# Ralph Progress Log
Started: Tue Jan 21 2026
PRD: VERSO Fee System Redesign (ralph/fee-system-redesign)
---

## Codebase Patterns
- Supabase foreign key joins (e.g., `profiles:user_id (...)`) may return arrays in TypeScript types even for single relationships - use `Array.isArray()` check to handle both cases
- UI components use shadcn/ui from @/components/ui/ (Badge, Button, Collapsible, etc.)
- Use cn() utility from @/lib/utils for conditional class names
- Navigation patterns: use `usePathname()` from next/navigation for active route detection
- Dark mode support via Tailwind dark: prefix classes
- ThemeProvider wraps layout and provides `useTheme()` hook for theme-aware styling
- Next.js file conventions: `loading.tsx` auto-wraps in Suspense, `error.tsx` creates error boundary with `error` and `reset` props
- URL params for filters/state: use `useSearchParams()` + `useRouter().push()` pattern for shareable links
- Reusable KPICard component at `@/components/dashboard/kpi-card.tsx` - supports icons, trends, additionalInfo breakdown
- Number formatting pattern: use toLocaleString() for counts, custom $XM/$XB formatting for large currency values
- Recharts pattern: Use LineChart with ResponsiveContainer, customize tooltip with a CustomTooltip component
- Data table pattern: Use @tanstack/react-table with useReactTable hook. Define ColumnDef[] with custom header and cell renderers
- Multi-select filter pattern: Use Popover + Command + CommandItem with checkbox styling for multi-select
- Debounce hook pattern: `useDebounce<T>(value: T, delay: number)` using useState + useEffect + setTimeout
- API multi-value filters: Support comma-separated values in query params, parse with `.split(',').filter(Boolean)`
- CSV export pattern: Create Blob with text/csv, use temporary anchor element with download attribute
- Badge variants: shadcn Badge only supports `default`, `secondary`, `destructive`, `outline` - for custom colors, use className override
- Entity type icon mapping: Use `Record<EntityType, LucideIcon>` with icons like Building2 (investor), Users (partner), Scale (lawyer), Handshake (commercial_partner), Globe (introducer), Landmark (arranger)

---

