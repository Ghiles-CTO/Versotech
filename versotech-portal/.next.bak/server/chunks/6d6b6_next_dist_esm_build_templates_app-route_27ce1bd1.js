module.exports=[505115,e=>{"use strict";var t=e.i(779444),r=e.i(698261),i=e.i(821776),s=e.i(796417),a=e.i(856890),o=e.i(26996),n=e.i(436944),d=e.i(88281),l=e.i(765944),u=e.i(984788),c=e.i(237011),p=e.i(712007),v=e.i(777657),f=e.i(13180),_=e.i(273827),m=e.i(193695);e.i(947956);var h=e.i(36217),y=e.i(433669),R=e.i(221640),w=e.i(414131),x=e.i(442862);async function g(e,{params:t}){try{let{id:e}=await t,r=await (0,y.createClient)(),{user:i,error:s}=await (0,R.getAuthenticatedUser)(r);if(s||!i)return w.NextResponse.json({error:"Unauthorized"},{status:401});if(!await (0,R.isStaffUser)(r,i))return w.NextResponse.json({error:"Staff access required"},{status:403});let a=(0,y.createServiceClient)(),{data:o,error:n}=await a.from("investors").select(`
        *,
        primary_rm_profile:profiles!investors_primary_rm_fkey (
          id,
          display_name,
          email
        ),
        secondary_rm_profile:profiles!investors_secondary_rm_fkey (
          id,
          display_name,
          email
        ),
        investor_users (
          user_id,
          profiles:profiles!investor_users_user_id_fkey (
            id,
            display_name,
            email,
            title,
            role
          )
        )
      `).eq("id",e).single();if(n){if("PGRST116"===n.code)return w.NextResponse.json({error:"Investor not found"},{status:404});return console.error("Fetch investor error:",n),w.NextResponse.json({error:"Failed to fetch investor"},{status:500})}return w.NextResponse.json({investor:o})}catch(e){return console.error("API /staff/investors/[id] GET error:",e),w.NextResponse.json({error:"Internal server error"},{status:500})}}async function E(e,{params:t}){try{let{id:r}=await t,i=await (0,y.createClient)(),{user:s,error:a}=await (0,R.getAuthenticatedUser)(i);if(a||!s)return w.NextResponse.json({error:"Unauthorized"},{status:401});if(!await (0,R.isStaffUser)(i,s))return w.NextResponse.json({error:"Staff access required"},{status:403});let o=(0,y.createServiceClient)(),{legal_name:n,display_name:d,type:l,email:u,phone:c,country:p,country_of_incorporation:v,tax_residency:f,primary_rm:_,secondary_rm:m,status:h,onboarding_status:g,kyc_status:E,aml_risk_rating:C,is_professional_investor:N,is_qualified_purchaser:A,is_pep:b,is_sanctioned:P,first_name:S,middle_name:T,middle_initial:q,last_name:j,name_suffix:I,date_of_birth:U,country_of_birth:O,nationality:k,phone_mobile:H,phone_office:D,is_us_citizen:M,is_us_taxpayer:F,us_taxpayer_id:$,country_of_tax_residency:K,id_type:L,id_number:G,id_issue_date:z,id_expiry_date:B,id_issuing_country:V,residential_street:X,residential_line_2:W,residential_city:Z,residential_state:J,residential_postal_code:Q,residential_country:Y,proof_of_address_date:ee,proof_of_address_expiry:et,tax_id_number:er}=await e.json(),ei=e=>""===e||void 0===e?null:e;if(u&&u.trim()){let{data:e}=await o.from("investors").select("id").eq("email",u).neq("id",r).single();if(e)return w.NextResponse.json({error:"Email already exists"},{status:409})}if(void 0!==l&&!["entity","institutional"].includes(l)){let{data:e}=await o.from("investors").select("type").eq("id",r).single();if(e&&["entity","institutional"].includes(e.type||"")){let{data:e}=await o.from("investor_members").select("id").eq("investor_id",r).eq("is_active",!0).limit(1);if(e&&e.length>0)return w.NextResponse.json({error:"Cannot change to non-entity type while members exist. Please remove members first."},{status:400})}}let es={};void 0!==n&&(es.legal_name=n),void 0!==d&&(es.display_name=ei(d)),void 0!==l&&(es.type=l),void 0!==u&&(es.email=ei(u)),void 0!==c&&(es.phone=ei(c)),void 0!==p&&(es.country=ei(p)),void 0!==v&&(es.country_of_incorporation=ei(v)),void 0!==f&&(es.tax_residency=ei(f)),void 0!==_&&(es.primary_rm=ei(_)),void 0!==m&&(es.secondary_rm=ei(m)),void 0!==h&&(es.status=h),void 0!==g&&(es.onboarding_status=g),void 0!==E&&(es.kyc_status=E),void 0!==C&&(es.aml_risk_rating=ei(C)),void 0!==N&&(es.is_professional_investor=N),void 0!==A&&(es.is_qualified_purchaser=A),void 0!==b&&(es.is_pep=b),void 0!==P&&(es.is_sanctioned=P),void 0!==S&&(es.first_name=ei(S)),void 0!==T&&(es.middle_name=ei(T)),void 0!==q&&(es.middle_initial=ei(q)),void 0!==j&&(es.last_name=ei(j)),void 0!==I&&(es.name_suffix=ei(I)),void 0!==U&&(es.date_of_birth=ei(U)),void 0!==O&&(es.country_of_birth=ei(O)),void 0!==k&&(es.nationality=ei(k)),void 0!==H&&(es.phone_mobile=ei(H)),void 0!==D&&(es.phone_office=ei(D)),void 0!==M&&(es.is_us_citizen=M),void 0!==F&&(es.is_us_taxpayer=F),void 0!==$&&(es.us_taxpayer_id=ei($)),void 0!==K&&(es.country_of_tax_residency=ei(K)),void 0!==L&&(es.id_type=ei(L)),void 0!==G&&(es.id_number=ei(G)),void 0!==z&&(es.id_issue_date=ei(z)),void 0!==B&&(es.id_expiry_date=ei(B)),void 0!==V&&(es.id_issuing_country=ei(V)),void 0!==X&&(es.residential_street=ei(X)),void 0!==W&&(es.residential_line_2=ei(W)),void 0!==Z&&(es.residential_city=ei(Z)),void 0!==J&&(es.residential_state=ei(J)),void 0!==Q&&(es.residential_postal_code=ei(Q)),void 0!==Y&&(es.residential_country=ei(Y)),void 0!==ee&&(es.proof_of_address_date=ei(ee)),void 0!==et&&(es.proof_of_address_expiry=ei(et)),void 0!==er&&(es.tax_id_number=ei(er)),es.updated_at=new Date().toISOString();let{data:ea,error:eo}=await o.from("investors").update(es).eq("id",r).select(`
        *,
        primary_rm_profile:profiles!investors_primary_rm_fkey (
          id,
          display_name,
          email
        ),
        secondary_rm_profile:profiles!investors_secondary_rm_fkey (
          id,
          display_name,
          email
        )
      `).single();if(eo)return console.error("Update investor error:",eo),w.NextResponse.json({error:eo.message},{status:500});return(0,x.revalidatePath)("/versotech/staff/investors"),(0,x.revalidatePath)(`/versotech/staff/investors/${r}`),w.NextResponse.json({investor:ea,message:"Investor updated successfully"})}catch(e){return console.error("API /staff/investors/[id] PATCH error:",e),w.NextResponse.json({error:"Internal server error"},{status:500})}}async function C(e,{params:t}){try{let{id:e}=await t,r=await (0,y.createClient)(),{user:i,error:s}=await (0,R.getAuthenticatedUser)(r);if(s||!i)return w.NextResponse.json({error:"Unauthorized"},{status:401});let{data:a}=await r.from("profiles").select("role").eq("id",i.id).single(),o=a?.role;if(!a||"staff_admin"!==o)return w.NextResponse.json({error:"Admin access required"},{status:403});let n=(0,y.createServiceClient)(),{data:d}=await n.from("subscriptions").select("id").eq("investor_id",e).eq("status","active");if(d&&d.length>0)return w.NextResponse.json({error:"Cannot delete investor with active subscriptions"},{status:400});let{error:l}=await n.from("investors").update({status:"archived",archived_at:new Date().toISOString()}).eq("id",e);if(l)return console.error("Archive investor error:",l),w.NextResponse.json({error:l.message},{status:500});return w.NextResponse.json({message:"Investor archived successfully"})}catch(e){return console.error("API /staff/investors/[id] DELETE error:",e),w.NextResponse.json({error:"Internal server error"},{status:500})}}e.s(["DELETE",()=>C,"GET",()=>g,"PATCH",()=>E],599636);var N=e.i(599636);let A=new t.AppRouteRouteModule({definition:{kind:r.RouteKind.APP_ROUTE,page:"/api/staff/investors/[id]/route",pathname:"/api/staff/investors/[id]",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/versotech-portal/src/app/api/staff/investors/[id]/route.ts",nextConfigOutput:"",userland:N}),{workAsyncStorage:b,workUnitAsyncStorage:P,serverHooks:S}=A;function T(){return(0,i.patchFetch)({workAsyncStorage:b,workUnitAsyncStorage:P})}async function q(e,t,i){A.isDev&&(0,s.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let y="/api/staff/investors/[id]/route";y=y.replace(/\/index$/,"")||"/";let R=await A.prepare(e,t,{srcPage:y,multiZoneDraftMode:!1});if(!R)return t.statusCode=400,t.end("Bad Request"),null==i.waitUntil||i.waitUntil.call(i,Promise.resolve()),null;let{buildId:w,params:x,nextConfig:g,parsedUrl:E,isDraftMode:C,prerenderManifest:N,routerServerContext:b,isOnDemandRevalidate:P,revalidateOnlyGenerated:S,resolvedPathname:T,clientReferenceManifest:q,serverActionsManifest:j}=R,I=(0,n.normalizeAppPath)(y),U=!!(N.dynamicRoutes[I]||N.routes[T]),O=async()=>((null==b?void 0:b.render404)?await b.render404(e,t,E,!1):t.end("This page could not be found"),null);if(U&&!C){let e=!!N.routes[T],t=N.dynamicRoutes[I];if(t&&!1===t.fallback&&!e){if(g.experimental.adapterPath)return await O();throw new m.NoFallbackError}}let k=null;!U||A.isDev||C||(k="/index"===(k=T)?"/":k);let H=!0===A.isDev||!U,D=U&&!H;j&&q&&(0,o.setManifestsSingleton)({page:y,clientReferenceManifest:q,serverActionsManifest:j});let M=e.method||"GET",F=(0,a.getTracer)(),$=F.getActiveScopeSpan(),K={params:x,prerenderManifest:N,renderOpts:{experimental:{authInterrupts:!!g.experimental.authInterrupts},cacheComponents:!!g.cacheComponents,supportsDynamicResponse:H,incrementalCache:(0,s.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:g.cacheLife,waitUntil:i.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,i,s)=>A.onRequestError(e,t,i,s,b)},sharedContext:{buildId:w}},L=new d.NodeNextRequest(e),G=new d.NodeNextResponse(t),z=l.NextRequestAdapter.fromNodeNextRequest(L,(0,l.signalFromNodeResponse)(t));try{let o=async e=>A.handle(z,K).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=F.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==u.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let i=r.get("next.route");if(i){let t=`${M} ${i}`;e.setAttributes({"next.route":i,"http.route":i,"next.span_name":t}),e.updateName(t)}else e.updateName(`${M} ${y}`)}),n=!!(0,s.getRequestMeta)(e,"minimalMode"),d=async s=>{var a,d;let l=async({previousCacheEntry:r})=>{try{if(!n&&P&&S&&!r)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let a=await o(s);e.fetchMetrics=K.renderOpts.fetchMetrics;let d=K.renderOpts.pendingWaitUntil;d&&i.waitUntil&&(i.waitUntil(d),d=void 0);let l=K.renderOpts.collectedTags;if(!U)return await (0,p.sendResponse)(L,G,a,K.renderOpts.pendingWaitUntil),null;{let e=await a.blob(),t=(0,v.toNodeOutgoingHttpHeaders)(a.headers);l&&(t[_.NEXT_CACHE_TAGS_HEADER]=l),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==K.renderOpts.collectedRevalidate&&!(K.renderOpts.collectedRevalidate>=_.INFINITE_CACHE)&&K.renderOpts.collectedRevalidate,i=void 0===K.renderOpts.collectedExpire||K.renderOpts.collectedExpire>=_.INFINITE_CACHE?void 0:K.renderOpts.collectedExpire;return{value:{kind:h.CachedRouteKind.APP_ROUTE,status:a.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:i}}}}catch(t){throw(null==r?void 0:r.isStale)&&await A.onRequestError(e,t,{routerKind:"App Router",routePath:y,routeType:"route",revalidateReason:(0,c.getRevalidateReason)({isStaticGeneration:D,isOnDemandRevalidate:P})},!1,b),t}},u=await A.handleResponse({req:e,nextConfig:g,cacheKey:k,routeKind:r.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:N,isRoutePPREnabled:!1,isOnDemandRevalidate:P,revalidateOnlyGenerated:S,responseGenerator:l,waitUntil:i.waitUntil,isMinimalMode:n});if(!U)return null;if((null==u||null==(a=u.value)?void 0:a.kind)!==h.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==u||null==(d=u.value)?void 0:d.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});n||t.setHeader("x-nextjs-cache",P?"REVALIDATED":u.isMiss?"MISS":u.isStale?"STALE":"HIT"),C&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let m=(0,v.fromNodeOutgoingHttpHeaders)(u.value.headers);return n&&U||m.delete(_.NEXT_CACHE_TAGS_HEADER),!u.cacheControl||t.getHeader("Cache-Control")||m.get("Cache-Control")||m.set("Cache-Control",(0,f.getCacheControlHeader)(u.cacheControl)),await (0,p.sendResponse)(L,G,new Response(u.value.body,{headers:m,status:u.value.status||200})),null};$?await d($):await F.withPropagatedContext(e.headers,()=>F.trace(u.BaseServerSpan.handleRequest,{spanName:`${M} ${y}`,kind:a.SpanKind.SERVER,attributes:{"http.method":M,"http.target":e.url}},d))}catch(t){if(t instanceof m.NoFallbackError||await A.onRequestError(e,t,{routerKind:"App Router",routePath:I,routeType:"route",revalidateReason:(0,c.getRevalidateReason)({isStaticGeneration:D,isOnDemandRevalidate:P})},!1,b),U)throw t;return await (0,p.sendResponse)(L,G,new Response(null,{status:500})),null}}e.s(["handler",()=>q,"patchFetch",()=>T,"routeModule",()=>A,"serverHooks",()=>S,"workAsyncStorage",()=>b,"workUnitAsyncStorage",()=>P],505115)}];

//# sourceMappingURL=6d6b6_next_dist_esm_build_templates_app-route_27ce1bd1.js.map