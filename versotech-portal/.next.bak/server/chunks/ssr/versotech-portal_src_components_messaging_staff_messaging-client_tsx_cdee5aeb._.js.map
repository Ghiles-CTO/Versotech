{"version":3,"sources":["../../../../../versotech-portal/src/components/messaging/staff/new-conversation-dialog.tsx","../../../../../versotech-portal/src/components/messaging/staff/messaging-client.tsx","../../../../../versotech-portal/src/components/messaging/staff/sidebar.tsx","../../../../../versotech-portal/node_modules/lucide-react/src/icons/message-square-plus.ts"],"sourcesContent":["'use client'\n\nimport { useMemo, useState } from 'react'\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n  DialogClose,\n} from '@/components/ui/dialog'\nimport { Button } from '@/components/ui/button'\nimport { Input } from '@/components/ui/input'\nimport { Textarea } from '@/components/ui/textarea'\nimport { Checkbox } from '@/components/ui/checkbox'\nimport { Badge } from '@/components/ui/badge'\nimport type { ConversationFilters } from '@/types/messaging'\nimport { cn } from '@/lib/utils'\n\nexport interface StaffDirectoryEntry {\n  id: string\n  display_name: string | null\n  email: string | null\n  role: string\n}\n\nexport interface InvestorDirectoryEntry {\n  id: string\n  display_name: string | null\n  email: string | null\n  role: string\n  investor_id: string | null\n  entity_name: string | null\n  entity_type: string | null\n}\n\ninterface NewConversationDialogProps {\n  open: boolean\n  onOpenChange: (open: boolean) => void\n  mode: 'dm' | 'group'\n  onCreate: (payload: {\n    subject: string\n    participantIds: string[]\n    visibility: ConversationFilters['visibility']\n    type: ConversationFilters['type']\n    initialMessage?: string\n  }) => void\n  staffDirectory: StaffDirectoryEntry[]\n  investorDirectory: InvestorDirectoryEntry[]\n  isSubmitting: boolean\n}\n\nconst CARD_CLASS = 'border border-slate-700 bg-slate-900/70 rounded-lg backdrop-blur'\n\ntype DirectoryItem =\n  | { kind: 'section'; title: string; description: string; count: number }\n  | { kind: 'group'; title: string }\n  | { kind: 'staff'; entry: StaffDirectoryEntry }\n  | { kind: 'investor'; entry: InvestorDirectoryEntry }\n  | { kind: 'empty'; message: string }\n\nexport function NewConversationDialog({\n  open,\n  onOpenChange,\n  mode,\n  onCreate,\n  staffDirectory,\n  investorDirectory,\n  isSubmitting,\n}: NewConversationDialogProps) {\n  const [subject, setSubject] = useState('')\n  const [initialMessage, setInitialMessage] = useState('')\n  const [selectedStaffIds, setSelectedStaffIds] = useState<string[]>([])\n  const [selectedInvestorIds, setSelectedInvestorIds] = useState<string[]>([])\n  const [searchQuery, setSearchQuery] = useState('')\n\n  console.log('[NewConversationDialog] Mode:', mode, 'Staff:', staffDirectory.length, 'Investors:', investorDirectory.length)\n\n  const isDM = mode === 'dm'\n  const isGroup = mode === 'group'\n\n  const totalSelected = selectedStaffIds.length + selectedInvestorIds.length\n  const hasInvestors = selectedInvestorIds.length > 0\n  \n  // For DM mode, get the selected person's name\n  const selectedPerson = useMemo(() => {\n    const allPeople = [...staffDirectory, ...investorDirectory]\n    const selectedId = [...selectedStaffIds, ...selectedInvestorIds][0]\n    return allPeople.find(p => p.id === selectedId)\n  }, [selectedStaffIds, selectedInvestorIds, staffDirectory, investorDirectory])\n\n  // Filter and group data\n  const filteredStaff = useMemo(() => {\n    if (!searchQuery) return staffDirectory\n    const query = searchQuery.toLowerCase()\n    return staffDirectory.filter(s => \n      s.display_name?.toLowerCase().includes(query) ||\n      s.email?.toLowerCase().includes(query)\n    )\n  }, [staffDirectory, searchQuery])\n  \n  const filteredInvestors = useMemo(() => {\n    if (!searchQuery) return investorDirectory\n    const query = searchQuery.toLowerCase()\n    return investorDirectory.filter(i =>\n      i.display_name?.toLowerCase().includes(query) ||\n      i.email?.toLowerCase().includes(query) ||\n      i.entity_name?.toLowerCase().includes(query)\n    )\n  }, [investorDirectory, searchQuery])\n  \n  // Group investors by entity\n  const investorsByEntity = useMemo(() => {\n    const groups = new Map<string, InvestorDirectoryEntry[]>()\n    \n    filteredInvestors.forEach(investor => {\n      const entityKey = investor.entity_name || 'Individual Investors'\n      if (!groups.has(entityKey)) {\n        groups.set(entityKey, [])\n      }\n      groups.get(entityKey)!.push(investor)\n    })\n    \n    return Array.from(groups.entries()).sort((a, b) => a[0].localeCompare(b[0]))\n  }, [filteredInvestors])\n\n  const combinedDirectoryItems = useMemo<DirectoryItem[]>(() => {\n    const items: DirectoryItem[] = []\n\n    items.push({\n      kind: 'section',\n      title: 'Staff Members',\n      description: 'Internal team available for messaging',\n      count: filteredStaff.length,\n    })\n\n    if (filteredStaff.length === 0) {\n      items.push({\n        kind: 'empty',\n        message: searchQuery ? 'No staff found' : 'No staff members available',\n      })\n    } else {\n      for (const entry of filteredStaff) {\n        items.push({ kind: 'staff', entry })\n      }\n    }\n\n    items.push({\n      kind: 'section',\n      title: 'Investors',\n      description: 'Include investor contacts in this thread',\n      count: filteredInvestors.length,\n    })\n\n    if (filteredInvestors.length === 0) {\n      items.push({\n        kind: 'empty',\n        message: searchQuery ? 'No investors found' : 'No investors available',\n      })\n    } else {\n      for (const [entityName, investors] of investorsByEntity) {\n        items.push({ kind: 'group', title: entityName })\n        for (const entry of investors) {\n          items.push({ kind: 'investor', entry })\n        }\n      }\n    }\n\n    return items\n  }, [filteredStaff, filteredInvestors, investorsByEntity, searchQuery])\n\n  const handleToggleStaff = (id: string) => {\n    if (isDM) {\n      // DM mode: Only one person total\n      setSelectedStaffIds([id])\n      setSelectedInvestorIds([]) // Clear investors\n    } else {\n      // Group mode: Multiple people\n    setSelectedStaffIds(prev =>\n      prev.includes(id) ? prev.filter(value => value !== id) : [...prev, id]\n    )\n    }\n  }\n\n  const handleToggleInvestor = (id: string) => {\n    if (isDM) {\n      // DM mode: Only one person total\n      setSelectedInvestorIds([id])\n      setSelectedStaffIds([]) // Clear staff\n    } else {\n      // Group mode: Multiple people\n    setSelectedInvestorIds(prev =>\n      prev.includes(id) ? prev.filter(value => value !== id) : [...prev, id]\n    )\n    }\n  }\n\n  const resetForm = () => {\n    setSubject('')\n    setInitialMessage('')\n    setSearchQuery('')\n    setSelectedStaffIds([])\n    setSelectedInvestorIds([])\n  }\n\n  const handleOpenChange = (next: boolean) => {\n    if (!next) {\n      resetForm()\n    }\n    onOpenChange(next)\n  }\n\n  const handleSubmit = () => {\n    const participantIds = [...selectedStaffIds, ...selectedInvestorIds]\n    \n    // For DM mode, use the selected person's name as subject\n    let finalSubject = subject.trim()\n    if (isDM && selectedPerson) {\n      finalSubject = selectedPerson.display_name || selectedPerson.email || 'Direct Message'\n    } else if (!finalSubject) {\n      finalSubject = 'Untitled conversation'\n    }\n    \n    const effectiveVisibility: ConversationFilters['visibility'] = hasInvestors ? 'investor' : 'internal'\n    const conversationType: ConversationFilters['type'] = isDM ? 'dm' : 'group'\n\n    console.log('[NewConversationDialog] Submitting:', {\n      mode,\n      subject: finalSubject,\n      participantIds,\n      totalParticipants: participantIds.length,\n      visibility: effectiveVisibility,\n      type: conversationType,\n    })\n\n    onCreate({\n      subject: finalSubject,\n      participantIds,\n      visibility: effectiveVisibility,\n      type: conversationType,\n      initialMessage: initialMessage.trim() || undefined,\n    })\n  }\n  \n  // Validation\n  const canSubmit = isDM ? totalSelected === 1 : totalSelected > 0\n\n  return (\n    <Dialog open={open} onOpenChange={handleOpenChange}>\n      <DialogContent\n        className=\"w-[min(95vw,1100px)] rounded-2xl border border-slate-700 bg-slate-950 p-0 text-slate-50\"\n        showCloseButton={false}\n      >\n        <div className=\"flex h-[min(90vh,880px)] flex-col\">\n          <div className=\"flex items-start justify-between gap-3 border-b border-slate-800 px-6 py-5\">\n            <DialogHeader className=\"flex-1 gap-1\">\n              <DialogTitle className=\"text-2xl font-semibold text-white\">\n            {isDM ? 'Start New Direct Conversation' : 'Create New Group'}\n          </DialogTitle>\n              <DialogDescription className=\"mt-1 text-base text-slate-300\">\n            {isDM \n              ? 'Select one person to start a direct conversation with.'\n              : 'Select multiple people and give your group a name.'}\n          </DialogDescription>\n        </DialogHeader>\n            <DialogClose className=\"rounded-md border border-slate-600 px-3 py-1 text-sm text-slate-200 transition-colors hover:bg-slate-800 hover:text-white\">\n              Close\n            </DialogClose>\n          </div>\n\n          <div className=\"flex-1 min-h-0 overflow-hidden\">\n            <div className=\"h-full overflow-y-auto px-6 py-6 space-y-6\">\n          {isGroup && (\n            <div className=\"space-y-2\">\n              <label htmlFor=\"group-name\" className=\"text-sm font-semibold text-white\">\n                Group Name <span className=\"text-red-400\">*</span>\n              </label>\n              <Input\n                id=\"group-name\"\n                placeholder=\"e.g., Q4 Planning Team\"\n                value={subject}\n                onChange={event => setSubject(event.target.value)}\n                    className=\"h-11 bg-slate-900 border-slate-700 text-white placeholder:text-slate-400\"\n              />\n            </div>\n          )}\n          \n          {isDM && selectedPerson && (\n                <div className=\"rounded-lg border border-blue-500/40 bg-blue-500/10 p-4\">\n                  <p className=\"text-xs font-semibold uppercase tracking-wider text-blue-300\">Starting conversation with</p>\n                  <p className=\"mt-1 text-lg font-semibold text-white\">\n                {selectedPerson.display_name || selectedPerson.email}\n              </p>\n              <p className=\"text-sm text-slate-300\">{selectedPerson.email}</p>\n            </div>\n          )}\n\n          <div className=\"space-y-3\">\n              <label htmlFor=\"initial-message\" className=\"text-base font-semibold text-white\">\n                {isDM ? 'First message' : 'Initial message'} <span className=\"text-slate-400 font-normal\">(optional)</span>\n              </label>\n              <Textarea\n                id=\"initial-message\"\n                placeholder={isDM ? 'Say hello...' : 'Kick off the conversation...'}\n                value={initialMessage}\n                onChange={event => setInitialMessage(event.target.value)}\n                rows={3}\n                className=\"bg-slate-900 border border-slate-700 text-white placeholder:text-slate-500 focus:border-blue-500\"\n              />\n            </div>\n\n            <div className=\"space-y-3\">\n              <label htmlFor=\"search-people\" className=\"text-base font-semibold text-white\">\n                {isDM ? 'Select one person' : 'Select participants'}\n              </label>\n              <Input\n                id=\"search-people\"\n                placeholder=\"Search by name or email...\"\n                value={searchQuery}\n                onChange={event => setSearchQuery(event.target.value)}\n                className=\"h-12 bg-slate-900 border border-slate-700 text-white placeholder:text-slate-500 focus:border-blue-500\"\n              />\n            </div>\n\n            <section className=\"rounded-xl border border-slate-800 bg-slate-900/70\">\n              <div className=\"max-h-[calc(80vh-240px)] overflow-y-auto px-5 py-4 space-y-4\">\n                {combinedDirectoryItems.map((item, index) => {\n                  switch (item.kind) {\n                    case 'section':\n                      return (\n                        <div key={`${item.kind}-${item.title}-${index}`} className=\"flex items-center justify-between\">\n                          <div>\n                            <p className=\"text-sm font-semibold text-white\">{item.title}</p>\n                            <p className=\"text-xs text-slate-400\">{item.description}</p>\n                          </div>\n                          <Badge variant=\"outline\" className=\"border-slate-600 bg-slate-800 text-xs font-semibold uppercase text-slate-200\">\n                            {item.count}\n                          </Badge>\n                        </div>\n                      )\n                    case 'group':\n                      return (\n                        <div key={`group-${item.title}-${index}`} className=\"pt-3 text-xs font-semibold uppercase tracking-wider text-slate-300\">\n                          {item.title}\n                        </div>\n                      )\n                    case 'empty':\n                      return (\n                        <p key={`empty-${item.message}-${index}`} className=\"py-6 text-center text-sm text-slate-400\">\n                          {item.message}\n                        </p>\n                      )\n                    case 'staff': {\n                      const entry = item.entry\n                      const isSelected = selectedStaffIds.includes(entry.id)\n                      return (\n                        <label\n                          key={`staff-${entry.id}-${index}`}\n                          className={cn(\n                            'flex flex-col gap-2 rounded-xl border px-4 py-4 transition-colors',\n                            isSelected\n                              ? 'border-blue-500 bg-blue-500/15 shadow-[0_0_0_1px_rgba(59,130,246,0.35)]'\n                              : 'border-slate-700 hover:border-slate-600 hover:bg-slate-800/60'\n                          )}\n                          onClick={() => handleToggleStaff(entry.id)}\n                        >\n                          <div className=\"flex items-center justify-between gap-4\">\n                            <div className=\"flex items-center gap-2\">\n                              {isGroup ? (\n                                <Checkbox\n                                  checked={isSelected}\n                                  onCheckedChange={() => handleToggleStaff(entry.id)}\n                                  className=\"h-5 w-5\"\n                                />\n                              ) : (\n                                <span\n                                  className={cn(\n                                    'flex h-5 w-5 items-center justify-center rounded-full border-2',\n                                    isSelected ? 'border-blue-400 bg-blue-500' : 'border-slate-500'\n                                  )}\n                                >\n                                  {isSelected && <span className=\"h-2.5 w-2.5 rounded-full bg-white\" />}\n                                </span>\n                              )}\n                              <p className=\"text-base font-semibold text-white leading-tight whitespace-normal\">\n                                {entry.display_name || entry.email || 'Staff member'}\n                              </p>\n                            </div>\n                            <Badge variant=\"outline\" className=\"border-slate-600 bg-slate-800 text-xs font-semibold uppercase text-slate-200\">\n                              {entry.role.replace('staff_', '')}\n                            </Badge>\n                          </div>\n                          <p className=\"text-sm text-slate-300 leading-tight whitespace-normal\">\n                            {entry.email}\n                          </p>\n                        </label>\n                      )\n                    }\n                    case 'investor': {\n                      const entry = item.entry\n                      const isSelected = selectedInvestorIds.includes(entry.id)\n                      return (\n                        <label\n                          key={`investor-${entry.id}-${index}`}\n                          className={cn(\n                            'flex flex-col gap-2 rounded-xl border px-4 py-4 transition-colors',\n                            isSelected\n                              ? 'border-blue-500 bg-blue-500/15 shadow-[0_0_0_1px_rgba(59,130,246,0.35)]'\n                              : 'border-slate-700 hover-border-slate-600 hover:bg-slate-800/60'\n                          )}\n                          onClick={() => handleToggleInvestor(entry.id)}\n                        >\n                          <div className=\"flex items-center justify-between gap-4\">\n                            <div className=\"flex items-center gap-2\">\n                              {isGroup ? (\n                                <Checkbox\n                                  checked={isSelected}\n                                  onCheckedChange={() => handleToggleInvestor(entry.id)}\n                                  className=\"h-5 w-5\"\n                                />\n                              ) : (\n                                <span\n                                  className={cn(\n                                    'flex h-5 w-5 items-center justify-center rounded-full border-2',\n                                    isSelected ? 'border-blue-400 bg-blue-500' : 'border-slate-500'\n                                  )}\n                                >\n                                  {isSelected && <span className=\"h-2.5 w-2.5 rounded-full bg-white\" />}\n                                </span>\n                              )}\n                              <span className=\"text-base font-semibold text-white leading-tight whitespace-normal\">\n                                {entry.display_name || entry.email || 'Investor'}\n                              </span>\n                            </div>\n                            {entry.entity_type && (\n                              <Badge variant=\"outline\" className=\"border-blue-400/60 bg-blue-500/10 text-xs font-semibold capitalize text-blue-200\">\n                                {entry.entity_type}\n                              </Badge>\n                            )}\n                          </div>\n                          <p className=\"text-sm text-slate-300 leading-tight whitespace-normal\">\n                            {entry.email}\n                          </p>\n                        </label>\n                      )\n                    }\n                  }\n                })}\n              </div>\n            </section>\n\n            <div className=\"rounded-xl border border-slate-800 bg-slate-900/70 px-6 py-4\">\n              <p className=\"text-sm font-semibold uppercase tracking-wide text-white\">Summary</p>\n              <p className=\"mt-2 text-base text-white\">\n                {isDM ? (\n                  totalSelected === 1 \n                    ? `Ready to message ${selectedPerson?.display_name || selectedPerson?.email}`\n                    : 'Select one person to continue'\n                ) : (\n                  `${totalSelected} participant${totalSelected === 1 ? '' : 's'} selected`\n                )}\n              </p>\n              {hasInvestors && (\n                <p className=\"mt-2 text-sm font-medium text-blue-300\">\n                  ✓ Contains investors • Visibility automatically set to Investor\n                </p>\n              )}\n              {!canSubmit && (\n                <p className=\"mt-2 text-sm text-red-300\">\n                  {isDM ? '⚠ Select exactly one person' : '⚠ Select at least one participant'}\n                </p>\n              )}\n              {isGroup && !subject.trim() && (\n                <p className=\"mt-2 text-sm text-red-300\">⚠ Group name is required</p>\n              )}\n            </div>\n          </div>\n        </div>\n\n        <DialogFooter className=\"gap-3 border-t border-slate-800 px-6 py-4\">\n          <Button\n            type=\"button\"\n            variant=\"outline\"\n            onClick={() => handleOpenChange(false)}\n            disabled={isSubmitting}\n            className=\"h-11 border border-slate-600 bg-slate-900 text-slate-100 transition-colors hover:bg-slate-800 hover:text-white\"\n          >\n            Cancel\n          </Button>\n          <Button\n            type=\"button\"\n            onClick={handleSubmit}\n            disabled={isSubmitting || !canSubmit || (isGroup && !subject.trim())}\n              className=\"h-11 bg-blue-600 px-8 text-base font-semibold text-white shadow-[0_8px_16px_rgba(37,99,235,0.35)] transition-colors hover:bg-blue-500\"\n          >\n            {isSubmitting ? 'Creating…' : isDM ? 'Start Conversation' : 'Create Group'}\n          </Button>\n        </DialogFooter>\n        </div>\n      </DialogContent>\n    </Dialog>\n  )\n}","'use client'\r\n\r\nimport { useCallback, useMemo, useRef, useState, useEffect } from 'react'\r\nimport type { ConversationSummary, ConversationFilters } from '@/types/messaging'\r\nimport { fetchConversationsClient, markConversationRead } from '@/lib/messaging'\r\nimport { ConversationsSidebar } from './sidebar'\r\nimport { ConversationView } from './conversation-view'\r\nimport { createClient } from '@/lib/supabase/client'\r\nimport { toast } from 'sonner'\r\nimport { NewConversationDialog } from './new-conversation-dialog'\r\nimport type { StaffDirectoryEntry, InvestorDirectoryEntry } from './new-conversation-dialog'\r\n\r\ninterface MessagingClientProps {\r\n  initialConversations: ConversationSummary[]\r\n  currentUserId: string\r\n  /** If false, hides \"New Conversation\" and doesn't load staff/investor directories. Default: true (staff behavior) */\r\n  canCreateConversation?: boolean\r\n}\r\n\r\nconst INITIAL_FILTERS: ConversationFilters = {\r\n  visibility: 'all',\r\n  type: 'all',\r\n}\r\n\r\nexport function MessagingClient({ initialConversations, currentUserId, canCreateConversation = true }: MessagingClientProps) {\r\n  const supabase = useMemo(() => createClient(), [])\r\n  const [filters, setFilters] = useState<ConversationFilters>(INITIAL_FILTERS)\r\n  const [conversations, setConversations] = useState<ConversationSummary[]>(initialConversations)\r\n  const [isLoading, setIsLoading] = useState(false)\r\n  const [activeConversationId, setActiveConversationId] = useState<string | null>(initialConversations[0]?.id || null)\r\n  const [errorMessage, setErrorMessage] = useState<string | null>(null)\r\n  const [isNewConversationOpen, setIsNewConversationOpen] = useState(false)\r\n  const [conversationMode, setConversationMode] = useState<'dm' | 'group'>('dm')\r\n  const [staffDirectory, setStaffDirectory] = useState<StaffDirectoryEntry[]>([])\r\n  const [investorDirectory, setInvestorDirectory] = useState<InvestorDirectoryEntry[]>([])\r\n  const [isCreatingConversation, setIsCreatingConversation] = useState(false)\r\n\r\n  // Ref to track active conversation without recreating subscriptions\r\n  const activeConversationIdRef = useRef(activeConversationId)\r\n  activeConversationIdRef.current = activeConversationId\r\n\r\n  console.log('[MessagingClient] Initial conversations:', initialConversations.length)\r\n  console.log('[MessagingClient] Current conversations state:', conversations.length)\r\n  console.log('[MessagingClient] Filters:', filters)\r\n\r\n  const activeConversation = conversations.find(conv => conv.id === activeConversationId) || null\r\n\r\n  const loadConversations = useCallback(async (nextFilters?: ConversationFilters, silent = false) => {\r\n    console.log('[MessagingClient] loadConversations called with filters:', nextFilters || filters, 'silent:', silent)\r\n    if (!silent) setIsLoading(true)\r\n    setErrorMessage(null)\r\n    try {\r\n      const filtersToUse = nextFilters || filters\r\n      const { conversations: data } = await fetchConversationsClient({ ...filtersToUse, includeMessages: true, limit: 50 })\r\n      console.log('[MessagingClient] Fetched conversations:', data.length)\r\n      setConversations(data)\r\n\r\n      // If no conversations found and we have an active one, keep it\r\n      // Otherwise select the first one\r\n      if (data.length > 0 && !activeConversationId) {\r\n        setActiveConversationId(data[0].id)\r\n      }\r\n    } catch (error: any) {\r\n      console.error('[MessagingClient] Load conversations error', error)\r\n      setErrorMessage(error.message || 'Failed to load conversations')\r\n    } finally {\r\n      if (!silent) setIsLoading(false)\r\n    }\r\n  }, [filters, activeConversationId])\r\n\r\n  const handleFiltersChange = useCallback((nextFilters: ConversationFilters) => {\r\n    setFilters(nextFilters)\r\n    loadConversations(nextFilters)\r\n  }, [loadConversations])\r\n\r\n  const handleRefresh = useCallback(() => {\r\n    loadConversations(filters)\r\n  }, [loadConversations, filters])\r\n\r\n  const handleSelectConversation = useCallback((conversationId: string) => {\r\n    setActiveConversationId(conversationId)\r\n    // Optimistically update local state to clear unread badge immediately\r\n    setConversations(prev => prev.map(conv =>\r\n      conv.id === conversationId ? { ...conv, unreadCount: 0 } : conv\r\n    ))\r\n    markConversationRead(conversationId).catch(console.error)\r\n  }, [])\r\n\r\n  // Global realtime subscription for conversations and messages\r\n  useEffect(() => {\r\n    console.log('[Staff Messages] Setting up realtime subscription')\r\n\r\n    const channel = supabase\r\n      .channel('staff_conversations_all')\r\n      .on('postgres_changes', {\r\n        event: 'INSERT',\r\n        schema: 'public',\r\n        table: 'conversations'\r\n      }, () => {\r\n        console.log('[Realtime] New conversation created, refreshing list')\r\n        void fetchConversationsClient({ ...filters, includeMessages: true, limit: 50 })\r\n          .then(({ conversations: data }) => {\r\n            setConversations(data)\r\n          })\r\n          .catch(console.error)\r\n      })\r\n      .on('postgres_changes', {\r\n        event: 'INSERT',\r\n        schema: 'public',\r\n        table: 'messages'\r\n      }, (payload) => {\r\n        // Refresh conversation list when new messages arrive in non-active conversations\r\n        // This updates preview text, timestamps, and unread counts\r\n        const messageConvId = (payload.new as { conversation_id?: string })?.conversation_id\r\n        if (messageConvId && messageConvId !== activeConversationIdRef.current) {\r\n          console.log('[Realtime] New message in background conversation, refreshing list')\r\n          void fetchConversationsClient({ ...filters, includeMessages: true, limit: 50 })\r\n            .then(({ conversations: data }) => {\r\n              setConversations(data)\r\n            })\r\n            .catch(console.error)\r\n        }\r\n      })\r\n      .subscribe((status) => {\r\n        console.log('[Realtime] Subscription status:', status)\r\n      })\r\n\r\n    return () => {\r\n      console.log('[Staff Messages] Cleaning up realtime subscription')\r\n      supabase.removeChannel(channel)\r\n    }\r\n  }, [supabase, filters])\r\n\r\n  const handleComposerError = useCallback((message: string) => {\r\n    toast.error(message)\r\n  }, [])\r\n  \r\n  const handleDeleteConversation = useCallback((conversationId: string) => {\r\n    console.log('[MessagingClient] Deleting conversation:', conversationId)\r\n    // Remove from local state\r\n    setConversations(prev => prev.filter(c => c.id !== conversationId))\r\n    setActiveConversationId(null)\r\n    toast.success('Conversation deleted')\r\n  }, [])\r\n\r\n  useEffect(() => {\r\n    // Only load directories if user can create conversations (staff only)\r\n    if (!canCreateConversation) {\r\n      console.log('[MessagingClient] Skipping directory load - user cannot create conversations')\r\n      return\r\n    }\r\n\r\n    const loadDirectories = async () => {\r\n      try {\r\n        console.log('[MessagingClient] Loading staff and investor directories...')\r\n        const [staffResponse, investorResponse] = await Promise.all([\r\n          fetch('/api/staff/available'),\r\n          fetch('/api/investors/available'),\r\n        ])\r\n\r\n        if (staffResponse.ok) {\r\n          const data = await staffResponse.json()\r\n          console.log('[MessagingClient] Staff directory loaded:', data.staff?.length || 0, 'members')\r\n          setStaffDirectory(data.staff || [])\r\n        } else {\r\n          console.error('[MessagingClient] Staff fetch failed:', staffResponse.status)\r\n        }\r\n\r\n        if (investorResponse.ok) {\r\n          const data = await investorResponse.json()\r\n          console.log('[MessagingClient] Investor directory loaded:', data.investors?.length || 0, 'investors')\r\n          console.log('[MessagingClient] Sample investor:', data.investors?.[0])\r\n          setInvestorDirectory(data.investors || [])\r\n        } else {\r\n          console.error('[MessagingClient] Investor fetch failed:', investorResponse.status)\r\n        }\r\n      } catch (error) {\r\n        console.error('[MessagingClient] Failed to load directories', error)\r\n      }\r\n    }\r\n\r\n    loadDirectories()\r\n  }, [canCreateConversation])\r\n\r\n  const handleCreateConversation = async (payload: {\r\n    subject: string\r\n    participantIds: string[]\r\n    visibility: ConversationFilters['visibility']\r\n    type: ConversationFilters['type']\r\n    initialMessage?: string\r\n  }) => {\r\n    const uniqueParticipants = Array.from(new Set(payload.participantIds))\r\n\r\n    console.log('[MessagingClient] Creating conversation:', {\r\n      subject: payload.subject,\r\n      participants: uniqueParticipants.length,\r\n      type: payload.type,\r\n      visibility: payload.visibility\r\n    })\r\n\r\n    if (!uniqueParticipants.length) {\r\n      toast.error('Select at least one participant')\r\n      return\r\n    }\r\n\r\n    setIsCreatingConversation(true)\r\n    try {\r\n      const requestBody = {\r\n        subject: payload.subject,\r\n        participant_ids: uniqueParticipants,\r\n        type: payload.type,\r\n        visibility: payload.visibility === 'all' ? 'internal' : payload.visibility,\r\n        initial_message: payload.initialMessage,\r\n      }\r\n      \r\n      console.log('[MessagingClient] Request payload:', requestBody)\r\n\r\n      const response = await fetch('/api/conversations', {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify(requestBody),\r\n      })\r\n\r\n      if (!response.ok) {\r\n        const data = await response.json().catch(() => null)\r\n        console.error('[MessagingClient] Create conversation error:', data)\r\n        throw new Error(data?.error || 'Failed to create conversation')\r\n      }\r\n\r\n      const result = await response.json()\r\n      console.log('[MessagingClient] Conversation created:', result)\r\n\r\n      toast.success('Conversation created successfully!')\r\n      setIsNewConversationOpen(false)\r\n      await loadConversations(filters)\r\n\r\n      if (result?.conversation?.id) {\r\n        setActiveConversationId(result.conversation.id)\r\n      }\r\n    } catch (error: any) {\r\n      console.error('[MessagingClient] Create conversation failed:', error)\r\n      toast.error(error.message || 'Unable to create conversation')\r\n    } finally {\r\n      setIsCreatingConversation(false)\r\n    }\r\n  }\r\n\r\n  return (\r\n    <div className=\"flex h-[calc(100vh-4rem)] overflow-hidden\">\r\n      <ConversationsSidebar\r\n        conversations={conversations}\r\n        filters={filters}\r\n        onFiltersChange={handleFiltersChange}\r\n        onRefresh={handleRefresh}\r\n        onSelectConversation={handleSelectConversation}\r\n        onCreateConversation={(mode) => {\r\n          setConversationMode(mode)\r\n          setIsNewConversationOpen(true)\r\n        }}\r\n        activeConversationId={activeConversationId}\r\n        isLoading={isLoading}\r\n        errorMessage={errorMessage}\r\n        canCreateConversation={canCreateConversation}\r\n      />\r\n      <div className=\"flex-1 flex flex-col\">\r\n        {activeConversation ? (\r\n          <ConversationView\r\n            key={activeConversation.id}\r\n            conversation={activeConversation}\r\n            currentUserId={currentUserId}\r\n            onRead={() => markConversationRead(activeConversation.id)}\r\n            onError={handleComposerError}\r\n            onDelete={handleDeleteConversation}\r\n          />\r\n        ) : (\r\n          <div className=\"flex items-center justify-center h-full text-muted-foreground\">\r\n            Select a conversation to get started\r\n          </div>\r\n        )}\r\n      </div>\r\n      {canCreateConversation && (\r\n        <NewConversationDialog\r\n          open={isNewConversationOpen}\r\n          onOpenChange={setIsNewConversationOpen}\r\n          mode={conversationMode}\r\n          staffDirectory={staffDirectory}\r\n          investorDirectory={investorDirectory}\r\n          onCreate={handleCreateConversation}\r\n          isSubmitting={isCreatingConversation}\r\n        />\r\n      )}\r\n    </div>\r\n  )\r\n}\r\n\r\n\r\n","import type { ConversationFilters, ConversationSummary } from '@/types/messaging'\nimport { cn } from '@/lib/utils'\nimport { Button } from '@/components/ui/button'\nimport { Badge } from '@/components/ui/badge'\nimport { Input } from '@/components/ui/input'\nimport { Avatar, AvatarFallback, AvatarImage } from '@/components/ui/avatar'\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select'\nimport { Loader2, RefreshCw, MessageSquarePlus, Search } from 'lucide-react'\nimport { useMemo, useState } from 'react'\nimport { applyConversationFilters, sortConversations, formatRelativeTime, getInitials, truncateText } from '@/lib/messaging'\n\ninterface ConversationsSidebarProps {\n  conversations: ConversationSummary[]\n  filters: ConversationFilters\n  onFiltersChange: (filters: ConversationFilters) => void\n  onRefresh: () => void\n  onSelectConversation: (conversationId: string) => void\n  onCreateConversation: (mode: 'dm' | 'group') => void\n  activeConversationId: string | null\n  isLoading: boolean\n  errorMessage: string | null\n  /** If false, hides New Chat/Group buttons. Default: true */\n  canCreateConversation?: boolean\n}\n\nconst VISIBILITY_FILTERS: Array<{ value: ConversationFilters['visibility']; label: string }> = [\n  { value: 'all', label: 'All' },\n  { value: 'investor', label: 'Investor' },\n  { value: 'internal', label: 'Internal' },\n  { value: 'deal', label: 'Deals' },\n]\n\nconst TYPE_FILTERS: Array<{ value: ConversationFilters['type']; label: string }> = [\n  { value: 'all', label: 'All Types' },\n  { value: 'dm', label: 'Direct' },\n  { value: 'group', label: 'Group' },\n  { value: 'deal_room', label: 'Deal Rooms' },\n  { value: 'broadcast', label: 'Broadcasts' },\n]\n\nexport function ConversationsSidebar({\n  conversations,\n  filters,\n  onFiltersChange,\n  onRefresh,\n  onSelectConversation,\n  onCreateConversation,\n  activeConversationId,\n  isLoading,\n  errorMessage,\n  canCreateConversation = true,\n}: ConversationsSidebarProps) {\n  const [searchValue, setSearchValue] = useState(filters.search || '')\n\n  const filteredConversations = useMemo(() => {\n    const nextFilters: ConversationFilters = {\n      ...filters,\n      search: searchValue || undefined,\n    }\n    const filtered = applyConversationFilters(conversations, nextFilters)\n    return sortConversations(filtered)\n  }, [conversations, filters, searchValue])\n\n  const handleVisibilityChange = (value: ConversationFilters['visibility']) => {\n    onFiltersChange({ ...filters, visibility: value })\n  }\n\n  const handleTypeChange = (value: ConversationFilters['type']) => {\n    onFiltersChange({ ...filters, type: value })\n  }\n\n  const toggleUnread = () => {\n    onFiltersChange({ ...filters, unreadOnly: !filters.unreadOnly })\n  }\n\n  const handleSearchChange = (value: string) => {\n    setSearchValue(value)\n    onFiltersChange({ ...filters, search: value || undefined })\n  }\n\n  const unreadTotals = useMemo(() => {\n    const totals: Record<ConversationFilters['visibility'], number> = {\n      all: 0,\n      investor: 0,\n      internal: 0,\n      deal: 0,\n    }\n\n    for (const conversation of conversations) {\n      totals.all += conversation.unreadCount || 0\n      totals[conversation.visibility] += conversation.unreadCount || 0\n    }\n\n    return totals\n  }, [conversations])\n\n  return (\n    <aside className=\"w-full sm:w-[360px] border-r border-border bg-card flex flex-col text-foreground\">\n      <div className=\"p-4 border-b border-border space-y-3\">\n        <div className=\"flex items-center justify-between gap-2 text-foreground\">\n          <div>\n            <h2 className=\"text-lg font-semibold\">Messages</h2>\n            <p className=\"text-xs text-muted-foreground\">Track investor and internal threads</p>\n          </div>\n          <Button\n            variant=\"ghost\"\n            size=\"icon\"\n            onClick={onRefresh}\n            disabled={isLoading}\n            className=\"text-foreground hover:text-foreground hover:bg-muted\"\n          >\n            {isLoading ? <Loader2 className=\"h-4 w-4 animate-spin\" /> : <RefreshCw className=\"h-4 w-4\" />}\n          </Button>\n        </div>\n\n        <div className=\"grid grid-cols-2 gap-2\">\n          <Select value={filters.visibility} onValueChange={handleVisibilityChange}>\n            <SelectTrigger className=\"bg-muted border-border text-foreground\">\n              <SelectValue placeholder=\"Visibility\" />\n            </SelectTrigger>\n            <SelectContent className=\"bg-muted text-popover-foreground border-border\">\n              {VISIBILITY_FILTERS.map(filter => (\n                <SelectItem key={filter.value} value={filter.value}>\n                  <div className=\"flex items-center justify-between gap-2\">\n                    <span>{filter.label}</span>\n                    <Badge variant=\"secondary\" className=\"bg-secondary text-foreground\">\n                      {unreadTotals[filter.value]}\n                    </Badge>\n                  </div>\n                </SelectItem>\n              ))}\n            </SelectContent>\n          </Select>\n\n          <Select value={filters.type} onValueChange={handleTypeChange}>\n            <SelectTrigger className=\"bg-muted border-border text-foreground\">\n              <SelectValue placeholder=\"Type\" />\n            </SelectTrigger>\n            <SelectContent className=\"bg-muted text-popover-foreground border-border\">\n              {TYPE_FILTERS.map(filter => (\n                <SelectItem key={filter.value} value={filter.value}>\n                  {filter.label}\n                </SelectItem>\n              ))}\n            </SelectContent>\n          </Select>\n        </div>\n\n        <div className=\"space-y-2\">\n          <Button\n            variant={filters.unreadOnly ? 'default' : 'outline'}\n            size=\"sm\"\n            className=\"w-full text-popover-foreground\"\n            onClick={toggleUnread}\n          >\n            Unread {filters.unreadOnly ? '' : `(${unreadTotals.all})`}\n          </Button>\n\n          {canCreateConversation && (\n            <div className=\"grid grid-cols-2 gap-2\">\n              <Button\n                size=\"sm\"\n                variant=\"default\"\n                className=\"bg-blue-600 hover:bg-blue-700 text-white\"\n                onClick={() => onCreateConversation('dm')}\n              >\n                <MessageSquarePlus className=\"h-3.5 w-3.5 mr-1.5\" />\n                New Chat\n              </Button>\n              <Button\n                size=\"sm\"\n                variant=\"outline\"\n                className=\"border-border text-popover-foreground hover:bg-muted\"\n                onClick={() => onCreateConversation('group')}\n              >\n                <MessageSquarePlus className=\"h-3.5 w-3.5 mr-1.5\" />\n                New Group\n              </Button>\n            </div>\n          )}\n        </div>\n\n        <Input\n          placeholder=\"Search conversations\"\n          value={searchValue}\n          onChange={event => handleSearchChange(event.target.value)}\n          className=\"bg-muted border-border text-popover-foreground placeholder:text-muted-foreground\"\n        />\n\n        {errorMessage ? (\n          <div className=\"text-xs text-red-300 border border-red-500/40 bg-red-500/10 p-2 rounded\">\n            {errorMessage}\n          </div>\n        ) : null}\n      </div>\n\n      <div className=\"flex-1 overflow-y-auto bg-background\">\n        {filteredConversations.length === 0 ? (\n          <div className=\"flex flex-col items-center justify-center h-full text-muted-foreground text-sm\">\n            {isLoading ? 'Loading conversations…' : 'No conversations match your filters.'}\n          </div>\n        ) : (\n          <ul className=\"p-2 space-y-1\">\n            {filteredConversations.map(conversation => {\n              const isActive = conversation.id === activeConversationId\n              const firstParticipant = conversation.participants[0]\n              const timestamp = conversation.lastMessageAt || conversation.createdAt\n              \n              return (\n                <li key={conversation.id}>\n                  <button\n                    className={cn(\n                      'w-full text-left px-3 py-3 rounded-lg group',\n                      'transition-all duration-200 ease-out',\n                      'hover:bg-muted/80 hover:shadow-md hover:scale-[1.02]',\n                      'focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2',\n                      'active:scale-[0.98]',\n                      isActive ? 'bg-muted shadow-sm scale-[1.01]' : 'bg-transparent'\n                    )}\n                    onClick={() => onSelectConversation(conversation.id)}\n                  >\n                    <div className=\"flex items-start gap-3\">\n                      {/* Avatar */}\n                      <div className=\"relative\">\n                        <Avatar className=\"h-11 w-11 transition-transform duration-200 group-hover:scale-110\">\n                          {firstParticipant?.avatarUrl && (\n                            <AvatarImage src={firstParticipant.avatarUrl} alt={firstParticipant.displayName || firstParticipant.email || 'User'} />\n                          )}\n                          <AvatarFallback className=\"bg-secondary text-foreground text-sm font-medium\">\n                            {getInitials(firstParticipant?.displayName || firstParticipant?.email)}\n                          </AvatarFallback>\n                        </Avatar>\n                        {conversation.unreadCount > 0 && (\n                          <div className=\"absolute -top-1 -right-1 h-5 w-5 rounded-full bg-blue-500 flex items-center justify-center shadow-lg animate-pulse\">\n                            <span className=\"text-[10px] font-bold text-white\">\n                              {conversation.unreadCount > 9 ? '9+' : conversation.unreadCount}\n                            </span>\n                          </div>\n                        )}\n                      </div>\n\n                      {/* Content */}\n                      <div className=\"flex-1 min-w-0\">\n                        <div className=\"flex items-baseline justify-between gap-2 mb-1\">\n                          <span className={cn(\n                            \"font-semibold truncate text-sm\",\n                            conversation.unreadCount > 0 ? \"text-white\" : \"text-foreground\"\n                          )}>\n                            {conversation.subject || 'Untitled Conversation'}\n                          </span>\n                          <span className=\"text-[10px] text-muted-foreground shrink-0\" suppressHydrationWarning>\n                            {formatRelativeTime(timestamp)}\n                          </span>\n                        </div>\n                        \n                        <p className={cn(\n                          \"text-xs truncate\",\n                          conversation.unreadCount > 0 ? \"text-foreground/80 font-medium\" : \"text-muted-foreground\"\n                        )}>\n                          {truncateText(conversation.preview || conversation.latestMessage?.body || 'No messages yet', 60)}\n                        </p>\n                        \n                        <div className=\"flex items-center gap-2 mt-1.5\">\n                          <Badge variant=\"outline\" className=\"text-[10px] capitalize border-border text-muted-foreground px-1.5 py-0\">\n                            {conversation.type.replace('_', ' ')}\n                          </Badge>\n                          {conversation.participants.length > 1 && (\n                            <span className=\"text-[10px] text-muted-foreground\">\n                              {conversation.participants.length} participants\n                            </span>\n                          )}\n                        </div>\n                      </div>\n                    </div>\n                  </button>\n                </li>\n              )\n            })}\n          </ul>\n        )}\n      </div>\n    </aside>\n  )\n}\n\n\n","import createLucideIcon from '../createLucideIcon';\nimport { IconNode } from '../types';\n\nexport const __iconNode: IconNode = [\n  [\n    'path',\n    {\n      d: 'M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z',\n      key: '18887p',\n    },\n  ],\n  ['path', { d: 'M12 8v6', key: '1ib9pf' }],\n  ['path', { d: 'M9 11h6', key: '1fldmi' }],\n];\n\n/**\n * @component @name MessageSquarePlus\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8cGF0aCBkPSJNMjIgMTdhMiAyIDAgMCAxLTIgMkg2LjgyOGEyIDIgMCAwIDAtMS40MTQuNTg2bC0yLjIwMiAyLjIwMkEuNzEuNzEgMCAwIDEgMiAyMS4yODZWNWEyIDIgMCAwIDEgMi0yaDE2YTIgMiAwIDAgMSAyIDJ6IiAvPgogIDxwYXRoIGQ9Ik0xMiA4djYiIC8+CiAgPHBhdGggZD0iTTkgMTFoNiIgLz4KPC9zdmc+Cg==) - https://lucide.dev/icons/message-square-plus\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst MessageSquarePlus = createLucideIcon('message-square-plus', __iconNode);\n\nexport default MessageSquarePlus;\n"],"names":[],"mappings":"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","ignoreList":[3]}