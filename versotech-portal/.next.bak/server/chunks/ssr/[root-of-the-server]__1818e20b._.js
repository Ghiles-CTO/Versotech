module.exports=[193695,(a,b,c)=>{b.exports=a.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},9349,a=>{a.n(a.i(142710))},199585,a=>{a.n(a.i(701395))},929852,a=>{a.n(a.i(816404))},516153,a=>{a.n(a.i(422096))},911164,a=>{a.n(a.i(273021))},16933,a=>{a.n(a.i(618450))},498419,a=>{a.n(a.i(72598))},75157,a=>{"use strict";async function b(a){let{data:{user:b},error:c}=await a.auth.getUser();return{user:b,error:c}}async function c(a,b,c){let{data:d}=await a.from("profiles").select("role").eq("id",b).single();if(d?.role==="ceo")return!0;let{data:e}=await a.from("ceo_users").select("user_id").eq("user_id",b).maybeSingle();if(e)return!0;let{data:f}=await a.from("staff_permissions").select("permission").eq("user_id",b).in("permission",c).limit(1).maybeSingle();return!!f}async function d(a,b){return c(a,b,["super_admin"])}a.s(["getAuthenticatedUser",()=>b,"isSuperAdmin",()=>d])},568808,a=>{"use strict";a.s(["IntroducersDashboard",()=>b]);let b=(0,a.i(578644).registerClientReference)(function(){throw Error("Attempted to call IntroducersDashboard() from the server but IntroducersDashboard is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/versotech-portal/src/components/staff/introducers/introducers-dashboard.tsx <module evaluation>","IntroducersDashboard")},784634,a=>{"use strict";a.s(["IntroducersDashboard",()=>b]);let b=(0,a.i(578644).registerClientReference)(function(){throw Error("Attempted to call IntroducersDashboard() from the server but IntroducersDashboard is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/versotech-portal/src/components/staff/introducers/introducers-dashboard.tsx","IntroducersDashboard")},873549,a=>{"use strict";a.i(568808);var b=a.i(784634);a.n(b)},64774,a=>{"use strict";a.s(["AddIntroducerProvider",()=>c,"useAddIntroducer",()=>d]);var b=a.i(578644);let c=(0,b.registerClientReference)(function(){throw Error("Attempted to call AddIntroducerProvider() from the server but AddIntroducerProvider is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/versotech-portal/src/components/staff/introducers/add-introducer-context.tsx <module evaluation>","AddIntroducerProvider"),d=(0,b.registerClientReference)(function(){throw Error("Attempted to call useAddIntroducer() from the server but useAddIntroducer is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/versotech-portal/src/components/staff/introducers/add-introducer-context.tsx <module evaluation>","useAddIntroducer")},716326,a=>{"use strict";a.s(["AddIntroducerProvider",()=>c,"useAddIntroducer",()=>d]);var b=a.i(578644);let c=(0,b.registerClientReference)(function(){throw Error("Attempted to call AddIntroducerProvider() from the server but AddIntroducerProvider is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/versotech-portal/src/components/staff/introducers/add-introducer-context.tsx","AddIntroducerProvider"),d=(0,b.registerClientReference)(function(){throw Error("Attempted to call useAddIntroducer() from the server but useAddIntroducer is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/versotech-portal/src/components/staff/introducers/add-introducer-context.tsx","useAddIntroducer")},639407,a=>{"use strict";a.i(64774);var b=a.i(716326);a.n(b)},993897,a=>{"use strict";a.s(["AddIntroducerDialog",()=>b]);let b=(0,a.i(578644).registerClientReference)(function(){throw Error("Attempted to call AddIntroducerDialog() from the server but AddIntroducerDialog is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/versotech-portal/src/components/staff/introducers/add-introducer-dialog.tsx <module evaluation>","AddIntroducerDialog")},744724,a=>{"use strict";a.s(["AddIntroducerDialog",()=>b]);let b=(0,a.i(578644).registerClientReference)(function(){throw Error("Attempted to call AddIntroducerDialog() from the server but AddIntroducerDialog is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/versotech-portal/src/components/staff/introducers/add-introducer-dialog.tsx","AddIntroducerDialog")},979355,a=>{"use strict";a.i(993897);var b=a.i(744724);a.n(b)},619086,a=>{"use strict";var b=a.i(714898),c=a.i(873549),d=a.i(639407),e=a.i(979355),f=a.i(75157),g=a.i(243085),h=a.i(198307);a.i(937413);var i=a.i(131360);async function j(){await (0,g.requireStaffAuth)();let a=await (0,h.createClient)(),{user:j}=await (0,f.getAuthenticatedUser)(a);j||(0,i.redirect)("/versotech/login");let{data:k}=await a.from("profiles").select("role").eq("id",j.id).single();k&&(k.role.startsWith("staff_")||"ceo"===k.role)||(0,i.redirect)("/versotech/staff");let l=(0,h.createServiceClient)(),{data:m,error:n}=await l.from("introducers").select(`
        id,
        legal_name,
        contact_name,
        email,
        default_commission_bps,
        commission_cap_amount,
        payment_terms,
        status,
        created_at,
        introductions (
          id,
          status,
          introduced_at,
          deal_id
        ),
        introducer_commissions (
          id,
          introduction_id,
          accrual_amount,
          status,
          created_at,
          paid_at
        )
      `).order("created_at",{ascending:!1});n&&console.error("[Introducers] Failed to fetch introducers",n);let o=new Map,p=(m??[]).map(a=>{let b=Array.isArray(a.introductions)?a.introductions:[],c=Array.isArray(a.introducer_commissions)?a.introducer_commissions:[],d=null;b.forEach(a=>{if(!a)return;let b=a.introduced_at||null;d?b&&new Date(b).getTime()>new Date(d).getTime()&&(d=b):d=b});let e=0,f=0;c.forEach(a=>{if(!a)return;let b=Number(a.accrual_amount??0);a.introduction_id&&o.set(a.introduction_id,{amount:b,status:a.status??null}),"paid"===a.status&&(e+=b),("accrued"===a.status||"invoiced"===a.status)&&(f+=b)});let g=b.filter(a=>a?.status==="allocated").length;return{id:a.id,legalName:a.legal_name??"Unnamed Introducer",contactName:a.contact_name,email:a.email,defaultCommissionBps:a.default_commission_bps??0,commissionCapAmount:a.commission_cap_amount?Number(a.commission_cap_amount):null,paymentTerms:a.payment_terms,status:a.status??"active",createdAt:a.created_at,totalIntroductions:b.length,successfulAllocations:g,totalCommissionPaid:e,pendingCommission:f,lastIntroductionAt:d}}),{data:q,error:r}=await l.from("introductions").select(`
        id,
        introducer_id,
        prospect_email,
        deal_id,
        status,
        introduced_at,
        commission_rate_override_bps,
        notes,
        introducer:introducers ( legal_name ),
        deal:deals ( name )
      `).order("introduced_at",{ascending:!1}).limit(10);r&&console.error("[Introducers] Failed to fetch recent introductions",r);let s=(q??[]).filter(Boolean).map(a=>{let b=a.id?o.get(a.id):void 0;return{id:a.id,introducerId:a.introducer_id??void 0,introducerName:a.introducer?.legal_name??"Unknown Introducer",prospectEmail:a.prospect_email??"VERSO BI",dealId:a.deal_id??void 0,dealName:a.deal?.name??"Untitled deal",status:a.status??"invited",introducedAt:a.introduced_at,commissionAmount:b?.amount??null,commissionStatus:b?.status??null,commissionRateOverrideBps:a.commission_rate_override_bps??null,notes:a.notes??null}}),t=p.reduce((a,b)=>(a.totalIntroducers+=1,"active"===b.status&&(a.activeIntroducers+=1),a.totalIntroductions+=b.totalIntroductions,a.totalAllocations+=b.successfulAllocations,a.totalCommissionPaid+=b.totalCommissionPaid,a.pendingCommission+=b.pendingCommission,a),{totalIntroducers:0,activeIntroducers:0,totalIntroductions:0,totalAllocations:0,totalCommissionPaid:0,pendingCommission:0}),{data:u}=await l.from("deals").select("id, name").in("status",["draft","open","allocation_pending"]).order("name",{ascending:!0}),v=(u??[]).map(a=>({id:a.id,name:a.name||"Untitled Deal"}));return(0,b.jsxs)(d.AddIntroducerProvider,{children:[(0,b.jsx)(c.IntroducersDashboard,{summary:t,introducers:p,recentIntroductions:s,deals:v,isDemo:!1}),(0,b.jsx)(e.AddIntroducerDialog,{})]})}a.s(["default",()=>j,"dynamic",0,"force-dynamic","revalidate",0,0])}];

//# sourceMappingURL=%5Broot-of-the-server%5D__1818e20b._.js.map