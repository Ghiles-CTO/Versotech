{"version":3,"sources":["../../../../../versotech-portal/src/lib/messaging/supabase.ts","../../../../../versotech-portal/src/components/messaging/shared/message-bubble.tsx","../../../../../versotech-portal/src/components/messaging/staff/conversation-view.tsx","../../../../../versotech-portal/src/components/ui/auto-expand-textarea.tsx","../../../../../versotech-portal/src/lib/messaging/selectors.ts","../../../../../versotech-portal/src/lib/messaging/utils.ts","../../../../../versotech-portal/src/components/messaging/message-skeleton.tsx","../../../../../versotech-portal/node_modules/lucide-react/src/icons/smile.ts","../../../../../versotech-portal/node_modules/lucide-react/src/icons/paperclip.ts"],"sourcesContent":["import { createClient } from '@/lib/supabase/client'\nimport type {\n  ConversationFilters,\n  ConversationMessage,\n  ConversationSummary,\n  MessageSender,\n} from '@/types/messaging'\n\ninterface FetchConversationsOptions extends ConversationFilters {\n  limit?: number\n  offset?: number\n  includeMessages?: boolean\n}\n\ninterface FetchConversationsResponse {\n  conversations: ConversationSummary[]\n  total: number\n  limit: number\n  offset: number\n  hasMore: boolean\n}\n\ninterface FetchMessagesOptions {\n  limit?: number\n  offset?: number\n}\n\nexport async function fetchConversationsClient(\n  filters: FetchConversationsOptions\n): Promise<FetchConversationsResponse> {\n  const params = new URLSearchParams()\n\n  if (filters.visibility) params.set('visibility', filters.visibility)\n  if (filters.type) params.set('type', filters.type)\n  if (filters.unreadOnly) params.set('unread', 'true')\n  if (filters.search) params.set('search', filters.search)\n  if (filters.dealId) params.set('dealId', filters.dealId)\n  if (typeof filters.limit === 'number') params.set('limit', String(filters.limit))\n  if (typeof filters.offset === 'number') params.set('offset', String(filters.offset))\n  if (filters.includeMessages === false) params.set('includeMessages', 'false')\n\n  const response = await fetch(`/api/conversations?${params.toString()}`, {\n    cache: 'no-store',\n  })\n\n  if (!response.ok) {\n    const error = await response.json().catch(() => null)\n    throw new Error(error?.error || 'Failed to load conversations')\n  }\n\n  const data = await response.json()\n\n  return {\n    conversations: data.conversations as ConversationSummary[],\n    total: data.pagination.total,\n    limit: data.pagination.limit,\n    offset: data.pagination.offset,\n    hasMore: data.pagination.has_more,\n  }\n}\n\nexport function normalizeConversation(raw: any): ConversationSummary {\n  const participants = Array.isArray(raw?.conversation_participants)\n    ? raw.conversation_participants.map((participant: any) => {\n        const profile = participant?.profiles || {}\n        return {\n          id: profile.id || participant.user_id,\n          displayName: profile.display_name || profile.email || null,\n          email: profile.email || null,\n          role: profile.role || null,\n          avatarUrl: profile.avatar_url ?? null,\n          participantRole: participant?.participant_role ?? 'member',\n          joinedAt: participant?.joined_at,\n          lastReadAt: participant?.last_read_at ?? null,\n          lastNotifiedAt: participant?.last_notified_at ?? null,\n          isMuted: participant?.is_muted ?? false,\n          isPinned: participant?.is_pinned ?? false,\n        }\n      })\n    : []\n\n  const latestMessageRaw = Array.isArray(raw?.messages) ? raw.messages[0] : null\n  const latestMessage = latestMessageRaw ? normalizeMessage(latestMessageRaw) : null\n\n  return {\n    id: raw.id,\n    subject: raw.subject ?? null,\n    preview: raw.preview ?? null,\n    type: raw.type ?? 'dm',\n    visibility: raw.visibility ?? 'internal',\n    ownerTeam: raw.owner_team ?? null,\n    dealId: raw.deal_id ?? null,\n    createdBy: raw.created_by ?? null,\n    createdAt: raw.created_at,\n    updatedAt: raw.updated_at,\n    lastMessageAt: raw.last_message_at ?? null,\n    lastMessageId: raw.last_message_id ?? null,\n    archivedAt: raw.archived_at ?? null,\n    metadata: raw.metadata ?? {},\n    participants,\n    unreadCount: raw.unreadCount ?? 0,\n    latestMessage,\n    participantCount: participants.length,\n  }\n}\n\nexport async function fetchConversationMessages(\n  conversationId: string,\n  options: FetchMessagesOptions = {}\n): Promise<ConversationMessage[]> {\n  const params = new URLSearchParams()\n  if (typeof options.limit === 'number') params.set('limit', String(options.limit))\n  if (typeof options.offset === 'number') params.set('offset', String(options.offset))\n\n  const response = await fetch(`/api/conversations/${conversationId}/messages?${params.toString()}`)\n\n  if (!response.ok) {\n    const error = await response.json().catch(() => null)\n    throw new Error(error?.error || 'Failed to fetch messages')\n  }\n\n  const data = await response.json()\n  return data.messages as ConversationMessage[]\n}\n\nexport async function markConversationRead(conversationId: string) {\n  await fetch(`/api/conversations/${conversationId}/read`, { method: 'POST' })\n}\n\nexport function getClientSupabase() {\n  return createClient()\n}\n\nexport function subscribeToConversationUpdates(\n  conversationId: string,\n  callbacks: {\n    onMessage?: (message: ConversationMessage) => void\n    onUpdate?: () => void\n  }\n) {\n  const supabase = createClient()\n\n  \n\n  const channel = supabase\n    .channel(`conversation-${conversationId}`)\n    .on(\n      'postgres_changes',\n      {\n        event: 'INSERT',\n        schema: 'public',\n        table: 'messages',\n        filter: `conversation_id=eq.${conversationId}`,\n      },\n      (payload) => {\n        if (payload.eventType === 'INSERT') {\n          callbacks.onMessage?.(normalizeMessage(payload.new))\n        }\n        callbacks.onUpdate?.()\n      }\n    )\n    .on(\n      'postgres_changes',\n      {\n        event: '*',\n        schema: 'public',\n        table: 'conversation_participants',\n        filter: `conversation_id=eq.${conversationId}`,\n      },\n      (payload) => {\n        callbacks.onUpdate?.()\n      }\n    )\n    .subscribe()\n\n  return () => {\n    supabase.removeChannel(channel)\n  }\n}\n\nexport function normalizeMessage(raw: any): ConversationMessage {\n  // Handle both API responses (with joined sender) and realtime events (without joins)\n  const sender = raw.sender as MessageSender | undefined\n\n  return {\n    id: raw.id,\n    conversationId: raw.conversation_id,\n    senderId: raw.sender_id,\n    body: raw.body ?? null,\n    messageType: raw.message_type ?? 'text',\n    fileKey: raw.file_key ?? null,\n    replyToMessageId: raw.reply_to_message_id ?? null,\n    metadata: raw.metadata ?? {},\n    createdAt: raw.created_at,\n    editedAt: raw.edited_at ?? null,\n    deletedAt: raw.deleted_at ?? null,\n    // Sender might not be available in realtime payloads, that's ok\n    sender: sender ? {\n      id: sender.id ?? null,\n      displayName: sender.displayName ?? (sender as any).display_name ?? null,\n      email: sender.email ?? null,\n      role: sender.role ?? null,\n      avatarUrl: sender.avatarUrl ?? (sender as any).avatar_url ?? null,\n    } : null,\n    readBy: Array.isArray(raw.read_by) ? raw.read_by : [],\n  }\n}\n\n\n","'use client'\n\nimport type { ConversationMessage } from '@/types/messaging'\nimport { Avatar, AvatarFallback, AvatarImage } from '@/components/ui/avatar'\nimport { Button } from '@/components/ui/button'\nimport { cn } from '@/lib/utils'\nimport { formatRelativeTime, formatFullTimestamp, getInitials } from '@/lib/messaging/utils'\nimport { CheckCheck, Check, Trash2 } from 'lucide-react'\nimport { motion } from 'framer-motion'\n\ninterface MessageBubbleProps {\n  message: ConversationMessage\n  senderName: string\n  senderEmail?: string | null\n  senderAvatarUrl?: string | null\n  isSelf: boolean\n  isGroupStart: boolean\n  isGroupEnd: boolean\n  showAvatar: boolean\n  showTimestamp: boolean\n  onDelete?: (messageId: string) => void\n}\n\nexport function MessageBubble({\n  message,\n  senderName,\n  senderEmail,\n  senderAvatarUrl,\n  isSelf,\n  isGroupStart,\n  isGroupEnd,\n  showAvatar,\n  showTimestamp,\n  onDelete,\n}: MessageBubbleProps) {\n  \n  if (message.deletedAt) {\n    return (\n      <div className={cn('flex items-center gap-2 py-1', isSelf ? 'justify-end' : 'justify-start')}>\n        <span className=\"text-xs italic text-muted-foreground\">\n          Message deleted\n        </span>\n      </div>\n    )\n  }\n\n  return (\n    <motion.div\n      initial={{ opacity: 0, y: 10, scale: 0.98 }}\n      animate={{ opacity: 1, y: 0, scale: 1 }}\n      transition={{\n        duration: 0.25,\n        ease: [0.25, 0.1, 0.25, 1],\n      }}\n      className={cn(\n        'flex gap-2 group',\n        isSelf ? 'flex-row-reverse' : 'flex-row',\n        !isGroupStart && 'mt-0.5',\n        isGroupStart && 'mt-5'\n      )}\n    >\n      {/* Avatar */}\n      <div className={cn('flex-shrink-0 self-end', !showAvatar && 'w-9')}>\n        {showAvatar ? (\n          <Avatar className=\"h-9 w-9 border-2 border-background shadow-sm transition-transform duration-200 group-hover:scale-110\">\n            {senderAvatarUrl && (\n              <AvatarImage src={senderAvatarUrl} alt={senderName} />\n            )}\n            <AvatarFallback className=\"text-xs bg-muted text-foreground font-medium\">\n              {getInitials(senderName)}\n            </AvatarFallback>\n          </Avatar>\n        ) : null}\n      </div>\n\n      {/* Message Content */}\n      <div className={cn('flex flex-col gap-1 max-w-[75%] md:max-w-[65%] relative', isSelf && 'items-end')}>\n        {/* Delete Button (shows on hover) */}\n        {isSelf && onDelete && !message.deletedAt && (\n          <Button\n            variant=\"ghost\"\n            size=\"icon\"\n            className=\"absolute -left-10 top-1 h-7 w-7 opacity-0 group-hover:opacity-100 transition-opacity text-muted-foreground hover:text-red-500\"\n            onClick={() => onDelete(message.id)}\n          >\n            <Trash2 className=\"h-4 w-4\" />\n          </Button>\n        )}\n        \n        {/* Sender Name (only at group start) */}\n        {isGroupStart && !isSelf && (\n          <span className=\"text-xs font-semibold text-foreground/80 px-2 mb-0.5\">\n            {senderName}\n          </span>\n        )}\n\n        {/* Message Bubble (WhatsApp style) */}\n        <div\n          className={cn(\n            'relative px-3.5 py-2.5 rounded-lg text-[14px] leading-relaxed',\n            'transition-all duration-200 ease-out',\n            isSelf\n              ? 'bg-primary text-primary-foreground shadow-md shadow-primary/20'\n              : 'bg-card text-foreground border border-border shadow-sm',\n            // Rounded corners with tail effect\n            'rounded-tl-2xl rounded-tr-2xl',\n            isSelf ? 'rounded-bl-2xl rounded-br-md' : 'rounded-bl-md rounded-br-2xl',\n            isGroupStart && (isSelf ? 'rounded-br-2xl' : 'rounded-bl-2xl'),\n            'group-hover:shadow-xl group-hover:-translate-y-0.5',\n            isSelf ? 'group-hover:shadow-primary/30' : 'group-hover:shadow-lg',\n            'max-w-full'\n          )}\n          title={formatFullTimestamp(message.createdAt)}\n        >\n          <div className=\"flex flex-col\">\n            <p className=\"whitespace-pre-wrap break-words\">\n              {message.body}\n            </p>\n            \n            {/* Inline metadata (WhatsApp style - time in corner) */}\n            <div className={cn(\n              'flex items-center gap-1 mt-1 justify-end select-none',\n              isSelf ? 'text-primary-foreground/60' : 'text-muted-foreground/70'\n            )}>\n              {message.editedAt && (\n                <span className=\"text-[9px] italic mr-1\">Edited</span>\n              )}\n              <span className=\"text-[9px] font-medium\">\n                {new Date(message.createdAt).toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit', hour12: true })}\n              </span>\n              {isSelf && (\n                <span className=\"ml-0.5\">\n                  {message.readBy && message.readBy.length > 0 \n                    ? <CheckCheck className=\"h-3.5 w-3.5\" />\n                    : <Check className=\"h-3.5 w-3.5\" />\n                  }\n                </span>\n              )}\n            </div>\n          </div>\n        </div>\n      </div>\n    </motion.div>\n  )\n}\n\n","'use client'\n\nimport type { ConversationSummary, ConversationMessage } from '@/types/messaging'\nimport { useEffect, useMemo, useState, useRef } from 'react'\nimport { fetchConversationMessages, markConversationRead, subscribeToConversationUpdates } from '@/lib/messaging'\nimport { groupMessages, getInitials, formatRelativeTime, getDateDivider, shouldShowDateDivider } from '@/lib/messaging/utils'\nimport { MessageBubble } from '@/components/messaging/shared/message-bubble'\nimport { MessageSkeleton } from '@/components/messaging/message-skeleton'\nimport { AutoExpandTextarea } from '@/components/ui/auto-expand-textarea'\nimport { Avatar, AvatarFallback, AvatarImage } from '@/components/ui/avatar'\nimport { ScrollArea } from '@/components/ui/scroll-area'\nimport { Badge } from '@/components/ui/badge'\nimport { Button } from '@/components/ui/button'\nimport { cn } from '@/lib/utils'\nimport { Send, Paperclip, MoreVertical, Users, Smile, Trash2, MessageSquare } from 'lucide-react'\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuSeparator,\n  DropdownMenuTrigger,\n} from '@/components/ui/dropdown-menu'\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n} from '@/components/ui/alert-dialog'\n\ninterface ConversationViewProps {\n  conversation: ConversationSummary\n  currentUserId: string\n  onRead?: () => void\n  onError?: (message: string) => void\n  onDelete?: (conversationId: string) => void\n}\n\nexport function ConversationView({ conversation, currentUserId, onRead, onError, onDelete }: ConversationViewProps) {\n  const [messages, setMessages] = useState<ConversationMessage[]>([])\n  const [isLoading, setIsLoading] = useState(true)\n  const [composerMessage, setComposerMessage] = useState('')\n  const [isSending, setIsSending] = useState(false)\n  const [showDeleteDialog, setShowDeleteDialog] = useState(false)\n  const [messageToDelete, setMessageToDelete] = useState<string | null>(null)\n  const scrollAreaRef = useRef<HTMLDivElement>(null)\n  const messagesEndRef = useRef<HTMLDivElement>(null)\n\n  console.log('[ConversationView] Rendering with', messages.length, 'messages for conversation:', conversation.id)\n  \n  const handleDeleteConversation = async () => {\n    try {\n      const response = await fetch(`/api/conversations/${conversation.id}`, {\n        method: 'DELETE',\n      })\n      \n      if (!response.ok) {\n        throw new Error('Failed to delete conversation')\n      }\n      \n      onDelete?.(conversation.id)\n      setShowDeleteDialog(false)\n    } catch (error: any) {\n      onError?.(error.message || 'Failed to delete conversation')\n    }\n  }\n  \n  const handleDeleteMessage = async (messageId: string) => {\n    try {\n      const response = await fetch(`/api/conversations/${conversation.id}/messages/${messageId}`, {\n        method: 'DELETE',\n      })\n      \n      if (!response.ok) {\n        throw new Error('Failed to delete message')\n      }\n      \n      // Remove message from local state\n      setMessages(prev => prev.filter(m => m.id !== messageId))\n      setMessageToDelete(null)\n    } catch (error: any) {\n      onError?.(error.message || 'Failed to delete message')\n    }\n  }\n\n  const participantsLookup = useMemo(() => {\n    const map = new Map<string, { name: string, email: string | null }>()\n    conversation.participants.forEach(participant => {\n      if (participant.id) {\n        map.set(participant.id, {\n          name: participant.displayName || participant.email || 'Unknown User',\n          email: participant.email\n        })\n      }\n    })\n    // Also add current user if not in participants\n    if (currentUserId && !map.has(currentUserId)) {\n      map.set(currentUserId, { name: 'You', email: null })\n    }\n    return map\n  }, [conversation.participants, currentUserId])\n\n  // Group messages for better visual flow\n  const groupedMessages = useMemo(() => {\n    return groupMessages(messages)\n  }, [messages])\n\n  // Auto-scroll to bottom when messages change\n  useEffect(() => {\n    console.log('[ConversationView] Auto-scroll triggered, messages:', messages.length)\n    if (messages.length > 0 && messagesEndRef.current) {\n      console.log('[ConversationView] Scrolling to bottom')\n      messagesEndRef.current.scrollIntoView({ behavior: 'smooth' })\n    }\n  }, [messages])\n\n  // Load initial messages\n  useEffect(() => {\n    let isMounted = true\n    setIsLoading(true)\n    setMessages([])\n    \n    fetchConversationMessages(conversation.id, { limit: 200 })\n      .then(data => {\n        if (!isMounted) return\n        setMessages(data)\n        onRead?.()\n        markConversationRead(conversation.id).catch(console.error)\n      })\n      .catch(error => {\n        console.error('Load messages error', error)\n      })\n      .finally(() => {\n        if (isMounted) setIsLoading(false)\n      })\n\n    return () => {\n      isMounted = false\n    }\n  }, [conversation.id, onRead])\n\n  // Handle message sending with optimistic update\n  const handleSend = async () => {\n    if (!composerMessage.trim()) return\n    \n    console.log('[ConversationView] Sending message:', composerMessage)\n    setIsSending(true)\n\n    try {\n      const response = await fetch(`/api/conversations/${conversation.id}/messages`, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ body: composerMessage }),\n      })\n\n      if (!response.ok) {\n        const error = await response.json().catch(() => null)\n        throw new Error(error?.error || 'Failed to send message')\n      }\n\n      const result = await response.json()\n      console.log('[ConversationView] Message sent, adding optimistically:', result.message)\n      \n      // Add message optimistically\n      if (result.message) {\n        setMessages(prev => {\n          if (prev.some(m => m.id === result.message.id)) return prev\n          return [...prev, result.message]\n        })\n      }\n      \n      setComposerMessage('')\n    } catch (error: any) {\n      console.error('[ConversationView] Send error:', error)\n      onError?.(error.message || 'Failed to send message')\n    } finally {\n      setIsSending(false)\n    }\n  }\n\n  const handleKeyDown = (event: React.KeyboardEvent<HTMLTextAreaElement>) => {\n    if (event.key === 'Enter' && (event.ctrlKey || event.metaKey)) {\n      event.preventDefault()\n      handleSend()\n    }\n  }\n\n  // Subscribe to new messages in realtime (for messages from OTHER users)\n  useEffect(() => {\n    console.log('[ConversationView] Setting up realtime for conversation:', conversation.id)\n    \n    const cleanup = subscribeToConversationUpdates(conversation.id, {\n      onMessage: (newMessage) => {\n        console.log('[ConversationView] Received new message from realtime:', newMessage)\n        setMessages(prev => {\n          console.log('[ConversationView] Current messages before add:', prev.length)\n          // Avoid duplicates\n          if (prev.some(m => m.id === newMessage.id)) {\n            console.log('[ConversationView] Message already exists, skipping')\n            return prev\n          }\n          console.log('[ConversationView] Adding realtime message to list')\n          const updated = [...prev, newMessage]\n          console.log('[ConversationView] Messages after add:', updated.length)\n          return updated\n        })\n        // Mark as read if we&apos;re viewing\n        markConversationRead(conversation.id).catch(console.error)\n      }\n    })\n\n    return () => {\n      console.log('[ConversationView] Cleaning up realtime for conversation:', conversation.id)\n      cleanup()\n    }\n  }, [conversation.id])\n\n  return (\n    <div className=\"flex-1 flex flex-col min-h-0\">\n      {/* Enhanced Header */}\n      <header className=\"relative z-10 border-b border-border bg-card px-6 py-4\">\n        <div className=\"flex items-center justify-between\">\n          <div className=\"flex items-center gap-3\">\n            {/* Participant Avatars */}\n            <div className=\"flex -space-x-2\">\n              {conversation.participants.slice(0, 3).map((participant, idx) => (\n                <Avatar key={participant.id} className=\"h-9 w-9 border-2 border-background\">\n                  {participant.avatarUrl && (\n                    <AvatarImage src={participant.avatarUrl} alt={participant.displayName || participant.email || 'User'} />\n                  )}\n                  <AvatarFallback className=\"text-xs bg-muted text-foreground\">\n                    {getInitials(participant.displayName || participant.email)}\n                  </AvatarFallback>\n                </Avatar>\n              ))}\n              {conversation.participants.length > 3 && (\n                <Avatar className=\"h-9 w-9 border-2 border-background\">\n                  <AvatarFallback className=\"text-xs bg-muted text-foreground\">\n                    +{conversation.participants.length - 3}\n                  </AvatarFallback>\n                </Avatar>\n              )}\n            </div>\n            \n            {/* Conversation Info */}\n            <div className=\"flex-1\">\n              <h3 className=\"text-base font-semibold text-foreground\">\n                {conversation.subject || 'Untitled Conversation'}\n              </h3>\n              <div className=\"flex items-center gap-2 text-xs text-muted-foreground\">\n                <Users className=\"h-3 w-3\" />\n                <span>{conversation.participants.length} participant{conversation.participants.length !== 1 ? 's' : ''}</span>\n              </div>\n            </div>\n          </div>\n\n          {/* Actions */}\n          <div className=\"flex items-center gap-2\">\n            <Badge variant=\"outline\" className=\"capitalize border-border text-foreground\">\n              {conversation.type.replace('_', ' ')}\n            </Badge>\n            \n            <DropdownMenu>\n              <DropdownMenuTrigger asChild>\n                <Button variant=\"ghost\" size=\"icon\" className=\"h-8 w-8\">\n                  <MoreVertical className=\"h-4 w-4\" />\n                </Button>\n              </DropdownMenuTrigger>\n              <DropdownMenuContent align=\"end\" className=\"w-48\">\n                <DropdownMenuItem className=\"cursor-pointer\">\n                  View Details\n                </DropdownMenuItem>\n                <DropdownMenuItem className=\"cursor-pointer\">\n                  Mute Notifications\n                </DropdownMenuItem>\n                <DropdownMenuSeparator />\n                <DropdownMenuItem \n                  className=\"cursor-pointer text-red-600 focus:text-red-600\"\n                  onClick={() => setShowDeleteDialog(true)}\n                >\n                  <Trash2 className=\"h-4 w-4 mr-2\" />\n                  Delete Conversation\n                </DropdownMenuItem>\n              </DropdownMenuContent>\n            </DropdownMenu>\n          </div>\n        </div>\n      </header>\n\n      <ScrollArea className=\"flex-1 min-h-0 bg-muted/20\">\n        <div className=\"px-4 py-6 md:px-8\">\n          {isLoading ? (\n            <MessageSkeleton count={3} />\n          ) : messages.length === 0 ? (\n            <div className=\"flex flex-col items-center justify-center h-full min-h-[400px] text-center px-4\">\n              <div className=\"relative mb-6\">\n                <div className=\"rounded-full bg-gradient-to-br from-primary/10 to-primary/5 p-8 backdrop-blur-sm border border-primary/10\">\n                  <MessageSquare className=\"h-12 w-12 text-primary/60\" />\n                </div>\n                <div className=\"absolute -top-1 -right-1 h-4 w-4 rounded-full bg-primary/20 animate-ping\" />\n              </div>\n              <h3 className=\"text-xl font-semibold text-foreground mb-2\">\n                Start the Conversation\n              </h3>\n              <p className=\"text-sm text-muted-foreground max-w-md leading-relaxed\">\n                No messages yet. Break the ice and send the first message to{' '}\n                <span className=\"font-medium text-foreground\">\n                  {conversation.participants.filter(p => p.id !== currentUserId)[0]?.displayName || 'your team'}\n                </span>\n                .\n              </p>\n            </div>\n          ) : (\n            <div className=\"space-y-0\">\n              {groupedMessages.map((message, index) => {\n                const isSelf = message.senderId === currentUserId\n                const senderInfo = message.sender?.displayName \n                  ? { name: message.sender.displayName, email: message.sender.email }\n                  : participantsLookup.get(message.senderId || '')\n                const displayName = senderInfo?.name || 'Unknown User'\n                \n                // Check if we need a date divider\n                const previousMessage = index > 0 ? groupedMessages[index - 1] : undefined\n                const showDivider = shouldShowDateDivider(message, previousMessage)\n\n                return (\n                  <div key={message.id}>\n                    {/* Date Divider (WhatsApp/Slack style) */}\n                    {showDivider && (\n                      <div className=\"flex items-center justify-center my-6\">\n                        <div className=\"px-3 py-1 rounded-full bg-muted/50 backdrop-blur-sm\">\n                          <span className=\"text-xs font-medium text-muted-foreground\">\n                            {getDateDivider(message.createdAt)}\n                          </span>\n                        </div>\n                      </div>\n                    )}\n                    \n                    <MessageBubble\n                      message={message}\n                      senderName={displayName}\n                      senderEmail={senderInfo?.email}\n                      senderAvatarUrl={message.sender?.avatarUrl ?? null}\n                      isSelf={isSelf}\n                      isGroupStart={message.isGroupStart}\n                      isGroupEnd={message.isGroupEnd}\n                      showAvatar={message.showAvatar}\n                      showTimestamp={message.showTimestamp}\n                      onDelete={setMessageToDelete}\n                    />\n                  </div>\n                )\n              })}\n            </div>\n          )}\n          <div ref={messagesEndRef} />\n        </div>\n      </ScrollArea>\n      \n      {/* Enhanced Composer (WhatsApp/Slack style) */}\n      <div className=\"relative z-10 border-t border-border bg-card px-6 py-4\">\n        <div className=\"flex items-end gap-2\">\n          {/* Action Buttons */}\n          <div className=\"flex items-center gap-1 shrink-0\">\n            <Button\n              variant=\"ghost\"\n              size=\"icon\"\n              className=\"h-9 w-9 text-muted-foreground hover:text-foreground\"\n              disabled={isSending}\n              title=\"Add emoji\"\n            >\n              <Smile className=\"h-5 w-5\" />\n            </Button>\n            <Button\n              variant=\"ghost\"\n              size=\"icon\"\n              className=\"h-9 w-9 text-muted-foreground hover:text-foreground\"\n              disabled={isSending}\n              title=\"Attach file\"\n            >\n              <Paperclip className=\"h-5 w-5\" />\n            </Button>\n          </div>\n\n          {/* Message Input Container */}\n          <div className=\"flex-1 relative\">\n            <AutoExpandTextarea\n              value={composerMessage}\n              onChange={event => setComposerMessage(event.target.value)}\n              onKeyDown={handleKeyDown}\n              placeholder=\"Type a message…\"\n              disabled={isSending}\n              className={cn(\n                \"min-h-[44px] max-h-[200px]\",\n                \"bg-background text-foreground\",\n                \"border-border focus-within:border-primary\",\n                \"placeholder:text-muted-foreground\",\n                \"transition-all duration-200\",\n                \"px-4 py-3\"\n              )}\n            />\n          </div>\n\n          {/* Send Button */}\n          <Button\n            onClick={handleSend}\n            disabled={isSending || !composerMessage.trim()}\n            size=\"icon\"\n            className={cn(\n              \"h-11 w-11 shrink-0 rounded-full shadow-lg\",\n              \"transition-all duration-200 ease-out\",\n              composerMessage.trim()\n                ? \"scale-100 opacity-100 hover:scale-105 hover:shadow-xl active:scale-95\"\n                : \"scale-90 opacity-50 cursor-not-allowed\"\n            )}\n          >\n            {isSending ? (\n              <div className=\"h-4 w-4 border-2 border-primary-foreground/30 border-t-primary-foreground rounded-full animate-spin\" />\n            ) : (\n              <Send className=\"h-4 w-4\" />\n            )}\n          </Button>\n        </div>\n        \n        {/* Helper Text */}\n        {composerMessage.trim() && !isSending && (\n          <p className=\"text-[10px] text-muted-foreground mt-2 px-1\">\n            Press <kbd className=\"px-1 py-0.5 rounded bg-muted text-foreground text-[10px]\">Ctrl</kbd> + <kbd className=\"px-1 py-0.5 rounded bg-muted text-foreground text-[10px]\">Enter</kbd> to send\n          </p>\n        )}\n      </div>\n      \n      {/* Delete Conversation Dialog */}\n      <AlertDialog open={showDeleteDialog} onOpenChange={setShowDeleteDialog}>\n        <AlertDialogContent>\n          <AlertDialogHeader>\n            <AlertDialogTitle>Delete Conversation?</AlertDialogTitle>\n            <AlertDialogDescription>\n              This will permanently delete this conversation and all its messages. This action cannot be undone.\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter>\n            <AlertDialogCancel>Cancel</AlertDialogCancel>\n            <AlertDialogAction \n              onClick={handleDeleteConversation}\n              className=\"bg-red-600 hover:bg-red-700\"\n            >\n              Delete\n            </AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n      \n      {/* Delete Message Dialog */}\n      <AlertDialog open={!!messageToDelete} onOpenChange={(open) => !open && setMessageToDelete(null)}>\n        <AlertDialogContent>\n          <AlertDialogHeader>\n            <AlertDialogTitle>Delete Message?</AlertDialogTitle>\n            <AlertDialogDescription>\n              This will permanently delete this message. This action cannot be undone.\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter>\n            <AlertDialogCancel>Cancel</AlertDialogCancel>\n            <AlertDialogAction \n              onClick={() => messageToDelete && handleDeleteMessage(messageToDelete)}\n              className=\"bg-red-600 hover:bg-red-700\"\n            >\n              Delete\n            </AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n    </div>\n  )\n}\n\n\n","'use client'\r\n\r\nimport * as React from 'react'\r\nimport { cn } from '@/lib/utils'\r\n\r\nexport type AutoExpandTextareaProps = React.TextareaHTMLAttributes<HTMLTextAreaElement>\r\n\r\nconst AutoExpandTextarea = React.forwardRef<HTMLTextAreaElement, AutoExpandTextareaProps>(\r\n  ({ className, onChange, ...props }, ref) => {\r\n    const textareaRef = React.useRef<HTMLTextAreaElement | null>(null)\r\n\r\n    const adjustHeight = React.useCallback(() => {\r\n      const textarea = textareaRef.current\r\n      if (textarea) {\r\n        textarea.style.height = 'auto'\r\n        textarea.style.height = `${textarea.scrollHeight}px`\r\n      }\r\n    }, [])\r\n\r\n    React.useEffect(() => {\r\n      adjustHeight()\r\n    }, [props.value, adjustHeight])\r\n\r\n    const handleChange = (e: React.ChangeEvent<HTMLTextAreaElement>) => {\r\n      adjustHeight()\r\n      onChange?.(e)\r\n    }\r\n\r\n    const setRefs = React.useCallback(\r\n      (node: HTMLTextAreaElement | null) => {\r\n        textareaRef.current = node\r\n        if (typeof ref === 'function') {\r\n          ref(node)\r\n        } else if (ref) {\r\n          ref.current = node\r\n        }\r\n      },\r\n      [ref]\r\n    )\r\n\r\n    return (\r\n      <textarea\r\n        ref={setRefs}\r\n        className={cn(\r\n          'flex min-h-[44px] max-h-[200px] w-full rounded-md border border-input',\r\n          'bg-background px-3 py-2 text-sm ring-offset-background',\r\n          'placeholder:text-muted-foreground',\r\n          'focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2',\r\n          'disabled:cursor-not-allowed disabled:opacity-50',\r\n          'resize-none overflow-y-auto',\r\n          'transition-all duration-200 ease-out',\r\n          className\r\n        )}\r\n        onChange={handleChange}\r\n        {...props}\r\n      />\r\n    )\r\n  }\r\n)\r\nAutoExpandTextarea.displayName = 'AutoExpandTextarea'\r\n\r\nexport { AutoExpandTextarea }\r\n","import type { ConversationSummary, ConversationFilters } from '@/types/messaging'\n\nexport function applyConversationFilters(\n  conversations: ConversationSummary[],\n  filters: ConversationFilters\n) {\n  return conversations.filter((conversation) => {\n    if (filters.type !== 'all' && conversation.type !== filters.type) return false\n    if (filters.visibility !== 'all' && conversation.visibility !== filters.visibility) return false\n    if (filters.dealId && conversation.dealId !== filters.dealId) return false\n    if (filters.unreadOnly && (!conversation.unreadCount || conversation.unreadCount === 0)) return false\n\n    if (filters.search) {\n      const query = filters.search.toLowerCase()\n      const haystack: string[] = []\n\n      if (conversation.subject) haystack.push(conversation.subject)\n      if (conversation.preview) haystack.push(conversation.preview)\n      if (conversation.ownerTeam) haystack.push(conversation.ownerTeam)\n\n      conversation.participants.forEach((participant) => {\n        if (participant.displayName) haystack.push(participant.displayName)\n        if (participant.email) haystack.push(participant.email)\n      })\n\n      const matches = haystack.some((entry) => entry.toLowerCase().includes(query))\n      if (!matches) return false\n    }\n\n    return true\n  })\n}\n\nexport function sortConversations(conversations: ConversationSummary[]) {\n  return [...conversations].sort((a, b) => {\n    const aTime = a.lastMessageAt ? new Date(a.lastMessageAt).getTime() : new Date(a.createdAt).getTime()\n    const bTime = b.lastMessageAt ? new Date(b.lastMessageAt).getTime() : new Date(b.createdAt).getTime()\n    return bTime - aTime\n  })\n}\n\n\n\n","import type { ConversationMessage } from '@/types/messaging'\n\n/**\n * Format a timestamp as relative time (e.g., \"2m ago\", \"Yesterday at 3:45 PM\")\n */\nexport function formatRelativeTime(timestamp: string): string {\n  const now = new Date()\n  const messageTime = new Date(timestamp)\n  const diffInSeconds = Math.floor((now.getTime() - messageTime.getTime()) / 1000)\n  \n  // Less than a minute\n  if (diffInSeconds < 60) {\n    return 'Just now'\n  }\n  \n  // Less than an hour\n  if (diffInSeconds < 3600) {\n    const minutes = Math.floor(diffInSeconds / 60)\n    return `${minutes}m ago`\n  }\n  \n  // Less than 24 hours\n  if (diffInSeconds < 86400) {\n    const hours = Math.floor(diffInSeconds / 3600)\n    return `${hours}h ago`\n  }\n  \n  // Yesterday\n  const yesterday = new Date(now)\n  yesterday.setDate(yesterday.getDate() - 1)\n  if (messageTime.toDateString() === yesterday.toDateString()) {\n    return `Yesterday at ${messageTime.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit', hour12: true })}`\n  }\n  \n  // Less than a week\n  if (diffInSeconds < 604800) {\n    const days = Math.floor(diffInSeconds / 86400)\n    return `${days}d ago`\n  }\n  \n  // Older - show full date\n  return messageTime.toLocaleDateString('en-US', { \n    month: 'short', \n    day: 'numeric',\n    year: messageTime.getFullYear() !== now.getFullYear() ? 'numeric' : undefined\n  })\n}\n\n/**\n * Format a full timestamp for display\n */\nexport function formatFullTimestamp(timestamp: string): string {\n  const date = new Date(timestamp)\n  return date.toLocaleString('en-US', {\n    month: 'short',\n    day: 'numeric',\n    year: 'numeric',\n    hour: 'numeric',\n    minute: '2-digit',\n    hour12: true\n  })\n}\n\n/**\n * Group consecutive messages from the same sender within a time window\n */\nexport interface GroupedMessage extends ConversationMessage {\n  isGroupStart: boolean\n  isGroupEnd: boolean\n  showAvatar: boolean\n  showTimestamp: boolean\n}\n\nexport function groupMessages(\n  messages: ConversationMessage[],\n  groupWindowMinutes = 5\n): GroupedMessage[] {\n  if (messages.length === 0) return []\n  \n  const grouped: GroupedMessage[] = []\n  \n  for (let i = 0; i < messages.length; i++) {\n    const current = messages[i]\n    const prev = i > 0 ? messages[i - 1] : null\n    const next = i < messages.length - 1 ? messages[i + 1] : null\n    \n    // Check if this message should be grouped with the previous one\n    const shouldGroupWithPrev = prev && \n      prev.senderId === current.senderId &&\n      !prev.deletedAt &&\n      !current.deletedAt &&\n      (new Date(current.createdAt).getTime() - new Date(prev.createdAt).getTime()) < (groupWindowMinutes * 60 * 1000)\n    \n    // Check if this message should be grouped with the next one\n    const shouldGroupWithNext = next &&\n      next.senderId === current.senderId &&\n      !next.deletedAt &&\n      !current.deletedAt &&\n      (new Date(next.createdAt).getTime() - new Date(current.createdAt).getTime()) < (groupWindowMinutes * 60 * 1000)\n    \n    grouped.push({\n      ...current,\n      isGroupStart: !shouldGroupWithPrev,\n      isGroupEnd: !shouldGroupWithNext,\n      showAvatar: !shouldGroupWithPrev, // Only show avatar at start of group\n      showTimestamp: !shouldGroupWithNext, // Only show timestamp at end of group\n    })\n  }\n  \n  return grouped\n}\n\n/**\n * Get initials from a name for avatar fallback\n */\nexport function getInitials(name: string | null | undefined): string {\n  if (!name) return '?'\n  \n  const parts = name.trim().split(' ')\n  if (parts.length >= 2) {\n    return `${parts[0][0]}${parts[1][0]}`.toUpperCase()\n  }\n  \n  return name.substring(0, 2).toUpperCase()\n}\n\n/**\n * Truncate text to a maximum length with ellipsis\n */\nexport function truncateText(text: string, maxLength: number): string {\n  if (text.length <= maxLength) return text\n  return text.substring(0, maxLength).trim() + '…'\n}\n\n/**\n * Get date divider label for grouping messages by date\n */\nexport function getDateDivider(timestamp: string): string {\n  const messageDate = new Date(timestamp)\n  const today = new Date()\n  const yesterday = new Date(today)\n  yesterday.setDate(yesterday.getDate() - 1)\n  \n  // Reset time to midnight for comparison\n  const messageDateOnly = new Date(messageDate.getFullYear(), messageDate.getMonth(), messageDate.getDate())\n  const todayOnly = new Date(today.getFullYear(), today.getMonth(), today.getDate())\n  const yesterdayOnly = new Date(yesterday.getFullYear(), yesterday.getMonth(), yesterday.getDate())\n  \n  if (messageDateOnly.getTime() === todayOnly.getTime()) {\n    return 'Today'\n  }\n  \n  if (messageDateOnly.getTime() === yesterdayOnly.getTime()) {\n    return 'Yesterday'\n  }\n  \n  // Within this week\n  const diffDays = Math.floor((todayOnly.getTime() - messageDateOnly.getTime()) / (1000 * 60 * 60 * 24))\n  if (diffDays < 7) {\n    return messageDate.toLocaleDateString('en-US', { weekday: 'long' })\n  }\n  \n  // Older\n  return messageDate.toLocaleDateString('en-US', { \n    month: 'long', \n    day: 'numeric',\n    year: messageDate.getFullYear() !== today.getFullYear() ? 'numeric' : undefined\n  })\n}\n\n/**\n * Check if two messages should have a date divider between them\n */\nexport function shouldShowDateDivider(currentMessage: ConversationMessage, previousMessage?: ConversationMessage): boolean {\n  if (!previousMessage) return true\n  \n  const currentDate = new Date(currentMessage.createdAt)\n  const previousDate = new Date(previousMessage.createdAt)\n  \n  // Different day\n  return currentDate.toDateString() !== previousDate.toDateString()\n}\n\n","import { cn } from '@/lib/utils'\r\n\r\ninterface MessageSkeletonProps {\r\n  isSent?: boolean\r\n  count?: number\r\n}\r\n\r\nfunction SingleMessageSkeleton({ isSent = false }: { isSent?: boolean }) {\r\n  return (\r\n    <div\r\n      className={cn(\r\n        'flex gap-3 animate-pulse',\r\n        isSent ? 'justify-end' : 'justify-start'\r\n      )}\r\n    >\r\n      {!isSent && (\r\n        <div className=\"h-8 w-8 rounded-full bg-muted/60 shrink-0\" />\r\n      )}\r\n      <div\r\n        className={cn(\r\n          'flex flex-col gap-2 max-w-[70%]',\r\n          isSent ? 'items-end' : 'items-start'\r\n        )}\r\n      >\r\n        {!isSent && <div className=\"h-3 w-24 bg-muted/60 rounded\" />}\r\n        <div\r\n          className={cn(\r\n            'rounded-2xl bg-muted/60',\r\n            isSent ? 'rounded-br-md' : 'rounded-bl-md',\r\n            'h-20 w-full min-w-[200px]'\r\n          )}\r\n        />\r\n        <div className=\"h-2 w-16 bg-muted/40 rounded\" />\r\n      </div>\r\n      {isSent && (\r\n        <div className=\"h-8 w-8 rounded-full bg-muted/60 shrink-0\" />\r\n      )}\r\n    </div>\r\n  )\r\n}\r\n\r\nexport function MessageSkeleton({ isSent, count = 3 }: MessageSkeletonProps) {\r\n  return (\r\n    <div className=\"space-y-4 p-4\">\r\n      {Array.from({ length: count }).map((_, i) => (\r\n        <SingleMessageSkeleton\r\n          key={i}\r\n          isSent={isSent !== undefined ? isSent : i % 2 === 0}\r\n        />\r\n      ))}\r\n    </div>\r\n  )\r\n}\r\n","import createLucideIcon from '../createLucideIcon';\nimport { IconNode } from '../types';\n\nexport const __iconNode: IconNode = [\n  ['circle', { cx: '12', cy: '12', r: '10', key: '1mglay' }],\n  ['path', { d: 'M8 14s1.5 2 4 2 4-2 4-2', key: '1y1vjs' }],\n  ['line', { x1: '9', x2: '9.01', y1: '9', y2: '9', key: 'yxxnd0' }],\n  ['line', { x1: '15', x2: '15.01', y1: '9', y2: '9', key: '1p4y9e' }],\n];\n\n/**\n * @component @name Smile\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8Y2lyY2xlIGN4PSIxMiIgY3k9IjEyIiByPSIxMCIgLz4KICA8cGF0aCBkPSJNOCAxNHMxLjUgMiA0IDIgNC0yIDQtMiIgLz4KICA8bGluZSB4MT0iOSIgeDI9IjkuMDEiIHkxPSI5IiB5Mj0iOSIgLz4KICA8bGluZSB4MT0iMTUiIHgyPSIxNS4wMSIgeTE9IjkiIHkyPSI5IiAvPgo8L3N2Zz4K) - https://lucide.dev/icons/smile\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst Smile = createLucideIcon('smile', __iconNode);\n\nexport default Smile;\n","import createLucideIcon from '../createLucideIcon';\nimport { IconNode } from '../types';\n\nexport const __iconNode: IconNode = [\n  [\n    'path',\n    {\n      d: 'm16 6-8.414 8.586a2 2 0 0 0 2.829 2.829l8.414-8.586a4 4 0 1 0-5.657-5.657l-8.379 8.551a6 6 0 1 0 8.485 8.485l8.379-8.551',\n      key: '1miecu',\n    },\n  ],\n];\n\n/**\n * @component @name Paperclip\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8cGF0aCBkPSJtMTYgNi04LjQxNCA4LjU4NmEyIDIgMCAwIDAgMi44MjkgMi44MjlsOC40MTQtOC41ODZhNCA0IDAgMSAwLTUuNjU3LTUuNjU3bC04LjM3OSA4LjU1MWE2IDYgMCAxIDAgOC40ODUgOC40ODVsOC4zNzktOC41NTEiIC8+Cjwvc3ZnPgo=) - https://lucide.dev/icons/paperclip\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst Paperclip = createLucideIcon('paperclip', __iconNode);\n\nexport default Paperclip;\n"],"names":[],"mappings":"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","ignoreList":[7,8]}