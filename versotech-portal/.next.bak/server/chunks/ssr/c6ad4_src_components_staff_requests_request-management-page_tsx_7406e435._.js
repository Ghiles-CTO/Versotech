module.exports=[894695,a=>{"use strict";var b=a.i(352584),c=a.i(611038),d=a.i(289633),e=a.i(838086);let f=(0,a.i(95799).default)("arrow-down-wide-narrow",[["path",{d:"m3 16 4 4 4-4",key:"1co6wj"}],["path",{d:"M7 20V4",key:"1yoxec"}],["path",{d:"M11 4h10",key:"1w87gc"}],["path",{d:"M11 8h7",key:"djye34"}],["path",{d:"M11 12h4",key:"q8tih4"}]]);var g=a.i(724070),h=a.i(540316),i=a.i(42329),j=a.i(166457),k=a.i(3321),l=a.i(789523),m=a.i(429306),n=a.i(38125),o=a.i(487068),p=a.i(657668),q=a.i(966494),r=a.i(325866),s=a.i(799373),t=a.i(15788),u=a.i(421908),v=a.i(951870),w=a.i(470305),x=a.i(930939),y=a.i(899750);function z({requestId:a,currentPriority:d,onUpdate:e,variant:f="inline"}){let[g,h]=(0,c.useState)(d),[i,j]=(0,c.useState)(!1),[l,m]=(0,c.useState)(!1),[n,o]=(0,c.useState)(null),p=async a=>{if("dialog"===f){o(a),m(!0);return}await q(a)},q=async b=>{j(!0);try{if(!(await fetch(`/api/requests/${a}`,{method:"PATCH",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({priority:b})})).ok)throw Error("Failed to update priority");h(b),y.toast.success(`Priority updated to ${x.PRIORITY_CONFIG[b].label}`),e?.(),m(!1)}catch(a){console.error("Failed to update priority:",a),y.toast.error("Failed to update priority")}finally{j(!1)}};return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)(v.Select,{value:g,onValueChange:p,disabled:i,children:[(0,b.jsx)(v.SelectTrigger,{className:"w-auto gap-2 border-none bg-transparent hover:bg-white/10",children:i?(0,b.jsx)(k.Loader2,{className:"h-3 w-3 animate-spin"}):(0,b.jsx)(t.Badge,{variant:x.PRIORITY_CONFIG[g].badge,children:x.PRIORITY_CONFIG[g].label})}),(0,b.jsx)(v.SelectContent,{children:(0,b.jsxs)(v.SelectGroup,{children:[(0,b.jsx)(v.SelectLabel,{children:"Change Priority"}),["urgent","high","normal","low"].map(a=>(0,b.jsx)(v.SelectItem,{value:a,children:(0,b.jsx)("div",{className:"flex items-center gap-2",children:(0,b.jsx)(t.Badge,{variant:x.PRIORITY_CONFIG[a].badge,children:x.PRIORITY_CONFIG[a].label})})},a))]})})]}),"dialog"===f&&(0,b.jsx)(w.Dialog,{open:l,onOpenChange:m,children:(0,b.jsxs)(w.DialogContent,{children:[(0,b.jsxs)(w.DialogHeader,{children:[(0,b.jsx)(w.DialogTitle,{children:"Change Request Priority"}),(0,b.jsxs)(w.DialogDescription,{children:["Are you sure you want to change the priority from"," ",(0,b.jsx)(t.Badge,{variant:x.PRIORITY_CONFIG[g].badge,children:x.PRIORITY_CONFIG[g].label})," ","to"," ",n&&(0,b.jsx)(t.Badge,{variant:x.PRIORITY_CONFIG[n].badge,children:x.PRIORITY_CONFIG[n].label}),"?"]})]}),(0,b.jsxs)(w.DialogFooter,{children:[(0,b.jsx)(u.Button,{variant:"outline",onClick:()=>m(!1),disabled:i,children:"Cancel"}),(0,b.jsxs)(u.Button,{onClick:()=>{n&&q(n)},disabled:i,children:[i&&(0,b.jsx)(k.Loader2,{className:"h-4 w-4 animate-spin mr-2"}),"Confirm"]})]})]})})]})}var A=a.i(216316),B=a.i(168118),C=a.i(441278),D=a.i(823879),E=a.i(191675),F=a.i(249464);let G={open:["assigned","in_progress","cancelled"],assigned:["in_progress","open","cancelled"],in_progress:["ready","awaiting_info","cancelled"],awaiting_info:["in_progress"],ready:["closed","in_progress"],closed:[],cancelled:[]},H={open:i.Clock,assigned:m.Play,in_progress:m.Play,awaiting_info:l.MessageCircle,ready:C.CheckCircle,closed:C.CheckCircle,cancelled:D.X};function I({requestId:a,currentStatus:d,onUpdate:e}){let[f,g]=(0,c.useState)(!1),[h,i]=(0,c.useState)(!1),[j,l]=(0,c.useState)(null),[m,n]=(0,c.useState)(""),o=G[d]||[],p=async(b,c)=>{g(!0);try{let d={status:b};if(c&&(d.completion_note=c),!(await fetch(`/api/requests/${a}`,{method:"PATCH",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(d)})).ok)throw Error("Failed to update status");y.toast.success(`Status updated to ${x.REQUEST_STATUS_CONFIG[b].label}`),e?.(),i(!1),n("")}catch(a){console.error("Failed to update status:",a),y.toast.error("Failed to update status")}finally{g(!1)}};if("closed"===d||"cancelled"===d){let a=H[d];return(0,b.jsxs)(t.Badge,{variant:"outline",className:"gap-1",children:[(0,b.jsx)(a,{className:"h-3 w-3"}),x.REQUEST_STATUS_CONFIG[d].label]})}let q=H[d];return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)(A.DropdownMenu,{children:[(0,b.jsx)(A.DropdownMenuTrigger,{asChild:!0,children:(0,b.jsxs)(u.Button,{variant:"outline",size:"sm",className:"gap-2",disabled:f||0===o.length,children:[f?(0,b.jsx)(k.Loader2,{className:"h-3 w-3 animate-spin"}):(0,b.jsx)(q,{className:"h-3 w-3"}),x.REQUEST_STATUS_CONFIG[d].label,o.length>0&&(0,b.jsx)(B.ChevronDown,{className:"h-3 w-3"})]})}),(0,b.jsxs)(A.DropdownMenuContent,{align:"end",children:[(0,b.jsx)(A.DropdownMenuLabel,{children:"Change Status"}),(0,b.jsx)(A.DropdownMenuSeparator,{}),o.map(a=>{let c=H[a];return(0,b.jsxs)(A.DropdownMenuItem,{onClick:()=>{"closed"===a?(l(a),i(!0)):p(a)},children:[(0,b.jsx)(c,{className:"h-4 w-4 mr-2"}),x.REQUEST_STATUS_CONFIG[a].label]},a)})]})]}),(0,b.jsx)(w.Dialog,{open:h,onOpenChange:i,children:(0,b.jsxs)(w.DialogContent,{children:[(0,b.jsxs)(w.DialogHeader,{children:[(0,b.jsx)(w.DialogTitle,{children:"Close Request"}),(0,b.jsx)(w.DialogDescription,{children:"Add a completion note before closing this request. This will be visible to the investor."})]}),(0,b.jsx)("div",{className:"space-y-4",children:(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(F.Label,{htmlFor:"completion-note",children:"Completion Note"}),(0,b.jsx)(E.Textarea,{id:"completion-note",placeholder:"Describe what was delivered or how the request was resolved...",value:m,onChange:a=>n(a.target.value),rows:4})]})}),(0,b.jsxs)(w.DialogFooter,{children:[(0,b.jsx)(u.Button,{variant:"outline",onClick:()=>i(!1),disabled:f,children:"Cancel"}),(0,b.jsxs)(u.Button,{onClick:()=>{j&&p(j,m)},disabled:f||!m.trim(),children:[f&&(0,b.jsx)(k.Loader2,{className:"h-4 w-4 animate-spin mr-2"}),"Close Request"]})]})]})})]})}var J=a.i(92881);function K({requestId:a,currentAssignee:d,onUpdate:e,trigger:f,currentUserId:g}){let[h,i]=(0,c.useState)(!1),[j,l]=(0,c.useState)([]),[m,n]=(0,c.useState)(""),[o,p]=(0,c.useState)(""),[q,s]=(0,c.useState)(!1),[t,x]=(0,c.useState)(!1);(0,c.useEffect)(()=>{h&&z()},[h]);let z=async()=>{s(!0);try{let a=await fetch("/api/profiles?role=staff_admin%2Cstaff_ops%2Cstaff_rm",{credentials:"include"});if(!a.ok)throw Error("Failed to load staff list");let b=await a.json();l(b.profiles||[])}catch(a){console.error("Failed to load staff list:",a),y.toast.error("Failed to load staff members")}finally{s(!1)}},A=async()=>{if(!m)return void y.toast.error("Please select a staff member");x(!0);try{if(!(await fetch(`/api/staff/requests/${a}/assign`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({assigned_to:m,note:o||void 0})})).ok)throw Error("Failed to assign request");let b=j.find(a=>a.id===m);y.toast.success(`Request assigned to ${b?.display_name||"staff member"}`),e?.(),i(!1),n(""),p("")}catch(a){console.error("Failed to assign request:",a),y.toast.error("Failed to assign request")}finally{x(!1)}},B=async()=>{if(!g)return void y.toast.error("User ID not available");x(!0);try{if(!(await fetch(`/api/staff/requests/${a}/assign`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({assigned_to:g})})).ok)throw Error("Failed to assign request");y.toast.success("Request assigned to you"),e?.()}catch(a){console.error("Failed to assign request:",a),y.toast.error("Failed to assign request")}finally{x(!1)}};return(0,b.jsxs)(w.Dialog,{open:h,onOpenChange:i,children:[(0,b.jsx)(w.DialogTrigger,{asChild:!0,children:f||(0,b.jsxs)(u.Button,{variant:"outline",size:"sm",className:"gap-2",children:[(0,b.jsx)(r.User,{className:"h-4 w-4"}),d?"Reassign":"Assign"]})}),(0,b.jsxs)(w.DialogContent,{children:[(0,b.jsxs)(w.DialogHeader,{children:[(0,b.jsx)(w.DialogTitle,{children:d?"Reassign Request":"Assign Request"}),(0,b.jsx)(w.DialogDescription,{children:d?(0,b.jsxs)(b.Fragment,{children:["Currently assigned to ",(0,b.jsx)("strong",{children:d.display_name}),". Select a new staff member to reassign."]}):"Select a staff member to assign this request to."})]}),(0,b.jsxs)("div",{className:"space-y-4",children:[g&&d?.id!==g&&(0,b.jsxs)(u.Button,{variant:"secondary",className:"w-full gap-2",onClick:B,disabled:t,children:[t?(0,b.jsx)(k.Loader2,{className:"h-4 w-4 animate-spin"}):(0,b.jsx)(J.UserCheck,{className:"h-4 w-4"}),"Assign to Me"]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(F.Label,{htmlFor:"staff-select",children:"Staff Member"}),q?(0,b.jsx)("div",{className:"flex items-center justify-center py-8",children:(0,b.jsx)(k.Loader2,{className:"h-6 w-6 animate-spin text-muted-foreground"})}):(0,b.jsxs)(v.Select,{value:m,onValueChange:n,children:[(0,b.jsx)(v.SelectTrigger,{id:"staff-select",children:(0,b.jsx)(v.SelectValue,{placeholder:"Select staff member..."})}),(0,b.jsx)(v.SelectContent,{children:(0,b.jsxs)(v.SelectGroup,{children:[(0,b.jsx)(v.SelectLabel,{children:"Staff Members"}),j.map(a=>(0,b.jsx)(v.SelectItem,{value:a.id,children:(0,b.jsxs)("div",{className:"flex flex-col",children:[(0,b.jsx)("span",{children:a.display_name}),(0,b.jsxs)("span",{className:"text-xs text-muted-foreground",children:[a.title||a.role," • ",a.email]})]})},a.id))]})})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(F.Label,{htmlFor:"assignment-note",children:"Assignment Note (Optional)"}),(0,b.jsx)(E.Textarea,{id:"assignment-note",placeholder:"Add context or instructions for the assignee...",value:o,onChange:a=>p(a.target.value),rows:3})]})]}),(0,b.jsxs)(w.DialogFooter,{children:[(0,b.jsx)(u.Button,{variant:"outline",onClick:()=>i(!1),disabled:t,children:"Cancel"}),(0,b.jsxs)(u.Button,{onClick:A,disabled:t||!m,children:[t&&(0,b.jsx)(k.Loader2,{className:"h-4 w-4 animate-spin mr-2"}),d?"Reassign":"Assign"]})]})]})]})}var L=a.i(284169),M=a.i(663475),N=a.i(537412),O=a.i(877028),P=a.i(58834),Q=a.i(888987);let R={search:"",status:"all",category:"all",priority:"all",assignedTo:"all",overdueOnly:!1,groupByCategory:!0},S=[{value:"all",label:"All statuses"},{value:"open",label:"Open"},{value:"assigned",label:"Assigned"},{value:"in_progress",label:"In Progress"},{value:"ready",label:"Ready"},{value:"closed",label:"Closed"}],T=[{value:"all",label:"All priorities"},{value:"urgent",label:"Urgent"},{value:"high",label:"High"},{value:"normal",label:"Normal"},{value:"low",label:"Low"}],U=[{value:"all",label:"All categories"},{value:"tax_doc",label:"Tax Documents"},{value:"analysis",label:"Performance Analysis"},{value:"data_export",label:"Data Exports"},{value:"presentation",label:"Presentations"},{value:"communication",label:"Communications"},{value:"cashflow",label:"Cashflow"},{value:"valuation",label:"Valuation"},{value:"other",label:"Other"}],V={urgent:0,high:1,normal:2,low:3};function W(){let a=(0,P.createClient)(),e=(0,d.useRouter)(),f=(0,d.useSearchParams)(),[g,h]=(0,c.useState)(null),[i,j]=(0,c.useState)(()=>f?{search:f.get("q")||"",status:f.get("status")||"all",category:f.get("category")||"all",priority:f.get("priority")||"all",assignedTo:f.get("assigned_to")||"all",overdueOnly:"true"===f.get("overdue"),groupByCategory:"true"===f.get("group_by_category")}:R),[k,l]=(0,c.useState)([]),[m,n]=(0,c.useState)(null),[o,p]=(0,c.useState)(!0),[q,r]=(0,c.useState)(null),[s,t]=(0,c.useState)(null),[u,v]=(0,c.useState)(null),[x,z]=(0,c.useState)(!1);async function A(){try{let{data:{user:b}}=await a.auth.getUser();b&&h(b.id)}catch(a){console.error("Failed to load current user:",a)}}async function B(a=!0){a&&p(!0),r(null);try{let a=new URLSearchParams;i.search&&a.set("q",i.search),"all"!==i.status&&a.set("status",i.status),"all"!==i.category&&a.set("category",i.category),"all"!==i.priority&&a.set("priority",i.priority),"all"!==i.assignedTo&&a.set("assigned_to",i.assignedTo),i.overdueOnly&&a.set("overdue_only","true"),i.groupByCategory&&a.set("group_by_category","true");let b=await fetch(`/api/staff/requests${a.size?`?${a.toString()}`:""}`,{credentials:"include"});if(!b.ok){let a="Failed to load requests";try{let c=await b.json(),d=[];"string"==typeof c?.error&&c.error.trim().length>0&&d.push(c.error.trim()),"string"==typeof c?.details&&c.details.trim().length>0&&d.push(c.details.trim()),"string"==typeof c?.hint&&c.hint.trim().length>0&&d.push(`Hint: ${c.hint.trim()}`),"string"==typeof c?.code&&c.code.trim().length>0&&d.push(`Code: ${c.code.trim()}`),d.length>0&&(a=d.join(" — "))}catch{}if(401===b.status){let a="Staff authentication required. Sign in with a staff account or set the demo_auth_user cookie for a staff role.";s!==a&&y.toast.info(a),t(a),r(null),l([]),n(null),p(!1);return}throw console.error("[StaffRequests] API returned error:",a,b.status,{filters:i,authError:s}),Error(`${a} (status ${b.status})`)}let c=await b.json();l(c.requests||[]),n(c.stats||null),t(null),c.hasData||y.toast.info("Connect Supabase data or run migrations to populate real requests.")}catch(b){console.error("[StaffRequests] Failed to load requests",b);let a=b instanceof Error?b.message:"Unexpected error occurred";a.toLowerCase().includes("staff authentication required")?(s!==a&&y.toast.info(a),t(a),r(null)):(r(a),a.toLowerCase().includes("failed to fetch requests")||y.toast.error(a))}finally{p(!1)}}(0,c.useEffect)(()=>{B(),A()},[i]),(0,c.useEffect)(()=>{let b=a.channel("staff_request_tickets_updates").on("postgres_changes",{event:"*",schema:"public",table:"request_tickets"},a=>{("INSERT"===a.eventType||"UPDATE"===a.eventType||"DELETE"===a.eventType)&&B(!1)}).subscribe();return()=>{a.removeChannel(b)}},[]),(0,c.useEffect)(()=>{let a=()=>{B(!1)};return window.addEventListener("staffRequests:refresh",a),()=>window.removeEventListener("staffRequests:refresh",a)},[]),(0,c.useEffect)(()=>{if(!f)return;let a=new URLSearchParams;i.search&&a.set("q",i.search),"all"!==i.status&&a.set("status",i.status),"all"!==i.category&&a.set("category",i.category),"all"!==i.priority&&a.set("priority",i.priority),"all"!==i.assignedTo&&a.set("assigned_to",i.assignedTo),i.overdueOnly&&a.set("overdue","true"),i.groupByCategory&&a.set("group_by_category","true");let b=a.toString();e.replace(b?`?${b}`:"?",{scroll:!1})},[i]);let C=(0,c.useMemo)(()=>[...k].sort((a,b)=>{let c=V[a.priority]??99,d=V[b.priority]??99;if(c!==d)return c-d;let e=a.created_at?new Date(a.created_at).getTime():0;return(b.created_at?new Date(b.created_at).getTime():0)-e}),[k]),D=m?.overdue_count??0;return(0,b.jsxs)("div",{className:"p-6 space-y-6 text-foreground",children:[s&&(0,b.jsxs)(L.Card,{className:"border border-amber-400/40 bg-amber-500/10",children:[(0,b.jsxs)(L.CardHeader,{children:[(0,b.jsx)(L.CardTitle,{className:"text-amber-100",children:"Staff Authentication Required"}),(0,b.jsx)(L.CardDescription,{className:"text-amber-100/80",children:s})]}),(0,b.jsxs)(L.CardContent,{className:"text-sm text-amber-50/90 space-y-2",children:[(0,b.jsxs)("p",{children:["Sign in with a staff account: ",(0,b.jsx)("strong",{children:"admin@versotech.com"})," / ",(0,b.jsx)("strong",{children:"admin123"})]}),(0,b.jsxs)("p",{className:"text-xs",children:["Or set the ",(0,b.jsx)("code",{children:"demo_auth_user"})," cookie (must use valid UUID for assigned_to filters):"]}),(0,b.jsx)("pre",{className:"rounded bg-amber-900/40 border border-amber-400/30 p-2 text-xs text-amber-50 overflow-x-auto",children:'{"id":"2a833fc7-b307-4485-a4c1-4e5c5a010e74","email":"admin@versotech.com","role":"staff_admin","displayName":"Admin Demo"}'})]})]}),(0,b.jsx)(X,{onRefresh:()=>B(),isRefreshing:o}),(0,b.jsx)(Y,{stats:m,totalRequests:C.length,overdueCount:D}),!s&&(0,b.jsx)(Z,{filters:i,onChange:a=>{j(b=>({...b,...a}))},onReset:()=>{j(R)},isLoading:o}),(0,b.jsx)($,{requests:C,isLoading:o,error:s?null:q,onRefresh:()=>B(),onSelectRequest:a=>{v(a),z(!0)},disabled:!!s,authError:s,groupByCategory:!!i.groupByCategory,currentUserId:g}),(0,b.jsx)(w.Dialog,{open:x,onOpenChange:z,children:(0,b.jsxs)(w.DialogContent,{className:"max-w-3xl",children:[(0,b.jsx)(w.DialogHeader,{children:(0,b.jsx)(w.DialogTitle,{children:"Request Details"})}),(0,b.jsx)(N.ScrollArea,{className:"h-[70vh] pr-4",children:u?(0,b.jsx)(aa,{request:u,onUpdate:()=>B(),currentUserId:g}):(0,b.jsx)("div",{className:"text-muted-foreground",children:"Select a request to view details"})})]})})]})}function X({onRefresh:a,isRefreshing:c}){let e=(0,d.useRouter)();return(0,b.jsxs)("div",{className:"flex flex-col gap-4 lg:flex-row lg:items-center lg:justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-3xl font-bold",children:"Request Management"}),(0,b.jsx)("p",{className:"text-muted-foreground mt-1",children:"Centralized triage for investor tax, performance, and servicing requests."})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsxs)(u.Button,{variant:"outline",onClick:a,className:"gap-2",disabled:c,children:[c?(0,b.jsx)(k.Loader2,{className:"h-4 w-4 animate-spin"}):(0,b.jsx)(n.RotateCcw,{className:"h-4 w-4"}),"Refresh"]}),(0,b.jsxs)(u.Button,{className:"gap-2",onClick:()=>e.push("/versotech_main/requests/analytics"),children:[(0,b.jsx)(q.TrendingUp,{className:"h-4 w-4"}),"Analytics"]})]})]})}function Y({stats:a,totalRequests:c,overdueCount:d}){let e=[{title:"Total Requests",value:a?.total_requests??c,description:"Active in queue"},{title:"Open",value:a?.open_count??0,description:"Awaiting assignment"},{title:"In Progress",value:a?.in_progress_count??0,description:"Assigned & being worked"},{title:"Ready",value:a?.ready_count??0,description:"Awaiting delivery"},{title:"Overdue",value:d,description:"Past SLA deadline",highlight:d>0}];return(0,b.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-3 xl:grid-cols-5 gap-4",children:e.map(a=>(0,b.jsxs)(L.Card,{className:(0,Q.cn)("border border-white/10 bg-white/5 transition-shadow",a.highlight?"shadow-lg shadow-red-500/20":"hover:shadow-lg"),children:[(0,b.jsx)(L.CardHeader,{className:"pb-3",children:(0,b.jsx)(L.CardTitle,{className:"text-sm text-muted-foreground",children:a.title})}),(0,b.jsxs)(L.CardContent,{children:[(0,b.jsx)("div",{className:"text-2xl font-semibold",children:a.value}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:a.description})]})]},a.title))})}function Z({filters:a,onChange:c,onReset:d,isLoading:g}){let k="all"!==a.status||"all"!==a.category||"all"!==a.priority||"all"!==a.assignedTo||a.overdueOnly||a.search.length>0;return(0,b.jsx)(L.Card,{className:"border border-white/10 bg-white/5",children:(0,b.jsxs)(L.CardContent,{className:"p-4 space-y-4",children:[(0,b.jsxs)("div",{className:"flex flex-col gap-4 xl:flex-row xl:items-center xl:justify-between",children:[(0,b.jsxs)("div",{className:"relative flex-1",children:[(0,b.jsx)(o.Search,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),(0,b.jsx)(M.Input,{placeholder:"Search by request ID, investor, title, or assignee",value:a.search,onChange:a=>c({search:a.target.value}),className:"pl-10"})]}),(0,b.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,b.jsxs)(u.Button,{variant:"outline",className:"gap-2",onClick:d,disabled:g||!k,children:[(0,b.jsx)(p.SlidersHorizontal,{className:"h-4 w-4"}),"Reset"]}),(0,b.jsxs)(u.Button,{variant:a.groupByCategory?"default":"outline",className:"gap-2",onClick:()=>c({groupByCategory:!a.groupByCategory}),children:[(0,b.jsx)(h.ClipboardList,{className:"h-4 w-4"}),a.groupByCategory?"Grouped":"Group"]})]})]}),(0,b.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,b.jsxs)(u.Button,{variant:"me"===a.assignedTo?"default":"outline",size:"sm",className:"gap-2",onClick:()=>c({assignedTo:"me"===a.assignedTo?"all":"me"}),children:[(0,b.jsx)(r.User,{className:"h-3 w-3"})," My Tasks"]}),(0,b.jsx)(u.Button,{variant:"open"===a.status?"default":"outline",size:"sm",onClick:()=>c({status:"open"===a.status?"all":"open"}),children:"Unassigned"}),(0,b.jsxs)(u.Button,{variant:a.overdueOnly?"default":"outline",size:"sm",className:"gap-2",onClick:()=>c({overdueOnly:!a.overdueOnly}),children:[(0,b.jsx)(e.AlertTriangle,{className:"h-3 w-3"})," Overdue"]}),(0,b.jsx)(u.Button,{variant:"urgent"===a.priority||"high"===a.priority?"default":"outline",size:"sm",onClick:()=>{"urgent"===a.priority||"high"===a.priority?c({priority:"all"}):c({priority:"urgent"})},children:"High Priority"}),(0,b.jsx)(u.Button,{variant:"in_progress"===a.status?"default":"outline",size:"sm",onClick:()=>c({status:"in_progress"===a.status?"all":"in_progress"}),children:"In Progress"})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2 xl:grid-cols-5",children:[(0,b.jsxs)(v.Select,{value:a.status,onValueChange:a=>c({status:a}),children:[(0,b.jsxs)(v.SelectTrigger,{className:"gap-2",children:[(0,b.jsx)(j.Filter,{className:"h-4 w-4"}),(0,b.jsx)(v.SelectValue,{placeholder:"Status"})]}),(0,b.jsx)(v.SelectContent,{children:(0,b.jsxs)(v.SelectGroup,{children:[(0,b.jsx)(v.SelectLabel,{children:"Status"}),S.map(a=>(0,b.jsx)(v.SelectItem,{value:a.value,children:a.label},a.value))]})})]}),(0,b.jsxs)(v.Select,{value:a.priority,onValueChange:a=>c({priority:a}),children:[(0,b.jsxs)(v.SelectTrigger,{className:"gap-2",children:[(0,b.jsx)(f,{className:"h-4 w-4"}),(0,b.jsx)(v.SelectValue,{placeholder:"Priority"})]}),(0,b.jsx)(v.SelectContent,{children:(0,b.jsxs)(v.SelectGroup,{children:[(0,b.jsx)(v.SelectLabel,{children:"Priority"}),T.map(a=>(0,b.jsx)(v.SelectItem,{value:a.value,children:a.label},a.value))]})})]}),(0,b.jsxs)(v.Select,{value:a.category,onValueChange:a=>c({category:a}),children:[(0,b.jsxs)(v.SelectTrigger,{className:"gap-2",children:[(0,b.jsx)(h.ClipboardList,{className:"h-4 w-4"}),(0,b.jsx)(v.SelectValue,{placeholder:"Category"})]}),(0,b.jsx)(v.SelectContent,{children:(0,b.jsxs)(v.SelectGroup,{children:[(0,b.jsx)(v.SelectLabel,{children:"Category"}),U.map(a=>(0,b.jsx)(v.SelectItem,{value:a.value,children:a.label},a.value))]})})]}),(0,b.jsxs)(v.Select,{value:a.assignedTo,onValueChange:a=>c({assignedTo:a}),children:[(0,b.jsxs)(v.SelectTrigger,{className:"gap-2",children:[(0,b.jsx)(r.User,{className:"h-4 w-4"}),(0,b.jsx)(v.SelectValue,{placeholder:"Assignee"})]}),(0,b.jsx)(v.SelectContent,{children:(0,b.jsxs)(v.SelectGroup,{children:[(0,b.jsx)(v.SelectLabel,{children:"Assignee"}),(0,b.jsx)(v.SelectItem,{value:"all",children:"All staff"}),(0,b.jsx)(v.SelectItem,{value:"me",children:"Assigned to me"})]})})]}),(0,b.jsxs)(v.Select,{value:a.overdueOnly?"overdue":"any",onValueChange:a=>c({overdueOnly:"overdue"===a}),children:[(0,b.jsxs)(v.SelectTrigger,{className:"gap-2",children:[(0,b.jsx)(i.Clock,{className:"h-4 w-4"}),(0,b.jsx)(v.SelectValue,{placeholder:"SLA"})]}),(0,b.jsx)(v.SelectContent,{children:(0,b.jsxs)(v.SelectGroup,{children:[(0,b.jsx)(v.SelectLabel,{children:"SLA"}),(0,b.jsx)(v.SelectItem,{value:"any",children:"All requests"}),(0,b.jsx)(v.SelectItem,{value:"overdue",children:"SLA breaches only"})]})})]})]})]})})}function $({requests:a,isLoading:c,error:d,onRefresh:f,onSelectRequest:g,disabled:i=!1,authError:j,groupByCategory:l=!1,currentUserId:m}){if(c)return(0,b.jsx)(L.Card,{className:"border border-white/10 bg-white/5",children:(0,b.jsxs)(L.CardContent,{className:"p-12 flex flex-col items-center gap-3 text-muted-foreground",children:[(0,b.jsx)(k.Loader2,{className:"h-8 w-8 animate-spin"}),(0,b.jsx)("p",{children:"Loading request queue…"})]})});if(d)return(0,b.jsx)(L.Card,{className:"border border-red-400/30 bg-red-500/10",children:(0,b.jsxs)(L.CardContent,{className:"p-6 space-y-3",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 text-sm text-red-200",children:[(0,b.jsx)(e.AlertTriangle,{className:"h-4 w-4"}),d]}),(0,b.jsxs)(u.Button,{variant:"outline",onClick:f,className:"gap-2 border-white/20",children:[(0,b.jsx)(n.RotateCcw,{className:"h-4 w-4"}),"Retry"]})]})});if(j)return(0,b.jsx)(L.Card,{className:"border border-dashed border-amber-400/40 bg-amber-500/10",children:(0,b.jsxs)(L.CardContent,{className:"p-10 text-center space-y-3 text-amber-100",children:[(0,b.jsx)(h.ClipboardList,{className:"h-12 w-12 text-amber-300/80 mx-auto"}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("p",{className:"text-lg font-semibold",children:"Authentication Required"}),(0,b.jsx)("p",{className:"text-sm text-amber-100/80",children:j})]})]})});if(!a.length)return(0,b.jsx)(L.Card,{className:"border border-dashed border-white/20 bg-white/5",children:(0,b.jsxs)(L.CardContent,{className:"p-12 text-center space-y-3",children:[(0,b.jsx)(h.ClipboardList,{className:"h-12 w-12 text-muted-foreground/80 mx-auto"}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("p",{className:"text-lg font-semibold",children:"No active requests"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"When investors submit requests from the Reports page or inbox automations, they will appear here for triage."})]}),(0,b.jsxs)(u.Button,{variant:"outline",onClick:f,className:"gap-2 border-white/20",children:[(0,b.jsx)(n.RotateCcw,{className:"h-4 w-4"}),"Check again"]})]})});if(l){let c=new Map;for(let b of a){let a=b.category||"other",d=c.get(a)||[];d.push(b),c.set(a,d)}return(0,b.jsx)("div",{className:(0,Q.cn)("space-y-6",i&&"opacity-50 pointer-events-none select-none"),children:Array.from(c.entries()).map(([a,c])=>(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(t.Badge,{variant:"outline",className:"border-white/20",children:x.REQUEST_CATEGORIES[a]?.label||a}),(0,b.jsxs)("span",{className:"text-xs text-muted-foreground",children:[c.length," items"]})]}),(0,b.jsx)("div",{className:"space-y-3",children:c.map(a=>(0,b.jsx)(_,{request:a,onSelect:()=>g(a),onUpdate:f,currentUserId:m},a.id))})]},a))})}return(0,b.jsx)("div",{className:(0,Q.cn)("space-y-4",i&&"opacity-50 pointer-events-none select-none"),children:a.map(a=>(0,b.jsx)(_,{request:a,onSelect:()=>g(a),onUpdate:f,currentUserId:m},a.id))})}function _({request:a,onSelect:c,onUpdate:d,currentUserId:f}){x.REQUEST_STATUS_CONFIG[a.status];let h=!!(a.due_date&&(0,x.isOverdue)(a.due_date));return(0,b.jsx)(L.Card,{className:(0,Q.cn)("border border-white/10 bg-white/5 hover:border-white/30 transition-colors",h&&"border-red-400/50 bg-red-500/5"),children:(0,b.jsx)(L.CardContent,{className:"p-6",children:(0,b.jsxs)("div",{className:"flex flex-col gap-4 lg:flex-row lg:items-start lg:justify-between",children:[(0,b.jsxs)("div",{className:"space-y-3 flex-1",children:[(0,b.jsxs)("div",{className:"flex flex-wrap items-center gap-2 text-sm",children:[(0,b.jsx)(t.Badge,{variant:"outline",className:"border-white/20 text-xs uppercase tracking-wide",children:a.id.split("-")[0]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(I,{requestId:a.id,currentStatus:a.status,onUpdate:d}),(0,b.jsx)(z,{requestId:a.id,currentPriority:a.priority,onUpdate:d,variant:"inline"}),(0,b.jsx)(t.Badge,{variant:"outline",className:"border-white/20",children:x.REQUEST_CATEGORIES[a.category]?.label||a.category}),h&&(0,b.jsxs)(t.Badge,{variant:"destructive",className:"gap-1",children:[(0,b.jsx)(e.AlertTriangle,{className:"h-3 w-3"}),"Overdue"]})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{className:"text-lg font-semibold",children:a.subject}),a.details&&(0,b.jsx)("p",{className:"text-sm text-muted-foreground line-clamp-2 max-w-2xl",children:a.details})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 gap-3 text-sm md:grid-cols-2 xl:grid-cols-4",children:[(0,b.jsx)(ab,{label:"Investor",value:a.investor?.legal_name||"N/A"}),(0,b.jsx)(ab,{label:"Created",value:new Date(a.created_at).toLocaleString(void 0,{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}),(0,b.jsx)(ab,{label:"Due",value:a.due_date?new Date(a.due_date).toLocaleString(void 0,{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"Not set",emphasis:h}),(0,b.jsx)(ab,{label:"Assigned",value:a.assigned_to_profile?.display_name||"Unassigned"})]}),(0,b.jsxs)("div",{className:"flex flex-wrap gap-3 text-xs text-muted-foreground",children:[a.due_date&&(0,b.jsxs)("div",{className:"flex items-center gap-1",children:[(0,b.jsx)(g.Calendar,{className:"h-3 w-3"}),(0,x.formatTimeRemaining)(a.due_date)]}),a.linked_workflow_run&&(0,b.jsxs)("div",{className:"flex items-center gap-1",children:[(0,b.jsx)(m.Play,{className:"h-3 w-3"})," Workflow ",ad(a.linked_workflow_run)]})]})]}),(0,b.jsxs)("div",{className:"flex flex-col gap-2 lg:min-w-[160px]",children:[(0,b.jsxs)(u.Button,{variant:"outline",size:"sm",className:"gap-2",onClick:c,children:[(0,b.jsx)(ae,{}),"View Details"]}),(0,b.jsx)(K,{requestId:a.id,currentAssignee:a.assigned_to_profile,currentUserId:f||void 0,onUpdate:d,trigger:(0,b.jsxs)(u.Button,{variant:"ghost",size:"sm",className:"gap-2 w-full justify-start",children:[(0,b.jsx)(s.UserPlus,{className:"h-4 w-4"}),a.assigned_to?"Reassign":"Assign"]})}),(0,b.jsxs)(u.Button,{variant:"ghost",size:"sm",className:"gap-2",onClick:c,children:[(0,b.jsx)(l.MessageCircle,{className:"h-4 w-4"}),"Conversation"]})]})]})})})}function aa({request:a,onUpdate:d,currentUserId:f}){let[g,h]=(0,c.useState)(!1),i=!!(a.due_date&&"closed"!==a.status&&"ready"!==a.status&&(0,x.isOverdue)(a.due_date));x.REQUEST_STATUS_CONFIG[a.status];let j=async()=>{h(!0);try{let b=await fetch("/api/conversations",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({subject:`Request ${a.id}: ${a.subject}`,participant_ids:[a.created_by],type:"dm",initial_message:`Context: request ${a.id} (${a.category||"general"}) - ${a.subject}`})});if(b.ok){let a=await b.json(),c=a?.conversation?.id;c&&(y.toast.success("Conversation created"),window.location.href=`/versotech_main/messages/${c}`)}else throw Error("Failed to create conversation")}catch(a){console.error("Failed to create conversation:",a),y.toast.error("Failed to create conversation")}finally{h(!1)}};return(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,b.jsx)(t.Badge,{variant:"outline",className:"border-white/20 text-xs",children:a.id}),(0,b.jsx)(I,{requestId:a.id,currentStatus:a.status,onUpdate:d}),(0,b.jsx)(z,{requestId:a.id,currentPriority:a.priority,onUpdate:d,variant:"inline"}),(0,b.jsx)(t.Badge,{variant:"outline",className:"border-white/20",children:x.REQUEST_CATEGORIES[a.category]?.label||a.category}),i&&(0,b.jsxs)(t.Badge,{variant:"destructive",className:"gap-1",children:[(0,b.jsx)(e.AlertTriangle,{className:"h-3 w-3"})," SLA breach"]})]}),(0,b.jsx)("h2",{className:"text-2xl font-semibold",children:a.subject}),a.details&&(0,b.jsx)("p",{className:"text-sm text-muted-foreground whitespace-pre-line",children:a.details})]}),(0,b.jsx)(O.Separator,{className:"border-white/10"}),(0,b.jsxs)("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[(0,b.jsxs)(ac,{title:"Investor",children:[(0,b.jsx)("p",{className:"text-sm font-medium",children:a.investor?.legal_name||"N/A"}),(0,b.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Created by: ",a.created_by_profile?.display_name]})]}),(0,b.jsxs)(ac,{title:"Assignment",children:[(0,b.jsx)("p",{className:"text-sm font-medium",children:a.assigned_to_profile?.display_name||"Unassigned"}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:a.assigned_to?"Assigned staff member responsible for delivery.":"Assign to an available analyst or RM."})]}),a.due_date&&(0,b.jsxs)(ac,{title:"SLA & Due Date",children:[(0,b.jsx)("p",{className:"text-sm font-medium",children:new Date(a.due_date).toLocaleString(void 0,{month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:(0,x.formatTimeRemaining)(a.due_date)})]}),(0,b.jsxs)(ac,{title:"Linked Workflow & Deliverables",children:[a.linked_workflow_run?(0,b.jsxs)("p",{className:"text-sm font-medium",children:["Workflow run: ",ad(a.linked_workflow_run)]}):(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"No workflow run linked."}),a.result_doc_id?(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"Deliverable ready for review."}):(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"Attach deliverables before closing the request."})]})]}),(0,b.jsx)(O.Separator,{className:"border-white/10"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{className:"text-lg font-medium mb-2",children:"Status History & Notes"}),(0,b.jsxs)("ul",{className:"space-y-2 text-sm text-muted-foreground",children:[(0,b.jsxs)("li",{children:["Created at ",new Date(a.created_at).toLocaleString()," by ",a.created_by_profile?.display_name]}),a.updated_at&&(0,b.jsxs)("li",{children:["Last updated at ",new Date(a.updated_at).toLocaleString()]}),a.closed_at&&(0,b.jsxs)("li",{children:["Closed at ",new Date(a.closed_at).toLocaleString()]}),a.completion_note&&(0,b.jsxs)("li",{className:"bg-white/5 border border-white/10 rounded-md p-3 text-foreground",children:[(0,b.jsx)("p",{className:"text-sm font-medium mb-1",children:"Completion Note"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground whitespace-pre-line",children:a.completion_note})]})]})]}),(0,b.jsx)(O.Separator,{className:"border-white/10"}),(0,b.jsx)("div",{className:"space-y-4",children:(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:[(0,b.jsx)(K,{requestId:a.id,currentAssignee:a.assigned_to_profile,currentUserId:f||void 0,onUpdate:d,trigger:(0,b.jsxs)(u.Button,{variant:"secondary",className:"justify-start gap-2 w-full",children:[(0,b.jsx)(s.UserPlus,{className:"h-4 w-4"}),a.assigned_to?"Reassign Request":"Assign Request"]})}),(0,b.jsxs)(u.Button,{variant:"outline",className:"justify-start gap-2",onClick:j,disabled:g,children:[g?(0,b.jsx)(k.Loader2,{className:"h-4 w-4 animate-spin"}):(0,b.jsx)(l.MessageCircle,{className:"h-4 w-4"}),"Create Conversation"]})]})})]})}function ab({label:a,value:c,emphasis:d}){return(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-xs text-muted-foreground uppercase tracking-wide",children:a}),(0,b.jsx)("div",{className:(0,Q.cn)("text-sm font-medium",d&&"text-red-300"),children:c})]})}function ac({title:a,children:c}){return(0,b.jsxs)("div",{className:"rounded-lg border border-white/10 bg-white/5 p-4 space-y-2",children:[(0,b.jsx)("h4",{className:"text-sm font-medium text-muted-foreground uppercase tracking-wide",children:a}),c]})}function ad(a){return a?`${a.slice(0,6)}…${a.slice(-4)}`:""}function ae(){return(0,b.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"h-4 w-4",children:[(0,b.jsx)("path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7"}),(0,b.jsx)("circle",{cx:"12",cy:"12",r:"3"})]})}a.s(["RequestManagementPage",()=>W],894695)}];

//# sourceMappingURL=c6ad4_src_components_staff_requests_request-management-page_tsx_7406e435._.js.map