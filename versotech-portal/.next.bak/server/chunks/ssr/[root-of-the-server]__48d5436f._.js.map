{"version":3,"sources":["../../../../../versotech-portal/src/components/investors/investor-detail-client.tsx/__nextjs-internal-proxy.mjs","../../../../../versotech-portal/src/app/%28staff%29/versotech/staff/investors/%5Bid%5D/page.tsx"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport const InvestorDetailClient = registerClientReference(\n    function() { throw new Error(\"Attempted to call InvestorDetailClient() from the server but InvestorDetailClient is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/versotech-portal/src/components/investors/investor-detail-client.tsx\",\n    \"InvestorDetailClient\",\n);\n","import { createClient } from '@/lib/supabase/server'\r\nimport { requireStaffAuth } from '@/lib/auth'\r\nimport { notFound } from 'next/navigation'\r\nimport { InvestorDetailClient } from '@/components/investors/investor-detail-client'\r\n\r\nexport const dynamic = 'force-dynamic'\r\n\r\ntype InvestorDetail = {\r\n  id: string\r\n  legal_name: string\r\n  display_name: string | null\r\n  type: string\r\n  email: string | null\r\n  phone: string | null\r\n  country: string | null\r\n  country_of_incorporation: string | null\r\n  tax_residency: string | null\r\n  kyc_status: string\r\n  status: string\r\n  onboarding_status: string\r\n  aml_risk_rating: string | null\r\n  is_pep: boolean\r\n  is_sanctioned: boolean\r\n  created_at: string\r\n  primary_rm_profile: {\r\n    id: string\r\n    display_name: string\r\n    email: string\r\n  } | null\r\n  investor_users: Array<{\r\n    user_id: string\r\n    profiles: {\r\n      id: string\r\n      display_name: string\r\n      email: string\r\n      title: string\r\n      role: string\r\n    } | null\r\n  }>\r\n}\r\n\r\ntype CapitalMetrics = {\r\n  total_commitment: number\r\n  total_contributed: number\r\n  total_distributed: number\r\n  unfunded_commitment: number\r\n  current_nav: number\r\n  vehicle_count: number\r\n}\r\n\r\n// Disable caching to ensure fresh data on every visit\r\nexport const revalidate = 0\r\n\r\nexport default async function InvestorDetailPage({\r\n  params\r\n}: {\r\n  params: Promise<{ id: string }>\r\n}) {\r\n  const { id } = await params\r\n\r\n  await requireStaffAuth()\r\n  const supabase = await createClient()\r\n\r\n  // Fetch investor details\r\n  const { data: investor, error } = await supabase\r\n    .from('investors')\r\n    .select(`\r\n      *,\r\n      primary_rm_profile:profiles!investors_primary_rm_fkey (\r\n        id,\r\n        display_name,\r\n        email\r\n      ),\r\n      investor_users (\r\n        user_id,\r\n        profiles:profiles!investor_users_user_id_fkey (\r\n          id,\r\n          display_name,\r\n          email,\r\n          title,\r\n          role\r\n        )\r\n      )\r\n    `)\r\n    .eq('id', id)\r\n    .single()\r\n\r\n  if (error || !investor) {\r\n    console.error('[Investor Detail] Error:', error)\r\n    notFound()\r\n  }\r\n\r\n  // Fetch capital metrics\r\n  let capitalMetrics: CapitalMetrics = {\n    total_commitment: 0,\n    total_contributed: 0,\n    total_distributed: 0,\n    unfunded_commitment: 0,\n    current_nav: 0,\n    vehicle_count: 0\n  }\n  let metricsAvailable = false\n\n  try {\n    const { data: metricsData, error: metricsError } = await supabase\n      .rpc('get_investor_capital_summary', {\n        p_investor_ids: [id]\n      })\r\n\r\n    if (metricsError) {\n      console.error('[Investor Detail] Capital metrics error:', metricsError)\n    } else if (metricsData && metricsData.length > 0) {\n      const metrics = metricsData[0]\n      metricsAvailable = true\n      capitalMetrics = {\n        total_commitment: Number(metrics.total_commitment) || 0,\n        total_contributed: Number(metrics.total_contributed) || 0,\n        total_distributed: Number(metrics.total_distributed) || 0,\n        unfunded_commitment: Number(metrics.unfunded_commitment) || 0,\n        current_nav: Number(metrics.current_nav) || 0,\n        vehicle_count: Number(metrics.vehicle_count) || 0\n      }\r\n    }\r\n  } catch (err) {\r\n    console.error('[Investor Detail] Capital metrics exception:', err)\r\n  }\r\n\r\n  const investorData = investor as unknown as InvestorDetail\r\n\r\n  return (\n    <InvestorDetailClient\n      investor={investorData}\n      capitalMetrics={capitalMetrics}\n      metricsAvailable={metricsAvailable}\n    />\n  )\n}\n"],"names":[],"mappings":"wcAEO,IAAM,EAAuB,CAAA,EAAA,AADpC,EAAA,CAAA,CAAA,QACoC,uBAAA,AAAuB,EACvD,WAAa,MAAM,AAAI,MAAM,sPAAwP,EACrR,qGACA,qFAHG,IAAM,EAAuB,CAAA,EADpC,AACoC,EADpC,CAAA,CAAA,QACoC,uBAAuB,AAAvB,EAChC,WAAa,MAAM,AAAI,MAAM,sPAAwP,EACrR,iFACA,iICLJ,EAAA,EAAA,CAAA,CAAA,QACA,EAAA,EAAA,CAAA,CAAA,QACA,EAAA,CAAA,CAAA,QAAA,IAAA,EAAA,EAAA,CAAA,CAAA,QACA,EAAA,EAAA,CAAA,CAAA,QAkDe,eAAe,EAAmB,QAC/C,CAAM,CAGP,EACC,GAAM,IAAE,CAAE,CAAE,CAAG,MAAM,CAErB,OAAM,CAAA,EAAA,EAAA,gBAAA,AAAgB,IACtB,IAAM,EAAW,MAAM,CAAA,EAAA,EAAA,YAAA,AAAY,IAG7B,CAAE,KAAM,CAAQ,OAAE,CAAK,CAAE,CAAG,MAAM,EACrC,IAAI,CAAC,aACL,MAAM,CAAC,CAAC;;;;;;;;;;;;;;;;;IAiBT,CAAC,EACA,EAAE,CAAC,KAAM,GACT,MAAM,IAEL,GAAS,CAAC,CAAA,GAAU,CACtB,QAAQ,KAAK,CAAC,2BAA4B,GAC1C,CAAA,EAAA,EAAA,QAAA,AAAQ,KAIV,IAAI,EAAiC,CACnC,iBAAkB,EAClB,kBAAmB,EACnB,kBAAmB,EACnB,oBAAqB,EACrB,YAAa,EACb,cAAe,CACjB,EACI,GAAmB,EAEvB,GAAI,CACF,GAAM,CAAE,KAAM,CAAW,CAAE,MAAO,CAAY,CAAE,CAAG,MAAM,EACtD,GAAG,CAAC,+BAAgC,CACnC,eAAgB,CAAC,EAAG,AACtB,GAEF,GAAI,EACF,QAAQ,IADQ,CACH,CAAC,2CAA4C,QACrD,GAAI,GAAe,EAAY,MAAM,CAAG,EAAG,CAChD,IAAM,EAAU,CAAW,CAAC,EAAE,CAC9B,EAAmB,GACnB,EAAiB,CACf,iBAAkB,OAAO,EAAQ,gBAAgB,GAAK,EACtD,kBAAmB,OAAO,EAAQ,iBAAiB,GAAK,EACxD,kBAAmB,OAAO,EAAQ,iBAAiB,GAAK,EACxD,oBAAqB,OAAO,EAAQ,mBAAmB,GAAK,EAC5D,YAAa,OAAO,EAAQ,WAAW,GAAK,EAC5C,cAAe,OAAO,EAAQ,aAAa,GAAK,CAClD,CACF,CACF,CAAE,MAAO,EAAK,CACZ,QAAQ,KAAK,CAAC,+CAAgD,EAChE,CAIA,MACE,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,oBAAoB,CAAA,CACnB,SAJiB,CAIP,CACV,eAAgB,EAChB,iBAAkB,GAGxB,kCAnIuB,+BA8CG","ignoreList":[0]}