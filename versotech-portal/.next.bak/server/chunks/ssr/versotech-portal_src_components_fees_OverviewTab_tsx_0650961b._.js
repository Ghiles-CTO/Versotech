module.exports=[876040,267522,813503,822020,291556,a=>{"use strict";var b=a.i(352584),c=a.i(611038),d=a.i(289633),e=a.i(284169),f=a.i(155508),g=a.i(816854),h=a.i(877918),i=a.i(966494),j=a.i(478870),k=a.i(92881),l=a.i(13289),m=a.i(871057),n=a.i(618287),o=a.i(50828),p=a.i(421908);function q(a,b="USD"){return new Intl.NumberFormat("en-US",{style:"currency",currency:b,minimumFractionDigits:2,maximumFractionDigits:2}).format(a)}function r(a){return`${(a/1e4*100).toFixed(2)}%`}function s(){let a=(0,d.useRouter)(),[r,s]=(0,c.useState)(null),[t,u]=(0,c.useState)(null),[v,w]=(0,c.useState)(!0),[x,y]=(0,c.useState)(!0);(0,c.useEffect)(()=>{z()},[]);let z=async()=>{try{let[a,b]=await Promise.all([fetch("/api/staff/fees/dashboard"),fetch("/api/staff/fees/projected")]),[c,d]=await Promise.all([a.json(),b.json()]);s(c.data),u(d.data)}catch(a){console.error("Error fetching overview data:",a)}finally{w(!1),y(!1)}};return v?(0,b.jsx)("div",{className:"text-white",children:"Loading..."}):r?(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[(0,b.jsxs)(e.Card,{children:[(0,b.jsxs)(e.CardHeader,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,b.jsx)(e.CardTitle,{className:"text-sm font-medium",children:"Total Fees (YTD)"}),(0,b.jsx)(f.DollarSign,{className:"h-4 w-4 text-muted-foreground"})]}),(0,b.jsxs)(e.CardContent,{children:[(0,b.jsx)("div",{className:"text-2xl font-bold text-white",children:q(r.total_fees_ytd)}),(0,b.jsxs)("p",{className:"text-xs text-gray-400",children:["MTD: ",q(r.total_fees_mtd)]})]})]}),(0,b.jsxs)(e.Card,{className:"cursor-pointer hover:bg-accent/50 transition-colors",onClick:()=>a.push("/versotech_main/reconciliation"),children:[(0,b.jsxs)(e.CardHeader,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,b.jsx)(e.CardTitle,{className:"text-sm font-medium",children:"Outstanding Invoices"}),(0,b.jsx)(g.FileText,{className:"h-4 w-4 text-muted-foreground"})]}),(0,b.jsxs)(e.CardContent,{children:[(0,b.jsx)("div",{className:"text-2xl font-bold text-white",children:q(r.outstanding_invoices_amount)}),(0,b.jsxs)("div",{className:"flex items-center justify-between mt-1",children:[(0,b.jsxs)("p",{className:"text-xs text-gray-400",children:[r.outstanding_invoices_count," invoices"]}),(0,b.jsxs)("span",{className:"text-xs text-blue-400 flex items-center gap-1",children:["View Invoices ",(0,b.jsx)(o.ArrowRight,{className:"h-3 w-3"})]})]})]})]}),(0,b.jsxs)(e.Card,{children:[(0,b.jsxs)(e.CardHeader,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,b.jsx)(e.CardTitle,{className:"text-sm font-medium",children:"Overdue"}),(0,b.jsx)(h.AlertCircle,{className:"h-4 w-4 text-destructive"})]}),(0,b.jsxs)(e.CardContent,{children:[(0,b.jsx)("div",{className:"text-2xl font-bold text-destructive",children:q(r.overdue_invoices_amount)}),(0,b.jsxs)("p",{className:"text-xs text-gray-400",children:[r.overdue_invoices_count," overdue invoices"]})]})]}),(0,b.jsxs)(e.Card,{children:[(0,b.jsxs)(e.CardHeader,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,b.jsx)(e.CardTitle,{className:"text-sm font-medium",children:"Upcoming Fees (30d)"}),(0,b.jsx)(i.TrendingUp,{className:"h-4 w-4 text-muted-foreground"})]}),(0,b.jsxs)(e.CardContent,{children:[(0,b.jsx)("div",{className:"text-2xl font-bold text-white",children:q(r.upcoming_fees_30days)}),(0,b.jsxs)("p",{className:"text-xs text-gray-400",children:[r.upcoming_fees_count," scheduled fees"]})]})]})]}),r.commission_summary&&(0,b.jsxs)(e.Card,{children:[(0,b.jsxs)(e.CardHeader,{className:"flex flex-row items-start justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsxs)(e.CardTitle,{className:"text-white flex items-center gap-2",children:[(0,b.jsx)(j.Users,{className:"h-5 w-5"}),"Commissions"]}),(0,b.jsx)("p",{className:"text-sm text-gray-400 mt-1",children:"Commission expenses across all entity types (Introducers, Partners, Commercial Partners)"})]}),(0,b.jsxs)(p.Button,{variant:"outline",size:"sm",onClick:()=>a.push("/versotech_main/arranger-reconciliation"),className:"border-gray-600 hover:bg-gray-800",children:["View Reconciliation",(0,b.jsx)(o.ArrowRight,{className:"ml-2 h-4 w-4"})]})]}),(0,b.jsx)(e.CardContent,{children:(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"grid gap-4 md:grid-cols-3",children:[(0,b.jsxs)("div",{className:"p-4 bg-red-900/20 rounded border border-red-700",children:[(0,b.jsx)("p",{className:"text-xs text-red-300 mb-1",children:"Total Commissions Owed"}),(0,b.jsx)("p",{className:"text-2xl font-bold text-white",children:q(r.commission_summary.total_owed)}),(0,b.jsx)("p",{className:"text-xs text-gray-400 mt-1",children:"Accrued + Invoiced"})]}),(0,b.jsxs)("div",{className:"p-4 bg-green-900/20 rounded border border-green-700",children:[(0,b.jsx)("p",{className:"text-xs text-green-300 mb-1",children:"Total Paid YTD"}),(0,b.jsx)("p",{className:"text-2xl font-bold text-white",children:q(r.commission_summary.total_paid_ytd)}),(0,b.jsx)("p",{className:"text-xs text-gray-400 mt-1",children:"Commissions paid this year"})]}),(0,b.jsxs)("div",{className:"p-4 bg-amber-900/20 rounded border border-amber-700",children:[(0,b.jsx)("p",{className:"text-xs text-amber-300 mb-1",children:"Pending Invoice"}),(0,b.jsx)("p",{className:"text-2xl font-bold text-white",children:q(r.commission_summary.total_accrued)}),(0,b.jsx)("p",{className:"text-xs text-gray-400 mt-1",children:"Accrued, awaiting invoice"})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h4",{className:"text-sm font-semibold mb-3 text-gray-300",children:"Breakdown by Entity Type"}),(0,b.jsxs)("div",{className:"grid gap-3 md:grid-cols-3",children:[(0,b.jsxs)("button",{onClick:()=>a.push("/versotech_main/arranger-reconciliation?tab=introducers"),className:"p-3 bg-gray-900 rounded border border-gray-700 flex items-start gap-3 hover:bg-gray-800 hover:border-blue-600 transition-colors cursor-pointer text-left",children:[(0,b.jsx)(k.UserCheck,{className:"h-5 w-5 text-blue-400 mt-0.5"}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("p",{className:"text-sm font-medium text-white",children:"Introducers"}),(0,b.jsx)(n.ExternalLink,{className:"h-3.5 w-3.5 text-gray-500"})]}),(0,b.jsxs)("div",{className:"mt-2 space-y-1 text-sm",children:[(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{className:"text-gray-400",children:"Owed:"}),(0,b.jsx)("span",{className:"text-white font-medium",children:q(r.commission_summary.by_entity_type.introducer.owed)})]}),(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{className:"text-gray-400",children:"Paid YTD:"}),(0,b.jsx)("span",{className:"text-green-400 font-medium",children:q(r.commission_summary.by_entity_type.introducer.paid)})]})]})]})]}),(0,b.jsxs)("button",{onClick:()=>a.push("/versotech_main/arranger-reconciliation?tab=partners"),className:"p-3 bg-gray-900 rounded border border-gray-700 flex items-start gap-3 hover:bg-gray-800 hover:border-green-600 transition-colors cursor-pointer text-left",children:[(0,b.jsx)(l.Handshake,{className:"h-5 w-5 text-green-400 mt-0.5"}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("p",{className:"text-sm font-medium text-white",children:"Partners"}),(0,b.jsx)(n.ExternalLink,{className:"h-3.5 w-3.5 text-gray-500"})]}),(0,b.jsxs)("div",{className:"mt-2 space-y-1 text-sm",children:[(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{className:"text-gray-400",children:"Owed:"}),(0,b.jsx)("span",{className:"text-white font-medium",children:q(r.commission_summary.by_entity_type.partner.owed)})]}),(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{className:"text-gray-400",children:"Paid YTD:"}),(0,b.jsx)("span",{className:"text-green-400 font-medium",children:q(r.commission_summary.by_entity_type.partner.paid)})]})]})]})]}),(0,b.jsxs)("button",{onClick:()=>a.push("/versotech_main/arranger-reconciliation?tab=commercialPartners"),className:"p-3 bg-gray-900 rounded border border-gray-700 flex items-start gap-3 hover:bg-gray-800 hover:border-purple-600 transition-colors cursor-pointer text-left",children:[(0,b.jsx)(m.Briefcase,{className:"h-5 w-5 text-purple-400 mt-0.5"}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("p",{className:"text-sm font-medium text-white",children:"Commercial Partners"}),(0,b.jsx)(n.ExternalLink,{className:"h-3.5 w-3.5 text-gray-500"})]}),(0,b.jsxs)("div",{className:"mt-2 space-y-1 text-sm",children:[(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{className:"text-gray-400",children:"Owed:"}),(0,b.jsx)("span",{className:"text-white font-medium",children:q(r.commission_summary.by_entity_type.commercial_partner.owed)})]}),(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{className:"text-gray-400",children:"Paid YTD:"}),(0,b.jsx)("span",{className:"text-green-400 font-medium",children:q(r.commission_summary.by_entity_type.commercial_partner.paid)})]})]})]})]})]})]})]})})]}),(0,b.jsxs)(e.Card,{children:[(0,b.jsxs)(e.CardHeader,{children:[(0,b.jsx)(e.CardTitle,{className:"text-white",children:"Complete Fee Analysis"}),(0,b.jsx)("p",{className:"text-sm text-gray-400",children:"All subscription fees broken down by type, vehicle, and status"})]}),(0,b.jsx)(e.CardContent,{children:x?(0,b.jsx)("p",{className:"text-sm text-gray-400",children:"Loading..."}):t?(0,b.jsxs)("div",{className:"space-y-8",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h4",{className:"text-lg font-semibold mb-4 text-white",children:"Total Fees by Type"}),(0,b.jsxs)("div",{className:"grid gap-4 md:grid-cols-3 lg:grid-cols-7",children:[(0,b.jsxs)("div",{className:"p-4 bg-blue-900/20 rounded border border-blue-700",children:[(0,b.jsx)("p",{className:"text-xs text-blue-300 mb-1",children:"Subscription Fees"}),(0,b.jsx)("p",{className:"text-xl font-bold text-white",children:q(t.totals.subscription_fees)})]}),(0,b.jsxs)("div",{className:"p-4 bg-green-900/20 rounded border border-green-700",children:[(0,b.jsx)("p",{className:"text-xs text-green-300 mb-1",children:"Spread Fees"}),(0,b.jsx)("p",{className:"text-xl font-bold text-white",children:q(t.totals.spread_fees)})]}),(0,b.jsxs)("div",{className:"p-4 bg-purple-900/20 rounded border border-purple-700",children:[(0,b.jsx)("p",{className:"text-xs text-purple-300 mb-1",children:"BD Fees"}),(0,b.jsx)("p",{className:"text-xl font-bold text-white",children:q(t.totals.bd_fees)})]}),(0,b.jsxs)("div",{className:"p-4 bg-orange-900/20 rounded border border-orange-700",children:[(0,b.jsx)("p",{className:"text-xs text-orange-300 mb-1",children:"FINRA Fees"}),(0,b.jsx)("p",{className:"text-xl font-bold text-white",children:q(t.totals.finra_fees)})]}),(0,b.jsxs)("div",{className:"p-4 bg-pink-900/20 rounded border border-pink-700",children:[(0,b.jsx)("p",{className:"text-xs text-pink-300 mb-1",children:"Performance Fees"}),(0,b.jsx)("p",{className:"text-xl font-bold text-white",children:q(t.totals.performance_fees)})]}),(0,b.jsxs)("div",{className:"p-4 bg-cyan-900/20 rounded border border-cyan-700",children:[(0,b.jsx)("p",{className:"text-xs text-cyan-300 mb-1",children:"Management Fees"}),(0,b.jsx)("p",{className:"text-xl font-bold text-white",children:q(t.totals.management_fees)}),(0,b.jsx)("p",{className:"text-xs text-gray-400 mt-1",children:"(Annual)"})]}),(0,b.jsxs)("div",{className:"p-4 bg-gray-800 rounded border border-gray-600",children:[(0,b.jsx)("p",{className:"text-xs text-gray-300 mb-1 font-semibold",children:"TOTAL ALL FEES"}),(0,b.jsx)("p",{className:"text-xl font-bold text-white",children:q(t.totals.total_fees)})]})]}),(0,b.jsx)("div",{className:"mt-4",children:(0,b.jsxs)("div",{className:`p-4 rounded border ${t.totals.unrealized_gains>=0?"bg-emerald-900/20 border-emerald-700":"bg-red-900/20 border-red-700"}`,children:[(0,b.jsx)("p",{className:`text-xs mb-1 ${t.totals.unrealized_gains>=0?"text-emerald-300":"text-red-300"}`,children:"Unrealized Gains/Losses (Cost vs Price per Share)"}),(0,b.jsx)("p",{className:`text-2xl font-bold ${t.totals.unrealized_gains>=0?"text-emerald-400":"text-red-400"}`,children:q(t.totals.unrealized_gains)}),(0,b.jsx)("p",{className:"text-xs text-gray-400 mt-1",children:"(Price per Share - Cost per Share) × Number of Shares"})]})}),(0,b.jsxs)("div",{className:"grid gap-4 md:grid-cols-3 mt-4",children:[(0,b.jsxs)("div",{className:"p-3 bg-gray-900 rounded border border-gray-700",children:[(0,b.jsx)("p",{className:"text-xs text-gray-400",children:"Total Committed Capital"}),(0,b.jsx)("p",{className:"text-lg font-bold text-white",children:q(t.totals.committed_capital)})]}),(0,b.jsxs)("div",{className:"p-3 bg-gray-900 rounded border border-gray-700",children:[(0,b.jsx)("p",{className:"text-xs text-gray-400",children:"Total Current NAV"}),(0,b.jsx)("p",{className:"text-lg font-bold text-white",children:q(t.totals.current_nav)})]}),(0,b.jsxs)("div",{className:"p-3 bg-gray-900 rounded border border-gray-700",children:[(0,b.jsx)("p",{className:"text-xs text-gray-400",children:"Total Subscriptions"}),(0,b.jsx)("p",{className:"text-lg font-bold text-white",children:t.totals.total_subscriptions})]})]})]}),t.by_status.length>0&&(0,b.jsxs)("div",{children:[(0,b.jsx)("h4",{className:"text-lg font-semibold mb-4 text-white",children:"Fees by Subscription Status"}),(0,b.jsx)("div",{className:"grid gap-3 md:grid-cols-2 lg:grid-cols-4",children:t.by_status.map((a,c)=>(0,b.jsxs)("div",{className:"p-4 bg-gray-900 rounded border border-gray-700",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,b.jsx)("span",{className:"text-sm font-bold text-white uppercase",children:a.status}),(0,b.jsxs)("span",{className:"text-xs text-gray-400",children:[a.subscription_count," subs"]})]}),(0,b.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{className:"text-gray-400",children:"Subscription:"}),(0,b.jsx)("span",{className:"text-white font-medium",children:q(a.subscription_fees)})]}),(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{className:"text-gray-400",children:"Spread:"}),(0,b.jsx)("span",{className:"text-white font-medium",children:q(a.spread_fees)})]}),(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{className:"text-gray-400",children:"BD:"}),(0,b.jsx)("span",{className:"text-white font-medium",children:q(a.bd_fees)})]}),(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{className:"text-gray-400",children:"FINRA:"}),(0,b.jsx)("span",{className:"text-white font-medium",children:q(a.finra_fees)})]}),(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{className:"text-gray-400",children:"Performance:"}),(0,b.jsx)("span",{className:"text-white font-medium",children:q(a.performance_fees)})]}),(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{className:"text-cyan-400",children:"Management:"}),(0,b.jsx)("span",{className:"text-white font-medium",children:q(a.management_fees)})]}),(0,b.jsxs)("div",{className:"flex justify-between pt-2 border-t border-gray-700",children:[(0,b.jsx)("span",{className:"text-white font-semibold",children:"Total Fees:"}),(0,b.jsx)("span",{className:"text-white font-bold",children:q(a.total_fees)})]}),(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{className:a.unrealized_gains>=0?"text-emerald-400":"text-red-400",children:"Unrealized Gain:"}),(0,b.jsx)("span",{className:`font-semibold ${a.unrealized_gains>=0?"text-emerald-400":"text-red-400"}`,children:q(a.unrealized_gains)})]})]})]},c))})]}),t.by_vehicle.length>0&&(0,b.jsxs)("div",{children:[(0,b.jsx)("h4",{className:"text-lg font-semibold mb-4 text-white",children:"Fees by Vehicle"}),(0,b.jsx)("div",{className:"space-y-4",children:t.by_vehicle.map((a,c)=>(0,b.jsxs)("div",{className:"p-5 bg-gray-900 rounded border border-gray-700",children:[(0,b.jsxs)("div",{className:"flex items-start justify-between mb-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h5",{className:"text-xl font-bold text-white mb-1",children:a.vehicle_name}),(0,b.jsxs)("p",{className:"text-sm text-gray-400",children:[a.subscription_count," subscription",1!==a.subscription_count?"s":""," • Capital: ",q(a.committed_capital)," • NAV: ",q(a.current_nav)]})]}),(0,b.jsxs)("div",{className:"text-right",children:[(0,b.jsx)("p",{className:"text-2xl font-bold text-white",children:q(a.fees.total_fees)}),(0,b.jsx)("p",{className:"text-xs text-gray-400",children:"total fees"})]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-6 gap-3 mb-4",children:[(0,b.jsxs)("div",{className:"p-2 bg-blue-900/10 rounded",children:[(0,b.jsx)("p",{className:"text-xs text-blue-300",children:"Subscription"}),(0,b.jsx)("p",{className:"text-sm font-bold text-white",children:q(a.fees.subscription_fees)})]}),(0,b.jsxs)("div",{className:"p-2 bg-green-900/10 rounded",children:[(0,b.jsx)("p",{className:"text-xs text-green-300",children:"Spread"}),(0,b.jsx)("p",{className:"text-sm font-bold text-white",children:q(a.fees.spread_fees)})]}),(0,b.jsxs)("div",{className:"p-2 bg-purple-900/10 rounded",children:[(0,b.jsx)("p",{className:"text-xs text-purple-300",children:"BD"}),(0,b.jsx)("p",{className:"text-sm font-bold text-white",children:q(a.fees.bd_fees)})]}),(0,b.jsxs)("div",{className:"p-2 bg-orange-900/10 rounded",children:[(0,b.jsx)("p",{className:"text-xs text-orange-300",children:"FINRA"}),(0,b.jsx)("p",{className:"text-sm font-bold text-white",children:q(a.fees.finra_fees)})]}),(0,b.jsxs)("div",{className:"p-2 bg-pink-900/10 rounded",children:[(0,b.jsx)("p",{className:"text-xs text-pink-300",children:"Performance"}),(0,b.jsx)("p",{className:"text-sm font-bold text-white",children:q(a.fees.performance_fees)})]}),(0,b.jsxs)("div",{className:"p-2 bg-cyan-900/10 rounded",children:[(0,b.jsx)("p",{className:"text-xs text-cyan-300",children:"Management"}),(0,b.jsx)("p",{className:"text-sm font-bold text-white",children:q(a.fees.management_fees)})]})]}),(0,b.jsx)("div",{className:`p-3 rounded mb-4 ${a.fees.unrealized_gains>=0?"bg-emerald-900/10 border border-emerald-700":"bg-red-900/10 border border-red-700"}`,children:(0,b.jsxs)("div",{className:"flex justify-between items-center",children:[(0,b.jsx)("span",{className:`text-sm ${a.fees.unrealized_gains>=0?"text-emerald-300":"text-red-300"}`,children:"Unrealized Gains/Losses"}),(0,b.jsx)("span",{className:`text-lg font-bold ${a.fees.unrealized_gains>=0?"text-emerald-400":"text-red-400"}`,children:q(a.fees.unrealized_gains)})]})}),a.by_status.length>0&&(0,b.jsxs)("div",{className:"pt-4 border-t border-gray-800",children:[(0,b.jsx)("p",{className:"text-xs text-gray-500 mb-3 font-semibold",children:"Status Breakdown:"}),(0,b.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-3",children:a.by_status.map((a,c)=>(0,b.jsxs)("div",{className:"p-3 bg-gray-800 rounded text-sm",children:[(0,b.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,b.jsx)("span",{className:"text-white font-semibold capitalize",children:a.status}),(0,b.jsx)("span",{className:"text-gray-400 text-xs",children:a.subscription_count})]}),(0,b.jsxs)("div",{className:"space-y-1 text-xs",children:[(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{className:"text-gray-400",children:"Sub:"}),(0,b.jsx)("span",{className:"text-white",children:q(a.subscription_fees)})]}),(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{className:"text-cyan-400",children:"Mgmt:"}),(0,b.jsx)("span",{className:"text-white",children:q(a.management_fees)})]}),(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{className:"text-gray-400",children:"Total Fees:"}),(0,b.jsx)("span",{className:"text-white font-semibold",children:q(a.total_fees)})]}),(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{className:a.unrealized_gains>=0?"text-emerald-400":"text-red-400",children:"Unrealized:"}),(0,b.jsx)("span",{className:`font-semibold ${a.unrealized_gains>=0?"text-emerald-400":"text-red-400"}`,children:q(a.unrealized_gains)})]})]})]},c))})]})]},c))})]})]}):(0,b.jsx)("p",{className:"text-sm text-gray-400",children:"No data available"})})]})]}):(0,b.jsx)("div",{className:"text-white",children:"Failed to load dashboard data"})}a.s(["default",()=>s],876040);var t=a.i(951870),u=a.i(15788),v=a.i(771088),w=a.i(479612),x=a.i(405708),y=a.i(405398),z=a.i(919014),A=a.i(278541),B=a.i(134303),C=a.i(675167),D=a.i(838086),E=a.i(168118),F=a.i(672606),G=a.i(441278),H=a.i(42329),I=a.i(625473),J=a.i(873785),K=a.i(203297),L=a.i(3321),M=a.i(264890),N=a.i(425622),O=a.i(899750),P=a.i(926076),Q=a.i(910187),R=a.i(283732);let S={subscription:"subscription_fee_percent",management:"management_fee_percent",performance:"carried_interest_percent",carried_interest:"carried_interest_percent"};function T(a,b){if(!b||!a.rate_bps)return{isValid:!0};let c=S[a.kind];if(!c)return{isValid:!0};let d=b[c];return null==d?{isValid:!0}:a.rate_bps/100>d?{isValid:!1,message:`Exceeds term sheet limit (${d}%)`,termSheetLimit:d}:{isValid:!0,termSheetLimit:d}}function U(a){switch(a||"draft"){case"accepted":return(0,b.jsxs)(u.Badge,{className:"bg-green-500/20 text-green-400 border-green-500/30",children:[(0,b.jsx)(G.CheckCircle,{className:"h-3 w-3 mr-1"}),"Accepted"]});case"sent":return(0,b.jsxs)(u.Badge,{className:"bg-blue-500/20 text-blue-400 border-blue-500/30",children:[(0,b.jsx)(J.Send,{className:"h-3 w-3 mr-1"}),"Sent"]});case"pending_signature":return(0,b.jsxs)(u.Badge,{className:"bg-amber-500/20 text-amber-400 border-amber-500/30",children:[(0,b.jsx)(H.Clock,{className:"h-3 w-3 mr-1"}),"Pending Signature"]});case"rejected":return(0,b.jsxs)(u.Badge,{className:"bg-red-500/20 text-red-400 border-red-500/30",children:[(0,b.jsx)(I.XCircle,{className:"h-3 w-3 mr-1"}),"Rejected"]});default:return(0,b.jsx)(u.Badge,{variant:"outline",className:"border-gray-500/30 text-gray-400",children:"Draft"})}}let V={introducers:{label:"Introducers",icon:j.Users,iconColor:"text-blue-400"},partners:{label:"Partners",icon:m.Briefcase,iconColor:"text-purple-400"},commercial_partners:{label:"Commercial Partners",icon:A.Building2,iconColor:"text-green-400"}};function W({}){let a=(0,d.useRouter)(),f=(0,d.useSearchParams)(),[h,i]=(0,c.useState)([]),[j,k]=(0,c.useState)(!0),l=f.get("deal_id")||void 0,[m,n]=(0,c.useState)([]),[o,q]=(0,c.useState)(!0),[s,G]=(0,c.useState)("table"),[H,I]=(0,c.useState)(!1),[J,S]=(0,c.useState)(null),[W,X]=(0,c.useState)(!1),[Y,Z]=(0,c.useState)(null),[$,_]=(0,c.useState)(!1),[aa,ab]=(0,c.useState)(null),[ac,ad]=(0,c.useState)({introducers:!0,partners:!0,commercial_partners:!0}),[ae,af]=(0,c.useState)(null),[ag,ah]=(0,c.useState)(null),ai=(0,c.useCallback)(async()=>{try{let a=await fetch("/api/deals"),b=await a.json();i(b.deals||[])}catch(a){console.error("Error fetching deals:",a)}finally{k(!1)}},[]),aj=b=>{let c=new URLSearchParams(f.toString());"none"===b?c.delete("deal_id"):c.set("deal_id",b),a.push(`/versotech_main/fees?${c.toString()}`)};(0,c.useEffect)(()=>{ai()},[ai]),(0,c.useEffect)(()=>{ak()},[l]);let ak=async()=>{q(!0);try{let a=l?`/api/staff/fees/plans?include_components=true&deal_id=${l}`:"/api/staff/fees/plans?include_components=true",[b,c]=await Promise.all([fetch(a),fetch("/api/deals")]),[d,e]=await Promise.all([b.json(),c.json()]),f=d.data||[],g=e.deals||[],h=new Map(g.map(a=>[a.id,a]));l&&(f=f.filter(a=>a.deal_id===l));let i=f.map(a=>({...a,deal:a.deal_id?h.get(a.deal_id):void 0}));n(i)}catch(a){console.error("Error fetching fee plans:",a)}finally{q(!1)}},al=a=>{ab(a),_(!0)},am=async()=>{if(aa)try{let a=await fetch(`/api/staff/fees/plans/${aa.id}/duplicate`,{method:"POST"});if(a.ok){let{data:b}=await a.json();await ak(),_(!1),ab(null),b&&(S(b),I(!0))}}catch(a){console.error("Error duplicating plan:",a)}},an=()=>{S(null),I(!0)},ao=a=>{S(a),I(!0)},ap=()=>{I(!1),S(null)},aq=a=>{Z(a),X(!0)},ar=async()=>{if(Y)try{(await fetch(`/api/staff/fees/plans/${Y.id}`,{method:"DELETE"})).ok&&(ak(),X(!1),Z(null))}catch(a){console.error("Error deleting plan:",a)}},as=a=>!!a.introducer&&!!a.generated_agreement_id||!!a.partner&&!!a.generated_placement_agreement_id,at=a=>!!a.introducer&&!a.generated_agreement_id||!!a.partner&&!a.generated_placement_agreement_id,au=a=>a.introducer?"Generate Introducer Agreement":a.partner?"Generate Placement Agreement":"",av=async a=>{if(a.introducer){af(a.id);try{let b=await fetch(`/api/staff/fees/plans/${a.id}/generate-agreement`,{method:"POST"});if(!b.ok){let a=await b.json();O.toast.error(`Failed to generate agreement: ${a.error||"Unknown error"}`);return}O.toast.success("Introducer Agreement generated successfully!"),ak()}catch(a){console.error("Error generating introducer agreement:",a),O.toast.error("Failed to generate agreement")}finally{af(null)}}},aw=async a=>{if(a.partner){af(a.id);try{let b=await fetch(`/api/staff/fees/plans/${a.id}/generate-placement-agreement`,{method:"POST"});if(!b.ok){let a=await b.json();O.toast.error(`Failed to generate placement agreement: ${a.error||"Unknown error"}`);return}O.toast.success("Placement Agreement generated successfully!"),ak()}catch(a){console.error("Error generating placement agreement:",a),O.toast.error("Failed to generate placement agreement")}finally{af(null)}}},ax=async a=>{a.introducer?await av(a):a.partner&&await aw(a)},ay=a=>a.introducer_agreement?.pdf_url?{pdfUrl:a.introducer_agreement.pdf_url,referenceNumber:a.introducer_agreement.reference_number}:a.placement_agreement?.pdf_url?{pdfUrl:a.placement_agreement.pdf_url,referenceNumber:a.placement_agreement.reference_number}:{pdfUrl:null,referenceNumber:null},az=async(a,b)=>{ah(a);try{let c=await fetch(`/api/storage/download?path=${encodeURIComponent(a)}&bucket=deal-documents`);if(!c.ok)throw Error("Failed to download file");let d=await c.blob(),e=window.URL.createObjectURL(d),f=document.createElement("a");f.href=e,f.download=a.split("/").pop()||`${b||"agreement"}.pdf`,document.body.appendChild(f),f.click(),document.body.removeChild(f),window.URL.revokeObjectURL(e),O.toast.success("PDF downloaded successfully")}catch(a){console.error("Error downloading PDF:",a),O.toast.error("Failed to download PDF")}finally{ah(null)}},aA=async a=>{try{let b=await fetch(`/api/storage/download?path=${encodeURIComponent(a)}&bucket=deal-documents`);if(!b.ok)throw Error("Failed to load file");let c=await b.blob(),d=window.URL.createObjectURL(c);window.open(d,"_blank")}catch(a){console.error("Error previewing PDF:",a),O.toast.error("Failed to preview PDF")}},aB=function(a){let b={introducers:[],partners:[],commercial_partners:[]};for(let c of a)c.introducer?b.introducers.push(c):c.partner?b.partners.push(c):c.commercial_partner&&b.commercial_partners.push(c);return b}(m);if(o)return(0,b.jsx)("div",{className:"text-white",children:"Loading fee plans..."});let aC=h.find(a=>a.id===l),aD=()=>(0,b.jsxs)("div",{className:"flex items-center gap-4",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(A.Building2,{className:"h-5 w-5 text-muted-foreground"}),(0,b.jsx)("span",{className:"text-sm font-medium",children:"Deal:"})]}),(0,b.jsxs)(t.Select,{value:l||"none",onValueChange:aj,disabled:j,children:[(0,b.jsx)(t.SelectTrigger,{className:"w-[350px]",children:j?(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(L.Loader2,{className:"h-4 w-4 animate-spin"}),(0,b.jsx)("span",{children:"Loading deals..."})]}):(0,b.jsx)(t.SelectValue,{placeholder:"Select a deal to view fee plans"})}),(0,b.jsxs)(t.SelectContent,{children:[(0,b.jsx)(t.SelectItem,{value:"none",children:(0,b.jsx)("span",{className:"text-muted-foreground",children:"Select a deal to view fee plans"})}),h.map(a=>(0,b.jsx)(t.SelectItem,{value:a.id,children:(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("span",{children:a.name}),(0,b.jsxs)("span",{className:"text-xs text-muted-foreground capitalize",children:["(",a.status,")"]})]})},a.id))]})]}),aC&&(0,b.jsxs)("span",{className:"text-sm text-muted-foreground",children:["Viewing fee plans for: ",(0,b.jsx)("strong",{children:aC.name})]})]});return l?(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h2",{className:"text-2xl font-bold text-white",children:"Fee Plans"}),(0,b.jsx)("p",{className:"text-gray-400",children:"Manage fee structure templates for this deal"})]}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)(p.Button,{variant:"outline",onClick:()=>G("table"===s?"cards":"table"),children:"table"===s?"Card View":"Table View"}),(0,b.jsxs)(p.Button,{onClick:an,children:[(0,b.jsx)(x.Plus,{className:"mr-2 h-4 w-4"}),"Create Fee Plan"]})]})]}),(0,b.jsx)(aD,{}),(0,b.jsx)(e.Card,{className:"bg-blue-500/10 border-blue-500/30",children:(0,b.jsx)(e.CardContent,{className:"pt-6",children:(0,b.jsxs)("p",{className:"text-sm text-gray-300 leading-relaxed",children:[(0,b.jsx)("strong",{className:"text-blue-400",children:"How Fee Plans Work:"})," Fee plans are commercial agreements with introducers/partners. Each fee plan must be linked to a ",(0,b.jsx)("strong",{children:"published term sheet"})," and an ",(0,b.jsx)("strong",{children:"entity"})," (introducer, partner, or commercial partner). Fee values cannot exceed the limits set in the term sheet. When an entity accepts a fee plan, investors can be dispatched through them."]})})}),0===m.length?(0,b.jsx)(e.Card,{children:(0,b.jsxs)(e.CardContent,{className:"py-10 text-center",children:[(0,b.jsx)("p",{className:"text-gray-400 mb-4",children:"No fee plans created yet"}),(0,b.jsxs)(p.Button,{onClick:an,children:[(0,b.jsx)(x.Plus,{className:"mr-2 h-4 w-4"}),"Create Your First Fee Plan"]})]})}):(0,b.jsx)("div",{className:"space-y-4",children:Object.entries(V).map(([a,c])=>{let d=c.icon,f=aB[a],h=ac[a];return(0,b.jsx)(P.Collapsible,{open:h,onOpenChange:()=>{ad(b=>({...b,[a]:!b[a]}))},children:(0,b.jsxs)(e.Card,{children:[(0,b.jsx)(P.CollapsibleTrigger,{asChild:!0,children:(0,b.jsx)(e.CardHeader,{className:"cursor-pointer hover:bg-white/5 transition-colors",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)(d,{className:`h-5 w-5 ${c.iconColor}`}),(0,b.jsxs)(e.CardTitle,{className:"text-lg",children:[c.label," (",f.length,")"]})]}),h?(0,b.jsx)(E.ChevronDown,{className:"h-5 w-5 text-muted-foreground"}):(0,b.jsx)(F.ChevronRight,{className:"h-5 w-5 text-muted-foreground"})]})})}),(0,b.jsx)(P.CollapsibleContent,{children:(0,b.jsx)(e.CardContent,{className:"pt-0",children:0===f.length?(0,b.jsx)("div",{className:"py-6 text-center text-muted-foreground",children:"No fee plans"}):"table"===s?(0,b.jsxs)(v.Table,{children:[(0,b.jsx)(v.TableHeader,{children:(0,b.jsxs)(v.TableRow,{children:[(0,b.jsx)(v.TableHead,{children:"Plan Name"}),(0,b.jsx)(v.TableHead,{children:"Entity"}),(0,b.jsx)(v.TableHead,{children:"Term Sheet"}),(0,b.jsx)(v.TableHead,{children:"Fee Components"}),(0,b.jsx)(v.TableHead,{children:"Status"}),(0,b.jsx)(v.TableHead,{className:"text-right",children:"Actions"})]})}),(0,b.jsx)(v.TableBody,{children:f.map(a=>(0,b.jsxs)(v.TableRow,{children:[(0,b.jsx)(v.TableCell,{children:(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(g.FileText,{className:"h-4 w-4 text-muted-foreground"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"font-medium",children:a.name}),a.description&&(0,b.jsx)("div",{className:"text-sm text-muted-foreground",children:a.description})]})]})}),(0,b.jsx)(v.TableCell,{children:(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(d,{className:`h-4 w-4 ${c.iconColor}`}),(0,b.jsx)("span",{children:a.introducer?.legal_name||a.partner?.name||a.commercial_partner?.name})]})}),(0,b.jsx)(v.TableCell,{children:a.term_sheet?(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(C.FileCheck,{className:"h-3 w-3 text-muted-foreground"}),(0,b.jsxs)("span",{className:"text-sm text-muted-foreground",children:["v",a.term_sheet.version]})]}):(0,b.jsx)("span",{className:"text-sm text-muted-foreground",children:"No term sheet"})}),(0,b.jsx)(v.TableCell,{children:(0,b.jsx)(Q.TooltipProvider,{children:(0,b.jsx)("div",{className:"flex flex-wrap gap-1",children:a.components?.map(c=>{let d=T(c,a.term_sheet);return(0,b.jsxs)(Q.Tooltip,{children:[(0,b.jsx)(Q.TooltipTrigger,{asChild:!0,children:(0,b.jsxs)(u.Badge,{variant:"outline",className:`text-xs ${!d.isValid?"border-red-500/50 bg-red-500/10":""}`,children:[!d.isValid&&(0,b.jsx)(D.AlertTriangle,{className:"h-3 w-3 mr-1 text-red-400"}),c.kind,":"," ",c.rate_bps?r(c.rate_bps):c.flat_amount?`$${c.flat_amount}`:"N/A"]})}),!d.isValid&&(0,b.jsx)(Q.TooltipContent,{className:"bg-red-900 border-red-700",children:(0,b.jsx)("p",{className:"text-red-200",children:d.message})})]},c.id)})})})}),(0,b.jsx)(v.TableCell,{children:(0,b.jsx)("div",{className:"flex flex-wrap gap-1",children:U(a.status)})}),(0,b.jsx)(v.TableCell,{className:"text-right",children:(0,b.jsxs)("div",{className:"flex gap-1 justify-end items-center",children:[at(a)&&(0,b.jsx)(p.Button,{variant:"ghost",size:"sm",onClick:()=>ax(a),disabled:ae===a.id,className:"text-green-400 hover:text-green-300",title:au(a),children:ae===a.id?(0,b.jsx)(L.Loader2,{className:"h-4 w-4 animate-spin"}):(0,b.jsx)(K.FileSignature,{className:"h-4 w-4"})}),as(a)&&(0,b.jsx)(u.Badge,{className:"bg-green-500/20 text-green-400 border-green-500/30 text-xs",children:"Agreement"}),(()=>{let{pdfUrl:c,referenceNumber:d}=ay(a);return c?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(p.Button,{variant:"ghost",size:"sm",onClick:()=>aA(c),className:"text-blue-400 hover:text-blue-300",title:"Preview PDF",children:(0,b.jsx)(M.Eye,{className:"h-4 w-4"})}),(0,b.jsx)(p.Button,{variant:"ghost",size:"sm",onClick:()=>az(c,d),disabled:ag===c,className:"text-green-400 hover:text-green-300",title:"Download PDF",children:ag===c?(0,b.jsx)(L.Loader2,{className:"h-4 w-4 animate-spin"}):(0,b.jsx)(N.Download,{className:"h-4 w-4"})})]}):null})(),(0,b.jsx)(p.Button,{variant:"ghost",size:"sm",onClick:()=>ao(a),children:(0,b.jsx)(y.Edit,{className:"h-4 w-4"})}),(0,b.jsx)(p.Button,{variant:"ghost",size:"sm",onClick:()=>al(a),children:(0,b.jsx)(z.Copy,{className:"h-4 w-4"})}),(0,b.jsx)(p.Button,{variant:"ghost",size:"sm",onClick:()=>aq(a),children:(0,b.jsx)(B.Trash2,{className:"h-4 w-4 text-red-500"})})]})})]},a.id))})]}):(0,b.jsx)("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:f.map(a=>(0,b.jsxs)(e.Card,{className:"bg-white/5 border-white/10",children:[(0,b.jsx)(e.CardHeader,{className:"pb-2",children:(0,b.jsxs)("div",{className:"flex items-start justify-between",children:[(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,b.jsx)(e.CardTitle,{className:"text-lg",children:a.name}),U(a.status)]}),(0,b.jsxs)("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[(0,b.jsx)(d,{className:`h-4 w-4 ${c.iconColor}`}),(0,b.jsx)("span",{children:a.introducer?.legal_name||a.partner?.name||a.commercial_partner?.name})]})]}),(0,b.jsxs)("div",{className:"flex gap-1 items-center",children:[at(a)&&(0,b.jsx)(p.Button,{variant:"ghost",size:"icon",onClick:()=>ax(a),disabled:ae===a.id,className:"text-green-400 hover:text-green-300",title:au(a),children:ae===a.id?(0,b.jsx)(L.Loader2,{className:"h-4 w-4 animate-spin"}):(0,b.jsx)(K.FileSignature,{className:"h-4 w-4"})}),as(a)&&(0,b.jsx)(u.Badge,{className:"bg-green-500/20 text-green-400 border-green-500/30 text-xs",children:"Agreement"}),(0,b.jsx)(p.Button,{variant:"ghost",size:"icon",onClick:()=>ao(a),children:(0,b.jsx)(y.Edit,{className:"h-4 w-4"})}),(0,b.jsx)(p.Button,{variant:"ghost",size:"icon",onClick:()=>al(a),children:(0,b.jsx)(z.Copy,{className:"h-4 w-4"})}),(0,b.jsx)(p.Button,{variant:"ghost",size:"icon",onClick:()=>aq(a),children:(0,b.jsx)(B.Trash2,{className:"h-4 w-4 text-red-500"})})]})]})}),(0,b.jsxs)(e.CardContent,{children:[a.description&&(0,b.jsx)("p",{className:"text-sm text-muted-foreground mb-3",children:a.description}),(0,b.jsx)(Q.TooltipProvider,{children:(0,b.jsx)("div",{className:"space-y-2",children:a.components?.map(c=>{let d=T(c,a.term_sheet);return(0,b.jsxs)("div",{className:`text-sm flex justify-between items-center ${!d.isValid?"text-red-400":""}`,children:[(0,b.jsxs)("span",{className:"capitalize flex items-center gap-1",children:[!d.isValid&&(0,b.jsxs)(Q.Tooltip,{children:[(0,b.jsx)(Q.TooltipTrigger,{children:(0,b.jsx)(D.AlertTriangle,{className:"h-3 w-3 text-red-400"})}),(0,b.jsx)(Q.TooltipContent,{className:"bg-red-900 border-red-700",children:(0,b.jsx)("p",{className:"text-red-200",children:d.message})})]}),c.kind]}),(0,b.jsx)("span",{className:"font-medium",children:c.rate_bps?r(c.rate_bps):c.flat_amount?`$${c.flat_amount}`:"N/A"})]},c.id)})})}),(()=>{let{pdfUrl:c,referenceNumber:d}=ay(a);return c?(0,b.jsx)("div",{className:"mt-4 pt-4 border-t border-white/10",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("div",{className:"p-2 rounded-lg bg-green-500/10",children:(0,b.jsx)(g.FileText,{className:"h-5 w-5 text-green-400"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm font-medium text-foreground",children:a.introducer?"Introducer Agreement":"Placement Agreement"}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:d||"Document ready"})]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsxs)(p.Button,{variant:"outline",size:"sm",onClick:()=>aA(c),className:"text-blue-400 border-blue-400/30 hover:bg-blue-400/10",children:[(0,b.jsx)(M.Eye,{className:"h-4 w-4 mr-1"}),"Preview"]}),(0,b.jsxs)(p.Button,{variant:"outline",size:"sm",onClick:()=>az(c,d),disabled:ag===c,className:"text-green-400 border-green-400/30 hover:bg-green-400/10",children:[ag===c?(0,b.jsx)(L.Loader2,{className:"h-4 w-4 mr-1 animate-spin"}):(0,b.jsx)(N.Download,{className:"h-4 w-4 mr-1"}),"Download"]})]})]})}):null})()]})]},a.id))})})})]})},a)})}),(0,b.jsx)(R.default,{open:H,onClose:ap,onSuccess:()=>{ak(),ap()},feePlan:J}),(0,b.jsx)(w.AlertDialog,{open:$,onOpenChange:_,children:(0,b.jsxs)(w.AlertDialogContent,{children:[(0,b.jsxs)(w.AlertDialogHeader,{children:[(0,b.jsx)(w.AlertDialogTitle,{children:"Duplicate Fee Plan?"}),(0,b.jsx)(w.AlertDialogDescription,{asChild:!0,children:(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsxs)("div",{children:["Create a copy of ",(0,b.jsx)("strong",{children:aa?.name})," with all fee components."]}),(0,b.jsx)("div",{children:"This is useful for:"}),(0,b.jsxs)("ul",{className:"list-disc list-inside space-y-1 ml-2",children:[(0,b.jsx)("li",{children:"Creating a similar plan for a new deal"}),(0,b.jsx)("li",{children:"Testing modifications without affecting the original"}),(0,b.jsx)("li",{children:"Creating variations for special investor terms"})]}),(0,b.jsx)("div",{className:"text-muted-foreground",children:"After duplication, you'll be able to immediately edit the new plan."})]})})]}),(0,b.jsxs)(w.AlertDialogFooter,{children:[(0,b.jsx)(w.AlertDialogCancel,{children:"Cancel"}),(0,b.jsx)(w.AlertDialogAction,{onClick:am,children:"Duplicate & Edit"})]})]})}),(0,b.jsx)(w.AlertDialog,{open:W,onOpenChange:X,children:(0,b.jsxs)(w.AlertDialogContent,{children:[(0,b.jsxs)(w.AlertDialogHeader,{children:[(0,b.jsx)(w.AlertDialogTitle,{children:"Delete Fee Plan?"}),(0,b.jsx)(w.AlertDialogDescription,{asChild:!0,children:(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsxs)("div",{children:["Are you sure you want to delete ",(0,b.jsx)("strong",{children:Y?.name}),"?"]}),Y&&Y.subscription_count&&Y.subscription_count>0?(0,b.jsxs)("div",{className:"text-yellow-500",children:["⚠️ This fee plan is used by ",Y.subscription_count," subscription",1!==Y.subscription_count?"s":"",". Deleting it won't affect those subscriptions, but you won't be able to apply this plan to new deals."]}):(0,b.jsx)("div",{children:"This fee plan is not currently used by any subscriptions."}),Y?.is_default&&(0,b.jsxs)("div",{className:"text-red-500",children:["⚠️ This is the default fee plan for ",Y?.deal?.name||"this deal",". You may want to set another plan as default before deleting this one."]})]})})]}),(0,b.jsxs)(w.AlertDialogFooter,{children:[(0,b.jsx)(w.AlertDialogCancel,{children:"Cancel"}),(0,b.jsx)(w.AlertDialogAction,{onClick:ar,className:"bg-red-500 hover:bg-red-600",children:"Delete"})]})]})})]}):(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsx)("div",{className:"flex items-center justify-between",children:(0,b.jsxs)("div",{children:[(0,b.jsx)("h2",{className:"text-2xl font-bold text-white",children:"Fee Plans"}),(0,b.jsx)("p",{className:"text-gray-400",children:"Manage fee structure templates for a specific deal"})]})}),(0,b.jsx)(aD,{}),(0,b.jsx)(e.Card,{children:(0,b.jsxs)(e.CardContent,{className:"py-10 text-center",children:[(0,b.jsx)(A.Building2,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),(0,b.jsx)("h3",{className:"text-lg font-medium text-foreground mb-2",children:"Select a deal to view fee plans"}),(0,b.jsx)("p",{className:"text-muted-foreground",children:"Use the deal selector above to choose a deal and view its associated fee plans."})]})})]})}a.s(["default",()=>W],267522);var X=a.i(908513),Y=a.i(623157),Z=a.i(470305),$=a.i(663475),_=a.i(249464),aa=a.i(191675),ab=a.i(266828);function ac({open:a,onClose:d,onSuccess:e,preselectedInvestorId:f}){let[g,h]=(0,c.useState)(!1),[i,j]=(0,c.useState)(!1),[k,l]=(0,c.useState)(!1),[m,n]=(0,c.useState)(""),[o,r]=(0,c.useState)(""),[s,v]=(0,c.useState)(""),[w,y]=(0,c.useState)(""),[z,A]=(0,c.useState)(""),[C,D]=(0,c.useState)(new Set),[E,F]=(0,c.useState)([]),[G,H]=(0,c.useState)([]),[I,J]=(0,c.useState)([]),[K,M]=(0,c.useState)([]);(0,c.useEffect)(()=>{a&&f&&(console.log("[GenerateInvoiceModal] Preselected investor ID:",f,"Type:",typeof f),/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(f)?(console.log("[GenerateInvoiceModal] Valid UUID, setting investorId"),n(f)):(console.error("[GenerateInvoiceModal] Invalid investor ID format:",f),alert(`Invalid investor ID format: ${f}`)))},[a,f]);let N=(0,c.useCallback)(async()=>{try{console.log("[GenerateInvoiceModal] Fetching investors...");let a=await fetch("/api/investors?limit=1000"),b=await a.json();console.log("[GenerateInvoiceModal] Investors fetched:",b.data?.length||0),J(b.data||[])}catch(a){console.error("Error fetching investors:",a)}},[]);(0,c.useEffect)(()=>{a&&N()},[a,N]);let O=(0,c.useCallback)(async()=>{if(m){l(!0);try{console.log("[GenerateInvoiceModal] Fetching ALL subscriptions for investor:",m);let a=await fetch(`/api/subscriptions?investor_id=${m}`),b=(await a.json()).data||[];console.log("[GenerateInvoiceModal] All subscriptions fetched:",b.length);let c=await fetch(`/api/staff/fees/events?status=accrued&investor_id=${m}&limit=500`),d=await c.json();if(!c.ok){console.error("[GenerateInvoiceModal] Fee events API error:",d),M([]),l(!1);return}let e=d.data||[];console.log("[GenerateInvoiceModal] Fee events fetched:",e.length),console.log("[GenerateInvoiceModal] Sample fee event:",e[0]);let f=[...new Set(e.map(a=>a.allocation_id).filter(Boolean))];console.log("[GenerateInvoiceModal] Subscription IDs with fee events:",f);let g=b.filter(a=>f.includes(a.id));console.log("[GenerateInvoiceModal] Subscriptions that have fees:",g.length),console.log("[GenerateInvoiceModal] Subscription details:",g),M(g),1===g.length&&(console.log("[GenerateInvoiceModal] Auto-selecting single subscription:",g[0].id),r(g[0].id))}catch(a){console.error("Error fetching subscriptions:",a),M([])}finally{l(!1)}}},[m]),P=(0,c.useCallback)(async()=>{if(!m||!o)return void console.log("[GenerateInvoiceModal] Missing investor or subscription ID, skipping fetch");console.log("[GenerateInvoiceModal] Starting fetchFeeEvents with investorId:",m,"subscriptionId:",o),j(!0);try{let a=new URLSearchParams({status:"accrued",investor_id:m,allocation_id:o,limit:"100",offset:"0"});console.log("[GenerateInvoiceModal] Fetching fee events for investor:",m,"subscription:",o),console.log("[GenerateInvoiceModal] URL params:",a.toString());let b=await fetch(`/api/staff/fees/events?${a}`),c=await b.json();if(console.log("[GenerateInvoiceModal] Fee events response:",c),!b.ok||c.error){console.error("[GenerateInvoiceModal] API error:",c.error||b.statusText),console.error("[GenerateInvoiceModal] Validation details:",JSON.stringify(c.details,null,2));let a=`Failed to load fee events: ${c.error||b.statusText}`;c.details&&Array.isArray(c.details)&&(a+="\n\nValidation errors:",c.details.forEach(b=>{a+=`
- Field: ${b.path?.join(".")}, Error: ${b.message}`})),alert(a),H([]);return}H(c.data||[]),console.log("[GenerateInvoiceModal] Set fee events count:",c.data?.length||0)}catch(a){console.error("Error fetching fee events:",a),alert(`Error loading fee events: ${a instanceof Error?a.message:"Unknown error"}`),H([])}finally{j(!1)}},[m,o]);(0,c.useEffect)(()=>{m?O():(M([]),r(""))},[m,O]),(0,c.useEffect)(()=>{m&&o?P():m&&!o&&H([])},[m,o,P]);let Q=(a,b,c)=>{let d=[...E];d[a]={...d[a],[b]:c},F(d)},R=async()=>{if(console.log("[GenerateInvoiceModal] handleSubmit called"),console.log("[GenerateInvoiceModal] Current state:",{investorId:m,selectedEventIds:Array.from(C),dueDate:w,notes:z,customLineItems:E}),!m||!o||0===C.size||!w)return void alert("Please select an investor, subscription, at least one fee event, and a due date");h(!0);try{let a=w?new Date(w+"T23:59:59").toISOString():"",b={investor_id:m,deal_id:s||void 0,fee_event_ids:Array.from(C),due_date:a,notes:z||void 0,custom_line_items:E.length>0?E:void 0};console.log("[GenerateInvoiceModal] Request body created:",b),console.log("[GenerateInvoiceModal] Sending request to /api/staff/fees/invoices/generate-simple");let c=await fetch("/api/staff/fees/invoices/generate-simple",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(b)});if(!c.ok){let a=await c.json();throw console.error("[GenerateInvoiceModal] Invoice generation failed:",a),console.error("[GenerateInvoiceModal] Request body was:",{investor_id:m,deal_id:s||void 0,fee_event_ids:Array.from(C),due_date:w,notes:z,custom_line_items:E.length>0?E:void 0}),Error(a.error||a.details?JSON.stringify(a.details,null,2):"Failed to generate invoice")}e(),S()}catch(a){console.error("Error generating invoice:",a),alert(a instanceof Error?a.message:"Failed to generate invoice")}finally{h(!1)}},S=()=>{n(""),r(""),v(""),y(""),A(""),D(new Set),F([]),H([]),M([]),d()},T=G.filter(a=>C.has(a.id)).reduce((a,b)=>a+Number(b.computed_amount),0)+E.reduce((a,b)=>a+b.amount*b.quantity,0);return(0,b.jsx)(Z.Dialog,{open:a,onOpenChange:S,children:(0,b.jsxs)(Z.DialogContent,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[(0,b.jsx)(Z.DialogHeader,{children:(0,b.jsx)(Z.DialogTitle,{children:"Generate Invoice"})}),(0,b.jsxs)("div",{className:"space-y-6",children:[f?(0,b.jsxs)("div",{children:[(0,b.jsx)(_.Label,{className:"text-white",children:"Investor"}),(0,b.jsxs)("div",{className:"flex items-center gap-2 p-2 border border-white/20 rounded-md bg-black/20",children:[(0,b.jsx)("span",{className:"text-sm font-medium text-white",children:I.find(a=>a.id===m)?.legal_name||I.find(a=>a.id===m)?.display_name||G[0]?.investor?.legal_name||G[0]?.investor?.display_name||"Loading..."}),(0,b.jsx)(u.Badge,{variant:"outline",className:"ml-auto text-white border-white/20",children:"Pre-selected"})]})]}):(0,b.jsxs)("div",{children:[(0,b.jsx)(_.Label,{htmlFor:"investor",className:"text-white",children:"Investor *"}),(0,b.jsxs)(t.Select,{value:m,onValueChange:n,children:[(0,b.jsx)(t.SelectTrigger,{id:"investor",children:(0,b.jsx)(t.SelectValue,{placeholder:"Select investor"})}),(0,b.jsx)(t.SelectContent,{children:I.map(a=>(0,b.jsx)(t.SelectItem,{value:a.id,children:a.legal_name||a.display_name},a.id))})]})]}),m&&(0,b.jsxs)("div",{children:[(0,b.jsx)(_.Label,{htmlFor:"subscription",className:"text-white",children:"Subscription *"}),k?(0,b.jsxs)("div",{className:"flex items-center justify-center p-2 border border-white/20 rounded-md",children:[(0,b.jsx)(L.Loader2,{className:"h-4 w-4 animate-spin mr-2"}),(0,b.jsx)("span",{className:"text-sm text-muted-foreground",children:"Loading subscriptions..."})]}):0===K.length?(0,b.jsxs)("div",{className:"p-2 border border-red-500/30 rounded-md bg-red-500/10",children:[(0,b.jsx)("p",{className:"text-sm text-red-300 font-medium",children:"No subscriptions with accrued fees found"}),(0,b.jsx)("p",{className:"text-xs text-red-400 mt-1",children:"This investor has no uninvoiced fee events. Fee events may not have been calculated yet, or all fees have already been invoiced."})]}):(0,b.jsxs)(t.Select,{value:o,onValueChange:r,children:[(0,b.jsx)(t.SelectTrigger,{id:"subscription",children:(0,b.jsx)(t.SelectValue,{placeholder:"Select subscription"})}),(0,b.jsx)(t.SelectContent,{children:K.map(a=>(0,b.jsxs)(t.SelectItem,{value:a.id,children:[a.subscription_number," - ",a.vehicle?.name||"Unknown Vehicle","(",q(a.commitment),")"]},a.id))})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(_.Label,{htmlFor:"due_date",className:"text-white",children:"Due Date *"}),(0,b.jsx)($.Input,{id:"due_date",type:"date",value:w,onChange:a=>y(a.target.value)})]}),m&&o&&(0,b.jsxs)("div",{children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,b.jsx)(_.Label,{className:"text-white",children:"Fee Events to Invoice *"}),G.length>0&&(0,b.jsx)(p.Button,{type:"button",variant:"outline",size:"sm",onClick:()=>{C.size===G.length?D(new Set):D(new Set(G.map(a=>a.id)))},children:C.size===G.length?"Deselect All":"Select All"})]}),i?(0,b.jsx)("div",{className:"py-4 text-center text-sm text-muted-foreground",children:"Loading fee events..."}):0===G.length?(0,b.jsx)("div",{className:"py-4 text-center text-sm text-muted-foreground",children:"No accrued fee events found for this investor"}):(0,b.jsx)("div",{className:"mt-2 space-y-2 border border-border rounded-lg p-4 max-h-60 overflow-y-auto",children:G.map(a=>(0,b.jsx)("div",{className:"flex items-center justify-between p-2 hover:bg-accent/10 rounded",children:(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)(ab.Checkbox,{checked:C.has(a.id),onCheckedChange:()=>{var b;let c;return b=a.id,void((c=new Set(C)).has(b)?c.delete(b):c.add(b),D(c))}}),(0,b.jsxs)("div",{children:[(0,b.jsxs)("div",{className:"font-medium text-white",children:[(0,b.jsx)(u.Badge,{variant:"outline",className:"mr-2 text-white border-white/20",children:"flat"===a.fee_type?"Investment":a.fee_type.replace("_"," ")}),(0,b.jsx)("span",{className:"text-white",children:q(a.computed_amount)})]}),(0,b.jsxs)("div",{className:"text-sm text-gray-400",children:[new Date(a.event_date).toLocaleDateString(),a.deal&&` • ${a.deal.name}`]})]})]})},a.id))})]}),(0,b.jsxs)("div",{children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,b.jsx)(_.Label,{className:"text-white",children:"Custom Line Items (Optional)"}),(0,b.jsxs)(p.Button,{type:"button",variant:"outline",size:"sm",onClick:()=>{F([...E,{description:"",amount:0,quantity:1}])},children:[(0,b.jsx)(x.Plus,{className:"mr-2 h-4 w-4"}),"Add Line Item"]})]}),E.map((a,c)=>(0,b.jsxs)("div",{className:"flex gap-2 mb-2",children:[(0,b.jsx)($.Input,{placeholder:"Description",value:a.description,onChange:a=>Q(c,"description",a.target.value),className:"flex-1"}),(0,b.jsx)($.Input,{type:"number",placeholder:"Qty",value:a.quantity,onChange:a=>Q(c,"quantity",parseFloat(a.target.value)),className:"w-20"}),(0,b.jsx)($.Input,{type:"number",placeholder:"Amount",value:a.amount,onChange:a=>Q(c,"amount",parseFloat(a.target.value)),className:"w-32"}),(0,b.jsx)(p.Button,{type:"button",variant:"ghost",size:"icon",onClick:()=>{F(E.filter((a,b)=>b!==c))},children:(0,b.jsx)(B.Trash2,{className:"h-4 w-4"})})]},c))]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(_.Label,{htmlFor:"notes",className:"text-white",children:"Notes (Optional)"}),(0,b.jsx)(aa.Textarea,{id:"notes",value:z,onChange:a=>A(a.target.value),placeholder:"Add any additional notes for the invoice",rows:3})]}),C.size>0&&(0,b.jsxs)("div",{className:"bg-accent p-4 rounded-lg",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between text-lg font-bold",children:[(0,b.jsx)("span",{children:"Total Amount:"}),(0,b.jsx)("span",{children:q(T)})]}),(0,b.jsxs)("div",{className:"text-sm text-muted-foreground mt-1",children:[C.size," fee event(s)",E.length>0&&` + ${E.length} custom item(s)`]})]}),(0,b.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,b.jsx)(p.Button,{variant:"outline",onClick:S,disabled:g,children:"Cancel"}),(0,b.jsxs)(p.Button,{onClick:R,disabled:g||0===C.size,children:[g&&(0,b.jsx)(L.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),"Generate Invoice"]})]})]})]})})}var ad=a.i(181608);let ae={draft:"secondary",sent:"default",paid:"default",partially_paid:"default",overdue:"destructive",cancelled:"secondary",disputed:"destructive"};function af(){let[a,d]=(0,c.useState)([]),[h,i]=(0,c.useState)([]),[j,k]=(0,c.useState)(!0),[l,m]=(0,c.useState)("all"),[n,o]=(0,c.useState)(!1),[r,s]=(0,c.useState)(void 0),[t,v]=(0,c.useState)(!1),w=(0,c.useCallback)(async()=>{try{let a="all"===l?"/api/staff/fees/invoices?limit=100&offset=0":`/api/staff/fees/invoices?status=${l}&limit=100&offset=0`,b=await fetch(a),c=await b.json();d(c.data||[])}catch(a){console.error("Error fetching invoices:",a)}},[l]),y=(0,c.useCallback)(async()=>{try{let a=await fetch("/api/staff/fees/events?status=accrued&limit=100&offset=0"),b=await a.json();console.log("[InvoicesTab] Fee events fetched:",b.data?.length||0,"events"),b.data?.length>0&&(console.log("[InvoicesTab] First fee event:",b.data[0]),console.log("[InvoicesTab] First investor data:",b.data[0]?.investor)),i(b.data||[])}catch(a){console.error("Error fetching fee events:",a)}},[]),z=(0,c.useCallback)(async()=>{k(!0),await Promise.all([w(),y()]),k(!1)},[w,y]);(0,c.useEffect)(()=>{z()},[z]);let A=async a=>{try{let b=await fetch(`/api/staff/fees/invoices/${a}/send`,{method:"POST"}),c=await b.json();b.ok?(alert(c.message||"Invoice sent successfully"),w()):(console.error("Error sending invoice:",c),alert(c.error+(c.details?`

${c.details}`:"")))}catch(a){console.error("Error sending invoice:",a),alert("Failed to send invoice. Please try again.")}},B=async(a,b)=>{try{(await fetch(`/api/staff/fees/invoices/${a}/mark-paid`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({paid_amount:b})})).ok&&w()}catch(a){console.error("Error marking invoice as paid:",a)}},C=async()=>{if(confirm("This will calculate fee events for all existing committed subscriptions that don't have fee events yet. Continue?")){v(!0);try{let a=await fetch("/api/staff/fees/events/backfill",{method:"POST"}),b=await a.json();a.ok?(alert(`Backfill complete!

Processed: ${b.results.processed}
Skipped: ${b.results.skipped}
Failed: ${b.results.failed}
Total Fee Events Created: ${b.results.created_events}`),z()):alert(`Backfill failed: ${b.error}`)}catch(a){console.error("Error running backfill:",a),alert("Failed to run backfill")}finally{v(!1)}}};if(j)return(0,b.jsx)("div",{children:"Loading..."});let E=h.reduce((a,b)=>{let c=b.investor?.id||"unknown";a[c]||(a[c]={investor:b.investor,subscriptions:{},total:0});let d=b.allocation_id||"no-subscription",e=b.subscription?`${b.subscription.subscription_number} - ${b.subscription.vehicle?.name||"Unknown Vehicle"}`:"Direct Fee";return a[c].subscriptions[d]||(a[c].subscriptions[d]={subscription:b.subscription,name:e,events:[],total:0}),a[c].subscriptions[d].events.push(b),a[c].subscriptions[d].total+=Number(b.computed_amount),a[c].total+=Number(b.computed_amount),a},{}),F=h.reduce((a,b)=>a+Number(b.computed_amount),0);return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h2",{className:"text-2xl font-bold",children:"Fee Billing"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:"Manage recurring fee billing and invoices. For initial investment fees, see Subscriptions."})]}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsxs)(p.Button,{variant:"outline",onClick:C,disabled:t,children:[t?(0,b.jsx)(L.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}):(0,b.jsx)(X.RefreshCw,{className:"mr-2 h-4 w-4"}),"Backfill Fee Events"]}),(0,b.jsxs)(p.Button,{onClick:()=>o(!0),children:[(0,b.jsx)(x.Plus,{className:"mr-2 h-4 w-4"}),"Generate Invoice"]})]})]}),(0,b.jsxs)(ad.Tabs,{defaultValue:"uninvoiced",className:"w-full",id:"invoices-tab-tabs",children:[(0,b.jsxs)(ad.TabsList,{children:[(0,b.jsxs)(ad.TabsTrigger,{value:"uninvoiced",children:["Uninvoiced Fees",h.length>0&&(0,b.jsx)(u.Badge,{variant:"secondary",className:"ml-2",children:h.length})]}),(0,b.jsx)(ad.TabsTrigger,{value:"invoices",children:"Invoices"})]}),(0,b.jsx)(ad.TabsContent,{value:"uninvoiced",className:"space-y-4",children:0===h.length?(0,b.jsx)(e.Card,{children:(0,b.jsxs)(e.CardContent,{className:"py-10 text-center",children:[(0,b.jsx)(g.FileText,{className:"mx-auto h-12 w-12 text-muted-foreground/50 mb-4"}),(0,b.jsx)("p",{className:"text-muted-foreground",children:"No uninvoiced fee events"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:"Fee events are automatically created when subscriptions are committed"})]})}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(e.Card,{children:(0,b.jsx)(e.CardContent,{className:"py-4",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Total Uninvoiced"}),(0,b.jsx)("p",{className:"text-2xl font-bold",children:q(F)})]}),(0,b.jsxs)("div",{className:"text-right",children:[(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Fee Events"}),(0,b.jsx)("p",{className:"text-2xl font-bold",children:h.length})]}),(0,b.jsxs)("div",{className:"text-right",children:[(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Investors"}),(0,b.jsx)("p",{className:"text-2xl font-bold",children:Object.keys(E).length})]})]})})}),Object.values(E).map(({investor:a,subscriptions:c,total:d})=>(0,b.jsxs)(e.Card,{children:[(0,b.jsx)(e.CardHeader,{children:(0,b.jsxs)("div",{className:"flex items-start justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(e.CardTitle,{className:"text-lg",children:a?.legal_name||a?.display_name||"Unknown Investor"}),(0,b.jsxs)("p",{className:"text-sm text-muted-foreground mt-1",children:[Object.keys(c).length," subscription(s) • ",q(d)]})]}),(0,b.jsxs)(p.Button,{size:"sm",onClick:()=>{console.log("[InvoicesTab] Invoice button clicked for investor:",a),console.log("[InvoicesTab] Investor ID:",a?.id,"Type:",typeof a?.id),a?.id&&"unknown"!==a.id?(console.log("[InvoicesTab] Setting selectedInvestorId to:",a.id),s(a.id),o(!0)):alert("Cannot generate invoice: Investor information is missing")},disabled:!a?.id||"unknown"===a.id,children:[(0,b.jsx)(x.Plus,{className:"mr-2 h-4 w-4"}),"Invoice All"]})]})}),(0,b.jsx)(e.CardContent,{children:(0,b.jsx)("div",{className:"space-y-4",children:Object.values(c).map(a=>(0,b.jsxs)("div",{className:"border-l-2 border-primary/20 pl-4",children:[(0,b.jsxs)("div",{className:"mb-2",children:[(0,b.jsx)("p",{className:"font-medium text-sm",children:a.name}),(0,b.jsxs)("p",{className:"text-xs text-muted-foreground",children:[a.events.length," fee(s) • ",q(a.total)]})]}),(0,b.jsx)("div",{className:"space-y-2",children:a.events.map(a=>(0,b.jsx)("div",{className:"flex items-center justify-between p-2 bg-accent/50 rounded",children:(0,b.jsxs)("div",{children:[(0,b.jsxs)("div",{className:"font-medium text-sm",children:[(0,b.jsx)(u.Badge,{variant:"outline",className:"mr-2 text-xs",children:"flat"===a.fee_type?"Investment":a.fee_type.replace("_"," ")}),q(a.computed_amount)]}),(0,b.jsx)("div",{className:"text-xs text-muted-foreground",children:new Date(a.event_date).toLocaleDateString()})]})},a.id))})]},a.name))})})]},a?.id||"unknown"))]})}),(0,b.jsxs)(ad.TabsContent,{value:"invoices",className:"space-y-4",children:[(0,b.jsx)("div",{className:"flex gap-2",children:["all","draft","sent","paid","overdue"].map(a=>(0,b.jsx)(p.Button,{variant:l===a?"default":"outline",size:"sm",onClick:()=>m(a),children:a.charAt(0).toUpperCase()+a.slice(1)},a))}),0===a.length?(0,b.jsx)(e.Card,{children:(0,b.jsxs)(e.CardContent,{className:"py-10 text-center",children:[(0,b.jsx)(g.FileText,{className:"mx-auto h-12 w-12 text-muted-foreground/50 mb-4"}),(0,b.jsx)("p",{className:"text-muted-foreground",children:"No invoices found"})]})}):(0,b.jsx)("div",{className:"space-y-4",children:a.map(a=>(0,b.jsxs)(e.Card,{children:[(0,b.jsx)(e.CardHeader,{children:(0,b.jsxs)("div",{className:"flex items-start justify-between",children:[(0,b.jsxs)("div",{className:"flex items-start gap-2",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(e.CardTitle,{className:"text-lg",children:a.invoice_number}),(0,b.jsxs)("p",{className:"text-sm text-muted-foreground mt-1",children:[a.investor?.display_name||"Unknown Investor",a.deal&&` • ${a.deal.name}`]})]}),a.has_discrepancy&&(0,b.jsxs)(Y.Popover,{children:[(0,b.jsx)(Y.PopoverTrigger,{asChild:!0,children:(0,b.jsxs)("button",{className:"flex items-center gap-1 px-2 py-1 text-xs font-medium text-amber-600 bg-amber-100 dark:bg-amber-900/30 dark:text-amber-400 rounded-md hover:bg-amber-200 dark:hover:bg-amber-900/50 transition-colors cursor-pointer",children:[(0,b.jsx)(D.AlertTriangle,{className:"h-3.5 w-3.5"}),(0,b.jsx)("span",{children:"Discrepancy"})]})}),(0,b.jsx)(Y.PopoverContent,{className:"w-80",side:"bottom",align:"start",children:(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 text-amber-600 dark:text-amber-400",children:[(0,b.jsx)(D.AlertTriangle,{className:"h-4 w-4"}),(0,b.jsx)("h4",{className:"font-medium",children:"Invoice Discrepancy Detected"})]}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"The invoice total does not match the sum of linked fee events."}),(0,b.jsxs)("div",{className:"space-y-2 p-3 bg-muted/50 rounded-md",children:[(0,b.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Invoice Total:"}),(0,b.jsx)("span",{className:"font-medium",children:q(a.total)})]}),(0,b.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Expected Total:"}),(0,b.jsx)("span",{className:"font-medium",children:q(a.total-(a.discrepancy_amount||0))})]}),(0,b.jsx)("div",{className:"border-t border-border pt-2 mt-2",children:(0,b.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,b.jsx)("span",{className:"text-amber-600 dark:text-amber-400 font-medium",children:"Discrepancy:"}),(0,b.jsxs)("span",{className:"text-amber-600 dark:text-amber-400 font-medium",children:[(a.discrepancy_amount||0)>0?"+":"",q(a.discrepancy_amount||0)]})]})})]}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"Please review the invoice line items and linked fee events to resolve this discrepancy."})]})})]})]}),(0,b.jsx)(u.Badge,{variant:ae[a.status],children:a.status.replace("_"," ")})]})}),(0,b.jsx)(e.CardContent,{children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("div",{className:"text-2xl font-bold",children:q(a.total)}),(0,b.jsxs)("div",{className:"text-sm text-muted-foreground",children:["Due: ",new Date(a.due_date).toLocaleDateString(),a.balance_due&&a.balance_due>0&&(0,b.jsxs)("span",{className:"ml-2",children:["• Balance: ",q(a.balance_due)]})]})]}),(0,b.jsxs)("div",{className:"flex gap-2",children:["draft"===a.status&&(0,b.jsxs)(p.Button,{size:"sm",onClick:()=>A(a.id),children:[(0,b.jsx)(J.Send,{className:"mr-2 h-4 w-4"}),"Send"]}),["sent","partially_paid","overdue"].includes(a.status)&&(0,b.jsxs)(p.Button,{size:"sm",onClick:()=>B(a.id,a.balance_due||a.total),children:[(0,b.jsx)(f.DollarSign,{className:"mr-2 h-4 w-4"}),"Mark Paid"]})]})]})})]},a.id))})]})]})]}),(0,b.jsx)(ac,{open:n,onClose:()=>{o(!1),s(void 0)},onSuccess:()=>z(),preselectedInvestorId:r})]})}a.s(["default",()=>af],813503);var ag=a.i(724070),ah=a.i(823879),ai=a.i(166457),aj=a.i(168405),ak=a.i(723603),al=a.i(716103);function am(){let a=(0,d.useRouter)(),g=(0,d.useSearchParams)(),[h,i]=(0,c.useState)(null),[n,o]=(0,c.useState)(!0),[r,s]=(0,c.useState)(60),[t,v]=(0,c.useState)([]),[w,x]=(0,c.useState)(!0),[y,z]=(0,c.useState)(!0),[B,C]=(0,c.useState)([]),[D,G]=(0,c.useState)(!0),[I,J]=(0,c.useState)(!0),[K,L]=(0,c.useState)([]),[M,N]=(0,c.useState)(!0),[O,Q]=(0,c.useState)(!0),[R,S]=(0,c.useState)([]),[T,U]=(0,c.useState)(!0),[V,W]=(0,c.useState)(!0),[X,Z]=(0,c.useState)([]),[$,_]=(0,c.useState)([]),[aa,ac]=(0,c.useState)(()=>{let a=g.get("deal_ids");return a?a.split(","):[]}),[ad,ae]=(0,c.useState)(()=>{let a=g.get("entity_ids");return a?a.split(","):[]}),[af,am]=(0,c.useState)(()=>{let a=g.get("date_from"),b=g.get("date_to");if(a||b)return{from:a?new Date(a):void 0,to:b?new Date(b):void 0}}),[an,ao]=(0,c.useState)(!1),[ap,aq]=(0,c.useState)(!1),ar=aa.length>0||ad.length>0||af?.from||af?.to;(0,c.useEffect)(()=>{let b=new URLSearchParams(g.toString());aa.length>0?b.set("deal_ids",aa.join(",")):b.delete("deal_ids"),ad.length>0?b.set("entity_ids",ad.join(",")):b.delete("entity_ids"),af?.from?b.set("date_from",af.from.toISOString().split("T")[0]):b.delete("date_from"),af?.to?b.set("date_to",af.to.toISOString().split("T")[0]):b.delete("date_to");let c=b.toString()?`?${b.toString()}`:window.location.pathname;a.push(c,{scroll:!1})},[aa,ad,af,a,g]);let as=(0,c.useCallback)(async()=>{try{let a=await fetch("/api/deals"),b=await a.json();Z(b.deals||[])}catch(a){console.error("Error fetching deals:",a)}},[]),at=(0,c.useCallback)(async()=>{try{let a=await fetch("/api/staff/fees/commissions"),b=((await a.json()).by_entity||[]).map(a=>({id:a.entity.id,name:a.entity.name,type:a.entity_type}));try{let a=await fetch("/api/staff/introducers"),c=((await a.json()).data||[]).map(a=>({id:a.id,name:a.legal_name||a.name||"Unknown",type:"introducer"})),d=new Set(b.map(a=>a.id));for(let a of c)d.has(a.id)||b.push(a)}catch{}b.sort((a,b)=>a.name.localeCompare(b.name)),_(b)}catch(a){console.error("Error fetching entities:",a)}},[]),au=(0,c.useCallback)(()=>{ac([]),ae([]),am(void 0)},[]),av=a=>{ac(b=>b.includes(a)?b.filter(b=>b!==a):[...b,a])},aw=a=>{ae(b=>b.includes(a)?b.filter(b=>b!==a):[...b,a])},ax=(0,c.useMemo)(()=>aa.map(a=>X.find(b=>b.id===a)?.name).filter(Boolean).join(", "),[aa,X]),ay=(0,c.useMemo)(()=>ad.map(a=>$.find(b=>b.id===a)?.name).filter(Boolean).join(", "),[ad,$]);(0,c.useEffect)(()=>{as(),at()},[as,at]);let az=(0,c.useCallback)(async()=>{o(!0);try{let a=await fetch(`/api/staff/fees/schedules?days=${r}`),b=await a.json();i(b)}catch(a){console.error("Error fetching schedules:",a)}finally{o(!1)}},[r]),aA=(0,c.useCallback)(async()=>{x(!0);try{let a=new URLSearchParams;a.set("status","accrued"),a.set("limit","200"),af?.from?a.set("period_from",af.from.toISOString().split("T")[0]):a.set("period_from",new Date().toISOString().split("T")[0]),af?.to&&a.set("period_to",af.to.toISOString().split("T")[0]);let b=await fetch(`/api/staff/fees/events?${a.toString()}`),c=(await b.json()).data||[];aa.length>0&&(c=c.filter(a=>a.deal?.id&&aa.includes(a.deal.id))),v(c)}catch(a){console.error("Error fetching investor fees:",a),v([])}finally{x(!1)}},[aa,af]),aB=(0,c.useCallback)(async()=>{G(!0);try{let a=new URLSearchParams;a.set("entity_type","introducer"),a.set("status","accrued");let b=await fetch(`/api/staff/fees/commissions?${a.toString()}`),c=((await b.json()).data||[]).filter(a=>"introducer"===a.entity_type);aa.length>0&&(c=c.filter(a=>a.deal_id&&aa.includes(a.deal_id))),ad.length>0&&(c=c.filter(a=>ad.includes(a.entity_id))),af?.from&&(c=c.filter(a=>new Date(a.created_at)>=af.from)),af?.to&&(c=c.filter(a=>new Date(a.created_at)<=af.to)),C(c)}catch(a){console.error("Error fetching introducer commissions:",a),C([])}finally{G(!1)}},[aa,ad,af]),aC=(0,c.useCallback)(async()=>{N(!0);try{let a=new URLSearchParams;a.set("entity_type","partner"),a.set("status","accrued");let b=await fetch(`/api/staff/fees/commissions?${a.toString()}`),c=((await b.json()).data||[]).filter(a=>"partner"===a.entity_type);aa.length>0&&(c=c.filter(a=>a.deal_id&&aa.includes(a.deal_id))),ad.length>0&&(c=c.filter(a=>ad.includes(a.entity_id))),af?.from&&(c=c.filter(a=>new Date(a.created_at)>=af.from)),af?.to&&(c=c.filter(a=>new Date(a.created_at)<=af.to)),L(c)}catch(a){console.error("Error fetching partner commissions:",a),L([])}finally{N(!1)}},[aa,ad,af]),aD=(0,c.useCallback)(async()=>{U(!0);try{let a=new URLSearchParams;a.set("entity_type","commercial_partner"),a.set("status","accrued");let b=await fetch(`/api/staff/fees/commissions?${a.toString()}`),c=((await b.json()).data||[]).filter(a=>"commercial_partner"===a.entity_type);aa.length>0&&(c=c.filter(a=>a.deal_id&&aa.includes(a.deal_id))),ad.length>0&&(c=c.filter(a=>ad.includes(a.entity_id))),af?.from&&(c=c.filter(a=>new Date(a.created_at)>=af.from)),af?.to&&(c=c.filter(a=>new Date(a.created_at)<=af.to)),S(c)}catch(a){console.error("Error fetching commercial partner commissions:",a),S([])}finally{U(!1)}},[aa,ad,af]);(0,c.useEffect)(()=>{az()},[r,az]),(0,c.useEffect)(()=>{aA()},[aA]),(0,c.useEffect)(()=>{aB()},[aB]),(0,c.useEffect)(()=>{aC()},[aC]),(0,c.useEffect)(()=>{aD()},[aD]);let aE=(0,c.useMemo)(()=>{let a={};for(let b of t){let c=b.deal?.id||"unknown",d=b.deal?.name||"Unknown Deal",e=b.investor?.id||"unknown",f=b.investor?.legal_name||b.investor?.display_name||"Unknown Investor";a[c]||(a[c]={deal:{id:c,name:d},byInvestor:{},total:0}),a[c].byInvestor[e]||(a[c].byInvestor[e]={investor:{id:e,name:f},fees:[],total:0}),a[c].byInvestor[e].fees.push(b),a[c].byInvestor[e].total+=b.computed_amount,a[c].total+=b.computed_amount}return Object.values(a).forEach(a=>{Object.values(a.byInvestor).forEach(a=>{a.fees.sort((a,b)=>{let c=a.period_start_date||a.event_date,d=b.period_start_date||b.event_date;return new Date(c).getTime()-new Date(d).getTime()})})}),a},[t]),aF=(0,c.useMemo)(()=>t.reduce((a,b)=>a+b.computed_amount,0),[t]),aG=(0,c.useMemo)(()=>{let a={};for(let b of B){let c=b.entity_id||"unknown",d=b.entity_name||"Unknown Introducer",e=b.deal_id||"unknown",f=b.deal_name||"Unknown Deal";a[c]||(a[c]={introducer:{id:c,name:d},byDeal:{},total:0}),a[c].byDeal[e]||(a[c].byDeal[e]={deal:{id:e,name:f},commissions:[],total:0}),a[c].byDeal[e].commissions.push(b),a[c].byDeal[e].total+=Number(b.accrual_amount),a[c].total+=Number(b.accrual_amount)}return Object.values(a).forEach(a=>{Object.values(a.byDeal).forEach(a=>{a.commissions.sort((a,b)=>new Date(b.created_at).getTime()-new Date(a.created_at).getTime())})}),a},[B]),aH=(0,c.useMemo)(()=>B.reduce((a,b)=>a+Number(b.accrual_amount),0),[B]),aI=(0,c.useMemo)(()=>{let a={};for(let b of K){let c=b.entity_id||"unknown",d=b.entity_name||"Unknown Partner",e=b.deal_id||"unknown",f=b.deal_name||"Unknown Deal";a[c]||(a[c]={partner:{id:c,name:d},byDeal:{},total:0}),a[c].byDeal[e]||(a[c].byDeal[e]={deal:{id:e,name:f},commissions:[],total:0}),a[c].byDeal[e].commissions.push(b),a[c].byDeal[e].total+=Number(b.accrual_amount),a[c].total+=Number(b.accrual_amount)}return Object.values(a).forEach(a=>{Object.values(a.byDeal).forEach(a=>{a.commissions.sort((a,b)=>new Date(b.created_at).getTime()-new Date(a.created_at).getTime())})}),a},[K]),aJ=(0,c.useMemo)(()=>K.reduce((a,b)=>a+Number(b.accrual_amount),0),[K]),aK=(0,c.useMemo)(()=>{let a={};for(let b of R){let c=b.entity_id||"unknown",d=b.entity_name||"Unknown Commercial Partner",e=b.deal_id||"unknown",f=b.deal_name||"Unknown Deal";a[c]||(a[c]={commercialPartner:{id:c,name:d},byDeal:{},total:0}),a[c].byDeal[e]||(a[c].byDeal[e]={deal:{id:e,name:f},commissions:[],total:0}),a[c].byDeal[e].commissions.push(b),a[c].byDeal[e].total+=Number(b.accrual_amount),a[c].total+=Number(b.accrual_amount)}return Object.values(a).forEach(a=>{Object.values(a.byDeal).forEach(a=>{a.commissions.sort((a,b)=>new Date(b.created_at).getTime()-new Date(a.created_at).getTime())})}),a},[R]),aL=(0,c.useMemo)(()=>R.reduce((a,b)=>a+Number(b.accrual_amount),0),[R]);if(n)return(0,b.jsx)("div",{className:"text-white",children:"Loading fee schedules..."});if(!h)return(0,b.jsx)("div",{className:"text-white",children:"Failed to load fee schedules"});let aM={management:"bg-blue-500/20 text-blue-400 border-blue-500/30",subscription:"bg-purple-500/20 text-purple-400 border-purple-500/30",performance:"bg-green-500/20 text-green-400 border-green-500/30"};return(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h2",{className:"text-2xl font-bold text-white",children:"Fee Schedule"}),(0,b.jsxs)("p",{className:"text-gray-400",children:["Upcoming recurring fees for the next ",r," days"]})]}),(0,b.jsxs)("div",{className:"grid gap-4 md:grid-cols-3",children:[(0,b.jsxs)(e.Card,{children:[(0,b.jsxs)(e.CardHeader,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,b.jsx)(e.CardTitle,{className:"text-sm font-medium",children:"Total Scheduled"}),(0,b.jsx)(ag.Calendar,{className:"h-4 w-4 text-muted-foreground"})]}),(0,b.jsxs)(e.CardContent,{children:[(0,b.jsx)("div",{className:"text-2xl font-bold text-white",children:h.summary.total_scheduled}),(0,b.jsx)("p",{className:"text-xs text-gray-400",children:"Recurring fees due"})]})]}),(0,b.jsxs)(e.Card,{children:[(0,b.jsxs)(e.CardHeader,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,b.jsx)(e.CardTitle,{className:"text-sm font-medium",children:"Expected Revenue"}),(0,b.jsx)(f.DollarSign,{className:"h-4 w-4 text-muted-foreground"})]}),(0,b.jsxs)(e.CardContent,{children:[(0,b.jsx)("div",{className:"text-2xl font-bold text-white",children:q(h.summary.total_amount)}),(0,b.jsx)("p",{className:"text-xs text-gray-400",children:"Total amount scheduled"})]})]}),(0,b.jsxs)(e.Card,{children:[(0,b.jsxs)(e.CardHeader,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,b.jsx)(e.CardTitle,{className:"text-sm font-medium",children:"Date Range"}),(0,b.jsx)(H.Clock,{className:"h-4 w-4 text-muted-foreground"})]}),(0,b.jsxs)(e.CardContent,{children:[(0,b.jsxs)("div",{className:"text-sm font-medium text-white",children:[new Date(h.summary.date_range.from).toLocaleDateString("en-US",{month:"short",day:"numeric"})," - ",new Date(h.summary.date_range.to).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})]}),(0,b.jsx)("p",{className:"text-xs text-gray-400",children:"Forecast period"})]})]})]}),(0,b.jsx)("div",{className:"flex gap-2",children:[30,60,90,180].map(a=>(0,b.jsxs)(p.Button,{variant:r===a?"default":"outline",size:"sm",onClick:()=>s(a),children:[a," days"]},a))}),(0,b.jsxs)(e.Card,{children:[(0,b.jsx)(e.CardHeader,{className:"pb-3",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(ai.Filter,{className:"h-4 w-4 text-gray-400"}),(0,b.jsx)(e.CardTitle,{className:"text-sm",children:"Filters"}),ar&&(0,b.jsxs)(u.Badge,{variant:"secondary",className:"text-xs",children:[aa.length+ad.length+ +!!af," active"]})]}),ar&&(0,b.jsxs)(p.Button,{variant:"ghost",size:"sm",onClick:au,className:"h-7 text-xs",children:[(0,b.jsx)(ah.X,{className:"h-3 w-3 mr-1"}),"Clear all"]})]})}),(0,b.jsx)(e.CardContent,{className:"pt-0",children:(0,b.jsxs)("div",{className:"flex flex-wrap gap-3",children:[(0,b.jsxs)(Y.Popover,{open:an,onOpenChange:ao,children:[(0,b.jsx)(Y.PopoverTrigger,{asChild:!0,children:(0,b.jsxs)(p.Button,{variant:"outline",role:"combobox","aria-expanded":an,className:"min-w-[200px] justify-between text-left font-normal",children:[(0,b.jsx)("span",{className:"truncate",children:aa.length>0?1===aa.length?ax:`${aa.length} deals selected`:"Select deals..."}),(0,b.jsx)(aj.ChevronsUpDown,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),(0,b.jsx)(Y.PopoverContent,{className:"w-[300px] p-0",align:"start",children:(0,b.jsxs)(ak.Command,{children:[(0,b.jsx)(ak.CommandInput,{placeholder:"Search deals..."}),(0,b.jsxs)(ak.CommandList,{children:[(0,b.jsx)(ak.CommandEmpty,{children:"No deals found."}),(0,b.jsx)(ak.CommandGroup,{heading:"Deals",children:X.map(a=>(0,b.jsx)(ak.CommandItem,{value:a.name,onSelect:()=>av(a.id),children:(0,b.jsxs)("div",{className:"flex items-center gap-2 w-full",children:[(0,b.jsx)(ab.Checkbox,{checked:aa.includes(a.id),onCheckedChange:()=>av(a.id),className:"h-4 w-4"}),(0,b.jsx)("span",{className:"truncate",children:a.name})]})},a.id))})]})]})})]}),(0,b.jsxs)(Y.Popover,{open:ap,onOpenChange:aq,children:[(0,b.jsx)(Y.PopoverTrigger,{asChild:!0,children:(0,b.jsxs)(p.Button,{variant:"outline",role:"combobox","aria-expanded":ap,className:"min-w-[200px] justify-between text-left font-normal",children:[(0,b.jsx)("span",{className:"truncate",children:ad.length>0?1===ad.length?ay:`${ad.length} entities selected`:"Select entities..."}),(0,b.jsx)(aj.ChevronsUpDown,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),(0,b.jsx)(Y.PopoverContent,{className:"w-[300px] p-0",align:"start",children:(0,b.jsxs)(ak.Command,{children:[(0,b.jsx)(ak.CommandInput,{placeholder:"Search entities..."}),(0,b.jsxs)(ak.CommandList,{children:[(0,b.jsx)(ak.CommandEmpty,{children:"No entities found."}),["introducer","partner","commercial_partner"].map(a=>{let c=$.filter(b=>b.type===a);return 0===c.length?null:(0,b.jsx)(ak.CommandGroup,{heading:{introducer:"Introducers",partner:"Partners",commercial_partner:"Commercial Partners"}[a],children:c.map(a=>(0,b.jsx)(ak.CommandItem,{value:`${a.type}-${a.name}`,onSelect:()=>aw(a.id),children:(0,b.jsxs)("div",{className:"flex items-center gap-2 w-full",children:[(0,b.jsx)(ab.Checkbox,{checked:ad.includes(a.id),onCheckedChange:()=>aw(a.id),className:"h-4 w-4"}),"introducer"===a.type&&(0,b.jsx)(k.UserCheck,{className:"h-3.5 w-3.5 text-blue-400 shrink-0"}),"partner"===a.type&&(0,b.jsx)(l.Handshake,{className:"h-3.5 w-3.5 text-green-400 shrink-0"}),"commercial_partner"===a.type&&(0,b.jsx)(m.Briefcase,{className:"h-3.5 w-3.5 text-purple-400 shrink-0"}),(0,b.jsx)("span",{className:"truncate",children:a.name})]})},a.id))},a)})]})]})})]}),(0,b.jsx)(al.DateRangePicker,{value:af,onChange:am,variant:"dark"})]})})]}),(0,b.jsx)(P.Collapsible,{open:y,onOpenChange:z,children:(0,b.jsxs)(e.Card,{children:[(0,b.jsx)(e.CardHeader,{className:"pb-3",children:(0,b.jsx)(P.CollapsibleTrigger,{asChild:!0,children:(0,b.jsxs)("button",{className:"flex w-full items-center justify-between text-left",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)(j.Users,{className:"h-5 w-5 text-blue-400"}),(0,b.jsxs)("div",{children:[(0,b.jsx)(e.CardTitle,{className:"text-lg",children:"Investor Fees"}),(0,b.jsx)("p",{className:"text-sm text-gray-400 mt-0.5",children:"Accrued fees pending collection"})]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-4",children:[(0,b.jsxs)("div",{className:"text-right",children:[(0,b.jsxs)("div",{className:"text-sm font-medium text-white",children:[t.length," fee",1!==t.length?"s":""]}),(0,b.jsx)("div",{className:"text-sm text-gray-400",children:q(aF)})]}),y?(0,b.jsx)(E.ChevronDown,{className:"h-5 w-5 text-gray-400"}):(0,b.jsx)(F.ChevronRight,{className:"h-5 w-5 text-gray-400"})]})]})})}),(0,b.jsx)(P.CollapsibleContent,{children:(0,b.jsx)(e.CardContent,{className:"pt-0",children:w?(0,b.jsx)("p",{className:"text-gray-400 py-4",children:"Loading investor fees..."}):0===t.length?(0,b.jsx)("p",{className:"text-gray-400 py-4",children:"No accrued investor fees with future periods"}):(0,b.jsx)("div",{className:"space-y-6",children:Object.entries(aE).map(([a,c])=>(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 border-b border-gray-700 pb-2",children:[(0,b.jsx)(A.Building2,{className:"h-4 w-4 text-purple-400"}),(0,b.jsx)("h4",{className:"font-semibold text-white",children:c.deal.name}),(0,b.jsx)("span",{className:"text-sm text-gray-400 ml-auto",children:q(c.total)})]}),Object.entries(c.byInvestor).map(([a,c])=>(0,b.jsxs)("div",{className:"ml-6 space-y-2",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(j.Users,{className:"h-3.5 w-3.5 text-gray-500"}),(0,b.jsx)("h5",{className:"font-medium text-gray-200",children:c.investor.name}),(0,b.jsx)("span",{className:"text-sm text-gray-400 ml-auto",children:q(c.total)})]}),(0,b.jsx)("div",{className:"overflow-x-auto",children:(0,b.jsxs)("table",{className:"w-full text-sm",children:[(0,b.jsx)("thead",{children:(0,b.jsxs)("tr",{className:"border-b border-gray-700",children:[(0,b.jsx)("th",{className:"text-left py-2 px-2 text-gray-400 font-medium",children:"Fee Type"}),(0,b.jsx)("th",{className:"text-right py-2 px-2 text-gray-400 font-medium",children:"Amount"}),(0,b.jsx)("th",{className:"text-left py-2 px-2 text-gray-400 font-medium",children:"Period Start"}),(0,b.jsx)("th",{className:"text-left py-2 px-2 text-gray-400 font-medium",children:"Period End"})]})}),(0,b.jsx)("tbody",{children:c.fees.map(a=>(0,b.jsxs)("tr",{className:"border-b border-gray-800",children:[(0,b.jsx)("td",{className:"py-2 px-2",children:(0,b.jsx)(u.Badge,{className:aM[a.fee_type]||"bg-gray-500/20 text-gray-400 border-gray-500/30",children:a.fee_type})}),(0,b.jsx)("td",{className:"py-2 px-2 text-right text-white font-medium",children:q(a.computed_amount)}),(0,b.jsx)("td",{className:"py-2 px-2 text-gray-300",children:a.period_start_date?new Date(a.period_start_date).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}):"-"}),(0,b.jsx)("td",{className:"py-2 px-2 text-gray-300",children:a.period_end_date?new Date(a.period_end_date).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}):"-"})]},a.id))})]})})]},a))]},a))})})})]})}),(0,b.jsx)(P.Collapsible,{open:I,onOpenChange:J,children:(0,b.jsxs)(e.Card,{children:[(0,b.jsx)(e.CardHeader,{className:"pb-3",children:(0,b.jsx)(P.CollapsibleTrigger,{asChild:!0,children:(0,b.jsxs)("button",{className:"flex w-full items-center justify-between text-left",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)(k.UserCheck,{className:"h-5 w-5 text-blue-400"}),(0,b.jsxs)("div",{children:[(0,b.jsx)(e.CardTitle,{className:"text-lg",children:"Introducer Commissions"}),(0,b.jsx)("p",{className:"text-sm text-gray-400 mt-0.5",children:"Pending commission payments to introducers"})]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-4",children:[(0,b.jsxs)("div",{className:"text-right",children:[(0,b.jsxs)("div",{className:"text-sm font-medium text-white",children:[B.length," commission",1!==B.length?"s":""]}),(0,b.jsx)("div",{className:"text-sm text-gray-400",children:q(aH)})]}),I?(0,b.jsx)(E.ChevronDown,{className:"h-5 w-5 text-gray-400"}):(0,b.jsx)(F.ChevronRight,{className:"h-5 w-5 text-gray-400"})]})]})})}),(0,b.jsx)(P.CollapsibleContent,{children:(0,b.jsx)(e.CardContent,{className:"pt-0",children:D?(0,b.jsx)("p",{className:"text-gray-400 py-4",children:"Loading introducer commissions..."}):0===B.length?(0,b.jsx)("p",{className:"text-gray-400 py-4",children:"No pending introducer commissions"}):(0,b.jsx)("div",{className:"space-y-6",children:Object.entries(aG).map(([a,c])=>(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 border-b border-gray-700 pb-2",children:[(0,b.jsx)(k.UserCheck,{className:"h-4 w-4 text-blue-400"}),(0,b.jsx)("h4",{className:"font-semibold text-white",children:c.introducer.name}),(0,b.jsx)("span",{className:"text-sm text-gray-400 ml-auto",children:q(c.total)})]}),Object.entries(c.byDeal).map(([a,c])=>(0,b.jsxs)("div",{className:"ml-6 space-y-2",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(A.Building2,{className:"h-3.5 w-3.5 text-purple-400"}),(0,b.jsx)("h5",{className:"font-medium text-gray-200",children:c.deal.name}),(0,b.jsx)("span",{className:"text-sm text-gray-400 ml-auto",children:q(c.total)})]}),(0,b.jsx)("div",{className:"overflow-x-auto",children:(0,b.jsxs)("table",{className:"w-full text-sm",children:[(0,b.jsx)("thead",{children:(0,b.jsxs)("tr",{className:"border-b border-gray-700",children:[(0,b.jsx)("th",{className:"text-left py-2 px-2 text-gray-400 font-medium",children:"Investor"}),(0,b.jsx)("th",{className:"text-right py-2 px-2 text-gray-400 font-medium",children:"Amount"}),(0,b.jsx)("th",{className:"text-left py-2 px-2 text-gray-400 font-medium",children:"Status"}),(0,b.jsx)("th",{className:"text-left py-2 px-2 text-gray-400 font-medium",children:"Created Date"})]})}),(0,b.jsx)("tbody",{children:c.commissions.map(a=>(0,b.jsxs)("tr",{className:"border-b border-gray-800",children:[(0,b.jsx)("td",{className:"py-2 px-2 text-gray-300",children:a.investor_name||"-"}),(0,b.jsx)("td",{className:"py-2 px-2 text-right text-white font-medium",children:q(Number(a.accrual_amount))}),(0,b.jsx)("td",{className:"py-2 px-2",children:(0,b.jsx)(u.Badge,{className:"bg-amber-500/20 text-amber-400 border-amber-500/30",children:a.status})}),(0,b.jsx)("td",{className:"py-2 px-2 text-gray-300",children:new Date(a.created_at).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})})]},a.id))})]})})]},a))]},a))})})})]})}),(0,b.jsx)(P.Collapsible,{open:O,onOpenChange:Q,children:(0,b.jsxs)(e.Card,{children:[(0,b.jsx)(e.CardHeader,{className:"pb-3",children:(0,b.jsx)(P.CollapsibleTrigger,{asChild:!0,children:(0,b.jsxs)("button",{className:"flex w-full items-center justify-between text-left",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)(l.Handshake,{className:"h-5 w-5 text-green-400"}),(0,b.jsxs)("div",{children:[(0,b.jsx)(e.CardTitle,{className:"text-lg",children:"Partner Commissions"}),(0,b.jsx)("p",{className:"text-sm text-gray-400 mt-0.5",children:"Pending commission payments to partners"})]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-4",children:[(0,b.jsxs)("div",{className:"text-right",children:[(0,b.jsxs)("div",{className:"text-sm font-medium text-white",children:[K.length," commission",1!==K.length?"s":""]}),(0,b.jsx)("div",{className:"text-sm text-gray-400",children:q(aJ)})]}),O?(0,b.jsx)(E.ChevronDown,{className:"h-5 w-5 text-gray-400"}):(0,b.jsx)(F.ChevronRight,{className:"h-5 w-5 text-gray-400"})]})]})})}),(0,b.jsx)(P.CollapsibleContent,{children:(0,b.jsx)(e.CardContent,{className:"pt-0",children:M?(0,b.jsx)("p",{className:"text-gray-400 py-4",children:"Loading partner commissions..."}):0===K.length?(0,b.jsx)("p",{className:"text-gray-400 py-4",children:"No pending partner commissions"}):(0,b.jsx)("div",{className:"space-y-6",children:Object.entries(aI).map(([a,c])=>(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 border-b border-gray-700 pb-2",children:[(0,b.jsx)(l.Handshake,{className:"h-4 w-4 text-green-400"}),(0,b.jsx)("h4",{className:"font-semibold text-white",children:c.partner.name}),(0,b.jsx)("span",{className:"text-sm text-gray-400 ml-auto",children:q(c.total)})]}),Object.entries(c.byDeal).map(([a,c])=>(0,b.jsxs)("div",{className:"ml-6 space-y-2",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(A.Building2,{className:"h-3.5 w-3.5 text-purple-400"}),(0,b.jsx)("h5",{className:"font-medium text-gray-200",children:c.deal.name}),(0,b.jsx)("span",{className:"text-sm text-gray-400 ml-auto",children:q(c.total)})]}),(0,b.jsx)("div",{className:"overflow-x-auto",children:(0,b.jsxs)("table",{className:"w-full text-sm",children:[(0,b.jsx)("thead",{children:(0,b.jsxs)("tr",{className:"border-b border-gray-700",children:[(0,b.jsx)("th",{className:"text-left py-2 px-2 text-gray-400 font-medium",children:"Investor"}),(0,b.jsx)("th",{className:"text-right py-2 px-2 text-gray-400 font-medium",children:"Amount"}),(0,b.jsx)("th",{className:"text-left py-2 px-2 text-gray-400 font-medium",children:"Status"}),(0,b.jsx)("th",{className:"text-left py-2 px-2 text-gray-400 font-medium",children:"Created Date"})]})}),(0,b.jsx)("tbody",{children:c.commissions.map(a=>(0,b.jsxs)("tr",{className:"border-b border-gray-800",children:[(0,b.jsx)("td",{className:"py-2 px-2 text-gray-300",children:a.investor_name||"-"}),(0,b.jsx)("td",{className:"py-2 px-2 text-right text-white font-medium",children:q(Number(a.accrual_amount))}),(0,b.jsx)("td",{className:"py-2 px-2",children:(0,b.jsx)(u.Badge,{className:"bg-amber-500/20 text-amber-400 border-amber-500/30",children:a.status})}),(0,b.jsx)("td",{className:"py-2 px-2 text-gray-300",children:new Date(a.created_at).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})})]},a.id))})]})})]},a))]},a))})})})]})}),(0,b.jsx)(P.Collapsible,{open:V,onOpenChange:W,children:(0,b.jsxs)(e.Card,{children:[(0,b.jsx)(e.CardHeader,{className:"pb-3",children:(0,b.jsx)(P.CollapsibleTrigger,{asChild:!0,children:(0,b.jsxs)("button",{className:"flex w-full items-center justify-between text-left",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)(m.Briefcase,{className:"h-5 w-5 text-purple-400"}),(0,b.jsxs)("div",{children:[(0,b.jsx)(e.CardTitle,{className:"text-lg",children:"Commercial Partner Commissions"}),(0,b.jsx)("p",{className:"text-sm text-gray-400 mt-0.5",children:"Pending commission payments to commercial partners"})]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-4",children:[(0,b.jsxs)("div",{className:"text-right",children:[(0,b.jsxs)("div",{className:"text-sm font-medium text-white",children:[R.length," commission",1!==R.length?"s":""]}),(0,b.jsx)("div",{className:"text-sm text-gray-400",children:q(aL)})]}),V?(0,b.jsx)(E.ChevronDown,{className:"h-5 w-5 text-gray-400"}):(0,b.jsx)(F.ChevronRight,{className:"h-5 w-5 text-gray-400"})]})]})})}),(0,b.jsx)(P.CollapsibleContent,{children:(0,b.jsx)(e.CardContent,{className:"pt-0",children:T?(0,b.jsx)("p",{className:"text-gray-400 py-4",children:"Loading commercial partner commissions..."}):0===R.length?(0,b.jsx)("p",{className:"text-gray-400 py-4",children:"No pending commercial partner commissions"}):(0,b.jsx)("div",{className:"space-y-6",children:Object.entries(aK).map(([a,c])=>(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 border-b border-gray-700 pb-2",children:[(0,b.jsx)(m.Briefcase,{className:"h-4 w-4 text-purple-400"}),(0,b.jsx)("h4",{className:"font-semibold text-white",children:c.commercialPartner.name}),(0,b.jsx)("span",{className:"text-sm text-gray-400 ml-auto",children:q(c.total)})]}),Object.entries(c.byDeal).map(([a,c])=>(0,b.jsxs)("div",{className:"ml-6 space-y-2",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(A.Building2,{className:"h-3.5 w-3.5 text-purple-400"}),(0,b.jsx)("h5",{className:"font-medium text-gray-200",children:c.deal.name}),(0,b.jsx)("span",{className:"text-sm text-gray-400 ml-auto",children:q(c.total)})]}),(0,b.jsx)("div",{className:"overflow-x-auto",children:(0,b.jsxs)("table",{className:"w-full text-sm",children:[(0,b.jsx)("thead",{children:(0,b.jsxs)("tr",{className:"border-b border-gray-700",children:[(0,b.jsx)("th",{className:"text-left py-2 px-2 text-gray-400 font-medium",children:"Investor"}),(0,b.jsx)("th",{className:"text-right py-2 px-2 text-gray-400 font-medium",children:"Amount"}),(0,b.jsx)("th",{className:"text-left py-2 px-2 text-gray-400 font-medium",children:"Status"}),(0,b.jsx)("th",{className:"text-left py-2 px-2 text-gray-400 font-medium",children:"Created Date"})]})}),(0,b.jsx)("tbody",{children:c.commissions.map(a=>(0,b.jsxs)("tr",{className:"border-b border-gray-800",children:[(0,b.jsx)("td",{className:"py-2 px-2 text-gray-300",children:a.investor_name||"-"}),(0,b.jsx)("td",{className:"py-2 px-2 text-right text-white font-medium",children:q(Number(a.accrual_amount))}),(0,b.jsx)("td",{className:"py-2 px-2",children:(0,b.jsx)(u.Badge,{className:"bg-amber-500/20 text-amber-400 border-amber-500/30",children:a.status})}),(0,b.jsx)("td",{className:"py-2 px-2 text-gray-300",children:new Date(a.created_at).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})})]},a.id))})]})})]},a))]},a))})})})]})}),(0,b.jsx)("div",{children:(0,b.jsx)("h3",{className:"text-lg font-semibold text-white mb-4",children:"Scheduled Recurring Fees"})}),0===Object.keys(h.by_month).length?(0,b.jsx)(e.Card,{children:(0,b.jsx)(e.CardContent,{className:"py-10 text-center",children:(0,b.jsxs)("p",{className:"text-gray-400",children:["No upcoming fees scheduled for the next ",r," days"]})})}):(0,b.jsx)("div",{className:"space-y-6",children:Object.entries(h.by_month).map(([a,c])=>(0,b.jsxs)("div",{children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,b.jsx)("h3",{className:"text-lg font-semibold text-white",children:a}),(0,b.jsxs)("div",{className:"text-sm text-gray-400",children:[c.fees.length," fee",1!==c.fees.length?"s":""," • ",q(c.total)]})]}),(0,b.jsx)("div",{className:"space-y-3",children:c.fees.map(a=>(0,b.jsx)(e.Card,{children:(0,b.jsx)(e.CardContent,{className:"py-4",children:(0,b.jsxs)("div",{className:"flex items-start justify-between",children:[(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,b.jsx)(u.Badge,{className:aM[a.fee_type]||"bg-gray-500/20 text-gray-400 border-gray-500/30",children:a.fee_name}),(0,b.jsx)(u.Badge,{variant:"outline",className:"text-xs",children:a.frequency})]}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("p",{className:"font-medium text-white",children:a.investor.legal_name||a.investor.display_name}),(0,b.jsx)("p",{className:"text-sm text-gray-400",children:a.vehicle.name}),(0,b.jsxs)("p",{className:"text-sm text-gray-400",children:["Subscription: ",a.subscription_number]}),(0,b.jsxs)("p",{className:"text-xs text-gray-500",children:["Due: ",new Date(a.next_due_date).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric",year:"numeric"})]})]})]}),(0,b.jsxs)("div",{className:"text-right ml-4",children:[(0,b.jsx)("div",{className:"text-xl font-bold text-white",children:q(a.amount)}),(0,b.jsx)(u.Badge,{variant:"secondary",className:"mt-2",children:a.status})]})]})})},a.id))})]},a))})]})}a.s(["default",()=>am],822020);var an=a.i(497412);let ao={accrued:"secondary",invoice_requested:"outline",invoice_submitted:"default",invoiced:"default",paid:"default",rejected:"destructive",cancelled:"secondary"},ap={accrued:H.Clock,invoice_requested:J.Send,invoice_submitted:g.FileText,invoiced:g.FileText,paid:G.CheckCircle,rejected:h.AlertCircle,cancelled:h.AlertCircle},aq={introducer:{label:"Introducer",icon:j.Users,linkPath:"/versotech_main/introducers",color:"text-blue-400"},partner:{label:"Partner",icon:m.Briefcase,linkPath:"/versotech_main/partners",color:"text-purple-400"},commercial_partner:{label:"Commercial Partner",icon:A.Building2,linkPath:"/versotech_main/commercial-partners",color:"text-orange-400"}};function ar(){let[a,d]=(0,c.useState)(null),[g,i]=(0,c.useState)(!0),[j,k]=(0,c.useState)("all"),[l,m]=(0,c.useState)("all"),[o,r]=(0,c.useState)(null),s=(0,c.useCallback)(async()=>{i(!0);try{let a=new URLSearchParams;"all"!==j&&a.set("status",j),"all"!==l&&a.set("entity_type",l);let b=a.toString()?`/api/staff/fees/commissions?${a.toString()}`:"/api/staff/fees/commissions",c=await fetch(b),e=await c.json();d(e)}catch(a){console.error("Error fetching commissions:",a)}finally{i(!1)}},[j,l]);(0,c.useEffect)(()=>{s()},[j,l,s]);let t=async(a,b)=>{r(a);try{let c=await fetch(`/api/staff/fees/commissions/${a}/mark-invoiced`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({entity_type:b})});if(c.ok)s();else{let a=await c.json();alert(`Failed to mark as invoiced: ${a.error}`)}}catch(a){console.error("Error marking as invoiced:",a),alert("Failed to mark as invoiced")}finally{r(null)}},v=async(a,b)=>{let c=prompt("Enter payment reference (optional):");r(a);try{let d=await fetch(`/api/staff/fees/commissions/${a}/mark-paid`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({payment_reference:c,entity_type:b})});if(d.ok)s();else{let a=await d.json();alert(`Failed to mark as paid: ${a.error}`)}}catch(a){console.error("Error marking as paid:",a),alert("Failed to mark as paid")}finally{r(null)}};return g?(0,b.jsx)("div",{className:"text-white",children:"Loading commissions..."}):a?(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h2",{className:"text-2xl font-bold text-white",children:"Entity Commissions"}),(0,b.jsx)("p",{className:"text-gray-400",children:"Track and manage commission payments to introducers, partners, and commercial partners"})]}),(0,b.jsxs)("div",{className:"grid gap-4 md:grid-cols-4",children:[(0,b.jsxs)(e.Card,{children:[(0,b.jsxs)(e.CardHeader,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,b.jsx)(e.CardTitle,{className:"text-sm font-medium",children:"Total Owed"}),(0,b.jsx)(f.DollarSign,{className:"h-4 w-4 text-muted-foreground"})]}),(0,b.jsxs)(e.CardContent,{children:[(0,b.jsx)("div",{className:"text-2xl font-bold text-white",children:q(a.summary.total_owed)}),(0,b.jsx)("p",{className:"text-xs text-gray-400",children:"Accrued + Invoiced"})]})]}),(0,b.jsxs)(e.Card,{children:[(0,b.jsxs)(e.CardHeader,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,b.jsx)(e.CardTitle,{className:"text-sm font-medium",children:"Accrued"}),(0,b.jsx)(H.Clock,{className:"h-4 w-4 text-blue-400"})]}),(0,b.jsxs)(e.CardContent,{children:[(0,b.jsx)("div",{className:"text-2xl font-bold text-white",children:q(a.summary.total_accrued)}),(0,b.jsx)("p",{className:"text-xs text-gray-400",children:"Not yet invoiced"})]})]}),(0,b.jsxs)(e.Card,{children:[(0,b.jsxs)(e.CardHeader,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,b.jsx)(e.CardTitle,{className:"text-sm font-medium",children:"Paid (YTD)"}),(0,b.jsx)(G.CheckCircle,{className:"h-4 w-4 text-green-400"})]}),(0,b.jsxs)(e.CardContent,{children:[(0,b.jsx)("div",{className:"text-2xl font-bold text-white",children:q(a.summary.total_paid)}),(0,b.jsx)("p",{className:"text-xs text-gray-400",children:"Settled commissions"})]})]}),(0,b.jsxs)(e.Card,{children:[(0,b.jsxs)(e.CardHeader,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,b.jsx)(e.CardTitle,{className:"text-sm font-medium",children:"Overdue"}),(0,b.jsx)(h.AlertCircle,{className:"h-4 w-4 text-destructive"})]}),(0,b.jsxs)(e.CardContent,{children:[(0,b.jsx)("div",{className:"text-2xl font-bold text-destructive",children:q(a.summary.total_overdue)}),(0,b.jsx)("p",{className:"text-xs text-gray-400",children:"Past due date"})]})]})]}),(0,b.jsxs)("div",{className:"flex flex-wrap gap-4",children:[(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)("span",{className:"text-sm text-gray-400 self-center mr-1",children:"Status:"}),["all","accrued","invoice_requested","invoice_submitted","invoiced","paid","rejected","cancelled"].map(a=>(0,b.jsx)(p.Button,{variant:j===a?"default":"outline",size:"sm",onClick:()=>k(a),children:"invoice_requested"===a?"Invoice Requested":"invoice_submitted"===a?"Invoice Submitted":a.charAt(0).toUpperCase()+a.slice(1)},a))]}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)("span",{className:"text-sm text-gray-400 self-center mr-1",children:"Entity:"}),(0,b.jsx)(p.Button,{variant:"all"===l?"default":"outline",size:"sm",onClick:()=>m("all"),children:"All"}),Object.keys(aq).map(a=>{let c=aq[a],d=c.icon;return(0,b.jsxs)(p.Button,{variant:l===a?"default":"outline",size:"sm",onClick:()=>m(a),className:"flex items-center gap-1",children:[(0,b.jsx)(d,{className:`h-3 w-3 ${l===a?"":c.color}`}),c.label]},a)})]})]}),0===a.by_entity.length?(0,b.jsx)(e.Card,{children:(0,b.jsx)(e.CardContent,{className:"py-10 text-center",children:(0,b.jsx)("p",{className:"text-gray-400",children:"No commissions found"})})}):(0,b.jsx)("div",{className:"space-y-4",children:a.by_entity.map(a=>{let c=aq[a.entity_type]||aq.introducer,d=c.icon;return(0,b.jsxs)(e.Card,{children:[(0,b.jsx)(e.CardHeader,{children:(0,b.jsxs)("div",{className:"flex items-start justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsxs)(e.CardTitle,{className:"text-lg text-white flex items-center gap-2",children:[(0,b.jsx)(d,{className:`h-5 w-5 ${c.color}`}),a.entity.name,(0,b.jsx)(u.Badge,{variant:"outline",className:`text-xs ${c.color}`,children:c.label}),(0,b.jsx)(an.default,{href:`${c.linkPath}/${a.entity.id}`,children:(0,b.jsx)(p.Button,{variant:"ghost",size:"sm",className:"h-6 px-2",children:(0,b.jsx)(n.ExternalLink,{className:"h-3 w-3"})})})]}),(a.entity.contact_name||a.entity.email)&&(0,b.jsx)("p",{className:"text-sm text-gray-400 mt-1",children:a.entity.contact_name&&a.entity.email?`${a.entity.contact_name} • ${a.entity.email}`:a.entity.contact_name||a.entity.email})]}),(0,b.jsxs)("div",{className:"text-right",children:[(0,b.jsx)("p",{className:"text-2xl font-bold text-white",children:q(a.totals.total)}),(0,b.jsxs)("p",{className:"text-xs text-gray-400",children:[a.commissions.length," commission",1!==a.commissions.length?"s":""]})]})]})}),(0,b.jsx)(e.CardContent,{children:(0,b.jsx)("div",{className:"space-y-3",children:a.commissions.map(a=>{let c=ap[a.status],d="paid"!==a.status&&!!a.payment_due_date&&new Date(a.payment_due_date)<new Date;return(0,b.jsx)("div",{className:`p-4 rounded border ${d?"bg-red-900/20 border-red-700":"bg-gray-900 border-gray-700"}`,children:(0,b.jsxs)("div",{className:"flex items-start justify-between",children:[(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,b.jsxs)(u.Badge,{variant:ao[a.status],children:[(0,b.jsx)(c,{className:"h-3 w-3 mr-1"}),"invoice_requested"===a.status?"Invoice Requested":"invoice_submitted"===a.status?"Invoice Submitted":a.status]}),d&&(0,b.jsxs)(u.Badge,{variant:"destructive",children:[(0,b.jsx)(h.AlertCircle,{className:"h-3 w-3 mr-1"}),"Overdue"]})]}),(0,b.jsx)("p",{className:"font-medium text-white",children:a.deal_name||"Direct commission"}),a.investor_name&&(0,b.jsxs)("p",{className:"text-sm text-gray-300",children:["Investor: ",a.investor_name]}),a.fee_plan_name&&(0,b.jsxs)("p",{className:"text-sm text-gray-400",children:["Fee Plan: ",a.fee_plan_name]}),(0,b.jsxs)("p",{className:"text-sm text-gray-400 mt-1",children:[(a.rate_bps/100).toFixed(2),"% of ",q(a.base_amount),a.payment_due_date&&(0,b.jsxs)("span",{className:"ml-2",children:["• Due: ",new Date(a.payment_due_date).toLocaleDateString()]})]}),a.notes&&(0,b.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:a.notes}),a.payment_reference&&(0,b.jsxs)("p",{className:"text-xs text-green-400 mt-1",children:["Payment ref: ",a.payment_reference]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2 ml-4",children:[(0,b.jsx)("div",{className:"text-right mr-4",children:(0,b.jsx)("p",{className:"text-xl font-bold text-white",children:q(a.accrual_amount)})}),(0,b.jsxs)("div",{className:"flex flex-col gap-2",children:["invoice_submitted"===a.status&&(0,b.jsx)(p.Button,{size:"sm",onClick:()=>t(a.id,a.entity_type),disabled:o===a.id,children:o===a.id?"Processing...":"Mark Invoiced"}),"invoiced"===a.status&&(0,b.jsx)(p.Button,{size:"sm",variant:"default",onClick:()=>v(a.id,a.entity_type),disabled:o===a.id,children:o===a.id?"Processing...":"Mark Paid"}),"paid"===a.status&&a.paid_at&&(0,b.jsxs)("p",{className:"text-xs text-green-400",children:["Paid ",new Date(a.paid_at).toLocaleDateString()]})]})]})]})},a.id)})})})]},`${a.entity_type}:${a.entity.id}`)})})]}):(0,b.jsx)("div",{className:"text-white",children:"Failed to load commissions data"})}a.s(["default",()=>ar],291556)}];

//# sourceMappingURL=versotech-portal_src_components_fees_OverviewTab_tsx_0650961b._.js.map