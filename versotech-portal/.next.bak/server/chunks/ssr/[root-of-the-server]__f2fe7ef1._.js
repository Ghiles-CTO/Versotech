module.exports=[274929,(a,b,c)=>{"use strict";b.exports=a.r(275099).vendored.contexts.HooksClientContext},530136,(a,b,c)=>{"use strict";b.exports=a.r(275099).vendored.contexts.ServerInsertedHtml},832319,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},120635,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/action-async-storage.external.js",()=>require("next/dist/server/app-render/action-async-storage.external.js"))},571370,(a,b,c)=>{"use strict";b.exports=a.r(275099).vendored.contexts.AppRouterContext},95799,a=>{"use strict";var b=a.i(611038);let c=a=>{let b=a.replace(/^([A-Z])|[\s-_]+(\w)/g,(a,b,c)=>c?c.toUpperCase():b.toLowerCase());return b.charAt(0).toUpperCase()+b.slice(1)},d=(...a)=>a.filter((a,b,c)=>!!a&&""!==a.trim()&&c.indexOf(a)===b).join(" ").trim();var e={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let f=(0,b.forwardRef)(({color:a="currentColor",size:c=24,strokeWidth:f=2,absoluteStrokeWidth:g,className:h="",children:i,iconNode:j,...k},l)=>(0,b.createElement)("svg",{ref:l,...e,width:c,height:c,stroke:a,strokeWidth:g?24*Number(f)/Number(c):f,className:d("lucide",h),...!i&&!(a=>{for(let b in a)if(b.startsWith("aria-")||"role"===b||"title"===b)return!0})(k)&&{"aria-hidden":"true"},...k},[...j.map(([a,c])=>(0,b.createElement)(a,c)),...Array.isArray(i)?i:[i]])),g=(a,e)=>{let g=(0,b.forwardRef)(({className:g,...h},i)=>(0,b.createElement)(f,{ref:i,iconNode:e,className:d(`lucide-${c(a).replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()}`,`lucide-${a}`,g),...h}));return g.displayName=c(a),g};a.s(["default",()=>g],95799)},491433,(a,b,c)=>{"use strict";function d(a){if("function"!=typeof WeakMap)return null;var b=new WeakMap,c=new WeakMap;return(d=function(a){return a?c:b})(a)}c._=function(a,b){if(!b&&a&&a.__esModule)return a;if(null===a||"object"!=typeof a&&"function"!=typeof a)return{default:a};var c=d(b);if(c&&c.has(a))return c.get(a);var e={__proto__:null},f=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var g in a)if("default"!==g&&Object.prototype.hasOwnProperty.call(a,g)){var h=f?Object.getOwnPropertyDescriptor(a,g):null;h&&(h.get||h.set)?Object.defineProperty(e,g,h):e[g]=a[g]}return e.default=a,c&&c.set(a,e),e}},441664,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0});var d={DEFAULT_SEGMENT_KEY:function(){return l},NOT_FOUND_SEGMENT_KEY:function(){return m},PAGE_SEGMENT_KEY:function(){return k},addSearchParamsIfPageSegment:function(){return i},computeSelectedLayoutSegment:function(){return j},getSegmentValue:function(){return f},getSelectedLayoutSegmentPath:function(){return function a(b,c,d=!0,e=[]){let g;if(d)g=b[1][c];else{let a=b[1];g=a.children??Object.values(a)[0]}if(!g)return e;let h=f(g[0]);return!h||h.startsWith(k)?e:(e.push(h),a(g,c,!1,e))}},isGroupSegment:function(){return g},isParallelRouteSegment:function(){return h}};for(var e in d)Object.defineProperty(c,e,{enumerable:!0,get:d[e]});function f(a){return Array.isArray(a)?a[1]:a}function g(a){return"("===a[0]&&a.endsWith(")")}function h(a){return a.startsWith("@")&&"@children"!==a}function i(a,b){if(a.includes(k)){let a=JSON.stringify(b);return"{}"!==a?k+"?"+a:k}return a}function j(a,b){if(!a||0===a.length)return null;let c="children"===b?a[0]:a[a.length-1];return c===l?null:c}let k="__PAGE__",l="__DEFAULT__",m="/_not-found"},3321,a=>{"use strict";let b=(0,a.i(95799).default)("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);a.s(["Loader2",()=>b],3321)},441278,a=>{"use strict";let b=(0,a.i(95799).default)("circle-check-big",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);a.s(["CheckCircle",()=>b],441278)},625473,a=>{"use strict";let b=(0,a.i(95799).default)("circle-x",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);a.s(["XCircle",()=>b],625473)},258050,a=>{"use strict";var b=a.i(352584),c=a.i(611038),d=a.i(289633);a.i(876700);var e=a.i(347452),f=a.i(3321),g=a.i(441278),h=a.i(625473),i=a.i(58834);function j(){return(0,e.createBrowserClient)("https://ipguxdssecfexudnvtia.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlwZ3V4ZHNzZWNmZXh1ZG52dGlhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTgzNjE4MzcsImV4cCI6MjA3MzkzNzgzN30.AGxM_YW9hfxuu7xDpi_4xhOoRhYM7iGTS1vJ0z2FByE",{auth:{persistSession:!0,detectSessionInUrl:!0,autoRefreshToken:!0,flowType:"implicit"}})}async function k(a,b){try{(0,i.resetClient)();let c=(0,i.createClient)(),{error:d}=await c.auth.setSession({access_token:a,refresh_token:b});if(d)return console.error("[auth-callback] Failed to sync session to main client:",d),!1;return console.log("[auth-callback] Session synced to main app client successfully"),!0}catch(a){return console.error("[auth-callback] Error syncing session:",a),!1}}function l(){let a=(0,d.useRouter)(),e=(0,d.useSearchParams)(),[i,l]=(0,c.useState)("loading"),[m,n]=(0,c.useState)("Verifying your email..."),o=(0,c.useRef)(!1),p=(0,c.useRef)(null),q=e.get("portal")??"investor",r=e.get("error"),s=e.get("error_description"),t=e.get("code"),u=e.get("type"),v="recovery"===u,w=(0,c.useCallback)(async a=>{if(o.current)return;if(o.current=!0,console.log("[auth-callback] User authenticated:",a.email),console.log("[auth-callback] User metadata:",a.user_metadata),console.log("[auth-callback] IS_RECOVERY_FLOW_DETECTED (module):",!1),console.log("[auth-callback] isRecoveryFromParams:",v),console.log("[auth-callback] Final isRecovery:",v),v){console.log("[auth-callback] Recovery flow CONFIRMED, redirecting to reset-password..."),l("success"),n("Redirecting to reset your password..."),setTimeout(()=>{window.location.href="/versotech_main/reset-password?from=recovery"},1e3);return}let b=p.current||j();try{let c=null,{data:d}=await b.from("profiles").select("role, display_name, password_set").eq("id",a.id).maybeSingle();if(!(c=d)){console.log("[auth-callback] Profile not found, creating it...");let d=a.user_metadata?.display_name||a.user_metadata?.full_name||a.email?.split("@")[0]||"User",e=await fetch("/api/auth/create-profile",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:a.id,email:a.email,displayName:d})});if(!e.ok){let a=await e.json().catch(()=>({}));console.error("[auth-callback] Profile creation failed:",a),l("error"),n("Failed to create profile. Please contact support.");return}let{data:f}=await b.from("profiles").select("role, display_name, password_set").eq("id",a.id).single();c=f||{role:"investor",display_name:d,password_set:!1}}if(console.log("[auth-callback] Profile ready:",c),["staff_admin","staff_ops","staff_rm","ceo"].includes(c.role),!1===c.password_set){console.log("[auth-callback] Password not set, redirecting to set-password page..."),l("success"),n("Please set your password to continue..."),setTimeout(()=>{window.location.href="/versotech_main/set-password"},1500);return}let e="/versotech_main/dashboard";console.log("[auth-callback] Redirecting to unified portal:",e,"for role:",c.role),l("success"),n("Email verified! Redirecting to portal..."),setTimeout(()=>{window.location.href=e},1500)}catch(a){console.error("[auth-callback] Unexpected error:",a),l("error"),n("An unexpected error occurred. Please try again.")}},[v,v]);return(0,c.useEffect)(()=>{if(console.log("[auth-callback:effect] Module-level IS_RECOVERY_FLOW_DETECTED:",!1),console.log("[auth-callback:effect] Module-level CAPTURED_HASH:","empty"),console.log("[auth-callback:effect] Component-level isRecovery:",v),r){console.error("[auth-callback] Error in URL:",r,s),l("error"),n(s||"Authentication failed. Please try again."),setTimeout(()=>{a.push("/versotech_main/login?error=auth_failed")},2e3);return}let b=j();p.current=b,console.log("[auth-callback] Created implicit flow client"),console.log("[auth-callback] Current URL hash:",window.location.hash?"Present (tokens in hash)":"Empty"),console.log("[auth-callback] Code param:",t?"Present (PKCE flow)":"Empty");let{data:{subscription:c}}=b.auth.onAuthStateChange(async(a,b)=>{console.log("[auth-callback] Auth state changed:",a,b?.user?.email,"isRecovery:",v),"SIGNED_IN"===a&&b?.user||"TOKEN_REFRESHED"===a&&b?.user?(b.access_token&&b.refresh_token&&await k(b.access_token,b.refresh_token),w(b.user)):"INITIAL_SESSION"===a&&b?.user&&(console.log("[auth-callback] Initial session detected"),b.access_token&&b.refresh_token&&await k(b.access_token,b.refresh_token),w(b.user))});return setTimeout(async()=>{let{data:{user:c}}=await b.auth.getUser();if(c){console.log("[auth-callback] Found existing session, isRecovery:",v),w(c);return}if(t){console.log("[auth-callback] Exchanging code for session...");let{data:c,error:d}=await b.auth.exchangeCodeForSession(t);if(d){console.error("[auth-callback] Exchange failed:",d),l("error"),n(`Verification error: ${d.message}`),setTimeout(()=>{a.push("/versotech_main/login?error=auth_failed")},3e3);return}if(c?.user)return void w(c.user)}let d=window.location.hash;if(d&&d.includes("access_token")){console.log("[auth-callback] Hash fragment detected, manually extracting tokens from:",d.substring(0,50)+"...");let a=new URLSearchParams(d.substring(1)),c=a.get("access_token"),e=a.get("refresh_token");if(console.log("[auth-callback] Tokens extracted:",{hasAccessToken:!!c,hasRefreshToken:!!e,type:a.get("type")}),c&&e){let{data:a,error:d}=await b.auth.setSession({access_token:c,refresh_token:e});if(d)console.error("[auth-callback] Failed to set session on implicit client:",d);else if(a?.user){console.log("[auth-callback] Session set on implicit client for:",a.user.email),await k(c,e)||console.warn("[auth-callback] Session sync to main client failed, navigation may fail"),w(a.user);return}}await new Promise(a=>setTimeout(a,500));let{data:{user:f}}=await b.auth.getUser();if(f){console.log("[auth-callback] User found after hash processing"),w(f);return}}console.log("[auth-callback] Waiting for auth state change..."),setTimeout(()=>{o.current||(console.error("[auth-callback] Timeout - no authenticated user found"),console.error("[auth-callback] Hash was:",window.location.hash?"Present":"Empty"),console.error("[auth-callback] CAPTURED_HASH was:","Empty"),l("error"),n("Verification failed. The link may have expired or already been used."),setTimeout(()=>{a.push("/versotech_main/login?error=auth_failed")},3e3))},5e3)},200),()=>{c.unsubscribe()}},[r,s,t,u,q,a,w,v]),(0,b.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-slate-50 flex items-center justify-center p-4",children:(0,b.jsxs)("div",{className:"bg-white p-8 rounded-lg shadow-lg max-w-md w-full text-center",children:["loading"===i&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(f.Loader2,{className:"w-16 h-16 mx-auto mb-4 text-blue-600 animate-spin"}),(0,b.jsx)("h1",{className:"text-xl font-bold text-gray-900 mb-2",children:"Verifying Your Email"}),(0,b.jsx)("p",{className:"text-gray-600",children:m})]}),"success"===i&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(g.CheckCircle,{className:"w-16 h-16 mx-auto mb-4 text-green-600"}),(0,b.jsx)("h1",{className:"text-xl font-bold text-gray-900 mb-2",children:"Email Verified!"}),(0,b.jsx)("p",{className:"text-gray-600",children:m})]}),"error"===i&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(h.XCircle,{className:"w-16 h-16 mx-auto mb-4 text-red-600"}),(0,b.jsx)("h1",{className:"text-xl font-bold text-gray-900 mb-2",children:"Verification Failed"}),(0,b.jsx)("p",{className:"text-gray-600 mb-4",children:m}),(0,b.jsx)("button",{onClick:()=>a.push("/"),className:"bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg",children:"Return to Home"})]})]})})}function m(){return(0,b.jsx)(c.Suspense,{fallback:(0,b.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-slate-50 flex items-center justify-center p-4",children:(0,b.jsxs)("div",{className:"bg-white p-8 rounded-lg shadow-lg max-w-md w-full text-center",children:[(0,b.jsx)(f.Loader2,{className:"w-16 h-16 mx-auto mb-4 text-blue-600 animate-spin"}),(0,b.jsx)("h1",{className:"text-xl font-bold text-gray-900 mb-2",children:"Loading..."}),(0,b.jsx)("p",{className:"text-gray-600",children:"Please wait while we verify your email."})]})}),children:(0,b.jsx)(l,{})})}a.s(["default",()=>m])},142368,a=>{a.v(a=>Promise.resolve().then(()=>a(648232)))}];

//# sourceMappingURL=%5Broot-of-the-server%5D__f2fe7ef1._.js.map