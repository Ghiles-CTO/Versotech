{"version":3,"sources":["../../../../../versotech-portal/src/components/staff/commercial-partners/commercial-partner-detail-client.tsx/__nextjs-internal-proxy.mjs","../../../../../versotech-portal/src/app/%28staff%29/versotech/staff/commercial-partners/%5Bid%5D/page.tsx"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport const CommercialPartnerDetailClient = registerClientReference(\n    function() { throw new Error(\"Attempted to call CommercialPartnerDetailClient() from the server but CommercialPartnerDetailClient is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/versotech-portal/src/components/staff/commercial-partners/commercial-partner-detail-client.tsx\",\n    \"CommercialPartnerDetailClient\",\n);\n","import { notFound } from 'next/navigation'\nimport { createServiceClient } from '@/lib/supabase/server'\nimport { CommercialPartnerDetailClient } from '@/components/staff/commercial-partners/commercial-partner-detail-client'\n\nexport const dynamic = 'force-dynamic'\n\ntype PageProps = {\n  params: Promise<{ id: string }>\n}\n\nexport default async function CommercialPartnerDetailPage({ params }: PageProps) {\n  const { id } = await params\n  const supabase = createServiceClient()\n\n  // Fetch commercial partner details\n  const { data: partner, error: partnerError } = await supabase\n    .from('commercial_partners')\n    .select('*')\n    .eq('id', id)\n    .single()\n\n  if (partnerError || !partner) {\n    console.error('Failed to fetch commercial partner:', partnerError)\n    notFound()\n  }\n\n  // Fetch linked users separately to avoid nested join issues\n  const { data: partnerUsers } = await supabase\n    .from('commercial_partner_users')\n    .select(`\n      user_id,\n      role,\n      is_primary,\n      can_sign,\n      can_execute_for_clients,\n      created_at\n    `)\n    .eq('commercial_partner_id', id)\n\n  // Fetch user profiles for the linked users\n  let linkedUsers: Array<{\n    userId: string\n    email: string\n    displayName: string | null\n    title: string | null\n    role: string\n    isPrimary: boolean\n    canSign: boolean\n    canExecuteForClients: boolean\n    createdAt: string\n  }> = []\n\n  if (partnerUsers && partnerUsers.length > 0) {\n    const userIds = partnerUsers.map((pu) => pu.user_id)\n    const { data: profiles } = await supabase\n      .from('profiles')\n      .select('id, email, display_name, title')\n      .in('id', userIds)\n\n    if (profiles) {\n      linkedUsers = partnerUsers.map((pu) => {\n        const profile = profiles.find((p) => p.id === pu.user_id)\n        return {\n          userId: pu.user_id,\n          email: profile?.email || '',\n          displayName: profile?.display_name || null,\n          title: profile?.title || null,\n          role: pu.role,\n          isPrimary: pu.is_primary,\n          canSign: pu.can_sign || false,\n          canExecuteForClients: pu.can_execute_for_clients || false,\n          createdAt: pu.created_at,\n        }\n      })\n    }\n  }\n\n  // Get document count for this commercial partner\n  const { count: documentCount } = await supabase\n    .from('documents')\n    .select('*', { count: 'exact', head: true })\n    .eq('entity_type', 'commercial_partner')\n    .eq('entity_id', id)\n\n  // Transform to client format\n  const partnerData = {\n    id: partner.id,\n    name: partner.name,\n    legal_name: partner.legal_name,\n    type: partner.type,\n    cp_type: partner.cp_type,\n    status: partner.status,\n    regulatory_status: partner.regulatory_status,\n    regulatory_number: partner.regulatory_number,\n    jurisdiction: partner.jurisdiction,\n    contact_name: partner.contact_name,\n    contact_email: partner.contact_email,\n    contact_phone: partner.contact_phone,\n    website: partner.website,\n    address_line_1: partner.address_line_1,\n    address_line_2: partner.address_line_2,\n    city: partner.city,\n    postal_code: partner.postal_code,\n    country: partner.country,\n    payment_terms: partner.payment_terms,\n    contract_start_date: partner.contract_start_date,\n    contract_end_date: partner.contract_end_date,\n    notes: partner.notes,\n    kyc_status: partner.kyc_status,\n    kyc_notes: partner.kyc_notes,\n    kyc_approved_at: partner.kyc_approved_at,\n    kyc_expires_at: partner.kyc_expires_at,\n    logo_url: partner.logo_url,\n    created_at: partner.created_at,\n    updated_at: partner.updated_at,\n  }\n\n  return (\n    <CommercialPartnerDetailClient\n      partner={partnerData}\n      linkedUsers={linkedUsers}\n      documentCount={documentCount || 0}\n    />\n  )\n}\n"],"names":[],"mappings":"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","ignoreList":[0]}