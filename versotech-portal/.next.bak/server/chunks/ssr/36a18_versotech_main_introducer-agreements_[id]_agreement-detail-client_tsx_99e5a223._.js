module.exports=[245270,a=>{"use strict";var b=a.i(352584),c=a.i(611038),d=a.i(289633),e=a.i(497412),f=a.i(284169),g=a.i(15788),h=a.i(421908),i=a.i(877028),j=a.i(479612),k=a.i(191675),l=a.i(249464),m=a.i(975965),n=a.i(203297),o=a.i(724070),p=a.i(438436),q=a.i(42329),r=a.i(399580),s=a.i(625473),t=a.i(873785),u=a.i(933838),v=a.i(877918),w=a.i(278541),x=a.i(439467),y=a.i(231276),z=a.i(325866),A=a.i(816854),B=a.i(3321),C=a.i(446803),D=a.i(264890),E=a.i(899750),F=a.i(201986),G=a.i(888987);function H({status:a,createdAt:c,signedDate:d,ceoSignature:e,introducerSignature:g}){let h=[{id:"created",label:"Agreement Created",description:"Draft agreement prepared",icon:A.FileText,status:"completed",timestamp:c},{id:"sent",label:"Sent to Introducer",description:"Agreement sent for review",icon:t.Send,status:["draft"].includes(a)?"upcoming":"completed",timestamp:null},{id:"approval",label:"Introducer Review",description:"rejected"===a?"Agreement rejected":"Awaiting approval",icon:"rejected"===a?s.XCircle:q.Clock,status:"rejected"===a?"failed":["draft","sent"].includes(a)?"upcoming":"pending_approval"===a?"current":"completed",timestamp:null},{id:"ceo_signature",label:"CEO Signature",description:e?.status==="signed"?`Signed by ${e.signer_name}`:["approved","pending_ceo_signature"].includes(a)?"Awaiting CEO signature":"CEO to sign first",icon:u.PenLine,status:["draft","sent","pending_approval","rejected"].includes(a)?"upcoming":["approved","pending_ceo_signature"].includes(a)?"current":(e?.status,"completed"),timestamp:e?.signature_timestamp},{id:"introducer_signature",label:"Introducer Signature",description:g?.status==="signed"?`Signed by ${g.signer_name}`:"pending_introducer_signature"===a?"Awaiting introducer signature":"Introducer to countersign",icon:u.PenLine,status:["draft","sent","pending_approval","approved","pending_ceo_signature","rejected"].includes(a)?"upcoming":"pending_introducer_signature"===a?"current":g?.status==="signed"||"active"===a?"completed":"upcoming",timestamp:g?.signature_timestamp},{id:"active",label:"Agreement Active",description:"Fee agreement in effect",icon:r.CheckCircle2,status:"active"===a?"completed":"upcoming",timestamp:d}];return(0,b.jsxs)(f.Card,{children:[(0,b.jsx)(f.CardHeader,{children:(0,b.jsxs)(f.CardTitle,{className:"flex items-center gap-2",children:[(0,b.jsx)(q.Clock,{className:"h-5 w-5 text-blue-500"}),"Agreement Timeline"]})}),(0,b.jsx)(f.CardContent,{children:(0,b.jsx)("div",{className:"relative",children:h.map((a,c)=>{let d=(a=>{switch(a.status){case"completed":return{line:"bg-gradient-to-b from-emerald-500 to-emerald-400",circle:"bg-gradient-to-br from-emerald-500 to-green-600 text-white shadow-lg shadow-emerald-500/25",text:"text-foreground",glow:!1};case"current":return{line:"bg-gradient-to-b from-emerald-500 via-amber-400 to-amber-500",circle:"bg-gradient-to-br from-amber-400 to-orange-500 text-white ring-4 ring-amber-400/30 shadow-lg shadow-amber-500/40 animate-pulse",text:"text-foreground font-semibold",glow:!0};case"failed":return{line:"bg-gradient-to-b from-rose-500 to-red-600",circle:"bg-gradient-to-br from-rose-500 to-red-600 text-white shadow-lg shadow-rose-500/25",text:"text-rose-600 dark:text-rose-400 font-medium",glow:!1};default:return{line:"bg-muted/50",circle:"bg-muted/80 text-muted-foreground border-2 border-muted-foreground/20",text:"text-muted-foreground",glow:!1}}})(a),e=a.icon,f=c===h.length-1;return(0,b.jsxs)("div",{className:"flex gap-4 pb-6 last:pb-0 group",children:[(0,b.jsxs)("div",{className:"flex flex-col items-center relative",children:[d.glow&&(0,b.jsx)("div",{className:"absolute inset-0 w-10 h-10 rounded-full bg-amber-400/20 blur-xl animate-pulse"}),(0,b.jsx)("div",{className:(0,G.cn)("relative flex items-center justify-center w-10 h-10 rounded-full shrink-0 transition-all duration-300",d.circle),children:(0,b.jsx)(e,{className:(0,G.cn)("h-5 w-5","current"===a.status&&"drop-shadow-sm")})}),!f&&(0,b.jsx)("div",{className:(0,G.cn)("w-0.5 flex-1 min-h-[28px] mt-2 rounded-full transition-all",d.line)})]}),(0,b.jsxs)("div",{className:(0,G.cn)("flex-1 pt-1.5 transition-all","current"===a.status&&"pl-2 border-l-2 border-amber-400/50 -ml-2"),children:[(0,b.jsx)("p",{className:(0,G.cn)("text-sm font-medium transition-colors",d.text),children:a.label}),(0,b.jsx)("p",{className:(0,G.cn)("text-xs mt-0.5","current"===a.status?"text-amber-600 dark:text-amber-400":"text-muted-foreground"),children:a.description}),a.timestamp&&(0,b.jsxs)("p",{className:"text-xs text-muted-foreground mt-1 flex items-center gap-1",children:[(0,b.jsx)(q.Clock,{className:"h-3 w-3"}),(0,F.formatDate)(a.timestamp)]})]})]},a.id)})})})]})}var I=a.i(518173);let J={draft:{bg:"bg-gray-500/10",text:"text-gray-500",icon:A.FileText},sent:{bg:"bg-blue-500/10",text:"text-blue-500",icon:t.Send},pending_approval:{bg:"bg-yellow-500/10",text:"text-yellow-500",icon:q.Clock},approved:{bg:"bg-emerald-500/10",text:"text-emerald-500",icon:r.CheckCircle2},pending_ceo_signature:{bg:"bg-amber-500/10",text:"text-amber-500",icon:u.PenLine},pending_introducer_signature:{bg:"bg-orange-500/10",text:"text-orange-500",icon:u.PenLine},active:{bg:"bg-green-500/10",text:"text-green-500",icon:r.CheckCircle2},rejected:{bg:"bg-red-500/10",text:"text-red-500",icon:s.XCircle},expired:{bg:"bg-gray-500/10",text:"text-gray-500",icon:v.AlertCircle},terminated:{bg:"bg-red-500/10",text:"text-red-500",icon:s.XCircle}},K={draft:"Draft",sent:"Sent to Introducer",pending_approval:"Pending Approval",approved:"Approved - Awaiting Signatures",pending_ceo_signature:"Awaiting CEO Signature",pending_introducer_signature:"Awaiting Introducer Signature",active:"Active",rejected:"Rejected",expired:"Expired",terminated:"Terminated"};function L({agreement:a,isStaff:q,currentUserId:v}){var L;let M=(0,d.useRouter)(),[N,O]=(0,c.useState)(null),[P,Q]=(0,c.useState)(""),[R,S]=(0,c.useState)(!1),[T,U]=(0,c.useState)(!1),[V,W]=(0,c.useState)(null),[X,Y]=(0,c.useState)(!1),[Z,$]=(0,c.useState)(null),_=async()=>{let b="active"===a.status,c=b&&a.signed_pdf_url?a.signed_pdf_url:a.pdf_url,d=b&&a.signed_pdf_url?"signatures":"deal-documents";if(c){S(!0);try{let b=await fetch(`/api/storage/download?path=${encodeURIComponent(c)}&bucket=${d}`);if(!b.ok)throw Error("Failed to download file");let e=await b.blob(),f=window.URL.createObjectURL(e),g=document.createElement("a");g.href=f,g.download=`${a.reference_number||"Fee_Agreement"}.pdf`,document.body.appendChild(g),g.click(),document.body.removeChild(g),window.URL.revokeObjectURL(f),E.toast.success("PDF downloaded successfully")}catch(a){console.error("Error downloading PDF:",a),E.toast.error("Failed to download PDF")}finally{S(!1)}}},aa=async()=>{let b="active"===a.status,c=b&&a.signed_pdf_url?a.signed_pdf_url:a.pdf_url,d=b&&a.signed_pdf_url?"signatures":"deal-documents";if(c){Y(!0),$(null),U(!0);try{let a=await fetch(`/api/storage/signed-url?path=${encodeURIComponent(c)}&bucket=${d}`);if(!a.ok)throw Error("Failed to get preview URL");let b=await a.json();W(b.signedUrl)}catch(a){console.error("Error loading PDF preview:",a),$("Failed to load PDF preview"),E.toast.error("Failed to load PDF preview")}finally{Y(!1)}}},ab=J[a.status]||J.draft,ac=ab.icon,ad=async()=>{O("send");try{let b=await fetch(`/api/introducer-agreements/${a.id}/send`,{method:"POST"});if(!b.ok){let a=await b.json();throw Error(a.error||"Failed to send agreement")}E.toast.success("Agreement sent to introducer for approval"),M.refresh()}catch(a){E.toast.error(a instanceof Error?a.message:"Failed to send agreement")}finally{O(null)}},ae=async()=>{O("approve");try{let b=await fetch(`/api/introducer-agreements/${a.id}/approve`,{method:"POST"});if(!b.ok){let a=await b.json();throw Error(a.error||"Failed to approve agreement")}E.toast.success("Agreement approved! CEO will be notified to sign."),M.refresh()}catch(a){E.toast.error(a instanceof Error?a.message:"Failed to approve agreement")}finally{O(null)}},af=async()=>{O("reject");try{let b=await fetch(`/api/introducer-agreements/${a.id}/reject`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({reason:P})});if(!b.ok){let a=await b.json();throw Error(a.error||"Failed to reject agreement")}E.toast.success("Agreement rejected"),M.refresh()}catch(a){E.toast.error(a instanceof Error?a.message:"Failed to reject agreement")}finally{O(null),Q("")}};return(0,b.jsxs)("div",{className:"p-6 space-y-6 max-w-5xl mx-auto",children:[(0,b.jsxs)("div",{className:"flex items-start justify-between",children:[(0,b.jsxs)("div",{className:"flex items-center gap-4",children:[(0,b.jsx)(h.Button,{variant:"ghost",size:"icon",asChild:!0,className:"rounded-full",children:(0,b.jsx)(e.default,{href:"/versotech_main/introducer-agreements",children:(0,b.jsx)(m.ArrowLeft,{className:"h-5 w-5"})})}),(0,b.jsxs)("div",{children:[(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("h1",{className:"text-2xl font-bold text-foreground",children:"Fee Agreement"}),(0,b.jsxs)(g.Badge,{variant:"outline",className:(0,G.cn)("capitalize",ab.bg,ab.text),children:[(0,b.jsx)(ac,{className:"h-3 w-3 mr-1"}),K[a.status]||a.status]})]}),(0,b.jsxs)("p",{className:"text-muted-foreground mt-1",children:["Agreement with ",a.introducer?.legal_name,a.reference_number&&(0,b.jsxs)("span",{className:"ml-2 text-xs font-mono text-muted-foreground/70",children:["(",a.reference_number,")"]})]})]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[q&&"draft"===a.status&&(0,b.jsxs)(h.Button,{onClick:ad,disabled:"send"===N,className:"bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-500 hover:to-indigo-500",children:["send"===N?(0,b.jsx)(B.Loader2,{className:"h-4 w-4 mr-2 animate-spin"}):(0,b.jsx)(t.Send,{className:"h-4 w-4 mr-2"}),"Send to Introducer"]}),!q&&"pending_approval"===a.status&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)(j.AlertDialog,{children:[(0,b.jsx)(j.AlertDialogTrigger,{asChild:!0,children:(0,b.jsxs)(h.Button,{variant:"outline",className:"border-red-500/30 text-red-500 hover:bg-red-500/10",children:[(0,b.jsx)(s.XCircle,{className:"h-4 w-4 mr-2"}),"Reject"]})}),(0,b.jsxs)(j.AlertDialogContent,{children:[(0,b.jsxs)(j.AlertDialogHeader,{children:[(0,b.jsx)(j.AlertDialogTitle,{children:"Reject Agreement?"}),(0,b.jsx)(j.AlertDialogDescription,{children:"Are you sure you want to reject this fee agreement? You can provide a reason below."})]}),(0,b.jsxs)("div",{className:"py-4",children:[(0,b.jsx)(l.Label,{htmlFor:"reject-reason",children:"Reason (optional)"}),(0,b.jsx)(k.Textarea,{id:"reject-reason",placeholder:"Enter reason for rejection...",value:P,onChange:a=>Q(a.target.value),className:"mt-2"})]}),(0,b.jsxs)(j.AlertDialogFooter,{children:[(0,b.jsx)(j.AlertDialogCancel,{children:"Cancel"}),(0,b.jsx)(j.AlertDialogAction,{onClick:af,className:"bg-red-600 hover:bg-red-700",disabled:"reject"===N,children:"reject"===N?"Rejecting...":"Reject Agreement"})]})]})]}),(0,b.jsxs)(h.Button,{onClick:ae,disabled:"approve"===N,className:"bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-500 hover:to-emerald-500",children:["approve"===N?(0,b.jsx)(B.Loader2,{className:"h-4 w-4 mr-2 animate-spin"}):(0,b.jsx)(r.CheckCircle2,{className:"h-4 w-4 mr-2"}),"Approve Agreement"]})]}),q&&"approved"===a.status&&(0,b.jsx)(h.Button,{asChild:!0,className:"bg-gradient-to-r from-amber-600 to-orange-600 hover:from-amber-500 hover:to-orange-500",children:(0,b.jsxs)(e.default,{href:`/versotech_main/versosign?agreement=${a.id}`,children:[(0,b.jsx)(u.PenLine,{className:"h-4 w-4 mr-2"}),"Sign Agreement"]})}),!q&&"pending_introducer_signature"===a.status&&(0,b.jsx)(h.Button,{asChild:!0,className:"bg-gradient-to-r from-amber-600 to-orange-600 hover:from-amber-500 hover:to-orange-500",children:(0,b.jsxs)(e.default,{href:`/versotech_main/versosign?agreement=${a.id}`,children:[(0,b.jsx)(u.PenLine,{className:"h-4 w-4 mr-2"}),"Sign Agreement"]})}),(a.pdf_url||a.signed_pdf_url)&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)(h.Button,{variant:"outline",onClick:aa,disabled:X,className:"border-emerald-500/30 text-emerald-600 hover:bg-emerald-500/10",children:[X?(0,b.jsx)(B.Loader2,{className:"h-4 w-4 mr-2 animate-spin"}):(0,b.jsx)(D.Eye,{className:"h-4 w-4 mr-2"}),"Preview"]}),(0,b.jsxs)(h.Button,{variant:"outline",onClick:_,disabled:R,className:"border-blue-500/30 text-blue-500 hover:bg-blue-500/10",children:[R?(0,b.jsx)(B.Loader2,{className:"h-4 w-4 mr-2 animate-spin"}):(0,b.jsx)(C.FileDown,{className:"h-4 w-4 mr-2"}),"active"===a.status?"Download Signed Agreement":"Download PDF"]})]})]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,b.jsxs)("div",{className:"lg:col-span-2 space-y-6",children:[(0,b.jsxs)(f.Card,{children:[(0,b.jsx)(f.CardHeader,{children:(0,b.jsxs)(f.CardTitle,{className:"flex items-center gap-2",children:[(0,b.jsx)(n.FileSignature,{className:"h-5 w-5 text-amber-500"}),"Agreement Details"]})}),(0,b.jsxs)(f.CardContent,{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-6",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(l.Label,{className:"text-muted-foreground text-sm",children:"Commission Rate"}),(0,b.jsxs)("div",{className:"flex items-center gap-2 mt-1",children:[(0,b.jsx)(p.Percent,{className:"h-4 w-4 text-muted-foreground"}),(0,b.jsx)("span",{className:"text-lg font-semibold",children:null===(L=a.default_commission_bps)?"Not set":`${(L/100).toFixed(2)}%`}),a.default_commission_bps&&(0,b.jsxs)("span",{className:"text-sm text-muted-foreground",children:["(",a.default_commission_bps," bps)"]})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(l.Label,{className:"text-muted-foreground text-sm",children:"Agreement Type"}),(0,b.jsxs)("div",{className:"flex items-center gap-2 mt-1",children:[(0,b.jsx)(n.FileSignature,{className:"h-4 w-4 text-muted-foreground"}),(0,b.jsx)("span",{className:"font-medium capitalize",children:a.agreement_type?.replace(/_/g," ")||"Not set"})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(l.Label,{className:"text-muted-foreground text-sm",children:"Effective Date"}),(0,b.jsxs)("div",{className:"flex items-center gap-2 mt-1",children:[(0,b.jsx)(o.Calendar,{className:"h-4 w-4 text-muted-foreground"}),(0,b.jsx)("span",{className:"font-medium",children:a.effective_date?(0,F.formatDate)(a.effective_date):"Not set"})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(l.Label,{className:"text-muted-foreground text-sm",children:"Expiry Date"}),(0,b.jsxs)("div",{className:"flex items-center gap-2 mt-1",children:[(0,b.jsx)(o.Calendar,{className:"h-4 w-4 text-muted-foreground"}),(0,b.jsx)("span",{className:"font-medium",children:a.expiry_date?(0,F.formatDate)(a.expiry_date):"No expiry"})]})]}),a.territory&&(0,b.jsxs)("div",{children:[(0,b.jsx)(l.Label,{className:"text-muted-foreground text-sm",children:"Territory"}),(0,b.jsx)("div",{className:"flex items-center gap-2 mt-1",children:(0,b.jsx)("span",{className:"font-medium",children:a.territory})})]}),a.payment_terms&&(0,b.jsxs)("div",{children:[(0,b.jsx)(l.Label,{className:"text-muted-foreground text-sm",children:"Payment Terms"}),(0,b.jsx)("div",{className:"flex items-center gap-2 mt-1",children:(0,b.jsx)("span",{className:"font-medium capitalize",children:a.payment_terms.replace(/_/g," ")})})]})]}),"active"===a.status&&a.signed_date&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(i.Separator,{}),(0,b.jsx)("div",{className:"flex items-center justify-between p-4 bg-green-500/10 rounded-lg border border-green-500/20",children:(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("div",{className:"p-2 bg-green-500/20 rounded-lg",children:(0,b.jsx)(A.FileText,{className:"h-5 w-5 text-green-500"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"font-medium text-green-700 dark:text-green-400",children:"Agreement Active"}),(0,b.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Fully signed on ",(0,F.formatDate)(a.signed_date)]})]})]})})]})]})]}),(0,b.jsx)(H,{status:a.status,createdAt:a.created_at,signedDate:a.signed_date,ceoSignature:a.ceo_signature_request,introducerSignature:a.introducer_signature_request})]}),(0,b.jsx)("div",{className:"space-y-6",children:(0,b.jsxs)(f.Card,{children:[(0,b.jsx)(f.CardHeader,{children:(0,b.jsxs)(f.CardTitle,{className:"flex items-center gap-2",children:[(0,b.jsx)(w.Building2,{className:"h-5 w-5 text-blue-500"}),"Introducer"]})}),(0,b.jsxs)(f.CardContent,{className:"space-y-4",children:[a.introducer?.logo_url&&(0,b.jsx)("div",{className:"flex justify-center",children:(0,b.jsx)("img",{src:a.introducer.logo_url,alt:a.introducer.legal_name,className:"h-16 w-auto object-contain"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"font-semibold text-lg",children:a.introducer?.legal_name}),(0,b.jsx)(g.Badge,{variant:"outline",className:(0,G.cn)("mt-1 capitalize",a.introducer?.status==="active"?"bg-green-500/10 text-green-500":"bg-gray-500/10 text-gray-500"),children:a.introducer?.status})]}),(0,b.jsx)(i.Separator,{}),a.introducer?.contact_name&&(0,b.jsxs)("div",{className:"flex items-center gap-3 text-sm",children:[(0,b.jsx)(z.User,{className:"h-4 w-4 text-muted-foreground"}),(0,b.jsx)("span",{children:a.introducer.contact_name})]}),a.introducer?.email&&(0,b.jsxs)("div",{className:"flex items-center gap-3 text-sm",children:[(0,b.jsx)(x.Mail,{className:"h-4 w-4 text-muted-foreground"}),(0,b.jsx)("a",{href:`mailto:${a.introducer.email}`,className:"text-blue-500 hover:underline",children:a.introducer.email})]}),a.introducer?.phone&&(0,b.jsxs)("div",{className:"flex items-center gap-3 text-sm",children:[(0,b.jsx)(y.Phone,{className:"h-4 w-4 text-muted-foreground"}),(0,b.jsx)("span",{children:a.introducer.phone})]}),q&&(0,b.jsx)(h.Button,{variant:"outline",size:"sm",className:"w-full mt-2",asChild:!0,children:(0,b.jsx)(e.default,{href:`/versotech_main/introducers/${a.introducer_id}`,children:"View Introducer Profile"})})]})]})})]}),(0,b.jsx)(I.DocumentViewerFullscreen,{isOpen:T,document:{id:a.id,name:`${a.reference_number||"Fee_Agreement"}.pdf`,file_name:`${a.reference_number||"Fee_Agreement"}.pdf`,type:"introducer_agreement"},previewUrl:V,isLoading:X,error:Z,onClose:()=>{U(!1),setTimeout(()=>{W(null),$(null)},300)},onDownload:_})]})}a.s(["AgreementDetailClient",()=>L],245270)}];

//# sourceMappingURL=36a18_versotech_main_introducer-agreements_%5Bid%5D_agreement-detail-client_tsx_99e5a223._.js.map