module.exports=[864775,a=>{"use strict";var b=a.i(352584),c=a.i(611038),d=a.i(468095),e=a.i(641428),f=a.i(908513),g=a.i(643232),h=a.i(975965),i=a.i(416986),j=a.i(421908),k=a.i(216316),l=a.i(672606),m=a.i(905219),n=a.i(888987);function o({currentFolder:a,onNavigate:d,className:e}){let f=c.default.useMemo(()=>{if(!a)return[];let b=a.path.split("/").filter(Boolean),c=[],d="";return b.forEach((e,f)=>{d+=`/${e}`,c.push({id:f===b.length-1?a.id:null,name:e,path:d})}),c},[a]),g=f.length>3?[...f.slice(0,1),{id:"...",name:"...",path:"..."},...f.slice(-2)]:f;return(0,b.jsxs)("nav",{className:(0,n.cn)("flex items-center gap-2 px-6 py-3.5","bg-black/40 border-b border-white/10","transition-colors duration-200",e),"aria-label":"Folder navigation breadcrumbs",children:[(0,b.jsx)("button",{onClick:()=>d(null),className:(0,n.cn)("inline-flex items-center justify-center","w-8 h-8 rounded-md","transition-all duration-150",a?"text-gray-400 hover:bg-white/10 hover:text-white":"bg-blue-500/20 text-blue-400 border border-blue-400/30","focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2"),"aria-label":"Navigate to root","aria-current":a?void 0:"page",children:(0,b.jsx)(i.Home,{className:"w-4 h-4",strokeWidth:2})}),g.map((a,e)=>{let f=e===g.length-1,h="..."===a.id;return(0,b.jsxs)(c.Fragment,{children:[(0,b.jsx)(l.ChevronRight,{className:"w-4 h-4 text-gray-600 flex-shrink-0",strokeWidth:2,"aria-hidden":"true"}),h?(0,b.jsx)("span",{className:"text-sm text-gray-500 px-2 select-none",children:a.name}):f?(0,b.jsxs)("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-white/5 border border-white/10 rounded-md",children:[(0,b.jsx)(m.Folder,{className:"w-3.5 h-3.5 text-blue-400 flex-shrink-0",strokeWidth:2}),(0,b.jsx)("span",{className:"text-sm font-medium text-white truncate max-w-[200px]",children:a.name})]}):(0,b.jsx)("button",{onClick:()=>{d(a.id)},className:(0,n.cn)("text-sm text-gray-400 px-3 py-1.5 rounded-md","hover:text-white hover:bg-white/10","focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2","transition-all duration-150","truncate max-w-[160px]"),title:a.name,children:a.name})]},a.id||e)}),a&&(0,b.jsxs)("div",{className:"ml-auto hidden lg:flex items-center gap-2 text-xs text-gray-400 font-mono",children:[(0,b.jsx)("span",{className:"opacity-60",children:"Path:"}),(0,b.jsx)("span",{className:"px-2 py-1 bg-white/5 rounded border border-white/10 text-gray-300",children:a.path})]})]})}var p=a.i(941766),q=a.i(487068),r=a.i(95799);let s=(0,r.default)("grid-3x3",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"M15 3v18",key:"14nvp0"}]]);var t=a.i(292944),u=a.i(294565),v=a.i(264634),w=a.i(405398),x=a.i(134303);let y={vehicle_root:{bg:"bg-navy-50",border:"border-navy-200",icon:"text-navy-700",hoverBg:"group-hover:bg-navy-100",hoverBorder:"group-hover:border-navy-300"},category:{bg:"bg-slate-50",border:"border-slate-200",icon:"text-slate-600",hoverBg:"group-hover:bg-slate-100",hoverBorder:"group-hover:border-slate-300"},custom:{bg:"bg-slate-50",border:"border-slate-200",icon:"text-slate-500",hoverBg:"group-hover:bg-slate-100",hoverBorder:"group-hover:border-slate-300"}};function z({folder:a,onNavigate:d,onRename:f,onDelete:g,onCreateSubfolder:h,className:i,variant:j="default"}){let[o,q]=c.default.useState(!1),[r,s]=c.default.useState(!1),t=y[a.folder_type]||y.custom,u=b=>{("Enter"===b.key||" "===b.key)&&(b.preventDefault(),d(a.id))};return"compact"===j?(0,b.jsxs)("button",{onClick:()=>d(a.id),onKeyDown:u,className:(0,n.cn)("group flex items-center gap-3 w-full","px-4 py-3 rounded-md","hover:bg-white/10 transition-colors duration-150","focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-1",i),children:[(0,b.jsx)(m.Folder,{className:"w-5 h-5 text-blue-400 flex-shrink-0",strokeWidth:2}),(0,b.jsx)("span",{className:"text-sm font-medium text-white flex-1 text-left break-words line-clamp-1",children:a.name}),(0,b.jsx)(l.ChevronRight,{className:"w-4 h-4 text-gray-400 opacity-0 group-hover:opacity-100 transition-opacity flex-shrink-0"})]}):(0,b.jsxs)("div",{className:(0,n.cn)("group relative","bg-white/5 border border-white/10 rounded-lg","hover:bg-white/10 hover:border-white/20","transition-all duration-200","cursor-pointer",i),onMouseEnter:()=>q(!0),onMouseLeave:()=>q(!1),onClick:()=>d(a.id),onKeyDown:u,role:"button",tabIndex:0,"aria-label":`Navigate to folder ${a.name}`,children:[(0,b.jsx)("div",{className:"p-5",children:(0,b.jsxs)("div",{className:"flex items-start gap-4",children:[(0,b.jsx)("div",{className:(0,n.cn)("w-14 h-14 rounded-lg border flex items-center justify-center","flex-shrink-0 transition-all duration-200",t.bg,t.border,t.hoverBg,t.hoverBorder),children:o?(0,b.jsx)(p.FolderOpen,{className:(0,n.cn)("w-6 h-6",t.icon),strokeWidth:2}):(0,b.jsx)(m.Folder,{className:(0,n.cn)("w-6 h-6",t.icon),strokeWidth:2})}),(0,b.jsxs)("div",{className:"flex-1 min-w-0 overflow-hidden",children:[(0,b.jsx)("h3",{className:"font-semibold text-white text-sm leading-tight mb-2 break-words line-clamp-2",children:a.name}),(0,b.jsxs)("div",{className:"flex items-center gap-3 text-sm text-gray-400",children:[void 0!==a.subfolder_count&&(0,b.jsxs)("span",{className:"inline-flex items-center gap-1.5",children:[(0,b.jsx)(m.Folder,{className:"w-3.5 h-3.5",strokeWidth:2}),(0,b.jsx)("span",{children:a.subfolder_count})]}),void 0!==a.document_count&&(0,b.jsxs)("span",{className:"inline-flex items-center gap-1.5",children:[(0,b.jsx)("span",{className:"w-3.5 h-3.5 inline-flex items-center justify-center",children:(0,b.jsx)("svg",{viewBox:"0 0 16 16",fill:"none",className:"w-3.5 h-3.5 text-gray-400",strokeWidth:2,children:(0,b.jsx)("path",{d:"M9 1H3a1 1 0 00-1 1v12a1 1 0 001 1h10a1 1 0 001-1V6M9 1l5 5M9 1v5h5",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"})})}),(0,b.jsx)("span",{children:a.document_count})]})]}),"vehicle_root"===a.folder_type&&(0,b.jsx)("div",{className:"mt-2",children:(0,b.jsx)("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-blue-500/20 text-blue-200 border border-blue-400/30",children:"Vehicle Root"})})]}),(f||g||h)&&(0,b.jsxs)(k.DropdownMenu,{open:r,onOpenChange:s,children:[(0,b.jsxs)(k.DropdownMenuTrigger,{className:(0,n.cn)("opacity-0 group-hover:opacity-100 transition-opacity duration-150","p-1 rounded hover:bg-white/10","focus:outline-none focus:ring-2 focus:ring-blue-500",r&&"opacity-100"),onClick:a=>{a.stopPropagation()},children:[(0,b.jsx)(v.MoreVertical,{className:"w-4 h-4 text-gray-400",strokeWidth:2}),(0,b.jsx)("span",{className:"sr-only",children:"Folder actions"})]}),(0,b.jsxs)(k.DropdownMenuContent,{align:"end",className:"w-48 bg-zinc-900 border-white/10",children:[h&&(0,b.jsxs)(k.DropdownMenuItem,{onClick:b=>{b.stopPropagation(),h(a.id)},className:"text-gray-200 focus:bg-white/10 focus:text-white",children:[(0,b.jsx)(e.FolderPlus,{className:"w-4 h-4 mr-2 text-blue-400",strokeWidth:2}),(0,b.jsx)("span",{children:"New Subfolder"})]}),f&&(0,b.jsxs)(k.DropdownMenuItem,{onClick:b=>{b.stopPropagation(),f(a.id)},className:"text-gray-200 focus:bg-white/10 focus:text-white",children:[(0,b.jsx)(w.Edit,{className:"w-4 h-4 mr-2 text-gray-400",strokeWidth:2}),(0,b.jsx)("span",{children:"Rename"})]}),g&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(k.DropdownMenuSeparator,{className:"bg-white/10"}),(0,b.jsxs)(k.DropdownMenuItem,{onClick:b=>{b.stopPropagation(),g(a.id)},className:"text-red-400 focus:text-red-300 focus:bg-red-500/20",children:[(0,b.jsx)(x.Trash2,{className:"w-4 h-4 mr-2",strokeWidth:2}),(0,b.jsx)("span",{children:"Delete"})]})]})]})]})]})}),(0,b.jsx)("div",{className:(0,n.cn)("absolute bottom-0 left-0 right-0 h-0.5 bg-blue-500","transform scale-x-0 group-hover:scale-x-100","transition-transform duration-200 origin-left","rounded-b-lg")})]})}function A({className:a}){return(0,b.jsx)("div",{className:(0,n.cn)("bg-white/5 border border-white/10 rounded-lg p-4","animate-pulse",a),children:(0,b.jsxs)("div",{className:"flex items-start gap-3",children:[(0,b.jsx)("div",{className:"w-11 h-11 rounded-lg bg-white/10 flex-shrink-0"}),(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsx)("div",{className:"h-4 bg-white/10 rounded w-3/4 mb-2"}),(0,b.jsx)("div",{className:"h-3 bg-white/10 rounded w-1/2"})]})]})})}var B=a.i(883668),C=a.i(663475),D=a.i(951870);function E({currentFolderId:a,currentFolder:c,subfolders:d,documents:e,isLoading:f=!1,viewMode:g="grid",sortBy:h="name",onNavigateToFolder:i,onDocumentClick:j,onUploadClick:k,onCreateFolderClick:l,onRenameFolder:m,onDeleteFolder:o,onCreateSubfolder:p,onRenameDocument:r,onDeleteDocument:v,onViewModeChange:w,onSortChange:x,onSearchChange:y,searchQuery:E="",className:G}){let H=!f&&0===d.length&&0===e.length;return d.length>0||e.length,(0,b.jsxs)("div",{className:(0,n.cn)("flex flex-col h-full bg-[#0a0a0a]",G),children:[(0,b.jsxs)("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4 px-6 py-4 bg-black/40 border-b border-white/10",children:[(0,b.jsxs)("div",{className:"relative w-full sm:w-auto sm:min-w-[300px]",children:[(0,b.jsx)(q.Search,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400",strokeWidth:2}),(0,b.jsx)(C.Input,{type:"text",placeholder:"Search folders and documents...",value:E,onChange:a=>y?.(a.target.value),className:"pl-10 h-9 text-sm bg-white/5 border-white/10 text-white placeholder:text-gray-500 focus:border-blue-500 focus:ring-blue-500"})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2 w-full sm:w-auto",children:[(0,b.jsxs)(D.Select,{value:h,onValueChange:a=>x?.(a),children:[(0,b.jsxs)(D.SelectTrigger,{className:"w-[140px] h-9 text-sm bg-white/5 border-white/10 text-white",children:[(0,b.jsx)(u.ArrowUpDown,{className:"w-3.5 h-3.5 mr-2 text-gray-400",strokeWidth:2}),(0,b.jsx)(D.SelectValue,{})]}),(0,b.jsxs)(D.SelectContent,{className:"bg-zinc-900 border-white/10 text-white",children:[(0,b.jsx)(D.SelectItem,{value:"name",className:"text-white focus:bg-white/10 focus:text-white",children:"Name"}),(0,b.jsx)(D.SelectItem,{value:"date",className:"text-white focus:bg-white/10 focus:text-white",children:"Date Modified"}),(0,b.jsx)(D.SelectItem,{value:"type",className:"text-white focus:bg-white/10 focus:text-white",children:"Type"})]})]}),w&&(0,b.jsxs)("div",{className:"flex items-center border border-white/10 rounded-md overflow-hidden",children:[(0,b.jsx)("button",{onClick:()=>w("grid"),className:(0,n.cn)("p-1.5 transition-colors","grid"===g?"bg-blue-500/20 text-blue-400":"text-gray-400 hover:bg-white/10"),"aria-label":"Grid view",children:(0,b.jsx)(s,{className:"w-4 h-4",strokeWidth:2})}),(0,b.jsx)("div",{className:"w-px h-6 bg-white/10"}),(0,b.jsx)("button",{onClick:()=>w("list"),className:(0,n.cn)("p-1.5 transition-colors","list"===g?"bg-blue-500/20 text-blue-400":"text-gray-400 hover:bg-white/10"),"aria-label":"List view",children:(0,b.jsx)(t.List,{className:"w-4 h-4",strokeWidth:2})})]})]})]}),(0,b.jsxs)("div",{className:"flex-1 overflow-auto",children:[f&&(0,b.jsx)("div",{className:"p-6",children:(0,b.jsx)("div",{className:(0,n.cn)("grid gap-4","grid"===g?"grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4":"grid-cols-1"),children:Array.from({length:8}).map((a,c)=>(0,b.jsx)(A,{},c))})}),H&&!f&&(0,b.jsx)(F,{onUploadClick:k,onCreateFolderClick:l}),!H&&!f&&(0,b.jsxs)("div",{className:"p-6 space-y-8",children:[d.length>0&&(0,b.jsxs)("div",{children:[(0,b.jsxs)("div",{className:"flex items-center gap-3 mb-4",children:[(0,b.jsx)("h2",{className:"text-sm font-semibold text-gray-400 uppercase tracking-wider",children:"Folders"}),(0,b.jsx)("div",{className:"flex-1 h-px bg-white/10"}),(0,b.jsx)("span",{className:"text-xs text-gray-500",children:d.length})]}),(0,b.jsx)("div",{className:(0,n.cn)("grid gap-4","grid"===g?"grid-cols-1 md:grid-cols-2 xl:grid-cols-4":"grid-cols-1 max-w-4xl"),children:d.map(a=>(0,b.jsx)(z,{folder:a,onNavigate:i,onRename:m,onDelete:o,onCreateSubfolder:p,variant:"list"===g?"compact":"default"},a.id))})]}),e.length>0&&(0,b.jsxs)("div",{children:[(0,b.jsxs)("div",{className:"flex items-center gap-3 mb-4",children:[(0,b.jsx)("h2",{className:"text-sm font-semibold text-gray-400 uppercase tracking-wider",children:"Documents"}),(0,b.jsx)("div",{className:"flex-1 h-px bg-white/10"}),(0,b.jsx)("span",{className:"text-xs text-gray-500",children:e.length})]}),(0,b.jsx)("div",{className:(0,n.cn)("grid gap-4","grid"===g?"grid-cols-1 md:grid-cols-2 xl:grid-cols-4":"grid-cols-1 max-w-4xl"),children:e.map(a=>(0,b.jsx)(B.DocumentCard,{document:a,onPreview:()=>j(a.id),onRename:r,onDelete:v,variant:"list"===g?"compact":"default"},a.id))})]})]})]})]})}function F({onUploadClick:a,onCreateFolderClick:c}){return(0,b.jsxs)("div",{className:"flex flex-col items-center justify-center py-16 px-4",children:[(0,b.jsx)("div",{className:"w-20 h-20 rounded-full bg-white/5 flex items-center justify-center mb-6 border border-white/10",children:(0,b.jsx)(p.FolderOpen,{className:"w-10 h-10 text-gray-400",strokeWidth:1.5})}),(0,b.jsx)("h3",{className:"text-lg font-semibold text-white mb-2",children:"This folder is empty"}),(0,b.jsx)("p",{className:"text-sm text-gray-400 mb-8 text-center max-w-md leading-relaxed",children:"Get started by uploading documents or creating subfolders to organize your files."}),(0,b.jsxs)("div",{className:"flex flex-col sm:flex-row gap-3",children:[(0,b.jsxs)(j.Button,{onClick:a,size:"default",className:"min-w-[160px] bg-blue-600 hover:bg-blue-700 text-white",children:[(0,b.jsx)(d.Upload,{className:"w-4 h-4 mr-2",strokeWidth:2}),"Upload Documents"]}),(0,b.jsxs)(j.Button,{onClick:c,variant:"outline",size:"default",className:"min-w-[160px] border-white/20 text-white hover:bg-white/10",children:[(0,b.jsx)(e.FolderPlus,{className:"w-4 h-4 mr-2",strokeWidth:2}),"New Folder"]})]})]})}var G=a.i(168118),H=a.i(823879),I=a.i(140561),J=a.i(537412);function K({open:a,onOpenChange:d,folders:e,currentFolderId:f,onNavigate:g}){let[h,i]=(0,c.useState)(new Set),[j,k]=(0,c.useState)(""),l=(0,c.useMemo)(()=>{var a;let b;return a=e,b=new Map,a.forEach(a=>{b.has(a.parent_folder_id)||b.set(a.parent_folder_id,[]),b.get(a.parent_folder_id).push({folder:a,children:[]})}),function a(c){return(b.get(c)||[]).map(b=>({...b,children:a(b.folder.id)}))}(null)},[e]),o=(0,c.useMemo)(()=>j.trim()?function a(b,c){return b.map(b=>{let d=b.folder.name.toLowerCase().includes(c),e=b.folder.path.toLowerCase().includes(c),f=a(b.children,c);return d||e||f.length>0?{...b,children:f}:null}).filter(a=>null!==a)}(l,j.toLowerCase()):l,[l,j]),p=a=>{let b=new Set(h);b.has(a)?b.delete(a):b.add(a),i(b)},r=a=>{g(a),d(!1)};return c.default.useEffect(()=>{if(f&&e.length>0){let a=e.find(a=>a.id===f);if(a){let b=function(a,b){let c=[],d=a;for(;d?.parent_folder_id;)c.push(d.parent_folder_id),d=b.find(a=>a.id===d.parent_folder_id);return c}(a,e);i(a=>new Set([...a,...b]))}}},[f,e]),(0,b.jsx)(I.Sheet,{open:a,onOpenChange:d,children:(0,b.jsxs)(I.SheetContent,{side:"left",className:"w-[400px] sm:w-[500px] p-0 bg-background border-border",children:[(0,b.jsxs)(I.SheetHeader,{className:"px-6 py-4 border-b border-border",children:[(0,b.jsx)(I.SheetTitle,{className:"text-foreground",children:"Browse All Folders"}),(0,b.jsx)(I.SheetDescription,{className:"text-muted-foreground",children:"Quick access to any folder in the hierarchy"})]}),(0,b.jsx)("div",{className:"px-6 py-4 border-b border-border bg-muted/50",children:(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)(q.Search,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-muted-foreground",strokeWidth:2}),(0,b.jsx)(C.Input,{type:"text",placeholder:"Search folders...",value:j,onChange:a=>k(a.target.value),className:"pl-10 pr-10 h-9 text-sm"}),j&&(0,b.jsx)("button",{onClick:()=>k(""),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-muted-foreground hover:text-foreground transition-colors",children:(0,b.jsx)(H.X,{className:"w-4 h-4",strokeWidth:2})})]})}),(0,b.jsx)(J.ScrollArea,{className:"flex-1 h-[calc(100vh-180px)]",children:(0,b.jsxs)("div",{className:"px-4 py-4",children:[(0,b.jsxs)("button",{onClick:()=>r(null),className:(0,n.cn)("flex items-center gap-2 w-full px-3 py-2 rounded-md text-sm font-medium transition-colors",null===f?"bg-primary/20 text-primary border border-primary":"text-muted-foreground hover:bg-muted border border-transparent"),children:[(0,b.jsx)(m.Folder,{className:"w-4 h-4 flex-shrink-0",strokeWidth:2}),(0,b.jsx)("span",{children:"All Documents (Root)"})]}),(0,b.jsx)("div",{className:"mt-2 space-y-0.5",children:o.map(a=>(0,b.jsx)(L,{node:a,level:0,currentFolderId:f,expandedFolders:h,onToggle:p,onNavigate:r},a.folder.id))}),0===o.length&&(0,b.jsx)("div",{className:"text-center py-8 text-sm text-muted-foreground",children:j?"No folders match your search":"No folders found"})]})}),(0,b.jsx)("div",{className:"px-6 py-3 border-t border-border bg-muted/50",children:(0,b.jsxs)("p",{className:"text-xs text-muted-foreground",children:[(0,b.jsx)("kbd",{className:"px-1.5 py-0.5 bg-muted border border-border rounded text-xs font-mono text-foreground",children:"Cmd+K"})," ","to open this drawer"]})})]})})}function L({node:a,level:c,currentFolderId:d,expandedFolders:e,onToggle:f,onNavigate:g}){let h=e.has(a.folder.id),i=a.children.length>0,j=d===a.folder.id,k=y[a.folder.folder_type]||y.custom;return(0,b.jsxs)("div",{children:[(0,b.jsxs)("div",{className:(0,n.cn)("flex items-center gap-1 rounded-md transition-colors",j?"bg-primary/20 border border-primary":"hover:bg-muted border border-transparent"),style:{paddingLeft:`${16*c+8}px`},children:[i?(0,b.jsx)("button",{onClick:()=>f(a.folder.id),className:"p-1 hover:bg-accent rounded transition-colors","aria-label":h?"Collapse folder":"Expand folder",children:h?(0,b.jsx)(G.ChevronDown,{className:"w-3.5 h-3.5 text-muted-foreground",strokeWidth:2}):(0,b.jsx)(l.ChevronRight,{className:"w-3.5 h-3.5 text-muted-foreground",strokeWidth:2})}):(0,b.jsx)("div",{className:"w-5"}),(0,b.jsxs)("button",{onClick:()=>g(a.folder.id),className:"flex items-center gap-2 flex-1 py-2 pr-3 text-left text-sm focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-1 rounded",children:[h?(0,b.jsx)(p.FolderOpen,{className:(0,n.cn)("w-4 h-4 flex-shrink-0",k===y.vehicle_root?"text-blue-500":k===y.category?"text-green-500":"text-muted-foreground"),strokeWidth:2}):(0,b.jsx)(m.Folder,{className:(0,n.cn)("w-4 h-4 flex-shrink-0",k===y.vehicle_root?"text-blue-500":k===y.category?"text-green-500":"text-muted-foreground"),strokeWidth:2}),(0,b.jsx)("span",{className:(0,n.cn)("truncate font-medium",j?"text-foreground":"text-muted-foreground"),children:a.folder.name}),void 0!==a.folder.subfolder_count&&a.folder.subfolder_count>0&&(0,b.jsxs)("span",{className:"text-xs text-muted-foreground",children:["(",a.folder.subfolder_count,")"]})]})]}),h&&i&&(0,b.jsx)("div",{className:"mt-0.5",children:a.children.map(a=>(0,b.jsx)(L,{node:a,level:c+1,currentFolderId:d,expandedFolders:e,onToggle:f,onNavigate:g},a.folder.id))})]})}function M({currentFolder:a,className:e}){return(0,b.jsx)("div",{className:(0,n.cn)("px-6 py-2.5 border-b","bg-navy-50 border-navy-100","transition-colors duration-200",e),children:(0,b.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,b.jsx)(d.Upload,{className:"w-4 h-4 text-navy-600 flex-shrink-0",strokeWidth:2}),(0,b.jsx)("span",{className:"text-slate-700 font-medium",children:"Upload destination:"}),a?(0,b.jsx)("div",{className:"flex items-center gap-1.5",children:a.path.split("/").filter(Boolean).map((a,d,e)=>(0,b.jsxs)(c.default.Fragment,{children:[d>0&&(0,b.jsx)(l.ChevronRight,{className:"w-3.5 h-3.5 text-navy-400 flex-shrink-0",strokeWidth:2}),(0,b.jsx)("span",{className:(0,n.cn)("font-medium",d===e.length-1?"text-navy-900":"text-navy-700"),children:a})]},d))}):(0,b.jsx)("span",{className:"font-medium text-navy-900",children:"Root / All Documents"}),(0,b.jsx)(m.Folder,{className:"w-4 h-4 text-navy-600 ml-1 flex-shrink-0",strokeWidth:2})]})})}var N=a.i(799968),O=a.i(816854),P=a.i(877918),Q=a.i(3321),R=a.i(399580),S=a.i(470305),T=a.i(249464),U=a.i(191675),V=a.i(899750);function W({open:a,onOpenChange:e,folderId:f,vehicleId:g,currentFolder:h,onSuccess:i}){let[k,l]=(0,c.useState)([]),[o,p]=(0,c.useState)("Other"),[q,r]=(0,c.useState)(""),[s,t]=(0,c.useState)(""),[u,v]=(0,c.useState)(!1),[w,x]=(0,c.useState)(f||null),[y,z]=(0,c.useState)([]),[A,B]=(0,c.useState)(!1);(0,c.useEffect)(()=>{a&&(async()=>{B(!0);try{let a=await fetch("/api/staff/documents/folders");if(a.ok){let b=await a.json();z(b.folders||[])}}catch(a){console.error("Error fetching folders:",a)}finally{B(!1)}})()},[a]),(0,c.useEffect)(()=>{x(f||null)},[f]);let E=(0,c.useCallback)(a=>{let b=a.map((a,b)=>({...a,id:`${Date.now()}-${b}`,progress:0,status:"pending"}));l(a=>[...a,...b])},[]),{getRootProps:F,getInputProps:G,isDragActive:I}=(0,N.useDropzone)({onDrop:E,accept:{"application/pdf":[".pdf"],"application/vnd.openxmlformats-officedocument.wordprocessingml.document":[".docx"],"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":[".xlsx"],"text/plain":[".txt"],"image/jpeg":[".jpg",".jpeg"],"image/png":[".png"]},maxSize:0x3200000,disabled:u}),J=async()=>{if(0===k.length)return void V.toast.error("Please select at least one file");v(!0);let a=0,b=k.length;try{for(let b of k){let c=new FormData;c.append("file",b),c.append("type",o),c.append("tags",q),c.append("description",s),w&&c.append("folder_id",w),g&&c.append("vehicle_id",g),l(a=>a.map(a=>a.id===b.id?{...a,status:"uploading"}:a));try{if(!(await fetch("/api/documents/upload",{method:"POST",body:c})).ok)throw Error("Upload failed");l(a=>a.map(a=>a.id===b.id?{...a,status:"success",progress:100}:a))}catch(c){l(a=>a.map(a=>a.id===b.id?{...a,status:"error",error:"Upload failed"}:a)),a++,console.error(`Error uploading ${b.name}:`,c)}}0===a?(V.toast.success(`Successfully uploaded ${b} file(s)`),i?.(),K()):V.toast.error(`${a} file(s) failed to upload`)}catch(a){console.error("Upload error:",a),V.toast.error("Failed to upload files")}finally{v(!1)}},K=()=>{u||(l([]),p("Other"),r(""),t(""),e(!1))};return(0,b.jsx)(S.Dialog,{open:a,onOpenChange:K,children:(0,b.jsxs)(S.DialogContent,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[(0,b.jsx)(S.DialogHeader,{children:(0,b.jsx)(S.DialogTitle,{children:"Upload Documents"})}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{...F(),className:(0,n.cn)("border-2 border-dashed rounded-lg p-8 text-center cursor-pointer transition-colors",I?"border-blue-500 bg-blue-50":"border-gray-300 hover:border-gray-400",u&&"opacity-50 cursor-not-allowed"),children:[(0,b.jsx)("input",{...G()}),(0,b.jsx)(d.Upload,{className:"h-12 w-12 mx-auto mb-4 text-gray-400"}),I?(0,b.jsx)("p",{className:"text-sm text-gray-600",children:"Drop files here..."}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("p",{className:"text-sm text-gray-600 mb-1",children:"Drag & drop files here, or click to select"}),(0,b.jsx)("p",{className:"text-xs text-gray-500",children:"Supported: PDF, DOCX, XLSX, TXT, JPG, PNG (max 50MB each)"})]})]}),k.length>0&&(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)(T.Label,{children:["Selected Files (",k.length,")"]}),(0,b.jsx)("div",{className:"border rounded-lg divide-y max-h-48 overflow-y-auto",children:k.map(a=>(0,b.jsxs)("div",{className:"flex items-center gap-3 p-3",children:[(0,b.jsx)(O.FileText,{className:"h-5 w-5 text-gray-400 flex-shrink-0"}),(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsx)("p",{className:"text-sm font-medium truncate",children:a.name}),(0,b.jsx)("p",{className:"text-xs text-gray-500",children:(a=>{if(0===a)return"0 Bytes";let b=Math.floor(Math.log(a)/Math.log(1024));return Math.round(a/Math.pow(1024,b)*100)/100+" "+["Bytes","KB","MB","GB"][b]})(a.size)})]}),"uploading"===a.status&&(0,b.jsx)(Q.Loader2,{className:"h-4 w-4 animate-spin text-blue-500"}),"success"===a.status&&(0,b.jsx)(R.CheckCircle2,{className:"h-4 w-4 text-green-500"}),"error"===a.status&&(0,b.jsx)(P.AlertCircle,{className:"h-4 w-4 text-red-500"}),"pending"===a.status&&!u&&(0,b.jsx)(j.Button,{variant:"ghost",size:"sm",onClick:()=>{var b;return b=a.id,void l(k.filter(a=>a.id!==b))},className:"h-6 w-6 p-0",children:(0,b.jsx)(H.X,{className:"h-4 w-4"})})]},a.id))})]}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(T.Label,{htmlFor:"document-type",children:"Document Type"}),(0,b.jsxs)(D.Select,{value:o,onValueChange:p,disabled:u,children:[(0,b.jsx)(D.SelectTrigger,{id:"document-type",children:(0,b.jsx)(D.SelectValue,{})}),(0,b.jsxs)(D.SelectContent,{children:[(0,b.jsx)(D.SelectItem,{value:"Agreement",children:"Agreement"}),(0,b.jsx)(D.SelectItem,{value:"Subscription",children:"Subscription"}),(0,b.jsx)(D.SelectItem,{value:"KYC",children:"KYC"}),(0,b.jsx)(D.SelectItem,{value:"Statement",children:"Statement"}),(0,b.jsx)(D.SelectItem,{value:"NDA",children:"NDA"}),(0,b.jsx)(D.SelectItem,{value:"Report",children:"Report"}),(0,b.jsx)(D.SelectItem,{value:"Tax",children:"Tax"}),(0,b.jsx)(D.SelectItem,{value:"Legal",children:"Legal"}),(0,b.jsx)(D.SelectItem,{value:"Other",children:"Other"})]})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(T.Label,{htmlFor:"folder",children:"Destination Folder"}),(0,b.jsxs)(D.Select,{value:w||"root",onValueChange:a=>x("root"===a?null:a),disabled:u||A,children:[(0,b.jsx)(D.SelectTrigger,{id:"folder",children:(0,b.jsx)(D.SelectValue,{children:A?(0,b.jsxs)("span",{className:"flex items-center gap-2",children:[(0,b.jsx)(Q.Loader2,{className:"h-4 w-4 animate-spin"}),"Loading folders..."]}):w?(0,b.jsxs)("span",{className:"flex items-center gap-2",children:[(0,b.jsx)(m.Folder,{className:"h-4 w-4"}),y.find(a=>a.id===w)?.path||"Unknown folder"]}):(0,b.jsxs)("span",{className:"flex items-center gap-2",children:[(0,b.jsx)(m.Folder,{className:"h-4 w-4"}),"Root / No Folder"]})})}),(0,b.jsxs)(D.SelectContent,{className:"max-h-[300px]",children:[(0,b.jsx)(D.SelectItem,{value:"root",children:(0,b.jsxs)("span",{className:"flex items-center gap-2",children:[(0,b.jsx)(m.Folder,{className:"h-4 w-4"}),"Root / No Folder"]})}),y.map(a=>{let c=(a.path.match(/\//g)||[]).length-1;return(0,b.jsx)(D.SelectItem,{value:a.id,children:(0,b.jsxs)("span",{className:"flex items-center gap-2",style:{paddingLeft:`${16*c}px`},children:[(0,b.jsx)(m.Folder,{className:"h-4 w-4 flex-shrink-0"}),(0,b.jsx)("span",{className:"truncate",children:a.path})]})},a.id)})]})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(T.Label,{htmlFor:"tags",children:"Tags (comma-separated)"}),(0,b.jsx)(C.Input,{id:"tags",placeholder:"quarterly, 2024, financial",value:q,onChange:a=>r(a.target.value),disabled:u})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(T.Label,{htmlFor:"description",children:"Description (optional)"}),(0,b.jsx)(U.Textarea,{id:"description",placeholder:"Add a description for these documents...",value:s,onChange:a=>t(a.target.value),disabled:u,rows:3})]})]})]}),(0,b.jsxs)(S.DialogFooter,{children:[(0,b.jsx)(j.Button,{variant:"outline",onClick:K,disabled:u,children:"Cancel"}),(0,b.jsx)(j.Button,{onClick:J,disabled:0===k.length||u,children:u?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(Q.Loader2,{className:"h-4 w-4 mr-2 animate-spin"}),"Uploading..."]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(d.Upload,{className:"h-4 w-4 mr-2"}),"Upload ",k.length," File",1!==k.length?"s":""]})})]})]})})}let X=(0,r.default)("folder-tree",[["path",{d:"M20 10a1 1 0 0 0 1-1V6a1 1 0 0 0-1-1h-2.5a1 1 0 0 1-.8-.4l-.9-1.2A1 1 0 0 0 15 3h-2a1 1 0 0 0-1 1v5a1 1 0 0 0 1 1Z",key:"hod4my"}],["path",{d:"M20 21a1 1 0 0 0 1-1v-3a1 1 0 0 0-1-1h-2.9a1 1 0 0 1-.88-.55l-.42-.85a1 1 0 0 0-.92-.6H13a1 1 0 0 0-1 1v5a1 1 0 0 0 1 1Z",key:"w4yl2u"}],["path",{d:"M3 5a2 2 0 0 0 2 2h3",key:"f2jnh7"}],["path",{d:"M3 3v13a2 2 0 0 0 2 2h3",key:"k8epm1"}]]);function Y({open:a,onOpenChange:d,documentId:e,documentName:f,currentFolderId:g,onSuccess:h}){let[i,k]=(0,c.useState)([]),[l,m]=(0,c.useState)(""),[n,o]=(0,c.useState)(!1),[p,q]=(0,c.useState)(!1);(0,c.useEffect)(()=>{a&&r()},[a]);let r=async()=>{try{o(!0);let a=await fetch("/api/staff/documents/folders");if(a.ok){let b=await a.json();k(b.folders||[])}else V.toast.error("Failed to load folders")}catch(a){console.error("Error loading folders:",a),V.toast.error("Failed to load folders")}finally{o(!1)}},s=async()=>{if(e)try{q(!0);let a="__root__"===l?null:l||null,b=await fetch(`/api/staff/documents/${e}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({folder_id:a})});if(b.ok)V.toast.success("Document moved successfully"),h?.(),d(!1);else{let a=await b.json();V.toast.error(a.error||"Failed to move document")}}catch(a){console.error("Error moving document:",a),V.toast.error("Failed to move document")}finally{q(!1)}},t=i.filter(a=>a.id!==g);return(0,b.jsx)(S.Dialog,{open:a,onOpenChange:d,children:(0,b.jsxs)(S.DialogContent,{children:[(0,b.jsx)(S.DialogHeader,{children:(0,b.jsxs)(S.DialogTitle,{children:["Move Document - ",f]})}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(T.Label,{children:"Select Destination Folder"}),n?(0,b.jsx)("div",{className:"text-center py-4",children:(0,b.jsx)(Q.Loader2,{className:"h-6 w-6 animate-spin mx-auto text-blue-500"})}):(0,b.jsxs)(D.Select,{value:l,onValueChange:m,children:[(0,b.jsx)(D.SelectTrigger,{children:(0,b.jsx)(D.SelectValue,{placeholder:"Select a folder..."})}),(0,b.jsxs)(D.SelectContent,{className:"max-h-80",children:[(0,b.jsx)(D.SelectItem,{value:"__root__",children:"Root (No Folder)"}),t.map(a=>(0,b.jsx)(D.SelectItem,{value:a.id,children:a.path},a.id))]})]})]}),g&&(0,b.jsxs)("p",{className:"text-sm text-gray-500",children:["Current: ",i.find(a=>a.id===g)?.path||"Root"]})]}),(0,b.jsxs)(S.DialogFooter,{children:[(0,b.jsx)(j.Button,{variant:"outline",onClick:()=>d(!1),children:"Cancel"}),(0,b.jsx)(j.Button,{onClick:s,disabled:!l||p,children:p?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(Q.Loader2,{className:"h-4 w-4 mr-2 animate-spin"}),"Moving..."]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(X,{className:"h-4 w-4 mr-2"}),"Move"]})})]})]})})}function Z({open:a,onOpenChange:d,parentFolderId:f,onSuccess:g}){let[h,i]=(0,c.useState)(""),[k,l]=(0,c.useState)(!1),m=async()=>{if(!h.trim())return void V.toast.error("Please enter a folder name");try{l(!0);let a={name:h.trim(),folder_type:"custom",...f&&{parent_folder_id:f}},b=await fetch("/api/staff/documents/folders",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}),c=await b.text();if(b.ok)V.toast.success("Folder created successfully"),i(""),g?.(),d(!1);else{let a={};try{a=JSON.parse(c)}catch(b){a={error:c||"Unknown error"}}console.error("[CreateFolder] Error response:",a);let b=a.details?`${a.error}: ${JSON.stringify(a.details)}`:a.error||"Failed to create folder";V.toast.error(b)}}catch(a){console.error("Error creating folder:",a),V.toast.error("Failed to create folder")}finally{l(!1)}},n=()=>{k||(i(""),d(!1))};return(0,b.jsx)(S.Dialog,{open:a,onOpenChange:n,children:(0,b.jsxs)(S.DialogContent,{children:[(0,b.jsx)(S.DialogHeader,{children:(0,b.jsx)(S.DialogTitle,{children:f?"Create Subfolder":"Create Folder"})}),(0,b.jsx)("div",{className:"space-y-4",children:(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(T.Label,{htmlFor:"folder-name",children:"Folder Name"}),(0,b.jsx)(C.Input,{id:"folder-name",placeholder:"Enter folder name...",value:h,onChange:a=>i(a.target.value),onKeyDown:a=>{"Enter"!==a.key||k||m()},disabled:k,autoFocus:!0})]})}),(0,b.jsxs)(S.DialogFooter,{children:[(0,b.jsx)(j.Button,{variant:"outline",onClick:n,disabled:k,children:"Cancel"}),(0,b.jsx)(j.Button,{onClick:m,disabled:!h.trim()||k,children:k?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(Q.Loader2,{className:"h-4 w-4 mr-2 animate-spin"}),"Creating..."]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(e.FolderPlus,{className:"h-4 w-4 mr-2"}),"Create Folder"]})})]})]})})}function $({open:a,onOpenChange:d,folderId:e,currentName:f,onSuccess:g}){let[h,i]=(0,c.useState)(f),[k,l]=(0,c.useState)(!1),m=async a=>{if(a.preventDefault(),!e||!h.trim())return void V.toast.error("Folder name is required");if(h.trim()===f){V.toast.info("Name unchanged"),d(!1);return}l(!0);try{let a=await fetch(`/api/staff/documents/folders/${e}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:h.trim()})});if(a.ok)V.toast.success("Folder renamed successfully"),g(),d(!1),i("");else{let b=await a.json().catch(()=>({error:"Unknown error"})),c=b.details||b.error||"Unknown error";V.toast.error(`Failed to rename folder: ${c}`)}}catch(a){console.error("Error renaming folder:",a),V.toast.error("Failed to rename folder")}finally{l(!1)}};return(0,b.jsx)(S.Dialog,{open:a,onOpenChange:a=>{a&&i(f),d(a)},children:(0,b.jsx)(S.DialogContent,{className:"bg-zinc-900 border-white/10 text-white",children:(0,b.jsxs)("form",{onSubmit:m,children:[(0,b.jsxs)(S.DialogHeader,{children:[(0,b.jsx)(S.DialogTitle,{className:"text-white",children:"Rename Folder"}),(0,b.jsx)(S.DialogDescription,{className:"text-gray-400",children:"Enter a new name for this folder"})]}),(0,b.jsxs)("div",{className:"py-4",children:[(0,b.jsx)(T.Label,{htmlFor:"folder-name",className:"text-white",children:"Folder Name"}),(0,b.jsx)(C.Input,{id:"folder-name",value:h,onChange:a=>i(a.target.value),placeholder:"Enter folder name",className:"mt-2 bg-white/5 border-white/10 text-white placeholder:text-gray-500",disabled:k,autoFocus:!0})]}),(0,b.jsxs)(S.DialogFooter,{children:[(0,b.jsx)(j.Button,{type:"button",variant:"outline",onClick:()=>d(!1),disabled:k,className:"border-white/20 text-white hover:bg-white/10",children:"Cancel"}),(0,b.jsx)(j.Button,{type:"submit",disabled:k||!h.trim(),className:"bg-blue-600 hover:bg-blue-700 text-white",children:k?"Renaming...":"Rename"})]})]})})})}function _({open:a,onOpenChange:d,documentId:e,currentName:f,onSuccess:g}){let[h,i]=(0,c.useState)(f),[k,l]=(0,c.useState)(!1),m=async a=>{if(a.preventDefault(),!e||!h.trim())return void V.toast.error("Document name is required");if(h.trim()===f){V.toast.info("Name unchanged"),d(!1);return}l(!0);try{let a=await fetch(`/api/staff/documents/${e}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:h.trim()})});if(a.ok)V.toast.success("Document renamed successfully"),g(),d(!1),i("");else{let b=await a.json().catch(()=>({error:"Unknown error"})),c=b.details||b.error||"Unknown error";V.toast.error(`Failed to rename document: ${c}`)}}catch(a){console.error("Error renaming document:",a),V.toast.error("Failed to rename document")}finally{l(!1)}};return(0,b.jsx)(S.Dialog,{open:a,onOpenChange:a=>{a&&i(f),d(a)},children:(0,b.jsx)(S.DialogContent,{className:"bg-zinc-900 border-white/10 text-white",children:(0,b.jsxs)("form",{onSubmit:m,children:[(0,b.jsxs)(S.DialogHeader,{children:[(0,b.jsx)(S.DialogTitle,{className:"text-white",children:"Rename Document"}),(0,b.jsx)(S.DialogDescription,{className:"text-gray-400",children:"Enter a new name for this document"})]}),(0,b.jsxs)("div",{className:"py-4",children:[(0,b.jsx)(T.Label,{htmlFor:"document-name",className:"text-white",children:"Document Name"}),(0,b.jsx)(C.Input,{id:"document-name",value:h,onChange:a=>i(a.target.value),placeholder:"Enter document name",className:"mt-2 bg-white/5 border-white/10 text-white placeholder:text-gray-500",disabled:k,autoFocus:!0})]}),(0,b.jsxs)(S.DialogFooter,{children:[(0,b.jsx)(j.Button,{type:"button",variant:"outline",onClick:()=>d(!1),disabled:k,className:"border-white/20 text-white hover:bg-white/10",children:"Cancel"}),(0,b.jsx)(j.Button,{type:"submit",disabled:k||!h.trim(),className:"bg-blue-600 hover:bg-blue-700 text-white",children:k?"Renaming...":"Rename"})]})]})})})}var aa=a.i(160409),ab=a.i(518173);function ac({initialVehicles:a,userProfile:r}){let[s,t]=(0,c.useState)(null),[u,v]=(0,c.useState)(null),[w,x]=(0,c.useState)([]),[y,z]=(0,c.useState)(!1),[A,B]=(0,c.useState)([]),[D,F]=(0,c.useState)([]),[I,L]=(0,c.useState)(!0),[N,O]=(0,c.useState)(!1),[P,Q]=(0,c.useState)(!1),[R,S]=(0,c.useState)(null),[T,U]=(0,c.useState)(!1),[X,ac]=(0,c.useState)(null),[ad,ae]=(0,c.useState)(""),[af,ag]=(0,c.useState)(null),[ah,ai]=(0,c.useState)(!1),[aj,ak]=(0,c.useState)(null),[al,am]=(0,c.useState)(""),[an,ao]=(0,c.useState)(!1),[ap,aq]=(0,c.useState)(null),[ar,as]=(0,c.useState)(""),[at,au]=(0,c.useState)(""),[av,aw]=(0,c.useState)("all"),[ax,ay]=(0,c.useState)("grid"),[az,aA]=(0,c.useState)("name"),[aB,aC]=(0,c.useState)(""),[aD,aE]=(0,c.useState)(new Set),{isOpen:aF,document:aG,previewUrl:aH,isLoading:aI,error:aJ,openPreview:aK,closePreview:aL,downloadDocument:aM}=(0,aa.useDocumentViewer)(),aN=a=>{null!==s&&s!==a&&x(a=>[...a,s]),t(a),v(A.find(b=>b.id===a)||null)},aO=(0,c.useMemo)(()=>{let a=A.filter(a=>a.parent_folder_id===(s||null));if(at){let b=at.toLowerCase();a=a.filter(a=>{let c=a.name.toLowerCase().includes(b),d=a.path.toLowerCase().includes(b);return c||d})}return a},[A,s,at]),aP=(0,c.useMemo)(()=>{let a=D;if(at){let b=at.toLowerCase();a=a.filter(a=>{let c=a.name.toLowerCase().includes(b),d=a.vehicle?.name.toLowerCase().includes(b)||!1,e=a.folder?.name.toLowerCase().includes(b)||!1,f=a.folder?.path.toLowerCase().includes(b)||!1,g=a.type.toLowerCase().includes(b),h=a.created_by_profile?.display_name.toLowerCase().includes(b)||!1;return c||d||e||f||g||h})}return[...a].sort((a,b)=>"name"===az?a.name.localeCompare(b.name):"date"===az?new Date(b.created_at).getTime()-new Date(a.created_at).getTime():"type"===az?a.type.localeCompare(b.type):0)},[D,at,az]),aQ=(0,c.useCallback)(a=>{let b=new Map;return a.forEach(a=>{b.has(a.parent_folder_id)||b.set(a.parent_folder_id,[]),b.get(a.parent_folder_id).push({folder:a,children:[]})}),function a(c){return(b.get(c)||[]).map(b=>({...b,children:a(b.folder.id)}))}(null)},[]),aR=(0,c.useMemo)(()=>aQ(A),[A,aQ]),aS=(0,c.useCallback)((a,b)=>a.map(a=>{let c=a.folder.name.toLowerCase().includes(b),d=a.folder.path.toLowerCase().includes(b),e=aS(a.children,b);return c||d||e.length>0?{...a,children:e}:null}).filter(a=>null!==a),[]),aT=(0,c.useMemo)(()=>aB.trim()?aS(aR,aB.toLowerCase()):aR,[aR,aB,aS]);(0,c.useEffect)(()=>{if(s&&A.length>0){let a=A.find(a=>a.id===s);if(a){let b=(a=>{let b=[],c=a;for(;c?.parent_folder_id;)b.push(c.parent_folder_id),c=A.find(a=>a.id===c.parent_folder_id);return b})(a);aE(a=>new Set([...a,...b]))}}},[s,A]);let aU=(0,c.useCallback)(async()=>{try{let a=await fetch("/api/staff/documents/folders?tree=true");if(a.ok){let b=(await a.json()).folders||[],c=a=>{let b=[];return a.forEach(a=>{b.push({id:a.id,name:a.name,path:a.path,parent_folder_id:a.parent_folder_id,folder_type:a.folder_type,vehicle_id:a.vehicle_id,created_by:a.created_by,created_at:a.created_at,updated_at:a.updated_at,subfolder_count:a.children?.length||0,document_count:a.document_count||0}),a.children&&a.children.length>0&&b.push(...c(a.children))}),b};B(c(b))}else{let b=await a.json().catch(()=>({error:"Unknown error"})),c=b.details||b.error||"Unknown error";V.toast.error(`Failed to load folders: ${c}`)}}catch(a){console.error("Error loading folders:",a),V.toast.error("Failed to load folders")}},[]),aV=(0,c.useCallback)(a=>{let b=[a],c=a=>{A.filter(b=>b.parent_folder_id===a).forEach(a=>{b.push(a.id),c(a.id)})};return c(a),b},[A]),aW=(0,c.useCallback)(async()=>{try{L(!0);let a=new URLSearchParams;!at&&s&&(aV(s).forEach(b=>a.append("folder_ids",b)),a.append("include_subfolders","true")),at&&a.append("search",at),"all"!==av&&a.append("status",av);let b=await fetch(`/api/staff/documents?${a.toString()}`);if(b.ok){let a=await b.json();F(a.documents||[])}else{let a=await b.json().catch(()=>({error:"Unknown error"})),c=a.details||a.error||"Unknown error";V.toast.error(`Failed to load documents: ${c}`)}}catch(a){console.error("Error loading documents:",a),V.toast.error("Failed to load documents")}finally{L(!1)}},[s,at,av,aV]);(0,c.useEffect)(()=>{aU()},[aU]),(0,c.useEffect)(()=>{aW()},[aW]);let aX=(a=null)=>{S(a||s),Q(!0)},aY=async b=>{try{let c=a.find(a=>a.id===b);(await fetch("/api/staff/documents/init-vehicle-folders",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({vehicle_id:b})})).ok?(V.toast.success(`Default folders created for ${c?.name||"vehicle"}`),aU()):V.toast.error("Failed to create vehicle folders")}catch(a){console.error("Error initializing folders:",a),V.toast.error("Failed to create vehicle folders")}},aZ=async a=>{if(confirm("Are you sure you want to delete this document?"))try{(await fetch(`/api/staff/documents/${a}`,{method:"DELETE"})).ok?(V.toast.success("Document deleted successfully"),aW()):V.toast.error("Failed to delete document")}catch(a){console.error("Error deleting document:",a),V.toast.error("Failed to delete document")}},a$=async a=>{let b=a.name||"";if(["docx","doc","xlsx","xls","pptx","ppt","odt","ods","odp"].includes(b.split(".").pop()?.toLowerCase()||"")){V.toast.info("Office documents cannot be previewed. Use Download to view."),a_(a.id);return}await aK({id:a.id,file_name:a.name,name:a.name,file_size_bytes:a.file_size_bytes,type:a.type,mime_type:a.mime_type})},a_=async a=>{try{let b=await fetch(`/api/documents/${a}/download`);if(b.ok){let a=await b.json(),c=a.url||a.download_url;c?(window.open(c,"_blank"),V.toast.success("Download started")):V.toast.error("No download URL in response")}else V.toast.error("Failed to generate download link")}catch(a){console.error("Error downloading document:",a),V.toast.error("Failed to download document")}},a0=async a=>{let b=A.find(b=>b.id===a);if(b&&confirm(`Are you sure you want to delete "${b.name}"? This will also delete all documents and subfolders within it.`))try{let b=await fetch(`/api/staff/documents/folders/${a}`,{method:"DELETE"});if(b.ok)V.toast.success("Folder deleted successfully"),aU(),aW();else{let a=await b.json().catch(()=>({error:"Unknown error"})),c=a.details||a.error||"Unknown error";V.toast.error(`Failed to delete folder: ${c}`)}}catch(a){console.error("Error deleting folder:",a),V.toast.error("Failed to delete folder")}},a1=a.filter(a=>!A.some(b=>b.vehicle_id===a.id&&"vehicle_root"===b.folder_type)),a2=(a,c=0)=>{let d=aD.has(a.folder.id),e=a.children.length>0,f=s===a.folder.id;return(0,b.jsxs)("div",{children:[(0,b.jsxs)("div",{className:(0,n.cn)("flex items-center gap-1 rounded-md transition-colors",f?"bg-primary/20 border border-primary":"hover:bg-muted border border-transparent"),style:{paddingLeft:`${16*c+8}px`},children:[e?(0,b.jsx)("button",{onClick:()=>{var b;return b=a.folder.id,void aE(a=>{let c=new Set(a);return c.has(b)?c.delete(b):c.add(b),c})},className:"p-1 hover:bg-accent rounded transition-colors","aria-label":d?"Collapse folder":"Expand folder",children:d?(0,b.jsx)(G.ChevronDown,{className:"w-3.5 h-3.5 text-muted-foreground"}):(0,b.jsx)(l.ChevronRight,{className:"w-3.5 h-3.5 text-muted-foreground"})}):(0,b.jsx)("div",{className:"w-5"}),(0,b.jsxs)("button",{onClick:()=>aN(a.folder.id),className:"flex items-center gap-2 flex-1 py-2 pr-3 text-left text-sm focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-1 rounded",children:[d?(0,b.jsx)(p.FolderOpen,{className:(0,n.cn)("w-4 h-4 flex-shrink-0","vehicle_root"===a.folder.folder_type?"text-blue-500":"category"===a.folder.folder_type?"text-green-500":"text-muted-foreground")}):(0,b.jsx)(m.Folder,{className:(0,n.cn)("w-4 h-4 flex-shrink-0","vehicle_root"===a.folder.folder_type?"text-blue-500":"category"===a.folder.folder_type?"text-green-500":"text-muted-foreground")}),(0,b.jsx)("span",{className:(0,n.cn)("truncate font-medium",f?"text-foreground":"text-muted-foreground"),children:a.folder.name}),void 0!==a.folder.document_count&&a.folder.document_count>0&&(0,b.jsxs)("span",{className:"text-xs text-muted-foreground ml-auto",children:["(",a.folder.document_count,")"]})]})]}),d&&e&&(0,b.jsx)("div",{className:"mt-0.5",children:a.children.map(a=>a2(a,c+1))})]},a.folder.id)};return(0,b.jsxs)("div",{className:"flex flex-col h-full bg-background",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between px-6 py-4 bg-muted/50 border-b border-border",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsxs)(j.Button,{variant:"outline",size:"icon",className:"lg:hidden",onClick:()=>z(!0),children:[(0,b.jsx)(g.Menu,{className:"h-5 w-5"}),(0,b.jsx)("span",{className:"sr-only",children:"Open folder tree"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-2xl font-bold text-foreground",children:"Document Management"}),(0,b.jsx)("p",{className:"text-muted-foreground mt-1 hidden sm:block",children:"Manage documents with hierarchical folder structure"})]})]}),(0,b.jsx)("div",{className:"flex gap-2",children:(0,b.jsxs)(j.Button,{variant:"outline",onClick:()=>aW(),children:[(0,b.jsx)(f.RefreshCw,{className:"h-4 w-4 mr-2"}),(0,b.jsx)("span",{className:"hidden sm:inline",children:"Refresh"})]})})]}),(0,b.jsxs)("div",{className:"flex-1 grid grid-cols-1 lg:grid-cols-[280px_1fr] overflow-hidden",children:[(0,b.jsxs)("aside",{className:"hidden lg:flex flex-col border-r border-border bg-muted/30",children:[(0,b.jsx)("div",{className:"px-4 py-3 border-b border-border",children:(0,b.jsx)("h2",{className:"text-sm font-semibold text-foreground",children:"Folders"})}),(0,b.jsx)("div",{className:"px-3 py-3 border-b border-border",children:(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)(q.Search,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-muted-foreground"}),(0,b.jsx)(C.Input,{type:"text",placeholder:"Search folders...",value:aB,onChange:a=>aC(a.target.value),className:"pl-10 pr-10 h-9 text-sm"}),aB&&(0,b.jsx)("button",{onClick:()=>aC(""),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-muted-foreground hover:text-foreground transition-colors",children:(0,b.jsx)(H.X,{className:"w-4 h-4"})})]})}),(0,b.jsx)(J.ScrollArea,{className:"flex-1",children:(0,b.jsxs)("div",{className:"px-2 py-2",children:[(0,b.jsxs)("button",{onClick:()=>aN(null),className:(0,n.cn)("flex items-center gap-2 w-full px-3 py-2 rounded-md text-sm font-medium transition-colors",null===s?"bg-primary/20 text-primary border border-primary":"text-muted-foreground hover:bg-muted border border-transparent"),children:[(0,b.jsx)(i.Home,{className:"w-4 h-4 flex-shrink-0"}),(0,b.jsx)("span",{children:"All Documents"})]}),(0,b.jsx)("div",{className:"mt-2 space-y-0.5",children:aT.map(a=>a2(a,0))}),0===aT.length&&(0,b.jsx)("div",{className:"text-center py-8 text-sm text-muted-foreground",children:aB?"No folders match your search":"No folders found"})]})}),a1.length>0&&(0,b.jsx)("div",{className:"p-3 border-t border-border",children:(0,b.jsxs)(k.DropdownMenu,{children:[(0,b.jsx)(k.DropdownMenuTrigger,{asChild:!0,children:(0,b.jsxs)(j.Button,{variant:"outline",size:"sm",className:"w-full border-amber-500/50 bg-amber-500/10 text-amber-600 dark:text-amber-400 hover:bg-amber-500/20",children:[(0,b.jsx)(e.FolderPlus,{className:"h-4 w-4 mr-2"}),"Init Folders (",a1.length,")"]})}),(0,b.jsx)(k.DropdownMenuContent,{children:a1.map(a=>(0,b.jsxs)(k.DropdownMenuItem,{onClick:()=>aY(a.id),children:[a.name," (",a.type,")"]},a.id))})]})})]}),(0,b.jsxs)("main",{className:"flex flex-col overflow-hidden",children:[u&&(0,b.jsx)(o,{currentFolder:u,onNavigate:aN}),u&&(0,b.jsx)(M,{currentFolder:u}),(0,b.jsxs)("div",{className:"flex items-center justify-between px-6 py-4 border-b border-border bg-muted/50",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[w.length>0&&(0,b.jsxs)(j.Button,{variant:"ghost",onClick:()=>{if(0===w.length)return;let a=w[w.length-1];x(a=>a.slice(0,-1)),t(a),v(A.find(b=>b.id===a)||null)},children:[(0,b.jsx)(h.ArrowLeft,{className:"w-4 h-4 mr-2"}),"Back"]}),a1.length>0&&(0,b.jsx)("div",{className:"lg:hidden",children:(0,b.jsxs)(k.DropdownMenu,{children:[(0,b.jsx)(k.DropdownMenuTrigger,{asChild:!0,children:(0,b.jsxs)(j.Button,{variant:"outline",size:"sm",className:"border-amber-500/50 bg-amber-500/10 text-amber-600 dark:text-amber-400 hover:bg-amber-500/20",children:[(0,b.jsx)(e.FolderPlus,{className:"h-4 w-4 mr-2"}),"Init (",a1.length,")"]})}),(0,b.jsx)(k.DropdownMenuContent,{children:a1.map(a=>(0,b.jsxs)(k.DropdownMenuItem,{onClick:()=>aY(a.id),children:[a.name," (",a.type,")"]},a.id))})]})})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsxs)(j.Button,{onClick:()=>O(!0),children:[(0,b.jsx)(d.Upload,{className:"w-4 h-4 mr-2"}),(0,b.jsx)("span",{className:"hidden sm:inline",children:"Upload"})]}),(0,b.jsxs)(j.Button,{variant:"outline",onClick:()=>aX(),children:[(0,b.jsx)(e.FolderPlus,{className:"w-4 h-4 mr-2"}),(0,b.jsx)("span",{className:"hidden sm:inline",children:"New Folder"})]})]})]}),(0,b.jsx)("div",{className:"flex-1 overflow-hidden",children:(0,b.jsx)(E,{currentFolderId:s,currentFolder:u,subfolders:aO,documents:aP,isLoading:I,viewMode:ax,sortBy:az,searchQuery:at,onNavigateToFolder:aN,onDocumentClick:a=>{let b=D.find(b=>b.id===a);b&&a$(b)},onUploadClick:()=>O(!0),onCreateFolderClick:()=>aX(),onRenameFolder:a=>{let b=A.find(b=>b.id===a);b&&(ak(a),am(b.name),ai(!0))},onDeleteFolder:a0,onCreateSubfolder:aX,onRenameDocument:a=>{let b=D.find(b=>b.id===a);b&&(aq(a),as(b.name),ao(!0))},onDeleteDocument:aZ,onViewModeChange:ay,onSortChange:aA,onSearchChange:au})})]})]}),(0,b.jsx)(K,{open:y,onOpenChange:z,folders:A,currentFolderId:s,onNavigate:aN}),(0,b.jsx)(W,{open:N,onOpenChange:O,folderId:s,currentFolder:u,vehicleId:u?.vehicle_id||void 0,onSuccess:()=>aW()}),(0,b.jsx)(Y,{open:T,onOpenChange:U,documentId:X,documentName:ad,currentFolderId:af,onSuccess:()=>aW()}),(0,b.jsx)(Z,{open:P,onOpenChange:Q,parentFolderId:R,onSuccess:()=>aU()}),(0,b.jsx)($,{open:ah,onOpenChange:ai,folderId:aj,currentName:al,onSuccess:()=>aU()}),(0,b.jsx)(_,{open:an,onOpenChange:ao,documentId:ap,currentName:ar,onSuccess:()=>aW()}),(0,b.jsx)(ab.DocumentViewerFullscreen,{isOpen:aF,document:aG,previewUrl:aH,isLoading:aI,error:aJ,onClose:aL,onDownload:aM})]})}a.s(["StaffDocumentsClient",()=>ac],864775)}];

//# sourceMappingURL=versotech-portal_src_components_documents_staff-documents-client_tsx_5b7fd868._.js.map