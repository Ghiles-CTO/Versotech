{"version":3,"sources":["../../../../../versotech-portal/src/app/%28main%29/versotech_main/shared-transactions/page.tsx"],"sourcesContent":["'use client'\n\nimport { useEffect, useState } from 'react'\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card'\nimport { Badge } from '@/components/ui/badge'\nimport { Input } from '@/components/ui/input'\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from '@/components/ui/select'\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from '@/components/ui/table'\nimport {\n  Share2,\n  Users,\n  DollarSign,\n  Clock,\n  CheckCircle2,\n  Search,\n  Loader2,\n  AlertCircle,\n  Briefcase,\n  TrendingUp,\n  Building2,\n  Handshake,\n} from 'lucide-react'\nimport { cn } from '@/lib/utils'\nimport { formatCurrency, formatDate } from '@/lib/format'\nimport { createClient } from '@/lib/supabase/client'\n\ntype SharedTransaction = {\n  id: string // Synthetic ID from deal_id + investor_id\n  deal_id: string\n  deal_name: string\n  deal_status: string\n  investor_id: string | null\n  investor_name: string\n  commitment_amount: number\n  currency: string\n  dispatched_at: string | null\n  partner_share: number // Percentage share\n  co_referrer_name: string | null\n  co_referrer_type: string | null\n}\n\ntype PartnerInfo = {\n  id: string\n  name: string\n  legal_name: string | null\n  status: string\n  logo_url: string | null\n}\n\ntype Summary = {\n  totalShared: number\n  activeDeals: number\n  totalValue: number\n  coPartners: number\n}\n\nconst STATUS_STYLES: Record<string, string> = {\n  open: 'bg-green-100 text-green-800 border-green-200',\n  closed: 'bg-blue-100 text-blue-800 border-blue-200',\n  pending: 'bg-yellow-100 text-yellow-800 border-yellow-200',\n  cancelled: 'bg-red-100 text-red-800 border-red-200',\n}\n\nconst STATUS_FILTERS = [\n  { label: 'All Status', value: 'all' },\n  { label: 'Open', value: 'open' },\n  { label: 'Closed', value: 'closed' },\n  { label: 'Pending', value: 'pending' },\n]\n\nexport default function SharedTransactionsPage() {\n  const [partnerInfo, setPartnerInfo] = useState<PartnerInfo | null>(null)\n  const [transactions, setTransactions] = useState<SharedTransaction[]>([])\n  const [summary, setSummary] = useState<Summary>({\n    totalShared: 0,\n    activeDeals: 0,\n    totalValue: 0,\n    coPartners: 0,\n  })\n  const [loading, setLoading] = useState(true)\n  const [error, setError] = useState<string | null>(null)\n  const [search, setSearch] = useState('')\n  const [statusFilter, setStatusFilter] = useState('all')\n\n  useEffect(() => {\n    async function fetchData() {\n      try {\n        setLoading(true)\n        const supabase = createClient()\n\n        // Get current user\n        const { data: { user } } = await supabase.auth.getUser()\n        if (!user) {\n          setError('Not authenticated')\n          return\n        }\n\n        // Check if user is a partner\n        const { data: partnerUser, error: partnerUserError } = await supabase\n          .from('partner_users')\n          .select('partner_id')\n          .eq('user_id', user.id)\n          .single()\n\n        if (partnerUserError || !partnerUser) {\n          // Maybe they're staff - show example data\n          await fetchAllSharedTransactions(supabase)\n          return\n        }\n\n        // Fetch partner info\n        const { data: partner, error: partnerError } = await supabase\n          .from('partners')\n          .select('id, name, legal_name, status, logo_url')\n          .eq('id', partnerUser.partner_id)\n          .single()\n\n        if (partnerError) throw partnerError\n        setPartnerInfo(partner)\n\n        // Fetch shared transactions for this partner\n        // Looking for deals where this partner referred AND there are other referrers\n        // Note: deal_memberships has no 'id' or 'created_at' columns - use composite key and dispatched_at\n        const { data: memberships, error: membershipsError } = await supabase\n          .from('deal_memberships')\n          .select(`\n            deal_id,\n            investor_id,\n            dispatched_at,\n            referred_by_entity_id,\n            referred_by_entity_type,\n            investor:investor_id (\n              id,\n              legal_name\n            ),\n            deal:deal_id (\n              id,\n              name,\n              status,\n              currency,\n              target_amount\n            )\n          `)\n          .eq('referred_by_entity_id', partnerUser.partner_id)\n          .eq('referred_by_entity_type', 'partner')\n          .order('dispatched_at', { ascending: false })\n\n        if (membershipsError) throw membershipsError\n\n        // Get subscription amounts for these investors\n        const investorIds = (memberships || [])\n          .filter((m: any) => {\n            const investor = Array.isArray(m.investor) ? m.investor[0] : m.investor\n            return investor?.id\n          })\n          .map((m: any) => {\n            const investor = Array.isArray(m.investor) ? m.investor[0] : m.investor\n            return investor.id\n          })\n\n        let subscriptionsMap: Record<string, any> = {}\n        if (investorIds.length > 0) {\n          const { data: subs } = await supabase\n            .from('subscriptions')\n            .select('investor_id, commitment, status')\n            .in('investor_id', investorIds)\n\n          if (subs) {\n            subs.forEach((s: any) => {\n              if (!subscriptionsMap[s.investor_id]) {\n                subscriptionsMap[s.investor_id] = s\n              }\n            })\n          }\n        }\n\n        // Find deals with multiple referrers (shared deals)\n        const dealIds = [...new Set((memberships || []).filter((m: any) => {\n          const deal = Array.isArray(m.deal) ? m.deal[0] : m.deal\n          return deal?.id\n        }).map((m: any) => {\n          const deal = Array.isArray(m.deal) ? m.deal[0] : m.deal\n          return deal.id\n        }))]\n\n        let sharedDealInfo: Record<string, any[]> = {}\n        if (dealIds.length > 0) {\n          const { data: allReferrals } = await supabase\n            .from('deal_memberships')\n            .select('deal_id, referred_by_entity_id, referred_by_entity_type')\n            .in('deal_id', dealIds)\n            .not('referred_by_entity_id', 'is', null)\n            .neq('referred_by_entity_id', partnerUser.partner_id)\n\n          if (allReferrals) {\n            allReferrals.forEach((r: any) => {\n              if (!sharedDealInfo[r.deal_id]) {\n                sharedDealInfo[r.deal_id] = []\n              }\n              sharedDealInfo[r.deal_id].push(r)\n            })\n          }\n        }\n\n        processTransactions(memberships || [], subscriptionsMap, sharedDealInfo)\n        setError(null)\n      } catch (err) {\n        console.error('[SharedTransactionsPage] Error:', err)\n        setError(err instanceof Error ? err.message : 'Failed to load shared transactions')\n      } finally {\n        setLoading(false)\n      }\n    }\n\n    async function fetchAllSharedTransactions(supabase: any) {\n      // Staff view - show deals with multiple referrers\n      // Note: deal_memberships has no 'id' or 'created_at' columns\n      const { data: memberships, error: membershipsError } = await supabase\n        .from('deal_memberships')\n        .select(`\n          deal_id,\n          investor_id,\n          dispatched_at,\n          referred_by_entity_id,\n          referred_by_entity_type,\n          investor:investor_id (\n            id,\n            legal_name\n          ),\n          deal:deal_id (\n            id,\n            name,\n            status,\n            currency,\n            target_amount\n          )\n        `)\n        .not('referred_by_entity_id', 'is', null)\n        .order('dispatched_at', { ascending: false })\n        .limit(50)\n\n      if (membershipsError) throw membershipsError\n      processTransactions(memberships || [], {}, {})\n    }\n\n    function processTransactions(\n      data: any[],\n      subscriptionsMap: Record<string, any>,\n      sharedDealInfo: Record<string, any[]>\n    ) {\n      const processed: SharedTransaction[] = data.map((membership) => {\n        // Handle Supabase returning array for joined foreign key\n        const investor = Array.isArray(membership.investor) ? membership.investor[0] : membership.investor\n        const deal = Array.isArray(membership.deal) ? membership.deal[0] : membership.deal\n\n        const subscription = investor?.id\n          ? subscriptionsMap[investor.id]\n          : null\n\n        const coReferrers = sharedDealInfo[deal?.id] || []\n        const hasCoReferrer = coReferrers.length > 0\n        const coReferrer = coReferrers[0]\n\n        // Create synthetic ID from composite key (deal_memberships has no 'id' column)\n        const syntheticId = `${membership.deal_id || 'no-deal'}-${membership.investor_id || 'no-investor'}`\n\n        return {\n          id: syntheticId,\n          deal_id: deal?.id || '',\n          deal_name: deal?.name || 'Unknown Deal',\n          deal_status: deal?.status || 'draft',\n          investor_id: investor?.id || null,\n          investor_name: investor?.legal_name || 'Unknown',\n          commitment_amount: subscription?.commitment || 0,\n          currency: deal?.currency || 'USD',\n          dispatched_at: membership.dispatched_at,\n          partner_share: hasCoReferrer ? 50 : 100, // Simplified share calculation\n          co_referrer_name: hasCoReferrer ? `Co-referrer (${coReferrer.referred_by_entity_type})` : null,\n          co_referrer_type: coReferrer?.referred_by_entity_type || null,\n        }\n      })\n\n      // Filter to only shared transactions (where there's a co-referrer)\n      const sharedOnly = processed.filter(t => t.co_referrer_name !== null)\n\n      setTransactions(processed) // Show all for now, filter can be applied\n\n      const uniqueDeals = new Set(processed.map(t => t.deal_id))\n      const uniqueCoPartners = new Set(processed.filter(t => t.co_referrer_name).map(t => t.co_referrer_name))\n      const totalValue = processed.reduce((sum, t) => sum + t.commitment_amount, 0)\n\n      setSummary({\n        totalShared: sharedOnly.length,\n        activeDeals: uniqueDeals.size,\n        totalValue,\n        coPartners: uniqueCoPartners.size,\n      })\n    }\n\n    fetchData()\n  }, [])\n\n  // Filter transactions\n  const filteredTransactions = transactions.filter(tx => {\n    const matchesStatus = statusFilter === 'all' || tx.deal_status === statusFilter\n    const matchesSearch = !search ||\n      tx.deal_name?.toLowerCase().includes(search.toLowerCase()) ||\n      tx.investor_name?.toLowerCase().includes(search.toLowerCase())\n    return matchesStatus && matchesSearch\n  })\n\n  if (loading) {\n    return (\n      <div className=\"flex items-center justify-center py-16\">\n        <Loader2 className=\"h-8 w-8 animate-spin text-muted-foreground\" />\n        <span className=\"ml-3 text-muted-foreground\">Loading shared transactions...</span>\n      </div>\n    )\n  }\n\n  if (error) {\n    return (\n      <div className=\"text-center py-16\">\n        <AlertCircle className=\"h-12 w-12 text-destructive mx-auto mb-4\" />\n        <h3 className=\"text-lg font-medium text-foreground mb-2\">Error Loading Transactions</h3>\n        <p className=\"text-muted-foreground\">{error}</p>\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"p-6 space-y-6\">\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h1 className=\"text-2xl font-bold text-foreground\">Shared Transactions</h1>\n          <p className=\"text-muted-foreground mt-1\">\n            {partnerInfo\n              ? `View deals shared with other partners as ${partnerInfo.name}`\n              : 'View all transactions with shared referrals'}\n          </p>\n        </div>\n        {partnerInfo && (\n          <div className=\"flex items-center gap-2\">\n            {partnerInfo.logo_url ? (\n              <img\n                src={partnerInfo.logo_url}\n                alt={partnerInfo.name}\n                className=\"h-10 w-10 rounded-lg object-cover\"\n              />\n            ) : (\n              <div className=\"h-10 w-10 rounded-lg bg-muted flex items-center justify-center\">\n                <Building2 className=\"h-5 w-5 text-muted-foreground\" />\n              </div>\n            )}\n          </div>\n        )}\n      </div>\n\n      {/* Summary Cards */}\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium text-muted-foreground flex items-center gap-2\">\n              <Share2 className=\"h-4 w-4\" />\n              Shared Referrals\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\">{summary.totalShared}</div>\n            <p className=\"text-xs text-muted-foreground mt-1\">\n              With co-referrers\n            </p>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium text-muted-foreground flex items-center gap-2\">\n              <Briefcase className=\"h-4 w-4\" />\n              Deals Involved\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold text-blue-600\">{summary.activeDeals}</div>\n            <p className=\"text-xs text-muted-foreground mt-1\">\n              Unique deals\n            </p>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium text-muted-foreground flex items-center gap-2\">\n              <TrendingUp className=\"h-4 w-4\" />\n              Total Value\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold text-emerald-600\">\n              {formatCurrency(summary.totalValue, 'USD')}\n            </div>\n            <p className=\"text-xs text-muted-foreground mt-1\">\n              Commitment value\n            </p>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium text-muted-foreground flex items-center gap-2\">\n              <Handshake className=\"h-4 w-4\" />\n              Co-Partners\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold text-purple-600\">{summary.coPartners}</div>\n            <p className=\"text-xs text-muted-foreground mt-1\">\n              Partner relationships\n            </p>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Filters */}\n      <Card>\n        <CardContent className=\"pt-6\">\n          <div className=\"flex flex-col md:flex-row gap-4\">\n            <div className=\"flex-1\">\n              <div className=\"relative\">\n                <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n                <Input\n                  placeholder=\"Search by deal or investor name...\"\n                  value={search}\n                  onChange={(e) => setSearch(e.target.value)}\n                  className=\"pl-10\"\n                />\n              </div>\n            </div>\n            <Select value={statusFilter} onValueChange={setStatusFilter}>\n              <SelectTrigger className=\"w-full md:w-48\">\n                <SelectValue placeholder=\"Filter by status\" />\n              </SelectTrigger>\n              <SelectContent>\n                {STATUS_FILTERS.map((option) => (\n                  <SelectItem key={option.value} value={option.value}>\n                    {option.label}\n                  </SelectItem>\n                ))}\n              </SelectContent>\n            </Select>\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Transactions Table */}\n      <Card>\n        <CardHeader>\n          <CardTitle>Transactions</CardTitle>\n          <CardDescription>\n            {filteredTransactions.length} transaction{filteredTransactions.length !== 1 ? 's' : ''} found\n          </CardDescription>\n        </CardHeader>\n        <CardContent>\n          {filteredTransactions.length === 0 ? (\n            <div className=\"border border-dashed border-muted rounded-lg py-12 flex flex-col items-center justify-center text-center space-y-2\">\n              <Share2 className=\"h-10 w-10 text-muted-foreground\" />\n              <p className=\"text-sm text-muted-foreground\">\n                {search || statusFilter !== 'all'\n                  ? 'No transactions match your filters'\n                  : partnerInfo\n                    ? 'No shared transactions yet'\n                    : 'No shared transactions found'}\n              </p>\n              {partnerInfo && transactions.length === 0 && (\n                <p className=\"text-xs text-muted-foreground\">\n                  Shared transactions appear when you co-refer deals with other partners\n                </p>\n              )}\n            </div>\n          ) : (\n            <div className=\"rounded-md border\">\n              <Table>\n                <TableHeader>\n                  <TableRow>\n                    <TableHead>Deal</TableHead>\n                    <TableHead>Investor</TableHead>\n                    <TableHead>Your Share</TableHead>\n                    <TableHead>Co-Referrer</TableHead>\n                    <TableHead>Amount</TableHead>\n                    <TableHead>Status</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {filteredTransactions.map((tx) => (\n                    <TableRow key={tx.id}>\n                      <TableCell>\n                        <div className=\"flex items-center gap-2\">\n                          <Briefcase className=\"h-4 w-4 text-muted-foreground\" />\n                          <span className=\"font-medium\">{tx.deal_name}</span>\n                        </div>\n                      </TableCell>\n                      <TableCell>\n                        <div className=\"flex items-center gap-2\">\n                          <Users className=\"h-4 w-4 text-muted-foreground\" />\n                          <span>{tx.investor_name}</span>\n                        </div>\n                      </TableCell>\n                      <TableCell>\n                        <Badge variant={tx.partner_share === 100 ? 'default' : 'secondary'}>\n                          {tx.partner_share}%\n                        </Badge>\n                      </TableCell>\n                      <TableCell>\n                        {tx.co_referrer_name ? (\n                          <div className=\"flex items-center gap-1\">\n                            <Handshake className=\"h-3 w-3 text-muted-foreground\" />\n                            <span className=\"text-sm\">{tx.co_referrer_name}</span>\n                          </div>\n                        ) : (\n                          <span className=\"text-muted-foreground text-xs\">None</span>\n                        )}\n                      </TableCell>\n                      <TableCell>\n                        <div className=\"font-medium\">\n                          {formatCurrency(tx.commitment_amount, tx.currency)}\n                        </div>\n                        <div className=\"text-xs text-muted-foreground\">\n                          {tx.dispatched_at ? formatDate(tx.dispatched_at) : 'â€”'}\n                        </div>\n                      </TableCell>\n                      <TableCell>\n                        <Badge\n                          variant=\"outline\"\n                          className={cn('capitalize', STATUS_STYLES[tx.deal_status] || '')}\n                        >\n                          {tx.deal_status}\n                        </Badge>\n                      </TableCell>\n                    </TableRow>\n                  ))}\n                </TableBody>\n              </Table>\n            </div>\n          )}\n        </CardContent>\n      </Card>\n    </div>\n  )\n}\n"],"names":[],"mappings":"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"}