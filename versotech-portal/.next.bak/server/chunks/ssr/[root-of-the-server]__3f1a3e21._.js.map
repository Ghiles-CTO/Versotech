{"version":3,"sources":["../../../../../versotech-portal/src/components/subscriptions/subscription-detail-client.tsx/__nextjs-internal-proxy.mjs","../../../../../versotech-portal/src/app/%28main%29/versotech_main/subscriptions/%5Bid%5D/page.tsx"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport const SubscriptionDetailClient = registerClientReference(\n    function() { throw new Error(\"Attempted to call SubscriptionDetailClient() from the server but SubscriptionDetailClient is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/versotech-portal/src/components/subscriptions/subscription-detail-client.tsx\",\n    \"SubscriptionDetailClient\",\n);\n","import { createClient } from '@/lib/supabase/server'\nimport { requireStaffAuth } from '@/lib/auth'\nimport { notFound } from 'next/navigation'\nimport { SubscriptionDetailClient } from '@/components/subscriptions/subscription-detail-client'\n\nexport const dynamic = 'force-dynamic'\n\nexport default async function SubscriptionDetailPage({\n  params,\n}: {\n  params: Promise<{ id: string }>\n}) {\n  const { id } = await params\n\n  await requireStaffAuth()\n  const supabase = await createClient()\n\n  // Fetch subscription with all related data\n  const { data: subscription, error } = await supabase\n    .from('subscriptions')\n    .select(\n      `\n        *,\n        investor:investors (\n          id,\n          legal_name,\n          display_name,\n          type,\n          country,\n          email,\n          phone,\n          kyc_status,\n          status,\n          aml_risk_rating,\n          is_pep,\n          primary_rm,\n          primary_rm_profile:profiles!investors_primary_rm_fkey (\n            id,\n            display_name,\n            email\n          )\n        ),\n        vehicle:vehicles (\n          id,\n          name,\n          entity_code,\n          type,\n          currency,\n          status,\n          domicile,\n          formation_date\n        )\n      `\n    )\n    .eq('id', id)\n    .single()\n\n  if (error || !subscription) {\n    console.error('[Subscription Detail] Error:', error)\n    notFound()\n  }\n\n  // Fetch capital activity (cashflows)\n  const { data: cashflows } = await supabase\n    .from('cashflows')\n    .select('*')\n    .eq('investor_id', subscription.investor_id)\n    .eq('vehicle_id', subscription.vehicle_id)\n    .order('date', { ascending: false })\n\n  // Fetch capital calls related to this vehicle\n  const { data: capitalCalls } = await supabase\n    .from('capital_calls')\n    .select('*')\n    .eq('vehicle_id', subscription.vehicle_id)\n    .order('due_date', { ascending: false })\n\n  // Fetch distributions related to this vehicle\n  const { data: distributions } = await supabase\n    .from('distributions')\n    .select('*')\n    .eq('vehicle_id', subscription.vehicle_id)\n    .order('date', { ascending: false })\n\n  // Calculate metrics\n  const contributions = cashflows?.filter((cf) => cf.type === 'contribution') || []\n  const distributionsFlow = cashflows?.filter((cf) => cf.type === 'distribution') || []\n\n  const total_contributed = contributions.reduce((sum, cf) => sum + Number(cf.amount), 0)\n  const total_distributed = distributionsFlow.reduce((sum, cf) => sum + Number(cf.amount), 0)\n  const unfunded_commitment = Number(subscription.commitment) - total_contributed\n  const current_nav = total_contributed - total_distributed\n\n  const metrics = {\n    total_commitment: Number(subscription.commitment),\n    total_contributed,\n    total_distributed,\n    unfunded_commitment,\n    current_nav,\n    total_calls: capitalCalls?.length || 0,\n    pending_calls: capitalCalls?.filter((cc) => cc.status === 'pending')?.length || 0,\n  }\n\n  return (\n    <SubscriptionDetailClient\n      subscription={subscription}\n      cashflows={cashflows || []}\n      capitalCalls={capitalCalls || []}\n      distributions={distributions || []}\n      metrics={metrics}\n    />\n  )\n}\n"],"names":[],"mappings":"oZAEO,IAAM,EAA2B,CAAA,EAAA,AADxC,EAAA,CAAA,CAAA,QACwC,uBAAA,AAAuB,EAC3D,WAAa,MAAM,AAAI,MAAM,8PAAgQ,EAC7R,6GACA,6FAHG,IAAM,EAA2B,CAAA,EAAA,AADxC,EAAA,CAAA,CAAA,QACwC,uBAAA,AAAuB,EAC3D,WAAa,MAAM,AAAI,MAAM,8PAAgQ,EAC7R,yFACA,qICLJ,EAAA,EAAA,CAAA,CAAA,QACA,EAAA,EAAA,CAAA,CAAA,QACA,EAAA,CAAA,CAAA,QAAA,IAAA,EAAA,EAAA,CAAA,CAAA,QACA,EAAA,EAAA,CAAA,CAAA,QAIe,eAAe,EAAuB,CACnD,QAAM,CAGP,EACC,GAAM,IAAE,CAAE,CAAE,CAAG,MAAM,CAErB,OAAM,CAAA,EAAA,EAAA,gBAAA,AAAgB,IACtB,IAAM,EAAW,MAAM,CAAA,EAAA,EAAA,YAAA,AAAY,IAG7B,CAAE,KAAM,CAAY,OAAE,CAAK,CAAE,CAAG,MAAM,EACzC,IAAI,CAAC,iBACL,MAAM,CACL,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;MA+BD,CAAC,EAEF,EAAE,CAAC,KAAM,GACT,MAAM,IAEL,GAAS,CAAC,CAAA,GAAc,CAC1B,QAAQ,KAAK,CAAC,+BAAgC,GAC9C,CAAA,EAAA,EAAA,QAAA,AAAQ,KAIV,GAAM,CAAE,KAAM,CAAS,CAAE,CAAG,MAAM,EAC/B,IAAI,CAAC,aACL,MAAM,CAAC,KACP,EAAE,CAAC,cAAe,EAAa,WAAW,EAC1C,EAAE,CAAC,aAAc,EAAa,UAAU,EACxC,KAAK,CAAC,OAAQ,CAAE,WAAW,CAAM,GAG9B,CAAE,KAAM,CAAY,CAAE,CAAG,MAAM,EAClC,IAAI,CAAC,iBACL,MAAM,CAAC,KACP,EAAE,CAAC,aAAc,EAAa,UAAU,EACxC,KAAK,CAAC,WAAY,CAAE,WAAW,CAAM,GAGlC,CAAE,KAAM,CAAa,CAAE,CAAG,MAAM,EACnC,IAAI,CAAC,iBACL,MAAM,CAAC,KACP,EAAE,CAAC,aAAc,EAAa,UAAU,EACxC,KAAK,CAAC,OAAQ,CAAE,WAAW,CAAM,GAG9B,EAAgB,GAAW,OAAQ,AAAD,GAAoB,iBAAZ,EAAG,IAAI,GAAwB,EAAE,CAC3E,EAAoB,GAAW,OAAO,AAAC,GAAmB,iBAAZ,EAAG,IAAI,GAAwB,EAAE,CAE/E,EAAoB,EAAc,MAAM,CAAC,CAAC,EAAK,IAAO,EAAM,OAAO,EAAG,MAAM,EAAG,GAC/E,EAAoB,EAAkB,MAAM,CAAC,CAAC,EAAK,IAAO,EAAM,OAAO,EAAG,MAAM,EAAG,GACnF,EAAsB,OAAO,EAAa,UAAU,EAAI,EAGxD,EAAU,CACd,iBAAkB,OAAO,EAAa,UAAU,oBAChD,oBACA,sBACA,EACA,YAPkB,EAAoB,EAQtC,YAAa,GAAc,QAAU,EACrC,cAAe,GAAc,OAAO,AAAC,GAAqB,AAAd,cAAG,MAAM,GAAiB,QAAU,CAClF,EAEA,MACE,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,wBAAwB,CAAA,CACvB,aAAc,EACd,UAAW,GAAa,EAAE,CAC1B,aAAc,GAAgB,EAAE,CAChC,cAAe,GAAiB,EAAE,CAClC,QAAS,GAGf,kCA3GuB","ignoreList":[0]}