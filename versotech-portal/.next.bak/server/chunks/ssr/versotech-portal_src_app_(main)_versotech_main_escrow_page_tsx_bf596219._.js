module.exports=[77388,a=>{"use strict";var b=a.i(352584),c=a.i(611038),d=a.i(284169),e=a.i(15788),f=a.i(421908),g=a.i(663475),h=a.i(951870),i=a.i(771088),j=a.i(181608),k=a.i(686331),l=a.i(155508),m=a.i(42329),n=a.i(399580),o=a.i(487068),p=a.i(3321),q=a.i(877918),r=a.i(278541),s=a.i(600900),t=a.i(324117),u=a.i(838086),v=a.i(13542),w=a.i(709151),w=w,x=a.i(425622),y=a.i(587143),z=a.i(888987),A=a.i(201986),B=a.i(58834),C=a.i(470305),D=a.i(249464),E=a.i(191675),F=a.i(441278),G=a.i(899750);function H({open:a,onOpenChange:d,subscriptionId:e,dealName:i,investorName:j,commitment:k,fundedAmount:l,currency:m,mode:n,onSuccess:o,feeEventId:q=null,defaultAmount:r=null,defaultPaymentType:s,defaultRecipientId:t=null}){let[u,v]=(0,c.useState)(!1),[w,x]=(0,c.useState)(""),[y,z]=(0,c.useState)(""),[A,B]=(0,c.useState)(""),[H,I]=(0,c.useState)(""),[J,K]=(0,c.useState)(""),L=k-l;(0,c.useEffect)(()=>{a&&("payment"===n?(x(null!=r?String(r):""),I(s||""),K(t||"")):(x(""),I(""),K("")))},[a,n,r,s,t]);let M=async()=>{if(!e)return void G.toast.error("Invalid subscription reference");if(!w||0>=parseFloat(w))return void G.toast.error("Please enter a valid amount");v(!0);try{let a=await fetch(`/api/escrow/${e}/confirm-funding`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({amount:parseFloat(w),bank_reference:y||void 0,confirmation_notes:A||void 0})}),b=await a.json();if(!a.ok)throw Error(b.error||"Failed to confirm funding");G.toast.success(b.data.message),d(!1),o?.(),x(""),z(""),B("")}catch(a){console.error("Funding confirmation error:",a),G.toast.error(a instanceof Error?a.message:"Failed to confirm funding")}finally{v(!1)}},N=async()=>{if(!e)return void G.toast.error("Invalid subscription reference");if(!w||0>=parseFloat(w))return void G.toast.error("Please enter a valid amount");if(!H)return void G.toast.error("Please select a payment type");if("seller"!==H&&!J)return void G.toast.error("Please enter a recipient ID");v(!0);try{let a={payment_type:H,amount:parseFloat(w),bank_reference:y||void 0,confirmation_notes:A||void 0,fee_event_id:q||void 0};"seller"!==H&&(a.recipient_id=J);let b=await fetch(`/api/escrow/${e}/confirm-payment`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}),c=await b.json();if(!b.ok)throw Error(c.error||"Failed to confirm payment");G.toast.success(c.data.message),d(!1),o?.(),x(""),z(""),B(""),I(""),K("")}catch(a){console.error("Payment confirmation error:",a),G.toast.error(a instanceof Error?a.message:"Failed to confirm payment")}finally{v(!1)}};return(0,b.jsx)(C.Dialog,{open:a,onOpenChange:d,children:(0,b.jsxs)(C.DialogContent,{className:"sm:max-w-[500px]",children:[(0,b.jsxs)(C.DialogHeader,{children:[(0,b.jsx)(C.DialogTitle,{children:"funding"===n?"Confirm Escrow Funding":"Confirm Fee Payment"}),(0,b.jsx)(C.DialogDescription,{children:"funding"===n?(0,b.jsxs)(b.Fragment,{children:["Confirm funding received for ",(0,b.jsx)("strong",{children:j}),"'s subscription in ",(0,b.jsx)("strong",{children:i}),"."]}):(0,b.jsxs)(b.Fragment,{children:["Confirm fee payment processed for ",(0,b.jsx)("strong",{children:i}),"."]})})]}),(0,b.jsxs)("div",{className:"space-y-4 py-4",children:["funding"===n&&(0,b.jsxs)("div",{className:"rounded-lg bg-muted p-3 text-sm",children:[(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Commitment:"}),(0,b.jsxs)("span",{className:"font-medium",children:[k.toLocaleString()," ",m]})]}),(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Already Funded:"}),(0,b.jsxs)("span",{className:"font-medium",children:[l.toLocaleString()," ",m]})]}),(0,b.jsxs)("div",{className:"flex justify-between border-t pt-2 mt-2",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Remaining:"}),(0,b.jsxs)("span",{className:"font-bold text-amber-600",children:[L.toLocaleString()," ",m]})]})]}),"payment"===n&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(D.Label,{htmlFor:"paymentType",children:"Payment Type"}),(0,b.jsxs)(h.Select,{value:H,onValueChange:I,children:[(0,b.jsx)(h.SelectTrigger,{children:(0,b.jsx)(h.SelectValue,{placeholder:"Select payment type"})}),(0,b.jsxs)(h.SelectContent,{children:[(0,b.jsx)(h.SelectItem,{value:"partner",children:"Partner Fee"}),(0,b.jsx)(h.SelectItem,{value:"introducer",children:"Introducer Fee"}),(0,b.jsx)(h.SelectItem,{value:"commercial_partner",children:"Commercial Partner Fee"}),(0,b.jsx)(h.SelectItem,{value:"seller",children:"Payment to Seller"})]})]})]}),"seller"!==H&&(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(D.Label,{htmlFor:"recipientId",children:"Recipient ID"}),(0,b.jsx)(g.Input,{id:"recipientId",placeholder:"Enter recipient entity ID",value:J,onChange:a=>K(a.target.value)})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)(D.Label,{htmlFor:"amount",children:["Amount Confirmed (",m,")"]}),(0,b.jsx)(g.Input,{id:"amount",type:"number",step:"0.01",min:"0",placeholder:"funding"===n?`e.g., ${L.toLocaleString()}`:"Enter amount",value:w,onChange:a=>x(a.target.value)})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(D.Label,{htmlFor:"bankReference",children:"Bank Reference (Optional)"}),(0,b.jsx)(g.Input,{id:"bankReference",placeholder:"Wire transfer reference",value:y,onChange:a=>z(a.target.value)})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(D.Label,{htmlFor:"notes",children:"Notes (Optional)"}),(0,b.jsx)(E.Textarea,{id:"notes",placeholder:"Any additional notes...",value:A,onChange:a=>B(a.target.value),rows:2})]})]}),(0,b.jsxs)(C.DialogFooter,{children:[(0,b.jsx)(f.Button,{variant:"outline",onClick:()=>d(!1),disabled:u,children:"Cancel"}),(0,b.jsx)(f.Button,{onClick:"funding"===n?M:N,disabled:u,children:u?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(p.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),"Confirming..."]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(F.CheckCircle,{className:"mr-2 h-4 w-4"}),"Confirm ","funding"===n?"Funding":"Payment"]})})]})]})})}var I=a.i(716103);let J={pending:"bg-yellow-100 text-yellow-800 border-yellow-200",funded:"bg-green-100 text-green-800 border-green-200",partially_funded:"bg-blue-100 text-blue-800 border-blue-200",overdue:"bg-red-100 text-red-800 border-red-200",cancelled:"bg-gray-100 text-gray-800 border-gray-200"},K={accrued:"bg-blue-100 text-blue-800 border-blue-200",invoiced:"bg-amber-100 text-amber-800 border-amber-200",paid:"bg-emerald-100 text-emerald-800 border-emerald-200",waived:"bg-gray-100 text-gray-800 border-gray-200",cancelled:"bg-gray-100 text-gray-800 border-gray-200",disputed:"bg-red-100 text-red-800 border-red-200",voided:"bg-gray-100 text-gray-800 border-gray-200"},L=[{label:"All Status",value:"all"},{label:"Pending",value:"pending"},{label:"Partially Funded",value:"partially_funded"},{label:"Funded",value:"funded"},{label:"Overdue",value:"overdue"}];function M(){let[a,C]=(0,c.useState)(null),[D,E]=(0,c.useState)(null),[F,G]=(0,c.useState)([]),[M,N]=(0,c.useState)([]),[O,P]=(0,c.useState)([]),[Q,R]=(0,c.useState)({totalDeals:0,pendingSettlements:0,totalPendingValue:0,overdueSettlements:0}),[S,T]=(0,c.useState)(!0),[U,V]=(0,c.useState)(null),[W,X]=(0,c.useState)(""),[Y,Z]=(0,c.useState)("all"),[$,_]=(0,c.useState)("deals"),[aa,ab]=(0,c.useState)(0),[ac,ad]=(0,c.useState)(void 0),[ae,af]=(0,c.useState)(!1),[ag,ah]=(0,c.useState)("funding"),[ai,aj]=(0,c.useState)(null),[ak,al]=(0,c.useState)(null),am=(0,c.useCallback)(()=>{ab(a=>a+1)},[]);(0,c.useEffect)(()=>{async function a(a,b){let{data:c,error:e}=await a.from("deals").select("id").eq("arranger_entity_id",b),f=(c||[]).map(a=>a.id);if(0===f.length)return void await d(a,[]);let{data:g,error:h}=await a.from("deal_fee_structures").select(`
          id,
          deal_id,
          status,
          legal_counsel,
          wire_escrow_agent,
          wire_bank_name,
          wire_account_holder,
          wire_iban,
          wire_bic,
          escrow_fee_text,
          deal:deal_id (
            id,
            name,
            company_name,
            target_amount,
            currency,
            status
          )
        `).in("deal_id",f).eq("status","published").order("created_at",{ascending:!1});if(h)throw h;await d(a,g||[])}async function b(a,b,c){let{data:e,error:f}=await a.from("deal_lawyer_assignments").select("deal_id").eq("lawyer_id",b),g=(e||[]).map(a=>a.deal_id);if((!g.length||f)&&c?.length&&(g=c),0===g.length)return void await d(a,[]);let{data:h,error:i}=await a.from("deal_fee_structures").select(`
          id,
          deal_id,
          status,
          legal_counsel,
          wire_escrow_agent,
          wire_bank_name,
          wire_account_holder,
          wire_iban,
          wire_bic,
          escrow_fee_text,
          deal:deal_id (
            id,
            name,
            company_name,
            target_amount,
            currency,
            status
          )
        `).in("deal_id",g).eq("status","published").order("created_at",{ascending:!1});if(i)throw i;await d(a,h||[])}async function c(a){let{data:b,error:c}=await a.from("deal_fee_structures").select(`
          id,
          deal_id,
          status,
          legal_counsel,
          wire_escrow_agent,
          wire_bank_name,
          wire_account_holder,
          wire_iban,
          wire_bic,
          escrow_fee_text,
          deal:deal_id (
            id,
            name,
            company_name,
            target_amount,
            currency,
            status
          )
        `).not("wire_escrow_agent","is",null).eq("status","published").order("created_at",{ascending:!1}).limit(100);if(c)throw c;await d(a,b||[])}async function d(a,b){if(0===b.length){G([]),N([]),P([]),R({totalDeals:0,pendingSettlements:0,totalPendingValue:0,overdueSettlements:0});return}let c=b.map(a=>a.deal_id),{data:d,error:e}=await a.from("subscriptions").select(`
          id,
          deal_id,
          investor_id,
          introducer_id,
          proxy_commercial_partner_id,
          commitment,
          funded_amount,
          outstanding_amount,
          funding_due_at,
          status,
          funded_at,
          investor:investor_id (
            id,
            display_name,
            legal_name
          )
        `).in("deal_id",c).in("status",["committed","approved","funded","active","partially_funded"]).order("created_at",{ascending:!1});if(e)throw e;let f=b.map(a=>{let b=(d||[]).filter(b=>b.deal_id===a.deal_id),c=b.reduce((a,b)=>a+(Number(b.outstanding_amount)||0),0),e=b.reduce((a,b)=>a+(Number(b.funded_amount)||0),0);return{id:a.id,deal_id:a.deal_id,deal_name:a.deal?.name||"Unknown Deal",company_name:a.deal?.company_name,status:a.status,legal_counsel:a.legal_counsel,wire_escrow_agent:a.wire_escrow_agent,wire_bank_name:a.wire_bank_name,wire_account_holder:a.wire_account_holder,wire_iban:a.wire_iban,wire_bic:a.wire_bic,escrow_fee_text:a.escrow_fee_text,target_amount:Number(a.deal?.target_amount)||0,currency:a.deal?.currency||"USD",subscriptions_count:b.length,pending_funding:c,funded_amount:e}});G(f);let g=new Date,h=(d||[]).filter(a=>(Number(a.outstanding_amount)||0)>0).map(a=>{let c=a.funding_due_at?new Date(a.funding_due_at):null,d=c?Math.floor((g.getTime()-c.getTime())/864e5):0,e=b.find(b=>b.deal_id===a.deal_id),f=a.status;return f=d>0?"overdue":Number(a.funded_amount)>0?"partially_funded":"pending",{id:a.id,investor_name:a.investor?.display_name||"Unknown Investor",investor_entity:a.investor?.legal_name,deal_name:e?.deal?.name||"Unknown Deal",deal_id:a.deal_id,commitment_amount:Number(a.commitment)||0,funded_amount:Number(a.funded_amount)||0,outstanding_amount:Number(a.outstanding_amount)||0,currency:e?.deal?.currency||"USD",funding_due_at:a.funding_due_at,status:f,days_overdue:Math.max(0,d)}});N(h);let i=new Map;(d||[]).forEach(a=>{a?.id&&i.set(a.id,{introducer_id:a.introducer_id||null,proxy_commercial_partner_id:a.proxy_commercial_partner_id||null})});let j=h.filter(a=>a.days_overdue>0).length,k=h.reduce((a,b)=>a+b.outstanding_amount,0);R({totalDeals:f.length,pendingSettlements:h.length,totalPendingValue:k,overdueSettlements:j});let{data:l,error:m}=await a.from("fee_events").select(`
          id,
          deal_id,
          investor_id,
          fee_type,
          base_amount,
          computed_amount,
          currency,
          status,
          event_date,
          invoice_id,
          allocation_id,
          investors (
            display_name,
            legal_name
          ),
          invoices:invoice_id (
            invoice_number,
            status,
            due_date
          )
        `).in("deal_id",c).order("event_date",{ascending:!1});if(m)console.error("[EscrowPage] Failed to load fee events:",m),P([]);else{let a=new Map;b.forEach(b=>{b?.deal_id&&b?.deal?.name&&a.set(b.deal_id,b.deal.name)}),P((l||[]).map(b=>{let c,d=Array.isArray(b.investors)?b.investors[0]:b.investors,e=Array.isArray(b.invoices)?b.invoices[0]:b.invoices,f=b.allocation_id?i.get(b.allocation_id):null,g=null;return f?.introducer_id?(c="introducer",g=f.introducer_id):f?.proxy_commercial_partner_id&&(c="commercial_partner",g=f.proxy_commercial_partner_id),{id:b.id,deal_id:b.deal_id,deal_name:a.get(b.deal_id)||"Unknown Deal",investor_name:d?.display_name||d?.legal_name||"Unknown Investor",subscription_id:b.allocation_id||null,fee_type:b.fee_type||null,base_amount:b.base_amount??null,computed_amount:Number(b.computed_amount||0),currency:b.currency||"USD",status:b.status||"accrued",event_date:b.event_date,invoice_id:b.invoice_id||null,invoice_number:e?.invoice_number||null,invoice_status:e?.status||null,invoice_due_date:e?.due_date||null,default_payment_type:c,default_recipient_id:g}}))}}!async function(){try{T(!0);let d=(0,B.createClient)(),{data:{user:e}}=await d.auth.getUser();if(!e)return void V("Not authenticated");let{data:f,error:g}=await d.from("lawyer_users").select("lawyer_id").eq("user_id",e.id).maybeSingle();if(f){let{data:a,error:c}=await d.from("lawyers").select("id, firm_name, display_name, specializations, is_active, assigned_deals").eq("id",f.lawyer_id).single();if(!c&&a){C(a),await b(d,a.id,a.assigned_deals);return}}let{data:h,error:i}=await d.from("arranger_users").select("arranger_id").eq("user_id",e.id).maybeSingle();if(h){let{data:b,error:c}=await d.from("arranger_entities").select("id, legal_name, status").eq("id",h.arranger_id).single();if(!c&&b){E(b),await a(d,b.id);return}}let{data:j}=await d.from("partner_users").select("partner_id").eq("user_id",e.id).maybeSingle();if(j)return void V("Access restricted. Partners cannot access escrow information.");await c(d),V(null)}catch(a){console.error("[EscrowPage] Error:",a),V(a instanceof Error?a.message:"Failed to load escrow data")}finally{T(!1)}}()},[aa]);let an=M.filter(a=>{let b="all"===Y||a.status===Y,c=!W||a.investor_name?.toLowerCase().includes(W.toLowerCase())||a.deal_name?.toLowerCase().includes(W.toLowerCase())||a.investor_entity?.toLowerCase().includes(W.toLowerCase()),d=!0;if(ac?.from&&a.funding_due_at){let b=new Date(a.funding_due_at);d=b>=ac.from,ac.to&&(d=d&&b<=ac.to)}return b&&c&&d}),ao=F.filter(a=>!W||a.deal_name?.toLowerCase().includes(W.toLowerCase())||a.company_name?.toLowerCase().includes(W.toLowerCase())||a.wire_escrow_agent?.toLowerCase().includes(W.toLowerCase())),ap=O.filter(a=>{let b=!W||a.deal_name.toLowerCase().includes(W.toLowerCase())||a.investor_name.toLowerCase().includes(W.toLowerCase()),c=!0;if(ac?.from&&a.event_date){let b=new Date(a.event_date);c=b>=ac.from,ac.to&&(c=c&&b<=ac.to)}return b&&c}),aq=(0,c.useCallback)(()=>{let a=new Blob([["Deal,Investor,Entity,Commitment,Funded,Outstanding,Status,Due Date",...an.map(a=>[a.deal_name,a.investor_name,a.investor_entity||"",a.commitment_amount.toString(),a.funded_amount.toString(),a.outstanding_amount.toString(),a.status.replace("_"," "),a.funding_due_at||""]).map(a=>a.map(a=>`"${a.replace(/"/g,'""')}"`).join(","))].join("\n")],{type:"text/csv;charset=utf-8;"}),b=document.createElement("a"),c=URL.createObjectURL(a);b.setAttribute("href",c),b.setAttribute("download",`escrow-settlements-${new Date().toISOString().split("T")[0]}.csv`),b.style.visibility="hidden",document.body.appendChild(b),b.click(),document.body.removeChild(b),URL.revokeObjectURL(c)},[an]);return S?(0,b.jsxs)("div",{className:"flex items-center justify-center py-16",children:[(0,b.jsx)(p.Loader2,{className:"h-8 w-8 animate-spin text-muted-foreground"}),(0,b.jsx)("span",{className:"ml-3 text-muted-foreground",children:"Loading escrow data..."})]}):U?(0,b.jsxs)("div",{className:"text-center py-16",children:[(0,b.jsx)(q.AlertCircle,{className:"h-12 w-12 text-destructive mx-auto mb-4"}),(0,b.jsx)("h3",{className:"text-lg font-medium text-foreground mb-2",children:"Error Loading Escrow Data"}),(0,b.jsx)("p",{className:"text-muted-foreground",children:U})]}):(0,b.jsxs)("div",{className:"p-6 space-y-6",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-2xl font-bold text-foreground",children:"Escrow Management"}),(0,b.jsx)("p",{className:"text-muted-foreground mt-1",children:a?`Manage escrow accounts and settlements for ${a.display_name}`:D?`View escrow status for deals managed by ${D.legal_name}`:"Monitor all escrow accounts and pending settlements"})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[M.length>0&&(0,b.jsxs)(f.Button,{variant:"outline",size:"sm",onClick:aq,children:[(0,b.jsx)(x.Download,{className:"h-4 w-4 mr-2"}),"Export CSV"]}),a&&a.specializations&&a.specializations.length>0&&(0,b.jsx)("div",{className:"flex gap-1",children:a.specializations.slice(0,2).map((a,c)=>(0,b.jsx)(e.Badge,{variant:"outline",className:"capitalize",children:a},c))}),D&&(0,b.jsxs)(e.Badge,{variant:"secondary",className:"flex items-center gap-1",children:[(0,b.jsx)(r.Building2,{className:"h-3 w-3"}),"Arranger View"]})]})]}),D&&!a&&(0,b.jsxs)("div",{className:"flex items-start gap-3 rounded-lg border border-blue-200 bg-blue-50 p-4 dark:border-blue-800 dark:bg-blue-950/30",children:[(0,b.jsx)(y.Info,{className:"h-5 w-5 text-blue-600 dark:text-blue-400 mt-0.5 shrink-0"}),(0,b.jsxs)("div",{className:"text-sm",children:[(0,b.jsx)("p",{className:"font-medium text-blue-900 dark:text-blue-100",children:"View-Only Access"}),(0,b.jsx)("p",{className:"text-blue-700 dark:text-blue-300 mt-0.5",children:"As an arranger, you can monitor escrow status and view transaction details for deals you manage. Funding confirmations and fee payments are handled by assigned lawyers."})]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,b.jsxs)(d.Card,{children:[(0,b.jsx)(d.CardHeader,{className:"pb-2",children:(0,b.jsxs)(d.CardTitle,{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[(0,b.jsx)(k.Lock,{className:"h-4 w-4"}),"Escrow Deals"]})}),(0,b.jsxs)(d.CardContent,{children:[(0,b.jsx)("div",{className:"text-2xl font-bold",children:Q.totalDeals}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Active escrow accounts"})]})]}),(0,b.jsxs)(d.Card,{children:[(0,b.jsx)(d.CardHeader,{className:"pb-2",children:(0,b.jsxs)(d.CardTitle,{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[(0,b.jsx)(m.Clock,{className:"h-4 w-4"}),"Pending Settlements"]})}),(0,b.jsxs)(d.CardContent,{children:[(0,b.jsx)("div",{className:"text-2xl font-bold text-yellow-600",children:Q.pendingSettlements}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Awaiting funding"})]})]}),(0,b.jsxs)(d.Card,{children:[(0,b.jsx)(d.CardHeader,{className:"pb-2",children:(0,b.jsxs)(d.CardTitle,{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[(0,b.jsx)(l.DollarSign,{className:"h-4 w-4"}),"Pending Value"]})}),(0,b.jsxs)(d.CardContent,{children:[(0,b.jsx)("div",{className:"text-2xl font-bold text-blue-600",children:(0,A.formatCurrency)(Q.totalPendingValue,"USD")}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Total outstanding"})]})]}),(0,b.jsxs)(d.Card,{children:[(0,b.jsx)(d.CardHeader,{className:"pb-2",children:(0,b.jsxs)(d.CardTitle,{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[(0,b.jsx)(u.AlertTriangle,{className:"h-4 w-4"}),"Overdue"]})}),(0,b.jsxs)(d.CardContent,{children:[(0,b.jsx)("div",{className:"text-2xl font-bold text-red-600",children:Q.overdueSettlements}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Past due date"})]})]})]}),(0,b.jsx)(d.Card,{children:(0,b.jsx)(d.CardContent,{className:"pt-6",children:(0,b.jsxs)("div",{className:"flex flex-col md:flex-row gap-4",children:[(0,b.jsx)("div",{className:"flex-1",children:(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)(o.Search,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),(0,b.jsx)(g.Input,{placeholder:"Search deals, investors, or escrow agents...",value:W,onChange:a=>X(a.target.value),className:"pl-10"})]})}),"settlements"===$&&(0,b.jsxs)(h.Select,{value:Y,onValueChange:Z,children:[(0,b.jsx)(h.SelectTrigger,{className:"w-full md:w-48",children:(0,b.jsx)(h.SelectValue,{placeholder:"Filter by status"})}),(0,b.jsx)(h.SelectContent,{children:L.map(a=>(0,b.jsx)(h.SelectItem,{value:a.value,children:a.label},a.value))})]}),("settlements"===$||"payments"===$)&&(0,b.jsx)(I.DateRangePicker,{value:ac,onChange:ad,className:"w-full md:w-auto"})]})})}),(0,b.jsxs)(j.Tabs,{value:$,onValueChange:_,className:"space-y-4",children:[(0,b.jsxs)(j.TabsList,{children:[(0,b.jsxs)(j.TabsTrigger,{value:"deals",className:"flex items-center gap-2",children:[(0,b.jsx)(s.Wallet,{className:"h-4 w-4"}),"Escrow Accounts (",F.length,")"]}),(0,b.jsxs)(j.TabsTrigger,{value:"settlements",className:"flex items-center gap-2",children:[(0,b.jsx)(w.default,{className:"h-4 w-4"}),"Pending Settlements (",M.length,")"]}),(0,b.jsxs)(j.TabsTrigger,{value:"payments",className:"flex items-center gap-2",children:[(0,b.jsx)(v.CreditCard,{className:"h-4 w-4"}),"Fee Payments (",O.length,")"]})]}),(0,b.jsx)(j.TabsContent,{value:"deals",children:(0,b.jsxs)(d.Card,{children:[(0,b.jsxs)(d.CardHeader,{children:[(0,b.jsx)(d.CardTitle,{children:"Escrow Accounts"}),(0,b.jsxs)(d.CardDescription,{children:[ao.length," deal",1!==ao.length?"s":""," with escrow accounts"]})]}),(0,b.jsx)(d.CardContent,{children:0===ao.length?(0,b.jsxs)("div",{className:"border border-dashed border-muted rounded-lg py-12 flex flex-col items-center justify-center text-center space-y-2",children:[(0,b.jsx)(k.Lock,{className:"h-10 w-10 text-muted-foreground"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:W?"No escrow accounts match your search":a?"No deals with you as legal counsel":D?"No deals managed by your arranger entity":"No deals with escrow accounts found"})]}):(0,b.jsx)("div",{className:"rounded-md border",children:(0,b.jsxs)(i.Table,{children:[(0,b.jsx)(i.TableHeader,{children:(0,b.jsxs)(i.TableRow,{children:[(0,b.jsx)(i.TableHead,{children:"Deal"}),(0,b.jsx)(i.TableHead,{children:"Escrow Agent"}),(0,b.jsx)(i.TableHead,{children:"Bank"}),(0,b.jsx)(i.TableHead,{children:"Subscriptions"}),(0,b.jsx)(i.TableHead,{children:"Funded / Pending"}),(0,b.jsx)(i.TableHead,{className:"text-right",children:"Actions"})]})}),(0,b.jsx)(i.TableBody,{children:ao.map(c=>(0,b.jsxs)(i.TableRow,{children:[(0,b.jsx)(i.TableCell,{children:(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("div",{className:"h-10 w-10 rounded-lg bg-muted flex items-center justify-center",children:(0,b.jsx)(r.Building2,{className:"h-5 w-5 text-muted-foreground"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"font-medium",children:c.deal_name}),c.company_name&&(0,b.jsx)("div",{className:"text-xs text-muted-foreground",children:c.company_name})]})]})}),(0,b.jsxs)(i.TableCell,{children:[(0,b.jsx)("div",{className:"font-medium",children:c.wire_escrow_agent||"—"}),c.escrow_fee_text&&(0,b.jsx)("div",{className:"text-xs text-muted-foreground",children:c.escrow_fee_text})]}),(0,b.jsx)(i.TableCell,{children:(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-sm",children:c.wire_bank_name||"—"}),c.wire_iban&&(0,b.jsxs)("div",{className:"text-xs text-muted-foreground font-mono",children:[c.wire_iban.slice(0,8),"..."]})]})}),(0,b.jsx)(i.TableCell,{children:(0,b.jsxs)(e.Badge,{variant:"secondary",children:[c.subscriptions_count," investor",1!==c.subscriptions_count?"s":""]})}),(0,b.jsx)(i.TableCell,{children:(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsxs)("div",{className:"text-sm font-medium text-green-600",children:[(0,A.formatCurrency)(c.funded_amount,c.currency)," funded"]}),c.pending_funding>0&&(0,b.jsxs)("div",{className:"text-xs text-yellow-600",children:[(0,A.formatCurrency)(c.pending_funding,c.currency)," pending"]})]})}),(0,b.jsx)(i.TableCell,{className:"text-right",children:(0,b.jsx)(f.Button,{variant:"ghost",size:"sm",asChild:!0,children:(0,b.jsx)("a",{href:a?`/versotech_main/lawyer-deal/${c.deal_id}`:`/versotech_main/opportunities/${c.deal_id}`,children:(0,b.jsx)(t.ArrowUpRight,{className:"h-4 w-4"})})})})]},c.id))})]})})})]})}),(0,b.jsx)(j.TabsContent,{value:"settlements",children:(0,b.jsxs)(d.Card,{children:[(0,b.jsxs)(d.CardHeader,{children:[(0,b.jsx)(d.CardTitle,{children:"Pending Settlements"}),(0,b.jsxs)(d.CardDescription,{children:[an.length," settlement",1!==an.length?"s":""," awaiting funding"]})]}),(0,b.jsx)(d.CardContent,{children:0===an.length?(0,b.jsxs)("div",{className:"border border-dashed border-muted rounded-lg py-12 flex flex-col items-center justify-center text-center space-y-2",children:[(0,b.jsx)(n.CheckCircle2,{className:"h-10 w-10 text-muted-foreground"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:W||"all"!==Y?"No settlements match your filters":"No pending settlements"})]}):(0,b.jsx)("div",{className:"rounded-md border",children:(0,b.jsxs)(i.Table,{children:[(0,b.jsx)(i.TableHeader,{children:(0,b.jsxs)(i.TableRow,{children:[(0,b.jsx)(i.TableHead,{children:"Investor"}),(0,b.jsx)(i.TableHead,{children:"Deal"}),(0,b.jsx)(i.TableHead,{children:"Commitment"}),(0,b.jsx)(i.TableHead,{children:"Outstanding"}),(0,b.jsx)(i.TableHead,{children:"Due Date"}),(0,b.jsx)(i.TableHead,{children:"Status"}),(0,b.jsx)(i.TableHead,{className:"text-right",children:"Actions"})]})}),(0,b.jsx)(i.TableBody,{children:an.map(c=>(0,b.jsxs)(i.TableRow,{children:[(0,b.jsx)(i.TableCell,{children:(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"font-medium",children:c.investor_name}),c.investor_entity&&(0,b.jsx)("div",{className:"text-xs text-muted-foreground",children:c.investor_entity})]})}),(0,b.jsx)(i.TableCell,{children:(0,b.jsx)("a",{href:a?`/versotech_main/lawyer-deal/${c.deal_id}`:`/versotech_main/opportunities/${c.deal_id}`,className:"text-primary hover:underline",children:c.deal_name})}),(0,b.jsxs)(i.TableCell,{children:[(0,b.jsx)("div",{className:"font-medium",children:(0,A.formatCurrency)(c.commitment_amount,c.currency)}),c.funded_amount>0&&(0,b.jsxs)("div",{className:"text-xs text-green-600",children:[(0,A.formatCurrency)(c.funded_amount,c.currency)," received"]})]}),(0,b.jsx)(i.TableCell,{children:(0,b.jsx)("div",{className:"font-medium text-yellow-600",children:(0,A.formatCurrency)(c.outstanding_amount,c.currency)})}),(0,b.jsx)(i.TableCell,{children:c.funding_due_at?(0,b.jsxs)("div",{className:(0,z.cn)("text-sm",c.days_overdue>0&&"text-red-600 font-medium"),children:[(0,A.formatDate)(c.funding_due_at),c.days_overdue>0&&(0,b.jsxs)("div",{className:"text-xs",children:[c.days_overdue," day",1!==c.days_overdue?"s":""," overdue"]})]}):(0,b.jsx)("span",{className:"text-muted-foreground text-xs",children:"Not set"})}),(0,b.jsx)(i.TableCell,{children:(0,b.jsx)(e.Badge,{variant:"outline",className:(0,z.cn)("capitalize",J[c.status]||J.pending),children:c.status.replace("_"," ")})}),(0,b.jsx)(i.TableCell,{className:"text-right",children:"funded"!==c.status&&a&&(0,b.jsxs)(f.Button,{variant:"outline",size:"sm",onClick:()=>{ah("funding"),aj(c),al(null),af(!0)},children:[(0,b.jsx)(n.CheckCircle2,{className:"h-4 w-4 mr-1"}),"Confirm Funding"]})})]},c.id))})]})})})]})}),(0,b.jsx)(j.TabsContent,{value:"payments",children:(0,b.jsxs)(d.Card,{children:[(0,b.jsxs)(d.CardHeader,{children:[(0,b.jsx)(d.CardTitle,{children:"Fee Payments"}),(0,b.jsxs)(d.CardDescription,{children:[ap.length," fee event",1!==ap.length?"s":""," for assigned deals"]})]}),(0,b.jsx)(d.CardContent,{children:0===ap.length?(0,b.jsxs)("div",{className:"border border-dashed border-muted rounded-lg py-12 flex flex-col items-center justify-center text-center space-y-2",children:[(0,b.jsx)(v.CreditCard,{className:"h-10 w-10 text-muted-foreground"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:W?"No fee events match your filters":"No fee events to display"})]}):(0,b.jsx)("div",{className:"rounded-md border",children:(0,b.jsxs)(i.Table,{children:[(0,b.jsx)(i.TableHeader,{children:(0,b.jsxs)(i.TableRow,{children:[(0,b.jsx)(i.TableHead,{children:"Deal"}),(0,b.jsx)(i.TableHead,{children:"Investor"}),(0,b.jsx)(i.TableHead,{children:"Fee Type"}),(0,b.jsx)(i.TableHead,{children:"Amount"}),(0,b.jsx)(i.TableHead,{children:"Invoice"}),(0,b.jsx)(i.TableHead,{children:"Due Date"}),(0,b.jsx)(i.TableHead,{children:"Status"}),(0,b.jsx)(i.TableHead,{className:"text-right",children:"Actions"})]})}),(0,b.jsx)(i.TableBody,{children:ap.map(c=>(0,b.jsxs)(i.TableRow,{children:[(0,b.jsx)(i.TableCell,{children:(0,b.jsx)("div",{className:"font-medium",children:c.deal_name})}),(0,b.jsx)(i.TableCell,{children:(0,b.jsx)("div",{className:"font-medium",children:c.investor_name})}),(0,b.jsx)(i.TableCell,{className:"capitalize",children:(c.fee_type||"fee").replace("_"," ")}),(0,b.jsxs)(i.TableCell,{children:[(0,b.jsx)("div",{className:"font-medium",children:(0,A.formatCurrency)(c.computed_amount,c.currency)}),null!=c.base_amount&&(0,b.jsxs)("div",{className:"text-xs text-muted-foreground",children:["Base: ",(0,A.formatCurrency)(c.base_amount,c.currency)]})]}),(0,b.jsx)(i.TableCell,{children:c.invoice_number?(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-sm font-medium",children:c.invoice_number}),c.invoice_status&&(0,b.jsx)("div",{className:"text-xs text-muted-foreground capitalize",children:c.invoice_status.replace("_"," ")})]}):(0,b.jsx)("span",{className:"text-xs text-muted-foreground",children:"Not issued"})}),(0,b.jsx)(i.TableCell,{children:c.invoice_due_date?(0,b.jsx)("div",{className:"text-sm",children:(0,A.formatDate)(c.invoice_due_date)}):(0,b.jsx)("span",{className:"text-xs text-muted-foreground",children:"Not set"})}),(0,b.jsx)(i.TableCell,{children:(0,b.jsx)(e.Badge,{variant:"outline",className:(0,z.cn)("capitalize",K[c.status]||"bg-gray-100 text-gray-800 border-gray-200"),children:c.status.replace("_"," ")})}),(0,b.jsxs)(i.TableCell,{className:"text-right",children:[["accrued","invoiced"].includes(c.status)&&c.subscription_id&&a&&(0,b.jsxs)(f.Button,{variant:"outline",size:"sm",onClick:()=>{ah("payment"),al(c),aj(null),af(!0)},children:[(0,b.jsx)(n.CheckCircle2,{className:"h-4 w-4 mr-1"}),"Confirm Payment"]}),["accrued","invoiced"].includes(c.status)&&!c.subscription_id&&a&&(0,b.jsx)("span",{className:"text-xs text-muted-foreground",children:"No subscription"})]})]},c.id))})]})})})]})})]}),(ai||ak)&&(0,b.jsx)(H,{open:ae,onOpenChange:af,mode:ag,subscriptionId:ai?.id||ak?.subscription_id||"",investorName:ai?.investor_name||ak?.investor_name||"Recipient",dealName:ai?.deal_name||ak?.deal_name||"Deal",commitment:ai?.commitment_amount||0,fundedAmount:ai?.funded_amount||0,currency:ai?.currency||ak?.currency||"USD",feeEventId:ak?.id||null,defaultAmount:ak?.computed_amount||null,defaultPaymentType:ak?.default_payment_type,defaultRecipientId:ak?.default_recipient_id||null,onSuccess:am})]})}a.s(["default",()=>M],77388)}];

//# sourceMappingURL=versotech-portal_src_app_%28main%29_versotech_main_escrow_page_tsx_bf596219._.js.map