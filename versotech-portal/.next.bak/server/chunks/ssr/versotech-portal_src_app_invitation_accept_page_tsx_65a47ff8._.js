module.exports=[985674,a=>{"use strict";var b=a.i(352584),c=a.i(611038),d=a.i(289633),e=a.i(284169),f=a.i(421908),g=a.i(15788),h=a.i(403205),i=a.i(663475),j=a.i(249464),k=a.i(3321),l=a.i(399580),m=a.i(625473),n=a.i(42329),o=a.i(278541),p=a.i(439467),q=a.i(752907),r=a.i(799373);let s=(0,a.i(95799).default)("log-in",[["path",{d:"m10 17 5-5-5-5",key:"1bsop3"}],["path",{d:"M15 12H3",key:"6jk70r"}],["path",{d:"M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4",key:"u53s6r"}]]);var t=a.i(877918),u=a.i(264890),v=a.i(575661),w=a.i(497412),x=a.i(976839);let y={partner:"Partner",investor:"Investor Entity",introducer:"Introducer",commercial_partner:"Commercial Partner",lawyer:"Law Firm",arranger:"Arranger",ceo:"CEO Office",staff:"VERSO Staff"};function z(){let a,z,A;(0,d.useRouter)();let B=(0,d.useSearchParams)().get("token"),[C,D]=(0,c.useState)(!0),[E,F]=(0,c.useState)(null),[G,H]=(0,c.useState)(null),[I,J]=(0,c.useState)(!1),[K,L]=(0,c.useState)(!1),[M,N]=(0,c.useState)(null),[O,P]=(0,c.useState)(!1),[Q,R]=(0,c.useState)(""),[S,T]=(0,c.useState)(""),[U,V]=(0,c.useState)(""),[W,X]=(0,c.useState)(!1),[Y,Z]=(0,c.useState)(!1),[$,_]=(0,c.useState)(!1),[aa,ab]=(0,c.useState)(""),[ac,ad]=(0,c.useState)(!1);(0,c.useEffect)(()=>{if(!B){F("Invalid invitation link - no token provided"),D(!1);return}ae()},[B]);let ae=async()=>{try{let a=await fetch(`/api/invitations/${B}`),b=await a.json();if(!a.ok)return void F(b.error||"Failed to load invitation");H(b)}catch(a){F("Failed to load invitation details")}finally{D(!1)}},af=async()=>{if(B){J(!0),F(null);try{let a=await fetch(`/api/invitations/${B}`,{method:"POST"}),b=await a.json();if(!a.ok)return void F(b.error||"Failed to accept invitation");L(!0),N(b),setTimeout(()=>{window.location.href=b.redirect_url||"/versotech_main/dashboard"},3e3)}catch(a){F("Failed to accept invitation")}finally{J(!1)}}},ag=async a=>{if(a.preventDefault(),B){if(Q.length<2)return void F("Display name must be at least 2 characters");if(S.length<8)return void F("Password must be at least 8 characters");if(S!==U)return void F("Passwords do not match");Z(!0),F(null);try{let a=await fetch(`/api/invitations/${B}/accept-new-user`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({display_name:Q,password:S})}),b=await a.json();if(!a.ok){F(b.error||"Failed to create account"),b.has_account&&(P(!1),_(!0));return}try{let a=await (0,x.signIn)(G.invitation.email,S,"investor");a?.success&&(L(!0),N({message:b.message,is_signatory:b.is_signatory,redirect_url:b.redirect_url}),setTimeout(()=>{window.location.href=b.redirect_url||"/versotech_main/dashboard"},3e3))}catch(a){window.location.href=`/versotech_main/login?message=account_created&redirect=${encodeURIComponent(`/invitation/accept?token=${B}`)}`}}catch(a){F("Failed to create account. Please try again.")}finally{Z(!1)}}},ah=async a=>{if(a.preventDefault(),G){ad(!0),F(null);try{let a=await (0,x.signIn)(G.invitation.email,aa,"investor");a?.success&&(await ae(),_(!1))}catch(a){F(a.message||"Sign in failed. Please check your password.")}finally{ad(!1)}}},ai=G?.email_has_account??!1;if(C)return(0,b.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-background",children:(0,b.jsx)(e.Card,{className:"w-full max-w-md",children:(0,b.jsxs)(e.CardContent,{className:"py-12 text-center",children:[(0,b.jsx)(k.Loader2,{className:"h-8 w-8 animate-spin mx-auto text-primary mb-4"}),(0,b.jsx)("p",{className:"text-muted-foreground",children:"Loading invitation..."})]})})});if(E&&!G)return(0,b.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-background p-4",children:(0,b.jsxs)(e.Card,{className:"w-full max-w-md",children:[(0,b.jsxs)(e.CardHeader,{className:"text-center",children:[(0,b.jsx)("div",{className:"mx-auto w-12 h-12 rounded-full bg-destructive/10 flex items-center justify-center mb-4",children:(0,b.jsx)(m.XCircle,{className:"h-6 w-6 text-destructive"})}),(0,b.jsx)(e.CardTitle,{children:"Invalid Invitation"}),(0,b.jsx)(e.CardDescription,{children:E})]}),(0,b.jsx)(e.CardFooter,{className:"justify-center",children:(0,b.jsx)(w.default,{href:"/versotech_main/login",children:(0,b.jsx)(f.Button,{variant:"outline",children:"Go to Sign In"})})})]})});if(K&&M)return(0,b.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-background p-4",children:(0,b.jsxs)(e.Card,{className:"w-full max-w-md",children:[(0,b.jsxs)(e.CardHeader,{className:"text-center",children:[(0,b.jsx)("div",{className:"mx-auto w-12 h-12 rounded-full bg-green-500/10 flex items-center justify-center mb-4",children:(0,b.jsx)(l.CheckCircle2,{className:"h-6 w-6 text-green-500"})}),(0,b.jsx)(e.CardTitle,{children:"Welcome!"}),(0,b.jsx)(e.CardDescription,{children:M.message})]}),(0,b.jsxs)(e.CardContent,{className:"space-y-4",children:[M.is_signatory&&(0,b.jsxs)(h.Alert,{children:[(0,b.jsx)(q.PenTool,{className:"h-4 w-4"}),(0,b.jsx)(h.AlertDescription,{children:"As an authorized signatory, you'll need to upload your signature specimen to sign documents. You can do this from your profile page."})]}),(0,b.jsx)("p",{className:"text-center text-sm text-muted-foreground",children:"Redirecting you to the portal..."}),(0,b.jsx)("div",{className:"flex justify-center",children:(0,b.jsx)(k.Loader2,{className:"h-5 w-5 animate-spin text-muted-foreground"})})]})]})});if(!G)return null;let{invitation:aj,user_logged_in:ak,email_match:al,user_email:am}=G;return(0,b.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-background p-4",children:(0,b.jsxs)(e.Card,{className:"w-full max-w-md",children:[(0,b.jsxs)(e.CardHeader,{className:"text-center",children:[(0,b.jsx)("div",{className:"mx-auto w-12 h-12 rounded-full bg-primary/10 flex items-center justify-center mb-4",children:(0,b.jsx)(r.UserPlus,{className:"h-6 w-6 text-primary"})}),(0,b.jsx)(e.CardTitle,{children:"You're Invited!"}),(0,b.jsxs)(e.CardDescription,{children:[aj.invited_by_name," has invited you to join"]})]}),(0,b.jsxs)(e.CardContent,{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"rounded-lg border p-4 space-y-3",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("div",{className:"w-10 h-10 rounded-lg bg-muted flex items-center justify-center",children:(0,b.jsx)(o.Building2,{className:"h-5 w-5 text-muted-foreground"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"font-medium",children:aj.entity_name}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:y[aj.entity_type]||aj.entity_type})]})]}),(0,b.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,b.jsx)(g.Badge,{variant:"outline",className:"capitalize",children:aj.role}),aj.is_signatory&&(0,b.jsxs)(g.Badge,{variant:"secondary",className:"flex items-center gap-1",children:[(0,b.jsx)(q.PenTool,{className:"h-3 w-3"}),"Signatory"]})]})]}),(0,b.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 text-muted-foreground",children:[(0,b.jsx)(p.Mail,{className:"h-4 w-4"}),(0,b.jsxs)("span",{children:["Sent to: ",aj.email]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2 text-muted-foreground",children:[(0,b.jsx)(n.Clock,{className:"h-4 w-4"}),(0,b.jsx)("span",{children:(a=new Date(aj.expires_at),z=new Date,(A=Math.ceil((a.getTime()-z.getTime())/864e5))<=0?"Expired":1===A?"Expires tomorrow":`Expires in ${A} days`)})]})]}),aj.is_signatory&&(0,b.jsxs)(h.Alert,{children:[(0,b.jsx)(q.PenTool,{className:"h-4 w-4"}),(0,b.jsx)(h.AlertDescription,{children:"You're being invited as an authorized signatory. After joining, you'll need to upload your signature specimen to sign documents."})]}),ak&&!al&&(0,b.jsxs)(h.Alert,{variant:"destructive",children:[(0,b.jsx)(t.AlertCircle,{className:"h-4 w-4"}),(0,b.jsxs)(h.AlertDescription,{children:["You're signed in as ",am,", but this invitation was sent to ",aj.email,". You can still accept it with your current account."]})]}),E&&(0,b.jsxs)(h.Alert,{variant:"destructive",children:[(0,b.jsx)(m.XCircle,{className:"h-4 w-4"}),(0,b.jsx)(h.AlertDescription,{children:E})]}),!ak&&O&&(0,b.jsxs)("form",{onSubmit:ag,className:"space-y-4 pt-2 border-t",children:[(0,b.jsxs)("div",{className:"text-center mb-4",children:[(0,b.jsx)("h3",{className:"font-semibold",children:"Create Your Account"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Set up your account to accept this invitation"})]}),(0,b.jsxs)("div",{className:"space-y-1.5",children:[(0,b.jsx)(j.Label,{htmlFor:"displayName",children:"Your Name"}),(0,b.jsx)(i.Input,{id:"displayName",type:"text",placeholder:"John Smith",value:Q,onChange:a=>R(a.target.value),required:!0,minLength:2})]}),(0,b.jsxs)("div",{className:"space-y-1.5",children:[(0,b.jsx)(j.Label,{htmlFor:"password",children:"Password"}),(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)(i.Input,{id:"password",type:W?"text":"password",placeholder:"••••••••",value:S,onChange:a=>T(a.target.value),required:!0,minLength:8,className:"pr-10"}),(0,b.jsx)("button",{type:"button",onClick:()=>X(!W),className:"absolute right-3 top-2.5 text-muted-foreground hover:text-foreground",children:W?(0,b.jsx)(v.EyeOff,{className:"h-5 w-5"}):(0,b.jsx)(u.Eye,{className:"h-5 w-5"})})]}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"Must be at least 8 characters"})]}),(0,b.jsxs)("div",{className:"space-y-1.5",children:[(0,b.jsx)(j.Label,{htmlFor:"confirmPassword",children:"Confirm Password"}),(0,b.jsx)(i.Input,{id:"confirmPassword",type:W?"text":"password",placeholder:"••••••••",value:U,onChange:a=>V(a.target.value),required:!0,minLength:8})]}),(0,b.jsx)(f.Button,{type:"submit",className:"w-full",disabled:Y,children:Y?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(k.Loader2,{className:"h-4 w-4 mr-2 animate-spin"}),"Creating Account..."]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(l.CheckCircle2,{className:"h-4 w-4 mr-2"}),"Create Account & Accept"]})}),(0,b.jsx)(f.Button,{type:"button",variant:"ghost",className:"w-full",onClick:()=>P(!1),children:"Back"})]}),!ak&&$&&(0,b.jsxs)("form",{onSubmit:ah,className:"space-y-4 pt-2 border-t",children:[(0,b.jsxs)("div",{className:"text-center mb-4",children:[(0,b.jsx)("h3",{className:"font-semibold",children:"Sign In"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Enter your password to continue"})]}),(0,b.jsxs)("div",{className:"space-y-1.5",children:[(0,b.jsx)(j.Label,{children:"Email"}),(0,b.jsx)(i.Input,{type:"email",value:aj.email,disabled:!0,className:"bg-muted"})]}),(0,b.jsxs)("div",{className:"space-y-1.5",children:[(0,b.jsx)(j.Label,{htmlFor:"signInPassword",children:"Password"}),(0,b.jsx)(i.Input,{id:"signInPassword",type:"password",placeholder:"••••••••",value:aa,onChange:a=>ab(a.target.value),required:!0})]}),(0,b.jsx)(f.Button,{type:"submit",className:"w-full",disabled:ac,children:ac?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(k.Loader2,{className:"h-4 w-4 mr-2 animate-spin"}),"Signing In..."]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(s,{className:"h-4 w-4 mr-2"}),"Sign In"]})}),(0,b.jsx)("div",{className:"text-center",children:(0,b.jsx)(w.default,{href:"/versotech_main/reset-password",className:"text-sm text-muted-foreground hover:text-foreground",children:"Forgot password?"})}),(0,b.jsx)(f.Button,{type:"button",variant:"ghost",className:"w-full",onClick:()=>_(!1),children:"Back"})]})]}),!O&&!$&&(0,b.jsx)(e.CardFooter,{className:"flex flex-col gap-3",children:ak?(0,b.jsx)(f.Button,{className:"w-full",size:"lg",onClick:af,disabled:I,children:I?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(k.Loader2,{className:"h-4 w-4 mr-2 animate-spin"}),"Accepting..."]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(l.CheckCircle2,{className:"h-4 w-4 mr-2"}),"Accept Invitation"]})}):ai?(0,b.jsxs)(f.Button,{className:"w-full",size:"lg",onClick:()=>_(!0),children:[(0,b.jsx)(s,{className:"h-4 w-4 mr-2"}),"Sign In to Accept"]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)(f.Button,{className:"w-full",size:"lg",onClick:()=>{aj.suggested_name&&R(aj.suggested_name),P(!0)},children:[(0,b.jsx)(r.UserPlus,{className:"h-4 w-4 mr-2"}),"Create Account to Accept"]}),(0,b.jsxs)("p",{className:"text-xs text-center text-muted-foreground",children:["Already have an account?"," ",(0,b.jsx)("button",{onClick:()=>_(!0),className:"text-primary hover:underline",children:"Sign in instead"})]})]})})]})})}function A(){return(0,b.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-background",children:(0,b.jsx)(e.Card,{className:"w-full max-w-md",children:(0,b.jsxs)(e.CardContent,{className:"py-12 text-center",children:[(0,b.jsx)(k.Loader2,{className:"h-8 w-8 animate-spin mx-auto text-primary mb-4"}),(0,b.jsx)("p",{className:"text-muted-foreground",children:"Loading invitation..."})]})})})}function B(){return(0,b.jsx)(c.Suspense,{fallback:(0,b.jsx)(A,{}),children:(0,b.jsx)(z,{})})}a.s(["default",()=>B],985674)}];

//# sourceMappingURL=versotech-portal_src_app_invitation_accept_page_tsx_65a47ff8._.js.map