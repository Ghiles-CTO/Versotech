module.exports=[328339,a=>{"use strict";var b=a.i(352584),c=a.i(611038),d=a.i(284169),e=a.i(15788),f=a.i(421908),g=a.i(663475),h=a.i(951870),i=a.i(771088),j=a.i(871057),k=a.i(816854),l=a.i(42329),m=a.i(399580),n=a.i(487068),o=a.i(3321),p=a.i(877918),q=a.i(618287),r=a.i(278541),s=a.i(504839),t=a.i(577955),u=a.i(672606),v=a.i(888987),w=a.i(201986),x=a.i(58834),y=a.i(497412);let z={open:"bg-green-100 text-green-800 border-green-200 dark:bg-green-900/30 dark:text-green-300 dark:border-green-800",draft:"bg-gray-100 text-gray-800 border-gray-200 dark:bg-gray-800 dark:text-gray-300 dark:border-gray-700",closed:"bg-blue-100 text-blue-800 border-blue-200 dark:bg-blue-900/30 dark:text-blue-300 dark:border-blue-800",cancelled:"bg-red-100 text-red-800 border-red-200 dark:bg-red-900/30 dark:text-red-300 dark:border-red-800",allocation_pending:"bg-yellow-100 text-yellow-800 border-yellow-200 dark:bg-yellow-900/30 dark:text-yellow-300 dark:border-yellow-800",fully_subscribed:"bg-purple-100 text-purple-800 border-purple-200 dark:bg-purple-900/30 dark:text-purple-300 dark:border-purple-800"},A=[{label:"All Status",value:"all"},{label:"Open",value:"open"},{label:"Draft",value:"draft"},{label:"Closed",value:"closed"},{label:"Fully Subscribed",value:"fully_subscribed"}];function B(){let[a,B]=(0,c.useState)(null),[C,D]=(0,c.useState)([]),[E,F]=(0,c.useState)({totalAssigned:0,activeDeals:0,closedDeals:0,pendingReview:0}),[G,H]=(0,c.useState)(!0),[I,J]=(0,c.useState)(null),[K,L]=(0,c.useState)(""),[M,N]=(0,c.useState)("all"),[O,P]=(0,c.useState)(1);(0,c.useEffect)(()=>{async function a(a){let{data:b,error:c}=await a.from("deals").select(`
          id,
          name,
          company_name,
          company_logo_url,
          deal_type,
          status,
          currency,
          target_amount,
          close_at,
          created_at
        `).order("created_at",{ascending:!1}).limit(50);if(c)throw c;let d=(b||[]).map(a=>({id:a.id,name:a.name||"Untitled Deal",company_name:a.company_name,company_logo_url:a.company_logo_url,deal_type:a.deal_type||"unknown",status:a.status||"draft",currency:a.currency||"USD",target_amount:Number(a.target_amount)||0,close_at:a.close_at,created_at:a.created_at}));D(d);let e=d.filter(a=>"open"===a.status||"allocation_pending"===a.status).length,f=d.filter(a=>"closed"===a.status||"fully_subscribed"===a.status).length;F({totalAssigned:d.length,activeDeals:e,closedDeals:f,pendingReview:0})}!async function(){try{H(!0);let b=(0,x.createClient)(),{data:{user:c}}=await b.auth.getUser();if(!c)return void J("Not authenticated");let{data:d,error:e}=await b.from("lawyer_users").select("lawyer_id").eq("user_id",c.id).single();if(e||!d)return void await a(b);let{data:f,error:g}=await b.from("lawyers").select("id, firm_name, display_name, specializations, is_active").eq("id",d.lawyer_id).single();if(g)throw g;B(f);let{data:h,error:i}=await b.from("vehicles").select("id, name").eq("lawyer_id",d.lawyer_id);i&&console.error("Error fetching lawyer vehicles:",i);let j=(h||[]).map(a=>a.id),k=[];if(j.length>0){let{data:a,error:c}=await b.from("deals").select(`
              id,
              name,
              company_name,
              company_logo_url,
              deal_type,
              status,
              currency,
              target_amount,
              close_at,
              created_at,
              vehicle_id
            `).in("vehicle_id",j).order("created_at",{ascending:!1});c&&console.error("Error fetching deals:",c),k=(a||[]).map(a=>({id:a.id,name:a.name||"Untitled Deal",company_name:a.company_name,company_logo_url:a.company_logo_url,deal_type:a.deal_type||"unknown",status:a.status||"draft",currency:a.currency||"USD",target_amount:Number(a.target_amount)||0,close_at:a.close_at,created_at:a.created_at}))}else{let{data:a}=await b.from("lawyers").select("assigned_deals").eq("id",d.lawyer_id).single();if(a?.assigned_deals&&a.assigned_deals.length>0){let{data:c}=await b.from("deals").select(`
                id, name, company_name, company_logo_url, deal_type,
                status, currency, target_amount, close_at, created_at
              `).in("id",a.assigned_deals).order("created_at",{ascending:!1});k=(c||[]).map(a=>({id:a.id,name:a.name||"Untitled Deal",company_name:a.company_name,company_logo_url:a.company_logo_url,deal_type:a.deal_type||"unknown",status:a.status||"draft",currency:a.currency||"USD",target_amount:Number(a.target_amount)||0,close_at:a.close_at,created_at:a.created_at}))}}D(k);let l=k.filter(a=>"open"===a.status||"allocation_pending"===a.status).length,m=k.filter(a=>"closed"===a.status||"fully_subscribed"===a.status).length;F({totalAssigned:k.length,activeDeals:l,closedDeals:m,pendingReview:0}),J(null)}catch(a){console.error("[AssignedDealsPage] Error:",a),J(a instanceof Error?a.message:"Failed to load assigned deals")}finally{H(!1)}}()},[]);let Q=C.filter(a=>{let b="all"===M||a.status===M,c=!K||a.name?.toLowerCase().includes(K.toLowerCase())||a.company_name?.toLowerCase().includes(K.toLowerCase());return b&&c}),R=Math.ceil(Q.length/10),S=(O-1)*10,T=Q.slice(S,S+10);return((0,c.useEffect)(()=>{P(1)},[K,M]),G)?(0,b.jsxs)("div",{className:"flex items-center justify-center py-16",children:[(0,b.jsx)(o.Loader2,{className:"h-8 w-8 animate-spin text-muted-foreground"}),(0,b.jsx)("span",{className:"ml-3 text-muted-foreground",children:"Loading assigned deals..."})]}):I?(0,b.jsxs)("div",{className:"text-center py-16",children:[(0,b.jsx)(p.AlertCircle,{className:"h-12 w-12 text-destructive mx-auto mb-4"}),(0,b.jsx)("h3",{className:"text-lg font-medium text-foreground mb-2",children:"Error Loading Deals"}),(0,b.jsx)("p",{className:"text-muted-foreground",children:I})]}):(0,b.jsxs)("div",{className:"p-6 space-y-6",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-2xl font-bold text-foreground",children:"Assigned Deals"}),(0,b.jsx)("p",{className:"text-muted-foreground mt-1",children:a?`Manage deal documentation and escrow as ${a.display_name}`:"View all deals requiring legal review"})]}),a&&a.specializations&&a.specializations.length>0&&(0,b.jsx)("div",{className:"flex gap-1",children:a.specializations.slice(0,2).map((a,c)=>(0,b.jsx)(e.Badge,{variant:"outline",className:"capitalize",children:a},c))})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,b.jsxs)(d.Card,{children:[(0,b.jsx)(d.CardHeader,{className:"pb-2",children:(0,b.jsxs)(d.CardTitle,{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[(0,b.jsx)(j.Briefcase,{className:"h-4 w-4"}),"Total Assigned"]})}),(0,b.jsxs)(d.CardContent,{children:[(0,b.jsx)("div",{className:"text-2xl font-bold",children:E.totalAssigned}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Deals requiring attention"})]})]}),(0,b.jsxs)(d.Card,{children:[(0,b.jsx)(d.CardHeader,{className:"pb-2",children:(0,b.jsxs)(d.CardTitle,{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[(0,b.jsx)(s.Scale,{className:"h-4 w-4"}),"Active Deals"]})}),(0,b.jsxs)(d.CardContent,{children:[(0,b.jsx)("div",{className:"text-2xl font-bold text-green-600",children:E.activeDeals}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Currently in progress"})]})]}),(0,b.jsxs)(d.Card,{children:[(0,b.jsx)(d.CardHeader,{className:"pb-2",children:(0,b.jsxs)(d.CardTitle,{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[(0,b.jsx)(m.CheckCircle2,{className:"h-4 w-4"}),"Completed"]})}),(0,b.jsxs)(d.CardContent,{children:[(0,b.jsx)("div",{className:"text-2xl font-bold text-blue-600",children:E.closedDeals}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Successfully closed"})]})]}),(0,b.jsxs)(d.Card,{children:[(0,b.jsx)(d.CardHeader,{className:"pb-2",children:(0,b.jsxs)(d.CardTitle,{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[(0,b.jsx)(l.Clock,{className:"h-4 w-4"}),"Pending Review"]})}),(0,b.jsxs)(d.CardContent,{children:[(0,b.jsx)("div",{className:"text-2xl font-bold text-orange-500",children:E.pendingReview}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Awaiting your review"})]})]})]}),(0,b.jsx)(d.Card,{children:(0,b.jsx)(d.CardContent,{className:"pt-6",children:(0,b.jsxs)("div",{className:"flex flex-col md:flex-row gap-4",children:[(0,b.jsx)("div",{className:"flex-1",children:(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)(n.Search,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),(0,b.jsx)(g.Input,{placeholder:"Search by deal name or company...",value:K,onChange:a=>L(a.target.value),className:"pl-10"})]})}),(0,b.jsxs)(h.Select,{value:M,onValueChange:N,children:[(0,b.jsx)(h.SelectTrigger,{className:"w-full md:w-48",children:(0,b.jsx)(h.SelectValue,{placeholder:"Filter by status"})}),(0,b.jsx)(h.SelectContent,{children:A.map(a=>(0,b.jsx)(h.SelectItem,{value:a.value,children:a.label},a.value))})]})]})})}),(0,b.jsxs)(d.Card,{children:[(0,b.jsxs)(d.CardHeader,{children:[(0,b.jsx)(d.CardTitle,{children:"Deals"}),(0,b.jsxs)(d.CardDescription,{children:[Q.length," deal",1!==Q.length?"s":""," found"]})]}),(0,b.jsx)(d.CardContent,{children:0===Q.length?(0,b.jsxs)("div",{className:"border border-dashed border-muted rounded-lg py-12 flex flex-col items-center justify-center text-center space-y-2",children:[(0,b.jsx)(k.FileText,{className:"h-10 w-10 text-muted-foreground"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:K||"all"!==M?"No deals match your filters":a?"No deals assigned to you yet":"No deals requiring legal review"}),a&&0===C.length&&(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"You will be notified when deals are assigned for your review"})]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("div",{className:"rounded-md border",children:(0,b.jsxs)(i.Table,{children:[(0,b.jsx)(i.TableHeader,{children:(0,b.jsxs)(i.TableRow,{children:[(0,b.jsx)(i.TableHead,{children:"Deal"}),(0,b.jsx)(i.TableHead,{children:"Type"}),(0,b.jsx)(i.TableHead,{children:"Status"}),(0,b.jsx)(i.TableHead,{children:"Value"}),(0,b.jsx)(i.TableHead,{children:"Close Date"}),(0,b.jsx)(i.TableHead,{className:"text-right",children:"Actions"})]})}),(0,b.jsx)(i.TableBody,{children:T.map(a=>(0,b.jsxs)(i.TableRow,{children:[(0,b.jsx)(i.TableCell,{children:(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[a.company_logo_url?(0,b.jsx)("img",{src:a.company_logo_url,alt:a.company_name||"",className:"h-10 w-10 rounded-lg object-cover"}):(0,b.jsx)("div",{className:"h-10 w-10 rounded-lg bg-muted flex items-center justify-center",children:(0,b.jsx)(r.Building2,{className:"h-5 w-5 text-muted-foreground"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"font-medium",children:a.name}),a.company_name&&(0,b.jsx)("div",{className:"text-xs text-muted-foreground",children:a.company_name})]})]})}),(0,b.jsx)(i.TableCell,{children:(0,b.jsx)(e.Badge,{variant:"secondary",className:"capitalize",children:a.deal_type.replace("_"," ")})}),(0,b.jsx)(i.TableCell,{children:(0,b.jsx)(e.Badge,{variant:"outline",className:(0,v.cn)("capitalize",z[a.status]||z.draft),children:a.status.replace("_"," ")})}),(0,b.jsx)(i.TableCell,{children:(0,b.jsx)("div",{className:"font-medium",children:(0,w.formatCurrency)(a.target_amount,a.currency)})}),(0,b.jsx)(i.TableCell,{children:a.close_at?(0,b.jsx)("div",{className:"text-sm",children:(0,w.formatDate)(a.close_at)}):(0,b.jsx)("span",{className:"text-muted-foreground text-xs",children:"Not set"})}),(0,b.jsx)(i.TableCell,{className:"text-right",children:(0,b.jsx)(f.Button,{variant:"ghost",size:"sm",asChild:!0,children:(0,b.jsx)(y.default,{href:`/versotech_main/lawyer-deal/${a.id}`,children:(0,b.jsx)(q.ExternalLink,{className:"h-4 w-4"})})})})]},a.id))})]})}),R>1&&(0,b.jsxs)("div",{className:"flex items-center justify-between pt-4 border-t",children:[(0,b.jsxs)("div",{className:"text-sm text-muted-foreground",children:["Showing ",S+1,"-",Math.min(S+10,Q.length)," of ",Q.length," deals"]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsxs)(f.Button,{variant:"outline",size:"sm",onClick:()=>P(a=>Math.max(1,a-1)),disabled:1===O,children:[(0,b.jsx)(t.ChevronLeft,{className:"h-4 w-4"}),"Previous"]}),(0,b.jsxs)("div",{className:"flex items-center gap-1 text-sm",children:[(0,b.jsx)("span",{children:"Page"}),(0,b.jsx)("span",{className:"font-medium",children:O}),(0,b.jsx)("span",{children:"of"}),(0,b.jsx)("span",{className:"font-medium",children:R})]}),(0,b.jsxs)(f.Button,{variant:"outline",size:"sm",onClick:()=>P(a=>Math.min(R,a+1)),disabled:O===R,children:["Next",(0,b.jsx)(u.ChevronRight,{className:"h-4 w-4"})]})]})]})]})})]})]})}a.s(["default",()=>B])}];

//# sourceMappingURL=versotech-portal_src_app_%28main%29_versotech_main_assigned-deals_page_tsx_4b4f0499._.js.map