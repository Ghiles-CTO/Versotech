{"version":3,"sources":["../../../../../versotech-portal/src/app/%28staff%29/versotech/staff/reconciliation/%5Bid%5D/transaction-detail-client.tsx/__nextjs-internal-proxy.mjs","../../../../../versotech-portal/src/app/%28staff%29/versotech/staff/reconciliation/%5Bid%5D/page.tsx"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport const TransactionDetailClient = registerClientReference(\n    function() { throw new Error(\"Attempted to call TransactionDetailClient() from the server but TransactionDetailClient is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/versotech-portal/src/app/(staff)/versotech/staff/reconciliation/[id]/transaction-detail-client.tsx\",\n    \"TransactionDetailClient\",\n);\n","import { redirect, notFound } from 'next/navigation'\nimport { requireStaffAuth } from '@/lib/auth'\nimport { createClient } from '@/lib/supabase/server'\nimport { TransactionDetailClient } from './transaction-detail-client'\n\nexport const dynamic = 'force-dynamic'\n\ninterface PageProps {\n  params: Promise<{ id: string }>\n}\n\nexport default async function TransactionDetailPage({ params }: PageProps) {\n  const profile = await requireStaffAuth()\n  if (!profile) {\n    redirect('/versotech/login')\n  }\n\n  const { id } = await params\n  const supabase = await createClient()\n\n  // Fetch transaction with all related data\n  const { data: transaction, error } = await supabase\n    .from('bank_transactions')\n    .select(`\n      id,\n      account_ref,\n      amount,\n      currency,\n      value_date,\n      memo,\n      counterparty,\n      bank_reference,\n      status,\n      match_confidence,\n      match_notes,\n      matched_invoice_ids,\n      import_batch_id,\n      created_at,\n      updated_at,\n      matches:reconciliation_matches!reconciliation_matches_bank_transaction_id_fkey (\n        id,\n        invoice_id,\n        match_type,\n        matched_amount,\n        match_confidence,\n        match_reason,\n        status,\n        approved_at,\n        approved_by,\n        invoices (\n          id,\n          invoice_number,\n          total,\n          paid_amount,\n          balance_due,\n          status,\n          match_status,\n          currency,\n          investor:investor_id (\n            id,\n            legal_name\n          ),\n          deal:deal_id (\n            id,\n            name\n          )\n        )\n      ),\n      suggestions:suggested_matches!suggested_matches_bank_transaction_id_fkey (\n        id,\n        invoice_id,\n        confidence,\n        match_reason,\n        amount_difference,\n        created_at,\n        invoices (\n          id,\n          invoice_number,\n          total,\n          paid_amount,\n          balance_due,\n          status,\n          match_status,\n          currency,\n          investor:investor_id (\n            id,\n            legal_name\n          ),\n          deal:deal_id (\n            id,\n            name\n          )\n        )\n      )\n    `)\n    .eq('id', id)\n    .single()\n\n  if (error || !transaction) {\n    notFound()\n  }\n\n  // Fetch open invoices for manual matching (same currency as transaction)\n  const transactionCurrency = transaction.currency || 'USD'\n  const { data: openInvoices } = await supabase\n    .from('invoices')\n    .select(`\n      id,\n      invoice_number,\n      total,\n      paid_amount,\n      balance_due,\n      status,\n      match_status,\n      currency,\n      due_date,\n      investor:investor_id (\n        id,\n        legal_name\n      ),\n      deal:deal_id (\n        id,\n        name\n      )\n    `)\n    .in('status', ['sent', 'partially_paid', 'overdue'])\n    .eq('currency', transactionCurrency)\n    .gt('balance_due', 0)\n    .order('due_date', { ascending: true })\n\n  return (\n    <div className=\"p-6\">\n      <TransactionDetailClient\n        transaction={transaction}\n        openInvoices={openInvoices || []}\n        staffProfile={profile}\n      />\n    </div>\n  )\n}\n"],"names":[],"mappings":"6aAEO,IAAM,EAA0B,CAAA,EAAA,AADvC,EAAA,CAAA,CAAA,QACuC,uBAAA,AAAuB,EAC1D,WAAa,MAAM,AAAI,MAAM,4PAA8P,EAC3R,mIACA,2FAHG,IAAM,EAA0B,CAAA,EAAA,AADvC,EAAA,CAAA,CAAA,QACuC,uBAAA,AAAuB,EAC1D,WAAa,MAAM,AAAI,MAAM,4PAA8P,EAC3R,+GACA,mICLJ,EAAA,CAAA,CAAA,QAAA,IAAA,EAAA,EAAA,CAAA,CAAA,QACA,EAAA,EAAA,CAAA,CAAA,QACA,EAAA,EAAA,CAAA,CAAA,QACA,EAAA,EAAA,CAAA,CAAA,QAQe,eAAe,EAAsB,QAAE,CAAM,CAAa,EACvE,IAAM,EAAU,MAAM,CAAA,EAAA,EAAA,gBAAA,AAAgB,GAClC,CAAC,GACH,CAAA,EAAA,EAAA,CADY,OACZ,AAAQ,EAAC,oBAGX,GAAM,IAAE,CAAE,CAAE,CAAG,MAAM,EACf,EAAW,MAAM,CAAA,EAAA,EAAA,YAAA,AAAY,IAG7B,CAAE,KAAM,CAAW,CAAE,OAAK,CAAE,CAAG,MAAM,EACxC,IAAI,CAAC,qBACL,MAAM,CAAC,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;IAuET,CAAC,EACA,EAAE,CAAC,KAAM,GACT,MAAM,GAEL,IAAS,CAAC,CAAA,GAAa,AACzB,CAAA,EAAA,EAAA,QAAA,AAAQ,IAIV,IAAM,EAAsB,EAAY,QAAQ,EAAI,MAC9C,CAAE,KAAM,CAAY,CAAE,CAAG,MAAM,EAClC,IAAI,CAAC,YACL,MAAM,CAAC,CAAC;;;;;;;;;;;;;;;;;;IAkBT,CAAC,EACA,EAAE,CAAC,SAAU,CAAC,OAAQ,iBAAkB,UAAU,EAClD,EAAE,CAAC,WAAY,GACf,EAAE,CAAC,cAAe,GAClB,KAAK,CAAC,WAAY,CAAE,WAAW,CAAK,GAEvC,MACE,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,eACb,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,uBAAuB,CAAA,CACtB,YAAa,EACb,aAAc,GAAgB,EAAE,CAChC,aAAc,KAItB,kCAtIuB","ignoreList":[0]}