module.exports=[243085,a=>{"use strict";a.i(483696);var b=a.i(263360),c=a.i(621599);a.i(937413);var d=a.i(131360);let e=["staff_admin","staff_ops","staff_rm","ceo"],f=async()=>{let a=await (0,c.cookies)();return(0,b.createServerClient)("https://ipguxdssecfexudnvtia.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlwZ3V4ZHNzZWNmZXh1ZG52dGlhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTgzNjE4MzcsImV4cCI6MjA3MzkzNzgzN30.AGxM_YW9hfxuu7xDpi_4xhOoRhYM7iGTS1vJ0z2FByE",{cookies:{getAll:()=>a.getAll(),setAll(b){try{b.forEach(({name:b,value:c,options:d})=>a.set(b,c,d))}catch{}}}})};async function g(){try{let a=await f(),{data:{user:b},error:c}=await a.auth.getUser();if(c||!b)return null;let{data:d,error:g}=await a.from("profiles").select("*").eq("id",b.id).single();if(g||!d)return console.error("[auth] Profile not found for user:",b.id,g),null;let h=[];if(e.includes(d.role)){let{data:c}=await a.from("staff_permissions").select("permission").eq("user_id",b.id);h=c?.map(a=>a.permission)||[]}return{id:d.id,email:d.email,displayName:d.display_name||d.email?.split("@")[0]||"User",avatar:d.avatar_url,role:d.role,title:d.title,created_at:d.created_at,permissions:h}}catch(a){return console.error("Error getting current user:",a),null}}async function h(){let a=await g();return a?console.log("[auth] Profile retrieved:",a.email,a.role):console.log("[auth] No profile found"),a}async function i(a){let b=await g();if(b||(0,d.redirect)("/versotech_main/login"),a&&!a.includes(b.role))throw Error("Insufficient permissions");return b}async function j(){let a=await g();if(a||(0,d.redirect)("/versotech_main/login"),"investor"!==a.role)throw Error("Investor access required");return a}async function k(){let a=await g();if(a||(0,d.redirect)("/versotech_main/login"),!e.includes(a.role))throw Error("Staff access required");return a}async function l(a){let b=await f(),{data:c,error:d}=await b.from("profiles").select("role").eq("id",a).single();if(!d&&c&&e.includes(c.role))return!0;let{data:g}=await b.rpc("get_user_personas",{p_user_id:a});return g?.some(a=>"staff"===a.persona_type||"ceo"===a.persona_type)||!1}a.s(["checkStaffAccess",()=>l,"getCurrentUser",()=>g,"getProfile",()=>h,"requireAuth",()=>i,"requireInvestorAuth",()=>j,"requireStaffAuth",()=>k])},636373,a=>{"use strict";a.s(["PersonaProvider",()=>c,"getNavItemsForPersona",()=>d,"usePersona",()=>e]);var b=a.i(578644);let c=(0,b.registerClientReference)(function(){throw Error("Attempted to call PersonaProvider() from the server but PersonaProvider is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/versotech-portal/src/contexts/persona-context.tsx <module evaluation>","PersonaProvider"),d=(0,b.registerClientReference)(function(){throw Error("Attempted to call getNavItemsForPersona() from the server but getNavItemsForPersona is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/versotech-portal/src/contexts/persona-context.tsx <module evaluation>","getNavItemsForPersona"),e=(0,b.registerClientReference)(function(){throw Error("Attempted to call usePersona() from the server but usePersona is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/versotech-portal/src/contexts/persona-context.tsx <module evaluation>","usePersona")},685298,a=>{"use strict";a.s(["PersonaProvider",()=>c,"getNavItemsForPersona",()=>d,"usePersona",()=>e]);var b=a.i(578644);let c=(0,b.registerClientReference)(function(){throw Error("Attempted to call PersonaProvider() from the server but PersonaProvider is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/versotech-portal/src/contexts/persona-context.tsx","PersonaProvider"),d=(0,b.registerClientReference)(function(){throw Error("Attempted to call getNavItemsForPersona() from the server but getNavItemsForPersona is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/versotech-portal/src/contexts/persona-context.tsx","getNavItemsForPersona"),e=(0,b.registerClientReference)(function(){throw Error("Attempted to call usePersona() from the server but usePersona is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/versotech-portal/src/contexts/persona-context.tsx","usePersona")},604168,a=>{"use strict";a.i(636373);var b=a.i(685298);a.n(b)},778149,a=>{"use strict";a.s(["AdminLayoutContent",()=>b]);let b=(0,a.i(578644).registerClientReference)(function(){throw Error("Attempted to call AdminLayoutContent() from the server but AdminLayoutContent is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/versotech-portal/src/app/(admin)/versotech_admin/components/admin-layout-content.tsx <module evaluation>","AdminLayoutContent")},120348,a=>{"use strict";a.s(["AdminLayoutContent",()=>b]);let b=(0,a.i(578644).registerClientReference)(function(){throw Error("Attempted to call AdminLayoutContent() from the server but AdminLayoutContent is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/versotech-portal/src/app/(admin)/versotech_admin/components/admin-layout-content.tsx","AdminLayoutContent")},681030,a=>{"use strict";a.i(778149);var b=a.i(120348);a.n(b)},423043,a=>{"use strict";var b=a.i(714898),c=a.i(243085);a.i(937413);var d=a.i(131360),e=a.i(198307),f=a.i(604168),g=a.i(681030);async function h({children:a}){let h=await (0,c.getProfile)();h||(0,d.redirect)("/versotech_main/login");let i=await (0,e.createClient)(),{data:j,error:k}=await i.rpc("get_user_personas",{p_user_id:h.id});k&&console.error("[AdminPortalLayout] Error fetching personas:",k);let l=j||[];return l.some(a=>"ceo"===a.persona_type||"staff"===a.persona_type&&("ceo"===a.role_in_entity||"staff_admin"===a.role_in_entity))||(console.warn("[AdminPortalLayout] Non-CEO user attempted to access admin:",h.email),(0,d.redirect)("/versotech_main/dashboard")),(0,b.jsx)(f.PersonaProvider,{initialPersonas:l,children:(0,b.jsx)(g.AdminLayoutContent,{profile:h,children:a})})}a.s(["default",()=>h,"dynamic",0,"force-dynamic"])},361481,a=>{a.v(a=>Promise.resolve().then(()=>a(389018)))}];

//# sourceMappingURL=versotech-portal_a36289ea._.js.map