module.exports=[695124,a=>{"use strict";var b=a.i(352584),c=a.i(611038),d=a.i(284169),e=a.i(15788),f=a.i(663475),g=a.i(951870),h=a.i(771088),i=a.i(421908),j=a.i(816854),k=a.i(42329),l=a.i(399580),m=a.i(487068),n=a.i(3321),o=a.i(877918),p=a.i(203297),q=a.i(724070),r=a.i(318525),s=a.i(438436),t=a.i(838086),u=a.i(278541),v=a.i(752907),w=a.i(95799);let x=(0,w.default)("thumbs-up",[["path",{d:"M7 10v12",key:"1qc93n"}],["path",{d:"M15 5.88 14 10h5.83a2 2 0 0 1 1.92 2.56l-2.33 8A2 2 0 0 1 17.5 22H4a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h2.76a2 2 0 0 0 1.79-1.11L12 2a3.13 3.13 0 0 1 3 3.88Z",key:"emmmcr"}]]),y=(0,w.default)("thumbs-down",[["path",{d:"M17 14V2",key:"8ymqnk"}],["path",{d:"M9 18.12 10 14H4.17a2 2 0 0 1-1.92-2.56l2.33-8A2 2 0 0 1 6.5 2H20a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2h-2.76a2 2 0 0 0-1.79 1.11L12 22a3.13 3.13 0 0 1-3-3.88Z",key:"m61m77"}]]);var z=a.i(264890),A=a.i(899750),B=a.i(888987),C=a.i(201986),D=a.i(58834),E=a.i(497412);let F={active:"bg-green-100 text-green-800 border-green-200",pending:"bg-yellow-100 text-yellow-800 border-yellow-200",pending_approval:"bg-blue-100 text-blue-800 border-blue-200",pending_cp_signature:"bg-amber-100 text-amber-800 border-amber-200",expired:"bg-red-100 text-red-800 border-red-200",draft:"bg-gray-100 text-gray-800 border-gray-200",terminated:"bg-red-100 text-red-800 border-red-200",approved:"bg-green-100 text-green-800 border-green-200",rejected:"bg-red-100 text-red-800 border-red-200"},G=[{label:"All Status",value:"all"},{label:"Active",value:"active"},{label:"Pending Approval",value:"pending_approval"},{label:"Pending",value:"pending"},{label:"Expired",value:"expired"},{label:"Draft",value:"draft"}],H={placement:"Placement Agreement",distribution:"Distribution Agreement",advisory:"Advisory Agreement",white_label:"White Label Agreement"};function I(){let[a,w]=(0,c.useState)(null),[I,J]=(0,c.useState)([]),[K,L]=(0,c.useState)({totalAgreements:0,activeAgreements:0,pendingAgreements:0,expiringSoon:0}),[M,N]=(0,c.useState)(!0),[O,P]=(0,c.useState)(null),[Q,R]=(0,c.useState)(""),[S,T]=(0,c.useState)("all"),[U,V]=(0,c.useState)(null),W=async a=>{V(a);try{let b=await fetch(`/api/placement-agreements/${a}/approve`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"approve"})});if(!b.ok){let a=await b.json();throw Error(a.error||"Failed to approve agreement")}J(b=>b.map(b=>b.id===a?{...b,status:"approved"}:b)),A.toast.success("Agreement approved successfully")}catch(a){console.error("Error approving agreement:",a),A.toast.error(a instanceof Error?a.message:"Failed to approve agreement")}finally{V(null)}},X=async a=>{V(a);try{let b=await fetch(`/api/placement-agreements/${a}/approve`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"reject"})});if(!b.ok){let a=await b.json();throw Error(a.error||"Failed to reject agreement")}J(b=>b.map(b=>b.id===a?{...b,status:"rejected"}:b)),A.toast.success("Agreement rejected")}catch(a){console.error("Error rejecting agreement:",a),A.toast.error(a instanceof Error?a.message:"Failed to reject agreement")}finally{V(null)}};function Y(a){if(!a)return!1;let b=new Date,c=new Date(a),d=new Date(b.getTime()+2592e6);return c>b&&c<=d}(0,c.useEffect)(()=>{async function a(a){let{data:c,error:d}=await a.from("placement_agreements").select(`
          *,
          commercial_partner:commercial_partner_id (
            id,
            name,
            legal_name,
            status
          )
        `).order("created_at",{ascending:!1}).limit(100);if(d)throw d;b(c||[],{})}function b(a,b){let c=new Date,d=new Date(c.getTime()+2592e6),e=a.map(a=>{let d=b[a.id],e=a.status||"draft";return a.expiry_date&&"active"===e&&new Date(a.expiry_date)<c&&(e="expired"),{id:a.id,agreement_type:a.agreement_type||"placement",signed_date:a.signed_date,effective_date:a.effective_date,expiry_date:a.expiry_date,default_commission_bps:a.default_commission_bps||0,commission_cap_amount:a.commission_cap_amount,payment_terms:a.payment_terms,territory:a.territory,deal_types:a.deal_types,exclusivity_level:a.exclusivity_level,status:e,created_at:a.created_at,signature_token:d?.token||null,signature_status:d?.status||null}});J(e);let f=e.filter(a=>"active"===a.status).length,g=e.filter(a=>"pending"===a.status).length,h=e.filter(a=>{if(!a.expiry_date)return!1;let b=new Date(a.expiry_date);return b>c&&b<=d&&"active"===a.status}).length;L({totalAgreements:e.length,activeAgreements:f,pendingAgreements:g,expiringSoon:h})}!async function(){try{N(!0);let c=(0,D.createClient)(),{data:{user:d}}=await c.auth.getUser();if(!d)return void P("Not authenticated");let{data:e,error:f}=await c.from("commercial_partner_users").select("commercial_partner_id").eq("user_id",d.id).single();if(f||!e)return void await a(c);let{data:g,error:h}=await c.from("commercial_partners").select("id, name, legal_name, type, status, logo_url").eq("id",e.commercial_partner_id).single();if(h)throw h;w(g);let{data:i,error:j}=await c.from("placement_agreements").select("*").eq("commercial_partner_id",e.commercial_partner_id).order("created_at",{ascending:!1});if(j)throw j;let k=(i||[]).map(a=>a.id),l={};if(k.length>0){let{data:a}=await c.from("signature_requests").select("placement_agreement_id, signing_token, status").in("placement_agreement_id",k).eq("signer_role","commercial_partner");for(let b of a||[])b.placement_agreement_id&&(l[b.placement_agreement_id]={token:b.signing_token,status:b.status})}b(i||[],l),P(null)}catch(a){console.error("[PlacementAgreementsPage] Error:",a),P(a instanceof Error?a.message:"Failed to load agreements")}finally{N(!1)}}()},[]);let Z=I.filter(a=>{let b="all"===S||a.status===S,c=!Q||a.agreement_type?.toLowerCase().includes(Q.toLowerCase())||a.territory?.toLowerCase().includes(Q.toLowerCase());return b&&c});return M?(0,b.jsxs)("div",{className:"flex items-center justify-center py-16",children:[(0,b.jsx)(n.Loader2,{className:"h-8 w-8 animate-spin text-muted-foreground"}),(0,b.jsx)("span",{className:"ml-3 text-muted-foreground",children:"Loading agreements..."})]}):O?(0,b.jsxs)("div",{className:"text-center py-16",children:[(0,b.jsx)(o.AlertCircle,{className:"h-12 w-12 text-destructive mx-auto mb-4"}),(0,b.jsx)("h3",{className:"text-lg font-medium text-foreground mb-2",children:"Error Loading Agreements"}),(0,b.jsx)("p",{className:"text-muted-foreground",children:O})]}):(0,b.jsxs)("div",{className:"p-6 space-y-6",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-2xl font-bold text-foreground",children:"Placement Agreements"}),(0,b.jsx)("p",{className:"text-muted-foreground mt-1",children:a?`Manage your placement agreements as ${a.name}`:"View and manage all placement agreements"})]}),a&&(0,b.jsx)("div",{className:"flex items-center gap-2",children:a.logo_url?(0,b.jsx)("img",{src:a.logo_url,alt:a.name,className:"h-10 w-10 rounded-lg object-cover"}):(0,b.jsx)("div",{className:"h-10 w-10 rounded-lg bg-muted flex items-center justify-center",children:(0,b.jsx)(u.Building2,{className:"h-5 w-5 text-muted-foreground"})})})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,b.jsxs)(d.Card,{children:[(0,b.jsx)(d.CardHeader,{className:"pb-2",children:(0,b.jsxs)(d.CardTitle,{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[(0,b.jsx)(j.FileText,{className:"h-4 w-4"}),"Total Agreements"]})}),(0,b.jsxs)(d.CardContent,{children:[(0,b.jsx)("div",{className:"text-2xl font-bold",children:K.totalAgreements}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"All placement arrangements"})]})]}),(0,b.jsxs)(d.Card,{children:[(0,b.jsx)(d.CardHeader,{className:"pb-2",children:(0,b.jsxs)(d.CardTitle,{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[(0,b.jsx)(l.CheckCircle2,{className:"h-4 w-4"}),"Active"]})}),(0,b.jsxs)(d.CardContent,{children:[(0,b.jsx)("div",{className:"text-2xl font-bold text-green-600",children:K.activeAgreements}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Currently in effect"})]})]}),(0,b.jsxs)(d.Card,{children:[(0,b.jsx)(d.CardHeader,{className:"pb-2",children:(0,b.jsxs)(d.CardTitle,{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[(0,b.jsx)(k.Clock,{className:"h-4 w-4"}),"Pending"]})}),(0,b.jsxs)(d.CardContent,{children:[(0,b.jsx)("div",{className:"text-2xl font-bold text-yellow-600",children:K.pendingAgreements}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Awaiting signature"})]})]}),(0,b.jsxs)(d.Card,{children:[(0,b.jsx)(d.CardHeader,{className:"pb-2",children:(0,b.jsxs)(d.CardTitle,{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[(0,b.jsx)(t.AlertTriangle,{className:"h-4 w-4"}),"Expiring Soon"]})}),(0,b.jsxs)(d.CardContent,{children:[(0,b.jsx)("div",{className:"text-2xl font-bold text-orange-500",children:K.expiringSoon}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Within 30 days"})]})]})]}),(0,b.jsx)(d.Card,{children:(0,b.jsx)(d.CardContent,{className:"pt-6",children:(0,b.jsxs)("div",{className:"flex flex-col md:flex-row gap-4",children:[(0,b.jsx)("div",{className:"flex-1",children:(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)(m.Search,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),(0,b.jsx)(f.Input,{placeholder:"Search by type or territory...",value:Q,onChange:a=>R(a.target.value),className:"pl-10"})]})}),(0,b.jsxs)(g.Select,{value:S,onValueChange:T,children:[(0,b.jsx)(g.SelectTrigger,{className:"w-full md:w-48",children:(0,b.jsx)(g.SelectValue,{placeholder:"Filter by status"})}),(0,b.jsx)(g.SelectContent,{children:G.map(a=>(0,b.jsx)(g.SelectItem,{value:a.value,children:a.label},a.value))})]})]})})}),(0,b.jsxs)(d.Card,{children:[(0,b.jsxs)(d.CardHeader,{children:[(0,b.jsx)(d.CardTitle,{children:"Agreements"}),(0,b.jsxs)(d.CardDescription,{children:[Z.length," agreement",1!==Z.length?"s":""," found"]})]}),(0,b.jsx)(d.CardContent,{children:0===Z.length?(0,b.jsxs)("div",{className:"border border-dashed border-muted rounded-lg py-12 flex flex-col items-center justify-center text-center space-y-2",children:[(0,b.jsx)(p.FileSignature,{className:"h-10 w-10 text-muted-foreground"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:Q||"all"!==S?"No agreements match your filters":a?"No placement agreements on file":"No placement agreements found"}),a&&0===I.length&&(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"Contact your account manager to set up a placement agreement"})]}):(0,b.jsx)("div",{className:"rounded-md border",children:(0,b.jsxs)(h.Table,{children:[(0,b.jsx)(h.TableHeader,{children:(0,b.jsxs)(h.TableRow,{children:[(0,b.jsx)(h.TableHead,{children:"Type"}),(0,b.jsx)(h.TableHead,{children:"Commission"}),(0,b.jsx)(h.TableHead,{children:"Territory"}),(0,b.jsx)(h.TableHead,{children:"Effective"}),(0,b.jsx)(h.TableHead,{children:"Expires"}),(0,b.jsx)(h.TableHead,{children:"Status"}),(0,b.jsx)(h.TableHead,{className:"text-right",children:"Actions"})]})}),(0,b.jsx)(h.TableBody,{children:Z.map(a=>{var c;return(0,b.jsxs)(h.TableRow,{children:[(0,b.jsx)(h.TableCell,{children:(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(j.FileText,{className:"h-4 w-4 text-muted-foreground"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"font-medium",children:H[a.agreement_type]||a.agreement_type}),a.exclusivity_level&&(0,b.jsx)("div",{className:"text-xs text-muted-foreground capitalize",children:a.exclusivity_level})]})]})}),(0,b.jsxs)(h.TableCell,{children:[(0,b.jsxs)("div",{className:"flex items-center gap-1",children:[(0,b.jsx)(s.Percent,{className:"h-3 w-3 text-muted-foreground"}),(0,b.jsx)("span",{className:"font-medium",children:(c=a.default_commission_bps,`${(c/100).toFixed(2)}%`)})]}),a.commission_cap_amount&&(0,b.jsxs)("div",{className:"text-xs text-muted-foreground",children:["Cap: $",a.commission_cap_amount.toLocaleString()]})]}),(0,b.jsxs)(h.TableCell,{children:[(0,b.jsxs)("div",{className:"flex items-center gap-1",children:[(0,b.jsx)(r.Globe,{className:"h-3 w-3 text-muted-foreground"}),(0,b.jsx)("span",{children:a.territory||"Global"})]}),a.deal_types&&a.deal_types.length>0&&(0,b.jsxs)("div",{className:"text-xs text-muted-foreground",children:[a.deal_types.slice(0,2).join(", "),a.deal_types.length>2&&` +${a.deal_types.length-2}`]})]}),(0,b.jsx)(h.TableCell,{children:(0,b.jsxs)("div",{className:"flex items-center gap-1",children:[(0,b.jsx)(q.Calendar,{className:"h-3 w-3 text-muted-foreground"}),(0,b.jsx)("span",{className:"text-sm",children:a.effective_date?(0,C.formatDate)(a.effective_date):"Not set"})]})}),(0,b.jsx)(h.TableCell,{children:(0,b.jsxs)("div",{className:(0,B.cn)("flex items-center gap-1",Y(a.expiry_date)&&"text-orange-600"),children:[Y(a.expiry_date)&&(0,b.jsx)(t.AlertTriangle,{className:"h-3 w-3"}),(0,b.jsx)("span",{className:"text-sm",children:a.expiry_date?(0,C.formatDate)(a.expiry_date):"No expiry"})]})}),(0,b.jsx)(h.TableCell,{children:(0,b.jsx)(e.Badge,{variant:"outline",className:(0,B.cn)("capitalize",F[a.status]||F.draft),children:a.status})}),(0,b.jsx)(h.TableCell,{className:"text-right",children:(0,b.jsxs)("div",{className:"flex justify-end gap-2",children:["pending_approval"===a.status&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)(i.Button,{size:"sm",onClick:()=>W(a.id),disabled:U===a.id,className:"bg-green-600 hover:bg-green-700",children:[U===a.id?(0,b.jsx)(n.Loader2,{className:"h-4 w-4 mr-1 animate-spin"}):(0,b.jsx)(x,{className:"h-4 w-4 mr-1"}),"Approve"]}),(0,b.jsxs)(i.Button,{size:"sm",variant:"destructive",onClick:()=>X(a.id),disabled:U===a.id,children:[U===a.id?(0,b.jsx)(n.Loader2,{className:"h-4 w-4 mr-1 animate-spin"}):(0,b.jsx)(y,{className:"h-4 w-4 mr-1"}),"Reject"]})]}),a.signature_token&&"pending"===a.signature_status&&(0,b.jsx)(i.Button,{size:"sm",className:"bg-amber-600 hover:bg-amber-700",asChild:!0,children:(0,b.jsxs)(E.default,{href:`/versotech_main/versosign/sign/${a.signature_token}`,children:[(0,b.jsx)(v.PenTool,{className:"h-4 w-4 mr-1"}),"Sign"]})}),"signed"===a.signature_status&&(0,b.jsxs)(e.Badge,{variant:"outline",className:"bg-green-100 text-green-800",children:[(0,b.jsx)(l.CheckCircle2,{className:"h-3 w-3 mr-1"}),"Signed"]}),(0,b.jsx)(i.Button,{variant:"ghost",size:"sm",asChild:!0,children:(0,b.jsx)(E.default,{href:`/versotech_main/placement-agreements/${a.id}`,children:(0,b.jsx)(z.Eye,{className:"h-4 w-4"})})})]})})]},a.id)})})]})})})]})]})}a.s(["default",()=>I],695124)}];

//# sourceMappingURL=c6ad4_src_app_%28main%29_versotech_main_placement-agreements_page_tsx_93d517d8._.js.map