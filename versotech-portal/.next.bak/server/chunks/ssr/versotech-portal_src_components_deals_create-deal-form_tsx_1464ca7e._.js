module.exports=[216378,a=>{"use strict";var b=a.i(352584),c=a.i(611038),d=a.i(289633),e=a.i(284169),f=a.i(421908),g=a.i(663475),h=a.i(249464),i=a.i(191675),j=a.i(951870),k=a.i(975965),l=a.i(50828),m=a.i(3321),n=a.i(468095),o=a.i(497412),p=a.i(714814);function q({entities:a,arrangerEntities:q=[],basePath:r="/versotech/staff"}){let s=(0,d.useRouter)(),[t,u]=(0,c.useState)(1),[v,w]=(0,c.useState)(!1),[x,y]=(0,c.useState)(null),[z,A]=(0,c.useState)({name:"",company_name:"",deal_type:"equity_secondary",stock_type:"common",vehicle_id:"",arranger_entity_id:"",sector:"",stage:"",location:"",currency:"USD",target_amount:"",open_at:"",close_at:"",description:"",investment_thesis:""}),[B,C]=(0,c.useState)(!1),[D,E]=(0,c.useState)(null),[F,G]=(0,c.useState)(""),[H,I]=(0,c.useState)("none"),J=(0,c.useMemo)(()=>a.find(a=>a.id===z.vehicle_id),[a,z.vehicle_id]),K=J?.logo_url??"";(0,c.useEffect)(()=>{if(!J){"entity"===H&&I(F?"manual":"none");return}K?"manual"!==H&&(F!==K&&G(K),"entity"!==H&&I("entity"),E(null)):"entity"===H&&(G(""),I("none"))},[J,K,H,F]);let L=(a,b)=>{A(c=>({...c,[a]:b}))},M=async()=>{w(!0),y(null);try{let a={name:z.name.trim(),company_name:z.company_name.trim()||null,deal_type:z.deal_type,stock_type:z.stock_type||null,vehicle_id:z.vehicle_id||null,arranger_entity_id:z.arranger_entity_id||null,sector:z.sector.trim()||null,stage:z.stage.trim()||null,location:z.location.trim()||null,currency:z.currency,target_amount:z.target_amount?parseFloat(z.target_amount):null,open_at:z.open_at||null,close_at:z.close_at||null,description:z.description.trim()||null,investment_thesis:z.investment_thesis.trim()||null,company_logo_url:F||void 0};console.log("[CreateDealForm] Submitting payload:",a);let b=await fetch("/api/deals",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!b.ok){console.error("[CreateDealForm] Response not OK:",b.status,b.statusText);let a={};try{a=await b.json(),console.error("[CreateDealForm] Error response:",a)}catch(a){throw console.error("[CreateDealForm] Failed to parse error response:",a),Error(`Server error: ${b.status} ${b.statusText}`)}if(a.details&&Array.isArray(a.details)){let b=a.details.map(a=>`${a.path.join(".")}: ${a.message}`).join(", ");throw Error(`Validation failed: ${b}`)}throw Error(a.error||a.details||`Failed to create deal (${b.status})`)}let{deal:c}=await b.json();s.push(`${r}/deals/${c.id}`)}catch(a){y(a.message),w(!1)}};return(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-3xl font-bold text-foreground",children:"Create New Deal"}),(0,b.jsx)("p",{className:"text-muted-foreground mt-1",children:"Set up a new investment opportunity"})]}),(0,b.jsx)(o.default,{href:`${r}/deals`,children:(0,b.jsxs)(f.Button,{variant:"ghost",className:"gap-2",children:[(0,b.jsx)(k.ArrowLeft,{className:"h-4 w-4"}),"Back to Deals"]})})]}),(0,b.jsx)("div",{className:"flex items-center justify-center gap-4",children:[1,2,3].map(a=>(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("div",{className:`w-10 h-10 rounded-full flex items-center justify-center font-medium transition-colors ${a===t?"bg-emerald-500 text-white":a<t?"bg-emerald-500/50 text-white":"bg-muted text-muted-foreground"}`,children:a}),(0,b.jsx)("span",{className:`text-sm ${a===t?"text-foreground font-medium":"text-muted-foreground"}`,children:1===a?"Basic Info":2===a?"Pipeline":"Timeline & Details"}),a<3&&(0,b.jsx)(l.ArrowRight,{className:"h-4 w-4 text-muted-foreground ml-2"})]},a))}),(0,b.jsxs)(e.Card,{className:"border-border bg-muted/50",children:[(0,b.jsxs)(e.CardHeader,{children:[(0,b.jsx)(e.CardTitle,{className:"text-foreground",children:1===t?"Basic Information":2===t?"Pipeline & Currency":"Timeline & Description"}),(0,b.jsx)(e.CardDescription,{children:1===t?"Enter the core details about this investment opportunity":2===t?"Set the target amount and currency. Investment limits (min/max) are defined in the termsheet.":"Set dates and provide context about the deal"})]}),(0,b.jsxs)(e.CardContent,{className:"space-y-6",children:[1===t&&(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(h.Label,{htmlFor:"name",className:"text-foreground",children:"Deal Name *"}),(0,b.jsx)(g.Input,{id:"name",placeholder:"e.g., Concluder Secondary Q1 2025",value:z.name,onChange:a=>L("name",a.target.value),required:!0})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(h.Label,{htmlFor:"company_name",className:"text-foreground",children:"Company Name"}),(0,b.jsx)(g.Input,{id:"company_name",placeholder:"e.g., Concluder Inc.",value:z.company_name,onChange:a=>L("company_name",a.target.value)})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(h.Label,{htmlFor:"deal_type",className:"text-foreground",children:"Deal Type *"}),(0,b.jsxs)(j.Select,{value:z.deal_type,onValueChange:a=>L("deal_type",a),children:[(0,b.jsx)(j.SelectTrigger,{children:(0,b.jsx)(j.SelectValue,{})}),(0,b.jsxs)(j.SelectContent,{children:[(0,b.jsx)(j.SelectItem,{value:"equity_secondary",children:"Secondary Equity"}),(0,b.jsx)(j.SelectItem,{value:"equity_primary",children:"Primary Equity"}),(0,b.jsx)(j.SelectItem,{value:"credit_trade_finance",children:"Credit & Trade Finance"}),(0,b.jsx)(j.SelectItem,{value:"other",children:"Other"})]})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(h.Label,{htmlFor:"stock_type",className:"text-foreground",children:"Stock Type *"}),(0,b.jsxs)(j.Select,{value:z.stock_type,onValueChange:a=>L("stock_type",a),children:[(0,b.jsx)(j.SelectTrigger,{children:(0,b.jsx)(j.SelectValue,{})}),(0,b.jsxs)(j.SelectContent,{children:[(0,b.jsx)(j.SelectItem,{value:"common",children:"Common/Ordinary Shares"}),(0,b.jsx)(j.SelectItem,{value:"preferred",children:"Preferred Shares"}),(0,b.jsx)(j.SelectItem,{value:"convertible",children:"Convertible Notes"}),(0,b.jsx)(j.SelectItem,{value:"warrant",children:"Warrants"}),(0,b.jsx)(j.SelectItem,{value:"bond",children:"Bonds"}),(0,b.jsx)(j.SelectItem,{value:"note",children:"Notes"}),(0,b.jsx)(j.SelectItem,{value:"other",children:"Other"})]})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("div",{className:"flex items-center justify-between",children:(0,b.jsx)(h.Label,{htmlFor:"vehicle_id",className:"text-foreground",children:"Entity (Optional)"})}),(0,b.jsxs)(j.Select,{value:z.vehicle_id||"none",onValueChange:b=>{let c="none"===b?"":b;if(L("vehicle_id",c),c){let b=a.find(a=>a.id===c);b?.arranger_entity_id&&!z.arranger_entity_id&&L("arranger_entity_id",b.arranger_entity_id)}},children:[(0,b.jsx)(j.SelectTrigger,{children:(0,b.jsx)(j.SelectValue,{placeholder:"Select entity or skip"})}),(0,b.jsxs)(j.SelectContent,{children:[(0,b.jsx)(j.SelectItem,{value:"none",children:"No entity - Direct deal"}),a.map(a=>(0,b.jsxs)(j.SelectItem,{value:a.id,children:[a.name," (",a.type,")"]},a.id))]})]}),(0,b.jsxs)("p",{className:"text-xs text-muted-foreground",children:['Choose an entity for pooled investments, or "No entity" for direct ownership deals. Manage entities from'," ",(0,b.jsx)(o.default,{href:`${r}/entities`,className:"text-emerald-300 hover:text-emerald-200 underline",children:"Entities"})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(h.Label,{htmlFor:"arranger_entity_id",className:"text-foreground",children:"Arranger (Optional)"}),(0,b.jsxs)(j.Select,{value:z.arranger_entity_id||"none",onValueChange:a=>L("arranger_entity_id","none"===a?"":a),children:[(0,b.jsx)(j.SelectTrigger,{children:(0,b.jsx)(j.SelectValue,{placeholder:"Select arranger or skip"})}),(0,b.jsxs)(j.SelectContent,{children:[(0,b.jsx)(j.SelectItem,{value:"none",children:"No Arranger"}),q.map(a=>(0,b.jsx)(j.SelectItem,{value:a.id,children:a.company_name||a.legal_name},a.id))]})]}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"Assign an arranger to manage this deal (mandate)"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(h.Label,{htmlFor:"sector",className:"text-foreground",children:"Sector"}),(0,b.jsx)(g.Input,{id:"sector",placeholder:"e.g., SaaS, FinTech",value:z.sector,onChange:a=>L("sector",a.target.value)})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(h.Label,{htmlFor:"stage",className:"text-foreground",children:"Stage"}),(0,b.jsx)(g.Input,{id:"stage",placeholder:"e.g., Series B, Growth",value:z.stage,onChange:a=>L("stage",a.target.value)})]}),(0,b.jsxs)("div",{className:"space-y-2 md:col-span-2",children:[(0,b.jsx)(h.Label,{htmlFor:"location",className:"text-foreground",children:"Location"}),(0,b.jsx)(g.Input,{id:"location",placeholder:"e.g., San Francisco, USA",value:z.location,onChange:a=>L("location",a.target.value)})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(h.Label,{className:"text-foreground",children:"Company Logo"}),(0,b.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,b.jsxs)("div",{className:"flex items-center gap-4",children:[F?(0,b.jsx)(p.default,{src:F,alt:`${(J?.name??z.name)||"Deal"} logo`,width:56,height:56,className:"rounded-lg object-contain bg-white border border-gray-200 p-2"}):(0,b.jsx)("div",{className:"h-14 w-14 rounded-lg bg-muted border border-border flex items-center justify-center text-muted-foreground",children:"56×56"}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)("label",{className:"inline-flex items-center gap-2 px-3 py-2 border rounded-md cursor-pointer text-sm",onClick:()=>{"entity"===H&&(I("manual"),G(""))},children:[(0,b.jsx)(n.Upload,{className:"h-4 w-4"}),(0,b.jsx)("span",{children:"entity"===H?"Replace Logo":"Upload Logo"}),(0,b.jsx)("input",{type:"file",accept:"image/*",className:"hidden",onChange:async a=>{let b=a.target.files?.[0];if(b){E(null),C(!0);try{let a=new FormData;a.append("file",b),a.append("deal_id","new");let c=await fetch("/api/deals/logo-upload",{method:"POST",body:a}),d=await c.json().catch(()=>({}));if(!c.ok||!d?.url)throw Error(d?.error||"Failed to upload logo");G(d.url),I("manual")}catch(a){E(a instanceof Error?a.message:"Failed to upload logo")}finally{C(!1),a.target.value=""}}}})]}),J?.logo_url&&"manual"===H&&(0,b.jsxs)(f.Button,{type:"button",variant:"ghost",size:"sm",className:"px-0 text-xs text-emerald-300 hover:text-emerald-200",onClick:()=>{G(J.logo_url??""),I("entity"),E(null)},children:["Use ",J.name," logo"]}),B&&(0,b.jsx)("span",{className:"text-xs text-muted-foreground",children:"Uploading…"})]})]}),D&&(0,b.jsx)("p",{className:"text-xs text-rose-500",children:D}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"entity"===H&&J?.name?`Prefilled from ${J.name}. Replace if you need a different logo.`:"Optional branding shown to investors."})]})]})]}),2===t&&(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(h.Label,{htmlFor:"currency",className:"text-foreground",children:"Currency *"}),(0,b.jsxs)(j.Select,{value:z.currency,onValueChange:a=>L("currency",a),children:[(0,b.jsx)(j.SelectTrigger,{children:(0,b.jsx)(j.SelectValue,{})}),(0,b.jsxs)(j.SelectContent,{children:[(0,b.jsx)(j.SelectItem,{value:"USD",children:"USD"}),(0,b.jsx)(j.SelectItem,{value:"EUR",children:"EUR"}),(0,b.jsx)(j.SelectItem,{value:"GBP",children:"GBP"})]})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(h.Label,{htmlFor:"target_amount",className:"text-foreground",children:"Target Amount"}),(0,b.jsx)(g.Input,{id:"target_amount",type:"number",step:"1",placeholder:"5000000",value:z.target_amount,onChange:a=>L("target_amount",a.target.value)}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"Total amount you aim to raise for this deal"})]})]}),(0,b.jsx)("div",{className:"p-4 rounded-lg bg-amber-500/10 border border-amber-500/20",children:(0,b.jsxs)("p",{className:"text-sm text-amber-700 dark:text-amber-200",children:[(0,b.jsx)("strong",{children:"Note:"})," Investment terms (price per share, minimum/maximum investment) are set in the Term Sheet after creating this deal. The termsheet is the source of truth for investor-facing financial details."]})})]}),3===t&&(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(h.Label,{htmlFor:"open_at",className:"text-foreground",children:"Open Date"}),(0,b.jsx)(g.Input,{id:"open_at",type:"datetime-local",value:z.open_at,onChange:a=>L("open_at",a.target.value)})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(h.Label,{htmlFor:"close_at",className:"text-foreground",children:"Close Date"}),(0,b.jsx)(g.Input,{id:"close_at",type:"datetime-local",value:z.close_at,onChange:a=>L("close_at",a.target.value)})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(h.Label,{htmlFor:"description",className:"text-foreground",children:"Description"}),(0,b.jsx)(i.Textarea,{id:"description",placeholder:"Provide a brief overview of this investment opportunity...",rows:4,value:z.description,onChange:a=>L("description",a.target.value)})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(h.Label,{htmlFor:"investment_thesis",className:"text-foreground",children:"Investment Thesis"}),(0,b.jsx)(i.Textarea,{id:"investment_thesis",placeholder:"Explain why this is an attractive investment...",rows:6,value:z.investment_thesis,onChange:a=>L("investment_thesis",a.target.value)})]})]}),x&&(0,b.jsx)("div",{className:"p-4 rounded-lg bg-red-500/20 border border-red-400/30 text-red-700 dark:text-red-200",children:x}),(0,b.jsxs)("div",{className:"flex items-center justify-between pt-4 border-t border-border",children:[(0,b.jsxs)(f.Button,{variant:"outline",onClick:()=>u(a=>Math.max(1,a-1)),disabled:1===t||v,children:[(0,b.jsx)(k.ArrowLeft,{className:"h-4 w-4 mr-2"}),"Previous"]}),t<3?(0,b.jsxs)(f.Button,{onClick:()=>u(a=>Math.min(3,a+1)),disabled:!z.name,children:["Next",(0,b.jsx)(l.ArrowRight,{className:"h-4 w-4 ml-2"})]}):(0,b.jsx)(f.Button,{onClick:M,disabled:v||!z.name,children:v?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(m.Loader2,{className:"h-4 w-4 mr-2 animate-spin"}),"Creating..."]}):"Create Deal"})]})]})]})]})}a.s(["CreateDealForm",()=>q])}];

//# sourceMappingURL=versotech-portal_src_components_deals_create-deal-form_tsx_1464ca7e._.js.map