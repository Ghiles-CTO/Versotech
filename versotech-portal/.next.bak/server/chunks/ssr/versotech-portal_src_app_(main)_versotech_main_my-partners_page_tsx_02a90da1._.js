module.exports=[434314,a=>{"use strict";var b=a.i(352584),c=a.i(611038),d=a.i(284169),e=a.i(15788),f=a.i(421908),g=a.i(663475),h=a.i(951870),i=a.i(771088),j=a.i(478870),k=a.i(278541),l=a.i(399580),m=a.i(487068),n=a.i(3321),o=a.i(877918),p=a.i(318525),q=a.i(439467),r=a.i(13289),s=a.i(816854),t=a.i(155508),u=a.i(672606),v=a.i(966494),w=a.i(888987),x=a.i(201986),y=a.i(58834),z=a.i(497412),A=a.i(140561),B=a.i(181608),C=a.i(877028),D=a.i(231276),E=a.i(618287);a.i(187814);var F=a.i(351424),G=a.i(470305),H=a.i(249464),I=a.i(191675),J=a.i(290913);let K=[{value:"invested_amount",label:"Invested Amount"},{value:"spread",label:"Spread"},{value:"management_fee",label:"Management Fee"},{value:"performance_fee",label:"Performance Fee"}];function L({open:a,onOpenChange:d,partnerId:e,partnerName:i,deals:j,feePlans:k,onSuccess:l}){let[m,o]=(0,c.useState)(!1),[p,q]=(0,c.useState)(null),[r,s]=(0,c.useState)(""),[t,u]=(0,c.useState)(""),[v,w]=(0,c.useState)("invested_amount"),[y,z]=(0,c.useState)(""),[A,B]=(0,c.useState)(""),[C,D]=(0,c.useState)(""),[E,F]=(0,c.useState)("USD"),[L,M]=(0,c.useState)(""),[N,O]=(0,c.useState)("");(0,c.useEffect)(()=>{a&&(s(""),u(""),w("invested_amount"),z(""),B(""),D(""),F("USD"),M(""),O(""),q(null))},[a]),(0,c.useEffect)(()=>{if(y&&A){let a=parseFloat(y)/1e4,b=parseFloat(A);isNaN(a)||isNaN(b)||D((b*a).toFixed(2))}},[y,A]),(0,c.useEffect)(()=>{if(r){let a=j.find(a=>a.id===r);a?.currency&&F(a.currency)}},[r,j]),(0,c.useEffect)(()=>{if(t){let a=k.find(a=>a.id===t);if(a?.components&&a.components.length>0){let b=a.components.find(a=>a.rate_bps);b?.rate_bps&&z(b.rate_bps.toString())}}},[t,k]);let P=async()=>{if(!y||0>=parseFloat(y))return void q("Rate is required and must be greater than 0");if(!C||0>=parseFloat(C))return void q("Commission amount is required and must be greater than 0");o(!0),q(null);try{let a={partner_id:e,deal_id:r||void 0,fee_plan_id:t||void 0,basis_type:v,rate_bps:parseInt(y,10),base_amount:A?parseFloat(A):void 0,accrual_amount:parseFloat(C),currency:E,payment_due_date:L||void 0,notes:N||void 0},b=await fetch("/api/arrangers/me/partner-commissions",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!b.ok){let a=await b.json();throw Error(a.error||"Failed to record commission")}l(),d(!1)}catch(a){console.error("[RecordCommissionDialog] Error:",a),q(a instanceof Error?a.message:"Failed to record commission")}finally{o(!1)}},Q=y?(parseFloat(y)/100).toFixed(2):"0.00";return(0,b.jsx)(G.Dialog,{open:a,onOpenChange:d,children:(0,b.jsxs)(G.DialogContent,{className:"max-w-lg",children:[(0,b.jsxs)(G.DialogHeader,{children:[(0,b.jsx)(G.DialogTitle,{children:"Record Commission"}),(0,b.jsxs)(G.DialogDescription,{children:["Record a commission owed to ",i]})]}),(0,b.jsxs)("div",{className:"space-y-4 py-4",children:[p&&(0,b.jsx)("div",{className:"bg-destructive/10 border border-destructive/30 text-destructive text-sm p-3 rounded",children:p}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(H.Label,{children:"Deal (Optional)"}),(0,b.jsxs)(h.Select,{value:r,onValueChange:s,children:[(0,b.jsx)(h.SelectTrigger,{children:(0,b.jsx)(h.SelectValue,{placeholder:"Select deal..."})}),(0,b.jsxs)(h.SelectContent,{children:[(0,b.jsx)(h.SelectItem,{value:"",children:"No specific deal"}),j.map(a=>(0,b.jsxs)(h.SelectItem,{value:a.id,children:[a.name," ",a.company_name&&`(${a.company_name})`]},a.id))]})]})]}),k.length>0&&(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(H.Label,{children:"Fee Plan (Optional)"}),(0,b.jsxs)(h.Select,{value:t,onValueChange:u,children:[(0,b.jsx)(h.SelectTrigger,{children:(0,b.jsx)(h.SelectValue,{placeholder:"Select fee plan..."})}),(0,b.jsxs)(h.SelectContent,{children:[(0,b.jsx)(h.SelectItem,{value:"",children:"No fee plan"}),k.map(a=>(0,b.jsx)(h.SelectItem,{value:a.id,children:a.name},a.id))]})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(H.Label,{children:"Commission Basis"}),(0,b.jsxs)(h.Select,{value:v,onValueChange:w,children:[(0,b.jsx)(h.SelectTrigger,{children:(0,b.jsx)(h.SelectValue,{})}),(0,b.jsx)(h.SelectContent,{children:K.map(a=>(0,b.jsx)(h.SelectItem,{value:a.value,children:a.label},a.value))})]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(H.Label,{children:"Rate (basis points) *"}),(0,b.jsx)(g.Input,{type:"number",value:y,onChange:a=>z(a.target.value),placeholder:"e.g., 100 = 1%"}),y&&(0,b.jsxs)("p",{className:"text-xs text-muted-foreground",children:["= ",Q,"%"]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)(H.Label,{children:["Base Amount (",E,")"]}),(0,b.jsx)(g.Input,{type:"number",value:A,onChange:a=>B(a.target.value),placeholder:"e.g., 100000"})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)(H.Label,{className:"flex items-center gap-2",children:["Commission Amount (",E,") *",y&&A&&(0,b.jsxs)("span",{className:"text-xs text-muted-foreground flex items-center gap-1",children:[(0,b.jsx)(J.Calculator,{className:"h-3 w-3"}),"Auto-calculated"]})]}),(0,b.jsx)(g.Input,{type:"number",value:C,onChange:a=>D(a.target.value),placeholder:"Commission amount"}),C&&(0,b.jsx)("p",{className:"text-sm font-medium text-primary",children:(0,x.formatCurrency)(parseFloat(C),E)})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(H.Label,{children:"Payment Due Date (Optional)"}),(0,b.jsx)(g.Input,{type:"date",value:L,onChange:a=>M(a.target.value)})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(H.Label,{children:"Notes (Optional)"}),(0,b.jsx)(I.Textarea,{value:N,onChange:a=>O(a.target.value),placeholder:"Any additional notes...",rows:2})]})]}),(0,b.jsxs)(G.DialogFooter,{children:[(0,b.jsx)(f.Button,{variant:"outline",onClick:()=>d(!1),disabled:m,children:"Cancel"}),(0,b.jsx)(f.Button,{onClick:P,disabled:m,children:m?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(n.Loader2,{className:"h-4 w-4 mr-2 animate-spin"}),"Recording..."]}):"Record Commission"})]})]})})}var M=a.i(405708);let N={active:"bg-green-100 text-green-800 border-green-200",pending:"bg-yellow-100 text-yellow-800 border-yellow-200",inactive:"bg-gray-100 text-gray-800 border-gray-200",suspended:"bg-red-100 text-red-800 border-red-200"},O={approved:"bg-green-100 text-green-800",pending:"bg-yellow-100 text-yellow-800",expired:"bg-red-100 text-red-800",not_started:"bg-gray-100 text-gray-800"};function P({partnerId:a,open:g,onOpenChange:h}){let[i,l]=(0,c.useState)(null),[m,r]=(0,c.useState)(!1),[t,u]=(0,c.useState)(null),[y,G]=(0,c.useState)(!1),H=async()=>{if(a){r(!0),u(null);try{let b=await fetch(`/api/arrangers/me/partners/${a}`);if(!b.ok){let a=await b.json();throw Error(a.error||"Failed to load partner details")}let c=await b.json();l(c.data)}catch(a){console.error("[PartnerDetailDrawer] Error:",a),u(a instanceof Error?a.message:"Failed to load partner details")}finally{r(!1)}}};return(0,c.useEffect)(()=>{if(!g||!a){l(null),u(null);return}H()},[g,a]),(0,b.jsx)(A.Sheet,{open:g,onOpenChange:h,children:(0,b.jsxs)(A.SheetContent,{className:"w-full sm:max-w-xl overflow-y-auto",children:[m&&(0,b.jsxs)("div",{className:"flex items-center justify-center py-16",children:[(0,b.jsx)(n.Loader2,{className:"h-8 w-8 animate-spin text-muted-foreground"}),(0,b.jsx)("span",{className:"ml-3 text-muted-foreground",children:"Loading partner details..."})]}),t&&(0,b.jsxs)("div",{className:"flex flex-col items-center justify-center py-16 text-center",children:[(0,b.jsx)(o.AlertCircle,{className:"h-12 w-12 text-destructive mb-4"}),(0,b.jsx)("p",{className:"text-muted-foreground",children:t}),(0,b.jsx)(f.Button,{variant:"outline",className:"mt-4",onClick:()=>h(!1),children:"Close"})]}),i&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)(A.SheetHeader,{className:"pb-4",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[i.partner.logo_url?(0,b.jsx)("img",{src:i.partner.logo_url,alt:i.partner.name,className:"h-12 w-12 rounded-lg object-cover"}):(0,b.jsx)("div",{className:"h-12 w-12 rounded-lg bg-muted flex items-center justify-center",children:(0,b.jsx)(k.Building2,{className:"h-6 w-6 text-muted-foreground"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)(A.SheetTitle,{children:i.partner.name}),(0,b.jsxs)(A.SheetDescription,{children:[i.partner.partner_type&&(0,b.jsx)("span",{className:"capitalize",children:i.partner.partner_type.replace("_"," ")}),i.partner.country&&` • ${i.partner.country}`]})]})]}),(0,b.jsxs)("div",{className:"flex gap-2 mt-3",children:[(0,b.jsx)(e.Badge,{variant:"outline",className:(0,w.cn)("capitalize",N[i.partner.status]||N.active),children:i.partner.status}),i.partner.kyc_status&&(0,b.jsxs)(e.Badge,{variant:"secondary",className:(0,w.cn)("text-xs",O[i.partner.kyc_status]||""),children:["KYC: ",i.partner.kyc_status.replace("_"," ")]})]})]}),(0,b.jsx)(C.Separator,{className:"my-4"}),(0,b.jsxs)("div",{className:"grid grid-cols-3 gap-3 mb-6",children:[(0,b.jsxs)(d.Card,{className:"p-3",children:[(0,b.jsx)("div",{className:"text-2xl font-bold text-primary",children:i.stats.total_deals}),(0,b.jsx)("div",{className:"text-xs text-muted-foreground",children:"Deals"})]}),(0,b.jsxs)(d.Card,{className:"p-3",children:[(0,b.jsx)("div",{className:"text-2xl font-bold text-blue-600",children:i.stats.total_referrals}),(0,b.jsx)("div",{className:"text-xs text-muted-foreground",children:"Referrals"})]}),(0,b.jsxs)(d.Card,{className:"p-3",children:[(0,b.jsx)("div",{className:"text-2xl font-bold text-purple-600",children:i.stats.active_fee_plans}),(0,b.jsx)("div",{className:"text-xs text-muted-foreground",children:"Fee Plans"})]})]}),(0,b.jsxs)(B.Tabs,{defaultValue:"overview",className:"w-full",children:[(0,b.jsxs)(B.TabsList,{className:"grid w-full grid-cols-4",children:[(0,b.jsx)(B.TabsTrigger,{value:"overview",children:"Overview"}),(0,b.jsx)(B.TabsTrigger,{value:"fees",children:"Fee Plans"}),(0,b.jsx)(B.TabsTrigger,{value:"commissions",children:"Commissions"}),(0,b.jsx)(B.TabsTrigger,{value:"activity",children:"Activity"})]}),(0,b.jsxs)(B.TabsContent,{value:"overview",className:"mt-4 space-y-4",children:[(0,b.jsxs)(d.Card,{children:[(0,b.jsx)(d.CardHeader,{className:"pb-2",children:(0,b.jsx)(d.CardTitle,{className:"text-sm",children:"Contact Information"})}),(0,b.jsxs)(d.CardContent,{className:"space-y-2 text-sm",children:[i.partner.contact_name&&(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(j.Users,{className:"h-4 w-4 text-muted-foreground"}),(0,b.jsx)("span",{children:i.partner.contact_name})]}),i.partner.contact_email&&(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(q.Mail,{className:"h-4 w-4 text-muted-foreground"}),(0,b.jsx)("a",{href:`mailto:${i.partner.contact_email}`,className:"text-primary hover:underline",children:i.partner.contact_email})]}),i.partner.contact_phone&&(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(D.Phone,{className:"h-4 w-4 text-muted-foreground"}),(0,b.jsx)("span",{children:i.partner.contact_phone})]}),i.partner.country&&(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(p.Globe,{className:"h-4 w-4 text-muted-foreground"}),(0,b.jsx)("span",{children:i.partner.country})]})]})]}),i.deals.length>0&&(0,b.jsxs)(d.Card,{children:[(0,b.jsx)(d.CardHeader,{className:"pb-2",children:(0,b.jsx)(d.CardTitle,{className:"text-sm",children:"Deals Involved"})}),(0,b.jsx)(d.CardContent,{children:(0,b.jsx)("div",{className:"space-y-2",children:i.deals.map(a=>(0,b.jsxs)("div",{className:"flex items-center justify-between p-2 rounded-md bg-muted/50",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"font-medium text-sm",children:a.name}),a.company_name&&(0,b.jsx)("div",{className:"text-xs text-muted-foreground",children:a.company_name})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(e.Badge,{variant:"outline",className:"text-xs capitalize",children:a.status}),(0,b.jsx)(z.default,{href:`/versotech_main/opportunities/${a.id}`,children:(0,b.jsx)(f.Button,{variant:"ghost",size:"sm",children:(0,b.jsx)(E.ExternalLink,{className:"h-3.5 w-3.5"})})})]})]},a.id))})})]})]}),(0,b.jsx)(B.TabsContent,{value:"fees",className:"mt-4 space-y-4",children:0===i.fee_plans.length?(0,b.jsx)(d.Card,{children:(0,b.jsxs)(d.CardContent,{className:"py-8 text-center",children:[(0,b.jsx)(s.FileText,{className:"h-10 w-10 text-muted-foreground mx-auto mb-3"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"No fee plans assigned to this partner"}),(0,b.jsx)(z.default,{href:"/versotech_main/fee-plans",children:(0,b.jsx)(f.Button,{variant:"outline",size:"sm",className:"mt-3",children:"Create Fee Plan"})})]})}):i.fee_plans.map(a=>(0,b.jsxs)(d.Card,{children:[(0,b.jsxs)(d.CardHeader,{className:"pb-2",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)(d.CardTitle,{className:"text-sm",children:a.name}),(0,b.jsx)(e.Badge,{variant:a.is_active?"default":"secondary",children:a.is_active?"Active":"Inactive"})]}),a.description&&(0,b.jsx)(d.CardDescription,{className:"text-xs",children:a.description})]}),(0,b.jsxs)(d.CardContent,{children:[a.components&&a.components.length>0?(0,b.jsx)("div",{className:"flex flex-wrap gap-2",children:a.components.map((a,c)=>(0,b.jsxs)(e.Badge,{variant:"outline",className:"text-xs",children:[a.kind,": ",a.rate_bps?`${(a.rate_bps/100).toFixed(2)}%`:a.flat_amount?`$${a.flat_amount}`:"N/A"]},c))}):(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"No fee components defined"}),a.effective_from&&(0,b.jsxs)("p",{className:"text-xs text-muted-foreground mt-2",children:["Effective from ",(0,x.formatDate)(a.effective_from),a.effective_until&&` to ${(0,x.formatDate)(a.effective_until)}`]})]})]},a.id))}),(0,b.jsxs)(B.TabsContent,{value:"commissions",className:"mt-4 space-y-4",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("h3",{className:"text-sm font-medium",children:"Commission Summary"}),(0,b.jsxs)(f.Button,{size:"sm",onClick:()=>G(!0),children:[(0,b.jsx)(M.Plus,{className:"h-4 w-4 mr-1"}),"Record Commission"]})]}),(0,b.jsx)(F.PartnerCommissionSummary,{summary:i.commission_summary}),(0,b.jsx)("div",{className:"flex justify-end",children:(0,b.jsx)(z.default,{href:"/versotech_main/lawyer-reconciliation",children:(0,b.jsxs)(f.Button,{variant:"outline",size:"sm",children:[(0,b.jsx)(v.TrendingUp,{className:"h-4 w-4 mr-2"}),"View Reconciliation"]})})})]}),(0,b.jsx)(B.TabsContent,{value:"activity",className:"mt-4 space-y-4",children:0===i.recent_referrals.length?(0,b.jsx)(d.Card,{children:(0,b.jsxs)(d.CardContent,{className:"py-8 text-center",children:[(0,b.jsx)(s.FileText,{className:"h-10 w-10 text-muted-foreground mx-auto mb-3"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"No activity yet"})]})}):(0,b.jsxs)(d.Card,{children:[(0,b.jsxs)(d.CardHeader,{className:"pb-2",children:[(0,b.jsx)(d.CardTitle,{className:"text-sm",children:"Recent Activity"}),(0,b.jsx)(d.CardDescription,{className:"text-xs",children:"Fee plan assignments to deals"})]}),(0,b.jsx)(d.CardContent,{children:(0,b.jsx)("div",{className:"space-y-3",children:i.recent_referrals.map(a=>(0,b.jsx)("div",{className:"flex items-center justify-between p-2 rounded-md bg-muted/50",children:(0,b.jsxs)("div",{children:[(0,b.jsxs)("div",{className:"font-medium text-sm",children:["Assigned to ",a.deal?.name||"Unknown Deal"]}),(0,b.jsxs)("div",{className:"text-xs text-muted-foreground",children:[a.deal?.company_name&&`${a.deal.company_name} • `,a.created_at&&(0,x.formatDate)(a.created_at)]})]})},a.id))})})]})})]}),(0,b.jsx)(L,{open:y,onOpenChange:G,partnerId:i.partner.id,partnerName:i.partner.name,deals:i.deals,feePlans:i.fee_plans,onSuccess:H})]})]})})}let Q={active:"bg-green-100 text-green-800 border-green-200",pending:"bg-yellow-100 text-yellow-800 border-yellow-200",inactive:"bg-gray-100 text-gray-800 border-gray-200",suspended:"bg-red-100 text-red-800 border-red-200"},R={approved:"bg-green-100 text-green-800",pending:"bg-yellow-100 text-yellow-800",expired:"bg-red-100 text-red-800",not_started:"bg-gray-100 text-gray-800"},S=[{label:"All Status",value:"all"},{label:"Active",value:"active"},{label:"Pending",value:"pending"},{label:"Inactive",value:"inactive"}];function T(){let[a,A]=(0,c.useState)(null),[B,C]=(0,c.useState)(null),[D,E]=(0,c.useState)([]),[G,H]=(0,c.useState)([]),[I,J]=(0,c.useState)({totalPartners:0,activePartners:0,totalReferrals:0,totalReferralValue:0,totalOwed:0,totalPaid:0}),[K,L]=(0,c.useState)(!0),[M,N]=(0,c.useState)(null),[O,T]=(0,c.useState)(""),[U,V]=(0,c.useState)("all"),[W,X]=(0,c.useState)("all"),[Y,Z]=(0,c.useState)(null),[$,_]=(0,c.useState)(!1);(0,c.useEffect)(()=>{async function a(a){let{data:b,error:c}=await a.from("partners").select("*").order("name").limit(100);if(c)throw c;let d={accrued:0,invoice_requested:0,invoiced:0,paid:0,cancelled:0,total_owed:0,currency:"USD"},e=(b||[]).map(a=>({id:a.id,name:a.name||a.legal_name||"Unknown Partner",legal_name:a.legal_name,partner_type:a.partner_type,status:a.status||"active",contact_name:a.contact_name,contact_email:a.contact_email,contact_phone:a.contact_phone,country:a.country,logo_url:a.logo_url,kyc_status:a.kyc_status,deals_count:0,referrals_count:0,total_referral_value:0,last_activity:null,fee_plans:[],commission_summary:d}));E(e),J({totalPartners:e.length,activePartners:e.filter(a=>"active"===a.status).length,totalReferrals:0,totalReferralValue:0,totalOwed:0,totalPaid:0})}!async function(){try{L(!0);let b=(0,y.createClient)(),{data:{user:c}}=await b.auth.getUser();if(!c)return void N("Not authenticated");let{data:d,error:e}=await b.from("arranger_users").select("arranger_id").eq("user_id",c.id).single();if(e||!d)return void await a(b);C(d.arranger_id);let{data:f,error:g}=await b.from("arranger_entities").select("id, legal_name, status").eq("id",d.arranger_id).single();if(g)throw g;A(f);let{data:h,error:i}=await b.from("deals").select("id, name, company_name").eq("arranger_entity_id",d.arranger_id).order("name");if(i)throw i;if(H(h||[]),!h||0===h.length){E([]),J({totalPartners:0,activePartners:0,totalReferrals:0,totalReferralValue:0,totalOwed:0,totalPaid:0});return}let j=h.map(a=>a.id),{data:k,error:l}=await b.from("fee_plans").select(`
            id,
            name,
            is_active,
            partner_id,
            deal_id,
            created_at,
            deal:deals(id, name, currency, created_at)
          `).in("deal_id",j).not("partner_id","is",null);if(l)throw l;let m=[...new Set((k||[]).map(a=>a.partner_id).filter(Boolean))];if(0===m.length){E([]),J({totalPartners:0,activePartners:0,totalReferrals:0,totalReferralValue:0,totalOwed:0,totalPaid:0});return}let{data:n,error:o}=await b.from("partners").select("*").in("id",m).order("name");if(o)throw o;let p=new Map,q=new Map;(k||[]).forEach(a=>{if(!a.partner_id)return;let b=p.get(a.partner_id)||[];b.push({id:a.id,name:a.name,is_active:a.is_active}),p.set(a.partner_id,b);let c=q.get(a.partner_id)||new Set;a.deal_id&&c.add(a.deal_id),q.set(a.partner_id,c)});let{data:r}=await b.from("partner_commissions").select("partner_id, status, accrual_amount, currency").in("partner_id",m).eq("arranger_id",d.arranger_id),s=new Map;m.forEach(a=>{s.set(a,{accrued:0,invoice_requested:0,invoice_submitted:0,invoiced:0,paid:0,cancelled:0,total_owed:0,currency:"USD"})}),(r||[]).forEach(a=>{let b=s.get(a.partner_id);if(!b)return;let c=Number(a.accrual_amount)||0;"accrued"===a.status?b.accrued+=c:"invoice_requested"===a.status?b.invoice_requested+=c:"invoice_submitted"===a.status?b.invoice_submitted=(b.invoice_submitted||0)+c:"invoiced"===a.status?b.invoiced+=c:"paid"===a.status?b.paid+=c:"cancelled"===a.status&&(b.cancelled+=c),["accrued","invoice_requested","invoice_submitted","invoiced"].includes(a.status)&&(b.total_owed+=c),a.currency&&(b.currency=a.currency)});let t=(n||[]).map(a=>{let b=p.get(a.id)||[],c=q.get(a.id)||new Set;return{id:a.id,name:a.name||a.legal_name||"Unknown Partner",legal_name:a.legal_name,partner_type:a.partner_type,status:a.status||"active",contact_name:a.contact_name,contact_email:a.contact_email,contact_phone:a.contact_phone,country:a.country,logo_url:a.logo_url,kyc_status:a.kyc_status,deals_count:c.size,referrals_count:0,total_referral_value:0,last_activity:null,fee_plans:b,commission_summary:s.get(a.id)||{accrued:0,invoice_requested:0,invoice_submitted:0,invoiced:0,paid:0,cancelled:0,total_owed:0,currency:"USD"}}});E(t);let u=t.filter(a=>"active"===a.status).length,v=t.reduce((a,b)=>a+b.referrals_count,0),w=t.reduce((a,b)=>a+b.total_referral_value,0),x=t.reduce((a,b)=>a+b.commission_summary.total_owed,0),z=t.reduce((a,b)=>a+b.commission_summary.paid,0);J({totalPartners:t.length,activePartners:u,totalReferrals:v,totalReferralValue:w,totalOwed:x,totalPaid:z}),N(null)}catch(a){console.error("[MyPartnersPage] Error:",a),N(a instanceof Error?a.message:"Failed to load partners")}finally{L(!1)}}()},[]);let aa=D.filter(a=>{let b="all"===U||a.status===U,c=!O||a.name?.toLowerCase().includes(O.toLowerCase())||a.legal_name?.toLowerCase().includes(O.toLowerCase())||a.contact_name?.toLowerCase().includes(O.toLowerCase())||a.country?.toLowerCase().includes(O.toLowerCase()),d="all"===W;return b&&c&&d});return K?(0,b.jsxs)("div",{className:"flex items-center justify-center py-16",children:[(0,b.jsx)(n.Loader2,{className:"h-8 w-8 animate-spin text-muted-foreground"}),(0,b.jsx)("span",{className:"ml-3 text-muted-foreground",children:"Loading partners..."})]}):M?(0,b.jsxs)("div",{className:"text-center py-16",children:[(0,b.jsx)(o.AlertCircle,{className:"h-12 w-12 text-destructive mx-auto mb-4"}),(0,b.jsx)("h3",{className:"text-lg font-medium text-foreground mb-2",children:"Error Loading Partners"}),(0,b.jsx)("p",{className:"text-muted-foreground",children:M})]}):(0,b.jsxs)("div",{className:"p-6 space-y-6",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-2xl font-bold text-foreground",children:"My Partners"}),(0,b.jsx)("p",{className:"text-muted-foreground mt-1",children:a?`Partners working with ${a.legal_name}`:"View all distribution partners"})]}),(0,b.jsx)(z.default,{href:"/versotech_main/fee-plans",children:(0,b.jsxs)(f.Button,{variant:"outline",size:"sm",children:[(0,b.jsx)(s.FileText,{className:"h-4 w-4 mr-2"}),"Fee Plans"]})})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-6 gap-4",children:[(0,b.jsxs)(d.Card,{children:[(0,b.jsx)(d.CardHeader,{className:"pb-2",children:(0,b.jsxs)(d.CardTitle,{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[(0,b.jsx)(j.Users,{className:"h-4 w-4"}),"Total Partners"]})}),(0,b.jsxs)(d.CardContent,{children:[(0,b.jsx)("div",{className:"text-2xl font-bold",children:I.totalPartners}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"In your network"})]})]}),(0,b.jsxs)(d.Card,{children:[(0,b.jsx)(d.CardHeader,{className:"pb-2",children:(0,b.jsxs)(d.CardTitle,{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[(0,b.jsx)(l.CheckCircle2,{className:"h-4 w-4"}),"Active Partners"]})}),(0,b.jsxs)(d.CardContent,{children:[(0,b.jsx)("div",{className:"text-2xl font-bold text-green-600",children:I.activePartners}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Currently active"})]})]}),(0,b.jsxs)(d.Card,{children:[(0,b.jsx)(d.CardHeader,{className:"pb-2",children:(0,b.jsxs)(d.CardTitle,{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[(0,b.jsx)(r.Handshake,{className:"h-4 w-4"}),"Total Referrals"]})}),(0,b.jsxs)(d.CardContent,{children:[(0,b.jsx)("div",{className:"text-2xl font-bold text-blue-600",children:I.totalReferrals}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Investors referred"})]})]}),(0,b.jsxs)(d.Card,{children:[(0,b.jsx)(d.CardHeader,{className:"pb-2",children:(0,b.jsxs)(d.CardTitle,{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[(0,b.jsx)(v.TrendingUp,{className:"h-4 w-4"}),"Referral Value"]})}),(0,b.jsxs)(d.CardContent,{children:[(0,b.jsx)("div",{className:"text-2xl font-bold text-purple-600",children:(0,x.formatCurrency)(I.totalReferralValue,"USD")}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Total commitments"})]})]}),(0,b.jsxs)(d.Card,{children:[(0,b.jsx)(d.CardHeader,{className:"pb-2",children:(0,b.jsxs)(d.CardTitle,{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[(0,b.jsx)(t.DollarSign,{className:"h-4 w-4"}),"Fees Owed"]})}),(0,b.jsxs)(d.CardContent,{children:[(0,b.jsx)("div",{className:"text-2xl font-bold text-yellow-600",children:(0,x.formatCurrency)(I.totalOwed,"USD")}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Pending payment"})]})]}),(0,b.jsxs)(d.Card,{children:[(0,b.jsx)(d.CardHeader,{className:"pb-2",children:(0,b.jsxs)(d.CardTitle,{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[(0,b.jsx)(l.CheckCircle2,{className:"h-4 w-4"}),"Fees Paid"]})}),(0,b.jsxs)(d.CardContent,{children:[(0,b.jsx)("div",{className:"text-2xl font-bold text-green-600",children:(0,x.formatCurrency)(I.totalPaid,"USD")}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Total paid out"})]})]})]}),(0,b.jsx)(d.Card,{children:(0,b.jsx)(d.CardContent,{className:"pt-6",children:(0,b.jsxs)("div",{className:"flex flex-col md:flex-row gap-4",children:[(0,b.jsx)("div",{className:"flex-1",children:(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)(m.Search,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),(0,b.jsx)(g.Input,{placeholder:"Search partners...",value:O,onChange:a=>T(a.target.value),className:"pl-10"})]})}),(0,b.jsxs)(h.Select,{value:U,onValueChange:V,children:[(0,b.jsx)(h.SelectTrigger,{className:"w-full md:w-48",children:(0,b.jsx)(h.SelectValue,{placeholder:"Filter by status"})}),(0,b.jsx)(h.SelectContent,{children:S.map(a=>(0,b.jsx)(h.SelectItem,{value:a.value,children:a.label},a.value))})]}),G.length>0&&(0,b.jsxs)(h.Select,{value:W,onValueChange:X,children:[(0,b.jsx)(h.SelectTrigger,{className:"w-full md:w-56",children:(0,b.jsx)(h.SelectValue,{placeholder:"Filter by deal"})}),(0,b.jsxs)(h.SelectContent,{children:[(0,b.jsx)(h.SelectItem,{value:"all",children:"All Deals"}),G.map(a=>(0,b.jsx)(h.SelectItem,{value:a.id,children:a.name},a.id))]})]})]})})}),(0,b.jsxs)(d.Card,{children:[(0,b.jsxs)(d.CardHeader,{children:[(0,b.jsx)(d.CardTitle,{children:"Partners"}),(0,b.jsxs)(d.CardDescription,{children:[aa.length," partner",1!==aa.length?"s":""," found",a&&" • Click a row to view details"]})]}),(0,b.jsx)(d.CardContent,{children:0===aa.length?(0,b.jsxs)("div",{className:"border border-dashed border-muted rounded-lg py-12 flex flex-col items-center justify-center text-center space-y-2",children:[(0,b.jsx)(j.Users,{className:"h-10 w-10 text-muted-foreground"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:O||"all"!==U?"No partners match your filters":"No partners in your network yet"})]}):(0,b.jsx)("div",{className:"rounded-md border",children:(0,b.jsxs)(i.Table,{children:[(0,b.jsx)(i.TableHeader,{children:(0,b.jsxs)(i.TableRow,{children:[(0,b.jsx)(i.TableHead,{children:"Partner"}),(0,b.jsx)(i.TableHead,{children:"Type"}),(0,b.jsx)(i.TableHead,{children:"Contact"}),(0,b.jsx)(i.TableHead,{children:"Fee Plans"}),(0,b.jsx)(i.TableHead,{children:"Referrals"}),(0,b.jsx)(i.TableHead,{children:"Payments"}),(0,b.jsx)(i.TableHead,{children:"Status"}),(0,b.jsx)(i.TableHead,{className:"w-10"})]})}),(0,b.jsx)(i.TableBody,{children:aa.map(c=>(0,b.jsxs)(i.TableRow,{className:(0,w.cn)(a&&"cursor-pointer hover:bg-muted/50 transition-colors"),onClick:()=>a&&void(Z(c.id),_(!0)),children:[(0,b.jsx)(i.TableCell,{children:(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[c.logo_url?(0,b.jsx)("img",{src:c.logo_url,alt:c.name,className:"h-10 w-10 rounded-lg object-cover"}):(0,b.jsx)("div",{className:"h-10 w-10 rounded-lg bg-muted flex items-center justify-center",children:(0,b.jsx)(k.Building2,{className:"h-5 w-5 text-muted-foreground"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"font-medium",children:c.name}),c.country&&(0,b.jsxs)("div",{className:"text-xs text-muted-foreground flex items-center gap-1",children:[(0,b.jsx)(p.Globe,{className:"h-3 w-3"}),c.country]})]})]})}),(0,b.jsx)(i.TableCell,{children:c.partner_type?(0,b.jsx)(e.Badge,{variant:"secondary",className:"capitalize",children:c.partner_type.replace("_"," ")}):(0,b.jsx)("span",{className:"text-muted-foreground text-xs",children:"—"})}),(0,b.jsx)(i.TableCell,{children:(0,b.jsxs)("div",{className:"space-y-1",children:[c.contact_name&&(0,b.jsx)("div",{className:"text-sm",children:c.contact_name}),c.contact_email&&(0,b.jsxs)("div",{className:"text-xs text-muted-foreground flex items-center gap-1",children:[(0,b.jsx)(q.Mail,{className:"h-3 w-3"}),c.contact_email]})]})}),(0,b.jsx)(i.TableCell,{children:c.fee_plans.length>0?(0,b.jsxs)("div",{className:"flex flex-wrap gap-1",children:[c.fee_plans.slice(0,2).map(a=>(0,b.jsx)(e.Badge,{variant:a.is_active?"default":"secondary",className:"text-xs",children:a.name},a.id)),c.fee_plans.length>2&&(0,b.jsxs)(e.Badge,{variant:"outline",className:"text-xs",children:["+",c.fee_plans.length-2]})]}):(0,b.jsx)("span",{className:"text-muted-foreground text-xs",children:"No fee plans"})}),(0,b.jsx)(i.TableCell,{children:(0,b.jsxs)("div",{children:[(0,b.jsxs)("div",{className:"font-medium",children:[c.referrals_count," referrals"]}),c.total_referral_value>0&&(0,b.jsx)("div",{className:"text-xs text-muted-foreground",children:(0,x.formatCurrency)(c.total_referral_value,"USD")})]})}),(0,b.jsx)(i.TableCell,{children:(0,b.jsx)(F.PartnerCommissionSummary,{summary:c.commission_summary,variant:"inline"})}),(0,b.jsx)(i.TableCell,{children:(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)(e.Badge,{variant:"outline",className:(0,w.cn)("capitalize",Q[c.status]||Q.active),children:c.status}),c.kyc_status&&(0,b.jsx)("div",{children:(0,b.jsxs)(e.Badge,{variant:"secondary",className:(0,w.cn)("text-xs",R[c.kyc_status]||""),children:["KYC: ",c.kyc_status.replace("_"," ")]})})]})}),(0,b.jsx)(i.TableCell,{children:a&&(0,b.jsx)(u.ChevronRight,{className:"h-4 w-4 text-muted-foreground"})})]},c.id))})]})})})]}),(0,b.jsx)(P,{partnerId:Y,open:$,onOpenChange:_})]})}a.s(["default",()=>T],434314)}];

//# sourceMappingURL=versotech-portal_src_app_%28main%29_versotech_main_my-partners_page_tsx_02a90da1._.js.map