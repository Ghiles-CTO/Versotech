module.exports=[850247,592492,674930,256944,49995,a=>{"use strict";var b=a.i(352584),c=a.i(611038),d=a.i(421908),e=a.i(216316),f=a.i(15788),g=a.i(888987),h=a.i(520783),i=a.i(85514),j=a.i(58834),k=a.i(71459),l=a.i(375968),m=a.i(142015),n=a.i(877918),o=a.i(497412);function p({className:a}){let[p,q]=(0,c.useState)(!1),[r,s]=(0,c.useState)(!1),[t,u]=(0,c.useState)([]),[v,w]=(0,c.useState)(!0),{activePersona:x}=(0,h.usePersona)(),{theme:y}=(0,i.useTheme)();(0,c.useEffect)(()=>{q(!0)},[]);let z=p&&"staff-dark"===y;(0,c.useEffect)(()=>{!async function(){if(!x||!p)return;w(!0);let a=(0,j.createClient)(),b=[];try{let{data:{user:c},error:d}=await a.auth.getUser();if(d||!c){console.warn("[NotificationCenter] No authenticated user found"),u([]);return}let e=c.id,f=x.persona_type,g="lawyer"===f||"introducer"===f;if(!g){let c=a.from("tasks").select("id, title, description, created_at, owner_user_id, owner_investor_id").in("status",["pending","in_progress"]).order("created_at",{ascending:!1}).limit(5);c="investor"===f?c.or(`owner_user_id.eq.${e},owner_investor_id.eq.${x.entity_id}`):c.eq("owner_user_id",e);let{data:d}=await c;d&&d.forEach(a=>{b.push({id:`task-${a.id}`,type:"task",title:a.title,description:a.description,href:"/versotech_main/tasks",read:!1,created_at:a.created_at})})}if(!g){let{data:c}=await a.from("conversation_participants").select("conversation_id, last_read_at").eq("user_id",e).limit(50),d=(c||[]).map(a=>a.conversation_id).filter(Boolean);if(d.length>0){let e=a.from("conversations").select("id, subject, preview, last_message_at, created_at, visibility").in("id",d).order("last_message_at",{ascending:!1,nullsFirst:!1}).limit(10);"staff"!==f&&(e=e.in("visibility",["investor","deal"]));let{data:g}=await e,h=new Map;(c||[]).forEach(a=>{a.conversation_id&&h.set(a.conversation_id,a.last_read_at??null)}),(g||[]).filter(a=>{let b=a.last_message_at??a.created_at;if(!b)return!1;let c=h.get(a.id);return!c||new Date(b).getTime()>new Date(c).getTime()}).slice(0,5).forEach(a=>{let c=a.last_message_at??a.created_at;b.push({id:`msg-${a.id}`,type:"message",title:a.subject||"New message",description:a.preview||"You have a new message",href:"/versotech_main/inbox?tab=messages",read:!1,created_at:c})})}}let{data:h}=await a.from("investor_notifications").select("id, title, message, created_at, read_at, link").eq("user_id",e).is("read_at",null).order("created_at",{ascending:!1}).limit(5);if(h&&h.forEach(a=>{b.push({id:`notif-${a.id}`,type:"notification",title:a.title,description:a.message,href:a.link||"/versotech_main/notifications",read:null!==a.read_at,created_at:a.created_at})}),"lawyer"===f){let{data:c}=await a.from("notifications").select("id, title, message, created_at, read, link").eq("user_id",e).eq("read",!1).order("created_at",{ascending:!1}).limit(5);c&&c.forEach(a=>{b.push({id:`lawyer-notif-${a.id}`,type:"notification",title:a.title,description:a.message,href:a.link||"/versotech_main/notifications",read:!!a.read,created_at:a.created_at})})}b.sort((a,b)=>new Date(b.created_at).getTime()-new Date(a.created_at).getTime()),u(b.slice(0,10))}catch(a){console.error("[NotificationCenter] Error fetching notifications:",a)}finally{w(!1)}}()},[x,p]);let A=t.filter(a=>!a.read).length;return p?(0,b.jsxs)(e.DropdownMenu,{open:r,onOpenChange:s,children:[(0,b.jsx)(e.DropdownMenuTrigger,{asChild:!0,children:(0,b.jsxs)(d.Button,{variant:"ghost",size:"icon",className:(0,g.cn)("relative",z?"text-gray-400 hover:text-white hover:bg-white/10":"text-gray-600 hover:text-gray-900 hover:bg-gray-100",a),children:[(0,b.jsx)(k.Bell,{className:"h-5 w-5"}),A>0&&(0,b.jsx)(f.Badge,{className:(0,g.cn)("absolute -top-1 -right-1 h-5 w-5 flex items-center justify-center p-0 text-[10px]","bg-red-500 text-white border-0"),children:A>9?"9+":A})]})}),(0,b.jsxs)(e.DropdownMenuContent,{align:"end",className:(0,g.cn)("w-80",z?"bg-zinc-800 border-white/10 text-white":"bg-white border-gray-200"),children:[(0,b.jsxs)(e.DropdownMenuLabel,{className:"flex items-center justify-between",children:[(0,b.jsx)("span",{className:z?"text-white":"text-gray-900",children:"Notifications"}),A>0&&(0,b.jsxs)(f.Badge,{variant:"secondary",className:"text-xs",children:[A," new"]})]}),(0,b.jsx)(e.DropdownMenuSeparator,{className:z?"bg-white/10":"bg-gray-100"}),v?(0,b.jsx)("div",{className:"p-4 text-center",children:(0,b.jsx)("div",{className:(0,g.cn)("animate-spin h-5 w-5 mx-auto border-2 rounded-full",z?"border-white/20 border-t-white":"border-gray-200 border-t-gray-600")})}):0===t.length?(0,b.jsx)("div",{className:(0,g.cn)("p-4 text-center text-sm","text-gray-500"),children:"No notifications"}):(0,b.jsx)("div",{className:"max-h-80 overflow-y-auto",children:t.map(a=>{let c,d,f,h,i=(a=>{switch(a){case"task":return l.CheckSquare;case"message":return m.MessageSquare;case"notification":return n.AlertCircle;default:return k.Bell}})(a.type);return(0,b.jsx)(e.DropdownMenuItem,{asChild:!0,className:(0,g.cn)("flex items-start gap-3 p-3 cursor-pointer",z?"focus:bg-white/10":"focus:bg-gray-50",!a.read&&(z?"bg-white/5":"bg-blue-50/50")),children:(0,b.jsxs)(o.default,{href:a.href,className:"flex items-start gap-3 w-full",children:[(0,b.jsx)("div",{className:(0,g.cn)("h-8 w-8 rounded-full flex items-center justify-center flex-shrink-0",z?"bg-white/10":"bg-gray-100"),children:(0,b.jsx)(i,{className:(0,g.cn)("h-4 w-4","task"===a.type&&"text-blue-500","message"===a.type&&"text-green-500","notification"===a.type&&"text-orange-500")})}),(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsx)("div",{className:(0,g.cn)("text-sm font-medium truncate",z?"text-white":"text-gray-900"),children:a.title}),a.description&&(0,b.jsx)("div",{className:(0,g.cn)("text-xs truncate",z?"text-gray-400":"text-gray-500"),children:a.description}),(0,b.jsxs)("div",{className:(0,g.cn)("text-xs mt-1",z?"text-gray-500":"text-gray-400"),children:[(c=new Date(a.created_at),h=Math.floor((f=Math.floor((d=Math.floor((new Date().getTime()-c.getTime())/6e4))/60))/24),d<1?"Just now":d<60?`${d}m ago`:f<24?`${f}h ago`:h<7?`${h}d ago`:c.toLocaleDateString()),a.deal_name&&` â€¢ ${a.deal_name}`]})]}),!a.read&&(0,b.jsx)("div",{className:"h-2 w-2 rounded-full bg-blue-500 flex-shrink-0 mt-2"})]})},a.id)})}),(0,b.jsx)(e.DropdownMenuSeparator,{className:z?"bg-white/10":"bg-gray-100"}),(0,b.jsx)(e.DropdownMenuItem,{asChild:!0,children:(0,b.jsx)(o.default,{href:"/versotech_main/notifications",className:(0,g.cn)("flex items-center justify-center text-sm py-2",z?"text-blue-400":"text-blue-600"),children:"View all notifications"})})]})]}):(0,b.jsx)(d.Button,{variant:"ghost",size:"icon",className:(0,g.cn)("relative",z?"text-gray-400 hover:text-white hover:bg-white/10":"text-gray-600 hover:text-gray-900 hover:bg-gray-100",a),children:(0,b.jsx)(k.Bell,{className:"h-5 w-5"})})}a.s(["NotificationCenter",()=>p],850247);var q=a.i(289633),r=a.i(105874),s=a.i(168118),t=a.i(696661),u=a.i(278541),v=a.i(478870),w=a.i(799373),x=a.i(871057),y=a.i(504839),z=a.i(325866),A=a.i(158800),B=a.i(123614),C=a.i(714814),D=a.i(976839);let E={ceo:u.Building2,staff:u.Building2,investor:z.User,arranger:x.Briefcase,introducer:w.UserPlus,partner:v.Users,commercial_partner:u.Building2,lawyer:y.Scale},F={ceo:"CEO",staff:"Staff",investor:"Investor",arranger:"Arranger",introducer:"Introducer",partner:"Partner",commercial_partner:"Commercial Partner",lawyer:"Lawyer"};function G({profile:a,className:f}){let j,[k,l]=(0,c.useState)(!1),[m,n]=(0,c.useState)(!1),[o,p]=(0,c.useState)(!1),{personas:u,activePersona:v,switchPersona:w,hasMultiplePersonas:x}=(0,h.usePersona)(),{theme:y}=(0,i.useTheme)(),G=(0,q.useRouter)();(0,c.useEffect)(()=>{l(!0)},[]);let H=k&&"staff-dark"===y,I=async()=>{p(!0);let a="/versotech_main/login";try{await (0,D.signOut)(),G.push(a),window.location.href=a}catch(b){console.error("Logout failed:",b),window.location.href=a}},J=a=>a&&a.split(" ").map(a=>a[0]).filter(Boolean).join("").toUpperCase().slice(0,2)||"U";return k?(0,b.jsxs)(e.DropdownMenu,{open:m,onOpenChange:n,children:[(0,b.jsx)(e.DropdownMenuTrigger,{asChild:!0,children:(0,b.jsxs)(d.Button,{variant:"ghost",className:(0,g.cn)("flex items-center gap-2 h-auto px-3 py-2",H?"hover:bg-white/10":"hover:bg-black/5",f),children:[(0,b.jsxs)(r.Avatar,{className:"h-8 w-8",children:[(0,b.jsx)(r.AvatarImage,{src:a.avatar||void 0,alt:a.displayName}),(0,b.jsx)(r.AvatarFallback,{className:(0,g.cn)("text-xs",H?"bg-white/20 text-white":"bg-black/10 text-black"),children:J(a.displayName)})]}),(0,b.jsx)("div",{className:"text-left",children:(0,b.jsx)("div",{className:(0,g.cn)("font-medium text-sm",H?"text-white":"text-black"),children:a.displayName})}),(0,b.jsx)(s.ChevronDown,{className:(0,g.cn)("h-4 w-4 transition-transform",H?"text-white/70":"text-black/70",m&&"rotate-180")})]})}),(0,b.jsxs)(e.DropdownMenuContent,{align:"end",className:(0,g.cn)("w-72",H?"bg-zinc-800 border-white/10":"bg-white border-gray-200"),children:[(0,b.jsx)("div",{className:"px-3 py-3",children:(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsxs)(r.Avatar,{className:"h-10 w-10",children:[(0,b.jsx)(r.AvatarImage,{src:a.avatar||void 0,alt:a.displayName}),(0,b.jsx)(r.AvatarFallback,{className:(0,g.cn)("text-sm",H?"bg-white/20 text-white":"bg-black/10 text-black"),children:J(a.displayName)})]}),(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsx)("div",{className:(0,g.cn)("font-medium text-sm truncate",H?"text-white":"text-gray-900"),children:a.displayName}),(0,b.jsx)("div",{className:(0,g.cn)("text-xs truncate",H?"text-gray-400":"text-gray-500"),children:a.email})]})]})}),x&&u.length>0&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(e.DropdownMenuSeparator,{className:H?"bg-white/10":"bg-gray-100"}),(0,b.jsx)(e.DropdownMenuLabel,{className:(0,g.cn)("text-xs uppercase tracking-wider",H?"text-gray-500":"text-gray-400"),children:"Switch Context"}),u.map(a=>{let c=E[a.persona_type]||z.User,d=v?.entity_id===a.entity_id;return(0,b.jsxs)(e.DropdownMenuItem,{onClick:()=>{w(a),n(!1)},className:(0,g.cn)("flex items-center gap-3 py-2.5 cursor-pointer",H?"focus:bg-white/10 focus:text-white":"focus:bg-gray-100 focus:text-gray-900",d&&(H?"bg-white/5":"bg-blue-50")),children:[a.entity_logo_url?(0,b.jsx)("div",{className:"relative h-8 w-8 rounded-full overflow-hidden flex-shrink-0",children:(0,b.jsx)(C.default,{src:a.entity_logo_url,alt:a.entity_name,fill:!0,className:"object-cover"})}):(0,b.jsx)("div",{className:(0,g.cn)("h-8 w-8 rounded-full flex items-center justify-center flex-shrink-0",H?"bg-white/10":"bg-gray-100"),children:(0,b.jsx)(c,{className:"h-4 w-4"})}),(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsx)("div",{className:(0,g.cn)("text-sm font-medium truncate",H?"text-white":"text-gray-900"),children:a.entity_name}),(0,b.jsx)("div",{className:(0,g.cn)("text-xs truncate",H?"text-gray-400":"text-gray-500"),children:"staff"===a.persona_type?a.role_in_entity:F[a.persona_type]})]}),d&&(0,b.jsx)(t.Check,{className:(0,g.cn)("h-4 w-4 flex-shrink-0",H?"text-blue-400":"text-blue-600")})]},a.entity_id)})]}),!x&&v&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(e.DropdownMenuSeparator,{className:H?"bg-white/10":"bg-gray-100"}),(0,b.jsxs)("div",{className:"px-3 py-2",children:[(0,b.jsx)("div",{className:(0,g.cn)("text-xs uppercase tracking-wider mb-1.5",H?"text-gray-500":"text-gray-400"),children:"Current Context"}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[v.entity_logo_url?(0,b.jsx)("div",{className:"relative h-6 w-6 rounded-full overflow-hidden flex-shrink-0",children:(0,b.jsx)(C.default,{src:v.entity_logo_url,alt:v.entity_name,fill:!0,className:"object-cover"})}):(0,b.jsx)("div",{className:(0,g.cn)("h-6 w-6 rounded-full flex items-center justify-center flex-shrink-0",H?"bg-white/10":"bg-gray-100"),children:(j=E[v.persona_type]||z.User,(0,b.jsx)(j,{className:"h-3 w-3"}))}),(0,b.jsx)("div",{className:(0,g.cn)("text-sm",H?"text-white":"text-gray-900"),children:v.entity_name})]})]})]}),(0,b.jsx)(e.DropdownMenuSeparator,{className:H?"bg-white/10":"bg-gray-100"}),(0,b.jsxs)(e.DropdownMenuItem,{onClick:()=>{n(!1);let a=v&&({ceo:"/versotech_main/ceo-profile",staff:"/versotech_main/profile",investor:"/versotech_main/profile",arranger:"/versotech_main/arranger-profile",lawyer:"/versotech_main/lawyer-profile",introducer:"/versotech_main/introducer-profile",partner:"/versotech_main/partner-profile",commercial_partner:"/versotech_main/commercial-partner-profile"})[v.persona_type]||"/versotech_main/profile";G.push(a)},className:H?"focus:bg-white/10 focus:text-white":"",children:[(0,b.jsx)(A.Settings,{className:"mr-2 h-4 w-4"}),"Profile Settings"]}),(0,b.jsxs)(e.DropdownMenuItem,{onClick:I,disabled:o,className:"text-red-600 focus:text-red-600",children:[(0,b.jsx)(B.LogOut,{className:"mr-2 h-4 w-4"}),o?"Signing out...":"Sign Out"]})]})]}):(0,b.jsxs)(d.Button,{variant:"ghost",className:(0,g.cn)("flex items-center gap-2 h-auto px-3 py-2",H?"hover:bg-white/10":"hover:bg-black/5",f),children:[(0,b.jsx)(r.Avatar,{className:"h-8 w-8",children:(0,b.jsx)(r.AvatarFallback,{className:(0,g.cn)("text-xs",H?"bg-white/20 text-white":"bg-black/10 text-black"),children:J(a.displayName)})}),(0,b.jsx)("div",{className:"text-left",children:(0,b.jsx)("div",{className:(0,g.cn)("font-medium text-sm",H?"text-white":"text-black"),children:a.displayName})}),(0,b.jsx)(s.ChevronDown,{className:(0,g.cn)("h-4 w-4",H?"text-white/70":"text-black/70")})]})}a.s(["IdentityMenu",()=>G],592492);var H=a.i(95799);let I=(0,H.default)("sun",[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]]);a.s(["Sun",()=>I],674930);let J=(0,H.default)("moon",[["path",{d:"M20.985 12.486a9 9 0 1 1-9.473-9.472c.405-.022.617.46.402.803a6 6 0 0 0 8.268 8.268c.344-.215.825-.004.803.401",key:"kfwtm"}]]);a.s(["Moon",()=>J],256944);let K=(0,H.default)("monitor",[["rect",{width:"20",height:"14",x:"2",y:"3",rx:"2",key:"48i651"}],["line",{x1:"8",x2:"16",y1:"21",y2:"21",key:"1svkeh"}],["line",{x1:"12",x2:"12",y1:"17",y2:"21",key:"vw1qmm"}]]);a.s(["Monitor",()=>K],49995)}];

//# sourceMappingURL=versotech-portal_src_components_layout_notification-center_tsx_c922a294._.js.map