module.exports=[780826,a=>{"use strict";var b=a.i(352584),c=a.i(611038),d=a.i(284169),e=a.i(15788),f=a.i(663475),g=a.i(951870),h=a.i(771088),i=a.i(860058),j=a.i(478870),k=a.i(487068),l=a.i(3321),m=a.i(877918),n=a.i(871057),o=a.i(966494),p=a.i(278541),q=a.i(13289),r=a.i(888987),s=a.i(201986),t=a.i(58834);let u={open:"bg-green-100 text-green-800 border-green-200",closed:"bg-blue-100 text-blue-800 border-blue-200",pending:"bg-yellow-100 text-yellow-800 border-yellow-200",cancelled:"bg-red-100 text-red-800 border-red-200"},v=[{label:"All Status",value:"all"},{label:"Open",value:"open"},{label:"Closed",value:"closed"},{label:"Pending",value:"pending"}];function w(){let[a,w]=(0,c.useState)(null),[x,y]=(0,c.useState)([]),[z,A]=(0,c.useState)({totalShared:0,activeDeals:0,totalValue:0,coPartners:0}),[B,C]=(0,c.useState)(!0),[D,E]=(0,c.useState)(null),[F,G]=(0,c.useState)(""),[H,I]=(0,c.useState)("all");(0,c.useEffect)(()=>{async function a(a){let{data:c,error:d}=await a.from("deal_memberships").select(`
          deal_id,
          investor_id,
          dispatched_at,
          referred_by_entity_id,
          referred_by_entity_type,
          investor:investor_id (
            id,
            legal_name
          ),
          deal:deal_id (
            id,
            name,
            status,
            currency,
            target_amount
          )
        `).not("referred_by_entity_id","is",null).order("dispatched_at",{ascending:!1}).limit(50);if(d)throw d;b(c||[],{},{})}function b(a,b,c){let d=a.map(a=>{let d=Array.isArray(a.investor)?a.investor[0]:a.investor,e=Array.isArray(a.deal)?a.deal[0]:a.deal,f=d?.id?b[d.id]:null,g=c[e?.id]||[],h=g.length>0,i=g[0];return{id:`${a.deal_id||"no-deal"}-${a.investor_id||"no-investor"}`,deal_id:e?.id||"",deal_name:e?.name||"Unknown Deal",deal_status:e?.status||"draft",investor_id:d?.id||null,investor_name:d?.legal_name||"Unknown",commitment_amount:f?.commitment||0,currency:e?.currency||"USD",dispatched_at:a.dispatched_at,partner_share:h?50:100,co_referrer_name:h?`Co-referrer (${i.referred_by_entity_type})`:null,co_referrer_type:i?.referred_by_entity_type||null}}),e=d.filter(a=>null!==a.co_referrer_name);y(d);let f=new Set(d.map(a=>a.deal_id)),g=new Set(d.filter(a=>a.co_referrer_name).map(a=>a.co_referrer_name)),h=d.reduce((a,b)=>a+b.commitment_amount,0);A({totalShared:e.length,activeDeals:f.size,totalValue:h,coPartners:g.size})}!async function(){try{C(!0);let c=(0,t.createClient)(),{data:{user:d}}=await c.auth.getUser();if(!d)return void E("Not authenticated");let{data:e,error:f}=await c.from("partner_users").select("partner_id").eq("user_id",d.id).single();if(f||!e)return void await a(c);let{data:g,error:h}=await c.from("partners").select("id, name, legal_name, status, logo_url").eq("id",e.partner_id).single();if(h)throw h;w(g);let{data:i,error:j}=await c.from("deal_memberships").select(`
            deal_id,
            investor_id,
            dispatched_at,
            referred_by_entity_id,
            referred_by_entity_type,
            investor:investor_id (
              id,
              legal_name
            ),
            deal:deal_id (
              id,
              name,
              status,
              currency,
              target_amount
            )
          `).eq("referred_by_entity_id",e.partner_id).eq("referred_by_entity_type","partner").order("dispatched_at",{ascending:!1});if(j)throw j;let k=(i||[]).filter(a=>{let b=Array.isArray(a.investor)?a.investor[0]:a.investor;return b?.id}).map(a=>(Array.isArray(a.investor)?a.investor[0]:a.investor).id),l={};if(k.length>0){let{data:a}=await c.from("subscriptions").select("investor_id, commitment, status").in("investor_id",k);a&&a.forEach(a=>{l[a.investor_id]||(l[a.investor_id]=a)})}let m=[...new Set((i||[]).filter(a=>{let b=Array.isArray(a.deal)?a.deal[0]:a.deal;return b?.id}).map(a=>(Array.isArray(a.deal)?a.deal[0]:a.deal).id))],n={};if(m.length>0){let{data:a}=await c.from("deal_memberships").select("deal_id, referred_by_entity_id, referred_by_entity_type").in("deal_id",m).not("referred_by_entity_id","is",null).neq("referred_by_entity_id",e.partner_id);a&&a.forEach(a=>{n[a.deal_id]||(n[a.deal_id]=[]),n[a.deal_id].push(a)})}b(i||[],l,n),E(null)}catch(a){console.error("[SharedTransactionsPage] Error:",a),E(a instanceof Error?a.message:"Failed to load shared transactions")}finally{C(!1)}}()},[]);let J=x.filter(a=>{let b="all"===H||a.deal_status===H,c=!F||a.deal_name?.toLowerCase().includes(F.toLowerCase())||a.investor_name?.toLowerCase().includes(F.toLowerCase());return b&&c});return B?(0,b.jsxs)("div",{className:"flex items-center justify-center py-16",children:[(0,b.jsx)(l.Loader2,{className:"h-8 w-8 animate-spin text-muted-foreground"}),(0,b.jsx)("span",{className:"ml-3 text-muted-foreground",children:"Loading shared transactions..."})]}):D?(0,b.jsxs)("div",{className:"text-center py-16",children:[(0,b.jsx)(m.AlertCircle,{className:"h-12 w-12 text-destructive mx-auto mb-4"}),(0,b.jsx)("h3",{className:"text-lg font-medium text-foreground mb-2",children:"Error Loading Transactions"}),(0,b.jsx)("p",{className:"text-muted-foreground",children:D})]}):(0,b.jsxs)("div",{className:"p-6 space-y-6",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-2xl font-bold text-foreground",children:"Shared Transactions"}),(0,b.jsx)("p",{className:"text-muted-foreground mt-1",children:a?`View deals shared with other partners as ${a.name}`:"View all transactions with shared referrals"})]}),a&&(0,b.jsx)("div",{className:"flex items-center gap-2",children:a.logo_url?(0,b.jsx)("img",{src:a.logo_url,alt:a.name,className:"h-10 w-10 rounded-lg object-cover"}):(0,b.jsx)("div",{className:"h-10 w-10 rounded-lg bg-muted flex items-center justify-center",children:(0,b.jsx)(p.Building2,{className:"h-5 w-5 text-muted-foreground"})})})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,b.jsxs)(d.Card,{children:[(0,b.jsx)(d.CardHeader,{className:"pb-2",children:(0,b.jsxs)(d.CardTitle,{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[(0,b.jsx)(i.Share2,{className:"h-4 w-4"}),"Shared Referrals"]})}),(0,b.jsxs)(d.CardContent,{children:[(0,b.jsx)("div",{className:"text-2xl font-bold",children:z.totalShared}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"With co-referrers"})]})]}),(0,b.jsxs)(d.Card,{children:[(0,b.jsx)(d.CardHeader,{className:"pb-2",children:(0,b.jsxs)(d.CardTitle,{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[(0,b.jsx)(n.Briefcase,{className:"h-4 w-4"}),"Deals Involved"]})}),(0,b.jsxs)(d.CardContent,{children:[(0,b.jsx)("div",{className:"text-2xl font-bold text-blue-600",children:z.activeDeals}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Unique deals"})]})]}),(0,b.jsxs)(d.Card,{children:[(0,b.jsx)(d.CardHeader,{className:"pb-2",children:(0,b.jsxs)(d.CardTitle,{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[(0,b.jsx)(o.TrendingUp,{className:"h-4 w-4"}),"Total Value"]})}),(0,b.jsxs)(d.CardContent,{children:[(0,b.jsx)("div",{className:"text-2xl font-bold text-emerald-600",children:(0,s.formatCurrency)(z.totalValue,"USD")}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Commitment value"})]})]}),(0,b.jsxs)(d.Card,{children:[(0,b.jsx)(d.CardHeader,{className:"pb-2",children:(0,b.jsxs)(d.CardTitle,{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[(0,b.jsx)(q.Handshake,{className:"h-4 w-4"}),"Co-Partners"]})}),(0,b.jsxs)(d.CardContent,{children:[(0,b.jsx)("div",{className:"text-2xl font-bold text-purple-600",children:z.coPartners}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Partner relationships"})]})]})]}),(0,b.jsx)(d.Card,{children:(0,b.jsx)(d.CardContent,{className:"pt-6",children:(0,b.jsxs)("div",{className:"flex flex-col md:flex-row gap-4",children:[(0,b.jsx)("div",{className:"flex-1",children:(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)(k.Search,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),(0,b.jsx)(f.Input,{placeholder:"Search by deal or investor name...",value:F,onChange:a=>G(a.target.value),className:"pl-10"})]})}),(0,b.jsxs)(g.Select,{value:H,onValueChange:I,children:[(0,b.jsx)(g.SelectTrigger,{className:"w-full md:w-48",children:(0,b.jsx)(g.SelectValue,{placeholder:"Filter by status"})}),(0,b.jsx)(g.SelectContent,{children:v.map(a=>(0,b.jsx)(g.SelectItem,{value:a.value,children:a.label},a.value))})]})]})})}),(0,b.jsxs)(d.Card,{children:[(0,b.jsxs)(d.CardHeader,{children:[(0,b.jsx)(d.CardTitle,{children:"Transactions"}),(0,b.jsxs)(d.CardDescription,{children:[J.length," transaction",1!==J.length?"s":""," found"]})]}),(0,b.jsx)(d.CardContent,{children:0===J.length?(0,b.jsxs)("div",{className:"border border-dashed border-muted rounded-lg py-12 flex flex-col items-center justify-center text-center space-y-2",children:[(0,b.jsx)(i.Share2,{className:"h-10 w-10 text-muted-foreground"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:F||"all"!==H?"No transactions match your filters":a?"No shared transactions yet":"No shared transactions found"}),a&&0===x.length&&(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"Shared transactions appear when you co-refer deals with other partners"})]}):(0,b.jsx)("div",{className:"rounded-md border",children:(0,b.jsxs)(h.Table,{children:[(0,b.jsx)(h.TableHeader,{children:(0,b.jsxs)(h.TableRow,{children:[(0,b.jsx)(h.TableHead,{children:"Deal"}),(0,b.jsx)(h.TableHead,{children:"Investor"}),(0,b.jsx)(h.TableHead,{children:"Your Share"}),(0,b.jsx)(h.TableHead,{children:"Co-Referrer"}),(0,b.jsx)(h.TableHead,{children:"Amount"}),(0,b.jsx)(h.TableHead,{children:"Status"})]})}),(0,b.jsx)(h.TableBody,{children:J.map(a=>(0,b.jsxs)(h.TableRow,{children:[(0,b.jsx)(h.TableCell,{children:(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(n.Briefcase,{className:"h-4 w-4 text-muted-foreground"}),(0,b.jsx)("span",{className:"font-medium",children:a.deal_name})]})}),(0,b.jsx)(h.TableCell,{children:(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(j.Users,{className:"h-4 w-4 text-muted-foreground"}),(0,b.jsx)("span",{children:a.investor_name})]})}),(0,b.jsx)(h.TableCell,{children:(0,b.jsxs)(e.Badge,{variant:100===a.partner_share?"default":"secondary",children:[a.partner_share,"%"]})}),(0,b.jsx)(h.TableCell,{children:a.co_referrer_name?(0,b.jsxs)("div",{className:"flex items-center gap-1",children:[(0,b.jsx)(q.Handshake,{className:"h-3 w-3 text-muted-foreground"}),(0,b.jsx)("span",{className:"text-sm",children:a.co_referrer_name})]}):(0,b.jsx)("span",{className:"text-muted-foreground text-xs",children:"None"})}),(0,b.jsxs)(h.TableCell,{children:[(0,b.jsx)("div",{className:"font-medium",children:(0,s.formatCurrency)(a.commitment_amount,a.currency)}),(0,b.jsx)("div",{className:"text-xs text-muted-foreground",children:a.dispatched_at?(0,s.formatDate)(a.dispatched_at):"â€”"})]}),(0,b.jsx)(h.TableCell,{children:(0,b.jsx)(e.Badge,{variant:"outline",className:(0,r.cn)("capitalize",u[a.deal_status]||""),children:a.deal_status})})]},a.id))})]})})})]})]})}a.s(["default",()=>w])}];

//# sourceMappingURL=c6ad4_src_app_%28main%29_versotech_main_shared-transactions_page_tsx_6935bf30._.js.map