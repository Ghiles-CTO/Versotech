module.exports=[193695,(a,b,c)=>{b.exports=a.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},9349,a=>{a.n(a.i(142710))},199585,a=>{a.n(a.i(701395))},929852,a=>{a.n(a.i(816404))},516153,a=>{a.n(a.i(422096))},911164,a=>{a.n(a.i(273021))},243085,a=>{"use strict";a.i(483696);var b=a.i(263360),c=a.i(621599);a.i(937413);var d=a.i(131360);let e=["staff_admin","staff_ops","staff_rm","ceo"],f=async()=>{let a=await (0,c.cookies)();return(0,b.createServerClient)("https://ipguxdssecfexudnvtia.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlwZ3V4ZHNzZWNmZXh1ZG52dGlhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTgzNjE4MzcsImV4cCI6MjA3MzkzNzgzN30.AGxM_YW9hfxuu7xDpi_4xhOoRhYM7iGTS1vJ0z2FByE",{cookies:{getAll:()=>a.getAll(),setAll(b){try{b.forEach(({name:b,value:c,options:d})=>a.set(b,c,d))}catch{}}}})};async function g(){try{let a=await f(),{data:{user:b},error:c}=await a.auth.getUser();if(c||!b)return null;let{data:d,error:g}=await a.from("profiles").select("*").eq("id",b.id).single();if(g||!d)return console.error("[auth] Profile not found for user:",b.id,g),null;let h=[];if(e.includes(d.role)){let{data:c}=await a.from("staff_permissions").select("permission").eq("user_id",b.id);h=c?.map(a=>a.permission)||[]}return{id:d.id,email:d.email,displayName:d.display_name||d.email?.split("@")[0]||"User",avatar:d.avatar_url,role:d.role,title:d.title,created_at:d.created_at,permissions:h}}catch(a){return console.error("Error getting current user:",a),null}}async function h(){let a=await g();return a?console.log("[auth] Profile retrieved:",a.email,a.role):console.log("[auth] No profile found"),a}async function i(a){let b=await g();if(b||(0,d.redirect)("/versotech_main/login"),a&&!a.includes(b.role))throw Error("Insufficient permissions");return b}async function j(){let a=await g();if(a||(0,d.redirect)("/versotech_main/login"),"investor"!==a.role)throw Error("Investor access required");return a}async function k(){let a=await g();if(a||(0,d.redirect)("/versotech_main/login"),!e.includes(a.role))throw Error("Staff access required");return a}async function l(a){let b=await f(),{data:c,error:d}=await b.from("profiles").select("role").eq("id",a).single();if(!d&&c&&e.includes(c.role))return!0;let{data:g}=await b.rpc("get_user_personas",{p_user_id:a});return g?.some(a=>"staff"===a.persona_type||"ceo"===a.persona_type)||!1}a.s(["checkStaffAccess",()=>l,"getCurrentUser",()=>g,"getProfile",()=>h,"requireAuth",()=>i,"requireInvestorAuth",()=>j,"requireStaffAuth",()=>k])},912238,a=>{"use strict";a.s(["Sidebar",()=>b]);let b=(0,a.i(578644).registerClientReference)(function(){throw Error("Attempted to call Sidebar() from the server but Sidebar is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/versotech-portal/src/components/layout/sidebar.tsx <module evaluation>","Sidebar")},286563,a=>{"use strict";a.s(["Sidebar",()=>b]);let b=(0,a.i(578644).registerClientReference)(function(){throw Error("Attempted to call Sidebar() from the server but Sidebar is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/versotech-portal/src/components/layout/sidebar.tsx","Sidebar")},496154,a=>{"use strict";a.i(912238);var b=a.i(286563);a.n(b)},445735,a=>{"use strict";a.s(["UserMenu",()=>b]);let b=(0,a.i(578644).registerClientReference)(function(){throw Error("Attempted to call UserMenu() from the server but UserMenu is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/versotech-portal/src/components/layout/user-menu.tsx <module evaluation>","UserMenu")},181058,a=>{"use strict";a.s(["UserMenu",()=>b]);let b=(0,a.i(578644).registerClientReference)(function(){throw Error("Attempted to call UserMenu() from the server but UserMenu is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/versotech-portal/src/components/layout/user-menu.tsx","UserMenu")},455428,a=>{"use strict";a.i(445735);var b=a.i(181058);a.n(b)},365595,a=>{"use strict";a.s(["GlobalKeyboardShortcuts",()=>b]);let b=(0,a.i(578644).registerClientReference)(function(){throw Error("Attempted to call GlobalKeyboardShortcuts() from the server but GlobalKeyboardShortcuts is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/versotech-portal/src/components/layout/global-keyboard-shortcuts.tsx <module evaluation>","GlobalKeyboardShortcuts")},520443,a=>{"use strict";a.s(["GlobalKeyboardShortcuts",()=>b]);let b=(0,a.i(578644).registerClientReference)(function(){throw Error("Attempted to call GlobalKeyboardShortcuts() from the server but GlobalKeyboardShortcuts is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/versotech-portal/src/components/layout/global-keyboard-shortcuts.tsx","GlobalKeyboardShortcuts")},586007,a=>{"use strict";a.i(365595);var b=a.i(520443);a.n(b)},619220,a=>{"use strict";a.s(["ThemeProvider",()=>c,"useTheme",()=>d]);var b=a.i(578644);let c=(0,b.registerClientReference)(function(){throw Error("Attempted to call ThemeProvider() from the server but ThemeProvider is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/versotech-portal/src/components/theme-provider.tsx <module evaluation>","ThemeProvider"),d=(0,b.registerClientReference)(function(){throw Error("Attempted to call useTheme() from the server but useTheme is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/versotech-portal/src/components/theme-provider.tsx <module evaluation>","useTheme")},199017,a=>{"use strict";a.s(["ThemeProvider",()=>c,"useTheme",()=>d]);var b=a.i(578644);let c=(0,b.registerClientReference)(function(){throw Error("Attempted to call ThemeProvider() from the server but ThemeProvider is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/versotech-portal/src/components/theme-provider.tsx","ThemeProvider"),d=(0,b.registerClientReference)(function(){throw Error("Attempted to call useTheme() from the server but useTheme is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/versotech-portal/src/components/theme-provider.tsx","useTheme")},684069,a=>{"use strict";a.i(619220);var b=a.i(199017);a.n(b)},336331,a=>{"use strict";a.s(["KYCAlert",()=>b]);let b=(0,a.i(578644).registerClientReference)(function(){throw Error("Attempted to call KYCAlert() from the server but KYCAlert is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/versotech-portal/src/components/dashboard/kyc-alert.tsx <module evaluation>","KYCAlert")},730807,a=>{"use strict";a.s(["KYCAlert",()=>b]);let b=(0,a.i(578644).registerClientReference)(function(){throw Error("Attempted to call KYCAlert() from the server but KYCAlert is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/versotech-portal/src/components/dashboard/kyc-alert.tsx","KYCAlert")},914402,a=>{"use strict";a.i(336331);var b=a.i(730807);a.n(b)},743513,a=>{"use strict";var b=a.i(714898),c=a.i(496154);let d="#0B5FFF",e={versoholdings:{name:"VERSO",loginPath:"/login",dashboardPath:"/versotech_main/dashboard",primary:d},versotech:{name:"VERSO Tech",loginPath:"/login",dashboardPath:"/versotech_main",primary:d}};function f({brand:a,className:c=""}){let d=e[a];return(0,b.jsx)("div",{className:`flex items-center ${c}`,children:(0,b.jsx)("h1",{className:`text-xl font-bold ${"versotech"===a?"text-foreground":"text-black"}`,children:d.name})})}var g=a.i(455428),h=a.i(586007),i=a.i(684069),j=a.i(243085);a.i(937413);var k=a.i(131360),l=a.i(198307),m=a.i(914402);async function n({children:a,brand:d}){let e=await (0,j.getProfile)();e||(0,k.redirect)("/login");let n=["staff_admin","staff_ops","staff_rm","ceo"].includes(e.role);console.log("[AppLayout] Profile check:",{brand:d,userRole:e.role,isStaffRole:n,email:e.email}),"versoholdings"===d&&"investor"!==e.role&&(console.log("[AppLayout] Redirecting non-investor from versoholdings"),(0,k.redirect)("/versotech_main")),"versotech"!==d||n||(console.log("[AppLayout] Redirecting non-staff from versotech"),(0,k.redirect)("/versotech_main/dashboard")),console.log("[AppLayout] Access granted for",e.email,"to",d);let o="versotech"===d,p="completed";if("versoholdings"===d&&"investor"===e.role)try{let a=await (0,l.createClient)(),{data:b}=await a.from("investor_users").select("investor_id, investors(kyc_status)").eq("user_id",e.id).single();b?.investors&&(p=b.investors.kyc_status||"not_started")}catch(a){console.error("[AppLayout] Error fetching KYC status:",a)}return(0,b.jsx)(i.ThemeProvider,{defaultTheme:o?"staff-dark":"light",children:(0,b.jsxs)("div",{className:"flex h-screen min-h-screen overflow-hidden bg-gradient-to-br from-gray-50 via-blue-50/30 to-indigo-50/20 dark:from-zinc-950 dark:via-zinc-950 dark:to-zinc-950 dark:bg-zinc-950",children:[(0,b.jsx)(h.GlobalKeyboardShortcuts,{brand:d,role:e.role}),(0,b.jsx)(c.Sidebar,{brand:d,userProfile:e}),(0,b.jsxs)("div",{className:"flex-1 flex flex-col overflow-hidden",children:[(0,b.jsxs)("header",{className:"bg-white/80 dark:bg-zinc-950 backdrop-blur-sm border-b border-gray-200 dark:border-white/10 px-6 py-4 flex items-center justify-between",children:[(0,b.jsx)(f,{brand:d}),(0,b.jsx)("div",{className:"flex items-center space-x-4",children:(0,b.jsx)(g.UserMenu,{profile:e,brand:d})})]}),(0,b.jsx)("main",{className:"flex-1 overflow-y-auto scrollbar-hide bg-transparent dark:bg-zinc-950 backdrop-blur-sm",children:(0,b.jsxs)("div",{className:"min-h-full bg-white/60 dark:bg-transparent backdrop-blur-sm dark:backdrop-blur-none",children:[!o&&"completed"!==p&&(0,b.jsx)("div",{className:"px-6 pt-6",children:(0,b.jsx)(m.KYCAlert,{status:p})}),a]})})]})]})})}a.s(["AppLayout",()=>n],743513)},468343,a=>{"use strict";let b=`
  id,
  name,
  type,
  file_key,
  file_size_bytes,
  mime_type,
  created_at,
  watermark,
  vehicle_id,
  deal_id,
  owner_investor_id,
  folder_id,
  created_by_profile:created_by(display_name, email),
  investors:owner_investor_id(id, legal_name),
  vehicles:vehicle_id(id, name, type, investment_name, logo_url),
  deals:deal_id(id, name, status),
  folder:document_folders(id, name, path, folder_type)
`;async function c(a,c){if(!c.length)return{documents:[],vehicles:[],folders:[]};let d=new Map,{data:e}=await a.from("subscriptions").select("vehicle_id, vehicles!inner(id, name, type, investment_name, logo_url)").in("investor_id",c).in("status",["active","committed","funded","partially_funded"]),f=Array.from(new Map((e??[]).map(a=>a.vehicles).filter(Boolean).map(a=>[a.id,a])).values()),g=a=>{a&&a.forEach(a=>{let b=a.name??a.file_key?.split("/").pop()??"Document",c={};a.investors&&(c.investor=a.investors),a.vehicles&&(c.vehicle={id:a.vehicles.id,name:a.vehicles.name,type:a.vehicles.type,investment_name:a.vehicles.investment_name??void 0,logo_url:a.vehicles.logo_url??void 0}),a.deals&&(c.deal={id:a.deals.id,name:a.deals.name,status:a.deals.status??void 0}),d.set(a.id,{id:a.id,name:b,type:a.type,file_name:b,file_key:a.file_key,file_size_bytes:a.file_size_bytes??void 0,mime_type:a.mime_type??void 0,created_at:a.created_at,created_by:a.created_by_profile??void 0,scope:c,watermark:a.watermark,folder:a.folder??void 0})})},{data:h,error:i}=await a.from("documents").select(b).in("owner_investor_id",c).eq("is_published",!0).order("created_at",{ascending:!1});i&&console.error("[Documents] Owner documents query error:",i.message),g(h);let j=f.map(a=>a.id).filter(Boolean);if(j.length>0){let{data:c,error:d}=await a.from("documents").select(b).in("vehicle_id",j).eq("is_published",!0).order("created_at",{ascending:!1});d&&console.error("[Documents] Vehicle documents query error:",d.message),g(c)}let{data:k}=await a.from("document_folders").select("*").order("path",{ascending:!0});return{documents:Array.from(d.values()),vehicles:f,folders:k??[]}}a.s(["loadInvestorDocuments",()=>c])},196463,a=>{"use strict";a.s(["ReportsPageClient",()=>b]);let b=(0,a.i(578644).registerClientReference)(function(){throw Error("Attempted to call ReportsPageClient() from the server but ReportsPageClient is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/versotech-portal/src/components/reports/reports-page-client.tsx <module evaluation>","ReportsPageClient")},53088,a=>{"use strict";a.s(["ReportsPageClient",()=>b]);let b=(0,a.i(578644).registerClientReference)(function(){throw Error("Attempted to call ReportsPageClient() from the server but ReportsPageClient is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/versotech-portal/src/components/reports/reports-page-client.tsx","ReportsPageClient")},769865,a=>{"use strict";a.i(196463);var b=a.i(53088);a.n(b)},23854,a=>{"use strict";var b=a.i(714898);a.i(937413);var c=a.i(131360),d=a.i(743513),e=a.i(769865),f=a.i(243085),g=a.i(468343),h=a.i(198307);async function i({searchParams:a}){let i=await a,j=i?.view==="documents"?"documents":"requests",k=await (0,f.getProfile)();k||(0,c.redirect)("/login");let l=(0,h.createServiceClient)(),{data:m}=await l.from("investor_users").select("investor_id").eq("user_id",k.id),n=m?.map(a=>a.investor_id)??[],[o,p]=await Promise.all([n.length>0?l.from("request_tickets").select(`
            *,
            investor:investors(id, legal_name),
            created_by_profile:profiles!request_tickets_created_by_fkey(id, display_name, email),
            assigned_to_profile:profiles!request_tickets_assigned_to_fkey(id, display_name, email),
            result_doc:documents(id, file_key, type, created_at)
          `).in("investor_id",n).order("created_at",{ascending:!1}).limit(100):Promise.resolve({data:[],error:null}),(0,g.loadInvestorDocuments)(l,n)]),q=o.data||[];return(0,b.jsx)(d.AppLayout,{brand:"versoholdings",children:(0,b.jsx)(e.ReportsPageClient,{initialRequests:q,initialDocuments:p.documents,folders:p.folders,vehicles:p.vehicles,initialView:j})})}a.s(["default",()=>i,"dynamic",0,"force-dynamic"])},361481,a=>{a.v(a=>Promise.resolve().then(()=>a(389018)))}];

//# sourceMappingURL=%5Broot-of-the-server%5D__8bba5fd9._.js.map