module.exports=[849853,a=>{"use strict";var b=a.i(352584),c=a.i(611038),d=a.i(289633),e=a.i(15788),f=a.i(181608),g=a.i(278541),h=a.i(478870),i=a.i(799373),j=a.i(324647),k=a.i(390354),l=a.i(284169),m=a.i(421908),n=a.i(663475),o=a.i(951870),p=a.i(771088),q=a.i(155508),r=a.i(816854),s=a.i(487068),t=a.i(399580),u=a.i(966494),v=a.i(877918),w=a.i(13542),x=a.i(3321),y=a.i(455966),z=a.i(888987),A=a.i(201986),B=a.i(58834);let C={committed:"bg-blue-100 text-blue-800 border-blue-200",partially_funded:"bg-amber-100 text-amber-800 border-amber-200",funded:"bg-emerald-100 text-emerald-800 border-emerald-200",active:"bg-green-100 text-green-800 border-green-200"},D={committed:"Awaiting Funding",partially_funded:"Partial",funded:"Fully Funded",active:"Active"},E={accrued:"bg-blue-100 text-blue-800 border-blue-200 dark:bg-blue-900/30 dark:text-blue-300 dark:border-blue-700",invoiced:"bg-amber-100 text-amber-800 border-amber-200 dark:bg-amber-900/30 dark:text-amber-300 dark:border-amber-700",paid:"bg-emerald-100 text-emerald-800 border-emerald-200 dark:bg-emerald-900/30 dark:text-emerald-300 dark:border-emerald-700",waived:"bg-gray-100 text-gray-800 border-gray-200 dark:bg-gray-800/50 dark:text-gray-300 dark:border-gray-700",cancelled:"bg-gray-100 text-gray-800 border-gray-200 dark:bg-gray-800/50 dark:text-gray-300 dark:border-gray-700",disputed:"bg-red-100 text-red-800 border-red-200 dark:bg-red-900/30 dark:text-red-300 dark:border-red-700"},F={mgmt:"Management Fee",perf:"Performance Fee",carry:"Carried Interest",upfront:"Upfront Fee",placement:"Placement Fee",transaction:"Transaction Fee",admin:"Admin Fee"};function G({deals:a}){let[d,h]=(0,c.useState)(!0),[i,j]=(0,c.useState)(null),[k,G]=(0,c.useState)([]),[H,I]=(0,c.useState)([]),[J,K]=(0,c.useState)(""),[L,M]=(0,c.useState)("all"),[N,O]=(0,c.useState)("subscriptions");(0,c.useEffect)(()=>{!async function(){if(0===a.length)return h(!1);try{h(!0),j(null);let b=(0,B.createClient)(),c=a.map(a=>a.id),{data:d,error:e}=await b.from("subscriptions").select(`
            id,
            deal_id,
            investor_id,
            status,
            commitment,
            currency,
            funded_amount,
            outstanding_amount,
            committed_at,
            funded_at,
            investors (id, legal_name, display_name)
          `).in("deal_id",c).in("status",["committed","partially_funded","funded","active"]).order("committed_at",{ascending:!1});if(e)throw e;let{data:f,error:g}=await b.from("fee_events").select(`
            id,
            deal_id,
            investor_id,
            fee_type,
            rate_bps,
            base_amount,
            computed_amount,
            currency,
            status,
            processed_at,
            event_date,
            created_at,
            invoice_id,
            investors (id, legal_name, display_name),
            invoices:invoice_id (invoice_number, status)
          `).in("deal_id",c).order("created_at",{ascending:!1});if(g)throw g;let i=(d||[]).map(b=>{let c=Array.isArray(b.investors)?b.investors[0]:b.investors,d=a.find(a=>a.id===b.deal_id);return{id:b.id,deal_id:b.deal_id,deal_name:d?.name||"Unknown Deal",investor_id:b.investor_id,investor_name:c?.display_name||c?.legal_name||"Unknown Investor",status:b.status,commitment:b.commitment||0,currency:b.currency||"USD",funded_amount:b.funded_amount||0,outstanding_amount:b.outstanding_amount||0,committed_at:b.committed_at,funded_at:b.funded_at}}),k=(f||[]).map(b=>{let c=Array.isArray(b.investors)?b.investors[0]:b.investors,d=Array.isArray(b.invoices)?b.invoices[0]:b.invoices,e=a.find(a=>a.id===b.deal_id);return{id:b.id,deal_id:b.deal_id,deal_name:e?.name||"Unknown Deal",investor_id:b.investor_id,investor_name:c?.display_name||c?.legal_name||"Unknown Investor",fee_type:b.fee_type,rate_bps:b.rate_bps,base_amount:b.base_amount,computed_amount:b.computed_amount,currency:b.currency||"USD",status:b.status,processed_at:b.processed_at,event_date:b.event_date,created_at:b.created_at,invoice_number:d?.invoice_number||null,invoice_status:d?.status||null}});G(i),I(k)}catch(a){console.error("[OverviewTab] Error fetching data:",a),j(a instanceof Error?a.message:"Failed to load data")}finally{h(!1)}}()},[a]);let P=(0,c.useMemo)(()=>{let b=k.reduce((a,b)=>a+b.commitment,0),c=k.reduce((a,b)=>a+b.funded_amount,0),d=k.reduce((a,b)=>a+b.outstanding_amount,0),e=k.filter(a=>"committed"===a.status).length,f=k.filter(a=>"partially_funded"===a.status).length,g=k.filter(a=>"funded"===a.status||"active"===a.status).length,h=H.reduce((a,b)=>a+(b.computed_amount||0),0),i=H.filter(a=>"paid"===a.status),j=i.reduce((a,b)=>a+(b.computed_amount||0),0),l=H.filter(a=>"accrued"===a.status||"invoiced"===a.status),m=l.reduce((a,b)=>a+(b.computed_amount||0),0);return{totalDeals:a.length,totalSubscriptions:k.length,totalCommitment:b,totalFunded:c,totalOutstanding:d,awaitingFunding:e,partiallyFunded:f,fullyFunded:g,totalFeeEvents:H.length,totalFeesAccrued:h,totalFeesPaid:j,totalFeesPending:m,feesPaidCount:i.length,feesPendingCount:l.length}},[a,k,H]),Q=(0,c.useMemo)(()=>k.filter(a=>{let b="all"===L||a.deal_id===L,c=!J||a.investor_name.toLowerCase().includes(J.toLowerCase())||a.deal_name.toLowerCase().includes(J.toLowerCase());return b&&c}),[k,L,J]),R=(0,c.useMemo)(()=>H.filter(a=>{let b="all"===L||a.deal_id===L,c=!J||a.investor_name.toLowerCase().includes(J.toLowerCase())||a.deal_name.toLowerCase().includes(J.toLowerCase());return b&&c}),[H,L,J]),S=(0,c.useMemo)(()=>a.map(a=>{let b=k.filter(b=>b.deal_id===a.id),c=H.filter(b=>b.deal_id===a.id),d=b.reduce((a,b)=>a+b.commitment,0),e=b.reduce((a,b)=>a+b.funded_amount,0),f=c.reduce((a,b)=>a+(b.computed_amount||0),0),g=c.filter(a=>"paid"===a.status).reduce((a,b)=>a+(b.computed_amount||0),0);return{...a,subscription_count:b.length,total_commitment:d,total_funded:e,funding_percentage:d>0?Math.round(e/d*100):0,total_fees:f,paid_fees:g,fee_count:c.length}}),[a,k,H]);return d?(0,b.jsxs)("div",{className:"flex items-center justify-center py-16",children:[(0,b.jsx)(x.Loader2,{className:"h-8 w-8 animate-spin text-muted-foreground"}),(0,b.jsx)("span",{className:"ml-3 text-muted-foreground",children:"Loading overview data..."})]}):i?(0,b.jsx)(l.Card,{className:"border-destructive",children:(0,b.jsx)(l.CardContent,{className:"py-8",children:(0,b.jsxs)("div",{className:"flex flex-col items-center gap-4",children:[(0,b.jsx)(v.AlertCircle,{className:"h-12 w-12 text-destructive"}),(0,b.jsx)("p",{className:"text-destructive",children:i}),(0,b.jsxs)(m.Button,{variant:"outline",onClick:()=>window.location.reload(),children:[(0,b.jsx)(y.RefreshCcw,{className:"h-4 w-4 mr-2"}),"Retry"]})]})})}):(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,b.jsxs)(l.Card,{children:[(0,b.jsx)(l.CardHeader,{className:"pb-2",children:(0,b.jsxs)(l.CardTitle,{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[(0,b.jsx)(g.Building2,{className:"h-4 w-4"}),"Managed Deals"]})}),(0,b.jsxs)(l.CardContent,{children:[(0,b.jsx)("div",{className:"text-2xl font-bold",children:P.totalDeals}),(0,b.jsxs)("p",{className:"text-xs text-muted-foreground mt-1",children:[P.totalSubscriptions," subscriptions"]})]})]}),(0,b.jsxs)(l.Card,{children:[(0,b.jsx)(l.CardHeader,{className:"pb-2",children:(0,b.jsxs)(l.CardTitle,{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[(0,b.jsx)(q.DollarSign,{className:"h-4 w-4"}),"Total Commitment"]})}),(0,b.jsxs)(l.CardContent,{children:[(0,b.jsx)("div",{className:"text-2xl font-bold text-primary",children:(0,A.formatCurrency)(P.totalCommitment,"USD")}),(0,b.jsxs)("p",{className:"text-xs text-muted-foreground mt-1",children:[(0,A.formatCurrency)(P.totalFunded,"USD")," funded"]})]})]}),(0,b.jsxs)(l.Card,{children:[(0,b.jsx)(l.CardHeader,{className:"pb-2",children:(0,b.jsxs)(l.CardTitle,{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[(0,b.jsx)(t.CheckCircle2,{className:"h-4 w-4"}),"Funding Status"]})}),(0,b.jsxs)(l.CardContent,{children:[(0,b.jsx)("div",{className:"text-2xl font-bold text-emerald-600",children:P.fullyFunded}),(0,b.jsxs)("p",{className:"text-xs text-muted-foreground mt-1",children:[P.awaitingFunding," awaiting • ",P.partiallyFunded," partial • ",P.fullyFunded," fully funded"]})]})]}),(0,b.jsxs)(l.Card,{children:[(0,b.jsx)(l.CardHeader,{className:"pb-2",children:(0,b.jsxs)(l.CardTitle,{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[(0,b.jsx)(w.CreditCard,{className:"h-4 w-4"}),"Fee Events"]})}),(0,b.jsxs)(l.CardContent,{children:[(0,b.jsx)("div",{className:"text-2xl font-bold",children:P.totalFeeEvents}),(0,b.jsxs)("p",{className:"text-xs text-muted-foreground mt-1",children:[(0,A.formatCurrency)(P.totalFeesPaid,"USD")," paid"]})]})]})]}),(0,b.jsx)(l.Card,{children:(0,b.jsx)(l.CardContent,{className:"pt-4",children:(0,b.jsxs)("div",{className:"flex flex-col md:flex-row gap-4",children:[(0,b.jsxs)("div",{className:"relative flex-1",children:[(0,b.jsx)(s.Search,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),(0,b.jsx)(n.Input,{placeholder:"Search investors or deals...",value:J,onChange:a=>K(a.target.value),className:"pl-10"})]}),(0,b.jsxs)(o.Select,{value:L,onValueChange:M,children:[(0,b.jsx)(o.SelectTrigger,{className:"w-full md:w-[250px]",children:(0,b.jsx)(o.SelectValue,{placeholder:"All Deals"})}),(0,b.jsxs)(o.SelectContent,{children:[(0,b.jsx)(o.SelectItem,{value:"all",children:"All Deals"}),a.map(a=>(0,b.jsx)(o.SelectItem,{value:a.id,children:a.name},a.id))]})]})]})})}),(0,b.jsxs)(f.Tabs,{value:N,onValueChange:O,children:[(0,b.jsxs)(f.TabsList,{children:[(0,b.jsxs)(f.TabsTrigger,{value:"subscriptions",className:"flex items-center gap-2",children:[(0,b.jsx)(r.FileText,{className:"h-4 w-4"}),"Subscriptions (",Q.length,")"]}),(0,b.jsxs)(f.TabsTrigger,{value:"fees",className:"flex items-center gap-2",children:[(0,b.jsx)(q.DollarSign,{className:"h-4 w-4"}),"Fee Events (",R.length,")"]}),(0,b.jsxs)(f.TabsTrigger,{value:"summary",className:"flex items-center gap-2",children:[(0,b.jsx)(u.TrendingUp,{className:"h-4 w-4"}),"Deal Summary"]})]}),(0,b.jsx)(f.TabsContent,{value:"subscriptions",children:(0,b.jsxs)(l.Card,{children:[(0,b.jsxs)(l.CardHeader,{className:"pb-4",children:[(0,b.jsx)(l.CardTitle,{className:"text-lg",children:"Subscriptions"}),(0,b.jsxs)(l.CardDescription,{children:[Q.length," active subscriptions"]})]}),(0,b.jsx)(l.CardContent,{children:(0,b.jsx)("div",{className:"overflow-x-auto",children:(0,b.jsxs)(p.Table,{children:[(0,b.jsx)(p.TableHeader,{children:(0,b.jsxs)(p.TableRow,{children:[(0,b.jsx)(p.TableHead,{children:"Investor"}),(0,b.jsx)(p.TableHead,{children:"Deal"}),(0,b.jsx)(p.TableHead,{className:"text-right",children:"Commitment"}),(0,b.jsx)(p.TableHead,{className:"text-right",children:"Funded"}),(0,b.jsx)(p.TableHead,{className:"text-right",children:"Outstanding"}),(0,b.jsx)(p.TableHead,{children:"Status"}),(0,b.jsx)(p.TableHead,{children:"Funded Date"})]})}),(0,b.jsx)(p.TableBody,{children:0===Q.length?(0,b.jsx)(p.TableRow,{children:(0,b.jsx)(p.TableCell,{colSpan:7,className:"text-center py-8 text-muted-foreground",children:"No subscriptions found"})}):Q.map(a=>(0,b.jsxs)(p.TableRow,{children:[(0,b.jsx)(p.TableCell,{className:"font-medium",children:a.investor_name}),(0,b.jsx)(p.TableCell,{children:a.deal_name}),(0,b.jsx)(p.TableCell,{className:"text-right",children:(0,A.formatCurrency)(a.commitment,a.currency)}),(0,b.jsx)(p.TableCell,{className:"text-right",children:(0,A.formatCurrency)(a.funded_amount,a.currency)}),(0,b.jsx)(p.TableCell,{className:"text-right",children:(0,A.formatCurrency)(a.outstanding_amount,a.currency)}),(0,b.jsx)(p.TableCell,{children:(0,b.jsx)(e.Badge,{variant:"outline",className:(0,z.cn)("text-xs",C[a.status]),children:D[a.status]||a.status})}),(0,b.jsx)(p.TableCell,{children:a.funded_at?(0,b.jsx)("span",{className:"text-sm",children:(0,A.formatDate)(a.funded_at)}):(0,b.jsx)("span",{className:"text-muted-foreground text-xs",children:"Pending"})})]},a.id))})]})})})]})}),(0,b.jsx)(f.TabsContent,{value:"fees",children:(0,b.jsxs)(l.Card,{children:[(0,b.jsxs)(l.CardHeader,{className:"pb-4",children:[(0,b.jsx)(l.CardTitle,{className:"text-lg",children:"Fee Events"}),(0,b.jsxs)(l.CardDescription,{children:[R.length," fee events"]})]}),(0,b.jsx)(l.CardContent,{children:(0,b.jsx)("div",{className:"overflow-x-auto",children:(0,b.jsxs)(p.Table,{children:[(0,b.jsx)(p.TableHeader,{children:(0,b.jsxs)(p.TableRow,{children:[(0,b.jsx)(p.TableHead,{children:"Deal"}),(0,b.jsx)(p.TableHead,{children:"Investor"}),(0,b.jsx)(p.TableHead,{children:"Fee Type"}),(0,b.jsx)(p.TableHead,{className:"text-right",children:"Amount"}),(0,b.jsx)(p.TableHead,{children:"Invoice"}),(0,b.jsx)(p.TableHead,{children:"Status"}),(0,b.jsx)(p.TableHead,{children:"Event Date"})]})}),(0,b.jsx)(p.TableBody,{children:0===R.length?(0,b.jsx)(p.TableRow,{children:(0,b.jsx)(p.TableCell,{colSpan:7,className:"text-center py-8 text-muted-foreground",children:"No fee events found"})}):R.map(a=>(0,b.jsxs)(p.TableRow,{children:[(0,b.jsx)(p.TableCell,{className:"font-medium",children:a.deal_name}),(0,b.jsx)(p.TableCell,{children:a.investor_name}),(0,b.jsx)(p.TableCell,{children:(0,b.jsx)(e.Badge,{variant:"outline",children:F[a.fee_type||""]||a.fee_type||"Unknown"})}),(0,b.jsx)(p.TableCell,{className:"text-right font-medium",children:(0,A.formatCurrency)(a.computed_amount||0,a.currency)}),(0,b.jsx)(p.TableCell,{children:a.invoice_number?(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-sm font-medium",children:a.invoice_number}),a.invoice_status&&(0,b.jsx)("div",{className:"text-xs text-muted-foreground capitalize",children:a.invoice_status.replace("_"," ")})]}):(0,b.jsx)("span",{className:"text-muted-foreground text-xs",children:"Not issued"})}),(0,b.jsx)(p.TableCell,{children:(0,b.jsx)(e.Badge,{variant:"outline",className:(0,z.cn)("text-xs capitalize",E[a.status]),children:a.status})}),(0,b.jsx)(p.TableCell,{children:a.event_date?(0,b.jsx)("span",{className:"text-sm",children:(0,A.formatDate)(a.event_date)}):(0,b.jsx)("span",{className:"text-muted-foreground text-xs",children:"-"})})]},a.id))})]})})})]})}),(0,b.jsx)(f.TabsContent,{value:"summary",children:(0,b.jsxs)(l.Card,{children:[(0,b.jsxs)(l.CardHeader,{className:"pb-4",children:[(0,b.jsx)(l.CardTitle,{className:"text-lg",children:"Deal Summary"}),(0,b.jsx)(l.CardDescription,{children:"Aggregated metrics by deal"})]}),(0,b.jsx)(l.CardContent,{children:(0,b.jsx)("div",{className:"overflow-x-auto",children:(0,b.jsxs)(p.Table,{children:[(0,b.jsx)(p.TableHeader,{children:(0,b.jsxs)(p.TableRow,{children:[(0,b.jsx)(p.TableHead,{children:"Deal"}),(0,b.jsx)(p.TableHead,{children:"Company"}),(0,b.jsx)(p.TableHead,{className:"text-right",children:"Subscriptions"}),(0,b.jsx)(p.TableHead,{className:"text-right",children:"Commitment"}),(0,b.jsx)(p.TableHead,{className:"text-right",children:"Funded"}),(0,b.jsx)(p.TableHead,{className:"text-right",children:"Funding %"}),(0,b.jsx)(p.TableHead,{className:"text-right",children:"Total Fees"})]})}),(0,b.jsx)(p.TableBody,{children:0===S.length?(0,b.jsx)(p.TableRow,{children:(0,b.jsx)(p.TableCell,{colSpan:7,className:"text-center py-8 text-muted-foreground",children:"No deals found"})}):S.map(a=>(0,b.jsxs)(p.TableRow,{children:[(0,b.jsx)(p.TableCell,{className:"font-medium",children:a.name}),(0,b.jsx)(p.TableCell,{children:a.company_name||"-"}),(0,b.jsx)(p.TableCell,{className:"text-right",children:a.subscription_count}),(0,b.jsx)(p.TableCell,{className:"text-right",children:(0,A.formatCurrency)(a.total_commitment,a.currency)}),(0,b.jsx)(p.TableCell,{className:"text-right",children:(0,A.formatCurrency)(a.total_funded,a.currency)}),(0,b.jsx)(p.TableCell,{className:"text-right",children:(0,b.jsxs)(e.Badge,{variant:"outline",className:(0,z.cn)("text-xs",a.funding_percentage>=100?"bg-emerald-100 text-emerald-800":a.funding_percentage>=50?"bg-amber-100 text-amber-800":"bg-gray-100 text-gray-800"),children:[a.funding_percentage,"%"]})}),(0,b.jsx)(p.TableCell,{className:"text-right",children:(0,A.formatCurrency)(a.total_fees,a.currency)})]},a.id))})]})})})]})})]})]})}var H=a.i(249464),I=a.i(425622),J=a.i(166457),K=a.i(577955),L=a.i(672606),M=a.i(439467),N=a.i(441278),O=a.i(924089),P=a.i(899750);let Q={introducer:"introducer",partner:"partner",commercial_partner:"commercial-partner"},R={accrued:"bg-blue-100 text-blue-800",invoice_requested:"bg-yellow-100 text-yellow-800",invoice_submitted:"bg-indigo-100 text-indigo-800",invoiced:"bg-orange-100 text-orange-800",paid:"bg-green-100 text-green-800",cancelled:"bg-red-100 text-red-800",rejected:"bg-red-100 text-red-800"},S="__all__";function T({type:a,entities:d,deals:f,apiEndpoint:g,entityLabel:h,entityPlural:i}){let[j,k]=(0,c.useState)(!1),[q,r]=(0,c.useState)(!1),[s,t]=(0,c.useState)(null),[u,w]=(0,c.useState)([]),[B,C]=(0,c.useState)(null),[D,E]=(0,c.useState)(0),[F,G]=(0,c.useState)(""),[T,U]=(0,c.useState)(""),[V,W]=(0,c.useState)(""),[X,Y]=(0,c.useState)(""),[Z,$]=(0,c.useState)(""),[_,aa]=(0,c.useState)(1),ab=Math.ceil(D/50),ac=[F,T,V,X,Z].filter(Boolean).length,[ad,ae]=(0,c.useState)(!1),[af,ag]=(0,c.useState)(null),[ah,ai]=(0,c.useState)(null),aj=(0,c.useCallback)(async(b=!1)=>{k(!0),t(null),b&&aa(1);try{let c=new URLSearchParams;F&&c.append("from_date",F),T&&c.append("to_date",T),V&&c.append("introducer"===a?"introducer_id":"partner"===a?"partner_id":"commercial_partner_id",V),X&&c.append("deal_id",X),Z&&c.append("status",Z),c.append("limit",String(50)),c.append("offset",String((b?0:_-1)*50));let d=await fetch(`${g}?${c.toString()}`);if(!d.ok){let a=await d.json();throw Error(a.error||"Failed to fetch report")}let e=await d.json(),f=(e.data||[]).map(b=>({...b,entity_id:b[`${a}_id`]||b.entity_id,entity_name:b[`${a}_name`]||b.entity_name||b.introducer_name||b.partner_name||b.commercial_partner_name,entity_email:b[`${a}_email`]||b.entity_email||b.introducer_email||b.partner_email||b.commercial_partner_email}));w(f),C(e.summary||null),E(e.pagination?.total||e.data?.length||0)}catch(b){console.error(`[CommissionTab:${a}] Error:`,b),t(b instanceof Error?b.message:"Failed to fetch report")}finally{k(!1)}},[g,a,F,T,V,X,Z,_]),ak=async()=>{r(!0);try{let b=new URLSearchParams;F&&b.append("from_date",F),T&&b.append("to_date",T),V&&b.append("introducer"===a?"introducer_id":"partner"===a?"partner_id":"commercial_partner_id",V),X&&b.append("deal_id",X),Z&&b.append("status",Z),b.append("format","csv");let c=document.createElement("a");c.href=`${g}?${b.toString()}`,c.download=`${a}_reconciliation_${new Date().toISOString().split("T")[0]}.csv`,document.body.appendChild(c),c.click(),document.body.removeChild(c)}finally{setTimeout(()=>r(!1),1e3)}},al=()=>{G(""),U(""),W(""),Y(""),$(""),aa(1)},am=async b=>{if(!ah){ai(b.id);try{let c=await fetch(`/api/staff/fees/commissions/${b.id}/mark-paid`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({entity_type:a})});if(!c.ok){let a=await c.json();throw Error(a.error||"Failed to mark commission as paid")}P.toast.success("Commission marked as paid"),aj(!1)}catch(a){console.error("[CommissionTab] Error marking paid:",a),P.toast.error(a instanceof Error?a.message:"Failed to mark commission as paid")}finally{ai(null)}}},an=!F||!T||new Date(F)<=new Date(T);return(0,c.useEffect)(()=>{aj(!0)},[]),(0,c.useEffect)(()=>{_>1&&aj(!1)},[_]),(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)(l.Card,{children:[(0,b.jsx)(l.CardHeader,{className:"pb-4",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsxs)(l.CardTitle,{className:"text-lg flex items-center gap-2",children:[(0,b.jsx)(J.Filter,{className:"h-5 w-5"}),"Filters"]}),ac>0&&(0,b.jsxs)(e.Badge,{variant:"secondary",className:"text-xs",children:[ac," active"]})]}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)(m.Button,{variant:"outline",size:"sm",onClick:al,disabled:0===ac,children:"Clear"}),(0,b.jsxs)(m.Button,{size:"sm",onClick:()=>aj(!0),disabled:j||!an,children:[j?(0,b.jsx)(x.Loader2,{className:"h-4 w-4 animate-spin"}):(0,b.jsx)(y.RefreshCcw,{className:"h-4 w-4"}),(0,b.jsx)("span",{className:"ml-2",children:"Apply"})]})]})]})}),(0,b.jsx)(l.CardContent,{children:(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(H.Label,{children:"From Date"}),(0,b.jsx)(n.Input,{type:"date",value:F,onChange:a=>G(a.target.value),max:T||void 0})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(H.Label,{children:"To Date"}),(0,b.jsx)(n.Input,{type:"date",value:T,onChange:a=>U(a.target.value),min:F||void 0}),!an&&(0,b.jsx)("p",{className:"text-xs text-destructive",children:"End date must be after start date"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(H.Label,{children:h}),(0,b.jsxs)(o.Select,{value:V||S,onValueChange:a=>W(a===S?"":a),children:[(0,b.jsx)(o.SelectTrigger,{children:(0,b.jsx)(o.SelectValue,{placeholder:`All ${i.toLowerCase()}`})}),(0,b.jsxs)(o.SelectContent,{children:[(0,b.jsxs)(o.SelectItem,{value:S,children:["All ",i.toLowerCase()]}),d.map(a=>(0,b.jsx)(o.SelectItem,{value:a.id,children:a.name},a.id))]})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(H.Label,{children:"Deal"}),(0,b.jsxs)(o.Select,{value:X||S,onValueChange:a=>Y(a===S?"":a),children:[(0,b.jsx)(o.SelectTrigger,{children:(0,b.jsx)(o.SelectValue,{placeholder:"All deals"})}),(0,b.jsxs)(o.SelectContent,{children:[(0,b.jsx)(o.SelectItem,{value:S,children:"All deals"}),f.map(a=>(0,b.jsx)(o.SelectItem,{value:a.id,children:a.name},a.id))]})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(H.Label,{children:"Status"}),(0,b.jsxs)(o.Select,{value:Z||S,onValueChange:a=>$(a===S?"":a),children:[(0,b.jsx)(o.SelectTrigger,{children:(0,b.jsx)(o.SelectValue,{placeholder:"All statuses"})}),(0,b.jsxs)(o.SelectContent,{children:[(0,b.jsx)(o.SelectItem,{value:S,children:"All statuses"}),(0,b.jsx)(o.SelectItem,{value:"accrued",children:"Accrued"}),(0,b.jsx)(o.SelectItem,{value:"invoice_requested",children:"Invoice Requested"}),(0,b.jsx)(o.SelectItem,{value:"invoice_submitted",children:"Invoice Submitted"}),(0,b.jsx)(o.SelectItem,{value:"invoiced",children:"Invoiced"}),(0,b.jsx)(o.SelectItem,{value:"paid",children:"Paid"}),(0,b.jsx)(o.SelectItem,{value:"cancelled",children:"Cancelled"}),(0,b.jsx)(o.SelectItem,{value:"rejected",children:"Rejected"})]})]})]})]})})]}),B&&(0,b.jsxs)(l.Card,{children:[(0,b.jsx)(l.CardHeader,{className:"pb-4",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)(l.CardTitle,{className:"text-lg",children:"Summary"}),(0,b.jsxs)(m.Button,{variant:"outline",size:"sm",onClick:ak,disabled:q||0===u.length,children:[q?(0,b.jsx)(x.Loader2,{className:"h-4 w-4 mr-2 animate-spin"}):(0,b.jsx)(I.Download,{className:"h-4 w-4 mr-2"}),"Export CSV"]})]})}),(0,b.jsx)(l.CardContent,{children:(0,b.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-9 gap-4",children:[(0,b.jsxs)("div",{className:"text-center p-3 rounded-lg bg-muted/50",children:[(0,b.jsx)("div",{className:"text-2xl font-bold",children:B.total_count}),(0,b.jsx)("div",{className:"text-xs text-muted-foreground",children:"Total Records"})]}),(0,b.jsxs)("div",{className:"text-center p-3 rounded-lg bg-muted/50",children:[(0,b.jsx)("div",{className:"text-2xl font-bold text-primary",children:(0,A.formatCurrency)(B.total_amount,B.currency)}),(0,b.jsx)("div",{className:"text-xs text-muted-foreground",children:"Total Amount"})]}),(0,b.jsxs)("div",{className:"text-center p-3 rounded-lg bg-blue-50",children:[(0,b.jsx)("div",{className:"text-2xl font-bold text-blue-600",children:(0,A.formatCurrency)(B.by_status.accrued.amount,B.currency)}),(0,b.jsxs)("div",{className:"text-xs text-muted-foreground",children:["Accrued (",B.by_status.accrued.count,")"]})]}),(0,b.jsxs)("div",{className:"text-center p-3 rounded-lg bg-yellow-50",children:[(0,b.jsx)("div",{className:"text-2xl font-bold text-yellow-600",children:(0,A.formatCurrency)(B.by_status.invoice_requested.amount,B.currency)}),(0,b.jsxs)("div",{className:"text-xs text-muted-foreground",children:["Invoice Req. (",B.by_status.invoice_requested.count,")"]})]}),(0,b.jsxs)("div",{className:"text-center p-3 rounded-lg bg-indigo-50",children:[(0,b.jsx)("div",{className:"text-2xl font-bold text-indigo-600",children:(0,A.formatCurrency)(B.by_status.invoice_submitted.amount,B.currency)}),(0,b.jsxs)("div",{className:"text-xs text-muted-foreground",children:["Invoice Submitted (",B.by_status.invoice_submitted.count,")"]})]}),(0,b.jsxs)("div",{className:"text-center p-3 rounded-lg bg-orange-50",children:[(0,b.jsx)("div",{className:"text-2xl font-bold text-orange-600",children:(0,A.formatCurrency)(B.by_status.invoiced.amount,B.currency)}),(0,b.jsxs)("div",{className:"text-xs text-muted-foreground",children:["Invoiced (",B.by_status.invoiced.count,")"]})]}),(0,b.jsxs)("div",{className:"text-center p-3 rounded-lg bg-green-50",children:[(0,b.jsx)("div",{className:"text-2xl font-bold text-green-600",children:(0,A.formatCurrency)(B.by_status.paid.amount,B.currency)}),(0,b.jsxs)("div",{className:"text-xs text-muted-foreground",children:["Paid (",B.by_status.paid.count,")"]})]}),(0,b.jsxs)("div",{className:"text-center p-3 rounded-lg bg-red-50",children:[(0,b.jsx)("div",{className:"text-2xl font-bold text-red-600",children:(0,A.formatCurrency)(B.by_status.cancelled.amount,B.currency)}),(0,b.jsxs)("div",{className:"text-xs text-muted-foreground",children:["Cancelled (",B.by_status.cancelled.count,")"]})]}),(0,b.jsxs)("div",{className:"text-center p-3 rounded-lg bg-rose-50",children:[(0,b.jsx)("div",{className:"text-2xl font-bold text-rose-600",children:(0,A.formatCurrency)(B.by_status.rejected.amount,B.currency)}),(0,b.jsxs)("div",{className:"text-xs text-muted-foreground",children:["Rejected (",B.by_status.rejected.count,")"]})]})]})})]}),s&&(0,b.jsx)(l.Card,{className:"border-destructive",children:(0,b.jsx)(l.CardContent,{className:"py-6",children:(0,b.jsxs)("div",{className:"flex flex-col items-center gap-4",children:[(0,b.jsx)(v.AlertCircle,{className:"h-12 w-12 text-destructive"}),(0,b.jsx)("p",{className:"text-destructive text-sm",children:s}),(0,b.jsxs)(m.Button,{variant:"outline",onClick:()=>aj(!0),children:[(0,b.jsx)(y.RefreshCcw,{className:"h-4 w-4 mr-2"}),"Retry"]})]})})}),(0,b.jsxs)(l.Card,{children:[(0,b.jsx)(l.CardHeader,{className:"pb-4",children:(0,b.jsx)("div",{className:"flex items-center justify-between",children:(0,b.jsxs)("div",{children:[(0,b.jsx)(l.CardTitle,{className:"text-lg",children:"Commission Details"}),(0,b.jsxs)(l.CardDescription,{children:[u.length," of ",D," records",ab>1&&` (Page ${_} of ${ab})`]})]})})}),(0,b.jsx)(l.CardContent,{children:j?(0,b.jsx)("div",{className:"flex items-center justify-center py-8",children:(0,b.jsx)(x.Loader2,{className:"h-8 w-8 animate-spin text-muted-foreground"})}):0===u.length?(0,b.jsxs)("div",{className:"text-center py-8",children:[(0,b.jsx)("div",{className:"text-muted-foreground mb-2",children:ac>0?"No commissions match your filters. Try adjusting or clearing filters.":`No ${i.toLowerCase()} commissions found yet.`}),ac>0&&(0,b.jsx)(m.Button,{variant:"outline",size:"sm",onClick:al,children:"Clear Filters"})]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("div",{className:"overflow-x-auto",children:(0,b.jsxs)(p.Table,{children:[(0,b.jsx)(p.TableHeader,{children:(0,b.jsxs)(p.TableRow,{children:[(0,b.jsx)(p.TableHead,{children:"Status"}),(0,b.jsx)(p.TableHead,{children:h}),(0,b.jsx)(p.TableHead,{children:"Deal"}),(0,b.jsx)(p.TableHead,{children:"Investor"}),(0,b.jsx)(p.TableHead,{children:"Basis"}),(0,b.jsx)(p.TableHead,{className:"text-right",children:"Rate (%)"}),(0,b.jsx)(p.TableHead,{className:"text-right",children:"Amount"}),(0,b.jsx)(p.TableHead,{children:"Due Date"}),(0,b.jsx)(p.TableHead,{children:"Paid At"}),(0,b.jsx)(p.TableHead,{children:"Created"}),(0,b.jsx)(p.TableHead,{className:"text-right",children:"Actions"})]})}),(0,b.jsx)(p.TableBody,{children:u.map(a=>(0,b.jsxs)(p.TableRow,{children:[(0,b.jsx)(p.TableCell,{children:(0,b.jsx)(e.Badge,{variant:"secondary",className:(0,z.cn)("text-xs capitalize",R[a.status]),children:a.status.replace("_"," ")})}),(0,b.jsx)(p.TableCell,{children:(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"font-medium text-sm",children:a.entity_name}),a.entity_email&&(0,b.jsx)("div",{className:"text-xs text-muted-foreground",children:a.entity_email})]})}),(0,b.jsx)(p.TableCell,{children:(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"font-medium text-sm",children:a.deal_name||"-"}),a.deal_company&&(0,b.jsx)("div",{className:"text-xs text-muted-foreground",children:a.deal_company})]})}),(0,b.jsx)(p.TableCell,{className:"text-sm",children:a.investor_name||"-"}),(0,b.jsx)(p.TableCell,{className:"capitalize text-sm",children:a.basis_type?.replace("_"," ")||"-"}),(0,b.jsxs)(p.TableCell,{className:"text-right text-sm",children:[(a.rate_bps/100).toFixed(2),"%"]}),(0,b.jsx)(p.TableCell,{className:"text-right font-medium",children:(0,A.formatCurrency)(a.accrual_amount,a.currency)}),(0,b.jsx)(p.TableCell,{className:"text-sm",children:a.payment_due_date?(0,A.formatDate)(a.payment_due_date):"-"}),(0,b.jsx)(p.TableCell,{className:"text-sm",children:a.paid_at?(0,A.formatDate)(a.paid_at):"-"}),(0,b.jsx)(p.TableCell,{className:"text-sm text-muted-foreground",children:(0,A.formatDate)(a.created_at)}),(0,b.jsx)(p.TableCell,{className:"text-right",children:(0,b.jsxs)("div",{className:"flex items-center justify-end gap-1",children:["accrued"===a.status&&(0,b.jsx)(m.Button,{variant:"ghost",size:"sm",onClick:()=>{ag(a),ae(!0)},title:"Request Invoice",className:"h-8 w-8 p-0 text-blue-500 hover:text-blue-600 hover:bg-blue-50",children:(0,b.jsx)(M.Mail,{className:"h-4 w-4"})}),"invoiced"===a.status&&(0,b.jsx)(m.Button,{variant:"ghost",size:"sm",onClick:()=>am(a),disabled:ah===a.id,title:"Mark as Paid",className:"h-8 w-8 p-0 text-green-500 hover:text-green-600 hover:bg-green-50",children:ah===a.id?(0,b.jsx)(x.Loader2,{className:"h-4 w-4 animate-spin"}):(0,b.jsx)(N.CheckCircle,{className:"h-4 w-4"})})]})})]},a.id))})]})}),ab>1&&(0,b.jsxs)("div",{className:"flex items-center justify-between mt-4 pt-4 border-t",children:[(0,b.jsxs)("div",{className:"text-sm text-muted-foreground",children:["Showing ",(_-1)*50+1," to ",Math.min(50*_,D)," of ",D]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsxs)(m.Button,{variant:"outline",size:"sm",onClick:()=>aa(a=>Math.max(1,a-1)),disabled:1===_||j,children:[(0,b.jsx)(K.ChevronLeft,{className:"h-4 w-4"}),"Previous"]}),(0,b.jsxs)("div",{className:"flex items-center gap-1 px-2",children:[(0,b.jsx)("span",{className:"text-sm font-medium",children:_}),(0,b.jsxs)("span",{className:"text-sm text-muted-foreground",children:["of ",ab]})]}),(0,b.jsxs)(m.Button,{variant:"outline",size:"sm",onClick:()=>aa(a=>Math.min(ab,a+1)),disabled:_===ab||j,children:["Next",(0,b.jsx)(L.ChevronRight,{className:"h-4 w-4"})]})]})]})]})})]}),(0,b.jsx)(O.RequestInvoiceDialog,{open:ad,onOpenChange:ae,commission:af?{id:af.id,accrual_amount:af.accrual_amount,currency:af.currency,entity_name:af.entity_name,deal:af.deal_name?{name:af.deal_name}:void 0}:null,commissionType:Q[a],onSuccess:()=>{P.toast.success("Invoice request sent"),aj(!1)}})]})}function U({arrangerInfo:a,deals:l,introducers:m,partners:n,commercialPartners:o,tabCounts:p,initialTab:q}){let r=(0,d.useRouter)(),s=(0,d.useSearchParams)(),[t,u]=(0,c.useState)(q);return(0,b.jsxs)("div",{className:"p-6 space-y-6",children:[(0,b.jsxs)("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsxs)("h1",{className:"text-2xl font-bold text-foreground flex items-center gap-2",children:[(0,b.jsx)(j.FileSpreadsheet,{className:"h-6 w-6"}),"Reconciliation"]}),(0,b.jsx)("p",{className:"text-muted-foreground mt-1",children:"View and manage commissions across all your partner relationships"})]}),a&&(0,b.jsx)("div",{className:"flex items-center gap-2",children:(0,b.jsx)(e.Badge,{variant:a.is_active?"default":"secondary",children:a.name})})]}),(0,b.jsxs)(f.Tabs,{value:t,onValueChange:a=>{u(a);let b=new URLSearchParams(s.toString());b.set("tab",a),r.push(`?${b.toString()}`,{scroll:!1})},className:"space-y-6",children:[(0,b.jsxs)(f.TabsList,{className:"grid grid-cols-2 md:grid-cols-4 w-full md:w-auto",children:[(0,b.jsxs)(f.TabsTrigger,{value:"overview",className:"flex items-center gap-2",children:[(0,b.jsx)(k.LayoutDashboard,{className:"h-4 w-4"}),(0,b.jsx)("span",{className:"hidden sm:inline",children:"Overview"}),p.overview>0&&(0,b.jsx)(e.Badge,{variant:"secondary",className:"ml-1 h-5 px-1.5 text-xs",children:p.overview})]}),(0,b.jsxs)(f.TabsTrigger,{value:"introducers",className:"flex items-center gap-2",children:[(0,b.jsx)(i.UserPlus,{className:"h-4 w-4"}),(0,b.jsx)("span",{className:"hidden sm:inline",children:"Introducers"}),p.introducers>0&&(0,b.jsx)(e.Badge,{variant:"secondary",className:"ml-1 h-5 px-1.5 text-xs",children:p.introducers})]}),(0,b.jsxs)(f.TabsTrigger,{value:"partners",className:"flex items-center gap-2",children:[(0,b.jsx)(h.Users,{className:"h-4 w-4"}),(0,b.jsx)("span",{className:"hidden sm:inline",children:"Partners"}),p.partners>0&&(0,b.jsx)(e.Badge,{variant:"secondary",className:"ml-1 h-5 px-1.5 text-xs",children:p.partners})]}),(0,b.jsxs)(f.TabsTrigger,{value:"commercial-partners",className:"flex items-center gap-2",children:[(0,b.jsx)(g.Building2,{className:"h-4 w-4"}),(0,b.jsx)("span",{className:"hidden sm:inline",children:"Commercial"}),p.commercialPartners>0&&(0,b.jsx)(e.Badge,{variant:"secondary",className:"ml-1 h-5 px-1.5 text-xs",children:p.commercialPartners})]})]}),(0,b.jsx)(f.TabsContent,{value:"overview",className:"space-y-6",children:(0,b.jsx)(G,{deals:l})}),(0,b.jsx)(f.TabsContent,{value:"introducers",className:"space-y-6",children:(0,b.jsx)(T,{type:"introducer",entities:m.map(a=>({id:a.id,name:a.legal_name})),deals:l,apiEndpoint:"/api/arrangers/me/reports/introducer-reconciliation",entityLabel:"Introducer",entityPlural:"Introducers"})}),(0,b.jsx)(f.TabsContent,{value:"partners",className:"space-y-6",children:(0,b.jsx)(T,{type:"partner",entities:n.map(a=>({id:a.id,name:a.name||a.legal_name})),deals:l,apiEndpoint:"/api/arrangers/me/reports/partner-reconciliation",entityLabel:"Partner",entityPlural:"Partners"})}),(0,b.jsx)(f.TabsContent,{value:"commercial-partners",className:"space-y-6",children:(0,b.jsx)(T,{type:"commercial_partner",entities:o.map(a=>({id:a.id,name:a.name||a.legal_name})),deals:l,apiEndpoint:"/api/arrangers/me/reports/commercial-partner-reconciliation",entityLabel:"Commercial Partner",entityPlural:"Commercial Partners"})})]})]})}a.s(["UnifiedReconciliationClient",()=>U],849853)}];

//# sourceMappingURL=c6ad4_src_components_arranger_unified-reconciliation-client_tsx_2b23a9fa._.js.map