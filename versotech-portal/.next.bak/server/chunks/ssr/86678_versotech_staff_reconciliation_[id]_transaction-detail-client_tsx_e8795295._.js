module.exports=[925686,a=>{"use strict";var b=a.i(352584),c=a.i(611038),d=a.i(289633),e=a.i(497412),f=a.i(899750),g=a.i(284169),h=a.i(421908),i=a.i(15788),j=a.i(249464),k=a.i(663475),l=a.i(191675),m=a.i(951870),n=a.i(975965),o=a.i(399580),p=a.i(877918),q=a.i(696661),r=a.i(823879),s=a.i(95799);let t=(0,s.default)("link",[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]]),u=(0,s.default)("unlink",[["path",{d:"m18.84 12.25 1.72-1.71h-.02a5.004 5.004 0 0 0-.12-7.07 5.006 5.006 0 0 0-6.95 0l-1.72 1.71",key:"yqzxt4"}],["path",{d:"m5.17 11.75-1.71 1.71a5.004 5.004 0 0 0 .12 7.07 5.006 5.006 0 0 0 6.95 0l1.71-1.71",key:"4qinb0"}],["line",{x1:"8",x2:"8",y1:"2",y2:"5",key:"1041cp"}],["line",{x1:"2",x2:"5",y1:"8",y2:"8",key:"14m1p5"}],["line",{x1:"16",x2:"16",y1:"19",y2:"22",key:"rzdirn"}],["line",{x1:"19",x2:"22",y1:"16",y2:"16",key:"ox905f"}]]);var v=a.i(325866),w=a.i(155508),x=a.i(724070),y=a.i(816854);let z=a=>{if(null==a)return 0;if("number"==typeof a)return a;let b=parseFloat(a);return Number.isNaN(b)?0:b},A=(a,b="USD")=>new Intl.NumberFormat("en-US",{style:"currency",currency:b,minimumFractionDigits:2,maximumFractionDigits:2}).format(a);function B({transaction:a,openInvoices:s,staffProfile:B}){var C;let D,E,F=(0,d.useRouter)(),[G,H]=(0,c.useState)(!1),[I,J]=(0,c.useState)(""),[K,L]=(0,c.useState)(""),[M,N]=(0,c.useState)(""),O=(0,c.useMemo)(()=>(a.matches||[]).filter(a=>"approved"===a.status),[a]),P=(0,c.useMemo)(()=>a.suggestions||[],[a]),Q=(0,c.useMemo)(()=>O.reduce((a,b)=>a+z(b.matched_amount),0),[O]),R=z(a.amount),S=Math.max(R-Q,0),T=(0,c.useMemo)(()=>s.find(a=>a.id===I)||null,[s,I]);(0,c.useEffect)(()=>{if(!T)return void L("");let a=Math.min(null!==T.balance_due&&void 0!==T.balance_due?z(T.balance_due):Math.max(z(T.total)-z(T.paid_amount),0),S);L(a>.01?a.toFixed(2):"")},[T,S]);let U=async a=>{H(!0);try{let b=await fetch("/api/staff/reconciliation/match/accept",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({suggested_match_id:a})}),c=await b.json();if(!b.ok)throw Error(c.error||"Failed to accept match");f.toast.success("Match accepted successfully - reloading..."),setTimeout(()=>{window.location.reload()},500)}catch(a){f.toast.error(a.message||"Failed to accept match"),H(!1)}},V=async a=>{H(!0);try{let b=await fetch("/api/staff/reconciliation/match/reject",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({suggested_match_id:a})}),c=await b.json();if(!b.ok)throw Error(c.error||"Failed to reject match");f.toast.success("Suggestion rejected successfully"),window.location.href=window.location.href}catch(a){f.toast.error(a.message||"Failed to reject match"),H(!1)}},W=async()=>{if(!I)return void f.toast.error("Please select an invoice");let b={bank_transaction_id:a.id,invoice_id:I};if(K){let a=parseFloat(K);if(Number.isNaN(a)||a<=0)return void f.toast.error("Enter a valid match amount");b.matched_amount=a}M.trim()&&(b.notes=M.trim()),H(!0);try{let a=await fetch("/api/staff/reconciliation/match/manual",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(b)}),c=await a.json();if(!a.ok)throw Error(c.error||"Failed to create manual match");f.toast.success("Manual match created successfully"),J(""),N(""),F.refresh()}catch(a){f.toast.error(a.message||"Failed to create manual match")}finally{H(!1)}},X=async b=>{if(confirm(b?"Unmatch this invoice from the transaction?":"Unmatch all invoices from this transaction?")){H(!0);try{let c=await fetch("/api/staff/reconciliation/unmatch",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({bank_transaction_id:a.id,match_id:b})}),d=await c.json();if(!c.ok)throw Error(d.error||"Failed to unmatch transaction");f.toast.success(d.message||"Unmatched successfully"),F.refresh()}catch(a){f.toast.error(a.message||"Failed to unmatch transaction")}finally{H(!1)}}};return(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"flex items-center gap-4",children:[(0,b.jsx)(e.default,{href:"/versotech_main/reconciliation",children:(0,b.jsx)(h.Button,{variant:"ghost",size:"icon",children:(0,b.jsx)(n.ArrowLeft,{className:"h-4 w-4"})})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-2xl font-bold text-foreground",children:"Transaction Details"}),(0,b.jsx)("p",{className:"text-muted-foreground mt-1",children:a.bank_reference||a.id})]})]}),(0,b.jsxs)("div",{className:"flex gap-2 items-center",children:[(C=a.status,E=(D={matched:{color:"bg-emerald-900/30 text-emerald-300 border-emerald-700",label:"Matched"},partially_matched:{color:"bg-amber-900/30 text-amber-300 border-amber-700",label:"Partially Matched"},unmatched:{color:"bg-slate-800/50 text-slate-300 border-slate-700",label:"Unmatched"}})[C]||D.unmatched,(0,b.jsxs)(i.Badge,{className:`${E.color} gap-1.5`,children:[(0,b.jsx)(o.CheckCircle2,{className:"h-3 w-3"}),E.label]})),a.match_confidence&&(0,b.jsxs)(i.Badge,{className:a.match_confidence>=80?"bg-emerald-900/30 text-emerald-300 border-emerald-700":a.match_confidence>=60?"bg-amber-900/30 text-amber-300 border-amber-700":"bg-rose-900/30 text-rose-300 border-rose-700",children:[a.match_confidence,"% confidence"]})]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,b.jsxs)("div",{className:"lg:col-span-2 space-y-6",children:[(0,b.jsxs)(g.Card,{children:[(0,b.jsx)(g.CardHeader,{children:(0,b.jsxs)(g.CardTitle,{className:"flex items-center gap-2",children:[(0,b.jsx)(w.DollarSign,{className:"h-5 w-5"}),"Transaction Information"]})}),(0,b.jsxs)(g.CardContent,{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(j.Label,{className:"text-muted-foreground text-xs",children:"Amount"}),(0,b.jsx)("div",{className:"text-2xl font-bold text-foreground",children:A(R,a.currency)})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(j.Label,{className:"text-muted-foreground text-xs",children:"Value Date"}),(0,b.jsxs)("div",{className:"text-lg font-medium text-foreground flex items-center gap-2",children:[(0,b.jsx)(x.Calendar,{className:"h-4 w-4"}),new Date(a.value_date).toLocaleDateString()]})]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(j.Label,{className:"text-muted-foreground text-xs",children:"Counterparty"}),(0,b.jsxs)("div",{className:"text-lg font-medium text-foreground flex items-center gap-2",children:[(0,b.jsx)(v.User,{className:"h-4 w-4"}),a.counterparty||"—"]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(j.Label,{className:"text-muted-foreground text-xs",children:"Remaining Amount"}),(0,b.jsx)("div",{className:"text-lg font-medium text-amber-200",children:S>.01?A(S,a.currency):"Fully allocated"})]})]}),a.memo&&(0,b.jsxs)("div",{children:[(0,b.jsx)(j.Label,{className:"text-muted-foreground text-xs",children:"Memo"}),(0,b.jsxs)("div",{className:"text-sm text-foreground flex items-start gap-2",children:[(0,b.jsx)(y.FileText,{className:"h-4 w-4 mt-0.5"}),a.memo]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(j.Label,{className:"text-muted-foreground text-xs",children:"Account Reference"}),(0,b.jsx)("div",{className:"text-sm font-mono text-foreground",children:a.account_ref||"—"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(j.Label,{className:"text-muted-foreground text-xs",children:"Bank Reference"}),(0,b.jsx)("div",{className:"text-sm font-mono text-foreground",children:a.bank_reference||"—"})]})]})]})]}),(0,b.jsxs)(g.Card,{children:[(0,b.jsxs)(g.CardHeader,{className:"flex flex-row items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsxs)(g.CardTitle,{className:"flex items-center gap-2",children:[(0,b.jsx)(t,{className:"h-5 w-5 text-emerald-300"}),"Approved Matches"]}),(0,b.jsx)(g.CardDescription,{children:O.length>0?`${O.length} invoice${1===O.length?"":"s"} matched`:"No invoices matched yet"})]}),O.length>0&&(0,b.jsxs)(h.Button,{variant:"outline",size:"sm",onClick:()=>X(),disabled:G,children:[(0,b.jsx)(u,{className:"h-4 w-4 mr-2"}),"Unmatch All"]})]}),(0,b.jsxs)(g.CardContent,{className:"space-y-4",children:[0===O.length&&(0,b.jsx)("div",{className:"text-sm text-muted-foreground",children:"No matches yet. Accept a suggestion or create a manual match."}),O.map(c=>{let d=c.invoices,e=d?.currency||a.currency||"USD",f=d?.invoice_number||d?.id?.slice(0,8),i=d?.investor?.legal_name,k=d?.deal?.name;return(0,b.jsxs)(g.Card,{className:"border-emerald-800/40 bg-emerald-950/10",children:[(0,b.jsxs)(g.CardHeader,{className:"flex flex-row items-center justify-between space-y-0",children:[(0,b.jsxs)("div",{children:[(0,b.jsxs)(g.CardTitle,{className:"flex items-center gap-2 text-base",children:[(0,b.jsx)(t,{className:"h-4 w-4 text-emerald-300"}),f]}),(0,b.jsxs)(g.CardDescription,{children:[i||"Investor"," ",k?`• ${k}`:""]})]}),(0,b.jsxs)(h.Button,{variant:"ghost",size:"sm",className:"text-rose-300 hover:text-rose-200",onClick:()=>X(c.id),disabled:G,children:[(0,b.jsx)(u,{className:"h-4 w-4 mr-2"}),"Unmatch"]})]}),(0,b.jsxs)(g.CardContent,{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(j.Label,{className:"text-muted-foreground text-xs",children:"Matched Amount"}),(0,b.jsx)("div",{className:"text-sm font-semibold text-foreground",children:A(z(c.matched_amount),e)})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(j.Label,{className:"text-muted-foreground text-xs",children:"Invoice Total"}),(0,b.jsx)("div",{className:"text-sm text-muted-foreground",children:A(z(d?.total),e)})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(j.Label,{className:"text-muted-foreground text-xs",children:"Status"}),(0,b.jsx)("div",{className:"text-xs capitalize text-emerald-200",children:c.match_type.replace("_"," ")})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(j.Label,{className:"text-muted-foreground text-xs",children:"Reason"}),(0,b.jsx)("div",{className:"text-xs text-muted-foreground line-clamp-2",children:c.match_reason||"Manual reconciliation"})]})]})]},c.id)})]})]}),(0,b.jsxs)(g.Card,{children:[(0,b.jsxs)(g.CardHeader,{children:[(0,b.jsxs)(g.CardTitle,{className:"flex items-center gap-2",children:[(0,b.jsx)(p.AlertCircle,{className:"h-5 w-5 text-amber-300"}),"Suggested Matches"]}),(0,b.jsx)(g.CardDescription,{children:P.length>0?"Review and accept high-confidence matches":"No pending suggestions"})]}),(0,b.jsxs)(g.CardContent,{className:"space-y-4",children:[0===P.length&&(0,b.jsx)("div",{className:"text-sm text-muted-foreground",children:"Auto-matching has not produced any suggestions for this transaction."}),P.map(c=>{let d=c.invoices,e=d?.currency||a.currency||"USD",f=d?.invoice_number||d?.id?.slice(0,8),k=d?.investor?.legal_name,l=d?.deal?.name;return(0,b.jsxs)(g.Card,{className:"border-amber-800/40 bg-amber-950/10",children:[(0,b.jsxs)(g.CardHeader,{className:"space-y-1",children:[(0,b.jsxs)(g.CardTitle,{className:"flex items-center justify-between text-base",children:[(0,b.jsxs)("span",{className:"flex items-center gap-2",children:[(0,b.jsx)(t,{className:"h-4 w-4 text-amber-300"}),f]}),null!==c.confidence&&void 0!==c.confidence&&(0,b.jsxs)(i.Badge,{className:c.confidence>=80?"bg-emerald-900/30 text-emerald-300 border-emerald-700":c.confidence>=60?"bg-amber-900/30 text-amber-300 border-amber-700":"bg-rose-900/30 text-rose-300 border-rose-700",children:[c.confidence,"% confidence"]})]}),(0,b.jsxs)(g.CardDescription,{children:[k||"Investor"," ",l?`• ${l}`:""]})]}),(0,b.jsxs)(g.CardContent,{className:"space-y-3",children:[(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(j.Label,{className:"text-muted-foreground text-xs",children:"Invoice Total"}),(0,b.jsx)("div",{className:"text-sm font-semibold text-foreground",children:A(z(d?.total),e)})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(j.Label,{className:"text-muted-foreground text-xs",children:"Balance Due"}),(0,b.jsx)("div",{className:"text-sm text-muted-foreground",children:A(d?.balance_due!==void 0&&d?.balance_due!==null?z(d.balance_due):Math.max(z(d?.total)-z(d?.paid_amount),0),e)})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(j.Label,{className:"text-muted-foreground text-xs",children:"Suggested Reason"}),(0,b.jsx)("div",{className:"text-xs text-muted-foreground line-clamp-2",children:c.match_reason})]})]}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsxs)(h.Button,{size:"sm",onClick:()=>U(c.id),disabled:G,children:[(0,b.jsx)(q.Check,{className:"h-4 w-4 mr-2"})," Accept"]}),(0,b.jsxs)(h.Button,{variant:"outline",size:"sm",onClick:()=>V(c.id),disabled:G,children:[(0,b.jsx)(r.X,{className:"h-4 w-4 mr-2"})," Reject"]})]})]})]},c.id)})]})]})]}),(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)(g.Card,{children:[(0,b.jsxs)(g.CardHeader,{children:[(0,b.jsx)(g.CardTitle,{children:"Manual Match"}),(0,b.jsx)(g.CardDescription,{children:"Link this transaction to an invoice that still has an outstanding balance."})]}),(0,b.jsxs)(g.CardContent,{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(j.Label,{children:"Select Invoice"}),(0,b.jsxs)(m.Select,{value:I,onValueChange:a=>J(a),children:[(0,b.jsx)(m.SelectTrigger,{children:(0,b.jsx)(m.SelectValue,{placeholder:"Choose invoice"})}),(0,b.jsxs)(m.SelectContent,{children:[0===s.length&&(0,b.jsx)(m.SelectItem,{value:"",disabled:!0,children:"No open invoices available"}),s.map(c=>{let d=c.currency||a.currency||"USD",e=null!==c.balance_due&&void 0!==c.balance_due?z(c.balance_due):Math.max(z(c.total)-z(c.paid_amount),0);return(0,b.jsxs)(m.SelectItem,{value:c.id,children:[c.invoice_number||c.id.slice(0,8)," • ",c.investor?.legal_name||"Investor"," • ",A(e,d)," due"]},c.id)})]})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(j.Label,{children:"Match Amount"}),(0,b.jsx)(k.Input,{type:"number",min:"0",step:"0.01",value:K,onChange:a=>L(a.target.value),placeholder:S>0?S.toFixed(2):"0.00"}),(0,b.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Remaining transaction amount: ",A(S,a.currency)]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(j.Label,{children:"Notes (optional)"}),(0,b.jsx)(l.Textarea,{value:M,onChange:a=>N(a.target.value),placeholder:"Document any context for this manual match",rows:3})]}),(0,b.jsxs)(h.Button,{onClick:W,disabled:G||!I,className:"w-full",children:[(0,b.jsx)(q.Check,{className:"h-4 w-4 mr-2"})," Create Manual Match"]})]})]}),(0,b.jsxs)(g.Card,{children:[(0,b.jsxs)(g.CardHeader,{children:[(0,b.jsx)(g.CardTitle,{children:"Reconciliation Summary"}),(0,b.jsx)(g.CardDescription,{children:"Overview of this transaction's allocation"})]}),(0,b.jsxs)(g.CardContent,{className:"space-y-3",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Total matched"}),(0,b.jsx)("span",{className:"font-medium text-emerald-200",children:A(Q,a.currency)})]}),(0,b.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Remaining"}),(0,b.jsx)("span",{className:"font-medium text-amber-200",children:A(S,a.currency)})]}),(0,b.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Matches created by"}),(0,b.jsx)("span",{className:"font-medium text-foreground",children:B?.displayName||"Staff"})]})]})]})]})]})]})}a.s(["TransactionDetailClient",()=>B],925686)}];

//# sourceMappingURL=86678_versotech_staff_reconciliation_%5Bid%5D_transaction-detail-client_tsx_e8795295._.js.map