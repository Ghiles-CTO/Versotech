{"version":3,"sources":["../../../../../versotech-portal/src/components/fees/OverviewTab.tsx","../../../../../versotech-portal/src/lib/fees/calculations.ts","../../../../../versotech-portal/src/components/fees/FeePlansTab.tsx","../../../../../versotech-portal/src/components/fees/InvoicesTab.tsx","../../../../../versotech-portal/src/components/fees/GenerateInvoiceModal.tsx","../../../../../versotech-portal/src/components/fees/ScheduleTab.tsx","../../../../../versotech-portal/src/components/fees/CommissionsTab.tsx"],"sourcesContent":["/**\r\n * Overview Tab - Complete fee analysis dashboard\r\n */\r\n\r\n'use client';\r\n\r\nimport { useEffect, useState } from 'react';\r\nimport { useRouter } from 'next/navigation';\r\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\r\nimport { DollarSign, FileText, AlertCircle, TrendingUp, Users, UserCheck, Handshake, Briefcase, ExternalLink, ArrowRight } from 'lucide-react';\r\nimport { Button } from '@/components/ui/button';\r\nimport { formatCurrency } from '@/lib/fees/calculations';\r\n\r\ninterface CommissionSummary {\r\n  total_owed: number;\r\n  total_accrued: number;\r\n  total_invoiced: number;\r\n  total_paid_ytd: number;\r\n  by_entity_type: {\r\n    introducer: { owed: number; paid: number };\r\n    partner: { owed: number; paid: number };\r\n    commercial_partner: { owed: number; paid: number };\r\n  };\r\n}\r\n\r\ninterface DashboardData {\r\n  total_fees_ytd: number;\r\n  total_fees_mtd: number;\r\n  total_fees_qtd: number;\r\n  outstanding_invoices_count: number;\r\n  outstanding_invoices_amount: number;\r\n  overdue_invoices_count: number;\r\n  overdue_invoices_amount: number;\r\n  upcoming_fees_30days: number;\r\n  upcoming_fees_count: number;\r\n  introducer_commissions_owed: number;\r\n  commission_summary?: CommissionSummary;\r\n}\r\n\r\ninterface FeeBreakdown {\r\n  subscription_fees: number;\r\n  spread_fees: number;\r\n  bd_fees: number;\r\n  finra_fees: number;\r\n  performance_fees: number;\r\n  management_fees: number;\r\n  total_fees: number;\r\n  unrealized_gains: number;\r\n}\r\n\r\ninterface ProjectedFees {\r\n  totals: FeeBreakdown & {\r\n    committed_capital: number;\r\n    current_nav: number;\r\n    total_subscriptions: number;\r\n  };\r\n  by_status: Array<FeeBreakdown & {\r\n    status: string;\r\n    committed_capital: number;\r\n    current_nav: number;\r\n    subscription_count: number;\r\n  }>;\r\n  by_vehicle: Array<{\r\n    vehicle_id: string;\r\n    vehicle_name: string;\r\n    fees: FeeBreakdown;\r\n    committed_capital: number;\r\n    current_nav: number;\r\n    subscription_count: number;\r\n    by_status: Array<FeeBreakdown & {\r\n      status: string;\r\n      committed_capital: number;\r\n      current_nav: number;\r\n      subscription_count: number;\r\n    }>;\r\n  }>;\r\n}\r\n\r\nexport default function OverviewTab() {\r\n  const router = useRouter();\r\n  const [data, setData] = useState<DashboardData | null>(null);\r\n  const [projectedFees, setProjectedFees] = useState<ProjectedFees | null>(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [loadingProjected, setLoadingProjected] = useState(true);\r\n\r\n  useEffect(() => {\r\n    fetchAllData();\r\n  }, []);\r\n\r\n  const fetchAllData = async () => {\r\n    try {\r\n      // Fetch both APIs in parallel for faster loading\r\n      const [dashboardRes, projectedRes] = await Promise.all([\r\n        fetch('/api/staff/fees/dashboard'),\r\n        fetch('/api/staff/fees/projected')\r\n      ]);\r\n\r\n      const [dashboardJson, projectedJson] = await Promise.all([\r\n        dashboardRes.json(),\r\n        projectedRes.json()\r\n      ]);\r\n\r\n      setData(dashboardJson.data);\r\n      setProjectedFees(projectedJson.data);\r\n    } catch (error) {\r\n      console.error('Error fetching overview data:', error);\r\n    } finally {\r\n      setLoading(false);\r\n      setLoadingProjected(false);\r\n    }\r\n  };\r\n\r\n  if (loading) {\r\n    return <div className=\"text-white\">Loading...</div>;\r\n  }\r\n\r\n  if (!data) {\r\n    return <div className=\"text-white\">Failed to load dashboard data</div>;\r\n  }\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      {/* KPI Cards */}\r\n      <div className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-4\">\r\n        <Card>\r\n          <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\r\n            <CardTitle className=\"text-sm font-medium\">Total Fees (YTD)</CardTitle>\r\n            <DollarSign className=\"h-4 w-4 text-muted-foreground\" />\r\n          </CardHeader>\r\n          <CardContent>\r\n            <div className=\"text-2xl font-bold text-white\">{formatCurrency(data.total_fees_ytd)}</div>\r\n            <p className=\"text-xs text-gray-400\">\r\n              MTD: {formatCurrency(data.total_fees_mtd)}\r\n            </p>\r\n          </CardContent>\r\n        </Card>\r\n\r\n        <Card\r\n          className=\"cursor-pointer hover:bg-accent/50 transition-colors\"\r\n          onClick={() => router.push('/versotech_main/reconciliation')}\r\n        >\r\n          <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\r\n            <CardTitle className=\"text-sm font-medium\">Outstanding Invoices</CardTitle>\r\n            <FileText className=\"h-4 w-4 text-muted-foreground\" />\r\n          </CardHeader>\r\n          <CardContent>\r\n            <div className=\"text-2xl font-bold text-white\">{formatCurrency(data.outstanding_invoices_amount)}</div>\r\n            <div className=\"flex items-center justify-between mt-1\">\r\n              <p className=\"text-xs text-gray-400\">\r\n                {data.outstanding_invoices_count} invoices\r\n              </p>\r\n              <span className=\"text-xs text-blue-400 flex items-center gap-1\">\r\n                View Invoices <ArrowRight className=\"h-3 w-3\" />\r\n              </span>\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n\r\n        <Card>\r\n          <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\r\n            <CardTitle className=\"text-sm font-medium\">Overdue</CardTitle>\r\n            <AlertCircle className=\"h-4 w-4 text-destructive\" />\r\n          </CardHeader>\r\n          <CardContent>\r\n            <div className=\"text-2xl font-bold text-destructive\">\r\n              {formatCurrency(data.overdue_invoices_amount)}\r\n            </div>\r\n            <p className=\"text-xs text-gray-400\">\r\n              {data.overdue_invoices_count} overdue invoices\r\n            </p>\r\n          </CardContent>\r\n        </Card>\r\n\r\n        <Card>\r\n          <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\r\n            <CardTitle className=\"text-sm font-medium\">Upcoming Fees (30d)</CardTitle>\r\n            <TrendingUp className=\"h-4 w-4 text-muted-foreground\" />\r\n          </CardHeader>\r\n          <CardContent>\r\n            <div className=\"text-2xl font-bold text-white\">{formatCurrency(data.upcoming_fees_30days)}</div>\r\n            <p className=\"text-xs text-gray-400\">\r\n              {data.upcoming_fees_count} scheduled fees\r\n            </p>\r\n          </CardContent>\r\n        </Card>\r\n      </div>\r\n\r\n      {/* Commissions Section */}\r\n      {data.commission_summary && (\r\n        <Card>\r\n          <CardHeader className=\"flex flex-row items-start justify-between\">\r\n            <div>\r\n              <CardTitle className=\"text-white flex items-center gap-2\">\r\n                <Users className=\"h-5 w-5\" />\r\n                Commissions\r\n              </CardTitle>\r\n              <p className=\"text-sm text-gray-400 mt-1\">\r\n                Commission expenses across all entity types (Introducers, Partners, Commercial Partners)\r\n              </p>\r\n            </div>\r\n            <Button\r\n              variant=\"outline\"\r\n              size=\"sm\"\r\n              onClick={() => router.push('/versotech_main/arranger-reconciliation')}\r\n              className=\"border-gray-600 hover:bg-gray-800\"\r\n            >\r\n              View Reconciliation\r\n              <ArrowRight className=\"ml-2 h-4 w-4\" />\r\n            </Button>\r\n          </CardHeader>\r\n          <CardContent>\r\n            <div className=\"space-y-6\">\r\n              {/* Commission KPI Cards */}\r\n              <div className=\"grid gap-4 md:grid-cols-3\">\r\n                <div className=\"p-4 bg-red-900/20 rounded border border-red-700\">\r\n                  <p className=\"text-xs text-red-300 mb-1\">Total Commissions Owed</p>\r\n                  <p className=\"text-2xl font-bold text-white\">\r\n                    {formatCurrency(data.commission_summary.total_owed)}\r\n                  </p>\r\n                  <p className=\"text-xs text-gray-400 mt-1\">\r\n                    Accrued + Invoiced\r\n                  </p>\r\n                </div>\r\n                <div className=\"p-4 bg-green-900/20 rounded border border-green-700\">\r\n                  <p className=\"text-xs text-green-300 mb-1\">Total Paid YTD</p>\r\n                  <p className=\"text-2xl font-bold text-white\">\r\n                    {formatCurrency(data.commission_summary.total_paid_ytd)}\r\n                  </p>\r\n                  <p className=\"text-xs text-gray-400 mt-1\">\r\n                    Commissions paid this year\r\n                  </p>\r\n                </div>\r\n                <div className=\"p-4 bg-amber-900/20 rounded border border-amber-700\">\r\n                  <p className=\"text-xs text-amber-300 mb-1\">Pending Invoice</p>\r\n                  <p className=\"text-2xl font-bold text-white\">\r\n                    {formatCurrency(data.commission_summary.total_accrued)}\r\n                  </p>\r\n                  <p className=\"text-xs text-gray-400 mt-1\">\r\n                    Accrued, awaiting invoice\r\n                  </p>\r\n                </div>\r\n              </div>\r\n\r\n              {/* Breakdown by Entity Type */}\r\n              <div>\r\n                <h4 className=\"text-sm font-semibold mb-3 text-gray-300\">Breakdown by Entity Type</h4>\r\n                <div className=\"grid gap-3 md:grid-cols-3\">\r\n                  <button\r\n                    onClick={() => router.push('/versotech_main/arranger-reconciliation?tab=introducers')}\r\n                    className=\"p-3 bg-gray-900 rounded border border-gray-700 flex items-start gap-3 hover:bg-gray-800 hover:border-blue-600 transition-colors cursor-pointer text-left\"\r\n                  >\r\n                    <UserCheck className=\"h-5 w-5 text-blue-400 mt-0.5\" />\r\n                    <div className=\"flex-1\">\r\n                      <div className=\"flex items-center justify-between\">\r\n                        <p className=\"text-sm font-medium text-white\">Introducers</p>\r\n                        <ExternalLink className=\"h-3.5 w-3.5 text-gray-500\" />\r\n                      </div>\r\n                      <div className=\"mt-2 space-y-1 text-sm\">\r\n                        <div className=\"flex justify-between\">\r\n                          <span className=\"text-gray-400\">Owed:</span>\r\n                          <span className=\"text-white font-medium\">\r\n                            {formatCurrency(data.commission_summary.by_entity_type.introducer.owed)}\r\n                          </span>\r\n                        </div>\r\n                        <div className=\"flex justify-between\">\r\n                          <span className=\"text-gray-400\">Paid YTD:</span>\r\n                          <span className=\"text-green-400 font-medium\">\r\n                            {formatCurrency(data.commission_summary.by_entity_type.introducer.paid)}\r\n                          </span>\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  </button>\r\n                  <button\r\n                    onClick={() => router.push('/versotech_main/arranger-reconciliation?tab=partners')}\r\n                    className=\"p-3 bg-gray-900 rounded border border-gray-700 flex items-start gap-3 hover:bg-gray-800 hover:border-green-600 transition-colors cursor-pointer text-left\"\r\n                  >\r\n                    <Handshake className=\"h-5 w-5 text-green-400 mt-0.5\" />\r\n                    <div className=\"flex-1\">\r\n                      <div className=\"flex items-center justify-between\">\r\n                        <p className=\"text-sm font-medium text-white\">Partners</p>\r\n                        <ExternalLink className=\"h-3.5 w-3.5 text-gray-500\" />\r\n                      </div>\r\n                      <div className=\"mt-2 space-y-1 text-sm\">\r\n                        <div className=\"flex justify-between\">\r\n                          <span className=\"text-gray-400\">Owed:</span>\r\n                          <span className=\"text-white font-medium\">\r\n                            {formatCurrency(data.commission_summary.by_entity_type.partner.owed)}\r\n                          </span>\r\n                        </div>\r\n                        <div className=\"flex justify-between\">\r\n                          <span className=\"text-gray-400\">Paid YTD:</span>\r\n                          <span className=\"text-green-400 font-medium\">\r\n                            {formatCurrency(data.commission_summary.by_entity_type.partner.paid)}\r\n                          </span>\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  </button>\r\n                  <button\r\n                    onClick={() => router.push('/versotech_main/arranger-reconciliation?tab=commercialPartners')}\r\n                    className=\"p-3 bg-gray-900 rounded border border-gray-700 flex items-start gap-3 hover:bg-gray-800 hover:border-purple-600 transition-colors cursor-pointer text-left\"\r\n                  >\r\n                    <Briefcase className=\"h-5 w-5 text-purple-400 mt-0.5\" />\r\n                    <div className=\"flex-1\">\r\n                      <div className=\"flex items-center justify-between\">\r\n                        <p className=\"text-sm font-medium text-white\">Commercial Partners</p>\r\n                        <ExternalLink className=\"h-3.5 w-3.5 text-gray-500\" />\r\n                      </div>\r\n                      <div className=\"mt-2 space-y-1 text-sm\">\r\n                        <div className=\"flex justify-between\">\r\n                          <span className=\"text-gray-400\">Owed:</span>\r\n                          <span className=\"text-white font-medium\">\r\n                            {formatCurrency(data.commission_summary.by_entity_type.commercial_partner.owed)}\r\n                          </span>\r\n                        </div>\r\n                        <div className=\"flex justify-between\">\r\n                          <span className=\"text-gray-400\">Paid YTD:</span>\r\n                          <span className=\"text-green-400 font-medium\">\r\n                            {formatCurrency(data.commission_summary.by_entity_type.commercial_partner.paid)}\r\n                          </span>\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  </button>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n      )}\r\n\r\n      {/* Complete Fee Analysis */}\r\n      <Card>\r\n        <CardHeader>\r\n          <CardTitle className=\"text-white\">Complete Fee Analysis</CardTitle>\r\n          <p className=\"text-sm text-gray-400\">\r\n            All subscription fees broken down by type, vehicle, and status\r\n          </p>\r\n        </CardHeader>\r\n        <CardContent>\r\n          {loadingProjected ? (\r\n            <p className=\"text-sm text-gray-400\">Loading...</p>\r\n          ) : projectedFees ? (\r\n            <div className=\"space-y-8\">\r\n              {/* Fee Type Breakdown - Top Section */}\r\n              <div>\r\n                <h4 className=\"text-lg font-semibold mb-4 text-white\">Total Fees by Type</h4>\r\n                <div className=\"grid gap-4 md:grid-cols-3 lg:grid-cols-7\">\r\n                  <div className=\"p-4 bg-blue-900/20 rounded border border-blue-700\">\r\n                    <p className=\"text-xs text-blue-300 mb-1\">Subscription Fees</p>\r\n                    <p className=\"text-xl font-bold text-white\">\r\n                      {formatCurrency(projectedFees.totals.subscription_fees)}\r\n                    </p>\r\n                  </div>\r\n                  <div className=\"p-4 bg-green-900/20 rounded border border-green-700\">\r\n                    <p className=\"text-xs text-green-300 mb-1\">Spread Fees</p>\r\n                    <p className=\"text-xl font-bold text-white\">\r\n                      {formatCurrency(projectedFees.totals.spread_fees)}\r\n                    </p>\r\n                  </div>\r\n                  <div className=\"p-4 bg-purple-900/20 rounded border border-purple-700\">\r\n                    <p className=\"text-xs text-purple-300 mb-1\">BD Fees</p>\r\n                    <p className=\"text-xl font-bold text-white\">\r\n                      {formatCurrency(projectedFees.totals.bd_fees)}\r\n                    </p>\r\n                  </div>\r\n                  <div className=\"p-4 bg-orange-900/20 rounded border border-orange-700\">\r\n                    <p className=\"text-xs text-orange-300 mb-1\">FINRA Fees</p>\r\n                    <p className=\"text-xl font-bold text-white\">\r\n                      {formatCurrency(projectedFees.totals.finra_fees)}\r\n                    </p>\r\n                  </div>\r\n                  <div className=\"p-4 bg-pink-900/20 rounded border border-pink-700\">\r\n                    <p className=\"text-xs text-pink-300 mb-1\">Performance Fees</p>\r\n                    <p className=\"text-xl font-bold text-white\">\r\n                      {formatCurrency(projectedFees.totals.performance_fees)}\r\n                    </p>\r\n                  </div>\r\n                  <div className=\"p-4 bg-cyan-900/20 rounded border border-cyan-700\">\r\n                    <p className=\"text-xs text-cyan-300 mb-1\">Management Fees</p>\r\n                    <p className=\"text-xl font-bold text-white\">\r\n                      {formatCurrency(projectedFees.totals.management_fees)}\r\n                    </p>\r\n                    <p className=\"text-xs text-gray-400 mt-1\">(Annual)</p>\r\n                  </div>\r\n                  <div className=\"p-4 bg-gray-800 rounded border border-gray-600\">\r\n                    <p className=\"text-xs text-gray-300 mb-1 font-semibold\">TOTAL ALL FEES</p>\r\n                    <p className=\"text-xl font-bold text-white\">\r\n                      {formatCurrency(projectedFees.totals.total_fees)}\r\n                    </p>\r\n                  </div>\r\n                </div>\r\n\r\n                {/* Unrealized Gains Card - Separate Row */}\r\n                <div className=\"mt-4\">\r\n                  <div className={`p-4 rounded border ${\r\n                    projectedFees.totals.unrealized_gains >= 0\r\n                      ? 'bg-emerald-900/20 border-emerald-700'\r\n                      : 'bg-red-900/20 border-red-700'\r\n                  }`}>\r\n                    <p className={`text-xs mb-1 ${\r\n                      projectedFees.totals.unrealized_gains >= 0\r\n                        ? 'text-emerald-300'\r\n                        : 'text-red-300'\r\n                    }`}>\r\n                      Unrealized Gains/Losses (Cost vs Price per Share)\r\n                    </p>\r\n                    <p className={`text-2xl font-bold ${\r\n                      projectedFees.totals.unrealized_gains >= 0\r\n                        ? 'text-emerald-400'\r\n                        : 'text-red-400'\r\n                    }`}>\r\n                      {formatCurrency(projectedFees.totals.unrealized_gains)}\r\n                    </p>\r\n                    <p className=\"text-xs text-gray-400 mt-1\">\r\n                      (Price per Share - Cost per Share) × Number of Shares\r\n                    </p>\r\n                  </div>\r\n                </div>\r\n\r\n                <div className=\"grid gap-4 md:grid-cols-3 mt-4\">\r\n                  <div className=\"p-3 bg-gray-900 rounded border border-gray-700\">\r\n                    <p className=\"text-xs text-gray-400\">Total Committed Capital</p>\r\n                    <p className=\"text-lg font-bold text-white\">\r\n                      {formatCurrency(projectedFees.totals.committed_capital)}\r\n                    </p>\r\n                  </div>\r\n                  <div className=\"p-3 bg-gray-900 rounded border border-gray-700\">\r\n                    <p className=\"text-xs text-gray-400\">Total Current NAV</p>\r\n                    <p className=\"text-lg font-bold text-white\">\r\n                      {formatCurrency(projectedFees.totals.current_nav)}\r\n                    </p>\r\n                  </div>\r\n                  <div className=\"p-3 bg-gray-900 rounded border border-gray-700\">\r\n                    <p className=\"text-xs text-gray-400\">Total Subscriptions</p>\r\n                    <p className=\"text-lg font-bold text-white\">\r\n                      {projectedFees.totals.total_subscriptions}\r\n                    </p>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n\r\n              {/* By Subscription Status */}\r\n              {projectedFees.by_status.length > 0 && (\r\n                <div>\r\n                  <h4 className=\"text-lg font-semibold mb-4 text-white\">Fees by Subscription Status</h4>\r\n                  <div className=\"grid gap-3 md:grid-cols-2 lg:grid-cols-4\">\r\n                    {projectedFees.by_status.map((statusGroup, index) => (\r\n                      <div\r\n                        key={index}\r\n                        className=\"p-4 bg-gray-900 rounded border border-gray-700\"\r\n                      >\r\n                        <div className=\"flex items-center justify-between mb-3\">\r\n                          <span className=\"text-sm font-bold text-white uppercase\">{statusGroup.status}</span>\r\n                          <span className=\"text-xs text-gray-400\">{statusGroup.subscription_count} subs</span>\r\n                        </div>\r\n                        <div className=\"space-y-2 text-sm\">\r\n                          <div className=\"flex justify-between\">\r\n                            <span className=\"text-gray-400\">Subscription:</span>\r\n                            <span className=\"text-white font-medium\">{formatCurrency(statusGroup.subscription_fees)}</span>\r\n                          </div>\r\n                          <div className=\"flex justify-between\">\r\n                            <span className=\"text-gray-400\">Spread:</span>\r\n                            <span className=\"text-white font-medium\">{formatCurrency(statusGroup.spread_fees)}</span>\r\n                          </div>\r\n                          <div className=\"flex justify-between\">\r\n                            <span className=\"text-gray-400\">BD:</span>\r\n                            <span className=\"text-white font-medium\">{formatCurrency(statusGroup.bd_fees)}</span>\r\n                          </div>\r\n                          <div className=\"flex justify-between\">\r\n                            <span className=\"text-gray-400\">FINRA:</span>\r\n                            <span className=\"text-white font-medium\">{formatCurrency(statusGroup.finra_fees)}</span>\r\n                          </div>\r\n                          <div className=\"flex justify-between\">\r\n                            <span className=\"text-gray-400\">Performance:</span>\r\n                            <span className=\"text-white font-medium\">{formatCurrency(statusGroup.performance_fees)}</span>\r\n                          </div>\r\n                          <div className=\"flex justify-between\">\r\n                            <span className=\"text-cyan-400\">Management:</span>\r\n                            <span className=\"text-white font-medium\">{formatCurrency(statusGroup.management_fees)}</span>\r\n                          </div>\r\n                          <div className=\"flex justify-between pt-2 border-t border-gray-700\">\r\n                            <span className=\"text-white font-semibold\">Total Fees:</span>\r\n                            <span className=\"text-white font-bold\">{formatCurrency(statusGroup.total_fees)}</span>\r\n                          </div>\r\n                          <div className=\"flex justify-between\">\r\n                            <span className={statusGroup.unrealized_gains >= 0 ? 'text-emerald-400' : 'text-red-400'}>\r\n                              Unrealized Gain:\r\n                            </span>\r\n                            <span className={`font-semibold ${statusGroup.unrealized_gains >= 0 ? 'text-emerald-400' : 'text-red-400'}`}>\r\n                              {formatCurrency(statusGroup.unrealized_gains)}\r\n                            </span>\r\n                          </div>\r\n                        </div>\r\n                      </div>\r\n                    ))}\r\n                  </div>\r\n                </div>\r\n              )}\r\n\r\n              {/* By Vehicle */}\r\n              {projectedFees.by_vehicle.length > 0 && (\r\n                <div>\r\n                  <h4 className=\"text-lg font-semibold mb-4 text-white\">Fees by Vehicle</h4>\r\n                  <div className=\"space-y-4\">\r\n                    {projectedFees.by_vehicle.map((vehicle, index) => (\r\n                      <div\r\n                        key={index}\r\n                        className=\"p-5 bg-gray-900 rounded border border-gray-700\"\r\n                      >\r\n                        {/* Vehicle Header */}\r\n                        <div className=\"flex items-start justify-between mb-4\">\r\n                          <div>\r\n                            <h5 className=\"text-xl font-bold text-white mb-1\">{vehicle.vehicle_name}</h5>\r\n                            <p className=\"text-sm text-gray-400\">\r\n                              {vehicle.subscription_count} subscription{vehicle.subscription_count !== 1 ? 's' : ''} •\r\n                              Capital: {formatCurrency(vehicle.committed_capital)} •\r\n                              NAV: {formatCurrency(vehicle.current_nav)}\r\n                            </p>\r\n                          </div>\r\n                          <div className=\"text-right\">\r\n                            <p className=\"text-2xl font-bold text-white\">\r\n                              {formatCurrency(vehicle.fees.total_fees)}\r\n                            </p>\r\n                            <p className=\"text-xs text-gray-400\">total fees</p>\r\n                          </div>\r\n                        </div>\r\n\r\n                        {/* Fee Type Breakdown for this Vehicle */}\r\n                        <div className=\"grid grid-cols-2 md:grid-cols-6 gap-3 mb-4\">\r\n                          <div className=\"p-2 bg-blue-900/10 rounded\">\r\n                            <p className=\"text-xs text-blue-300\">Subscription</p>\r\n                            <p className=\"text-sm font-bold text-white\">{formatCurrency(vehicle.fees.subscription_fees)}</p>\r\n                          </div>\r\n                          <div className=\"p-2 bg-green-900/10 rounded\">\r\n                            <p className=\"text-xs text-green-300\">Spread</p>\r\n                            <p className=\"text-sm font-bold text-white\">{formatCurrency(vehicle.fees.spread_fees)}</p>\r\n                          </div>\r\n                          <div className=\"p-2 bg-purple-900/10 rounded\">\r\n                            <p className=\"text-xs text-purple-300\">BD</p>\r\n                            <p className=\"text-sm font-bold text-white\">{formatCurrency(vehicle.fees.bd_fees)}</p>\r\n                          </div>\r\n                          <div className=\"p-2 bg-orange-900/10 rounded\">\r\n                            <p className=\"text-xs text-orange-300\">FINRA</p>\r\n                            <p className=\"text-sm font-bold text-white\">{formatCurrency(vehicle.fees.finra_fees)}</p>\r\n                          </div>\r\n                          <div className=\"p-2 bg-pink-900/10 rounded\">\r\n                            <p className=\"text-xs text-pink-300\">Performance</p>\r\n                            <p className=\"text-sm font-bold text-white\">{formatCurrency(vehicle.fees.performance_fees)}</p>\r\n                          </div>\r\n                          <div className=\"p-2 bg-cyan-900/10 rounded\">\r\n                            <p className=\"text-xs text-cyan-300\">Management</p>\r\n                            <p className=\"text-sm font-bold text-white\">{formatCurrency(vehicle.fees.management_fees)}</p>\r\n                          </div>\r\n                        </div>\r\n\r\n                        {/* Unrealized Gains for Vehicle */}\r\n                        <div className={`p-3 rounded mb-4 ${\r\n                          vehicle.fees.unrealized_gains >= 0\r\n                            ? 'bg-emerald-900/10 border border-emerald-700'\r\n                            : 'bg-red-900/10 border border-red-700'\r\n                        }`}>\r\n                          <div className=\"flex justify-between items-center\">\r\n                            <span className={`text-sm ${\r\n                              vehicle.fees.unrealized_gains >= 0 ? 'text-emerald-300' : 'text-red-300'\r\n                            }`}>\r\n                              Unrealized Gains/Losses\r\n                            </span>\r\n                            <span className={`text-lg font-bold ${\r\n                              vehicle.fees.unrealized_gains >= 0 ? 'text-emerald-400' : 'text-red-400'\r\n                            }`}>\r\n                              {formatCurrency(vehicle.fees.unrealized_gains)}\r\n                            </span>\r\n                          </div>\r\n                        </div>\r\n\r\n                        {/* Status Breakdown within Vehicle */}\r\n                        {vehicle.by_status.length > 0 && (\r\n                          <div className=\"pt-4 border-t border-gray-800\">\r\n                            <p className=\"text-xs text-gray-500 mb-3 font-semibold\">Status Breakdown:</p>\r\n                            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-3\">\r\n                              {vehicle.by_status.map((status, idx) => (\r\n                                <div key={idx} className=\"p-3 bg-gray-800 rounded text-sm\">\r\n                                  <div className=\"flex justify-between items-center mb-2\">\r\n                                    <span className=\"text-white font-semibold capitalize\">{status.status}</span>\r\n                                    <span className=\"text-gray-400 text-xs\">{status.subscription_count}</span>\r\n                                  </div>\r\n                                  <div className=\"space-y-1 text-xs\">\r\n                                    <div className=\"flex justify-between\">\r\n                                      <span className=\"text-gray-400\">Sub:</span>\r\n                                      <span className=\"text-white\">{formatCurrency(status.subscription_fees)}</span>\r\n                                    </div>\r\n                                    <div className=\"flex justify-between\">\r\n                                      <span className=\"text-cyan-400\">Mgmt:</span>\r\n                                      <span className=\"text-white\">{formatCurrency(status.management_fees)}</span>\r\n                                    </div>\r\n                                    <div className=\"flex justify-between\">\r\n                                      <span className=\"text-gray-400\">Total Fees:</span>\r\n                                      <span className=\"text-white font-semibold\">{formatCurrency(status.total_fees)}</span>\r\n                                    </div>\r\n                                    <div className=\"flex justify-between\">\r\n                                      <span className={status.unrealized_gains >= 0 ? 'text-emerald-400' : 'text-red-400'}>\r\n                                        Unrealized:\r\n                                      </span>\r\n                                      <span className={`font-semibold ${status.unrealized_gains >= 0 ? 'text-emerald-400' : 'text-red-400'}`}>\r\n                                        {formatCurrency(status.unrealized_gains)}\r\n                                      </span>\r\n                                    </div>\r\n                                  </div>\r\n                                </div>\r\n                              ))}\r\n                            </div>\r\n                          </div>\r\n                        )}\r\n                      </div>\r\n                    ))}\r\n                  </div>\r\n                </div>\r\n              )}\r\n            </div>\r\n          ) : (\r\n            <p className=\"text-sm text-gray-400\">No data available</p>\r\n          )}\r\n        </CardContent>\r\n      </Card>\r\n    </div>\r\n  );\r\n}\r\n","/**\r\n * Fee Calculation Utilities\r\n * Handles calculations for subscription, management, performance, and spread fees\r\n */\r\n\r\nexport interface FeeCalculationInput {\r\n  investmentAmount: number;\r\n  rateBps?: number; // Basis points (e.g., 200 = 2%)\r\n  flatAmount?: number;\r\n  durationPeriods?: number;\r\n  numShares?: number;\r\n  entryPricePerShare?: number;\r\n  exitPricePerShare?: number;\r\n  costPerShare?: number;\r\n  tierThresholdMultiplier?: number;\r\n}\r\n\r\nexport interface PerformanceFeeTier {\r\n  rateBps: number;\r\n  thresholdMultiplier?: number; // e.g., 10.0 for \"10x return\"\r\n  nextTierComponentId?: string;\r\n}\r\n\r\nexport interface PerformanceFeeWithHurdleInput {\r\n  contributedCapital: number;\r\n  exitProceeds: number;\r\n  carryRateBps: number; // Carried interest rate in basis points (e.g., 2000 = 20%)\r\n  hurdleRateBps: number; // Hurdle rate in basis points (e.g., 800 = 8% annual)\r\n  yearsHeld: number; // Investment holding period in years\r\n}\r\n\r\nexport interface TieredPerformanceFeeInput {\r\n  contributedCapital: number;\r\n  exitProceeds: number;\r\n  yearsHeld: number;\r\n  hurdleRateBps: number;\r\n  // Tier 1: Base carry rate applies until threshold\r\n  tier1RateBps: number;\r\n  tier1ThresholdMultiplier?: number; // e.g., 2.0 for \"up to 2x return\"\r\n  // Tier 2: Higher carry rate above threshold\r\n  tier2RateBps?: number;\r\n  tier2ThresholdMultiplier?: number; // e.g., 3.0 for \"up to 3x return\"\r\n}\r\n\r\n/**\r\n * Convert basis points to decimal percentage\r\n * @param bps - Basis points (e.g., 200 for 2%)\r\n * @returns Decimal percentage (e.g., 0.02 for 2%)\r\n */\r\nexport function bpsToPercent(bps: number): number {\r\n  return bps / 10000;\r\n}\r\n\r\n/**\r\n * Convert decimal percentage to basis points\r\n * @param percent - Decimal percentage (e.g., 0.02 for 2%)\r\n * @returns Basis points (e.g., 200 for 2%)\r\n */\r\nexport function percentToBps(percent: number): number {\r\n  return Math.round(percent * 10000);\r\n}\r\n\r\n/**\r\n * Calculate subscription fee\r\n * Formula: investment_amount × subscription_fee_percent\r\n * @param input - Fee calculation input\r\n * @returns Calculated subscription fee\r\n */\r\nexport function calculateSubscriptionFee(input: FeeCalculationInput): number {\r\n  if (input.flatAmount) {\r\n    return input.flatAmount;\r\n  }\r\n\r\n  if (!input.rateBps) {\r\n    return 0;\r\n  }\r\n\r\n  const feePercent = bpsToPercent(input.rateBps);\r\n  return input.investmentAmount * feePercent;\r\n}\r\n\r\n/**\r\n * Calculate management fee (single period or total for upfront payment)\r\n * Formula: investment_amount × management_fee_percent × number_of_periods\r\n * @param input - Fee calculation input\r\n * @param isUpfront - If true, calculates total for all periods; if false, calculates single period\r\n * @returns Calculated management fee\r\n */\r\nexport function calculateManagementFee(\r\n  input: FeeCalculationInput,\r\n  isUpfront: boolean = false\r\n): number {\r\n  if (!input.rateBps) {\r\n    return 0;\r\n  }\r\n\r\n  const feePercent = bpsToPercent(input.rateBps);\r\n  const baseFee = input.investmentAmount * feePercent;\r\n\r\n  if (isUpfront && input.durationPeriods) {\r\n    return baseFee * input.durationPeriods;\r\n  }\r\n\r\n  return baseFee;\r\n}\r\n\r\nexport interface ManagementFeePeriodInput {\r\n  baseAmount: number;\r\n  rateBps: number;\r\n  periodStartDate: Date;\r\n  periodEndDate: Date;\r\n}\r\n\r\n/**\r\n * Calculate management fee for a specific period with pro-rata adjustment\r\n * Formula: base_amount × (rate_bps / 10000) × (period_days / 365)\r\n * @param input - Period-based fee calculation input\r\n * @returns Calculated management fee prorated for the period\r\n */\r\nexport function calculateManagementFeePeriod(input: ManagementFeePeriodInput): number {\r\n  if (!input.rateBps || input.rateBps <= 0) {\r\n    return 0;\r\n  }\r\n\r\n  if (!input.baseAmount || input.baseAmount <= 0) {\r\n    return 0;\r\n  }\r\n\r\n  const periodDays = calculateDaysBetween(input.periodStartDate, input.periodEndDate);\r\n  if (periodDays <= 0) {\r\n    return 0;\r\n  }\r\n\r\n  const feePercent = bpsToPercent(input.rateBps);\r\n  const annualizedFraction = periodDays / 365;\r\n\r\n  return input.baseAmount * feePercent * annualizedFraction;\r\n}\r\n\r\n/**\r\n * Calculate the number of days between two dates (inclusive of end date)\r\n * @param startDate - Period start date\r\n * @param endDate - Period end date\r\n * @returns Number of days in the period\r\n */\r\nexport function calculateDaysBetween(startDate: Date, endDate: Date): number {\r\n  const msPerDay = 24 * 60 * 60 * 1000;\r\n  const diffMs = endDate.getTime() - startDate.getTime();\r\n  // Add 1 to include the end date in the count (both start and end are inclusive)\r\n  return Math.floor(diffMs / msPerDay) + 1;\r\n}\r\n\r\n/**\r\n * Calculate the end date for a fee period based on frequency\r\n * @param startDate - Period start date\r\n * @param frequency - Fee frequency (annual, quarterly, monthly)\r\n * @returns Period end date (day before next period starts)\r\n */\r\nexport function calculatePeriodEndDate(\r\n  startDate: Date,\r\n  frequency: 'annual' | 'quarterly' | 'monthly'\r\n): Date {\r\n  const endDate = new Date(startDate);\r\n\r\n  switch (frequency) {\r\n    case 'annual':\r\n      endDate.setFullYear(endDate.getFullYear() + 1);\r\n      break;\r\n    case 'quarterly':\r\n      endDate.setMonth(endDate.getMonth() + 3);\r\n      break;\r\n    case 'monthly':\r\n      endDate.setMonth(endDate.getMonth() + 1);\r\n      break;\r\n  }\r\n\r\n  // Subtract 1 day to get the last day of the current period\r\n  endDate.setDate(endDate.getDate() - 1);\r\n\r\n  return endDate;\r\n}\r\n\r\n/**\r\n * Calculate simple performance fee (no tiers)\r\n * Formula: (exit_price - entry_price) × num_shares × performance_fee_percent\r\n * @param input - Fee calculation input\r\n * @returns Calculated performance fee\r\n */\r\nexport function calculateSimplePerformanceFee(input: FeeCalculationInput): number {\r\n  if (!input.rateBps || !input.numShares || !input.entryPricePerShare || !input.exitPricePerShare) {\r\n    return 0;\r\n  }\r\n\r\n  const gainPerShare = input.exitPricePerShare - input.entryPricePerShare;\r\n\r\n  // No performance fee if there's no gain\r\n  if (gainPerShare <= 0) {\r\n    return 0;\r\n  }\r\n\r\n  const feePercent = bpsToPercent(input.rateBps);\r\n  return gainPerShare * input.numShares * feePercent;\r\n}\r\n\r\n/**\r\n * Calculate tiered performance fee\r\n * Example: 20% on gains up to 10x, 30% on gains above 10x\r\n * @param input - Fee calculation input\r\n * @param tiers - Array of performance fee tiers\r\n * @returns Calculated tiered performance fee\r\n */\r\nexport function calculateTieredPerformanceFee(\r\n  input: FeeCalculationInput,\r\n  tiers: PerformanceFeeTier[]\r\n): number {\r\n  if (!input.numShares || !input.entryPricePerShare || !input.exitPricePerShare) {\r\n    return 0;\r\n  }\r\n\r\n  const gainPerShare = input.exitPricePerShare - input.entryPricePerShare;\r\n\r\n  // No performance fee if there's no gain\r\n  if (gainPerShare <= 0) {\r\n    return 0;\r\n  }\r\n\r\n  const returnMultiplier = input.exitPricePerShare / input.entryPricePerShare;\r\n  let totalFee = 0;\r\n\r\n  // Sort tiers by threshold (ascending)\r\n  const sortedTiers = [...tiers].sort((a, b) => {\r\n    const aThreshold = a.thresholdMultiplier || Infinity;\r\n    const bThreshold = b.thresholdMultiplier || Infinity;\r\n    return aThreshold - bThreshold;\r\n  });\r\n\r\n  let previousThreshold = 1; // Start at 1x (entry price)\r\n\r\n  for (const tier of sortedTiers) {\r\n    const currentThreshold = tier.thresholdMultiplier || Infinity;\r\n\r\n    if (returnMultiplier <= previousThreshold) {\r\n      break; // Return is below this tier\r\n    }\r\n\r\n    const applicableMultiplier = Math.min(returnMultiplier, currentThreshold);\r\n    const tierGainPerShare = input.entryPricePerShare * (applicableMultiplier - previousThreshold);\r\n    const tierFeePercent = bpsToPercent(tier.rateBps);\r\n    const tierFee = tierGainPerShare * input.numShares * tierFeePercent;\r\n\r\n    totalFee += tierFee;\r\n    previousThreshold = currentThreshold;\r\n\r\n    if (returnMultiplier <= currentThreshold) {\r\n      break; // Return doesn't reach next tier\r\n    }\r\n  }\r\n\r\n  return totalFee;\r\n}\r\n\r\n/**\r\n * Calculate performance fee with hurdle rate (carried interest)\r\n * Formula:\r\n *   profit = exit_proceeds - contributed_capital\r\n *   hurdle_return = contributed_capital × (hurdle_bps / 10000) × years_held\r\n *   profit_above_hurdle = profit - hurdle_return\r\n *   performance_fee = profit_above_hurdle × (carry_bps / 10000) if positive, else 0\r\n *\r\n * This matches the database function calculate_performance_fee()\r\n * @param input - Performance fee calculation input\r\n * @returns Calculated performance fee (carried interest)\r\n */\r\nexport function calculatePerformanceFeeWithHurdle(\r\n  input: PerformanceFeeWithHurdleInput\r\n): number {\r\n  const { contributedCapital, exitProceeds, carryRateBps, hurdleRateBps, yearsHeld } = input;\r\n\r\n  // Calculate profit\r\n  const profit = exitProceeds - contributedCapital;\r\n\r\n  // No performance fee if there's no profit\r\n  if (profit <= 0) {\r\n    return 0;\r\n  }\r\n\r\n  // Calculate hurdle return (minimum return threshold)\r\n  const hurdleReturn = contributedCapital * bpsToPercent(hurdleRateBps) * yearsHeld;\r\n\r\n  // Calculate profit above the hurdle\r\n  const profitAboveHurdle = profit - hurdleReturn;\r\n\r\n  // No performance fee if profit doesn't exceed hurdle\r\n  if (profitAboveHurdle <= 0) {\r\n    return 0;\r\n  }\r\n\r\n  // Calculate and return the performance fee\r\n  const carryRate = bpsToPercent(carryRateBps);\r\n  return Math.round(profitAboveHurdle * carryRate * 100) / 100;\r\n}\r\n\r\n/**\r\n * Calculate tiered performance fee with hurdle rate\r\n * Supports two tiers with different carry rates based on return multiples\r\n *\r\n * Example: 20% carry up to 2x return, 30% carry above 2x\r\n *\r\n * @param input - Tiered performance fee calculation input\r\n * @returns Calculated tiered performance fee\r\n */\r\nexport function calculateTieredPerformanceFeeWithHurdle(\r\n  input: TieredPerformanceFeeInput\r\n): number {\r\n  const {\r\n    contributedCapital,\r\n    exitProceeds,\r\n    yearsHeld,\r\n    hurdleRateBps,\r\n    tier1RateBps,\r\n    tier1ThresholdMultiplier,\r\n    tier2RateBps,\r\n    tier2ThresholdMultiplier,\r\n  } = input;\r\n\r\n  // Calculate profit\r\n  const profit = exitProceeds - contributedCapital;\r\n\r\n  // No performance fee if there's no profit\r\n  if (profit <= 0) {\r\n    return 0;\r\n  }\r\n\r\n  // Calculate hurdle return\r\n  const hurdleReturn = contributedCapital * bpsToPercent(hurdleRateBps) * yearsHeld;\r\n\r\n  // Calculate profit above hurdle\r\n  const profitAboveHurdle = profit - hurdleReturn;\r\n\r\n  // No performance fee if profit doesn't exceed hurdle\r\n  if (profitAboveHurdle <= 0) {\r\n    return 0;\r\n  }\r\n\r\n  // Calculate return multiple: exitProceeds / contributedCapital\r\n  const returnMultiple = exitProceeds / contributedCapital;\r\n\r\n  // If no tier structure, apply single rate\r\n  if (!tier1ThresholdMultiplier || !tier2RateBps) {\r\n    const carryRate = bpsToPercent(tier1RateBps);\r\n    return Math.round(profitAboveHurdle * carryRate * 100) / 100;\r\n  }\r\n\r\n  let totalFee = 0;\r\n\r\n  // Tier 1: Profit from hurdle to tier1 threshold (or actual return if lower)\r\n  // tier1 threshold is expressed as a multiple (e.g., 2.0 = 2x return)\r\n  const tier1MaxProfit = contributedCapital * (tier1ThresholdMultiplier - 1); // Profit at tier 1 threshold\r\n  const tier1Profit = Math.min(profitAboveHurdle, Math.max(0, tier1MaxProfit - hurdleReturn));\r\n  if (tier1Profit > 0) {\r\n    totalFee += tier1Profit * bpsToPercent(tier1RateBps);\r\n  }\r\n\r\n  // Tier 2: Profit from tier1 threshold to tier2 threshold (or actual return if lower)\r\n  if (returnMultiple > tier1ThresholdMultiplier) {\r\n    const tier2Start = contributedCapital * (tier1ThresholdMultiplier - 1);\r\n    const tier2End = tier2ThresholdMultiplier\r\n      ? contributedCapital * (tier2ThresholdMultiplier - 1)\r\n      : profit;\r\n\r\n    const tier2Profit = Math.min(profit, tier2End) - tier2Start;\r\n    if (tier2Profit > 0) {\r\n      totalFee += tier2Profit * bpsToPercent(tier2RateBps);\r\n    }\r\n  }\r\n\r\n  return Math.round(totalFee * 100) / 100;\r\n}\r\n\r\n/**\r\n * Calculate spread (price per share markup)\r\n * Formula: (investor_price_per_share - cost_per_share) × num_shares\r\n * @param input - Fee calculation input\r\n * @returns Calculated spread revenue\r\n */\r\nexport function calculateSpread(input: FeeCalculationInput): number {\r\n  if (!input.numShares || !input.entryPricePerShare || !input.costPerShare) {\r\n    return 0;\r\n  }\r\n\r\n  const spreadPerShare = input.entryPricePerShare - input.costPerShare;\r\n\r\n  // No spread if investor price is at or below cost\r\n  if (spreadPerShare <= 0) {\r\n    return 0;\r\n  }\r\n\r\n  return spreadPerShare * input.numShares;\r\n}\r\n\r\n/**\r\n * Calculate introducer commission\r\n * Formula: base_fee_amount × commission_rate_percent\r\n * @param baseFeeAmount - The base fee amount to calculate commission on\r\n * @param commissionRateBps - Commission rate in basis points\r\n * @returns Calculated commission amount\r\n */\r\nexport function calculateIntroducerCommission(\r\n  baseFeeAmount: number,\r\n  commissionRateBps: number\r\n): number {\r\n  const commissionPercent = bpsToPercent(commissionRateBps);\r\n  return baseFeeAmount * commissionPercent;\r\n}\r\n\r\n/**\r\n * Calculate total wire amount (investment + subscription fee)\r\n * @param investmentAmount - Base investment amount\r\n * @param subscriptionFeeBps - Subscription fee in basis points\r\n * @returns Total amount investor needs to wire\r\n */\r\nexport function calculateTotalWireAmount(\r\n  investmentAmount: number,\r\n  subscriptionFeeBps: number\r\n): number {\r\n  const subscriptionFee = calculateSubscriptionFee({\r\n    investmentAmount,\r\n    rateBps: subscriptionFeeBps,\r\n  });\r\n\r\n  return investmentAmount + subscriptionFee;\r\n}\r\n\r\n/**\r\n * Calculate net fee retained by Verso after introducer commission\r\n * @param grossFee - Total fee collected\r\n * @param introducerCommissionBps - Introducer commission rate in basis points\r\n * @returns Net fee retained\r\n */\r\nexport function calculateNetFeeRetained(\r\n  grossFee: number,\r\n  introducerCommissionBps: number\r\n): number {\r\n  const commission = calculateIntroducerCommission(grossFee, introducerCommissionBps);\r\n  return grossFee - commission;\r\n}\r\n\r\n/**\r\n * Format currency for display\r\n * @param amount - Amount to format\r\n * @param currency - Currency code (default: USD)\r\n * @returns Formatted currency string\r\n */\r\nexport function formatCurrency(amount: number, currency: string = 'USD'): string {\r\n  return new Intl.NumberFormat('en-US', {\r\n    style: 'currency',\r\n    currency,\r\n    minimumFractionDigits: 2,\r\n    maximumFractionDigits: 2,\r\n  }).format(amount);\r\n}\r\n\r\n/**\r\n * Format basis points for display\r\n * @param bps - Basis points\r\n * @returns Formatted percentage string (e.g., \"2.00%\")\r\n */\r\nexport function formatBps(bps: number): string {\r\n  const percent = bpsToPercent(bps) * 100;\r\n  return `${percent.toFixed(2)}%`;\r\n}\r\n\r\n/**\r\n * Invoice validation types and functions\r\n */\r\n\r\nexport interface InvoiceLineWithFeeEvent {\r\n  id?: string;\r\n  fee_event_id?: string | null;\r\n  kind?: string;\r\n  amount: number;\r\n  fee_event?: {\r\n    id: string;\r\n    computed_amount: number;\r\n  } | null;\r\n}\r\n\r\nexport interface InvoiceValidationInput {\r\n  invoiceTotal: number;\r\n  invoiceSubtotal: number;\r\n  lines: InvoiceLineWithFeeEvent[];\r\n}\r\n\r\nexport interface InvoiceValidationResult {\r\n  isValid: boolean;\r\n  hasDiscrepancy: boolean;\r\n  expectedTotal: number;\r\n  actualTotal: number;\r\n  discrepancyAmount: number;\r\n  discrepancyPercent: number;\r\n  feeEventsTotal: number;\r\n  customItemsTotal: number;\r\n  lineItemsTotal: number;\r\n  details: string[];\r\n}\r\n\r\n/**\r\n * Validate that an invoice total matches the sum of its linked fee events\r\n *\r\n * Invoice total should equal:\r\n *   SUM(fee_events.computed_amount for linked events) + SUM(custom_line_items.amount)\r\n *\r\n * @param input - Invoice validation input\r\n * @returns Validation result with discrepancy details\r\n */\r\nexport function validateInvoiceTotal(input: InvoiceValidationInput): InvoiceValidationResult {\r\n  const { invoiceTotal, invoiceSubtotal, lines } = input;\r\n  const details: string[] = [];\r\n\r\n  // Calculate totals from line items\r\n  let feeEventsTotal = 0;\r\n  let customItemsTotal = 0;\r\n  let lineItemsTotal = 0;\r\n\r\n  for (const line of lines) {\r\n    const lineAmount = Number(line.amount) || 0;\r\n    lineItemsTotal += lineAmount;\r\n\r\n    if (line.fee_event_id && line.fee_event) {\r\n      // Fee event line - check if line amount matches fee event computed_amount\r\n      const eventAmount = Number(line.fee_event.computed_amount) || 0;\r\n      feeEventsTotal += eventAmount;\r\n\r\n      // Check for line-level discrepancy\r\n      if (Math.abs(lineAmount - eventAmount) > 0.01) {\r\n        details.push(\r\n          `Line for fee event ${line.fee_event_id}: line amount ${formatCurrency(lineAmount)} differs from fee event computed_amount ${formatCurrency(eventAmount)}`\r\n        );\r\n      }\r\n    } else {\r\n      // Custom line item\r\n      customItemsTotal += lineAmount;\r\n    }\r\n  }\r\n\r\n  // Expected total = sum of all line items\r\n  const expectedTotal = lineItemsTotal;\r\n  const discrepancyAmount = Math.abs(invoiceTotal - expectedTotal);\r\n  const discrepancyPercent = expectedTotal > 0\r\n    ? (discrepancyAmount / expectedTotal) * 100\r\n    : (invoiceTotal > 0 ? 100 : 0);\r\n\r\n  // Allow for small rounding differences (within 1 cent)\r\n  const hasDiscrepancy = discrepancyAmount > 0.01;\r\n  const isValid = !hasDiscrepancy;\r\n\r\n  // Add summary details\r\n  if (hasDiscrepancy) {\r\n    details.unshift(\r\n      `Invoice total (${formatCurrency(invoiceTotal)}) does not match sum of line items (${formatCurrency(expectedTotal)}). Discrepancy: ${formatCurrency(discrepancyAmount)} (${discrepancyPercent.toFixed(2)}%)`\r\n    );\r\n  }\r\n\r\n  // Check subtotal vs total (in case tax is applied later)\r\n  if (Math.abs(invoiceTotal - invoiceSubtotal) > 0.01) {\r\n    details.push(\r\n      `Invoice total (${formatCurrency(invoiceTotal)}) differs from subtotal (${formatCurrency(invoiceSubtotal)}) - verify tax calculation if applicable`\r\n    );\r\n  }\r\n\r\n  return {\r\n    isValid,\r\n    hasDiscrepancy,\r\n    expectedTotal,\r\n    actualTotal: invoiceTotal,\r\n    discrepancyAmount,\r\n    discrepancyPercent,\r\n    feeEventsTotal,\r\n    customItemsTotal,\r\n    lineItemsTotal,\r\n    details,\r\n  };\r\n}\r\n","/**\r\n * Fee Plans Tab - List and manage fee structures\r\n */\r\n\r\n'use client';\r\n\r\nimport { useEffect, useState, useCallback } from 'react';\r\nimport { useRouter, useSearchParams } from 'next/navigation';\r\nimport {\r\n  Select,\r\n  SelectContent,\r\n  SelectItem,\r\n  SelectTrigger,\r\n  SelectValue,\r\n} from '@/components/ui/select';\r\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Badge } from '@/components/ui/badge';\r\nimport {\r\n  Table,\r\n  TableBody,\r\n  TableCell,\r\n  TableHead,\r\n  TableHeader,\r\n  TableRow,\r\n} from '@/components/ui/table';\r\nimport {\r\n  AlertDialog,\r\n  AlertDialogAction,\r\n  AlertDialogCancel,\r\n  AlertDialogContent,\r\n  AlertDialogDescription,\r\n  AlertDialogFooter,\r\n  AlertDialogHeader,\r\n  AlertDialogTitle,\r\n} from '@/components/ui/alert-dialog';\r\nimport { Plus, Edit, Copy, FileText, Building2, Trash2, Users, Briefcase, FileCheck, AlertTriangle, ChevronDown, ChevronRight, CheckCircle, Clock, XCircle, Send, FileSignature, Loader2, Eye, Download, Building } from 'lucide-react';\r\nimport { toast } from 'sonner';\r\nimport { Collapsible, CollapsibleContent, CollapsibleTrigger } from '@/components/ui/collapsible';\r\nimport { Tooltip, TooltipContent, TooltipProvider, TooltipTrigger } from '@/components/ui/tooltip';\r\nimport type { FeePlanWithComponents } from '@/lib/fees/types';\r\nimport { formatBps } from '@/lib/fees/calculations';\r\nimport FeePlanEditModal from './FeePlanEditModal';\r\n\r\ninterface FeePlanWithDeal extends FeePlanWithComponents {\r\n  deal?: {\r\n    id: string;\r\n    name: string;\r\n  };\r\n  term_sheet?: {\r\n    id: string;\r\n    version: number;\r\n    status: string;\r\n    subscription_fee_percent?: number | null;\r\n    management_fee_percent?: number | null;\r\n    carried_interest_percent?: number | null;\r\n  } | null;\r\n  introducer?: {\r\n    id: string;\r\n    legal_name: string;\r\n  } | null;\r\n  partner?: {\r\n    id: string;\r\n    name: string;\r\n  } | null;\r\n  commercial_partner?: {\r\n    id: string;\r\n    name: string;\r\n  } | null;\r\n  introducer_agreement?: {\r\n    id: string;\r\n    reference_number: string | null;\r\n    status: string;\r\n    pdf_url: string | null;\r\n  } | null;\r\n  placement_agreement?: {\r\n    id: string;\r\n    reference_number: string | null;\r\n    status: string;\r\n    pdf_url: string | null;\r\n  } | null;\r\n  subscription_count?: number;\r\n  status?: string;\r\n}\r\n\r\n// Map fee component kinds to term sheet fields\r\nconst componentToTermSheetField: Record<string, 'subscription_fee_percent' | 'management_fee_percent' | 'carried_interest_percent'> = {\r\n  subscription: 'subscription_fee_percent',\r\n  management: 'management_fee_percent',\r\n  performance: 'carried_interest_percent',\r\n  carried_interest: 'carried_interest_percent',\r\n};\r\n\r\n// Check if a fee component exceeds term sheet limits\r\nfunction getComponentValidation(\r\n  component: { kind: string; rate_bps?: number | null },\r\n  termSheet?: FeePlanWithDeal['term_sheet']\r\n): { isValid: boolean; message?: string; termSheetLimit?: number } {\r\n  if (!termSheet || !component.rate_bps) {\r\n    return { isValid: true };\r\n  }\r\n\r\n  const fieldName = componentToTermSheetField[component.kind];\r\n  if (!fieldName) {\r\n    return { isValid: true };\r\n  }\r\n\r\n  const termSheetLimit = termSheet[fieldName];\r\n  if (termSheetLimit === null || termSheetLimit === undefined) {\r\n    return { isValid: true };\r\n  }\r\n\r\n  // Convert rate_bps to percent (100 bps = 1%)\r\n  const componentPercent = component.rate_bps / 100;\r\n\r\n  if (componentPercent > termSheetLimit) {\r\n    return {\r\n      isValid: false,\r\n      message: `Exceeds term sheet limit (${termSheetLimit}%)`,\r\n      termSheetLimit,\r\n    };\r\n  }\r\n\r\n  return { isValid: true, termSheetLimit };\r\n}\r\n\r\nconst feePlanStatusStyles: Record<string, string> = {\r\n  draft: 'bg-slate-500/20 text-slate-400',\r\n  sent: 'bg-blue-500/20 text-blue-400',\r\n  pending_signature: 'bg-purple-500/20 text-purple-400',\r\n  accepted: 'bg-green-500/20 text-green-400',\r\n  rejected: 'bg-red-500/20 text-red-400',\r\n};\r\n\r\n// Helper function to render fee plan status badge with consistent styling\r\nfunction getFeePlanStatusBadge(status: string | undefined) {\r\n  const planStatus = status || 'draft';\r\n  switch (planStatus) {\r\n    case 'accepted':\r\n      return (\r\n        <Badge className=\"bg-green-500/20 text-green-400 border-green-500/30\">\r\n          <CheckCircle className=\"h-3 w-3 mr-1\" />\r\n          Accepted\r\n        </Badge>\r\n      );\r\n    case 'sent':\r\n      return (\r\n        <Badge className=\"bg-blue-500/20 text-blue-400 border-blue-500/30\">\r\n          <Send className=\"h-3 w-3 mr-1\" />\r\n          Sent\r\n        </Badge>\r\n      );\r\n    case 'pending_signature':\r\n      return (\r\n        <Badge className=\"bg-amber-500/20 text-amber-400 border-amber-500/30\">\r\n          <Clock className=\"h-3 w-3 mr-1\" />\r\n          Pending Signature\r\n        </Badge>\r\n      );\r\n    case 'rejected':\r\n      return (\r\n        <Badge className=\"bg-red-500/20 text-red-400 border-red-500/30\">\r\n          <XCircle className=\"h-3 w-3 mr-1\" />\r\n          Rejected\r\n        </Badge>\r\n      );\r\n    default:\r\n      return (\r\n        <Badge variant=\"outline\" className=\"border-gray-500/30 text-gray-400\">\r\n          Draft\r\n        </Badge>\r\n      );\r\n  }\r\n}\r\n\r\ninterface Deal {\r\n  id: string;\r\n  name: string;\r\n  status: string;\r\n}\r\n\r\n// Props are now optional - the component manages its own deal selection\r\ninterface FeePlansTabProps {\r\n  // Intentionally empty - deal selection is now internal\r\n}\r\n\r\n// Entity type configuration for grouping fee plans\r\ntype EntityGroup = 'introducers' | 'partners' | 'commercial_partners';\r\nconst entityGroupConfig: Record<EntityGroup, { label: string; icon: typeof Users; iconColor: string }> = {\r\n  introducers: { label: 'Introducers', icon: Users, iconColor: 'text-blue-400' },\r\n  partners: { label: 'Partners', icon: Briefcase, iconColor: 'text-purple-400' },\r\n  commercial_partners: { label: 'Commercial Partners', icon: Building2, iconColor: 'text-green-400' },\r\n};\r\n\r\n// Helper to group fee plans by entity type\r\nfunction groupPlansByEntityType(plans: FeePlanWithDeal[]): Record<EntityGroup, FeePlanWithDeal[]> {\r\n  const groups: Record<EntityGroup, FeePlanWithDeal[]> = {\r\n    introducers: [],\r\n    partners: [],\r\n    commercial_partners: [],\r\n  };\r\n\r\n  for (const plan of plans) {\r\n    if (plan.introducer) {\r\n      groups.introducers.push(plan);\r\n    } else if (plan.partner) {\r\n      groups.partners.push(plan);\r\n    } else if (plan.commercial_partner) {\r\n      groups.commercial_partners.push(plan);\r\n    }\r\n    // Plans without an entity are not shown in grouped view\r\n  }\r\n\r\n  return groups;\r\n}\r\n\r\nexport default function FeePlansTab({}: FeePlansTabProps) {\r\n  const router = useRouter();\r\n  const searchParams = useSearchParams();\r\n\r\n  // Deal selection state (managed internally)\r\n  const [deals, setDeals] = useState<Deal[]>([]);\r\n  const [loadingDeals, setLoadingDeals] = useState(true);\r\n  const dealId = searchParams.get('deal_id') || undefined;\r\n\r\n  const [plans, setPlans] = useState<FeePlanWithDeal[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [viewMode, setViewMode] = useState<'table' | 'cards'>('table');\r\n  const [editModalOpen, setEditModalOpen] = useState(false);\r\n  const [selectedPlan, setSelectedPlan] = useState<FeePlanWithDeal | null>(null);\r\n  const [deleteDialogOpen, setDeleteDialogOpen] = useState(false);\r\n  const [planToDelete, setPlanToDelete] = useState<FeePlanWithDeal | null>(null);\r\n  const [duplicateDialogOpen, setDuplicateDialogOpen] = useState(false);\r\n  const [planToDuplicate, setPlanToDuplicate] = useState<FeePlanWithDeal | null>(null);\r\n  const [expandedGroups, setExpandedGroups] = useState<Record<EntityGroup, boolean>>({\r\n    introducers: true,\r\n    partners: true,\r\n    commercial_partners: true,\r\n  });\r\n  const [generatingAgreement, setGeneratingAgreement] = useState<string | null>(null);\r\n  const [downloadingPdf, setDownloadingPdf] = useState<string | null>(null);\r\n\r\n  // Fetch deals for the selector\r\n  const fetchDeals = useCallback(async () => {\r\n    try {\r\n      const res = await fetch('/api/deals');\r\n      const data = await res.json();\r\n      setDeals(data.deals || []);\r\n    } catch (error) {\r\n      console.error('Error fetching deals:', error);\r\n    } finally {\r\n      setLoadingDeals(false);\r\n    }\r\n  }, []);\r\n\r\n  // Handle deal selection change - updates URL for deep linking\r\n  const handleDealChange = (selectedDealId: string) => {\r\n    const params = new URLSearchParams(searchParams.toString());\r\n\r\n    if (selectedDealId === 'none') {\r\n      params.delete('deal_id');\r\n    } else {\r\n      params.set('deal_id', selectedDealId);\r\n    }\r\n\r\n    router.push(`/versotech_main/fees?${params.toString()}`);\r\n  };\r\n\r\n  useEffect(() => {\r\n    fetchDeals();\r\n  }, [fetchDeals]);\r\n\r\n  useEffect(() => {\r\n    fetchPlans();\r\n  }, [dealId]);\r\n\r\n  const fetchPlans = async () => {\r\n    setLoading(true);\r\n    try {\r\n      // Build API URL with deal filter if provided\r\n      const plansUrl = dealId\r\n        ? `/api/staff/fees/plans?include_components=true&deal_id=${dealId}`\r\n        : '/api/staff/fees/plans?include_components=true';\r\n\r\n      // Fetch plans and deals in parallel\r\n      const [plansRes, dealsRes] = await Promise.all([\r\n        fetch(plansUrl),\r\n        fetch('/api/deals')\r\n      ]);\r\n\r\n      const [plansJson, dealsJson] = await Promise.all([\r\n        plansRes.json(),\r\n        dealsRes.json()\r\n      ]);\r\n\r\n      let plans = plansJson.data || [];\r\n      const allDeals = dealsJson.deals || [];\r\n      const dealsMap = new Map(allDeals.map((d: any) => [d.id, d]));\r\n\r\n      // Filter plans by deal_id on client side as fallback (if API doesn't support filtering)\r\n      if (dealId) {\r\n        plans = plans.filter((plan: any) => plan.deal_id === dealId);\r\n      }\r\n\r\n      // Map deals to plans\r\n      const plansWithDeals = plans.map((plan: any) => ({\r\n        ...plan,\r\n        deal: plan.deal_id ? dealsMap.get(plan.deal_id) : undefined,\r\n      }));\r\n\r\n      setPlans(plansWithDeals);\r\n    } catch (error) {\r\n      console.error('Error fetching fee plans:', error);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleDuplicateClick = (plan: FeePlanWithDeal) => {\r\n    setPlanToDuplicate(plan);\r\n    setDuplicateDialogOpen(true);\r\n  };\r\n\r\n  const handleDuplicateConfirm = async () => {\r\n    if (!planToDuplicate) return;\r\n\r\n    try {\r\n      const res = await fetch(`/api/staff/fees/plans/${planToDuplicate.id}/duplicate`, {\r\n        method: 'POST',\r\n      });\r\n      if (res.ok) {\r\n        const { data: duplicatedPlan } = await res.json();\r\n        await fetchPlans();\r\n        setDuplicateDialogOpen(false);\r\n        setPlanToDuplicate(null);\r\n\r\n        // Open edit modal for the new plan\r\n        if (duplicatedPlan) {\r\n          setSelectedPlan(duplicatedPlan);\r\n          setEditModalOpen(true);\r\n        }\r\n      }\r\n    } catch (error) {\r\n      console.error('Error duplicating plan:', error);\r\n    }\r\n  };\r\n\r\n  const handleCreateNew = () => {\r\n    setSelectedPlan(null);\r\n    setEditModalOpen(true);\r\n  };\r\n\r\n  const handleEdit = (plan: FeePlanWithDeal) => {\r\n    setSelectedPlan(plan);\r\n    setEditModalOpen(true);\r\n  };\r\n\r\n  const handleModalClose = () => {\r\n    setEditModalOpen(false);\r\n    setSelectedPlan(null);\r\n  };\r\n\r\n  const handleModalSuccess = () => {\r\n    fetchPlans();\r\n    handleModalClose();\r\n  };\r\n\r\n  const handleDeleteClick = (plan: FeePlanWithDeal) => {\r\n    setPlanToDelete(plan);\r\n    setDeleteDialogOpen(true);\r\n  };\r\n\r\n  const handleDeleteConfirm = async () => {\r\n    if (!planToDelete) return;\r\n\r\n    try {\r\n      const res = await fetch(`/api/staff/fees/plans/${planToDelete.id}`, {\r\n        method: 'DELETE',\r\n      });\r\n      if (res.ok) {\r\n        fetchPlans();\r\n        setDeleteDialogOpen(false);\r\n        setPlanToDelete(null);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error deleting plan:', error);\r\n    }\r\n  };\r\n\r\n  const toggleGroup = (group: EntityGroup) => {\r\n    setExpandedGroups((prev) => ({ ...prev, [group]: !prev[group] }));\r\n  };\r\n\r\n  // Check if agreement has been generated for this plan\r\n  const hasGeneratedAgreement = (plan: FeePlanWithDeal) => {\r\n    if (plan.introducer && (plan as any).generated_agreement_id) return true;\r\n    if (plan.partner && (plan as any).generated_placement_agreement_id) return true;\r\n    return false;\r\n  };\r\n\r\n  // Check if this plan can have an agreement generated\r\n  const canGenerateAgreement = (plan: FeePlanWithDeal) => {\r\n    // Introducers: need introducer and no existing agreement\r\n    if (plan.introducer && !(plan as any).generated_agreement_id) return true;\r\n    // Partners: need partner and no existing placement agreement\r\n    if (plan.partner && !(plan as any).generated_placement_agreement_id) return true;\r\n    return false;\r\n  };\r\n\r\n  // Get appropriate tooltip for generate button\r\n  const getGenerateTooltip = (plan: FeePlanWithDeal) => {\r\n    if (plan.introducer) return 'Generate Introducer Agreement';\r\n    if (plan.partner) return 'Generate Placement Agreement';\r\n    return '';\r\n  };\r\n\r\n  // Generate Introducer Agreement\r\n  const handleGenerateIntroducerAgreement = async (plan: FeePlanWithDeal) => {\r\n    if (!plan.introducer) return;\r\n\r\n    setGeneratingAgreement(plan.id);\r\n    try {\r\n      const res = await fetch(`/api/staff/fees/plans/${plan.id}/generate-agreement`, {\r\n        method: 'POST',\r\n      });\r\n\r\n      if (!res.ok) {\r\n        const data = await res.json();\r\n        toast.error(`Failed to generate agreement: ${data.error || 'Unknown error'}`);\r\n        return;\r\n      }\r\n\r\n      toast.success('Introducer Agreement generated successfully!');\r\n      fetchPlans();\r\n    } catch (error) {\r\n      console.error('Error generating introducer agreement:', error);\r\n      toast.error('Failed to generate agreement');\r\n    } finally {\r\n      setGeneratingAgreement(null);\r\n    }\r\n  };\r\n\r\n  // Generate Partner Placement Agreement\r\n  const handleGeneratePartnerAgreement = async (plan: FeePlanWithDeal) => {\r\n    if (!plan.partner) return;\r\n\r\n    setGeneratingAgreement(plan.id);\r\n    try {\r\n      const res = await fetch(`/api/staff/fees/plans/${plan.id}/generate-placement-agreement`, {\r\n        method: 'POST',\r\n      });\r\n\r\n      if (!res.ok) {\r\n        const data = await res.json();\r\n        toast.error(`Failed to generate placement agreement: ${data.error || 'Unknown error'}`);\r\n        return;\r\n      }\r\n\r\n      toast.success('Placement Agreement generated successfully!');\r\n      fetchPlans();\r\n    } catch (error) {\r\n      console.error('Error generating placement agreement:', error);\r\n      toast.error('Failed to generate placement agreement');\r\n    } finally {\r\n      setGeneratingAgreement(null);\r\n    }\r\n  };\r\n\r\n  // Unified handler that routes to correct agreement type\r\n  const handleGenerateAgreement = async (plan: FeePlanWithDeal) => {\r\n    if (plan.introducer) {\r\n      await handleGenerateIntroducerAgreement(plan);\r\n    } else if (plan.partner) {\r\n      await handleGeneratePartnerAgreement(plan);\r\n    }\r\n  };\r\n\r\n  // Get PDF URL from agreement (introducer or placement)\r\n  const getAgreementPdfInfo = (plan: FeePlanWithDeal): { pdfUrl: string | null; referenceNumber: string | null } => {\r\n    if (plan.introducer_agreement?.pdf_url) {\r\n      return {\r\n        pdfUrl: plan.introducer_agreement.pdf_url,\r\n        referenceNumber: plan.introducer_agreement.reference_number\r\n      };\r\n    }\r\n    if (plan.placement_agreement?.pdf_url) {\r\n      return {\r\n        pdfUrl: plan.placement_agreement.pdf_url,\r\n        referenceNumber: plan.placement_agreement.reference_number\r\n      };\r\n    }\r\n    return { pdfUrl: null, referenceNumber: null };\r\n  };\r\n\r\n  // Handle PDF download from Supabase storage\r\n  const handleDownloadPdf = async (pdfUrl: string, referenceNumber: string | null) => {\r\n    setDownloadingPdf(pdfUrl);\r\n    try {\r\n      const response = await fetch(`/api/storage/download?path=${encodeURIComponent(pdfUrl)}&bucket=deal-documents`);\r\n      if (!response.ok) {\r\n        throw new Error('Failed to download file');\r\n      }\r\n      const blob = await response.blob();\r\n      const url = window.URL.createObjectURL(blob);\r\n      const link = document.createElement('a');\r\n      link.href = url;\r\n      // Extract actual filename from storage path, or fall back to reference number\r\n      const actualFilename = pdfUrl.split('/').pop() || `${referenceNumber || 'agreement'}.pdf`;\r\n      link.download = actualFilename;\r\n      document.body.appendChild(link);\r\n      link.click();\r\n      document.body.removeChild(link);\r\n      window.URL.revokeObjectURL(url);\r\n      toast.success('PDF downloaded successfully');\r\n    } catch (error) {\r\n      console.error('Error downloading PDF:', error);\r\n      toast.error('Failed to download PDF');\r\n    } finally {\r\n      setDownloadingPdf(null);\r\n    }\r\n  };\r\n\r\n  // Handle PDF preview in new tab\r\n  const handlePreviewPdf = async (pdfUrl: string) => {\r\n    try {\r\n      const response = await fetch(`/api/storage/download?path=${encodeURIComponent(pdfUrl)}&bucket=deal-documents`);\r\n      if (!response.ok) {\r\n        throw new Error('Failed to load file');\r\n      }\r\n      const blob = await response.blob();\r\n      const url = window.URL.createObjectURL(blob);\r\n      window.open(url, '_blank');\r\n    } catch (error) {\r\n      console.error('Error previewing PDF:', error);\r\n      toast.error('Failed to preview PDF');\r\n    }\r\n  };\r\n\r\n  // Group plans by entity type for the grouped view\r\n  const groupedPlans = groupPlansByEntityType(plans);\r\n\r\n  if (loading) {\r\n    return <div className=\"text-white\">Loading fee plans...</div>;\r\n  }\r\n\r\n  // Get selected deal info for display\r\n  const selectedDeal = deals.find((d) => d.id === dealId);\r\n\r\n  // Deal selector component (reused in both views)\r\n  const DealSelector = () => (\r\n    <div className=\"flex items-center gap-4\">\r\n      <div className=\"flex items-center gap-2\">\r\n        <Building2 className=\"h-5 w-5 text-muted-foreground\" />\r\n        <span className=\"text-sm font-medium\">Deal:</span>\r\n      </div>\r\n      <Select\r\n        value={dealId || 'none'}\r\n        onValueChange={handleDealChange}\r\n        disabled={loadingDeals}\r\n      >\r\n        <SelectTrigger className=\"w-[350px]\">\r\n          {loadingDeals ? (\r\n            <div className=\"flex items-center gap-2\">\r\n              <Loader2 className=\"h-4 w-4 animate-spin\" />\r\n              <span>Loading deals...</span>\r\n            </div>\r\n          ) : (\r\n            <SelectValue placeholder=\"Select a deal to view fee plans\" />\r\n          )}\r\n        </SelectTrigger>\r\n        <SelectContent>\r\n          <SelectItem value=\"none\">\r\n            <span className=\"text-muted-foreground\">Select a deal to view fee plans</span>\r\n          </SelectItem>\r\n          {deals.map((deal) => (\r\n            <SelectItem key={deal.id} value={deal.id}>\r\n              <div className=\"flex items-center gap-2\">\r\n                <span>{deal.name}</span>\r\n                <span className=\"text-xs text-muted-foreground capitalize\">\r\n                  ({deal.status})\r\n                </span>\r\n              </div>\r\n            </SelectItem>\r\n          ))}\r\n        </SelectContent>\r\n      </Select>\r\n      {selectedDeal && (\r\n        <span className=\"text-sm text-muted-foreground\">\r\n          Viewing fee plans for: <strong>{selectedDeal.name}</strong>\r\n        </span>\r\n      )}\r\n    </div>\r\n  );\r\n\r\n  // Show prompt if no deal is selected\r\n  if (!dealId) {\r\n    return (\r\n      <div className=\"space-y-6\">\r\n        <div className=\"flex items-center justify-between\">\r\n          <div>\r\n            <h2 className=\"text-2xl font-bold text-white\">Fee Plans</h2>\r\n            <p className=\"text-gray-400\">\r\n              Manage fee structure templates for a specific deal\r\n            </p>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Deal Selector */}\r\n        <DealSelector />\r\n\r\n        <Card>\r\n          <CardContent className=\"py-10 text-center\">\r\n            <Building2 className=\"h-12 w-12 text-muted-foreground mx-auto mb-4\" />\r\n            <h3 className=\"text-lg font-medium text-foreground mb-2\">Select a deal to view fee plans</h3>\r\n            <p className=\"text-muted-foreground\">\r\n              Use the deal selector above to choose a deal and view its associated fee plans.\r\n            </p>\r\n          </CardContent>\r\n        </Card>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      <div className=\"flex items-center justify-between\">\r\n        <div>\r\n          <h2 className=\"text-2xl font-bold text-white\">Fee Plans</h2>\r\n          <p className=\"text-gray-400\">\r\n            Manage fee structure templates for this deal\r\n          </p>\r\n        </div>\r\n        <div className=\"flex gap-2\">\r\n          <Button variant=\"outline\" onClick={() => setViewMode(viewMode === 'table' ? 'cards' : 'table')}>\r\n            {viewMode === 'table' ? 'Card View' : 'Table View'}\r\n          </Button>\r\n          <Button onClick={handleCreateNew}>\r\n            <Plus className=\"mr-2 h-4 w-4\" />\r\n            Create Fee Plan\r\n          </Button>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Deal Selector */}\r\n      <DealSelector />\r\n\r\n      {/* Explanation Card */}\r\n      <Card className=\"bg-blue-500/10 border-blue-500/30\">\r\n        <CardContent className=\"pt-6\">\r\n          <p className=\"text-sm text-gray-300 leading-relaxed\">\r\n            <strong className=\"text-blue-400\">How Fee Plans Work:</strong> Fee plans are commercial agreements with introducers/partners.\r\n            Each fee plan must be linked to a <strong>published term sheet</strong> and an <strong>entity</strong> (introducer, partner, or commercial partner).\r\n            Fee values cannot exceed the limits set in the term sheet. When an entity accepts a fee plan, investors can be dispatched through them.\r\n          </p>\r\n        </CardContent>\r\n      </Card>\r\n\r\n      {plans.length === 0 ? (\r\n        <Card>\r\n          <CardContent className=\"py-10 text-center\">\r\n            <p className=\"text-gray-400 mb-4\">No fee plans created yet</p>\r\n            <Button onClick={handleCreateNew}>\r\n              <Plus className=\"mr-2 h-4 w-4\" />\r\n              Create Your First Fee Plan\r\n            </Button>\r\n          </CardContent>\r\n        </Card>\r\n      ) : (\r\n        <div className=\"space-y-4\">\r\n          {/* Grouped Fee Plans by Entity Type */}\r\n          {(Object.entries(entityGroupConfig) as [EntityGroup, typeof entityGroupConfig[EntityGroup]][]).map(\r\n            ([groupKey, config]) => {\r\n              const GroupIcon = config.icon;\r\n              const groupPlans = groupedPlans[groupKey];\r\n              const isExpanded = expandedGroups[groupKey];\r\n\r\n              return (\r\n                <Collapsible\r\n                  key={groupKey}\r\n                  open={isExpanded}\r\n                  onOpenChange={() => toggleGroup(groupKey)}\r\n                >\r\n                  <Card>\r\n                    <CollapsibleTrigger asChild>\r\n                      <CardHeader className=\"cursor-pointer hover:bg-white/5 transition-colors\">\r\n                        <div className=\"flex items-center justify-between\">\r\n                          <div className=\"flex items-center gap-3\">\r\n                            <GroupIcon className={`h-5 w-5 ${config.iconColor}`} />\r\n                            <CardTitle className=\"text-lg\">\r\n                              {config.label} ({groupPlans.length})\r\n                            </CardTitle>\r\n                          </div>\r\n                          {isExpanded ? (\r\n                            <ChevronDown className=\"h-5 w-5 text-muted-foreground\" />\r\n                          ) : (\r\n                            <ChevronRight className=\"h-5 w-5 text-muted-foreground\" />\r\n                          )}\r\n                        </div>\r\n                      </CardHeader>\r\n                    </CollapsibleTrigger>\r\n                    <CollapsibleContent>\r\n                      <CardContent className=\"pt-0\">\r\n                        {groupPlans.length === 0 ? (\r\n                          <div className=\"py-6 text-center text-muted-foreground\">\r\n                            No fee plans\r\n                          </div>\r\n                        ) : viewMode === 'table' ? (\r\n                          <Table>\r\n                            <TableHeader>\r\n                              <TableRow>\r\n                                <TableHead>Plan Name</TableHead>\r\n                                <TableHead>Entity</TableHead>\r\n                                <TableHead>Term Sheet</TableHead>\r\n                                <TableHead>Fee Components</TableHead>\r\n                                <TableHead>Status</TableHead>\r\n                                <TableHead className=\"text-right\">Actions</TableHead>\r\n                              </TableRow>\r\n                            </TableHeader>\r\n                            <TableBody>\r\n                              {groupPlans.map((plan) => (\r\n                                <TableRow key={plan.id}>\r\n                                  <TableCell>\r\n                                    <div className=\"flex items-center gap-2\">\r\n                                      <FileText className=\"h-4 w-4 text-muted-foreground\" />\r\n                                      <div>\r\n                                        <div className=\"font-medium\">{plan.name}</div>\r\n                                        {plan.description && (\r\n                                          <div className=\"text-sm text-muted-foreground\">\r\n                                            {plan.description}\r\n                                          </div>\r\n                                        )}\r\n                                      </div>\r\n                                    </div>\r\n                                  </TableCell>\r\n                                  <TableCell>\r\n                                    <div className=\"flex items-center gap-2\">\r\n                                      <GroupIcon className={`h-4 w-4 ${config.iconColor}`} />\r\n                                      <span>\r\n                                        {plan.introducer?.legal_name ||\r\n                                          plan.partner?.name ||\r\n                                          plan.commercial_partner?.name}\r\n                                      </span>\r\n                                    </div>\r\n                                  </TableCell>\r\n                                  <TableCell>\r\n                                    {plan.term_sheet ? (\r\n                                      <div className=\"flex items-center gap-2\">\r\n                                        <FileCheck className=\"h-3 w-3 text-muted-foreground\" />\r\n                                        <span className=\"text-sm text-muted-foreground\">\r\n                                          v{plan.term_sheet.version}\r\n                                        </span>\r\n                                      </div>\r\n                                    ) : (\r\n                                      <span className=\"text-sm text-muted-foreground\">\r\n                                        No term sheet\r\n                                      </span>\r\n                                    )}\r\n                                  </TableCell>\r\n                                  <TableCell>\r\n                                    <TooltipProvider>\r\n                                      <div className=\"flex flex-wrap gap-1\">\r\n                                        {plan.components?.map((comp) => {\r\n                                          const validation = getComponentValidation(\r\n                                            comp,\r\n                                            plan.term_sheet\r\n                                          );\r\n                                          return (\r\n                                            <Tooltip key={comp.id}>\r\n                                              <TooltipTrigger asChild>\r\n                                                <Badge\r\n                                                  variant=\"outline\"\r\n                                                  className={`text-xs ${\r\n                                                    !validation.isValid\r\n                                                      ? 'border-red-500/50 bg-red-500/10'\r\n                                                      : ''\r\n                                                  }`}\r\n                                                >\r\n                                                  {!validation.isValid && (\r\n                                                    <AlertTriangle className=\"h-3 w-3 mr-1 text-red-400\" />\r\n                                                  )}\r\n                                                  {comp.kind}:{' '}\r\n                                                  {comp.rate_bps\r\n                                                    ? formatBps(comp.rate_bps)\r\n                                                    : comp.flat_amount\r\n                                                    ? `$${comp.flat_amount}`\r\n                                                    : 'N/A'}\r\n                                                </Badge>\r\n                                              </TooltipTrigger>\r\n                                              {!validation.isValid && (\r\n                                                <TooltipContent className=\"bg-red-900 border-red-700\">\r\n                                                  <p className=\"text-red-200\">\r\n                                                    {validation.message}\r\n                                                  </p>\r\n                                                </TooltipContent>\r\n                                              )}\r\n                                            </Tooltip>\r\n                                          );\r\n                                        })}\r\n                                      </div>\r\n                                    </TooltipProvider>\r\n                                  </TableCell>\r\n                                  <TableCell>\r\n                                    <div className=\"flex flex-wrap gap-1\">\r\n                                      {getFeePlanStatusBadge(plan.status)}\r\n                                    </div>\r\n                                  </TableCell>\r\n                                  <TableCell className=\"text-right\">\r\n                                    <div className=\"flex gap-1 justify-end items-center\">\r\n                                      {/* Generate Agreement button */}\r\n                                      {canGenerateAgreement(plan) && (\r\n                                        <Button\r\n                                          variant=\"ghost\"\r\n                                          size=\"sm\"\r\n                                          onClick={() => handleGenerateAgreement(plan)}\r\n                                          disabled={generatingAgreement === plan.id}\r\n                                          className=\"text-green-400 hover:text-green-300\"\r\n                                          title={getGenerateTooltip(plan)}\r\n                                        >\r\n                                          {generatingAgreement === plan.id ? (\r\n                                            <Loader2 className=\"h-4 w-4 animate-spin\" />\r\n                                          ) : (\r\n                                            <FileSignature className=\"h-4 w-4\" />\r\n                                          )}\r\n                                        </Button>\r\n                                      )}\r\n                                      {hasGeneratedAgreement(plan) && (\r\n                                        <Badge className=\"bg-green-500/20 text-green-400 border-green-500/30 text-xs\">\r\n                                          Agreement\r\n                                        </Badge>\r\n                                      )}\r\n                                      {/* PDF Preview/Download buttons */}\r\n                                      {(() => {\r\n                                        const { pdfUrl, referenceNumber } = getAgreementPdfInfo(plan);\r\n                                        if (!pdfUrl) return null;\r\n                                        return (\r\n                                          <>\r\n                                            <Button\r\n                                              variant=\"ghost\"\r\n                                              size=\"sm\"\r\n                                              onClick={() => handlePreviewPdf(pdfUrl)}\r\n                                              className=\"text-blue-400 hover:text-blue-300\"\r\n                                              title=\"Preview PDF\"\r\n                                            >\r\n                                              <Eye className=\"h-4 w-4\" />\r\n                                            </Button>\r\n                                            <Button\r\n                                              variant=\"ghost\"\r\n                                              size=\"sm\"\r\n                                              onClick={() => handleDownloadPdf(pdfUrl, referenceNumber)}\r\n                                              disabled={downloadingPdf === pdfUrl}\r\n                                              className=\"text-green-400 hover:text-green-300\"\r\n                                              title=\"Download PDF\"\r\n                                            >\r\n                                              {downloadingPdf === pdfUrl ? (\r\n                                                <Loader2 className=\"h-4 w-4 animate-spin\" />\r\n                                              ) : (\r\n                                                <Download className=\"h-4 w-4\" />\r\n                                              )}\r\n                                            </Button>\r\n                                          </>\r\n                                        );\r\n                                      })()}\r\n                                      <Button\r\n                                        variant=\"ghost\"\r\n                                        size=\"sm\"\r\n                                        onClick={() => handleEdit(plan)}\r\n                                      >\r\n                                        <Edit className=\"h-4 w-4\" />\r\n                                      </Button>\r\n                                      <Button\r\n                                        variant=\"ghost\"\r\n                                        size=\"sm\"\r\n                                        onClick={() => handleDuplicateClick(plan)}\r\n                                      >\r\n                                        <Copy className=\"h-4 w-4\" />\r\n                                      </Button>\r\n                                      <Button\r\n                                        variant=\"ghost\"\r\n                                        size=\"sm\"\r\n                                        onClick={() => handleDeleteClick(plan)}\r\n                                      >\r\n                                        <Trash2 className=\"h-4 w-4 text-red-500\" />\r\n                                      </Button>\r\n                                    </div>\r\n                                  </TableCell>\r\n                                </TableRow>\r\n                              ))}\r\n                            </TableBody>\r\n                          </Table>\r\n                        ) : (\r\n                          <div className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-3\">\r\n                            {groupPlans.map((plan) => (\r\n                              <Card key={plan.id} className=\"bg-white/5 border-white/10\">\r\n                                <CardHeader className=\"pb-2\">\r\n                                  <div className=\"flex items-start justify-between\">\r\n                                    <div className=\"flex-1\">\r\n                                      <div className=\"flex items-center gap-2 mb-1\">\r\n                                        <CardTitle className=\"text-lg\">{plan.name}</CardTitle>\r\n                                        {getFeePlanStatusBadge(plan.status)}\r\n                                      </div>\r\n                                      <div className=\"flex items-center gap-2 text-sm text-muted-foreground\">\r\n                                        <GroupIcon className={`h-4 w-4 ${config.iconColor}`} />\r\n                                        <span>\r\n                                          {plan.introducer?.legal_name ||\r\n                                            plan.partner?.name ||\r\n                                            plan.commercial_partner?.name}\r\n                                        </span>\r\n                                      </div>\r\n                                    </div>\r\n                                    <div className=\"flex gap-1 items-center\">\r\n                                      {/* Generate Agreement button */}\r\n                                      {canGenerateAgreement(plan) && (\r\n                                        <Button\r\n                                          variant=\"ghost\"\r\n                                          size=\"icon\"\r\n                                          onClick={() => handleGenerateAgreement(plan)}\r\n                                          disabled={generatingAgreement === plan.id}\r\n                                          className=\"text-green-400 hover:text-green-300\"\r\n                                          title={getGenerateTooltip(plan)}\r\n                                        >\r\n                                          {generatingAgreement === plan.id ? (\r\n                                            <Loader2 className=\"h-4 w-4 animate-spin\" />\r\n                                          ) : (\r\n                                            <FileSignature className=\"h-4 w-4\" />\r\n                                          )}\r\n                                        </Button>\r\n                                      )}\r\n                                      {hasGeneratedAgreement(plan) && (\r\n                                        <Badge className=\"bg-green-500/20 text-green-400 border-green-500/30 text-xs\">\r\n                                          Agreement\r\n                                        </Badge>\r\n                                      )}\r\n                                      <Button\r\n                                        variant=\"ghost\"\r\n                                        size=\"icon\"\r\n                                        onClick={() => handleEdit(plan)}\r\n                                      >\r\n                                        <Edit className=\"h-4 w-4\" />\r\n                                      </Button>\r\n                                      <Button\r\n                                        variant=\"ghost\"\r\n                                        size=\"icon\"\r\n                                        onClick={() => handleDuplicateClick(plan)}\r\n                                      >\r\n                                        <Copy className=\"h-4 w-4\" />\r\n                                      </Button>\r\n                                      <Button\r\n                                        variant=\"ghost\"\r\n                                        size=\"icon\"\r\n                                        onClick={() => handleDeleteClick(plan)}\r\n                                      >\r\n                                        <Trash2 className=\"h-4 w-4 text-red-500\" />\r\n                                      </Button>\r\n                                    </div>\r\n                                  </div>\r\n                                </CardHeader>\r\n                                <CardContent>\r\n                                  {plan.description && (\r\n                                    <p className=\"text-sm text-muted-foreground mb-3\">\r\n                                      {plan.description}\r\n                                    </p>\r\n                                  )}\r\n                                  <TooltipProvider>\r\n                                    <div className=\"space-y-2\">\r\n                                      {plan.components?.map((comp) => {\r\n                                        const validation = getComponentValidation(\r\n                                          comp,\r\n                                          plan.term_sheet\r\n                                        );\r\n                                        return (\r\n                                          <div\r\n                                            key={comp.id}\r\n                                            className={`text-sm flex justify-between items-center ${\r\n                                              !validation.isValid ? 'text-red-400' : ''\r\n                                            }`}\r\n                                          >\r\n                                            <span className=\"capitalize flex items-center gap-1\">\r\n                                              {!validation.isValid && (\r\n                                                <Tooltip>\r\n                                                  <TooltipTrigger>\r\n                                                    <AlertTriangle className=\"h-3 w-3 text-red-400\" />\r\n                                                  </TooltipTrigger>\r\n                                                  <TooltipContent className=\"bg-red-900 border-red-700\">\r\n                                                    <p className=\"text-red-200\">\r\n                                                      {validation.message}\r\n                                                    </p>\r\n                                                  </TooltipContent>\r\n                                                </Tooltip>\r\n                                              )}\r\n                                              {comp.kind}\r\n                                            </span>\r\n                                            <span className=\"font-medium\">\r\n                                              {comp.rate_bps\r\n                                                ? formatBps(comp.rate_bps)\r\n                                                : comp.flat_amount\r\n                                                ? `$${comp.flat_amount}`\r\n                                                : 'N/A'}\r\n                                            </span>\r\n                                          </div>\r\n                                        );\r\n                                      })}\r\n                                    </div>\r\n                                  </TooltipProvider>\r\n\r\n                                  {/* Agreement Document Section */}\r\n                                  {(() => {\r\n                                    const { pdfUrl, referenceNumber } = getAgreementPdfInfo(plan);\r\n                                    if (!pdfUrl) return null;\r\n\r\n                                    return (\r\n                                      <div className=\"mt-4 pt-4 border-t border-white/10\">\r\n                                        <div className=\"flex items-center justify-between\">\r\n                                          <div className=\"flex items-center gap-3\">\r\n                                            <div className=\"p-2 rounded-lg bg-green-500/10\">\r\n                                              <FileText className=\"h-5 w-5 text-green-400\" />\r\n                                            </div>\r\n                                            <div>\r\n                                              <p className=\"text-sm font-medium text-foreground\">\r\n                                                {plan.introducer ? 'Introducer Agreement' : 'Placement Agreement'}\r\n                                              </p>\r\n                                              <p className=\"text-xs text-muted-foreground\">\r\n                                                {referenceNumber || 'Document ready'}\r\n                                              </p>\r\n                                            </div>\r\n                                          </div>\r\n                                          <div className=\"flex items-center gap-2\">\r\n                                            <Button\r\n                                              variant=\"outline\"\r\n                                              size=\"sm\"\r\n                                              onClick={() => handlePreviewPdf(pdfUrl)}\r\n                                              className=\"text-blue-400 border-blue-400/30 hover:bg-blue-400/10\"\r\n                                            >\r\n                                              <Eye className=\"h-4 w-4 mr-1\" />\r\n                                              Preview\r\n                                            </Button>\r\n                                            <Button\r\n                                              variant=\"outline\"\r\n                                              size=\"sm\"\r\n                                              onClick={() => handleDownloadPdf(pdfUrl, referenceNumber)}\r\n                                              disabled={downloadingPdf === pdfUrl}\r\n                                              className=\"text-green-400 border-green-400/30 hover:bg-green-400/10\"\r\n                                            >\r\n                                              {downloadingPdf === pdfUrl ? (\r\n                                                <Loader2 className=\"h-4 w-4 mr-1 animate-spin\" />\r\n                                              ) : (\r\n                                                <Download className=\"h-4 w-4 mr-1\" />\r\n                                              )}\r\n                                              Download\r\n                                            </Button>\r\n                                          </div>\r\n                                        </div>\r\n                                      </div>\r\n                                    );\r\n                                  })()}\r\n                                </CardContent>\r\n                              </Card>\r\n                            ))}\r\n                          </div>\r\n                        )}\r\n                      </CardContent>\r\n                    </CollapsibleContent>\r\n                  </Card>\r\n                </Collapsible>\r\n              );\r\n            }\r\n          )}\r\n        </div>\r\n      )}\r\n\r\n      {/* Edit Modal */}\r\n      <FeePlanEditModal\r\n        open={editModalOpen}\r\n        onClose={handleModalClose}\r\n        onSuccess={handleModalSuccess}\r\n        feePlan={selectedPlan}\r\n      />\r\n\r\n      {/* Duplicate Confirmation Dialog */}\r\n      <AlertDialog open={duplicateDialogOpen} onOpenChange={setDuplicateDialogOpen}>\r\n        <AlertDialogContent>\r\n          <AlertDialogHeader>\r\n            <AlertDialogTitle>Duplicate Fee Plan?</AlertDialogTitle>\r\n            <AlertDialogDescription asChild>\r\n              <div className=\"space-y-3\">\r\n                <div>\r\n                  Create a copy of <strong>{planToDuplicate?.name}</strong> with all fee components.\r\n                </div>\r\n                <div>\r\n                  This is useful for:\r\n                </div>\r\n                <ul className=\"list-disc list-inside space-y-1 ml-2\">\r\n                  <li>Creating a similar plan for a new deal</li>\r\n                  <li>Testing modifications without affecting the original</li>\r\n                  <li>Creating variations for special investor terms</li>\r\n                </ul>\r\n                <div className=\"text-muted-foreground\">\r\n                  After duplication, you'll be able to immediately edit the new plan.\r\n                </div>\r\n              </div>\r\n            </AlertDialogDescription>\r\n          </AlertDialogHeader>\r\n          <AlertDialogFooter>\r\n            <AlertDialogCancel>Cancel</AlertDialogCancel>\r\n            <AlertDialogAction onClick={handleDuplicateConfirm}>\r\n              Duplicate & Edit\r\n            </AlertDialogAction>\r\n          </AlertDialogFooter>\r\n        </AlertDialogContent>\r\n      </AlertDialog>\r\n\r\n      {/* Delete Confirmation Dialog */}\r\n      <AlertDialog open={deleteDialogOpen} onOpenChange={setDeleteDialogOpen}>\r\n        <AlertDialogContent>\r\n          <AlertDialogHeader>\r\n            <AlertDialogTitle>Delete Fee Plan?</AlertDialogTitle>\r\n            <AlertDialogDescription asChild>\r\n              <div className=\"space-y-3\">\r\n                <div>\r\n                  Are you sure you want to delete <strong>{planToDelete?.name}</strong>?\r\n                </div>\r\n                {planToDelete && planToDelete.subscription_count && planToDelete.subscription_count > 0 ? (\r\n                  <div className=\"text-yellow-500\">\r\n                    ⚠️ This fee plan is used by {planToDelete.subscription_count} subscription\r\n                    {planToDelete.subscription_count !== 1 ? 's' : ''}. Deleting it won't affect those\r\n                    subscriptions, but you won't be able to apply this plan to new deals.\r\n                  </div>\r\n                ) : (\r\n                  <div>This fee plan is not currently used by any subscriptions.</div>\r\n                )}\r\n                {planToDelete?.is_default && (\r\n                  <div className=\"text-red-500\">\r\n                    ⚠️ This is the default fee plan for {planToDelete?.deal?.name || 'this deal'}.\r\n                    You may want to set another plan as default before deleting this one.\r\n                  </div>\r\n                )}\r\n              </div>\r\n            </AlertDialogDescription>\r\n          </AlertDialogHeader>\r\n          <AlertDialogFooter>\r\n            <AlertDialogCancel>Cancel</AlertDialogCancel>\r\n            <AlertDialogAction\r\n              onClick={handleDeleteConfirm}\r\n              className=\"bg-red-500 hover:bg-red-600\"\r\n            >\r\n              Delete\r\n            </AlertDialogAction>\r\n          </AlertDialogFooter>\r\n        </AlertDialogContent>\r\n      </AlertDialog>\r\n    </div>\r\n  );\r\n}\r\n","/**\r\n * Invoices Tab - Manage invoices and payments\r\n */\r\n\r\n'use client';\r\n\r\nimport { useEffect, useState, useCallback } from 'react';\r\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Badge } from '@/components/ui/badge';\r\nimport { Plus, Send, DollarSign, X, FileText, AlertCircle, AlertTriangle, RefreshCw, Loader2 } from 'lucide-react';\r\nimport { Popover, PopoverContent, PopoverTrigger } from '@/components/ui/popover';\r\nimport type { InvoiceWithLines } from '@/lib/fees/types';\r\nimport { formatCurrency } from '@/lib/fees/calculations';\r\nimport { GenerateInvoiceModal } from './GenerateInvoiceModal';\r\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\r\n\r\nconst statusColors = {\r\n  draft: 'secondary',\r\n  sent: 'default',\r\n  paid: 'default',\r\n  partially_paid: 'default',\r\n  overdue: 'destructive',\r\n  cancelled: 'secondary',\r\n  disputed: 'destructive',\r\n} as const;\r\n\r\ninterface FeeEvent {\r\n  id: string;\r\n  fee_type: string;\r\n  computed_amount: number;\r\n  event_date: string;\r\n  status: string;\r\n  allocation_id?: string;\r\n  investor?: {\r\n    id: string;\r\n    legal_name: string;\r\n    display_name: string;\r\n  };\r\n  deal?: {\r\n    id: string;\r\n    name: string;\r\n  };\r\n  subscription?: {\r\n    id: string;\r\n    subscription_number: string;\r\n    commitment: number;\r\n    vehicle?: {\r\n      id: string;\r\n      name: string;\r\n      short_name?: string;\r\n    };\r\n  };\r\n}\r\n\r\nexport default function InvoicesTab() {\r\n  const [invoices, setInvoices] = useState<InvoiceWithLines[]>([]);\r\n  const [feeEvents, setFeeEvents] = useState<FeeEvent[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [filter, setFilter] = useState('all');\r\n  const [showGenerateModal, setShowGenerateModal] = useState(false);\r\n  const [selectedInvestorId, setSelectedInvestorId] = useState<string | undefined>(undefined);\r\n  const [backfillLoading, setBackfillLoading] = useState(false);\r\n\r\n  const fetchInvoices = useCallback(async () => {\r\n    try {\r\n      const url = filter === 'all'\r\n        ? '/api/staff/fees/invoices?limit=100&offset=0'\r\n        : `/api/staff/fees/invoices?status=${filter}&limit=100&offset=0`;\r\n      const res = await fetch(url);\r\n      const json = await res.json();\r\n      setInvoices(json.data || []);\r\n    } catch (error) {\r\n      console.error('Error fetching invoices:', error);\r\n    }\r\n  }, [filter]);\r\n\r\n  const fetchFeeEvents = useCallback(async () => {\r\n    try {\r\n      const res = await fetch('/api/staff/fees/events?status=accrued&limit=100&offset=0');\r\n      const json = await res.json();\r\n      console.log('[InvoicesTab] Fee events fetched:', json.data?.length || 0, 'events');\r\n      if (json.data?.length > 0) {\r\n        console.log('[InvoicesTab] First fee event:', json.data[0]);\r\n        console.log('[InvoicesTab] First investor data:', json.data[0]?.investor);\r\n      }\r\n      setFeeEvents(json.data || []);\r\n    } catch (error) {\r\n      console.error('Error fetching fee events:', error);\r\n    }\r\n  }, []);\r\n\r\n  const fetchData = useCallback(async () => {\r\n    setLoading(true);\r\n    await Promise.all([fetchInvoices(), fetchFeeEvents()]);\r\n    setLoading(false);\r\n  }, [fetchInvoices, fetchFeeEvents]);\r\n\r\n  useEffect(() => {\r\n    fetchData();\r\n  }, [fetchData]);\r\n\r\n  const handleSend = async (invoiceId: string) => {\r\n    try {\r\n      const res = await fetch(`/api/staff/fees/invoices/${invoiceId}/send`, {\r\n        method: 'POST',\r\n      });\r\n\r\n      const data = await res.json();\r\n\r\n      if (res.ok) {\r\n        // Success - invoice was sent and status updated\r\n        alert(data.message || 'Invoice sent successfully');\r\n        fetchInvoices();\r\n      } else {\r\n        // Failed - show error message\r\n        console.error('Error sending invoice:', data);\r\n        alert(data.error + (data.details ? `\\n\\n${data.details}` : ''));\r\n      }\r\n    } catch (error) {\r\n      console.error('Error sending invoice:', error);\r\n      alert('Failed to send invoice. Please try again.');\r\n    }\r\n  };\r\n\r\n  const handleMarkPaid = async (invoiceId: string, amount: number) => {\r\n    try {\r\n      const res = await fetch(`/api/staff/fees/invoices/${invoiceId}/mark-paid`, {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({ paid_amount: amount }),\r\n      });\r\n      if (res.ok) {\r\n        fetchInvoices();\r\n      }\r\n    } catch (error) {\r\n      console.error('Error marking invoice as paid:', error);\r\n    }\r\n  };\r\n\r\n  const handleBackfillFeeEvents = async () => {\r\n    if (!confirm('This will calculate fee events for all existing committed subscriptions that don\\'t have fee events yet. Continue?')) {\r\n      return;\r\n    }\r\n\r\n    setBackfillLoading(true);\r\n    try {\r\n      const res = await fetch('/api/staff/fees/events/backfill', {\r\n        method: 'POST',\r\n      });\r\n\r\n      const result = await res.json();\r\n\r\n      if (res.ok) {\r\n        alert(`Backfill complete!\\n\\nProcessed: ${result.results.processed}\\nSkipped: ${result.results.skipped}\\nFailed: ${result.results.failed}\\nTotal Fee Events Created: ${result.results.created_events}`);\r\n        fetchData(); // Refresh data\r\n      } else {\r\n        alert(`Backfill failed: ${result.error}`);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error running backfill:', error);\r\n      alert('Failed to run backfill');\r\n    } finally {\r\n      setBackfillLoading(false);\r\n    }\r\n  };\r\n\r\n  if (loading) {\r\n    return <div>Loading...</div>;\r\n  }\r\n\r\n  // Group fee events by investor and then by subscription\r\n  const feeEventsByInvestor = feeEvents.reduce((acc, event) => {\r\n    const investorId = event.investor?.id || 'unknown';\r\n    if (!acc[investorId]) {\r\n      acc[investorId] = {\r\n        investor: event.investor,\r\n        subscriptions: {},\r\n        total: 0,\r\n      };\r\n    }\r\n\r\n    // Group by subscription within investor\r\n    const subscriptionId = event.allocation_id || 'no-subscription';\r\n    const subscriptionName = event.subscription\r\n      ? `${event.subscription.subscription_number} - ${event.subscription.vehicle?.name || 'Unknown Vehicle'}`\r\n      : 'Direct Fee';\r\n\r\n    if (!acc[investorId].subscriptions[subscriptionId]) {\r\n      acc[investorId].subscriptions[subscriptionId] = {\r\n        subscription: event.subscription,\r\n        name: subscriptionName,\r\n        events: [],\r\n        total: 0,\r\n      };\r\n    }\r\n\r\n    acc[investorId].subscriptions[subscriptionId].events.push(event);\r\n    acc[investorId].subscriptions[subscriptionId].total += Number(event.computed_amount);\r\n    acc[investorId].total += Number(event.computed_amount);\r\n\r\n    return acc;\r\n  }, {} as Record<string, {\r\n    investor: any;\r\n    subscriptions: Record<string, {\r\n      subscription: any;\r\n      name: string;\r\n      events: FeeEvent[];\r\n      total: number;\r\n    }>;\r\n    total: number;\r\n  }>);\r\n\r\n  const totalUninvoiced = feeEvents.reduce((sum, e) => sum + Number(e.computed_amount), 0);\r\n\r\n  return (\r\n    <>\r\n      <div className=\"space-y-6\">\r\n        <div className=\"flex items-center justify-between\">\r\n          <div>\r\n            <h2 className=\"text-2xl font-bold\">Fee Billing</h2>\r\n            <p className=\"text-sm text-muted-foreground mt-1\">\r\n              Manage recurring fee billing and invoices. For initial investment fees, see Subscriptions.\r\n            </p>\r\n          </div>\r\n          <div className=\"flex gap-2\">\r\n            <Button\r\n              variant=\"outline\"\r\n              onClick={handleBackfillFeeEvents}\r\n              disabled={backfillLoading}\r\n            >\r\n              {backfillLoading ? (\r\n                <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\r\n              ) : (\r\n                <RefreshCw className=\"mr-2 h-4 w-4\" />\r\n              )}\r\n              Backfill Fee Events\r\n            </Button>\r\n            <Button onClick={() => setShowGenerateModal(true)}>\r\n              <Plus className=\"mr-2 h-4 w-4\" />\r\n              Generate Invoice\r\n            </Button>\r\n          </div>\r\n        </div>\r\n\r\n        <Tabs defaultValue=\"uninvoiced\" className=\"w-full\" id=\"invoices-tab-tabs\">\r\n          <TabsList>\r\n            <TabsTrigger value=\"uninvoiced\">\r\n              Uninvoiced Fees\r\n              {feeEvents.length > 0 && (\r\n                <Badge variant=\"secondary\" className=\"ml-2\">\r\n                  {feeEvents.length}\r\n                </Badge>\r\n              )}\r\n            </TabsTrigger>\r\n            <TabsTrigger value=\"invoices\">Invoices</TabsTrigger>\r\n          </TabsList>\r\n\r\n          {/* Uninvoiced Fee Events Tab */}\r\n          <TabsContent value=\"uninvoiced\" className=\"space-y-4\">\r\n            {feeEvents.length === 0 ? (\r\n              <Card>\r\n                <CardContent className=\"py-10 text-center\">\r\n                  <FileText className=\"mx-auto h-12 w-12 text-muted-foreground/50 mb-4\" />\r\n                  <p className=\"text-muted-foreground\">No uninvoiced fee events</p>\r\n                  <p className=\"text-sm text-muted-foreground mt-1\">\r\n                    Fee events are automatically created when subscriptions are committed\r\n                  </p>\r\n                </CardContent>\r\n              </Card>\r\n            ) : (\r\n              <>\r\n                {/* Summary Card */}\r\n                <Card>\r\n                  <CardContent className=\"py-4\">\r\n                    <div className=\"flex items-center justify-between\">\r\n                      <div>\r\n                        <p className=\"text-sm text-muted-foreground\">Total Uninvoiced</p>\r\n                        <p className=\"text-2xl font-bold\">{formatCurrency(totalUninvoiced)}</p>\r\n                      </div>\r\n                      <div className=\"text-right\">\r\n                        <p className=\"text-sm text-muted-foreground\">Fee Events</p>\r\n                        <p className=\"text-2xl font-bold\">{feeEvents.length}</p>\r\n                      </div>\r\n                      <div className=\"text-right\">\r\n                        <p className=\"text-sm text-muted-foreground\">Investors</p>\r\n                        <p className=\"text-2xl font-bold\">\r\n                          {Object.keys(feeEventsByInvestor).length}\r\n                        </p>\r\n                      </div>\r\n                    </div>\r\n                  </CardContent>\r\n                </Card>\r\n\r\n                {/* Fee Events Grouped by Investor and Subscription */}\r\n                {Object.values(feeEventsByInvestor).map(({ investor, subscriptions, total }) => (\r\n                  <Card key={investor?.id || 'unknown'}>\r\n                    <CardHeader>\r\n                      <div className=\"flex items-start justify-between\">\r\n                        <div>\r\n                          <CardTitle className=\"text-lg\">\r\n                            {investor?.legal_name || investor?.display_name || 'Unknown Investor'}\r\n                          </CardTitle>\r\n                          <p className=\"text-sm text-muted-foreground mt-1\">\r\n                            {Object.keys(subscriptions).length} subscription(s) • {formatCurrency(total)}\r\n                          </p>\r\n                        </div>\r\n                        <Button\r\n                          size=\"sm\"\r\n                          onClick={() => {\r\n                            console.log('[InvoicesTab] Invoice button clicked for investor:', investor);\r\n                            console.log('[InvoicesTab] Investor ID:', investor?.id, 'Type:', typeof investor?.id);\r\n\r\n                            // Only open modal if we have a valid investor ID\r\n                            if (investor?.id && investor.id !== 'unknown') {\r\n                              console.log('[InvoicesTab] Setting selectedInvestorId to:', investor.id);\r\n                              setSelectedInvestorId(investor.id);\r\n                              setShowGenerateModal(true);\r\n                            } else {\r\n                              alert('Cannot generate invoice: Investor information is missing');\r\n                            }\r\n                          }}\r\n                          disabled={!investor?.id || investor.id === 'unknown'}\r\n                        >\r\n                          <Plus className=\"mr-2 h-4 w-4\" />\r\n                          Invoice All\r\n                        </Button>\r\n                      </div>\r\n                    </CardHeader>\r\n                    <CardContent>\r\n                      <div className=\"space-y-4\">\r\n                        {/* Group by Subscription */}\r\n                        {Object.values(subscriptions).map((subGroup) => (\r\n                          <div key={subGroup.name} className=\"border-l-2 border-primary/20 pl-4\">\r\n                            <div className=\"mb-2\">\r\n                              <p className=\"font-medium text-sm\">\r\n                                {subGroup.name}\r\n                              </p>\r\n                              <p className=\"text-xs text-muted-foreground\">\r\n                                {subGroup.events.length} fee(s) • {formatCurrency(subGroup.total)}\r\n                              </p>\r\n                            </div>\r\n                            <div className=\"space-y-2\">\r\n                              {subGroup.events.map((event) => (\r\n                                <div\r\n                                  key={event.id}\r\n                                  className=\"flex items-center justify-between p-2 bg-accent/50 rounded\"\r\n                                >\r\n                                  <div>\r\n                                    <div className=\"font-medium text-sm\">\r\n                                      <Badge variant=\"outline\" className=\"mr-2 text-xs\">\r\n                                        {event.fee_type === 'flat' ? 'Investment' : event.fee_type.replace('_', ' ')}\r\n                                      </Badge>\r\n                                      {formatCurrency(event.computed_amount)}\r\n                                    </div>\r\n                                    <div className=\"text-xs text-muted-foreground\">\r\n                                      {new Date(event.event_date).toLocaleDateString()}\r\n                                    </div>\r\n                                  </div>\r\n                                </div>\r\n                              ))}\r\n                            </div>\r\n                          </div>\r\n                        ))}\r\n                      </div>\r\n                    </CardContent>\r\n                  </Card>\r\n                ))}\r\n              </>\r\n            )}\r\n          </TabsContent>\r\n\r\n          {/* Invoices Tab */}\r\n          <TabsContent value=\"invoices\" className=\"space-y-4\">\r\n            {/* Filters */}\r\n            <div className=\"flex gap-2\">\r\n              {['all', 'draft', 'sent', 'paid', 'overdue'].map((status) => (\r\n                <Button\r\n                  key={status}\r\n                  variant={filter === status ? 'default' : 'outline'}\r\n                  size=\"sm\"\r\n                  onClick={() => setFilter(status)}\r\n                >\r\n                  {status.charAt(0).toUpperCase() + status.slice(1)}\r\n                </Button>\r\n              ))}\r\n            </div>\r\n\r\n            {/* Invoices List */}\r\n            {invoices.length === 0 ? (\r\n              <Card>\r\n                <CardContent className=\"py-10 text-center\">\r\n                  <FileText className=\"mx-auto h-12 w-12 text-muted-foreground/50 mb-4\" />\r\n                  <p className=\"text-muted-foreground\">No invoices found</p>\r\n                </CardContent>\r\n              </Card>\r\n            ) : (\r\n              <div className=\"space-y-4\">\r\n                {invoices.map((invoice) => (\r\n                  <Card key={invoice.id}>\r\n                    <CardHeader>\r\n                      <div className=\"flex items-start justify-between\">\r\n                        <div className=\"flex items-start gap-2\">\r\n                          <div>\r\n                            <CardTitle className=\"text-lg\">{invoice.invoice_number}</CardTitle>\r\n                            <p className=\"text-sm text-muted-foreground mt-1\">\r\n                              {invoice.investor?.display_name || 'Unknown Investor'}\r\n                              {invoice.deal && ` • ${invoice.deal.name}`}\r\n                            </p>\r\n                          </div>\r\n                          {/* Discrepancy Warning Badge */}\r\n                          {invoice.has_discrepancy && (\r\n                            <Popover>\r\n                              <PopoverTrigger asChild>\r\n                                <button\r\n                                  className=\"flex items-center gap-1 px-2 py-1 text-xs font-medium text-amber-600 bg-amber-100 dark:bg-amber-900/30 dark:text-amber-400 rounded-md hover:bg-amber-200 dark:hover:bg-amber-900/50 transition-colors cursor-pointer\"\r\n                                >\r\n                                  <AlertTriangle className=\"h-3.5 w-3.5\" />\r\n                                  <span>Discrepancy</span>\r\n                                </button>\r\n                              </PopoverTrigger>\r\n                              <PopoverContent className=\"w-80\" side=\"bottom\" align=\"start\">\r\n                                <div className=\"space-y-3\">\r\n                                  <div className=\"flex items-center gap-2 text-amber-600 dark:text-amber-400\">\r\n                                    <AlertTriangle className=\"h-4 w-4\" />\r\n                                    <h4 className=\"font-medium\">Invoice Discrepancy Detected</h4>\r\n                                  </div>\r\n                                  <p className=\"text-sm text-muted-foreground\">\r\n                                    The invoice total does not match the sum of linked fee events.\r\n                                  </p>\r\n                                  <div className=\"space-y-2 p-3 bg-muted/50 rounded-md\">\r\n                                    <div className=\"flex justify-between text-sm\">\r\n                                      <span className=\"text-muted-foreground\">Invoice Total:</span>\r\n                                      <span className=\"font-medium\">{formatCurrency(invoice.total)}</span>\r\n                                    </div>\r\n                                    <div className=\"flex justify-between text-sm\">\r\n                                      <span className=\"text-muted-foreground\">Expected Total:</span>\r\n                                      <span className=\"font-medium\">\r\n                                        {formatCurrency(invoice.total - (invoice.discrepancy_amount || 0))}\r\n                                      </span>\r\n                                    </div>\r\n                                    <div className=\"border-t border-border pt-2 mt-2\">\r\n                                      <div className=\"flex justify-between text-sm\">\r\n                                        <span className=\"text-amber-600 dark:text-amber-400 font-medium\">Discrepancy:</span>\r\n                                        <span className=\"text-amber-600 dark:text-amber-400 font-medium\">\r\n                                          {(invoice.discrepancy_amount || 0) > 0 ? '+' : ''}{formatCurrency(invoice.discrepancy_amount || 0)}\r\n                                        </span>\r\n                                      </div>\r\n                                    </div>\r\n                                  </div>\r\n                                  <p className=\"text-xs text-muted-foreground\">\r\n                                    Please review the invoice line items and linked fee events to resolve this discrepancy.\r\n                                  </p>\r\n                                </div>\r\n                              </PopoverContent>\r\n                            </Popover>\r\n                          )}\r\n                        </div>\r\n                        <Badge variant={statusColors[invoice.status]}>\r\n                          {invoice.status.replace('_', ' ')}\r\n                        </Badge>\r\n                      </div>\r\n                    </CardHeader>\r\n                    <CardContent>\r\n                      <div className=\"flex items-center justify-between\">\r\n                        <div className=\"space-y-1\">\r\n                          <div className=\"text-2xl font-bold\">\r\n                            {formatCurrency(invoice.total)}\r\n                          </div>\r\n                          <div className=\"text-sm text-muted-foreground\">\r\n                            Due: {new Date(invoice.due_date).toLocaleDateString()}\r\n                            {invoice.balance_due && invoice.balance_due > 0 && (\r\n                              <span className=\"ml-2\">\r\n                                • Balance: {formatCurrency(invoice.balance_due)}\r\n                              </span>\r\n                            )}\r\n                          </div>\r\n                        </div>\r\n                        <div className=\"flex gap-2\">\r\n                          {invoice.status === 'draft' && (\r\n                            <Button\r\n                              size=\"sm\"\r\n                              onClick={() => handleSend(invoice.id)}\r\n                            >\r\n                              <Send className=\"mr-2 h-4 w-4\" />\r\n                              Send\r\n                            </Button>\r\n                          )}\r\n                          {['sent', 'partially_paid', 'overdue'].includes(invoice.status) && (\r\n                            <Button\r\n                              size=\"sm\"\r\n                              onClick={() => handleMarkPaid(invoice.id, invoice.balance_due || invoice.total)}\r\n                            >\r\n                              <DollarSign className=\"mr-2 h-4 w-4\" />\r\n                              Mark Paid\r\n                            </Button>\r\n                          )}\r\n                        </div>\r\n                      </div>\r\n                    </CardContent>\r\n                  </Card>\r\n                ))}\r\n              </div>\r\n            )}\r\n          </TabsContent>\r\n        </Tabs>\r\n      </div>\r\n\r\n      {/* Generate Invoice Modal */}\r\n      <GenerateInvoiceModal\r\n        open={showGenerateModal}\r\n        onClose={() => {\r\n          setShowGenerateModal(false);\r\n          setSelectedInvestorId(undefined);\r\n        }}\r\n        onSuccess={() => fetchData()}\r\n        preselectedInvestorId={selectedInvestorId}\r\n      />\r\n    </>\r\n  );\r\n}\r\n","/**\r\n * Generate Invoice Modal\r\n * Form to create invoices from accrued fee events\r\n */\r\n\r\n'use client';\r\n\r\nimport { useState, useEffect, useCallback } from 'react';\r\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from '@/components/ui/dialog';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Input } from '@/components/ui/input';\r\nimport { Label } from '@/components/ui/label';\r\nimport { Textarea } from '@/components/ui/textarea';\r\nimport { Checkbox } from '@/components/ui/checkbox';\r\nimport {\r\n  Select,\r\n  SelectContent,\r\n  SelectItem,\r\n  SelectTrigger,\r\n  SelectValue,\r\n} from '@/components/ui/select';\r\nimport { Badge } from '@/components/ui/badge';\r\nimport { Plus, Trash2, Loader2 } from 'lucide-react';\r\nimport { formatCurrency } from '@/lib/fees/calculations';\r\n\r\ninterface FeeEvent {\r\n  id: string;\r\n  fee_type: string;\r\n  computed_amount: number;\r\n  event_date: string;\r\n  investor?: {\r\n    id: string;\r\n    legal_name: string;\r\n    display_name: string;\r\n  };\r\n  deal?: {\r\n    id: string;\r\n    name: string;\r\n  };\r\n}\r\n\r\ninterface CustomLineItem {\r\n  description: string;\r\n  amount: number;\r\n  quantity: number;\r\n}\r\n\r\ninterface Subscription {\r\n  id: string;\r\n  subscription_number: string;\r\n  commitment: number;\r\n  vehicle?: {\r\n    id: string;\r\n    name: string;\r\n    short_name?: string;\r\n  };\r\n}\r\n\r\ninterface Props {\r\n  open: boolean;\r\n  onClose: () => void;\r\n  onSuccess: () => void;\r\n  preselectedInvestorId?: string; // If set, auto-select investor and fetch their fee events\r\n}\r\n\r\nexport function GenerateInvoiceModal({ open, onClose, onSuccess, preselectedInvestorId }: Props) {\r\n  const [loading, setLoading] = useState(false);\r\n  const [fetchingEvents, setFetchingEvents] = useState(false);\r\n  const [fetchingSubscriptions, setFetchingSubscriptions] = useState(false);\r\n\r\n  // Form state\r\n  const [investorId, setInvestorId] = useState<string>('');\r\n  const [subscriptionId, setSubscriptionId] = useState<string>('');\r\n  const [dealId, setDealId] = useState<string>('');\r\n  const [dueDate, setDueDate] = useState<string>('');\r\n  const [notes, setNotes] = useState<string>('');\r\n  const [selectedEventIds, setSelectedEventIds] = useState<Set<string>>(new Set());\r\n  const [customLineItems, setCustomLineItems] = useState<CustomLineItem[]>([]);\r\n\r\n  // Data state\r\n  const [feeEvents, setFeeEvents] = useState<FeeEvent[]>([]);\r\n  const [investors, setInvestors] = useState<any[]>([]);\r\n  const [subscriptions, setSubscriptions] = useState<Subscription[]>([]);\r\n\r\n  // Set preselected investor on mount\r\n  useEffect(() => {\r\n    if (open && preselectedInvestorId) {\r\n      console.log('[GenerateInvoiceModal] Preselected investor ID:', preselectedInvestorId, 'Type:', typeof preselectedInvestorId);\r\n\r\n      // Validate the investor ID is a valid UUID format\r\n      const uuidRegex = /^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i;\r\n      if (uuidRegex.test(preselectedInvestorId)) {\r\n        console.log('[GenerateInvoiceModal] Valid UUID, setting investorId');\r\n        setInvestorId(preselectedInvestorId);\r\n      } else {\r\n        console.error('[GenerateInvoiceModal] Invalid investor ID format:', preselectedInvestorId);\r\n        alert(`Invalid investor ID format: ${preselectedInvestorId}`);\r\n      }\r\n    }\r\n  }, [open, preselectedInvestorId]);\r\n\r\n  const fetchInvestors = useCallback(async () => {\r\n    try {\r\n      console.log('[GenerateInvoiceModal] Fetching investors...');\r\n      const res = await fetch('/api/investors?limit=1000');\r\n      const json = await res.json();\r\n      console.log('[GenerateInvoiceModal] Investors fetched:', json.data?.length || 0);\r\n      setInvestors(json.data || []);\r\n    } catch (error) {\r\n      console.error('Error fetching investors:', error);\r\n    }\r\n  }, []);\r\n\r\n  // Fetch investors on mount\r\n  useEffect(() => {\r\n    if (open) {\r\n      fetchInvestors();\r\n    }\r\n  }, [open, fetchInvestors]);\r\n\r\n  const fetchSubscriptions = useCallback(async () => {\r\n    if (!investorId) return;\r\n\r\n    setFetchingSubscriptions(true);\r\n    try {\r\n      console.log('[GenerateInvoiceModal] Fetching ALL subscriptions for investor:', investorId);\r\n\r\n      // Fetch ALL subscriptions for this investor (not just committed)\r\n      const subsRes = await fetch(`/api/subscriptions?investor_id=${investorId}`);\r\n      const subsJson = await subsRes.json();\r\n      const allSubs = subsJson.data || [];\r\n\r\n      console.log('[GenerateInvoiceModal] All subscriptions fetched:', allSubs.length);\r\n\r\n      // Now fetch fee events to see which subs have fees\r\n      const feeEventsRes = await fetch(`/api/staff/fees/events?status=accrued&investor_id=${investorId}&limit=500`);\r\n      const feeEventsJson = await feeEventsRes.json();\r\n\r\n      if (!feeEventsRes.ok) {\r\n        console.error('[GenerateInvoiceModal] Fee events API error:', feeEventsJson);\r\n        setSubscriptions([]);\r\n        setFetchingSubscriptions(false);\r\n        return;\r\n      }\r\n\r\n      const allFeeEvents = feeEventsJson.data || [];\r\n\r\n      console.log('[GenerateInvoiceModal] Fee events fetched:', allFeeEvents.length);\r\n      console.log('[GenerateInvoiceModal] Sample fee event:', allFeeEvents[0]);\r\n\r\n      // Get unique subscription IDs from fee events (check allocation_id)\r\n      const subscriptionIdsWithFees = [...new Set(\r\n        allFeeEvents\r\n          .map((event: any) => event.allocation_id)\r\n          .filter(Boolean)\r\n      )];\r\n\r\n      console.log('[GenerateInvoiceModal] Subscription IDs with fee events:', subscriptionIdsWithFees);\r\n\r\n      // Filter subscriptions to only those with fee events\r\n      const subsWithFees = allSubs.filter((sub: any) =>\r\n        subscriptionIdsWithFees.includes(sub.id)\r\n      );\r\n\r\n      console.log('[GenerateInvoiceModal] Subscriptions that have fees:', subsWithFees.length);\r\n      console.log('[GenerateInvoiceModal] Subscription details:', subsWithFees);\r\n\r\n      setSubscriptions(subsWithFees);\r\n\r\n      // If only one subscription, auto-select it\r\n      if (subsWithFees.length === 1) {\r\n        console.log('[GenerateInvoiceModal] Auto-selecting single subscription:', subsWithFees[0].id);\r\n        setSubscriptionId(subsWithFees[0].id);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error fetching subscriptions:', error);\r\n      setSubscriptions([]);\r\n    } finally {\r\n      setFetchingSubscriptions(false);\r\n    }\r\n  }, [investorId]);\r\n\r\n  const fetchFeeEvents = useCallback(async () => {\r\n    if (!investorId || !subscriptionId) {\r\n      console.log('[GenerateInvoiceModal] Missing investor or subscription ID, skipping fetch');\r\n      return;\r\n    }\r\n\r\n    console.log('[GenerateInvoiceModal] Starting fetchFeeEvents with investorId:', investorId, 'subscriptionId:', subscriptionId);\r\n\r\n    setFetchingEvents(true);\r\n    try {\r\n      const params = new URLSearchParams({\r\n        status: 'accrued',\r\n        investor_id: investorId,\r\n        allocation_id: subscriptionId, // Filter by specific subscription\r\n        limit: '100',\r\n        offset: '0',\r\n      });\r\n\r\n      console.log('[GenerateInvoiceModal] Fetching fee events for investor:', investorId, 'subscription:', subscriptionId);\r\n      console.log('[GenerateInvoiceModal] URL params:', params.toString());\r\n      const res = await fetch(`/api/staff/fees/events?${params}`);\r\n      const json = await res.json();\r\n      console.log('[GenerateInvoiceModal] Fee events response:', json);\r\n\r\n      // Check for API errors\r\n      if (!res.ok || json.error) {\r\n        console.error('[GenerateInvoiceModal] API error:', json.error || res.statusText);\r\n        console.error('[GenerateInvoiceModal] Validation details:', JSON.stringify(json.details, null, 2));\r\n\r\n        // Format validation errors for display\r\n        let errorMessage = `Failed to load fee events: ${json.error || res.statusText}`;\r\n        if (json.details && Array.isArray(json.details)) {\r\n          errorMessage += '\\n\\nValidation errors:';\r\n          json.details.forEach((issue: any) => {\r\n            errorMessage += `\\n- Field: ${issue.path?.join('.')}, Error: ${issue.message}`;\r\n          });\r\n        }\r\n\r\n        alert(errorMessage);\r\n        setFeeEvents([]);\r\n        return;\r\n      }\r\n\r\n      setFeeEvents(json.data || []);\r\n      console.log('[GenerateInvoiceModal] Set fee events count:', json.data?.length || 0);\r\n    } catch (error) {\r\n      console.error('Error fetching fee events:', error);\r\n      alert(`Error loading fee events: ${error instanceof Error ? error.message : 'Unknown error'}`);\r\n      setFeeEvents([]);\r\n    } finally {\r\n      setFetchingEvents(false);\r\n    }\r\n  }, [investorId, subscriptionId]);\r\n\r\n  // Fetch subscriptions when investor changes\r\n  useEffect(() => {\r\n    if (investorId) {\r\n      fetchSubscriptions();\r\n    } else {\r\n      setSubscriptions([]);\r\n      setSubscriptionId('');\r\n    }\r\n  }, [investorId, fetchSubscriptions]);\r\n\r\n  // Fetch fee events when investor or subscription changes\r\n  useEffect(() => {\r\n    if (investorId && subscriptionId) {\r\n      fetchFeeEvents();\r\n    } else if (investorId && !subscriptionId) {\r\n      // Clear fee events when no subscription selected\r\n      setFeeEvents([]);\r\n    }\r\n  }, [investorId, subscriptionId, fetchFeeEvents]);\r\n\r\n  const toggleEventSelection = (eventId: string) => {\r\n    const newSelection = new Set(selectedEventIds);\r\n    if (newSelection.has(eventId)) {\r\n      newSelection.delete(eventId);\r\n    } else {\r\n      newSelection.add(eventId);\r\n    }\r\n    setSelectedEventIds(newSelection);\r\n  };\r\n\r\n  const addCustomLineItem = () => {\r\n    setCustomLineItems([\r\n      ...customLineItems,\r\n      { description: '', amount: 0, quantity: 1 },\r\n    ]);\r\n  };\r\n\r\n  const removeCustomLineItem = (index: number) => {\r\n    setCustomLineItems(customLineItems.filter((_, i) => i !== index));\r\n  };\r\n\r\n  const updateCustomLineItem = (index: number, field: keyof CustomLineItem, value: any) => {\r\n    const updated = [...customLineItems];\r\n    updated[index] = { ...updated[index], [field]: value };\r\n    setCustomLineItems(updated);\r\n  };\r\n\r\n  const calculateTotal = () => {\r\n    const eventsTotal = feeEvents\r\n      .filter((event) => selectedEventIds.has(event.id))\r\n      .reduce((sum, event) => sum + Number(event.computed_amount), 0);\r\n\r\n    const customTotal = customLineItems.reduce(\r\n      (sum, item) => sum + (item.amount * item.quantity),\r\n      0\r\n    );\r\n\r\n    return eventsTotal + customTotal;\r\n  };\r\n\r\n  const handleSubmit = async () => {\r\n    console.log('[GenerateInvoiceModal] handleSubmit called');\r\n    console.log('[GenerateInvoiceModal] Current state:', {\r\n      investorId,\r\n      selectedEventIds: Array.from(selectedEventIds),\r\n      dueDate,\r\n      notes,\r\n      customLineItems,\r\n    });\r\n\r\n    if (!investorId || !subscriptionId || selectedEventIds.size === 0 || !dueDate) {\r\n      alert('Please select an investor, subscription, at least one fee event, and a due date');\r\n      return;\r\n    }\r\n\r\n    setLoading(true);\r\n    try {\r\n      // Format due date as ISO string with time at end of day\r\n      const formattedDueDate = dueDate ? new Date(dueDate + 'T23:59:59').toISOString() : '';\r\n\r\n      const requestBody = {\r\n        investor_id: investorId,\r\n        deal_id: dealId || undefined,\r\n        fee_event_ids: Array.from(selectedEventIds),\r\n        due_date: formattedDueDate,\r\n        notes: notes || undefined,\r\n        custom_line_items: customLineItems.length > 0 ? customLineItems : undefined,\r\n      };\r\n\r\n      console.log('[GenerateInvoiceModal] Request body created:', requestBody);\r\n      console.log('[GenerateInvoiceModal] Sending request to /api/staff/fees/invoices/generate-simple');\r\n\r\n      // Use simplified endpoint\r\n      const res = await fetch('/api/staff/fees/invoices/generate-simple', {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify(requestBody),\r\n      });\r\n\r\n      if (!res.ok) {\r\n        const error = await res.json();\r\n        console.error('[GenerateInvoiceModal] Invoice generation failed:', error);\r\n        console.error('[GenerateInvoiceModal] Request body was:', {\r\n          investor_id: investorId,\r\n          deal_id: dealId || undefined,\r\n          fee_event_ids: Array.from(selectedEventIds),\r\n          due_date: dueDate,\r\n          notes,\r\n          custom_line_items: customLineItems.length > 0 ? customLineItems : undefined,\r\n        });\r\n        throw new Error(error.error || error.details ? JSON.stringify(error.details, null, 2) : 'Failed to generate invoice');\r\n      }\r\n\r\n      onSuccess();\r\n      handleClose();\r\n    } catch (error) {\r\n      console.error('Error generating invoice:', error);\r\n      alert(error instanceof Error ? error.message : 'Failed to generate invoice');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleClose = () => {\r\n    setInvestorId('');\r\n    setSubscriptionId('');\r\n    setDealId('');\r\n    setDueDate('');\r\n    setNotes('');\r\n    setSelectedEventIds(new Set());\r\n    setCustomLineItems([]);\r\n    setFeeEvents([]);\r\n    setSubscriptions([]);\r\n    onClose();\r\n  };\r\n\r\n  const total = calculateTotal();\r\n\r\n  return (\r\n    <Dialog open={open} onOpenChange={handleClose}>\r\n      <DialogContent className=\"max-w-4xl max-h-[90vh] overflow-y-auto\">\r\n        <DialogHeader>\r\n          <DialogTitle>Generate Invoice</DialogTitle>\r\n        </DialogHeader>\r\n\r\n        <div className=\"space-y-6\">\r\n          {/* Investor Selection or Display */}\r\n          {preselectedInvestorId ? (\r\n            // Show the preselected investor as read-only\r\n            <div>\r\n              <Label className=\"text-white\">Investor</Label>\r\n              <div className=\"flex items-center gap-2 p-2 border border-white/20 rounded-md bg-black/20\">\r\n                <span className=\"text-sm font-medium text-white\">\r\n                  {investors.find(i => i.id === investorId)?.legal_name ||\r\n                   investors.find(i => i.id === investorId)?.display_name ||\r\n                   feeEvents[0]?.investor?.legal_name ||\r\n                   feeEvents[0]?.investor?.display_name ||\r\n                   'Loading...'}\r\n                </span>\r\n                <Badge variant=\"outline\" className=\"ml-auto text-white border-white/20\">Pre-selected</Badge>\r\n              </div>\r\n            </div>\r\n          ) : (\r\n            // Show investor selector only when not preselected\r\n            <div>\r\n              <Label htmlFor=\"investor\" className=\"text-white\">Investor *</Label>\r\n              <Select value={investorId} onValueChange={setInvestorId}>\r\n                <SelectTrigger id=\"investor\">\r\n                  <SelectValue placeholder=\"Select investor\" />\r\n                </SelectTrigger>\r\n                <SelectContent>\r\n                  {investors.map((investor) => (\r\n                    <SelectItem key={investor.id} value={investor.id}>\r\n                      {investor.legal_name || investor.display_name}\r\n                    </SelectItem>\r\n                  ))}\r\n                </SelectContent>\r\n              </Select>\r\n            </div>\r\n          )}\r\n\r\n          {/* Subscription Selection - shows after investor is selected */}\r\n          {investorId && (\r\n            <div>\r\n              <Label htmlFor=\"subscription\" className=\"text-white\">Subscription *</Label>\r\n              {fetchingSubscriptions ? (\r\n                <div className=\"flex items-center justify-center p-2 border border-white/20 rounded-md\">\r\n                  <Loader2 className=\"h-4 w-4 animate-spin mr-2\" />\r\n                  <span className=\"text-sm text-muted-foreground\">Loading subscriptions...</span>\r\n                </div>\r\n              ) : subscriptions.length === 0 ? (\r\n                <div className=\"p-2 border border-red-500/30 rounded-md bg-red-500/10\">\r\n                  <p className=\"text-sm text-red-300 font-medium\">No subscriptions with accrued fees found</p>\r\n                  <p className=\"text-xs text-red-400 mt-1\">\r\n                    This investor has no uninvoiced fee events. Fee events may not have been calculated yet, or all fees have already been invoiced.\r\n                  </p>\r\n                </div>\r\n              ) : (\r\n                <Select value={subscriptionId} onValueChange={setSubscriptionId}>\r\n                  <SelectTrigger id=\"subscription\">\r\n                    <SelectValue placeholder=\"Select subscription\" />\r\n                  </SelectTrigger>\r\n                  <SelectContent>\r\n                    {subscriptions.map((subscription) => (\r\n                      <SelectItem key={subscription.id} value={subscription.id}>\r\n                        {subscription.subscription_number} - {subscription.vehicle?.name || 'Unknown Vehicle'}\r\n                        ({formatCurrency(subscription.commitment)})\r\n                      </SelectItem>\r\n                    ))}\r\n                  </SelectContent>\r\n                </Select>\r\n              )}\r\n            </div>\r\n          )}\r\n\r\n          {/* Due Date */}\r\n          <div>\r\n            <Label htmlFor=\"due_date\" className=\"text-white\">Due Date *</Label>\r\n            <Input\r\n              id=\"due_date\"\r\n              type=\"date\"\r\n              value={dueDate}\r\n              onChange={(e) => setDueDate(e.target.value)}\r\n            />\r\n          </div>\r\n\r\n          {/* Fee Events Selection - shows after subscription is selected */}\r\n          {investorId && subscriptionId && (\r\n            <div>\r\n              <div className=\"flex items-center justify-between mb-2\">\r\n                <Label className=\"text-white\">Fee Events to Invoice *</Label>\r\n                {feeEvents.length > 0 && (\r\n                  <Button\r\n                    type=\"button\"\r\n                    variant=\"outline\"\r\n                    size=\"sm\"\r\n                    onClick={() => {\r\n                      if (selectedEventIds.size === feeEvents.length) {\r\n                        // Deselect all\r\n                        setSelectedEventIds(new Set());\r\n                      } else {\r\n                        // Select all\r\n                        setSelectedEventIds(new Set(feeEvents.map(e => e.id)));\r\n                      }\r\n                    }}\r\n                  >\r\n                    {selectedEventIds.size === feeEvents.length ? 'Deselect All' : 'Select All'}\r\n                  </Button>\r\n                )}\r\n              </div>\r\n              {fetchingEvents ? (\r\n                <div className=\"py-4 text-center text-sm text-muted-foreground\">\r\n                  Loading fee events...\r\n                </div>\r\n              ) : feeEvents.length === 0 ? (\r\n                <div className=\"py-4 text-center text-sm text-muted-foreground\">\r\n                  No accrued fee events found for this investor\r\n                </div>\r\n              ) : (\r\n                <div className=\"mt-2 space-y-2 border border-border rounded-lg p-4 max-h-60 overflow-y-auto\">\r\n                  {feeEvents.map((event) => (\r\n                    <div\r\n                      key={event.id}\r\n                      className=\"flex items-center justify-between p-2 hover:bg-accent/10 rounded\"\r\n                    >\r\n                      <div className=\"flex items-center gap-3\">\r\n                        <Checkbox\r\n                          checked={selectedEventIds.has(event.id)}\r\n                          onCheckedChange={() => toggleEventSelection(event.id)}\r\n                        />\r\n                        <div>\r\n                          <div className=\"font-medium text-white\">\r\n                            <Badge variant=\"outline\" className=\"mr-2 text-white border-white/20\">\r\n                              {event.fee_type === 'flat' ? 'Investment' : event.fee_type.replace('_', ' ')}\r\n                            </Badge>\r\n                            <span className=\"text-white\">{formatCurrency(event.computed_amount)}</span>\r\n                          </div>\r\n                          <div className=\"text-sm text-gray-400\">\r\n                            {new Date(event.event_date).toLocaleDateString()}\r\n                            {event.deal && ` • ${event.deal.name}`}\r\n                          </div>\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  ))}\r\n                </div>\r\n              )}\r\n            </div>\r\n          )}\r\n\r\n          {/* Custom Line Items */}\r\n          <div>\r\n            <div className=\"flex items-center justify-between mb-2\">\r\n              <Label className=\"text-white\">Custom Line Items (Optional)</Label>\r\n              <Button\r\n                type=\"button\"\r\n                variant=\"outline\"\r\n                size=\"sm\"\r\n                onClick={addCustomLineItem}\r\n              >\r\n                <Plus className=\"mr-2 h-4 w-4\" />\r\n                Add Line Item\r\n              </Button>\r\n            </div>\r\n            {customLineItems.map((item, index) => (\r\n              <div key={index} className=\"flex gap-2 mb-2\">\r\n                <Input\r\n                  placeholder=\"Description\"\r\n                  value={item.description}\r\n                  onChange={(e) =>\r\n                    updateCustomLineItem(index, 'description', e.target.value)\r\n                  }\r\n                  className=\"flex-1\"\r\n                />\r\n                <Input\r\n                  type=\"number\"\r\n                  placeholder=\"Qty\"\r\n                  value={item.quantity}\r\n                  onChange={(e) =>\r\n                    updateCustomLineItem(index, 'quantity', parseFloat(e.target.value))\r\n                  }\r\n                  className=\"w-20\"\r\n                />\r\n                <Input\r\n                  type=\"number\"\r\n                  placeholder=\"Amount\"\r\n                  value={item.amount}\r\n                  onChange={(e) =>\r\n                    updateCustomLineItem(index, 'amount', parseFloat(e.target.value))\r\n                  }\r\n                  className=\"w-32\"\r\n                />\r\n                <Button\r\n                  type=\"button\"\r\n                  variant=\"ghost\"\r\n                  size=\"icon\"\r\n                  onClick={() => removeCustomLineItem(index)}\r\n                >\r\n                  <Trash2 className=\"h-4 w-4\" />\r\n                </Button>\r\n              </div>\r\n            ))}\r\n          </div>\r\n\r\n          {/* Notes */}\r\n          <div>\r\n            <Label htmlFor=\"notes\" className=\"text-white\">Notes (Optional)</Label>\r\n            <Textarea\r\n              id=\"notes\"\r\n              value={notes}\r\n              onChange={(e) => setNotes(e.target.value)}\r\n              placeholder=\"Add any additional notes for the invoice\"\r\n              rows={3}\r\n            />\r\n          </div>\r\n\r\n          {/* Total Preview */}\r\n          {selectedEventIds.size > 0 && (\r\n            <div className=\"bg-accent p-4 rounded-lg\">\r\n              <div className=\"flex items-center justify-between text-lg font-bold\">\r\n                <span>Total Amount:</span>\r\n                <span>{formatCurrency(total)}</span>\r\n              </div>\r\n              <div className=\"text-sm text-muted-foreground mt-1\">\r\n                {selectedEventIds.size} fee event(s)\r\n                {customLineItems.length > 0 && ` + ${customLineItems.length} custom item(s)`}\r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n          {/* Actions */}\r\n          <div className=\"flex justify-end gap-2\">\r\n            <Button variant=\"outline\" onClick={handleClose} disabled={loading}>\r\n              Cancel\r\n            </Button>\r\n            <Button onClick={handleSubmit} disabled={loading || selectedEventIds.size === 0}>\r\n              {loading && <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />}\r\n              Generate Invoice\r\n            </Button>\r\n          </div>\r\n        </div>\r\n      </DialogContent>\r\n    </Dialog>\r\n  );\r\n}\r\n","/**\r\n * Schedule Tab - Calendar view of upcoming recurring fees\r\n */\r\n\r\n'use client';\r\n\r\nimport { useEffect, useState, useCallback, useMemo } from 'react';\r\nimport { useSearchParams, useRouter } from 'next/navigation';\r\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\r\nimport { Badge } from '@/components/ui/badge';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Checkbox } from '@/components/ui/checkbox';\r\nimport { formatCurrency } from '@/lib/fees/calculations';\r\nimport { Calendar, DollarSign, Clock, Users, Building2, ChevronDown, ChevronRight, UserCheck, Handshake, Briefcase, X, Filter, Check, ChevronsUpDown } from 'lucide-react';\r\nimport {\r\n  Collapsible,\r\n  CollapsibleContent,\r\n  CollapsibleTrigger,\r\n} from '@/components/ui/collapsible';\r\nimport {\r\n  Popover,\r\n  PopoverContent,\r\n  PopoverTrigger,\r\n} from '@/components/ui/popover';\r\nimport {\r\n  Command,\r\n  CommandEmpty,\r\n  CommandGroup,\r\n  CommandInput,\r\n  CommandItem,\r\n  CommandList,\r\n} from '@/components/ui/command';\r\nimport { DateRangePicker } from '@/components/ui/date-range-picker';\r\nimport type { DateRange } from 'react-day-picker';\r\n\r\ninterface UpcomingFee {\r\n  id: string;\r\n  subscription_id: string;\r\n  subscription_number: string;\r\n  investor: {\r\n    id: string;\r\n    legal_name: string;\r\n    display_name: string;\r\n  };\r\n  vehicle: {\r\n    id: string;\r\n    name: string;\r\n  };\r\n  fee_type: string;\r\n  fee_name: string;\r\n  amount: number;\r\n  frequency: string;\r\n  next_due_date: string;\r\n  status: string;\r\n}\r\n\r\ninterface InvestorFeeEvent {\r\n  id: string;\r\n  fee_type: string;\r\n  computed_amount: number;\r\n  period_start_date: string | null;\r\n  period_end_date: string | null;\r\n  status: string;\r\n  event_date: string;\r\n  investor: {\r\n    id: string;\r\n    legal_name: string;\r\n    display_name: string;\r\n  } | null;\r\n  deal: {\r\n    id: string;\r\n    name: string;\r\n  } | null;\r\n}\r\n\r\ninterface IntroducerCommission {\r\n  id: string;\r\n  entity_type: 'introducer';\r\n  entity_id: string;\r\n  entity_name: string;\r\n  deal_id: string | null;\r\n  deal_name?: string;\r\n  investor_id: string | null;\r\n  investor_name?: string;\r\n  accrual_amount: number;\r\n  status: string;\r\n  created_at: string;\r\n}\r\n\r\ninterface PartnerCommission {\r\n  id: string;\r\n  entity_type: 'partner';\r\n  entity_id: string;\r\n  entity_name: string;\r\n  deal_id: string | null;\r\n  deal_name?: string;\r\n  investor_id: string | null;\r\n  investor_name?: string;\r\n  accrual_amount: number;\r\n  status: string;\r\n  created_at: string;\r\n}\r\n\r\ninterface CommercialPartnerCommission {\r\n  id: string;\r\n  entity_type: 'commercial_partner';\r\n  entity_id: string;\r\n  entity_name: string;\r\n  deal_id: string | null;\r\n  deal_name?: string;\r\n  investor_id: string | null;\r\n  investor_name?: string;\r\n  accrual_amount: number;\r\n  status: string;\r\n  created_at: string;\r\n}\r\n\r\ninterface ScheduleData {\r\n  data: UpcomingFee[];\r\n  summary: {\r\n    total_scheduled: number;\r\n    total_amount: number;\r\n    date_range: {\r\n      from: string;\r\n      to: string;\r\n    };\r\n  };\r\n  by_month: Record<string, {\r\n    fees: UpcomingFee[];\r\n    total: number;\r\n  }>;\r\n}\r\n\r\ninterface Deal {\r\n  id: string;\r\n  name: string;\r\n}\r\n\r\ninterface Entity {\r\n  id: string;\r\n  name: string;\r\n  type: 'introducer' | 'partner' | 'commercial_partner';\r\n}\r\n\r\nexport default function ScheduleTab() {\r\n  const router = useRouter();\r\n  const searchParams = useSearchParams();\r\n\r\n  const [data, setData] = useState<ScheduleData | null>(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [daysAhead, setDaysAhead] = useState(60);\r\n  const [investorFees, setInvestorFees] = useState<InvestorFeeEvent[]>([]);\r\n  const [investorFeesLoading, setInvestorFeesLoading] = useState(true);\r\n  const [investorFeesExpanded, setInvestorFeesExpanded] = useState(true);\r\n  const [introducerCommissions, setIntroducerCommissions] = useState<IntroducerCommission[]>([]);\r\n  const [introducerCommissionsLoading, setIntroducerCommissionsLoading] = useState(true);\r\n  const [introducerCommissionsExpanded, setIntroducerCommissionsExpanded] = useState(true);\r\n  const [partnerCommissions, setPartnerCommissions] = useState<PartnerCommission[]>([]);\r\n  const [partnerCommissionsLoading, setPartnerCommissionsLoading] = useState(true);\r\n  const [partnerCommissionsExpanded, setPartnerCommissionsExpanded] = useState(true);\r\n  const [commercialPartnerCommissions, setCommercialPartnerCommissions] = useState<CommercialPartnerCommission[]>([]);\r\n  const [commercialPartnerCommissionsLoading, setCommercialPartnerCommissionsLoading] = useState(true);\r\n  const [commercialPartnerCommissionsExpanded, setCommercialPartnerCommissionsExpanded] = useState(true);\r\n\r\n  // Filter state\r\n  const [deals, setDeals] = useState<Deal[]>([]);\r\n  const [entities, setEntities] = useState<Entity[]>([]);\r\n  const [selectedDealIds, setSelectedDealIds] = useState<string[]>(() => {\r\n    const dealIds = searchParams.get('deal_ids');\r\n    return dealIds ? dealIds.split(',') : [];\r\n  });\r\n  const [selectedEntityIds, setSelectedEntityIds] = useState<string[]>(() => {\r\n    const entityIds = searchParams.get('entity_ids');\r\n    return entityIds ? entityIds.split(',') : [];\r\n  });\r\n  const [dateRange, setDateRange] = useState<DateRange | undefined>(() => {\r\n    const from = searchParams.get('date_from');\r\n    const to = searchParams.get('date_to');\r\n    if (from || to) {\r\n      return {\r\n        from: from ? new Date(from) : undefined,\r\n        to: to ? new Date(to) : undefined,\r\n      };\r\n    }\r\n    return undefined;\r\n  });\r\n  const [dealPopoverOpen, setDealPopoverOpen] = useState(false);\r\n  const [entityPopoverOpen, setEntityPopoverOpen] = useState(false);\r\n\r\n  // Check if any filters are active\r\n  const hasActiveFilters = selectedDealIds.length > 0 || selectedEntityIds.length > 0 || dateRange?.from || dateRange?.to;\r\n\r\n  // Update URL when filters change\r\n  useEffect(() => {\r\n    const params = new URLSearchParams(searchParams.toString());\r\n\r\n    if (selectedDealIds.length > 0) {\r\n      params.set('deal_ids', selectedDealIds.join(','));\r\n    } else {\r\n      params.delete('deal_ids');\r\n    }\r\n\r\n    if (selectedEntityIds.length > 0) {\r\n      params.set('entity_ids', selectedEntityIds.join(','));\r\n    } else {\r\n      params.delete('entity_ids');\r\n    }\r\n\r\n    if (dateRange?.from) {\r\n      params.set('date_from', dateRange.from.toISOString().split('T')[0]);\r\n    } else {\r\n      params.delete('date_from');\r\n    }\r\n\r\n    if (dateRange?.to) {\r\n      params.set('date_to', dateRange.to.toISOString().split('T')[0]);\r\n    } else {\r\n      params.delete('date_to');\r\n    }\r\n\r\n    const newUrl = params.toString() ? `?${params.toString()}` : window.location.pathname;\r\n    router.push(newUrl, { scroll: false });\r\n  }, [selectedDealIds, selectedEntityIds, dateRange, router, searchParams]);\r\n\r\n  // Fetch deals list for filter\r\n  const fetchDeals = useCallback(async () => {\r\n    try {\r\n      const res = await fetch('/api/deals');\r\n      const json = await res.json();\r\n      setDeals(json.deals || []);\r\n    } catch (error) {\r\n      console.error('Error fetching deals:', error);\r\n    }\r\n  }, []);\r\n\r\n  // Fetch entities list for filter - uses commissions API to get unique entities\r\n  const fetchEntities = useCallback(async () => {\r\n    try {\r\n      // Fetch all commissions to extract unique entities\r\n      const res = await fetch('/api/staff/fees/commissions');\r\n      const json = await res.json();\r\n\r\n      // Use by_entity which has already grouped unique entities\r\n      const byEntity = json.by_entity || [];\r\n      const allEntities: Entity[] = byEntity.map((group: { entity_type: string; entity: { id: string; name: string } }) => ({\r\n        id: group.entity.id,\r\n        name: group.entity.name,\r\n        type: group.entity_type as 'introducer' | 'partner' | 'commercial_partner',\r\n      }));\r\n\r\n      // Also try to get introducers from dedicated endpoint for completeness\r\n      try {\r\n        const introducersRes = await fetch('/api/staff/introducers');\r\n        const introducersJson = await introducersRes.json();\r\n        const introducers = (introducersJson.data || []).map((e: { id: string; legal_name?: string; name?: string }) => ({\r\n          id: e.id,\r\n          name: e.legal_name || e.name || 'Unknown',\r\n          type: 'introducer' as const,\r\n        }));\r\n\r\n        // Merge introducers, avoiding duplicates\r\n        const existingIds = new Set(allEntities.map(e => e.id));\r\n        for (const introducer of introducers) {\r\n          if (!existingIds.has(introducer.id)) {\r\n            allEntities.push(introducer);\r\n          }\r\n        }\r\n      } catch {\r\n        // Introducers endpoint may not be accessible, that's ok\r\n      }\r\n\r\n      // Sort by name\r\n      allEntities.sort((a, b) => a.name.localeCompare(b.name));\r\n\r\n      setEntities(allEntities);\r\n    } catch (error) {\r\n      console.error('Error fetching entities:', error);\r\n    }\r\n  }, []);\r\n\r\n  // Clear all filters\r\n  const clearFilters = useCallback(() => {\r\n    setSelectedDealIds([]);\r\n    setSelectedEntityIds([]);\r\n    setDateRange(undefined);\r\n  }, []);\r\n\r\n  // Toggle deal selection\r\n  const toggleDeal = (dealId: string) => {\r\n    setSelectedDealIds((prev) =>\r\n      prev.includes(dealId) ? prev.filter((id) => id !== dealId) : [...prev, dealId]\r\n    );\r\n  };\r\n\r\n  // Toggle entity selection\r\n  const toggleEntity = (entityId: string) => {\r\n    setSelectedEntityIds((prev) =>\r\n      prev.includes(entityId) ? prev.filter((id) => id !== entityId) : [...prev, entityId]\r\n    );\r\n  };\r\n\r\n  // Get selected deal names for display\r\n  const selectedDealNames = useMemo(() => {\r\n    return selectedDealIds\r\n      .map((id) => deals.find((d) => d.id === id)?.name)\r\n      .filter(Boolean)\r\n      .join(', ');\r\n  }, [selectedDealIds, deals]);\r\n\r\n  // Get selected entity names for display\r\n  const selectedEntityNames = useMemo(() => {\r\n    return selectedEntityIds\r\n      .map((id) => entities.find((e) => e.id === id)?.name)\r\n      .filter(Boolean)\r\n      .join(', ');\r\n  }, [selectedEntityIds, entities]);\r\n\r\n  // Load deals and entities on mount\r\n  useEffect(() => {\r\n    fetchDeals();\r\n    fetchEntities();\r\n  }, [fetchDeals, fetchEntities]);\r\n\r\n  const fetchSchedules = useCallback(async () => {\r\n    setLoading(true);\r\n    try {\r\n      const res = await fetch(`/api/staff/fees/schedules?days=${daysAhead}`);\r\n      const json = await res.json();\r\n      setData(json);\r\n    } catch (error) {\r\n      console.error('Error fetching schedules:', error);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }, [daysAhead]);\r\n\r\n  const fetchInvestorFees = useCallback(async () => {\r\n    setInvestorFeesLoading(true);\r\n    try {\r\n      // Get fee events with status = 'accrued' and future period_start_date\r\n      const params = new URLSearchParams();\r\n      params.set('status', 'accrued');\r\n      params.set('limit', '200');\r\n\r\n      // Use date range or default to today\r\n      if (dateRange?.from) {\r\n        params.set('period_from', dateRange.from.toISOString().split('T')[0]);\r\n      } else {\r\n        params.set('period_from', new Date().toISOString().split('T')[0]);\r\n      }\r\n      if (dateRange?.to) {\r\n        params.set('period_to', dateRange.to.toISOString().split('T')[0]);\r\n      }\r\n\r\n      const res = await fetch(`/api/staff/fees/events?${params.toString()}`);\r\n      const json = await res.json();\r\n\r\n      let feeData = json.data || [];\r\n\r\n      // Filter by selected deals (client-side since API doesn't support multiple deal_ids)\r\n      if (selectedDealIds.length > 0) {\r\n        feeData = feeData.filter((fee: InvestorFeeEvent) =>\r\n          fee.deal?.id && selectedDealIds.includes(fee.deal.id)\r\n        );\r\n      }\r\n\r\n      setInvestorFees(feeData);\r\n    } catch (error) {\r\n      console.error('Error fetching investor fees:', error);\r\n      setInvestorFees([]);\r\n    } finally {\r\n      setInvestorFeesLoading(false);\r\n    }\r\n  }, [selectedDealIds, dateRange]);\r\n\r\n  const fetchIntroducerCommissions = useCallback(async () => {\r\n    setIntroducerCommissionsLoading(true);\r\n    try {\r\n      // Get introducer commissions with status = 'accrued' for schedule view\r\n      const params = new URLSearchParams();\r\n      params.set('entity_type', 'introducer');\r\n      params.set('status', 'accrued');\r\n\r\n      const res = await fetch(`/api/staff/fees/commissions?${params.toString()}`);\r\n      const json = await res.json();\r\n\r\n      let introducerData = (json.data || []).filter(\r\n        (c: IntroducerCommission) => c.entity_type === 'introducer'\r\n      );\r\n\r\n      // Filter by selected deals\r\n      if (selectedDealIds.length > 0) {\r\n        introducerData = introducerData.filter((c: IntroducerCommission) =>\r\n          c.deal_id && selectedDealIds.includes(c.deal_id)\r\n        );\r\n      }\r\n\r\n      // Filter by selected entities (introducers)\r\n      if (selectedEntityIds.length > 0) {\r\n        introducerData = introducerData.filter((c: IntroducerCommission) =>\r\n          selectedEntityIds.includes(c.entity_id)\r\n        );\r\n      }\r\n\r\n      // Filter by date range (created_at)\r\n      if (dateRange?.from) {\r\n        introducerData = introducerData.filter((c: IntroducerCommission) =>\r\n          new Date(c.created_at) >= dateRange.from!\r\n        );\r\n      }\r\n      if (dateRange?.to) {\r\n        introducerData = introducerData.filter((c: IntroducerCommission) =>\r\n          new Date(c.created_at) <= dateRange.to!\r\n        );\r\n      }\r\n\r\n      setIntroducerCommissions(introducerData);\r\n    } catch (error) {\r\n      console.error('Error fetching introducer commissions:', error);\r\n      setIntroducerCommissions([]);\r\n    } finally {\r\n      setIntroducerCommissionsLoading(false);\r\n    }\r\n  }, [selectedDealIds, selectedEntityIds, dateRange]);\r\n\r\n  const fetchPartnerCommissions = useCallback(async () => {\r\n    setPartnerCommissionsLoading(true);\r\n    try {\r\n      // Get partner commissions with status = 'accrued' for schedule view\r\n      const params = new URLSearchParams();\r\n      params.set('entity_type', 'partner');\r\n      params.set('status', 'accrued');\r\n\r\n      const res = await fetch(`/api/staff/fees/commissions?${params.toString()}`);\r\n      const json = await res.json();\r\n\r\n      let partnerData = (json.data || []).filter(\r\n        (c: PartnerCommission) => c.entity_type === 'partner'\r\n      );\r\n\r\n      // Filter by selected deals\r\n      if (selectedDealIds.length > 0) {\r\n        partnerData = partnerData.filter((c: PartnerCommission) =>\r\n          c.deal_id && selectedDealIds.includes(c.deal_id)\r\n        );\r\n      }\r\n\r\n      // Filter by selected entities (partners)\r\n      if (selectedEntityIds.length > 0) {\r\n        partnerData = partnerData.filter((c: PartnerCommission) =>\r\n          selectedEntityIds.includes(c.entity_id)\r\n        );\r\n      }\r\n\r\n      // Filter by date range (created_at)\r\n      if (dateRange?.from) {\r\n        partnerData = partnerData.filter((c: PartnerCommission) =>\r\n          new Date(c.created_at) >= dateRange.from!\r\n        );\r\n      }\r\n      if (dateRange?.to) {\r\n        partnerData = partnerData.filter((c: PartnerCommission) =>\r\n          new Date(c.created_at) <= dateRange.to!\r\n        );\r\n      }\r\n\r\n      setPartnerCommissions(partnerData);\r\n    } catch (error) {\r\n      console.error('Error fetching partner commissions:', error);\r\n      setPartnerCommissions([]);\r\n    } finally {\r\n      setPartnerCommissionsLoading(false);\r\n    }\r\n  }, [selectedDealIds, selectedEntityIds, dateRange]);\r\n\r\n  const fetchCommercialPartnerCommissions = useCallback(async () => {\r\n    setCommercialPartnerCommissionsLoading(true);\r\n    try {\r\n      // Get commercial partner commissions with status = 'accrued' for schedule view\r\n      const params = new URLSearchParams();\r\n      params.set('entity_type', 'commercial_partner');\r\n      params.set('status', 'accrued');\r\n\r\n      const res = await fetch(`/api/staff/fees/commissions?${params.toString()}`);\r\n      const json = await res.json();\r\n\r\n      let commercialPartnerData = (json.data || []).filter(\r\n        (c: CommercialPartnerCommission) => c.entity_type === 'commercial_partner'\r\n      );\r\n\r\n      // Filter by selected deals\r\n      if (selectedDealIds.length > 0) {\r\n        commercialPartnerData = commercialPartnerData.filter((c: CommercialPartnerCommission) =>\r\n          c.deal_id && selectedDealIds.includes(c.deal_id)\r\n        );\r\n      }\r\n\r\n      // Filter by selected entities (commercial partners)\r\n      if (selectedEntityIds.length > 0) {\r\n        commercialPartnerData = commercialPartnerData.filter((c: CommercialPartnerCommission) =>\r\n          selectedEntityIds.includes(c.entity_id)\r\n        );\r\n      }\r\n\r\n      // Filter by date range (created_at)\r\n      if (dateRange?.from) {\r\n        commercialPartnerData = commercialPartnerData.filter((c: CommercialPartnerCommission) =>\r\n          new Date(c.created_at) >= dateRange.from!\r\n        );\r\n      }\r\n      if (dateRange?.to) {\r\n        commercialPartnerData = commercialPartnerData.filter((c: CommercialPartnerCommission) =>\r\n          new Date(c.created_at) <= dateRange.to!\r\n        );\r\n      }\r\n\r\n      setCommercialPartnerCommissions(commercialPartnerData);\r\n    } catch (error) {\r\n      console.error('Error fetching commercial partner commissions:', error);\r\n      setCommercialPartnerCommissions([]);\r\n    } finally {\r\n      setCommercialPartnerCommissionsLoading(false);\r\n    }\r\n  }, [selectedDealIds, selectedEntityIds, dateRange]);\r\n\r\n  useEffect(() => {\r\n    fetchSchedules();\r\n  }, [daysAhead, fetchSchedules]);\r\n\r\n  useEffect(() => {\r\n    fetchInvestorFees();\r\n  }, [fetchInvestorFees]);\r\n\r\n  useEffect(() => {\r\n    fetchIntroducerCommissions();\r\n  }, [fetchIntroducerCommissions]);\r\n\r\n  useEffect(() => {\r\n    fetchPartnerCommissions();\r\n  }, [fetchPartnerCommissions]);\r\n\r\n  useEffect(() => {\r\n    fetchCommercialPartnerCommissions();\r\n  }, [fetchCommercialPartnerCommissions]);\r\n\r\n  // Group investor fees by deal, then by investor\r\n  const groupedInvestorFees = useMemo(() => {\r\n    const byDeal: Record<string, {\r\n      deal: { id: string; name: string };\r\n      byInvestor: Record<string, {\r\n        investor: { id: string; name: string };\r\n        fees: InvestorFeeEvent[];\r\n        total: number;\r\n      }>;\r\n      total: number;\r\n    }> = {};\r\n\r\n    for (const fee of investorFees) {\r\n      const dealId = fee.deal?.id || 'unknown';\r\n      const dealName = fee.deal?.name || 'Unknown Deal';\r\n      const investorId = fee.investor?.id || 'unknown';\r\n      const investorName = fee.investor?.legal_name || fee.investor?.display_name || 'Unknown Investor';\r\n\r\n      if (!byDeal[dealId]) {\r\n        byDeal[dealId] = {\r\n          deal: { id: dealId, name: dealName },\r\n          byInvestor: {},\r\n          total: 0,\r\n        };\r\n      }\r\n\r\n      if (!byDeal[dealId].byInvestor[investorId]) {\r\n        byDeal[dealId].byInvestor[investorId] = {\r\n          investor: { id: investorId, name: investorName },\r\n          fees: [],\r\n          total: 0,\r\n        };\r\n      }\r\n\r\n      byDeal[dealId].byInvestor[investorId].fees.push(fee);\r\n      byDeal[dealId].byInvestor[investorId].total += fee.computed_amount;\r\n      byDeal[dealId].total += fee.computed_amount;\r\n    }\r\n\r\n    // Sort fees by period_start_date within each group\r\n    Object.values(byDeal).forEach(dealGroup => {\r\n      Object.values(dealGroup.byInvestor).forEach(investorGroup => {\r\n        investorGroup.fees.sort((a, b) => {\r\n          const dateA = a.period_start_date || a.event_date;\r\n          const dateB = b.period_start_date || b.event_date;\r\n          return new Date(dateA).getTime() - new Date(dateB).getTime();\r\n        });\r\n      });\r\n    });\r\n\r\n    return byDeal;\r\n  }, [investorFees]);\r\n\r\n  const investorFeesTotal = useMemo(() => {\r\n    return investorFees.reduce((sum, fee) => sum + fee.computed_amount, 0);\r\n  }, [investorFees]);\r\n\r\n  // Group introducer commissions by introducer, then by deal\r\n  const groupedIntroducerCommissions = useMemo(() => {\r\n    const byIntroducer: Record<string, {\r\n      introducer: { id: string; name: string };\r\n      byDeal: Record<string, {\r\n        deal: { id: string; name: string };\r\n        commissions: IntroducerCommission[];\r\n        total: number;\r\n      }>;\r\n      total: number;\r\n    }> = {};\r\n\r\n    for (const commission of introducerCommissions) {\r\n      const introducerId = commission.entity_id || 'unknown';\r\n      const introducerName = commission.entity_name || 'Unknown Introducer';\r\n      const dealId = commission.deal_id || 'unknown';\r\n      const dealName = commission.deal_name || 'Unknown Deal';\r\n\r\n      if (!byIntroducer[introducerId]) {\r\n        byIntroducer[introducerId] = {\r\n          introducer: { id: introducerId, name: introducerName },\r\n          byDeal: {},\r\n          total: 0,\r\n        };\r\n      }\r\n\r\n      if (!byIntroducer[introducerId].byDeal[dealId]) {\r\n        byIntroducer[introducerId].byDeal[dealId] = {\r\n          deal: { id: dealId, name: dealName },\r\n          commissions: [],\r\n          total: 0,\r\n        };\r\n      }\r\n\r\n      byIntroducer[introducerId].byDeal[dealId].commissions.push(commission);\r\n      byIntroducer[introducerId].byDeal[dealId].total += Number(commission.accrual_amount);\r\n      byIntroducer[introducerId].total += Number(commission.accrual_amount);\r\n    }\r\n\r\n    // Sort commissions by created_at within each group\r\n    Object.values(byIntroducer).forEach(introducerGroup => {\r\n      Object.values(introducerGroup.byDeal).forEach(dealGroup => {\r\n        dealGroup.commissions.sort((a, b) => {\r\n          return new Date(b.created_at).getTime() - new Date(a.created_at).getTime();\r\n        });\r\n      });\r\n    });\r\n\r\n    return byIntroducer;\r\n  }, [introducerCommissions]);\r\n\r\n  const introducerCommissionsTotal = useMemo(() => {\r\n    return introducerCommissions.reduce((sum, c) => sum + Number(c.accrual_amount), 0);\r\n  }, [introducerCommissions]);\r\n\r\n  // Group partner commissions by partner, then by deal\r\n  const groupedPartnerCommissions = useMemo(() => {\r\n    const byPartner: Record<string, {\r\n      partner: { id: string; name: string };\r\n      byDeal: Record<string, {\r\n        deal: { id: string; name: string };\r\n        commissions: PartnerCommission[];\r\n        total: number;\r\n      }>;\r\n      total: number;\r\n    }> = {};\r\n\r\n    for (const commission of partnerCommissions) {\r\n      const partnerId = commission.entity_id || 'unknown';\r\n      const partnerName = commission.entity_name || 'Unknown Partner';\r\n      const dealId = commission.deal_id || 'unknown';\r\n      const dealName = commission.deal_name || 'Unknown Deal';\r\n\r\n      if (!byPartner[partnerId]) {\r\n        byPartner[partnerId] = {\r\n          partner: { id: partnerId, name: partnerName },\r\n          byDeal: {},\r\n          total: 0,\r\n        };\r\n      }\r\n\r\n      if (!byPartner[partnerId].byDeal[dealId]) {\r\n        byPartner[partnerId].byDeal[dealId] = {\r\n          deal: { id: dealId, name: dealName },\r\n          commissions: [],\r\n          total: 0,\r\n        };\r\n      }\r\n\r\n      byPartner[partnerId].byDeal[dealId].commissions.push(commission);\r\n      byPartner[partnerId].byDeal[dealId].total += Number(commission.accrual_amount);\r\n      byPartner[partnerId].total += Number(commission.accrual_amount);\r\n    }\r\n\r\n    // Sort commissions by created_at within each group\r\n    Object.values(byPartner).forEach(partnerGroup => {\r\n      Object.values(partnerGroup.byDeal).forEach(dealGroup => {\r\n        dealGroup.commissions.sort((a, b) => {\r\n          return new Date(b.created_at).getTime() - new Date(a.created_at).getTime();\r\n        });\r\n      });\r\n    });\r\n\r\n    return byPartner;\r\n  }, [partnerCommissions]);\r\n\r\n  const partnerCommissionsTotal = useMemo(() => {\r\n    return partnerCommissions.reduce((sum, c) => sum + Number(c.accrual_amount), 0);\r\n  }, [partnerCommissions]);\r\n\r\n  // Group commercial partner commissions by commercial partner, then by deal\r\n  const groupedCommercialPartnerCommissions = useMemo(() => {\r\n    const byCommercialPartner: Record<string, {\r\n      commercialPartner: { id: string; name: string };\r\n      byDeal: Record<string, {\r\n        deal: { id: string; name: string };\r\n        commissions: CommercialPartnerCommission[];\r\n        total: number;\r\n      }>;\r\n      total: number;\r\n    }> = {};\r\n\r\n    for (const commission of commercialPartnerCommissions) {\r\n      const commercialPartnerId = commission.entity_id || 'unknown';\r\n      const commercialPartnerName = commission.entity_name || 'Unknown Commercial Partner';\r\n      const dealId = commission.deal_id || 'unknown';\r\n      const dealName = commission.deal_name || 'Unknown Deal';\r\n\r\n      if (!byCommercialPartner[commercialPartnerId]) {\r\n        byCommercialPartner[commercialPartnerId] = {\r\n          commercialPartner: { id: commercialPartnerId, name: commercialPartnerName },\r\n          byDeal: {},\r\n          total: 0,\r\n        };\r\n      }\r\n\r\n      if (!byCommercialPartner[commercialPartnerId].byDeal[dealId]) {\r\n        byCommercialPartner[commercialPartnerId].byDeal[dealId] = {\r\n          deal: { id: dealId, name: dealName },\r\n          commissions: [],\r\n          total: 0,\r\n        };\r\n      }\r\n\r\n      byCommercialPartner[commercialPartnerId].byDeal[dealId].commissions.push(commission);\r\n      byCommercialPartner[commercialPartnerId].byDeal[dealId].total += Number(commission.accrual_amount);\r\n      byCommercialPartner[commercialPartnerId].total += Number(commission.accrual_amount);\r\n    }\r\n\r\n    // Sort commissions by created_at within each group\r\n    Object.values(byCommercialPartner).forEach(commercialPartnerGroup => {\r\n      Object.values(commercialPartnerGroup.byDeal).forEach(dealGroup => {\r\n        dealGroup.commissions.sort((a, b) => {\r\n          return new Date(b.created_at).getTime() - new Date(a.created_at).getTime();\r\n        });\r\n      });\r\n    });\r\n\r\n    return byCommercialPartner;\r\n  }, [commercialPartnerCommissions]);\r\n\r\n  const commercialPartnerCommissionsTotal = useMemo(() => {\r\n    return commercialPartnerCommissions.reduce((sum, c) => sum + Number(c.accrual_amount), 0);\r\n  }, [commercialPartnerCommissions]);\r\n\r\n  if (loading) {\r\n    return <div className=\"text-white\">Loading fee schedules...</div>;\r\n  }\r\n\r\n  if (!data) {\r\n    return <div className=\"text-white\">Failed to load fee schedules</div>;\r\n  }\r\n\r\n  const feeTypeColors: Record<string, string> = {\r\n    management: 'bg-blue-500/20 text-blue-400 border-blue-500/30',\r\n    subscription: 'bg-purple-500/20 text-purple-400 border-purple-500/30',\r\n    performance: 'bg-green-500/20 text-green-400 border-green-500/30',\r\n  };\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      {/* Header */}\r\n      <div>\r\n        <h2 className=\"text-2xl font-bold text-white\">Fee Schedule</h2>\r\n        <p className=\"text-gray-400\">Upcoming recurring fees for the next {daysAhead} days</p>\r\n      </div>\r\n\r\n      {/* Summary Cards */}\r\n      <div className=\"grid gap-4 md:grid-cols-3\">\r\n        <Card>\r\n          <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\r\n            <CardTitle className=\"text-sm font-medium\">Total Scheduled</CardTitle>\r\n            <Calendar className=\"h-4 w-4 text-muted-foreground\" />\r\n          </CardHeader>\r\n          <CardContent>\r\n            <div className=\"text-2xl font-bold text-white\">\r\n              {data.summary.total_scheduled}\r\n            </div>\r\n            <p className=\"text-xs text-gray-400\">\r\n              Recurring fees due\r\n            </p>\r\n          </CardContent>\r\n        </Card>\r\n\r\n        <Card>\r\n          <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\r\n            <CardTitle className=\"text-sm font-medium\">Expected Revenue</CardTitle>\r\n            <DollarSign className=\"h-4 w-4 text-muted-foreground\" />\r\n          </CardHeader>\r\n          <CardContent>\r\n            <div className=\"text-2xl font-bold text-white\">\r\n              {formatCurrency(data.summary.total_amount)}\r\n            </div>\r\n            <p className=\"text-xs text-gray-400\">\r\n              Total amount scheduled\r\n            </p>\r\n          </CardContent>\r\n        </Card>\r\n\r\n        <Card>\r\n          <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\r\n            <CardTitle className=\"text-sm font-medium\">Date Range</CardTitle>\r\n            <Clock className=\"h-4 w-4 text-muted-foreground\" />\r\n          </CardHeader>\r\n          <CardContent>\r\n            <div className=\"text-sm font-medium text-white\">\r\n              {new Date(data.summary.date_range.from).toLocaleDateString('en-US', { month: 'short', day: 'numeric' })}\r\n              {' - '}\r\n              {new Date(data.summary.date_range.to).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' })}\r\n            </div>\r\n            <p className=\"text-xs text-gray-400\">\r\n              Forecast period\r\n            </p>\r\n          </CardContent>\r\n        </Card>\r\n      </div>\r\n\r\n      {/* Time Range Selector */}\r\n      <div className=\"flex gap-2\">\r\n        {[30, 60, 90, 180].map((days) => (\r\n          <Button\r\n            key={days}\r\n            variant={daysAhead === days ? 'default' : 'outline'}\r\n            size=\"sm\"\r\n            onClick={() => setDaysAhead(days)}\r\n          >\r\n            {days} days\r\n          </Button>\r\n        ))}\r\n      </div>\r\n\r\n      {/* Filter Controls */}\r\n      <Card>\r\n        <CardHeader className=\"pb-3\">\r\n          <div className=\"flex items-center justify-between\">\r\n            <div className=\"flex items-center gap-2\">\r\n              <Filter className=\"h-4 w-4 text-gray-400\" />\r\n              <CardTitle className=\"text-sm\">Filters</CardTitle>\r\n              {hasActiveFilters && (\r\n                <Badge variant=\"secondary\" className=\"text-xs\">\r\n                  {selectedDealIds.length + selectedEntityIds.length + (dateRange ? 1 : 0)} active\r\n                </Badge>\r\n              )}\r\n            </div>\r\n            {hasActiveFilters && (\r\n              <Button variant=\"ghost\" size=\"sm\" onClick={clearFilters} className=\"h-7 text-xs\">\r\n                <X className=\"h-3 w-3 mr-1\" />\r\n                Clear all\r\n              </Button>\r\n            )}\r\n          </div>\r\n        </CardHeader>\r\n        <CardContent className=\"pt-0\">\r\n          <div className=\"flex flex-wrap gap-3\">\r\n            {/* Deal Filter */}\r\n            <Popover open={dealPopoverOpen} onOpenChange={setDealPopoverOpen}>\r\n              <PopoverTrigger asChild>\r\n                <Button\r\n                  variant=\"outline\"\r\n                  role=\"combobox\"\r\n                  aria-expanded={dealPopoverOpen}\r\n                  className=\"min-w-[200px] justify-between text-left font-normal\"\r\n                >\r\n                  <span className=\"truncate\">\r\n                    {selectedDealIds.length > 0\r\n                      ? selectedDealIds.length === 1\r\n                        ? selectedDealNames\r\n                        : `${selectedDealIds.length} deals selected`\r\n                      : 'Select deals...'}\r\n                  </span>\r\n                  <ChevronsUpDown className=\"ml-2 h-4 w-4 shrink-0 opacity-50\" />\r\n                </Button>\r\n              </PopoverTrigger>\r\n              <PopoverContent className=\"w-[300px] p-0\" align=\"start\">\r\n                <Command>\r\n                  <CommandInput placeholder=\"Search deals...\" />\r\n                  <CommandList>\r\n                    <CommandEmpty>No deals found.</CommandEmpty>\r\n                    <CommandGroup heading=\"Deals\">\r\n                      {deals.map((deal) => (\r\n                        <CommandItem\r\n                          key={deal.id}\r\n                          value={deal.name}\r\n                          onSelect={() => toggleDeal(deal.id)}\r\n                        >\r\n                          <div className=\"flex items-center gap-2 w-full\">\r\n                            <Checkbox\r\n                              checked={selectedDealIds.includes(deal.id)}\r\n                              onCheckedChange={() => toggleDeal(deal.id)}\r\n                              className=\"h-4 w-4\"\r\n                            />\r\n                            <span className=\"truncate\">{deal.name}</span>\r\n                          </div>\r\n                        </CommandItem>\r\n                      ))}\r\n                    </CommandGroup>\r\n                  </CommandList>\r\n                </Command>\r\n              </PopoverContent>\r\n            </Popover>\r\n\r\n            {/* Entity Filter */}\r\n            <Popover open={entityPopoverOpen} onOpenChange={setEntityPopoverOpen}>\r\n              <PopoverTrigger asChild>\r\n                <Button\r\n                  variant=\"outline\"\r\n                  role=\"combobox\"\r\n                  aria-expanded={entityPopoverOpen}\r\n                  className=\"min-w-[200px] justify-between text-left font-normal\"\r\n                >\r\n                  <span className=\"truncate\">\r\n                    {selectedEntityIds.length > 0\r\n                      ? selectedEntityIds.length === 1\r\n                        ? selectedEntityNames\r\n                        : `${selectedEntityIds.length} entities selected`\r\n                      : 'Select entities...'}\r\n                  </span>\r\n                  <ChevronsUpDown className=\"ml-2 h-4 w-4 shrink-0 opacity-50\" />\r\n                </Button>\r\n              </PopoverTrigger>\r\n              <PopoverContent className=\"w-[300px] p-0\" align=\"start\">\r\n                <Command>\r\n                  <CommandInput placeholder=\"Search entities...\" />\r\n                  <CommandList>\r\n                    <CommandEmpty>No entities found.</CommandEmpty>\r\n                    {/* Group by entity type */}\r\n                    {['introducer', 'partner', 'commercial_partner'].map((type) => {\r\n                      const typeEntities = entities.filter((e) => e.type === type);\r\n                      if (typeEntities.length === 0) return null;\r\n\r\n                      const typeLabels: Record<string, string> = {\r\n                        introducer: 'Introducers',\r\n                        partner: 'Partners',\r\n                        commercial_partner: 'Commercial Partners',\r\n                      };\r\n\r\n                      return (\r\n                        <CommandGroup key={type} heading={typeLabels[type]}>\r\n                          {typeEntities.map((entity) => (\r\n                            <CommandItem\r\n                              key={entity.id}\r\n                              value={`${entity.type}-${entity.name}`}\r\n                              onSelect={() => toggleEntity(entity.id)}\r\n                            >\r\n                              <div className=\"flex items-center gap-2 w-full\">\r\n                                <Checkbox\r\n                                  checked={selectedEntityIds.includes(entity.id)}\r\n                                  onCheckedChange={() => toggleEntity(entity.id)}\r\n                                  className=\"h-4 w-4\"\r\n                                />\r\n                                {entity.type === 'introducer' && (\r\n                                  <UserCheck className=\"h-3.5 w-3.5 text-blue-400 shrink-0\" />\r\n                                )}\r\n                                {entity.type === 'partner' && (\r\n                                  <Handshake className=\"h-3.5 w-3.5 text-green-400 shrink-0\" />\r\n                                )}\r\n                                {entity.type === 'commercial_partner' && (\r\n                                  <Briefcase className=\"h-3.5 w-3.5 text-purple-400 shrink-0\" />\r\n                                )}\r\n                                <span className=\"truncate\">{entity.name}</span>\r\n                              </div>\r\n                            </CommandItem>\r\n                          ))}\r\n                        </CommandGroup>\r\n                      );\r\n                    })}\r\n                  </CommandList>\r\n                </Command>\r\n              </PopoverContent>\r\n            </Popover>\r\n\r\n            {/* Date Range Filter */}\r\n            <DateRangePicker\r\n              value={dateRange}\r\n              onChange={setDateRange}\r\n              variant=\"dark\"\r\n            />\r\n          </div>\r\n        </CardContent>\r\n      </Card>\r\n\r\n      {/* Investor Fees Section */}\r\n      <Collapsible open={investorFeesExpanded} onOpenChange={setInvestorFeesExpanded}>\r\n        <Card>\r\n          <CardHeader className=\"pb-3\">\r\n            <CollapsibleTrigger asChild>\r\n              <button className=\"flex w-full items-center justify-between text-left\">\r\n                <div className=\"flex items-center gap-3\">\r\n                  <Users className=\"h-5 w-5 text-blue-400\" />\r\n                  <div>\r\n                    <CardTitle className=\"text-lg\">Investor Fees</CardTitle>\r\n                    <p className=\"text-sm text-gray-400 mt-0.5\">\r\n                      Accrued fees pending collection\r\n                    </p>\r\n                  </div>\r\n                </div>\r\n                <div className=\"flex items-center gap-4\">\r\n                  <div className=\"text-right\">\r\n                    <div className=\"text-sm font-medium text-white\">\r\n                      {investorFees.length} fee{investorFees.length !== 1 ? 's' : ''}\r\n                    </div>\r\n                    <div className=\"text-sm text-gray-400\">\r\n                      {formatCurrency(investorFeesTotal)}\r\n                    </div>\r\n                  </div>\r\n                  {investorFeesExpanded ? (\r\n                    <ChevronDown className=\"h-5 w-5 text-gray-400\" />\r\n                  ) : (\r\n                    <ChevronRight className=\"h-5 w-5 text-gray-400\" />\r\n                  )}\r\n                </div>\r\n              </button>\r\n            </CollapsibleTrigger>\r\n          </CardHeader>\r\n          <CollapsibleContent>\r\n            <CardContent className=\"pt-0\">\r\n              {investorFeesLoading ? (\r\n                <p className=\"text-gray-400 py-4\">Loading investor fees...</p>\r\n              ) : investorFees.length === 0 ? (\r\n                <p className=\"text-gray-400 py-4\">No accrued investor fees with future periods</p>\r\n              ) : (\r\n                <div className=\"space-y-6\">\r\n                  {Object.entries(groupedInvestorFees).map(([dealId, dealGroup]) => (\r\n                    <div key={dealId} className=\"space-y-4\">\r\n                      {/* Deal Header */}\r\n                      <div className=\"flex items-center gap-2 border-b border-gray-700 pb-2\">\r\n                        <Building2 className=\"h-4 w-4 text-purple-400\" />\r\n                        <h4 className=\"font-semibold text-white\">{dealGroup.deal.name}</h4>\r\n                        <span className=\"text-sm text-gray-400 ml-auto\">\r\n                          {formatCurrency(dealGroup.total)}\r\n                        </span>\r\n                      </div>\r\n\r\n                      {/* Investors within Deal */}\r\n                      {Object.entries(dealGroup.byInvestor).map(([investorId, investorGroup]) => (\r\n                        <div key={investorId} className=\"ml-6 space-y-2\">\r\n                          {/* Investor Header */}\r\n                          <div className=\"flex items-center gap-2\">\r\n                            <Users className=\"h-3.5 w-3.5 text-gray-500\" />\r\n                            <h5 className=\"font-medium text-gray-200\">{investorGroup.investor.name}</h5>\r\n                            <span className=\"text-sm text-gray-400 ml-auto\">\r\n                              {formatCurrency(investorGroup.total)}\r\n                            </span>\r\n                          </div>\r\n\r\n                          {/* Fee Events Table */}\r\n                          <div className=\"overflow-x-auto\">\r\n                            <table className=\"w-full text-sm\">\r\n                              <thead>\r\n                                <tr className=\"border-b border-gray-700\">\r\n                                  <th className=\"text-left py-2 px-2 text-gray-400 font-medium\">Fee Type</th>\r\n                                  <th className=\"text-right py-2 px-2 text-gray-400 font-medium\">Amount</th>\r\n                                  <th className=\"text-left py-2 px-2 text-gray-400 font-medium\">Period Start</th>\r\n                                  <th className=\"text-left py-2 px-2 text-gray-400 font-medium\">Period End</th>\r\n                                </tr>\r\n                              </thead>\r\n                              <tbody>\r\n                                {investorGroup.fees.map((fee) => (\r\n                                  <tr key={fee.id} className=\"border-b border-gray-800\">\r\n                                    <td className=\"py-2 px-2\">\r\n                                      <Badge className={feeTypeColors[fee.fee_type] || 'bg-gray-500/20 text-gray-400 border-gray-500/30'}>\r\n                                        {fee.fee_type}\r\n                                      </Badge>\r\n                                    </td>\r\n                                    <td className=\"py-2 px-2 text-right text-white font-medium\">\r\n                                      {formatCurrency(fee.computed_amount)}\r\n                                    </td>\r\n                                    <td className=\"py-2 px-2 text-gray-300\">\r\n                                      {fee.period_start_date\r\n                                        ? new Date(fee.period_start_date).toLocaleDateString('en-US', {\r\n                                            month: 'short',\r\n                                            day: 'numeric',\r\n                                            year: 'numeric',\r\n                                          })\r\n                                        : '-'}\r\n                                    </td>\r\n                                    <td className=\"py-2 px-2 text-gray-300\">\r\n                                      {fee.period_end_date\r\n                                        ? new Date(fee.period_end_date).toLocaleDateString('en-US', {\r\n                                            month: 'short',\r\n                                            day: 'numeric',\r\n                                            year: 'numeric',\r\n                                          })\r\n                                        : '-'}\r\n                                    </td>\r\n                                  </tr>\r\n                                ))}\r\n                              </tbody>\r\n                            </table>\r\n                          </div>\r\n                        </div>\r\n                      ))}\r\n                    </div>\r\n                  ))}\r\n                </div>\r\n              )}\r\n            </CardContent>\r\n          </CollapsibleContent>\r\n        </Card>\r\n      </Collapsible>\r\n\r\n      {/* Introducer Commissions Section */}\r\n      <Collapsible open={introducerCommissionsExpanded} onOpenChange={setIntroducerCommissionsExpanded}>\r\n        <Card>\r\n          <CardHeader className=\"pb-3\">\r\n            <CollapsibleTrigger asChild>\r\n              <button className=\"flex w-full items-center justify-between text-left\">\r\n                <div className=\"flex items-center gap-3\">\r\n                  <UserCheck className=\"h-5 w-5 text-blue-400\" />\r\n                  <div>\r\n                    <CardTitle className=\"text-lg\">Introducer Commissions</CardTitle>\r\n                    <p className=\"text-sm text-gray-400 mt-0.5\">\r\n                      Pending commission payments to introducers\r\n                    </p>\r\n                  </div>\r\n                </div>\r\n                <div className=\"flex items-center gap-4\">\r\n                  <div className=\"text-right\">\r\n                    <div className=\"text-sm font-medium text-white\">\r\n                      {introducerCommissions.length} commission{introducerCommissions.length !== 1 ? 's' : ''}\r\n                    </div>\r\n                    <div className=\"text-sm text-gray-400\">\r\n                      {formatCurrency(introducerCommissionsTotal)}\r\n                    </div>\r\n                  </div>\r\n                  {introducerCommissionsExpanded ? (\r\n                    <ChevronDown className=\"h-5 w-5 text-gray-400\" />\r\n                  ) : (\r\n                    <ChevronRight className=\"h-5 w-5 text-gray-400\" />\r\n                  )}\r\n                </div>\r\n              </button>\r\n            </CollapsibleTrigger>\r\n          </CardHeader>\r\n          <CollapsibleContent>\r\n            <CardContent className=\"pt-0\">\r\n              {introducerCommissionsLoading ? (\r\n                <p className=\"text-gray-400 py-4\">Loading introducer commissions...</p>\r\n              ) : introducerCommissions.length === 0 ? (\r\n                <p className=\"text-gray-400 py-4\">No pending introducer commissions</p>\r\n              ) : (\r\n                <div className=\"space-y-6\">\r\n                  {Object.entries(groupedIntroducerCommissions).map(([introducerId, introducerGroup]) => (\r\n                    <div key={introducerId} className=\"space-y-4\">\r\n                      {/* Introducer Header */}\r\n                      <div className=\"flex items-center gap-2 border-b border-gray-700 pb-2\">\r\n                        <UserCheck className=\"h-4 w-4 text-blue-400\" />\r\n                        <h4 className=\"font-semibold text-white\">{introducerGroup.introducer.name}</h4>\r\n                        <span className=\"text-sm text-gray-400 ml-auto\">\r\n                          {formatCurrency(introducerGroup.total)}\r\n                        </span>\r\n                      </div>\r\n\r\n                      {/* Deals within Introducer */}\r\n                      {Object.entries(introducerGroup.byDeal).map(([dealId, dealGroup]) => (\r\n                        <div key={dealId} className=\"ml-6 space-y-2\">\r\n                          {/* Deal Header */}\r\n                          <div className=\"flex items-center gap-2\">\r\n                            <Building2 className=\"h-3.5 w-3.5 text-purple-400\" />\r\n                            <h5 className=\"font-medium text-gray-200\">{dealGroup.deal.name}</h5>\r\n                            <span className=\"text-sm text-gray-400 ml-auto\">\r\n                              {formatCurrency(dealGroup.total)}\r\n                            </span>\r\n                          </div>\r\n\r\n                          {/* Commissions Table */}\r\n                          <div className=\"overflow-x-auto\">\r\n                            <table className=\"w-full text-sm\">\r\n                              <thead>\r\n                                <tr className=\"border-b border-gray-700\">\r\n                                  <th className=\"text-left py-2 px-2 text-gray-400 font-medium\">Investor</th>\r\n                                  <th className=\"text-right py-2 px-2 text-gray-400 font-medium\">Amount</th>\r\n                                  <th className=\"text-left py-2 px-2 text-gray-400 font-medium\">Status</th>\r\n                                  <th className=\"text-left py-2 px-2 text-gray-400 font-medium\">Created Date</th>\r\n                                </tr>\r\n                              </thead>\r\n                              <tbody>\r\n                                {dealGroup.commissions.map((commission) => (\r\n                                  <tr key={commission.id} className=\"border-b border-gray-800\">\r\n                                    <td className=\"py-2 px-2 text-gray-300\">\r\n                                      {commission.investor_name || '-'}\r\n                                    </td>\r\n                                    <td className=\"py-2 px-2 text-right text-white font-medium\">\r\n                                      {formatCurrency(Number(commission.accrual_amount))}\r\n                                    </td>\r\n                                    <td className=\"py-2 px-2\">\r\n                                      <Badge className=\"bg-amber-500/20 text-amber-400 border-amber-500/30\">\r\n                                        {commission.status}\r\n                                      </Badge>\r\n                                    </td>\r\n                                    <td className=\"py-2 px-2 text-gray-300\">\r\n                                      {new Date(commission.created_at).toLocaleDateString('en-US', {\r\n                                        month: 'short',\r\n                                        day: 'numeric',\r\n                                        year: 'numeric',\r\n                                      })}\r\n                                    </td>\r\n                                  </tr>\r\n                                ))}\r\n                              </tbody>\r\n                            </table>\r\n                          </div>\r\n                        </div>\r\n                      ))}\r\n                    </div>\r\n                  ))}\r\n                </div>\r\n              )}\r\n            </CardContent>\r\n          </CollapsibleContent>\r\n        </Card>\r\n      </Collapsible>\r\n\r\n      {/* Partner Commissions Section */}\r\n      <Collapsible open={partnerCommissionsExpanded} onOpenChange={setPartnerCommissionsExpanded}>\r\n        <Card>\r\n          <CardHeader className=\"pb-3\">\r\n            <CollapsibleTrigger asChild>\r\n              <button className=\"flex w-full items-center justify-between text-left\">\r\n                <div className=\"flex items-center gap-3\">\r\n                  <Handshake className=\"h-5 w-5 text-green-400\" />\r\n                  <div>\r\n                    <CardTitle className=\"text-lg\">Partner Commissions</CardTitle>\r\n                    <p className=\"text-sm text-gray-400 mt-0.5\">\r\n                      Pending commission payments to partners\r\n                    </p>\r\n                  </div>\r\n                </div>\r\n                <div className=\"flex items-center gap-4\">\r\n                  <div className=\"text-right\">\r\n                    <div className=\"text-sm font-medium text-white\">\r\n                      {partnerCommissions.length} commission{partnerCommissions.length !== 1 ? 's' : ''}\r\n                    </div>\r\n                    <div className=\"text-sm text-gray-400\">\r\n                      {formatCurrency(partnerCommissionsTotal)}\r\n                    </div>\r\n                  </div>\r\n                  {partnerCommissionsExpanded ? (\r\n                    <ChevronDown className=\"h-5 w-5 text-gray-400\" />\r\n                  ) : (\r\n                    <ChevronRight className=\"h-5 w-5 text-gray-400\" />\r\n                  )}\r\n                </div>\r\n              </button>\r\n            </CollapsibleTrigger>\r\n          </CardHeader>\r\n          <CollapsibleContent>\r\n            <CardContent className=\"pt-0\">\r\n              {partnerCommissionsLoading ? (\r\n                <p className=\"text-gray-400 py-4\">Loading partner commissions...</p>\r\n              ) : partnerCommissions.length === 0 ? (\r\n                <p className=\"text-gray-400 py-4\">No pending partner commissions</p>\r\n              ) : (\r\n                <div className=\"space-y-6\">\r\n                  {Object.entries(groupedPartnerCommissions).map(([partnerId, partnerGroup]) => (\r\n                    <div key={partnerId} className=\"space-y-4\">\r\n                      {/* Partner Header */}\r\n                      <div className=\"flex items-center gap-2 border-b border-gray-700 pb-2\">\r\n                        <Handshake className=\"h-4 w-4 text-green-400\" />\r\n                        <h4 className=\"font-semibold text-white\">{partnerGroup.partner.name}</h4>\r\n                        <span className=\"text-sm text-gray-400 ml-auto\">\r\n                          {formatCurrency(partnerGroup.total)}\r\n                        </span>\r\n                      </div>\r\n\r\n                      {/* Deals within Partner */}\r\n                      {Object.entries(partnerGroup.byDeal).map(([dealId, dealGroup]) => (\r\n                        <div key={dealId} className=\"ml-6 space-y-2\">\r\n                          {/* Deal Header */}\r\n                          <div className=\"flex items-center gap-2\">\r\n                            <Building2 className=\"h-3.5 w-3.5 text-purple-400\" />\r\n                            <h5 className=\"font-medium text-gray-200\">{dealGroup.deal.name}</h5>\r\n                            <span className=\"text-sm text-gray-400 ml-auto\">\r\n                              {formatCurrency(dealGroup.total)}\r\n                            </span>\r\n                          </div>\r\n\r\n                          {/* Commissions Table */}\r\n                          <div className=\"overflow-x-auto\">\r\n                            <table className=\"w-full text-sm\">\r\n                              <thead>\r\n                                <tr className=\"border-b border-gray-700\">\r\n                                  <th className=\"text-left py-2 px-2 text-gray-400 font-medium\">Investor</th>\r\n                                  <th className=\"text-right py-2 px-2 text-gray-400 font-medium\">Amount</th>\r\n                                  <th className=\"text-left py-2 px-2 text-gray-400 font-medium\">Status</th>\r\n                                  <th className=\"text-left py-2 px-2 text-gray-400 font-medium\">Created Date</th>\r\n                                </tr>\r\n                              </thead>\r\n                              <tbody>\r\n                                {dealGroup.commissions.map((commission) => (\r\n                                  <tr key={commission.id} className=\"border-b border-gray-800\">\r\n                                    <td className=\"py-2 px-2 text-gray-300\">\r\n                                      {commission.investor_name || '-'}\r\n                                    </td>\r\n                                    <td className=\"py-2 px-2 text-right text-white font-medium\">\r\n                                      {formatCurrency(Number(commission.accrual_amount))}\r\n                                    </td>\r\n                                    <td className=\"py-2 px-2\">\r\n                                      <Badge className=\"bg-amber-500/20 text-amber-400 border-amber-500/30\">\r\n                                        {commission.status}\r\n                                      </Badge>\r\n                                    </td>\r\n                                    <td className=\"py-2 px-2 text-gray-300\">\r\n                                      {new Date(commission.created_at).toLocaleDateString('en-US', {\r\n                                        month: 'short',\r\n                                        day: 'numeric',\r\n                                        year: 'numeric',\r\n                                      })}\r\n                                    </td>\r\n                                  </tr>\r\n                                ))}\r\n                              </tbody>\r\n                            </table>\r\n                          </div>\r\n                        </div>\r\n                      ))}\r\n                    </div>\r\n                  ))}\r\n                </div>\r\n              )}\r\n            </CardContent>\r\n          </CollapsibleContent>\r\n        </Card>\r\n      </Collapsible>\r\n\r\n      {/* Commercial Partner Commissions Section */}\r\n      <Collapsible open={commercialPartnerCommissionsExpanded} onOpenChange={setCommercialPartnerCommissionsExpanded}>\r\n        <Card>\r\n          <CardHeader className=\"pb-3\">\r\n            <CollapsibleTrigger asChild>\r\n              <button className=\"flex w-full items-center justify-between text-left\">\r\n                <div className=\"flex items-center gap-3\">\r\n                  <Briefcase className=\"h-5 w-5 text-purple-400\" />\r\n                  <div>\r\n                    <CardTitle className=\"text-lg\">Commercial Partner Commissions</CardTitle>\r\n                    <p className=\"text-sm text-gray-400 mt-0.5\">\r\n                      Pending commission payments to commercial partners\r\n                    </p>\r\n                  </div>\r\n                </div>\r\n                <div className=\"flex items-center gap-4\">\r\n                  <div className=\"text-right\">\r\n                    <div className=\"text-sm font-medium text-white\">\r\n                      {commercialPartnerCommissions.length} commission{commercialPartnerCommissions.length !== 1 ? 's' : ''}\r\n                    </div>\r\n                    <div className=\"text-sm text-gray-400\">\r\n                      {formatCurrency(commercialPartnerCommissionsTotal)}\r\n                    </div>\r\n                  </div>\r\n                  {commercialPartnerCommissionsExpanded ? (\r\n                    <ChevronDown className=\"h-5 w-5 text-gray-400\" />\r\n                  ) : (\r\n                    <ChevronRight className=\"h-5 w-5 text-gray-400\" />\r\n                  )}\r\n                </div>\r\n              </button>\r\n            </CollapsibleTrigger>\r\n          </CardHeader>\r\n          <CollapsibleContent>\r\n            <CardContent className=\"pt-0\">\r\n              {commercialPartnerCommissionsLoading ? (\r\n                <p className=\"text-gray-400 py-4\">Loading commercial partner commissions...</p>\r\n              ) : commercialPartnerCommissions.length === 0 ? (\r\n                <p className=\"text-gray-400 py-4\">No pending commercial partner commissions</p>\r\n              ) : (\r\n                <div className=\"space-y-6\">\r\n                  {Object.entries(groupedCommercialPartnerCommissions).map(([commercialPartnerId, commercialPartnerGroup]) => (\r\n                    <div key={commercialPartnerId} className=\"space-y-4\">\r\n                      {/* Commercial Partner Header */}\r\n                      <div className=\"flex items-center gap-2 border-b border-gray-700 pb-2\">\r\n                        <Briefcase className=\"h-4 w-4 text-purple-400\" />\r\n                        <h4 className=\"font-semibold text-white\">{commercialPartnerGroup.commercialPartner.name}</h4>\r\n                        <span className=\"text-sm text-gray-400 ml-auto\">\r\n                          {formatCurrency(commercialPartnerGroup.total)}\r\n                        </span>\r\n                      </div>\r\n\r\n                      {/* Deals within Commercial Partner */}\r\n                      {Object.entries(commercialPartnerGroup.byDeal).map(([dealId, dealGroup]) => (\r\n                        <div key={dealId} className=\"ml-6 space-y-2\">\r\n                          {/* Deal Header */}\r\n                          <div className=\"flex items-center gap-2\">\r\n                            <Building2 className=\"h-3.5 w-3.5 text-purple-400\" />\r\n                            <h5 className=\"font-medium text-gray-200\">{dealGroup.deal.name}</h5>\r\n                            <span className=\"text-sm text-gray-400 ml-auto\">\r\n                              {formatCurrency(dealGroup.total)}\r\n                            </span>\r\n                          </div>\r\n\r\n                          {/* Commissions Table */}\r\n                          <div className=\"overflow-x-auto\">\r\n                            <table className=\"w-full text-sm\">\r\n                              <thead>\r\n                                <tr className=\"border-b border-gray-700\">\r\n                                  <th className=\"text-left py-2 px-2 text-gray-400 font-medium\">Investor</th>\r\n                                  <th className=\"text-right py-2 px-2 text-gray-400 font-medium\">Amount</th>\r\n                                  <th className=\"text-left py-2 px-2 text-gray-400 font-medium\">Status</th>\r\n                                  <th className=\"text-left py-2 px-2 text-gray-400 font-medium\">Created Date</th>\r\n                                </tr>\r\n                              </thead>\r\n                              <tbody>\r\n                                {dealGroup.commissions.map((commission) => (\r\n                                  <tr key={commission.id} className=\"border-b border-gray-800\">\r\n                                    <td className=\"py-2 px-2 text-gray-300\">\r\n                                      {commission.investor_name || '-'}\r\n                                    </td>\r\n                                    <td className=\"py-2 px-2 text-right text-white font-medium\">\r\n                                      {formatCurrency(Number(commission.accrual_amount))}\r\n                                    </td>\r\n                                    <td className=\"py-2 px-2\">\r\n                                      <Badge className=\"bg-amber-500/20 text-amber-400 border-amber-500/30\">\r\n                                        {commission.status}\r\n                                      </Badge>\r\n                                    </td>\r\n                                    <td className=\"py-2 px-2 text-gray-300\">\r\n                                      {new Date(commission.created_at).toLocaleDateString('en-US', {\r\n                                        month: 'short',\r\n                                        day: 'numeric',\r\n                                        year: 'numeric',\r\n                                      })}\r\n                                    </td>\r\n                                  </tr>\r\n                                ))}\r\n                              </tbody>\r\n                            </table>\r\n                          </div>\r\n                        </div>\r\n                      ))}\r\n                    </div>\r\n                  ))}\r\n                </div>\r\n              )}\r\n            </CardContent>\r\n          </CollapsibleContent>\r\n        </Card>\r\n      </Collapsible>\r\n\r\n      {/* Scheduled Recurring Fees - Grouped by Month */}\r\n      <div>\r\n        <h3 className=\"text-lg font-semibold text-white mb-4\">Scheduled Recurring Fees</h3>\r\n      </div>\r\n      {Object.keys(data.by_month).length === 0 ? (\r\n        <Card>\r\n          <CardContent className=\"py-10 text-center\">\r\n            <p className=\"text-gray-400\">No upcoming fees scheduled for the next {daysAhead} days</p>\r\n          </CardContent>\r\n        </Card>\r\n      ) : (\r\n        <div className=\"space-y-6\">\r\n          {Object.entries(data.by_month).map(([month, monthData]) => (\r\n            <div key={month}>\r\n              <div className=\"flex items-center justify-between mb-3\">\r\n                <h3 className=\"text-lg font-semibold text-white\">{month}</h3>\r\n                <div className=\"text-sm text-gray-400\">\r\n                  {monthData.fees.length} fee{monthData.fees.length !== 1 ? 's' : ''} • {formatCurrency(monthData.total)}\r\n                </div>\r\n              </div>\r\n\r\n              <div className=\"space-y-3\">\r\n                {monthData.fees.map((fee) => (\r\n                  <Card key={fee.id}>\r\n                    <CardContent className=\"py-4\">\r\n                      <div className=\"flex items-start justify-between\">\r\n                        <div className=\"flex-1\">\r\n                          <div className=\"flex items-center gap-2 mb-2\">\r\n                            <Badge className={feeTypeColors[fee.fee_type] || 'bg-gray-500/20 text-gray-400 border-gray-500/30'}>\r\n                              {fee.fee_name}\r\n                            </Badge>\r\n                            <Badge variant=\"outline\" className=\"text-xs\">\r\n                              {fee.frequency}\r\n                            </Badge>\r\n                          </div>\r\n\r\n                          <div className=\"space-y-1\">\r\n                            <p className=\"font-medium text-white\">\r\n                              {fee.investor.legal_name || fee.investor.display_name}\r\n                            </p>\r\n                            <p className=\"text-sm text-gray-400\">\r\n                              {fee.vehicle.name}\r\n                            </p>\r\n                            <p className=\"text-sm text-gray-400\">\r\n                              Subscription: {fee.subscription_number}\r\n                            </p>\r\n                            <p className=\"text-xs text-gray-500\">\r\n                              Due: {new Date(fee.next_due_date).toLocaleDateString('en-US', {\r\n                                weekday: 'short',\r\n                                month: 'short',\r\n                                day: 'numeric',\r\n                                year: 'numeric',\r\n                              })}\r\n                            </p>\r\n                          </div>\r\n                        </div>\r\n\r\n                        <div className=\"text-right ml-4\">\r\n                          <div className=\"text-xl font-bold text-white\">\r\n                            {formatCurrency(fee.amount)}\r\n                          </div>\r\n                          <Badge variant=\"secondary\" className=\"mt-2\">\r\n                            {fee.status}\r\n                          </Badge>\r\n                        </div>\r\n                      </div>\r\n                    </CardContent>\r\n                  </Card>\r\n                ))}\r\n              </div>\r\n            </div>\r\n          ))}\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n","/**\r\n * Commissions Tab - Manage entity commissions (introducers, partners, commercial partners)\r\n */\r\n\r\n'use client';\r\n\r\nimport { useEffect, useState, useCallback } from 'react';\r\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Badge } from '@/components/ui/badge';\r\nimport { DollarSign, CheckCircle, Clock, AlertCircle, ExternalLink, FileText, Users, Briefcase, Building2, Send } from 'lucide-react';\r\nimport { formatCurrency } from '@/lib/fees/calculations';\r\nimport Link from 'next/link';\r\n\r\ntype EntityType = 'introducer' | 'partner' | 'commercial_partner';\r\n\r\ninterface Commission {\r\n  id: string;\r\n  entity_type: EntityType;\r\n  entity_id: string;\r\n  entity_name: string;\r\n  entity_contact?: string;\r\n  entity_email?: string;\r\n  deal_id: string | null;\r\n  deal_name?: string;\r\n  investor_id: string | null;\r\n  investor_name?: string;\r\n  fee_plan_id?: string | null;\r\n  fee_plan_name?: string;\r\n  basis_type: string;\r\n  rate_bps: number;\r\n  accrual_amount: number;\r\n  currency: string;\r\n  status: 'accrued' | 'invoice_requested' | 'invoice_submitted' | 'invoiced' | 'paid' | 'rejected' | 'cancelled';\n  invoice_id: string | null;\r\n  paid_at: string | null;\r\n  created_at: string;\r\n  base_amount: number;\r\n  payment_due_date: string | null;\r\n  payment_reference: string | null;\r\n  notes: string | null;\r\n}\r\n\r\ninterface EntityGroup {\r\n  entity_type: EntityType;\r\n  entity: {\r\n    id: string;\r\n    name: string;\r\n    contact_name?: string;\r\n    email?: string;\r\n  };\r\n  commissions: Commission[];\r\n  totals: {\r\n    accrued: number;\r\n    invoiced: number;\r\n    paid: number;\r\n    total: number;\r\n  };\r\n}\r\n\r\ninterface CommissionsData {\r\n  data: Commission[];\r\n  summary: {\r\n    total_accrued: number;\r\n    total_invoiced: number;\r\n    total_paid: number;\r\n    total_overdue: number;\r\n    total_owed: number;\r\n  };\r\n  by_entity: EntityGroup[];\r\n}\r\n\r\nconst statusColors = {\n  accrued: 'secondary',\n  invoice_requested: 'outline',\n  invoice_submitted: 'default',\n  invoiced: 'default',\n  paid: 'default',\n  rejected: 'destructive',\n  cancelled: 'secondary',\n} as const;\n\nconst statusIcons = {\n  accrued: Clock,\n  invoice_requested: Send,\n  invoice_submitted: FileText,\n  invoiced: FileText,\n  paid: CheckCircle,\n  rejected: AlertCircle,\n  cancelled: AlertCircle,\n};\n\r\n// Entity type configuration\r\nconst entityConfig: Record<EntityType, { label: string; icon: typeof Users; linkPath: string; color: string }> = {\r\n  introducer: {\r\n    label: 'Introducer',\r\n    icon: Users,\r\n    linkPath: '/versotech_main/introducers',\r\n    color: 'text-blue-400',\r\n  },\r\n  partner: {\r\n    label: 'Partner',\r\n    icon: Briefcase,\r\n    linkPath: '/versotech_main/partners',\r\n    color: 'text-purple-400',\r\n  },\r\n  commercial_partner: {\r\n    label: 'Commercial Partner',\r\n    icon: Building2,\r\n    linkPath: '/versotech_main/commercial-partners',\r\n    color: 'text-orange-400',\r\n  },\r\n};\r\n\r\n// Fallback for unknown entity types\r\nconst getEntityConfig = (type: EntityType) => {\r\n  return entityConfig[type] || entityConfig.introducer;\r\n};\r\n\r\nexport default function CommissionsTab() {\r\n  const [data, setData] = useState<CommissionsData | null>(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [statusFilter, setStatusFilter] = useState<'all' | 'accrued' | 'invoice_requested' | 'invoice_submitted' | 'invoiced' | 'paid' | 'rejected' | 'cancelled'>('all');\n  const [entityTypeFilter, setEntityTypeFilter] = useState<'all' | EntityType>('all');\r\n  const [actionLoading, setActionLoading] = useState<string | null>(null);\r\n\r\n  const fetchCommissions = useCallback(async () => {\r\n    setLoading(true);\r\n    try {\r\n      const params = new URLSearchParams();\r\n      if (statusFilter !== 'all') params.set('status', statusFilter);\r\n      if (entityTypeFilter !== 'all') params.set('entity_type', entityTypeFilter);\r\n\r\n      const url = params.toString()\r\n        ? `/api/staff/fees/commissions?${params.toString()}`\r\n        : '/api/staff/fees/commissions';\r\n      const res = await fetch(url);\r\n      const json = await res.json();\r\n      setData(json);\r\n    } catch (error) {\r\n      console.error('Error fetching commissions:', error);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }, [statusFilter, entityTypeFilter]);\r\n\r\n  useEffect(() => {\r\n    fetchCommissions();\r\n  }, [statusFilter, entityTypeFilter, fetchCommissions]);\r\n\r\n  const handleMarkInvoiced = async (commissionId: string, entityType: EntityType) => {\r\n    setActionLoading(commissionId);\r\n    try {\r\n      const res = await fetch(`/api/staff/fees/commissions/${commissionId}/mark-invoiced`, {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({ entity_type: entityType }),\r\n      });\r\n      if (res.ok) {\r\n        fetchCommissions();\r\n      } else {\r\n        const error = await res.json();\r\n        alert(`Failed to mark as invoiced: ${error.error}`);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error marking as invoiced:', error);\r\n      alert('Failed to mark as invoiced');\r\n    } finally {\r\n      setActionLoading(null);\r\n    }\r\n  };\r\n\r\n  const handleMarkPaid = async (commissionId: string, entityType: EntityType) => {\r\n    const reference = prompt('Enter payment reference (optional):');\r\n\r\n    setActionLoading(commissionId);\r\n    try {\r\n      const res = await fetch(`/api/staff/fees/commissions/${commissionId}/mark-paid`, {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({ payment_reference: reference, entity_type: entityType }),\r\n      });\r\n      if (res.ok) {\r\n        fetchCommissions();\r\n      } else {\r\n        const error = await res.json();\r\n        alert(`Failed to mark as paid: ${error.error}`);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error marking as paid:', error);\r\n      alert('Failed to mark as paid');\r\n    } finally {\r\n      setActionLoading(null);\r\n    }\r\n  };\r\n\r\n  if (loading) {\r\n    return <div className=\"text-white\">Loading commissions...</div>;\r\n  }\r\n\r\n  if (!data) {\r\n    return <div className=\"text-white\">Failed to load commissions data</div>;\r\n  }\r\n\r\n  const isOverdue = (commission: Commission) => {\r\n    if (commission.status === 'paid') return false;\r\n    if (!commission.payment_due_date) return false;\r\n    return new Date(commission.payment_due_date) < new Date();\r\n  };\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      {/* Header */}\r\n      <div>\r\n        <h2 className=\"text-2xl font-bold text-white\">Entity Commissions</h2>\r\n        <p className=\"text-gray-400\">Track and manage commission payments to introducers, partners, and commercial partners</p>\r\n      </div>\r\n\r\n      {/* Summary Cards */}\r\n      <div className=\"grid gap-4 md:grid-cols-4\">\r\n        <Card>\r\n          <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\r\n            <CardTitle className=\"text-sm font-medium\">Total Owed</CardTitle>\r\n            <DollarSign className=\"h-4 w-4 text-muted-foreground\" />\r\n          </CardHeader>\r\n          <CardContent>\r\n            <div className=\"text-2xl font-bold text-white\">\r\n              {formatCurrency(data.summary.total_owed)}\r\n            </div>\r\n            <p className=\"text-xs text-gray-400\">\r\n              Accrued + Invoiced\r\n            </p>\r\n          </CardContent>\r\n        </Card>\r\n\r\n        <Card>\r\n          <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\r\n            <CardTitle className=\"text-sm font-medium\">Accrued</CardTitle>\r\n            <Clock className=\"h-4 w-4 text-blue-400\" />\r\n          </CardHeader>\r\n          <CardContent>\r\n            <div className=\"text-2xl font-bold text-white\">\r\n              {formatCurrency(data.summary.total_accrued)}\r\n            </div>\r\n            <p className=\"text-xs text-gray-400\">\r\n              Not yet invoiced\r\n            </p>\r\n          </CardContent>\r\n        </Card>\r\n\r\n        <Card>\r\n          <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\r\n            <CardTitle className=\"text-sm font-medium\">Paid (YTD)</CardTitle>\r\n            <CheckCircle className=\"h-4 w-4 text-green-400\" />\r\n          </CardHeader>\r\n          <CardContent>\r\n            <div className=\"text-2xl font-bold text-white\">\r\n              {formatCurrency(data.summary.total_paid)}\r\n            </div>\r\n            <p className=\"text-xs text-gray-400\">\r\n              Settled commissions\r\n            </p>\r\n          </CardContent>\r\n        </Card>\r\n\r\n        <Card>\r\n          <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\r\n            <CardTitle className=\"text-sm font-medium\">Overdue</CardTitle>\r\n            <AlertCircle className=\"h-4 w-4 text-destructive\" />\r\n          </CardHeader>\r\n          <CardContent>\r\n            <div className=\"text-2xl font-bold text-destructive\">\r\n              {formatCurrency(data.summary.total_overdue)}\r\n            </div>\r\n            <p className=\"text-xs text-gray-400\">\r\n              Past due date\r\n            </p>\r\n          </CardContent>\r\n        </Card>\r\n      </div>\r\n\r\n      {/* Filters */}\r\n      <div className=\"flex flex-wrap gap-4\">\r\n        {/* Status Filter */}\r\n        <div className=\"flex gap-2\">\r\n          <span className=\"text-sm text-gray-400 self-center mr-1\">Status:</span>\r\n          {(['all', 'accrued', 'invoice_requested', 'invoice_submitted', 'invoiced', 'paid', 'rejected', 'cancelled'] as const).map((status) => (\n            <Button\n              key={status}\n              variant={statusFilter === status ? 'default' : 'outline'}\n              size=\"sm\"\n              onClick={() => setStatusFilter(status)}\n            >\n              {status === 'invoice_requested'\n                ? 'Invoice Requested'\n                : status === 'invoice_submitted'\n                ? 'Invoice Submitted'\n                : status.charAt(0).toUpperCase() + status.slice(1)}\n            </Button>\n          ))}\n        </div>\r\n\r\n        {/* Entity Type Filter */}\r\n        <div className=\"flex gap-2\">\r\n          <span className=\"text-sm text-gray-400 self-center mr-1\">Entity:</span>\r\n          <Button\r\n            variant={entityTypeFilter === 'all' ? 'default' : 'outline'}\r\n            size=\"sm\"\r\n            onClick={() => setEntityTypeFilter('all')}\r\n          >\r\n            All\r\n          </Button>\r\n          {(Object.keys(entityConfig) as EntityType[]).map((type) => {\r\n            const config = entityConfig[type];\r\n            const Icon = config.icon;\r\n            return (\r\n              <Button\r\n                key={type}\r\n                variant={entityTypeFilter === type ? 'default' : 'outline'}\r\n                size=\"sm\"\r\n                onClick={() => setEntityTypeFilter(type)}\r\n                className=\"flex items-center gap-1\"\r\n              >\r\n                <Icon className={`h-3 w-3 ${entityTypeFilter === type ? '' : config.color}`} />\r\n                {config.label}\r\n              </Button>\r\n            );\r\n          })}\r\n        </div>\r\n      </div>\r\n\r\n      {/* Commissions Grouped by Entity */}\r\n      {data.by_entity.length === 0 ? (\r\n        <Card>\r\n          <CardContent className=\"py-10 text-center\">\r\n            <p className=\"text-gray-400\">No commissions found</p>\r\n          </CardContent>\r\n        </Card>\r\n      ) : (\r\n        <div className=\"space-y-4\">\r\n          {data.by_entity.map((group) => {\r\n            const config = getEntityConfig(group.entity_type);\r\n            const EntityIcon = config.icon;\r\n\r\n            return (\r\n              <Card key={`${group.entity_type}:${group.entity.id}`}>\r\n                <CardHeader>\r\n                  <div className=\"flex items-start justify-between\">\r\n                    <div>\r\n                      <CardTitle className=\"text-lg text-white flex items-center gap-2\">\r\n                        <EntityIcon className={`h-5 w-5 ${config.color}`} />\r\n                        {group.entity.name}\r\n                        <Badge variant=\"outline\" className={`text-xs ${config.color}`}>\r\n                          {config.label}\r\n                        </Badge>\r\n                        <Link href={`${config.linkPath}/${group.entity.id}`}>\r\n                          <Button variant=\"ghost\" size=\"sm\" className=\"h-6 px-2\">\r\n                            <ExternalLink className=\"h-3 w-3\" />\r\n                          </Button>\r\n                        </Link>\r\n                      </CardTitle>\r\n                      {(group.entity.contact_name || group.entity.email) && (\r\n                        <p className=\"text-sm text-gray-400 mt-1\">\r\n                          {group.entity.contact_name && group.entity.email\r\n                            ? `${group.entity.contact_name} • ${group.entity.email}`\r\n                            : group.entity.contact_name || group.entity.email}\r\n                        </p>\r\n                      )}\r\n                    </div>\r\n                    <div className=\"text-right\">\r\n                      <p className=\"text-2xl font-bold text-white\">\r\n                        {formatCurrency(group.totals.total)}\r\n                      </p>\r\n                      <p className=\"text-xs text-gray-400\">\r\n                        {group.commissions.length} commission{group.commissions.length !== 1 ? 's' : ''}\r\n                      </p>\r\n                    </div>\r\n                  </div>\r\n                </CardHeader>\r\n                <CardContent>\r\n                  <div className=\"space-y-3\">\r\n                    {group.commissions.map((commission) => {\r\n                      const StatusIcon = statusIcons[commission.status];\r\n                      const overdue = isOverdue(commission);\r\n\r\n                      return (\r\n                        <div\r\n                          key={commission.id}\r\n                          className={`p-4 rounded border ${\r\n                            overdue\r\n                              ? 'bg-red-900/20 border-red-700'\r\n                              : 'bg-gray-900 border-gray-700'\r\n                          }`}\r\n                        >\r\n                          <div className=\"flex items-start justify-between\">\r\n                            <div className=\"flex-1\">\r\n                              <div className=\"flex items-center gap-2 mb-2\">\r\n                                <Badge variant={statusColors[commission.status]}>\r\n                                  <StatusIcon className=\"h-3 w-3 mr-1\" />\r\n                                  {commission.status === 'invoice_requested'\n                                    ? 'Invoice Requested'\n                                    : commission.status === 'invoice_submitted'\n                                    ? 'Invoice Submitted'\n                                    : commission.status}\n                                </Badge>\r\n                                {overdue && (\r\n                                  <Badge variant=\"destructive\">\r\n                                    <AlertCircle className=\"h-3 w-3 mr-1\" />\r\n                                    Overdue\r\n                                  </Badge>\r\n                                )}\r\n                              </div>\r\n                              <p className=\"font-medium text-white\">\r\n                                {commission.deal_name || 'Direct commission'}\r\n                              </p>\r\n                              {commission.investor_name && (\r\n                                <p className=\"text-sm text-gray-300\">\r\n                                  Investor: {commission.investor_name}\r\n                                </p>\r\n                              )}\r\n                              {commission.fee_plan_name && (\r\n                                <p className=\"text-sm text-gray-400\">\r\n                                  Fee Plan: {commission.fee_plan_name}\r\n                                </p>\r\n                              )}\r\n                              <p className=\"text-sm text-gray-400 mt-1\">\r\n                                {(commission.rate_bps / 100).toFixed(2)}% of {formatCurrency(commission.base_amount)}\r\n                                {commission.payment_due_date && (\r\n                                  <span className=\"ml-2\">\r\n                                    • Due: {new Date(commission.payment_due_date).toLocaleDateString()}\r\n                                  </span>\r\n                                )}\r\n                              </p>\r\n                              {commission.notes && (\r\n                                <p className=\"text-xs text-gray-500 mt-1\">{commission.notes}</p>\r\n                              )}\r\n                              {commission.payment_reference && (\r\n                                <p className=\"text-xs text-green-400 mt-1\">\r\n                                  Payment ref: {commission.payment_reference}\r\n                                </p>\r\n                              )}\r\n                            </div>\r\n                            <div className=\"flex items-center gap-2 ml-4\">\r\n                              <div className=\"text-right mr-4\">\r\n                                <p className=\"text-xl font-bold text-white\">\r\n                                  {formatCurrency(commission.accrual_amount)}\r\n                                </p>\r\n                              </div>\r\n                              <div className=\"flex flex-col gap-2\">\r\n                                {commission.status === 'invoice_submitted' && (\n                                  <Button\n                                    size=\"sm\"\n                                    onClick={() => handleMarkInvoiced(commission.id, commission.entity_type)}\n                                    disabled={actionLoading === commission.id}\n                                  >\n                                    {actionLoading === commission.id ? 'Processing...' : 'Mark Invoiced'}\n                                  </Button>\n                                )}\n                                {commission.status === 'invoiced' && (\n                                  <Button\n                                    size=\"sm\"\n                                    variant=\"default\"\n                                    onClick={() => handleMarkPaid(commission.id, commission.entity_type)}\n                                    disabled={actionLoading === commission.id}\n                                  >\n                                    {actionLoading === commission.id ? 'Processing...' : 'Mark Paid'}\r\n                                  </Button>\r\n                                )}\r\n                                {commission.status === 'paid' && commission.paid_at && (\r\n                                  <p className=\"text-xs text-green-400\">\r\n                                    Paid {new Date(commission.paid_at).toLocaleDateString()}\r\n                                  </p>\r\n                                )}\r\n                              </div>\r\n                            </div>\r\n                          </div>\r\n                        </div>\r\n                      );\r\n                    })}\r\n                  </div>\r\n                </CardContent>\r\n              </Card>\r\n            );\r\n          })}\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}