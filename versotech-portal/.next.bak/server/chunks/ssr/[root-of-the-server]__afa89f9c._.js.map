{"version":3,"sources":["../../../../../versotech-portal/src/components/profile/profile-page-client.tsx/__nextjs-internal-proxy.mjs","../../../../../versotech-portal/src/app/%28main%29/versotech_main/profile/page.tsx"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport const ProfilePageClient = registerClientReference(\n    function() { throw new Error(\"Attempted to call ProfilePageClient() from the server but ProfilePageClient is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/versotech-portal/src/components/profile/profile-page-client.tsx\",\n    \"ProfilePageClient\",\n);\n","import { redirect } from 'next/navigation'\r\nimport { cookies } from 'next/headers'\r\nimport { createClient, createServiceClient } from '@/lib/supabase/server'\r\nimport { ProfilePageClient } from '@/components/profile/profile-page-client'\r\n\r\nexport const dynamic = 'force-dynamic'\r\nexport const revalidate = 0\r\n\r\nexport default async function ProfilePage({\r\n  searchParams,\r\n}: {\r\n  searchParams: Promise<{ tab?: string }>\r\n}) {\r\n  const resolvedSearchParams = await searchParams\r\n  const defaultTab = resolvedSearchParams.tab || 'overview'\r\n  const supabase = await createClient()\r\n  const serviceSupabase = createServiceClient()\r\n\r\n  // Get the current user\r\n  const { data: { user }, error: authError } = await supabase.auth.getUser()\r\n  if (authError || !user) {\r\n    redirect('/versotech_main/login')\r\n  }\r\n\r\n  // Get active persona from cookie (set by persona switcher)\r\n  const cookieStore = await cookies()\r\n  const activePersonaType = cookieStore.get('verso_active_persona_type')?.value\r\n\r\n  // Fetch complete profile data\r\n  const { data: profile, error } = await supabase\r\n    .from('profiles')\r\n    .select('*')\r\n    .eq('id', user.id)\r\n    .single()\r\n\r\n  if (error || !profile) {\r\n    return (\r\n      <div className=\"p-6\">\r\n        <div className=\"max-w-2xl mx-auto text-center py-12\">\r\n          <h1 className=\"text-2xl font-bold text-foreground mb-2\">Error Loading Profile</h1>\r\n          <p className=\"text-muted-foreground\">\r\n            Unable to load your profile data. Please try again.\r\n          </p>\r\n        </div>\r\n      </div>\r\n    )\r\n  }\r\n\r\n  // ALWAYS check if user has an investor link - we need this data regardless of persona\r\n  let investorInfo = null\r\n  let investorUserInfo = null\r\n\r\n  // Check if user is associated with an investor\r\n  const { data: investorUser, error: investorUserError } = await serviceSupabase\r\n    .from('investor_users')\r\n    .select('investor_id, role, is_primary, can_sign')\r\n    .eq('user_id', user.id)\r\n    .maybeSingle()\r\n\r\n  if (investorUserError) {\r\n    console.error('[ProfilePage] Error fetching investor_users:', investorUserError)\r\n  }\r\n\r\n  console.log('[ProfilePage] investorUser result:', { investorUser, investorUserError })\r\n\r\n  if (investorUser) {\r\n    // Fetch investor entity details including KYC fields\r\n    const { data: investor, error: investorError } = await serviceSupabase\r\n      .from('investors')\r\n      .select(`\r\n        id,\r\n        legal_name,\r\n        display_name,\r\n        type,\r\n        status,\r\n        kyc_status,\r\n        onboarding_status,\r\n        country,\r\n        country_of_incorporation,\r\n        tax_residency,\r\n        email,\r\n        phone,\r\n        website,\r\n        registered_address,\r\n        city,\r\n        representative_name,\r\n        representative_title,\r\n        is_professional_investor,\r\n        is_qualified_purchaser,\r\n        aml_risk_rating,\r\n        logo_url,\r\n        first_name,\r\n        middle_name,\r\n        last_name,\r\n        name_suffix,\r\n        date_of_birth,\r\n        country_of_birth,\r\n        nationality,\r\n        phone_mobile,\r\n        phone_office,\r\n        residential_street,\r\n        residential_line_2,\r\n        residential_city,\r\n        residential_state,\r\n        residential_postal_code,\r\n        residential_country,\r\n        registered_address_line_1,\r\n        registered_address_line_2,\r\n        registered_city,\r\n        registered_state,\r\n        registered_postal_code,\r\n        registered_country,\r\n        is_us_citizen,\r\n        is_us_taxpayer,\r\n        us_taxpayer_id,\r\n        id_type,\r\n        id_number,\r\n        id_issue_date,\r\n        id_expiry_date,\r\n        id_issuing_country,\r\n        middle_initial,\r\n        proof_of_address_date,\r\n        proof_of_address_expiry,\r\n        tax_id_number\r\n      `)\r\n      .eq('id', investorUser.investor_id)\r\n      .single()\r\n\r\n    if (investorError) {\r\n      console.error('[ProfilePage] Error fetching investor:', investorError)\r\n    }\r\n\r\n    console.log('[ProfilePage] investor result:', { investor: investor?.id, investorError })\r\n\r\n    if (investor) {\r\n      investorInfo = {\r\n        id: investor.id,\r\n        legal_name: investor.legal_name,\r\n        display_name: investor.display_name,\r\n        type: investor.type,\r\n        status: investor.status,\r\n        kyc_status: investor.kyc_status,\r\n        onboarding_status: investor.onboarding_status,\r\n        country: investor.country,\r\n        country_of_incorporation: investor.country_of_incorporation,\r\n        tax_residency: investor.tax_residency,\r\n        email: investor.email,\r\n        phone: investor.phone,\r\n        website: investor.website,\r\n        registered_address: investor.registered_address,\r\n        city: investor.city,\r\n        representative_name: investor.representative_name,\r\n        representative_title: investor.representative_title,\r\n        is_professional_investor: investor.is_professional_investor,\r\n        is_qualified_purchaser: investor.is_qualified_purchaser,\r\n        aml_risk_rating: investor.aml_risk_rating,\r\n        logo_url: investor.logo_url,\r\n        // Individual KYC fields\r\n        first_name: investor.first_name,\r\n        middle_name: investor.middle_name,\r\n        last_name: investor.last_name,\r\n        name_suffix: investor.name_suffix,\r\n        date_of_birth: investor.date_of_birth,\r\n        country_of_birth: investor.country_of_birth,\r\n        nationality: investor.nationality,\r\n        // Phone numbers\r\n        phone_mobile: investor.phone_mobile,\r\n        phone_office: investor.phone_office,\r\n        // Residential address (for individuals)\r\n        residential_street: investor.residential_street,\r\n        residential_line_2: investor.residential_line_2,\r\n        residential_city: investor.residential_city,\r\n        residential_state: investor.residential_state,\r\n        residential_postal_code: investor.residential_postal_code,\r\n        residential_country: investor.residential_country,\r\n        // Registered address (for entities)\r\n        registered_address_line_1: investor.registered_address_line_1,\r\n        registered_address_line_2: investor.registered_address_line_2,\r\n        registered_city: investor.registered_city,\r\n        registered_state: investor.registered_state,\r\n        registered_postal_code: investor.registered_postal_code,\r\n        registered_country: investor.registered_country,\r\n        // US Tax compliance\r\n        is_us_citizen: investor.is_us_citizen,\r\n        is_us_taxpayer: investor.is_us_taxpayer,\r\n        us_taxpayer_id: investor.us_taxpayer_id,\r\n        country_of_tax_residency: investor.tax_residency,  // Column is named tax_residency in DB\r\n        // ID Document\r\n        id_type: investor.id_type,\r\n        id_number: investor.id_number,\r\n        id_issue_date: investor.id_issue_date,\r\n        id_expiry_date: investor.id_expiry_date,\r\n        id_issuing_country: investor.id_issuing_country,\r\n        // Additional KYC fields\r\n        middle_initial: investor.middle_initial,\r\n        proof_of_address_date: investor.proof_of_address_date,\r\n        proof_of_address_expiry: investor.proof_of_address_expiry,\r\n        tax_id_number: investor.tax_id_number,\r\n      }\r\n\r\n      investorUserInfo = {\r\n        role: investorUser.role,\r\n        is_primary: investorUser.is_primary,\r\n        can_sign: investorUser.can_sign || false\r\n      }\r\n    }\r\n  }\r\n\r\n  // Determine variant based on active persona cookie\r\n  // If persona is 'investor' OR user has investor link and no persona set, show investor profile\r\n  const staffPersonaTypes = ['ceo', 'staff']\r\n  const isActivePersonaStaff = activePersonaType ? staffPersonaTypes.includes(activePersonaType) : false\r\n  const isProfileRoleStaff = ['staff_admin', 'staff_ops', 'staff_rm', 'staff', 'admin'].includes(profile.role)\r\n\r\n  // Show investor profile if:\r\n  // 1. Active persona is 'investor', OR\r\n  // 2. User has investor link AND (no active persona OR active persona is investor-type)\r\n  const hasInvestorLink = !!investorInfo\r\n  const showAsStaff = activePersonaType\r\n    ? isActivePersonaStaff && !hasInvestorLink  // Staff persona but ONLY if no investor link\r\n    : isProfileRoleStaff && !hasInvestorLink     // Staff role but ONLY if no investor link\r\n\r\n  // Debug logging\r\n  console.log('[ProfilePage] Debug:', {\r\n    email: profile.email,\r\n    activePersonaType,\r\n    isActivePersonaStaff,\r\n    isProfileRoleStaff,\r\n    hasInvestorLink,\r\n    showAsStaff,\r\n    variant: showAsStaff ? 'staff' : 'investor',\r\n    investorInfo: investorInfo ? { id: investorInfo.id, legal_name: investorInfo.legal_name, type: investorInfo.type } : null,\r\n    investorUserInfo,\r\n  })\r\n\r\n  return (\r\n    <ProfilePageClient\r\n      userEmail={user.email || ''}\r\n      profile={{\r\n        id: profile.id,\r\n        email: profile.email,\r\n        display_name: profile.display_name,\r\n        full_name: profile.display_name,\r\n        title: profile.title,\r\n        avatar_url: profile.avatar_url,\r\n        phone: profile.phone,\r\n        office_location: profile.office_location,\r\n        bio: profile.bio,\r\n        role: profile.role,\r\n        created_at: profile.created_at\r\n      }}\r\n      variant={showAsStaff ? 'staff' : 'investor'}\r\n      defaultTab={defaultTab}\r\n      investorInfo={investorInfo}\r\n      investorUserInfo={investorUserInfo}\r\n    />\r\n  )\r\n}\r\n"],"names":[],"mappings":"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","ignoreList":[0]}