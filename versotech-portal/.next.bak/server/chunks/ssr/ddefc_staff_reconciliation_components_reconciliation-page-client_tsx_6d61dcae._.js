module.exports=[943835,a=>{"use strict";var b=a.i(352584),c=a.i(611038),d=a.i(289633),e=a.i(284169),f=a.i(421908),g=a.i(663475),h=a.i(181608),i=a.i(908513),j=a.i(487068),k=a.i(441278),l=a.i(877918),m=a.i(42329),n=a.i(787957),o=a.i(816854),p=a.i(966494),q=a.i(778541),r=a.i(784021),s=a.i(391686),t=a.i(771088),u=a.i(951870),v=a.i(577955),w=a.i(672606),x=a.i(195587),y=a.i(598626);function z({columns:a,data:d,pageSize:e=25}){let[g,h]=c.useState([{id:"value_date",desc:!0}]),[i,j]=c.useState([]),[k,l]=c.useState({}),[m,n]=c.useState({pageIndex:0,pageSize:e}),o=(0,r.useReactTable)({data:d,columns:a,pageCount:Math.ceil(d.length/m.pageSize),onSortingChange:h,onColumnFiltersChange:j,getCoreRowModel:(0,s.getCoreRowModel)(),getSortedRowModel:(0,s.getSortedRowModel)(),getFilteredRowModel:(0,s.getFilteredRowModel)(),getPaginationRowModel:(0,s.getPaginationRowModel)(),onColumnVisibilityChange:l,onPaginationChange:n,state:{sorting:g,columnFilters:i,columnVisibility:k,pagination:m}}),p=o.getRowModel().rows,q=o.getFilteredRowModel().rows.length,z=o.getPageCount(),A=m.pageIndex+1;return(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between px-4 py-3 bg-muted/50 border-b border-border",children:[(0,b.jsxs)("div",{className:"text-sm text-muted-foreground",children:["Showing ",(0,b.jsx)("span",{className:"font-medium text-foreground",children:m.pageIndex*m.pageSize+1})," to"," ",(0,b.jsx)("span",{className:"font-medium text-foreground",children:Math.min((m.pageIndex+1)*m.pageSize,q)})," of"," ",(0,b.jsx)("span",{className:"font-medium text-foreground",children:q})," transactions"]}),(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsxs)(u.Select,{value:`${m.pageSize}`,onValueChange:a=>{n(b=>({...b,pageSize:Number(a),pageIndex:0}))},children:[(0,b.jsx)(u.SelectTrigger,{className:"h-8 w-[100px]",children:(0,b.jsx)(u.SelectValue,{placeholder:`${m.pageSize}`})}),(0,b.jsxs)(u.SelectContent,{children:[(0,b.jsx)(u.SelectItem,{value:"10",children:"10 rows"}),(0,b.jsx)(u.SelectItem,{value:"25",children:"25 rows"}),(0,b.jsx)(u.SelectItem,{value:"50",children:"50 rows"}),(0,b.jsx)(u.SelectItem,{value:"100",children:"100 rows"})]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(f.Button,{variant:"ghost",size:"icon",className:"h-8 w-8 disabled:opacity-30",onClick:()=>o.setPageIndex(0),disabled:!o.getCanPreviousPage(),children:(0,b.jsx)(x.ChevronsLeft,{className:"h-4 w-4 text-muted-foreground"})}),(0,b.jsx)(f.Button,{variant:"ghost",size:"icon",className:"h-8 w-8 disabled:opacity-30",onClick:()=>o.previousPage(),disabled:!o.getCanPreviousPage(),children:(0,b.jsx)(v.ChevronLeft,{className:"h-4 w-4 text-muted-foreground"})}),(0,b.jsx)("div",{className:"flex items-center gap-1 px-3",children:(0,b.jsxs)("span",{className:"text-sm text-muted-foreground",children:["Page ",(0,b.jsx)("span",{className:"font-medium text-foreground",children:A})," of ",(0,b.jsx)("span",{className:"font-medium text-foreground",children:z})]})}),(0,b.jsx)(f.Button,{variant:"ghost",size:"icon",className:"h-8 w-8 disabled:opacity-30",onClick:()=>o.nextPage(),disabled:!o.getCanNextPage(),children:(0,b.jsx)(w.ChevronRight,{className:"h-4 w-4 text-muted-foreground"})}),(0,b.jsx)(f.Button,{variant:"ghost",size:"icon",className:"h-8 w-8 disabled:opacity-30",onClick:()=>o.setPageIndex(z-1),disabled:!o.getCanNextPage(),children:(0,b.jsx)(y.ChevronsRight,{className:"h-4 w-4 text-muted-foreground"})})]})]})]}),(0,b.jsx)("div",{className:"border border-border rounded-lg overflow-hidden bg-card",children:(0,b.jsxs)(t.Table,{children:[(0,b.jsx)(t.TableHeader,{children:o.getHeaderGroups().map(a=>(0,b.jsx)(t.TableRow,{className:"border-b border-border bg-muted/50 hover:bg-muted/50",children:a.headers.map(a=>(0,b.jsx)(t.TableHead,{className:"text-foreground font-semibold",children:a.isPlaceholder?null:(0,r.flexRender)(a.column.columnDef.header,a.getContext())},a.id))},a.id))}),(0,b.jsx)(t.TableBody,{children:p.length?p.map(a=>(0,b.jsx)(t.TableRow,{"data-state":a.getIsSelected()&&"selected",className:"border-b border-border/50 hover:bg-muted/30 transition-colors",children:a.getVisibleCells().map(a=>(0,b.jsx)(t.TableCell,{className:"py-4",children:(0,r.flexRender)(a.column.columnDef.cell,a.getContext())},a.id))},a.id)):(0,b.jsx)(t.TableRow,{children:(0,b.jsx)(t.TableCell,{colSpan:a.length,className:"h-24 text-center text-muted-foreground",children:"No transactions found."})})})]})}),(0,b.jsxs)("div",{className:"flex items-center justify-between px-4 py-3 bg-muted/50 border-t border-border",children:[(0,b.jsxs)("div",{className:"text-sm text-muted-foreground",children:["Page ",A," of ",z]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(f.Button,{variant:"outline",size:"sm",onClick:()=>o.setPageIndex(0),disabled:!o.getCanPreviousPage(),children:"First"}),(0,b.jsx)(f.Button,{variant:"outline",size:"sm",onClick:()=>o.previousPage(),disabled:!o.getCanPreviousPage(),children:"Previous"}),(0,b.jsx)(f.Button,{variant:"outline",size:"sm",onClick:()=>o.nextPage(),disabled:!o.getCanNextPage(),children:"Next"}),(0,b.jsx)(f.Button,{variant:"outline",size:"sm",onClick:()=>o.setPageIndex(z-1),disabled:!o.getCanNextPage(),children:"Last"})]})]})]})}var A=a.i(15788),B=a.i(294565),C=a.i(264890),D=a.i(399580),E=a.i(118234),F=a.i(478870),G=a.i(497412);let H=a=>null==a?null:(0,b.jsxs)(A.Badge,{className:a>=80?"bg-emerald-900/30 text-emerald-300 border-emerald-700":a>=60?"bg-amber-900/30 text-amber-300 border-amber-700":"bg-rose-900/30 text-rose-300 border-rose-700",children:[a,"% match"]}),I=(a,b)=>new Intl.NumberFormat("en-US",{style:"currency",currency:b||"USD",minimumFractionDigits:2,maximumFractionDigits:2}).format(a),J=a=>a?a.invoice_number?a.invoice_number:`Invoice ${a.id.slice(0,8)}`:"Invoice",K=a=>{let c=a.invoices,d=J(c),e=c?.investor?.legal_name,f=c?.deal?.name;return(0,b.jsxs)("div",{className:"space-y-0.5",children:[(0,b.jsxs)("div",{className:"text-sm font-medium text-foreground flex items-center gap-2",children:[(0,b.jsx)(o.FileText,{className:"h-3.5 w-3.5"})," ",d,(0,b.jsx)(A.Badge,{variant:"outline",className:"border-white/10 text-xs capitalize",children:a.match_type.replace("_"," ")})]}),(0,b.jsxs)("div",{className:"text-xs text-muted-foreground flex items-center gap-1",children:[(0,b.jsx)("span",{children:I(a.matched_amount,c?.currency||"USD")}),a.match_reason&&(0,b.jsxs)("span",{className:"text-muted-foreground/70",children:["• ",a.match_reason]})]}),(e||f)&&(0,b.jsxs)("div",{className:"text-xs text-muted-foreground flex items-center gap-2",children:[(0,b.jsx)(F.Users,{className:"h-3 w-3"}),(0,b.jsx)("span",{children:[e,f].filter(Boolean).join(" • ")})]})]},a.id)},L=[{id:"value_date",accessorKey:"value_date",header:({column:a})=>(0,b.jsxs)(f.Button,{variant:"ghost",onClick:()=>a.toggleSorting("asc"===a.getIsSorted()),className:"hover:bg-white/5 -ml-4",children:["Date",(0,b.jsx)(B.ArrowUpDown,{className:"ml-2 h-4 w-4"})]}),cell:({row:a})=>(0,b.jsx)("div",{className:"font-medium text-foreground",children:new Date(a.original.value_date).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})})},{id:"counterparty",accessorKey:"counterparty",header:({column:a})=>(0,b.jsxs)(f.Button,{variant:"ghost",onClick:()=>a.toggleSorting("asc"===a.getIsSorted()),className:"hover:bg-white/5 -ml-4",children:["Counterparty",(0,b.jsx)(B.ArrowUpDown,{className:"ml-2 h-4 w-4"})]}),cell:({row:a})=>{let c=a.original,d=c.matches?.[0],e=d?.invoices,f=e?.investor?.legal_name;return(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("div",{className:"font-medium text-foreground",children:c.counterparty}),f&&(0,b.jsxs)("div",{className:"text-xs text-emerald-300",children:["→ ",f]}),!f&&(c.suggestions?.length||0)>0&&(0,b.jsxs)("div",{className:"text-xs text-amber-400",children:[c.suggestions?.length," suggestion",(c.suggestions?.length||0)>1?"s":""]}),c.memo&&(0,b.jsx)("div",{className:"text-xs text-muted-foreground truncate max-w-xs",children:c.memo})]})}},{id:"amount",accessorKey:"amount",header:({column:a})=>(0,b.jsxs)(f.Button,{variant:"ghost",onClick:()=>a.toggleSorting("asc"===a.getIsSorted()),className:"hover:bg-white/5 -ml-4",children:["Amount",(0,b.jsx)(B.ArrowUpDown,{className:"ml-2 h-4 w-4"})]}),cell:({row:a})=>{let c=a.original,d=c.amount<0;return(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("div",{className:`font-semibold ${d?"text-rose-400":"text-foreground"}`,children:I(c.amount,c.currency)}),"number"==typeof c.matched_amount_total&&c.matched_amount_total>0&&(0,b.jsxs)("div",{className:"text-xs text-emerald-300",children:["Matched ",I(c.matched_amount_total,c.currency)]}),"number"==typeof c.remaining_amount&&c.remaining_amount>0&&(0,b.jsxs)("div",{className:"text-xs text-amber-400",children:["Remaining ",I(c.remaining_amount,c.currency)]})]})}},{id:"matched_to",header:"Matched To",cell:({row:a})=>{let c=a.original;return c.matches&&c.matches.length>0?(0,b.jsxs)("div",{className:"space-y-2",children:[c.matches.slice(0,2).map(K),c.matches.length>2&&(0,b.jsxs)("div",{className:"text-xs text-muted-foreground",children:["+",c.matches.length-2," more matches"]})]}):(a=>{let c=a.suggestions||[];if(!c.length)return(0,b.jsx)("span",{className:"text-muted-foreground text-sm",children:"—"});let d=c[0],e=d.invoices,f=J(e),g=e?.investor?.legal_name;return(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsxs)("div",{className:"text-sm font-medium text-amber-300",children:[f,c.length>1&&(0,b.jsxs)("span",{className:"text-xs text-muted-foreground ml-2",children:["+",c.length-1," more"]})]}),(0,b.jsx)("div",{className:"text-xs text-muted-foreground",children:g||"Potential match"}),H(d.confidence)]})})(c)}},{id:"status",accessorKey:"status",header:({column:a})=>(0,b.jsxs)(f.Button,{variant:"ghost",onClick:()=>a.toggleSorting("asc"===a.getIsSorted()),className:"hover:bg-white/5 -ml-4",children:["Status",(0,b.jsx)(B.ArrowUpDown,{className:"ml-2 h-4 w-4"})]}),cell:({row:a})=>{var c;let d,e,f,g=a.original;return(0,b.jsxs)("div",{className:"space-y-1.5",children:[(c=g.status,f=(e=(d={matched:{color:"bg-emerald-900/30 text-emerald-300 border-emerald-700",icon:D.CheckCircle2,label:"Matched"},partially_matched:{color:"bg-amber-900/30 text-amber-300 border-amber-700",icon:l.AlertCircle,label:"Partial"},unmatched:{color:"bg-slate-800/50 text-slate-300 border-slate-700",icon:E.HelpCircle,label:"Unmatched"}})[c]||d.unmatched).icon,(0,b.jsxs)(A.Badge,{className:`${e.color} gap-1.5`,children:[(0,b.jsx)(f,{className:"h-3 w-3"}),e.label]})),g.match_confidence&&H(g.match_confidence),g.match_notes&&(0,b.jsx)("div",{className:"text-xs text-muted-foreground line-clamp-2",children:g.match_notes})]})}},{id:"reference",header:"Reference",cell:({row:a})=>{let c=a.original;return(0,b.jsxs)("div",{className:"space-y-1",children:[c.bank_reference&&(0,b.jsx)("div",{className:"text-xs font-mono text-muted-foreground",children:c.bank_reference}),c.account_ref&&(0,b.jsx)("div",{className:"text-xs text-muted-foreground",children:c.account_ref})]})}},{id:"actions",header:"Actions",cell:({row:a})=>{let c=a.original;return(0,b.jsx)(G.default,{href:`/versotech_main/reconciliation/${c.id}`,children:(0,b.jsxs)(f.Button,{variant:"ghost",size:"sm",className:"hover:bg-white/5",children:[(0,b.jsx)(C.Eye,{className:"h-4 w-4 mr-2"}),"View"]})})}}];function M({columns:a,data:d}){let[e,f]=c.useState([{id:"created_at",desc:!0}]),g=(0,r.useReactTable)({data:d,columns:a,state:{sorting:e},onSortingChange:f,getCoreRowModel:(0,s.getCoreRowModel)(),getSortedRowModel:(0,s.getSortedRowModel)()});return(0,b.jsx)("div",{className:"rounded-md border border-white/10",children:(0,b.jsxs)(t.Table,{children:[(0,b.jsx)(t.TableHeader,{children:g.getHeaderGroups().map(a=>(0,b.jsx)(t.TableRow,{className:"border-white/10 hover:bg-white/5",children:a.headers.map(a=>(0,b.jsx)(t.TableHead,{className:"text-muted-foreground",children:a.isPlaceholder?null:(0,r.flexRender)(a.column.columnDef.header,a.getContext())},a.id))},a.id))}),(0,b.jsx)(t.TableBody,{children:g.getRowModel().rows?.length?g.getRowModel().rows.map(a=>(0,b.jsx)(t.TableRow,{"data-state":a.getIsSelected()&&"selected",className:"border-white/10 hover:bg-white/5",children:a.getVisibleCells().map(a=>(0,b.jsx)(t.TableCell,{children:(0,r.flexRender)(a.column.columnDef.cell,a.getContext())},a.id))},a.id)):(0,b.jsx)(t.TableRow,{children:(0,b.jsx)(t.TableCell,{colSpan:a.length,className:"h-24 text-center text-muted-foreground",children:"No invoices found."})})})]})})}let N=(a,b)=>new Intl.NumberFormat("en-US",{style:"currency",currency:b||"USD",minimumFractionDigits:2,maximumFractionDigits:2}).format(a),O=a=>new Date(a).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}),P=[{id:"invoice_number",accessorKey:"invoice_number",header:({column:a})=>(0,b.jsxs)(f.Button,{variant:"ghost",onClick:()=>a.toggleSorting("asc"===a.getIsSorted()),className:"hover:bg-white/5 -ml-4",children:["Invoice #",(0,b.jsx)(B.ArrowUpDown,{className:"ml-2 h-4 w-4"})]}),cell:({row:a})=>{let c=a.original,d=c.invoice_number||`INV-${c.id.slice(0,8)}`;return(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsxs)("div",{className:"font-medium text-foreground flex items-center gap-2",children:[(0,b.jsx)(o.FileText,{className:"h-3.5 w-3.5"}),d]}),c.deal?.name&&(0,b.jsx)("div",{className:"text-xs text-muted-foreground",children:c.deal.name})]})}},{id:"investor",header:"Investor",cell:({row:a})=>{let c=a.original.investor;return(0,b.jsx)("div",{className:"font-medium text-foreground",children:c?.legal_name||"—"})}},{id:"created_at",accessorKey:"created_at",header:({column:a})=>(0,b.jsxs)(f.Button,{variant:"ghost",onClick:()=>a.toggleSorting("asc"===a.getIsSorted()),className:"hover:bg-white/5 -ml-4",children:["Created",(0,b.jsx)(B.ArrowUpDown,{className:"ml-2 h-4 w-4"})]}),cell:({row:a})=>(0,b.jsx)("div",{className:"text-sm text-muted-foreground",children:O(a.original.created_at)})},{id:"total",accessorKey:"total",header:({column:a})=>(0,b.jsxs)(f.Button,{variant:"ghost",onClick:()=>a.toggleSorting("asc"===a.getIsSorted()),className:"hover:bg-white/5 -ml-4",children:["Total",(0,b.jsx)(B.ArrowUpDown,{className:"ml-2 h-4 w-4"})]}),cell:({row:a})=>{let c=a.original;return(0,b.jsx)("div",{className:"font-semibold text-foreground",children:N(c.total,c.currency)})}},{id:"paid_amount",accessorKey:"paid_amount",header:({column:a})=>(0,b.jsxs)(f.Button,{variant:"ghost",onClick:()=>a.toggleSorting("asc"===a.getIsSorted()),className:"hover:bg-white/5 -ml-4",children:["Paid",(0,b.jsx)(B.ArrowUpDown,{className:"ml-2 h-4 w-4"})]}),cell:({row:a})=>{let c=a.original,d=c.total>0?c.paid_amount/c.total*100:0;return(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("div",{className:`text-sm font-medium ${c.paid_amount>0?"text-emerald-300":"text-muted-foreground"}`,children:N(c.paid_amount,c.currency)}),d>0&&(0,b.jsxs)("div",{className:"text-xs text-muted-foreground",children:[d.toFixed(0),"% paid"]})]})}},{id:"balance_due",accessorKey:"balance_due",header:({column:a})=>(0,b.jsxs)(f.Button,{variant:"ghost",onClick:()=>a.toggleSorting("asc"===a.getIsSorted()),className:"hover:bg-white/5 -ml-4",children:["Balance Due",(0,b.jsx)(B.ArrowUpDown,{className:"ml-2 h-4 w-4"})]}),cell:({row:a})=>{let c=a.original;return(0,b.jsx)("div",{className:`font-medium ${c.balance_due>0?"text-amber-300":"text-muted-foreground"}`,children:N(c.balance_due,c.currency)})}},{id:"status",accessorKey:"status",header:"Status",cell:({row:a})=>{var c;let d,e,f,g=a.original;return(0,b.jsxs)("div",{className:"space-y-1.5",children:[(c=g.status,f=(e=(d={paid:{color:"bg-emerald-900/30 text-emerald-300 border-emerald-700",icon:D.CheckCircle2,label:"Paid"},partially_paid:{color:"bg-amber-900/30 text-amber-300 border-amber-700",icon:m.Clock,label:"Partial"},sent:{color:"bg-blue-900/30 text-blue-300 border-blue-700",icon:o.FileText,label:"Sent"},overdue:{color:"bg-rose-900/30 text-rose-300 border-rose-700",icon:l.AlertCircle,label:"Overdue"},draft:{color:"bg-slate-800/50 text-slate-300 border-slate-700",icon:m.Clock,label:"Draft"}})[c]||d.draft).icon,(0,b.jsxs)(A.Badge,{className:`${e.color} gap-1.5`,children:[(0,b.jsx)(f,{className:"h-3 w-3"}),e.label]})),g.paid_at&&(0,b.jsxs)("div",{className:"text-xs text-muted-foreground",children:["Paid ",O(g.paid_at)]})]})}},{id:"match_status",header:"Match Status",cell:({row:a})=>{let c=a.original;return(0,b.jsxs)("div",{className:"space-y-1",children:[(a=>{if(!a)return null;let c={matched:{color:"bg-emerald-900/30 text-emerald-300 border-emerald-700",label:"Matched"},partially_matched:{color:"bg-amber-900/30 text-amber-300 border-amber-700",label:"Partial Match"},unmatched:{color:"bg-slate-800/50 text-slate-300 border-slate-700",label:"Unmatched"}},d=c[a]||c.unmatched;return(0,b.jsx)(A.Badge,{className:d.color,children:d.label})})(c.match_status),(c.match_count||0)>0&&(0,b.jsxs)("div",{className:"text-xs text-muted-foreground",children:[c.match_count," match",1===c.match_count?"":"es"]})]})}}];var Q=a.i(470305),R=a.i(249464);a.i(191675);var S=a.i(468095),T=a.i(899750);function U(){let[a,e]=(0,c.useState)(!1),[h,i]=(0,c.useState)(null),[j,k]=(0,c.useState)(!1),l=(0,d.useRouter)(),m=async()=>{if(!h)return void T.toast.error("Please select a file");k(!0);try{let a=new FormData;a.append("file",h);let b=await fetch("/api/staff/reconciliation/upload",{method:"POST",body:a}),c=await b.json();if(!b.ok)throw Error(c.error||"Failed to upload CSV");T.toast.success(c.message||`Imported ${c.imported} transactions`),e(!1),i(null),l.refresh()}catch(a){T.toast.error(a.message||"Failed to upload CSV")}finally{k(!1)}};return(0,b.jsxs)(Q.Dialog,{open:a,onOpenChange:e,children:[(0,b.jsx)(Q.DialogTrigger,{asChild:!0,children:(0,b.jsxs)(f.Button,{variant:"outline",children:[(0,b.jsx)(S.Upload,{className:"h-4 w-4 mr-2"}),"Import Bank Data"]})}),(0,b.jsxs)(Q.DialogContent,{children:[(0,b.jsx)(Q.DialogHeader,{children:(0,b.jsx)(Q.DialogTitle,{children:"Import Bank Transactions"})}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(R.Label,{htmlFor:"file",children:"CSV File"}),(0,b.jsx)(g.Input,{id:"file",type:"file",accept:".csv",onChange:a=>i(a.target.files?.[0]||null)}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Expected columns: date, amount, counterparty (plus optional: currency, memo, reference)"})]}),(0,b.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,b.jsx)(f.Button,{variant:"outline",onClick:()=>e(!1),disabled:j,children:"Cancel"}),(0,b.jsx)(f.Button,{onClick:m,disabled:!h||j,children:j?"Uploading...":"Import"})]})]})]})]})}function V(){let[a,e]=(0,c.useState)(!1),g=(0,d.useRouter)(),h=async()=>{e(!0);try{let a=await fetch("/api/staff/reconciliation/auto-match",{method:"POST"}),b=await a.json();if(!a.ok)throw Error(b.error||"Failed to run auto-match");T.toast.success(b.message||`Found ${b.matches} suggested matches`),g.refresh()}catch(a){T.toast.error(a.message||"Failed to run auto-match")}finally{e(!1)}};return(0,b.jsxs)(f.Button,{onClick:h,disabled:a,children:[(0,b.jsx)(i.RefreshCw,{className:`h-4 w-4 mr-2 ${a?"animate-spin":""}`}),"Run Auto-Match"]})}function W(){(0,d.useRouter)();let[a,r]=(0,c.useState)("transactions"),[s,t]=(0,c.useState)([]),[u,v]=(0,c.useState)(null),[w,x]=(0,c.useState)([]),[y,A]=(0,c.useState)(null),[B,C]=(0,c.useState)(!0),[D,E]=(0,c.useState)(!1),[F,G]=(0,c.useState)(""),[H,I]=(0,c.useState)("");(0,c.useEffect)(()=>{J(),K()},[]);let J=async()=>{try{C(!0);let a=await fetch("/api/staff/reconciliation");if(!a.ok)throw Error("Failed to load transactions");let b=await a.json();t(b.transactions||[]),v(b.stats||{})}catch(a){console.error("Load error:",a),T.toast.error("Failed to load reconciliation data")}finally{C(!1)}},K=async()=>{try{let a=await fetch("/api/staff/reconciliation/invoices");if(!a.ok)throw Error("Failed to load invoices");let b=await a.json();x(b.invoices||[]),A(b.stats||{})}catch(a){console.error("Invoice load error:",a),T.toast.error("Failed to load invoices")}},N=async()=>{E(!0);try{await Promise.all([fetch("/api/staff/reconciliation").then(async a=>{if(!a.ok)throw Error("Failed to refresh transactions");let b=await a.json();t(b.transactions||[]),v(b.stats||{})}),fetch("/api/staff/reconciliation/invoices").then(async a=>{if(!a.ok)throw Error("Failed to refresh invoices");let b=await a.json();x(b.invoices||[]),A(b.stats||{})})]),T.toast.success("Data refreshed")}catch(a){T.toast.error("Failed to refresh data")}finally{E(!1)}},O=(0,c.useMemo)(()=>{if(!s||0===s.length)return[];let a=s;if(F){let b=F.toLowerCase();a=a.filter(a=>{let c=(a.matches||[]).flatMap(a=>{let b=a.invoices;return[b?.invoice_number,b?.investor?.legal_name,b?.deal?.name]}),d=(a.suggestions||[]).flatMap(a=>{let b=a.invoices;return[b?.invoice_number,b?.investor?.legal_name,b?.deal?.name]});return[a.counterparty,a.memo,a.bank_reference,a.account_ref,...c,...d].filter(Boolean).join(" ").toLowerCase().includes(b)})}return H&&(a=a.filter(a=>a.status===H)),a},[s,F,H]),Q=(0,c.useMemo)(()=>{if(!w||0===w.length)return[];let a=w;if(F){let b=F.toLowerCase();a=a.filter(a=>[a.invoice_number,a.investor?.legal_name,a.deal?.name].filter(Boolean).join(" ").toLowerCase().includes(b))}return H&&(["paid","partially_paid","sent","overdue","draft"].includes(H)?a=a.filter(a=>a.status===H):["matched","partially_matched","unmatched"].includes(H)&&(a=a.filter(a=>a.match_status===H))),a},[w,F,H]),R=(0,c.useMemo)(()=>{let a=O.length,b=O.filter(a=>"matched"===a.status).length,c=O.filter(a=>"partially_matched"===a.status).length,d=O.filter(a=>"unmatched"===a.status).length,e=O.reduce((a,b)=>a+(Number(b.amount)||0),0),f=O.reduce((a,b)=>a+(Number(b.matched_amount_total)||0),0),g=O.filter(a=>"unmatched"===a.status).reduce((a,b)=>a+(Number(b.amount)||0),0),h=a>0?Math.round(b/a*100):0;return{total:a,matched:b,partiallyMatched:c,unmatched:d,totalAmount:e,matchedAmount:f,unmatchedAmount:g,outstandingAmount:e-f,matchPercentage:h}},[O]),S=a=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(a);if(B)return(0,b.jsx)("div",{className:"flex items-center justify-center h-96",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)(i.RefreshCw,{className:"h-8 w-8 animate-spin text-muted-foreground mx-auto mb-2"}),(0,b.jsx)("div",{className:"text-sm text-muted-foreground",children:"Loading reconciliation data..."})]})});let W=u?.total>0?Math.round(u.matched/u.total*100):0,X=s.filter(a=>"partially_matched"===a.status).reduce((a,b)=>a+("number"==typeof b.remaining_amount?b.remaining_amount:Math.max((b.amount||0)-(b.matched_amount_total||0),0)),0);return(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-2xl font-bold text-foreground",children:"Bank Reconciliation"}),(0,b.jsx)("p",{className:"text-muted-foreground mt-1",children:"Import bank transactions and match payments to fee invoices"})]}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsxs)(f.Button,{variant:"outline",onClick:N,disabled:D,children:[(0,b.jsx)(i.RefreshCw,{className:`h-4 w-4 mr-2 ${D?"animate-spin":""}`}),"Refresh"]}),(0,b.jsx)(U,{}),(0,b.jsx)(V,{})]})]}),(0,b.jsxs)(e.Card,{children:[(0,b.jsx)(e.CardHeader,{className:"pb-3",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsxs)(e.CardTitle,{className:"flex items-center gap-2",children:[(0,b.jsx)(p.TrendingUp,{className:"h-5 w-5 text-muted-foreground"}),"Reconciliation Summary"]}),(0,b.jsxs)(e.CardDescription,{className:"mt-1",children:["Overall reconciliation status",(F||H)&&(0,b.jsx)("span",{className:"text-amber-400 ml-2",children:"(filtered view)"})]})]}),(0,b.jsxs)("div",{className:"text-right",children:[(0,b.jsxs)("div",{className:"text-3xl font-bold text-emerald-400",children:[R.matchPercentage,"%"]}),(0,b.jsx)("div",{className:"text-sm text-muted-foreground",children:"Match Rate"})]})]})}),(0,b.jsxs)(e.CardContent,{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Matching Progress"}),(0,b.jsxs)("span",{className:"text-foreground font-medium",children:[R.matched," of ",R.total," transactions"]})]}),(0,b.jsx)(q.Progress,{value:R.matchPercentage,className:"h-3"})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 pt-2",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3 p-3 rounded-lg bg-muted/50 border border-border",children:[(0,b.jsx)("div",{className:"p-2 rounded-lg bg-amber-500/10",children:(0,b.jsx)(m.Clock,{className:"h-5 w-5 text-amber-500 dark:text-amber-400"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-sm text-muted-foreground",children:"Total Outstanding"}),(0,b.jsx)("div",{className:"text-lg font-bold text-amber-600 dark:text-amber-200",children:S(R.outstandingAmount)}),(0,b.jsxs)("div",{className:"text-xs text-muted-foreground",children:[R.unmatched+R.partiallyMatched," transactions"]})]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-3 p-3 rounded-lg bg-muted/50 border border-border",children:[(0,b.jsx)("div",{className:"p-2 rounded-lg bg-emerald-500/10",children:(0,b.jsx)(k.CheckCircle,{className:"h-5 w-5 text-emerald-500 dark:text-emerald-400"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-sm text-muted-foreground",children:"Total Matched"}),(0,b.jsx)("div",{className:"text-lg font-bold text-emerald-600 dark:text-emerald-200",children:S(R.matchedAmount)}),(0,b.jsxs)("div",{className:"text-xs text-muted-foreground",children:[R.matched," transactions"]})]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-3 p-3 rounded-lg bg-muted/50 border border-border",children:[(0,b.jsx)("div",{className:"p-2 rounded-lg bg-rose-500/10",children:(0,b.jsx)(l.AlertCircle,{className:"h-5 w-5 text-rose-500 dark:text-rose-400"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-sm text-muted-foreground",children:"Total Unmatched"}),(0,b.jsx)("div",{className:"text-lg font-bold text-rose-600 dark:text-rose-200",children:S(R.unmatchedAmount)}),(0,b.jsxs)("div",{className:"text-xs text-muted-foreground",children:[R.unmatched," transactions"]})]})]})]})]})]}),(0,b.jsxs)(h.Tabs,{value:a,onValueChange:a=>r(a),children:[(0,b.jsxs)(h.TabsList,{className:"grid w-full max-w-md grid-cols-2",children:[(0,b.jsxs)(h.TabsTrigger,{value:"transactions",className:"flex items-center gap-2",children:[(0,b.jsx)(n.Activity,{className:"h-4 w-4"}),"Transactions (",s.length,")"]}),(0,b.jsxs)(h.TabsTrigger,{value:"invoices",className:"flex items-center gap-2",children:[(0,b.jsx)(o.FileText,{className:"h-4 w-4"}),"Fee Invoices (",w.length,")"]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4 mt-6",children:[(0,b.jsxs)(e.Card,{className:"bg-muted/50 border border-border",children:[(0,b.jsx)(e.CardHeader,{className:"pb-3",children:(0,b.jsxs)(e.CardTitle,{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[(0,b.jsx)(n.Activity,{className:"h-4 w-4"}),"Match Rate"]})}),(0,b.jsxs)(e.CardContent,{children:[(0,b.jsxs)("div",{className:"text-2xl font-bold text-emerald-600 dark:text-emerald-200",children:[W,"%"]}),(0,b.jsxs)("div",{className:"text-sm text-muted-foreground mt-1",children:[u?.matched||0," of ",u?.total||0]})]})]}),(0,b.jsxs)(e.Card,{children:[(0,b.jsx)(e.CardHeader,{className:"pb-3",children:(0,b.jsxs)(e.CardTitle,{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[(0,b.jsx)(k.CheckCircle,{className:"h-4 w-4"}),"Matched"]})}),(0,b.jsxs)(e.CardContent,{children:[(0,b.jsx)("div",{className:"text-2xl font-bold text-emerald-600 dark:text-emerald-200",children:u?.matched||0}),(0,b.jsx)("div",{className:"text-sm text-muted-foreground mt-1",children:S(u?.matchedAmount||0)})]})]}),(0,b.jsxs)(e.Card,{children:[(0,b.jsx)(e.CardHeader,{className:"pb-3",children:(0,b.jsxs)(e.CardTitle,{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[(0,b.jsx)(l.AlertCircle,{className:"h-4 w-4"}),"Partial"]})}),(0,b.jsxs)(e.CardContent,{children:[(0,b.jsx)("div",{className:"text-2xl font-bold text-amber-600 dark:text-amber-200",children:u?.partiallyMatched||u?.partially_matched||0}),(0,b.jsx)("div",{className:"text-sm text-muted-foreground mt-1",children:S(X||0)})]})]}),(0,b.jsxs)(e.Card,{children:[(0,b.jsx)(e.CardHeader,{className:"pb-3",children:(0,b.jsxs)(e.CardTitle,{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[(0,b.jsx)(m.Clock,{className:"h-4 w-4"}),"Unmatched"]})}),(0,b.jsxs)(e.CardContent,{children:[(0,b.jsx)("div",{className:"text-2xl font-bold text-rose-600 dark:text-rose-200",children:u?.unmatched||0}),(0,b.jsx)("div",{className:"text-sm text-muted-foreground mt-1",children:S(u?.unmatchedAmount||0)})]})]}),(0,b.jsxs)(e.Card,{children:[(0,b.jsx)(e.CardHeader,{className:"pb-3",children:(0,b.jsxs)(e.CardTitle,{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[(0,b.jsx)(j.Search,{className:"h-4 w-4"}),"Suggested Matches"]})}),(0,b.jsxs)(e.CardContent,{children:[(0,b.jsx)("div",{className:"text-2xl font-bold text-blue-600 dark:text-blue-200",children:u?.suggestedMatchesCount||0}),(0,b.jsx)("div",{className:"text-sm text-muted-foreground mt-1",children:"Ready for review"})]})]})]}),(0,b.jsx)(h.TabsContent,{value:"transactions",className:"space-y-4",children:(0,b.jsxs)(e.Card,{children:[(0,b.jsx)(e.CardHeader,{children:(0,b.jsx)("div",{className:"flex items-center justify-between",children:(0,b.jsxs)("div",{children:[(0,b.jsx)(e.CardTitle,{children:"All Transactions"}),(0,b.jsxs)(e.CardDescription,{children:[O.length," transaction",1!==O.length?"s":"",O.length!==s.length&&` (filtered from ${s.length})`]})]})})}),(0,b.jsxs)(e.CardContent,{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"flex gap-3",children:[(0,b.jsxs)("div",{className:"flex-1 relative",children:[(0,b.jsx)(j.Search,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),(0,b.jsx)(g.Input,{placeholder:"Search by counterparty, invoice, investor, reference...",value:F,onChange:a=>G(a.target.value),className:"pl-10"})]}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)(f.Button,{variant:""===H?"default":"outline",size:"sm",onClick:()=>I(""),children:"All"}),(0,b.jsx)(f.Button,{variant:"unmatched"===H?"default":"outline",size:"sm",onClick:()=>I("unmatched"),children:"Unmatched"}),(0,b.jsx)(f.Button,{variant:"partially_matched"===H?"default":"outline",size:"sm",onClick:()=>I("partially_matched"),children:"Partial"}),(0,b.jsx)(f.Button,{variant:"matched"===H?"default":"outline",size:"sm",onClick:()=>I("matched"),children:"Matched"})]})]}),(0,b.jsx)(z,{columns:L,data:O,pageSize:25})]})]})}),(0,b.jsx)(h.TabsContent,{value:"invoices",className:"space-y-4",children:(0,b.jsxs)(e.Card,{children:[(0,b.jsx)(e.CardHeader,{children:(0,b.jsx)("div",{className:"flex items-center justify-between",children:(0,b.jsxs)("div",{children:[(0,b.jsx)(e.CardTitle,{children:"All Fee Invoices"}),(0,b.jsxs)(e.CardDescription,{children:[Q.length," invoice",1!==Q.length?"s":"",Q.length!==w.length&&` (filtered from ${w.length})`]})]})})}),(0,b.jsxs)(e.CardContent,{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"flex gap-3",children:[(0,b.jsxs)("div",{className:"flex-1 relative",children:[(0,b.jsx)(j.Search,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),(0,b.jsx)(g.Input,{placeholder:"Search by invoice number, investor, deal...",value:F,onChange:a=>G(a.target.value),className:"pl-10"})]}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)(f.Button,{variant:""===H?"default":"outline",size:"sm",onClick:()=>I(""),children:"All"}),(0,b.jsx)(f.Button,{variant:"sent"===H?"default":"outline",size:"sm",onClick:()=>I("sent"),children:"Sent"}),(0,b.jsx)(f.Button,{variant:"partially_paid"===H?"default":"outline",size:"sm",onClick:()=>I("partially_paid"),children:"Partial"}),(0,b.jsx)(f.Button,{variant:"paid"===H?"default":"outline",size:"sm",onClick:()=>I("paid"),children:"Paid"}),(0,b.jsx)(f.Button,{variant:"matched"===H?"default":"outline",size:"sm",onClick:()=>I("matched"),children:"Matched"}),(0,b.jsx)(f.Button,{variant:"unmatched"===H?"default":"outline",size:"sm",onClick:()=>I("unmatched"),children:"Unmatched"})]})]}),(0,b.jsx)(M,{columns:P,data:Q})]})]})})]})]})}a.s(["ReconciliationPageClient",()=>W],943835)}];

//# sourceMappingURL=ddefc_staff_reconciliation_components_reconciliation-page-client_tsx_6d61dcae._.js.map