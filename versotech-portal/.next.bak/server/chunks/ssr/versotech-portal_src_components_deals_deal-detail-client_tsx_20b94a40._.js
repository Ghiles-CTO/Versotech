module.exports=[716616,a=>{"use strict";var b=a.i(352584),c=a.i(611038),d=a.i(284169),e=a.i(421908),f=a.i(15788),g=a.i(181608),h=a.i(470305),i=a.i(663475),j=a.i(249464),k=a.i(191675),l=a.i(951870),m=a.i(796300),n=a.i(816854),o=a.i(455964),p=a.i(975965),q=a.i(405398),r=a.i(3321),s=a.i(497412),t=a.i(289633),u=a.i(289907),v=a.i(966494),w=a.i(155508),x=a.i(278541);function y({deal:a,memberships:c=[],subscriptionsForJourney:e=[]}){let g=a.target_amount?Math.round(a.raised_amount/a.target_amount*100):0,h=new Map(e.map(a=>[a.investor_id,a])),i=c.map(a=>({...a,subscription:a.investor_id?h.get(a.investor_id):null})),j={total:i.length,dispatched:i.filter(a=>a.dispatched_at).length,viewed:i.filter(a=>a.viewed_at).length,interested:i.filter(a=>a.interest_confirmed_at).length,ndaSigned:i.filter(a=>a.nda_signed_at).length,dataRoom:i.filter(a=>a.data_room_granted_at).length,packGen:i.filter(a=>a.subscription?.pack_generated_at).length,packSent:i.filter(a=>a.subscription?.pack_sent_at).length,signed:i.filter(a=>a.subscription?.signed_at).length,funded:i.filter(a=>a.subscription?.funded_at).length},k=[{label:"Dispatched",count:j.dispatched},{label:"Viewed",count:j.viewed},{label:"Interested",count:j.interested},{label:"NDA",count:j.ndaSigned},{label:"Data Room",count:j.dataRoom},{label:"Pack Gen",count:j.packGen},{label:"Pack Sent",count:j.packSent},{label:"Signed",count:j.signed},{label:"Funded",count:j.funded}];return(0,b.jsxs)("div",{className:"space-y-6",children:[c.length>0&&(0,b.jsxs)(d.Card,{className:"border border-border bg-muted/30 overflow-hidden",children:[(0,b.jsx)(d.CardHeader,{className:"pb-2 pt-4 px-6",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)(d.CardTitle,{className:"text-sm font-medium text-muted-foreground tracking-wide uppercase",children:"Investor Pipeline"}),(0,b.jsxs)("span",{className:"text-xs text-muted-foreground",children:[j.total," total"]})]})}),(0,b.jsxs)(d.CardContent,{className:"px-6 pb-5",children:[(0,b.jsxs)("div",{className:"relative pt-2",children:[(0,b.jsx)("div",{className:"absolute top-[26px] left-5 right-5 h-[2px] bg-gradient-to-r from-emerald-500/20 via-emerald-500/10 to-transparent"}),(0,b.jsx)("div",{className:"relative flex items-start justify-between",children:k.map((a,c)=>{let d=a.count>0,e="Funded"===a.label,f=(a=>{if(0===a)return j.total>0?Math.round(k[0].count/j.total*100):0;let b=k[a-1].count;return 0===b?0:Math.round(k[a].count/b*100)})(c);return(0,b.jsxs)("div",{className:"flex flex-col items-center group",style:{flex:"1 1 0"},children:[(0,b.jsx)("div",{className:`
                          relative z-10 w-11 h-11 rounded-full flex items-center justify-center
                          text-sm font-semibold transition-all duration-300 cursor-default
                          ${d?e?"bg-emerald-500/25 text-emerald-300 ring-2 ring-emerald-500/40 shadow-[0_0_20px_rgba(16,185,129,0.15)]":"bg-emerald-500/15 text-emerald-400 ring-1 ring-emerald-500/25":"bg-muted text-muted-foreground/60"}
                          group-hover:scale-110 group-hover:ring-emerald-400/40
                        `,children:a.count}),(0,b.jsx)("span",{className:`
                        text-[10px] mt-2 text-center leading-tight transition-colors
                        ${d?"text-foreground/70":"text-muted-foreground/50"}
                        group-hover:text-foreground
                      `,children:a.label}),c>0&&(0,b.jsxs)("span",{className:`
                          text-[9px] mt-0.5 transition-opacity
                          ${a.count>0?"text-emerald-400/60":"text-muted-foreground/30"}
                        `,children:[f,"%"]})]},a.label)})})]}),(0,b.jsxs)("div",{className:"flex items-center justify-center gap-8 mt-6 pt-4 border-t border-border",children:[(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("div",{className:"text-lg font-semibold text-foreground",children:j.funded}),(0,b.jsx)("div",{className:"text-[10px] text-muted-foreground uppercase tracking-wider",children:"Funded"})]}),(0,b.jsx)("div",{className:"w-px h-8 bg-muted"}),(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsxs)("div",{className:"text-lg font-semibold text-foreground",children:[j.total>0?Math.round(j.funded/j.total*100):0,"%"]}),(0,b.jsx)("div",{className:"text-[10px] text-muted-foreground uppercase tracking-wider",children:"Conversion"})]}),(0,b.jsx)("div",{className:"w-px h-8 bg-muted"}),(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("div",{className:"text-lg font-semibold text-foreground",children:j.signed}),(0,b.jsx)("div",{className:"text-[10px] text-muted-foreground uppercase tracking-wider",children:"Signed"})]})]})]})]}),(0,b.jsxs)(d.Card,{className:"border border-border bg-muted/50",children:[(0,b.jsxs)(d.CardHeader,{children:[(0,b.jsx)(d.CardTitle,{className:"text-foreground",children:"Deal Information"}),(0,b.jsx)(d.CardDescription,{children:"Core details and structure"})]}),(0,b.jsx)(d.CardContent,{className:"space-y-4",children:(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-sm font-medium text-muted-foreground",children:"Deal Name"}),(0,b.jsx)("p",{className:"text-lg text-foreground mt-1",children:a.name})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-sm font-medium text-muted-foreground",children:"Company"}),(0,b.jsx)("p",{className:"text-lg text-foreground mt-1",children:a.company_name||"—"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-sm font-medium text-muted-foreground",children:"Vehicle"}),(0,b.jsx)("div",{className:"flex items-center gap-2 mt-1",children:a.vehicles?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(x.Building2,{className:"h-4 w-4 text-muted-foreground"}),(0,b.jsx)("span",{className:"text-foreground",children:a.vehicles.name}),(0,b.jsx)(f.Badge,{variant:"outline",className:"border-border",children:a.vehicles.type})]}):(0,b.jsx)("span",{className:"text-muted-foreground",children:"No vehicle assigned"})})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-sm font-medium text-muted-foreground",children:"Arranger"}),(0,b.jsx)("div",{className:"flex items-center gap-2 mt-1",children:a.arranger_entities?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(x.Building2,{className:"h-4 w-4 text-amber-500"}),(0,b.jsx)("span",{className:"text-foreground",children:a.arranger_entities.company_name||a.arranger_entities.legal_name}),(0,b.jsx)(f.Badge,{variant:"outline",className:"border-amber-500/30 text-amber-400 bg-amber-500/10",children:"Mandate"})]}):(0,b.jsx)("span",{className:"text-muted-foreground",children:"No arranger assigned"})})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-sm font-medium text-muted-foreground",children:"Sector / Stage"}),(0,b.jsxs)("p",{className:"text-foreground mt-1",children:[a.sector||"—"," ",a.stage&&`• ${a.stage}`]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-sm font-medium text-muted-foreground",children:"Location"}),(0,b.jsx)("p",{className:"text-foreground mt-1",children:a.location||"—"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-sm font-medium text-muted-foreground",children:"Currency"}),(0,b.jsx)("p",{className:"text-foreground mt-1",children:a.currency})]})]})})]}),(0,b.jsxs)(d.Card,{className:"border border-border bg-muted/50",children:[(0,b.jsxs)(d.CardHeader,{children:[(0,b.jsxs)(d.CardTitle,{className:"text-foreground flex items-center gap-2",children:[(0,b.jsx)(w.DollarSign,{className:"h-5 w-5"}),"Fundraising Progress"]}),(0,b.jsx)(d.CardDescription,{children:"Target and raised amounts. Investment terms (price, min/max) are defined in the Term Sheet."})]}),(0,b.jsxs)(d.CardContent,{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-sm font-medium text-muted-foreground",children:"Target Amount"}),(0,b.jsxs)("p",{className:"text-2xl font-bold text-foreground mt-1",children:[a.currency," ",a.target_amount?.toLocaleString()||"—"]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-sm font-medium text-muted-foreground",children:"Raised Amount"}),(0,b.jsxs)("p",{className:"text-2xl font-bold text-emerald-400 mt-1",children:[a.currency," ",a.raised_amount?.toLocaleString()||0]})]})]}),a.target_amount>0&&(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Progress"}),(0,b.jsxs)("span",{className:"font-medium text-foreground",children:[g,"% of target"]})]}),(0,b.jsx)("div",{className:"h-2 bg-muted rounded-full overflow-hidden",children:(0,b.jsx)("div",{className:"h-full bg-emerald-500 transition-all duration-300",style:{width:`${Math.min(g,100)}%`}})})]})]})]}),(0,b.jsxs)(d.Card,{className:"border border-border bg-muted/50",children:[(0,b.jsxs)(d.CardHeader,{children:[(0,b.jsxs)(d.CardTitle,{className:"text-foreground flex items-center gap-2",children:[(0,b.jsx)(u.CalendarDays,{className:"h-5 w-5"}),"Timeline"]}),(0,b.jsx)(d.CardDescription,{children:"Important dates and deadlines"})]}),(0,b.jsx)(d.CardContent,{children:(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-sm font-medium text-muted-foreground",children:"Open Date"}),(0,b.jsx)("p",{className:"text-foreground mt-1",children:a.open_at?new Date(a.open_at).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}):"—"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-sm font-medium text-muted-foreground",children:"Close Date"}),(0,b.jsx)("p",{className:"text-foreground mt-1",children:a.close_at?new Date(a.close_at).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}):"—"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-sm font-medium text-muted-foreground",children:"Created"}),(0,b.jsx)("p",{className:"text-foreground mt-1",children:new Date(a.created_at).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})})]}),a.close_at&&new Date(a.close_at)>new Date&&(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-sm font-medium text-muted-foreground",children:"Days Remaining"}),(0,b.jsx)("p",{className:"text-2xl font-bold text-emerald-200 mt-1",children:Math.ceil((new Date(a.close_at).getTime()-new Date().getTime())/864e5)})]})]})})]}),(a.description||a.investment_thesis)&&(0,b.jsxs)(d.Card,{className:"border border-border bg-muted/50",children:[(0,b.jsx)(d.CardHeader,{children:(0,b.jsxs)(d.CardTitle,{className:"text-foreground flex items-center gap-2",children:[(0,b.jsx)(v.TrendingUp,{className:"h-5 w-5"}),"Deal Overview"]})}),(0,b.jsxs)(d.CardContent,{className:"space-y-4",children:[a.description&&(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-sm font-medium text-muted-foreground",children:"Description"}),(0,b.jsx)("p",{className:"text-foreground mt-2 whitespace-pre-wrap",children:a.description})]}),a.investment_thesis&&(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-sm font-medium text-muted-foreground",children:"Investment Thesis"}),(0,b.jsx)("p",{className:"text-foreground mt-2 whitespace-pre-wrap",children:a.investment_thesis})]})]})]})]})}var z=a.i(405708);function A({dealId:a,onSuccess:d}){let f=(0,t.useRouter)(),[g,m]=(0,c.useState)(!1),[n,o]=(0,c.useState)(!1),[p,q]=(0,c.useState)(null),[s,u]=(0,c.useState)({source_type:"company",counterparty_name:"",units_total:"",unit_cost:"",currency:"USD",acquired_at:"",lockup_until:"",notes:""}),v=(a,b)=>{u(c=>({...c,[a]:b}))},w=async()=>{if(!s.units_total||!s.unit_cost)return void q("Units and cost are required");o(!0),q(null);try{let b=await fetch(`/api/deals/${a}/inventory`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({source_type:s.source_type,counterparty_name:s.counterparty_name,units_total:parseFloat(s.units_total),unit_cost:parseFloat(s.unit_cost),currency:s.currency,acquired_at:s.acquired_at||null,lockup_until:s.lockup_until||null,notes:s.notes||null})});if(!b.ok){let a=await b.json();throw Error(a.error||"Failed to add share lot")}u({source_type:"company",counterparty_name:"",units_total:"",unit_cost:"",currency:"USD",acquired_at:"",lockup_until:"",notes:""}),m(!1),d&&d(),f.refresh()}catch(a){q(a.message)}finally{o(!1)}};return(0,b.jsxs)(h.Dialog,{open:g,onOpenChange:m,children:[(0,b.jsx)(h.DialogTrigger,{asChild:!0,children:(0,b.jsxs)(e.Button,{className:"gap-2",children:[(0,b.jsx)(z.Plus,{className:"h-4 w-4"}),"Add Share Lot"]})}),(0,b.jsxs)(h.DialogContent,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[(0,b.jsxs)(h.DialogHeader,{children:[(0,b.jsx)(h.DialogTitle,{children:"Add Share Lot"}),(0,b.jsx)(h.DialogDescription,{children:"Add inventory to this deal from a share source"})]}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(j.Label,{htmlFor:"source_type",children:"Source Type *"}),(0,b.jsxs)(l.Select,{value:s.source_type,onValueChange:a=>v("source_type",a),children:[(0,b.jsx)(l.SelectTrigger,{children:(0,b.jsx)(l.SelectValue,{})}),(0,b.jsxs)(l.SelectContent,{children:[(0,b.jsx)(l.SelectItem,{value:"company",children:"Company"}),(0,b.jsx)(l.SelectItem,{value:"fund",children:"Fund"}),(0,b.jsx)(l.SelectItem,{value:"colleague",children:"Colleague"}),(0,b.jsx)(l.SelectItem,{value:"other",children:"Other"})]})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(j.Label,{htmlFor:"counterparty_name",children:"Counterparty Name"}),(0,b.jsx)(i.Input,{id:"counterparty_name",placeholder:"e.g., Former Employee",value:s.counterparty_name,onChange:a=>v("counterparty_name",a.target.value)})]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(j.Label,{htmlFor:"units_total",children:"Total Units *"}),(0,b.jsx)(i.Input,{id:"units_total",type:"number",step:"0.00000001",placeholder:"50000",value:s.units_total,onChange:a=>v("units_total",a.target.value),required:!0})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(j.Label,{htmlFor:"unit_cost",children:"Unit Cost *"}),(0,b.jsx)(i.Input,{id:"unit_cost",type:"number",step:"0.000001",placeholder:"120.00",value:s.unit_cost,onChange:a=>v("unit_cost",a.target.value),required:!0})]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-3 gap-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(j.Label,{htmlFor:"currency",children:"Currency"}),(0,b.jsxs)(l.Select,{value:s.currency,onValueChange:a=>v("currency",a),children:[(0,b.jsx)(l.SelectTrigger,{children:(0,b.jsx)(l.SelectValue,{})}),(0,b.jsxs)(l.SelectContent,{children:[(0,b.jsx)(l.SelectItem,{value:"USD",children:"USD"}),(0,b.jsx)(l.SelectItem,{value:"EUR",children:"EUR"}),(0,b.jsx)(l.SelectItem,{value:"GBP",children:"GBP"})]})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(j.Label,{htmlFor:"acquired_at",children:"Acquired Date"}),(0,b.jsx)(i.Input,{id:"acquired_at",type:"date",value:s.acquired_at,onChange:a=>v("acquired_at",a.target.value)})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(j.Label,{htmlFor:"lockup_until",children:"Lockup Until"}),(0,b.jsx)(i.Input,{id:"lockup_until",type:"date",value:s.lockup_until,onChange:a=>v("lockup_until",a.target.value)})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(j.Label,{htmlFor:"notes",children:"Notes"}),(0,b.jsx)(k.Textarea,{id:"notes",placeholder:"Additional information about this share lot...",rows:3,value:s.notes,onChange:a=>v("notes",a.target.value)})]}),p&&(0,b.jsx)("div",{className:"p-3 rounded-lg bg-red-500/20 border border-red-400/30 text-red-200 text-sm",children:p}),(0,b.jsxs)("div",{className:"flex justify-end gap-2 pt-4",children:[(0,b.jsx)(e.Button,{variant:"outline",onClick:()=>m(!1),disabled:n,children:"Cancel"}),(0,b.jsx)(e.Button,{onClick:w,disabled:n,children:n?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(r.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),"Adding..."]}):"Add Share Lot"})]})]})]})]})}function B({dealId:a,shareLots:c,inventorySummary:g,onRefresh:h}){return(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,b.jsxs)(d.Card,{className:"border-border bg-muted/50",children:[(0,b.jsx)(d.CardHeader,{className:"pb-2",children:(0,b.jsx)(d.CardTitle,{className:"text-sm font-medium text-muted-foreground",children:"Total Units"})}),(0,b.jsx)(d.CardContent,{children:(0,b.jsx)("p",{className:"text-2xl font-bold text-foreground",children:g.total_units.toLocaleString()})})]}),(0,b.jsxs)(d.Card,{className:"border-border bg-muted/50",children:[(0,b.jsx)(d.CardHeader,{className:"pb-2",children:(0,b.jsx)(d.CardTitle,{className:"text-sm font-medium text-muted-foreground",children:"Available"})}),(0,b.jsx)(d.CardContent,{children:(0,b.jsx)("p",{className:"text-2xl font-bold text-emerald-200",children:g.available_units.toLocaleString()})})]}),(0,b.jsxs)(d.Card,{className:"border-border bg-muted/50",children:[(0,b.jsx)(d.CardHeader,{className:"pb-2",children:(0,b.jsx)(d.CardTitle,{className:"text-sm font-medium text-muted-foreground",children:"Reserved"})}),(0,b.jsx)(d.CardContent,{children:(0,b.jsx)("p",{className:"text-2xl font-bold text-amber-200",children:g.reserved_units.toLocaleString()})})]}),(0,b.jsxs)(d.Card,{className:"border-border bg-muted/50",children:[(0,b.jsx)(d.CardHeader,{className:"pb-2",children:(0,b.jsx)(d.CardTitle,{className:"text-sm font-medium text-muted-foreground",children:"Allocated"})}),(0,b.jsx)(d.CardContent,{children:(0,b.jsx)("p",{className:"text-2xl font-bold text-sky-200",children:g.allocated_units.toLocaleString()})})]})]}),(0,b.jsxs)(d.Card,{className:"border-border bg-muted/50",children:[(0,b.jsx)(d.CardHeader,{children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsxs)(d.CardTitle,{className:"text-foreground flex items-center gap-2",children:[(0,b.jsx)(m.Package,{className:"h-5 w-5"}),"Share Lots"]}),(0,b.jsx)(d.CardDescription,{children:"Inventory sources and allocation tracking"})]}),(0,b.jsx)(A,{dealId:a,onSuccess:h})]})}),(0,b.jsx)(d.CardContent,{children:c&&0!==c.length?(0,b.jsx)("div",{className:"space-y-3",children:c.map(a=>(0,b.jsx)("div",{className:"border border-border rounded-lg p-4 bg-muted/50 hover:bg-muted transition-colors",children:(0,b.jsxs)("div",{className:"flex items-start justify-between",children:[(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("span",{className:"font-medium text-foreground",children:a.share_sources?.counterparty_name||"Unknown Source"}),(0,b.jsx)(f.Badge,{variant:"outline",className:"border-border text-xs",children:a.share_sources?.kind}),(0,b.jsx)(f.Badge,{className:"available"===a.status?"bg-emerald-500/20 text-emerald-200":"exhausted"===a.status?"bg-red-500/20 text-red-200":"bg-amber-500/20 text-amber-200",children:a.status})]}),(0,b.jsxs)("div",{className:"flex items-center gap-4 text-sm text-muted-foreground",children:[(0,b.jsxs)("span",{children:["Total: ",a.units_total.toLocaleString()," units"]}),(0,b.jsxs)("span",{children:["Remaining: ",a.units_remaining.toLocaleString()," units"]}),(0,b.jsxs)("span",{children:["Cost: ",a.currency," ",a.unit_cost.toFixed(2),"/unit"]}),a.acquired_at&&(0,b.jsxs)("span",{children:["Acquired: ",new Date(a.acquired_at).toLocaleDateString()]})]})]}),(0,b.jsx)(e.Button,{variant:"outline",size:"sm",children:"Edit"})]})},a.id))}):(0,b.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:'No share lots added yet. Click "Add Share Lot" to begin.'})})]})]})}var C=a.i(948153),D=a.i(771088),E=a.i(873785),F=a.i(264890),G=a.i(203297),H=a.i(941766),I=a.i(439467),J=a.i(399580),K=a.i(600900),L=a.i(478870),M=a.i(134303),N=a.i(703606),O=a.i(871057),P=a.i(799373),Q=a.i(917542),R=a.i(216316),S=a.i(877918),T=a.i(888987);let U={partner_investor:"partner",introducer_investor:"introducer",commercial_partner_investor:"commercial_partner"},V=[{value:"investor",label:"Investor",icon:Q.UserCircle,description:"Individual or entity investing in this deal",color:"bg-emerald-500/20 text-emerald-300 border-emerald-500/30"},{value:"partner",label:"Partner",icon:x.Building2,description:"Distribution or syndicate partner",color:"bg-purple-500/20 text-purple-300 border-purple-500/30"},{value:"introducer",label:"Introducer",icon:L.Users,description:"Individual or entity introducing investors",color:"bg-orange-500/20 text-orange-300 border-orange-500/30"},{value:"commercial_partner",label:"Commercial Partner",icon:O.Briefcase,description:"Wealth manager, placement agent, etc.",color:"bg-cyan-500/20 text-cyan-300 border-cyan-500/30"}],W=[{value:"investor",label:"Investor"},{value:"co_investor",label:"Co-Investor"},{value:"partner_investor",label:"Partner Investor"},{value:"introducer_investor",label:"Introducer Investor"},{value:"commercial_partner_investor",label:"Commercial Partner Investor"}],X=[{value:"subscription",label:"Subscription Fee"},{value:"management",label:"Management Fee"},{value:"performance",label:"Performance Fee"},{value:"spread_markup",label:"Spread Markup"},{value:"flat",label:"Flat Fee"}];function Y({dealId:a,onParticipantAdded:d}){let f=(0,t.useRouter)(),[g,k]=(0,c.useState)(!1),[m,n]=(0,c.useState)(!1),[o,p]=(0,c.useState)(null),[q,s]=(0,c.useState)(null),[u,v]=(0,c.useState)([]),[w,x]=(0,c.useState)([]),[y,A]=(0,c.useState)([]),[B,C]=(0,c.useState)([]),[D,E]=(0,c.useState)(!1),[F,G]=(0,c.useState)(""),[H,I]=(0,c.useState)(null),[J,K]=(0,c.useState)("investor"),[N,O]=(0,c.useState)(""),[P,Q]=(0,c.useState)(null),[R,Y]=(0,c.useState)(null),[Z,$]=(0,c.useState)(!1),[_,aa]=(0,c.useState)(""),[ab,ac]=(0,c.useState)([]),[ad,ae]=(0,c.useState)(""),[af,ag]=(0,c.useState)(!1),[ah,ai]=(0,c.useState)(""),[aj,ak]=(0,c.useState)([{kind:"subscription",rate_bps:200}]),[al,am]=(0,c.useState)([]),[an,ao]=(0,c.useState)(!1),[ap,aq]=(0,c.useState)(""),[ar,as]=(0,c.useState)(null),[at,au]=(0,c.useState)([]),[av,aw]=(0,c.useState)(!1),[ax,ay]=(0,c.useState)(""),az=!!U[J],aA=U[J],aB=(0,c.useCallback)(()=>"partner"===aA?w:"introducer"===aA?y:"commercial_partner"===aA?B:[],[aA,w,y,B]),aC=(0,c.useCallback)(async()=>{E(!0);try{let[a,b,c,d]=await Promise.all([fetch("/api/investors?has_users=true"),fetch("/api/admin/partners?status=active"),fetch("/api/admin/introducers?status=active"),fetch("/api/admin/commercial-partners?status=active")]);if(a.ok){let b=await a.json();v(b.investors||b.data||[])}if(b.ok){let a=await b.json();x(a.partners||a.data||[])}if(c.ok){let a=await c.json();A(a.introducers||a.data||[])}if(d.ok){let a=await d.json();C(a.partners||a.commercial_partners||a.data||[])}}catch(a){console.error("Failed to load entities:",a)}finally{E(!1)}},[]),aD=(0,c.useCallback)(async()=>{ag(!0);try{let b=await fetch(`/api/deals/${a}/fee-structures?status=published`);if(b.ok){let a=await b.json();ac(a.term_sheets||[])}}catch(a){console.error("Term sheets fetch failed:",a)}finally{ag(!1)}},[a]),aE=(0,c.useCallback)(async()=>{if(P&&aA){$(!0),Y(null),aa("");try{let b=`/api/deals/${a}/dispatch/fee-plans?entity_id=${P.id}&entity_type=${aA}`;ad&&(b+=`&term_sheet_id=${ad}`);let c=await fetch(b);if(c.ok){let a=await c.json();Y(a),1===a.accepted_plans.length&&aa(a.accepted_plans[0].id)}}catch(a){console.error("Fee plans fetch failed:",a)}finally{$(!1)}}},[a,P,aA,ad]),aF=(0,c.useCallback)(async b=>{ao(!0),am([]),aq(""),as(null),au([]),ay("");try{let c=await fetch(`/api/deals/${a}/active-agreements?introducer_id=${b}`);if(c.ok){let a=await c.json();am(a.agreements||[])}}catch(a){console.error("Active agreements fetch failed:",a)}finally{ao(!1)}},[a]),aG=(0,c.useCallback)(async b=>{aw(!0),au([]),ay("");try{let c=await fetch(`/api/deals/${a}/linkable-investors?term_sheet_id=${b}`);if(c.ok){let a=await c.json();au(a.investors||[])}}catch(a){console.error("Linkable investors fetch failed:",a)}finally{aw(!1)}},[a]);(0,c.useEffect)(()=>{g||(s(null),G(""),I(null),K("investor"),ai(""),ak([{kind:"subscription",rate_bps:200}]),p(null),O(""),Q(null),Y(null),aa(""),ac([]),ae(""),am([]),aq(""),as(null),au([]),ay(""))},[g]),(0,c.useEffect)(()=>{g&&aC()},[g,aC]),(0,c.useEffect)(()=>{G(""),I(null),K("investor"),O(""),Q(null),Y(null),aa(""),ai(""),am([]),aq(""),as(null),au([]),ay("")},[q]),(0,c.useEffect)(()=>{O(""),Q(null),Y(null),aa("")},[J]),(0,c.useEffect)(()=>{"investor"===q&&g?aD():(ac([]),ae(""))},[q,g,aD]),(0,c.useEffect)(()=>{"introducer"===q&&H?.id?aF(H.id):"introducer"===q&&(am([]),aq(""),as(null),au([]),ay(""))},[q,H?.id,aF]),(0,c.useEffect)(()=>{if(!ap){as(null),au([]),ay("");return}let a=al.find(a=>a.id===ap);as(a||null),a?.term_sheet_id&&aG(a.term_sheet_id)},[ap,al,aG]),(0,c.useEffect)(()=>{P&&aA&&ad?aE():(Y(null),aa(""))},[P,aA,ad,aE]),(0,c.useEffect)(()=>{if(!F)return void I(null);let a=[];"investor"===q?a=u:"partner"===q?a=w:"introducer"===q?a=y:"commercial_partner"===q&&(a=B);let b=a.find(a=>a.id===F);if(I(b||null),b&&"investor"!==q){let a=b.name||b.legal_name||"Unknown";ai(`${a} Fee Plan`)}},[F,q,u,w,y,B]),(0,c.useEffect)(()=>{N?Q(aB().find(a=>a.id===N)||null):Q(null)},[N,aB]);let aH=(a,b,c)=>{let d=[...aj];d[a]={...d[a],[b]:c},"rate_bps"===b&&delete d[a].flat_amount,"flat_amount"===b&&delete d[a].rate_bps,ak(d)},aI=async()=>{if(!q)return void p("Please select a participant type");if("investor"===q){if(!H)return void p("Please select an investor");if(!ad)return void p("Please select a term sheet for this investor");if(az){if(!P){let a=aA?.replace("_"," ")||"entity";p(`Please select a ${a} for this investor role`);return}if(!R?.can_dispatch)return void p(R?.message||"No accepted fee plan available for this entity");if(!_)return void p("Please select a fee plan")}}else if("introducer"===q){if(!ar)return void p("Please select an active introducer agreement");if(!ax)return void p("Please select an investor to link to this introducer")}else{if(!H)return void p(`Please select a ${q.replace("_"," ")}`);if(!ah.trim())return void p("Please enter a fee plan name")}n(!0),p(null);try{if("investor"===q){let b={investor_id:H.id,role:J,send_notification:!0,term_sheet_id:ad};az&&P&&_&&(b.referred_by_entity_id=P.id,b.referred_by_entity_type=aA,b.assigned_fee_plan_id=_);let c=await fetch(`/api/deals/${a}/members`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(b)});if(!c.ok){let a=await c.json();throw Error(a.message||a.error||"Failed to add investor")}}else if("introducer"===q){let b=at.find(a=>a.user_id===ax);if(!b||!ar)throw Error("Invalid selection");let c=await fetch(`/api/deals/${a}/members/${b.user_id}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({referred_by_entity_id:ar.introducer_id,referred_by_entity_type:"introducer",assigned_fee_plan_id:ar.fee_plan_id,role:"introducer_investor"})});if(!c.ok){let a=await c.json();throw Error(a.error||"Failed to link investor to introducer")}}else{let b=await fetch(`/api/deals/${a}/partners`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({entity_type:q,entity_id:H.id,fee_plan_name:ah.trim(),fee_components:aj.filter(a=>void 0!==a.rate_bps&&null!==a.rate_bps||void 0!==a.flat_amount&&null!==a.flat_amount)})});if(!b.ok){let a=await b.json();throw Error(a.error||`Failed to add ${q.replace("_"," ")}`)}}k(!1),d?.(),f.refresh()}catch(a){p(a.message)}finally{n(!1)}},aJ=a=>a.legal_name||a.name||"Unknown",aK=V.find(a=>a.value===q),aL=()=>"investor"===q?u:"partner"===q?w:"introducer"===q?y:"commercial_partner"===q?B:[];return(0,b.jsxs)(h.Dialog,{open:g,onOpenChange:k,children:[(0,b.jsx)(h.DialogTrigger,{asChild:!0,children:(0,b.jsxs)(e.Button,{className:"gap-2",children:[(0,b.jsx)(z.Plus,{className:"h-4 w-4"}),"Add Participant"]})}),(0,b.jsxs)(h.DialogContent,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[(0,b.jsxs)(h.DialogHeader,{children:[(0,b.jsx)(h.DialogTitle,{children:"Add Deal Participant"}),(0,b.jsx)(h.DialogDescription,{children:"Add an investor, partner, introducer, or commercial partner to this deal"})]}),(0,b.jsxs)("div",{className:"space-y-6 py-4",children:[(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsx)(j.Label,{children:"Participant Type"}),(0,b.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:V.map(a=>{let c=a.icon,d=q===a.value;return(0,b.jsx)("button",{type:"button",onClick:()=>s(a.value),className:(0,T.cn)("p-4 rounded-lg border text-left transition-all",d?a.color+" border-2":"border-border hover:border-primary hover:bg-muted"),children:(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)(c,{className:"h-5 w-5"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"font-medium",children:a.label}),(0,b.jsx)("div",{className:"text-xs text-muted-foreground",children:a.description})]})]})},a.value)})})]}),q&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)(j.Label,{children:["Select ",aK?.label]}),D?(0,b.jsxs)("div",{className:"flex items-center gap-2 py-3",children:[(0,b.jsx)(r.Loader2,{className:"h-4 w-4 animate-spin text-muted-foreground"}),(0,b.jsxs)("span",{className:"text-sm text-muted-foreground",children:["Loading ",aK?.label.toLowerCase(),"s..."]})]}):0===aL().length?(0,b.jsx)("div",{className:"p-3 rounded-lg border border-amber-500/30 bg-amber-500/5 text-amber-300 text-sm",children:(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(S.AlertCircle,{className:"h-4 w-4"}),(0,b.jsxs)("span",{children:["No ",aK?.label.toLowerCase(),"s available."]})]})}):(0,b.jsxs)(l.Select,{value:F,onValueChange:G,children:[(0,b.jsx)(l.SelectTrigger,{className:(0,T.cn)(H&&aK?.color),children:(0,b.jsx)(l.SelectValue,{placeholder:`Select a ${aK?.label.toLowerCase()}`})}),(0,b.jsx)(l.SelectContent,{children:aL().map(a=>(0,b.jsx)(l.SelectItem,{value:a.id,children:(0,b.jsxs)("div",{className:"flex flex-col",children:[(0,b.jsx)("span",{children:aJ(a)}),a.contact_email&&(0,b.jsx)("span",{className:"text-xs text-muted-foreground",children:a.contact_email})]})},a.id))})]})]}),"investor"===q&&H&&(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(j.Label,{children:"Role"}),(0,b.jsxs)(l.Select,{value:J,onValueChange:K,children:[(0,b.jsx)(l.SelectTrigger,{children:(0,b.jsx)(l.SelectValue,{})}),(0,b.jsx)(l.SelectContent,{children:W.map(a=>(0,b.jsx)(l.SelectItem,{value:a.value,children:a.label},a.value))})]})]}),"investor"===q&&H&&(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(j.Label,{children:"Term Sheet (Investor Class) *"}),af?(0,b.jsxs)("div",{className:"flex items-center gap-2 py-3",children:[(0,b.jsx)(r.Loader2,{className:"h-4 w-4 animate-spin text-muted-foreground"}),(0,b.jsx)("span",{className:"text-sm text-muted-foreground",children:"Loading term sheets..."})]}):0===ab.length?(0,b.jsx)("div",{className:"p-3 rounded-lg border border-amber-500/30 bg-amber-500/5 text-amber-300 text-sm",children:(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(S.AlertCircle,{className:"h-4 w-4"}),(0,b.jsx)("span",{children:"No published term sheets available. Please publish a term sheet first."})]})}):(0,b.jsxs)(l.Select,{value:ad,onValueChange:ae,children:[(0,b.jsx)(l.SelectTrigger,{children:(0,b.jsx)(l.SelectValue,{placeholder:"Select term sheet"})}),(0,b.jsx)(l.SelectContent,{children:ab.map(a=>(0,b.jsxs)(l.SelectItem,{value:a.id,children:["v",a.version," — ",a.subscription_fee_percent??0,"% sub / ",a.management_fee_percent??0,"% mgmt / ",a.carried_interest_percent??0,"% carry"]},a.id))})]})]}),"investor"===q&&H&&az&&(0,b.jsxs)("div",{className:"space-y-3 p-4 rounded-lg border border-amber-500/30 bg-amber-500/5",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(S.AlertCircle,{className:"h-4 w-4 text-amber-400"}),(0,b.jsxs)(j.Label,{className:"text-amber-300",children:["Referring ",aA?.replace("_"," ")," Required"]})]}),(0,b.jsxs)(l.Select,{value:N,onValueChange:O,children:[(0,b.jsx)(l.SelectTrigger,{children:(0,b.jsx)(l.SelectValue,{placeholder:`Select ${aA?.replace("_"," ")}`})}),(0,b.jsx)(l.SelectContent,{children:aB().map(a=>(0,b.jsx)(l.SelectItem,{value:a.id,children:aJ(a)},a.id))})]}),P&&!ad&&(0,b.jsx)("div",{className:"p-3 rounded-lg bg-blue-500/10 border border-blue-500/30",children:(0,b.jsxs)("div",{className:"flex items-start gap-2",children:[(0,b.jsx)(S.AlertCircle,{className:"h-4 w-4 text-blue-400 mt-0.5"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-blue-300 font-medium",children:"Term Sheet Required"}),(0,b.jsx)("p",{className:"text-xs text-blue-300/80 mt-1",children:"Please select a term sheet above first. Fee plans are linked to specific term sheets."})]})]})}),P&&ad&&Z&&(0,b.jsxs)("div",{className:"flex items-center gap-2 py-3",children:[(0,b.jsx)(r.Loader2,{className:"h-4 w-4 animate-spin text-muted-foreground"}),(0,b.jsx)("span",{className:"text-sm text-muted-foreground",children:"Loading fee plans..."})]}),P&&ad&&!Z&&R&&!R.can_dispatch&&(0,b.jsx)("div",{className:"p-3 rounded-lg bg-destructive/10 border border-destructive/30",children:(0,b.jsxs)("div",{className:"flex items-start gap-2",children:[(0,b.jsx)(S.AlertCircle,{className:"h-4 w-4 text-destructive mt-0.5"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-destructive font-medium",children:"Cannot Dispatch"}),(0,b.jsx)("p",{className:"text-xs text-destructive/80 mt-1",children:R.message||"No accepted fee plan available for this term sheet"})]})]})}),P&&ad&&!Z&&R&&R.can_dispatch&&(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(j.Label,{children:"Fee Plan"}),(0,b.jsxs)(l.Select,{value:_,onValueChange:aa,children:[(0,b.jsx)(l.SelectTrigger,{children:(0,b.jsx)(l.SelectValue,{placeholder:"Select fee plan"})}),(0,b.jsx)(l.SelectContent,{children:R.accepted_plans.map(a=>(0,b.jsx)(l.SelectItem,{value:a.id,children:(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("span",{children:a.name}),a.is_default&&(0,b.jsx)("span",{className:"text-xs bg-primary/20 text-primary px-1.5 py-0.5 rounded",children:"Default"})]})},a.id))})]}),_&&(0,b.jsx)("div",{className:"p-2 rounded bg-muted/30 text-xs space-y-1",children:R.accepted_plans.find(a=>a.id===_)?.fee_components.map((a,c)=>(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{className:"text-muted-foreground capitalize",children:a.kind.replace("_"," ")}),(0,b.jsx)("span",{children:void 0!==a.rate_bps?`${(a.rate_bps/100).toFixed(2)}%`:void 0!==a.flat_amount?`$${a.flat_amount.toLocaleString()}`:"-"})]},c))})]})]}),"investor"!==q&&"introducer"!==q&&H&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(j.Label,{children:"Fee Plan Name"}),(0,b.jsx)(i.Input,{value:ah,onChange:a=>ai(a.target.value),placeholder:"e.g., Standard Partner Fee"})]}),(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)(j.Label,{children:"Fee Components"}),(0,b.jsxs)(e.Button,{type:"button",variant:"ghost",size:"sm",onClick:()=>{ak([...aj,{kind:"subscription",rate_bps:100}])},className:"gap-1 text-xs",children:[(0,b.jsx)(z.Plus,{className:"h-3 w-3"}),"Add"]})]}),(0,b.jsx)("div",{className:"space-y-2",children:aj.map((a,c)=>(0,b.jsxs)("div",{className:"flex items-center gap-2 p-3 rounded-md bg-muted/50",children:[(0,b.jsxs)(l.Select,{value:a.kind,onValueChange:a=>aH(c,"kind",a),children:[(0,b.jsx)(l.SelectTrigger,{className:"w-36",children:(0,b.jsx)(l.SelectValue,{})}),(0,b.jsx)(l.SelectContent,{children:X.map(a=>(0,b.jsx)(l.SelectItem,{value:a.value,children:a.label},a.value))})]}),(0,b.jsx)(i.Input,{type:"number",step:"0.01",placeholder:"Rate %",value:void 0!==a.rate_bps&&null!==a.rate_bps?a.rate_bps/100:"",onChange:a=>aH(c,"rate_bps",a.target.value?100*parseFloat(a.target.value):void 0),className:"w-20"}),(0,b.jsx)("span",{className:"text-xs text-muted-foreground",children:"or"}),(0,b.jsx)(i.Input,{type:"number",step:"0.01",placeholder:"Flat $",value:void 0!==a.flat_amount&&null!==a.flat_amount?a.flat_amount:"",onChange:a=>aH(c,"flat_amount",a.target.value?parseFloat(a.target.value):void 0),className:"w-20"}),aj.length>1&&(0,b.jsx)(e.Button,{type:"button",variant:"ghost",size:"icon",onClick:()=>{ak(aj.filter((a,b)=>b!==c))},className:"h-8 w-8 text-destructive",children:(0,b.jsx)(M.Trash2,{className:"h-4 w-4"})})]},c))})]})]})]}),"introducer"===q&&H&&(0,b.jsxs)("div",{className:"space-y-4 p-4 rounded-lg border border-orange-500/30 bg-orange-500/5",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(L.Users,{className:"h-5 w-5 text-orange-400"}),(0,b.jsxs)("div",{children:[(0,b.jsxs)("h4",{className:"font-medium text-orange-300",children:["Link Investor to ",aJ(H)]}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"Select an active agreement, then choose an investor to link"})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(j.Label,{children:"Select Agreement (Term Sheet)"}),an?(0,b.jsxs)("div",{className:"flex items-center gap-2 py-3",children:[(0,b.jsx)(r.Loader2,{className:"h-4 w-4 animate-spin text-muted-foreground"}),(0,b.jsx)("span",{className:"text-sm text-muted-foreground",children:"Loading agreements..."})]}):0===al.length?(0,b.jsx)("div",{className:"p-3 rounded-lg border border-amber-500/30 bg-amber-500/5 text-amber-300 text-sm",children:(0,b.jsxs)("div",{className:"flex items-start gap-2",children:[(0,b.jsx)(S.AlertCircle,{className:"h-4 w-4 mt-0.5"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"font-medium",children:"No active agreements for this introducer"}),(0,b.jsxs)("p",{className:"text-xs text-amber-300/80 mt-1",children:[aJ(H)," has no signed agreements on this deal. Create and sign an introducer agreement in the Introducers tab first."]})]})]})}):(0,b.jsxs)(l.Select,{value:ap,onValueChange:aq,children:[(0,b.jsx)(l.SelectTrigger,{className:(0,T.cn)(ar&&"border-orange-500/50"),children:(0,b.jsx)(l.SelectValue,{placeholder:"Select an agreement"})}),(0,b.jsx)(l.SelectContent,{children:al.map(a=>(0,b.jsx)(l.SelectItem,{value:a.id,children:(0,b.jsxs)("div",{className:"flex flex-col",children:[(0,b.jsx)("span",{className:"font-medium",children:a.fee_plan_name}),(0,b.jsxs)("span",{className:"text-xs text-muted-foreground",children:["Term Sheet v",a.term_sheet_version," ",a.reference_number?`• ${a.reference_number}`:""]})]})},a.id))})]})]}),ar&&(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(j.Label,{children:"Select Investor to Link"}),av?(0,b.jsxs)("div",{className:"flex items-center gap-2 py-3",children:[(0,b.jsx)(r.Loader2,{className:"h-4 w-4 animate-spin text-muted-foreground"}),(0,b.jsx)("span",{className:"text-sm text-muted-foreground",children:"Loading eligible investors..."})]}):0===at.length?(0,b.jsx)("div",{className:"p-3 rounded-lg border border-blue-500/30 bg-blue-500/5 text-blue-300 text-sm",children:(0,b.jsxs)("div",{className:"flex items-start gap-2",children:[(0,b.jsx)(S.AlertCircle,{className:"h-4 w-4 mt-0.5"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"font-medium",children:"No eligible investors"}),(0,b.jsxs)("p",{className:"text-xs text-blue-300/80 mt-1",children:["No investors on Term Sheet v",ar.term_sheet_version," are available to link. They may already be linked to an introducer, or you need to add investors to this term sheet first."]})]})]})}):(0,b.jsxs)(l.Select,{value:ax,onValueChange:ay,children:[(0,b.jsx)(l.SelectTrigger,{className:(0,T.cn)(ax&&"border-orange-500/50"),children:(0,b.jsx)(l.SelectValue,{placeholder:"Select an investor"})}),(0,b.jsx)(l.SelectContent,{children:at.map(a=>(0,b.jsx)(l.SelectItem,{value:a.user_id,children:(0,b.jsxs)("div",{className:"flex flex-col",children:[(0,b.jsx)("span",{children:a.display_name}),a.email&&(0,b.jsx)("span",{className:"text-xs text-muted-foreground",children:a.email})]})},a.user_id))})]})]}),ar&&ax&&(0,b.jsx)("div",{className:"p-3 rounded-lg bg-emerald-500/10 border border-emerald-500/30",children:(0,b.jsxs)("div",{className:"flex items-start gap-2",children:[(0,b.jsx)("div",{className:"text-emerald-400 mt-0.5",children:"✓"}),(0,b.jsxs)("div",{className:"text-sm",children:[(0,b.jsx)("p",{className:"text-emerald-300 font-medium",children:"Ready to link"}),(0,b.jsxs)("p",{className:"text-emerald-300/80 text-xs mt-1",children:["This investor will be linked to ",(0,b.jsx)("strong",{children:aJ(H)})," using the ",(0,b.jsx)("strong",{children:ar.fee_plan_name})," fee plan (Term Sheet v",ar.term_sheet_version,")."]})]})]})})]}),o&&(0,b.jsx)("div",{className:"p-3 rounded-lg bg-destructive/10 text-destructive text-sm",children:o}),(0,b.jsxs)("div",{className:"flex justify-end gap-2 pt-4",children:[(0,b.jsx)(e.Button,{variant:"outline",onClick:()=>k(!1),disabled:m,children:"Cancel"}),(0,b.jsx)(e.Button,{onClick:aI,disabled:m||!(()=>{if(!q)return!1;if("investor"===q)return!!H&&!!ad&&(!az||!!P&&!!R?.can_dispatch&&!!_)&&!0;return"introducer"===q?!!(ar&&ax):!!(H&&ah.trim())})(),children:m?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(r.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),"introducer"===q?"Linking...":"Adding..."]}):"introducer"===q?"Link Investor to Introducer":`Add ${aK?.label||"Participant"}`})]})]})]})]})}let Z=[{key:"dispatched",label:"Dispatched",icon:E.Send,field:"dispatched_at"},{key:"viewed",label:"Viewed",icon:F.Eye,field:"viewed_at"},{key:"interest",label:"Interest",icon:v.TrendingUp,field:"interest_confirmed_at"},{key:"nda",label:"NDA",icon:G.FileSignature,field:"nda_signed_at"},{key:"data_room",label:"Data Room",icon:H.FolderOpen,field:"data_room_granted_at"},{key:"pack_gen",label:"Pack Gen",icon:n.FileText,field:"pack_generated_at",fromSubscription:!0},{key:"pack_sent",label:"Pack Sent",icon:I.Mail,field:"pack_sent_at",fromSubscription:!0},{key:"signed",label:"Signed",icon:J.CheckCircle2,field:"signed_at",fromSubscription:!0},{key:"funded",label:"Funded",icon:K.Wallet,field:"funded_at",fromSubscription:!0}];function $(a){let b=a.subscription||null;for(let c=Z.length-1;c>=0;c--){let d=Z[c],e=null,f="fromSubscription"in d&&d.fromSubscription;if(f&&b?e=b[d.field]:f||(e=a[d.field]),e)return{stage:d.label,index:c}}return{stage:"Invited",index:-1}}function _({member:a}){let{index:c}=$(a),d=a.subscription||null;return(0,b.jsx)("div",{className:"flex items-center gap-1",children:Z.map((e,f)=>{let g=null,h="fromSubscription"in e&&e.fromSubscription;h&&d?g=d[e.field]:h||(g=a[e.field]);let i=!!g;return(0,b.jsx)("div",{className:`w-6 h-6 rounded-full flex items-center justify-center text-xs transition-colors ${i?"bg-green-500/30 text-green-400 border border-green-500/50":f===c?"bg-yellow-500/30 text-yellow-400 border border-yellow-500/50":"bg-muted text-muted-foreground"}`,title:`${e.label}${g?` - ${(0,C.format)(new Date(g),"MMM d, yyyy")}`:""}`,children:(0,b.jsx)(e.icon,{className:"h-3 w-3"})},e.key)})})}function aa({dealId:a,members:g,subscriptions:h=[]}){let i=(0,t.useRouter)(),[j,k]=(0,c.useState)(g),[m,n]=(0,c.useState)([]),[o,p]=(0,c.useState)(!0),[q,s]=(0,c.useState)(null),[u,w]=(0,c.useState)(null),[y,z]=(0,c.useState)("all"),A=new Map(h.map(a=>[a.investor_id,a])),B=j.filter(a=>!["lawyer","arranger"].includes(a.role)).map(a=>({...a,subscription:a.investor_id?A.get(a.investor_id):null})),C=B.reduce((a,b)=>{let c=b.assigned_fee_plan;return c&&!a.find(a=>a.id===c.id)&&a.push({id:c.id,name:c.name}),a},[]),E="all"===y?B:"none"===y?B.filter(a=>!a.assigned_fee_plan):B.filter(a=>a.assigned_fee_plan?.id===y);(0,c.useEffect)(()=>{k(g)},[g]);let G=async()=>{p(!0),s(null);try{let b=await fetch(`/api/deals/${a}/partners`);if(!b.ok){let a=await b.json().catch(()=>({}));throw Error(a.error||"Failed to load partner assignments")}let c=await b.json();n(c.data||[])}catch(a){console.error("Failed to fetch partner assignments:",a),s(a instanceof Error?a.message:"Failed to load partner assignments")}finally{p(!1)}};(0,c.useEffect)(()=>{G()},[a]);let H=async b=>{if(confirm("Are you sure you want to remove this partner from this deal?")){w(b);try{let c=await fetch(`/api/deals/${a}/partners?fee_plan_id=${b}`,{method:"DELETE"});if(c.ok)await G(),i.refresh();else{let a=await c.json();alert(a.error||"Failed to remove partner")}}catch(a){console.error("Failed to remove partner:",a),alert("Failed to remove partner")}finally{w(null)}}},J={subscription:"Subscription Fee",management:"Management Fee",performance:"Performance Fee",spread_markup:"Spread Markup",flat:"Flat Fee",other:"Other"},K={draft:"bg-slate-100 dark:bg-slate-500/20 text-slate-700 dark:text-slate-300",sent:"bg-blue-100 dark:bg-blue-500/20 text-blue-700 dark:text-blue-300",pending_signature:"bg-amber-100 dark:bg-amber-500/20 text-amber-700 dark:text-amber-300",accepted:"bg-emerald-100 dark:bg-emerald-500/20 text-emerald-700 dark:text-emerald-300",rejected:"bg-red-100 dark:bg-red-500/20 text-red-700 dark:text-red-300"},S=async()=>{try{let b=await fetch(`/api/deals/${a}/members`);if(b.ok){let a=await b.json();k(a.members||[])}}catch(a){console.error("Failed to refresh members:",a)}},T=async b=>{if(confirm("Are you sure you want to remove this member from the deal?"))try{let c=await fetch(`/api/deals/${a}/members/${b}`,{method:"DELETE"});if(c.ok)await S();else{let a=await c.json();alert(`Failed to remove member: ${a.error||"Unknown error"}`)}}catch(a){console.error("Failed to remove member:",a),alert("Failed to remove member. Please try again.")}},U={investor:"bg-emerald-100 dark:bg-emerald-500/20 text-emerald-700 dark:text-emerald-200",co_investor:"bg-blue-100 dark:bg-blue-500/20 text-blue-700 dark:text-blue-200",partner_investor:"bg-purple-100 dark:bg-purple-500/20 text-purple-700 dark:text-purple-200",introducer_investor:"bg-orange-100 dark:bg-orange-500/20 text-orange-700 dark:text-orange-200",commercial_partner_investor:"bg-teal-100 dark:bg-teal-500/20 text-teal-700 dark:text-teal-200",advisor:"bg-purple-100 dark:bg-purple-500/20 text-purple-700 dark:text-purple-200",banker:"bg-cyan-100 dark:bg-cyan-500/20 text-cyan-700 dark:text-cyan-200",introducer:"bg-pink-100 dark:bg-pink-500/20 text-pink-700 dark:text-pink-200",verso_staff:"bg-muted text-muted-foreground",viewer:"bg-muted text-muted-foreground"},V={total:B.length,dispatched:B.filter(a=>a.dispatched_at).length,viewed:B.filter(a=>a.viewed_at).length,interested:B.filter(a=>a.interest_confirmed_at).length,ndaSigned:B.filter(a=>a.nda_signed_at).length,dataRoom:B.filter(a=>a.data_room_granted_at).length,packGen:B.filter(a=>a.subscription?.pack_generated_at).length,packSent:B.filter(a=>a.subscription?.pack_sent_at).length,signed:B.filter(a=>a.subscription?.signed_at).length,funded:B.filter(a=>a.subscription?.funded_at).length};return(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)(d.Card,{className:"border border-border bg-muted/50",children:[(0,b.jsx)(d.CardHeader,{className:"pb-3",children:(0,b.jsxs)(d.CardTitle,{className:"text-sm font-medium flex items-center gap-2",children:[(0,b.jsx)(v.TrendingUp,{className:"h-4 w-4"}),"Investor Journey Funnel"]})}),(0,b.jsx)(d.CardContent,{children:(0,b.jsx)("div",{className:"flex items-center gap-2 overflow-x-auto pb-2",children:[{label:"Dispatched",count:V.dispatched},{label:"Viewed",count:V.viewed},{label:"Interested",count:V.interested},{label:"NDA",count:V.ndaSigned},{label:"Data Room",count:V.dataRoom},{label:"Pack Gen",count:V.packGen},{label:"Pack Sent",count:V.packSent},{label:"Signed",count:V.signed},{label:"Funded",count:V.funded}].map((a,c)=>(0,b.jsxs)("div",{className:"flex items-center",children:[(0,b.jsxs)("div",{className:"text-center min-w-[70px]",children:[(0,b.jsx)("div",{className:"text-xl font-bold",children:a.count}),(0,b.jsx)("div",{className:"text-xs text-muted-foreground",children:a.label})]}),c<8&&(0,b.jsx)("div",{className:"mx-1 text-muted-foreground",children:"→"})]},a.label))})})]}),(0,b.jsxs)(d.Card,{className:"border border-border bg-muted/50",children:[(0,b.jsx)(d.CardHeader,{children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsxs)(d.CardTitle,{className:"text-foreground flex items-center gap-2",children:[(0,b.jsx)(L.Users,{className:"h-5 w-5"}),"Deal Participants (",B.length+m.length,")"]}),(0,b.jsx)(d.CardDescription,{children:"Investors, partners, introducers, and other participants in this deal"})]}),(0,b.jsx)("div",{className:"flex items-center gap-2",children:(0,b.jsx)(Y,{dealId:a,onParticipantAdded:()=>{S(),G()}})})]})}),(0,b.jsxs)(d.CardContent,{className:"space-y-6",children:[(0,b.jsxs)("div",{children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,b.jsxs)("h3",{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[(0,b.jsx)(Q.UserCircle,{className:"h-4 w-4"}),"Investors (",E.length,"all"!==y?` of ${B.length}`:"",")"]}),C.length>0&&(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("span",{className:"text-xs text-muted-foreground",children:"Filter by Fee Plan:"}),(0,b.jsxs)(l.Select,{value:y,onValueChange:z,children:[(0,b.jsx)(l.SelectTrigger,{className:"w-[200px] h-8 text-sm",children:(0,b.jsx)(l.SelectValue,{placeholder:"All Fee Plans"})}),(0,b.jsxs)(l.SelectContent,{children:[(0,b.jsx)(l.SelectItem,{value:"all",children:"All Fee Plans"}),(0,b.jsx)(l.SelectItem,{value:"none",children:"No Fee Plan (Direct)"}),C.map(a=>(0,b.jsx)(l.SelectItem,{value:a.id,children:a.name},a.id))]})]})]})]}),0===E.length?(0,b.jsx)("div",{className:"text-center py-6 text-muted-foreground border border-dashed border-border rounded-lg",children:"all"!==y?"No investors match the selected fee plan filter.":'No investors added yet. Click "Add Participant" to invite investors.'}):(0,b.jsxs)(D.Table,{children:[(0,b.jsx)(D.TableHeader,{children:(0,b.jsxs)(D.TableRow,{children:[(0,b.jsx)(D.TableHead,{children:"Member"}),(0,b.jsx)(D.TableHead,{children:"Role"}),(0,b.jsx)(D.TableHead,{children:"Referred By"}),(0,b.jsx)(D.TableHead,{children:"Fee Plan"}),(0,b.jsx)(D.TableHead,{children:"Journey Progress"}),(0,b.jsx)(D.TableHead,{children:"Current Stage"}),(0,b.jsx)(D.TableHead,{className:"text-right",children:"Actions"})]})}),(0,b.jsx)(D.TableBody,{children:E.map(a=>{let c,d=Array.isArray(a.profiles)?a.profiles[0]:a.profiles,g=Array.isArray(a.investors)?a.investors[0]:a.investors,{stage:h}=$(a),i=(c=a.assigned_fee_plan)?c.introducer?{type:"Introducer",name:c.introducer.company_name||c.introducer.name,icon:L.Users}:c.partner?{type:"Partner",name:c.partner.company_name||c.partner.name,icon:x.Building2}:c.commercial_partner?{type:"Commercial Partner",name:c.commercial_partner.company_name||c.commercial_partner.name,icon:O.Briefcase}:null:null,j=a.assigned_fee_plan;return(0,b.jsxs)(D.TableRow,{children:[(0,b.jsx)(D.TableCell,{children:(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"font-medium",children:g?.legal_name||d?.display_name||"Unknown"}),(0,b.jsx)("div",{className:"text-sm text-muted-foreground",children:d?.email}),g?.kyc_status&&(0,b.jsxs)(f.Badge,{variant:"outline",className:`text-xs mt-1 ${"approved"===g.kyc_status?"bg-green-500/20 text-green-400":"pending"===g.kyc_status?"bg-yellow-500/20 text-yellow-400":""}`,children:["KYC: ",g.kyc_status]})]})}),(0,b.jsx)(D.TableCell,{children:(0,b.jsx)(f.Badge,{className:U[a.role]||"bg-muted text-foreground",children:a.role?.replace(/_/g," ")})}),(0,b.jsx)(D.TableCell,{children:i?(0,b.jsxs)("div",{className:"flex items-center gap-1.5 text-sm",children:[(0,b.jsx)(i.icon,{className:"h-3.5 w-3.5 text-muted-foreground"}),(0,b.jsx)("span",{className:"text-muted-foreground",children:i.name})]}):(0,b.jsx)("span",{className:"text-xs text-muted-foreground/60",children:"Direct"})}),(0,b.jsx)(D.TableCell,{children:j?(0,b.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,b.jsx)("span",{className:"text-sm",children:j.name}),(0,b.jsx)(f.Badge,{className:`text-[10px] w-fit ${K[j.status]||"bg-muted text-muted-foreground"}`,children:j.status})]}):(0,b.jsx)("span",{className:"text-xs text-muted-foreground/60",children:"—"})}),(0,b.jsx)(D.TableCell,{children:(0,b.jsx)(_,{member:a})}),(0,b.jsx)(D.TableCell,{children:(0,b.jsx)(f.Badge,{variant:"outline",children:h})}),(0,b.jsx)(D.TableCell,{className:"text-right",children:(0,b.jsxs)(R.DropdownMenu,{children:[(0,b.jsx)(R.DropdownMenuTrigger,{asChild:!0,children:(0,b.jsx)(e.Button,{variant:"ghost",size:"icon",className:"h-8 w-8",children:(0,b.jsx)(N.MoreHorizontal,{className:"h-4 w-4"})})}),(0,b.jsxs)(R.DropdownMenuContent,{align:"end",children:[(0,b.jsx)(R.DropdownMenuLabel,{children:"Actions"}),(0,b.jsx)(R.DropdownMenuSeparator,{}),g&&(0,b.jsx)(R.DropdownMenuItem,{asChild:!0,children:(0,b.jsxs)("a",{href:`/versotech_main/investors/${g.id}`,children:[(0,b.jsx)(F.Eye,{className:"mr-2 h-4 w-4"}),"View Investor"]})}),d?.email&&(0,b.jsxs)(R.DropdownMenuItem,{onClick:()=>window.location.href=`mailto:${d.email}`,children:[(0,b.jsx)(I.Mail,{className:"mr-2 h-4 w-4"}),"Send Email"]}),(0,b.jsx)(R.DropdownMenuSeparator,{}),(0,b.jsxs)(R.DropdownMenuItem,{className:"text-red-400",onClick:()=>T(a.user_id),children:[(0,b.jsx)(M.Trash2,{className:"mr-2 h-4 w-4"}),"Remove Member"]})]})]})})]},a.user_id)})})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsxs)("h3",{className:"text-sm font-medium text-muted-foreground mb-3 flex items-center gap-2",children:[(0,b.jsx)(P.UserPlus,{className:"h-4 w-4"}),"Partners & Intermediaries (",m.length,")"]}),o?(0,b.jsx)("div",{className:"flex items-center justify-center py-6",children:(0,b.jsx)(r.Loader2,{className:"h-5 w-5 animate-spin text-muted-foreground"})}):q?(0,b.jsxs)("div",{className:"text-center py-6 text-red-400 border border-dashed border-red-500/20 rounded-lg bg-red-500/5",children:[q,(0,b.jsx)(e.Button,{variant:"ghost",size:"sm",onClick:G,className:"ml-2 text-red-400 hover:text-red-300",children:"Retry"})]}):0===m.length?(0,b.jsx)("div",{className:"text-center py-6 text-muted-foreground border border-dashed border-border rounded-lg",children:'No partners assigned yet. Click "Add Participant" to add partners, introducers, or commercial partners.'}):(0,b.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:m.map(a=>(0,b.jsx)("div",{className:"p-3 rounded-lg border border-border bg-muted/50",children:(0,b.jsxs)("div",{className:"flex items-start justify-between",children:[(0,b.jsxs)("div",{className:"flex items-start gap-3",children:[(0,b.jsx)("div",{className:"p-2 rounded-lg bg-primary/10",children:(a=>{switch(a){case"partner":default:return(0,b.jsx)(x.Building2,{className:"h-4 w-4"});case"introducer":return(0,b.jsx)(L.Users,{className:"h-4 w-4"});case"commercial_partner":return(0,b.jsx)(O.Briefcase,{className:"h-4 w-4"})}})(a.entity_type)}),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"font-medium text-sm",children:a.entity_name}),(0,b.jsx)("div",{className:"flex items-center gap-2 mt-1",children:(0,b.jsx)(f.Badge,{variant:"outline",className:"text-xs",children:(a=>{switch(a){case"partner":return"Partner";case"introducer":return"Introducer";case"commercial_partner":return"Commercial Partner";default:return a}})(a.entity_type)})}),(0,b.jsx)("div",{className:"text-xs text-muted-foreground mt-1",children:a.fee_components.length>0?a.fee_components.map(a=>(0,b.jsxs)("span",{className:"mr-2",children:[J[a.kind]||a.kind,": ",null!==a.rate_bps&&void 0!==a.rate_bps?`${a.rate_bps/100}%`:null!==a.flat_amount&&void 0!==a.flat_amount?`$${a.flat_amount}`:"—"]},a.id)):(0,b.jsx)("span",{className:"italic",children:"No fees defined"})})]})]}),(0,b.jsx)(e.Button,{variant:"ghost",size:"icon",onClick:()=>H(a.fee_plan_id),disabled:u===a.fee_plan_id,className:"text-destructive hover:text-destructive h-7 w-7",children:u===a.fee_plan_id?(0,b.jsx)(r.Loader2,{className:"h-3 w-3 animate-spin"}):(0,b.jsx)(M.Trash2,{className:"h-3 w-3"})})]})},a.fee_plan_id))})]})]})]})]})}var ab=a.i(441278),ac=a.i(42329),ad=a.i(625473),ae=a.i(425622),af=a.i(899750),ag=a.i(283732);function ah({dealId:a,feePlans:g}){let h=(0,t.useRouter)(),[i,j]=(0,c.useState)(!1),[k,l]=(0,c.useState)(null),[m,o]=(0,c.useState)(null),[p,s]=(0,c.useState)(null),u=async(a,b)=>{s(a);try{let c=await fetch(`/api/storage/download?path=${encodeURIComponent(a)}&bucket=deal-documents`);if(!c.ok)throw Error("Failed to download file");let d=await c.blob(),e=window.URL.createObjectURL(d),f=document.createElement("a");f.href=e,f.download=a.split("/").pop()||`${b||"agreement"}.pdf`,document.body.appendChild(f),f.click(),document.body.removeChild(f),window.URL.revokeObjectURL(e),af.toast.success("PDF downloaded successfully")}catch(a){console.error("Error downloading PDF:",a),af.toast.error("Failed to download PDF")}finally{s(null)}},v=async a=>{try{let b=await fetch(`/api/storage/download?path=${encodeURIComponent(a)}&bucket=deal-documents`);if(!b.ok)throw Error("Failed to load file");let c=await b.blob(),d=window.URL.createObjectURL(c);window.open(d,"_blank")}catch(a){console.error("Error previewing PDF:",a),af.toast.error("Failed to preview PDF")}},y={subscription:"Subscription Fee",management:"Management Fee",performance:"Performance Fee",spread_markup:"Spread Markup",flat:"Flat Fee",other:"Other"},A=a=>{l({...a,components:a.fee_components||[]}),j(!0)},B=async a=>{if(a.introducer_id){o(a.id);try{let b=await fetch(`/api/staff/fees/plans/${a.id}/generate-agreement`,{method:"POST"});if(!b.ok){let a=await b.json();alert(`Failed to generate agreement: ${a.error||"Unknown error"}`);return}alert("Introducer Agreement generated successfully!"),h.refresh()}catch(a){console.error("Error generating introducer agreement:",a),alert("Failed to generate agreement")}finally{o(null)}}},C=async a=>{if(a.partner_id){o(a.id);try{let b=await fetch(`/api/staff/fees/plans/${a.id}/generate-placement-agreement`,{method:"POST"});if(!b.ok){let a=await b.json();alert(`Failed to generate placement agreement: ${a.error||"Unknown error"}`);return}alert("Placement Agreement generated successfully!"),h.refresh()}catch(a){console.error("Error generating placement agreement:",a),alert("Failed to generate placement agreement")}finally{o(null)}}},D=async a=>{a.introducer_id?await B(a):a.partner_id&&await C(a)};return(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)(d.Card,{className:"border border-border bg-muted/50",children:[(0,b.jsx)(d.CardHeader,{children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsxs)(d.CardTitle,{className:"text-foreground flex items-center gap-2",children:[(0,b.jsx)(w.DollarSign,{className:"h-5 w-5"}),"Fee Plans"]}),(0,b.jsx)(d.CardDescription,{children:"Configure fee structures for investors"})]}),(0,b.jsxs)(e.Button,{onClick:()=>{l(null),j(!0)},className:"gap-2",children:[(0,b.jsx)(z.Plus,{className:"h-4 w-4"}),"Create Fee Plan"]})]})}),(0,b.jsx)(d.CardContent,{children:g&&0!==g.length?(0,b.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:g.map(a=>{let c=a.introducer_id?{type:"Introducer",icon:(0,b.jsx)(L.Users,{className:"h-4 w-4 text-blue-400"}),name:a.introducer?.legal_name||a.introducer?.name||a.introducer?.company_name||"Unknown"}:a.partner_id?{type:"Partner",icon:(0,b.jsx)(x.Building2,{className:"h-4 w-4 text-green-400"}),name:a.partner?.name||a.partner?.legal_name||a.partner?.company_name||"Unknown"}:a.commercial_partner_id?{type:"Commercial Partner",icon:(0,b.jsx)(O.Briefcase,{className:"h-4 w-4 text-purple-400"}),name:a.commercial_partner?.name||a.commercial_partner?.legal_name||a.commercial_partner?.company_name||"Unknown"}:null;return(0,b.jsxs)(d.Card,{className:"border border-border bg-muted/50",children:[(0,b.jsxs)(d.CardHeader,{children:[(0,b.jsxs)("div",{className:"flex items-start justify-between",children:[(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,b.jsx)(d.CardTitle,{className:"text-lg text-foreground",children:a.name}),(a=>{switch(a.status||"draft"){case"accepted":return(0,b.jsxs)(f.Badge,{className:"bg-green-100 dark:bg-green-500/20 text-green-700 dark:text-green-400 border-green-300 dark:border-green-500/30",children:[(0,b.jsx)(ab.CheckCircle,{className:"h-3 w-3 mr-1"}),"Accepted"]});case"sent":case"pending_signature":return(0,b.jsxs)(f.Badge,{className:"bg-amber-100 dark:bg-amber-500/20 text-amber-700 dark:text-amber-400 border-amber-300 dark:border-amber-500/30",children:[(0,b.jsx)(ac.Clock,{className:"h-3 w-3 mr-1"}),"Pending"]});case"rejected":return(0,b.jsxs)(f.Badge,{className:"bg-red-100 dark:bg-red-500/20 text-red-700 dark:text-red-400 border-red-300 dark:border-red-500/30",children:[(0,b.jsx)(ad.XCircle,{className:"h-3 w-3 mr-1"}),"Rejected"]});default:return(0,b.jsx)(f.Badge,{variant:"outline",className:"border-border text-muted-foreground",children:"Draft"})}})(a)]}),a.description&&(0,b.jsx)(d.CardDescription,{className:"mt-1",children:a.description})]}),(0,b.jsxs)("div",{className:"flex items-center gap-1",children:[(!!a.introducer_id&&!a.generated_agreement_id||!!a.partner_id&&!a.generated_placement_agreement_id)&&(0,b.jsx)(e.Button,{variant:"ghost",size:"sm",onClick:()=>D(a),disabled:m===a.id,className:"text-green-400 hover:text-green-300",title:a.introducer_id?"Generate Introducer Agreement (DOC 3)":a.partner_id?"Generate Placement Agreement":"",children:m===a.id?(0,b.jsx)(r.Loader2,{className:"h-4 w-4 animate-spin"}):(0,b.jsx)(G.FileSignature,{className:"h-4 w-4"})}),(!!a.introducer_id&&!!a.generated_agreement_id||!!a.partner_id&&!!a.generated_placement_agreement_id)&&(0,b.jsx)(f.Badge,{className:"bg-green-500/20 text-green-400 border-green-500/30 text-xs",children:"Agreement Generated"}),(0,b.jsx)(e.Button,{variant:"ghost",size:"sm",onClick:()=>A(a),className:"text-blue-400 hover:text-blue-300",children:(0,b.jsx)(q.Edit,{className:"h-4 w-4"})})]})]}),(0,b.jsxs)("div",{className:"mt-3 space-y-2",children:[a.term_sheet_id&&a.term_sheet&&(0,b.jsxs)("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[(0,b.jsx)(n.FileText,{className:"h-4 w-4 text-muted-foreground"}),(0,b.jsxs)("span",{children:["Term Sheet v",a.term_sheet.version,a.term_sheet.term_sheet_date&&(0,b.jsxs)("span",{className:"text-muted-foreground ml-1",children:["(",new Date(a.term_sheet.term_sheet_date).toLocaleDateString(),")"]})]})]}),!a.term_sheet_id&&(0,b.jsxs)("div",{className:"flex items-center gap-2 text-sm text-amber-400",children:[(0,b.jsx)(n.FileText,{className:"h-4 w-4"}),(0,b.jsx)("span",{children:"No term sheet linked"})]}),c&&(0,b.jsxs)("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[c.icon,(0,b.jsxs)("span",{children:[c.type,": ",c.name]})]}),!c&&(0,b.jsxs)("div",{className:"flex items-center gap-2 text-sm text-amber-400",children:[(0,b.jsx)(L.Users,{className:"h-4 w-4"}),(0,b.jsx)("span",{children:"No entity linked"})]}),a.accepted_at&&(0,b.jsxs)("div",{className:"flex items-center gap-2 text-sm text-green-400",children:[(0,b.jsx)(ab.CheckCircle,{className:"h-4 w-4"}),(0,b.jsxs)("span",{children:["Accepted ",new Date(a.accepted_at).toLocaleDateString()]})]})]})]}),(0,b.jsxs)(d.CardContent,{className:"space-y-3",children:[a.fee_components&&a.fee_components.length>0?(0,b.jsx)("div",{className:"space-y-2",children:a.fee_components.map(a=>(0,b.jsxs)("div",{className:"flex items-center justify-between py-2 px-3 rounded bg-muted/50",children:[(0,b.jsx)("span",{className:"text-sm text-foreground",children:y[a.kind]}),(0,b.jsx)(f.Badge,{variant:"outline",className:"border-border text-muted-foreground",children:a.rate_bps?`${a.rate_bps/100}%`:a.flat_amount?`$${a.flat_amount}`:"—"})]},a.id))}):(0,b.jsxs)("div",{className:"text-center py-4",children:[(0,b.jsx)("p",{className:"text-sm text-muted-foreground mb-2",children:"No components added yet"}),(0,b.jsx)(e.Button,{variant:"outline",size:"sm",onClick:()=>A(a),className:"text-xs",children:"Add Components"})]}),(()=>{let{pdfUrl:c,referenceNumber:d}=a.introducer_agreement?.pdf_url?{pdfUrl:a.introducer_agreement.pdf_url,referenceNumber:a.introducer_agreement.reference_number}:a.placement_agreement?.pdf_url?{pdfUrl:a.placement_agreement.pdf_url,referenceNumber:a.placement_agreement.reference_number}:{pdfUrl:null,referenceNumber:null};return c?(0,b.jsx)("div",{className:"mt-4 pt-4 border-t border-border",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("div",{className:"p-2 rounded-lg bg-green-500/10",children:(0,b.jsx)(n.FileText,{className:"h-5 w-5 text-green-400"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm font-medium text-foreground",children:a.introducer_id?"Introducer Agreement":"Placement Agreement"}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:d||"Document ready"})]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsxs)(e.Button,{variant:"outline",size:"sm",onClick:()=>v(c),className:"text-blue-400 border-blue-400/30 hover:bg-blue-400/10",children:[(0,b.jsx)(F.Eye,{className:"h-4 w-4 mr-1"}),"Preview"]}),(0,b.jsxs)(e.Button,{variant:"outline",size:"sm",onClick:()=>u(c,d),disabled:p===c,className:"text-green-400 border-green-400/30 hover:bg-green-400/10",children:[p===c?(0,b.jsx)(r.Loader2,{className:"h-4 w-4 mr-1 animate-spin"}):(0,b.jsx)(ae.Download,{className:"h-4 w-4 mr-1"}),"Download"]})]})]})}):null})()]})]},a.id)})}):(0,b.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:'No fee plans created yet. Click "Create Fee Plan" to begin.'})})]}),(0,b.jsx)(ag.default,{open:i,onClose:()=>{j(!1),l(null)},onSuccess:()=>{j(!1),l(null),h.refresh()},feePlan:k,dealId:a})]})}var ai=a.i(993009),aj=a.i(799968),ak=a.i(266828),al=a.i(778541),am=a.i(468095),an=a.i(478291),ao=a.i(823879);let ap=["Term Sheets","Data Room","Subscription Documents","Legal Documents","Financial Reports","Due Diligence"];function aq({dealId:a,onUploadComplete:d,trigger:f}){let g=(0,t.useRouter)(),[k,m]=(0,c.useState)(!1),[n,o]=(0,c.useState)([]),[p,q]=(0,c.useState)([]),[s,u]=(0,c.useState)(null),[v,w]=(0,c.useState)("Data Room"),[x,y]=(0,c.useState)(!1),[z,A]=(0,c.useState)(!1),[B,C]=(0,c.useState)(!1),[D,E]=(0,c.useState)(0),[F,G]=(0,c.useState)("file"),[I,J]=(0,c.useState)(""),[K,L]=(0,c.useState)(""),[M,N]=(0,c.useState)(!1),O=(0,c.useCallback)(async()=>{N(!0);try{let b=await fetch(`/api/deals/${a}/folders`);if(b.ok){let a=await b.json();q(a.folders||[]);let c=a.folders?.find(a=>"Data Room"===a.name||a.path?.includes("/Data Room"));c?(u(c.id),w("Data Room")):a.folders?.length>0&&(u(a.folders[0].id),w(a.folders[0].name))}else console.warn("Could not fetch deal folders, using defaults")}catch(a){console.error("Error fetching deal folders:",a)}finally{N(!1)}},[a]);(0,c.useEffect)(()=>{k&&a&&O()},[k,a,O]);let P=(0,c.useCallback)(a=>{o(b=>[...b,...a])},[]),{getRootProps:Q,getInputProps:R,isDragActive:S}=(0,aj.useDropzone)({onDrop:P,multiple:!0}),T=async()=>{if("file"===F&&0===n.length)return void af.toast.error("Please select files to upload");if("link"===F){if(!I.trim())return void af.toast.error("Please enter a link");if(!K.trim())return void af.toast.error("Please enter a document name")}C(!0),E(0);try{if("link"===F){let b=await fetch(`/api/deals/${a}/documents/link`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({external_link:I,file_name:K,folder:v,folder_id:s,visible_to_investors:x,is_featured:z})});if(b.ok)af.toast.success("Link added successfully");else{let a=await b.json();af.toast.error(`Failed to add link: ${a.error}`)}E(100)}else{let b=0;for(let c=0;c<n.length;c++){let d=n[c],e=new FormData;e.append("file",d),e.append("folder",v),s&&e.append("folder_id",s),e.append("visible_to_investors",x.toString()),e.append("is_featured",z.toString());let f=await fetch(`/api/deals/${a}/documents/upload`,{method:"POST",body:e});if(!f.ok){let a=await f.json();af.toast.error(`Failed to upload ${d.name}: ${a.error}`);continue}b++,E(Math.round((c+1)/n.length*100))}af.toast.success(`Successfully uploaded ${b} of ${n.length} files`)}o([]),w("Legal"),y(!1),A(!1),J(""),L(""),m(!1),d?.(),g.refresh()}catch(a){console.error("Upload error:",a),af.toast.error("Failed to upload documents")}finally{C(!1),E(0)}};return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("div",{onClick:()=>m(!0),children:f}),(0,b.jsx)(h.Dialog,{open:k,onOpenChange:m,children:(0,b.jsxs)(h.DialogContent,{className:"sm:max-w-2xl",children:[(0,b.jsxs)(h.DialogHeader,{children:[(0,b.jsx)(h.DialogTitle,{children:"Add Documents"}),(0,b.jsx)(h.DialogDescription,{children:"Upload files or add links to external documents (Google Drive, Dropbox, etc.)"})]}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"flex gap-2 border-b",children:[(0,b.jsx)(e.Button,{variant:"file"===F?"default":"ghost",onClick:()=>G("file"),className:"flex-1",children:"Upload Files"}),(0,b.jsx)(e.Button,{variant:"link"===F?"default":"ghost",onClick:()=>G("link"),className:"flex-1",children:"Add Link"})]}),"file"===F?(0,b.jsx)(b.Fragment,{children:(0,b.jsxs)("div",{...Q(),className:`border-2 border-dashed rounded-lg p-8 text-center cursor-pointer transition-colors ${S?"border-blue-500 bg-blue-500/10":"border-border hover:border-muted-foreground"}`,children:[(0,b.jsx)("input",{...R()}),(0,b.jsx)(am.Upload,{className:"h-12 w-12 mx-auto mb-4 text-muted-foreground"}),S?(0,b.jsx)("p",{className:"text-blue-600 dark:text-blue-400 font-medium",children:"Drop files here..."}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("p",{className:"text-foreground font-medium mb-1",children:"Drag and drop files here, or click to browse"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Supports all document types (PDF, DOCX, XLSX, JSON, etc.)"})]})]})}):(0,b.jsx)(b.Fragment,{children:(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(j.Label,{htmlFor:"linkUrl",children:"Document Link"}),(0,b.jsx)(i.Input,{id:"linkUrl",type:"url",value:I,onChange:a=>J(a.target.value),placeholder:"https://drive.google.com/file/d/..."}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"Paste a Google Drive, Dropbox, or any public link"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(j.Label,{htmlFor:"linkName",children:"Document Name"}),(0,b.jsx)(i.Input,{id:"linkName",value:K,onChange:a=>L(a.target.value),placeholder:"Q4 2024 Report"})]})]})}),"file"===F&&n.length>0&&(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)(j.Label,{children:["Selected Files (",n.length,")"]}),(0,b.jsx)("div",{className:"max-h-48 overflow-y-auto space-y-2",children:n.map((a,c)=>(0,b.jsxs)("div",{className:"flex items-center justify-between p-2 bg-muted rounded border border-border",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[(0,b.jsx)(an.File,{className:"h-4 w-4 text-muted-foreground flex-shrink-0"}),(0,b.jsx)("span",{className:"text-sm truncate",children:a.name}),(0,b.jsxs)("span",{className:"text-xs text-muted-foreground flex-shrink-0",children:["(",(a.size/1024).toFixed(1)," KB)"]})]}),(0,b.jsx)(e.Button,{variant:"ghost",size:"sm",onClick:()=>{o(a=>a.filter((a,b)=>b!==c))},disabled:B,children:(0,b.jsx)(ao.X,{className:"h-4 w-4"})})]},c))})]}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(j.Label,{children:"Folder"}),(0,b.jsxs)(l.Select,{value:s||v,onValueChange:a=>{let b=p.find(b=>b.id===a);b?(u(b.id),w(b.name)):(u(null),w(a))},disabled:B||M,children:[(0,b.jsx)(l.SelectTrigger,{children:(0,b.jsx)(l.SelectValue,{placeholder:M?"Loading folders...":"Select folder"})}),(0,b.jsx)(l.SelectContent,{children:p.length>0?p.map(a=>(0,b.jsx)(l.SelectItem,{value:a.id,children:(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(H.FolderOpen,{className:"h-3 w-3"}),(0,b.jsx)("span",{children:a.name})]})},a.id)):ap.map(a=>(0,b.jsx)(l.SelectItem,{value:a,children:a},a))})]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,b.jsx)(ak.Checkbox,{id:"visible",checked:x,onCheckedChange:a=>y(a),disabled:B}),(0,b.jsx)("label",{htmlFor:"visible",className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:"Visible to investors"})]}),(0,b.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,b.jsx)(ak.Checkbox,{id:"featured",checked:z,onCheckedChange:a=>A(a),disabled:B}),(0,b.jsx)("label",{htmlFor:"featured",className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:"Featured document"})]})]})]}),B&&(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,b.jsx)("span",{children:"Uploading..."}),(0,b.jsxs)("span",{children:[D,"%"]})]}),(0,b.jsx)(al.Progress,{value:D})]}),(0,b.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,b.jsx)(e.Button,{variant:"outline",onClick:()=>m(!1),disabled:B,children:"Cancel"}),(0,b.jsxs)(e.Button,{onClick:T,disabled:B||"file"===F&&0===n.length,children:[B&&(0,b.jsx)(r.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),"link"===F?"Add Link":`Upload ${n.length>0?`(${n.length})`:""}`]})]})]})]})})]})}let ar=["Legal","KYC","Reports","Presentations","Financial Models","Misc"];function as({dealId:a,documentId:d,open:g,onOpenChange:m,onSaved:n,initialData:o}){let[p,q]=(0,c.useState)(o?.file_name||""),[s,t]=(0,c.useState)(o?.folder||"Legal"),[u,v]=(0,c.useState)(o?.visible_to_investors||!1),[w,x]=(0,c.useState)(o?.tags||[]),[y,z]=(0,c.useState)(""),[A,B]=(0,c.useState)(o?.document_notes||""),[C,D]=(0,c.useState)(o?.document_expires_at?new Date(o.document_expires_at).toISOString().slice(0,16):""),[E,F]=(0,c.useState)(!1);(0,c.useEffect)(()=>{o&&(q(o.file_name||""),t(o.folder||"Legal"),v(o.visible_to_investors||!1),x(o.tags||[]),B(o.document_notes||""),D(o.document_expires_at?new Date(o.document_expires_at).toISOString().slice(0,16):""))},[o,g]);let G=()=>{let a=y.trim();a&&!w.includes(a)&&(x([...w,a]),z(""))},H=async()=>{F(!0);try{let b=await fetch(`/api/deals/${a}/documents/${d}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({file_name:p,folder:s,visible_to_investors:u,tags:w,document_notes:A||null,document_expires_at:C?new Date(C).toISOString():null})});if(!b.ok){let a=await b.json();throw Error(a.error||"Failed to update document")}af.toast.success("Document metadata updated successfully"),m(!1),n&&n()}catch(a){console.error("Save error:",a),af.toast.error(a instanceof Error?a.message:"Failed to save changes")}finally{F(!1)}};return(0,b.jsx)(h.Dialog,{open:g,onOpenChange:m,children:(0,b.jsxs)(h.DialogContent,{className:"sm:max-w-2xl max-h-[90vh] overflow-y-auto",children:[(0,b.jsxs)(h.DialogHeader,{children:[(0,b.jsx)(h.DialogTitle,{children:"Edit Document Metadata"}),(0,b.jsx)(h.DialogDescription,{children:"Update document details, visibility, tags, and expiry settings."})]}),(0,b.jsxs)("div",{className:"space-y-4 py-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(j.Label,{htmlFor:"fileName",children:"File Name"}),(0,b.jsx)(i.Input,{id:"fileName",value:p,onChange:a=>q(a.target.value),placeholder:"document.pdf"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(j.Label,{children:"Folder"}),(0,b.jsxs)(l.Select,{value:s,onValueChange:t,children:[(0,b.jsx)(l.SelectTrigger,{children:(0,b.jsx)(l.SelectValue,{})}),(0,b.jsx)(l.SelectContent,{children:ar.map(a=>(0,b.jsx)(l.SelectItem,{value:a,children:a},a))})]})]}),(0,b.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,b.jsx)(ak.Checkbox,{id:"visible",checked:u,onCheckedChange:a=>v(a)}),(0,b.jsx)("label",{htmlFor:"visible",className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:"Visible to investors"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(j.Label,{children:"Tags"}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)(i.Input,{value:y,onChange:a=>z(a.target.value),onKeyPress:a=>"Enter"===a.key&&(a.preventDefault(),G()),placeholder:"Add tag and press Enter"}),(0,b.jsx)(e.Button,{type:"button",onClick:G,variant:"outline",children:"Add"})]}),w.length>0&&(0,b.jsx)("div",{className:"flex flex-wrap gap-2",children:w.map(a=>(0,b.jsxs)(f.Badge,{variant:"secondary",className:"gap-1",children:[a,(0,b.jsx)(ao.X,{className:"h-3 w-3 cursor-pointer",onClick:()=>{x(w.filter(b=>b!==a))}})]},a))})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(j.Label,{htmlFor:"expiresAt",children:"Document Expiry (Optional)"}),(0,b.jsx)(i.Input,{id:"expiresAt",type:"datetime-local",value:C,onChange:a=>D(a.target.value)}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"Leave blank for no expiry. Expired documents will be hidden from investors."})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(j.Label,{htmlFor:"notes",children:"Internal Notes"}),(0,b.jsx)(k.Textarea,{id:"notes",value:A,onChange:a=>B(a.target.value),rows:3,placeholder:"Add internal notes about this document (not visible to investors)"})]})]}),(0,b.jsxs)(h.DialogFooter,{children:[(0,b.jsx)(e.Button,{variant:"outline",onClick:()=>m(!1),disabled:E,children:"Cancel"}),(0,b.jsxs)(e.Button,{onClick:H,disabled:E,children:[E&&(0,b.jsx)(r.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),"Save Changes"]})]})]})})}function at({dealId:a,documentId:d,open:g,onOpenChange:i}){let[j,k]=(0,c.useState)([]),[l,m]=(0,c.useState)(!1),[o,p]=(0,c.useState)(null),[q,s]=(0,c.useState)(!1),t=(0,c.useRef)(null),u=async b=>{let c=b.target.files?.[0];if(c){s(!0);try{let b=new FormData;b.append("file",c);let e=await fetch(`/api/deals/${a}/documents/${d}/versions`,{method:"POST",body:b});if(!e.ok){let a=await e.json();throw Error(a.error||"Failed to upload new version")}af.toast.success("New version uploaded successfully"),await v()}catch(a){console.error("Error uploading version:",a),af.toast.error(a instanceof Error?a.message:"Failed to upload new version")}finally{s(!1),t.current&&(t.current.value="")}}},v=(0,c.useCallback)(async()=>{m(!0),p(null);try{let b=await fetch(`/api/deals/${a}/documents/${d}/versions`);if(!b.ok)throw Error("Failed to load version history");let c=await b.json();k(c.versions||[])}catch(a){console.error("Error loading versions:",a),p(a instanceof Error?a.message:"Failed to load versions")}finally{m(!1)}},[a,d]);return(0,c.useEffect)(()=>{g&&d&&v()},[g,d,v]),(0,b.jsx)(h.Dialog,{open:g,onOpenChange:i,children:(0,b.jsxs)(h.DialogContent,{className:"sm:max-w-3xl max-h-[80vh] overflow-y-auto",children:[(0,b.jsxs)(h.DialogHeader,{children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)(h.DialogTitle,{className:"flex items-center gap-2",children:[(0,b.jsx)(n.FileText,{className:"h-5 w-5"}),"Document Version History"]}),(0,b.jsxs)("div",{children:[(0,b.jsxs)(e.Button,{size:"sm",onClick:()=>t.current?.click(),disabled:q||l,children:[q?(0,b.jsx)(r.Loader2,{className:"h-4 w-4 mr-2 animate-spin"}):(0,b.jsx)(am.Upload,{className:"h-4 w-4 mr-2"}),q?"Uploading...":"Upload New Version"]}),(0,b.jsx)("input",{type:"file",ref:t,onChange:u,className:"hidden",accept:".pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx,.txt,.csv"})]})]}),(0,b.jsx)(h.DialogDescription,{children:"View all versions of this document. The latest version is shown to investors."})]}),l&&(0,b.jsx)("div",{className:"flex items-center justify-center py-8",children:(0,b.jsx)(r.Loader2,{className:"h-8 w-8 animate-spin text-muted-foreground"})}),o&&(0,b.jsx)("div",{className:"text-center py-8 text-destructive",children:o}),!l&&!o&&0===j.length&&(0,b.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:"No version history available yet."}),!l&&!o&&j.length>0&&(0,b.jsxs)(D.Table,{children:[(0,b.jsx)(D.TableHeader,{children:(0,b.jsxs)(D.TableRow,{children:[(0,b.jsx)(D.TableHead,{children:"Version"}),(0,b.jsx)(D.TableHead,{children:"File Name"}),(0,b.jsx)(D.TableHead,{children:"Size"}),(0,b.jsx)(D.TableHead,{children:"Uploaded"}),(0,b.jsx)(D.TableHead,{children:"Status"}),(0,b.jsx)(D.TableHead,{className:"text-right",children:"Actions"})]})}),(0,b.jsx)(D.TableBody,{children:j.map(a=>{var c;let d=!a.replaced_by_id;return(0,b.jsxs)(D.TableRow,{children:[(0,b.jsxs)(D.TableCell,{className:"font-medium",children:["v",a.version]}),(0,b.jsx)(D.TableCell,{className:"font-mono text-sm",children:a.file_name}),(0,b.jsx)(D.TableCell,{className:"text-sm text-muted-foreground",children:(c=a.file_size_bytes)?c<1024?`${c} B`:c<1048576?`${(c/1024).toFixed(1)} KB`:`${(c/1048576).toFixed(1)} MB`:"—"}),(0,b.jsx)(D.TableCell,{className:"text-sm",children:(0,C.format)(new Date(a.created_at),"dd MMM yyyy HH:mm")}),(0,b.jsx)(D.TableCell,{children:d?(0,b.jsx)(f.Badge,{className:"bg-emerald-500/20 text-emerald-200",children:"Current"}):(0,b.jsx)(f.Badge,{variant:"outline",className:"text-muted-foreground",children:"Replaced"})}),(0,b.jsx)(D.TableCell,{className:"text-right",children:(0,b.jsxs)(e.Button,{variant:"outline",size:"sm",className:"gap-2",children:[(0,b.jsx)(ae.Download,{className:"h-4 w-4"}),"Download"]})})]},a.id)})})]})]})})}function au({dealId:a,documents:f,onRefresh:g}){let[h,i]=(0,c.useState)(0),[j,k]=(0,c.useState)(null),[l,m]=(0,c.useState)(null),[o,p]=(0,c.useState)(null),[r,s]=(0,c.useState)(null),t=async b=>{s(b);try{let c=await fetch(`/api/deals/${a}/documents/${b}/download`);if(!c.ok)throw Error("Failed to generate download link");let d=await c.json();window.open(d.download_url,"_blank"),af.toast.success("Document download started")}catch(a){console.error("Download error:",a),af.toast.error("Failed to download document")}finally{s(null)}},u=async b=>{if(confirm("Are you sure you want to delete this document? This action cannot be undone.")){p(b);try{if(!(await fetch(`/api/deals/${a}/documents/${b}`,{method:"DELETE"})).ok)throw Error("Failed to delete document");af.toast.success("Document deleted successfully"),g&&g()}catch(a){console.error("Delete error:",a),af.toast.error("Failed to delete document")}finally{p(null)}}};return(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)(d.Card,{className:"border-border bg-muted/50",children:[(0,b.jsx)(d.CardHeader,{children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsxs)(d.CardTitle,{className:"text-foreground flex items-center gap-2",children:[(0,b.jsx)(n.FileText,{className:"h-5 w-5"}),"Deal Documents"]}),(0,b.jsx)(d.CardDescription,{children:"Documents scoped to this deal only"})]}),(0,b.jsx)(aq,{dealId:a,onUploadComplete:()=>{i(a=>a+1),g&&g()},trigger:(0,b.jsxs)(e.Button,{className:"gap-2",children:[(0,b.jsx)(z.Plus,{className:"h-4 w-4"}),"Upload Document"]})})]})}),(0,b.jsx)(d.CardContent,{children:0===f.length?(0,b.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:'No documents uploaded yet. Click "Upload Document" to add files.'}):(0,b.jsx)("div",{className:"space-y-2",children:f.map(a=>(0,b.jsxs)("div",{className:"flex items-center justify-between py-3 px-4 rounded-lg border border-border bg-muted/50 hover:bg-muted transition-colors",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3 flex-1",children:[(0,b.jsx)(n.FileText,{className:"h-5 w-5 text-muted-foreground"}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("div",{className:"flex items-center gap-2",children:(0,b.jsx)("span",{className:"font-medium text-foreground",children:a.file_key.split("/").pop()})}),(0,b.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Uploaded ",new Date(a.created_at).toLocaleDateString(),a.created_by_profile&&` by ${a.created_by_profile.display_name}`]})]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsxs)(e.Button,{variant:"outline",size:"sm",className:"gap-2",onClick:()=>k(a),children:[(0,b.jsx)(q.Edit,{className:"h-4 w-4"}),"Edit"]}),(0,b.jsxs)(e.Button,{variant:"outline",size:"sm",className:"gap-2",onClick:()=>m(a.id),children:[(0,b.jsx)(ai.History,{className:"h-4 w-4"}),"Versions"]}),(0,b.jsxs)(e.Button,{variant:"outline",size:"sm",className:"gap-2",onClick:()=>t(a.id),disabled:r===a.id,children:[(0,b.jsx)(ae.Download,{className:"h-4 w-4"}),r===a.id?"Downloading...":"Download"]}),(0,b.jsx)(e.Button,{variant:"outline",size:"sm",className:"text-red-700 dark:text-red-200",onClick:()=>u(a.id),disabled:o===a.id,children:(0,b.jsx)(M.Trash2,{className:"h-4 w-4"})})]})]},a.id))})})]}),j&&(0,b.jsx)(as,{dealId:a,documentId:j.id,open:!!j,onOpenChange:a=>!a&&k(null),onSaved:()=>{k(null),g&&g()},initialData:{file_name:j.file_name,folder:j.folder,visible_to_investors:j.visible_to_investors,tags:j.tags,document_notes:j.document_notes,document_expires_at:j.document_expires_at}}),l&&(0,b.jsx)(at,{dealId:a,documentId:l,open:!!l,onOpenChange:a=>!a&&m(null)})]})}var av=a.i(211374),aw=a.i(537412),ax=a.i(787957),ay=a.i(980137),az=a.i(686331),aA=a.i(166457),aB=a.i(908513),aC=a.i(380640);let aD={conversion:aB.RefreshCw,audit:q.Edit,membership:L.Users,interest:ay.Heart,access:az.Lock,subscription:n.FileText},aE={conversion:"text-purple-500",audit:"text-muted-foreground",membership:"text-blue-500",interest:"text-pink-500",access:"text-orange-500",subscription:"text-green-500"},aF={conversion:"bg-purple-500/10",audit:"bg-muted",membership:"bg-blue-500/10",interest:"bg-pink-500/10",access:"bg-orange-500/10",subscription:"bg-green-500/10"},aG={conversion:"Conversion",audit:"Audit",membership:"Membership",interest:"Interest",access:"Access",subscription:"Subscription"};function aH({dealId:a}){let[g,h]=(0,c.useState)([]),[i,j]=(0,c.useState)(!0),[k,m]=(0,c.useState)(null),[n,o]=(0,c.useState)("all"),[p,q]=(0,c.useState)(!1),[r,s]=(0,c.useState)(0),t=async(b=!1)=>{try{j(!0);let c=b?r:0,d="all"!==n?`&category=${n}`:"",e=await fetch(`/api/deals/${a}/activity?limit=50&offset=${c}${d}`);if(!e.ok)throw Error("Failed to fetch activity timeline");let f=await e.json();b?h(a=>[...a,...f.events||[]]):h(f.events||[]),q(f.hasMore||!1),s(c+(f.events?.length||0)),m(null)}catch(a){console.error("Failed to fetch activities:",a),m("Failed to load activity timeline"),h([])}finally{j(!1)}};return((0,c.useEffect)(()=>{s(0),t(!1)},[a,n]),i&&0===g.length)?(0,b.jsxs)(d.Card,{className:"border-border bg-muted/50",children:[(0,b.jsxs)(d.CardHeader,{children:[(0,b.jsx)(av.Skeleton,{className:"h-6 w-32"}),(0,b.jsx)(av.Skeleton,{className:"h-4 w-48"})]}),(0,b.jsx)(d.CardContent,{children:(0,b.jsx)("div",{className:"space-y-4",children:[1,2,3,4,5].map(a=>(0,b.jsxs)("div",{className:"flex gap-4",children:[(0,b.jsx)(av.Skeleton,{className:"h-10 w-10 rounded-full"}),(0,b.jsxs)("div",{className:"flex-1 space-y-2",children:[(0,b.jsx)(av.Skeleton,{className:"h-4 w-3/4"}),(0,b.jsx)(av.Skeleton,{className:"h-3 w-1/2"})]})]},a))})})]}):k?(0,b.jsx)(d.Card,{className:"border-border bg-muted/50",children:(0,b.jsx)(d.CardContent,{className:"pt-6",children:(0,b.jsxs)("div",{className:"flex items-center gap-2 text-destructive",children:[(0,b.jsx)(S.AlertCircle,{className:"h-4 w-4"}),(0,b.jsx)("p",{children:k})]})})}):(0,b.jsxs)(d.Card,{className:"border-border bg-muted/50",children:[(0,b.jsx)(d.CardHeader,{children:(0,b.jsxs)("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsxs)(d.CardTitle,{className:"text-foreground flex items-center gap-2",children:[(0,b.jsx)(ax.Activity,{className:"h-5 w-5"}),"Activity Log"]}),(0,b.jsx)(d.CardDescription,{children:"Complete audit trail of all deal actions"})]}),(0,b.jsxs)(l.Select,{value:n,onValueChange:o,children:[(0,b.jsxs)(l.SelectTrigger,{className:"w-[180px]",children:[(0,b.jsx)(aA.Filter,{className:"h-4 w-4 mr-2"}),(0,b.jsx)(l.SelectValue,{})]}),(0,b.jsxs)(l.SelectContent,{children:[(0,b.jsx)(l.SelectItem,{value:"all",children:"All Activities"}),(0,b.jsx)(l.SelectItem,{value:"conversion",children:"Conversions"}),(0,b.jsx)(l.SelectItem,{value:"audit",children:"Audit Trail"}),(0,b.jsx)(l.SelectItem,{value:"membership",children:"Membership"}),(0,b.jsx)(l.SelectItem,{value:"interest",children:"Interest"}),(0,b.jsx)(l.SelectItem,{value:"access",children:"Access Control"}),(0,b.jsx)(l.SelectItem,{value:"subscription",children:"Subscriptions"})]})]})]})}),(0,b.jsx)(d.CardContent,{children:(0,b.jsx)(aw.ScrollArea,{style:{height:"600px"},className:"pr-4",children:0===g.length?(0,b.jsxs)("div",{className:"text-center py-12",children:[(0,b.jsx)(ac.Clock,{className:"h-12 w-12 mx-auto text-muted-foreground mb-4"}),(0,b.jsx)("p",{className:"text-muted-foreground text-lg font-medium",children:"No activities found"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground mt-2",children:"all"===n?"There are no recorded activities for this deal in the last 90 days.":`No ${aG[n]} activities found.`})]}):(0,b.jsxs)("div",{className:"space-y-4",children:[g.map((a,c)=>{let d=aD[a.category],e=aE[a.category],h=aF[a.category],i=c===g.length-1&&!p;return(0,b.jsxs)("div",{className:"relative",children:[!i&&(0,b.jsx)("div",{className:"absolute left-5 top-12 bottom-0 w-px bg-border"}),(0,b.jsxs)("div",{className:"flex gap-4",children:[(0,b.jsx)("div",{className:`flex-shrink-0 w-10 h-10 rounded-full ${h} flex items-center justify-center relative z-10`,children:(0,b.jsx)(d,{className:`h-5 w-5 ${e}`})}),(0,b.jsx)("div",{className:"flex-1 pb-8",children:(0,b.jsxs)("div",{className:"flex items-start justify-between gap-4",children:[(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-1 flex-wrap",children:[(0,b.jsx)("p",{className:"font-semibold text-sm text-foreground",children:a.type}),(0,b.jsx)(f.Badge,{variant:"outline",className:"text-xs",children:aG[a.category]})]}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground mb-2",children:a.description}),a.details&&Object.keys(a.details).length>0&&(0,b.jsx)("div",{className:"flex flex-wrap gap-2 mb-2",children:Object.entries(a.details).filter(([a])=>!["id","userId","dealId"].includes(a)).map(([a,c])=>{let d=String(c);if("boolean"==typeof c)d=c?"Yes":"No";else if(null==c)return null;return(0,b.jsxs)("div",{className:"text-xs bg-muted px-2 py-1 rounded",children:[(0,b.jsxs)("span",{className:"font-medium",children:[a.replace(/_/g," "),":"]})," ",(0,b.jsx)("span",{children:d})]},a)})}),(0,b.jsxs)("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[a.actor&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("span",{children:["by ",a.actor.name,a.actor.role&&` (${a.actor.role})`]}),(0,b.jsx)("span",{children:"•"})]}),(0,b.jsx)("span",{title:(0,C.format)(new Date(a.timestamp),"PPpp"),children:(0,aC.formatDistanceToNow)(new Date(a.timestamp),{addSuffix:!0})})]})]}),a.details?.status==="success"||a.details?.status==="approved"?(0,b.jsx)(ab.CheckCircle,{className:"h-4 w-4 text-green-600 flex-shrink-0"}):null,a.details?.status==="error"||a.details?.status==="rejected"?(0,b.jsx)(S.AlertCircle,{className:"h-4 w-4 text-red-600 flex-shrink-0"}):null]})})]})]},a.id)}),p&&(0,b.jsx)("div",{className:"flex justify-center pt-4",children:(0,b.jsx)(e.Button,{variant:"outline",onClick:()=>{t(!0)},disabled:i,children:i?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(aB.RefreshCw,{className:"h-4 w-4 mr-2 animate-spin"}),"Loading..."]}):"Load More"})})]})})})]})}var aI=a.i(877028),aJ=a.i(919014),aK=a.i(366511),aL=a.i(470664),aM=a.i(306226),aN=a.i(675167);let aO=(0,a.i(95799).default)("send-horizontal",[["path",{d:"M3.714 3.048a.498.498 0 0 0-.683.627l2.843 7.627a2 2 0 0 1 0 1.396l-2.842 7.627a.498.498 0 0 0 .682.627l18-8.5a.5.5 0 0 0 0-.904z",key:"117uat"}],["path",{d:"M6 12h16",key:"s4cdu5"}]]);var aP=a.i(518173),aQ=a.i(520783);let aR={draft:"bg-amber-500/20 text-amber-100",published:"bg-emerald-500/20 text-emerald-100",archived:"bg-muted text-muted-foreground"},aS={draft:"bg-muted text-muted-foreground border-border",sent:"bg-blue-500/20 text-blue-300 border-blue-500/30",pending_signature:"bg-amber-500/20 text-amber-300 border-amber-500/30",accepted:"bg-emerald-500/20 text-emerald-300 border-emerald-500/30",rejected:"bg-red-500/20 text-red-300 border-red-500/30"},aT={draft:"Draft",sent:"Sent",pending_signature:"Pending",accepted:"Accepted",rejected:"Rejected"},aU={term_sheet_date:"",transaction_type:"",opportunity_summary:"",issuer:"",vehicle:"",exclusive_arranger:"",purchaser:"",seller:"",structure:"",allocation_up_to:"",price_per_share_text:"",price_per_share:"",cost_per_share:"",minimum_ticket:"",subscription_fee_percent:"",management_fee_percent:"",management_fee_clause:"",carried_interest_percent:"",performance_fee_clause:"",legal_counsel:"",interest_confirmation_deadline:"",validity_date:"",completion_date:"",completion_date_text:""};function aV(a){if(!a)return null;let b=Number(a);return Number.isFinite(b)?b:null}function aW({dealId:a,termSheets:g}){let l,m,n,o,[p,q]=(0,c.useState)(g??[]),[s,t]=(0,c.useState)(!1),[u,v]=(0,c.useState)("create"),[w,y]=(0,c.useState)(null),[A,B]=(0,c.useState)(aU),[D,E]=(0,c.useState)(!1),[G,H]=(0,c.useState)(null),[I,J]=(0,c.useState)(null),[K,M]=(0,c.useState)(null),N=(0,c.useRef)({}),[P,Q]=(0,c.useState)([]),[R,S]=(0,c.useState)(!1),[T,U]=(0,c.useState)(!1),[V,W]=(0,c.useState)(),[X,Y]=(0,c.useState)(!1),[Z,$]=(0,c.useState)(!1),[_,aa]=(0,c.useState)(null),[ab,ac]=(0,c.useState)(null),[ad,ae]=(0,c.useState)(null),[ah,ai]=(0,c.useState)(null),[aj,ak]=(0,c.useState)(null),[al,an]=(0,c.useState)(null),{isCEO:ao,isStaff:ap}=(0,aQ.usePersona)();(0,c.useEffect)(()=>{q(g??[])},[g]);let aq=(0,c.useCallback)(async()=>{S(!0);try{let b=await fetch(`/api/deals/${a}/fee-plans`);if(!b.ok)return void console.error("Failed to fetch fee plans");let c=await b.json();Q(c.feePlans||[])}catch(a){console.error("Error fetching fee plans:",a)}finally{S(!1)}},[a]);(0,c.useEffect)(()=>{aq()},[aq]);let ar=(0,c.useMemo)(()=>{let a={};for(let b of P){let c=b.term_sheet_id||"unlinked";a[c]||(a[c]=[]),a[c].push(b)}return a},[P]),as=a=>a.introducer?{type:"Introducer",name:a.introducer.company_name||a.introducer.name,icon:L.Users}:a.partner?{type:"Partner",name:a.partner.company_name||a.partner.name,icon:x.Building2}:a.commercial_partner?{type:"Commercial Partner",name:a.commercial_partner.company_name||a.commercial_partner.name,icon:O.Briefcase}:null,at=a=>{W(a),U(!0)},au=()=>{U(!1),W(void 0)},av=async b=>{let c=p.find(a=>a.id===b),d=c?.term_sheet_attachment_key?.split("/").pop()||"Term Sheet.pdf";ac(b),ai({id:b,file_name:d,name:d,mime_type:"application/pdf",type:"term_sheet"}),Y(!0),$(!0),ae(null),aa(null);try{let c=await fetch(`/api/deals/${a}/fee-structures/${b}/attachment`);if(!c.ok){let a=await c.json();throw Error(a.error||"Failed to load document")}let d=await c.json();aa(d.url)}catch(a){ae(a instanceof Error?a.message:"Failed to load document")}finally{$(!1)}},aw=async b=>{ak(b),H(null);try{let c=await fetch(`/api/deals/${a}/fee-structures/${b}/generate`,{method:"POST"}),d=await c.json();if(!c.ok)throw Error(d.error||"Failed to generate term sheet");await aD()}catch(a){H(a instanceof Error?a.message:"Failed to generate term sheet")}finally{ak(null)}},ax=async b=>{an(b),H(null);try{let c=await fetch(`/api/deals/${a}/fee-structures/${b}/request-close`,{method:"POST"}),d=await c.json();if(!c.ok)throw Error(d.error||"Failed to request close approval");af.toast.success("Close approval created",{description:"The CEO will review this request in the Approvals queue."}),await aD()}catch(b){let a=b instanceof Error?b.message:"Failed to request close approval";H(a),af.toast.error("Request failed",{description:a})}finally{an(null)}},ay=(0,c.useMemo)(()=>[...p].sort((a,b)=>(b.version??0)-(a.version??0)),[p]),az=(0,c.useMemo)(()=>ay.filter(a=>"published"===a.status),[ay]);az[0];let aA=async(b,c)=>{J(null),M(b);try{let d=new FormData;d.append("file",c);let e=await fetch(`/api/deals/${a}/fee-structures/${b}/attachment`,{method:"POST",body:d}),f=await e.json().catch(()=>({}));if(!e.ok)throw Error(f?.error||"Failed to upload attachment");let g=p.map(a=>a.id===b?{...a,term_sheet_attachment_key:f.term_sheet_attachment_key}:a);q(g),w===b&&B(a=>({...a,term_sheet_attachment_key:f.term_sheet_attachment_key??""}))}catch(a){console.error("Term sheet attachment upload failed",a),J(a instanceof Error?a.message:"Failed to upload attachment")}finally{let a=N.current[b];a&&(a.value=""),M(null)}},aB=(a,b)=>{var c;v(a),y("edit"===a?b?.id??null:null),B((c="create"===a?void 0:b)?{term_sheet_date:c.term_sheet_date?c.term_sheet_date.slice(0,10):"",transaction_type:c.transaction_type??"",opportunity_summary:c.opportunity_summary??"",issuer:c.issuer??"",vehicle:c.vehicle??"",exclusive_arranger:c.exclusive_arranger??"",purchaser:c.purchaser??"",seller:c.seller??"",structure:c.structure??"",allocation_up_to:c.allocation_up_to??"",price_per_share_text:c.price_per_share_text??"",price_per_share:null!=c.price_per_share?String(c.price_per_share):"",cost_per_share:null!=c.cost_per_share?String(c.cost_per_share):"",minimum_ticket:c.minimum_ticket??"",subscription_fee_percent:c.subscription_fee_percent??"",management_fee_percent:c.management_fee_percent??"",management_fee_clause:c.management_fee_clause??"",carried_interest_percent:c.carried_interest_percent??"",performance_fee_clause:c.performance_fee_clause??"",legal_counsel:c.legal_counsel??"",interest_confirmation_deadline:c.interest_confirmation_deadline?c.interest_confirmation_deadline.slice(0,16):"",validity_date:c.validity_date?c.validity_date.slice(0,16):"",completion_date:c.completion_date?c.completion_date.slice(0,10):"",completion_date_text:c.completion_date_text??""}:aU),H(null),t(!0)},aC=()=>{t(!1),y(null),B(aU)},aD=async()=>{let b=await fetch(`/api/deals/${a}/fee-structures`);b.ok?q((await b.json()).term_sheets??[]):H("Failed to refresh term sheets. Please reload the page.")},aE=async()=>{E(!0),H(null);try{let b,c={term_sheet_date:A.term_sheet_date||null,transaction_type:A.transaction_type||null,opportunity_summary:A.opportunity_summary||null,issuer:A.issuer||null,vehicle:A.vehicle||null,exclusive_arranger:A.exclusive_arranger||null,purchaser:A.purchaser||null,seller:A.seller||null,structure:A.structure||null,allocation_up_to:aV(A.allocation_up_to),price_per_share_text:A.price_per_share_text||null,price_per_share:aV(A.price_per_share),cost_per_share:aV(A.cost_per_share),minimum_ticket:aV(A.minimum_ticket),subscription_fee_percent:aV(A.subscription_fee_percent),management_fee_percent:aV(A.management_fee_percent),management_fee_clause:A.management_fee_clause||null,carried_interest_percent:aV(A.carried_interest_percent),performance_fee_clause:A.performance_fee_clause||null,legal_counsel:A.legal_counsel||null,interest_confirmation_deadline:A.interest_confirmation_deadline||null,validity_date:A.validity_date||null,completion_date:A.completion_date||null,completion_date_text:A.completion_date_text||null};if("create"===u||"clone"===u)b=await fetch(`/api/deals/${a}/fee-structures`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(c)});else{if(!w)throw Error("Missing term sheet ID");b=await fetch(`/api/deals/${a}/fee-structures`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({structure_id:w,updates:c})})}if(!b.ok){let a=await b.text();throw Error(a||"Failed to save term sheet")}await aD(),aC()}catch(a){H(a instanceof Error?a.message:"Unexpected error saving term sheet")}finally{E(!1)}},aF=async(b,c)=>{E(!0),H(null);try{let d=await fetch(`/api/deals/${a}/fee-structures`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({structure_id:b.id,updates:{status:c}})});if(!d.ok){let a=await d.text();throw Error(a||"Failed to update status")}await aD()}catch(a){H(a instanceof Error?a.message:"Unexpected error updating status")}finally{E(!1)}};return(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{className:"text-lg font-semibold text-foreground",children:"Term Sheet Versions"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Draft, publish, and archive the structured economics that power the investor experience."})]}),(0,b.jsxs)(e.Button,{onClick:()=>aB("create"),disabled:D,className:"gap-2",children:[(0,b.jsx)(z.Plus,{className:"h-4 w-4"}),"New Term Sheet"]})]}),G&&(0,b.jsx)(d.Card,{className:"border border-destructive/30 bg-destructive/10",children:(0,b.jsx)(d.CardContent,{className:"text-sm text-destructive p-3",children:G})}),I&&(0,b.jsx)(d.Card,{className:"border border-amber-400/30 bg-amber-500/10",children:(0,b.jsx)(d.CardContent,{className:"text-sm text-amber-800 p-3",children:I})}),az.length>0&&(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("h3",{className:"text-sm font-semibold text-emerald-400 uppercase tracking-wide",children:["Published Term Sheets (",az.length,")"]}),(0,b.jsx)("div",{className:"grid grid-cols-1 xl:grid-cols-2 gap-4",children:az.map(a=>(0,b.jsxs)(d.Card,{className:"border border-emerald-400/30 bg-emerald-500/10",children:[(0,b.jsxs)(d.CardHeader,{className:"flex flex-row items-start justify-between space-y-0",children:[(0,b.jsxs)("div",{children:[(0,b.jsxs)(d.CardTitle,{className:"text-foreground",children:["Version ",a.version]}),(0,b.jsxs)(d.CardDescription,{children:["Published"," ",a.published_at?(0,C.format)(new Date(a.published_at),"dd MMM yyyy"):"—",a.term_sheet_date&&(0,b.jsxs)("span",{className:"ml-2",children:["• Dated: ",(0,C.format)(new Date(a.term_sheet_date),"dd MMM yyyy")]}),a.vehicle&&(0,b.jsxs)("span",{className:"ml-2",children:["• ",a.vehicle]})]})]}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsxs)(e.Button,{variant:"outline",size:"sm",className:"gap-2",onClick:()=>aB("edit",a),disabled:D,children:[(0,b.jsx)(aM.Pencil,{className:"h-4 w-4"}),"Edit"]}),(0,b.jsxs)(e.Button,{variant:"outline",size:"sm",className:"gap-2",onClick:()=>aB("clone",a),disabled:D,children:[(0,b.jsx)(aJ.Copy,{className:"h-4 w-4"}),"Clone"]}),(0,b.jsx)(e.Button,{variant:"outline",size:"sm",className:"gap-2",onClick:()=>N.current[a.id]?.click(),disabled:K===a.id,children:K===a.id?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(r.Loader2,{className:"h-4 w-4 animate-spin"}),"Uploading..."]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(am.Upload,{className:"h-4 w-4"}),"Upload Attachment"]})}),(0,b.jsx)(e.Button,{variant:"outline",size:"sm",className:"gap-2 border-blue-500/30 hover:bg-blue-500/10",onClick:()=>aw(a.id),disabled:aj===a.id,children:aj===a.id?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(r.Loader2,{className:"h-4 w-4 animate-spin"}),"Generating..."]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(aN.FileCheck,{className:"h-4 w-4"}),"Generate PDF"]})}),(0,b.jsx)(e.Button,{variant:"outline",size:"sm",className:"gap-2 border-amber-500/30 hover:bg-amber-500/10",onClick:()=>ax(a.id),disabled:al===a.id||!!a.closed_processed_at,title:a.closed_processed_at?"Already processed":"Request CEO approval to close this termsheet",children:al===a.id?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(r.Loader2,{className:"h-4 w-4 animate-spin"}),"Requesting..."]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(aO,{className:"h-4 w-4"}),"Request Close"]})})]})]}),(0,b.jsxs)(d.CardContent,{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("div",{className:"text-xs text-emerald-200",children:a.term_sheet_attachment_key?"Attachment available for investors to download.":"No attachment uploaded yet."}),a.term_sheet_attachment_key&&(0,b.jsxs)(e.Button,{variant:"outline",size:"sm",className:"gap-2 border-emerald-500/30 hover:bg-emerald-500/10",onClick:()=>av(a.id),children:[(0,b.jsx)(F.Eye,{className:"h-4 w-4"}),"Preview"]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h4",{className:"text-xs font-semibold text-emerald-300 uppercase tracking-wide mb-3",children:"Transaction Details"}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"text-muted-foreground block text-xs",children:"Transaction Type"}),(0,b.jsx)("span",{className:"text-foreground font-medium",children:a.transaction_type||"—"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"text-muted-foreground block text-xs",children:"Structure"}),(0,b.jsx)("span",{className:"text-foreground font-medium",children:a.structure||"—"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"text-muted-foreground block text-xs",children:"Issuer"}),(0,b.jsx)("span",{className:"text-foreground font-medium",children:a.issuer||"—"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"text-muted-foreground block text-xs",children:"Vehicle"}),(0,b.jsx)("span",{className:"text-foreground font-medium",children:a.vehicle||"—"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"text-muted-foreground block text-xs",children:"Exclusive Arranger"}),(0,b.jsx)("span",{className:"text-foreground font-medium",children:a.exclusive_arranger||"—"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"text-muted-foreground block text-xs",children:"Purchaser"}),(0,b.jsx)("span",{className:"text-foreground font-medium",children:a.purchaser||"—"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"text-muted-foreground block text-xs",children:"Seller"}),(0,b.jsx)("span",{className:"text-foreground font-medium",children:a.seller||"—"})]})]})]}),(0,b.jsx)(aI.Separator,{className:"bg-emerald-400/20"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h4",{className:"text-xs font-semibold text-emerald-300 uppercase tracking-wide mb-3",children:"Investment Terms"}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"text-muted-foreground block text-xs",children:"Allocation Up To"}),(0,b.jsx)("span",{className:"text-foreground font-medium",children:a.allocation_up_to?a.allocation_up_to.toLocaleString():"—"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"text-muted-foreground block text-xs",children:"Price Per Share"}),(0,b.jsx)("span",{className:"text-foreground font-medium",children:a.price_per_share_text||"—"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"text-muted-foreground block text-xs",children:"Minimum Ticket"}),(0,b.jsx)("span",{className:"text-foreground font-medium",children:a.minimum_ticket?a.minimum_ticket.toLocaleString():"—"})]})]})]}),(0,b.jsx)(aI.Separator,{className:"bg-emerald-400/20"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h4",{className:"text-xs font-semibold text-emerald-300 uppercase tracking-wide mb-3",children:"Fee Structure"}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 text-sm",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"text-muted-foreground block text-xs",children:"Subscription Fee"}),(0,b.jsx)("span",{className:"text-foreground font-medium",children:null!=a.subscription_fee_percent?`${a.subscription_fee_percent}%`:"—"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"text-muted-foreground block text-xs",children:"Management Fee"}),(0,b.jsx)("span",{className:"text-foreground font-medium",children:null!=a.management_fee_percent?`${a.management_fee_percent}% p.a.`:"—"}),a.management_fee_clause&&(0,b.jsx)("span",{className:"text-muted-foreground block text-xs mt-1 italic",children:a.management_fee_clause})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"text-muted-foreground block text-xs",children:"Carried Interest"}),(0,b.jsx)("span",{className:"text-foreground font-medium",children:null!=a.carried_interest_percent?`${a.carried_interest_percent}%`:"—"}),a.performance_fee_clause&&(0,b.jsx)("span",{className:"text-muted-foreground block text-xs mt-1 italic",children:a.performance_fee_clause})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"text-muted-foreground block text-xs",children:"Legal Counsel"}),(0,b.jsx)("span",{className:"text-foreground font-medium",children:a.legal_counsel||"—"})]})]})]}),(0,b.jsx)(aI.Separator,{className:"bg-emerald-400/20"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h4",{className:"text-xs font-semibold text-emerald-300 uppercase tracking-wide mb-3",children:"Timeline & Deadlines"}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"text-muted-foreground block text-xs",children:"Interest Deadline"}),(0,b.jsx)("span",{className:"text-foreground font-medium",children:a.interest_confirmation_deadline?(0,C.format)(new Date(a.interest_confirmation_deadline),"dd MMM yyyy HH:mm"):"—"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"text-muted-foreground block text-xs",children:"Completion Date"}),(0,b.jsx)("span",{className:"text-foreground font-medium",children:a.completion_date?(0,C.format)(new Date(a.completion_date),"dd MMM yyyy"):a.completion_date_text||"—"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"text-muted-foreground block text-xs",children:"Validity Date"}),(0,b.jsx)("span",{className:"text-foreground font-medium",children:a.validity_date?(0,C.format)(new Date(a.validity_date),"dd MMM yyyy HH:mm"):"—"})]})]})]}),a.term_sheet_html&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(aI.Separator,{className:"bg-emerald-400/20"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h4",{className:"text-xs font-semibold text-emerald-300 uppercase tracking-wide mb-3",children:"Opportunity Summary"}),(0,b.jsx)("div",{className:"space-y-2 text-sm text-emerald-50/90 leading-relaxed",dangerouslySetInnerHTML:{__html:a.term_sheet_html}})]})]}),(0,b.jsx)(aI.Separator,{className:"bg-emerald-400/20"}),(0,b.jsxs)("div",{children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,b.jsxs)("h4",{className:"text-xs font-semibold text-emerald-300 uppercase tracking-wide flex items-center gap-2",children:[(0,b.jsx)(aN.FileCheck,{className:"h-4 w-4"}),"Linked Fee Plans"]}),(0,b.jsxs)(e.Button,{variant:"outline",size:"sm",className:"gap-1 text-xs h-7 border-emerald-500/30 hover:bg-emerald-500/10",onClick:()=>at(a.id),children:[(0,b.jsx)(z.Plus,{className:"h-3 w-3"}),"Create Fee Plan"]})]}),R?(0,b.jsxs)("div",{className:"flex items-center gap-2 text-emerald-200/60 text-sm py-2",children:[(0,b.jsx)(r.Loader2,{className:"h-4 w-4 animate-spin"}),"Loading fee plans..."]}):0===(ar[a.id]||[]).length?(0,b.jsx)("div",{className:"text-sm text-emerald-200/60 py-2",children:"No fee plans linked to this term sheet yet. Create one to define commission terms for introducers or partners."}):(0,b.jsx)("div",{className:"space-y-2",children:(ar[a.id]||[]).map(a=>{let c=as(a);return(0,b.jsxs)("div",{className:"flex items-center justify-between p-2 rounded-md bg-muted/50 border border-emerald-500/10",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[c&&(0,b.jsxs)("div",{className:"flex items-center gap-1 text-xs text-emerald-300/80",children:[(0,b.jsx)(c.icon,{className:"h-3.5 w-3.5"}),(0,b.jsxs)("span",{children:[c.type,":"]}),(0,b.jsx)("span",{className:"font-medium text-emerald-100",children:c.name})]}),(0,b.jsx)("span",{className:"text-sm text-emerald-100 font-medium",children:a.name})]}),(0,b.jsx)(f.Badge,{className:`text-xs ${aS[a.status]||aS.draft}`,children:aT[a.status]||a.status})]},a.id)})})]})]})]},a.id))})]}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("h3",{className:"text-sm font-semibold text-muted-foreground uppercase tracking-wide",children:["Other Versions (",ay.filter(a=>"published"!==a.status).length,")"]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 xl:grid-cols-2 gap-4",children:[ay.filter(a=>"published"!==a.status).map(a=>(0,b.jsxs)(d.Card,{className:"border-border bg-muted/50",children:[(0,b.jsxs)(d.CardHeader,{className:"flex items-start justify-between space-y-0",children:[(0,b.jsxs)("div",{children:[(0,b.jsxs)(d.CardTitle,{className:"text-foreground text-lg",children:["Version ",a.version]}),(0,b.jsxs)(d.CardDescription,{children:["Created ",(0,C.format)(new Date(a.created_at),"dd MMM yyyy"),a.term_sheet_date&&` • Term Sheet Date: ${(0,C.format)(new Date(a.term_sheet_date),"dd MMM yyyy")}`]})]}),(0,b.jsx)(f.Badge,{className:aR[a.status]??aR.draft,children:a.status.toUpperCase()})]}),(0,b.jsxs)(d.CardContent,{className:"space-y-4 text-sm",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("div",{className:"text-xs text-muted-foreground",children:a.term_sheet_attachment_key?"Attachment uploaded.":"No attachment uploaded yet."}),a.term_sheet_attachment_key&&(0,b.jsxs)(e.Button,{variant:"ghost",size:"sm",className:"gap-1 h-7 text-xs",onClick:()=>av(a.id),children:[(0,b.jsx)(F.Eye,{className:"h-3 w-3"}),"Preview"]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("h4",{className:"text-xs font-semibold text-muted-foreground uppercase tracking-wide",children:"Transaction Details"}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"text-muted-foreground block text-xs",children:"Transaction Type"}),(0,b.jsx)("span",{className:"text-foreground font-medium",children:a.transaction_type||"—"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"text-muted-foreground block text-xs",children:"Structure"}),(0,b.jsx)("span",{className:"text-foreground font-medium",children:a.structure||"—"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"text-muted-foreground block text-xs",children:"Issuer"}),(0,b.jsx)("span",{className:"text-foreground font-medium",children:a.issuer||"—"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"text-muted-foreground block text-xs",children:"Vehicle"}),(0,b.jsx)("span",{className:"text-foreground font-medium",children:a.vehicle||"—"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"text-muted-foreground block text-xs",children:"Arranger"}),(0,b.jsx)("span",{className:"text-foreground font-medium",children:a.exclusive_arranger||"—"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"text-muted-foreground block text-xs",children:"Purchaser"}),(0,b.jsx)("span",{className:"text-foreground font-medium",children:a.purchaser||"—"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"text-muted-foreground block text-xs",children:"Seller"}),(0,b.jsx)("span",{className:"text-foreground font-medium",children:a.seller||"—"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"text-muted-foreground block text-xs",children:"Legal Counsel"}),(0,b.jsx)("span",{className:"text-foreground font-medium",children:a.legal_counsel||"—"})]})]})]}),(0,b.jsx)(aI.Separator,{}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("h4",{className:"text-xs font-semibold text-muted-foreground uppercase tracking-wide",children:"Investment Terms"}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"text-muted-foreground block text-xs",children:"Allocation"}),(0,b.jsx)("span",{className:"text-foreground font-medium",children:a.allocation_up_to?a.allocation_up_to.toLocaleString():"—"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"text-muted-foreground block text-xs",children:"Price Per Share"}),(0,b.jsx)("span",{className:"text-foreground font-medium",children:a.price_per_share_text||"—"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"text-muted-foreground block text-xs",children:"Min Ticket"}),(0,b.jsx)("span",{className:"text-foreground font-medium",children:a.minimum_ticket?a.minimum_ticket.toLocaleString():"—"})]})]})]}),(0,b.jsx)(aI.Separator,{}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("h4",{className:"text-xs font-semibold text-muted-foreground uppercase tracking-wide",children:"Fee Structure"}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"text-muted-foreground block text-xs",children:"Subscription Fee"}),(0,b.jsx)("span",{className:"text-foreground font-medium",children:null!=a.subscription_fee_percent?`${a.subscription_fee_percent}%`:"—"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"text-muted-foreground block text-xs",children:"Management Fee"}),(0,b.jsx)("span",{className:"text-foreground font-medium",children:null!=a.management_fee_percent?`${a.management_fee_percent}% p.a.`:"—"}),a.management_fee_clause&&(0,b.jsx)("span",{className:"text-muted-foreground block text-xs italic mt-1",children:a.management_fee_clause})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"text-muted-foreground block text-xs",children:"Carried Interest"}),(0,b.jsx)("span",{className:"text-foreground font-medium",children:null!=a.carried_interest_percent?`${a.carried_interest_percent}%`:"—"}),a.performance_fee_clause&&(0,b.jsx)("span",{className:"text-muted-foreground block text-xs italic mt-1",children:a.performance_fee_clause})]})]})]}),(0,b.jsx)(aI.Separator,{}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("h4",{className:"text-xs font-semibold text-muted-foreground uppercase tracking-wide",children:"Timeline"}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"text-muted-foreground block text-xs",children:"Interest Deadline"}),(0,b.jsx)("span",{className:"text-foreground font-medium",children:a.interest_confirmation_deadline?(0,C.format)(new Date(a.interest_confirmation_deadline),"dd MMM yyyy HH:mm"):"—"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"text-muted-foreground block text-xs",children:"Validity"}),(0,b.jsx)("span",{className:"text-foreground font-medium",children:a.validity_date?(0,C.format)(new Date(a.validity_date),"dd MMM yyyy HH:mm"):"—"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"text-muted-foreground block text-xs",children:"Completion Date"}),(0,b.jsx)("span",{className:"text-foreground font-medium",children:a.completion_date?(0,C.format)(new Date(a.completion_date),"dd MMM yyyy"):a.completion_date_text||"—"})]})]})]}),a.term_sheet_html&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,b.jsx)("h4",{className:"text-xs font-semibold text-muted-foreground uppercase tracking-wide",children:"Opportunity Summary"}),(0,b.jsx)("div",{className:"space-y-2 text-sm text-foreground/90 leading-relaxed",dangerouslySetInnerHTML:{__html:a.term_sheet_html}})]}),(0,b.jsx)(aI.Separator,{})]}),(0,b.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,b.jsx)("input",{type:"file",accept:".pdf,.doc,.docx,application/pdf,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document",className:"hidden",ref:b=>{N.current[a.id]=b},onChange:b=>{let c=b.target.files?.[0];c&&aA(a.id,c)}}),(0,b.jsxs)(e.Button,{variant:"outline",size:"sm",className:"gap-2",onClick:()=>aB("clone",a),disabled:D,children:[(0,b.jsx)(aJ.Copy,{className:"h-4 w-4"}),"Clone"]}),"draft"===a.status&&(0,b.jsxs)(e.Button,{variant:"outline",size:"sm",className:"gap-2",onClick:()=>aB("edit",a),disabled:D,children:[(0,b.jsx)(aM.Pencil,{className:"h-4 w-4"}),"Edit"]}),"published"!==a.status&&(0,b.jsxs)(e.Button,{size:"sm",className:"gap-2",onClick:()=>aF(a,"published"),disabled:D,children:[(0,b.jsx)(aK.Rocket,{className:"h-4 w-4"}),"Publish"]}),"archived"!==a.status&&(0,b.jsxs)(e.Button,{variant:"outline",size:"sm",className:"gap-2 text-rose-300",onClick:()=>aF(a,"archived"),disabled:D,children:[(0,b.jsx)(aL.Archive,{className:"h-4 w-4"}),"Archive"]}),(0,b.jsx)(e.Button,{variant:"outline",size:"sm",className:"gap-2",onClick:()=>N.current[a.id]?.click(),disabled:K===a.id,children:K===a.id?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(r.Loader2,{className:"h-4 w-4 animate-spin"}),"Uploading..."]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(am.Upload,{className:"h-4 w-4"}),"Upload Attachment"]})}),(0,b.jsx)(e.Button,{variant:"outline",size:"sm",className:"gap-2",onClick:()=>aw(a.id),disabled:aj===a.id,children:aj===a.id?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(r.Loader2,{className:"h-4 w-4 animate-spin"}),"Generating..."]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(aN.FileCheck,{className:"h-4 w-4"}),"Generate PDF"]})})]}),"published"===a.status&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(aI.Separator,{}),(0,b.jsxs)("div",{children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,b.jsxs)("h4",{className:"text-xs font-semibold text-muted-foreground uppercase tracking-wide flex items-center gap-1.5",children:[(0,b.jsx)(aN.FileCheck,{className:"h-3.5 w-3.5"}),"Linked Fee Plans"]}),(0,b.jsxs)(e.Button,{variant:"ghost",size:"sm",className:"gap-1 text-xs h-6 px-2",onClick:()=>at(a.id),children:[(0,b.jsx)(z.Plus,{className:"h-3 w-3"}),"Add"]})]}),R?(0,b.jsxs)("div",{className:"flex items-center gap-2 text-muted-foreground text-xs py-1",children:[(0,b.jsx)(r.Loader2,{className:"h-3 w-3 animate-spin"}),"Loading..."]}):0===(ar[a.id]||[]).length?(0,b.jsx)("div",{className:"text-xs text-muted-foreground py-1",children:"No fee plans linked yet."}):(0,b.jsx)("div",{className:"space-y-1.5",children:(ar[a.id]||[]).map(a=>{let c=as(a);return(0,b.jsxs)("div",{className:"flex items-center justify-between py-1 px-2 rounded bg-muted/50 text-xs",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 min-w-0",children:[c&&(0,b.jsxs)("span",{className:"flex items-center gap-1 text-muted-foreground shrink-0",children:[(0,b.jsx)(c.icon,{className:"h-3 w-3"}),c.name]}),(0,b.jsx)("span",{className:"text-foreground truncate",children:a.name})]}),(0,b.jsx)(f.Badge,{className:`text-[10px] h-5 shrink-0 ${aS[a.status]||aS.draft}`,children:aT[a.status]||a.status})]},a.id)})})]})]})]})]},a.id)),0===ay.length&&(0,b.jsx)(d.Card,{className:"border border-dashed border-border bg-muted/50",children:(0,b.jsxs)(d.CardContent,{className:"py-16 text-center space-y-3",children:[(0,b.jsx)("h4",{className:"text-lg font-semibold text-foreground",children:"No term sheets yet"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Create your first version to begin capturing structured economics and publishing investor-ready content."}),(0,b.jsxs)(e.Button,{variant:"outline",className:"gap-2",onClick:()=>aB("create"),disabled:D,children:[(0,b.jsx)(z.Plus,{className:"h-4 w-4"}),"Create Term Sheet"]})]})})]})]}),(0,b.jsx)(h.Dialog,{open:s,onOpenChange:a=>!a&&aC(),children:(0,b.jsxs)(h.DialogContent,{className:"sm:max-w-3xl max-h-[90vh] overflow-y-auto",children:[(0,b.jsxs)(h.DialogHeader,{children:[(0,b.jsxs)(h.DialogTitle,{children:["create"===u&&"Create Term Sheet","edit"===u&&"Edit Term Sheet","clone"===u&&"Clone Term Sheet"]}),(0,b.jsx)(d.CardDescription,{children:"Populate the structured fields that sync with investor-facing term sheets."})]}),(0,b.jsxs)("div",{className:"space-y-6 py-4",children:[(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(j.Label,{htmlFor:"term_sheet_date",children:"Term Sheet Date"}),(0,b.jsx)(i.Input,{id:"term_sheet_date",type:"date",value:A.term_sheet_date,onChange:a=>B(b=>({...b,term_sheet_date:a.target.value}))})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(j.Label,{htmlFor:"transaction_type",children:"Transaction Type"}),(0,b.jsx)(i.Input,{id:"transaction_type",value:A.transaction_type,onChange:a=>B(b=>({...b,transaction_type:a.target.value}))})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(j.Label,{htmlFor:"structure",children:"Structure"}),(0,b.jsx)(i.Input,{id:"structure",value:A.structure,onChange:a=>B(b=>({...b,structure:a.target.value}))})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(j.Label,{htmlFor:"allocation_up_to",children:"Allocation “Up to”"}),(0,b.jsx)(i.Input,{id:"allocation_up_to",type:"number",value:A.allocation_up_to,onChange:a=>B(b=>({...b,allocation_up_to:a.target.value}))})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(j.Label,{htmlFor:"opportunity_summary",children:"Opportunity Summary"}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"Supports basic Markdown for emphasis, lists, and headings. The rendered HTML is stored for the investor view."}),(0,b.jsx)(k.Textarea,{id:"opportunity_summary",rows:3,value:A.opportunity_summary,onChange:a=>B(b=>({...b,opportunity_summary:a.target.value}))})]}),(0,b.jsx)(aI.Separator,{}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(j.Label,{htmlFor:"issuer",children:"Issuer"}),(0,b.jsx)(i.Input,{id:"issuer",placeholder:"e.g., VERSO Capital",value:A.issuer,onChange:a=>B(b=>({...b,issuer:a.target.value}))})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(j.Label,{htmlFor:"vehicle",children:"Vehicle"}),(0,b.jsx)(i.Input,{id:"vehicle",placeholder:"e.g., VERSO SPV 2025-01",value:A.vehicle,onChange:a=>B(b=>({...b,vehicle:a.target.value}))})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(j.Label,{htmlFor:"exclusive_arranger",children:"Exclusive Arranger"}),(0,b.jsx)(i.Input,{id:"exclusive_arranger",placeholder:"e.g., VERSO Management Limited",value:A.exclusive_arranger,onChange:a=>B(b=>({...b,exclusive_arranger:a.target.value}))})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(j.Label,{htmlFor:"purchaser",children:"Purchaser"}),(0,b.jsx)(i.Input,{id:"purchaser",placeholder:"e.g., Qualified Limited Partners",value:A.purchaser,onChange:a=>B(b=>({...b,purchaser:a.target.value}))})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(j.Label,{htmlFor:"seller",children:"Seller"}),(0,b.jsx)(i.Input,{id:"seller",placeholder:"e.g., GP of Transform Capital",value:A.seller,onChange:a=>B(b=>({...b,seller:a.target.value}))})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(j.Label,{htmlFor:"legal_counsel",children:"Legal Counsel"}),(0,b.jsx)(i.Input,{id:"legal_counsel",placeholder:"e.g., Dupont & Partners Law Firm",value:A.legal_counsel,onChange:a=>B(b=>({...b,legal_counsel:a.target.value}))})]})]}),(0,b.jsx)(aI.Separator,{}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(j.Label,{htmlFor:"price_per_share_text",children:"Price per Share (Display Text)"}),(0,b.jsx)(i.Input,{id:"price_per_share_text",placeholder:"e.g., £10.00 per share",value:A.price_per_share_text,onChange:a=>B(b=>({...b,price_per_share_text:a.target.value}))}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:'Display text for investors (e.g., "£10.00 per share", "~$15-20")'})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(j.Label,{htmlFor:"price_per_share",children:"Price per Share (Numeric)"}),(0,b.jsx)(i.Input,{id:"price_per_share",type:"number",step:"0.01",placeholder:"e.g., 10.00",value:A.price_per_share,onChange:a=>B(b=>({...b,price_per_share:a.target.value}))}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"Used for subscription calculations"})]})]}),(ao||ap)&&(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 p-4 rounded-lg bg-amber-500/5 border border-amber-500/20",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(j.Label,{htmlFor:"cost_per_share",className:"text-amber-200",children:"Cost per Share (Internal)"}),(0,b.jsx)(i.Input,{id:"cost_per_share",type:"number",step:"0.01",placeholder:"e.g., 8.00",value:A.cost_per_share,onChange:a=>B(b=>({...b,cost_per_share:a.target.value})),className:"border-amber-500/30"}),(0,b.jsx)("p",{className:"text-xs text-amber-200/70",children:"VERSO's acquisition cost (not shown to investors)"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(j.Label,{className:"text-amber-200",children:"Spread per Share"}),(0,b.jsx)("div",{className:"h-10 px-3 rounded-md bg-background/50 border border-amber-500/30 flex items-center text-sm font-medium",children:(l=parseFloat(A.price_per_share)||0,m=parseFloat(A.cost_per_share)||0,l>0&&m>0?`${(l-m).toFixed(2)}`:"—")}),(0,b.jsx)("p",{className:"text-xs text-amber-200/70",children:"Calculated: price − cost"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(j.Label,{className:"text-amber-200",children:"Margin %"}),(0,b.jsx)("div",{className:"h-10 px-3 rounded-md bg-background/50 border border-amber-500/30 flex items-center text-sm font-medium",children:(n=parseFloat(A.price_per_share)||0,o=parseFloat(A.cost_per_share)||0,n>0&&o>0?`${((n-o)/o*100).toFixed(1)}%`:"—")}),(0,b.jsx)("p",{className:"text-xs text-amber-200/70",children:"Margin on cost"})]})]}),(0,b.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(j.Label,{htmlFor:"minimum_ticket",children:"Minimum Ticket"}),(0,b.jsx)(i.Input,{id:"minimum_ticket",type:"number",value:A.minimum_ticket,onChange:a=>B(b=>({...b,minimum_ticket:a.target.value}))})]})}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(j.Label,{htmlFor:"subscription_fee_percent",children:"Subscription Fee %"}),(0,b.jsx)(i.Input,{id:"subscription_fee_percent",type:"number",step:"0.01",value:A.subscription_fee_percent,onChange:a=>B(b=>({...b,subscription_fee_percent:a.target.value}))})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(j.Label,{htmlFor:"management_fee_percent",children:"Management Fee %"}),(0,b.jsx)(i.Input,{id:"management_fee_percent",type:"number",step:"0.01",value:A.management_fee_percent,onChange:a=>B(b=>({...b,management_fee_percent:a.target.value}))})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(j.Label,{htmlFor:"carried_interest_percent",children:"Carried Interest %"}),(0,b.jsx)(i.Input,{id:"carried_interest_percent",type:"number",step:"0.01",value:A.carried_interest_percent,onChange:a=>B(b=>({...b,carried_interest_percent:a.target.value}))})]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(j.Label,{htmlFor:"management_fee_clause",children:"Management Fee Clause"}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:'Optional descriptive text (e.g., "Waived instead of 2.00% per annum")'}),(0,b.jsx)(i.Input,{id:"management_fee_clause",placeholder:"e.g., Waived (instead of 2.00% per annum)",value:A.management_fee_clause,onChange:a=>B(b=>({...b,management_fee_clause:a.target.value}))})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(j.Label,{htmlFor:"performance_fee_clause",children:"Performance Fee Clause"}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:'Optional descriptive text (e.g., "Waived instead of 20% no hurdle")'}),(0,b.jsx)(i.Input,{id:"performance_fee_clause",placeholder:"e.g., Waived (instead of 20.00% no hurdle rate)",value:A.performance_fee_clause,onChange:a=>B(b=>({...b,performance_fee_clause:a.target.value}))})]})]}),(0,b.jsx)(aI.Separator,{}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(j.Label,{htmlFor:"interest_confirmation_deadline",children:"Interest Confirmation Deadline"}),(0,b.jsx)(i.Input,{id:"interest_confirmation_deadline",type:"datetime-local",value:A.interest_confirmation_deadline,onChange:a=>B(b=>({...b,interest_confirmation_deadline:a.target.value}))})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(j.Label,{htmlFor:"validity_date",children:"Validity Date"}),(0,b.jsx)(i.Input,{id:"validity_date",type:"datetime-local",value:A.validity_date,onChange:a=>B(b=>({...b,validity_date:a.target.value}))})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(j.Label,{htmlFor:"completion_date",children:"Completion Date"}),(0,b.jsx)(i.Input,{id:"completion_date",type:"date",value:A.completion_date,onChange:a=>B(b=>({...b,completion_date:a.target.value}))}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"When set, enables automatic CEO approval for deal closing."})]})]})]}),(0,b.jsxs)(h.DialogFooter,{className:"flex items-center justify-between",children:[(0,b.jsx)(e.Button,{type:"button",variant:"ghost",onClick:aC,disabled:D,children:"Cancel"}),(0,b.jsxs)(e.Button,{onClick:aE,disabled:D,children:[D&&(0,b.jsx)(r.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),"Save Term Sheet"]})]})]})}),(0,b.jsx)(ag.default,{open:T,onClose:au,onSuccess:()=>{au(),aq()},dealId:a,initialTermSheetId:V}),(0,b.jsx)(aP.DocumentViewerFullscreen,{isOpen:X,document:ah,previewUrl:_,isLoading:Z,error:ad,onClose:()=>{Y(!1),aa(null),ac(null),ae(null),ai(null)},onDownload:()=>{_&&window.open(_,"_blank")}})]})}let aX={pending_review:"bg-amber-500/20 text-amber-100",approved:"bg-emerald-500/20 text-emerald-100",rejected:"bg-rose-500/20 text-rose-100",withdrawn:"bg-muted text-muted-foreground",signal:"bg-purple-500/20 text-purple-100"},aY={pending_review:"bg-amber-500/20 text-amber-100",approved:"bg-emerald-500/20 text-emerald-100",rejected:"bg-rose-500/20 text-rose-100",cancelled:"bg-muted text-muted-foreground"};function aZ({dealId:a,interests:e,subscriptions:g}){let h=(0,c.useMemo)(()=>{let a=e?.filter(a=>a.is_post_close)??[],b=e?.filter(a=>!a.is_post_close&&"pending_review"===a.status)??[];return{signals:a,pending:b,approved:e?.filter(a=>!a.is_post_close&&"approved"===a.status)??[],other:e?.filter(a=>!a.is_post_close&&!["pending_review","approved"].includes(a.status))??[]}},[e]);return(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)(d.Card,{className:"border-border bg-muted/50",children:[(0,b.jsxs)(d.CardHeader,{className:"flex flex-row items-start justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(d.CardTitle,{className:"text-foreground",children:"Interest Pipeline"}),(0,b.jsx)(d.CardDescription,{children:"Track investor signals and align approvals with NDA and data-room workflows."})]}),(0,b.jsx)(s.default,{href:`/versotech_main/approvals?entity=deal_interest&deal=${a}`,className:"text-sm font-medium text-sky-300 hover:text-sky-200",children:"View related approvals ➜"})]}),(0,b.jsxs)(d.CardContent,{className:"space-y-6",children:[h.signals.length>0&&(0,b.jsx)(a$,{title:"Future Interest Signals (Closed Deal)",interests:h.signals,emptyLabel:""}),(0,b.jsx)(a$,{title:"Pending Review",interests:h.pending,emptyLabel:"No pending interests."}),(0,b.jsx)(a$,{title:"Approved",interests:h.approved,emptyLabel:"No approved interests yet."}),h.other.length>0&&(0,b.jsx)(a$,{title:"Completed",interests:h.other,emptyLabel:""})]})]}),(0,b.jsxs)(d.Card,{className:"border-border bg-muted/50",children:[(0,b.jsxs)(d.CardHeader,{className:"flex flex-row items-start justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(d.CardTitle,{className:"text-foreground",children:"Subscription Submissions"}),(0,b.jsx)(d.CardDescription,{children:"Monitor definitive commitments flowing in from the investor data room."})]}),(0,b.jsx)(s.default,{href:`/versotech_main/approvals?entity=deal_subscription&deal=${a}`,className:"text-sm font-medium text-sky-300 hover:text-sky-200",children:"View related approvals ➜"})]}),(0,b.jsx)(d.CardContent,{children:(0,b.jsxs)(D.Table,{className:"min-w-full",children:[(0,b.jsx)(D.TableHeader,{children:(0,b.jsxs)(D.TableRow,{children:[(0,b.jsx)(D.TableHead,{children:"Investor"}),(0,b.jsx)(D.TableHead,{children:"Status"}),(0,b.jsx)(D.TableHead,{children:"Submitted"}),(0,b.jsx)(D.TableHead,{children:"Amount (derived)"})]})}),(0,b.jsx)(D.TableBody,{children:g?.length?g.map(a=>{let c=a.payload_json?.amount??a.payload_json?.subscription_amount??a.payload_json?.commitment_amount,d="number"==typeof c?c:parseFloat(c??""),e=Number.isFinite(d)?d.toLocaleString():void 0;return(0,b.jsxs)(D.TableRow,{children:[(0,b.jsx)(D.TableCell,{children:a.investors?.legal_name||"Unknown investor"}),(0,b.jsx)(D.TableCell,{children:(0,b.jsx)(f.Badge,{className:aY[a.status]??"bg-muted",children:a.status.replace("_"," ").toUpperCase()})}),(0,b.jsx)(D.TableCell,{children:a.submitted_at?(0,C.format)(new Date(a.submitted_at),"dd MMM yyyy HH:mm"):"—"}),(0,b.jsx)(D.TableCell,{children:e??"—"})]},a.id)}):(0,b.jsx)(D.TableRow,{children:(0,b.jsx)(D.TableCell,{colSpan:4,className:"text-center text-muted-foreground py-6",children:"No subscription submissions yet."})})})]})})]})]})}function a$({title:a,interests:c,emptyLabel:d}){return(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("h4",{className:"text-sm font-semibold text-foreground",children:a}),(0,b.jsxs)(D.Table,{className:"min-w-full",children:[(0,b.jsx)(D.TableHeader,{children:(0,b.jsxs)(D.TableRow,{children:[(0,b.jsx)(D.TableHead,{children:"Investor"}),(0,b.jsx)(D.TableHead,{children:"Action"}),(0,b.jsx)(D.TableHead,{children:"Status"}),(0,b.jsx)(D.TableHead,{children:"Indicative Amount"}),(0,b.jsx)(D.TableHead,{children:"Submitted"})]})}),(0,b.jsx)(D.TableBody,{children:c.length?c.map(a=>{let c=a.is_post_close?"signal":a.status,d=a.is_post_close?"SIGNAL":a.status.replace("_"," ").toUpperCase();return(0,b.jsxs)(D.TableRow,{children:[(0,b.jsx)(D.TableCell,{children:a.investors?.legal_name||"Unknown investor"}),(0,b.jsx)(D.TableCell,{children:a.is_post_close?(0,b.jsx)(f.Badge,{className:"bg-purple-500/20 text-purple-100",children:"Notify Me About Similar"}):(0,b.jsx)(f.Badge,{className:"bg-blue-500/20 text-blue-100",children:"I'm Interested"})}),(0,b.jsx)(D.TableCell,{children:(0,b.jsx)(f.Badge,{className:aX[c]??"bg-muted",children:d})}),(0,b.jsx)(D.TableCell,{children:a.indicative_amount?`${a.indicative_currency??""} ${a.indicative_amount.toLocaleString()}`:"—"}),(0,b.jsx)(D.TableCell,{children:a.submitted_at?(0,C.format)(new Date(a.submitted_at),"dd MMM yyyy HH:mm"):"—"})]},a.id)}):(0,b.jsx)(D.TableRow,{children:(0,b.jsx)(D.TableCell,{colSpan:5,className:"text-center text-muted-foreground py-6",children:d})})})]})]})}var a_=a.i(635136),a0=a.i(618287);let a1={investorId:"",expiresAt:"",autoGranted:!1,notes:""};function a2({dealId:a,dealName:g,memberships:m,accessRecords:o,documents:p}){let s=(0,t.useRouter)(),[u,v]=(0,c.useState)(!1),[w,x]=(0,c.useState)(a1),[y,A]=(0,c.useState)(null),[B,E]=(0,c.useState)(!1),[F,G]=(0,c.useState)(null),[H,I]=(0,c.useState)(o??[]),[J,K]=(0,c.useState)(null),[L,N]=(0,c.useState)({}),[O,P]=(0,c.useState)(!1);(0,c.useEffect)(()=>{I(o??[])},[o]);let Q=(0,c.useMemo)(()=>m?.filter(a=>a.investor_id&&a.investors).map(a=>({id:a.investor_id,label:a.investors?.legal_name||"Unnamed investor"}))??[],[m]);(0,c.useMemo)(()=>{let a=new Map;return p?.forEach(b=>{let c=b.folder||"Uncategorised";a.has(c)||a.set(c,[]),a.get(c).push(b)}),Array.from(a.entries())},[p]);let R=()=>{x(a1),A(null),G(null)},S=()=>{v(!1),R()},T=async()=>{let b=await fetch(`/api/deals/${a}/data-room-access`);b.ok?I((await b.json()).access??[]):G("Failed to refresh access records. Please reload the page.")},U=async()=>{if(!w.investorId)return void G("Select an investor before submitting.");E(!0),G(null);try{let b=await fetch(`/api/deals/${a}/data-room-access`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({investor_id:w.investorId,expires_at:w.expiresAt?new Date(w.expiresAt).toISOString():null,auto_granted:w.autoGranted,notes:w.notes||null})});if(!b.ok){let a=await b.text();throw Error(a||"Failed to save access record")}await T(),S()}catch(a){G(a instanceof Error?a.message:"Unexpected error saving access record")}finally{E(!1)}},V=async b=>{E(!0),G(null);try{let c=await fetch(`/api/deals/${a}/data-room-access`,{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({access_id:b.id,reason:"Revoked via staff portal"})});if(!c.ok){let a=await c.text();throw Error(a||"Failed to revoke access")}await T()}catch(a){G(a instanceof Error?a.message:"Unexpected error revoking access")}finally{E(!1)}},W=async b=>{try{if(b.external_link)window.open(b.external_link,"_blank","noopener,noreferrer"),af.toast.success("Opening document in new tab");else{let c=await fetch(`/api/deals/${a}/documents/${b.id}/download`);if(!c.ok)throw Error("Failed to get download link");let d=await c.json();window.open(d.download_url,"_blank"),af.toast.success("Document download started")}}catch(a){af.toast.error("Failed to open document")}},X=async()=>{if(J){E(!0);try{let b=await fetch(`/api/deals/${a}/documents/${J}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(L)});if(!b.ok){let a=await b.json();throw Error(a.error||"Failed to update document")}af.toast.success("Document updated successfully"),P(!1),K(null),s.refresh()}catch(a){af.toast.error(a instanceof Error?a.message:"Failed to update document")}finally{E(!1)}}},Y=async b=>{if(confirm(`Are you sure you want to delete "${b.file_name}"? This action cannot be undone.`)){E(!0);try{if(!(await fetch(`/api/deals/${a}/documents/${b.id}`,{method:"DELETE"})).ok)throw Error("Failed to delete document");af.toast.success("Document deleted successfully"),s.refresh()}catch(a){af.toast.error("Failed to delete document")}finally{E(!1)}}};return(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)(d.Card,{className:"border-border bg-muted/50",children:[(0,b.jsxs)(d.CardHeader,{className:"flex flex-row items-start justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(d.CardTitle,{className:"text-foreground",children:"Data Room Access"}),(0,b.jsx)(d.CardDescription,{children:"Manage NDA-cleared investors, extend access windows, and keep visibility in sync with documentation."})]}),(0,b.jsxs)(e.Button,{onClick:()=>{R(),v(!0)},className:"gap-2",disabled:B,children:[(0,b.jsx)(a_.KeyRound,{className:"h-4 w-4"}),"Grant Access"]})]}),(0,b.jsxs)(d.CardContent,{children:[F&&(0,b.jsx)("div",{className:"mb-4 rounded-md border border-destructive/40 bg-destructive/10 px-4 py-3 text-sm text-destructive",children:F}),(0,b.jsxs)(D.Table,{className:"min-w-full",children:[(0,b.jsx)(D.TableHeader,{children:(0,b.jsxs)(D.TableRow,{children:[(0,b.jsx)(D.TableHead,{children:"Investor"}),(0,b.jsx)(D.TableHead,{children:"Granted"}),(0,b.jsx)(D.TableHead,{children:"Expires"}),(0,b.jsx)(D.TableHead,{children:"Status"}),(0,b.jsx)(D.TableHead,{className:"text-right",children:"Actions"})]})}),(0,b.jsx)(D.TableBody,{children:H?.length?H.map(a=>{let c=!!a.revoked_at,d=!a.revoked_at&&a.expires_at&&new Date(a.expires_at)<new Date(Date.now()+2592e5);return(0,b.jsxs)(D.TableRow,{children:[(0,b.jsx)(D.TableCell,{className:"font-medium",children:a.investors?.legal_name||"Unknown investor"}),(0,b.jsx)(D.TableCell,{children:a.granted_at?(0,C.format)(new Date(a.granted_at),"dd MMM yyyy HH:mm"):"—"}),(0,b.jsx)(D.TableCell,{children:a.expires_at?`${(0,C.format)(new Date(a.expires_at),"dd MMM yyyy HH:mm")} (${(0,aC.formatDistanceToNow)(new Date(a.expires_at),{addSuffix:!0})})`:"No expiry"}),(0,b.jsx)(D.TableCell,{children:(0,b.jsx)(f.Badge,{className:c?"bg-rose-500/20 text-rose-100":d?"bg-amber-500/20 text-amber-100":"bg-emerald-500/20 text-emerald-100",children:c?"REVOKED":d?"EXPIRING":"ACTIVE"})}),(0,b.jsxs)(D.TableCell,{className:"text-right space-x-2",children:[(0,b.jsxs)(e.Button,{variant:"outline",size:"sm",className:"gap-2",onClick:()=>{x({investorId:a.investor_id,expiresAt:a.expires_at?a.expires_at.slice(0,16):"",autoGranted:!!a.auto_granted,notes:a.notes??""}),A(a.id),G(null),v(!0)},disabled:B||c,children:[(0,b.jsx)(ac.Clock,{className:"h-4 w-4"}),"Extend"]}),(0,b.jsxs)(e.Button,{variant:"outline",size:"sm",className:"gap-2 text-rose-300",onClick:()=>V(a),disabled:B||c,children:[(0,b.jsx)(M.Trash2,{className:"h-4 w-4"}),"Revoke"]})]})]},a.id)}):(0,b.jsx)(D.TableRow,{children:(0,b.jsx)(D.TableCell,{colSpan:5,className:"text-center text-muted-foreground py-6",children:"No active access yet. Grant access once the NDA is signed."})})})]})]})]}),(0,b.jsxs)(d.Card,{className:"border-border bg-muted/50",children:[(0,b.jsxs)(d.CardHeader,{className:"flex flex-row items-start justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(d.CardTitle,{className:"text-foreground",children:"Data Room Documents"}),(0,b.jsx)(d.CardDescription,{children:"Upload and manage documents that investors can access in their data room."})]}),(0,b.jsx)(aq,{dealId:a,onUploadComplete:T,trigger:(0,b.jsxs)(e.Button,{className:"gap-2",children:[(0,b.jsx)(z.Plus,{className:"h-4 w-4"}),"Upload Files"]})})]}),(0,b.jsx)(d.CardContent,{children:p?.length?(0,b.jsxs)(D.Table,{children:[(0,b.jsx)(D.TableHeader,{children:(0,b.jsxs)(D.TableRow,{children:[(0,b.jsx)(D.TableHead,{children:"Document"}),(0,b.jsx)(D.TableHead,{children:"Folder"}),(0,b.jsx)(D.TableHead,{children:"Visible to Investors"}),(0,b.jsx)(D.TableHead,{children:"Uploaded"}),(0,b.jsx)(D.TableHead,{className:"text-right",children:"Actions"})]})}),(0,b.jsx)(D.TableBody,{children:p.map(a=>(0,b.jsxs)(D.TableRow,{children:[(0,b.jsx)(D.TableCell,{className:"font-medium",children:(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[a.external_link?(0,b.jsx)(a0.ExternalLink,{className:"h-4 w-4 text-blue-500"}):(0,b.jsx)(n.FileText,{className:"h-4 w-4 text-muted-foreground"}),a.file_name||a.file_key?.split("/").pop()||"Untitled",a.external_link&&(0,b.jsx)(f.Badge,{variant:"outline",className:"ml-2 text-xs bg-blue-500/10 text-blue-400 border-blue-500/30",children:"Link"})]})}),(0,b.jsx)(D.TableCell,{children:(0,b.jsx)(f.Badge,{variant:"outline",children:a.folder||"Uncategorized"})}),(0,b.jsx)(D.TableCell,{children:(0,b.jsx)(f.Badge,{className:a.visible_to_investors?"bg-emerald-500/20 text-emerald-100":"bg-muted text-muted-foreground",children:a.visible_to_investors?"YES":"NO"})}),(0,b.jsx)(D.TableCell,{className:"text-sm text-muted-foreground",children:a.created_at?(0,C.format)(new Date(a.created_at),"MMM d, yyyy"):"—"}),(0,b.jsxs)(D.TableCell,{className:"text-right space-x-2",children:[(0,b.jsx)(e.Button,{variant:"outline",size:"sm",className:"gap-2",onClick:()=>W(a),disabled:B,children:a.external_link?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(a0.ExternalLink,{className:"h-4 w-4"}),"View"]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(ae.Download,{className:"h-4 w-4"}),"Download"]})}),(0,b.jsxs)(e.Button,{variant:"outline",size:"sm",className:"gap-2",onClick:()=>{K(a.id),N({file_name:a.file_name||"",folder:a.folder||"Legal",visible_to_investors:a.visible_to_investors||!1,document_notes:a.document_notes||"",external_link:a.external_link||""}),P(!0)},disabled:B,children:[(0,b.jsx)(q.Edit,{className:"h-4 w-4"}),"Edit"]}),(0,b.jsxs)(e.Button,{variant:"outline",size:"sm",className:"gap-2 text-rose-300",onClick:()=>Y(a),disabled:B,children:[(0,b.jsx)(M.Trash2,{className:"h-4 w-4"}),"Delete"]})]})]},a.id))})]}):(0,b.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:"No documents have been published to the data room yet."})})]}),(0,b.jsx)(h.Dialog,{open:u,onOpenChange:a=>!a&&S(),children:(0,b.jsxs)(h.DialogContent,{className:"sm:max-w-lg",children:[(0,b.jsxs)(h.DialogHeader,{children:[(0,b.jsx)(h.DialogTitle,{children:y?"Update Data Room Access":"Grant Data Room Access"}),(0,b.jsxs)(d.CardDescription,{children:["Select an investor and optionally set an expiry to control data room visibility for ",g,"."]})]}),(0,b.jsxs)("div",{className:"space-y-4 py-2",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(j.Label,{children:"Investor"}),(0,b.jsxs)(l.Select,{value:w.investorId,onValueChange:a=>x(b=>({...b,investorId:a})),children:[(0,b.jsx)(l.SelectTrigger,{children:(0,b.jsx)(l.SelectValue,{placeholder:"Select investor"})}),(0,b.jsx)(l.SelectContent,{children:Q.length?Q.map(a=>(0,b.jsx)(l.SelectItem,{value:a.id,children:a.label},a.id)):(0,b.jsx)(l.SelectItem,{value:"",children:"No investors invited yet"})})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(j.Label,{htmlFor:"expiresAt",children:"Expiry"}),(0,b.jsx)(i.Input,{id:"expiresAt",type:"datetime-local",value:w.expiresAt,onChange:a=>x(b=>({...b,expiresAt:a.target.value}))}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"Leave blank for open-ended access."})]}),(0,b.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,b.jsx)(ak.Checkbox,{id:"autoGranted",checked:w.autoGranted,onCheckedChange:a=>x(b=>({...b,autoGranted:!!a}))}),(0,b.jsx)(j.Label,{htmlFor:"autoGranted",className:"text-sm font-medium",children:"Mark as auto-granted (automation)"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(j.Label,{htmlFor:"notes",children:"Notes"}),(0,b.jsx)(k.Textarea,{id:"notes",rows:3,value:w.notes,onChange:a=>x(b=>({...b,notes:a.target.value}))})]})]}),(0,b.jsxs)(h.DialogFooter,{className:"flex items-center justify-between",children:[(0,b.jsx)(e.Button,{type:"button",variant:"ghost",onClick:S,disabled:B,children:"Cancel"}),(0,b.jsxs)(e.Button,{onClick:U,disabled:B,children:[B&&(0,b.jsx)(r.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),"Save Access"]})]})]})}),(0,b.jsx)(h.Dialog,{open:O,onOpenChange:P,children:(0,b.jsxs)(h.DialogContent,{className:"sm:max-w-lg",children:[(0,b.jsxs)(h.DialogHeader,{children:[(0,b.jsx)(h.DialogTitle,{children:"Edit Document"}),(0,b.jsx)(d.CardDescription,{children:"Update document metadata, folder, and visibility settings."})]}),(0,b.jsxs)("div",{className:"space-y-4 py-2",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(j.Label,{htmlFor:"fileName",children:"Document Name"}),(0,b.jsx)(i.Input,{id:"fileName",value:L.file_name||"",onChange:a=>N(b=>({...b,file_name:a.target.value})),placeholder:"Enter document name..."})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(j.Label,{htmlFor:"externalLink",children:"External Link (optional)"}),(0,b.jsx)(i.Input,{id:"externalLink",type:"url",value:L.external_link||"",onChange:a=>N(b=>({...b,external_link:a.target.value})),placeholder:"https://drive.google.com/file/d/..."}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"Leave empty for uploaded files. Add a Google Drive, Dropbox, or other external link to reference documents hosted elsewhere."})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(j.Label,{children:"Folder"}),(0,b.jsxs)(l.Select,{value:L.folder,onValueChange:a=>N(b=>({...b,folder:a})),children:[(0,b.jsx)(l.SelectTrigger,{children:(0,b.jsx)(l.SelectValue,{})}),(0,b.jsxs)(l.SelectContent,{children:[(0,b.jsx)(l.SelectItem,{value:"Legal",children:"Legal"}),(0,b.jsx)(l.SelectItem,{value:"KYC",children:"KYC"}),(0,b.jsx)(l.SelectItem,{value:"Reports",children:"Reports"}),(0,b.jsx)(l.SelectItem,{value:"Presentations",children:"Presentations"}),(0,b.jsx)(l.SelectItem,{value:"Financial Models",children:"Financial Models"}),(0,b.jsx)(l.SelectItem,{value:"Misc",children:"Misc"})]})]})]}),(0,b.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,b.jsx)(ak.Checkbox,{id:"docVisible",checked:L.visible_to_investors,onCheckedChange:a=>N(b=>({...b,visible_to_investors:!!a}))}),(0,b.jsx)(j.Label,{htmlFor:"docVisible",className:"text-sm font-medium",children:"Visible to investors"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(j.Label,{htmlFor:"docNotes",children:"Notes"}),(0,b.jsx)(k.Textarea,{id:"docNotes",rows:3,value:L.document_notes,onChange:a=>N(b=>({...b,document_notes:a.target.value})),placeholder:"Internal notes about this document..."})]})]}),(0,b.jsxs)(h.DialogFooter,{className:"flex items-center justify-between",children:[(0,b.jsx)(e.Button,{type:"button",variant:"ghost",onClick:()=>P(!1),disabled:B,children:"Cancel"}),(0,b.jsxs)(e.Button,{onClick:X,disabled:B,children:[B&&(0,b.jsx)(r.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),"Save Changes"]})]})]})})]})}function a3({dealId:a}){let[g,h]=(0,c.useState)([]),[i,j]=(0,c.useState)(!0),k={pending_review:"bg-yellow-100 dark:bg-yellow-500/20 text-yellow-700 dark:text-yellow-200",approved:"bg-emerald-100 dark:bg-emerald-500/20 text-emerald-700 dark:text-emerald-200",rejected:"bg-red-100 dark:bg-red-500/20 text-red-700 dark:text-red-200",pending_signature:"bg-blue-100 dark:bg-blue-500/20 text-blue-700 dark:text-blue-200",committed:"bg-green-100 dark:bg-green-500/20 text-green-700 dark:text-green-200"},l={no_pack:"bg-muted text-muted-foreground",draft:"bg-purple-100 dark:bg-purple-500/20 text-purple-700 dark:text-purple-200",final:"bg-cyan-100 dark:bg-cyan-500/20 text-cyan-700 dark:text-cyan-200",pending_signature:"bg-amber-100 dark:bg-amber-500/20 text-amber-700 dark:text-amber-200",signed:"bg-emerald-100 dark:bg-emerald-500/20 text-emerald-700 dark:text-emerald-200"},m={no_pack:"No Pack",draft:"Draft Generated",final:"Final Uploaded",pending_signature:"Awaiting Signatures",signed:"Fully Executed"},o=(0,c.useCallback)(async()=>{j(!0);try{let b=await fetch(`/api/deals/${a}/subscriptions`);if(!b.ok)throw Error("Failed to fetch subscriptions");let c=await b.json();h(c.submissions||[])}catch(a){console.error("Error fetching subscriptions:",a),af.toast.error("Failed to load subscriptions")}finally{j(!1)}},[a]);return((0,c.useEffect)(()=>{o()},[a,o]),i)?(0,b.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,b.jsx)(r.Loader2,{className:"h-8 w-8 animate-spin text-muted-foreground"})}):(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)(d.Card,{className:"border border-border bg-muted/50",children:[(0,b.jsx)(d.CardHeader,{children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsxs)(d.CardTitle,{className:"text-foreground flex items-center gap-2",children:[(0,b.jsx)(n.FileText,{className:"h-5 w-5"}),"Subscription Submissions"]}),(0,b.jsx)(d.CardDescription,{children:"Investor subscriptions and pack generation status"})]}),(0,b.jsxs)("div",{className:"text-sm text-muted-foreground",children:[g.length," ",1===g.length?"submission":"submissions"]})]})}),(0,b.jsx)(d.CardContent,{children:0===g.length?(0,b.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:"No subscription submissions yet for this deal."}):(0,b.jsx)("div",{className:"space-y-2",children:g.map(a=>{let c,d;return(0,b.jsxs)("div",{className:"flex items-center justify-between py-4 px-4 rounded-lg border border-border bg-muted/50 hover:bg-muted transition-colors",children:[(0,b.jsxs)("div",{className:"flex items-center gap-4 flex-1",children:[(0,b.jsx)(n.FileText,{className:"h-5 w-5 text-muted-foreground"}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,b.jsx)("span",{className:"font-medium text-foreground",children:a.investors.legal_name}),(0,b.jsx)(f.Badge,{className:k[a.status]||k.pending_review,children:a.status.replace(/_/g," ").toUpperCase()})]}),(0,b.jsxs)("div",{className:"flex items-center gap-4 text-sm text-muted-foreground",children:[(0,b.jsxs)("span",{children:["Amount: ",(c=a.payload_json?.amount||a.payload_json?.subscription_amount,d=a.payload_json?.currency||"USD",c?new Intl.NumberFormat("en-US",{style:"currency",currency:d}).format(c):"Not specified")]}),(0,b.jsx)("span",{children:"•"}),(0,b.jsxs)("span",{children:["Submitted ",new Date(a.submitted_at).toLocaleDateString()]})]})]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsxs)("div",{className:"text-right mr-2",children:[(0,b.jsx)("div",{className:"text-xs text-muted-foreground mb-1",children:"Subscription Pack"}),(0,b.jsx)(f.Badge,{className:l[a.pack_status||"no_pack"],children:m[a.pack_status||"no_pack"]})]}),(a.subscription_id||a.pack_document_id)&&(0,b.jsxs)(e.Button,{variant:"outline",size:"sm",className:"gap-2",onClick:()=>{a.subscription_id?window.open(`/versotech_main/subscriptions/${a.subscription_id}`,"_blank"):a.pack_document_id?window.open(`/api/documents/${a.pack_document_id}/download`,"_blank"):af.toast.info("This subscription has not been converted to a formal commitment yet, and no subscription pack has been generated.")},children:[(0,b.jsx)(a0.ExternalLink,{className:"h-4 w-4"}),a.subscription_id?"View Subscription":"View Pack"]})]})]},a.id)})})})]}),(0,b.jsxs)(d.Card,{className:"border border-border bg-muted/50",children:[(0,b.jsx)(d.CardHeader,{children:(0,b.jsx)(d.CardTitle,{className:"text-sm text-foreground",children:"Pack Status Legend"})}),(0,b.jsx)(d.CardContent,{children:(0,b.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-3 text-sm",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(f.Badge,{className:l.no_pack,children:"No Pack"}),(0,b.jsx)("span",{className:"text-muted-foreground",children:"No document generated"})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(f.Badge,{className:l.draft,children:"Draft"}),(0,b.jsx)("span",{className:"text-muted-foreground",children:"System generated draft"})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(f.Badge,{className:l.final,children:"Final"}),(0,b.jsx)("span",{className:"text-muted-foreground",children:"Staff uploaded final"})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(f.Badge,{className:l.pending_signature,children:"Awaiting"}),(0,b.jsx)("span",{className:"text-muted-foreground",children:"Sent for signatures"})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(f.Badge,{className:l.signed,children:"Executed"}),(0,b.jsx)("span",{className:"text-muted-foreground",children:"All parties signed"})]})]})})]})]})}var a4=a.i(118234);function a5({open:a,onOpenChange:d,dealId:f,faq:g,onSave:l}){let[m,n]=(0,c.useState)(""),[o,p]=(0,c.useState)(""),[q,s]=(0,c.useState)(!1);(0,c.useEffect)(()=>{g?(n(g.question),p(g.answer)):(n(""),p(""))},[g,a]);let t=async a=>{if(a.preventDefault(),!m.trim()||!o.trim())return void af.toast.error("Question and answer are required");s(!0);try{let a=g?`/api/deals/${f}/faqs/${g.id}`:`/api/deals/${f}/faqs`,b=g?"PATCH":"POST",c=await fetch(a,{method:b,headers:{"Content-Type":"application/json"},body:JSON.stringify({question:m,answer:o})}),e=await c.json();if(!c.ok)throw Error(e.error||"Failed to save FAQ");af.toast.success(g?"FAQ updated successfully":"FAQ created successfully"),l(),d(!1)}catch(a){console.error("Error saving FAQ:",a),af.toast.error(a instanceof Error?a.message:"Failed to save FAQ")}finally{s(!1)}};return(0,b.jsx)(h.Dialog,{open:a,onOpenChange:d,children:(0,b.jsx)(h.DialogContent,{className:"sm:max-w-[600px]",children:(0,b.jsxs)("form",{onSubmit:t,children:[(0,b.jsxs)(h.DialogHeader,{children:[(0,b.jsx)(h.DialogTitle,{children:g?"Edit FAQ":"Add New FAQ"}),(0,b.jsx)(h.DialogDescription,{children:g?"Update the question and answer":"Create a new frequently asked question for this deal"})]}),(0,b.jsxs)("div",{className:"grid gap-4 py-4",children:[(0,b.jsxs)("div",{className:"grid gap-2",children:[(0,b.jsx)(j.Label,{htmlFor:"question",children:"Question"}),(0,b.jsx)(i.Input,{id:"question",value:m,onChange:a=>n(a.target.value),placeholder:"e.g., What is the minimum investment amount?",maxLength:500,required:!0}),(0,b.jsxs)("p",{className:"text-xs text-muted-foreground",children:[m.length,"/500 characters"]})]}),(0,b.jsxs)("div",{className:"grid gap-2",children:[(0,b.jsx)(j.Label,{htmlFor:"answer",children:"Answer"}),(0,b.jsx)(k.Textarea,{id:"answer",value:o,onChange:a=>p(a.target.value),placeholder:"Provide a clear and concise answer...",rows:6,maxLength:5e3,required:!0}),(0,b.jsxs)("p",{className:"text-xs text-muted-foreground",children:[o.length,"/5000 characters"]})]})]}),(0,b.jsxs)(h.DialogFooter,{children:[(0,b.jsx)(e.Button,{type:"button",variant:"outline",onClick:()=>d(!1),disabled:q,children:"Cancel"}),(0,b.jsxs)(e.Button,{type:"submit",disabled:q,children:[q&&(0,b.jsx)(r.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),g?"Update":"Create"," FAQ"]})]})]})})})}var a6=a.i(479612);function a7({faq:a,onEdit:c,onDelete:f}){return(0,b.jsx)(d.Card,{children:(0,b.jsx)(d.CardContent,{className:"pt-6",children:(0,b.jsxs)("div",{className:"flex items-start justify-between gap-4",children:[(0,b.jsxs)("div",{className:"flex-1 space-y-2",children:[(0,b.jsx)("h4",{className:"font-semibold text-sm",children:a.question}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground whitespace-pre-wrap",children:a.answer})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(e.Button,{variant:"ghost",size:"sm",onClick:c,children:(0,b.jsx)(q.Edit,{className:"h-4 w-4"})}),(0,b.jsxs)(a6.AlertDialog,{children:[(0,b.jsx)(a6.AlertDialogTrigger,{asChild:!0,children:(0,b.jsx)(e.Button,{variant:"ghost",size:"sm",children:(0,b.jsx)(M.Trash2,{className:"h-4 w-4 text-destructive"})})}),(0,b.jsxs)(a6.AlertDialogContent,{children:[(0,b.jsxs)(a6.AlertDialogHeader,{children:[(0,b.jsx)(a6.AlertDialogTitle,{children:"Delete FAQ?"}),(0,b.jsx)(a6.AlertDialogDescription,{children:"Are you sure you want to delete this FAQ? This action cannot be undone."})]}),(0,b.jsxs)(a6.AlertDialogFooter,{children:[(0,b.jsx)(a6.AlertDialogCancel,{children:"Cancel"}),(0,b.jsx)(a6.AlertDialogAction,{onClick:f,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Delete"})]})]})]})]})]})})})}function a8({dealId:a}){let[f,g]=(0,c.useState)([]),[h,i]=(0,c.useState)(!0),[j,k]=(0,c.useState)(!1),[l,m]=(0,c.useState)(null),n=(0,c.useCallback)(async()=>{try{let b=await fetch(`/api/deals/${a}/faqs`),c=await b.json();g(c.faqs||[])}catch(a){console.error("Error fetching FAQs:",a),af.toast.error("Failed to load FAQs")}finally{i(!1)}},[a]);(0,c.useEffect)(()=>{n()},[n]);let o=async b=>{try{let c=await fetch(`/api/deals/${a}/faqs/${b}`,{method:"DELETE"});if(!c.ok){let a=await c.json();throw Error(a.error||"Failed to delete")}g(f.filter(a=>a.id!==b)),af.toast.success("FAQ deleted successfully")}catch(a){console.error("Error deleting FAQ:",a),af.toast.error(a instanceof Error?a.message:"Failed to delete FAQ")}},p=()=>{m(null),k(!0)};return h?(0,b.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,b.jsx)(r.Loader2,{className:"h-6 w-6 animate-spin text-muted-foreground"})}):(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)(d.Card,{children:[(0,b.jsx)(d.CardHeader,{children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(a4.HelpCircle,{className:"h-5 w-5 text-primary"}),(0,b.jsx)(d.CardTitle,{children:"Deal FAQs"})]}),(0,b.jsx)(d.CardDescription,{className:"mt-2",children:"Manage frequently asked questions for this deal. Investors with data room access can view these FAQs."})]}),(0,b.jsxs)(e.Button,{onClick:p,children:[(0,b.jsx)(z.Plus,{className:"h-4 w-4 mr-2"}),"Add FAQ"]})]})}),(0,b.jsx)(d.CardContent,{children:0===f.length?(0,b.jsxs)("div",{className:"text-center py-12 border-2 border-dashed rounded-lg",children:[(0,b.jsx)(a4.HelpCircle,{className:"h-12 w-12 mx-auto text-muted-foreground mb-4"}),(0,b.jsx)("p",{className:"text-muted-foreground font-medium mb-2",children:"No FAQs yet"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground mb-4",children:"Add frequently asked questions to help investors understand this deal better."}),(0,b.jsxs)(e.Button,{onClick:p,variant:"outline",children:[(0,b.jsx)(z.Plus,{className:"h-4 w-4 mr-2"}),"Add Your First FAQ"]})]}):(0,b.jsx)("div",{className:"space-y-4",children:f.map(a=>(0,b.jsx)(a7,{faq:a,onEdit:()=>{m(a),k(!0)},onDelete:()=>o(a.id)},a.id))})})]}),(0,b.jsx)(a5,{open:j,onOpenChange:a=>{k(a),a||m(null)},dealId:a,faq:l,onSave:()=>{n(),k(!1),m(null)}})]})}let a9={draft:"bg-muted text-foreground border border-border",open:"bg-emerald-500/20 text-emerald-200 border border-emerald-400/30",allocation_pending:"bg-amber-500/15 text-amber-200 border border-amber-400/30",closed:"bg-blue-500/20 text-blue-200 border border-blue-400/30",cancelled:"bg-red-500/20 text-red-200 border border-red-400/30"},ba={equity_secondary:"Secondary",equity_primary:"Primary",credit_trade_finance:"Credit/Trade",other:"Other"};function bb({deal:a,inventorySummary:u,documents:v,termSheets:w,interests:x,dataRoomAccess:z,dataRoomDocuments:A,subscriptions:C,subscriptionsForJourney:D=[],activitySummary:E,userProfile:F,arrangerEntities:G=[]}){let[H,I]=(0,c.useState)("overview"),[J,K]=(0,c.useState)(!1),[L,M]=(0,c.useState)([]),[N,O]=(0,c.useState)(!1),[P,Q]=(0,c.useState)({name:a?.name||"",description:a?.description||"",investment_thesis:a?.investment_thesis||"",status:a?.status||"draft",deal_type:a?.deal_type||"equity_secondary",stock_type:a?.stock_type||"common",company_name:a?.company_name||"",company_website:a?.company_website||"",sector:a?.sector||"",stage:a?.stage||"",location:a?.location||"",open_at:a?.open_at?a.open_at.slice(0,16):"",close_at:a?.close_at?a.close_at.slice(0,16):"",target_amount:a?.target_amount||"",currency:a?.currency||"USD",arranger_entity_id:a?.arranger_entity_id||""}),R=(0,t.useRouter)(),S=async()=>{try{let b=await fetch(`/api/deals/${a.id}/inventory`);if(b.ok){let a=await b.json();M(a.inventory||[])}}catch(a){console.error("Failed to fetch share lots:",a)}};(0,c.useEffect)(()=>{a?.id&&S()},[a?.id]),(0,c.useEffect)(()=>{console.log("[DealDetailClient] Component mounted",{dealId:a?.id,dealName:a?.name,dealStatus:a?.status,hasInventory:!!u,termSheetCount:w?.length||0,interestCount:x?.length||0,userRole:F?.role})},[a,u,w,x,F]);let T=async()=>{O(!0);try{if(!(await fetch(`/api/deals/${a.id}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({...P,target_amount:P.target_amount?parseFloat(P.target_amount):null,arranger_entity_id:"none"!==P.arranger_entity_id&&P.arranger_entity_id?P.arranger_entity_id:null})})).ok)throw Error("Failed to update deal");K(!1),R.refresh()}catch(a){console.error("Error updating deal:",a),alert("Failed to update deal. Please try again.")}finally{O(!1)}},U=w?.find(a=>"published"===a.status),V=x?.filter(a=>"pending_review"===a.status)??[],W=x?.filter(a=>"approved"===a.status)??[],X=z?.filter(a=>!a.revoked_at)??[],Y=C?.filter(a=>"pending_review"===a.status)??[],Z=E?.nda_completed??0,$=E?.subscription_completed??0;return a&&a.id?(0,b.jsxs)("div",{className:"p-6 space-y-6",children:[(0,b.jsxs)("div",{className:"flex items-start justify-between",children:[(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("div",{className:"flex items-center gap-3 mb-2",children:(0,b.jsxs)(e.Button,{variant:"ghost",size:"sm",className:"gap-2 text-foreground hover:text-sky-400 hover:bg-muted",onClick:()=>R.push("/versotech_main/deals"),children:[(0,b.jsx)(p.ArrowLeft,{className:"h-4 w-4"}),"Back to Deals"]})}),(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("h1",{className:"text-3xl font-bold text-foreground",children:a.name}),(0,b.jsx)(f.Badge,{className:a9[a.status],children:a.status.replace("_"," ")}),(0,b.jsx)(f.Badge,{variant:"outline",className:"border-border text-foreground",children:ba[a.deal_type]})]}),a.company_name&&(0,b.jsxs)("p",{className:"text-muted-foreground text-lg",children:[a.company_name,a.sector&&` • ${a.sector}`,a.location&&` • ${a.location}`]})]}),(0,b.jsx)("div",{className:"flex items-center gap-2",children:(0,b.jsxs)(e.Button,{variant:"outline",className:"gap-2 border-border text-foreground hover:bg-muted",onClick:()=>K(!0),children:[(0,b.jsx)(q.Edit,{className:"h-4 w-4"}),"Edit Deal"]})})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,b.jsxs)(d.Card,{className:"border border-border bg-muted/50",children:[(0,b.jsxs)(d.CardHeader,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,b.jsx)(d.CardTitle,{className:"text-sm font-medium text-muted-foreground",children:"Interest Signals"}),(0,b.jsx)(o.HandCoins,{className:"h-4 w-4 text-muted-foreground"})]}),(0,b.jsxs)(d.CardContent,{children:[(0,b.jsx)("div",{className:"text-2xl font-bold text-foreground",children:x?.length??0}),(0,b.jsxs)("p",{className:"text-xs text-muted-foreground",children:[V.length," awaiting review"]})]})]}),(0,b.jsxs)(d.Card,{className:"border border-border bg-muted/50",children:[(0,b.jsxs)(d.CardHeader,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,b.jsx)(d.CardTitle,{className:"text-sm font-medium text-muted-foreground",children:"Active NDAs"}),(0,b.jsx)(n.FileText,{className:"h-4 w-4 text-muted-foreground"})]}),(0,b.jsxs)(d.CardContent,{children:[(0,b.jsx)("div",{className:"text-2xl font-bold text-foreground",children:X.length}),(0,b.jsxs)("p",{className:"text-xs text-muted-foreground",children:[W.length," interests approved"]})]})]}),(0,b.jsxs)(d.Card,{className:"border border-border bg-muted/50",children:[(0,b.jsxs)(d.CardHeader,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,b.jsx)(d.CardTitle,{className:"text-sm font-medium text-muted-foreground",children:"Published Term Sheet"}),(0,b.jsx)(m.Package,{className:"h-4 w-4 text-muted-foreground"})]}),(0,b.jsxs)(d.CardContent,{children:[(0,b.jsx)("div",{className:"text-2xl font-bold text-foreground",children:U?`V${U.version}`:"—"}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:U?`Published ${U.published_at?new Date(U.published_at).toLocaleDateString():""}`:"No published version"})]})]}),(0,b.jsxs)(d.Card,{className:"border border-border bg-muted/50",children:[(0,b.jsxs)(d.CardHeader,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,b.jsx)(d.CardTitle,{className:"text-sm font-medium text-muted-foreground",children:"Subscriptions"}),(0,b.jsx)(m.Package,{className:"h-4 w-4 text-muted-foreground"})]}),(0,b.jsxs)(d.CardContent,{children:[(0,b.jsx)("div",{className:"text-2xl font-bold text-foreground",children:C?.length??0}),(0,b.jsxs)("p",{className:"text-xs text-muted-foreground",children:[Y.length," awaiting approval"]})]})]}),(0,b.jsxs)(d.Card,{className:"border border-border bg-muted/50",children:[(0,b.jsxs)(d.CardHeader,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,b.jsx)(d.CardTitle,{className:"text-sm font-medium text-muted-foreground",children:"Conversions (90d)"}),(0,b.jsx)(f.Badge,{variant:"outline",children:"Analytics"})]}),(0,b.jsx)(d.CardContent,{children:(0,b.jsxs)("div",{className:"flex flex-col gap-1 text-xs text-muted-foreground",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("span",{children:"NDA completed"}),(0,b.jsx)("span",{className:"font-semibold text-foreground",children:Z})]}),(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("span",{children:"Subscriptions funded"}),(0,b.jsx)("span",{className:"font-semibold text-foreground",children:$})]})]})})]})]}),(0,b.jsxs)(g.Tabs,{defaultValue:"overview",value:H,onValueChange:I,id:`deal-tabs-${a.id}`,children:[(0,b.jsxs)(g.TabsList,{className:"flex flex-wrap gap-2",children:[(0,b.jsx)(g.TabsTrigger,{value:"overview",children:"Overview"}),(0,b.jsx)(g.TabsTrigger,{value:"term-sheet",children:"Term Sheets"}),(0,b.jsx)(g.TabsTrigger,{value:"interests",children:"Interests"}),(0,b.jsx)(g.TabsTrigger,{value:"data-room",children:"Data Room"}),(0,b.jsx)(g.TabsTrigger,{value:"inventory",children:"Inventory"}),(0,b.jsx)(g.TabsTrigger,{value:"members",children:"Members"}),(0,b.jsx)(g.TabsTrigger,{value:"fees",children:"Fee Plans"}),(0,b.jsx)(g.TabsTrigger,{value:"subscriptions",children:"Subscriptions"}),(0,b.jsx)(g.TabsTrigger,{value:"documents",children:"Documents"}),(0,b.jsx)(g.TabsTrigger,{value:"faq",children:"FAQ"}),(0,b.jsx)(g.TabsTrigger,{value:"activity",children:"Activity"})]}),(0,b.jsx)(g.TabsContent,{value:"overview",children:(0,b.jsx)(y,{deal:a,memberships:a.deal_memberships||[],subscriptionsForJourney:D})}),(0,b.jsx)(g.TabsContent,{value:"term-sheet",children:(0,b.jsx)(aW,{dealId:a.id,termSheets:w})}),(0,b.jsx)(g.TabsContent,{value:"interests",children:(0,b.jsx)(aZ,{dealId:a.id,interests:x,subscriptions:C})}),(0,b.jsx)(g.TabsContent,{value:"data-room",children:(0,b.jsx)(a2,{dealId:a.id,dealName:a.name,memberships:a.deal_memberships||[],accessRecords:z,documents:A})}),(0,b.jsx)(g.TabsContent,{value:"inventory",children:(0,b.jsx)(B,{dealId:a.id,shareLots:L,inventorySummary:u,onRefresh:()=>{S()}})}),(0,b.jsx)(g.TabsContent,{value:"members",children:(0,b.jsx)(aa,{dealId:a.id,members:a.deal_memberships||[],subscriptions:D})}),(0,b.jsx)(g.TabsContent,{value:"fees",children:(0,b.jsx)(ah,{dealId:a.id,feePlans:a.fee_plans||[]})}),(0,b.jsx)(g.TabsContent,{value:"subscriptions",children:(0,b.jsx)(a3,{dealId:a.id})}),(0,b.jsx)(g.TabsContent,{value:"documents",children:(0,b.jsx)(au,{dealId:a.id,documents:v})}),(0,b.jsx)(g.TabsContent,{value:"faq",children:(0,b.jsx)(a8,{dealId:a.id})}),(0,b.jsx)(g.TabsContent,{value:"activity",children:(0,b.jsx)(aH,{dealId:a.id})})]}),(0,b.jsx)(h.Dialog,{open:J,onOpenChange:K,children:(0,b.jsxs)(h.DialogContent,{className:"sm:max-w-3xl max-h-[90vh] overflow-y-auto",children:[(0,b.jsxs)(h.DialogHeader,{children:[(0,b.jsx)(h.DialogTitle,{children:"Edit Deal"}),(0,b.jsx)(h.DialogDescription,{children:"Update deal information. Changes will be reflected immediately."})]}),(0,b.jsxs)("div",{className:"space-y-6 py-4",children:[(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{className:"space-y-2 md:col-span-2",children:[(0,b.jsx)(j.Label,{htmlFor:"edit-name",children:"Deal Name *"}),(0,b.jsx)(i.Input,{id:"edit-name",value:P.name,onChange:a=>Q({...P,name:a.target.value}),placeholder:"e.g., Revolut Secondary 2025"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(j.Label,{htmlFor:"edit-status",children:"Status"}),(0,b.jsxs)(l.Select,{value:P.status,onValueChange:a=>Q({...P,status:a}),children:[(0,b.jsx)(l.SelectTrigger,{id:"edit-status",children:(0,b.jsx)(l.SelectValue,{})}),(0,b.jsxs)(l.SelectContent,{children:[(0,b.jsx)(l.SelectItem,{value:"draft",children:"Draft"}),(0,b.jsx)(l.SelectItem,{value:"open",children:"Open"}),(0,b.jsx)(l.SelectItem,{value:"allocation_pending",children:"Allocation Pending"}),(0,b.jsx)(l.SelectItem,{value:"closed",children:"Closed"}),(0,b.jsx)(l.SelectItem,{value:"cancelled",children:"Cancelled"})]})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(j.Label,{htmlFor:"edit-deal-type",children:"Deal Type"}),(0,b.jsxs)(l.Select,{value:P.deal_type,onValueChange:a=>Q({...P,deal_type:a}),children:[(0,b.jsx)(l.SelectTrigger,{id:"edit-deal-type",children:(0,b.jsx)(l.SelectValue,{})}),(0,b.jsxs)(l.SelectContent,{children:[(0,b.jsx)(l.SelectItem,{value:"equity_secondary",children:"Secondary"}),(0,b.jsx)(l.SelectItem,{value:"equity_primary",children:"Primary"}),(0,b.jsx)(l.SelectItem,{value:"credit_trade_finance",children:"Credit/Trade Finance"}),(0,b.jsx)(l.SelectItem,{value:"other",children:"Other"})]})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(j.Label,{htmlFor:"edit-stock-type",children:"Stock Type"}),(0,b.jsxs)(l.Select,{value:P.stock_type,onValueChange:a=>Q({...P,stock_type:a}),children:[(0,b.jsx)(l.SelectTrigger,{id:"edit-stock-type",children:(0,b.jsx)(l.SelectValue,{})}),(0,b.jsxs)(l.SelectContent,{children:[(0,b.jsx)(l.SelectItem,{value:"common",children:"Common/Ordinary Shares"}),(0,b.jsx)(l.SelectItem,{value:"preferred",children:"Preferred Shares"}),(0,b.jsx)(l.SelectItem,{value:"convertible",children:"Convertible Notes"}),(0,b.jsx)(l.SelectItem,{value:"warrant",children:"Warrants"}),(0,b.jsx)(l.SelectItem,{value:"bond",children:"Bonds"}),(0,b.jsx)(l.SelectItem,{value:"note",children:"Notes"}),(0,b.jsx)(l.SelectItem,{value:"other",children:"Other"})]})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(j.Label,{htmlFor:"edit-company-name",children:"Company Name"}),(0,b.jsx)(i.Input,{id:"edit-company-name",value:P.company_name,onChange:a=>Q({...P,company_name:a.target.value}),placeholder:"e.g., Revolut Ltd"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(j.Label,{htmlFor:"edit-company-website",children:"Company Website"}),(0,b.jsx)(i.Input,{id:"edit-company-website",type:"url",value:P.company_website,onChange:a=>Q({...P,company_website:a.target.value}),placeholder:"https://..."})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(j.Label,{htmlFor:"edit-sector",children:"Sector"}),(0,b.jsx)(i.Input,{id:"edit-sector",value:P.sector,onChange:a=>Q({...P,sector:a.target.value}),placeholder:"e.g., Fintech"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(j.Label,{htmlFor:"edit-stage",children:"Stage"}),(0,b.jsx)(i.Input,{id:"edit-stage",value:P.stage,onChange:a=>Q({...P,stage:a.target.value}),placeholder:"e.g., Series E"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(j.Label,{htmlFor:"edit-location",children:"Location"}),(0,b.jsx)(i.Input,{id:"edit-location",value:P.location,onChange:a=>Q({...P,location:a.target.value}),placeholder:"e.g., London, UK"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(j.Label,{htmlFor:"edit-currency",children:"Currency"}),(0,b.jsxs)(l.Select,{value:P.currency,onValueChange:a=>Q({...P,currency:a}),children:[(0,b.jsx)(l.SelectTrigger,{id:"edit-currency",children:(0,b.jsx)(l.SelectValue,{})}),(0,b.jsxs)(l.SelectContent,{children:[(0,b.jsx)(l.SelectItem,{value:"USD",children:"USD"}),(0,b.jsx)(l.SelectItem,{value:"EUR",children:"EUR"}),(0,b.jsx)(l.SelectItem,{value:"GBP",children:"GBP"})]})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(j.Label,{htmlFor:"edit-arranger",children:"Arranger (Mandate)"}),(0,b.jsxs)(l.Select,{value:P.arranger_entity_id||"none",onValueChange:a=>Q({...P,arranger_entity_id:"none"===a?"":a}),children:[(0,b.jsx)(l.SelectTrigger,{id:"edit-arranger",children:(0,b.jsx)(l.SelectValue,{placeholder:"Select arranger"})}),(0,b.jsxs)(l.SelectContent,{children:[(0,b.jsx)(l.SelectItem,{value:"none",children:"No Arranger"}),G.map(a=>(0,b.jsx)(l.SelectItem,{value:a.id,children:a.company_name||a.legal_name},a.id))]})]}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"Assign an arranger to manage this deal as their mandate"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(j.Label,{htmlFor:"edit-open-at",children:"Open Date"}),(0,b.jsx)(i.Input,{id:"edit-open-at",type:"datetime-local",value:P.open_at,onChange:a=>Q({...P,open_at:a.target.value})})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(j.Label,{htmlFor:"edit-close-at",children:"Close Date"}),(0,b.jsx)(i.Input,{id:"edit-close-at",type:"datetime-local",value:P.close_at,onChange:a=>Q({...P,close_at:a.target.value})})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(j.Label,{htmlFor:"edit-target-amount",children:"Target Amount"}),(0,b.jsx)(i.Input,{id:"edit-target-amount",type:"number",step:"1",value:P.target_amount,onChange:a=>Q({...P,target_amount:a.target.value}),placeholder:"e.g., 5000000"}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"Investment terms (price, min/max) are set in the Term Sheet"})]}),(0,b.jsxs)("div",{className:"space-y-2 md:col-span-2",children:[(0,b.jsx)(j.Label,{htmlFor:"edit-description",children:"Description"}),(0,b.jsx)(k.Textarea,{id:"edit-description",rows:3,value:P.description,onChange:a=>Q({...P,description:a.target.value}),placeholder:"Brief description of the deal..."})]}),(0,b.jsxs)("div",{className:"space-y-2 md:col-span-2",children:[(0,b.jsx)(j.Label,{htmlFor:"edit-investment-thesis",children:"Investment Thesis"}),(0,b.jsx)(k.Textarea,{id:"edit-investment-thesis",rows:3,value:P.investment_thesis,onChange:a=>Q({...P,investment_thesis:a.target.value}),placeholder:"Why this is a good investment opportunity..."})]})]}),(0,b.jsxs)("div",{className:"flex justify-end gap-2 pt-4",children:[(0,b.jsx)(e.Button,{variant:"outline",onClick:()=>K(!1),disabled:N,children:"Cancel"}),(0,b.jsxs)(e.Button,{onClick:T,disabled:N||!P.name,children:[N&&(0,b.jsx)(r.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),"Save Changes"]})]})]})]})})]}):(0,b.jsx)("div",{className:"p-6",children:(0,b.jsx)(d.Card,{className:"border border-destructive/50 bg-destructive/10",children:(0,b.jsxs)(d.CardContent,{className:"p-6 text-center text-foreground",children:[(0,b.jsx)("p",{children:"Unable to load deal details"}),(0,b.jsx)(s.default,{href:"/versotech_main/deals",children:(0,b.jsx)(e.Button,{variant:"outline",className:"mt-4",children:"Back to Deals"})})]})})})}a.s(["DealDetailClient",()=>bb],716616)}];

//# sourceMappingURL=versotech-portal_src_components_deals_deal-detail-client_tsx_20b94a40._.js.map