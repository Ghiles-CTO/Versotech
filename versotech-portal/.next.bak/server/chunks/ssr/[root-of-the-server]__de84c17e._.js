module.exports=[193695,(a,b,c)=>{b.exports=a.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},9349,a=>{a.n(a.i(142710))},199585,a=>{a.n(a.i(701395))},929852,a=>{a.n(a.i(816404))},516153,a=>{a.n(a.i(422096))},911164,a=>{a.n(a.i(273021))},450926,a=>{a.n(a.i(933743))},105109,a=>{"use strict";var b=a.i(596942),c=a.i(198307);async function d(a,b){try{let{count:c,error:d}=await a;if(d)return console.error(`[dashboard-data] Error fetching ${b}:`,d.message),{count:null,error:d.message};return{count:c??0,error:null}}catch(c){let a=c instanceof Error?c.message:"Unknown error";return console.error(`[dashboard-data] Exception fetching ${b}:`,a),{count:null,error:a}}}async function e(a,b){let{data:c,error:d}=await a.rpc("aggregate_fee_events_by_date",{start_date:b});return d?(console.error("[dashboard-data] Error fetching aggregated fee data:",d),{data:null,error:d}):{data:c,error:null}}async function f(a,b){let{data:c,error:d}=await a.rpc("aggregate_subscriptions_by_date",{start_date:b});return d?(console.error("[dashboard-data] Error fetching aggregated subscription data:",d),{data:null,error:d}):{data:c,error:null}}function g(a,b,c){let d=new Map;return a.forEach(a=>{if(!a[b])return;let e=new Date(a[b]).toISOString().split("T")[0],f=Number(a[c])||0;d.has(e)||d.set(e,{date:e,amount:0});let g=d.get(e);g.amount+=f}),Array.from(d.values()).sort((a,b)=>a.date.localeCompare(b.date))}async function h(a){let b,h,i=(0,c.createServiceClient)(),j=[],k=new Date(Date.UTC((b=new Date).getUTCFullYear(),b.getUTCMonth(),1)).toISOString(),l=a?.from?new Date(a.from).toISOString():((h=new Date).setFullYear(h.getFullYear()-1),h.toISOString()),[m,n,o,p,q,r,s,t,u,v,w,x,y,z]=await Promise.all([d(i.from("investors").select("id",{head:!0,count:"exact"}).eq("status","active"),"Active LPs"),d(i.from("investors").select("id",{head:!0,count:"exact"}).in("kyc_status",["pending","review","completed"]),"Pending KYC"),d(i.from("tasks").select("id",{head:!0,count:"exact"}).in("kind",["kyc_individual","kyc_entity","kyc_aml_check","onboarding_profile","compliance_tax_forms"]).in("status",["pending","in_progress"]).eq("priority","high"),"High Priority KYC"),d(i.from("workflow_runs").select("id",{head:!0,count:"exact"}).gte("created_at",k),"Workflow Runs (MTD)"),d(i.from("investors").select("id",{head:!0,count:"exact"}),"Total Investors"),d(i.from("investors").select("id",{head:!0,count:"exact"}).eq("kyc_status","approved"),"Compliant Investors"),d(i.from("workflows").select("id",{head:!0,count:"exact"}).eq("is_active",!0),"Active Workflows"),d(i.from("deals").select("id",{head:!0,count:"exact"}).in("status",["open","allocation_pending","draft"]),"Active Deals"),d(i.from("request_tickets").select("id",{head:!0,count:"exact"}).in("status",["open","assigned","in_progress"]),"Active Requests"),i.from("fee_events").select("id, computed_amount, fee_type, created_at").order("created_at",{ascending:!1}).limit(5),i.from("subscriptions").select("id, commitment, status, created_at").order("created_at",{ascending:!1}).limit(5),i.from("investors").select("id, status, kyc_status, created_at").order("created_at",{ascending:!1}).limit(5),e(i,l),f(i,l)]);v.error&&j.push({metric:"Latest Fees",message:v.error.message}),w.error&&j.push({metric:"Latest Subscriptions",message:w.error.message}),x.error&&j.push({metric:"Latest Investors",message:x.error.message});let A=q.count??0,B=r.count??0,C=A>0?B/A*100:null,D=[],E=[];if(y.error){j.push({metric:"Fee Chart Data",message:y.error.message});let a=await i.from("fee_events").select("computed_amount, created_at, fee_type").gte("created_at",l).order("created_at",{ascending:!0});!a.error&&a.data&&(D=g(a.data,"created_at","computed_amount"))}else D=y.data??[];if(z.error){j.push({metric:"Subscription Chart Data",message:z.error.message});let a=await i.from("subscriptions").select("commitment, created_at, status").gte("created_at",l).order("created_at",{ascending:!0});!a.error&&a.data&&(E=g(a.data,"created_at","commitment"))}else E=z.data??[];let F=[];v.data?.forEach(a=>{F.push({id:a.id,title:"Fee Calculated",description:`${a.fee_type} fee of $${a.computed_amount?.toLocaleString()}`,activityType:"fee",createdAt:a.created_at,amount:a.computed_amount,status:"processed"})}),w.data?.forEach(a=>{F.push({id:a.id,title:"New Subscription",description:`Commitment: $${a.commitment?.toLocaleString()??"0"}`,activityType:"subscription",createdAt:a.created_at,amount:a.commitment,status:a.status})}),x.data?.forEach(a=>{F.push({id:a.id,title:"Investor Update",description:`Status: ${a.status}, KYC: ${a.kyc_status}`,activityType:"investor",createdAt:a.created_at,status:a.kyc_status})}),F.sort((a,b)=>new Date(b.createdAt).getTime()-new Date(a.createdAt).getTime());let G=F.slice(0,10);[{name:"Active LPs",result:m},{name:"Pending KYC",result:n},{name:"High Priority KYC",result:o},{name:"Workflow Runs (MTD)",result:p},{name:"Total Investors",result:q},{name:"Compliant Investors",result:r},{name:"Active Workflows",result:s},{name:"Active Deals",result:t},{name:"Active Requests",result:u}].forEach(({name:a,result:b})=>{b.error&&j.push({metric:a,message:b.error})});let H={generatedAt:new Date().toISOString(),kpis:{activeLps:m.count,pendingKyc:n.count,highPriorityKyc:o.count,workflowRunsThisMonth:p.count,complianceRate:C},processCenter:{activeWorkflows:s.count},management:{activeDeals:t.count,activeRequests:u.count,complianceRate:C,activeInvestors:m.count},recentActivity:G,charts:{fees:D.map(a=>({...a,type:a.type||"total"})),subscriptions:E.map(a=>({...a,status:a.status||"active"}))}};return j.length>0&&(H.errors=j),H}async function i(a,c=!1){if(c)return console.log("[Dashboard Cache] Force refresh requested, bypassing cache"),await h(a);let d=a?.from||a?.to?`staff-dashboard-data-${a.from?.toString()}-${a.to?.toString()}`:"staff-dashboard-data-default",e=(0,b.unstable_cache)(async()=>(console.log("[Dashboard Cache] Fetching fresh data from database for range:",a),await h(a)),[d],{revalidate:300,tags:["staff-dashboard"]});return await e()}a.s(["getCachedStaffDashboardData",()=>i],105109)},893121,a=>{"use strict";a.s(["CEODashboard",()=>b]);let b=(0,a.i(578644).registerClientReference)(function(){throw Error("Attempted to call CEODashboard() from the server but CEODashboard is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/versotech-portal/src/app/(main)/versotech_main/dashboard/ceo-dashboard.tsx <module evaluation>","CEODashboard")},923596,a=>{"use strict";a.s(["CEODashboard",()=>b]);let b=(0,a.i(578644).registerClientReference)(function(){throw Error("Attempted to call CEODashboard() from the server but CEODashboard is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/versotech-portal/src/app/(main)/versotech_main/dashboard/ceo-dashboard.tsx","CEODashboard")},538811,a=>{"use strict";a.i(893121);var b=a.i(923596);a.n(b)},232723,a=>{"use strict";a.s(["PersonaDashboard",()=>b]);let b=(0,a.i(578644).registerClientReference)(function(){throw Error("Attempted to call PersonaDashboard() from the server but PersonaDashboard is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/versotech-portal/src/app/(main)/versotech_main/dashboard/persona-dashboard.tsx <module evaluation>","PersonaDashboard")},78672,a=>{"use strict";a.s(["PersonaDashboard",()=>b]);let b=(0,a.i(578644).registerClientReference)(function(){throw Error("Attempted to call PersonaDashboard() from the server but PersonaDashboard is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/versotech-portal/src/app/(main)/versotech_main/dashboard/persona-dashboard.tsx","PersonaDashboard")},658779,a=>{"use strict";a.i(232723);var b=a.i(78672);a.n(b)},995208,a=>{"use strict";var b=a.i(714898),c=a.i(243085);a.i(937413);var d=a.i(131360),e=a.i(621599),f=a.i(538811),g=a.i(658779),h=a.i(105109);async function i(){let a=await (0,c.getCurrentUser)();a||(0,d.redirect)("/versotech_main/login");let i=await (0,e.cookies)(),j=i.get("verso_active_persona_type")?.value;if(("staff_admin"===a.role||"ceo"===a.role)&&(!j||"ceo"===j||"staff"===j)){let a=await (0,h.getCachedStaffDashboardData)(),c={activeLps:a.kpis.activeLps??0,pendingKyc:a.kpis.pendingKyc??0,workflowRuns:a.kpis.workflowRunsThisMonth??0,complianceRate:a.kpis.complianceRate??0,kycPipeline:a.kpis.highPriorityKyc??0,ndaInProgress:0,subscriptionReview:0,activeDeals:a.management.activeDeals??0,activeRequests:a.management.activeRequests??0,lastUpdated:a.generatedAt};return(0,b.jsx)(f.CEODashboard,{dashboardData:a,realtimeMetrics:c})}return(0,b.jsx)(g.PersonaDashboard,{})}a.s(["default",()=>i,"dynamic",0,"force-dynamic"])},346946,a=>{a.v(a=>Promise.resolve().then(()=>a(596942)))}];

//# sourceMappingURL=%5Broot-of-the-server%5D__de84c17e._.js.map