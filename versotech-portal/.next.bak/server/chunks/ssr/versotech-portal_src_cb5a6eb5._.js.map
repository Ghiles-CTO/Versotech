{"version":3,"sources":["../../../../../versotech-portal/src/components/signature/signature-canvas-widget.tsx","../../../../../versotech-portal/src/components/signature/inline-pdf-viewer.tsx","../../../../../versotech-portal/src/app/%28staff%29/versotech/staff/versosign/versosign-page-client.tsx"],"sourcesContent":["'use client'\r\n\r\nimport { useRef, useState } from 'react'\r\nimport { Button } from '@/components/ui/button'\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card'\r\nimport { Loader2, RotateCcw } from 'lucide-react'\r\nimport SignatureCanvas from 'react-signature-canvas'\r\n\r\ninterface SignatureCanvasWidgetProps {\r\n  onSignatureCapture: (dataUrl: string) => Promise<void>\r\n  signerName: string\r\n  signerEmail: string\r\n  isSubmitting?: boolean\r\n}\r\n\r\nexport function SignatureCanvasWidget({\r\n  onSignatureCapture,\r\n  signerName,\r\n  signerEmail,\r\n  isSubmitting = false\r\n}: SignatureCanvasWidgetProps) {\r\n  const sigCanvasRef = useRef<SignatureCanvas>(null)\r\n  const [hasDrawn, setHasDrawn] = useState(false)\r\n\r\n  const handleDrawEnd = () => {\r\n    if (sigCanvasRef.current && !sigCanvasRef.current.isEmpty()) {\r\n      setHasDrawn(true)\r\n    }\r\n  }\r\n\r\n  const handleClear = () => {\r\n    if (sigCanvasRef.current) {\r\n      sigCanvasRef.current.clear()\r\n      setHasDrawn(false)\r\n    }\r\n  }\r\n\r\n  const handleSubmit = async () => {\r\n    if (!sigCanvasRef.current || sigCanvasRef.current.isEmpty()) return\r\n\r\n    // Get trimmed canvas (removes whitespace around signature)\r\n    const trimmedCanvas = sigCanvasRef.current.getTrimmedCanvas()\r\n    const dataUrl = trimmedCanvas.toDataURL('image/png')\r\n    await onSignatureCapture(dataUrl)\r\n  }\r\n\r\n  return (\r\n    <Card className=\"h-full\">\r\n      <CardHeader>\r\n        <CardTitle>Sign Document</CardTitle>\r\n        <CardDescription>\r\n          Draw your signature below to execute this document\r\n        </CardDescription>\r\n      </CardHeader>\r\n      <CardContent className=\"space-y-4\">\r\n        <div className=\"space-y-2\">\r\n          <p className=\"text-sm text-muted-foreground\">Signing as:</p>\r\n          <div className=\"rounded-lg bg-muted p-3\">\r\n            <p className=\"font-semibold\">{signerName}</p>\r\n            <p className=\"text-sm text-muted-foreground\">{signerEmail}</p>\r\n          </div>\r\n        </div>\r\n\r\n        <div>\r\n          <p className=\"text-sm font-medium mb-2\">Your Signature</p>\r\n          <div className=\"border-2 border-border rounded-lg bg-white dark:bg-zinc-100 overflow-hidden\">\r\n            <SignatureCanvas\r\n              ref={sigCanvasRef}\r\n              canvasProps={{\r\n                className: 'w-full cursor-crosshair',\r\n                style: { width: '100%', height: '192px' }\r\n              }}\r\n              penColor=\"black\"\r\n              backgroundColor=\"white\"\r\n              onEnd={handleDrawEnd}\r\n            />\r\n          </div>\r\n          <p className=\"text-xs text-muted-foreground mt-2\">\r\n            Draw your signature using your mouse or touchscreen\r\n          </p>\r\n        </div>\r\n\r\n        <div className=\"flex gap-2 pt-4\">\r\n          <Button\r\n            variant=\"outline\"\r\n            onClick={handleClear}\r\n            disabled={!hasDrawn || isSubmitting}\r\n            className=\"flex-1\"\r\n          >\r\n            <RotateCcw className=\"h-4 w-4 mr-2\" />\r\n            Clear\r\n          </Button>\r\n          <Button\r\n            onClick={handleSubmit}\r\n            disabled={!hasDrawn || isSubmitting}\r\n            className=\"flex-1\"\r\n          >\r\n            {isSubmitting ? (\r\n              <>\r\n                <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />\r\n                Submitting...\r\n              </>\r\n            ) : (\r\n              'Submit Signature'\r\n            )}\r\n          </Button>\r\n        </div>\r\n      </CardContent>\r\n    </Card>\r\n  )\r\n}\r\n","'use client'\r\n\r\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card'\r\nimport { Button } from '@/components/ui/button'\r\nimport { FileText, ExternalLink } from 'lucide-react'\r\n\r\ninterface InlinePdfViewerProps {\r\n  pdfUrl: string\r\n  documentName: string\r\n}\r\n\r\nexport function InlinePdfViewer({ pdfUrl, documentName }: InlinePdfViewerProps) {\r\n  return (\r\n    <Card className=\"h-full\">\r\n      <CardHeader>\r\n        <div className=\"flex items-center justify-between\">\r\n          <div className=\"flex items-center gap-2\">\r\n            <FileText className=\"h-5 w-5\" />\r\n            <CardTitle className=\"text-lg\">{documentName}</CardTitle>\r\n          </div>\r\n          <Button variant=\"outline\" size=\"sm\" asChild>\r\n            <a href={pdfUrl} target=\"_blank\" rel=\"noopener noreferrer\">\r\n              Open in New Tab\r\n              <ExternalLink className=\"h-4 w-4 ml-2\" />\r\n            </a>\r\n          </Button>\r\n        </div>\r\n      </CardHeader>\r\n      <CardContent>\r\n        <div className=\"border rounded-lg bg-gray-50 overflow-hidden\" style={{ height: '600px' }}>\r\n          <iframe\r\n            src={pdfUrl}\r\n            className=\"w-full h-full\"\r\n            title={documentName}\r\n          />\r\n        </div>\r\n      </CardContent>\r\n    </Card>\r\n  )\r\n}\r\n","'use client'\r\n\r\nimport { useState, useEffect } from 'react'\r\nimport { useRouter } from 'next/navigation'\r\nimport { createClient } from '@/lib/supabase/client'\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card'\r\nimport { Badge } from '@/components/ui/badge'\r\nimport { Button } from '@/components/ui/button'\r\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs'\r\nimport { Alert, AlertDescription, AlertTitle } from '@/components/ui/alert'\r\nimport {\r\n  CheckCircle2,\r\n  Clock,\r\n  AlertCircle,\r\n  FileSignature,\r\n  ExternalLink,\r\n  Users,\r\n  Mail,\r\n  Calendar,\r\n  AlertTriangle,\r\n  ArrowLeft\r\n} from 'lucide-react'\r\nimport { format } from 'date-fns'\r\nimport { SignatureCanvasWidget } from '@/components/signature/signature-canvas-widget'\r\nimport { InlinePdfViewer } from '@/components/signature/inline-pdf-viewer'\r\nimport type { SignatureGroup, ExpiredSignature } from './page'\r\nimport type { SignatureTask } from './page'\r\n\r\ninterface SignatureRequestPublicView {\r\n  signing_token: string\r\n  signer_name: string\r\n  signer_email: string\r\n  document_type: string\r\n  unsigned_pdf_url?: string\r\n  google_drive_url?: string\r\n  token_expires_at: string\r\n  status: string\r\n}\r\n\r\ninterface VersoSignPageClientProps {\r\n  userId: string\r\n  signatureGroups: SignatureGroup[]\r\n  stats: {\r\n    pending: number\r\n    in_progress: number\r\n    completed_today: number\r\n    overdue: number\r\n    expired: number\r\n  }\r\n}\r\n\r\nexport function VersoSignPageClient({\r\n  userId,\r\n  signatureGroups,\r\n  stats\r\n}: VersoSignPageClientProps) {\r\n  const router = useRouter()\r\n  const [selectedTab, setSelectedTab] = useState('countersignatures')\r\n  const [loadingTaskId, setLoadingTaskId] = useState<string | null>(null)\r\n  const [signingMode, setSigningMode] = useState<{\r\n    active: boolean\r\n    task: SignatureTask | null\r\n    signatureRequest: SignatureRequestPublicView | null\r\n    token: string | null\r\n  }>({ active: false, task: null, signatureRequest: null, token: null })\r\n  const [isSubmitting, setIsSubmitting] = useState(false)\r\n  const [error, setError] = useState<string | null>(null)\r\n\r\n  // Extract token from signing URL\r\n  // Supports both old format (/sign/TOKEN) and new format (?token=TOKEN)\r\n  const extractTokenFromUrl = (url: string): string | null => {\r\n    // Try new format first: ?token=TOKEN or &token=TOKEN\r\n    const queryMatch = url.match(/[?&]token=([^&]+)/)\r\n    if (queryMatch) return queryMatch[1]\r\n\r\n    // Fall back to old format: /sign/TOKEN\r\n    const pathMatch = url.match(/\\/sign\\/([^\\/\\?]+)/)\r\n    return pathMatch ? pathMatch[1] : null\r\n  }\r\n\r\n  const handleSignDocument = async (task: SignatureTask) => {\r\n    if (!task.instructions?.action_url) {\r\n      setError('No signature URL available')\r\n      return\r\n    }\r\n\r\n    const token = extractTokenFromUrl(task.instructions.action_url)\r\n    if (!token) {\r\n      setError('Invalid signature URL')\r\n      return\r\n    }\r\n\r\n    setLoadingTaskId(task.id)\r\n    setError(null)\r\n\r\n    try {\r\n      // Fetch signature request details\r\n      const response = await fetch(`/api/signature/${token}`)\r\n      if (!response.ok) {\r\n        // Handle specific error cases\r\n        if (response.status === 410) {\r\n          throw new Error('This signature request has expired. Please check the \"Expired\" tab or resend the signature request.')\r\n        } else if (response.status === 400) {\r\n          const errorData = await response.json().catch(() => ({}))\r\n          throw new Error(errorData.error || 'This signature request is no longer valid.')\r\n        } else if (response.status === 404) {\r\n          throw new Error('Signature request not found. It may have been deleted or never created.')\r\n        }\r\n        throw new Error('Failed to fetch signature request')\r\n      }\r\n\r\n      const signatureRequest = await response.json()\r\n\r\n      // Enter signing mode with token\r\n      setSigningMode({\r\n        active: true,\r\n        task,\r\n        signatureRequest,\r\n        token\r\n      })\r\n\r\n      // Mark task as in progress\r\n      await fetch('/api/tasks', {\r\n        method: 'PATCH',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({\r\n          id: task.id,\r\n          status: 'in_progress',\r\n          started_at: new Date().toISOString()\r\n        })\r\n      })\r\n    } catch (error) {\r\n      console.error('Error entering signing mode:', error)\r\n      setError(error instanceof Error ? error.message : 'Failed to load signature request')\r\n    } finally {\r\n      setLoadingTaskId(null)\r\n    }\r\n  }\r\n\r\n  const handleExitSigningMode = () => {\r\n    setSigningMode({ active: false, task: null, signatureRequest: null, token: null })\r\n    setError(null)\r\n  }\r\n\r\n  const handleSignatureSubmit = async (signatureDataUrl: string) => {\r\n    if (!signingMode.signatureRequest || !signingMode.token) return\r\n\r\n    setIsSubmitting(true)\r\n    setError(null)\r\n\r\n    try {\r\n      const response = await fetch('/api/signature/submit', {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({\r\n          token: signingMode.token,\r\n          signature_data_url: signatureDataUrl\r\n        })\r\n      })\r\n\r\n      if (!response.ok) {\r\n        const errorData = await response.json()\r\n        throw new Error(errorData.error || 'Failed to submit signature')\r\n      }\r\n\r\n      // Exit signing mode\r\n      handleExitSigningMode()\r\n\r\n      // Refresh the page to update task list\r\n      router.refresh()\r\n    } catch (error) {\r\n      console.error('Error submitting signature:', error)\r\n      setError(error instanceof Error ? error.message : 'Failed to submit signature')\r\n    } finally {\r\n      setIsSubmitting(false)\r\n    }\r\n  }\r\n\r\n  // Real-time task updates\r\n  useEffect(() => {\r\n    const supabase = createClient()\r\n\r\n    const subscription = supabase\r\n      .channel('versosign_tasks')\r\n      .on(\r\n        'postgres_changes',\r\n        {\r\n          event: 'UPDATE',\r\n          schema: 'public',\r\n          table: 'tasks',\r\n          filter: `owner_user_id=eq.${userId}`\r\n        },\r\n        (payload) => {\r\n          console.log('Task updated:', payload)\r\n          router.refresh()\r\n        }\r\n      )\r\n      .on(\r\n        'postgres_changes',\r\n        {\r\n          event: 'INSERT',\r\n          schema: 'public',\r\n          table: 'tasks',\r\n          filter: `owner_user_id=eq.${userId}`\r\n        },\r\n        (payload) => {\r\n          console.log('New task created:', payload)\r\n          router.refresh()\r\n        }\r\n      )\r\n      .subscribe()\r\n\r\n    return () => {\r\n      subscription.unsubscribe()\r\n    }\r\n  }, [userId, router])\r\n\r\n  const handleManualFollowUp = async (task: SignatureTask) => {\r\n    const message = `\r\nInvestor: ${task.metadata?.investor_name || 'Unknown'}\r\nEmail: ${task.instructions?.investor_email || 'Not available'}\r\nSignature URL: ${task.instructions?.action_url || 'Not available'}\r\n\r\nAction Required: ${task.instructions?.action_required || 'Send signature link to investor'}\r\n    `\r\n\r\n    // Copy to clipboard\r\n    await navigator.clipboard.writeText(message)\r\n    alert('Follow-up details copied to clipboard!')\r\n\r\n    // Mark as in progress\r\n    setLoadingTaskId(task.id)\r\n    try {\r\n      const response = await fetch('/api/tasks', {\r\n        method: 'PATCH',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({\r\n          id: task.id,\r\n          status: 'in_progress',\r\n          started_at: new Date().toISOString()\r\n        })\r\n      })\r\n\r\n      if (!response.ok) {\r\n        console.error('Failed to update task status')\r\n      }\r\n    } catch (error) {\r\n      console.error('Error updating task:', error)\r\n    } finally {\r\n      setLoadingTaskId(null)\r\n    }\r\n  }\r\n\r\n  const getPriorityColor = (priority: string) => {\r\n    switch (priority) {\r\n      case 'high': return 'bg-red-100 text-red-800 border-red-300'\r\n      case 'medium': return 'bg-yellow-100 text-yellow-800 border-yellow-300'\r\n      case 'low': return 'bg-green-100 text-green-800 border-green-300'\r\n      default: return 'bg-gray-100 text-gray-800 border-gray-300'\r\n    }\r\n  }\r\n\r\n  const getStatusIcon = (status: string) => {\r\n    switch (status) {\r\n      case 'completed': return <CheckCircle2 className=\"h-4 w-4 text-green-600\" />\r\n      case 'in_progress': return <Clock className=\"h-4 w-4 text-blue-600 animate-pulse\" />\r\n      case 'overdue': return <AlertTriangle className=\"h-4 w-4 text-red-600\" />\r\n      default: return <AlertCircle className=\"h-4 w-4 text-yellow-600\" />\r\n    }\r\n  }\r\n\r\n  // INLINE SIGNING MODE\r\n  if (signingMode.active && signingMode.task && signingMode.signatureRequest) {\r\n    const pdfUrl = signingMode.signatureRequest.unsigned_pdf_url || signingMode.signatureRequest.google_drive_url\r\n\r\n    return (\r\n      <div className=\"container mx-auto py-6\">\r\n        <div className=\"mb-6\">\r\n          <Button\r\n            variant=\"ghost\"\r\n            onClick={handleExitSigningMode}\r\n            className=\"mb-4\"\r\n          >\r\n            <ArrowLeft className=\"h-4 w-4 mr-2\" />\r\n            Back to Tasks\r\n          </Button>\r\n          <h1 className=\"text-2xl font-bold text-foreground mb-2\">{signingMode.task.title}</h1>\r\n          <p className=\"text-muted-foreground\">{signingMode.task.description}</p>\r\n        </div>\r\n\r\n        {error && (\r\n          <Alert className=\"mb-6 border-red-200 bg-red-50\">\r\n            <AlertTriangle className=\"h-4 w-4 text-red-600\" />\r\n            <AlertTitle className=\"text-red-900\">Error</AlertTitle>\r\n            <AlertDescription className=\"text-red-700\">{error}</AlertDescription>\r\n          </Alert>\r\n        )}\r\n\r\n        <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\r\n          {pdfUrl && (\r\n            <InlinePdfViewer\r\n              pdfUrl={pdfUrl}\r\n              documentName={signingMode.task.title}\r\n            />\r\n          )}\r\n          <SignatureCanvasWidget\r\n            onSignatureCapture={handleSignatureSubmit}\r\n            signerName={signingMode.signatureRequest.signer_name}\r\n            signerEmail={signingMode.signatureRequest.signer_email}\r\n            isSubmitting={isSubmitting}\r\n          />\r\n        </div>\r\n      </div>\r\n    )\r\n  }\r\n\r\n  // TASK LIST VIEW\r\n  return (\r\n    <div className=\"container mx-auto py-6\">\r\n      <div className=\"mb-8\">\r\n        <h1 className=\"text-3xl font-bold text-foreground mb-2\">VersoSign</h1>\r\n        <p className=\"text-muted-foreground\">\r\n          Document signature management and countersigning\r\n        </p>\r\n      </div>\r\n\r\n      {error && (\r\n        <Alert className=\"mb-6 border-red-200 bg-red-50\">\r\n          <AlertTriangle className=\"h-4 w-4 text-red-600\" />\r\n          <AlertTitle className=\"text-red-900\">Error</AlertTitle>\r\n          <AlertDescription className=\"text-red-700\">{error}</AlertDescription>\r\n        </Alert>\r\n      )}\r\n\r\n      {/* Stats Cards */}\r\n      <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4 mb-8\">\r\n        <Card>\r\n          <CardHeader className=\"pb-3\">\r\n            <CardTitle className=\"text-sm font-medium text-muted-foreground\">\r\n              Pending Signatures\r\n            </CardTitle>\r\n          </CardHeader>\r\n          <CardContent>\r\n            <div className=\"text-2xl font-bold\">{stats.pending}</div>\r\n            {stats.pending > 0 && (\r\n              <p className=\"text-xs text-muted-foreground mt-1\">\r\n                Awaiting action\r\n              </p>\r\n            )}\r\n          </CardContent>\r\n        </Card>\r\n\r\n        <Card>\r\n          <CardHeader className=\"pb-3\">\r\n            <CardTitle className=\"text-sm font-medium text-muted-foreground\">\r\n              In Progress\r\n            </CardTitle>\r\n          </CardHeader>\r\n          <CardContent>\r\n            <div className=\"text-2xl font-bold\">{stats.in_progress}</div>\r\n            {stats.in_progress > 0 && (\r\n              <p className=\"text-xs text-muted-foreground mt-1\">\r\n                Currently signing\r\n              </p>\r\n            )}\r\n          </CardContent>\r\n        </Card>\r\n\r\n        <Card>\r\n          <CardHeader className=\"pb-3\">\r\n            <CardTitle className=\"text-sm font-medium text-muted-foreground\">\r\n              Completed Today\r\n            </CardTitle>\r\n          </CardHeader>\r\n          <CardContent>\r\n            <div className=\"text-2xl font-bold text-green-600\">\r\n              {stats.completed_today}\r\n            </div>\r\n            <p className=\"text-xs text-muted-foreground mt-1\">\r\n              Signed today\r\n            </p>\r\n          </CardContent>\r\n        </Card>\r\n\r\n        <Card>\r\n          <CardHeader className=\"pb-3\">\r\n            <CardTitle className=\"text-sm font-medium text-muted-foreground\">\r\n              Overdue\r\n            </CardTitle>\r\n          </CardHeader>\r\n          <CardContent>\r\n            <div className=\"text-2xl font-bold text-red-600\">\r\n              {stats.overdue}\r\n            </div>\r\n            {stats.overdue > 0 && (\r\n              <p className=\"text-xs text-red-600 mt-1\">\r\n                Need immediate attention\r\n              </p>\r\n            )}\r\n          </CardContent>\r\n        </Card>\r\n      </div>\r\n\r\n      {/* Alert for Overdue Tasks */}\r\n      {stats.overdue > 0 && (\r\n        <Alert className=\"mb-6 border-red-200 bg-red-50\">\r\n          <AlertTriangle className=\"h-4 w-4 text-red-600\" />\r\n          <AlertTitle className=\"text-red-900\">Overdue Signatures</AlertTitle>\r\n          <AlertDescription className=\"text-red-700\">\r\n            You have {stats.overdue} overdue signature{stats.overdue !== 1 ? 's' : ''} requiring immediate attention.\r\n          </AlertDescription>\r\n        </Alert>\r\n      )}\r\n\r\n      {/* Tabs for different signature categories */}\r\n      <Tabs value={selectedTab} onValueChange={setSelectedTab}>\r\n        <TabsList className=\"mb-6\">\r\n          <TabsTrigger value=\"countersignatures\">\r\n            <FileSignature className=\"h-4 w-4 mr-2\" />\r\n            Countersignatures\r\n            {(signatureGroups.find(g => g.category === 'countersignatures')?.tasks.length || 0) > 0 && (\r\n              <Badge className=\"ml-2\" variant=\"secondary\">\r\n                {signatureGroups.find(g => g.category === 'countersignatures')?.tasks.length || 0}\r\n              </Badge>\r\n            )}\r\n          </TabsTrigger>\r\n          <TabsTrigger value=\"follow_ups\">\r\n            <Users className=\"h-4 w-4 mr-2\" />\r\n            Manual Follow-ups\r\n            {(signatureGroups.find(g => g.category === 'follow_ups')?.tasks.length || 0) > 0 && (\r\n              <Badge className=\"ml-2\" variant=\"secondary\">\r\n                {signatureGroups.find(g => g.category === 'follow_ups')?.tasks.length || 0}\r\n              </Badge>\r\n            )}\r\n          </TabsTrigger>\r\n          <TabsTrigger value=\"other\">\r\n            <CheckCircle2 className=\"h-4 w-4 mr-2\" />\r\n            Completed\r\n          </TabsTrigger>\r\n          <TabsTrigger value=\"expired\">\r\n            <AlertCircle className=\"h-4 w-4 mr-2\" />\r\n            Expired\r\n            {stats.expired > 0 && (\r\n              <Badge className=\"ml-2\" variant=\"destructive\">\r\n                {stats.expired}\r\n              </Badge>\r\n            )}\r\n          </TabsTrigger>\r\n        </TabsList>\r\n\r\n        {signatureGroups.map(group => (\r\n          <TabsContent key={group.category} value={group.category}>\r\n            <Card>\r\n              <CardHeader>\r\n                <CardTitle>{group.title}</CardTitle>\r\n                <CardDescription>{group.description}</CardDescription>\r\n              </CardHeader>\r\n              <CardContent>\r\n                {/* Handle expired signatures tab */}\r\n                {group.category === 'expired' ? (\r\n                  ((group.expiredSignatures?.length || 0) === 0 && (group.tasks?.length || 0) === 0) ? (\r\n                    <div className=\"text-center py-8 text-muted-foreground\">\r\n                      No expired signatures\r\n                    </div>\r\n                  ) : (\r\n                    <div className=\"space-y-4\">\r\n                      {/* Show expired tasks (tasks with expired signature requests) */}\r\n                      {group.tasks?.map(task => (\r\n                        <div\r\n                          key={task.id}\r\n                          className=\"border border-red-200 rounded-lg p-4 bg-red-50/50 dark:bg-red-950/20 dark:border-red-900\"\r\n                        >\r\n                          <div className=\"flex items-start justify-between\">\r\n                            <div className=\"flex-1\">\r\n                              <div className=\"flex items-center gap-2 mb-2\">\r\n                                <AlertCircle className=\"h-4 w-4 text-red-600\" />\r\n                                <h4 className=\"font-semibold text-foreground\">{task.title}</h4>\r\n                                <Badge variant=\"destructive\">Expired</Badge>\r\n                              </div>\r\n                              <p className=\"text-sm text-muted-foreground mb-3\">\r\n                                {task.description || 'The signature request for this task has expired.'}\r\n                              </p>\r\n                              <div className=\"flex flex-wrap gap-4 text-sm text-muted-foreground\">\r\n                                {task.instructions?.investor_name && (\r\n                                  <span className=\"flex items-center gap-1\">\r\n                                    <Users className=\"h-3 w-3\" />\r\n                                    {task.instructions.investor_name}\r\n                                  </span>\r\n                                )}\r\n                                {task.instructions?.investor_email && (\r\n                                  <span className=\"flex items-center gap-1\">\r\n                                    <Mail className=\"h-3 w-3\" />\r\n                                    {task.instructions.investor_email}\r\n                                  </span>\r\n                                )}\r\n                                <span className=\"flex items-center gap-1\">\r\n                                  <Calendar className=\"h-3 w-3\" />\r\n                                  Created {format(new Date(task.created_at), 'MMM d, yyyy')}\r\n                                </span>\r\n                              </div>\r\n                            </div>\r\n                          </div>\r\n                        </div>\r\n                      ))}\r\n                      {/* Show expired signature requests */}\r\n                      {group.expiredSignatures?.map(sig => (\r\n                        <div\r\n                          key={sig.id}\r\n                          className=\"border rounded-lg p-4 hover:bg-muted/50 transition-colors\"\r\n                        >\r\n                          <div className=\"flex items-start justify-between\">\r\n                            <div className=\"flex-1\">\r\n                              <div className=\"flex items-center gap-2 mb-2\">\r\n                                <AlertCircle className=\"h-4 w-4 text-red-600\" />\r\n                                <h4 className=\"font-semibold\">{sig.document_type.toUpperCase()}</h4>\r\n                                <Badge variant=\"destructive\">Expired</Badge>\r\n                              </div>\r\n                              <p className=\"text-sm text-muted-foreground mb-3\">\r\n                                Request for {sig.signer_name} expired on {format(new Date(sig.token_expires_at), 'MMM d, yyyy')}\r\n                              </p>\r\n                              <div className=\"flex flex-wrap gap-4 text-sm text-muted-foreground\">\r\n                                <span className=\"flex items-center gap-1\">\r\n                                  <Users className=\"h-3 w-3\" />\r\n                                  {sig.investor?.display_name || sig.investor?.legal_name || sig.signer_name}\r\n                                </span>\r\n                                <span className=\"flex items-center gap-1\">\r\n                                  <Mail className=\"h-3 w-3\" />\r\n                                  {sig.signer_email}\r\n                                </span>\r\n                                <span className=\"flex items-center gap-1\">\r\n                                  <Calendar className=\"h-3 w-3\" />\r\n                                  Created {format(new Date(sig.created_at), 'MMM d, yyyy')}\r\n                                </span>\r\n                              </div>\r\n                            </div>\r\n                          </div>\r\n                        </div>\r\n                      ))}\r\n                    </div>\r\n                  )\r\n                ) : group.tasks.length === 0 ? (\r\n                  <div className=\"text-center py-8 text-muted-foreground\">\r\n                    No tasks in this category\r\n                  </div>\r\n                ) : (\r\n                  <div className=\"space-y-4\">\r\n                    {group.tasks.map(task => (\r\n                      <div\r\n                        key={task.id}\r\n                        className=\"border rounded-lg p-4 hover:bg-muted/50 transition-colors\"\r\n                      >\r\n                        <div className=\"flex items-start justify-between\">\r\n                          <div className=\"flex-1\">\r\n                            <div className=\"flex items-center gap-2 mb-2\">\r\n                              {getStatusIcon(\r\n                                task.due_at && new Date(task.due_at) < new Date() && task.status === 'pending'\r\n                                  ? 'overdue'\r\n                                  : task.status\r\n                              )}\r\n                              <h4 className=\"font-semibold\">{task.title}</h4>\r\n                              <Badge\r\n                                variant=\"outline\"\r\n                                className={getPriorityColor(task.priority)}\r\n                              >\r\n                                {task.priority}\r\n                              </Badge>\r\n                              {/* Show signer role if available */}\r\n                              {task.instructions?.signer_role && (\r\n                                <Badge variant=\"secondary\" className=\"text-xs\">\r\n                                  Signing as: {task.instructions.signer_role.toUpperCase()}\r\n                                </Badge>\r\n                              )}\r\n                              {/* Indicate if waiting for prior signature */}\r\n                              {task.instructions?.requires_prior_signature && (\r\n                                <Badge variant=\"outline\" className=\"text-xs text-amber-600 border-amber-300\">\r\n                                  Awaiting prior signature\r\n                                </Badge>\r\n                              )}\r\n                            </div>\r\n\r\n                            {task.description && (\r\n                              <p className=\"text-sm text-muted-foreground mb-3\">\r\n                                {task.description}\r\n                              </p>\r\n                            )}\r\n\r\n                            <div className=\"flex flex-wrap gap-4 text-sm text-muted-foreground\">\r\n                              {task.instructions?.investor_name && (\r\n                                <span className=\"flex items-center gap-1\">\r\n                                  <Users className=\"h-3 w-3\" />\r\n                                  {task.instructions.investor_name}\r\n                                </span>\r\n                              )}\r\n                              {task.due_at && (\r\n                                <span className=\"flex items-center gap-1\">\r\n                                  <Calendar className=\"h-3 w-3\" />\r\n                                  Due {format(new Date(task.due_at), 'MMM d, yyyy')}\r\n                                </span>\r\n                              )}\r\n                              {task.instructions?.investor_email && (\r\n                                <span className=\"flex items-center gap-1\">\r\n                                  <Mail className=\"h-3 w-3\" />\r\n                                  {task.instructions.investor_email}\r\n                                </span>\r\n                              )}\r\n                            </div>\r\n                          </div>\r\n\r\n                          <div className=\"flex gap-2\">\r\n                            {(task.status === 'pending' || task.status === 'in_progress') && (\r\n                              <>\r\n                                {task.kind === 'countersignature' && task.instructions?.action_url && (\r\n                                  <Button\r\n                                    size=\"sm\"\r\n                                    onClick={() => handleSignDocument(task)}\r\n                                    disabled={loadingTaskId === task.id}\r\n                                  >\r\n                                    <FileSignature className=\"h-4 w-4 mr-2\" />\r\n                                    {loadingTaskId === task.id ? 'Loading...' : 'Sign Document'}\r\n                                  </Button>\r\n                                )}\r\n                                {task.metadata?.issue === 'investor_no_user_account' && (\r\n                                  <Button\r\n                                    size=\"sm\"\r\n                                    variant=\"outline\"\r\n                                    onClick={() => handleManualFollowUp(task)}\r\n                                    disabled={loadingTaskId === task.id}\r\n                                  >\r\n                                    <Mail className=\"h-4 w-4 mr-2\" />\r\n                                    Copy Details\r\n                                  </Button>\r\n                                )}\r\n                              </>\r\n                            )}\r\n                            {task.status === 'completed' && task.completed_at && (\r\n                              <Badge variant=\"outline\" className=\"text-green-600\">\r\n                                Completed {format(new Date(task.completed_at), 'MMM d')}\r\n                              </Badge>\r\n                            )}\r\n                          </div>\r\n                        </div>\r\n                      </div>\r\n                    ))}\r\n                  </div>\r\n                )}\r\n              </CardContent>\r\n            </Card>\r\n          </TabsContent>\r\n        ))}\r\n      </Tabs>\r\n    </div>\r\n  )\r\n}"],"names":[],"mappings":"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"}