{"version":3,"sources":["../../../../../versotech-portal/src/components/fees/FeePlanEditModal.tsx","../../../../../versotech-portal/src/components/fees/TermSheetSelector.tsx","../../../../../versotech-portal/src/components/fees/EntitySelector.tsx","../../../../../versotech-portal/src/lib/fees/term-sheet-sync.ts"],"sourcesContent":["/**\r\n * Fee Plan Edit Modal - Redesigned\r\n *\r\n * A clean, wizard-style modal for creating and editing fee plans.\r\n * Uses progressive disclosure to reduce cognitive load.\r\n */\r\n\r\n'use client';\r\n\r\nimport { useState, useEffect, useCallback, useMemo } from 'react';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\nimport {\r\n  Dialog,\r\n  DialogContent,\r\n  DialogHeader,\r\n  DialogTitle,\r\n} from '@/components/ui/dialog';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Input } from '@/components/ui/input';\r\nimport { Label } from '@/components/ui/label';\r\nimport { Textarea } from '@/components/ui/textarea';\r\nimport {\r\n  Select,\r\n  SelectContent,\r\n  SelectItem,\r\n  SelectTrigger,\r\n  SelectValue,\r\n} from '@/components/ui/select';\r\nimport { Checkbox } from '@/components/ui/checkbox';\r\nimport { Badge } from '@/components/ui/badge';\r\nimport {\r\n  Plus,\r\n  Trash2,\r\n  Loader2,\r\n  AlertTriangle,\r\n  ChevronDown,\r\n  FileText,\r\n  DollarSign,\r\n  ScrollText,\r\n  Check,\r\n  Building2,\r\n} from 'lucide-react';\r\nimport type { FeePlanWithComponents } from '@/lib/fees/types';\r\nimport { TermSheetSelector, type TermSheet } from './TermSheetSelector';\r\nimport { EntitySelector, type EntityType } from './EntitySelector';\r\nimport { validateFeeComponentsAgainstTermSheet } from '@/lib/fees/term-sheet-sync';\r\n\r\n// ============================================================================\r\n// TYPES\r\n// ============================================================================\r\n\r\ninterface FeePlanEditModalProps {\r\n  open: boolean;\r\n  onClose: () => void;\r\n  onSuccess: () => void;\r\n  feePlan?: FeePlanWithComponents | null;\r\n  dealId?: string;\r\n  initialTermSheetId?: string;\r\n}\r\n\r\ninterface FeeComponent {\r\n  id?: string;\r\n  kind: 'subscription' | 'management' | 'performance' | 'spread_markup' | 'flat' | 'bd_fee' | 'finra_fee' | 'other';\r\n  calc_method: string;\r\n  frequency: string;\r\n  rate_bps?: number;\r\n  flat_amount?: number;\r\n  notes?: string;\r\n  payment_schedule?: string;\r\n  duration_periods?: number;\r\n  duration_unit?: string;\r\n  tier_threshold_multiplier?: number;\r\n}\r\n\r\ninterface AgreementTerms {\r\n  duration_months: number;\r\n  non_circumvention_months: number | null;\r\n  non_circumvention_indefinite: boolean;\r\n  governing_law: string;\r\n  vat_number: string;\r\n  intro_payment_days: number;\r\n  perf_payment_days: number;\r\n  hurdle_rate_bps?: number;\r\n  has_catchup: boolean;\r\n  catchup_rate_bps?: number;\r\n  has_high_water_mark: boolean;\r\n  has_no_cap: boolean;\r\n  performance_cap_percent?: number;\r\n}\r\n\r\n// ============================================================================\r\n// CONSTANTS\r\n// ============================================================================\r\n\r\nconst FEE_KINDS = [\r\n  { value: 'subscription', label: 'Subscription Fee', color: 'blue' },\r\n  { value: 'management', label: 'Management Fee', color: 'green' },\r\n  { value: 'performance', label: 'Performance Fee', color: 'purple' },\r\n  { value: 'flat', label: 'Flat Fee', color: 'amber' },\r\n  { value: 'spread_markup', label: 'Spread/Markup', color: 'cyan' },\r\n  { value: 'other', label: 'Other', color: 'gray' },\r\n] as const;\r\n\r\nconst CALC_METHODS = [\r\n  { value: 'percent_of_investment', label: '% of Investment' },\r\n  { value: 'percent_per_annum', label: '% per Annum' },\r\n  { value: 'percent_of_profit', label: '% of Profit' },\r\n  { value: 'fixed_amount', label: 'Fixed Amount' },\r\n] as const;\r\n\r\nconst GOVERNING_LAWS = [\r\n  'British Virgin Islands',\r\n  'England and Wales',\r\n  'Cayman Islands',\r\n  'Delaware, USA',\r\n  'Singapore',\r\n] as const;\r\n\r\nconst DEFAULT_AGREEMENT_TERMS: AgreementTerms = {\r\n  duration_months: 36,\r\n  non_circumvention_months: null,\r\n  non_circumvention_indefinite: true,\r\n  governing_law: 'British Virgin Islands',\r\n  vat_number: '',\r\n  intro_payment_days: 3,\r\n  perf_payment_days: 10,\r\n  has_catchup: false,\r\n  has_high_water_mark: false,\r\n  has_no_cap: true,\r\n};\r\n\r\n// ============================================================================\r\n// SECTION COMPONENTS\r\n// ============================================================================\r\n\r\ninterface CollapsibleSectionProps {\r\n  title: string;\r\n  icon: React.ReactNode;\r\n  isOpen: boolean;\r\n  onToggle: () => void;\r\n  children: React.ReactNode;\r\n  badge?: string;\r\n  status?: 'complete' | 'incomplete' | 'error';\r\n}\r\n\r\nfunction CollapsibleSection({\r\n  title,\r\n  icon,\r\n  isOpen,\r\n  onToggle,\r\n  children,\r\n  badge,\r\n  status,\r\n}: CollapsibleSectionProps) {\r\n  return (\r\n    <div className=\"border border-border rounded-2xl overflow-hidden bg-card shadow-lg\">\r\n      <button\r\n        type=\"button\"\r\n        onClick={onToggle}\r\n        className=\"w-full px-8 py-6 flex items-center justify-between hover:bg-muted/60 transition-colors\"\r\n      >\r\n        <div className=\"flex items-center gap-5\">\r\n          <div className=\"text-blue-500 dark:text-blue-400 p-2 bg-blue-500/10 rounded-lg\">{icon}</div>\r\n          <span className=\"font-bold text-foreground text-xl\">{title}</span>\r\n          {badge && (\r\n            <Badge variant=\"outline\" className=\"text-sm border-border text-foreground px-3 py-1 font-medium\">\r\n              {badge}\r\n            </Badge>\r\n          )}\r\n        </div>\r\n        <div className=\"flex items-center gap-5\">\r\n          {status === 'complete' && (\r\n            <div className=\"w-8 h-8 rounded-full bg-green-500/20 flex items-center justify-center\">\r\n              <Check className=\"w-5 h-5 text-green-500 dark:text-green-400\" />\r\n            </div>\r\n          )}\r\n          {status === 'error' && (\r\n            <div className=\"w-8 h-8 rounded-full bg-red-500/20 flex items-center justify-center\">\r\n              <AlertTriangle className=\"w-5 h-5 text-red-500 dark:text-red-400\" />\r\n            </div>\r\n          )}\r\n          <motion.div\r\n            animate={{ rotate: isOpen ? 180 : 0 }}\r\n            transition={{ duration: 0.2 }}\r\n            className=\"p-1\"\r\n          >\r\n            <ChevronDown className=\"w-6 h-6 text-muted-foreground\" />\r\n          </motion.div>\r\n        </div>\r\n      </button>\r\n      <AnimatePresence>\r\n        {isOpen && (\r\n          <motion.div\r\n            initial={{ height: 0, opacity: 0 }}\r\n            animate={{ height: 'auto', opacity: 1 }}\r\n            exit={{ height: 0, opacity: 0 }}\r\n            transition={{ duration: 0.25, ease: 'easeInOut' }}\r\n          >\r\n            <div className=\"px-8 pb-8 pt-6 border-t border-border bg-muted/30\">\r\n              {children}\r\n            </div>\r\n          </motion.div>\r\n        )}\r\n      </AnimatePresence>\r\n    </div>\r\n  );\r\n}\r\n\r\n// ============================================================================\r\n// FEE COMPONENT CARD\r\n// ============================================================================\r\n\r\ninterface FeeComponentCardProps {\r\n  component: FeeComponent;\r\n  index: number;\r\n  onChange: (updates: Partial<FeeComponent>) => void;\r\n  onRemove: () => void;\r\n  termSheetLimits?: { subscription?: number; management?: number; performance?: number };\r\n}\r\n\r\nfunction FeeComponentCard({\r\n  component,\r\n  index,\r\n  onChange,\r\n  onRemove,\r\n  termSheetLimits,\r\n}: FeeComponentCardProps) {\r\n  const kindConfig = FEE_KINDS.find((k) => k.value === component.kind);\r\n\r\n  const ratePercent = component.rate_bps ? (component.rate_bps / 100).toFixed(2) : null;\r\n\r\n  // Check if rate exceeds term sheet limit\r\n  const exceedsLimit = useMemo(() => {\r\n    if (!termSheetLimits || !component.rate_bps) return false;\r\n    const limitKey = component.kind as keyof typeof termSheetLimits;\r\n    const limit = termSheetLimits[limitKey];\r\n    if (!limit) return false;\r\n    return (component.rate_bps / 100) > limit;\r\n  }, [termSheetLimits, component.rate_bps, component.kind]);\r\n\r\n  // Color mapping for Tailwind (can't use dynamic class names)\r\n  const getBorderColor = () => {\r\n    switch (kindConfig?.color) {\r\n      case 'blue': return 'border-blue-500/40';\r\n      case 'green': return 'border-green-500/40';\r\n      case 'purple': return 'border-purple-500/40';\r\n      case 'amber': return 'border-amber-500/40';\r\n      case 'cyan': return 'border-cyan-500/40';\r\n      default: return 'border-border';\r\n    }\r\n  };\r\n\r\n  const getBadgeColor = () => {\r\n    switch (kindConfig?.color) {\r\n      case 'blue': return 'bg-blue-500/20 text-blue-400';\r\n      case 'green': return 'bg-green-500/20 text-green-400';\r\n      case 'purple': return 'bg-purple-500/20 text-purple-400';\r\n      case 'amber': return 'bg-amber-500/20 text-amber-400';\r\n      case 'cyan': return 'bg-cyan-500/20 text-cyan-400';\r\n      default: return 'bg-muted text-muted-foreground';\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className={`border-2 rounded-2xl p-6 bg-card ${getBorderColor()} transition-all hover:bg-muted/60`}>\r\n      {/* Header Row */}\r\n      <div className=\"flex items-center justify-between mb-6\">\r\n        <div className=\"flex items-center gap-5\">\r\n          <div className={`w-12 h-12 rounded-xl ${getBadgeColor()} flex items-center justify-center font-bold text-lg`}>\r\n            {index + 1}\r\n          </div>\r\n          <div className=\"space-y-1\">\r\n            <Label className=\"text-sm text-muted-foreground\">Fee Type</Label>\r\n            <Select\r\n              value={component.kind}\r\n              onValueChange={(val) => onChange({ kind: val as FeeComponent['kind'] })}\r\n            >\r\n              <SelectTrigger className=\"w-64 bg-muted/50 border-border text-foreground h-12 text-base font-medium\">\r\n                <SelectValue />\r\n              </SelectTrigger>\r\n              <SelectContent className=\"bg-popover border-border\">\r\n                {FEE_KINDS.map((kind) => (\r\n                  <SelectItem key={kind.value} value={kind.value} className=\"text-base py-3\">\r\n                    {kind.label}\r\n                  </SelectItem>\r\n                ))}\r\n              </SelectContent>\r\n            </Select>\r\n          </div>\r\n        </div>\r\n        <Button\r\n          type=\"button\"\r\n          variant=\"ghost\"\r\n          size=\"icon\"\r\n          onClick={onRemove}\r\n          className=\"text-muted-foreground hover:text-red-500 dark:hover:text-red-400 hover:bg-red-500/10 h-12 w-12 rounded-xl\"\r\n        >\r\n          <Trash2 className=\"w-6 h-6\" />\r\n        </Button>\r\n      </div>\r\n\r\n      {/* Fields - 4 columns with more gap */}\r\n      <div className=\"grid grid-cols-4 gap-6\">\r\n        {/* Calculation Method */}\r\n        <div className=\"space-y-2\">\r\n          <Label className=\"text-sm text-muted-foreground font-medium\">Calculation Method</Label>\r\n          <Select\r\n            value={component.calc_method}\r\n            onValueChange={(val) => onChange({ calc_method: val })}\r\n          >\r\n            <SelectTrigger className=\"bg-muted/50 border-border text-foreground h-12 text-base\">\r\n              <SelectValue />\r\n            </SelectTrigger>\r\n            <SelectContent className=\"bg-popover border-border\">\r\n              {CALC_METHODS.map((method) => (\r\n                <SelectItem key={method.value} value={method.value} className=\"text-base py-2.5\">\r\n                  {method.label}\r\n                </SelectItem>\r\n              ))}\r\n            </SelectContent>\r\n          </Select>\r\n        </div>\r\n\r\n        {/* Conditional: Rate OR Flat Amount based on calc_method */}\r\n        {component.calc_method === 'fixed_amount' ? (\r\n          <div className=\"space-y-2\">\r\n            <Label className=\"text-sm text-muted-foreground font-medium\">Amount (USD)</Label>\r\n            <Input\r\n              type=\"number\"\r\n              step=\"0.01\"\r\n              min=\"0\"\r\n              value={component.flat_amount || ''}\r\n              onChange={(e) => onChange({ flat_amount: e.target.value ? Number(e.target.value) : undefined })}\r\n              placeholder=\"5,000.00\"\r\n              className=\"bg-muted/50 border-border text-foreground h-12 text-lg font-mono\"\r\n            />\r\n            {component.flat_amount && (\r\n              <p className=\"text-base text-green-600 dark:text-green-400 font-semibold\">\r\n                ${component.flat_amount.toLocaleString()}\r\n              </p>\r\n            )}\r\n          </div>\r\n        ) : (\r\n          <div className=\"space-y-2\">\r\n            <Label className=\"text-sm text-muted-foreground font-medium\">Rate (Basis Points)</Label>\r\n            <Input\r\n              type=\"number\"\r\n              value={component.rate_bps || ''}\r\n              onChange={(e) => onChange({ rate_bps: e.target.value ? Number(e.target.value) : undefined })}\r\n              placeholder=\"200\"\r\n              className={`bg-muted/50 border-border text-foreground h-12 text-lg font-mono ${exceedsLimit ? 'border-red-500 bg-red-500/10' : ''}`}\r\n            />\r\n            {ratePercent && (\r\n              <p className={`text-base font-semibold ${exceedsLimit ? 'text-red-500 dark:text-red-400' : 'text-blue-600 dark:text-blue-400'}`}>\r\n                = {ratePercent}%\r\n                {exceedsLimit && ' ⚠️ exceeds limit'}\r\n              </p>\r\n            )}\r\n          </div>\r\n        )}\r\n\r\n        {/* Payment Schedule */}\r\n        <div className=\"space-y-2\">\r\n          <Label className=\"text-sm text-muted-foreground font-medium\">Payment Schedule</Label>\r\n          <Select\r\n            value={component.payment_schedule || 'upfront'}\r\n            onValueChange={(val) => onChange({ payment_schedule: val })}\r\n          >\r\n            <SelectTrigger className=\"bg-muted/50 border-border text-foreground h-12 text-base\">\r\n              <SelectValue />\r\n            </SelectTrigger>\r\n            <SelectContent className=\"bg-popover border-border\">\r\n              <SelectItem value=\"upfront\" className=\"text-base py-2.5\">Upfront</SelectItem>\r\n              <SelectItem value=\"recurring\" className=\"text-base py-2.5\">Recurring</SelectItem>\r\n              <SelectItem value=\"on_demand\" className=\"text-base py-2.5\">On Demand</SelectItem>\r\n            </SelectContent>\r\n          </Select>\r\n        </div>\r\n\r\n        {/* Notes */}\r\n        <div className=\"space-y-2\">\r\n          <Label className=\"text-sm text-muted-foreground font-medium\">Notes</Label>\r\n          <Input\r\n            value={component.notes || ''}\r\n            onChange={(e) => onChange({ notes: e.target.value })}\r\n            placeholder=\"Optional notes...\"\r\n            className=\"bg-muted/50 border-border text-foreground h-12 text-base\"\r\n          />\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\n// ============================================================================\r\n// MAIN MODAL COMPONENT\r\n// ============================================================================\r\n\r\nexport default function FeePlanEditModal({\r\n  open,\r\n  onClose,\r\n  onSuccess,\r\n  feePlan,\r\n  dealId,\r\n  initialTermSheetId,\r\n}: FeePlanEditModalProps) {\r\n  // UI State\r\n  const [loading, setLoading] = useState(false);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [expandedSections, setExpandedSections] = useState({\r\n    basic: true,\r\n    components: true,\r\n    agreement: false,\r\n  });\r\n\r\n  // Data State\r\n  const [deals, setDeals] = useState<Array<{ id: string; name: string }>>([]);\r\n  const [validationErrors, setValidationErrors] = useState<string[]>([]);\r\n\r\n  // Form State - Basic Info\r\n  const [name, setName] = useState('');\r\n  const [description, setDescription] = useState('');\r\n  const [selectedDealId, setSelectedDealId] = useState<string | undefined>(dealId);\r\n  const [isActive, setIsActive] = useState(true);\r\n\r\n  // Form State - Term Sheet & Entity\r\n  const [termSheetId, setTermSheetId] = useState<string | undefined>(initialTermSheetId);\r\n  const [selectedTermSheet, setSelectedTermSheet] = useState<TermSheet | null>(null);\r\n  const [entityType, setEntityType] = useState<EntityType | undefined>();\r\n  const [entityId, setEntityId] = useState<string | undefined>();\r\n\r\n  // Form State - Components\r\n  const [components, setComponents] = useState<FeeComponent[]>([]);\r\n\r\n  // Form State - Agreement Terms\r\n  const [agreementTerms, setAgreementTerms] = useState<AgreementTerms>(DEFAULT_AGREEMENT_TERMS);\r\n\r\n  // Derived State\r\n  const isEditing = !!feePlan;\r\n  const hasPerformanceComponent = components.some((c) => c.kind === 'performance');\r\n  const hasSubscriptionComponent = components.some((c) => c.kind === 'subscription');\r\n\r\n  const termSheetLimits = useMemo(() => {\r\n    if (!selectedTermSheet) return undefined;\r\n    return {\r\n      subscription: selectedTermSheet.subscription_fee_percent || undefined,\r\n      management: selectedTermSheet.management_fee_percent || undefined,\r\n      performance: selectedTermSheet.carried_interest_percent || undefined,\r\n    };\r\n  }, [selectedTermSheet]);\r\n\r\n  // Check section completion\r\n  const basicInfoComplete = name.trim() && selectedDealId && termSheetId && entityType && entityId;\r\n  const componentsValid = validationErrors.length === 0;\r\n\r\n  // ============================================================================\r\n  // EFFECTS\r\n  // ============================================================================\r\n\r\n  // Load deals on open\r\n  useEffect(() => {\r\n    if (open) {\r\n      loadDeals();\r\n    }\r\n  }, [open]);\r\n\r\n  // Initialize form when opening\r\n  useEffect(() => {\r\n    if (!open) return;\r\n\r\n    if (feePlan) {\r\n      // Edit mode - load existing data\r\n      setName(feePlan.name);\r\n      setDescription(feePlan.description || '');\r\n      setSelectedDealId(feePlan.deal_id || undefined);\r\n      setIsActive(feePlan.is_active);\r\n\r\n      const fp = feePlan as any;\r\n      setTermSheetId(fp.term_sheet_id || undefined);\r\n\r\n      // Determine entity\r\n      if (fp.introducer_id) {\r\n        setEntityType('introducer');\r\n        setEntityId(fp.introducer_id);\r\n      } else if (fp.partner_id) {\r\n        setEntityType('partner');\r\n        setEntityId(fp.partner_id);\r\n      } else if (fp.commercial_partner_id) {\r\n        setEntityType('commercial_partner');\r\n        setEntityId(fp.commercial_partner_id);\r\n      }\r\n\r\n      // Load agreement terms\r\n      setAgreementTerms({\r\n        duration_months: fp.agreement_duration_months ?? 36,\r\n        non_circumvention_months: fp.non_circumvention_months ?? null,\r\n        non_circumvention_indefinite: fp.non_circumvention_months == null,\r\n        governing_law: fp.governing_law ?? 'British Virgin Islands',\r\n        vat_number: fp.vat_registration_number ?? '',\r\n        intro_payment_days: 3,\r\n        perf_payment_days: 10,\r\n        hurdle_rate_bps: undefined,\r\n        has_catchup: false,\r\n        catchup_rate_bps: undefined,\r\n        has_high_water_mark: false,\r\n        has_no_cap: true,\r\n        performance_cap_percent: undefined,\r\n      });\r\n\r\n      // Load components\r\n      const existingComponents = (feePlan.components || []) as any[];\r\n      const subComp = existingComponents.find((c) => c.kind === 'subscription');\r\n      const perfComp = existingComponents.find((c) => c.kind === 'performance');\r\n\r\n      // Extract agreement terms from components\r\n      if (subComp) {\r\n        setAgreementTerms((prev) => ({\r\n          ...prev,\r\n          intro_payment_days: subComp.payment_days_after_event ?? 3,\r\n        }));\r\n      }\r\n      if (perfComp) {\r\n        setAgreementTerms((prev) => ({\r\n          ...prev,\r\n          perf_payment_days: perfComp.payment_days_after_event ?? 10,\r\n          hurdle_rate_bps: perfComp.hurdle_rate_bps,\r\n          has_catchup: perfComp.has_catchup ?? false,\r\n          catchup_rate_bps: perfComp.catchup_rate_bps,\r\n          has_high_water_mark: perfComp.has_high_water_mark ?? false,\r\n          has_no_cap: perfComp.has_no_cap ?? true,\r\n          performance_cap_percent: perfComp.performance_cap_percent,\r\n        }));\r\n      }\r\n\r\n      setComponents(\r\n        existingComponents.map((c: any) => ({\r\n          id: c.id,\r\n          kind: c.kind,\r\n          calc_method: c.calc_method || 'percent_of_investment',\r\n          frequency: c.frequency || 'one_time',\r\n          rate_bps: c.rate_bps,\r\n          flat_amount: c.flat_amount,\r\n          notes: c.notes || '',\r\n          payment_schedule: c.payment_schedule || 'upfront',\r\n          duration_periods: c.duration_periods,\r\n          duration_unit: c.duration_unit,\r\n        }))\r\n      );\r\n    } else {\r\n      // Create mode - reset form\r\n      resetForm();\r\n    }\r\n  }, [open, feePlan, dealId, initialTermSheetId]);\r\n\r\n  // Validate components against term sheet\r\n  useEffect(() => {\r\n    if (selectedTermSheet && components.length > 0) {\r\n      const errors = validateFeeComponentsAgainstTermSheet(components, selectedTermSheet);\r\n      setValidationErrors(errors);\r\n    } else {\r\n      setValidationErrors([]);\r\n    }\r\n  }, [components, selectedTermSheet]);\r\n\r\n  // Auto-expand agreement section when entity is selected\r\n  useEffect(() => {\r\n    if (entityType && entityId) {\r\n      setExpandedSections((prev) => ({ ...prev, agreement: true }));\r\n    }\r\n  }, [entityType, entityId]);\r\n\r\n  // ============================================================================\r\n  // HANDLERS\r\n  // ============================================================================\r\n\r\n  const resetForm = useCallback(() => {\r\n    setName('');\r\n    setDescription('');\r\n    setSelectedDealId(dealId);\r\n    setIsActive(true);\r\n    setTermSheetId(initialTermSheetId);\r\n    setSelectedTermSheet(null);\r\n    setEntityType(undefined);\r\n    setEntityId(undefined);\r\n    setComponents([]);\r\n    setAgreementTerms(DEFAULT_AGREEMENT_TERMS);\r\n    setError(null);\r\n    setValidationErrors([]);\r\n    setExpandedSections({ basic: true, components: true, agreement: false });\r\n  }, [dealId, initialTermSheetId]);\r\n\r\n  const loadDeals = async () => {\r\n    try {\r\n      const res = await fetch('/api/deals');\r\n      const json = await res.json();\r\n      setDeals(json.deals || []);\r\n    } catch (err) {\r\n      console.error('Error loading deals:', err);\r\n    }\r\n  };\r\n\r\n  const toggleSection = (section: keyof typeof expandedSections) => {\r\n    setExpandedSections((prev) => ({ ...prev, [section]: !prev[section] }));\r\n  };\r\n\r\n  const addComponent = () => {\r\n    setComponents([\r\n      ...components,\r\n      {\r\n        kind: 'subscription',\r\n        calc_method: 'percent_of_investment',\r\n        frequency: 'one_time',\r\n        payment_schedule: 'upfront',\r\n      },\r\n    ]);\r\n  };\r\n\r\n  const updateComponent = (index: number, updates: Partial<FeeComponent>) => {\r\n    setComponents((prev) => {\r\n      const updated = [...prev];\r\n      updated[index] = { ...updated[index], ...updates };\r\n      return updated;\r\n    });\r\n  };\r\n\r\n  const removeComponent = (index: number) => {\r\n    setComponents((prev) => prev.filter((_, i) => i !== index));\r\n  };\r\n\r\n  const updateAgreementTerms = (updates: Partial<AgreementTerms>) => {\r\n    setAgreementTerms((prev) => ({ ...prev, ...updates }));\r\n  };\r\n\r\n  const handleSave = async () => {\r\n    // Validate\r\n    if (!name.trim()) {\r\n      setError('Plan name is required');\r\n      return;\r\n    }\r\n    if (!selectedDealId) {\r\n      setError('A deal must be selected');\r\n      return;\r\n    }\r\n    if (!termSheetId) {\r\n      setError('A term sheet must be selected');\r\n      return;\r\n    }\r\n    if (!entityType || !entityId) {\r\n      setError('An entity must be selected');\r\n      return;\r\n    }\r\n    if (validationErrors.length > 0) {\r\n      setError(`Fee values exceed term sheet limits: ${validationErrors.join('; ')}`);\r\n      return;\r\n    }\r\n\r\n    setLoading(true);\r\n    setError(null);\r\n\r\n    try {\r\n      // Build entity fields\r\n      const entityFields = {\r\n        introducer_id: entityType === 'introducer' ? entityId : undefined,\r\n        partner_id: entityType === 'partner' ? entityId : undefined,\r\n        commercial_partner_id: entityType === 'commercial_partner' ? entityId : undefined,\r\n      };\r\n\r\n      // Build components with agreement terms merged\r\n      // IMPORTANT: has_catchup and has_high_water_mark are NOT NULL in DB\r\n      const processedComponents = components.map((c) => {\r\n        const { id, notes, ...rest } = c;\r\n\r\n        // Base fields for ALL components - include NOT NULL boolean defaults\r\n        const base = {\r\n          ...rest,\r\n          notes: notes?.trim() || undefined,\r\n          // These columns are NOT NULL in DB - must always provide values\r\n          has_catchup: false,\r\n          has_high_water_mark: false,\r\n          ...(id && id.length > 10 ? { id } : {}),\r\n        };\r\n\r\n        if (c.kind === 'subscription') {\r\n          return {\r\n            ...base,\r\n            payment_days_after_event: agreementTerms.intro_payment_days,\r\n          };\r\n        }\r\n\r\n        if (c.kind === 'performance') {\r\n          return {\r\n            ...base,\r\n            payment_days_after_event: agreementTerms.perf_payment_days,\r\n            hurdle_rate_bps: agreementTerms.hurdle_rate_bps || undefined,\r\n            has_catchup: agreementTerms.has_catchup,\r\n            catchup_rate_bps: agreementTerms.has_catchup ? agreementTerms.catchup_rate_bps : undefined,\r\n            has_high_water_mark: agreementTerms.has_high_water_mark,\r\n            has_no_cap: agreementTerms.has_no_cap,\r\n            performance_cap_percent: agreementTerms.has_no_cap ? undefined : agreementTerms.performance_cap_percent,\r\n          };\r\n        }\r\n\r\n        return base;\r\n      });\r\n\r\n      const payload = {\r\n        name: name.trim(),\r\n        description: description.trim() || undefined,\r\n        deal_id: selectedDealId,\r\n        term_sheet_id: termSheetId,\r\n        ...entityFields,\r\n        is_active: isActive,\r\n        agreement_duration_months: agreementTerms.duration_months,\r\n        non_circumvention_months: agreementTerms.non_circumvention_indefinite ? null : agreementTerms.non_circumvention_months,\r\n        governing_law: agreementTerms.governing_law,\r\n        vat_registration_number: agreementTerms.vat_number.trim() || null,\r\n        components: processedComponents,\r\n      };\r\n\r\n      const url = feePlan ? `/api/staff/fees/plans/${feePlan.id}` : '/api/staff/fees/plans';\r\n      const res = await fetch(url, {\r\n        method: feePlan ? 'PUT' : 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify(payload),\r\n      });\r\n\r\n      if (!res.ok) {\r\n        const errorData = await res.json().catch(() => ({ error: `HTTP ${res.status}` }));\r\n        const msg = errorData.error || 'Failed to save';\r\n        const details = errorData.details ? `\\n${errorData.details}` : '';\r\n        throw new Error(`${msg}${details}`);\r\n      }\r\n\r\n      onSuccess();\r\n    } catch (err) {\r\n      setError(err instanceof Error ? err.message : 'Failed to save fee plan');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  // ============================================================================\r\n  // RENDER\r\n  // ============================================================================\r\n\r\n  return (\r\n    <Dialog open={open} onOpenChange={(isOpen) => !isOpen && onClose()}>\r\n      <DialogContent\r\n        showCloseButton={false}\r\n        className=\"!max-w-[1400px] !w-[96vw] !max-h-[94vh] !p-0 bg-background border-border text-foreground overflow-hidden flex flex-col\"\r\n      >\r\n        {/* Header */}\r\n        <DialogHeader className=\"px-10 py-6 border-b border-border bg-gradient-to-r from-blue-500/5 dark:from-blue-900/10 via-muted/30 to-transparent shrink-0\">\r\n          <div className=\"flex items-center justify-between\">\r\n            <div>\r\n              <DialogTitle className=\"text-2xl font-bold text-foreground tracking-tight\">\r\n                {isEditing ? 'Edit Fee Plan' : 'Create New Fee Plan'}\r\n              </DialogTitle>\r\n              <p className=\"text-base text-muted-foreground mt-2\">\r\n                {isEditing ? 'Modify fee structure and agreement terms' : 'Define a fee structure for a partner or introducer agreement'}\r\n              </p>\r\n            </div>\r\n            <div className=\"flex items-center gap-6\">\r\n              <div className=\"flex items-center gap-3 bg-muted/50 px-4 py-2 rounded-lg border border-border\">\r\n                <Checkbox\r\n                  id=\"is_active\"\r\n                  checked={isActive}\r\n                  onCheckedChange={(checked) => setIsActive(checked as boolean)}\r\n                  className=\"border-border h-5 w-5\"\r\n                />\r\n                <Label htmlFor=\"is_active\" className=\"text-sm text-muted-foreground cursor-pointer font-medium\">\r\n                  Plan Active\r\n                </Label>\r\n              </div>\r\n              <Button\r\n                type=\"button\"\r\n                variant=\"ghost\"\r\n                size=\"icon\"\r\n                onClick={onClose}\r\n                className=\"h-10 w-10 text-muted-foreground hover:text-foreground hover:bg-muted rounded-lg\"\r\n              >\r\n                <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\"><path d=\"M18 6 6 18\"/><path d=\"m6 6 12 12\"/></svg>\r\n              </Button>\r\n            </div>\r\n          </div>\r\n        </DialogHeader>\r\n\r\n        {/* Error Banner */}\r\n        <AnimatePresence>\r\n          {error && (\r\n            <motion.div\r\n              initial={{ height: 0, opacity: 0 }}\r\n              animate={{ height: 'auto', opacity: 1 }}\r\n              exit={{ height: 0, opacity: 0 }}\r\n              className=\"px-10 py-4 bg-red-500/10 border-b border-red-500/30 shrink-0\"\r\n            >\r\n              <div className=\"flex items-center gap-3 text-red-400\">\r\n                <AlertTriangle className=\"w-5 h-5 shrink-0\" />\r\n                <span className=\"text-base\">{error}</span>\r\n              </div>\r\n            </motion.div>\r\n          )}\r\n        </AnimatePresence>\r\n\r\n        {/* Scrollable Content */}\r\n        <div className=\"flex-1 overflow-y-auto px-10 py-8 space-y-6\">\r\n          {/* Section 1: Basic Information */}\r\n          <CollapsibleSection\r\n            title=\"Basic Information\"\r\n            icon={<FileText className=\"w-5 h-5\" />}\r\n            isOpen={expandedSections.basic}\r\n            onToggle={() => toggleSection('basic')}\r\n            status={basicInfoComplete ? 'complete' : undefined}\r\n          >\r\n            <div className=\"space-y-6\">\r\n              {/* Row 1: Plan Name & Description side by side */}\r\n              <div className=\"grid grid-cols-2 gap-8\">\r\n                <div className=\"space-y-3\">\r\n                  <Label className=\"text-base text-foreground font-medium\">\r\n                    Plan Name <span className=\"text-red-500 dark:text-red-400\">*</span>\r\n                  </Label>\r\n                  <Input\r\n                    value={name}\r\n                    onChange={(e) => setName(e.target.value)}\r\n                    placeholder=\"e.g., Standard Introducer Fee Plan\"\r\n                    className=\"bg-muted/50 border-border text-foreground h-12 text-base focus:border-blue-500 focus:ring-1 focus:ring-blue-500/30\"\r\n                  />\r\n                </div>\r\n                <div className=\"space-y-3\">\r\n                  <Label className=\"text-base text-foreground font-medium\">Description</Label>\r\n                  <Input\r\n                    value={description}\r\n                    onChange={(e) => setDescription(e.target.value)}\r\n                    placeholder=\"Optional description of this fee arrangement...\"\r\n                    className=\"bg-muted/50 border-border text-foreground h-12 text-base focus:border-blue-500\"\r\n                  />\r\n                </div>\r\n              </div>\r\n\r\n              {/* Row 2: Deal, Term Sheet, Entity - 3 columns */}\r\n              <div className=\"grid grid-cols-3 gap-8\">\r\n                {/* Deal */}\r\n                <div className=\"space-y-3\">\r\n                  {dealId ? (\r\n                    <>\r\n                      <Label className=\"text-base text-foreground font-medium\">Deal</Label>\r\n                      <div className=\"flex items-center gap-3 px-4 py-3 bg-muted/50 border border-border rounded-lg text-foreground h-12\">\r\n                        <Building2 className=\"w-5 h-5 text-blue-500 dark:text-blue-400\" />\r\n                        <span className=\"text-base truncate\">{deals.find((d) => d.id === dealId)?.name || 'Loading...'}</span>\r\n                      </div>\r\n                    </>\r\n                  ) : (\r\n                    <>\r\n                      <Label className=\"text-base text-foreground font-medium\">\r\n                        Deal <span className=\"text-red-500 dark:text-red-400\">*</span>\r\n                      </Label>\r\n                      <Select\r\n                        value={selectedDealId || ''}\r\n                        onValueChange={(val) => {\r\n                          setSelectedDealId(val || undefined);\r\n                          setTermSheetId(undefined);\r\n                          setSelectedTermSheet(null);\r\n                          setEntityType(undefined);\r\n                          setEntityId(undefined);\r\n                        }}\r\n                      >\r\n                        <SelectTrigger className=\"bg-muted/50 border-border text-foreground h-12 text-base\">\r\n                          <SelectValue placeholder=\"Select a deal\" />\r\n                        </SelectTrigger>\r\n                        <SelectContent className=\"bg-popover border-border\">\r\n                          {deals.map((deal) => (\r\n                            <SelectItem key={deal.id} value={deal.id} className=\"text-base py-2.5\">\r\n                              {deal.name}\r\n                            </SelectItem>\r\n                          ))}\r\n                        </SelectContent>\r\n                      </Select>\r\n                    </>\r\n                  )}\r\n                </div>\r\n\r\n                {/* Term Sheet */}\r\n                <div className=\"space-y-3\">\r\n                  <TermSheetSelector\r\n                    dealId={selectedDealId}\r\n                    value={termSheetId}\r\n                    onChange={(id, ts) => {\r\n                      setTermSheetId(id);\r\n                      setSelectedTermSheet(ts);\r\n                    }}\r\n                    required={true}\r\n                  />\r\n                </div>\r\n\r\n                {/* Entity Type Quick Select - simplified */}\r\n                <div className=\"space-y-3\">\r\n                  <Label className=\"text-base text-foreground font-medium\">\r\n                    Entity Type <span className=\"text-red-500 dark:text-red-400\">*</span>\r\n                  </Label>\r\n                  <Select\r\n                    value={entityType || ''}\r\n                    onValueChange={(val) => {\r\n                      setEntityType(val as EntityType || undefined);\r\n                      setEntityId(undefined);\r\n                    }}\r\n                    disabled={!selectedDealId}\r\n                  >\r\n                    <SelectTrigger className=\"bg-muted/50 border-border text-foreground h-12 text-base\">\r\n                      <SelectValue placeholder={selectedDealId ? \"Select type\" : \"Select deal first\"} />\r\n                    </SelectTrigger>\r\n                    <SelectContent className=\"bg-popover border-border\">\r\n                      <SelectItem value=\"introducer\" className=\"text-base py-2.5\">Introducer</SelectItem>\r\n                      <SelectItem value=\"partner\" className=\"text-base py-2.5\">Partner</SelectItem>\r\n                    </SelectContent>\r\n                  </Select>\r\n                </div>\r\n              </div>\r\n\r\n              {/* Row 3: Entity Selection (only if type selected) */}\r\n              {entityType && selectedDealId && (\r\n                <div className=\"pt-4 border-t border-border\">\r\n                  <EntitySelector\r\n                    dealId={selectedDealId}\r\n                    entityType={entityType}\r\n                    onEntityTypeChange={setEntityType}\r\n                    entityId={entityId}\r\n                    onEntityIdChange={setEntityId}\r\n                    required={true}\r\n                    excludeTypes={['commercial_partner']}\r\n                  />\r\n                </div>\r\n              )}\r\n            </div>\r\n          </CollapsibleSection>\r\n\r\n          {/* Section 2: Fee Components */}\r\n          <CollapsibleSection\r\n            title=\"Fee Components\"\r\n            icon={<DollarSign className=\"w-5 h-5\" />}\r\n            isOpen={expandedSections.components}\r\n            onToggle={() => toggleSection('components')}\r\n            badge={`${components.length} component${components.length !== 1 ? 's' : ''}`}\r\n            status={components.length > 0 ? (componentsValid ? 'complete' : 'error') : undefined}\r\n          >\r\n            <div className=\"space-y-4\">\r\n              {/* Validation Errors */}\r\n              {validationErrors.length > 0 && (\r\n                <div className=\"p-3 bg-red-500/10 border border-red-500/30 rounded-lg\">\r\n                  <div className=\"flex items-start gap-2\">\r\n                    <AlertTriangle className=\"w-4 h-4 text-red-400 mt-0.5\" />\r\n                    <div className=\"text-sm text-red-400\">\r\n                      <p className=\"font-medium\">Fees exceed term sheet limits:</p>\r\n                      <ul className=\"mt-1 space-y-1\">\r\n                        {validationErrors.map((err, i) => (\r\n                          <li key={i}>• {err}</li>\r\n                        ))}\r\n                      </ul>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              )}\r\n\r\n              {/* Components List */}\r\n              {components.length === 0 ? (\r\n                <div className=\"text-center py-8 border-2 border-dashed border-border rounded-lg\">\r\n                  <DollarSign className=\"w-8 h-8 text-muted-foreground mx-auto mb-2\" />\r\n                  <p className=\"text-muted-foreground text-sm\">No fee components defined</p>\r\n                  <Button\r\n                    type=\"button\"\r\n                    onClick={addComponent}\r\n                    variant=\"outline\"\r\n                    size=\"sm\"\r\n                    className=\"mt-3 border-border text-muted-foreground hover:bg-muted\"\r\n                  >\r\n                    <Plus className=\"w-4 h-4 mr-2\" />\r\n                    Add First Component\r\n                  </Button>\r\n                </div>\r\n              ) : (\r\n                <div className=\"space-y-3\">\r\n                  {components.map((comp, index) => (\r\n                    <FeeComponentCard\r\n                      key={index}\r\n                      component={comp}\r\n                      index={index}\r\n                      onChange={(updates) => updateComponent(index, updates)}\r\n                      onRemove={() => removeComponent(index)}\r\n                      termSheetLimits={termSheetLimits}\r\n                    />\r\n                  ))}\r\n                  <Button\r\n                    type=\"button\"\r\n                    onClick={addComponent}\r\n                    variant=\"outline\"\r\n                    size=\"sm\"\r\n                    className=\"w-full border-border border-dashed text-muted-foreground hover:bg-muted hover:text-foreground\"\r\n                  >\r\n                    <Plus className=\"w-4 h-4 mr-2\" />\r\n                    Add Component\r\n                  </Button>\r\n                </div>\r\n              )}\r\n            </div>\r\n          </CollapsibleSection>\r\n\r\n          {/* Section 3: Agreement Terms (only for introducers/partners) */}\r\n          {(entityType === 'introducer' || entityType === 'partner') && (\r\n            <CollapsibleSection\r\n              title=\"Agreement Terms\"\r\n              icon={<ScrollText className=\"w-5 h-5\" />}\r\n              isOpen={expandedSections.agreement}\r\n              onToggle={() => toggleSection('agreement')}\r\n              badge={entityType === 'introducer' ? 'DOC 3' : 'Placement'}\r\n            >\r\n              <div className=\"space-y-6\">\r\n                {/* General Terms */}\r\n                <div className=\"space-y-4\">\r\n                  <h4 className=\"text-sm font-medium text-foreground flex items-center gap-2\">\r\n                    <div className=\"w-2 h-2 rounded-full bg-blue-500\" />\r\n                    General Terms\r\n                  </h4>\r\n                  <div className=\"grid grid-cols-3 gap-4 pl-4\">\r\n                    {/* Duration */}\r\n                    <div className=\"space-y-2\">\r\n                      <Label className=\"text-xs text-muted-foreground\">Agreement Duration</Label>\r\n                      <div className=\"flex items-center gap-2\">\r\n                        <Input\r\n                          type=\"number\"\r\n                          min=\"1\"\r\n                          value={agreementTerms.duration_months}\r\n                          onChange={(e) => updateAgreementTerms({ duration_months: Number(e.target.value) || 36 })}\r\n                          className=\"bg-muted/50 border-border text-foreground h-9 w-20\"\r\n                        />\r\n                        <span className=\"text-xs text-muted-foreground\">months</span>\r\n                      </div>\r\n                    </div>\r\n\r\n                    {/* Non-Circumvention */}\r\n                    <div className=\"space-y-2\">\r\n                      <Label className=\"text-xs text-muted-foreground\">Non-Circumvention</Label>\r\n                      <div className=\"flex items-center gap-2\">\r\n                        <Checkbox\r\n                          checked={agreementTerms.non_circumvention_indefinite}\r\n                          onCheckedChange={(checked) => {\r\n                            updateAgreementTerms({\r\n                              non_circumvention_indefinite: !!checked,\r\n                              non_circumvention_months: checked ? null : 24,\r\n                            });\r\n                          }}\r\n                          className=\"border-border\"\r\n                        />\r\n                        <span className=\"text-xs text-muted-foreground\">Indefinite</span>\r\n                        {!agreementTerms.non_circumvention_indefinite && (\r\n                          <>\r\n                            <Input\r\n                              type=\"number\"\r\n                              min=\"1\"\r\n                              value={agreementTerms.non_circumvention_months || ''}\r\n                              onChange={(e) => updateAgreementTerms({ non_circumvention_months: Number(e.target.value) || null })}\r\n                              className=\"bg-muted/50 border-border text-foreground h-8 w-16\"\r\n                            />\r\n                            <span className=\"text-xs text-muted-foreground\">mo</span>\r\n                          </>\r\n                        )}\r\n                      </div>\r\n                    </div>\r\n\r\n                    {/* Governing Law */}\r\n                    <div className=\"space-y-2\">\r\n                      <Label className=\"text-xs text-muted-foreground\">Governing Law</Label>\r\n                      <Select\r\n                        value={agreementTerms.governing_law}\r\n                        onValueChange={(val) => updateAgreementTerms({ governing_law: val })}\r\n                      >\r\n                        <SelectTrigger className=\"bg-muted/50 border-border text-foreground h-9 text-xs\">\r\n                          <SelectValue />\r\n                        </SelectTrigger>\r\n                        <SelectContent className=\"bg-popover border-border\">\r\n                          {GOVERNING_LAWS.map((law) => (\r\n                            <SelectItem key={law} value={law} className=\"text-xs\">\r\n                              {law}\r\n                            </SelectItem>\r\n                          ))}\r\n                        </SelectContent>\r\n                      </Select>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n\r\n                {/* Introduction Fee Terms */}\r\n                {hasSubscriptionComponent && (\r\n                  <div className=\"space-y-4\">\r\n                    <h4 className=\"text-sm font-medium text-foreground flex items-center gap-2\">\r\n                      <div className=\"w-2 h-2 rounded-full bg-green-500\" />\r\n                      Introduction Fee Payment\r\n                    </h4>\r\n                    <div className=\"pl-4\">\r\n                      <div className=\"space-y-2\">\r\n                        <Label className=\"text-xs text-muted-foreground\">Payment After Closing</Label>\r\n                        <div className=\"flex items-center gap-2\">\r\n                          <Input\r\n                            type=\"number\"\r\n                            min=\"1\"\r\n                            max=\"90\"\r\n                            value={agreementTerms.intro_payment_days}\r\n                            onChange={(e) => updateAgreementTerms({ intro_payment_days: Number(e.target.value) || 3 })}\r\n                            className=\"bg-muted/50 border-border text-foreground h-9 w-20\"\r\n                          />\r\n                          <span className=\"text-xs text-muted-foreground\">business days after share certificate</span>\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                )}\r\n\r\n                {/* Performance Fee Terms */}\r\n                {hasPerformanceComponent && (\r\n                  <div className=\"space-y-4\">\r\n                    <h4 className=\"text-sm font-medium text-foreground flex items-center gap-2\">\r\n                      <div className=\"w-2 h-2 rounded-full bg-purple-500\" />\r\n                      Performance Fee (Carried Interest)\r\n                    </h4>\r\n                    <div className=\"pl-4 space-y-4\">\r\n                      <div className=\"grid grid-cols-3 gap-4\">\r\n                        {/* Payment Days */}\r\n                        <div className=\"space-y-2\">\r\n                          <Label className=\"text-xs text-muted-foreground\">Payment After Redemption</Label>\r\n                          <div className=\"flex items-center gap-2\">\r\n                            <Input\r\n                              type=\"number\"\r\n                              min=\"1\"\r\n                              max=\"90\"\r\n                              value={agreementTerms.perf_payment_days}\r\n                              onChange={(e) => updateAgreementTerms({ perf_payment_days: Number(e.target.value) || 10 })}\r\n                              className=\"bg-muted/50 border-border text-foreground h-9 w-20\"\r\n                            />\r\n                            <span className=\"text-xs text-muted-foreground\">days</span>\r\n                          </div>\r\n                        </div>\r\n\r\n                        {/* Hurdle Rate */}\r\n                        <div className=\"space-y-2\">\r\n                          <Label className=\"text-xs text-muted-foreground\">Hurdle Rate</Label>\r\n                          <div className=\"flex items-center gap-2\">\r\n                            <Input\r\n                              type=\"number\"\r\n                              min=\"0\"\r\n                              value={agreementTerms.hurdle_rate_bps || ''}\r\n                              onChange={(e) => updateAgreementTerms({ hurdle_rate_bps: e.target.value ? Number(e.target.value) : undefined })}\r\n                              placeholder=\"800\"\r\n                              className=\"bg-muted/50 border-border text-foreground h-9 w-24\"\r\n                            />\r\n                            <span className=\"text-xs text-muted-foreground\">bps</span>\r\n                          </div>\r\n                          {agreementTerms.hurdle_rate_bps && (\r\n                            <p className=\"text-xs text-blue-600 dark:text-blue-400\">= {(agreementTerms.hurdle_rate_bps / 100).toFixed(2)}%</p>\r\n                          )}\r\n                        </div>\r\n                      </div>\r\n\r\n                      {/* Checkboxes Row */}\r\n                      <div className=\"flex flex-wrap gap-6\">\r\n                        {/* GP Catchup */}\r\n                        <div className=\"flex items-center gap-2\">\r\n                          <Checkbox\r\n                            checked={agreementTerms.has_catchup}\r\n                            onCheckedChange={(checked) => updateAgreementTerms({ has_catchup: !!checked })}\r\n                            className=\"border-border\"\r\n                          />\r\n                          <span className=\"text-sm text-muted-foreground\">GP Catchup</span>\r\n                          {agreementTerms.has_catchup && (\r\n                            <div className=\"flex items-center gap-1 ml-2\">\r\n                              <Input\r\n                                type=\"number\"\r\n                                value={agreementTerms.catchup_rate_bps || ''}\r\n                                onChange={(e) => updateAgreementTerms({ catchup_rate_bps: e.target.value ? Number(e.target.value) : undefined })}\r\n                                className=\"bg-muted/50 border-border text-foreground h-8 w-20\"\r\n                              />\r\n                              <span className=\"text-xs text-muted-foreground\">bps</span>\r\n                            </div>\r\n                          )}\r\n                        </div>\r\n\r\n                        {/* High Water Mark */}\r\n                        <div className=\"flex items-center gap-2\">\r\n                          <Checkbox\r\n                            checked={agreementTerms.has_high_water_mark}\r\n                            onCheckedChange={(checked) => updateAgreementTerms({ has_high_water_mark: !!checked })}\r\n                            className=\"border-border\"\r\n                          />\r\n                          <span className=\"text-sm text-muted-foreground\">High Water Mark</span>\r\n                        </div>\r\n\r\n                        {/* No Cap */}\r\n                        <div className=\"flex items-center gap-2\">\r\n                          <Checkbox\r\n                            checked={agreementTerms.has_no_cap}\r\n                            onCheckedChange={(checked) => {\r\n                              updateAgreementTerms({\r\n                                has_no_cap: !!checked,\r\n                                performance_cap_percent: checked ? undefined : 20,\r\n                              });\r\n                            }}\r\n                            className=\"border-border\"\r\n                          />\r\n                          <span className=\"text-sm text-muted-foreground\">No Cap</span>\r\n                          {!agreementTerms.has_no_cap && (\r\n                            <div className=\"flex items-center gap-1 ml-2\">\r\n                              <Input\r\n                                type=\"number\"\r\n                                step=\"0.1\"\r\n                                min=\"0\"\r\n                                max=\"100\"\r\n                                value={agreementTerms.performance_cap_percent || ''}\r\n                                onChange={(e) => updateAgreementTerms({ performance_cap_percent: e.target.value ? Number(e.target.value) : undefined })}\r\n                                className=\"bg-muted/50 border-border text-foreground h-8 w-16\"\r\n                              />\r\n                              <span className=\"text-xs text-muted-foreground\">%</span>\r\n                            </div>\r\n                          )}\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                )}\r\n\r\n                {/* VAT */}\r\n                <div className=\"space-y-4\">\r\n                  <h4 className=\"text-sm font-medium text-foreground flex items-center gap-2\">\r\n                    <div className=\"w-2 h-2 rounded-full bg-amber-500\" />\r\n                    VAT Information\r\n                  </h4>\r\n                  <div className=\"pl-4\">\r\n                    <div className=\"space-y-2 max-w-xs\">\r\n                      <Label className=\"text-xs text-muted-foreground\">VAT Registration Number</Label>\r\n                      <Input\r\n                        value={agreementTerms.vat_number}\r\n                        onChange={(e) => updateAgreementTerms({ vat_number: e.target.value })}\r\n                        placeholder=\"e.g., GB123456789\"\r\n                        className=\"bg-muted/50 border-border text-foreground h-9\"\r\n                      />\r\n                      <p className=\"text-xs text-muted-foreground\">Leave blank if not VAT registered</p>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </CollapsibleSection>\r\n          )}\r\n        </div>\r\n\r\n        {/* Footer */}\r\n        <div className=\"px-10 py-6 border-t border-border bg-muted/60 flex items-center justify-between shrink-0\">\r\n          <div className=\"text-base text-muted-foreground\">\r\n            <span className=\"font-semibold text-foreground text-lg\">{components.length}</span> fee component{components.length !== 1 ? 's' : ''} defined\r\n            {validationErrors.length > 0 && (\r\n              <span className=\"text-red-500 dark:text-red-400 ml-4 inline-flex items-center gap-2\">\r\n                <AlertTriangle className=\"w-5 h-5\" />\r\n                {validationErrors.length} validation error{validationErrors.length !== 1 ? 's' : ''}\r\n              </span>\r\n            )}\r\n          </div>\r\n          <div className=\"flex items-center gap-5\">\r\n            <Button\r\n              type=\"button\"\r\n              variant=\"outline\"\r\n              onClick={onClose}\r\n              disabled={loading}\r\n              className=\"border-border text-foreground hover:bg-muted h-12 px-8 text-base font-medium\"\r\n            >\r\n              Cancel\r\n            </Button>\r\n            <Button\r\n              type=\"button\"\r\n              onClick={handleSave}\r\n              disabled={loading || !basicInfoComplete || validationErrors.length > 0}\r\n              className=\"bg-blue-600 hover:bg-blue-500 h-12 px-10 min-w-[180px] text-base font-semibold shadow-lg shadow-blue-500/20\"\r\n            >\r\n              {loading ? (\r\n                <>\r\n                  <Loader2 className=\"w-5 h-5 mr-2 animate-spin\" />\r\n                  Saving...\r\n                </>\r\n              ) : (\r\n                <>{isEditing ? 'Update Fee Plan' : 'Create Fee Plan'}</>\r\n              )}\r\n            </Button>\r\n          </div>\r\n        </div>\r\n      </DialogContent>\r\n    </Dialog>\r\n  );\r\n}\r\n","/**\n * Term Sheet Selector Component\n *\n * Allows selection of a published term sheet for a deal.\n * Fee models must be derived from term sheets per business requirements.\n */\n\n'use client';\n\nimport { useState, useEffect } from 'react';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { Label } from '@/components/ui/label';\nimport { Badge } from '@/components/ui/badge';\nimport { Loader2, FileText, AlertCircle } from 'lucide-react';\n\nexport interface TermSheet {\n  id: string;\n  deal_id: string;\n  version: number;\n  status: string;\n  term_sheet_date: string | null;\n  subscription_fee_percent: number | null;\n  management_fee_percent: number | null;\n  carried_interest_percent: number | null;\n  published_at: string | null;\n}\n\ninterface TermSheetSelectorProps {\n  dealId: string | undefined;\n  value?: string;\n  onChange: (termSheetId: string | undefined, termSheet: TermSheet | null) => void;\n  required?: boolean;\n  disabled?: boolean;\n}\n\nexport function TermSheetSelector({\n  dealId,\n  value,\n  onChange,\n  required = true,\n  disabled = false,\n}: TermSheetSelectorProps) {\n  const [loading, setLoading] = useState(false);\n  const [termSheets, setTermSheets] = useState<TermSheet[]>([]);\n  const [error, setError] = useState<string | null>(null);\n\n  useEffect(() => {\n    if (dealId) {\n      loadTermSheets(dealId);\n    } else {\n      setTermSheets([]);\n      onChange(undefined, null);\n    }\n  }, [dealId]);\n\n  const loadTermSheets = async (dId: string) => {\n    setLoading(true);\n    setError(null);\n    try {\n      const res = await fetch(`/api/deals/${dId}/fee-structures?status=published`);\n      if (!res.ok) {\n        throw new Error('Failed to load term sheets');\n      }\n      const json = await res.json();\n      const sheets = json.term_sheets || [];\n      setTermSheets(sheets);\n\n      // If current value is not in the list, clear it\n      if (value && !sheets.find((ts: TermSheet) => ts.id === value)) {\n        onChange(undefined, null);\n      }\n    } catch (err) {\n      console.error('Error loading term sheets:', err);\n      setError('Failed to load term sheets');\n      setTermSheets([]);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleChange = (termSheetId: string) => {\n    if (termSheetId === 'none') {\n      onChange(undefined, null);\n    } else {\n      const selected = termSheets.find(ts => ts.id === termSheetId);\n      onChange(termSheetId, selected || null);\n    }\n  };\n\n  const formatFeePercent = (value: number | null | undefined): string => {\n    if (value === null || value === undefined) return '-';\n    return `${value}%`;\n  };\n\n  const selectedTermSheet = termSheets.find(ts => ts.id === value);\n\n  if (!dealId) {\n    return (\n      <div className=\"space-y-2\">\n        <Label className=\"text-foreground font-medium\">\n          Term Sheet {required && <span className=\"text-red-500 dark:text-red-400\">*</span>}\n        </Label>\n        <div className=\"flex items-center gap-2 text-amber-600 dark:text-amber-400 text-sm bg-amber-500/10 p-3 rounded border border-amber-500/30\">\n          <AlertCircle className=\"h-4 w-4\" />\n          <span>Select a deal first to see available term sheets</span>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-2\">\n      <Label className=\"text-foreground font-medium\">\n        Term Sheet {required && <span className=\"text-red-500 dark:text-red-400\">*</span>}\n      </Label>\n\n      {loading ? (\n        <div className=\"flex items-center gap-2 text-muted-foreground h-11 px-3 border border-border rounded-md bg-muted/50\">\n          <Loader2 className=\"h-4 w-4 animate-spin\" />\n          <span className=\"text-sm\">Loading term sheets...</span>\n        </div>\n      ) : error ? (\n        <div className=\"flex items-center gap-2 text-red-500 dark:text-red-400 text-sm bg-red-500/10 p-3 rounded border border-red-500/30\">\n          <AlertCircle className=\"h-4 w-4\" />\n          <span>{error}</span>\n        </div>\n      ) : termSheets.length === 0 ? (\n        <div className=\"flex items-center gap-2 text-amber-600 dark:text-amber-400 text-sm bg-amber-500/10 p-3 rounded border border-amber-500/30\">\n          <AlertCircle className=\"h-4 w-4\" />\n          <span>No published term sheets available for this deal. Create and publish a term sheet first.</span>\n        </div>\n      ) : (\n        <>\n          <Select\n            value={value || 'none'}\n            onValueChange={handleChange}\n            disabled={disabled}\n          >\n            <SelectTrigger className=\"bg-muted/50 border-border text-foreground h-11\">\n              <SelectValue placeholder=\"Select a term sheet\" />\n            </SelectTrigger>\n            <SelectContent className=\"bg-popover border-border\">\n              {!required && (\n                <SelectItem value=\"none\">No term sheet</SelectItem>\n              )}\n              {termSheets.map((ts) => (\n                <SelectItem key={ts.id} value={ts.id}>\n                  <div className=\"flex items-center gap-2\">\n                    <FileText className=\"h-4 w-4 text-muted-foreground\" />\n                    <span>Version {ts.version}</span>\n                    {ts.term_sheet_date && (\n                      <span className=\"text-muted-foreground text-xs\">\n                        ({new Date(ts.term_sheet_date).toLocaleDateString()})\n                      </span>\n                    )}\n                  </div>\n                </SelectItem>\n              ))}\n            </SelectContent>\n          </Select>\n\n          {/* Show fee summary when a term sheet is selected */}\n          {selectedTermSheet && (\n            <div className=\"bg-muted/50 border border-border rounded-md p-3 mt-2\">\n              <p className=\"text-xs text-muted-foreground mb-2 font-medium\">Term Sheet Fee Limits:</p>\n              <div className=\"flex flex-wrap gap-2\">\n                <Badge variant=\"outline\" className=\"text-xs border-blue-500/30 text-blue-600 dark:text-blue-400\">\n                  Subscription: {formatFeePercent(selectedTermSheet.subscription_fee_percent)}\n                </Badge>\n                <Badge variant=\"outline\" className=\"text-xs border-green-500/30 text-green-600 dark:text-green-400\">\n                  Management: {formatFeePercent(selectedTermSheet.management_fee_percent)}\n                </Badge>\n                <Badge variant=\"outline\" className=\"text-xs border-purple-500/30 text-purple-600 dark:text-purple-400\">\n                  Performance: {formatFeePercent(selectedTermSheet.carried_interest_percent)}\n                </Badge>\n              </div>\n              <p className=\"text-xs text-muted-foreground mt-2\">\n                Fee model values must not exceed these limits.\n              </p>\n            </div>\n          )}\n        </>\n      )}\n    </div>\n  );\n}\n","/**\n * Entity Selector Component\n *\n * Allows selection of an introducer, partner, or commercial partner for a fee model.\n * Fee models are commercial agreements with entities, not investor-facing.\n */\n\n'use client';\n\nimport { useState, useEffect } from 'react';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { Label } from '@/components/ui/label';\nimport { Loader2, Users, Building2, Briefcase, AlertCircle } from 'lucide-react';\n\nexport type EntityType = 'introducer' | 'partner' | 'commercial_partner';\n\ninterface Entity {\n  id: string;\n  name: string;\n  email?: string;\n  company_name?: string;\n}\n\ninterface EntitySelectorProps {\n  dealId: string | undefined;\n  entityType: EntityType | undefined;\n  onEntityTypeChange: (type: EntityType | undefined) => void;\n  entityId: string | undefined;\n  onEntityIdChange: (id: string | undefined) => void;\n  required?: boolean;\n  disabled?: boolean;\n  /** Entity types to exclude from selection */\n  excludeTypes?: EntityType[];\n}\n\nexport function EntitySelector({\n  dealId,\n  entityType,\n  onEntityTypeChange,\n  entityId,\n  onEntityIdChange,\n  required = true,\n  disabled = false,\n  excludeTypes = [],\n}: EntitySelectorProps) {\n  const [loading, setLoading] = useState(false);\n  const [entities, setEntities] = useState<Entity[]>([]);\n  const [error, setError] = useState<string | null>(null);\n\n  useEffect(() => {\n    if (dealId && entityType) {\n      loadEntities(dealId, entityType);\n    } else {\n      setEntities([]);\n      onEntityIdChange(undefined);\n    }\n  }, [dealId, entityType]);\n\n  const loadEntities = async (dId: string, type: EntityType) => {\n    setLoading(true);\n    setError(null);\n    try {\n      // Load entities dispatched to this deal based on type\n      let endpoint = '';\n      switch (type) {\n        case 'introducer':\n          endpoint = `/api/deals/${dId}/introducers`;\n          break;\n        case 'partner':\n          endpoint = `/api/deals/${dId}/partners`;\n          break;\n        case 'commercial_partner':\n          endpoint = `/api/deals/${dId}/commercial-partners`;\n          break;\n      }\n\n      const res = await fetch(endpoint);\n      if (!res.ok) {\n        // If endpoint doesn't exist or returns error, try fallback\n        console.warn(`Entity endpoint ${endpoint} not available, trying fallback`);\n        await loadEntitiesFallback(type);\n        return;\n      }\n\n      const json = await res.json();\n      // Handle different response formats from various endpoints\n      let entityList = json.introducers || json.partners || json.commercial_partners || [];\n\n      // Deal-specific endpoints return { data: [...] } with transformed entities\n      if (entityList.length === 0 && json.data && Array.isArray(json.data)) {\n        // Transform the deal-specific format to entity format\n        entityList = json.data\n          .filter((item: any) => item.entity_type === type.replace('_', ''))\n          .map((item: any) => ({\n            id: item.entity_id,\n            name: item.entity_name,\n            email: item.entity_email,\n          }));\n      }\n\n      // If still empty, fall back to admin endpoint to get ALL entities\n      if (entityList.length === 0) {\n        console.log(`No ${type}s found for deal, loading all ${type}s from admin endpoint`);\n        await loadEntitiesFallback(type);\n        return;\n      }\n\n      setEntities(entityList);\n\n      // If current value is not in the list, clear it\n      if (entityId && !entityList.find((e: Entity) => e.id === entityId)) {\n        onEntityIdChange(undefined);\n      }\n    } catch (err) {\n      console.error('Error loading entities:', err);\n      await loadEntitiesFallback(type);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  // Fallback to load all entities of a type (not deal-specific)\n  // Uses admin endpoints which list all entities in the system\n  const loadEntitiesFallback = async (type: EntityType) => {\n    try {\n      let endpoint = '';\n      switch (type) {\n        case 'introducer':\n          endpoint = '/api/admin/introducers';\n          break;\n        case 'partner':\n          endpoint = '/api/admin/partners';\n          break;\n        case 'commercial_partner':\n          endpoint = '/api/admin/commercial-partners';\n          break;\n      }\n\n      const res = await fetch(endpoint);\n      if (!res.ok) {\n        throw new Error(`Failed to load ${type}s`);\n      }\n\n      const json = await res.json();\n      // Admin endpoints return data in various formats - handle all possibilities\n      const entityList = json.introducers || json.partners || json.commercial_partners || json.data || [];\n\n      // Map the entity list to a common format\n      const normalizedEntities = entityList.map((entity: any) => ({\n        id: entity.id,\n        name: entity.name || entity.legal_name || entity.company_name || entity.contact_name,\n        email: entity.email || entity.contact_email,\n        company_name: entity.company_name || entity.legal_name,\n      }));\n\n      setEntities(normalizedEntities);\n    } catch (err) {\n      console.error('Error in fallback loading:', err);\n      setError(`Failed to load ${type}s`);\n      setEntities([]);\n    }\n  };\n\n  const handleEntityTypeChange = (value: string) => {\n    if (value === 'none') {\n      onEntityTypeChange(undefined);\n      onEntityIdChange(undefined);\n    } else {\n      onEntityTypeChange(value as EntityType);\n      onEntityIdChange(undefined); // Reset entity when type changes\n    }\n  };\n\n  const handleEntityChange = (value: string) => {\n    if (value === 'none') {\n      onEntityIdChange(undefined);\n    } else {\n      onEntityIdChange(value);\n    }\n  };\n\n  const getEntityTypeIcon = (type: EntityType | undefined) => {\n    switch (type) {\n      case 'introducer':\n        return <Users className=\"h-4 w-4\" />;\n      case 'partner':\n        return <Building2 className=\"h-4 w-4\" />;\n      case 'commercial_partner':\n        return <Briefcase className=\"h-4 w-4\" />;\n      default:\n        return null;\n    }\n  };\n\n  const getEntityTypeLabel = (type: EntityType): string => {\n    switch (type) {\n      case 'introducer':\n        return 'Introducer';\n      case 'partner':\n        return 'Partner';\n      case 'commercial_partner':\n        return 'Commercial Partner';\n    }\n  };\n\n  if (!dealId) {\n    return (\n      <div className=\"space-y-4\">\n        <div className=\"space-y-2\">\n          <Label className=\"text-white font-medium\">\n            Entity Type {required && <span className=\"text-red-400\">*</span>}\n          </Label>\n          <div className=\"flex items-center gap-2 text-amber-400 text-sm bg-amber-500/10 p-3 rounded border border-amber-500/30\">\n            <AlertCircle className=\"h-4 w-4\" />\n            <span>Select a deal first to assign an entity</span>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-4\">\n      {/* Entity Type Selector */}\n      <div className=\"space-y-2\">\n        <Label className=\"text-white font-medium\">\n          Entity Type {required && <span className=\"text-red-400\">*</span>}\n        </Label>\n        <Select\n          value={entityType || 'none'}\n          onValueChange={handleEntityTypeChange}\n          disabled={disabled}\n        >\n          <SelectTrigger className=\"bg-black border-gray-700 text-white h-11\">\n            <SelectValue placeholder=\"Select entity type\" />\n          </SelectTrigger>\n          <SelectContent className=\"bg-black border-gray-700 text-white\">\n            {!required && (\n              <SelectItem value=\"none\">No entity</SelectItem>\n            )}\n            {!excludeTypes.includes('introducer') && (\n              <SelectItem value=\"introducer\">\n                <div className=\"flex items-center gap-2\">\n                  <Users className=\"h-4 w-4 text-blue-400\" />\n                  <span>Introducer</span>\n                </div>\n              </SelectItem>\n            )}\n            {!excludeTypes.includes('partner') && (\n              <SelectItem value=\"partner\">\n                <div className=\"flex items-center gap-2\">\n                  <Building2 className=\"h-4 w-4 text-green-400\" />\n                  <span>Partner</span>\n                </div>\n              </SelectItem>\n            )}\n            {!excludeTypes.includes('commercial_partner') && (\n              <SelectItem value=\"commercial_partner\">\n                <div className=\"flex items-center gap-2\">\n                  <Briefcase className=\"h-4 w-4 text-purple-400\" />\n                  <span>Commercial Partner</span>\n                </div>\n              </SelectItem>\n            )}\n          </SelectContent>\n        </Select>\n      </div>\n\n      {/* Entity Selector (only shown when type is selected) */}\n      {entityType && (\n        <div className=\"space-y-2\">\n          <Label className=\"text-white font-medium\">\n            {getEntityTypeLabel(entityType)} {required && <span className=\"text-red-400\">*</span>}\n          </Label>\n\n          {loading ? (\n            <div className=\"flex items-center gap-2 text-gray-400 h-11 px-3 border border-gray-700 rounded-md bg-black\">\n              <Loader2 className=\"h-4 w-4 animate-spin\" />\n              <span className=\"text-sm\">Loading {entityType}s...</span>\n            </div>\n          ) : error ? (\n            <div className=\"flex items-center gap-2 text-red-400 text-sm bg-red-500/10 p-3 rounded border border-red-500/30\">\n              <AlertCircle className=\"h-4 w-4\" />\n              <span>{error}</span>\n            </div>\n          ) : entities.length === 0 ? (\n            <div className=\"flex items-center gap-2 text-amber-400 text-sm bg-amber-500/10 p-3 rounded border border-amber-500/30\">\n              <AlertCircle className=\"h-4 w-4\" />\n              <span>No {entityType}s available. Add {entityType}s to the system first.</span>\n            </div>\n          ) : (\n            <Select\n              value={entityId || 'none'}\n              onValueChange={handleEntityChange}\n              disabled={disabled}\n            >\n              <SelectTrigger className=\"bg-black border-gray-700 text-white h-11\">\n                <SelectValue placeholder={`Select ${getEntityTypeLabel(entityType)}`} />\n              </SelectTrigger>\n              <SelectContent className=\"bg-black border-gray-700 text-white max-h-60\">\n                {!required && (\n                  <SelectItem value=\"none\">No selection</SelectItem>\n                )}\n                {entities.map((entity) => (\n                  <SelectItem key={entity.id} value={entity.id}>\n                    <div className=\"flex items-center gap-2\">\n                      {getEntityTypeIcon(entityType)}\n                      <span>{entity.name || entity.company_name}</span>\n                      {entity.email && (\n                        <span className=\"text-gray-400 text-xs\">({entity.email})</span>\n                      )}\n                    </div>\n                  </SelectItem>\n                ))}\n              </SelectContent>\n            </Select>\n          )}\n        </div>\n      )}\n    </div>\n  );\n}\n","/**\r\n * Term Sheet & Fee Plan Utilities\r\n *\r\n * IMPORTANT ARCHITECTURAL NOTE:\r\n * Term sheets and fee plans/models serve DIFFERENT purposes:\r\n * - Term sheets: Investor-facing fee disclosures\r\n * - Fee models: Introducer/Partner commission agreements\r\n *\r\n * Fee models must be MANUALLY created and linked to term sheets.\r\n * Auto-sync between term sheets and fee plans has been DEPRECATED.\r\n */\r\n\r\nimport { SupabaseClient } from '@supabase/supabase-js';\r\n\r\n/**\r\n * Convert percent to basis points\r\n * @param percent - Percentage value (e.g., 2.5 for 2.5%)\r\n * @returns Basis points (e.g., 250 for 2.5%)\r\n */\r\nexport function percentToBps(percent: number | null | undefined): number | null {\r\n  if (percent === null || percent === undefined) return null;\r\n  return Math.round(percent * 100);\r\n}\r\n\r\n/**\r\n * Convert basis points to percent\r\n * @param bps - Basis points (e.g., 250 for 2.5%)\r\n * @returns Percentage value (e.g., 2.5 for 2.5%)\r\n */\r\nexport function bpsToPercent(bps: number | null | undefined): number | null {\r\n  if (bps === null || bps === undefined) return null;\r\n  return bps / 100;\r\n}\r\n\r\n/**\r\n * Validate that fee model values do not exceed term sheet limits\r\n * @param feeComponents - Array of fee components to validate\r\n * @param termSheet - The term sheet to validate against\r\n * @returns Array of validation error messages (empty if valid)\r\n */\r\nexport function validateFeeComponentsAgainstTermSheet(\r\n  feeComponents: Array<{ kind: string; rate_bps?: number | null }>,\r\n  termSheet: {\r\n    subscription_fee_percent?: number | null;\r\n    management_fee_percent?: number | null;\r\n    carried_interest_percent?: number | null;\r\n  }\r\n): string[] {\r\n  const errors: string[] = [];\r\n\r\n  for (const comp of feeComponents) {\r\n    if (!comp.rate_bps) continue;\r\n\r\n    const compPercent = bpsToPercent(comp.rate_bps);\r\n    if (compPercent === null) continue;\r\n\r\n    switch (comp.kind) {\r\n      case 'subscription':\r\n        if (termSheet.subscription_fee_percent !== null &&\r\n            termSheet.subscription_fee_percent !== undefined &&\r\n            compPercent > termSheet.subscription_fee_percent) {\r\n          errors.push(\r\n            `Subscription fee (${compPercent}%) exceeds term sheet limit (${termSheet.subscription_fee_percent}%)`\r\n          );\r\n        }\r\n        break;\r\n      case 'management':\r\n        if (termSheet.management_fee_percent !== null &&\r\n            termSheet.management_fee_percent !== undefined &&\r\n            compPercent > termSheet.management_fee_percent) {\r\n          errors.push(\r\n            `Management fee (${compPercent}%) exceeds term sheet limit (${termSheet.management_fee_percent}%)`\r\n          );\r\n        }\r\n        break;\r\n      case 'performance':\r\n        if (termSheet.carried_interest_percent !== null &&\r\n            termSheet.carried_interest_percent !== undefined &&\r\n            compPercent > termSheet.carried_interest_percent) {\r\n          errors.push(\r\n            `Performance fee (${compPercent}%) exceeds term sheet limit (${termSheet.carried_interest_percent}%)`\r\n          );\r\n        }\r\n        break;\r\n    }\r\n  }\r\n\r\n  return errors;\r\n}\r\n\r\n/**\r\n * @deprecated Fee models must be manually created. Auto-sync is disabled.\r\n *\r\n * This function previously auto-generated fee plans from published term sheets.\r\n * Per business requirements (Fred), fee models are commercial agreements with\r\n * introducers/partners and must be manually created, not auto-generated.\r\n *\r\n * The function is kept for backward compatibility but does nothing.\r\n * All callers should be removed.\r\n */\r\nexport async function syncTermSheetToFeePlan(\r\n  supabase: SupabaseClient,\r\n  termSheet: {\r\n    id: string;\r\n    subscription_fee_percent?: number | null;\r\n    management_fee_percent?: number | null;\r\n    carried_interest_percent?: number | null;\r\n  },\r\n  dealId: string,\r\n  userId: string\r\n): Promise<{ success: boolean; error?: string; feePlanId?: string }> {\r\n  console.warn(\r\n    '[DEPRECATED] syncTermSheetToFeePlan() called but auto-sync is disabled. ' +\r\n    'Fee models must be manually created by staff and linked to term sheets. ' +\r\n    `Term sheet: ${termSheet.id}, Deal: ${dealId}`\r\n  );\r\n\r\n  // No-op - return success without creating anything\r\n  return { success: true };\r\n}\r\n\r\n/**\r\n * @deprecated Fee models and term sheets serve different purposes - no sync.\r\n *\r\n * This function previously synced fee plan values back to term sheets.\r\n * Per business requirements (Fred):\r\n * - Term sheets are investor-facing fee disclosures\r\n * - Fee models are introducer/partner commission agreements\r\n *\r\n * They should NOT sync as they have different values for different audiences.\r\n * The function is kept for backward compatibility but does nothing.\r\n */\r\nexport async function syncFeePlanToTermSheet(\r\n  supabase: SupabaseClient,\r\n  feePlanId: string,\r\n  dealId: string\r\n): Promise<{ success: boolean; error?: string }> {\r\n  console.warn(\r\n    '[DEPRECATED] syncFeePlanToTermSheet() called but sync is disabled. ' +\r\n    'Term sheets (investor-facing) and fee models (partner/introducer agreements) ' +\r\n    'serve different purposes and should not sync. ' +\r\n    `Fee plan: ${feePlanId}, Deal: ${dealId}`\r\n  );\r\n\r\n  // No-op - return success without doing anything\r\n  return { success: true };\r\n}\r\n"],"names":[],"mappings":"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"}