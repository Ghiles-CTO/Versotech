{"version":3,"sources":["../../../../../versotech-portal/src/components/approvals/approvals-page-client.tsx/__nextjs-internal-proxy.mjs","../../../../../versotech-portal/src/app/%28staff%29/versotech/staff/approvals/page.tsx"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport const ApprovalsPageClient = registerClientReference(\n    function() { throw new Error(\"Attempted to call ApprovalsPageClient() from the server but ApprovalsPageClient is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/versotech-portal/src/components/approvals/approvals-page-client.tsx\",\n    \"ApprovalsPageClient\",\n);\n","import { Filter, Download } from 'lucide-react'\r\nimport { Button } from '@/components/ui/button'\r\nimport { ApprovalsPageClient } from '@/components/approvals/approvals-page-client'\r\nimport { Approval, ApprovalStats } from '@/types/approvals'\r\nimport { createServiceClient } from '@/lib/supabase/server'\r\n\r\nexport const dynamic = 'force-dynamic'\r\n\r\n// Fetch approval data server-side directly from database\r\nasync function fetchApprovalData(): Promise<{\r\n  approvals: Approval[]\r\n  stats: ApprovalStats\r\n  counts: { pending: number; approved: number; rejected: number }\r\n  hasData: boolean\r\n}> {\r\n  try {\r\n    // Use service client to bypass RLS for staff users\r\n    const supabase = createServiceClient()\r\n\r\n    // Calculate 30-day cutoff for historical approved/rejected items\r\n    const thirtyDaysAgo = new Date()\r\n    thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30)\r\n\r\n    // Fetch all statuses for Kanban view support (pending + recent approved/rejected)\r\n    const { data: approvals, error: approvalsError } = await supabase\r\n      .from('approvals')\r\n      .select(`\r\n        *,\r\n        requested_by_profile:requested_by (\r\n          id,\r\n          display_name,\r\n          email,\r\n          role\r\n        ),\r\n        assigned_to_profile:assigned_to (\r\n          id,\r\n          display_name,\r\n          email,\r\n          role\r\n        ),\r\n        approved_by_profile:approved_by (\r\n          id,\r\n          display_name,\r\n          email,\r\n          role\r\n        ),\r\n        related_deal:deals (\r\n          id,\r\n          name,\r\n          status,\r\n          deal_type,\r\n          currency\r\n        ),\r\n        related_investor:investors (\r\n          id,\r\n          legal_name,\r\n          kyc_status,\r\n          type\r\n        )\r\n      `)\r\n      // Kanban view: Pending (all) OR (approved/rejected with resolved_at >= 30 days)\r\n      .or(`status.eq.pending,and(status.in.(approved,rejected),resolved_at.gte.${thirtyDaysAgo.toISOString()})`)\r\n      .order('sla_breach_at', { ascending: true, nullsFirst: false })\r\n      .order('created_at', { ascending: false })\r\n\r\n    if (approvalsError) {\r\n      console.error('[Approvals] Error fetching approvals:', approvalsError)\r\n      return getEmptyData()\r\n    }\r\n\r\n    console.log(`[Approvals] Fetched ${approvals?.length || 0} approvals (pending + recent approved/rejected)`)\r\n\r\n    // Get statistics using RPC function\r\n    const { data: statsData, error: statsError } = await supabase\r\n      .rpc('get_approval_stats', { p_staff_id: null })\r\n      .single()\r\n\r\n    if (statsError) {\r\n      console.warn('[Approvals] Error fetching stats:', statsError)\r\n    }\r\n\r\n    const stats: ApprovalStats = (statsData || {\r\n      total_pending: approvals?.length || 0,\r\n      overdue_count: 0,\r\n      avg_processing_time_hours: 0,\r\n      approval_rate_24h: 0,\r\n      total_approved_30d: 0,\r\n      total_rejected_30d: 0,\r\n      total_awaiting_info: 0\r\n    }) as ApprovalStats\r\n\r\n    console.log('[Approvals] Stats:', stats)\r\n\r\n    return {\r\n      approvals: (approvals || []) as Approval[],\r\n      stats,\r\n      counts: {\r\n        pending: stats.total_pending,\r\n        approved: stats.total_approved_30d,\r\n        rejected: stats.total_rejected_30d\r\n      },\r\n      hasData: (approvals && approvals.length > 0) || false\r\n    }\r\n  } catch (error) {\r\n    console.error('[Approvals] Error in fetchApprovalData:', error)\r\n    return getEmptyData()\r\n  }\r\n}\r\n\r\nfunction getEmptyData() {\r\n  return {\r\n    approvals: [],\r\n    stats: {\r\n      total_pending: 0,\r\n      overdue_count: 0,\r\n      avg_processing_time_hours: 0,\r\n      approval_rate_24h: 0,\r\n      total_approved_30d: 0,\r\n      total_rejected_30d: 0,\r\n      total_awaiting_info: 0\r\n    },\r\n    counts: { pending: 0, approved: 0, rejected: 0 },\r\n    hasData: false\r\n  }\r\n}\r\n\r\nexport default async function ApprovalsPage() {\r\n  // Fetch approval data server-side\r\n  const { approvals, stats, counts, hasData } = await fetchApprovalData()\r\n\r\n  return (\r\n    <div className=\"p-6 space-y-8\">\r\n        {/* Header */}\r\n        <div className=\"border-b border-gray-800 pb-6\">\r\n          <h1 className=\"text-3xl font-bold text-foreground\">Approval Queue</h1>\r\n          <p className=\"text-lg text-muted-foreground mt-1\">\r\n            Review and approve investor commitments and allocations\r\n          </p>\r\n        </div>\r\n\r\n        {/* Client Component with Interactive Features */}\r\n        <ApprovalsPageClient\r\n          initialApprovals={approvals}\r\n          initialStats={stats}\r\n          initialCounts={counts}\r\n        />\r\n      </div>\r\n    )\r\n}"],"names":[],"mappings":"0aAEO,IAAM,EAAsB,CAAA,EAAA,AADnC,EAAA,CAAA,CAAA,QACmC,uBAAA,AAAuB,EACtD,WAAa,MAAM,AAAI,MAAM,oPAAsP,EACnR,oGACA,mFAHG,IAAM,EAAsB,CAAA,EADnC,AACmC,EADnC,CAAA,CAAA,QACmC,uBAAA,AAAuB,EACtD,WAAa,MAAM,AAAI,MAAM,oPAAsP,EACnR,gFACA,gICHJ,EAAA,EAAA,CAAA,CAAA,QAEA,EAAA,EAAA,CAAA,CAAA,QAKA,eAAe,IAMb,GAAI,CAEF,IAAM,EAAW,CAAA,EAAA,EAAA,mBAAA,AAAmB,IAG9B,EAAgB,IAAI,KAC1B,EAAc,OAAO,CAAC,EAAc,OAAO,GAAK,IAGhD,GAAM,CAAE,KAAM,CAAS,CAAE,MAAO,CAAc,CAAE,CAAG,MAAM,EACtD,IAAI,CAAC,aACL,MAAM,CAAC,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;MAiCT,CAAC,CACD,CACC,EAAE,CAAC,CAAC,oEAAoE,EAAE,EAAc,GADT,QACoB,GAAG,CAAC,CAAC,EACxG,KAAK,CAAC,gBAAiB,CAAE,WAAW,EAAM,YAAY,CAAM,GAC5D,KAAK,CAAC,aAAc,CAAE,WAAW,CAAM,GAE1C,GAAI,EAEF,OADA,OADkB,CACV,KAAK,CAAC,wCAAyC,GAChD,IAGT,QAAQ,GAAG,CAAC,CAAC,oBAAoB,EAAE,GAAW,QAAU,EAAE,+CAA+C,CAAC,EAG1G,GAAM,CAAE,KAAM,CAAS,CAAE,MAAO,CAAU,CAAE,CAAG,MAAM,EAClD,GAAG,CAAC,qBAAsB,CAAE,WAAY,IAAK,GAC7C,MAAM,GAEL,GACF,QAAQ,CADM,GACF,CAAC,oCAAqC,GAGpD,IAAM,EAAwB,GAAa,CACzC,cAAe,GAAW,QAAU,EACpC,cAAe,EACf,0BAA2B,EAC3B,kBAAmB,EACnB,mBAAoB,EACpB,mBAAoB,EACpB,oBAAqB,CACvB,EAIA,OAFA,QAAQ,GAAG,CAAC,qBAAsB,GAE3B,CACL,UAAY,GAAa,EAAE,OAC3B,EACA,OAAQ,CACN,QAAS,EAAM,aAAa,CAC5B,SAAU,EAAM,kBAAkB,CAClC,SAAU,EAAM,kBAClB,AADoC,EAEpC,QAAU,GAAa,EAAU,MAAM,CAAG,IAAM,CAClD,CACF,CAAE,MAAO,EAAO,CAEd,OADA,QAAQ,KAAK,CAAC,0CAA2C,GAClD,GACT,CACF,CAEA,SAAS,IACP,MAAO,CACL,UAAW,EAAE,CACb,MAAO,CACL,cAAe,EACf,cAAe,EACf,0BAA2B,EAC3B,kBAAmB,EACnB,mBAAoB,EACpB,mBAAoB,EACpB,oBAAqB,CACvB,EACA,OAAQ,CAAE,QAAS,EAAG,SAAU,EAAG,SAAU,CAAE,EAC/C,SAAS,CACX,CACF,CAEe,eAAe,IAE5B,GAAM,WAAE,CAAS,OAAE,CAAK,QAAE,CAAM,SAAE,CAAO,CAAE,CAAG,MAAM,IAEpD,MACE,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,0BAEX,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,0CACb,CAAA,EAAA,EAAA,GAAA,EAAC,KAAA,CAAG,UAAU,8CAAqC,mBACnD,CAAA,EAAA,EAAA,GAAA,EAAC,IAAA,CAAE,UAAU,8CAAqC,+DAMpD,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,mBAAmB,CAAA,CAClB,iBAAkB,EAClB,aAAc,EACd,cAAe,MAIzB,kCA9IuB","ignoreList":[0]}