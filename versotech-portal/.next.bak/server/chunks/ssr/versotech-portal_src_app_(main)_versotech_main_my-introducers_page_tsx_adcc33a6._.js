module.exports=[546037,a=>{"use strict";var b=a.i(352584),c=a.i(611038),d=a.i(284169),e=a.i(15788),f=a.i(421908),g=a.i(663475),h=a.i(951870),i=a.i(771088),j=a.i(799373),k=a.i(278541),l=a.i(399580),m=a.i(487068),n=a.i(3321),o=a.i(877918),p=a.i(618287),q=a.i(439467),r=a.i(13289),s=a.i(438436),t=a.i(816854),u=a.i(752907),v=a.i(42329),w=a.i(405708),x=a.i(600900),y=a.i(13542),z=a.i(966494),A=a.i(497412),B=a.i(888987),C=a.i(201986),D=a.i(58834),E=a.i(29427),F=a.i(140561),G=a.i(181608),H=a.i(877028),I=a.i(478870),J=a.i(441278),K=a.i(625473),L=a.i(264890),M=a.i(527742),N=a.i(470305),O=a.i(249464),P=a.i(191675),Q=a.i(290913);let R=[{value:"invested_amount",label:"Invested Amount"},{value:"spread",label:"Spread"},{value:"management_fee",label:"Management Fee"},{value:"performance_fee",label:"Performance Fee"}];function S({open:a,onOpenChange:d,introducerId:e,introducerName:i,deals:j,feePlans:k,onSuccess:l}){let[m,o]=(0,c.useState)(!1),[p,q]=(0,c.useState)(null),[r,s]=(0,c.useState)(""),[t,u]=(0,c.useState)(""),[v,w]=(0,c.useState)("invested_amount"),[x,y]=(0,c.useState)(""),[z,A]=(0,c.useState)(""),[B,D]=(0,c.useState)(""),[E,F]=(0,c.useState)("USD"),[G,H]=(0,c.useState)(""),[I,J]=(0,c.useState)("");(0,c.useEffect)(()=>{a&&(s(""),u(""),w("invested_amount"),y(""),A(""),D(""),F("USD"),H(""),J(""),q(null))},[a]),(0,c.useEffect)(()=>{if(x&&z){let a=parseFloat(x)/1e4,b=parseFloat(z);isNaN(a)||isNaN(b)||D((b*a).toFixed(2))}},[x,z]),(0,c.useEffect)(()=>{if(r){let a=j.find(a=>a.id===r);a?.currency&&F(a.currency)}},[r,j]),(0,c.useEffect)(()=>{if(t){let a=k.find(a=>a.id===t);if(a?.components&&a.components.length>0){let b=a.components.find(a=>a.rate_bps);b?.rate_bps&&y(b.rate_bps.toString())}}},[t,k]);let K=async()=>{if(!x||0>=parseFloat(x))return void q("Rate is required and must be greater than 0");if(!B||0>=parseFloat(B))return void q("Commission amount is required and must be greater than 0");o(!0),q(null);try{let a={introducer_id:e,deal_id:r||void 0,fee_plan_id:t||void 0,basis_type:v,rate_bps:parseInt(x,10),base_amount:z?parseFloat(z):void 0,accrual_amount:parseFloat(B),currency:E,payment_due_date:G||void 0,notes:I||void 0},b=await fetch("/api/arrangers/me/introducer-commissions",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!b.ok){let a=await b.json();throw Error(a.error||"Failed to record commission")}l(),d(!1)}catch(a){console.error("[RecordCommissionDialog] Error:",a),q(a instanceof Error?a.message:"Failed to record commission")}finally{o(!1)}},L=x?(parseFloat(x)/100).toFixed(2):"0.00";return(0,b.jsx)(N.Dialog,{open:a,onOpenChange:d,children:(0,b.jsxs)(N.DialogContent,{className:"max-w-lg",children:[(0,b.jsxs)(N.DialogHeader,{children:[(0,b.jsx)(N.DialogTitle,{children:"Record Commission"}),(0,b.jsxs)(N.DialogDescription,{children:["Record a commission owed to ",i]})]}),(0,b.jsxs)("div",{className:"space-y-4 py-4",children:[p&&(0,b.jsx)("div",{className:"bg-destructive/10 border border-destructive/30 text-destructive text-sm p-3 rounded",children:p}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(O.Label,{children:"Deal (Optional)"}),(0,b.jsxs)(h.Select,{value:r,onValueChange:s,children:[(0,b.jsx)(h.SelectTrigger,{children:(0,b.jsx)(h.SelectValue,{placeholder:"Select deal..."})}),(0,b.jsxs)(h.SelectContent,{children:[(0,b.jsx)(h.SelectItem,{value:"",children:"No specific deal"}),j.map(a=>(0,b.jsxs)(h.SelectItem,{value:a.id,children:[a.name," ",a.company_name&&`(${a.company_name})`]},a.id))]})]})]}),k.length>0&&(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(O.Label,{children:"Fee Plan (Optional)"}),(0,b.jsxs)(h.Select,{value:t,onValueChange:u,children:[(0,b.jsx)(h.SelectTrigger,{children:(0,b.jsx)(h.SelectValue,{placeholder:"Select fee plan..."})}),(0,b.jsxs)(h.SelectContent,{children:[(0,b.jsx)(h.SelectItem,{value:"",children:"No fee plan"}),k.map(a=>(0,b.jsx)(h.SelectItem,{value:a.id,children:a.name},a.id))]})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(O.Label,{children:"Commission Basis"}),(0,b.jsxs)(h.Select,{value:v,onValueChange:w,children:[(0,b.jsx)(h.SelectTrigger,{children:(0,b.jsx)(h.SelectValue,{})}),(0,b.jsx)(h.SelectContent,{children:R.map(a=>(0,b.jsx)(h.SelectItem,{value:a.value,children:a.label},a.value))})]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(O.Label,{children:"Rate (basis points) *"}),(0,b.jsx)(g.Input,{type:"number",value:x,onChange:a=>y(a.target.value),placeholder:"e.g., 100 = 1%"}),x&&(0,b.jsxs)("p",{className:"text-xs text-muted-foreground",children:["= ",L,"%"]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)(O.Label,{children:["Base Amount (",E,")"]}),(0,b.jsx)(g.Input,{type:"number",value:z,onChange:a=>A(a.target.value),placeholder:"e.g., 100000"})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)(O.Label,{className:"flex items-center gap-2",children:["Commission Amount (",E,") *",x&&z&&(0,b.jsxs)("span",{className:"text-xs text-muted-foreground flex items-center gap-1",children:[(0,b.jsx)(Q.Calculator,{className:"h-3 w-3"}),"Auto-calculated"]})]}),(0,b.jsx)(g.Input,{type:"number",value:B,onChange:a=>D(a.target.value),placeholder:"Commission amount"}),B&&(0,b.jsx)("p",{className:"text-sm font-medium text-primary",children:(0,C.formatCurrency)(parseFloat(B),E)})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(O.Label,{children:"Payment Due Date (Optional)"}),(0,b.jsx)(g.Input,{type:"date",value:G,onChange:a=>H(a.target.value)})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(O.Label,{children:"Notes (Optional)"}),(0,b.jsx)(P.Textarea,{value:I,onChange:a=>J(a.target.value),placeholder:"Any additional notes...",rows:2})]})]}),(0,b.jsxs)(N.DialogFooter,{children:[(0,b.jsx)(f.Button,{variant:"outline",onClick:()=>d(!1),disabled:m,children:"Cancel"}),(0,b.jsx)(f.Button,{onClick:K,disabled:m,children:m?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(n.Loader2,{className:"h-4 w-4 mr-2 animate-spin"}),"Recording..."]}):"Record Commission"})]})]})})}function T({open:a,onOpenChange:d,commission:e,onSuccess:g}){let[h,i]=(0,c.useState)(!1),[j,k]=(0,c.useState)(null),l=async()=>{if(e){i(!0),k(null);try{let a=await fetch(`/api/arrangers/me/introducer-commissions/${e.id}/request-invoice`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({})});if(!a.ok){let b=await a.json();throw Error(b.error||"Failed to request invoice")}g(),d(!1)}catch(a){console.error("[RequestInvoiceDialog] Error:",a),k(a instanceof Error?a.message:"Failed to request invoice")}finally{i(!1)}}};if(!e)return null;let m=(0,C.formatCurrency)(e.accrual_amount,e.currency||"USD");return(0,b.jsx)(N.Dialog,{open:a,onOpenChange:d,children:(0,b.jsxs)(N.DialogContent,{className:"max-w-md",children:[(0,b.jsxs)(N.DialogHeader,{children:[(0,b.jsxs)(N.DialogTitle,{className:"flex items-center gap-2",children:[(0,b.jsx)(t.FileText,{className:"h-5 w-5"}),"Request Invoice"]}),(0,b.jsx)(N.DialogDescription,{children:"Send an invoice request notification to the introducer."})]}),(0,b.jsxs)("div",{className:"py-4 space-y-4",children:[j&&(0,b.jsx)("div",{className:"bg-destructive/10 border border-destructive/30 text-destructive text-sm p-3 rounded",children:j}),(0,b.jsxs)("div",{className:"bg-muted/50 p-4 rounded-lg space-y-2",children:[(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Introducer:"}),(0,b.jsx)("span",{className:"font-medium",children:e.introducer?.legal_name||"Unknown"})]}),e.deal&&(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Deal:"}),(0,b.jsx)("span",{className:"font-medium",children:e.deal.name})]}),(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Amount:"}),(0,b.jsx)("span",{className:"font-medium text-primary",children:m})]})]}),(0,b.jsxs)("div",{className:"flex items-start gap-2 text-sm text-muted-foreground",children:[(0,b.jsx)(q.Mail,{className:"h-4 w-4 mt-0.5 flex-shrink-0"}),(0,b.jsx)("p",{children:'The introducer will receive a notification asking them to submit their invoice for this commission. The commission status will be updated to "Invoice Requested".'})]})]}),(0,b.jsxs)(N.DialogFooter,{children:[(0,b.jsx)(f.Button,{variant:"outline",onClick:()=>d(!1),disabled:h,children:"Cancel"}),(0,b.jsx)(f.Button,{onClick:l,disabled:h,children:h?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(n.Loader2,{className:"h-4 w-4 mr-2 animate-spin"}),"Sending..."]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(q.Mail,{className:"h-4 w-4 mr-2"}),"Request Invoice"]})})]})]})})}function U({open:a,onOpenChange:d,commission:e,lawyers:g=[],onSuccess:i}){let[j,k]=(0,c.useState)(!1),[l,m]=(0,c.useState)(null),[o,p]=(0,c.useState)(""),[q,r]=(0,c.useState)("");(0,c.useEffect)(()=>{a&&(p(""),r(""),m(null))},[a]);let s=async()=>{if(e){k(!0),m(null);try{let a={};o&&(a.lawyer_id=o),q&&(a.notes=q);let b=await fetch(`/api/arrangers/me/introducer-commissions/${e.id}/request-payment`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!b.ok){let a=await b.json();throw Error(a.error||"Failed to request payment")}i(),d(!1)}catch(a){console.error("[RequestPaymentDialog] Error:",a),m(a instanceof Error?a.message:"Failed to request payment")}finally{k(!1)}}};if(!e)return null;let t=(0,C.formatCurrency)(e.accrual_amount,e.currency||"USD");return(0,b.jsx)(N.Dialog,{open:a,onOpenChange:d,children:(0,b.jsxs)(N.DialogContent,{className:"max-w-md",children:[(0,b.jsxs)(N.DialogHeader,{children:[(0,b.jsxs)(N.DialogTitle,{className:"flex items-center gap-2",children:[(0,b.jsx)(y.CreditCard,{className:"h-5 w-5"}),"Request Payment"]}),(0,b.jsx)(N.DialogDescription,{children:"Request payment approval from the legal team or CEO."})]}),(0,b.jsxs)("div",{className:"py-4 space-y-4",children:[l&&(0,b.jsx)("div",{className:"bg-destructive/10 border border-destructive/30 text-destructive text-sm p-3 rounded",children:l}),(0,b.jsxs)("div",{className:"bg-muted/50 p-4 rounded-lg space-y-2",children:[(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Introducer:"}),(0,b.jsx)("span",{className:"font-medium",children:e.introducer?.legal_name||"Unknown"})]}),e.deal&&(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Deal:"}),(0,b.jsx)("span",{className:"font-medium",children:e.deal.name})]}),(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Amount:"}),(0,b.jsx)("span",{className:"font-medium text-primary",children:t})]})]}),g.length>0&&(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(O.Label,{children:"Priority Lawyer (Optional)"}),(0,b.jsxs)(h.Select,{value:o,onValueChange:p,children:[(0,b.jsx)(h.SelectTrigger,{children:(0,b.jsx)(h.SelectValue,{placeholder:"Select lawyer..."})}),(0,b.jsxs)(h.SelectContent,{children:[(0,b.jsx)(h.SelectItem,{value:"",children:"Send to all assigned"}),g.map(a=>(0,b.jsx)(h.SelectItem,{value:a.id,children:a.legal_name},a.id))]})]}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"Optionally select a specific lawyer to prioritize for this payment request."})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(O.Label,{children:"Notes (Optional)"}),(0,b.jsx)(P.Textarea,{value:q,onChange:a=>r(a.target.value),placeholder:"Any payment instructions or notes...",rows:2})]}),(0,b.jsxs)("div",{className:"flex items-start gap-2 text-sm text-muted-foreground",children:[(0,b.jsx)(I.Users,{className:"h-4 w-4 mt-0.5 flex-shrink-0"}),(0,b.jsx)("p",{children:"This will notify the assigned lawyers and CEO/admin staff to process the payment to the introducer. Make sure the invoice has been received before requesting payment."})]})]}),(0,b.jsxs)(N.DialogFooter,{children:[(0,b.jsx)(f.Button,{variant:"outline",onClick:()=>d(!1),disabled:j,children:"Cancel"}),(0,b.jsx)(f.Button,{onClick:s,disabled:j,children:j?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(n.Loader2,{className:"h-4 w-4 mr-2 animate-spin"}),"Sending..."]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(y.CreditCard,{className:"h-4 w-4 mr-2"}),"Request Payment"]})})]})]})})}var V=a.i(761854);let W={active:"bg-green-100 text-green-800 border-green-200",pending:"bg-yellow-100 text-yellow-800 border-yellow-200",inactive:"bg-gray-100 text-gray-800 border-gray-200",suspended:"bg-red-100 text-red-800 border-red-200"},X={accrued:{icon:v.Clock,color:"text-blue-600"},invoice_requested:{icon:t.FileText,color:"text-yellow-600"},invoice_submitted:{icon:t.FileText,color:"text-indigo-600"},invoiced:{icon:t.FileText,color:"text-orange-600"},paid:{icon:J.CheckCircle,color:"text-green-600"},cancelled:{icon:K.XCircle,color:"text-red-600"},rejected:{icon:K.XCircle,color:"text-red-600"}};function Y({introducerId:a,open:g,onOpenChange:h}){let[i,j]=(0,c.useState)(null),[l,m]=(0,c.useState)(!1),[r,s]=(0,c.useState)(null),[u,x]=(0,c.useState)([]),[D,E]=(0,c.useState)(!1),[J,K]=(0,c.useState)(!1),[N,O]=(0,c.useState)(!1),[P,Q]=(0,c.useState)(!1),[R,Y]=(0,c.useState)(null),[Z,$]=(0,c.useState)(!1),[_,aa]=(0,c.useState)(null),ab=async()=>{if(a){m(!0),s(null);try{let b=await fetch(`/api/arrangers/me/introducers/${a}`);if(!b.ok){let a=await b.json();throw Error(a.error||"Failed to load introducer details")}let c=await b.json();j(c.data)}catch(a){console.error("[IntroducerDetailDrawer] Error:",a),s(a instanceof Error?a.message:"Failed to load introducer details")}finally{m(!1)}}},ac=async()=>{if(a){E(!0);try{let b=await fetch(`/api/arrangers/me/introducer-commissions?introducer_id=${a}&limit=20`);if(b.ok){let a=await b.json();x(a.data||[])}}catch(a){console.error("[IntroducerDetailDrawer] Error fetching commissions:",a)}finally{E(!1)}}};(0,c.useEffect)(()=>{if(!g||!a){j(null),s(null),x([]);return}ab(),ac()},[g,a]);let ad=()=>{ab(),ac()};return(0,b.jsx)(F.Sheet,{open:g,onOpenChange:h,children:(0,b.jsxs)(F.SheetContent,{className:"w-full sm:max-w-xl overflow-y-auto",children:[l&&(0,b.jsxs)("div",{className:"flex items-center justify-center py-16",children:[(0,b.jsx)(n.Loader2,{className:"h-8 w-8 animate-spin text-muted-foreground"}),(0,b.jsx)("span",{className:"ml-3 text-muted-foreground",children:"Loading introducer details..."})]}),r&&(0,b.jsxs)("div",{className:"flex flex-col items-center justify-center py-16 text-center",children:[(0,b.jsx)(o.AlertCircle,{className:"h-12 w-12 text-destructive mb-4"}),(0,b.jsx)("p",{className:"text-muted-foreground",children:r}),(0,b.jsx)(f.Button,{variant:"outline",className:"mt-4",onClick:()=>h(!1),children:"Close"})]}),i&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)(F.SheetHeader,{className:"pb-4",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[i.introducer.logo_url?(0,b.jsx)("img",{src:i.introducer.logo_url,alt:i.introducer.legal_name,className:"h-12 w-12 rounded-lg object-cover"}):(0,b.jsx)("div",{className:"h-12 w-12 rounded-lg bg-muted flex items-center justify-center",children:(0,b.jsx)(k.Building2,{className:"h-6 w-6 text-muted-foreground"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)(F.SheetTitle,{children:i.introducer.legal_name}),(0,b.jsx)(F.SheetDescription,{children:i.introducer.contact_name&&(0,b.jsx)("span",{children:i.introducer.contact_name})})]})]}),(0,b.jsxs)("div",{className:"flex gap-2 mt-3",children:[(0,b.jsx)(e.Badge,{variant:"outline",className:(0,B.cn)("capitalize",W[i.introducer.status]||W.active),children:i.introducer.status}),i.introducer.default_commission_bps&&(0,b.jsxs)(e.Badge,{variant:"secondary",className:"text-xs",children:[(i.introducer.default_commission_bps/100).toFixed(2),"% default rate"]})]})]}),(0,b.jsx)(H.Separator,{className:"my-4"}),(0,b.jsxs)("div",{className:"grid grid-cols-3 gap-3 mb-6",children:[(0,b.jsxs)(d.Card,{className:"p-3",children:[(0,b.jsx)("div",{className:"text-2xl font-bold text-primary",children:i.stats.total_deals}),(0,b.jsx)("div",{className:"text-xs text-muted-foreground",children:"Deals"})]}),(0,b.jsxs)(d.Card,{className:"p-3",children:[(0,b.jsx)("div",{className:"text-2xl font-bold text-blue-600",children:i.stats.total_referrals}),(0,b.jsx)("div",{className:"text-xs text-muted-foreground",children:"Referrals"})]}),(0,b.jsxs)(d.Card,{className:"p-3",children:[(0,b.jsx)("div",{className:"text-2xl font-bold text-purple-600",children:i.stats.active_fee_plans}),(0,b.jsx)("div",{className:"text-xs text-muted-foreground",children:"Fee Plans"})]})]}),(0,b.jsxs)(G.Tabs,{defaultValue:"overview",className:"w-full",children:[(0,b.jsxs)(G.TabsList,{className:"grid w-full grid-cols-4",children:[(0,b.jsx)(G.TabsTrigger,{value:"overview",children:"Overview"}),(0,b.jsx)(G.TabsTrigger,{value:"fees",children:"Fee Plans"}),(0,b.jsx)(G.TabsTrigger,{value:"commissions",children:"Commissions"}),(0,b.jsx)(G.TabsTrigger,{value:"referrals",children:"Referrals"})]}),(0,b.jsxs)(G.TabsContent,{value:"overview",className:"mt-4 space-y-4",children:[(0,b.jsxs)(d.Card,{children:[(0,b.jsx)(d.CardHeader,{className:"pb-2",children:(0,b.jsx)(d.CardTitle,{className:"text-sm",children:"Contact Information"})}),(0,b.jsxs)(d.CardContent,{className:"space-y-2 text-sm",children:[i.introducer.contact_name&&(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(I.Users,{className:"h-4 w-4 text-muted-foreground"}),(0,b.jsx)("span",{children:i.introducer.contact_name})]}),i.introducer.email&&(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(q.Mail,{className:"h-4 w-4 text-muted-foreground"}),(0,b.jsx)("a",{href:`mailto:${i.introducer.email}`,className:"text-primary hover:underline",children:i.introducer.email})]})]})]}),(0,b.jsxs)(d.Card,{children:[(0,b.jsx)(d.CardHeader,{className:"pb-2",children:(0,b.jsx)(d.CardTitle,{className:"text-sm",children:"Commission Terms"})}),(0,b.jsxs)(d.CardContent,{className:"space-y-2 text-sm",children:[i.introducer.default_commission_bps?(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Default Rate:"}),(0,b.jsxs)("span",{className:"font-medium",children:[(i.introducer.default_commission_bps/100).toFixed(2),"%"]})]}):(0,b.jsx)("p",{className:"text-muted-foreground",children:"No default rate set"}),i.introducer.commission_cap_amount&&(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Commission Cap:"}),(0,b.jsx)("span",{className:"font-medium",children:(0,C.formatCurrency)(i.introducer.commission_cap_amount,"USD")})]}),i.introducer.payment_terms&&(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Payment Terms:"}),(0,b.jsx)("span",{className:"font-medium",children:i.introducer.payment_terms})]}),i.introducer.agreement_expiry_date&&(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Agreement Expiry:"}),(0,b.jsx)("span",{className:"font-medium",children:(0,C.formatDate)(i.introducer.agreement_expiry_date)})]})]})]}),i.deals.length>0&&(0,b.jsxs)(d.Card,{children:[(0,b.jsx)(d.CardHeader,{className:"pb-2",children:(0,b.jsx)(d.CardTitle,{className:"text-sm",children:"Deals Involved"})}),(0,b.jsx)(d.CardContent,{children:(0,b.jsx)("div",{className:"space-y-2",children:i.deals.map(a=>(0,b.jsxs)("div",{className:"flex items-center justify-between p-2 rounded-md bg-muted/50",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"font-medium text-sm",children:a.name}),a.company_name&&(0,b.jsx)("div",{className:"text-xs text-muted-foreground",children:a.company_name})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(e.Badge,{variant:"outline",className:"text-xs capitalize",children:a.status}),(0,b.jsx)(A.default,{href:`/versotech_main/opportunities/${a.id}`,children:(0,b.jsx)(f.Button,{variant:"ghost",size:"sm",children:(0,b.jsx)(p.ExternalLink,{className:"h-3.5 w-3.5"})})})]})]},a.id))})})]})]}),(0,b.jsx)(G.TabsContent,{value:"fees",className:"mt-4 space-y-4",children:0===i.fee_plans.length?(0,b.jsx)(d.Card,{children:(0,b.jsxs)(d.CardContent,{className:"py-8 text-center",children:[(0,b.jsx)(t.FileText,{className:"h-10 w-10 text-muted-foreground mx-auto mb-3"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"No fee plans assigned to this introducer"}),(0,b.jsx)(A.default,{href:"/versotech_main/fee-plans",children:(0,b.jsx)(f.Button,{variant:"outline",size:"sm",className:"mt-3",children:"Create Fee Plan"})})]})}):i.fee_plans.map(a=>(0,b.jsxs)(d.Card,{children:[(0,b.jsxs)(d.CardHeader,{className:"pb-2",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)(d.CardTitle,{className:"text-sm",children:a.name}),(0,b.jsx)(e.Badge,{variant:a.is_active?"default":"secondary",children:a.is_active?"Active":"Inactive"})]}),a.description&&(0,b.jsx)(d.CardDescription,{className:"text-xs",children:a.description})]}),(0,b.jsxs)(d.CardContent,{children:[a.components&&a.components.length>0?(0,b.jsx)("div",{className:"flex flex-wrap gap-2",children:a.components.map((a,c)=>(0,b.jsxs)(e.Badge,{variant:"outline",className:"text-xs",children:[a.kind,": ",a.rate_bps?`${(a.rate_bps/100).toFixed(2)}%`:a.flat_amount?`$${a.flat_amount}`:"N/A"]},c))}):(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"No fee components defined"}),a.effective_from&&(0,b.jsxs)("p",{className:"text-xs text-muted-foreground mt-2",children:["Effective from ",(0,C.formatDate)(a.effective_from),a.effective_until&&` to ${(0,C.formatDate)(a.effective_until)}`]})]})]},a.id))}),(0,b.jsxs)(G.TabsContent,{value:"commissions",className:"mt-4 space-y-4",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("h3",{className:"text-sm font-medium",children:"Commission Summary"}),(0,b.jsxs)(f.Button,{size:"sm",onClick:()=>K(!0),children:[(0,b.jsx)(w.Plus,{className:"h-4 w-4 mr-1"}),"Record Commission"]})]}),(0,b.jsx)(M.CommissionSummary,{summary:i.commission_summary}),D?(0,b.jsx)("div",{className:"flex items-center justify-center py-4",children:(0,b.jsx)(n.Loader2,{className:"h-4 w-4 animate-spin"})}):u.length>0?(0,b.jsxs)(d.Card,{children:[(0,b.jsx)(d.CardHeader,{className:"pb-2",children:(0,b.jsx)(d.CardTitle,{className:"text-sm",children:"Recent Commissions"})}),(0,b.jsx)(d.CardContent,{className:"space-y-2",children:u.slice(0,10).map(a=>{let c=X[a.status]?.icon||v.Clock,d=X[a.status]?.color||"text-gray-600";return(0,b.jsxs)("div",{className:"flex items-center justify-between p-2 rounded-md bg-muted/50",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(c,{className:(0,B.cn)("h-4 w-4",d)}),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"font-medium text-sm",children:(0,C.formatCurrency)(a.accrual_amount,a.currency)}),(0,b.jsxs)("div",{className:"text-xs text-muted-foreground",children:[a.deal?.name||"No deal"," • ",(0,C.formatDate)(a.created_at)]})]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(e.Badge,{variant:"outline",className:"text-xs capitalize",children:a.status.replace("_"," ")}),"accrued"===a.status&&(0,b.jsxs)(f.Button,{size:"sm",variant:"outline",onClick:()=>{Y(a),O(!0)},children:[(0,b.jsx)(t.FileText,{className:"h-3.5 w-3.5 mr-1"}),"Request Invoice"]}),"invoiced"===a.status&&(0,b.jsxs)(f.Button,{size:"sm",variant:"outline",onClick:()=>{Y(a),Q(!0)},children:[(0,b.jsx)(y.CreditCard,{className:"h-3.5 w-3.5 mr-1"}),"Request Payment"]}),("invoiced"===a.status||"paid"===a.status)&&a.invoice_id&&(0,b.jsxs)(f.Button,{size:"sm",variant:"ghost",onClick:()=>{a.invoice_id&&(aa({id:a.invoice_id,name:`Invoice - ${a.deal?.name||"Commission"}`,mimeType:"application/pdf"}),$(!0))},className:"text-blue-600",children:[(0,b.jsx)(L.Eye,{className:"h-3.5 w-3.5 mr-1"}),"View Invoice"]})]})]},a.id)})})]}):null,(0,b.jsx)("div",{className:"flex justify-end",children:(0,b.jsx)(A.default,{href:"/versotech_main/introducer-reconciliation",children:(0,b.jsxs)(f.Button,{variant:"outline",size:"sm",children:[(0,b.jsx)(z.TrendingUp,{className:"h-4 w-4 mr-2"}),"View Reconciliation"]})})})]}),(0,b.jsx)(G.TabsContent,{value:"referrals",className:"mt-4 space-y-4",children:0===i.recent_referrals.length?(0,b.jsx)(d.Card,{children:(0,b.jsxs)(d.CardContent,{className:"py-8 text-center",children:[(0,b.jsx)(I.Users,{className:"h-10 w-10 text-muted-foreground mx-auto mb-3"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"No referrals yet"})]})}):(0,b.jsxs)(d.Card,{children:[(0,b.jsxs)(d.CardHeader,{className:"pb-2",children:[(0,b.jsx)(d.CardTitle,{className:"text-sm",children:"Recent Referrals"}),(0,b.jsx)(d.CardDescription,{className:"text-xs",children:"Investors introduced to your deals"})]}),(0,b.jsx)(d.CardContent,{children:(0,b.jsx)("div",{className:"space-y-3",children:i.recent_referrals.map(a=>(0,b.jsxs)("div",{className:"flex items-center justify-between p-2 rounded-md bg-muted/50",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"font-medium text-sm",children:a.investor?.name||"Unknown Investor"}),(0,b.jsxs)("div",{className:"text-xs text-muted-foreground",children:[a.deal?.name||"Unknown Deal",a.deal?.company_name&&` • ${a.deal.company_name}`]})]}),(0,b.jsx)("div",{className:"text-xs text-muted-foreground",children:(0,C.formatDate)(a.created_at)})]},a.id))})})]})})]}),(0,b.jsx)(S,{open:J,onOpenChange:K,introducerId:i.introducer.id,introducerName:i.introducer.legal_name,deals:i.deals,feePlans:i.fee_plans,onSuccess:ad}),(0,b.jsx)(T,{open:N,onOpenChange:O,commission:R,onSuccess:ad}),(0,b.jsx)(U,{open:P,onOpenChange:Q,commission:R,onSuccess:ad}),_&&(0,b.jsx)(V.DocumentViewer,{documentId:_.id,documentName:_.name,mimeType:_.mimeType,open:Z,onClose:()=>{$(!1),aa(null)}})]})]})})}let Z={active:"bg-green-100 text-green-800 border-green-200",pending:"bg-yellow-100 text-yellow-800 border-yellow-200",inactive:"bg-gray-100 text-gray-800 border-gray-200",suspended:"bg-red-100 text-red-800 border-red-200"},$=[{label:"All Status",value:"all"},{label:"Active",value:"active"},{label:"Pending",value:"pending"},{label:"Inactive",value:"inactive"}];function _(){let[a,F]=(0,c.useState)(null),[G,H]=(0,c.useState)([]),[I,J]=(0,c.useState)([]),[K,L]=(0,c.useState)([]),[N,O]=(0,c.useState)({totalIntroducers:0,activeIntroducers:0,totalReferrals:0,totalFeesOwed:0,totalFeesPaid:0,totalCommissions:0}),[P,Q]=(0,c.useState)(!0),[R,S]=(0,c.useState)(null),[T,U]=(0,c.useState)(""),[V,W]=(0,c.useState)("all"),[X,_]=(0,c.useState)("all"),[aa,ab]=(0,c.useState)(!1),[ac,ad]=(0,c.useState)(null),[ae,af]=(0,c.useState)(!1),[ag,ah]=(0,c.useState)(null),ai=async()=>{try{Q(!0);let a=(0,D.createClient)(),{data:{user:b}}=await a.auth.getUser();if(!b)return void S("Not authenticated");let{data:c,error:d}=await a.from("arranger_users").select("arranger_id").eq("user_id",b.id).single();if(d||!c)return void await aj(a);let{data:e,error:f}=await a.from("arranger_entities").select("id, legal_name, status").eq("id",c.arranger_id).single();if(f)throw f;F(e);let{data:g}=await a.from("introducer_agreements").select(`
          id,
          agreement_type,
          status,
          created_at,
          arranger_signature_request_id,
          introducer:introducer_id (id, legal_name)
        `).eq("arranger_id",c.arranger_id).in("status",["approved","pending_arranger_signature"]).order("created_at",{ascending:!1}),h=[];for(let b of g||[]){let c=Array.isArray(b.introducer)?b.introducer[0]:b.introducer,d=null;if(b.arranger_signature_request_id){let{data:c}=await a.from("signature_requests").select("signing_token, status, token_expires_at").eq("id",b.arranger_signature_request_id).eq("status","pending").single();c&&new Date(c.token_expires_at)>new Date&&(d=`/versotech_main/versosign/sign/${c.signing_token}`)}h.push({id:b.id,introducer_name:c?.legal_name||"Unknown Introducer",introducer_id:c?.id||"",agreement_type:b.agreement_type,created_at:b.created_at,status:b.status,signing_url:d})}L(h);let{data:i,error:j}=await a.from("deals").select("id, name").eq("arranger_entity_id",c.arranger_id);if(j)throw j;if(J(i||[]),!i||0===i.length){H([]),O({totalIntroducers:0,activeIntroducers:0,totalReferrals:0,totalFeesOwed:0,totalFeesPaid:0,totalCommissions:0});return}let k=i.map(a=>a.id),{data:l,error:m}=await a.from("deal_memberships").select("referred_by_entity_id, investor_id, deal_id").in("deal_id",k).eq("referred_by_entity_type","introducer").not("referred_by_entity_id","is",null);if(m)throw m;let n=[...new Set((l||[]).map(a=>a.referred_by_entity_id))];if(0===n.length){H([]),O({totalIntroducers:0,activeIntroducers:0,totalReferrals:0,totalFeesOwed:0,totalFeesPaid:0,totalCommissions:0});return}let{data:o,error:p}=await a.from("introducers").select("*").in("id",n).order("legal_name");if(p)throw p;let{data:q}=await a.from("fee_plans").select("id, name, is_active, introducer_id").eq("created_by_arranger_id",c.arranger_id).in("introducer_id",n),r=new Map;(q||[]).forEach(a=>{let b=r.get(a.introducer_id)||[];b.push({id:a.id,name:a.name,is_active:a.is_active}),r.set(a.introducer_id,b)});let{data:s}=await a.from("introducer_commissions").select("introducer_id, status, accrual_amount, currency").eq("arranger_id",c.arranger_id).in("introducer_id",n),t=new Map;n.forEach(a=>{t.set(a,{accrued:0,invoice_requested:0,invoice_submitted:0,invoiced:0,paid:0,cancelled:0,total_owed:0,currency:"USD"})}),(s||[]).forEach(a=>{let b=t.get(a.introducer_id);if(b){let c=Number(a.accrual_amount)||0;"accrued"===a.status?b.accrued+=c:"invoice_requested"===a.status?b.invoice_requested+=c:"invoice_submitted"===a.status?b.invoice_submitted=(b.invoice_submitted||0)+c:"invoiced"===a.status?b.invoiced+=c:"paid"===a.status?b.paid+=c:"cancelled"===a.status&&(b.cancelled+=c),a.currency&&(b.currency=a.currency)}}),t.forEach(a=>{a.total_owed=a.accrued+a.invoice_requested+(a.invoice_submitted||0)+a.invoiced});let u=[...new Set((l||[]).filter(a=>a.investor_id).map(a=>a.investor_id))],{data:v}=await a.from("subscriptions").select("investor_id, commitment").in("investor_id",u),w=new Map;(v||[]).forEach(a=>{let b=w.get(a.investor_id)||0;w.set(a.investor_id,b+(Number(a.commitment)||0))});let x=(o||[]).map(a=>{let b=(l||[]).filter(b=>b.referred_by_entity_id===a.id),c=[...new Set(b.map(a=>a.deal_id).filter(Boolean))],d=b.reduce((a,b)=>b.investor_id?a+(w.get(b.investor_id)||0):a,0),e=t.get(a.id)||{accrued:0,invoice_requested:0,invoice_submitted:0,invoiced:0,paid:0,cancelled:0,total_owed:0,currency:"USD"};return{id:a.id,legal_name:a.legal_name||"Unknown Introducer",contact_name:a.contact_name,email:a.email,status:a.status||"active",default_commission_bps:a.default_commission_bps,commission_cap_amount:a.commission_cap_amount?Number(a.commission_cap_amount):null,agreement_expiry_date:a.agreement_expiry_date,logo_url:a.logo_url,deals_count:c.length,referrals_count:b.length,total_referral_value:d,fee_plans:r.get(a.id)||[],commission_summary:e}});H(x);let y=0,z=0;x.forEach(a=>{y+=a.commission_summary.total_owed,z+=a.commission_summary.paid}),O({totalIntroducers:x.length,activeIntroducers:x.filter(a=>"active"===a.status).length,totalReferrals:x.reduce((a,b)=>a+b.referrals_count,0),totalFeesOwed:y,totalFeesPaid:z,totalCommissions:y+z}),S(null)}catch(a){console.error("[MyIntroducersPage] Error:",a),S(a instanceof Error?a.message:"Failed to load introducers")}finally{Q(!1)}};async function aj(a){let{data:b,error:c}=await a.from("introducers").select("*").order("legal_name").limit(100);if(c)throw c;let d=(b||[]).map(a=>({id:a.id,legal_name:a.legal_name||"Unknown Introducer",contact_name:a.contact_name,email:a.email,status:a.status||"active",default_commission_bps:a.default_commission_bps,commission_cap_amount:a.commission_cap_amount?Number(a.commission_cap_amount):null,agreement_expiry_date:a.agreement_expiry_date,logo_url:a.logo_url,deals_count:0,referrals_count:0,total_referral_value:0,fee_plans:[],commission_summary:{accrued:0,invoice_requested:0,invoiced:0,paid:0,cancelled:0,total_owed:0,currency:"USD"}}));H(d),O({totalIntroducers:d.length,activeIntroducers:d.filter(a=>"active"===a.status).length,totalReferrals:0,totalFeesOwed:0,totalFeesPaid:0,totalCommissions:0})}(0,c.useEffect)(()=>{ai()},[]);let ak=G.filter(a=>{let b="all"===V||a.status===V,c=!T||a.legal_name?.toLowerCase().includes(T.toLowerCase())||a.contact_name?.toLowerCase().includes(T.toLowerCase())||a.email?.toLowerCase().includes(T.toLowerCase());return b&&c&&!0}),al=new Date,am=new Date(al.getTime()+2592e6),an=a=>{ah(a),af(!0)};return P?(0,b.jsxs)("div",{className:"flex items-center justify-center py-16",children:[(0,b.jsx)(n.Loader2,{className:"h-8 w-8 animate-spin text-muted-foreground"}),(0,b.jsx)("span",{className:"ml-3 text-muted-foreground",children:"Loading introducers..."})]}):R?(0,b.jsxs)("div",{className:"text-center py-16",children:[(0,b.jsx)(o.AlertCircle,{className:"h-12 w-12 text-destructive mx-auto mb-4"}),(0,b.jsx)("h3",{className:"text-lg font-medium text-foreground mb-2",children:"Error Loading Introducers"}),(0,b.jsx)("p",{className:"text-muted-foreground",children:R})]}):(0,b.jsxs)("div",{className:"p-6 space-y-6",children:[(0,b.jsx)("div",{className:"flex items-center justify-between",children:(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-2xl font-bold text-foreground",children:"My Introducers"}),(0,b.jsx)("p",{className:"text-muted-foreground mt-1",children:a?`Introducers working with ${a.legal_name}`:"View all registered introducers"})]})}),K.length>0&&(0,b.jsxs)(d.Card,{className:"border-amber-500/30 bg-amber-500/5",children:[(0,b.jsxs)(d.CardHeader,{className:"pb-3",children:[(0,b.jsxs)(d.CardTitle,{className:"text-lg flex items-center gap-2",children:[(0,b.jsx)(v.Clock,{className:"h-5 w-5 text-amber-500"}),"Agreements Awaiting Your Signature (",K.length,")"]}),(0,b.jsx)(d.CardDescription,{children:"Review and sign these introducer agreements to activate them"})]}),(0,b.jsx)(d.CardContent,{children:(0,b.jsx)("div",{className:"space-y-3",children:K.map(a=>(0,b.jsxs)("div",{className:"flex items-center justify-between p-3 rounded-lg border border-amber-500/20 bg-background",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("div",{className:"h-10 w-10 rounded-lg bg-amber-500/10 flex items-center justify-center",children:(0,b.jsx)(t.FileText,{className:"h-5 w-5 text-amber-500"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"font-medium",children:a.introducer_name}),(0,b.jsxs)("div",{className:"text-sm text-muted-foreground capitalize",children:[a.agreement_type.replace(/_/g," ")," • Created ",(0,C.formatDate)(a.created_at)]})]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[a.signing_url?(0,b.jsx)(f.Button,{asChild:!0,size:"sm",className:"bg-amber-500 hover:bg-amber-600",children:(0,b.jsxs)(A.default,{href:a.signing_url,children:[(0,b.jsx)(u.PenTool,{className:"h-4 w-4 mr-1"}),"Sign Now"]})}):(0,b.jsxs)(f.Button,{size:"sm",onClick:async()=>{try{let b=await fetch(`/api/introducer-agreements/${a.id}/sign`,{method:"POST"});if(b.ok){let a=await b.json();a.signing_url&&(window.location.href=a.signing_url)}}catch(a){console.error("Failed to initiate signing:",a)}},className:"bg-amber-500 hover:bg-amber-600",children:[(0,b.jsx)(u.PenTool,{className:"h-4 w-4 mr-1"}),"Initiate Signing"]}),(0,b.jsx)(f.Button,{variant:"outline",size:"sm",asChild:!0,children:(0,b.jsx)(A.default,{href:`/versotech_main/introducer-agreements/${a.id}`,children:"View"})})]})]},a.id))})})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-6 gap-4",children:[(0,b.jsxs)(d.Card,{children:[(0,b.jsx)(d.CardHeader,{className:"pb-2",children:(0,b.jsxs)(d.CardTitle,{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[(0,b.jsx)(j.UserPlus,{className:"h-4 w-4"}),"Total Introducers"]})}),(0,b.jsxs)(d.CardContent,{children:[(0,b.jsx)("div",{className:"text-2xl font-bold",children:N.totalIntroducers}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"In your network"})]})]}),(0,b.jsxs)(d.Card,{children:[(0,b.jsx)(d.CardHeader,{className:"pb-2",children:(0,b.jsxs)(d.CardTitle,{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[(0,b.jsx)(l.CheckCircle2,{className:"h-4 w-4"}),"Active"]})}),(0,b.jsxs)(d.CardContent,{children:[(0,b.jsx)("div",{className:"text-2xl font-bold text-green-600",children:N.activeIntroducers}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"With valid agreements"})]})]}),(0,b.jsxs)(d.Card,{children:[(0,b.jsx)(d.CardHeader,{className:"pb-2",children:(0,b.jsxs)(d.CardTitle,{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[(0,b.jsx)(r.Handshake,{className:"h-4 w-4"}),"Referrals"]})}),(0,b.jsxs)(d.CardContent,{children:[(0,b.jsx)("div",{className:"text-2xl font-bold text-blue-600",children:N.totalReferrals}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Investors introduced"})]})]}),(0,b.jsxs)(d.Card,{children:[(0,b.jsx)(d.CardHeader,{className:"pb-2",children:(0,b.jsxs)(d.CardTitle,{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[(0,b.jsx)(z.TrendingUp,{className:"h-4 w-4"}),"Total Commissions"]})}),(0,b.jsxs)(d.CardContent,{children:[(0,b.jsx)("div",{className:"text-2xl font-bold text-purple-600",children:(0,C.formatCurrency)(N.totalCommissions,"USD")}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"All time"})]})]}),(0,b.jsxs)(d.Card,{children:[(0,b.jsx)(d.CardHeader,{className:"pb-2",children:(0,b.jsxs)(d.CardTitle,{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[(0,b.jsx)(x.Wallet,{className:"h-4 w-4"}),"Fees Owed"]})}),(0,b.jsxs)(d.CardContent,{children:[(0,b.jsx)("div",{className:"text-2xl font-bold text-orange-600",children:(0,C.formatCurrency)(N.totalFeesOwed,"USD")}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Pending payment"})]})]}),(0,b.jsxs)(d.Card,{children:[(0,b.jsx)(d.CardHeader,{className:"pb-2",children:(0,b.jsxs)(d.CardTitle,{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[(0,b.jsx)(y.CreditCard,{className:"h-4 w-4"}),"Fees Paid"]})}),(0,b.jsxs)(d.CardContent,{children:[(0,b.jsx)("div",{className:"text-2xl font-bold text-green-600",children:(0,C.formatCurrency)(N.totalFeesPaid,"USD")}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Completed"})]})]})]}),(0,b.jsx)(d.Card,{children:(0,b.jsx)(d.CardContent,{className:"pt-6",children:(0,b.jsxs)("div",{className:"flex flex-col md:flex-row gap-4",children:[(0,b.jsxs)("div",{className:"flex-1 relative",children:[(0,b.jsx)(m.Search,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),(0,b.jsx)(g.Input,{placeholder:"Search introducers...",value:T,onChange:a=>U(a.target.value),className:"pl-10"})]}),(0,b.jsxs)(h.Select,{value:V,onValueChange:W,children:[(0,b.jsx)(h.SelectTrigger,{className:"w-full md:w-48",children:(0,b.jsx)(h.SelectValue,{placeholder:"Filter by status"})}),(0,b.jsx)(h.SelectContent,{children:$.map(a=>(0,b.jsx)(h.SelectItem,{value:a.value,children:a.label},a.value))})]}),I.length>0&&(0,b.jsxs)(h.Select,{value:X,onValueChange:_,children:[(0,b.jsx)(h.SelectTrigger,{className:"w-full md:w-48",children:(0,b.jsx)(h.SelectValue,{placeholder:"Filter by deal"})}),(0,b.jsxs)(h.SelectContent,{children:[(0,b.jsx)(h.SelectItem,{value:"all",children:"All Deals"}),I.map(a=>(0,b.jsx)(h.SelectItem,{value:a.id,children:a.name},a.id))]})]})]})})}),(0,b.jsxs)(d.Card,{children:[(0,b.jsxs)(d.CardHeader,{children:[(0,b.jsx)(d.CardTitle,{children:"Introducers"}),(0,b.jsxs)(d.CardDescription,{children:[ak.length," introducer",1!==ak.length?"s":""," found"]})]}),(0,b.jsx)(d.CardContent,{children:0===ak.length?(0,b.jsxs)("div",{className:"border border-dashed border-muted rounded-lg py-12 flex flex-col items-center justify-center text-center space-y-2",children:[(0,b.jsx)(j.UserPlus,{className:"h-10 w-10 text-muted-foreground"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:T||"all"!==V?"No introducers match your filters":"No introducers in your network yet"})]}):(0,b.jsx)("div",{className:"rounded-md border",children:(0,b.jsxs)(i.Table,{children:[(0,b.jsx)(i.TableHeader,{children:(0,b.jsxs)(i.TableRow,{children:[(0,b.jsx)(i.TableHead,{children:"Introducer"}),(0,b.jsx)(i.TableHead,{children:"Rate / Fee Plans"}),(0,b.jsx)(i.TableHead,{children:"Referrals"}),(0,b.jsx)(i.TableHead,{children:"Commission Status"}),(0,b.jsx)(i.TableHead,{children:"Agreement"}),(0,b.jsx)(i.TableHead,{children:"Status"}),(0,b.jsx)(i.TableHead,{className:"text-right",children:"Actions"})]})}),(0,b.jsx)(i.TableBody,{children:ak.map(c=>{let d=c.agreement_expiry_date&&new Date(c.agreement_expiry_date)<=am&&new Date(c.agreement_expiry_date)>al,g=c.agreement_expiry_date&&new Date(c.agreement_expiry_date)<=al;return(0,b.jsxs)(i.TableRow,{className:"cursor-pointer hover:bg-muted/50",onClick:()=>an(c.id),children:[(0,b.jsx)(i.TableCell,{children:(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[c.logo_url?(0,b.jsx)("img",{src:c.logo_url,alt:c.legal_name,className:"h-10 w-10 rounded-lg object-cover"}):(0,b.jsx)("div",{className:"h-10 w-10 rounded-lg bg-muted flex items-center justify-center",children:(0,b.jsx)(k.Building2,{className:"h-5 w-5 text-muted-foreground"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"font-medium",children:c.legal_name}),c.email&&(0,b.jsxs)("div",{className:"text-xs text-muted-foreground flex items-center gap-1",children:[(0,b.jsx)(q.Mail,{className:"h-3 w-3"}),c.email]})]})]})}),(0,b.jsx)(i.TableCell,{onClick:a=>a.stopPropagation(),children:(0,b.jsxs)("div",{className:"space-y-1",children:[c.default_commission_bps?(0,b.jsxs)("div",{className:"font-medium flex items-center gap-1",children:[(0,b.jsx)(s.Percent,{className:"h-3 w-3"}),(c.default_commission_bps/100).toFixed(2),"%"]}):(0,b.jsx)("span",{className:"text-muted-foreground text-xs",children:"No default rate"}),c.fee_plans.length>0&&(0,b.jsxs)("div",{className:"flex flex-wrap gap-1",children:[c.fee_plans.slice(0,2).map(a=>(0,b.jsx)(e.Badge,{variant:a.is_active?"default":"secondary",className:"text-xs",children:a.name},a.id)),c.fee_plans.length>2&&(0,b.jsxs)(e.Badge,{variant:"outline",className:"text-xs",children:["+",c.fee_plans.length-2]})]})]})}),(0,b.jsx)(i.TableCell,{children:(0,b.jsxs)("div",{children:[(0,b.jsxs)("div",{className:"font-medium",children:[c.referrals_count," referrals"]}),(0,b.jsxs)("div",{className:"text-xs text-muted-foreground",children:[c.deals_count," deal",1!==c.deals_count?"s":""]})]})}),(0,b.jsx)(i.TableCell,{onClick:a=>a.stopPropagation(),children:(0,b.jsx)(M.CommissionSummary,{summary:c.commission_summary,variant:"inline"})}),(0,b.jsx)(i.TableCell,{children:c.agreement_expiry_date?(0,b.jsxs)("div",{className:(0,B.cn)("text-sm",g&&"text-red-600",d&&"text-yellow-600"),children:[(0,b.jsxs)("div",{className:"flex items-center gap-1",children:[(0,b.jsx)(t.FileText,{className:"h-3 w-3"}),(0,C.formatDate)(c.agreement_expiry_date)]}),g&&(0,b.jsx)(e.Badge,{variant:"destructive",className:"text-xs mt-1",children:"Expired"}),d&&(0,b.jsx)(e.Badge,{variant:"outline",className:"text-xs mt-1 bg-yellow-100",children:"Expiring Soon"})]}):(0,b.jsx)("span",{className:"text-muted-foreground text-xs",children:"No agreement"})}),(0,b.jsx)(i.TableCell,{children:(0,b.jsx)(e.Badge,{variant:"outline",className:(0,B.cn)("capitalize",Z[c.status]||Z.active),children:c.status})}),(0,b.jsx)(i.TableCell,{className:"text-right",onClick:a=>a.stopPropagation(),children:(0,b.jsxs)("div",{className:"flex items-center justify-end gap-1",children:[a&&(0,b.jsxs)(f.Button,{variant:"outline",size:"sm",onClick:a=>{a.stopPropagation(),ad(c),ab(!0)},children:[(0,b.jsx)(w.Plus,{className:"h-4 w-4 mr-1"}),"Agreement"]}),(0,b.jsx)(f.Button,{variant:"ghost",size:"sm",onClick:a=>{a.stopPropagation(),an(c.id)},children:(0,b.jsx)(p.ExternalLink,{className:"h-4 w-4"})})]})})]},c.id)})})]})})})]}),ac&&(0,b.jsx)(E.CreateAgreementDialog,{open:aa,onOpenChange:a=>{ab(a),a||ad(null)},introducerId:ac.id,introducerName:ac.legal_name,defaultCommissionBps:ac.default_commission_bps||100}),(0,b.jsx)(Y,{introducerId:ag,open:ae,onOpenChange:af})]})}a.s(["default",()=>_],546037)}];

//# sourceMappingURL=versotech-portal_src_app_%28main%29_versotech_main_my-introducers_page_tsx_adcc33a6._.js.map