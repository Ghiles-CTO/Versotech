module.exports=[54365,a=>{"use strict";var b=a.i(352584),c=a.i(611038),d=a.i(284169),e=a.i(15788),f=a.i(421908),g=a.i(663475),h=a.i(951870),i=a.i(771088),j=a.i(778541),k=a.i(816854),l=a.i(966494),m=a.i(155508),n=a.i(42329),o=a.i(487068),p=a.i(3321),q=a.i(877918),r=a.i(618287),s=a.i(871057),t=a.i(478870),u=a.i(278541),v=a.i(752907),w=a.i(724070),x=a.i(888987),y=a.i(201986),z=a.i(58834),A=a.i(497412);let B=[{label:"All Time",value:"all"},{label:"Last 7 Days",value:"7d"},{label:"Last 30 Days",value:"30d"},{label:"Last 90 Days",value:"90d"},{label:"This Year",value:"year"}],C={open:"bg-green-100 text-green-800 border-green-200",draft:"bg-gray-100 text-gray-800 border-gray-200",closed:"bg-blue-100 text-blue-800 border-blue-200",cancelled:"bg-red-100 text-red-800 border-red-200",allocation_pending:"bg-yellow-100 text-yellow-800 border-yellow-200",fully_subscribed:"bg-purple-100 text-purple-800 border-purple-200"},D=[{label:"All Status",value:"all"},{label:"Open",value:"open"},{label:"Draft",value:"draft"},{label:"Closed",value:"closed"},{label:"Fully Subscribed",value:"fully_subscribed"}];function E(){let[a,E]=(0,c.useState)(null),[F,G]=(0,c.useState)([]),[H,I]=(0,c.useState)({totalMandates:0,activeMandates:0,closedMandates:0,totalRaised:0,totalTarget:0,currency:"USD"}),[J,K]=(0,c.useState)(!0),[L,M]=(0,c.useState)(null),[N,O]=(0,c.useState)(""),[P,Q]=(0,c.useState)("all"),[R,S]=(0,c.useState)("all"),[T,U]=(0,c.useState)(0),[V,W]=(0,c.useState)([]),[X,Y]=(0,c.useState)(!1);(0,c.useEffect)(()=>{async function a(a){let{data:b,error:c}=await a.from("vehicles").select("id").not("arranger_entity_id","is",null);if(c)throw c;let d=(b||[]).map(a=>a.id),e=[];if(d.length>0){let{data:b,error:c}=await a.from("deals").select(`
            id,
            name,
            company_name,
            company_logo_url,
            deal_type,
            status,
            currency,
            target_amount,
            raised_amount,
            minimum_investment,
            sector,
            stage,
            location,
            open_at,
            close_at,
            created_at,
            vehicle_id
          `).in("vehicle_id",d).order("created_at",{ascending:!1}).limit(100);if(c)throw c;e=b||[]}let f=(e||[]).map(a=>({id:a.id,name:a.name||"Untitled Deal",company_name:a.company_name,company_logo_url:a.company_logo_url,deal_type:a.deal_type||"unknown",status:a.status||"draft",currency:a.currency||"USD",target_amount:Number(a.target_amount)||0,raised_amount:Number(a.raised_amount)||0,minimum_investment:Number(a.minimum_investment)||0,sector:a.sector,stage:a.stage,location:a.location,open_at:a.open_at,close_at:a.close_at,created_at:a.created_at,investor_count:0,pending_signatures:0}));G(f);let g=f.filter(a=>"open"===a.status||"allocation_pending"===a.status).length,h=f.filter(a=>"closed"===a.status||"fully_subscribed"===a.status).length,i=0,j=0;for(let a of f)i+=a.raised_amount,j+=a.target_amount;I({totalMandates:f.length,activeMandates:g,closedMandates:h,totalRaised:i,totalTarget:j,currency:"USD"})}!async function(){try{K(!0);let b=(0,z.createClient)(),{data:{user:c}}=await b.auth.getUser();if(!c)return void M("Not authenticated");let{data:d,error:e}=await b.from("arranger_users").select("arranger_id").eq("user_id",c.id).single();if(e||!d)return void await a(b);let{data:f,error:g}=await b.from("arranger_entities").select("id, legal_name, license_type, status").eq("id",d.arranger_id).single();if(g)throw g;E(f);let{data:h,error:i}=await b.from("vehicles").select("id, name").eq("arranger_entity_id",d.arranger_id);if(i)throw i;let j=(h||[]).map(a=>a.id),k=[];if(j.length>0){let{data:a,error:c}=await b.from("deals").select(`
              id,
              name,
              company_name,
              company_logo_url,
              deal_type,
              status,
              currency,
              target_amount,
              raised_amount,
              minimum_investment,
              sector,
              stage,
              location,
              open_at,
              close_at,
              created_at,
              vehicle_id
            `).in("vehicle_id",j).order("created_at",{ascending:!1});if(c)throw c;k=a||[]}let l=(k||[]).map(a=>a.id),m={},n={};if(l.length>0){let{data:a}=await b.from("deal_memberships").select("deal_id").in("deal_id",l).eq("role","investor");for(let b of a||[])b.deal_id&&(m[b.deal_id]=(m[b.deal_id]||0)+1);let{data:c}=await b.from("subscriptions").select(`
              id,
              deal_id,
              investor:investor_id (
                id,
                legal_name,
                display_name
              )
            `).in("deal_id",l);if(c&&c.length>0){let a=c.map(a=>a.id),{data:d}=await b.from("signature_requests").select("id, subscription_id, status, signer_role, document_type, created_at, token_expires_at, signing_token").in("subscription_id",a).eq("status","pending").eq("signer_role","arranger").order("created_at",{ascending:!1}),e=[];for(let a of d||[]){let b=c.find(b=>b.id===a.subscription_id);if(b?.deal_id){n[b.deal_id]=(n[b.deal_id]||0)+1;let c=(k||[]).find(a=>a.id===b.deal_id);e.push({id:a.id,deal_id:b.deal_id,deal_name:c?.name||"Unknown Deal",investor_name:b.investor?.legal_name||b.investor?.display_name||"Unknown Investor",subscription_id:a.subscription_id,document_type:a.document_type,created_at:a.created_at,token_expires_at:a.token_expires_at,signing_url:`/versotech_main/versosign/sign/${a.signing_token}`})}}W(e)}}let o=Object.values(n).reduce((a,b)=>a+b,0);U(o);let p=(k||[]).map(a=>({id:a.id,name:a.name||"Untitled Deal",company_name:a.company_name,company_logo_url:a.company_logo_url,deal_type:a.deal_type||"unknown",status:a.status||"draft",currency:a.currency||"USD",target_amount:Number(a.target_amount)||0,raised_amount:Number(a.raised_amount)||0,minimum_investment:Number(a.minimum_investment)||0,sector:a.sector,stage:a.stage,location:a.location,open_at:a.open_at,close_at:a.close_at,created_at:a.created_at,investor_count:m[a.id]||0,pending_signatures:n[a.id]||0}));G(p);let q=p.filter(a=>"open"===a.status||"allocation_pending"===a.status).length,r=p.filter(a=>"closed"===a.status||"fully_subscribed"===a.status).length,s=0,t=0;for(let a of p)s+=a.raised_amount,t+=a.target_amount;I({totalMandates:p.length,activeMandates:q,closedMandates:r,totalRaised:s,totalTarget:t,currency:"USD"}),M(null)}catch(a){console.error("[MyMandatesPage] Error:",a),M(a instanceof Error?a.message:"Failed to load mandates")}finally{K(!1)}}()},[]);let Z=F.filter(a=>{let b="all"===P||a.status===P,c=!N||a.name?.toLowerCase().includes(N.toLowerCase())||a.company_name?.toLowerCase().includes(N.toLowerCase())||a.sector?.toLowerCase().includes(N.toLowerCase()),d=(a=>{let b=new Date;switch(a){case"7d":return new Date(b.getTime()-6048e5);case"30d":return new Date(b.getTime()-2592e6);case"90d":return new Date(b.getTime()-7776e6);case"year":return new Date(b.getFullYear(),0,1);default:return null}})(R),e=!d||new Date(a.created_at)>=d;return b&&c&&e}),$=(a,b)=>0===b?0:Math.min(100,Math.round(a/b*100));return J?(0,b.jsxs)("div",{className:"flex items-center justify-center py-16",children:[(0,b.jsx)(p.Loader2,{className:"h-8 w-8 animate-spin text-muted-foreground"}),(0,b.jsx)("span",{className:"ml-3 text-muted-foreground",children:"Loading mandates..."})]}):L?(0,b.jsxs)("div",{className:"text-center py-16",children:[(0,b.jsx)(q.AlertCircle,{className:"h-12 w-12 text-destructive mx-auto mb-4"}),(0,b.jsx)("h3",{className:"text-lg font-medium text-foreground mb-2",children:"Error Loading Mandates"}),(0,b.jsx)("p",{className:"text-muted-foreground",children:L})]}):(0,b.jsxs)("div",{className:"p-6 space-y-6",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-2xl font-bold text-foreground",children:"My Mandates"}),(0,b.jsx)("p",{className:"text-muted-foreground mt-1",children:a?`Manage deals and placement activities as ${a.legal_name}`:"View all arranger mandates across the platform"})]}),a&&a.license_type&&(0,b.jsx)(e.Badge,{variant:"outline",className:"capitalize",children:a.license_type})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,b.jsxs)(d.Card,{children:[(0,b.jsx)(d.CardHeader,{className:"pb-2",children:(0,b.jsxs)(d.CardTitle,{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[(0,b.jsx)(s.Briefcase,{className:"h-4 w-4"}),"Total Mandates"]})}),(0,b.jsxs)(d.CardContent,{children:[(0,b.jsx)("div",{className:"text-2xl font-bold",children:H.totalMandates}),(0,b.jsxs)("p",{className:"text-xs text-muted-foreground mt-1",children:[H.activeMandates," active, ",H.closedMandates," closed"]})]})]}),(0,b.jsxs)(d.Card,{children:[(0,b.jsx)(d.CardHeader,{className:"pb-2",children:(0,b.jsxs)(d.CardTitle,{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[(0,b.jsx)(l.TrendingUp,{className:"h-4 w-4"}),"Active Deals"]})}),(0,b.jsxs)(d.CardContent,{children:[(0,b.jsx)("div",{className:"text-2xl font-bold text-green-600",children:H.activeMandates}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Currently raising"})]})]}),(0,b.jsxs)(d.Card,{children:[(0,b.jsx)(d.CardHeader,{className:"pb-2",children:(0,b.jsxs)(d.CardTitle,{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[(0,b.jsx)(m.DollarSign,{className:"h-4 w-4"}),"Total Raised"]})}),(0,b.jsxs)(d.CardContent,{children:[(0,b.jsx)("div",{className:"text-2xl font-bold",children:(0,y.formatCurrency)(H.totalRaised,H.currency)}),(0,b.jsxs)("p",{className:"text-xs text-muted-foreground mt-1",children:["of ",(0,y.formatCurrency)(H.totalTarget,H.currency)," target"]})]})]}),(0,b.jsxs)(d.Card,{children:[(0,b.jsx)(d.CardHeader,{className:"pb-2",children:(0,b.jsxs)(d.CardTitle,{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[(0,b.jsx)(n.Clock,{className:"h-4 w-4"}),"Avg. Progress"]})}),(0,b.jsxs)(d.CardContent,{children:[(0,b.jsxs)("div",{className:"text-2xl font-bold",children:[H.totalTarget>0?$(H.totalRaised,H.totalTarget):0,"%"]}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Overall fundraising"})]})]})]}),T>0&&(0,b.jsx)(d.Card,{className:"border-amber-500/30 bg-amber-50/50",children:(0,b.jsxs)(d.CardContent,{className:"py-4",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("div",{className:"p-2 rounded-full bg-amber-500/20",children:(0,b.jsx)(v.PenTool,{className:"h-5 w-5 text-amber-600"})}),(0,b.jsxs)("div",{children:[(0,b.jsxs)("p",{className:"font-medium text-foreground",children:[T," Pending Signature",1!==T?"s":""]}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"You have subscription packs awaiting your countersignature"})]})]}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)(f.Button,{variant:"ghost",size:"sm",onClick:()=>Y(!X),children:X?"Hide List":"Show List"}),(0,b.jsx)(f.Button,{variant:"outline",asChild:!0,children:(0,b.jsxs)(A.default,{href:"/versotech_main/versosign",children:[(0,b.jsx)(v.PenTool,{className:"h-4 w-4 mr-2"}),"Go to VERSOSign"]})})]})]}),X&&V.length>0&&(0,b.jsx)("div",{className:"mt-4 pt-4 border-t border-amber-300/30",children:(0,b.jsx)("div",{className:"space-y-2",children:V.map(a=>{let c=new Date(a.token_expires_at).getTime()-Date.now()<1728e5;return(0,b.jsxs)("div",{className:"flex items-center justify-between p-3 bg-white/50 rounded-lg border border-amber-200/50",children:[(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsx)("p",{className:"font-medium text-foreground truncate",children:a.deal_name}),(0,b.jsxs)("p",{className:"text-sm text-muted-foreground",children:[a.investor_name," • ",a.document_type.replace("_"," ")]}),(0,b.jsxs)("p",{className:(0,x.cn)("text-xs mt-1",c?"text-red-600 font-medium":"text-muted-foreground"),children:[c?"⚠️ ":"","Expires: ",(0,y.formatDate)(a.token_expires_at)]})]}),(0,b.jsx)(f.Button,{size:"sm",className:"ml-4 bg-amber-600 hover:bg-amber-700",asChild:!0,children:(0,b.jsxs)(A.default,{href:a.signing_url,children:[(0,b.jsx)(v.PenTool,{className:"h-4 w-4 mr-1"}),"Sign Now"]})})]},a.id)})})})]})}),(0,b.jsx)(d.Card,{children:(0,b.jsx)(d.CardContent,{className:"pt-6",children:(0,b.jsxs)("div",{className:"flex flex-col md:flex-row gap-4",children:[(0,b.jsx)("div",{className:"flex-1",children:(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)(o.Search,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),(0,b.jsx)(g.Input,{placeholder:"Search by deal name, company, or sector...",value:N,onChange:a=>O(a.target.value),className:"pl-10"})]})}),(0,b.jsxs)(h.Select,{value:P,onValueChange:Q,children:[(0,b.jsx)(h.SelectTrigger,{className:"w-full md:w-40",children:(0,b.jsx)(h.SelectValue,{placeholder:"Filter by status"})}),(0,b.jsx)(h.SelectContent,{children:D.map(a=>(0,b.jsx)(h.SelectItem,{value:a.value,children:a.label},a.value))})]}),(0,b.jsxs)(h.Select,{value:R,onValueChange:S,children:[(0,b.jsxs)(h.SelectTrigger,{className:"w-full md:w-40",children:[(0,b.jsx)(w.Calendar,{className:"h-4 w-4 mr-2"}),(0,b.jsx)(h.SelectValue,{placeholder:"Filter by date"})]}),(0,b.jsx)(h.SelectContent,{children:B.map(a=>(0,b.jsx)(h.SelectItem,{value:a.value,children:a.label},a.value))})]})]})})}),(0,b.jsxs)(d.Card,{children:[(0,b.jsxs)(d.CardHeader,{children:[(0,b.jsx)(d.CardTitle,{children:"Mandates"}),(0,b.jsxs)(d.CardDescription,{children:[Z.length," mandate",1!==Z.length?"s":""," found"]})]}),(0,b.jsx)(d.CardContent,{children:0===Z.length?(0,b.jsxs)("div",{className:"border border-dashed border-muted rounded-lg py-12 flex flex-col items-center justify-center text-center space-y-2",children:[(0,b.jsx)(k.FileText,{className:"h-10 w-10 text-muted-foreground"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:N||"all"!==P?"No mandates match your filters":"No mandates yet"}),!a&&0===F.length&&(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"Arranger mandates will appear here when deals are assigned to arranger entities"})]}):(0,b.jsx)("div",{className:"rounded-md border",children:(0,b.jsxs)(i.Table,{children:[(0,b.jsx)(i.TableHeader,{children:(0,b.jsxs)(i.TableRow,{children:[(0,b.jsx)(i.TableHead,{children:"Deal"}),(0,b.jsx)(i.TableHead,{children:"Status"}),(0,b.jsx)(i.TableHead,{children:"Progress"}),(0,b.jsx)(i.TableHead,{children:"Investors"}),(0,b.jsx)(i.TableHead,{children:"Pending"}),(0,b.jsx)(i.TableHead,{children:"Timeline"}),(0,b.jsx)(i.TableHead,{className:"text-right",children:"Actions"})]})}),(0,b.jsx)(i.TableBody,{children:Z.map(a=>(0,b.jsxs)(i.TableRow,{children:[(0,b.jsx)(i.TableCell,{children:(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[a.company_logo_url?(0,b.jsx)("img",{src:a.company_logo_url,alt:a.company_name||"",className:"h-10 w-10 rounded-lg object-cover"}):(0,b.jsx)("div",{className:"h-10 w-10 rounded-lg bg-muted flex items-center justify-center",children:(0,b.jsx)(u.Building2,{className:"h-5 w-5 text-muted-foreground"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"font-medium",children:a.name}),a.company_name&&(0,b.jsxs)("div",{className:"text-xs text-muted-foreground",children:[a.company_name,a.sector&&` • ${a.sector}`]})]})]})}),(0,b.jsx)(i.TableCell,{children:(0,b.jsx)(e.Badge,{variant:"outline",className:(0,x.cn)("capitalize",C[a.status]||C.draft),children:a.status.replace("_"," ")})}),(0,b.jsx)(i.TableCell,{children:(0,b.jsxs)("div",{className:"w-32 space-y-1",children:[(0,b.jsxs)("div",{className:"flex justify-between text-xs",children:[(0,b.jsx)("span",{children:(0,y.formatCurrency)(a.raised_amount,a.currency)}),(0,b.jsxs)("span",{className:"text-muted-foreground",children:[$(a.raised_amount,a.target_amount),"%"]})]}),(0,b.jsx)(j.Progress,{value:$(a.raised_amount,a.target_amount),className:"h-2"}),(0,b.jsxs)("div",{className:"text-xs text-muted-foreground",children:["of ",(0,y.formatCurrency)(a.target_amount,a.currency)]})]})}),(0,b.jsx)(i.TableCell,{children:(0,b.jsxs)("div",{className:"flex items-center gap-1",children:[(0,b.jsx)(t.Users,{className:"h-4 w-4 text-muted-foreground"}),(0,b.jsx)("span",{className:"font-medium",children:a.investor_count})]})}),(0,b.jsx)(i.TableCell,{children:a.pending_signatures>0?(0,b.jsxs)(e.Badge,{variant:"outline",className:"bg-amber-50 text-amber-700 border-amber-200",children:[(0,b.jsx)(v.PenTool,{className:"h-3 w-3 mr-1"}),a.pending_signatures]}):(0,b.jsx)("span",{className:"text-muted-foreground text-xs",children:"—"})}),(0,b.jsx)(i.TableCell,{children:(0,b.jsxs)("div",{className:"text-sm",children:[a.open_at&&(0,b.jsxs)("div",{className:"text-xs",children:["Open: ",(0,y.formatDate)(a.open_at)]}),a.close_at&&(0,b.jsxs)("div",{className:"text-xs text-muted-foreground",children:["Close: ",(0,y.formatDate)(a.close_at)]}),!a.open_at&&!a.close_at&&(0,b.jsx)("span",{className:"text-muted-foreground text-xs",children:"No dates set"})]})}),(0,b.jsx)(i.TableCell,{className:"text-right",children:(0,b.jsx)(f.Button,{variant:"ghost",size:"sm",asChild:!0,children:(0,b.jsx)(A.default,{href:`/versotech_main/my-mandates/${a.id}`,children:(0,b.jsx)(r.ExternalLink,{className:"h-4 w-4"})})})})]},a.id))})]})})})]})]})}a.s(["default",()=>E])}];

//# sourceMappingURL=versotech-portal_src_app_%28main%29_versotech_main_my-mandates_page_tsx_087fdba4._.js.map