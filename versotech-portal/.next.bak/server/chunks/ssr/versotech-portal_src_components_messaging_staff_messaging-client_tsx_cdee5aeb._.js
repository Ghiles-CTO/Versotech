module.exports=[509706,a=>{"use strict";var b=a.i(352584),c=a.i(611038);a.i(182584);var d=a.i(590612),e=a.i(888987),f=a.i(421908),g=a.i(15788),h=a.i(663475),i=a.i(105874),j=a.i(951870),k=a.i(3321),l=a.i(908513);let m=(0,a.i(95799).default)("message-square-plus",[["path",{d:"M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z",key:"18887p"}],["path",{d:"M12 8v6",key:"1ib9pf"}],["path",{d:"M9 11h6",key:"1fldmi"}]]);var n=a.i(124737),o=a.i(200365);let p=[{value:"all",label:"All"},{value:"investor",label:"Investor"},{value:"internal",label:"Internal"},{value:"deal",label:"Deals"}],q=[{value:"all",label:"All Types"},{value:"dm",label:"Direct"},{value:"group",label:"Group"},{value:"deal_room",label:"Deal Rooms"},{value:"broadcast",label:"Broadcasts"}];function r({conversations:a,filters:d,onFiltersChange:r,onRefresh:s,onSelectConversation:t,onCreateConversation:u,activeConversationId:v,isLoading:w,errorMessage:x,canCreateConversation:y=!0}){let[z,A]=(0,c.useState)(d.search||""),B=(0,c.useMemo)(()=>{let b={...d,search:z||void 0},c=(0,n.applyConversationFilters)(a,b);return(0,n.sortConversations)(c)},[a,d,z]),C=(0,c.useMemo)(()=>{let b={all:0,investor:0,internal:0,deal:0};for(let c of a)b.all+=c.unreadCount||0,b[c.visibility]+=c.unreadCount||0;return b},[a]);return(0,b.jsxs)("aside",{className:"w-full sm:w-[360px] border-r border-border bg-card flex flex-col text-foreground",children:[(0,b.jsxs)("div",{className:"p-4 border-b border-border space-y-3",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between gap-2 text-foreground",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h2",{className:"text-lg font-semibold",children:"Messages"}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"Track investor and internal threads"})]}),(0,b.jsx)(f.Button,{variant:"ghost",size:"icon",onClick:s,disabled:w,className:"text-foreground hover:text-foreground hover:bg-muted",children:w?(0,b.jsx)(k.Loader2,{className:"h-4 w-4 animate-spin"}):(0,b.jsx)(l.RefreshCw,{className:"h-4 w-4"})})]}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,b.jsxs)(j.Select,{value:d.visibility,onValueChange:a=>{r({...d,visibility:a})},children:[(0,b.jsx)(j.SelectTrigger,{className:"bg-muted border-border text-foreground",children:(0,b.jsx)(j.SelectValue,{placeholder:"Visibility"})}),(0,b.jsx)(j.SelectContent,{className:"bg-muted text-popover-foreground border-border",children:p.map(a=>(0,b.jsx)(j.SelectItem,{value:a.value,children:(0,b.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,b.jsx)("span",{children:a.label}),(0,b.jsx)(g.Badge,{variant:"secondary",className:"bg-secondary text-foreground",children:C[a.value]})]})},a.value))})]}),(0,b.jsxs)(j.Select,{value:d.type,onValueChange:a=>{r({...d,type:a})},children:[(0,b.jsx)(j.SelectTrigger,{className:"bg-muted border-border text-foreground",children:(0,b.jsx)(j.SelectValue,{placeholder:"Type"})}),(0,b.jsx)(j.SelectContent,{className:"bg-muted text-popover-foreground border-border",children:q.map(a=>(0,b.jsx)(j.SelectItem,{value:a.value,children:a.label},a.value))})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)(f.Button,{variant:d.unreadOnly?"default":"outline",size:"sm",className:"w-full text-popover-foreground",onClick:()=>{r({...d,unreadOnly:!d.unreadOnly})},children:["Unread ",d.unreadOnly?"":`(${C.all})`]}),y&&(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,b.jsxs)(f.Button,{size:"sm",variant:"default",className:"bg-blue-600 hover:bg-blue-700 text-white",onClick:()=>u("dm"),children:[(0,b.jsx)(m,{className:"h-3.5 w-3.5 mr-1.5"}),"New Chat"]}),(0,b.jsxs)(f.Button,{size:"sm",variant:"outline",className:"border-border text-popover-foreground hover:bg-muted",onClick:()=>u("group"),children:[(0,b.jsx)(m,{className:"h-3.5 w-3.5 mr-1.5"}),"New Group"]})]})]}),(0,b.jsx)(h.Input,{placeholder:"Search conversations",value:z,onChange:a=>{var b;A(b=a.target.value),r({...d,search:b||void 0})},className:"bg-muted border-border text-popover-foreground placeholder:text-muted-foreground"}),x?(0,b.jsx)("div",{className:"text-xs text-red-300 border border-red-500/40 bg-red-500/10 p-2 rounded",children:x}):null]}),(0,b.jsx)("div",{className:"flex-1 overflow-y-auto bg-background",children:0===B.length?(0,b.jsx)("div",{className:"flex flex-col items-center justify-center h-full text-muted-foreground text-sm",children:w?"Loading conversations…":"No conversations match your filters."}):(0,b.jsx)("ul",{className:"p-2 space-y-1",children:B.map(a=>{let c=a.id===v,d=a.participants[0],f=a.lastMessageAt||a.createdAt;return(0,b.jsx)("li",{children:(0,b.jsx)("button",{className:(0,e.cn)("w-full text-left px-3 py-3 rounded-lg group","transition-all duration-200 ease-out","hover:bg-muted/80 hover:shadow-md hover:scale-[1.02]","focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2","active:scale-[0.98]",c?"bg-muted shadow-sm scale-[1.01]":"bg-transparent"),onClick:()=>t(a.id),children:(0,b.jsxs)("div",{className:"flex items-start gap-3",children:[(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsxs)(i.Avatar,{className:"h-11 w-11 transition-transform duration-200 group-hover:scale-110",children:[d?.avatarUrl&&(0,b.jsx)(i.AvatarImage,{src:d.avatarUrl,alt:d.displayName||d.email||"User"}),(0,b.jsx)(i.AvatarFallback,{className:"bg-secondary text-foreground text-sm font-medium",children:(0,o.getInitials)(d?.displayName||d?.email)})]}),a.unreadCount>0&&(0,b.jsx)("div",{className:"absolute -top-1 -right-1 h-5 w-5 rounded-full bg-blue-500 flex items-center justify-center shadow-lg animate-pulse",children:(0,b.jsx)("span",{className:"text-[10px] font-bold text-white",children:a.unreadCount>9?"9+":a.unreadCount})})]}),(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsxs)("div",{className:"flex items-baseline justify-between gap-2 mb-1",children:[(0,b.jsx)("span",{className:(0,e.cn)("font-semibold truncate text-sm",a.unreadCount>0?"text-white":"text-foreground"),children:a.subject||"Untitled Conversation"}),(0,b.jsx)("span",{className:"text-[10px] text-muted-foreground shrink-0",suppressHydrationWarning:!0,children:(0,o.formatRelativeTime)(f)})]}),(0,b.jsx)("p",{className:(0,e.cn)("text-xs truncate",a.unreadCount>0?"text-foreground/80 font-medium":"text-muted-foreground"),children:(0,o.truncateText)(a.preview||a.latestMessage?.body||"No messages yet",60)}),(0,b.jsxs)("div",{className:"flex items-center gap-2 mt-1.5",children:[(0,b.jsx)(g.Badge,{variant:"outline",className:"text-[10px] capitalize border-border text-muted-foreground px-1.5 py-0",children:a.type.replace("_"," ")}),a.participants.length>1&&(0,b.jsxs)("span",{className:"text-[10px] text-muted-foreground",children:[a.participants.length," participants"]})]})]})]})})},a.id)})})})]})}var s=a.i(174297),t=a.i(58834),u=a.i(899750),v=a.i(470305),w=a.i(191675),x=a.i(266828);function y({open:a,onOpenChange:d,mode:i,onCreate:j,staffDirectory:k,investorDirectory:l,isSubmitting:m}){let[n,o]=(0,c.useState)(""),[p,q]=(0,c.useState)(""),[r,s]=(0,c.useState)([]),[t,u]=(0,c.useState)([]),[y,z]=(0,c.useState)("");console.log("[NewConversationDialog] Mode:",i,"Staff:",k.length,"Investors:",l.length);let A="dm"===i,B="group"===i,C=r.length+t.length,D=t.length>0,E=(0,c.useMemo)(()=>{let a=[...r,...t][0];return[...k,...l].find(b=>b.id===a)},[r,t,k,l]),F=(0,c.useMemo)(()=>{if(!y)return k;let a=y.toLowerCase();return k.filter(b=>b.display_name?.toLowerCase().includes(a)||b.email?.toLowerCase().includes(a))},[k,y]),G=(0,c.useMemo)(()=>{if(!y)return l;let a=y.toLowerCase();return l.filter(b=>b.display_name?.toLowerCase().includes(a)||b.email?.toLowerCase().includes(a)||b.entity_name?.toLowerCase().includes(a))},[l,y]),H=(0,c.useMemo)(()=>{let a=new Map;return G.forEach(b=>{let c=b.entity_name||"Individual Investors";a.has(c)||a.set(c,[]),a.get(c).push(b)}),Array.from(a.entries()).sort((a,b)=>a[0].localeCompare(b[0]))},[G]),I=(0,c.useMemo)(()=>{let a=[];if(a.push({kind:"section",title:"Staff Members",description:"Internal team available for messaging",count:F.length}),0===F.length)a.push({kind:"empty",message:y?"No staff found":"No staff members available"});else for(let b of F)a.push({kind:"staff",entry:b});if(a.push({kind:"section",title:"Investors",description:"Include investor contacts in this thread",count:G.length}),0===G.length)a.push({kind:"empty",message:y?"No investors found":"No investors available"});else for(let[b,c]of H)for(let d of(a.push({kind:"group",title:b}),c))a.push({kind:"investor",entry:d});return a},[F,G,H,y]),J=a=>{A?(s([a]),u([])):s(b=>b.includes(a)?b.filter(b=>b!==a):[...b,a])},K=a=>{A?(u([a]),s([])):u(b=>b.includes(a)?b.filter(b=>b!==a):[...b,a])},L=a=>{a||(o(""),q(""),z(""),s([]),u([])),d(a)},M=A?1===C:C>0;return(0,b.jsx)(v.Dialog,{open:a,onOpenChange:L,children:(0,b.jsx)(v.DialogContent,{className:"w-[min(95vw,1100px)] rounded-2xl border border-slate-700 bg-slate-950 p-0 text-slate-50",showCloseButton:!1,children:(0,b.jsxs)("div",{className:"flex h-[min(90vh,880px)] flex-col",children:[(0,b.jsxs)("div",{className:"flex items-start justify-between gap-3 border-b border-slate-800 px-6 py-5",children:[(0,b.jsxs)(v.DialogHeader,{className:"flex-1 gap-1",children:[(0,b.jsx)(v.DialogTitle,{className:"text-2xl font-semibold text-white",children:A?"Start New Direct Conversation":"Create New Group"}),(0,b.jsx)(v.DialogDescription,{className:"mt-1 text-base text-slate-300",children:A?"Select one person to start a direct conversation with.":"Select multiple people and give your group a name."})]}),(0,b.jsx)(v.DialogClose,{className:"rounded-md border border-slate-600 px-3 py-1 text-sm text-slate-200 transition-colors hover:bg-slate-800 hover:text-white",children:"Close"})]}),(0,b.jsx)("div",{className:"flex-1 min-h-0 overflow-hidden",children:(0,b.jsxs)("div",{className:"h-full overflow-y-auto px-6 py-6 space-y-6",children:[B&&(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)("label",{htmlFor:"group-name",className:"text-sm font-semibold text-white",children:["Group Name ",(0,b.jsx)("span",{className:"text-red-400",children:"*"})]}),(0,b.jsx)(h.Input,{id:"group-name",placeholder:"e.g., Q4 Planning Team",value:n,onChange:a=>o(a.target.value),className:"h-11 bg-slate-900 border-slate-700 text-white placeholder:text-slate-400"})]}),A&&E&&(0,b.jsxs)("div",{className:"rounded-lg border border-blue-500/40 bg-blue-500/10 p-4",children:[(0,b.jsx)("p",{className:"text-xs font-semibold uppercase tracking-wider text-blue-300",children:"Starting conversation with"}),(0,b.jsx)("p",{className:"mt-1 text-lg font-semibold text-white",children:E.display_name||E.email}),(0,b.jsx)("p",{className:"text-sm text-slate-300",children:E.email})]}),(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsxs)("label",{htmlFor:"initial-message",className:"text-base font-semibold text-white",children:[A?"First message":"Initial message"," ",(0,b.jsx)("span",{className:"text-slate-400 font-normal",children:"(optional)"})]}),(0,b.jsx)(w.Textarea,{id:"initial-message",placeholder:A?"Say hello...":"Kick off the conversation...",value:p,onChange:a=>q(a.target.value),rows:3,className:"bg-slate-900 border border-slate-700 text-white placeholder:text-slate-500 focus:border-blue-500"})]}),(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsx)("label",{htmlFor:"search-people",className:"text-base font-semibold text-white",children:A?"Select one person":"Select participants"}),(0,b.jsx)(h.Input,{id:"search-people",placeholder:"Search by name or email...",value:y,onChange:a=>z(a.target.value),className:"h-12 bg-slate-900 border border-slate-700 text-white placeholder:text-slate-500 focus:border-blue-500"})]}),(0,b.jsx)("section",{className:"rounded-xl border border-slate-800 bg-slate-900/70",children:(0,b.jsx)("div",{className:"max-h-[calc(80vh-240px)] overflow-y-auto px-5 py-4 space-y-4",children:I.map((a,c)=>{switch(a.kind){case"section":return(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm font-semibold text-white",children:a.title}),(0,b.jsx)("p",{className:"text-xs text-slate-400",children:a.description})]}),(0,b.jsx)(g.Badge,{variant:"outline",className:"border-slate-600 bg-slate-800 text-xs font-semibold uppercase text-slate-200",children:a.count})]},`${a.kind}-${a.title}-${c}`);case"group":return(0,b.jsx)("div",{className:"pt-3 text-xs font-semibold uppercase tracking-wider text-slate-300",children:a.title},`group-${a.title}-${c}`);case"empty":return(0,b.jsx)("p",{className:"py-6 text-center text-sm text-slate-400",children:a.message},`empty-${a.message}-${c}`);case"staff":{let d=a.entry,f=r.includes(d.id);return(0,b.jsxs)("label",{className:(0,e.cn)("flex flex-col gap-2 rounded-xl border px-4 py-4 transition-colors",f?"border-blue-500 bg-blue-500/15 shadow-[0_0_0_1px_rgba(59,130,246,0.35)]":"border-slate-700 hover:border-slate-600 hover:bg-slate-800/60"),onClick:()=>J(d.id),children:[(0,b.jsxs)("div",{className:"flex items-center justify-between gap-4",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[B?(0,b.jsx)(x.Checkbox,{checked:f,onCheckedChange:()=>J(d.id),className:"h-5 w-5"}):(0,b.jsx)("span",{className:(0,e.cn)("flex h-5 w-5 items-center justify-center rounded-full border-2",f?"border-blue-400 bg-blue-500":"border-slate-500"),children:f&&(0,b.jsx)("span",{className:"h-2.5 w-2.5 rounded-full bg-white"})}),(0,b.jsx)("p",{className:"text-base font-semibold text-white leading-tight whitespace-normal",children:d.display_name||d.email||"Staff member"})]}),(0,b.jsx)(g.Badge,{variant:"outline",className:"border-slate-600 bg-slate-800 text-xs font-semibold uppercase text-slate-200",children:d.role.replace("staff_","")})]}),(0,b.jsx)("p",{className:"text-sm text-slate-300 leading-tight whitespace-normal",children:d.email})]},`staff-${d.id}-${c}`)}case"investor":{let d=a.entry,f=t.includes(d.id);return(0,b.jsxs)("label",{className:(0,e.cn)("flex flex-col gap-2 rounded-xl border px-4 py-4 transition-colors",f?"border-blue-500 bg-blue-500/15 shadow-[0_0_0_1px_rgba(59,130,246,0.35)]":"border-slate-700 hover-border-slate-600 hover:bg-slate-800/60"),onClick:()=>K(d.id),children:[(0,b.jsxs)("div",{className:"flex items-center justify-between gap-4",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[B?(0,b.jsx)(x.Checkbox,{checked:f,onCheckedChange:()=>K(d.id),className:"h-5 w-5"}):(0,b.jsx)("span",{className:(0,e.cn)("flex h-5 w-5 items-center justify-center rounded-full border-2",f?"border-blue-400 bg-blue-500":"border-slate-500"),children:f&&(0,b.jsx)("span",{className:"h-2.5 w-2.5 rounded-full bg-white"})}),(0,b.jsx)("span",{className:"text-base font-semibold text-white leading-tight whitespace-normal",children:d.display_name||d.email||"Investor"})]}),d.entity_type&&(0,b.jsx)(g.Badge,{variant:"outline",className:"border-blue-400/60 bg-blue-500/10 text-xs font-semibold capitalize text-blue-200",children:d.entity_type})]}),(0,b.jsx)("p",{className:"text-sm text-slate-300 leading-tight whitespace-normal",children:d.email})]},`investor-${d.id}-${c}`)}}})})}),(0,b.jsxs)("div",{className:"rounded-xl border border-slate-800 bg-slate-900/70 px-6 py-4",children:[(0,b.jsx)("p",{className:"text-sm font-semibold uppercase tracking-wide text-white",children:"Summary"}),(0,b.jsx)("p",{className:"mt-2 text-base text-white",children:A?1===C?`Ready to message ${E?.display_name||E?.email}`:"Select one person to continue":`${C} participant${1===C?"":"s"} selected`}),D&&(0,b.jsx)("p",{className:"mt-2 text-sm font-medium text-blue-300",children:"✓ Contains investors • Visibility automatically set to Investor"}),!M&&(0,b.jsx)("p",{className:"mt-2 text-sm text-red-300",children:A?"⚠ Select exactly one person":"⚠ Select at least one participant"}),B&&!n.trim()&&(0,b.jsx)("p",{className:"mt-2 text-sm text-red-300",children:"⚠ Group name is required"})]})]})}),(0,b.jsxs)(v.DialogFooter,{className:"gap-3 border-t border-slate-800 px-6 py-4",children:[(0,b.jsx)(f.Button,{type:"button",variant:"outline",onClick:()=>L(!1),disabled:m,className:"h-11 border border-slate-600 bg-slate-900 text-slate-100 transition-colors hover:bg-slate-800 hover:text-white",children:"Cancel"}),(0,b.jsx)(f.Button,{type:"button",onClick:()=>{let a=[...r,...t],b=n.trim();A&&E?b=E.display_name||E.email||"Direct Message":b||(b="Untitled conversation");let c=D?"investor":"internal",d=A?"dm":"group";console.log("[NewConversationDialog] Submitting:",{mode:i,subject:b,participantIds:a,totalParticipants:a.length,visibility:c,type:d}),j({subject:b,participantIds:a,visibility:c,type:d,initialMessage:p.trim()||void 0})},disabled:m||!M||B&&!n.trim(),className:"h-11 bg-blue-600 px-8 text-base font-semibold text-white shadow-[0_8px_16px_rgba(37,99,235,0.35)] transition-colors hover:bg-blue-500",children:m?"Creating…":A?"Start Conversation":"Create Group"})]})]})})})}let z={visibility:"all",type:"all"};function A({initialConversations:a,currentUserId:e,canCreateConversation:f=!0}){let g=(0,c.useMemo)(()=>(0,t.createClient)(),[]),[h,i]=(0,c.useState)(z),[j,k]=(0,c.useState)(a),[l,m]=(0,c.useState)(!1),[n,o]=(0,c.useState)(a[0]?.id||null),[p,q]=(0,c.useState)(null),[v,w]=(0,c.useState)(!1),[x,A]=(0,c.useState)("dm"),[B,C]=(0,c.useState)([]),[D,E]=(0,c.useState)([]),[F,G]=(0,c.useState)(!1),H=(0,c.useRef)(n);H.current=n,console.log("[MessagingClient] Initial conversations:",a.length),console.log("[MessagingClient] Current conversations state:",j.length),console.log("[MessagingClient] Filters:",h);let I=j.find(a=>a.id===n)||null,J=(0,c.useCallback)(async(a,b=!1)=>{console.log("[MessagingClient] loadConversations called with filters:",a||h,"silent:",b),b||m(!0),q(null);try{let b=a||h,{conversations:c}=await (0,d.fetchConversationsClient)({...b,includeMessages:!0,limit:50});console.log("[MessagingClient] Fetched conversations:",c.length),k(c),c.length>0&&!n&&o(c[0].id)}catch(a){console.error("[MessagingClient] Load conversations error",a),q(a.message||"Failed to load conversations")}finally{b||m(!1)}},[h,n]),K=(0,c.useCallback)(a=>{i(a),J(a)},[J]),L=(0,c.useCallback)(()=>{J(h)},[J,h]),M=(0,c.useCallback)(a=>{o(a),k(b=>b.map(b=>b.id===a?{...b,unreadCount:0}:b)),(0,d.markConversationRead)(a).catch(console.error)},[]);(0,c.useEffect)(()=>{console.log("[Staff Messages] Setting up realtime subscription");let a=g.channel("staff_conversations_all").on("postgres_changes",{event:"INSERT",schema:"public",table:"conversations"},()=>{console.log("[Realtime] New conversation created, refreshing list"),(0,d.fetchConversationsClient)({...h,includeMessages:!0,limit:50}).then(({conversations:a})=>{k(a)}).catch(console.error)}).on("postgres_changes",{event:"INSERT",schema:"public",table:"messages"},a=>{let b=a.new?.conversation_id;b&&b!==H.current&&(console.log("[Realtime] New message in background conversation, refreshing list"),(0,d.fetchConversationsClient)({...h,includeMessages:!0,limit:50}).then(({conversations:a})=>{k(a)}).catch(console.error))}).subscribe(a=>{console.log("[Realtime] Subscription status:",a)});return()=>{console.log("[Staff Messages] Cleaning up realtime subscription"),g.removeChannel(a)}},[g,h]);let N=(0,c.useCallback)(a=>{u.toast.error(a)},[]),O=(0,c.useCallback)(a=>{console.log("[MessagingClient] Deleting conversation:",a),k(b=>b.filter(b=>b.id!==a)),o(null),u.toast.success("Conversation deleted")},[]);(0,c.useEffect)(()=>{f?(async()=>{try{console.log("[MessagingClient] Loading staff and investor directories...");let[a,b]=await Promise.all([fetch("/api/staff/available"),fetch("/api/investors/available")]);if(a.ok){let b=await a.json();console.log("[MessagingClient] Staff directory loaded:",b.staff?.length||0,"members"),C(b.staff||[])}else console.error("[MessagingClient] Staff fetch failed:",a.status);if(b.ok){let a=await b.json();console.log("[MessagingClient] Investor directory loaded:",a.investors?.length||0,"investors"),console.log("[MessagingClient] Sample investor:",a.investors?.[0]),E(a.investors||[])}else console.error("[MessagingClient] Investor fetch failed:",b.status)}catch(a){console.error("[MessagingClient] Failed to load directories",a)}})():console.log("[MessagingClient] Skipping directory load - user cannot create conversations")},[f]);let P=async a=>{let b=Array.from(new Set(a.participantIds));if(console.log("[MessagingClient] Creating conversation:",{subject:a.subject,participants:b.length,type:a.type,visibility:a.visibility}),!b.length)return void u.toast.error("Select at least one participant");G(!0);try{let c={subject:a.subject,participant_ids:b,type:a.type,visibility:"all"===a.visibility?"internal":a.visibility,initial_message:a.initialMessage};console.log("[MessagingClient] Request payload:",c);let d=await fetch("/api/conversations",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(c)});if(!d.ok){let a=await d.json().catch(()=>null);throw console.error("[MessagingClient] Create conversation error:",a),Error(a?.error||"Failed to create conversation")}let e=await d.json();console.log("[MessagingClient] Conversation created:",e),u.toast.success("Conversation created successfully!"),w(!1),await J(h),e?.conversation?.id&&o(e.conversation.id)}catch(a){console.error("[MessagingClient] Create conversation failed:",a),u.toast.error(a.message||"Unable to create conversation")}finally{G(!1)}};return(0,b.jsxs)("div",{className:"flex h-[calc(100vh-4rem)] overflow-hidden",children:[(0,b.jsx)(r,{conversations:j,filters:h,onFiltersChange:K,onRefresh:L,onSelectConversation:M,onCreateConversation:a=>{A(a),w(!0)},activeConversationId:n,isLoading:l,errorMessage:p,canCreateConversation:f}),(0,b.jsx)("div",{className:"flex-1 flex flex-col",children:I?(0,b.jsx)(s.ConversationView,{conversation:I,currentUserId:e,onRead:()=>(0,d.markConversationRead)(I.id),onError:N,onDelete:O},I.id):(0,b.jsx)("div",{className:"flex items-center justify-center h-full text-muted-foreground",children:"Select a conversation to get started"})}),f&&(0,b.jsx)(y,{open:v,onOpenChange:w,mode:x,staffDirectory:B,investorDirectory:D,onCreate:P,isSubmitting:F})]})}a.s(["MessagingClient",()=>A],509706)}];

//# sourceMappingURL=versotech-portal_src_components_messaging_staff_messaging-client_tsx_cdee5aeb._.js.map