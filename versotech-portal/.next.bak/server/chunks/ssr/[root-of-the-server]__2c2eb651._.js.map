{"version":3,"sources":["../../../../../versotech-portal/src/app/%28main%29/versotech_main/introducer-agreements/%5Bid%5D/agreement-detail-client.tsx/__nextjs-internal-proxy.mjs","../../../../../versotech-portal/src/app/%28main%29/versotech_main/introducer-agreements/%5Bid%5D/page.tsx"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport const AgreementDetailClient = registerClientReference(\n    function() { throw new Error(\"Attempted to call AgreementDetailClient() from the server but AgreementDetailClient is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/versotech-portal/src/app/(main)/versotech_main/introducer-agreements/[id]/agreement-detail-client.tsx\",\n    \"AgreementDetailClient\",\n);\n","import { createClient } from '@/lib/supabase/server'\r\nimport { notFound, redirect } from 'next/navigation'\r\nimport { AgreementDetailClient } from './agreement-detail-client'\r\n\r\ntype PageProps = {\r\n  params: Promise<{ id: string }>\r\n}\r\n\r\nexport default async function AgreementDetailPage({ params }: PageProps) {\r\n  const { id } = await params\r\n  const supabase = await createClient()\r\n\r\n  const {\r\n    data: { user },\r\n  } = await supabase.auth.getUser()\r\n\r\n  if (!user) {\r\n    redirect('/auth/login')\r\n  }\r\n\r\n  // Fetch agreement with introducer details\r\n  const { data: agreement, error } = await supabase\r\n    .from('introducer_agreements')\r\n    .select(`\r\n      *,\r\n      introducer:introducer_id (\r\n        id,\r\n        legal_name,\r\n        contact_name,\r\n        email,\r\n        status,\r\n        logo_url\r\n      ),\r\n      ceo_signature_request:ceo_signature_request_id (\r\n        id,\r\n        status,\r\n        signer_name,\r\n        signer_email,\r\n        signature_timestamp,\r\n        signed_pdf_path\r\n      ),\r\n      introducer_signature_request:introducer_signature_request_id (\r\n        id,\r\n        status,\r\n        signer_name,\r\n        signer_email,\r\n        signature_timestamp,\r\n        signed_pdf_path\r\n      )\r\n    `)\r\n    .eq('id', id)\r\n    .single()\r\n\r\n  if (error || !agreement) {\r\n    notFound()\r\n  }\r\n\r\n  // Check if user has access (is staff or the introducer)\r\n  const role = user.user_metadata?.role || user.role\r\n  const isStaff = role?.startsWith('staff_')\r\n\r\n  if (!isStaff) {\r\n    // Check if user is linked to this introducer\r\n    const { data: introducerUser } = await supabase\r\n      .from('introducer_users')\r\n      .select('introducer_id')\r\n      .eq('user_id', user.id)\r\n      .single()\r\n\r\n    if (!introducerUser || introducerUser.introducer_id !== agreement.introducer_id) {\r\n      notFound()\r\n    }\r\n  }\r\n\r\n  return (\r\n    <AgreementDetailClient\r\n      agreement={agreement}\r\n      isStaff={isStaff}\r\n      currentUserId={user.id}\r\n    />\r\n  )\r\n}\r\n"],"names":[],"mappings":"iZAEO,IAAM,EAAwB,CAAA,EAAA,AADrC,EAAA,CAAA,CAAA,QACqC,uBAAA,AAAuB,EACxD,WAAa,MAAM,AAAI,MAAM,wPAA0P,EACvR,sIACA,uFAHG,IAAM,EAAwB,CAAA,EAAA,AADrC,EAAA,CAAA,CAAA,QACqC,uBAAA,AAAuB,EACxD,WAAa,MAAM,AAAI,MAAM,wPAA0P,EACvR,kHACA,kICLJ,EAAA,EAAA,CAAA,CAAA,QACA,EAAA,CAAA,CAAA,QAAA,IAAA,EAAA,EAAA,CAAA,CAAA,QACA,EAAA,EAAA,CAAA,CAAA,QAMe,eAAe,EAAoB,QAAE,CAAM,CAAa,EACrE,GAAM,IAAE,CAAE,CAAE,CAAG,MAAM,EACf,EAAW,MAAM,CAAA,EAAA,EAAA,YAAA,AAAY,IAE7B,CACJ,KAAM,MAAE,CAAI,CAAE,CACf,CAAG,MAAM,EAAS,IAAI,CAAC,OAAO,EAE3B,CAAC,GACH,CAAA,EADS,AACT,EAAA,QAAA,AAAQ,EAAC,eAIX,GAAM,CAAE,KAAM,CAAS,OAAE,CAAK,CAAE,CAAG,MAAM,EACtC,IAAI,CAAC,yBACL,MAAM,CAAC,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;IA0BT,CAAC,EACA,EAAE,CAAC,KAAM,GACT,MAAM,IAEL,GAAS,CAAC,CAAA,GAAW,AACvB,CAAA,EAAA,EAAA,QAAA,AAAQ,IAIV,IAAM,EAAO,EAAK,aAAa,EAAE,MAAQ,EAAK,IAAI,CAC5C,EAAU,GAAM,WAAW,UAEjC,GAAI,CAAC,EAAS,CAEZ,GAAM,CAAE,KAAM,CAAc,CAAE,CAAG,MAAM,EACpC,IAAI,CAAC,oBACL,MAAM,CAAC,iBACP,EAAE,CAAC,UAAW,EAAK,EAAE,EACrB,MAAM,EAEL,CAAC,GAAkB,EAAe,aAAa,GAAK,EAAU,aAAa,EAAE,AAC/E,CAAA,EAAA,EAAA,QAAA,AAAQ,GAEZ,CAEA,MACE,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,qBAAqB,CAAA,CACpB,UAAW,EACX,QAAS,EACT,cAAe,EAAK,EAAE,EAG5B","ignoreList":[0]}