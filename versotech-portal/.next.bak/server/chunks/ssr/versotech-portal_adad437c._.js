module.exports=[243085,a=>{"use strict";a.i(483696);var b=a.i(263360),c=a.i(621599);a.i(937413);var d=a.i(131360);let e=["staff_admin","staff_ops","staff_rm","ceo"],f=async()=>{let a=await (0,c.cookies)();return(0,b.createServerClient)("https://ipguxdssecfexudnvtia.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlwZ3V4ZHNzZWNmZXh1ZG52dGlhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTgzNjE4MzcsImV4cCI6MjA3MzkzNzgzN30.AGxM_YW9hfxuu7xDpi_4xhOoRhYM7iGTS1vJ0z2FByE",{cookies:{getAll:()=>a.getAll(),setAll(b){try{b.forEach(({name:b,value:c,options:d})=>a.set(b,c,d))}catch{}}}})};async function g(){try{let a=await f(),{data:{user:b},error:c}=await a.auth.getUser();if(c||!b)return null;let{data:d,error:g}=await a.from("profiles").select("*").eq("id",b.id).single();if(g||!d)return console.error("[auth] Profile not found for user:",b.id,g),null;let h=[];if(e.includes(d.role)){let{data:c}=await a.from("staff_permissions").select("permission").eq("user_id",b.id);h=c?.map(a=>a.permission)||[]}return{id:d.id,email:d.email,displayName:d.display_name||d.email?.split("@")[0]||"User",avatar:d.avatar_url,role:d.role,title:d.title,created_at:d.created_at,permissions:h}}catch(a){return console.error("Error getting current user:",a),null}}async function h(){let a=await g();return a?console.log("[auth] Profile retrieved:",a.email,a.role):console.log("[auth] No profile found"),a}async function i(a){let b=await g();if(b||(0,d.redirect)("/versotech_main/login"),a&&!a.includes(b.role))throw Error("Insufficient permissions");return b}async function j(){let a=await g();if(a||(0,d.redirect)("/versotech_main/login"),"investor"!==a.role)throw Error("Investor access required");return a}async function k(){let a=await g();if(a||(0,d.redirect)("/versotech_main/login"),!e.includes(a.role))throw Error("Staff access required");return a}async function l(a){let b=await f(),{data:c,error:d}=await b.from("profiles").select("role").eq("id",a).single();if(!d&&c&&e.includes(c.role))return!0;let{data:g}=await b.rpc("get_user_personas",{p_user_id:a});return g?.some(a=>"staff"===a.persona_type||"ceo"===a.persona_type)||!1}a.s(["checkStaffAccess",()=>l,"getCurrentUser",()=>g,"getProfile",()=>h,"requireAuth",()=>i,"requireInvestorAuth",()=>j,"requireStaffAuth",()=>k])},636373,a=>{"use strict";a.s(["PersonaProvider",()=>c,"getNavItemsForPersona",()=>d,"usePersona",()=>e]);var b=a.i(578644);let c=(0,b.registerClientReference)(function(){throw Error("Attempted to call PersonaProvider() from the server but PersonaProvider is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/versotech-portal/src/contexts/persona-context.tsx <module evaluation>","PersonaProvider"),d=(0,b.registerClientReference)(function(){throw Error("Attempted to call getNavItemsForPersona() from the server but getNavItemsForPersona is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/versotech-portal/src/contexts/persona-context.tsx <module evaluation>","getNavItemsForPersona"),e=(0,b.registerClientReference)(function(){throw Error("Attempted to call usePersona() from the server but usePersona is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/versotech-portal/src/contexts/persona-context.tsx <module evaluation>","usePersona")},685298,a=>{"use strict";a.s(["PersonaProvider",()=>c,"getNavItemsForPersona",()=>d,"usePersona",()=>e]);var b=a.i(578644);let c=(0,b.registerClientReference)(function(){throw Error("Attempted to call PersonaProvider() from the server but PersonaProvider is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/versotech-portal/src/contexts/persona-context.tsx","PersonaProvider"),d=(0,b.registerClientReference)(function(){throw Error("Attempted to call getNavItemsForPersona() from the server but getNavItemsForPersona is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/versotech-portal/src/contexts/persona-context.tsx","getNavItemsForPersona"),e=(0,b.registerClientReference)(function(){throw Error("Attempted to call usePersona() from the server but usePersona is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/versotech-portal/src/contexts/persona-context.tsx","usePersona")},604168,a=>{"use strict";a.i(636373);var b=a.i(685298);a.n(b)},22757,a=>{"use strict";a.s(["UnifiedAppLayout",()=>b]);let b=(0,a.i(578644).registerClientReference)(function(){throw Error("Attempted to call UnifiedAppLayout() from the server but UnifiedAppLayout is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/versotech-portal/src/components/layout/unified-app-layout.tsx <module evaluation>","UnifiedAppLayout")},244454,a=>{"use strict";a.s(["UnifiedAppLayout",()=>b]);let b=(0,a.i(578644).registerClientReference)(function(){throw Error("Attempted to call UnifiedAppLayout() from the server but UnifiedAppLayout is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/versotech-portal/src/components/layout/unified-app-layout.tsx","UnifiedAppLayout")},457722,a=>{"use strict";a.i(22757);var b=a.i(244454);a.n(b)},876349,a=>{"use strict";a.s(["ProxyModeProvider",()=>c,"useProxyMode",()=>d]);var b=a.i(578644);let c=(0,b.registerClientReference)(function(){throw Error("Attempted to call ProxyModeProvider() from the server but ProxyModeProvider is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/versotech-portal/src/components/commercial-partner/proxy-mode-context.tsx <module evaluation>","ProxyModeProvider"),d=(0,b.registerClientReference)(function(){throw Error("Attempted to call useProxyMode() from the server but useProxyMode is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/versotech-portal/src/components/commercial-partner/proxy-mode-context.tsx <module evaluation>","useProxyMode")},975452,a=>{"use strict";a.s(["ProxyModeProvider",()=>c,"useProxyMode",()=>d]);var b=a.i(578644);let c=(0,b.registerClientReference)(function(){throw Error("Attempted to call ProxyModeProvider() from the server but ProxyModeProvider is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/versotech-portal/src/components/commercial-partner/proxy-mode-context.tsx","ProxyModeProvider"),d=(0,b.registerClientReference)(function(){throw Error("Attempted to call useProxyMode() from the server but useProxyMode is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/versotech-portal/src/components/commercial-partner/proxy-mode-context.tsx","useProxyMode")},187544,a=>{"use strict";a.i(876349);var b=a.i(975452);a.n(b)},708443,a=>{"use strict";a.s(["ProxyModeBanner",()=>b]);let b=(0,a.i(578644).registerClientReference)(function(){throw Error("Attempted to call ProxyModeBanner() from the server but ProxyModeBanner is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/versotech-portal/src/components/commercial-partner/proxy-mode-banner.tsx <module evaluation>","ProxyModeBanner")},942420,a=>{"use strict";a.s(["ProxyModeBanner",()=>b]);let b=(0,a.i(578644).registerClientReference)(function(){throw Error("Attempted to call ProxyModeBanner() from the server but ProxyModeBanner is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/versotech-portal/src/components/commercial-partner/proxy-mode-banner.tsx","ProxyModeBanner")},546648,a=>{"use strict";a.i(708443);var b=a.i(942420);a.n(b)},294490,a=>{"use strict";a.s(["PlatformTour",()=>b]);let b=(0,a.i(578644).registerClientReference)(function(){throw Error("Attempted to call PlatformTour() from the server but PlatformTour is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/versotech-portal/src/components/tour/platform-tour.tsx <module evaluation>","PlatformTour")},525359,a=>{"use strict";a.s(["PlatformTour",()=>b]);let b=(0,a.i(578644).registerClientReference)(function(){throw Error("Attempted to call PlatformTour() from the server but PlatformTour is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/versotech-portal/src/components/tour/platform-tour.tsx","PlatformTour")},697194,a=>{"use strict";a.i(294490);var b=a.i(525359);a.n(b)},47512,a=>{"use strict";a.s(["TourSpotlight",()=>b]);let b=(0,a.i(578644).registerClientReference)(function(){throw Error("Attempted to call TourSpotlight() from the server but TourSpotlight is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/versotech-portal/src/components/tour/tour-spotlight.tsx <module evaluation>","TourSpotlight")},638236,a=>{"use strict";a.s(["TourSpotlight",()=>b]);let b=(0,a.i(578644).registerClientReference)(function(){throw Error("Attempted to call TourSpotlight() from the server but TourSpotlight is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/versotech-portal/src/components/tour/tour-spotlight.tsx","TourSpotlight")},433466,a=>{"use strict";a.i(47512);var b=a.i(638236);a.n(b)},143932,a=>{"use strict";a.s(["TourTooltip",()=>b]);let b=(0,a.i(578644).registerClientReference)(function(){throw Error("Attempted to call TourTooltip() from the server but TourTooltip is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/versotech-portal/src/components/tour/tour-tooltip.tsx <module evaluation>","TourTooltip")},896969,a=>{"use strict";a.s(["TourTooltip",()=>b]);let b=(0,a.i(578644).registerClientReference)(function(){throw Error("Attempted to call TourTooltip() from the server but TourTooltip is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/versotech-portal/src/components/tour/tour-tooltip.tsx","TourTooltip")},133179,a=>{"use strict";a.i(143932);var b=a.i(896969);a.n(b)},180330,a=>{"use strict";a.s(["TourRestartButton",()=>c,"TourWelcomeModal",()=>d]);var b=a.i(578644);let c=(0,b.registerClientReference)(function(){throw Error("Attempted to call TourRestartButton() from the server but TourRestartButton is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/versotech-portal/src/components/tour/tour-welcome-modal.tsx <module evaluation>","TourRestartButton"),d=(0,b.registerClientReference)(function(){throw Error("Attempted to call TourWelcomeModal() from the server but TourWelcomeModal is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/versotech-portal/src/components/tour/tour-welcome-modal.tsx <module evaluation>","TourWelcomeModal")},747811,a=>{"use strict";a.s(["TourRestartButton",()=>c,"TourWelcomeModal",()=>d]);var b=a.i(578644);let c=(0,b.registerClientReference)(function(){throw Error("Attempted to call TourRestartButton() from the server but TourRestartButton is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/versotech-portal/src/components/tour/tour-welcome-modal.tsx","TourRestartButton"),d=(0,b.registerClientReference)(function(){throw Error("Attempted to call TourWelcomeModal() from the server but TourWelcomeModal is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/versotech-portal/src/components/tour/tour-welcome-modal.tsx","TourWelcomeModal")},876466,a=>{"use strict";a.i(180330);var b=a.i(747811);a.n(b)},933743,a=>{"use strict";var b=a.i(714898),c=a.i(243085);a.i(937413);var d=a.i(131360),e=a.i(198307),f=a.i(604168),g=a.i(457722),h=a.i(187544),i=a.i(546648),j=a.i(697194);async function k({children:a}){let k=await (0,c.getProfile)();k||(0,d.redirect)("/versotech_main/login");let l=await (0,e.createClient)(),{data:m,error:n}=await l.rpc("get_user_personas",{p_user_id:k.id});n&&console.error("[UnifiedPortalLayout] Error fetching personas:",n);let o=m||[],{data:p}=await l.from("profiles").select("has_completed_platform_tour").eq("id",k.id).single();if(0===o.length)if(["staff_admin","staff_ops","staff_rm","ceo"].includes(k.role)){let a="ceo"===k.role||"staff_admin"===k.role?"ceo":"staff";o=[{persona_type:a,entity_id:"internal",entity_name:"VERSO Staff",entity_logo_url:null,role_in_entity:k.role,is_primary:!0,can_sign:"ceo"===k.role||"staff_admin"===k.role,can_execute_for_clients:!1}],console.log("[UnifiedPortalLayout] Created synthetic persona for:",k.email,k.role,"â†’",a)}else console.warn("[UnifiedPortalLayout] User has no personas:",k.email),(0,d.redirect)("/versotech_main/login?error=no_personas");let q={ceo:1,staff:2,arranger:3,introducer:4,partner:5,commercial_partner:6,lawyer:7,investor:8},r=o.length>0?o.reduce((a,b)=>{let c=q[a.persona_type]??99;return(q[b.persona_type]??99)<c?b:a}).persona_type:"investor";if("investor"===r){let a=o.find(a=>"investor"===a.persona_type);if(a){let{data:b}=await l.from("investors").select("type").eq("id",a.entity_id).maybeSingle();r=b?.type==="entity"?"investor_entity":"investor_individual"}}return(0,b.jsx)(f.PersonaProvider,{initialPersonas:o,children:(0,b.jsxs)(h.ProxyModeProvider,{children:[(0,b.jsx)(i.ProxyModeBanner,{}),(0,b.jsx)(j.PlatformTour,{activePersona:r,hasCompletedTour:p?.has_completed_platform_tour??!1,children:(0,b.jsx)(g.UnifiedAppLayout,{profile:k,children:a})})]})})}a.i(433466),a.i(133179),a.i(876466),a.s(["default",()=>k,"dynamic",0,"force-dynamic"],933743)},361481,a=>{a.v(a=>Promise.resolve().then(()=>a(389018)))}];

//# sourceMappingURL=versotech-portal_adad437c._.js.map