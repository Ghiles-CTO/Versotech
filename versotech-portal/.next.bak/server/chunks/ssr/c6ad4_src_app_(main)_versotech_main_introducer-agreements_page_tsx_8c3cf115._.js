module.exports=[269214,a=>{"use strict";var b=a.i(352584),c=a.i(611038),d=a.i(284169),e=a.i(15788),f=a.i(421908),g=a.i(663475),h=a.i(951870),i=a.i(771088),j=a.i(816854),k=a.i(42329),l=a.i(399580),m=a.i(487068),n=a.i(3321),o=a.i(877918),p=a.i(203297),q=a.i(724070),r=a.i(318525),s=a.i(438436),t=a.i(838086),u=a.i(446803),v=a.i(899750),w=a.i(888987),x=a.i(201986),y=a.i(58834),z=a.i(289633);let A={draft:{className:"bg-slate-100 text-slate-700 border-slate-200 dark:bg-slate-800 dark:text-slate-300 dark:border-slate-700",label:"Draft"},sent:{className:"bg-sky-100 text-sky-700 border-sky-200 dark:bg-sky-900/50 dark:text-sky-300 dark:border-sky-800",label:"Sent"},pending_approval:{className:"bg-amber-100 text-amber-700 border-amber-200 dark:bg-amber-900/50 dark:text-amber-300 dark:border-amber-800",label:"Pending Approval"},approved:{className:"bg-teal-100 text-teal-700 border-teal-200 dark:bg-teal-900/50 dark:text-teal-300 dark:border-teal-800",label:"Approved"},pending_ceo_signature:{className:"bg-indigo-100 text-indigo-700 border-indigo-200 dark:bg-indigo-900/50 dark:text-indigo-300 dark:border-indigo-800",label:"Awaiting CEO"},pending_introducer_signature:{className:"bg-violet-100 text-violet-700 border-violet-200 dark:bg-violet-900/50 dark:text-violet-300 dark:border-violet-800",label:"Awaiting Introducer"},active:{className:"bg-emerald-100 text-emerald-700 border-emerald-200 dark:bg-emerald-900/50 dark:text-emerald-300 dark:border-emerald-800",label:"Active"},rejected:{className:"bg-rose-100 text-rose-700 border-rose-200 dark:bg-rose-900/50 dark:text-rose-300 dark:border-rose-800",label:"Rejected"},expired:{className:"bg-orange-100 text-orange-700 border-orange-200 dark:bg-orange-900/50 dark:text-orange-300 dark:border-orange-800",label:"Expired"},terminated:{className:"bg-red-100 text-red-700 border-red-200 dark:bg-red-900/50 dark:text-red-300 dark:border-red-800",label:"Terminated"}},B=[{label:"All Agreements",value:"all",group:null},{label:"Draft",value:"draft",group:"In Progress"},{label:"Sent",value:"sent",group:"In Progress"},{label:"Pending Approval",value:"pending_approval",group:"In Progress"},{label:"Approved",value:"approved",group:"In Progress"},{label:"Awaiting CEO Signature",value:"pending_ceo_signature",group:"Signatures"},{label:"Awaiting Introducer Signature",value:"pending_introducer_signature",group:"Signatures"},{label:"Active",value:"active",group:"Final"},{label:"Rejected",value:"rejected",group:"Final"},{label:"Expired",value:"expired",group:"Final"},{label:"Terminated",value:"terminated",group:"Final"}],C={referral:"Referral Agreement",revenue_share:"Revenue Share",fixed_fee:"Fixed Fee",hybrid:"Hybrid"};function D(){let a=(0,z.useRouter)(),[D,E]=(0,c.useState)(null),[F,G]=(0,c.useState)([]),[H,I]=(0,c.useState)({totalAgreements:0,activeAgreements:0,pendingAgreements:0,expiringSoon:0}),[J,K]=(0,c.useState)(!0),[L,M]=(0,c.useState)(null),[N,O]=(0,c.useState)(""),[P,Q]=(0,c.useState)("all"),[R,S]=(0,c.useState)(null),T=async(a,b,c)=>{a.stopPropagation(),S(b);try{let a=await fetch(`/api/storage/download?path=${encodeURIComponent(b)}&bucket=deal-documents`);if(!a.ok)throw Error("Failed to download file");let d=await a.blob(),e=window.URL.createObjectURL(d),f=document.createElement("a");f.href=e,f.download=b.split("/").pop()||`${c||"Fee_Agreement"}.pdf`,document.body.appendChild(f),f.click(),document.body.removeChild(f),window.URL.revokeObjectURL(e),v.toast.success("PDF downloaded successfully")}catch(a){console.error("Error downloading PDF:",a),v.toast.error("Failed to download PDF")}finally{S(null)}};function U(a){if(!a)return!1;let b=new Date,c=new Date(a),d=new Date(b.getTime()+2592e6);return c>b&&c<=d}function V(a){return`${(a/100).toFixed(2)}%`}(0,c.useEffect)(()=>{async function a(a){let{data:c,error:d}=await a.from("introducer_agreements").select(`
          *,
          introducer:introducer_id (
            id,
            legal_name,
            status
          )
        `).order("created_at",{ascending:!1}).limit(100);if(d)throw d;b(c||[])}function b(a){let b=new Date,c=new Date(b.getTime()+2592e6),d=a.map(a=>({id:a.id,agreement_type:a.agreement_type||"referral",signed_date:a.signed_date,effective_date:a.effective_date,expiry_date:a.expiry_date,default_commission_bps:a.default_commission_bps||0,commission_cap_amount:a.commission_cap_amount,payment_terms:a.payment_terms,territory:a.territory,deal_types:a.deal_types,exclusivity_level:a.exclusivity_level,status:a.status||"draft",created_at:a.created_at,pdf_url:a.pdf_url||null,reference_number:a.reference_number||null}));G(d);let e=d.filter(a=>"active"===a.status).length,f=["draft","sent","pending_approval","approved","pending_ceo_signature","pending_introducer_signature"],g=d.filter(a=>f.includes(a.status)).length,h=d.filter(a=>{if(!a.expiry_date)return!1;let d=new Date(a.expiry_date);return d>b&&d<=c&&"active"===a.status}).length;I({totalAgreements:d.length,activeAgreements:e,pendingAgreements:g,expiringSoon:h})}!async function(){try{K(!0);let c=(0,y.createClient)(),{data:{user:d}}=await c.auth.getUser();if(!d)return void M("Not authenticated");let{data:e,error:f}=await c.from("introducer_users").select("introducer_id").eq("user_id",d.id).single();if(f||!e)return void await a(c);let{data:g,error:h}=await c.from("introducers").select("id, legal_name, status, default_commission_bps, logo_url").eq("id",e.introducer_id).single();if(h)throw h;E(g);let{data:i,error:j}=await c.from("introducer_agreements").select("*").eq("introducer_id",e.introducer_id).order("created_at",{ascending:!1});if(j)throw j;b(i||[]),M(null)}catch(a){console.error("[IntroducerAgreementsPage] Error:",a),M(a instanceof Error?a.message:"Failed to load agreements")}finally{K(!1)}}()},[]);let W=F.filter(a=>{let b="all"===P||a.status===P,c=!N||a.agreement_type?.toLowerCase().includes(N.toLowerCase())||a.territory?.toLowerCase().includes(N.toLowerCase());return b&&c});return J?(0,b.jsxs)("div",{className:"flex items-center justify-center py-16",children:[(0,b.jsx)(n.Loader2,{className:"h-8 w-8 animate-spin text-muted-foreground"}),(0,b.jsx)("span",{className:"ml-3 text-muted-foreground",children:"Loading agreements..."})]}):L?(0,b.jsxs)("div",{className:"text-center py-16",children:[(0,b.jsx)(o.AlertCircle,{className:"h-12 w-12 text-destructive mx-auto mb-4"}),(0,b.jsx)("h3",{className:"text-lg font-medium text-foreground mb-2",children:"Error Loading Agreements"}),(0,b.jsx)("p",{className:"text-muted-foreground",children:L})]}):(0,b.jsxs)("div",{className:"p-6 space-y-6",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-2xl font-bold text-foreground",children:"Fee Agreements"}),(0,b.jsx)("p",{className:"text-muted-foreground mt-1",children:D?`Manage your commission agreements as ${D.legal_name}`:"View and manage all introducer agreements"})]}),D&&D.default_commission_bps&&(0,b.jsxs)(e.Badge,{variant:"outline",className:"text-sm",children:["Default: ",V(D.default_commission_bps)]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,b.jsxs)(d.Card,{className:"relative overflow-hidden group hover:shadow-md transition-shadow",children:[(0,b.jsx)("div",{className:"absolute inset-0 bg-gradient-to-br from-slate-500/5 to-slate-600/5 opacity-0 group-hover:opacity-100 transition-opacity"}),(0,b.jsx)(d.CardHeader,{className:"pb-2",children:(0,b.jsxs)(d.CardTitle,{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[(0,b.jsx)("div",{className:"p-1.5 rounded-lg bg-slate-100 dark:bg-slate-800",children:(0,b.jsx)(j.FileText,{className:"h-3.5 w-3.5 text-slate-600 dark:text-slate-400"})}),"Total Agreements"]})}),(0,b.jsxs)(d.CardContent,{children:[(0,b.jsx)("div",{className:"text-3xl font-bold tracking-tight",children:H.totalAgreements}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"All fee arrangements"})]})]}),(0,b.jsxs)(d.Card,{className:"relative overflow-hidden group hover:shadow-md transition-shadow",children:[(0,b.jsx)("div",{className:"absolute inset-0 bg-gradient-to-br from-emerald-500/5 to-green-600/5 opacity-0 group-hover:opacity-100 transition-opacity"}),(0,b.jsx)(d.CardHeader,{className:"pb-2",children:(0,b.jsxs)(d.CardTitle,{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[(0,b.jsx)("div",{className:"p-1.5 rounded-lg bg-emerald-100 dark:bg-emerald-900/50",children:(0,b.jsx)(l.CheckCircle2,{className:"h-3.5 w-3.5 text-emerald-600 dark:text-emerald-400"})}),"Active"]})}),(0,b.jsxs)(d.CardContent,{children:[(0,b.jsx)("div",{className:"text-3xl font-bold tracking-tight text-emerald-600 dark:text-emerald-400",children:H.activeAgreements}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Currently in effect"})]})]}),(0,b.jsxs)(d.Card,{className:"relative overflow-hidden group hover:shadow-md transition-shadow",children:[(0,b.jsx)("div",{className:"absolute inset-0 bg-gradient-to-br from-amber-500/5 to-yellow-600/5 opacity-0 group-hover:opacity-100 transition-opacity"}),(0,b.jsx)(d.CardHeader,{className:"pb-2",children:(0,b.jsxs)(d.CardTitle,{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[(0,b.jsx)("div",{className:"p-1.5 rounded-lg bg-amber-100 dark:bg-amber-900/50",children:(0,b.jsx)(k.Clock,{className:"h-3.5 w-3.5 text-amber-600 dark:text-amber-400"})}),"In Progress"]})}),(0,b.jsxs)(d.CardContent,{children:[(0,b.jsx)("div",{className:"text-3xl font-bold tracking-tight text-amber-600 dark:text-amber-400",children:H.pendingAgreements}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Awaiting action"})]})]}),(0,b.jsxs)(d.Card,{className:"relative overflow-hidden group hover:shadow-md transition-shadow",children:[(0,b.jsx)("div",{className:"absolute inset-0 bg-gradient-to-br from-orange-500/5 to-red-600/5 opacity-0 group-hover:opacity-100 transition-opacity"}),(0,b.jsx)(d.CardHeader,{className:"pb-2",children:(0,b.jsxs)(d.CardTitle,{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[(0,b.jsx)("div",{className:"p-1.5 rounded-lg bg-orange-100 dark:bg-orange-900/50",children:(0,b.jsx)(t.AlertTriangle,{className:"h-3.5 w-3.5 text-orange-600 dark:text-orange-400"})}),"Expiring Soon"]})}),(0,b.jsxs)(d.CardContent,{children:[(0,b.jsx)("div",{className:"text-3xl font-bold tracking-tight text-orange-600 dark:text-orange-400",children:H.expiringSoon}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Within 30 days"})]})]})]}),(0,b.jsx)(d.Card,{children:(0,b.jsx)(d.CardContent,{className:"pt-6",children:(0,b.jsxs)("div",{className:"flex flex-col md:flex-row gap-4",children:[(0,b.jsx)("div",{className:"flex-1",children:(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)(m.Search,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),(0,b.jsx)(g.Input,{placeholder:"Search by type or territory...",value:N,onChange:a=>O(a.target.value),className:"pl-10"})]})}),(0,b.jsxs)(h.Select,{value:P,onValueChange:Q,children:[(0,b.jsx)(h.SelectTrigger,{className:"w-full md:w-56",children:(0,b.jsx)(h.SelectValue,{placeholder:"Filter by status"})}),(0,b.jsxs)(h.SelectContent,{children:[(0,b.jsx)(h.SelectItem,{value:"all",children:"All Agreements"}),(0,b.jsxs)(h.SelectGroup,{children:[(0,b.jsx)(h.SelectLabel,{className:"text-xs text-muted-foreground font-semibold px-2 py-1.5",children:"In Progress"}),B.filter(a=>"In Progress"===a.group).map(a=>(0,b.jsx)(h.SelectItem,{value:a.value,children:(0,b.jsxs)("span",{className:"flex items-center gap-2",children:[(0,b.jsx)("span",{className:(0,w.cn)("w-2 h-2 rounded-full","draft"===a.value&&"bg-slate-500","sent"===a.value&&"bg-sky-500","pending_approval"===a.value&&"bg-amber-500","approved"===a.value&&"bg-teal-500")}),a.label]})},a.value))]}),(0,b.jsxs)(h.SelectGroup,{children:[(0,b.jsx)(h.SelectLabel,{className:"text-xs text-muted-foreground font-semibold px-2 py-1.5",children:"Awaiting Signatures"}),B.filter(a=>"Signatures"===a.group).map(a=>(0,b.jsx)(h.SelectItem,{value:a.value,children:(0,b.jsxs)("span",{className:"flex items-center gap-2",children:[(0,b.jsx)("span",{className:(0,w.cn)("w-2 h-2 rounded-full","pending_ceo_signature"===a.value&&"bg-indigo-500","pending_introducer_signature"===a.value&&"bg-violet-500")}),a.label]})},a.value))]}),(0,b.jsxs)(h.SelectGroup,{children:[(0,b.jsx)(h.SelectLabel,{className:"text-xs text-muted-foreground font-semibold px-2 py-1.5",children:"Final States"}),B.filter(a=>"Final"===a.group).map(a=>(0,b.jsx)(h.SelectItem,{value:a.value,children:(0,b.jsxs)("span",{className:"flex items-center gap-2",children:[(0,b.jsx)("span",{className:(0,w.cn)("w-2 h-2 rounded-full","active"===a.value&&"bg-emerald-500","rejected"===a.value&&"bg-rose-500","expired"===a.value&&"bg-orange-500","terminated"===a.value&&"bg-red-500")}),a.label]})},a.value))]})]})]})]})})}),(0,b.jsxs)(d.Card,{children:[(0,b.jsxs)(d.CardHeader,{children:[(0,b.jsx)(d.CardTitle,{children:"Agreements"}),(0,b.jsxs)(d.CardDescription,{children:[W.length," agreement",1!==W.length?"s":""," found"]})]}),(0,b.jsx)(d.CardContent,{children:0===W.length?(0,b.jsxs)("div",{className:"border-2 border-dashed border-muted/50 rounded-xl py-16 flex flex-col items-center justify-center text-center space-y-4 bg-gradient-to-br from-muted/20 to-muted/5",children:[(0,b.jsx)("div",{className:"p-4 rounded-2xl bg-muted/30",children:(0,b.jsx)(p.FileSignature,{className:"h-12 w-12 text-muted-foreground/60"})}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("p",{className:"text-base font-medium text-muted-foreground",children:N||"all"!==P?"No agreements match your filters":D?"No fee agreements on file":"No introducer agreements found"}),D&&0===F.length&&(0,b.jsx)("p",{className:"text-sm text-muted-foreground/70 max-w-sm",children:"Contact your relationship manager to set up a fee agreement and start making introductions."}),(N||"all"!==P)&&(0,b.jsx)(f.Button,{variant:"ghost",size:"sm",className:"mt-2",onClick:()=>{O(""),Q("all")},children:"Clear filters"})]})]}):(0,b.jsx)("div",{className:"rounded-md border",children:(0,b.jsxs)(i.Table,{children:[(0,b.jsx)(i.TableHeader,{children:(0,b.jsxs)(i.TableRow,{children:[(0,b.jsx)(i.TableHead,{children:"Type"}),(0,b.jsx)(i.TableHead,{children:"Commission"}),(0,b.jsx)(i.TableHead,{children:"Territory"}),(0,b.jsx)(i.TableHead,{children:"Effective"}),(0,b.jsx)(i.TableHead,{children:"Expires"}),(0,b.jsx)(i.TableHead,{children:"Status"}),(0,b.jsx)(i.TableHead,{className:"w-12",children:"PDF"})]})}),(0,b.jsx)(i.TableBody,{children:W.map(c=>(0,b.jsxs)(i.TableRow,{className:"cursor-pointer hover:bg-muted/50 transition-colors duration-150 group",onClick:()=>a.push(`/versotech_main/introducer-agreements/${c.id}`),children:[(0,b.jsx)(i.TableCell,{children:(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(j.FileText,{className:"h-4 w-4 text-muted-foreground"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"font-medium",children:C[c.agreement_type]||c.agreement_type}),c.exclusivity_level&&(0,b.jsx)("div",{className:"text-xs text-muted-foreground capitalize",children:c.exclusivity_level})]})]})}),(0,b.jsxs)(i.TableCell,{children:[(0,b.jsxs)("div",{className:"flex items-center gap-1",children:[(0,b.jsx)(s.Percent,{className:"h-3 w-3 text-muted-foreground"}),(0,b.jsx)("span",{className:"font-medium",children:V(c.default_commission_bps)})]}),c.commission_cap_amount&&(0,b.jsxs)("div",{className:"text-xs text-muted-foreground",children:["Cap: $",c.commission_cap_amount.toLocaleString()]})]}),(0,b.jsxs)(i.TableCell,{children:[(0,b.jsxs)("div",{className:"flex items-center gap-1",children:[(0,b.jsx)(r.Globe,{className:"h-3 w-3 text-muted-foreground"}),(0,b.jsx)("span",{children:c.territory||"Global"})]}),c.deal_types&&c.deal_types.length>0&&(0,b.jsxs)("div",{className:"text-xs text-muted-foreground",children:[c.deal_types.slice(0,2).join(", "),c.deal_types.length>2&&` +${c.deal_types.length-2}`]})]}),(0,b.jsx)(i.TableCell,{children:(0,b.jsxs)("div",{className:"flex items-center gap-1",children:[(0,b.jsx)(q.Calendar,{className:"h-3 w-3 text-muted-foreground"}),(0,b.jsx)("span",{className:"text-sm",children:c.effective_date?(0,x.formatDate)(c.effective_date):"Not set"})]})}),(0,b.jsx)(i.TableCell,{children:(0,b.jsxs)("div",{className:(0,w.cn)("flex items-center gap-1",U(c.expiry_date)&&"text-orange-600"),children:[U(c.expiry_date)&&(0,b.jsx)(t.AlertTriangle,{className:"h-3 w-3"}),(0,b.jsx)("span",{className:"text-sm",children:c.expiry_date?(0,x.formatDate)(c.expiry_date):"No expiry"})]})}),(0,b.jsx)(i.TableCell,{children:(0,b.jsx)(e.Badge,{variant:"outline",className:(0,w.cn)("font-medium",(A[c.status]||A.draft).className),children:(A[c.status]||A.draft).label})}),(0,b.jsx)(i.TableCell,{children:c.pdf_url?(0,b.jsx)(f.Button,{variant:"ghost",size:"sm",onClick:a=>T(a,c.pdf_url,c.reference_number),disabled:R===c.pdf_url,className:"h-8 w-8 p-0 text-blue-500 hover:text-blue-400 hover:bg-blue-500/10",title:"Download PDF",children:R===c.pdf_url?(0,b.jsx)(n.Loader2,{className:"h-4 w-4 animate-spin"}):(0,b.jsx)(u.FileDown,{className:"h-4 w-4"})}):(0,b.jsx)("span",{className:"text-xs text-muted-foreground",children:"â€”"})})]},c.id))})]})})})]})]})}a.s(["default",()=>D])}];

//# sourceMappingURL=c6ad4_src_app_%28main%29_versotech_main_introducer-agreements_page_tsx_8c3cf115._.js.map