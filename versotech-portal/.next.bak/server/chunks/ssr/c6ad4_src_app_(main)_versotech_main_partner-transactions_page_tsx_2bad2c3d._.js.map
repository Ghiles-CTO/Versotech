{"version":3,"sources":["../../../../../versotech-portal/src/app/%28main%29/versotech_main/partner-transactions/page.tsx"],"sourcesContent":["'use client'\n\nimport { useEffect, useState } from 'react'\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card'\nimport { Badge } from '@/components/ui/badge'\nimport { Button } from '@/components/ui/button'\nimport { Input } from '@/components/ui/input'\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from '@/components/ui/select'\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from '@/components/ui/table'\nimport {\n  ArrowRightLeft,\n  Users,\n  DollarSign,\n  TrendingUp,\n  Search,\n  Loader2,\n  AlertCircle,\n  ExternalLink,\n  Building2,\n  Download,\n  Percent,\n} from 'lucide-react'\nimport { toast } from 'sonner'\nimport { cn } from '@/lib/utils'\nimport { formatCurrency, formatDate } from '@/lib/format'\nimport { createClient } from '@/lib/supabase/client'\nimport Link from 'next/link'\n\ntype PartnerTransaction = {\n  id: string\n  investor: {\n    id: string\n    legal_name: string\n  } | null\n  deal: {\n    id: string\n    name: string\n    company_name: string | null\n    status: string\n  } | null\n  subscription: {\n    id: string\n    commitment: number\n    currency: string\n    status: string\n    committed_at: string | null\n  } | null\n  referred_at: string | null\n  role: string\n  // PRD Row 72-76: Investor journey stage tracking\n  // PRD Row 73: \"Passed\" = investor declined/did not proceed\n  investorStage: 'dispatched' | 'interested' | 'passed' | 'approved' | 'signed' | 'funded'\n  interest_confirmed_at: string | null\n  // PRD Row 77: Partner fee model per deal\n  feeModel: {\n    rate_bps: number | null   // Basis points (e.g., 200 = 2%)\n    flat_amount: number | null\n    currency: string\n    kind: string | null       // 'referral', 'success', etc.\n  } | null\n}\n\ntype PartnerInfo = {\n  id: string\n  name: string\n  legal_name: string | null\n  partner_type: string\n  status: string\n}\n\ntype Summary = {\n  totalReferrals: number\n  convertedCount: number\n  pendingCount: number\n  totalCommitmentValue: number\n  currency: string\n}\n\ntype MembershipRow = {\n  // Note: deal_memberships has composite PK (deal_id, user_id), no 'id' column\n  role: string | null\n  dispatched_at: string | null\n  interest_confirmed_at: string | null // PRD Row 72\n  deal_id: string | null\n  investor_id: string | null\n  investor: { id: string; legal_name: string | null } | { id: string; legal_name: string | null }[] | null\n  deal: { id: string; name: string | null; company_name: string | null; status: string | null } |\n    { id: string; name: string | null; company_name: string | null; status: string | null }[] | null\n}\n\ntype SubscriptionRow = {\n  id: string\n  investor_id: string\n  deal_id: string\n  commitment: number | null\n  currency: string | null\n  status: string | null\n  committed_at: string | null\n  created_at: string | null\n}\n\nfunction normalizeJoin<T>(value: T | T[] | null): T | null {\n  if (!value) return null\n  return Array.isArray(value) ? value[0] || null : value\n}\n\nfunction getSubscriptionKey(investorId: string, dealId: string) {\n  return `${investorId}:${dealId}`\n}\n\nfunction getTimestamp(value: string | null | undefined): number {\n  if (!value) return 0\n  return new Date(value).getTime()\n}\n\nfunction buildSummary(transactions: PartnerTransaction[]): Summary {\n  const converted = transactions.filter(t =>\n    t.subscription?.status === 'committed' || t.subscription?.status === 'active'\n  ).length\n  const pending = transactions.filter(t => t.subscription?.status === 'pending').length\n\n  let totalValue = 0\n  for (const t of transactions) {\n    if (t.subscription && (t.subscription.status === 'committed' || t.subscription.status === 'active')) {\n      totalValue += t.subscription.commitment\n    }\n  }\n\n  const currency = transactions.find(t => t.subscription?.currency)?.subscription?.currency || 'USD'\n\n  return {\n    totalReferrals: transactions.length,\n    convertedCount: converted,\n    pendingCount: pending,\n    totalCommitmentValue: totalValue,\n    currency\n  }\n}\n\nconst STATUS_STYLES: Record<string, string> = {\n  active: 'bg-green-100 text-green-800 border-green-200',\n  committed: 'bg-blue-100 text-blue-800 border-blue-200',\n  pending: 'bg-yellow-100 text-yellow-800 border-yellow-200',\n  cancelled: 'bg-gray-100 text-gray-800 border-gray-200',\n}\n\nconst STATUS_FILTERS = [\n  { label: 'All Status', value: 'all' },\n  { label: 'Active', value: 'active' },\n  { label: 'Committed', value: 'committed' },\n  { label: 'Pending', value: 'pending' },\n  { label: 'Cancelled', value: 'cancelled' },\n]\n\n// PRD Rows 71-76: Investor journey stage filters for Partner\nconst INVESTOR_STAGE_FILTERS = [\n  { label: 'All Stages', value: 'all' },\n  { label: 'Dispatched', value: 'dispatched' },          // Row 71\n  { label: 'Interested', value: 'interested' },          // Row 72\n  { label: 'Passed', value: 'passed' },                  // Row 73 (investor declined)\n  { label: 'Approved (Pack)', value: 'approved' },       // Row 74 (subscription approved)\n  { label: 'Signed', value: 'signed' },                  // Row 75\n  { label: 'Funded', value: 'funded' },                  // Row 76\n]\n\nexport default function PartnerTransactionsPage() {\n  const [partnerInfo, setPartnerInfo] = useState<PartnerInfo | null>(null)\n  const [transactions, setTransactions] = useState<PartnerTransaction[]>([])\n  const [summary, setSummary] = useState<Summary>({\n    totalReferrals: 0,\n    convertedCount: 0,\n    pendingCount: 0,\n    totalCommitmentValue: 0,\n    currency: 'USD',\n  })\n  const [loading, setLoading] = useState(true)\n  const [error, setError] = useState<string | null>(null)\n  const [search, setSearch] = useState('')\n  const [statusFilter, setStatusFilter] = useState('all')\n  const [investorStageFilter, setInvestorStageFilter] = useState('all') // PRD Rows 72-76\n  const [exporting, setExporting] = useState(false)\n\n  const handleExport = async () => {\n    if (!partnerInfo) {\n      toast.error('Export is only available for partner users')\n      return\n    }\n\n    try {\n      setExporting(true)\n      const response = await fetch('/api/partners/me/transactions/export')\n\n      if (response.status === 429) {\n        toast.error('Please wait 1 minute between export requests')\n        return\n      }\n\n      if (!response.ok) {\n        const error = await response.json()\n        throw new Error(error.error || 'Export failed')\n      }\n\n      // Download the CSV\n      const blob = await response.blob()\n      const url = window.URL.createObjectURL(blob)\n      const a = document.createElement('a')\n      a.href = url\n      a.download = `partner-transactions-${new Date().toISOString().split('T')[0]}.csv`\n      document.body.appendChild(a)\n      a.click()\n      window.URL.revokeObjectURL(url)\n      document.body.removeChild(a)\n\n      toast.success('Transactions exported successfully')\n    } catch (err) {\n      console.error('[PartnerTransactionsPage] Export error:', err)\n      toast.error(err instanceof Error ? err.message : 'Failed to export transactions')\n    } finally {\n      setExporting(false)\n    }\n  }\n\n  useEffect(() => {\n    const supabase = createClient()\n\n    const hydrateTransactions = async (memberships: MembershipRow[]) => {\n      const investorIds = Array.from(new Set(\n        memberships.map(m => m.investor_id).filter((id): id is string => Boolean(id))\n      ))\n      const dealIds = Array.from(new Set(\n        memberships.map(m => m.deal_id).filter((id): id is string => Boolean(id))\n      ))\n\n      const subscriptionMap = new Map<string, SubscriptionRow>()\n      // PRD Row 77: Fee model per deal\n      const feeModelMap = new Map<string, { rate_bps: number | null; flat_amount: number | null; currency: string; kind: string | null }>()\n\n      if (investorIds.length > 0 && dealIds.length > 0) {\n        const { data: subscriptions, error: subscriptionsError } = await supabase\n          .from('subscriptions')\n          .select('id, investor_id, deal_id, commitment, currency, status, committed_at, created_at')\n          .in('investor_id', investorIds)\n          .in('deal_id', dealIds)\n\n        if (subscriptionsError) throw subscriptionsError\n\n        for (const subscription of subscriptions || []) {\n          const key = getSubscriptionKey(subscription.investor_id, subscription.deal_id)\n          const existing = subscriptionMap.get(key)\n          const existingTimestamp = Math.max(\n            getTimestamp(existing?.committed_at),\n            getTimestamp(existing?.created_at)\n          )\n          const currentTimestamp = Math.max(\n            getTimestamp(subscription.committed_at),\n            getTimestamp(subscription.created_at)\n          )\n\n          if (!existing || currentTimestamp >= existingTimestamp) {\n            subscriptionMap.set(key, subscription)\n          }\n        }\n      }\n\n      // PRD Row 77: Fetch fee plans for deals to show partner's commission\n      if (dealIds.length > 0) {\n        const { data: feePlans } = await supabase\n          .from('fee_plans')\n          .select(`\n            deal_id,\n            is_default,\n            fee_components (\n              kind,\n              rate_bps,\n              flat_amount,\n              calc_method\n            )\n          `)\n          .in('deal_id', dealIds)\n          .eq('is_active', true)\n\n        if (feePlans) {\n          for (const plan of feePlans) {\n            // Get the referral/success fee component\n            const components = plan.fee_components as any[] || []\n            const referralFee = components.find(c => c.kind === 'referral' || c.kind === 'success' || c.kind === 'commission')\n            if (referralFee && plan.deal_id) {\n              const subForDeal = subscriptionMap.get(`${plan.deal_id}`) || Array.from(subscriptionMap.values()).find(s => s.deal_id === plan.deal_id)\n              feeModelMap.set(plan.deal_id, {\n                rate_bps: referralFee.rate_bps,\n                flat_amount: referralFee.flat_amount,\n                currency: subForDeal?.currency || 'USD',\n                kind: referralFee.kind\n              })\n            }\n          }\n        }\n      }\n\n      return memberships.map((membership) => {\n        const investor = normalizeJoin(membership.investor)\n        const deal = normalizeJoin(membership.deal)\n        const subscription = membership.investor_id && membership.deal_id\n          ? subscriptionMap.get(getSubscriptionKey(membership.investor_id, membership.deal_id)) || null\n          : null\n\n        // Create synthetic ID from composite key (deal_memberships has no 'id' column)\n        const syntheticId = `${membership.deal_id || 'no-deal'}-${membership.investor_id || 'no-investor'}`\n\n        // PRD Rows 71-76: Compute investor journey stage\n        // Priority: funded > signed > approved > passed > interested > dispatched\n        let investorStage: 'dispatched' | 'interested' | 'passed' | 'approved' | 'signed' | 'funded' = 'dispatched'\n        if (subscription) {\n          const status = subscription.status || ''\n          if (status === 'active' || status === 'committed') {\n            investorStage = 'funded'\n          } else if (status === 'signed') {\n            investorStage = 'signed'\n          } else if (status === 'approved') {\n            investorStage = 'approved'\n          } else if (status === 'cancelled' || status === 'rejected') {\n            // PRD Row 73: \"Passed\" = investor declined/subscription cancelled\n            investorStage = 'passed'\n          } else if (membership.interest_confirmed_at) {\n            investorStage = 'interested'\n          }\n        } else if (membership.interest_confirmed_at) {\n          investorStage = 'interested'\n        }\n\n        return {\n          id: syntheticId,\n          investor: investor ? {\n            id: investor.id,\n            legal_name: investor.legal_name || 'Unknown',\n          } : null,\n          deal: deal ? {\n            id: deal.id,\n            name: deal.name || 'Unknown Deal',\n            company_name: deal.company_name ?? null,\n            status: deal.status || 'unknown',\n          } : null,\n          subscription: subscription ? {\n            id: subscription.id,\n            commitment: Number(subscription.commitment) || 0,\n            currency: subscription.currency || 'USD',\n            status: subscription.status || 'pending',\n            committed_at: subscription.committed_at,\n          } : null,\n          referred_at: membership.dispatched_at,\n          role: membership.role || 'investor',\n          investorStage,\n          interest_confirmed_at: membership.interest_confirmed_at,\n          // PRD Row 77: Fee model per deal\n          feeModel: deal ? feeModelMap.get(deal.id) || null : null,\n        }\n      })\n    }\n\n    async function fetchData() {\n      try {\n        setLoading(true)\n\n        // Get current user\n        const { data: { user } } = await supabase.auth.getUser()\n        if (!user) {\n          setError('Not authenticated')\n          return\n        }\n\n        // Check if user is a partner\n        const { data: partnerUser, error: partnerUserError } = await supabase\n          .from('partner_users')\n          .select('partner_id')\n          .eq('user_id', user.id)\n          .single()\n\n        if (partnerUserError || !partnerUser) {\n          // Maybe they're staff - show all partner transactions\n          await fetchAllPartnerTransactions()\n          return\n        }\n\n        // Fetch partner info\n        const { data: partner, error: partnerError } = await supabase\n          .from('partners')\n          .select('id, name, legal_name, partner_type, status')\n          .eq('id', partnerUser.partner_id)\n          .single()\n\n        if (partnerError) throw partnerError\n        setPartnerInfo(partner)\n\n        // Fetch deal memberships referred by this partner\n        const { data: memberships, error: membershipsError } = await supabase\n          .from('deal_memberships')\n          .select(`\n            role,\n            dispatched_at,\n            interest_confirmed_at,\n            deal_id,\n            investor_id,\n            investor:investor_id (\n              id,\n              legal_name\n            ),\n            deal:deal_id (\n              id,\n              name,\n              company_name,\n              status\n            )\n          `)\n          .eq('referred_by_entity_id', partnerUser.partner_id)\n          .eq('referred_by_entity_type', 'partner')\n          .order('dispatched_at', { ascending: false })\n\n        if (membershipsError) throw membershipsError\n\n        const processedTransactions = await hydrateTransactions(memberships || [])\n        setTransactions(processedTransactions)\n        setSummary(buildSummary(processedTransactions))\n\n        setError(null)\n      } catch (err) {\n        console.error('[PartnerTransactionsPage] Error:', err)\n        setError(err instanceof Error ? err.message : 'Failed to load transactions')\n      } finally {\n        setLoading(false)\n      }\n    }\n\n    async function fetchAllPartnerTransactions() {\n      // Staff view - show all partner-referred transactions\n      const { data: memberships, error: membershipsError } = await supabase\n        .from('deal_memberships')\n        .select(`\n          role,\n          dispatched_at,\n          interest_confirmed_at,\n          deal_id,\n          investor_id,\n          referred_by_entity_id,\n          investor:investor_id (\n            id,\n            legal_name\n          ),\n          deal:deal_id (\n            id,\n            name,\n            company_name,\n            status\n          )\n        `)\n        .eq('referred_by_entity_type', 'partner')\n        .order('dispatched_at', { ascending: false })\n        .limit(100)\n\n      if (membershipsError) throw membershipsError\n\n      const processedTransactions = await hydrateTransactions(memberships || [])\n      setTransactions(processedTransactions)\n      setSummary(buildSummary(processedTransactions))\n    }\n\n    fetchData()\n  }, [])\n\n  // Filter transactions\n  const filteredTransactions = transactions.filter(tx => {\n    const txStatus = tx.subscription?.status || 'no_subscription'\n    const matchesStatus = statusFilter === 'all' || txStatus === statusFilter\n    // PRD Rows 72-76: Filter by investor journey stage\n    const matchesStage = investorStageFilter === 'all' || tx.investorStage === investorStageFilter\n    const matchesSearch = !search ||\n      tx.investor?.legal_name?.toLowerCase().includes(search.toLowerCase()) ||\n      tx.deal?.name?.toLowerCase().includes(search.toLowerCase()) ||\n      tx.deal?.company_name?.toLowerCase().includes(search.toLowerCase())\n    return matchesStatus && matchesStage && matchesSearch\n  })\n\n  if (loading) {\n    return (\n      <div className=\"flex items-center justify-center py-16\">\n        <Loader2 className=\"h-8 w-8 animate-spin text-muted-foreground\" />\n        <span className=\"ml-3 text-muted-foreground\">Loading transactions...</span>\n      </div>\n    )\n  }\n\n  if (error) {\n    return (\n      <div className=\"text-center py-16\">\n        <AlertCircle className=\"h-12 w-12 text-destructive mx-auto mb-4\" />\n        <h3 className=\"text-lg font-medium text-foreground mb-2\">Error Loading Transactions</h3>\n        <p className=\"text-muted-foreground\">{error}</p>\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"p-6 space-y-6\">\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h1 className=\"text-2xl font-bold text-foreground\">Partner Transactions</h1>\n          <p className=\"text-muted-foreground mt-1\">\n            {partnerInfo\n              ? `Track referrals and investments as ${partnerInfo.name}`\n              : 'View all partner-referred transactions across the platform'}\n          </p>\n        </div>\n        <div className=\"flex items-center gap-2\">\n          {partnerInfo && (\n            <>\n              <Button\n                variant=\"outline\"\n                onClick={handleExport}\n                disabled={exporting || transactions.length === 0}\n              >\n                {exporting ? (\n                  <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />\n                ) : (\n                  <Download className=\"h-4 w-4 mr-2\" />\n                )}\n                Export CSV\n              </Button>\n              <Badge variant=\"outline\" className=\"capitalize\">\n                {partnerInfo.partner_type}\n              </Badge>\n            </>\n          )}\n        </div>\n      </div>\n\n      {/* Summary Cards */}\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium text-muted-foreground flex items-center gap-2\">\n              <Users className=\"h-4 w-4\" />\n              Total Referrals\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\">{summary.totalReferrals}</div>\n            <p className=\"text-xs text-muted-foreground mt-1\">\n              Investors referred to deals\n            </p>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium text-muted-foreground flex items-center gap-2\">\n              <TrendingUp className=\"h-4 w-4\" />\n              Converted\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold text-green-600\">{summary.convertedCount}</div>\n            <p className=\"text-xs text-muted-foreground mt-1\">\n              Successfully invested\n            </p>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium text-muted-foreground flex items-center gap-2\">\n              <ArrowRightLeft className=\"h-4 w-4\" />\n              Pending\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold text-orange-500\">{summary.pendingCount}</div>\n            <p className=\"text-xs text-muted-foreground mt-1\">\n              Awaiting completion\n            </p>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium text-muted-foreground flex items-center gap-2\">\n              <DollarSign className=\"h-4 w-4\" />\n              Total Value\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\">{formatCurrency(summary.totalCommitmentValue, summary.currency)}</div>\n            <p className=\"text-xs text-muted-foreground mt-1\">\n              Converted commitments\n            </p>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Filters */}\n      <Card>\n        <CardContent className=\"pt-6\">\n          <div className=\"flex flex-col md:flex-row gap-4\">\n            <div className=\"flex-1\">\n              <div className=\"relative\">\n                <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n                <Input\n                  placeholder=\"Search by investor, deal, or company...\"\n                  value={search}\n                  onChange={(e) => setSearch(e.target.value)}\n                  className=\"pl-10\"\n                />\n              </div>\n            </div>\n            <Select value={statusFilter} onValueChange={setStatusFilter}>\n              <SelectTrigger className=\"w-full md:w-48\">\n                <SelectValue placeholder=\"Filter by status\" />\n              </SelectTrigger>\n              <SelectContent>\n                {STATUS_FILTERS.map((option) => (\n                  <SelectItem key={option.value} value={option.value}>\n                    {option.label}\n                  </SelectItem>\n                ))}\n              </SelectContent>\n            </Select>\n            {/* PRD Rows 72-76: Investor journey stage filter */}\n            <Select value={investorStageFilter} onValueChange={setInvestorStageFilter}>\n              <SelectTrigger className=\"w-full md:w-48\">\n                <SelectValue placeholder=\"Filter by stage\" />\n              </SelectTrigger>\n              <SelectContent>\n                {INVESTOR_STAGE_FILTERS.map((option) => (\n                  <SelectItem key={option.value} value={option.value}>\n                    {option.label}\n                  </SelectItem>\n                ))}\n              </SelectContent>\n            </Select>\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Transactions Table */}\n      <Card>\n        <CardHeader>\n          <CardTitle>Transactions</CardTitle>\n          <CardDescription>\n            {filteredTransactions.length} transaction{filteredTransactions.length !== 1 ? 's' : ''} found\n          </CardDescription>\n        </CardHeader>\n        <CardContent>\n          {filteredTransactions.length === 0 ? (\n            <div className=\"border border-dashed border-muted rounded-lg py-12 flex flex-col items-center justify-center text-center space-y-2\">\n              <Building2 className=\"h-10 w-10 text-muted-foreground\" />\n              <p className=\"text-sm text-muted-foreground\">\n                {search || statusFilter !== 'all' || investorStageFilter !== 'all'\n                  ? 'No transactions match your filters'\n                  : 'No partner transactions yet'}\n              </p>\n              {!partnerInfo && transactions.length === 0 && (\n                <p className=\"text-xs text-muted-foreground\">\n                  Partner referrals will appear here when investors are referred via partner relationships\n                </p>\n              )}\n            </div>\n          ) : (\n            <div className=\"rounded-md border\">\n              <Table>\n                <TableHeader>\n                  <TableRow>\n                    <TableHead>Investor</TableHead>\n                    <TableHead>Deal</TableHead>\n                    <TableHead>Commitment</TableHead>\n                    <TableHead>Commission</TableHead>\n                    <TableHead>Status</TableHead>\n                    <TableHead>Stage</TableHead>\n                    <TableHead>Referred</TableHead>\n                    <TableHead className=\"text-right\">Actions</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {filteredTransactions.map((tx) => (\n                    <TableRow key={tx.id}>\n                      <TableCell>\n                        {tx.investor ? (\n                          <div className=\"font-medium\">{tx.investor.legal_name}</div>\n                        ) : (\n                          <span className=\"text-muted-foreground\">—</span>\n                        )}\n                      </TableCell>\n                      <TableCell>\n                        {tx.deal ? (\n                          <div>\n                            <div className=\"font-medium\">{tx.deal.name}</div>\n                            {tx.deal.company_name && (\n                              <div className=\"text-xs text-muted-foreground\">\n                                {tx.deal.company_name}\n                              </div>\n                            )}\n                          </div>\n                        ) : (\n                          <span className=\"text-muted-foreground\">—</span>\n                        )}\n                      </TableCell>\n                      <TableCell>\n                        {tx.subscription ? (\n                          <div className=\"font-medium\">\n                            {formatCurrency(tx.subscription.commitment, tx.subscription.currency)}\n                          </div>\n                        ) : (\n                          <span className=\"text-muted-foreground text-sm\">Not subscribed</span>\n                        )}\n                      </TableCell>\n                      {/* PRD Row 77: Partner fee model per deal */}\n                      <TableCell>\n                        {tx.feeModel ? (\n                          <div className=\"flex items-center gap-1\">\n                            <Percent className=\"h-3 w-3 text-emerald-600\" />\n                            <span className=\"text-sm font-medium text-emerald-600\">\n                              {tx.feeModel.rate_bps\n                                ? `${(tx.feeModel.rate_bps / 100).toFixed(2)}%`\n                                : tx.feeModel.flat_amount\n                                  ? formatCurrency(tx.feeModel.flat_amount, tx.feeModel.currency)\n                                  : '—'}\n                            </span>\n                            {tx.subscription && tx.feeModel.rate_bps && (\n                              <span className=\"text-xs text-muted-foreground ml-1\">\n                                (~{formatCurrency(tx.subscription.commitment * tx.feeModel.rate_bps / 10000, tx.subscription.currency)})\n                              </span>\n                            )}\n                          </div>\n                        ) : (\n                          <span className=\"text-muted-foreground text-xs\">Not set</span>\n                        )}\n                      </TableCell>\n                      <TableCell>\n                        {tx.subscription ? (\n                          <Badge\n                            variant=\"outline\"\n                            className={cn('capitalize', STATUS_STYLES[tx.subscription.status] || STATUS_STYLES.pending)}\n                          >\n                            {tx.subscription.status.replace('_', ' ')}\n                          </Badge>\n                        ) : (\n                          <Badge variant=\"outline\" className=\"text-gray-500\">\n                            Referred\n                          </Badge>\n                        )}\n                      </TableCell>\n                      {/* PRD Rows 72-76: Investor journey stage */}\n                      <TableCell>\n                        <Badge\n                          variant=\"outline\"\n                          className={cn(\n                            'capitalize',\n                            tx.investorStage === 'funded' && 'bg-green-100 text-green-800 border-green-200',\n                            tx.investorStage === 'signed' && 'bg-blue-100 text-blue-800 border-blue-200',\n                            tx.investorStage === 'approved' && 'bg-purple-100 text-purple-800 border-purple-200',\n                            tx.investorStage === 'passed' && 'bg-red-100 text-red-800 border-red-200',\n                            tx.investorStage === 'interested' && 'bg-yellow-100 text-yellow-800 border-yellow-200',\n                            tx.investorStage === 'dispatched' && 'bg-gray-100 text-gray-600 border-gray-200'\n                          )}\n                        >\n                          {tx.investorStage}\n                        </Badge>\n                      </TableCell>\n                      <TableCell>\n                        {tx.referred_at ? formatDate(tx.referred_at) : '—'}\n                      </TableCell>\n                      <TableCell className=\"text-right\">\n                        <div className=\"flex items-center justify-end gap-2\">\n                          {tx.deal && (\n                            <Button variant=\"ghost\" size=\"sm\" asChild>\n                              <Link href={`/versotech_main/opportunities/${tx.deal.id}`}>\n                                <ExternalLink className=\"h-4 w-4\" />\n                              </Link>\n                            </Button>\n                          )}\n                        </div>\n                      </TableCell>\n                    </TableRow>\n                  ))}\n                </TableBody>\n              </Table>\n            </div>\n          )}\n        </CardContent>\n      </Card>\n    </div>\n  )\n}\n"],"names":[],"mappings":"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"}