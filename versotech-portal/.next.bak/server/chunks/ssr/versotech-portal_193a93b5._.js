module.exports=[160409,a=>{"use strict";var b=a.i(611038),c=a.i(899750),d=a.i(217906),e=a.i(937199);let f=["application/pdf","image/png","image/jpeg","image/jpg","image/gif","image/webp","text/plain"],g=["pdf","png","jpeg","jpg","gif","webp","txt","text"];function h(){let[a,h]=(0,b.useState)(!1),[i,j]=(0,b.useState)(null),[k,l]=(0,b.useState)(null),[m,n]=(0,b.useState)(!1),[o,p]=(0,b.useState)(null),q=(0,b.useCallback)(async(a,b)=>{p(null),l(null);let i=(a=>{let b;if(a.file_size_bytes&&!(a.file_size_bytes<=0xa00000))return"File is too large for preview (maximum 10MB). Please download to view.";let c=a.file_name||a.name||"",d=!!c&&!!(b=c.split(".").pop()?.toLowerCase())&&g.includes(b),e=a.mime_type||"",h=!!e&&f.includes(e);return["docx","doc","xlsx","xls","pptx","ppt","odt","ods","odp"].includes(c.split(".").pop()?.toLowerCase()||"")||e&&(e.includes("officedocument")||e.includes("msword")||e.includes("ms-excel")||e.includes("ms-powerpoint")||e.includes("opendocument"))?"Office documents cannot be previewed. Please download to view.":d||h?null:"Preview not supported for this file type. Please download to view."})(a);if(i)return void c.toast.error(i);j(a),h(!0),n(!0);try{let c=b?await d.DocumentService.getDealDocumentPreviewUrl(b,a.id):await d.DocumentService.getPreviewUrl(a.id);l(c.download_url),n(!1)}catch(b){console.error("Failed to load document preview:",b);let a=b instanceof e.DocumentError?d.DocumentService.getErrorMessage(b):"Failed to load document preview. Please try downloading instead.";p(a),n(!1),c.toast.error(a)}},[]),r=(0,b.useCallback)(()=>{h(!1),setTimeout(()=>{j(null),l(null),p(null),n(!1)},300)},[]),s=(0,b.useCallback)(async()=>{if(i)try{if(k)return void window.open(k,"_blank");let a=await d.DocumentService.getDownloadUrl(i.id);window.open(a.download_url,"_blank")}catch(b){console.error("Failed to download document:",b);let a=b instanceof e.DocumentError?d.DocumentService.getErrorMessage(b):"Failed to download document";c.toast.error(a)}},[i,k]);return{isOpen:a,document:i,previewUrl:k,isLoading:m,error:o,openPreview:q,closePreview:r,downloadDocument:s}}a.s(["useDocumentViewer",()=>h],160409)},518173,a=>{"use strict";var b=a.i(352584),c=a.i(611038);a.i(776777);var d=a.i(823879),e=a.i(425622),f=a.i(3321),g=a.i(877918),h=a.i(816854),i=a.i(421908),j=a.i(888987);function k({isOpen:a,document:k,previewUrl:l,isLoading:m,error:n,onClose:o,onDownload:p}){let[q,r]=(0,c.useState)(!1),[s,t]=(0,c.useState)(!1);return(0,c.useEffect)(()=>(t(!0),()=>t(!1)),[]),(0,c.useMemo)(()=>{var a;return l?(a=k?.file_name||k?.name,a?.toLowerCase().endsWith(".pdf")||l?.toLowerCase().includes(".pdf")||l?.includes("deal-documents")&&l?.includes(".pdf")||0)?l.includes("#")?l:`${l}#navpanes=0&view=FitH&pagemode=none`:l:null},[l,k]),(0,c.useEffect)(()=>{},[a,o,p]),(0,c.useEffect)(()=>{r(!1)},[l]),a&&s&&(h.FileText,k?.file_name||k?.name,k?.type&&k.type,k?.file_size_bytes&&(b.Fragment,(0,j.formatFileSize)(k.file_size_bytes)),i.Button,e.Download,i.Button,d.X,(m||n||q)&&(m&&f.Loader2,n&&!m&&(g.AlertCircle,i.Button,e.Download),!q||m||n||(g.AlertCircle,i.Button,e.Download))),null}a.s(["DocumentViewerFullscreen",()=>k])},217906,937199,a=>{"use strict";class b extends Error{statusCode;originalError;constructor(a,b,c){super(a),this.statusCode=b,this.originalError=c,this.name="DocumentError"}}a.s(["DocumentError",()=>b],937199);class c{static isValidStorageUrl(a){return!!a&&!!a.startsWith("https://")&&(a.includes("supabase.co/storage")||a.includes("supabase.com/storage")||a.startsWith("blob:"))}static async parseResponse(a){let c;try{c=await a.json()}catch(c){throw new b("Invalid response from server",a.status,c)}if(!a.ok)throw new b(c.error||c.message||"Failed to load document",a.status,c);let d=c.url||c.download_url;if(!d)throw new b("No download URL in response",500,c);if(!this.isValidStorageUrl(d))throw new b("Invalid download URL format",500,c);return c.url=d,c.download_url=d,c}static async getPreviewUrl(a){try{let b=await fetch(`/api/documents/${a}/download?mode=preview`,{method:"GET",headers:{"Content-Type":"application/json"}});return await this.parseResponse(b)}catch(a){if(a instanceof b)throw a;throw new b("Network error while loading preview",0,a)}}static async getDownloadUrl(a){try{let b=await fetch(`/api/documents/${a}/download?mode=download`,{method:"GET",headers:{"Content-Type":"application/json"}});return await this.parseResponse(b)}catch(a){if(a instanceof b)throw a;throw new b("Network error while loading download",0,a)}}static async getDealDocumentPreviewUrl(a,c){try{let b=await fetch(`/api/deals/${a}/documents/${c}/download?mode=preview`,{method:"GET",headers:{"Content-Type":"application/json"}});return await this.parseResponse(b)}catch(a){if(a instanceof b)throw a;throw new b("Network error while loading deal document preview",0,a)}}static async getDealDocumentDownloadUrl(a,c){try{let b=await fetch(`/api/deals/${a}/documents/${c}/download?mode=download`,{method:"GET",headers:{"Content-Type":"application/json"}});return await this.parseResponse(b)}catch(a){if(a instanceof b)throw a;throw new b("Network error while loading deal document download",0,a)}}static getErrorMessage(a){switch(a.statusCode){case 401:return"You do not have permission to view this document.";case 403:return"Access to this document is forbidden.";case 404:return"Document not found or has been deleted.";case 413:return"File is too large to process.";case 500:return"Server error while loading document. Please try again.";case 0:return"Network error. Please check your connection and try again.";default:return a.message||"Failed to load document preview."}}}a.s(["DocumentService",()=>c],217906)},941766,a=>{"use strict";let b=(0,a.i(95799).default)("folder-open",[["path",{d:"m6 14 1.5-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.54 6a2 2 0 0 1-1.95 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H18a2 2 0 0 1 2 2v2",key:"usdka0"}]]);a.s(["FolderOpen",()=>b],941766)},905219,a=>{"use strict";let b=(0,a.i(95799).default)("folder",[["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]]);a.s(["Folder",()=>b],905219)},324647,a=>{"use strict";let b=(0,a.i(95799).default)("file-spreadsheet",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M8 13h2",key:"yr2amv"}],["path",{d:"M14 13h2",key:"un5t4a"}],["path",{d:"M8 17h2",key:"2yhykz"}],["path",{d:"M14 17h2",key:"10kma7"}]]);a.s(["FileSpreadsheet",()=>b],324647)},416986,a=>{"use strict";let b=(0,a.i(95799).default)("house",[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-6a2 2 0 0 1 2.582 0l7 6A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"r6nss1"}]]);a.s(["Home",()=>b],416986)},883668,a=>{"use strict";var b=a.i(352584),c=a.i(15788),d=a.i(425622),e=a.i(496392),f=a.i(42329),g=a.i(278541),h=a.i(905219),i=a.i(264890),j=a.i(816854),k=a.i(324647),l=a.i(675167),m=a.i(504839),n=a.i(947208),o=a.i(686331),p=a.i(203297);let q=(0,a.i(95799).default)("clipboard",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}]]);var r=a.i(92881),s=a.i(264634),t=a.i(405398),u=a.i(134303),v=a.i(611038),w=a.i(899750),x=a.i(888987),y=a.i(216316);function z({document:a,onPreview:z,onRename:A,onDelete:B,variant:C="default",className:D}){var E,F;let[G,H]=(0,v.useState)(!1),[I,J]=(0,v.useState)(!1),K=async()=>{H(!0);try{let b=await fetch(`/api/documents/${a.id}/download`);if(!b.ok)return void(404===b.status?w.toast.error("Document not found or access denied"):401===b.status?w.toast.error("Please sign in to download documents"):w.toast.error("Failed to generate download link"));let{download_url:c,watermark:d,expires_in_seconds:e}=await b.json();d&&w.toast.info(`Document will be watermarked with: ${d.downloaded_by}`,{duration:5e3}),window.open(c,"_blank"),w.toast.success(`Download link generated. Expires in ${Math.floor(e/60)} minutes`,{duration:5e3})}catch(a){w.toast.error("Failed to download document. Please try again.")}finally{H(!1)}},L=a.file_name||a.name||"Untitled Document",M=(E=a.file_size_bytes)?E<1024?E+" B":E<1048576?(E/1024).toFixed(1)+" KB":(E/1048576).toFixed(1)+" MB":"Unknown size",N=(a.type||"Document").toString().replace(/_/g," ").split(" ").map(a=>a.charAt(0).toUpperCase()+a.slice(1).toLowerCase()).join(" "),O=a.scope?.vehicle,P=new Date(a.created_at).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}),Q=(F=a.type,({statement:k.FileSpreadsheet,report:l.FileCheck,legal:m.Scale,tax:n.Receipt,nda:o.Lock,subscription:p.FileSignature,agreement:p.FileSignature,term_sheet:q,kyc:r.UserCheck,other:j.FileText})[F.toLowerCase()]||j.FileText);return"compact"===C?(0,b.jsxs)("button",{onClick:()=>z?.(a),className:(0,x.cn)("group flex items-center gap-3 w-full px-4 py-3 rounded-md","hover:bg-muted transition-colors duration-150","focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-1",D),children:[(0,b.jsx)(Q,{className:"w-5 h-5 text-primary flex-shrink-0",strokeWidth:2}),(0,b.jsx)("span",{className:"text-sm font-medium text-foreground flex-1 text-left break-words line-clamp-1",children:L}),(0,b.jsx)("span",{className:"text-sm text-muted-foreground flex-shrink-0",children:M})]}):(0,b.jsxs)("div",{className:(0,x.cn)("group relative bg-card border border-border rounded-lg shadow-sm","hover:bg-muted/50 hover:border-border hover:shadow-md","transition-all duration-200","cursor-pointer",D),onClick:()=>z?.(a),children:[(0,b.jsx)("div",{className:"p-5",children:(0,b.jsxs)("div",{className:"flex items-start gap-4",children:[(0,b.jsx)("div",{className:(0,x.cn)("w-14 h-14 rounded-lg border border-border flex items-center justify-center","flex-shrink-0 transition-all duration-200","bg-muted/50"),children:(0,b.jsx)(Q,{className:"w-6 h-6 text-primary",strokeWidth:2})}),(0,b.jsxs)("div",{className:"flex-1 min-w-0 overflow-hidden",children:[(0,b.jsx)("h3",{className:"font-semibold text-foreground text-sm leading-tight mb-2 break-words line-clamp-2",children:L}),(0,b.jsxs)("div",{className:"flex items-center gap-2 text-sm text-muted-foreground mb-2",children:[(0,b.jsx)("span",{children:N}),(0,b.jsx)("span",{children:"•"}),(0,b.jsx)("span",{children:M}),(0,b.jsx)("span",{children:"•"}),(0,b.jsxs)("span",{className:"flex items-center gap-1",children:[(0,b.jsx)(f.Clock,{className:"w-3.5 h-3.5",strokeWidth:2}),P]})]}),(0,b.jsxs)("div",{className:"flex flex-wrap items-center gap-1.5",children:[O&&(0,b.jsxs)(c.Badge,{variant:"outline",className:"text-xs border-blue-200 bg-blue-50 text-blue-700",children:[(0,b.jsx)(g.Building2,{className:"w-3.5 h-3.5 mr-1",strokeWidth:2}),O.name]}),a.folder&&(0,b.jsxs)(c.Badge,{variant:"outline",className:"text-xs border-purple-200 bg-purple-50 text-purple-700",children:[(0,b.jsx)(h.Folder,{className:"w-3.5 h-3.5 mr-1",strokeWidth:2}),a.folder.path]}),a.watermark&&(0,b.jsxs)(c.Badge,{variant:"outline",className:"text-xs border-emerald-200 bg-emerald-50 text-emerald-700",children:[(0,b.jsx)(e.Shield,{className:"w-3.5 h-3.5 mr-1",strokeWidth:2}),"Watermarked"]})]})]}),(0,b.jsxs)(y.DropdownMenu,{open:I,onOpenChange:J,children:[(0,b.jsxs)(y.DropdownMenuTrigger,{className:(0,x.cn)("opacity-0 group-hover:opacity-100 transition-opacity duration-150","p-1 rounded hover:bg-muted","focus:outline-none focus:ring-2 focus:ring-primary",I&&"opacity-100"),onClick:a=>a.stopPropagation(),children:[(0,b.jsx)(s.MoreVertical,{className:"w-4 h-4 text-muted-foreground",strokeWidth:2}),(0,b.jsx)("span",{className:"sr-only",children:"Document actions"})]}),(0,b.jsxs)(y.DropdownMenuContent,{align:"end",className:"w-48",children:[z&&(0,b.jsxs)(y.DropdownMenuItem,{onClick:b=>{b.stopPropagation(),z(a)},children:[(0,b.jsx)(i.Eye,{className:"w-4 h-4 mr-2 text-primary",strokeWidth:2}),(0,b.jsx)("span",{children:"Preview"})]}),(0,b.jsx)(y.DropdownMenuItem,{onClick:a=>{a.stopPropagation(),K()},disabled:G,children:G?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(f.Clock,{className:"w-4 h-4 mr-2 animate-spin text-muted-foreground",strokeWidth:2}),(0,b.jsx)("span",{children:"Generating..."})]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(d.Download,{className:"w-4 h-4 mr-2 text-muted-foreground",strokeWidth:2}),(0,b.jsx)("span",{children:"Download"})]})}),A&&(0,b.jsxs)(y.DropdownMenuItem,{onClick:b=>{b.stopPropagation(),A(a.id)},children:[(0,b.jsx)(t.Edit,{className:"w-4 h-4 mr-2 text-muted-foreground",strokeWidth:2}),(0,b.jsx)("span",{children:"Rename"})]}),B&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(y.DropdownMenuSeparator,{}),(0,b.jsxs)(y.DropdownMenuItem,{onClick:b=>{b.stopPropagation(),B(a.id)},className:"text-destructive focus:text-destructive",children:[(0,b.jsx)(u.Trash2,{className:"w-4 h-4 mr-2",strokeWidth:2}),(0,b.jsx)("span",{children:"Delete"})]})]})]})]})]})}),(0,b.jsx)("div",{className:(0,x.cn)("absolute bottom-0 left-0 right-0 h-0.5 bg-primary","transform scale-x-0 group-hover:scale-x-100","transition-transform duration-200 origin-left","rounded-b-lg")})]})}a.s(["DocumentCard",()=>z],883668)}];

//# sourceMappingURL=versotech-portal_193a93b5._.js.map