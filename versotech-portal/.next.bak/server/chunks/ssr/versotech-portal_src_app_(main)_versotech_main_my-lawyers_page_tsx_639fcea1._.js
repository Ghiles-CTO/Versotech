module.exports=[270394,a=>{"use strict";var b=a.i(352584),c=a.i(611038),d=a.i(284169),e=a.i(15788),f=a.i(421908),g=a.i(663475),h=a.i(951870),i=a.i(771088),j=a.i(504839),k=a.i(966494),l=a.i(399580),m=a.i(487068),n=a.i(3321),o=a.i(877918),p=a.i(618287),q=a.i(439467),r=a.i(318525),s=a.i(871057),t=a.i(888987),u=a.i(201986),v=a.i(58834);let w={approved:"bg-green-100 text-green-800",pending:"bg-yellow-100 text-yellow-800",expired:"bg-red-100 text-red-800",not_started:"bg-gray-100 text-gray-800"},x=[{label:"All Status",value:"all"},{label:"Active",value:"active"},{label:"Inactive",value:"inactive"}];function y(){let[a,y]=(0,c.useState)(null),[z,A]=(0,c.useState)([]),[B,C]=(0,c.useState)({totalLawyers:0,activeLawyers:0,totalDeals:0,totalDealValue:0}),[D,E]=(0,c.useState)(!0),[F,G]=(0,c.useState)(null),[H,I]=(0,c.useState)(""),[J,K]=(0,c.useState)("all");(0,c.useEffect)(()=>{async function a(a){let{data:b,error:c}=await a.from("lawyers").select("*").order("firm_name").limit(100);if(c)throw c;let d=(b||[]).map(a=>({id:a.id,firm_name:a.firm_name,display_name:a.display_name,legal_entity_type:a.legal_entity_type,specializations:a.specializations,primary_contact_name:a.primary_contact_name,primary_contact_email:a.primary_contact_email,primary_contact_phone:a.primary_contact_phone,country:a.country,logo_url:a.logo_url,kyc_status:a.kyc_status,is_active:a.is_active,deals_count:0,total_deal_value:0,total_subscriptions:0,funded_subscriptions:0,total_funded_amount:0,total_commitment:0}));A(d),C({totalLawyers:d.length,activeLawyers:d.filter(a=>a.is_active).length,totalDeals:0,totalDealValue:0})}!async function(){try{E(!0);let b=(0,v.createClient)(),{data:{user:c}}=await b.auth.getUser();if(!c)return void G("Not authenticated");let{data:d,error:e}=await b.from("arranger_users").select("arranger_id").eq("user_id",c.id).single();if(e||!d)return void await a(b);let{data:f,error:g}=await b.from("arranger_entities").select("id, legal_name, status").eq("id",d.arranger_id).single();if(g)throw g;y(f);let{data:h,error:i}=await b.from("deals").select("id, target_amount, currency").eq("arranger_entity_id",d.arranger_id);if(i)throw i;if(!h||0===h.length){A([]),C({totalLawyers:0,activeLawyers:0,totalDeals:0,totalDealValue:0});return}let j=h.map(a=>a.id),{data:k,error:l}=await b.from("deal_fee_structures").select("deal_id, legal_counsel").in("deal_id",j).not("legal_counsel","is",null).eq("status","published");if(l)throw l;let m=[...new Set((k||[]).map(a=>a.legal_counsel))];if(0===m.length){A([]),C({totalLawyers:0,activeLawyers:0,totalDeals:0,totalDealValue:0});return}let{data:n,error:o}=await b.from("lawyers").select("*").or(m.map(a=>`firm_name.ilike.%${a}%,display_name.ilike.%${a}%`).join(",")).order("firm_name");if(o)throw o;let p=new Map;h.forEach(a=>p.set(a.id,Number(a.target_amount)||0));let{data:q}=await b.from("subscriptions").select("id, deal_id, commitment, funded_amount, status").in("deal_id",j),r=new Map;(q||[]).forEach(a=>{let b=r.get(a.deal_id)||[];b.push(a),r.set(a.deal_id,b)});let s=(n||[]).map(a=>{let b=(k||[]).filter(b=>{let c=b.legal_counsel?.toLowerCase()||"";return c.includes(a.firm_name?.toLowerCase()||"")||c.includes(a.display_name?.toLowerCase()||"")}),c=[...new Set(b.map(a=>a.deal_id))],d=c.reduce((a,b)=>a+(p.get(b)||0),0),e=0,f=0,g=0,h=0;return c.forEach(a=>{(r.get(a)||[]).forEach(a=>{e++;let b=Number(a.commitment)||0,c=Number(a.funded_amount)||0;h+=b,g+=c,b>0&&c>=b&&f++})}),{id:a.id,firm_name:a.firm_name,display_name:a.display_name,legal_entity_type:a.legal_entity_type,specializations:a.specializations,primary_contact_name:a.primary_contact_name,primary_contact_email:a.primary_contact_email,primary_contact_phone:a.primary_contact_phone,country:a.country,logo_url:a.logo_url,kyc_status:a.kyc_status,is_active:a.is_active,deals_count:c.length,total_deal_value:d,total_subscriptions:e,funded_subscriptions:f,total_funded_amount:g,total_commitment:h}});A(s),C({totalLawyers:s.length,activeLawyers:s.filter(a=>a.is_active).length,totalDeals:s.reduce((a,b)=>a+b.deals_count,0),totalDealValue:s.reduce((a,b)=>a+b.total_deal_value,0)}),G(null)}catch(a){console.error("[MyLawyersPage] Error:",a),G(a instanceof Error?a.message:"Failed to load lawyers")}finally{E(!1)}}()},[]);let L=z.filter(a=>{let b="all"===J||"active"===J&&a.is_active||"inactive"===J&&!a.is_active,c=!H||a.firm_name?.toLowerCase().includes(H.toLowerCase())||a.display_name?.toLowerCase().includes(H.toLowerCase())||a.primary_contact_name?.toLowerCase().includes(H.toLowerCase())||a.specializations?.some(a=>a.toLowerCase().includes(H.toLowerCase()));return b&&c});return D?(0,b.jsxs)("div",{className:"flex items-center justify-center py-16",children:[(0,b.jsx)(n.Loader2,{className:"h-8 w-8 animate-spin text-muted-foreground"}),(0,b.jsx)("span",{className:"ml-3 text-muted-foreground",children:"Loading lawyers..."})]}):F?(0,b.jsxs)("div",{className:"text-center py-16",children:[(0,b.jsx)(o.AlertCircle,{className:"h-12 w-12 text-destructive mx-auto mb-4"}),(0,b.jsx)("h3",{className:"text-lg font-medium text-foreground mb-2",children:"Error Loading Lawyers"}),(0,b.jsx)("p",{className:"text-muted-foreground",children:F})]}):(0,b.jsxs)("div",{className:"p-6 space-y-6",children:[(0,b.jsx)("div",{className:"flex items-center justify-between",children:(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-2xl font-bold text-foreground",children:"My Lawyers"}),(0,b.jsx)("p",{className:"text-muted-foreground mt-1",children:a?`Legal counsel working with ${a.legal_name}`:"View all registered law firms"})]})}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,b.jsxs)(d.Card,{children:[(0,b.jsx)(d.CardHeader,{className:"pb-2",children:(0,b.jsxs)(d.CardTitle,{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[(0,b.jsx)(j.Scale,{className:"h-4 w-4"}),"Total Lawyers"]})}),(0,b.jsxs)(d.CardContent,{children:[(0,b.jsx)("div",{className:"text-2xl font-bold",children:B.totalLawyers}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"In your network"})]})]}),(0,b.jsxs)(d.Card,{children:[(0,b.jsx)(d.CardHeader,{className:"pb-2",children:(0,b.jsxs)(d.CardTitle,{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[(0,b.jsx)(l.CheckCircle2,{className:"h-4 w-4"}),"Active"]})}),(0,b.jsxs)(d.CardContent,{children:[(0,b.jsx)("div",{className:"text-2xl font-bold text-green-600",children:B.activeLawyers}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Currently active"})]})]}),(0,b.jsxs)(d.Card,{children:[(0,b.jsx)(d.CardHeader,{className:"pb-2",children:(0,b.jsxs)(d.CardTitle,{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[(0,b.jsx)(s.Briefcase,{className:"h-4 w-4"}),"Deals Handled"]})}),(0,b.jsxs)(d.CardContent,{children:[(0,b.jsx)("div",{className:"text-2xl font-bold text-blue-600",children:B.totalDeals}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Legal counsel on"})]})]}),(0,b.jsxs)(d.Card,{children:[(0,b.jsx)(d.CardHeader,{className:"pb-2",children:(0,b.jsxs)(d.CardTitle,{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[(0,b.jsx)(k.TrendingUp,{className:"h-4 w-4"}),"Deal Value"]})}),(0,b.jsxs)(d.CardContent,{children:[(0,b.jsx)("div",{className:"text-2xl font-bold text-purple-600",children:(0,u.formatCurrency)(B.totalDealValue,"USD")}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Total handled"})]})]})]}),(0,b.jsx)(d.Card,{children:(0,b.jsx)(d.CardContent,{className:"pt-6",children:(0,b.jsxs)("div",{className:"flex flex-col md:flex-row gap-4",children:[(0,b.jsxs)("div",{className:"flex-1 relative",children:[(0,b.jsx)(m.Search,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),(0,b.jsx)(g.Input,{placeholder:"Search lawyers, firms, or specializations...",value:H,onChange:a=>I(a.target.value),className:"pl-10"})]}),(0,b.jsxs)(h.Select,{value:J,onValueChange:K,children:[(0,b.jsx)(h.SelectTrigger,{className:"w-full md:w-48",children:(0,b.jsx)(h.SelectValue,{placeholder:"Filter by status"})}),(0,b.jsx)(h.SelectContent,{children:x.map(a=>(0,b.jsx)(h.SelectItem,{value:a.value,children:a.label},a.value))})]})]})})}),(0,b.jsxs)(d.Card,{children:[(0,b.jsxs)(d.CardHeader,{children:[(0,b.jsx)(d.CardTitle,{children:"Lawyers & Law Firms"}),(0,b.jsxs)(d.CardDescription,{children:[L.length," firm",1!==L.length?"s":""," found"]})]}),(0,b.jsx)(d.CardContent,{children:0===L.length?(0,b.jsxs)("div",{className:"border border-dashed border-muted rounded-lg py-12 flex flex-col items-center justify-center text-center space-y-2",children:[(0,b.jsx)(j.Scale,{className:"h-10 w-10 text-muted-foreground"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:H||"all"!==J?"No lawyers match your filters":"No lawyers in your network yet"})]}):(0,b.jsx)("div",{className:"rounded-md border",children:(0,b.jsxs)(i.Table,{children:[(0,b.jsx)(i.TableHeader,{children:(0,b.jsxs)(i.TableRow,{children:[(0,b.jsx)(i.TableHead,{children:"Firm"}),(0,b.jsx)(i.TableHead,{children:"Specializations"}),(0,b.jsx)(i.TableHead,{children:"Contact"}),(0,b.jsx)(i.TableHead,{children:"Deals"}),(0,b.jsx)(i.TableHead,{children:"Escrow Status"}),(0,b.jsx)(i.TableHead,{children:"Deal Value"}),(0,b.jsx)(i.TableHead,{children:"Status"}),(0,b.jsx)(i.TableHead,{className:"text-right",children:"Actions"})]})}),(0,b.jsx)(i.TableBody,{children:L.map(a=>(0,b.jsxs)(i.TableRow,{children:[(0,b.jsx)(i.TableCell,{children:(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[a.logo_url?(0,b.jsx)("img",{src:a.logo_url,alt:a.firm_name,className:"h-10 w-10 rounded-lg object-cover"}):(0,b.jsx)("div",{className:"h-10 w-10 rounded-lg bg-muted flex items-center justify-center",children:(0,b.jsx)(j.Scale,{className:"h-5 w-5 text-muted-foreground"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"font-medium",children:a.firm_name}),a.display_name!==a.firm_name&&(0,b.jsx)("div",{className:"text-xs text-muted-foreground",children:a.display_name}),a.country&&(0,b.jsxs)("div",{className:"text-xs text-muted-foreground flex items-center gap-1",children:[(0,b.jsx)(r.Globe,{className:"h-3 w-3"}),a.country]})]})]})}),(0,b.jsx)(i.TableCell,{children:a.specializations&&a.specializations.length>0?(0,b.jsxs)("div",{className:"flex flex-wrap gap-1",children:[a.specializations.slice(0,2).map((a,c)=>(0,b.jsx)(e.Badge,{variant:"secondary",className:"capitalize text-xs",children:a},c)),a.specializations.length>2&&(0,b.jsxs)(e.Badge,{variant:"outline",className:"text-xs",children:["+",a.specializations.length-2]})]}):(0,b.jsx)("span",{className:"text-muted-foreground text-xs",children:"â€”"})}),(0,b.jsx)(i.TableCell,{children:(0,b.jsxs)("div",{className:"space-y-1",children:[a.primary_contact_name&&(0,b.jsx)("div",{className:"text-sm",children:a.primary_contact_name}),a.primary_contact_email&&(0,b.jsxs)("div",{className:"text-xs text-muted-foreground flex items-center gap-1",children:[(0,b.jsx)(q.Mail,{className:"h-3 w-3"}),a.primary_contact_email]})]})}),(0,b.jsx)(i.TableCell,{children:(0,b.jsxs)(e.Badge,{variant:"outline",children:[a.deals_count," deal",1!==a.deals_count?"s":""]})}),(0,b.jsx)(i.TableCell,{children:a.total_subscriptions>0?(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("div",{className:"flex items-center gap-2",children:(0,b.jsxs)(e.Badge,{variant:"secondary",className:(0,t.cn)("text-xs",a.funded_subscriptions===a.total_subscriptions?"bg-green-100 text-green-800":a.funded_subscriptions>0?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"),children:[a.funded_subscriptions,"/",a.total_subscriptions," funded"]})}),(0,b.jsxs)("div",{className:"text-xs text-muted-foreground",children:[(0,u.formatCurrency)(a.total_funded_amount,"USD")," / ",(0,u.formatCurrency)(a.total_commitment,"USD")]})]}):(0,b.jsx)("span",{className:"text-muted-foreground text-xs",children:"No subs"})}),(0,b.jsx)(i.TableCell,{children:(0,b.jsx)("div",{className:"font-medium",children:(0,u.formatCurrency)(a.total_deal_value,"USD")})}),(0,b.jsx)(i.TableCell,{children:(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)(e.Badge,{variant:"outline",className:(0,t.cn)("capitalize",a.is_active?"bg-green-100 text-green-800 border-green-200":"bg-gray-100 text-gray-800 border-gray-200"),children:a.is_active?"Active":"Inactive"}),a.kyc_status&&(0,b.jsx)("div",{children:(0,b.jsxs)(e.Badge,{variant:"secondary",className:(0,t.cn)("text-xs",w[a.kyc_status]||""),children:["KYC: ",a.kyc_status.replace("_"," ")]})})]})}),(0,b.jsx)(i.TableCell,{className:"text-right",children:(0,b.jsx)(f.Button,{variant:"ghost",size:"sm",asChild:!0,children:(0,b.jsx)("a",{href:`/versotech_main/users?type=lawyer&id=${a.id}`,children:(0,b.jsx)(p.ExternalLink,{className:"h-4 w-4"})})})})]},a.id))})]})})})]})]})}a.s(["default",()=>y])}];

//# sourceMappingURL=versotech-portal_src_app_%28main%29_versotech_main_my-lawyers_page_tsx_639fcea1._.js.map