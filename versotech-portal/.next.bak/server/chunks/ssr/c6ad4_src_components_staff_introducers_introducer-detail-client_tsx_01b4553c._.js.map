{"version":3,"sources":["../../../../../versotech-portal/src/components/staff/introducers/introducer-detail-client.tsx","../../../../../versotech-portal/src/components/staff/introducers/dispatch-introducer-investor-dialog.tsx"],"sourcesContent":["'use client'\r\n\r\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from '@/components/ui/card'\r\nimport { Button } from '@/components/ui/button'\r\nimport { Badge } from '@/components/ui/badge'\r\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs'\r\nimport Link from 'next/link'\r\nimport {\r\n  ArrowLeft,\r\n  Mail,\r\n  Phone,\r\n  User,\r\n  Calendar,\r\n  FileText,\r\n  Banknote,\r\n  Activity,\r\n  DollarSign,\r\n  TrendingUp,\r\n  Building2,\r\n  Edit,\r\n  UserPlus,\r\n  Clock,\r\n  Percent,\r\n  FileSignature,\r\n  MoreHorizontal,\r\n  Eye,\r\n  Send,\r\n  PenLine,\r\n  Plus,\r\n  CheckCircle2,\r\n  XCircle,\r\n  AlertCircle,\r\n  FileCheck,\r\n  Users,\r\n  Briefcase,\r\n  ExternalLink,\r\n  Download,\r\n  FileDown,\r\n  ChevronDown,\r\n  ChevronUp,\r\n  Loader2,\r\n  Info,\r\n} from 'lucide-react'\r\nimport {\r\n  DropdownMenu,\r\n  DropdownMenuContent,\r\n  DropdownMenuItem,\r\n  DropdownMenuSeparator,\r\n  DropdownMenuTrigger,\r\n} from '@/components/ui/dropdown-menu'\r\nimport { useState, useEffect, useCallback } from 'react'\r\nimport { KYCDocumentsTab } from '@/components/shared/kyc-documents-tab'\r\nimport { BankDetailsTab } from '@/components/shared/bank-details-tab'\r\nimport { ActivityTimelineTab } from '@/components/shared/activity-timeline-tab'\r\nimport { IndividualKycDisplay, EntityKYCEditDialog } from '@/components/shared'\r\nimport { StaffEntityMembersTab } from '@/components/staff/shared/staff-entity-members-tab'\r\nimport { EditIntroducerDialog } from '@/components/staff/introducers/edit-introducer-dialog'\r\nimport { CreateAgreementDialog } from '@/components/staff/introducers/create-agreement-dialog'\r\nimport { InviteUserDialog } from '@/components/users/invite-user-dialog'\r\nimport { DispatchIntroducerInvestorDialog } from '@/components/staff/introducers/dispatch-introducer-investor-dialog'\r\nimport { useRouter } from 'next/navigation'\r\nimport { toast } from 'sonner'\r\nimport { formatCurrency, formatBps, formatDate } from '@/lib/format'\r\nimport { statusStyles, kycStyles, getStatusStyle } from '@/lib/status-styles'\r\n\r\ntype IntroducerDetail = {\r\n  id: string\r\n  legal_name: string\r\n  contact_name: string | null\r\n  email: string | null\r\n  phone_mobile: string | null\r\n  phone_office: string | null\r\n  default_commission_bps: number | null\r\n  commission_cap_amount: number | null\r\n  payment_terms: string | null\r\n  status: string\r\n  kyc_status: string | null\r\n  notes: string | null\r\n  created_at: string | null\r\n  updated_at: string | null\r\n  // Entity type (individual vs entity)\r\n  type?: string | null\r\n  // Individual KYC fields\r\n  first_name?: string | null\r\n  middle_name?: string | null\r\n  last_name?: string | null\r\n  name_suffix?: string | null\r\n  date_of_birth?: string | null\r\n  country_of_birth?: string | null\r\n  nationality?: string | null\r\n  // US Tax compliance\r\n  is_us_citizen?: boolean | null\r\n  is_us_taxpayer?: boolean | null\r\n  us_taxpayer_id?: string | null\r\n  country_of_tax_residency?: string | null\r\n  // ID Document\r\n  id_type?: string | null\r\n  id_number?: string | null\r\n  id_issue_date?: string | null\r\n  id_expiry_date?: string | null\r\n  id_issuing_country?: string | null\r\n  // Residential Address\r\n  residential_street?: string | null\r\n  residential_line_2?: string | null\r\n  residential_city?: string | null\r\n  residential_state?: string | null\r\n  residential_postal_code?: string | null\r\n  residential_country?: string | null\r\n  // New KYC fields\r\n  middle_initial?: string | null\r\n  proof_of_address_date?: string | null\r\n  proof_of_address_expiry?: string | null\r\n  tax_id_number?: string | null\r\n}\r\n\r\ntype Introduction = {\r\n  id: string\r\n  prospect_email: string | null\r\n  status: string\r\n  introduced_at: string | null\r\n  deal: {\r\n    id: string\r\n    name: string\r\n  } | null\r\n  investor: {\r\n    id: string\r\n    legal_name: string\r\n  } | null\r\n}\r\n\r\ntype Commission = {\r\n  id: string\r\n  accrual_amount: number\r\n  status: string\r\n  paid_at: string | null\r\n  created_at: string\r\n  deal_id: string | null\r\n  investor_id: string | null\r\n  investor?: {\r\n    legal_name: string\r\n  } | null\r\n  deal?: {\r\n    name: string\r\n  } | null\r\n}\r\n\r\ntype Agreement = {\r\n  id: string\r\n  status: string\r\n  reference_number: string | null\r\n  default_commission_bps: number | null\r\n  effective_date: string | null\r\n  expiry_date: string | null\r\n  signed_date: string | null\r\n  pdf_url: string | null\r\n  deal_id: string | null\r\n  fee_plan_id: string | null\r\n  created_at: string\r\n  updated_at: string\r\n  deal?: {\r\n    id: string\r\n    name: string\r\n  } | null\r\n}\r\n\r\ntype IntroducerMetrics = {\r\n  totalIntroductions: number\r\n  successfulAllocations: number\r\n  conversionRate: number\r\n  totalCommissionPaid: number\r\n  pendingCommission: number\r\n}\r\n\r\ntype FeeComponent = {\r\n  id: string\r\n  kind: string\r\n  calc_method: string | null\r\n  rate_bps: number | null\r\n  flat_amount: number | null\r\n  frequency: string | null\r\n}\r\n\r\ntype IntroducerFeePlan = {\r\n  id: string\r\n  name: string\r\n  description: string | null\r\n  status: 'draft' | 'sent' | 'pending_signature' | 'accepted' | 'rejected'\r\n  is_active: boolean\r\n  accepted_at: string | null\r\n  accepted_by: string | null\r\n  created_at: string\r\n  updated_at: string\r\n  generated_agreement_id: string | null\r\n  deal: {\r\n    id: string\r\n    name: string\r\n    status: string\r\n  } | null\r\n  term_sheet: {\r\n    id: string\r\n    version: number\r\n    status: string\r\n    term_sheet_date: string | null\r\n    subscription_fee_percent: number | null\r\n    management_fee_percent: number | null\r\n    carried_interest_percent: number | null\r\n  } | null\r\n  fee_components: FeeComponent[]\r\n  introducer_agreement: {\r\n    id: string\r\n    reference_number: string | null\r\n    status: string\r\n    pdf_url: string | null\r\n    signed_date: string | null\r\n  } | null\r\n  investor_count: number\r\n}\r\n\r\ntype ReferredInvestor = {\r\n  id: string\r\n  investor_id: string | null\r\n  user_id: string | null\r\n  role: string\r\n  invited_at: string | null\r\n  accepted_at: string | null\r\n  profile: {\r\n    id: string\r\n    display_name: string | null\r\n    email: string | null\r\n  } | null\r\n  investor: {\r\n    id: string\r\n    legal_name: string\r\n    type: string | null\r\n  } | null\r\n  deal: {\r\n    id: string\r\n    name: string\r\n    status: string\r\n  } | null\r\n  fee_plan: {\r\n    id: string\r\n    name: string\r\n    status: string\r\n  } | null\r\n  subscription: {\r\n    status: string\r\n    amount: number | null\r\n    funded_at: string | null\r\n  } | null\r\n}\r\n\r\ninterface IntroducerDetailClientProps {\r\n  introducer: IntroducerDetail\r\n  metrics: IntroducerMetrics\r\n  introductions: Introduction[]\r\n  commissions: Commission[]\r\n  agreements: Agreement[]\r\n}\r\n\r\nexport function IntroducerDetailClient({\r\n  introducer,\r\n  metrics,\r\n  introductions,\r\n  commissions,\r\n  agreements\r\n}: IntroducerDetailClientProps) {\r\n  const router = useRouter()\r\n  const [editDialogOpen, setEditDialogOpen] = useState(false)\r\n  const [inviteDialogOpen, setInviteDialogOpen] = useState(false)\r\n  const [createAgreementOpen, setCreateAgreementOpen] = useState(false)\r\n  const [kycDialogOpen, setKycDialogOpen] = useState(false)\r\n  const [dispatchDialogOpen, setDispatchDialogOpen] = useState(false)\r\n  const [sendingAgreement, setSendingAgreement] = useState<string | null>(null)\r\n  const [downloadingPdf, setDownloadingPdf] = useState<string | null>(null)\r\n\r\n  // Handle PDF download from Supabase storage\r\n  const handleDownloadPdf = async (pdfUrl: string, referenceNumber: string | null) => {\r\n    setDownloadingPdf(pdfUrl)\r\n    try {\r\n      // Fetch the file directly from our API\r\n      const response = await fetch(`/api/storage/download?path=${encodeURIComponent(pdfUrl)}&bucket=deal-documents`)\r\n      if (!response.ok) {\r\n        throw new Error('Failed to download file')\r\n      }\r\n\r\n      // Convert response to blob and trigger download\r\n      const blob = await response.blob()\r\n      const url = window.URL.createObjectURL(blob)\r\n      const link = document.createElement('a')\r\n      link.href = url\r\n      // Extract actual filename from storage path, or fall back to reference number\r\n      const actualFilename = pdfUrl.split('/').pop() || `${referenceNumber || 'agreement'}.pdf`\r\n      link.download = actualFilename\r\n      document.body.appendChild(link)\r\n      link.click()\r\n      document.body.removeChild(link)\r\n      window.URL.revokeObjectURL(url)\r\n\r\n      toast.success('PDF downloaded successfully')\r\n    } catch (error) {\r\n      console.error('Error downloading PDF:', error)\r\n      toast.error('Failed to download PDF')\r\n    } finally {\r\n      setDownloadingPdf(null)\r\n    }\r\n  }\r\n\r\n  // Preview PDF in new tab\r\n  const handlePreviewPdf = async (pdfUrl: string) => {\r\n    try {\r\n      // Fetch the file directly from our API\r\n      const response = await fetch(`/api/storage/download?path=${encodeURIComponent(pdfUrl)}&bucket=deal-documents`)\r\n      if (!response.ok) {\r\n        throw new Error('Failed to load file')\r\n      }\r\n\r\n      // Convert response to blob and open in new tab\r\n      const blob = await response.blob()\r\n      const url = window.URL.createObjectURL(blob)\r\n      window.open(url, '_blank')\r\n    } catch (error) {\r\n      console.error('Error previewing PDF:', error)\r\n      toast.error('Failed to preview PDF')\r\n    }\r\n  }\r\n\r\n  // Fee Plans and Referred Investors state\r\n  const [feePlans, setFeePlans] = useState<IntroducerFeePlan[]>([])\r\n  const [feePlansLoading, setFeePlansLoading] = useState(false)\r\n  const [expandedFeePlan, setExpandedFeePlan] = useState<string | null>(null)\r\n  const [referredInvestors, setReferredInvestors] = useState<ReferredInvestor[]>([])\r\n  const [referredInvestorsLoading, setReferredInvestorsLoading] = useState(false)\r\n\r\n  // Fee component kind labels\r\n  const feeKindLabels: Record<string, string> = {\r\n    subscription: 'Subscription Fee',\r\n    management: 'Management Fee',\r\n    performance: 'Performance Fee',\r\n    spread_markup: 'Spread Markup',\r\n    flat: 'Flat Fee',\r\n    other: 'Other'\r\n  }\r\n\r\n  // Fetch fee plans for this introducer\r\n  const fetchFeePlans = useCallback(async () => {\r\n    setFeePlansLoading(true)\r\n    try {\r\n      const response = await fetch(`/api/introducers/${introducer.id}/fee-plans`)\r\n      if (response.ok) {\r\n        const data = await response.json()\r\n        setFeePlans(data.fee_plans || [])\r\n      }\r\n    } catch (error) {\r\n      console.error('Error fetching fee plans:', error)\r\n    } finally {\r\n      setFeePlansLoading(false)\r\n    }\r\n  }, [introducer.id])\r\n\r\n  // Fetch referred investors for this introducer\r\n  const fetchReferredInvestors = useCallback(async () => {\r\n    setReferredInvestorsLoading(true)\r\n    try {\r\n      const response = await fetch(`/api/introducers/${introducer.id}/referred-investors`)\r\n      if (response.ok) {\r\n        const data = await response.json()\r\n        setReferredInvestors(data.referred_investors || [])\r\n      }\r\n    } catch (error) {\r\n      console.error('Error fetching referred investors:', error)\r\n    } finally {\r\n      setReferredInvestorsLoading(false)\r\n    }\r\n  }, [introducer.id])\r\n\r\n  // Load fee plans and referred investors on mount\r\n  useEffect(() => {\r\n    fetchFeePlans()\r\n    fetchReferredInvestors()\r\n  }, [fetchFeePlans, fetchReferredInvestors])\r\n\r\n  const feePlanStatusStyles: Record<string, string> = {\r\n    draft: 'bg-slate-500/20 text-slate-400',\r\n    sent: 'bg-blue-500/20 text-blue-400',\r\n    pending_signature: 'bg-purple-500/20 text-purple-400',\r\n    accepted: 'bg-green-500/20 text-green-400',\r\n    rejected: 'bg-red-500/20 text-red-400',\r\n  }\r\n\r\n  const introStatusStyles: Record<string, string> = {\r\n    allocated: 'bg-green-500/20 text-green-400',\r\n    converted: 'bg-green-500/20 text-green-400',\r\n    pending: 'bg-yellow-500/20 text-yellow-400',\r\n    expired: 'bg-gray-500/20 text-gray-400',\r\n  }\r\n\r\n  const commissionStatusStyles: Record<string, string> = {\r\n    paid: 'bg-green-500/20 text-green-400',\r\n    accrued: 'bg-yellow-500/20 text-yellow-400',\r\n    invoiced: 'bg-blue-500/20 text-blue-400',\r\n    cancelled: 'bg-red-500/20 text-red-400',\r\n  }\r\n\r\n  const agreementStatusStyles: Record<string, { bg: string; text: string; icon: React.ReactNode }> = {\r\n    draft: {\r\n      bg: 'bg-slate-500/20',\r\n      text: 'text-slate-400',\r\n      icon: <FileText className=\"h-3 w-3\" />\r\n    },\r\n    sent: {\r\n      bg: 'bg-blue-500/20',\r\n      text: 'text-blue-400',\r\n      icon: <Send className=\"h-3 w-3\" />\r\n    },\r\n    pending_approval: {\r\n      bg: 'bg-amber-500/20',\r\n      text: 'text-amber-400',\r\n      icon: <AlertCircle className=\"h-3 w-3\" />\r\n    },\r\n    approved: {\r\n      bg: 'bg-indigo-500/20',\r\n      text: 'text-indigo-400',\r\n      icon: <CheckCircle2 className=\"h-3 w-3\" />\r\n    },\r\n    pending_ceo_signature: {\r\n      bg: 'bg-purple-500/20',\r\n      text: 'text-purple-400',\r\n      icon: <PenLine className=\"h-3 w-3\" />\r\n    },\r\n    pending_introducer_signature: {\r\n      bg: 'bg-cyan-500/20',\r\n      text: 'text-cyan-400',\r\n      icon: <PenLine className=\"h-3 w-3\" />\r\n    },\r\n    active: {\r\n      bg: 'bg-emerald-500/20',\r\n      text: 'text-emerald-400',\r\n      icon: <CheckCircle2 className=\"h-3 w-3\" />\r\n    },\r\n    expired: {\r\n      bg: 'bg-gray-500/20',\r\n      text: 'text-gray-400',\r\n      icon: <Clock className=\"h-3 w-3\" />\r\n    },\r\n    rejected: {\r\n      bg: 'bg-red-500/20',\r\n      text: 'text-red-400',\r\n      icon: <XCircle className=\"h-3 w-3\" />\r\n    },\r\n  }\r\n\r\n  const formatAgreementStatus = (status: string) => {\r\n    const mapping: Record<string, string> = {\r\n      draft: 'Draft',\r\n      sent: 'Sent',\r\n      pending_approval: 'Pending Approval',\r\n      approved: 'Approved',\r\n      pending_ceo_signature: 'Awaiting CEO Signature',\r\n      pending_introducer_signature: 'Awaiting Introducer Signature',\r\n      active: 'Active',\r\n      expired: 'Expired',\r\n      rejected: 'Rejected',\r\n    }\r\n    return mapping[status] || status\r\n  }\r\n\r\n  const handleSendAgreement = async (agreementId: string) => {\r\n    setSendingAgreement(agreementId)\r\n    try {\r\n      const response = await fetch(`/api/introducer-agreements/${agreementId}/send`, {\r\n        method: 'POST',\r\n      })\r\n      if (!response.ok) {\r\n        const error = await response.json()\r\n        throw new Error(error.error || 'Failed to send agreement')\r\n      }\r\n      toast.success('Agreement sent to introducer for approval')\r\n      router.refresh()\r\n    } catch (error) {\r\n      toast.error(error instanceof Error ? error.message : 'Failed to send agreement')\r\n    } finally {\r\n      setSendingAgreement(null)\r\n    }\r\n  }\r\n\r\n  const formatPaymentTerms = (terms: string | null) => {\r\n    if (!terms) return 'Not set'\r\n    const mapping: Record<string, string> = {\r\n      'net_15': 'Net 15',\r\n      'net_30': 'Net 30',\r\n      'net_45': 'Net 45',\r\n      'net_60': 'Net 60',\r\n    }\r\n    return mapping[terms] || terms\r\n  }\r\n\r\n  // Format introducer data for edit dialog\r\n  const introducerForDialog = {\r\n    id: introducer.id,\r\n    legalName: introducer.legal_name,\r\n    contactName: introducer.contact_name,\r\n    email: introducer.email,\r\n    defaultCommissionBps: introducer.default_commission_bps || 0,\r\n    commissionCapAmount: introducer.commission_cap_amount,\r\n    paymentTerms: introducer.payment_terms,\r\n    status: introducer.status,\r\n    notes: introducer.notes,\r\n  }\r\n\r\n  return (\r\n    <div className=\"p-6 space-y-6\">\r\n      {/* Header */}\r\n      <div className=\"flex items-center justify-between\">\r\n        <div className=\"flex items-center gap-4\">\r\n          <Link href=\"/versotech_main/users\">\r\n            <Button variant=\"ghost\" size=\"sm\" className=\"bg-gray-800 text-white hover:bg-gray-700\">\r\n              <ArrowLeft className=\"h-4 w-4 mr-2\" />\r\n              Back to Users\r\n            </Button>\r\n          </Link>\r\n          <div>\r\n            <h1 className=\"text-2xl font-bold text-foreground\">\r\n              {introducer.legal_name}\r\n            </h1>\r\n            <p className=\"text-sm text-muted-foreground\">\r\n              Introducer ID: {introducer.id.slice(0, 8)}\r\n            </p>\r\n          </div>\r\n        </div>\r\n        <div className=\"flex items-center gap-2\">\r\n          <Button\r\n            variant=\"default\"\r\n            size=\"sm\"\r\n            onClick={() => setDispatchDialogOpen(true)}\r\n            className=\"bg-gradient-to-r from-orange-600 to-amber-600 hover:from-orange-500 hover:to-amber-500 text-white\"\r\n          >\r\n            <Send className=\"h-4 w-4 mr-2\" />\r\n            Dispatch Investor\r\n          </Button>\r\n          <Button variant=\"outline\" size=\"sm\" onClick={() => setInviteDialogOpen(true)}>\r\n            <UserPlus className=\"h-4 w-4 mr-2\" />\r\n            Invite User\r\n          </Button>\r\n          <Button variant=\"outline\" size=\"sm\" onClick={() => setEditDialogOpen(true)}>\r\n            <Edit className=\"h-4 w-4 mr-2\" />\r\n            Edit\r\n          </Button>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Status Badges */}\r\n      <div className=\"flex gap-2 flex-wrap\">\r\n        <Badge className={getStatusStyle(introducer.status, statusStyles)}>\r\n          {introducer.status}\r\n        </Badge>\r\n        {introducer.kyc_status && (\r\n          <Badge className={getStatusStyle(introducer.kyc_status, kycStyles)}>\r\n            KYC: {introducer.kyc_status}\r\n          </Badge>\r\n        )}\r\n        {introducer.default_commission_bps && (\r\n          <Badge variant=\"outline\">\r\n            {formatBps(introducer.default_commission_bps)} Commission\r\n          </Badge>\r\n        )}\r\n      </div>\r\n\r\n      {/* Metrics Cards */}\r\n      <div className=\"grid grid-cols-1 md:grid-cols-5 gap-4\">\r\n        <Card>\r\n          <CardHeader className=\"pb-3\">\r\n            <CardTitle className=\"text-sm font-medium text-muted-foreground flex items-center gap-2\">\r\n              <TrendingUp className=\"h-4 w-4\" />\r\n              Introductions\r\n            </CardTitle>\r\n          </CardHeader>\r\n          <CardContent>\r\n            <div className=\"text-2xl font-bold text-foreground\">{metrics.totalIntroductions}</div>\r\n            <div className=\"text-sm text-muted-foreground mt-1\">\r\n              {metrics.successfulAllocations} converted\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n\r\n        <Card>\r\n          <CardHeader className=\"pb-3\">\r\n            <CardTitle className=\"text-sm font-medium text-muted-foreground flex items-center gap-2\">\r\n              <Percent className=\"h-4 w-4\" />\r\n              Conversion Rate\r\n            </CardTitle>\r\n          </CardHeader>\r\n          <CardContent>\r\n            <div className=\"text-2xl font-bold text-foreground\">\r\n              {metrics.conversionRate.toFixed(1)}%\r\n            </div>\r\n            <div className=\"text-sm text-muted-foreground mt-1\">Success rate</div>\r\n          </CardContent>\r\n        </Card>\r\n\r\n        <Card>\r\n          <CardHeader className=\"pb-3\">\r\n            <CardTitle className=\"text-sm font-medium text-muted-foreground flex items-center gap-2\">\r\n              <DollarSign className=\"h-4 w-4\" />\r\n              Paid Commissions\r\n            </CardTitle>\r\n          </CardHeader>\r\n          <CardContent>\r\n            <div className=\"text-2xl font-bold text-green-400\">\r\n              {formatCurrency(metrics.totalCommissionPaid)}\r\n            </div>\r\n            <div className=\"text-sm text-muted-foreground mt-1\">All time</div>\r\n          </CardContent>\r\n        </Card>\r\n\r\n        <Card>\r\n          <CardHeader className=\"pb-3\">\r\n            <CardTitle className=\"text-sm font-medium text-muted-foreground flex items-center gap-2\">\r\n              <Clock className=\"h-4 w-4\" />\r\n              Pending\r\n            </CardTitle>\r\n          </CardHeader>\r\n          <CardContent>\r\n            <div className=\"text-2xl font-bold text-orange-400\">\r\n              {formatCurrency(metrics.pendingCommission)}\r\n            </div>\r\n            <div className=\"text-sm text-muted-foreground mt-1\">Owed</div>\r\n          </CardContent>\r\n        </Card>\r\n\r\n        <Card>\r\n          <CardHeader className=\"pb-3\">\r\n            <CardTitle className=\"text-sm font-medium text-muted-foreground flex items-center gap-2\">\r\n              <Percent className=\"h-4 w-4\" />\r\n              Default Rate\r\n            </CardTitle>\r\n          </CardHeader>\r\n          <CardContent>\r\n            <div className=\"text-2xl font-bold text-foreground\">\r\n              {formatBps(introducer.default_commission_bps || 0)}\r\n            </div>\r\n            {introducer.commission_cap_amount && (\r\n              <div className=\"text-sm text-muted-foreground mt-1\">\r\n                Cap: {formatCurrency(introducer.commission_cap_amount)}\r\n              </div>\r\n            )}\r\n          </CardContent>\r\n        </Card>\r\n      </div>\r\n\r\n      {/* Tabbed Content */}\r\n      <Tabs defaultValue=\"overview\" className=\"space-y-6\" id={`introducer-tabs-${introducer.id}`}>\r\n        <TabsList className=\"grid w-full grid-cols-2 sm:grid-cols-4 md:grid-cols-5 lg:grid-cols-10 lg:w-auto lg:inline-grid\">\r\n          <TabsTrigger value=\"overview\" className=\"gap-2\">\r\n            <Building2 className=\"h-4 w-4\" />\r\n            <span className=\"hidden sm:inline\">Overview</span>\r\n          </TabsTrigger>\r\n          <TabsTrigger value=\"members\" className=\"gap-2\">\r\n            <User className=\"h-4 w-4\" />\r\n            <span className=\"hidden sm:inline\">Members</span>\r\n          </TabsTrigger>\r\n          <TabsTrigger value=\"fee-plans\" className=\"gap-2\">\r\n            <FileCheck className=\"h-4 w-4\" />\r\n            <span className=\"hidden sm:inline\">Fee Plans</span>\r\n          </TabsTrigger>\r\n          <TabsTrigger value=\"referred-investors\" className=\"gap-2\">\r\n            <Users className=\"h-4 w-4\" />\r\n            <span className=\"hidden sm:inline\">Investors</span>\r\n          </TabsTrigger>\r\n          <TabsTrigger value=\"agreements\" className=\"gap-2\">\r\n            <FileSignature className=\"h-4 w-4\" />\r\n            <span className=\"hidden sm:inline\">Agreements</span>\r\n          </TabsTrigger>\r\n          <TabsTrigger value=\"introductions\" className=\"gap-2\">\r\n            <TrendingUp className=\"h-4 w-4\" />\r\n            <span className=\"hidden sm:inline\">Introductions</span>\r\n          </TabsTrigger>\r\n          <TabsTrigger value=\"commissions\" className=\"gap-2\">\r\n            <DollarSign className=\"h-4 w-4\" />\r\n            <span className=\"hidden sm:inline\">Commissions</span>\r\n          </TabsTrigger>\r\n          <TabsTrigger value=\"kyc\" className=\"gap-2\">\r\n            <FileText className=\"h-4 w-4\" />\r\n            <span className=\"hidden sm:inline\">KYC</span>\r\n          </TabsTrigger>\r\n          <TabsTrigger value=\"bank\" className=\"gap-2\">\r\n            <Banknote className=\"h-4 w-4\" />\r\n            <span className=\"hidden sm:inline\">Bank</span>\r\n          </TabsTrigger>\r\n          <TabsTrigger value=\"activity\" className=\"gap-2\">\r\n            <Activity className=\"h-4 w-4\" />\r\n            <span className=\"hidden sm:inline\">Activity</span>\r\n          </TabsTrigger>\r\n        </TabsList>\r\n\r\n        {/* Overview Tab */}\r\n        <TabsContent value=\"overview\" className=\"space-y-6\">\r\n          <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\r\n            {/* Contact Information */}\r\n            <Card>\r\n              <CardHeader>\r\n                <CardTitle>Contact Information</CardTitle>\r\n              </CardHeader>\r\n              <CardContent className=\"space-y-4\">\r\n                {introducer.contact_name && (\r\n                  <div className=\"flex items-center gap-3\">\r\n                    <User className=\"h-4 w-4 text-muted-foreground\" />\r\n                    <div>\r\n                      <div className=\"text-sm text-muted-foreground\">Primary Contact</div>\r\n                      <div className=\"text-sm font-medium\">{introducer.contact_name}</div>\r\n                    </div>\r\n                  </div>\r\n                )}\r\n                {introducer.email && (\r\n                  <div className=\"flex items-center gap-3\">\r\n                    <Mail className=\"h-4 w-4 text-muted-foreground\" />\r\n                    <div>\r\n                      <div className=\"text-sm text-muted-foreground\">Email</div>\r\n                      <a href={`mailto:${introducer.email}`} className=\"text-sm font-medium text-blue-400 hover:underline\">\r\n                        {introducer.email}\r\n                      </a>\r\n                    </div>\r\n                  </div>\r\n                )}\r\n                {introducer.phone_mobile && (\r\n                  <div className=\"flex items-center gap-3\">\r\n                    <Phone className=\"h-4 w-4 text-muted-foreground\" />\r\n                    <div>\r\n                      <div className=\"text-sm text-muted-foreground\">Mobile</div>\r\n                      <div className=\"text-sm font-medium\">{introducer.phone_mobile}</div>\r\n                    </div>\r\n                  </div>\r\n                )}\r\n                {introducer.phone_office && (\r\n                  <div className=\"flex items-center gap-3\">\r\n                    <Phone className=\"h-4 w-4 text-muted-foreground\" />\r\n                    <div>\r\n                      <div className=\"text-sm text-muted-foreground\">Office</div>\r\n                      <div className=\"text-sm font-medium\">{introducer.phone_office}</div>\r\n                    </div>\r\n                  </div>\r\n                )}\r\n                {introducer.created_at && (\r\n                  <div className=\"flex items-center gap-3\">\r\n                    <Calendar className=\"h-4 w-4 text-muted-foreground\" />\r\n                    <div>\r\n                      <div className=\"text-sm text-muted-foreground\">Member Since</div>\r\n                      <div className=\"text-sm font-medium\">{formatDate(introducer.created_at)}</div>\r\n                    </div>\r\n                  </div>\r\n                )}\r\n                {!introducer.contact_name && !introducer.email && !introducer.phone_mobile && !introducer.phone_office && (\r\n                  <p className=\"text-sm text-muted-foreground\">No contact information available</p>\r\n                )}\r\n              </CardContent>\r\n            </Card>\r\n          </div>\r\n\r\n          {/* Individual KYC Information (for individual introducers) */}\r\n          {introducer.type === 'individual' && (\r\n            <IndividualKycDisplay\r\n              data={{\r\n                first_name: introducer.first_name,\r\n                middle_name: introducer.middle_name,\r\n                last_name: introducer.last_name,\r\n                name_suffix: introducer.name_suffix,\r\n                date_of_birth: introducer.date_of_birth,\r\n                country_of_birth: introducer.country_of_birth,\r\n                nationality: introducer.nationality,\r\n                email: introducer.email,\r\n                phone_mobile: introducer.phone_mobile,\r\n                phone_office: introducer.phone_office,\r\n                residential_street: introducer.residential_street,\r\n                residential_line_2: introducer.residential_line_2,\r\n                residential_city: introducer.residential_city,\r\n                residential_state: introducer.residential_state,\r\n                residential_postal_code: introducer.residential_postal_code,\r\n                residential_country: introducer.residential_country,\r\n                is_us_citizen: introducer.is_us_citizen,\r\n                is_us_taxpayer: introducer.is_us_taxpayer,\r\n                us_taxpayer_id: introducer.us_taxpayer_id,\r\n                country_of_tax_residency: introducer.country_of_tax_residency,\r\n                id_type: introducer.id_type,\r\n                id_number: introducer.id_number,\r\n                id_issue_date: introducer.id_issue_date,\r\n                id_expiry_date: introducer.id_expiry_date,\r\n                id_issuing_country: introducer.id_issuing_country,\r\n              }}\r\n              showEditButton={true}\r\n              onEdit={() => setKycDialogOpen(true)}\r\n              title=\"Personal KYC Information\"\r\n            />\r\n          )}\r\n\r\n          {/* Notes Card */}\r\n          {introducer.notes && (\r\n            <Card>\r\n              <CardHeader>\r\n                <CardTitle>Notes</CardTitle>\r\n              </CardHeader>\r\n              <CardContent>\r\n                <div className=\"text-sm bg-white/5 rounded-lg p-4 whitespace-pre-wrap\">\r\n                  {introducer.notes}\r\n                </div>\r\n              </CardContent>\r\n            </Card>\r\n          )}\r\n        </TabsContent>\r\n\r\n        {/* Members Tab */}\r\n        <TabsContent value=\"members\">\r\n          <StaffEntityMembersTab\r\n            entityType=\"introducer\"\r\n            entityId={introducer.id}\r\n            entityName={introducer.legal_name}\r\n          />\r\n        </TabsContent>\r\n\r\n        {/* Fee Plans Tab */}\r\n        <TabsContent value=\"fee-plans\">\r\n          <Card>\r\n            <CardHeader>\r\n              <CardTitle>Fee Plans</CardTitle>\r\n              <CardDescription>\r\n                All fee plans linked to {introducer.legal_name} across deals. Click to expand details.\r\n              </CardDescription>\r\n            </CardHeader>\r\n            <CardContent>\r\n              {feePlansLoading ? (\r\n                <div className=\"flex items-center justify-center py-8\">\r\n                  <Loader2 className=\"h-8 w-8 animate-spin text-muted-foreground\" />\r\n                </div>\r\n              ) : feePlans.length === 0 ? (\r\n                <div className=\"flex flex-col items-center justify-center py-12 text-center\">\r\n                  <div className=\"p-4 rounded-2xl bg-gradient-to-br from-blue-500/10 to-indigo-500/10 border border-blue-500/20 mb-4\">\r\n                    <FileCheck className=\"h-10 w-10 text-blue-400/60\" />\r\n                  </div>\r\n                  <p className=\"text-muted-foreground mb-1\">No fee plans yet</p>\r\n                  <p className=\"text-sm text-muted-foreground/70\">\r\n                    Fee plans will appear here when created from deals\r\n                  </p>\r\n                </div>\r\n              ) : (\r\n                <div className=\"space-y-4\">\r\n                  {feePlans.map((feePlan) => {\r\n                    const isExpanded = expandedFeePlan === feePlan.id\r\n                    const hasAgreement = feePlan.introducer_agreement?.pdf_url\r\n\r\n                    return (\r\n                      <div\r\n                        key={feePlan.id}\r\n                        className={`rounded-xl border transition-all ${\r\n                          isExpanded\r\n                            ? 'border-blue-500/30 bg-blue-500/5'\r\n                            : 'border-white/10 hover:border-white/20'\r\n                        }`}\r\n                      >\r\n                        {/* Header - Clickable */}\r\n                        <div\r\n                          className=\"flex items-center justify-between p-4 cursor-pointer\"\r\n                          onClick={() => setExpandedFeePlan(isExpanded ? null : feePlan.id)}\r\n                        >\r\n                          <div className=\"flex items-center gap-4\">\r\n                            <div className={`p-2.5 rounded-lg ${feePlan.status === 'accepted' ? 'bg-green-500/20' : 'bg-slate-500/20'}`}>\r\n                              <FileCheck className={`h-5 w-5 ${feePlan.status === 'accepted' ? 'text-green-400' : 'text-slate-400'}`} />\r\n                            </div>\r\n                            <div>\r\n                              <div className=\"font-medium text-foreground\">{feePlan.name}</div>\r\n                              <div className=\"text-sm text-muted-foreground flex items-center gap-2 mt-0.5\">\r\n                                <Briefcase className=\"h-3 w-3\" />\r\n                                {feePlan.deal?.name || 'Unknown Deal'}\r\n                                {feePlan.term_sheet && (\r\n                                  <span className=\"text-xs text-muted-foreground/70\">\r\n                                    • Term Sheet v{feePlan.term_sheet.version}\r\n                                  </span>\r\n                                )}\r\n                              </div>\r\n                            </div>\r\n                          </div>\r\n                          <div className=\"flex items-center gap-3\">\r\n                            {feePlan.investor_count > 0 && (\r\n                              <div className=\"flex items-center gap-1 text-sm text-muted-foreground\">\r\n                                <Users className=\"h-4 w-4\" />\r\n                                {feePlan.investor_count}\r\n                              </div>\r\n                            )}\r\n                            {hasAgreement && (\r\n                              <Badge className=\"bg-green-500/20 text-green-400 border-green-500/30 text-xs\">\r\n                                PDF\r\n                              </Badge>\r\n                            )}\r\n                            <Badge className={feePlanStatusStyles[feePlan.status] || 'bg-gray-500/20 text-gray-400'}>\r\n                              {feePlan.status}\r\n                            </Badge>\r\n                            {isExpanded ? (\r\n                              <ChevronUp className=\"h-5 w-5 text-muted-foreground\" />\r\n                            ) : (\r\n                              <ChevronDown className=\"h-5 w-5 text-muted-foreground\" />\r\n                            )}\r\n                          </div>\r\n                        </div>\r\n\r\n                        {/* Expanded Content */}\r\n                        {isExpanded && (\r\n                          <div className=\"px-4 pb-4 pt-0 border-t border-white/10 mt-0\">\r\n                            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6 pt-4\">\r\n                              {/* Left Column - Fee Components */}\r\n                              <div>\r\n                                <h4 className=\"text-sm font-medium text-foreground mb-3\">Fee Components</h4>\r\n                                {feePlan.fee_components && feePlan.fee_components.length > 0 ? (\r\n                                  <div className=\"space-y-2\">\r\n                                    {feePlan.fee_components.map((component) => (\r\n                                      <div\r\n                                        key={component.id}\r\n                                        className=\"flex items-center justify-between py-2 px-3 rounded bg-white/5\"\r\n                                      >\r\n                                        <span className=\"text-sm text-foreground\">\r\n                                          {feeKindLabels[component.kind] || component.kind}\r\n                                        </span>\r\n                                        <Badge variant=\"outline\" className=\"border-white/20 text-muted-foreground\">\r\n                                          {component.rate_bps ? `${component.rate_bps / 100}%` :\r\n                                           component.flat_amount ? `$${component.flat_amount.toLocaleString()}` : '—'}\r\n                                        </Badge>\r\n                                      </div>\r\n                                    ))}\r\n                                  </div>\r\n                                ) : feePlan.term_sheet ? (\r\n                                  <div className=\"space-y-2\">\r\n                                    {feePlan.term_sheet.subscription_fee_percent && (\r\n                                      <div className=\"flex items-center justify-between py-2 px-3 rounded bg-white/5\">\r\n                                        <span className=\"text-sm text-foreground\">Subscription Fee</span>\r\n                                        <Badge variant=\"outline\" className=\"border-white/20 text-muted-foreground\">\r\n                                          {feePlan.term_sheet.subscription_fee_percent}%\r\n                                        </Badge>\r\n                                      </div>\r\n                                    )}\r\n                                    {feePlan.term_sheet.management_fee_percent && (\r\n                                      <div className=\"flex items-center justify-between py-2 px-3 rounded bg-white/5\">\r\n                                        <span className=\"text-sm text-foreground\">Management Fee</span>\r\n                                        <Badge variant=\"outline\" className=\"border-white/20 text-muted-foreground\">\r\n                                          {feePlan.term_sheet.management_fee_percent}%\r\n                                        </Badge>\r\n                                      </div>\r\n                                    )}\r\n                                    {feePlan.term_sheet.carried_interest_percent && (\r\n                                      <div className=\"flex items-center justify-between py-2 px-3 rounded bg-white/5\">\r\n                                        <span className=\"text-sm text-foreground\">Carried Interest</span>\r\n                                        <Badge variant=\"outline\" className=\"border-white/20 text-muted-foreground\">\r\n                                          {feePlan.term_sheet.carried_interest_percent}%\r\n                                        </Badge>\r\n                                      </div>\r\n                                    )}\r\n                                  </div>\r\n                                ) : (\r\n                                  <p className=\"text-sm text-muted-foreground\">No fee components defined</p>\r\n                                )}\r\n                              </div>\r\n\r\n                              {/* Right Column - Agreement & Actions */}\r\n                              <div>\r\n                                <h4 className=\"text-sm font-medium text-foreground mb-3\">Agreement</h4>\r\n                                {feePlan.introducer_agreement ? (\r\n                                  <div className=\"space-y-3\">\r\n                                    <div className=\"flex items-center gap-3 p-3 rounded-lg bg-white/5\">\r\n                                      <div className=\"p-2 rounded-lg bg-green-500/10\">\r\n                                        <FileSignature className=\"h-5 w-5 text-green-400\" />\r\n                                      </div>\r\n                                      <div className=\"flex-1\">\r\n                                        <p className=\"text-sm font-medium text-foreground\">\r\n                                          {feePlan.introducer_agreement.reference_number || 'Agreement'}\r\n                                        </p>\r\n                                        <p className=\"text-xs text-muted-foreground\">\r\n                                          Status: {feePlan.introducer_agreement.status}\r\n                                        </p>\r\n                                      </div>\r\n                                    </div>\r\n                                    {feePlan.introducer_agreement.pdf_url && (\r\n                                      <div className=\"flex gap-2\">\r\n                                        <Button\r\n                                          variant=\"outline\"\r\n                                          size=\"sm\"\r\n                                          className=\"flex-1 text-blue-400 border-blue-400/30 hover:bg-blue-400/10\"\r\n                                          onClick={(e) => {\r\n                                            e.stopPropagation()\r\n                                            // Preview in new tab\r\n                                            fetch(`/api/storage/download?path=${encodeURIComponent(feePlan.introducer_agreement!.pdf_url!)}&bucket=deal-documents`)\r\n                                              .then(res => res.blob())\r\n                                              .then(blob => {\r\n                                                const url = window.URL.createObjectURL(blob)\r\n                                                window.open(url, '_blank')\r\n                                              })\r\n                                          }}\r\n                                        >\r\n                                          <Eye className=\"h-4 w-4 mr-1\" />\r\n                                          Preview\r\n                                        </Button>\r\n                                        <Button\r\n                                          variant=\"outline\"\r\n                                          size=\"sm\"\r\n                                          className=\"flex-1 text-green-400 border-green-400/30 hover:bg-green-400/10\"\r\n                                          onClick={(e) => {\r\n                                            e.stopPropagation()\r\n                                            handleDownloadPdf(\r\n                                              feePlan.introducer_agreement!.pdf_url!,\r\n                                              feePlan.introducer_agreement!.reference_number\r\n                                            )\r\n                                          }}\r\n                                          disabled={downloadingPdf === feePlan.introducer_agreement.pdf_url}\r\n                                        >\r\n                                          {downloadingPdf === feePlan.introducer_agreement.pdf_url ? (\r\n                                            <Loader2 className=\"h-4 w-4 mr-1 animate-spin\" />\r\n                                          ) : (\r\n                                            <Download className=\"h-4 w-4 mr-1\" />\r\n                                          )}\r\n                                          Download\r\n                                        </Button>\r\n                                      </div>\r\n                                    )}\r\n                                  </div>\r\n                                ) : (\r\n                                  <div className=\"flex items-center gap-2 p-3 rounded-lg bg-amber-500/10 border border-amber-500/20\">\r\n                                    <AlertCircle className=\"h-4 w-4 text-amber-400\" />\r\n                                    <p className=\"text-sm text-amber-400\">No agreement generated yet</p>\r\n                                  </div>\r\n                                )}\r\n\r\n                                {/* Additional info */}\r\n                                <div className=\"mt-4 space-y-2\">\r\n                                  {feePlan.accepted_at && (\r\n                                    <div className=\"flex items-center gap-2 text-sm text-green-400\">\r\n                                      <CheckCircle2 className=\"h-4 w-4\" />\r\n                                      Accepted {formatDate(feePlan.accepted_at)}\r\n                                    </div>\r\n                                  )}\r\n                                  <div className=\"flex items-center gap-2 text-sm text-muted-foreground\">\r\n                                    <Calendar className=\"h-4 w-4\" />\r\n                                    Created {formatDate(feePlan.created_at)}\r\n                                  </div>\r\n                                </div>\r\n\r\n                                {/* Link to deal */}\r\n                                <Button\r\n                                  variant=\"outline\"\r\n                                  size=\"sm\"\r\n                                  className=\"mt-4 w-full\"\r\n                                  onClick={(e) => {\r\n                                    e.stopPropagation()\r\n                                    router.push(`/versotech_main/deals/${feePlan.deal?.id}?tab=fees`)\r\n                                  }}\r\n                                >\r\n                                  <ExternalLink className=\"h-4 w-4 mr-2\" />\r\n                                  View in Deal\r\n                                </Button>\r\n                              </div>\r\n                            </div>\r\n                          </div>\r\n                        )}\r\n                      </div>\r\n                    )\r\n                  })}\r\n                </div>\r\n              )}\r\n            </CardContent>\r\n          </Card>\r\n        </TabsContent>\r\n\r\n        {/* Referred Investors Tab */}\r\n        <TabsContent value=\"referred-investors\">\r\n          <Card>\r\n            <CardHeader>\r\n              <CardTitle>Referred Investors</CardTitle>\r\n              <CardDescription>\r\n                Investors dispatched through {introducer.legal_name}\r\n              </CardDescription>\r\n            </CardHeader>\r\n            <CardContent>\r\n              {referredInvestorsLoading ? (\r\n                <div className=\"flex items-center justify-center py-8\">\r\n                  <Loader2 className=\"h-8 w-8 animate-spin text-muted-foreground\" />\r\n                </div>\r\n              ) : referredInvestors.length === 0 ? (\r\n                <div className=\"flex flex-col items-center justify-center py-12 text-center\">\r\n                  <div className=\"p-4 rounded-2xl bg-gradient-to-br from-purple-500/10 to-pink-500/10 border border-purple-500/20 mb-4\">\r\n                    <Users className=\"h-10 w-10 text-purple-400/60\" />\r\n                  </div>\r\n                  <p className=\"text-muted-foreground mb-1\">No referred investors yet</p>\r\n                  <p className=\"text-sm text-muted-foreground/70 mb-4\">\r\n                    Investors dispatched through this introducer will appear here\r\n                  </p>\r\n                  <Button\r\n                    onClick={() => setDispatchDialogOpen(true)}\r\n                    className=\"mb-4 bg-gradient-to-r from-orange-600 to-amber-600 hover:from-orange-500 hover:to-amber-500 text-white\"\r\n                  >\r\n                    <Send className=\"h-4 w-4 mr-2\" />\r\n                    Dispatch Investor\r\n                  </Button>\r\n                  <div className=\"max-w-md p-4 rounded-lg bg-blue-500/10 border border-blue-500/20 text-left\">\r\n                    <div className=\"flex items-start gap-3\">\r\n                      <Info className=\"h-5 w-5 text-blue-400 mt-0.5 flex-shrink-0\" />\r\n                      <div>\r\n                        <p className=\"text-sm font-medium text-blue-400 mb-1\">How to link investors</p>\r\n                        <p className=\"text-xs text-muted-foreground\">\r\n                          Click \"Dispatch Investor\" above to link an investor from a deal where {introducer.legal_name} has\r\n                          an active fee agreement. You can also dispatch from the Deal's Members tab.\r\n                        </p>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              ) : (\r\n                <div className=\"space-y-3\">\r\n                  {referredInvestors.map((refInvestor) => (\r\n                    <div\r\n                      key={refInvestor.id}\r\n                      className=\"group flex items-center justify-between p-4 rounded-xl border border-white/10 hover:border-white/20 hover:bg-white/5 transition-all cursor-pointer\"\r\n                      onClick={() => router.push(`/versotech_main/deals/${refInvestor.deal?.id}?tab=members`)}\r\n                    >\r\n                      <div className=\"flex items-center gap-4\">\r\n                        <div className=\"p-2.5 rounded-lg bg-purple-500/20\">\r\n                          <User className=\"h-5 w-5 text-purple-400\" />\r\n                        </div>\r\n                        <div>\r\n                          <div className=\"font-medium text-foreground\">\r\n                            {refInvestor.investor?.legal_name || refInvestor.profile?.display_name || refInvestor.profile?.email || 'Unknown'}\r\n                          </div>\r\n                          <div className=\"text-sm text-muted-foreground flex items-center gap-2 mt-0.5\">\r\n                            <Briefcase className=\"h-3 w-3\" />\r\n                            {refInvestor.deal?.name || 'Unknown Deal'}\r\n                            {refInvestor.fee_plan && (\r\n                              <span className=\"text-xs text-muted-foreground/70\">\r\n                                • {refInvestor.fee_plan.name}\r\n                              </span>\r\n                            )}\r\n                          </div>\r\n                        </div>\r\n                      </div>\r\n                      <div className=\"flex items-center gap-3\">\r\n                        {refInvestor.subscription?.amount && (\r\n                          <div className=\"text-sm font-medium text-foreground\">\r\n                            {formatCurrency(refInvestor.subscription.amount)}\r\n                          </div>\r\n                        )}\r\n                        <Badge className={\r\n                          refInvestor.subscription?.status === 'funded'\r\n                            ? 'bg-green-500/20 text-green-400'\r\n                            : refInvestor.subscription?.status\r\n                              ? 'bg-yellow-500/20 text-yellow-400'\r\n                              : 'bg-gray-500/20 text-gray-400'\r\n                        }>\r\n                          {refInvestor.subscription?.status || 'Invited'}\r\n                        </Badge>\r\n                        <ExternalLink className=\"h-4 w-4 text-muted-foreground opacity-0 group-hover:opacity-100 transition-opacity\" />\r\n                      </div>\r\n                    </div>\r\n                  ))}\r\n                </div>\r\n              )}\r\n            </CardContent>\r\n          </Card>\r\n        </TabsContent>\r\n\r\n        {/* Agreements Tab */}\r\n        <TabsContent value=\"agreements\">\r\n          <Card>\r\n            <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-4\">\r\n              <div>\r\n                <CardTitle>Fee Agreements</CardTitle>\r\n                <CardDescription>\r\n                  Manage commission agreements with {introducer.legal_name}\r\n                </CardDescription>\r\n              </div>\r\n              <Button\r\n                onClick={() => setCreateAgreementOpen(true)}\r\n                className=\"bg-gradient-to-r from-amber-600 to-orange-600 hover:from-amber-500 hover:to-orange-500 text-white\"\r\n              >\r\n                <Plus className=\"h-4 w-4 mr-2\" />\r\n                Create Agreement\r\n              </Button>\r\n            </CardHeader>\r\n            <CardContent>\r\n              {agreements.length === 0 ? (\r\n                <div className=\"flex flex-col items-center justify-center py-12 text-center\">\r\n                  <div className=\"p-4 rounded-2xl bg-gradient-to-br from-amber-500/10 to-orange-500/10 border border-amber-500/20 mb-4\">\r\n                    <FileSignature className=\"h-10 w-10 text-amber-400/60\" />\r\n                  </div>\r\n                  <p className=\"text-muted-foreground mb-1\">No agreements yet</p>\r\n                  <p className=\"text-sm text-muted-foreground/70\">\r\n                    Create a fee agreement to enable introductions\r\n                  </p>\r\n                </div>\r\n              ) : (\r\n                <div className=\"space-y-3\">\r\n                  {agreements.map((agreement) => {\r\n                    const statusStyle = agreementStatusStyles[agreement.status] || {\r\n                      bg: 'bg-gray-500/20',\r\n                      text: 'text-gray-400',\r\n                      icon: <FileText className=\"h-3 w-3\" />\r\n                    }\r\n                    const isActive = agreement.status === 'active'\r\n                    const isDraft = agreement.status === 'draft'\r\n                    const canSign = agreement.status === 'pending_ceo_signature'\r\n\r\n                    return (\r\n                      <div\r\n                        key={agreement.id}\r\n                        className={`group relative flex items-center justify-between p-4 rounded-xl border transition-all duration-200 cursor-pointer\r\n                          ${isActive\r\n                            ? 'border-emerald-500/30 bg-gradient-to-r from-emerald-500/5 to-transparent hover:from-emerald-500/10'\r\n                            : 'border-white/10 hover:border-white/20 hover:bg-white/5'\r\n                          }`}\r\n                        onClick={() => router.push(`/versotech_main/introducer-agreements/${agreement.id}`)}\r\n                      >\r\n                        {/* Left side - Agreement info */}\r\n                        <div className=\"flex items-center gap-4\">\r\n                          <div className={`p-2.5 rounded-lg ${statusStyle.bg}`}>\r\n                            <FileSignature className={`h-5 w-5 ${statusStyle.text}`} />\r\n                          </div>\r\n                          <div>\r\n                            <div className=\"flex items-center gap-2\">\r\n                              <span className=\"font-medium text-foreground\">\r\n                                {agreement.reference_number || `Agreement ${agreement.id.slice(0, 8)}`}\r\n                              </span>\r\n                              <span className=\"text-sm text-muted-foreground\">\r\n                                • {formatBps(agreement.default_commission_bps || 0)}\r\n                              </span>\r\n                              {isActive && (\r\n                                <span className=\"text-xs px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-400 font-medium\">\r\n                                  Current\r\n                                </span>\r\n                              )}\r\n                            </div>\r\n                            <div className=\"text-sm text-muted-foreground mt-0.5 flex items-center gap-2\">\r\n                              {agreement.deal && (\r\n                                <span className=\"flex items-center gap-1\">\r\n                                  <Briefcase className=\"h-3 w-3\" />\r\n                                  {agreement.deal.name}\r\n                                </span>\r\n                              )}\r\n                              {agreement.effective_date && (\r\n                                <span>• {formatDate(agreement.effective_date)}</span>\r\n                              )}\r\n                              {agreement.expiry_date && (\r\n                                <span className=\"text-muted-foreground/70\">→ {formatDate(agreement.expiry_date)}</span>\r\n                              )}\r\n                              {!agreement.deal && !agreement.effective_date && (\r\n                                <>Created {formatDate(agreement.created_at)}</>\r\n                              )}\r\n                            </div>\r\n                          </div>\r\n                        </div>\r\n\r\n                        {/* Right side - Status and actions */}\r\n                        <div className=\"flex items-center gap-3\">\r\n                          {/* PDF Download Button */}\r\n                          {agreement.pdf_url && (\r\n                            <Button\r\n                              variant=\"outline\"\r\n                              size=\"sm\"\r\n                              className=\"h-8 gap-1.5 text-blue-400 border-blue-500/30 hover:bg-blue-500/10 hover:border-blue-500/50\"\r\n                              onClick={(e) => {\r\n                                e.stopPropagation()\r\n                                handleDownloadPdf(agreement.pdf_url!, agreement.reference_number)\r\n                              }}\r\n                              disabled={downloadingPdf === agreement.pdf_url}\r\n                            >\r\n                              {downloadingPdf === agreement.pdf_url ? (\r\n                                <div className=\"animate-spin rounded-full h-3 w-3 border-b border-blue-400\" />\r\n                              ) : (\r\n                                <FileDown className=\"h-3.5 w-3.5\" />\r\n                              )}\r\n                              <span className=\"hidden sm:inline\">PDF</span>\r\n                            </Button>\r\n                          )}\r\n\r\n                          <Badge className={`${statusStyle.bg} ${statusStyle.text} gap-1.5 font-medium`}>\r\n                            {statusStyle.icon}\r\n                            {formatAgreementStatus(agreement.status)}\r\n                          </Badge>\r\n\r\n                          {/* Three-dots menu: Only Preview and Download for documents */}\r\n                          {agreement.pdf_url && (\r\n                            <DropdownMenu>\r\n                              <DropdownMenuTrigger asChild onClick={(e) => e.stopPropagation()}>\r\n                                <Button\r\n                                  variant=\"ghost\"\r\n                                  size=\"sm\"\r\n                                  className=\"h-8 w-8 p-0 opacity-0 group-hover:opacity-100 transition-opacity\"\r\n                                >\r\n                                  <MoreHorizontal className=\"h-4 w-4\" />\r\n                                </Button>\r\n                              </DropdownMenuTrigger>\r\n                              <DropdownMenuContent align=\"end\" className=\"w-48\">\r\n                                <DropdownMenuItem\r\n                                  onClick={(e) => {\r\n                                    e.stopPropagation()\r\n                                    handlePreviewPdf(agreement.pdf_url!)\r\n                                  }}\r\n                                >\r\n                                  <Eye className=\"h-4 w-4 mr-2\" />\r\n                                  Preview\r\n                                </DropdownMenuItem>\r\n                                <DropdownMenuItem\r\n                                  onClick={(e) => {\r\n                                    e.stopPropagation()\r\n                                    handleDownloadPdf(agreement.pdf_url!, agreement.reference_number)\r\n                                  }}\r\n                                  disabled={downloadingPdf === agreement.pdf_url}\r\n                                >\r\n                                  <Download className=\"h-4 w-4 mr-2\" />\r\n                                  {downloadingPdf === agreement.pdf_url ? 'Downloading...' : 'Download'}\r\n                                </DropdownMenuItem>\r\n                              </DropdownMenuContent>\r\n                            </DropdownMenu>\r\n                          )}\r\n                        </div>\r\n                      </div>\r\n                    )\r\n                  })}\r\n                </div>\r\n              )}\r\n            </CardContent>\r\n          </Card>\r\n        </TabsContent>\r\n\r\n        {/* Introductions Tab */}\r\n        <TabsContent value=\"introductions\">\r\n          <Card>\r\n            <CardHeader>\r\n              <CardTitle>Introductions</CardTitle>\r\n              <CardDescription>\r\n                All prospects introduced by {introducer.legal_name}\r\n              </CardDescription>\r\n            </CardHeader>\r\n            <CardContent>\r\n              {introductions.length === 0 ? (\r\n                <div className=\"flex flex-col items-center justify-center py-8 text-center\">\r\n                  <TrendingUp className=\"h-12 w-12 text-muted-foreground mb-4 opacity-50\" />\r\n                  <p className=\"text-muted-foreground\">No introductions yet</p>\r\n                </div>\r\n              ) : (\r\n                <div className=\"space-y-3\">\r\n                  {introductions.map((intro) => (\r\n                    <div\r\n                      key={intro.id}\r\n                      className=\"flex items-center justify-between p-4 rounded-lg border border-white/10 hover:bg-white/5 transition-colors\"\r\n                    >\r\n                      <div>\r\n                        <div className=\"font-medium text-foreground\">\r\n                          {intro.investor?.legal_name || intro.prospect_email || 'Unknown'}\r\n                        </div>\r\n                        <div className=\"text-sm text-muted-foreground\">\r\n                          {intro.prospect_email && intro.investor?.legal_name && (\r\n                            <span className=\"mr-2\">{intro.prospect_email}</span>\r\n                          )}\r\n                          {intro.deal?.name || 'No deal linked'}\r\n                          {intro.introduced_at && ` • ${formatDate(intro.introduced_at)}`}\r\n                        </div>\r\n                      </div>\r\n                      <Badge className={introStatusStyles[intro.status] ?? 'bg-gray-500/20 text-gray-400'}>\r\n                        {intro.status}\r\n                      </Badge>\r\n                    </div>\r\n                  ))}\r\n                </div>\r\n              )}\r\n            </CardContent>\r\n          </Card>\r\n        </TabsContent>\r\n\r\n        {/* Commissions Tab */}\r\n        <TabsContent value=\"commissions\">\r\n          <Card>\r\n            <CardHeader>\r\n              <CardTitle>Commission History</CardTitle>\r\n              <CardDescription>\r\n                All commissions earned by {introducer.legal_name}\r\n              </CardDescription>\r\n            </CardHeader>\r\n            <CardContent>\r\n              {commissions.length === 0 ? (\r\n                <div className=\"flex flex-col items-center justify-center py-8 text-center\">\r\n                  <DollarSign className=\"h-12 w-12 text-muted-foreground mb-4 opacity-50\" />\r\n                  <p className=\"text-muted-foreground\">No commissions yet</p>\r\n                </div>\r\n              ) : (\r\n                <div className=\"space-y-3\">\r\n                  {commissions.map((comm) => (\r\n                    <div\r\n                      key={comm.id}\r\n                      className=\"flex items-center justify-between p-4 rounded-lg border border-white/10 hover:bg-white/5 transition-colors\"\r\n                    >\r\n                      <div>\r\n                        <div className=\"font-medium text-foreground\">\r\n                          {formatCurrency(comm.accrual_amount)}\r\n                        </div>\r\n                        <div className=\"text-sm text-muted-foreground\">\r\n                          {comm.investor?.legal_name || 'Unknown investor'}\r\n                          {comm.deal && (\r\n                            <> • {comm.deal.name}</>\r\n                          )}\r\n                        </div>\r\n                        <div className=\"text-xs text-muted-foreground\">\r\n                          Created {formatDate(comm.created_at)}\r\n                          {comm.paid_at && ` • Paid ${formatDate(comm.paid_at)}`}\r\n                        </div>\r\n                      </div>\r\n                      <Badge className={commissionStatusStyles[comm.status] ?? 'bg-gray-500/20 text-gray-400'}>\r\n                        {comm.status}\r\n                      </Badge>\r\n                    </div>\r\n                  ))}\r\n                </div>\r\n              )}\r\n            </CardContent>\r\n          </Card>\r\n        </TabsContent>\r\n\r\n        {/* KYC Documents Tab */}\r\n        <TabsContent value=\"kyc\">\r\n          <KYCDocumentsTab\r\n            entityType=\"introducer\"\r\n            entityId={introducer.id}\r\n            entityName={introducer.legal_name}\r\n          />\r\n        </TabsContent>\r\n\r\n        {/* Bank Details Tab */}\r\n        <TabsContent value=\"bank\">\r\n          <BankDetailsTab\r\n            entityType=\"introducer\"\r\n            entityId={introducer.id}\r\n            entityName={introducer.legal_name}\r\n          />\r\n        </TabsContent>\r\n\r\n        {/* Activity Tab */}\r\n        <TabsContent value=\"activity\">\r\n          <ActivityTimelineTab\r\n            entityType=\"introducer\"\r\n            entityId={introducer.id}\r\n            entityName={introducer.legal_name}\r\n          />\r\n        </TabsContent>\r\n      </Tabs>\r\n\r\n      {/* Dialogs */}\r\n      <EditIntroducerDialog\r\n        open={editDialogOpen}\r\n        onOpenChange={setEditDialogOpen}\r\n        introducer={introducerForDialog}\r\n      />\r\n\r\n      <InviteUserDialog\r\n        open={inviteDialogOpen}\r\n        onOpenChange={setInviteDialogOpen}\r\n        entityType=\"introducer\"\r\n        entityId={introducer.id}\r\n        entityName={introducer.legal_name}\r\n      />\r\n\r\n      <CreateAgreementDialog\r\n        open={createAgreementOpen}\r\n        onOpenChange={setCreateAgreementOpen}\r\n        introducerId={introducer.id}\r\n        introducerName={introducer.legal_name}\r\n        defaultCommissionBps={introducer.default_commission_bps || 100}\r\n      />\r\n\r\n      <DispatchIntroducerInvestorDialog\r\n        open={dispatchDialogOpen}\r\n        onOpenChange={setDispatchDialogOpen}\r\n        introducerId={introducer.id}\r\n        introducerName={introducer.legal_name}\r\n        feePlans={feePlans}\r\n      />\r\n\r\n      {introducer.type === 'individual' && (\r\n        <EntityKYCEditDialog\r\n          open={kycDialogOpen}\r\n          onOpenChange={setKycDialogOpen}\r\n          entityType=\"introducer\"\r\n          entityId={introducer.id}\r\n          entityName={introducer.legal_name}\r\n          apiEndpoint={`/api/admin/introducers/${introducer.id}`}\r\n          initialData={{\r\n            first_name: introducer.first_name ?? undefined,\r\n            middle_name: introducer.middle_name ?? undefined,\r\n            last_name: introducer.last_name ?? undefined,\r\n            name_suffix: introducer.name_suffix ?? undefined,\r\n            date_of_birth: introducer.date_of_birth ?? undefined,\r\n            country_of_birth: introducer.country_of_birth ?? undefined,\r\n            nationality: introducer.nationality ?? undefined,\r\n            email: introducer.email ?? undefined,\r\n            phone_mobile: introducer.phone_mobile ?? undefined,\r\n            phone_office: introducer.phone_office ?? undefined,\r\n            residential_street: introducer.residential_street ?? undefined,\r\n            residential_line_2: introducer.residential_line_2 ?? undefined,\r\n            residential_city: introducer.residential_city ?? undefined,\r\n            residential_state: introducer.residential_state ?? undefined,\r\n            residential_postal_code: introducer.residential_postal_code ?? undefined,\r\n            residential_country: introducer.residential_country ?? undefined,\r\n            is_us_citizen: introducer.is_us_citizen ?? undefined,\r\n            is_us_taxpayer: introducer.is_us_taxpayer ?? undefined,\r\n            us_taxpayer_id: introducer.us_taxpayer_id ?? undefined,\r\n            country_of_tax_residency: introducer.country_of_tax_residency ?? undefined,\r\n            id_type: introducer.id_type ?? undefined,\r\n            id_number: introducer.id_number ?? undefined,\r\n            id_issue_date: introducer.id_issue_date ?? undefined,\r\n            id_expiry_date: introducer.id_expiry_date ?? undefined,\r\n            id_issuing_country: introducer.id_issuing_country ?? undefined,\r\n          }}\r\n          onSuccess={() => router.refresh()}\r\n        />\r\n      )}\r\n    </div>\r\n  )\r\n}\r\n","'use client'\n\nimport { useState, useEffect, useMemo } from 'react'\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogHeader,\n  DialogTitle,\n} from '@/components/ui/dialog'\nimport { Button } from '@/components/ui/button'\nimport { Label } from '@/components/ui/label'\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from '@/components/ui/select'\nimport {\n  Loader2,\n  Users,\n  Briefcase,\n  AlertCircle,\n  CheckCircle2,\n  FileSignature,\n  ArrowRight,\n} from 'lucide-react'\nimport { useRouter } from 'next/navigation'\nimport { toast } from 'sonner'\nimport { Badge } from '@/components/ui/badge'\nimport { cn } from '@/lib/utils'\n\ninterface DispatchIntroducerInvestorDialogProps {\n  open: boolean\n  onOpenChange: (open: boolean) => void\n  introducerId: string\n  introducerName: string\n  feePlans: FeePlan[]\n}\n\ninterface FeePlan {\n  id: string\n  name: string\n  status: 'draft' | 'sent' | 'pending_signature' | 'accepted' | 'rejected'\n  is_active: boolean\n  deal: {\n    id: string\n    name: string\n    status: string\n  } | null\n  term_sheet: {\n    id: string\n    version: number\n  } | null\n  introducer_agreement: {\n    id: string\n    reference_number: string | null\n    status: string\n    signed_date: string | null\n  } | null\n}\n\ninterface LinkableInvestor {\n  user_id: string\n  investor_id: string\n  display_name: string\n  email: string\n  current_role: string\n}\n\nexport function DispatchIntroducerInvestorDialog({\n  open,\n  onOpenChange,\n  introducerId,\n  introducerName,\n  feePlans,\n}: DispatchIntroducerInvestorDialogProps) {\n  const router = useRouter()\n  const [loading, setLoading] = useState(false)\n  const [error, setError] = useState<string | null>(null)\n\n  // Step 1: Select Deal (only deals with valid fee plans + active agreements)\n  const [selectedDealId, setSelectedDealId] = useState<string>('')\n\n  // Step 2: Select Fee Plan (auto-populated from deal selection)\n  const [selectedFeePlanId, setSelectedFeePlanId] = useState<string>('')\n  const [selectedFeePlan, setSelectedFeePlan] = useState<FeePlan | null>(null)\n\n  // Step 3: Select Investor\n  const [linkableInvestors, setLinkableInvestors] = useState<LinkableInvestor[]>([])\n  const [linkableInvestorsLoading, setLinkableInvestorsLoading] = useState(false)\n  const [selectedInvestorId, setSelectedInvestorId] = useState<string>('')\n\n  // Filter fee plans to only show those with:\n  // 1. status='accepted' AND is_active=true\n  // 2. introducer_agreement?.status='active' AND signed_date not null\n  // Memoized to prevent infinite re-render loops\n  const validFeePlans = useMemo(() =>\n    feePlans.filter(fp =>\n      fp.status === 'accepted' &&\n      fp.is_active &&\n      fp.introducer_agreement?.status === 'active' &&\n      fp.introducer_agreement?.signed_date !== null &&\n      fp.deal !== null\n    ),\n    [feePlans]\n  )\n\n  // Get unique deals from valid fee plans\n  const dealsWithValidPlans = useMemo(() =>\n    validFeePlans.reduce((acc, fp) => {\n      if (fp.deal && !acc.find(d => d.id === fp.deal!.id)) {\n        acc.push(fp.deal)\n      }\n      return acc\n    }, [] as { id: string; name: string; status: string }[]),\n    [validFeePlans]\n  )\n\n  // Get fee plans for selected deal\n  const feePlansForDeal = useMemo(() =>\n    selectedDealId\n      ? validFeePlans.filter(fp => fp.deal?.id === selectedDealId)\n      : [],\n    [selectedDealId, validFeePlans]\n  )\n\n  // Reset form when dialog closes\n  useEffect(() => {\n    if (!open) {\n      setSelectedDealId('')\n      setSelectedFeePlanId('')\n      setSelectedFeePlan(null)\n      setLinkableInvestors([])\n      setSelectedInvestorId('')\n      setError(null)\n    }\n  }, [open])\n\n  // When deal changes, reset fee plan and investor\n  useEffect(() => {\n    setSelectedFeePlanId('')\n    setSelectedFeePlan(null)\n    setLinkableInvestors([])\n    setSelectedInvestorId('')\n\n    // Auto-select if only one fee plan for this deal\n    // feePlansForDeal is already computed with new selectedDealId (useMemo runs before effects)\n    if (feePlansForDeal.length === 1) {\n      setSelectedFeePlanId(feePlansForDeal[0].id)\n      setSelectedFeePlan(feePlansForDeal[0])\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [selectedDealId]) // Only trigger on deal change, not feePlansForDeal reference change\n\n  // Update selectedFeePlan when fee plan ID changes\n  useEffect(() => {\n    if (!selectedFeePlanId) {\n      setSelectedFeePlan(null)\n      setLinkableInvestors([])\n      setSelectedInvestorId('')\n      return\n    }\n\n    const fp = validFeePlans.find(p => p.id === selectedFeePlanId)\n    setSelectedFeePlan(fp || null)\n  }, [selectedFeePlanId, validFeePlans])\n\n  // Fetch linkable investors when fee plan is selected\n  // Uses AbortController to prevent race conditions when user quickly switches selections\n  useEffect(() => {\n    const dealId = selectedFeePlan?.deal?.id\n    const termSheetId = selectedFeePlan?.term_sheet?.id\n\n    if (!dealId || !termSheetId) {\n      setLinkableInvestors([])\n      setSelectedInvestorId('')\n      return\n    }\n\n    const abortController = new AbortController()\n\n    const fetchInvestors = async () => {\n      setLinkableInvestorsLoading(true)\n      setLinkableInvestors([])\n      setSelectedInvestorId('')\n\n      try {\n        const response = await fetch(\n          `/api/deals/${dealId}/linkable-investors?term_sheet_id=${termSheetId}`,\n          { signal: abortController.signal }\n        )\n        if (response.ok) {\n          const data = await response.json()\n          setLinkableInvestors(data.investors || [])\n        } else {\n          // API returned an error - show empty list (error is non-critical)\n          console.error('Failed to fetch linkable investors:', response.status, response.statusText)\n          setLinkableInvestors([])\n        }\n      } catch (err: any) {\n        // Ignore abort errors - they're expected when selection changes quickly\n        if (err.name !== 'AbortError') {\n          console.error('Failed to fetch linkable investors:', err)\n        }\n      } finally {\n        if (!abortController.signal.aborted) {\n          setLinkableInvestorsLoading(false)\n        }\n      }\n    }\n\n    fetchInvestors()\n\n    // Cleanup: abort the fetch if selection changes before it completes\n    return () => abortController.abort()\n  }, [selectedFeePlan])\n\n  const handleSubmit = async () => {\n    if (!selectedFeePlan || !selectedInvestorId) {\n      setError('Please complete all selections')\n      return\n    }\n\n    // Defensive check - deal should always exist for valid fee plans\n    if (!selectedFeePlan.deal?.id) {\n      setError('Invalid fee plan selected - missing deal information')\n      return\n    }\n\n    setLoading(true)\n    setError(null)\n\n    try {\n      const response = await fetch(\n        `/api/deals/${selectedFeePlan.deal.id}/members/${selectedInvestorId}`,\n        {\n          method: 'PATCH',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify({\n            referred_by_entity_id: introducerId,\n            referred_by_entity_type: 'introducer',\n            assigned_fee_plan_id: selectedFeePlanId,\n            role: 'introducer_investor'\n          }),\n        }\n      )\n\n      if (!response.ok) {\n        const data = await response.json()\n        throw new Error(data.error || 'Failed to link investor to introducer')\n      }\n\n      toast.success('Investor successfully linked to introducer')\n      onOpenChange(false)\n      router.refresh()\n    } catch (err: any) {\n      setError(err.message)\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  const isFormValid = selectedDealId && selectedFeePlanId && selectedInvestorId\n\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent className=\"max-w-lg\">\n        <DialogHeader>\n          <DialogTitle>Dispatch Investor for {introducerName}</DialogTitle>\n          <DialogDescription>\n            Link an investor to this introducer using an active fee agreement\n          </DialogDescription>\n        </DialogHeader>\n\n        <div className=\"space-y-6 py-4\">\n          {/* No valid fee plans warning */}\n          {validFeePlans.length === 0 ? (\n            <div className=\"p-4 rounded-lg border border-amber-500/30 bg-amber-500/5\">\n              <div className=\"flex items-start gap-3\">\n                <AlertCircle className=\"h-5 w-5 text-amber-400 mt-0.5 flex-shrink-0\" />\n                <div>\n                  <p className=\"text-sm font-medium text-amber-300\">No active fee agreements</p>\n                  <p className=\"text-xs text-muted-foreground mt-1\">\n                    {introducerName} has no active fee agreements with signed terms.\n                    Create and sign an introducer agreement from a deal first.\n                  </p>\n                </div>\n              </div>\n            </div>\n          ) : (\n            <>\n              {/* Step 1: Select Deal */}\n              <div className=\"space-y-2\">\n                <Label className=\"flex items-center gap-2\">\n                  <span className=\"flex items-center justify-center w-5 h-5 rounded-full bg-primary/20 text-primary text-xs font-medium\">1</span>\n                  Select Deal\n                </Label>\n                <Select value={selectedDealId} onValueChange={setSelectedDealId}>\n                  <SelectTrigger className={cn(selectedDealId && 'border-primary/50')}>\n                    <SelectValue placeholder=\"Select a deal\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {dealsWithValidPlans.map((deal) => (\n                      <SelectItem key={deal.id} value={deal.id}>\n                        <div className=\"flex items-center gap-2\">\n                          <Briefcase className=\"h-4 w-4 text-muted-foreground\" />\n                          <span>{deal.name}</span>\n                        </div>\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n                <p className=\"text-xs text-muted-foreground\">\n                  Only deals with active signed agreements are shown\n                </p>\n              </div>\n\n              {/* Step 2: Select Fee Plan */}\n              {selectedDealId && (\n                <div className=\"space-y-2\">\n                  <Label className=\"flex items-center gap-2\">\n                    <span className=\"flex items-center justify-center w-5 h-5 rounded-full bg-primary/20 text-primary text-xs font-medium\">2</span>\n                    Select Fee Plan\n                  </Label>\n                  {feePlansForDeal.length === 1 ? (\n                    <div className=\"p-3 rounded-lg bg-muted/50 border border-primary/30\">\n                      <div className=\"flex items-center gap-3\">\n                        <FileSignature className=\"h-5 w-5 text-primary\" />\n                        <div>\n                          <p className=\"font-medium text-sm\">{feePlansForDeal[0].name}</p>\n                          {feePlansForDeal[0].term_sheet && (\n                            <p className=\"text-xs text-muted-foreground\">\n                              Term Sheet v{feePlansForDeal[0].term_sheet.version}\n                            </p>\n                          )}\n                        </div>\n                        <Badge className=\"ml-auto bg-green-500/20 text-green-400\">\n                          Active\n                        </Badge>\n                      </div>\n                    </div>\n                  ) : (\n                    <Select value={selectedFeePlanId} onValueChange={setSelectedFeePlanId}>\n                      <SelectTrigger className={cn(selectedFeePlanId && 'border-primary/50')}>\n                        <SelectValue placeholder=\"Select a fee plan\" />\n                      </SelectTrigger>\n                      <SelectContent>\n                        {feePlansForDeal.map((fp) => (\n                          <SelectItem key={fp.id} value={fp.id}>\n                            <div className=\"flex flex-col\">\n                              <span className=\"font-medium\">{fp.name}</span>\n                              {fp.term_sheet && (\n                                <span className=\"text-xs text-muted-foreground\">\n                                  Term Sheet v{fp.term_sheet.version}\n                                </span>\n                              )}\n                            </div>\n                          </SelectItem>\n                        ))}\n                      </SelectContent>\n                    </Select>\n                  )}\n                </div>\n              )}\n\n              {/* Step 3: Select Investor */}\n              {selectedFeePlan && (\n                <div className=\"space-y-2\">\n                  <Label className=\"flex items-center gap-2\">\n                    <span className=\"flex items-center justify-center w-5 h-5 rounded-full bg-primary/20 text-primary text-xs font-medium\">3</span>\n                    Select Investor\n                  </Label>\n                  {linkableInvestorsLoading ? (\n                    <div className=\"flex items-center gap-2 py-3\">\n                      <Loader2 className=\"h-4 w-4 animate-spin text-muted-foreground\" />\n                      <span className=\"text-sm text-muted-foreground\">Loading eligible investors...</span>\n                    </div>\n                  ) : linkableInvestors.length === 0 ? (\n                    <div className=\"p-3 rounded-lg border border-blue-500/30 bg-blue-500/5\">\n                      <div className=\"flex items-start gap-2\">\n                        <AlertCircle className=\"h-4 w-4 text-blue-400 mt-0.5\" />\n                        <div>\n                          <p className=\"text-sm font-medium text-blue-300\">No eligible investors</p>\n                          <p className=\"text-xs text-blue-300/80 mt-1\">\n                            No investors on this term sheet are available.\n                            They may already be linked to an introducer.\n                          </p>\n                        </div>\n                      </div>\n                    </div>\n                  ) : (\n                    <Select value={selectedInvestorId} onValueChange={setSelectedInvestorId}>\n                      <SelectTrigger className={cn(selectedInvestorId && 'border-primary/50')}>\n                        <SelectValue placeholder=\"Select an investor\" />\n                      </SelectTrigger>\n                      <SelectContent>\n                        {linkableInvestors.map((investor) => (\n                          <SelectItem key={investor.user_id} value={investor.user_id}>\n                            <div className=\"flex items-center gap-2\">\n                              <Users className=\"h-4 w-4 text-muted-foreground\" />\n                              <div className=\"flex flex-col\">\n                                <span>{investor.display_name}</span>\n                                {investor.email && (\n                                  <span className=\"text-xs text-muted-foreground\">{investor.email}</span>\n                                )}\n                              </div>\n                            </div>\n                          </SelectItem>\n                        ))}\n                      </SelectContent>\n                    </Select>\n                  )}\n                </div>\n              )}\n\n              {/* Summary */}\n              {isFormValid && (\n                <div className=\"p-3 rounded-lg bg-emerald-500/10 border border-emerald-500/30\">\n                  <div className=\"flex items-start gap-2\">\n                    <CheckCircle2 className=\"h-5 w-5 text-emerald-400 mt-0.5\" />\n                    <div className=\"text-sm\">\n                      <p className=\"text-emerald-300 font-medium\">Ready to dispatch</p>\n                      <p className=\"text-emerald-300/80 text-xs mt-1\">\n                        The selected investor will be linked to <strong>{introducerName}</strong> using\n                        the <strong>{selectedFeePlan?.name}</strong> fee plan.\n                      </p>\n                    </div>\n                  </div>\n                </div>\n              )}\n            </>\n          )}\n\n          {/* Error Display */}\n          {error && (\n            <div className=\"p-3 rounded-lg bg-destructive/10 text-destructive text-sm\">\n              {error}\n            </div>\n          )}\n\n          {/* Actions */}\n          <div className=\"flex justify-end gap-2 pt-4\">\n            <Button variant=\"outline\" onClick={() => onOpenChange(false)} disabled={loading}>\n              Cancel\n            </Button>\n            <Button\n              onClick={handleSubmit}\n              disabled={loading || !isFormValid || validFeePlans.length === 0}\n              className=\"gap-2\"\n            >\n              {loading ? (\n                <>\n                  <Loader2 className=\"h-4 w-4 animate-spin\" />\n                  Linking...\n                </>\n              ) : (\n                <>\n                  <ArrowRight className=\"h-4 w-4\" />\n                  Dispatch Investor\n                </>\n              )}\n            </Button>\n          </div>\n        </div>\n      </DialogContent>\n    </Dialog>\n  )\n}\n"],"names":[],"mappings":"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"}