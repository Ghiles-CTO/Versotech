module.exports=[368180,a=>{"use strict";var b=a.i(352584),c=a.i(611038),d=a.i(714814),e=a.i(497412),f=a.i(975965),g=a.i(278541),h=a.i(176531),i=a.i(425622),j=a.i(816854),k=a.i(405708),l=a.i(478870),m=a.i(540316),n=a.i(787957),o=a.i(871057),p=a.i(47748),q=a.i(405398),r=a.i(941766),s=a.i(838086),t=a.i(399580),u=a.i(877918),v=a.i(587143),w=a.i(3321),x=a.i(618287),y=a.i(134303),z=a.i(264890),A=a.i(966494),B=a.i(284169),C=a.i(181608),D=a.i(421908),E=a.i(15788),F=a.i(951870),G=a.i(470305),H=a.i(663475),I=a.i(249464),J=a.i(468095),K=a.i(289633);function L({dealId:a,entityId:d,triggerLabel:e,onUploaded:f,defaultFolderId:g=null,folderOptions:h=[]}){let i=(0,K.useRouter)(),[k,l]=(0,c.useState)(!1),[m,n]=(0,c.useState)(!1),[o,p]=(0,c.useState)(null),[q,r]=(0,c.useState)(null),[s,t]=(0,c.useState)("contract"),[u,x]=(0,c.useState)(""),[y,z]=(0,c.useState)(""),[A,B]=(0,c.useState)("file"),[E,L]=(0,c.useState)(""),[M,N]=(0,c.useState)("external"),[O,P]=(0,c.useState)(g),Q=!!(a||d),R="file"===A;(0,c.useEffect)(()=>{k||(B("file"),r(null),L(""),N("external"),p(null),P(g??null))},[k,g]);let S=async()=>{if(!Q)return void p("Document scope is not configured");n(!0),p(null);try{if("file"===A){if(!q){p("Please select a file"),n(!1);return}let b=new FormData;b.append("file",q),b.append("type",s),u.trim()&&b.append("name",u.trim()),y.trim()&&b.append("description",y.trim()),a&&b.append("deal_id",a),d&&(b.append("entity_id",d),b.append("vehicle_id",d)),O&&b.append("folder_id",O);let c=await fetch("/api/documents/upload",{method:"POST",body:b});if(!c.ok){let a=await c.json();throw Error(a.error||"Failed to upload document")}}else{if(!E.trim()){p("Please provide a valid external link"),n(!1);return}let b={name:u.trim()||null,type:s||null,description:y.trim()||null,external_url:E.trim(),link_type:M};a&&(b.deal_id=a),d&&(b.entity_id=d,b.vehicle_id=d),O&&(b.folder_id=O);let c=await fetch("/api/documents/link",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(b)});if(!c.ok){let a=await c.json();throw Error(a.error||"Failed to save link")}}r(null),x(""),z(""),L(""),N("external"),B("file"),l(!1),P(g??null),i.refresh(),f?.()}catch(a){p(a.message)}finally{n(!1)}};return(0,b.jsxs)(G.Dialog,{open:k,onOpenChange:l,children:[(0,b.jsx)(G.DialogTrigger,{asChild:!0,children:(0,b.jsxs)(D.Button,{className:"gap-2",children:[(0,b.jsx)(J.Upload,{className:"h-4 w-4"}),e||"Upload Document"]})}),(0,b.jsxs)(G.DialogContent,{className:"bg-background border-border max-w-2xl",children:[(0,b.jsxs)(G.DialogHeader,{children:[(0,b.jsxs)(G.DialogTitle,{className:"flex items-center gap-2 text-foreground",children:[(0,b.jsx)(J.Upload,{className:"h-5 w-5 text-emerald-500 dark:text-emerald-400"}),"Upload Document"]}),(0,b.jsxs)(G.DialogDescription,{className:"text-muted-foreground",children:["Add a document scoped to this ",a?"deal":"entity"]})]}),h.length>0&&(0,b.jsxs)("div",{className:"mt-4 space-y-2",children:[(0,b.jsx)(I.Label,{htmlFor:"doc-folder-select",className:"text-sm font-medium text-foreground",children:"Folder"}),(0,b.jsxs)(F.Select,{value:O??"none",onValueChange:a=>P("none"===a?null:a),children:[(0,b.jsx)(F.SelectTrigger,{id:"doc-folder-select",className:"bg-background border-input text-foreground",children:(0,b.jsx)(F.SelectValue,{placeholder:"Select folder"})}),(0,b.jsxs)(F.SelectContent,{className:"bg-popover border-border",children:[(0,b.jsx)(F.SelectItem,{value:"none",className:"text-foreground",children:"Unfiled"}),h.map(a=>(0,b.jsx)(F.SelectItem,{value:a.id,className:"text-foreground",children:a.path??a.name},a.id))]})]})]}),(0,b.jsxs)(C.Tabs,{value:A,onValueChange:a=>B(a),children:[(0,b.jsxs)(C.TabsList,{className:"grid grid-cols-2 bg-muted/50 border border-border",children:[(0,b.jsxs)(C.TabsTrigger,{value:"file",className:"data-[state=active]:bg-emerald-500/20 data-[state=active]:text-emerald-800 dark:data-[state=active]:text-emerald-100 text-foreground",children:[(0,b.jsx)(J.Upload,{className:"h-4 w-4 mr-2"}),"Upload File"]}),(0,b.jsxs)(C.TabsTrigger,{value:"link",className:"data-[state=active]:bg-emerald-500/20 data-[state=active]:text-emerald-800 dark:data-[state=active]:text-emerald-100 text-foreground",children:[(0,b.jsx)(j.FileText,{className:"h-4 w-4 mr-2"}),"Link Document"]})]}),(0,b.jsxs)(C.TabsContent,{value:"file",className:"mt-4 space-y-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(I.Label,{htmlFor:"doc_type_file",className:"text-sm font-medium text-foreground",children:"Document Type *"}),(0,b.jsxs)(F.Select,{value:s,onValueChange:t,children:[(0,b.jsx)(F.SelectTrigger,{id:"doc_type_file",className:"bg-background border-input text-foreground",children:(0,b.jsx)(F.SelectValue,{})}),(0,b.jsxs)(F.SelectContent,{className:"bg-popover border-border",children:[(0,b.jsx)(F.SelectItem,{value:"nda",className:"text-foreground",children:"NDA"}),(0,b.jsx)(F.SelectItem,{value:"term_sheet",className:"text-foreground",children:"Term Sheet"}),(0,b.jsx)(F.SelectItem,{value:"subscription",className:"text-foreground",children:"Subscription Agreement"}),(0,b.jsx)(F.SelectItem,{value:"contract",className:"text-foreground",children:"Contract"}),(0,b.jsx)(F.SelectItem,{value:"report",className:"text-foreground",children:"Report"}),(0,b.jsx)(F.SelectItem,{value:"other",className:"text-foreground",children:"Other"})]})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(I.Label,{htmlFor:"doc_name_file",className:"text-sm font-medium text-foreground",children:"Title"}),(0,b.jsx)(H.Input,{id:"doc_name_file",placeholder:"e.g., Board Resolution - Jan 2025",value:u,onChange:a=>x(a.target.value),className:"bg-background border-input text-foreground placeholder:text-muted-foreground focus:border-emerald-400/50 focus:ring-emerald-400/20"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(I.Label,{htmlFor:"doc_description_file",className:"text-sm font-medium text-foreground",children:"Description"}),(0,b.jsx)(H.Input,{id:"doc_description_file",placeholder:"Optional summary or context",value:y,onChange:a=>z(a.target.value),className:"bg-background border-input text-foreground placeholder:text-muted-foreground focus:border-emerald-400/50 focus:ring-emerald-400/20"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(I.Label,{htmlFor:"file-input",className:"text-sm font-medium text-foreground",children:"File *"}),(0,b.jsx)(H.Input,{id:"file-input",type:"file",onChange:a=>r(a.target.files?.[0]||null),accept:".pdf,.doc,.docx,.xls,.xlsx",className:"bg-background border-input text-foreground file:text-foreground"}),q&&(0,b.jsxs)("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[(0,b.jsx)(j.FileText,{className:"h-4 w-4"}),(0,b.jsx)("span",{className:"text-foreground",children:q.name}),(0,b.jsxs)("span",{className:"text-xs",children:["(",(q.size/1024).toFixed(1)," KB)"]})]})]})]}),(0,b.jsxs)(C.TabsContent,{value:"link",className:"mt-4 space-y-4",children:[(0,b.jsxs)("div",{className:"rounded-lg border border-border bg-muted/50 p-4 space-y-3",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 pb-2 border-b border-border",children:[(0,b.jsx)("div",{className:"h-8 w-8 rounded-full bg-emerald-500/20 flex items-center justify-center",children:(0,b.jsx)(j.FileText,{className:"h-4 w-4 text-emerald-600 dark:text-emerald-400"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{className:"text-sm font-semibold text-foreground",children:"Link External Document"}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"Connect to documents stored in Google Drive or other platforms"})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(I.Label,{htmlFor:"link-type",className:"text-sm font-medium text-foreground",children:"Link Source *"}),(0,b.jsxs)(F.Select,{value:M,onValueChange:N,children:[(0,b.jsx)(F.SelectTrigger,{id:"link-type",className:"bg-background border-input text-foreground",children:(0,b.jsx)(F.SelectValue,{})}),(0,b.jsxs)(F.SelectContent,{className:"bg-popover border-border",children:[(0,b.jsx)(F.SelectItem,{value:"google_drive",className:"text-foreground",children:(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("div",{className:"h-4 w-4 rounded bg-blue-500/20 flex items-center justify-center",children:(0,b.jsx)("span",{className:"text-xs",children:"G"})}),"Google Drive"]})}),(0,b.jsx)(F.SelectItem,{value:"sharepoint",className:"text-foreground",children:(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("div",{className:"h-4 w-4 rounded bg-blue-500/20 flex items-center justify-center",children:(0,b.jsx)("span",{className:"text-xs",children:"S"})}),"SharePoint"]})}),(0,b.jsx)(F.SelectItem,{value:"dropbox",className:"text-foreground",children:(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("div",{className:"h-4 w-4 rounded bg-blue-500/20 flex items-center justify-center",children:(0,b.jsx)("span",{className:"text-xs",children:"D"})}),"Dropbox"]})}),(0,b.jsx)(F.SelectItem,{value:"external",className:"text-foreground",children:"External URL"}),(0,b.jsx)(F.SelectItem,{value:"other",className:"text-foreground",children:"Other"})]})]}),"google_drive"===M&&(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"Make sure the Google Drive link has proper sharing permissions"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)(I.Label,{htmlFor:"link-url",className:"text-sm font-medium text-foreground",children:["google_drive"===M?"Google Drive Share Link":"External URL"," *"]}),(0,b.jsx)(H.Input,{id:"link-url",type:"url",placeholder:"google_drive"===M?"https://drive.google.com/file/d/...":"https://example.com/document.pdf",value:E,onChange:a=>L(a.target.value),className:"bg-background border-input text-foreground placeholder:text-muted-foreground focus:border-emerald-400/50 focus:ring-emerald-400/20"}),"google_drive"===M&&E&&(0,b.jsxs)("div",{className:"flex items-start gap-2 p-2 rounded-md bg-blue-500/10 border border-blue-400/20",children:[(0,b.jsx)(v.Info,{className:"h-4 w-4 text-blue-600 dark:text-blue-400 mt-0.5 shrink-0"}),(0,b.jsxs)("div",{className:"text-xs text-blue-800 dark:text-blue-200",children:[(0,b.jsx)("p",{className:"font-medium",children:"Google Drive Link Detected"}),(0,b.jsx)("p",{className:"mt-0.5 opacity-80",children:"Verify the link is accessible to intended users"})]})]})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(I.Label,{htmlFor:"doc_type_link",className:"text-sm font-medium text-foreground",children:"Document Type *"}),(0,b.jsxs)(F.Select,{value:s,onValueChange:t,children:[(0,b.jsx)(F.SelectTrigger,{id:"doc_type_link",className:"bg-background border-input text-foreground",children:(0,b.jsx)(F.SelectValue,{})}),(0,b.jsxs)(F.SelectContent,{className:"bg-popover border-border",children:[(0,b.jsx)(F.SelectItem,{value:"nda",className:"text-foreground",children:"NDA"}),(0,b.jsx)(F.SelectItem,{value:"term_sheet",className:"text-foreground",children:"Term Sheet"}),(0,b.jsx)(F.SelectItem,{value:"subscription",className:"text-foreground",children:"Subscription Agreement"}),(0,b.jsx)(F.SelectItem,{value:"contract",className:"text-foreground",children:"Contract"}),(0,b.jsx)(F.SelectItem,{value:"report",className:"text-foreground",children:"Report"}),(0,b.jsx)(F.SelectItem,{value:"other",className:"text-foreground",children:"Other"})]})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(I.Label,{htmlFor:"doc_name_link",className:"text-sm font-medium text-foreground",children:"Title"}),(0,b.jsx)(H.Input,{id:"doc_name_link",placeholder:"e.g., Investor Presentation August 2025",value:u,onChange:a=>x(a.target.value),className:"bg-background border-input text-foreground placeholder:text-muted-foreground focus:border-emerald-400/50 focus:ring-emerald-400/20"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(I.Label,{htmlFor:"doc_description_link",className:"text-sm font-medium text-foreground",children:"Description"}),(0,b.jsx)(H.Input,{id:"doc_description_link",placeholder:"Optional summary or context",value:y,onChange:a=>z(a.target.value),className:"bg-background border-input text-foreground placeholder:text-muted-foreground focus:border-emerald-400/50 focus:ring-emerald-400/20"})]})]})]}),o&&(0,b.jsx)("div",{className:"p-3 rounded-lg bg-red-100 dark:bg-red-500/20 border border-red-300 dark:border-red-400/30 text-red-700 dark:text-red-200 text-sm",children:o}),(0,b.jsxs)("div",{className:"flex justify-end gap-2 pt-4",children:[(0,b.jsx)(D.Button,{variant:"outline",onClick:()=>l(!1),disabled:m,children:"Cancel"}),(0,b.jsx)(D.Button,{onClick:S,disabled:m||R&&!q||!R&&!E.trim(),className:"bg-emerald-600 hover:bg-emerald-700 text-white",children:m?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(w.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),R?"Uploading...":"Saving..."]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(J.Upload,{className:"mr-2 h-4 w-4"}),R?"Upload":"Save Link"]})})]})]})]})}var M=a.i(191675),N=a.i(652212),O=a.i(487068),P=a.i(325866),Q=a.i(537412),R=a.i(169091),S=a.i(601527),T=a.i(165936);T.z.object({full_name:T.z.string().min(1,"Full name is required").max(200,"Name must be less than 200 characters"),email:T.z.string().email("Must be a valid email address").max(255,"Email must be less than 255 characters").nullable().or(T.z.literal("")).transform(a=>""===a?null:a),phone:T.z.string().max(50,"Phone must be less than 50 characters").nullable().or(T.z.literal("")).transform(a=>""===a?null:a),nationality:T.z.string().max(100,"Nationality must be less than 100 characters").nullable().or(T.z.literal("")).transform(a=>""===a?null:a),id_number:T.z.string().max(100,"ID number must be less than 100 characters").nullable().or(T.z.literal("")).transform(a=>""===a?null:a),notes:T.z.string().max(5e3,"Notes must be less than 5000 characters").nullable().or(T.z.literal("")).transform(a=>""===a?null:a)});let U=T.z.object({role:T.z.string().min(1,"Role is required").max(100,"Role must be less than 100 characters"),effective_from:T.z.string().min(1,"Effective from date is required").refine(a=>!isNaN(new Date(a).getTime()),"Must be a valid date"),effective_to:T.z.string().nullable().refine(a=>!a||!isNaN(new Date(a).getTime()),"Must be a valid date").or(T.z.literal("")).transform(a=>""===a?null:a),notes:T.z.string().max(5e3,"Notes must be less than 5000 characters").nullable().or(T.z.literal("")).transform(a=>""===a?null:a)}).refine(a=>!a.effective_to||!a.effective_from||new Date(a.effective_from)<=new Date(a.effective_to),{message:"End date must be after start date",path:["effective_to"]}),V=T.z.object({full_name:T.z.string().min(1,"Full name is required").max(200,"Name must be less than 200 characters"),email:T.z.string().email("Must be a valid email address").max(255,"Email must be less than 255 characters").nullable().or(T.z.literal("")).transform(a=>""===a?null:a),phone:T.z.string().max(50,"Phone must be less than 50 characters").nullable().or(T.z.literal("")).transform(a=>""===a?null:a),nationality:T.z.string().max(100,"Nationality must be less than 100 characters").nullable().or(T.z.literal("")).transform(a=>""===a?null:a),id_number:T.z.string().max(100,"ID number must be less than 100 characters").nullable().or(T.z.literal("")).transform(a=>""===a?null:a),director_notes:T.z.string().max(5e3,"Notes must be less than 5000 characters").nullable().or(T.z.literal("")).transform(a=>""===a?null:a),role:T.z.string().min(1,"Role is required").max(100,"Role must be less than 100 characters"),effective_from:T.z.string().min(1,"Effective from date is required").refine(a=>!isNaN(new Date(a).getTime()),"Must be a valid date"),effective_to:T.z.string().nullable().refine(a=>!a||!isNaN(new Date(a).getTime()),"Must be a valid date").or(T.z.literal("")).transform(a=>""===a?null:a),assignment_notes:T.z.string().max(5e3,"Notes must be less than 5000 characters").nullable().or(T.z.literal("")).transform(a=>""===a?null:a)}).refine(a=>!a.effective_to||!a.effective_from||new Date(a.effective_from)<=new Date(a.effective_to),{message:"End date must be after start date",path:["effective_to"]}),W=T.z.object({role:T.z.string().min(1,"Role is required").max(100,"Role must be less than 100 characters"),effective_from:T.z.string().min(1,"Effective from date is required").refine(a=>!isNaN(new Date(a).getTime()),"Must be a valid date"),effective_to:T.z.string().nullable().refine(a=>!a||!isNaN(new Date(a).getTime()),"Must be a valid date").or(T.z.literal("")).transform(a=>""===a?null:a),notes:T.z.string().max(5e3,"Notes must be less than 5000 characters").nullable().or(T.z.literal("")).transform(a=>""===a?null:a)}).refine(a=>!a.effective_to||!a.effective_from||new Date(a.effective_from)<=new Date(a.effective_to),{message:"End date must be after start date",path:["effective_to"]});var X=a.i(899750);function Y({entityId:a,open:d,onClose:e,onSuccess:f,mode:g,existingDirector:h}){let[i,j]=(0,c.useState)("select"),[l,m]=(0,c.useState)(!1),[n,o]=(0,c.useState)(""),[p,r]=(0,c.useState)([]),[s,t]=(0,c.useState)(null),u=function({entityId:a,directorId:b,defaultValues:c,onSuccess:d}){let e=(0,R.useForm)({resolver:(0,S.zodResolver)(W),defaultValues:c||{role:"",effective_from:new Date().toISOString().split("T")[0],effective_to:null,notes:null}}),f=async c=>{try{let e=await fetch(`/api/entities/${a}/directors/${b}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({role:c.role,effective_from:c.effective_from,effective_to:c.effective_to,notes:c.notes})});if(!e.ok){let a=await e.json();throw Error(a.error||"Failed to update director")}let f=await e.json();X.toast.success("Director updated successfully"),d?.(f)}catch(a){throw console.error("Failed to update director:",a),X.toast.error(a instanceof Error?a.message:"Failed to update director"),a}};return{form:e,onSubmit:e.handleSubmit(f),isSubmitting:e.formState.isSubmitting,errors:e.formState.errors}}({entityId:a,directorId:h?.id||"",defaultValues:h?{role:h.role||"Director",effective_from:h.effective_from||new Date().toISOString().split("T")[0],effective_to:h.effective_to||null,notes:h.notes||null}:void 0,onSuccess:()=>{f(),z()}}),v=function({entityId:a,directorData:b,defaultValues:c,onSuccess:d}){let e=(0,R.useForm)({resolver:(0,S.zodResolver)(U),defaultValues:c||{role:"Director",effective_from:new Date().toISOString().split("T")[0],effective_to:null,notes:null}}),f=async c=>{try{let e=await fetch("/api/entity-directors",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({vehicle_id:a,full_name:b.full_name,email:b.email,role:c.role,effective_from:c.effective_from,effective_to:c.effective_to,notes:c.notes})});if(!e.ok){let a=await e.json();throw Error(a.error||"Failed to assign director")}let f=await e.json();X.toast.success("Director assigned successfully"),d?.(f)}catch(a){throw console.error("Failed to assign director:",a),X.toast.error(a instanceof Error?a.message:"Failed to assign director"),a}};return{form:e,onSubmit:e.handleSubmit(f),isSubmitting:e.formState.isSubmitting,errors:e.formState.errors}}({entityId:a,directorData:s||{full_name:"",email:null},defaultValues:{role:"Director",effective_from:new Date().toISOString().split("T")[0],effective_to:null,notes:null},onSuccess:()=>{f(),z()}}),x=function({entityId:a,defaultValues:b,onSuccess:c}){let d=(0,R.useForm)({resolver:(0,S.zodResolver)(V),defaultValues:b||{full_name:"",email:null,phone:null,nationality:null,id_number:null,director_notes:null,role:"Director",effective_from:new Date().toISOString().split("T")[0],effective_to:null,assignment_notes:null}}),e=async b=>{try{let d=await fetch("/api/director-registry",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({full_name:b.full_name,email:b.email,phone:b.phone,nationality:b.nationality,id_number:b.id_number,notes:b.director_notes})});if(!d.ok){let a=await d.json();throw Error(a.error||"Failed to register director")}let e=await fetch("/api/entity-directors",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({vehicle_id:a,full_name:b.full_name,email:b.email,role:b.role,effective_from:b.effective_from,effective_to:b.effective_to,notes:b.assignment_notes})});if(!e.ok){let a=await e.json();throw Error(a.error||"Failed to assign director")}let f=await e.json();X.toast.success("Director registered and assigned successfully"),c?.(f)}catch(a){throw console.error("Failed to create and assign director:",a),X.toast.error(a instanceof Error?a.message:"Failed to create and assign director"),a}};return{form:d,onSubmit:d.handleSubmit(e),isSubmitting:d.formState.isSubmitting,errors:d.formState.errors}}({entityId:a,defaultValues:{full_name:"",email:null,phone:null,nationality:null,id_number:null,director_notes:null,role:"Director",effective_from:new Date().toISOString().split("T")[0],effective_to:null,assignment_notes:null},onSuccess:()=>{f(),z()}}),y=(0,c.useCallback)(async()=>{m(!0);try{let a=n?`/api/director-registry?search=${encodeURIComponent(n)}`:"/api/director-registry",b=await fetch(a);if(!b.ok)throw Error("Failed to fetch directors");let c=await b.json();r(c.directors||[])}catch(a){console.error("Failed to fetch directors:",a),X.toast.error("Failed to load directors")}finally{m(!1)}},[n]);(0,c.useEffect)(()=>{d&&"create"===g&&"select"===i&&y()},[d,g,i,n,y]);let z=()=>{j("select"),t(null),o(""),v.form.reset(),x.form.reset(),u.form.reset(),e()};return"edit"===g&&h?(0,b.jsx)(G.Dialog,{open:d,onOpenChange:z,children:(0,b.jsxs)(G.DialogContent,{className:"sm:max-w-[600px] bg-zinc-950 border-white/10",children:[(0,b.jsxs)(G.DialogHeader,{children:[(0,b.jsxs)(G.DialogTitle,{className:"text-white flex items-center gap-2",children:[(0,b.jsx)(q.Edit,{className:"h-5 w-5 text-emerald-400"}),"Edit Director Assignment"]}),(0,b.jsxs)(G.DialogDescription,{className:"text-gray-400",children:["Update assignment details for ",h.full_name]})]}),(0,b.jsx)(N.Form,{...u.form,children:(0,b.jsxs)("form",{onSubmit:u.onSubmit,className:"space-y-4 py-4",children:[(0,b.jsx)(N.FormField,{control:u.form.control,name:"role",render:({field:a})=>(0,b.jsxs)(N.FormItem,{children:[(0,b.jsx)(N.FormLabel,{className:"text-white",children:"Role *"}),(0,b.jsx)(N.FormControl,{children:(0,b.jsx)(H.Input,{placeholder:"e.g., Director, Chairman",className:"bg-white/5 border-white/10 text-white",...a})}),(0,b.jsx)(N.FormMessage,{})]})}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,b.jsx)(N.FormField,{control:u.form.control,name:"effective_from",render:({field:a})=>(0,b.jsxs)(N.FormItem,{children:[(0,b.jsx)(N.FormLabel,{className:"text-white",children:"Effective From *"}),(0,b.jsx)(N.FormControl,{children:(0,b.jsx)(H.Input,{type:"date",className:"bg-white/5 border-white/10 text-white",...a})}),(0,b.jsx)(N.FormMessage,{})]})}),(0,b.jsx)(N.FormField,{control:u.form.control,name:"effective_to",render:({field:a})=>(0,b.jsxs)(N.FormItem,{children:[(0,b.jsx)(N.FormLabel,{className:"text-white",children:"Effective To"}),(0,b.jsx)(N.FormControl,{children:(0,b.jsx)(H.Input,{type:"date",className:"bg-white/5 border-white/10 text-white",...a,value:a.value||""})}),(0,b.jsx)(N.FormDescription,{className:"text-xs text-gray-400",children:"Leave empty if still active"}),(0,b.jsx)(N.FormMessage,{})]})})]}),(0,b.jsx)(N.FormField,{control:u.form.control,name:"notes",render:({field:a})=>(0,b.jsxs)(N.FormItem,{children:[(0,b.jsx)(N.FormLabel,{className:"text-white",children:"Notes"}),(0,b.jsx)(N.FormControl,{children:(0,b.jsx)(M.Textarea,{placeholder:"Additional notes about this assignment...",rows:3,className:"bg-white/5 border-white/10 text-white",...a,value:a.value||""})}),(0,b.jsx)(N.FormMessage,{})]})}),(0,b.jsxs)(G.DialogFooter,{className:"border-t border-white/10 pt-4",children:[(0,b.jsx)(D.Button,{type:"button",variant:"outline",onClick:z,disabled:u.isSubmitting,className:"border-white/10 text-white hover:bg-white/10 bg-white/5",children:"Cancel"}),(0,b.jsx)(D.Button,{type:"submit",disabled:u.isSubmitting,className:"bg-emerald-600 hover:bg-emerald-700 text-white",children:u.isSubmitting?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(w.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),"Saving..."]}):"Save Changes"})]})]})})]})}):(0,b.jsx)(G.Dialog,{open:d,onOpenChange:z,children:(0,b.jsxs)(G.DialogContent,{className:"sm:max-w-[700px] bg-zinc-950 border-white/10 max-h-[90vh] overflow-y-auto",children:[(0,b.jsxs)(G.DialogHeader,{children:[(0,b.jsxs)(G.DialogTitle,{className:"text-white flex items-center gap-2",children:[(0,b.jsx)(P.User,{className:"h-5 w-5 text-emerald-400"}),"select"===i?"Add Director from Registry":"Register New Director"]}),(0,b.jsx)(G.DialogDescription,{className:"text-gray-400",children:"select"===i?"Select an existing director or register a new one":"Add a new director to the registry and assign to this entity"})]}),"select"===i?(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(I.Label,{className:"text-sm font-medium text-white",children:"Search Directors"}),(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)(O.Search,{className:"absolute left-3 top-3 h-4 w-4 text-gray-500"}),(0,b.jsx)(H.Input,{placeholder:"Search directors by name or email...",value:n,onChange:a=>o(a.target.value),className:"pl-9 bg-white/5 border-white/10 text-white placeholder:text-gray-500 focus:border-emerald-400/50 focus:ring-emerald-400/20"})]}),(0,b.jsx)("p",{className:"text-xs text-gray-400",children:"Start typing to filter the director registry"})]}),(0,b.jsx)(Q.ScrollArea,{className:"h-[300px] rounded border border-white/10 bg-white/5",children:(0,b.jsx)("div",{className:"p-2 space-y-2",children:l?(0,b.jsxs)("div",{className:"text-center py-8 text-gray-400",children:[(0,b.jsx)(w.Loader2,{className:"h-6 w-6 animate-spin mx-auto mb-2 text-emerald-400"}),(0,b.jsx)("p",{children:"Searching..."})]}):0===p.length?(0,b.jsxs)("div",{className:"text-center py-8 text-gray-400",children:[(0,b.jsx)("div",{className:"h-12 w-12 rounded-full bg-white/5 flex items-center justify-center mx-auto mb-2",children:(0,b.jsx)(P.User,{className:"h-6 w-6"})}),(0,b.jsx)("p",{className:"text-white",children:"No directors found"}),(0,b.jsx)(D.Button,{variant:"link",size:"sm",onClick:()=>j("create"),className:"mt-2 text-emerald-400 hover:text-emerald-300",children:"Register new director"})]}):p.map(a=>(0,b.jsxs)(B.Card,{className:`p-3 cursor-pointer transition-all ${s?.id===a.id?"border-emerald-500 bg-emerald-500/10":"border-white/10 bg-white/5 hover:bg-white/10"}`,onClick:()=>{t(a)},children:[(0,b.jsx)("div",{className:"font-medium text-white",children:a.full_name}),a.email&&(0,b.jsx)("div",{className:"text-sm text-gray-400",children:a.email}),a.nationality&&(0,b.jsx)("div",{className:"text-xs text-gray-400 mt-1",children:a.nationality})]},a.id))})}),s&&(0,b.jsx)(N.Form,{...v.form,children:(0,b.jsxs)("form",{onSubmit:v.onSubmit,className:"border-t border-white/10 pt-4 space-y-3",children:[(0,b.jsx)("h4",{className:"font-medium text-sm text-white",children:"Assignment Details"}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,b.jsx)(N.FormField,{control:v.form.control,name:"role",render:({field:a})=>(0,b.jsxs)(N.FormItem,{children:[(0,b.jsx)(N.FormLabel,{className:"text-white",children:"Role *"}),(0,b.jsx)(N.FormControl,{children:(0,b.jsx)(H.Input,{placeholder:"e.g., Director, Chairman",className:"bg-white/5 border-white/10 text-white",...a})}),(0,b.jsx)(N.FormMessage,{})]})}),(0,b.jsx)(N.FormField,{control:v.form.control,name:"effective_from",render:({field:a})=>(0,b.jsxs)(N.FormItem,{children:[(0,b.jsx)(N.FormLabel,{className:"text-white",children:"Effective From *"}),(0,b.jsx)(N.FormControl,{children:(0,b.jsx)(H.Input,{type:"date",className:"bg-white/5 border-white/10 text-white",...a})}),(0,b.jsx)(N.FormMessage,{})]})})]}),(0,b.jsx)(N.FormField,{control:v.form.control,name:"notes",render:({field:a})=>(0,b.jsxs)(N.FormItem,{children:[(0,b.jsx)(N.FormLabel,{className:"text-white",children:"Notes"}),(0,b.jsx)(N.FormControl,{children:(0,b.jsx)(M.Textarea,{placeholder:"Any additional notes...",rows:2,className:"bg-white/5 border-white/10 text-white",...a,value:a.value||""})}),(0,b.jsx)(N.FormMessage,{})]})})]})}),(0,b.jsxs)(D.Button,{variant:"outline",onClick:()=>j("create"),className:"w-full gap-2 border-emerald-500/30 text-emerald-400 hover:bg-emerald-500/10 bg-emerald-500/5",disabled:v.isSubmitting,children:[(0,b.jsx)(k.Plus,{className:"h-4 w-4"}),"Register New Director"]}),(0,b.jsxs)(G.DialogFooter,{className:"border-t border-white/10 pt-4",children:[(0,b.jsx)(D.Button,{type:"button",variant:"outline",onClick:z,disabled:v.isSubmitting,className:"border-white/10 text-white hover:bg-white/10 bg-white/5",children:"Cancel"}),(0,b.jsx)(D.Button,{onClick:v.onSubmit,disabled:v.isSubmitting||!s,className:"bg-emerald-600 hover:bg-emerald-700 text-white",children:v.isSubmitting?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(w.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),"Assigning..."]}):"Assign Director"})]})]}):(0,b.jsx)(N.Form,{...x.form,children:(0,b.jsxs)("form",{onSubmit:x.onSubmit,className:"space-y-4",children:[(0,b.jsxs)("div",{className:"rounded-lg border border-white/10 bg-white/5 p-4 space-y-3",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 pb-2 border-b border-white/10",children:[(0,b.jsx)("div",{className:"h-8 w-8 rounded-full bg-emerald-500/20 flex items-center justify-center",children:(0,b.jsx)(P.User,{className:"h-4 w-4 text-emerald-400"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{className:"text-sm font-semibold text-white",children:"Director Information"}),(0,b.jsx)("p",{className:"text-xs text-gray-400",children:"Enter the director's personal details"})]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,b.jsx)("div",{className:"col-span-2",children:(0,b.jsx)(N.FormField,{control:x.form.control,name:"full_name",render:({field:a})=>(0,b.jsxs)(N.FormItem,{children:[(0,b.jsx)(N.FormLabel,{className:"text-white",children:"Full Name *"}),(0,b.jsx)(N.FormControl,{children:(0,b.jsx)(H.Input,{placeholder:"John Smith",className:"bg-white/5 border-white/10 text-white",...a})}),(0,b.jsx)(N.FormMessage,{})]})})}),(0,b.jsx)(N.FormField,{control:x.form.control,name:"email",render:({field:a})=>(0,b.jsxs)(N.FormItem,{children:[(0,b.jsx)(N.FormLabel,{className:"text-white",children:"Email"}),(0,b.jsx)(N.FormControl,{children:(0,b.jsx)(H.Input,{type:"email",placeholder:"john@example.com",className:"bg-white/5 border-white/10 text-white",...a,value:a.value||""})}),(0,b.jsx)(N.FormMessage,{})]})}),(0,b.jsx)(N.FormField,{control:x.form.control,name:"phone",render:({field:a})=>(0,b.jsxs)(N.FormItem,{children:[(0,b.jsx)(N.FormLabel,{className:"text-white",children:"Phone"}),(0,b.jsx)(N.FormControl,{children:(0,b.jsx)(H.Input,{placeholder:"+1 234 567 8900",className:"bg-white/5 border-white/10 text-white",...a,value:a.value||""})}),(0,b.jsx)(N.FormMessage,{})]})}),(0,b.jsx)(N.FormField,{control:x.form.control,name:"nationality",render:({field:a})=>(0,b.jsxs)(N.FormItem,{children:[(0,b.jsx)(N.FormLabel,{className:"text-white",children:"Nationality"}),(0,b.jsx)(N.FormControl,{children:(0,b.jsx)(H.Input,{placeholder:"e.g., British, American",className:"bg-white/5 border-white/10 text-white",...a,value:a.value||""})}),(0,b.jsx)(N.FormMessage,{})]})}),(0,b.jsx)(N.FormField,{control:x.form.control,name:"id_number",render:({field:a})=>(0,b.jsxs)(N.FormItem,{children:[(0,b.jsx)(N.FormLabel,{className:"text-white",children:"ID/Passport Number"}),(0,b.jsx)(N.FormControl,{children:(0,b.jsx)(H.Input,{placeholder:"AB123456",className:"bg-white/5 border-white/10 text-white",...a,value:a.value||""})}),(0,b.jsx)(N.FormMessage,{})]})}),(0,b.jsx)("div",{className:"col-span-2",children:(0,b.jsx)(N.FormField,{control:x.form.control,name:"director_notes",render:({field:a})=>(0,b.jsxs)(N.FormItem,{children:[(0,b.jsx)(N.FormLabel,{className:"text-white",children:"Notes"}),(0,b.jsx)(N.FormControl,{children:(0,b.jsx)(M.Textarea,{placeholder:"Additional information...",rows:2,className:"bg-white/5 border-white/10 text-white",...a,value:a.value||""})}),(0,b.jsx)(N.FormMessage,{})]})})})]})]}),(0,b.jsxs)("div",{className:"border-t border-white/10 pt-4 space-y-3",children:[(0,b.jsx)("h4",{className:"font-medium text-sm text-white",children:"Entity Assignment"}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,b.jsx)(N.FormField,{control:x.form.control,name:"role",render:({field:a})=>(0,b.jsxs)(N.FormItem,{children:[(0,b.jsx)(N.FormLabel,{className:"text-white",children:"Role *"}),(0,b.jsx)(N.FormControl,{children:(0,b.jsx)(H.Input,{placeholder:"e.g., Director, Chairman",className:"bg-white/5 border-white/10 text-white",...a})}),(0,b.jsx)(N.FormMessage,{})]})}),(0,b.jsx)(N.FormField,{control:x.form.control,name:"effective_from",render:({field:a})=>(0,b.jsxs)(N.FormItem,{children:[(0,b.jsx)(N.FormLabel,{className:"text-white",children:"Effective From *"}),(0,b.jsx)(N.FormControl,{children:(0,b.jsx)(H.Input,{type:"date",className:"bg-white/5 border-white/10 text-white",...a})}),(0,b.jsx)(N.FormMessage,{})]})})]}),(0,b.jsx)(N.FormField,{control:x.form.control,name:"assignment_notes",render:({field:a})=>(0,b.jsxs)(N.FormItem,{children:[(0,b.jsx)(N.FormLabel,{className:"text-white",children:"Assignment Notes"}),(0,b.jsx)(N.FormControl,{children:(0,b.jsx)(M.Textarea,{placeholder:"Notes about this assignment...",rows:2,className:"bg-white/5 border-white/10 text-white",...a,value:a.value||""})}),(0,b.jsx)(N.FormMessage,{})]})})]}),(0,b.jsx)(D.Button,{type:"button",variant:"outline",onClick:()=>j("select"),className:"w-full border-white/10 text-white hover:bg-white/10 bg-white/5",disabled:x.isSubmitting,children:"Back to Selection"}),(0,b.jsxs)(G.DialogFooter,{className:"border-t border-white/10 pt-4",children:[(0,b.jsx)(D.Button,{type:"button",variant:"outline",onClick:z,disabled:x.isSubmitting,className:"border-white/10 text-white hover:bg-white/10 bg-white/5",children:"Cancel"}),(0,b.jsx)(D.Button,{type:"submit",disabled:x.isSubmitting,className:"bg-emerald-600 hover:bg-emerald-700 text-white",children:x.isSubmitting?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(w.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),"Creating..."]}):"Register & Assign"})]})]})})]})})}let Z=["lawyer","accountant","auditor","administrator","strategic_partner","shareholder","other"],$=T.z.object({role:T.z.enum(Z),company_name:T.z.string().min(1,"Company/Firm name is required").max(200,"Company name must be less than 200 characters"),contact_person:T.z.string().max(200,"Contact person name must be less than 200 characters").nullable().or(T.z.literal("")).transform(a=>""===a?null:a),email:T.z.string().email("Must be a valid email address").max(255,"Email must be less than 255 characters").nullable().or(T.z.literal("")).transform(a=>""===a?null:a),phone:T.z.string().max(50,"Phone must be less than 50 characters").nullable().or(T.z.literal("")).transform(a=>""===a?null:a),effective_from:T.z.string().min(1,"Effective from date is required").refine(a=>!isNaN(new Date(a).getTime()),"Must be a valid date"),effective_to:T.z.string().nullable().refine(a=>!a||!isNaN(new Date(a).getTime()),"Must be a valid date").or(T.z.literal("")).transform(a=>""===a?null:a),notes:T.z.string().max(5e3,"Notes must be less than 5000 characters").nullable().or(T.z.literal("")).transform(a=>""===a?null:a)}).refine(a=>!a.effective_to||!a.effective_from||new Date(a.effective_from)<=new Date(a.effective_to),{message:"End date must be after start date",path:["effective_to"]}),_=T.z.object({role:T.z.enum(Z),company_name:T.z.string().min(1,"Company/Firm name is required").max(200,"Company name must be less than 200 characters"),contact_person:T.z.string().max(200,"Contact person name must be less than 200 characters").nullable().or(T.z.literal("")).transform(a=>""===a?null:a),email:T.z.string().email("Must be a valid email address").max(255,"Email must be less than 255 characters").nullable().or(T.z.literal("")).transform(a=>""===a?null:a),phone:T.z.string().max(50,"Phone must be less than 50 characters").nullable().or(T.z.literal("")).transform(a=>""===a?null:a),effective_from:T.z.string().min(1,"Effective from date is required").refine(a=>!isNaN(new Date(a).getTime()),"Must be a valid date"),effective_to:T.z.string().nullable().refine(a=>!a||!isNaN(new Date(a).getTime()),"Must be a valid date").or(T.z.literal("")).transform(a=>""===a?null:a),notes:T.z.string().max(5e3,"Notes must be less than 5000 characters").nullable().or(T.z.literal("")).transform(a=>""===a?null:a)}).refine(a=>!a.effective_to||!a.effective_from||new Date(a.effective_from)<=new Date(a.effective_to),{message:"End date must be after start date",path:["effective_to"]});function aa({entityId:a,open:c,onClose:d,onSuccess:e,mode:f,existingStakeholder:g}){let h=function({entityId:a,defaultValues:b,onSuccess:c}){let d=(0,R.useForm)({resolver:(0,S.zodResolver)($),defaultValues:b||{role:"lawyer",company_name:"",contact_person:null,email:null,phone:null,effective_from:new Date().toISOString().split("T")[0],effective_to:null,notes:null}}),e=async b=>{try{let d=await fetch(`/api/entities/${a}/stakeholders`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(b)});if(!d.ok){let a=await d.json();throw Error(a.error||"Failed to add stakeholder")}let e=await d.json();X.toast.success("Stakeholder added successfully"),c?.(e)}catch(a){throw console.error("Failed to add stakeholder:",a),X.toast.error(a instanceof Error?a.message:"Failed to add stakeholder"),a}};return{form:d,onSubmit:d.handleSubmit(e),isSubmitting:d.formState.isSubmitting,errors:d.formState.errors}}({entityId:a,defaultValues:{role:"lawyer",company_name:"",contact_person:null,email:null,phone:null,effective_from:new Date().toISOString().split("T")[0],effective_to:null,notes:null},onSuccess:()=>{e(),n()}}),i=function({entityId:a,stakeholderId:b,defaultValues:c,onSuccess:d}){let e=(0,R.useForm)({resolver:(0,S.zodResolver)(_),defaultValues:c||{role:"lawyer",company_name:"",contact_person:null,email:null,phone:null,effective_from:new Date().toISOString().split("T")[0],effective_to:null,notes:null}}),f=async c=>{try{let e=await fetch(`/api/entities/${a}/stakeholders/${b}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(c)});if(!e.ok){let a=await e.json();throw Error(a.error||"Failed to update stakeholder")}let f=await e.json();X.toast.success("Stakeholder updated successfully"),d?.(f)}catch(a){throw console.error("Failed to update stakeholder:",a),X.toast.error(a instanceof Error?a.message:"Failed to update stakeholder"),a}};return{form:e,onSubmit:e.handleSubmit(f),isSubmitting:e.formState.isSubmitting,errors:e.formState.errors}}({entityId:a,stakeholderId:g?.id||"",defaultValues:g?{role:g.role,company_name:g.company_name||"",contact_person:g.contact_person||null,email:g.email||null,phone:g.phone||null,effective_from:g.effective_from||new Date().toISOString().split("T")[0],effective_to:g.effective_to||null,notes:g.notes||null}:void 0,onSuccess:()=>{e(),n()}}),j="edit"===f?i.form:h.form,k="edit"===f?i.onSubmit:h.onSubmit,m="edit"===f?i.isSubmitting:h.isSubmitting,n=()=>{h.form.reset(),i.form.reset(),d()};return(0,b.jsx)(G.Dialog,{open:c,onOpenChange:n,children:(0,b.jsxs)(G.DialogContent,{className:"sm:max-w-[600px] max-h-[90vh] overflow-y-auto bg-zinc-950 border-white/10",children:[(0,b.jsxs)(G.DialogHeader,{children:[(0,b.jsx)(G.DialogTitle,{className:"text-white flex items-center gap-2",children:"edit"===f?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(q.Edit,{className:"h-5 w-5 text-emerald-400"}),"Edit Stakeholder"]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(l.Users,{className:"h-5 w-5 text-emerald-400"}),"Add Stakeholder"]})}),(0,b.jsx)(G.DialogDescription,{className:"text-gray-400",children:"edit"===f?"Update stakeholder information and assignment details":"Add lawyers, accountants, auditors, administrators, or strategic partners to this entity"})]}),(0,b.jsx)(N.Form,{...j,children:(0,b.jsxs)("form",{onSubmit:k,className:"space-y-4 py-4",children:[(0,b.jsx)(N.FormField,{control:j.control,name:"role",render:({field:a})=>(0,b.jsxs)(N.FormItem,{children:[(0,b.jsx)(N.FormLabel,{className:"text-white",children:"Stakeholder Role *"}),(0,b.jsxs)(F.Select,{onValueChange:a.onChange,defaultValue:a.value,children:[(0,b.jsx)(N.FormControl,{children:(0,b.jsx)(F.SelectTrigger,{className:"bg-white/5 border-white/10 text-white",children:(0,b.jsx)(F.SelectValue,{})})}),(0,b.jsx)(F.SelectContent,{className:"bg-zinc-950 border-white/10",children:Z.map(a=>(0,b.jsx)(F.SelectItem,{value:a,className:"text-white",children:{lawyer:"Lawyer / Legal Counsel",accountant:"Accountant",auditor:"Auditor",administrator:"Administrator",strategic_partner:"Strategic Partner",shareholder:"Shareholder",other:"Other"}[a]||a},a))})]}),(0,b.jsx)(N.FormMessage,{})]})}),(0,b.jsx)(N.FormField,{control:j.control,name:"company_name",render:({field:a})=>(0,b.jsxs)(N.FormItem,{children:[(0,b.jsx)(N.FormLabel,{className:"text-white",children:"Company / Firm Name *"}),(0,b.jsx)(N.FormControl,{children:(0,b.jsx)(H.Input,{placeholder:"e.g., Arendt & Medernach, KPMG Luxembourg",className:"bg-white/5 border-white/10 text-white",...a})}),(0,b.jsx)(N.FormMessage,{})]})}),(0,b.jsx)(N.FormField,{control:j.control,name:"contact_person",render:({field:a})=>(0,b.jsxs)(N.FormItem,{children:[(0,b.jsx)(N.FormLabel,{className:"text-white",children:"Contact Person"}),(0,b.jsx)(N.FormControl,{children:(0,b.jsx)(H.Input,{placeholder:"Primary contact name",className:"bg-white/5 border-white/10 text-white",...a,value:a.value||""})}),(0,b.jsx)(N.FormMessage,{})]})}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,b.jsx)(N.FormField,{control:j.control,name:"email",render:({field:a})=>(0,b.jsxs)(N.FormItem,{children:[(0,b.jsx)(N.FormLabel,{className:"text-white",children:"Email"}),(0,b.jsx)(N.FormControl,{children:(0,b.jsx)(H.Input,{type:"email",placeholder:"contact@firm.com",className:"bg-white/5 border-white/10 text-white",...a,value:a.value||""})}),(0,b.jsx)(N.FormMessage,{})]})}),(0,b.jsx)(N.FormField,{control:j.control,name:"phone",render:({field:a})=>(0,b.jsxs)(N.FormItem,{children:[(0,b.jsx)(N.FormLabel,{className:"text-white",children:"Phone"}),(0,b.jsx)(N.FormControl,{children:(0,b.jsx)(H.Input,{type:"tel",placeholder:"+352 123 456",className:"bg-white/5 border-white/10 text-white",...a,value:a.value||""})}),(0,b.jsx)(N.FormMessage,{})]})})]}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,b.jsx)(N.FormField,{control:j.control,name:"effective_from",render:({field:a})=>(0,b.jsxs)(N.FormItem,{children:[(0,b.jsx)(N.FormLabel,{className:"text-white",children:"Effective From *"}),(0,b.jsx)(N.FormControl,{children:(0,b.jsx)(H.Input,{type:"date",className:"bg-white/5 border-white/10 text-white",...a})}),(0,b.jsx)(N.FormMessage,{})]})}),(0,b.jsx)(N.FormField,{control:j.control,name:"effective_to",render:({field:a})=>(0,b.jsxs)(N.FormItem,{children:[(0,b.jsx)(N.FormLabel,{className:"text-white",children:"Effective To"}),(0,b.jsx)(N.FormControl,{children:(0,b.jsx)(H.Input,{type:"date",className:"bg-white/5 border-white/10 text-white",...a,value:a.value||""})}),(0,b.jsx)(N.FormDescription,{className:"text-xs text-gray-400",children:"Leave empty if currently active"}),(0,b.jsx)(N.FormMessage,{})]})})]}),(0,b.jsx)(N.FormField,{control:j.control,name:"notes",render:({field:a})=>(0,b.jsxs)(N.FormItem,{children:[(0,b.jsx)(N.FormLabel,{className:"text-white",children:"Additional Notes"}),(0,b.jsx)(N.FormControl,{children:(0,b.jsx)(M.Textarea,{placeholder:"Add any relevant information about this stakeholder...",rows:3,className:"bg-white/5 border-white/10 text-white",...a,value:a.value||""})}),(0,b.jsx)(N.FormMessage,{})]})}),(0,b.jsxs)(G.DialogFooter,{className:"border-t border-white/10 pt-4",children:[(0,b.jsx)(D.Button,{type:"button",variant:"outline",onClick:n,disabled:m,className:"border-white/10 text-white hover:bg-white/10 bg-white/5",children:"Cancel"}),(0,b.jsx)(D.Button,{type:"submit",disabled:m,className:"bg-emerald-600 hover:bg-emerald-700 text-white",children:m?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(w.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),"edit"===f?"Saving...":"Adding..."]}):"edit"===f?"Save Changes":"Add Stakeholder"})]})]})})]})})}var ab=a.i(160409),ac=a.i(518173),ad=a.i(772998);let ae=T.z.object({name:T.z.string().min(1,"Entity name is required").max(200,"Name must be less than 200 characters"),entity_code:T.z.string().min(1,"Entity code is required").max(50,"Entity code must be less than 50 characters").nullable(),platform:T.z.string().max(100,"Platform must be less than 100 characters").nullable(),investment_name:T.z.string().max(200,"Investment name must be less than 200 characters").nullable(),former_entity:T.z.string().max(200,"Former entity name must be less than 200 characters").nullable(),status:T.z.enum(["LIVE","CLOSED","TBD"]),type:T.z.enum(["fund","spv","securitization","note","venture_capital","private_equity","real_estate","other"]),domicile:T.z.string().max(100,"Domicile must be less than 100 characters").nullable(),currency:T.z.string().length(3,"Currency must be exactly 3 letters").transform(a=>a.toUpperCase()),formation_date:T.z.string().nullable(),legal_jurisdiction:T.z.string().max(100,"Legal jurisdiction must be less than 100 characters").nullable(),registration_number:T.z.string().max(100,"Registration number must be less than 100 characters").nullable(),reporting_type:T.z.enum(["Not Required","Company Only","Online only","Company + Online"]).nullable(),requires_reporting:T.z.boolean().nullable(),notes:T.z.string().max(5e3,"Notes must be less than 5000 characters").nullable(),logo_url:T.z.string().url("Logo URL must be a valid URL").nullable().or(T.z.literal("")).transform(a=>""===a?null:a),website_url:T.z.string().url("Website URL must be a valid URL").nullable().or(T.z.literal("")).transform(a=>""===a?null:a)});var af=a.i(479612);function ag(){let[a,d]=(0,c.useState)(!1),[e,f]=(0,c.useState)(null),[g,h]=(0,c.useState)(null),i=(0,c.useCallback)((a,b)=>{f(a),h(()=>b),d(!0)},[]),j=(0,c.useCallback)(()=>{g?.(),d(!1)},[g]),k=(0,c.useCallback)(()=>{d(!1)},[]);return{confirm:i,ConfirmationDialog:(0,c.useCallback)(()=>e?(0,b.jsx)(af.AlertDialog,{open:a,onOpenChange:d,children:(0,b.jsxs)(af.AlertDialogContent,{className:"bg-zinc-950 border-white/10",children:[(0,b.jsxs)(af.AlertDialogHeader,{children:[(0,b.jsx)(af.AlertDialogTitle,{className:"text-white",children:e.title}),(0,b.jsx)(af.AlertDialogDescription,{className:"text-gray-400",children:e.description})]}),(0,b.jsxs)(af.AlertDialogFooter,{children:[(0,b.jsx)(af.AlertDialogCancel,{onClick:k,className:"bg-gray-700 text-white border-gray-600 hover:bg-gray-600",children:e.cancelText||"Cancel"}),(0,b.jsx)(af.AlertDialogAction,{onClick:j,className:"destructive"===e.variant?"bg-red-600 hover:bg-red-700 text-white":"bg-emerald-600 hover:bg-emerald-700 text-white",children:e.confirmText||"Confirm"})]})]})}):null,[e,a,j,k])}}let ah=[{value:"LIVE",label:"Live"},{value:"TBD",label:"TBD"},{value:"CLOSED",label:"Closed"}],ai=[{value:"fund",label:"Fund"},{value:"spv",label:"SPV"},{value:"securitization",label:"Securitization"},{value:"note",label:"Note"},{value:"venture_capital",label:"Venture Capital"},{value:"private_equity",label:"Private Equity"},{value:"real_estate",label:"Real Estate"},{value:"other",label:"Other"}],aj=[{value:"Not Required",label:"Not Required"},{value:"Company Only",label:"Company Only"},{value:"Online only",label:"Online Only"},{value:"Company + Online",label:"Company + Online"}],ak=["USD","EUR","GBP","CHF","JPY","AUD","CAD"];function al({entity:a,open:e,onClose:f,onSuccess:g}){let[h,i]=(0,c.useState)(a.logo_url||""),[j,k]=(0,c.useState)(!1),[l,m]=(0,c.useState)(null),{confirm:n,ConfirmationDialog:o}=ag(),[p,r]=(0,c.useState)({arrangers:[],lawyers:[]}),[s,t]=(0,c.useState)(!1),[v,x]=(0,c.useState)(a.arranger_entity_id||""),[z,A]=(0,c.useState)(a.lawyer_id||""),[B,C]=(0,c.useState)(a.address||""),E=(0,c.useCallback)(async()=>{t(!0);try{let a=await fetch("/api/vehicles/dropdown-options");if(a.ok){let b=await a.json();r(b)}}catch(a){console.error("Failed to fetch dropdown options:",a)}finally{t(!1)}},[]),{form:L,onSubmit:O,isSubmitting:P}=function({entityId:a,defaultValues:b,onSuccess:c,mode:d="edit"}){let e=(0,K.useRouter)(),f=(0,R.useForm)({resolver:(0,S.zodResolver)(ae),defaultValues:b||{name:"",entity_code:"",platform:"",investment_name:"",former_entity:"",status:"LIVE",type:"fund",domicile:"",currency:"USD",formation_date:null,legal_jurisdiction:"",registration_number:"",reporting_type:"Not Required",requires_reporting:!1,notes:"",logo_url:null,website_url:null}}),g=async b=>{try{let f="edit"===d&&a?`/api/entities/${a}`:"/api/vehicles",g=await fetch(f,{method:"edit"===d?"PATCH":"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(b)});if(!g.ok){let a=await g.json();throw Error(a.error||`Failed to ${d} entity`)}let h=await g.json();X.toast.success("edit"===d?"Entity updated successfully":"Entity created successfully"),c?.(h),"create"===d&&h.vehicle?.id&&e.push(`/versotech_main/entities/${h.vehicle.id}`)}catch(a){throw console.error(`Failed to ${d} entity:`,a),X.toast.error(a instanceof Error?a.message:`Failed to ${d} entity`),a}};return{form:f,onSubmit:f.handleSubmit(g),isSubmitting:f.formState.isSubmitting,errors:f.formState.errors}}({entityId:a.id,mode:"edit",defaultValues:{name:a.name||"",entity_code:a.entity_code||"",platform:a.platform||"",investment_name:a.investment_name||"",former_entity:a.former_entity||"",status:a.status||"LIVE",type:a.type||"fund",domicile:a.domicile||"",currency:a.currency||"USD",formation_date:a.formation_date?a.formation_date.slice(0,10):null,legal_jurisdiction:a.legal_jurisdiction||"",registration_number:a.registration_number||"",reporting_type:a.reporting_type||"Not Required",requires_reporting:a.requires_reporting??!1,notes:a.notes||"",logo_url:a.logo_url||null,website_url:a.website_url||""},onSuccess:a=>{g(a.entity),f()}});(0,c.useEffect)(()=>{e&&E()},[e,E]),(0,c.useEffect)(()=>{e&&(i(a.logo_url||""),m(null),x(a.arranger_entity_id||""),A(a.lawyer_id||""),C(a.address||""),L.reset({name:a.name||"",entity_code:a.entity_code||"",platform:a.platform||"",investment_name:a.investment_name||"",former_entity:a.former_entity||"",status:a.status||"LIVE",type:a.type||"fund",domicile:a.domicile||"",currency:a.currency||"USD",formation_date:a.formation_date?a.formation_date.slice(0,10):null,legal_jurisdiction:a.legal_jurisdiction||"",registration_number:a.registration_number||"",reporting_type:a.reporting_type||"Not Required",requires_reporting:a.requires_reporting??!1,notes:a.notes||"",logo_url:a.logo_url||null,website_url:a.website_url||""}))},[a,e,L]);let Q=async b=>{m(null),k(!0);try{let c=new FormData;c.append("file",b),c.append("vehicle_id",a.id);let d=await fetch("/api/entities/logo-upload",{method:"POST",body:c}),e=await d.json().catch(()=>({}));if(!d.ok)throw Error(e.error||"Failed to upload logo");i(e.url),L.setValue("logo_url",e.url),X.toast.success("Logo uploaded successfully")}catch(b){let a=b instanceof Error?b.message:"Failed to upload logo";m(a),X.toast.error(a)}finally{k(!1)}},T=async()=>{if(await L.trigger())try{let b=await fetch(`/api/entities/${a.id}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({...L.getValues(),logo_url:h||null,address:B||null,arranger_entity_id:v||null,lawyer_id:z||null})});if(!b.ok){let a=await b.json().catch(()=>({}));throw Error(a.error||"Failed to update vehicle")}let c=await b.json();X.toast.success("Vehicle updated successfully"),g(c.entity),f()}catch(a){X.toast.error(a instanceof Error?a.message:"Failed to update vehicle")}};return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(G.Dialog,{open:e,onOpenChange:f,children:(0,b.jsxs)(G.DialogContent,{className:"bg-background border-border max-w-4xl max-h-[90vh] overflow-y-auto",children:[(0,b.jsxs)(G.DialogHeader,{children:[(0,b.jsxs)(G.DialogTitle,{className:"flex items-center gap-2 text-foreground",children:[(0,b.jsx)(q.Edit,{className:"h-5 w-5 text-emerald-400"}),"Edit Vehicle"]}),(0,b.jsx)(G.DialogDescription,{className:"text-muted-foreground",children:"Update vehicle information and metadata"})]}),(0,b.jsx)(N.Form,{...L,children:(0,b.jsxs)("form",{onSubmit:a=>{a.preventDefault(),n({title:"Confirm Changes",description:"Are you sure you want to save these changes to the vehicle?",confirmText:"Save Changes",variant:"default"},()=>{T()})},className:"space-y-6",children:[(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsx)("h3",{className:"text-sm font-semibold text-emerald-400 uppercase tracking-wide",children:"Basic Information"}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,b.jsx)(N.FormField,{control:L.control,name:"name",render:({field:a})=>(0,b.jsxs)(N.FormItem,{className:"col-span-2",children:[(0,b.jsx)(N.FormLabel,{className:"text-foreground",children:"Vehicle Name *"}),(0,b.jsx)(N.FormControl,{children:(0,b.jsx)(H.Input,{...a,className:"bg-background border-input text-foreground",placeholder:"Enter vehicle name"})}),(0,b.jsx)(N.FormMessage,{})]})}),(0,b.jsx)(N.FormField,{control:L.control,name:"entity_code",render:({field:a})=>(0,b.jsxs)(N.FormItem,{children:[(0,b.jsx)(N.FormLabel,{className:"text-foreground",children:"Vehicle Code"}),(0,b.jsx)(N.FormControl,{children:(0,b.jsx)(H.Input,{...a,value:a.value||"",className:"bg-background border-input text-foreground font-mono",placeholder:"e.g., VEH001"})}),(0,b.jsx)(N.FormDescription,{className:"text-xs text-muted-foreground",children:"Unique identifier for this vehicle"}),(0,b.jsx)(N.FormMessage,{})]})}),(0,b.jsx)(N.FormField,{control:L.control,name:"platform",render:({field:a})=>(0,b.jsxs)(N.FormItem,{children:[(0,b.jsx)(N.FormLabel,{className:"text-foreground",children:"Platform"}),(0,b.jsx)(N.FormControl,{children:(0,b.jsx)(H.Input,{...a,value:a.value||"",className:"bg-background border-input text-foreground",placeholder:"e.g., Fund Admin Platform"})}),(0,b.jsx)(N.FormMessage,{})]})}),(0,b.jsx)(N.FormField,{control:L.control,name:"type",render:({field:a})=>(0,b.jsxs)(N.FormItem,{children:[(0,b.jsx)(N.FormLabel,{className:"text-foreground",children:"Vehicle Type *"}),(0,b.jsxs)(F.Select,{onValueChange:a.onChange,value:a.value,children:[(0,b.jsx)(N.FormControl,{children:(0,b.jsx)(F.SelectTrigger,{className:"bg-background border-input text-foreground",children:(0,b.jsx)(F.SelectValue,{})})}),(0,b.jsx)(F.SelectContent,{className:"bg-popover border-border",children:ai.map(a=>(0,b.jsx)(F.SelectItem,{value:a.value,className:"text-foreground",children:a.label},a.value))})]}),(0,b.jsx)(N.FormMessage,{})]})}),(0,b.jsx)(N.FormField,{control:L.control,name:"status",render:({field:a})=>(0,b.jsxs)(N.FormItem,{children:[(0,b.jsx)(N.FormLabel,{className:"text-foreground",children:"Status *"}),(0,b.jsxs)(F.Select,{onValueChange:a.onChange,value:a.value,children:[(0,b.jsx)(N.FormControl,{children:(0,b.jsx)(F.SelectTrigger,{className:"bg-background border-input text-foreground",children:(0,b.jsx)(F.SelectValue,{})})}),(0,b.jsx)(F.SelectContent,{className:"bg-popover border-border",children:ah.map(a=>(0,b.jsx)(F.SelectItem,{value:a.value,className:"text-foreground",children:a.label},a.value))})]}),(0,b.jsx)(N.FormMessage,{})]})})]}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,b.jsx)(N.FormField,{control:L.control,name:"investment_name",render:({field:a})=>(0,b.jsxs)(N.FormItem,{children:[(0,b.jsx)(N.FormLabel,{className:"text-foreground",children:"Investment Name"}),(0,b.jsx)(N.FormControl,{children:(0,b.jsx)(H.Input,{...a,value:a.value||"",className:"bg-background border-input text-foreground",placeholder:"Investment vehicle name"})}),(0,b.jsx)(N.FormMessage,{})]})}),(0,b.jsx)(N.FormField,{control:L.control,name:"former_entity",render:({field:a})=>(0,b.jsxs)(N.FormItem,{children:[(0,b.jsx)(N.FormLabel,{className:"text-foreground",children:"Former Vehicle Name"}),(0,b.jsx)(N.FormControl,{children:(0,b.jsx)(H.Input,{...a,value:a.value||"",className:"bg-background border-input text-foreground",placeholder:"Previous name if renamed"})}),(0,b.jsx)(N.FormMessage,{})]})})]})]}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsx)("h3",{className:"text-sm font-semibold text-emerald-400 uppercase tracking-wide",children:"Service Providers"}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(I.Label,{className:"text-foreground",children:"Arranger"}),(0,b.jsxs)(F.Select,{value:v,onValueChange:a=>x("none"===a?"":a),disabled:s,children:[(0,b.jsx)(F.SelectTrigger,{className:"bg-background border-input text-foreground",children:(0,b.jsx)(F.SelectValue,{placeholder:s?"Loading...":"Select arranger"})}),(0,b.jsxs)(F.SelectContent,{children:[(0,b.jsx)(F.SelectItem,{value:"none",children:"None"}),p.arrangers.map(a=>(0,b.jsx)(F.SelectItem,{value:a.id,children:a.name},a.id))]})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(I.Label,{className:"text-foreground",children:"Legal Counsel"}),(0,b.jsxs)(F.Select,{value:z,onValueChange:a=>A("none"===a?"":a),disabled:s,children:[(0,b.jsx)(F.SelectTrigger,{className:"bg-background border-input text-foreground",children:(0,b.jsx)(F.SelectValue,{placeholder:s?"Loading...":"Select legal counsel"})}),(0,b.jsxs)(F.SelectContent,{children:[(0,b.jsx)(F.SelectItem,{value:"none",children:"None"}),p.lawyers.map(a=>(0,b.jsxs)(F.SelectItem,{value:a.id,children:[a.name," ",a.firm_name&&a.name!==a.firm_name?`(${a.firm_name})`:""]},a.id))]})]})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(I.Label,{className:"text-foreground",children:"Address"}),(0,b.jsx)(M.Textarea,{value:B,onChange:a=>C(a.target.value),className:"bg-background border-input text-foreground",placeholder:"Registered address of the vehicle",rows:2})]})]}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsx)("h3",{className:"text-sm font-semibold text-emerald-400 uppercase tracking-wide",children:"Legal & Compliance"}),(0,b.jsxs)("div",{className:"grid grid-cols-3 gap-4",children:[(0,b.jsx)(N.FormField,{control:L.control,name:"domicile",render:({field:a})=>(0,b.jsxs)(N.FormItem,{children:[(0,b.jsx)(N.FormLabel,{className:"text-foreground",children:"Domicile"}),(0,b.jsx)(N.FormControl,{children:(0,b.jsx)(H.Input,{...a,value:a.value||"",className:"bg-background border-input text-foreground",placeholder:"e.g., Cayman Islands"})}),(0,b.jsx)(N.FormMessage,{})]})}),(0,b.jsx)(N.FormField,{control:L.control,name:"legal_jurisdiction",render:({field:a})=>(0,b.jsxs)(N.FormItem,{children:[(0,b.jsx)(N.FormLabel,{className:"text-foreground",children:"Legal Jurisdiction"}),(0,b.jsx)(N.FormControl,{children:(0,b.jsx)(H.Input,{...a,value:a.value||"",className:"bg-background border-input text-foreground",placeholder:"e.g., Delaware"})}),(0,b.jsx)(N.FormMessage,{})]})}),(0,b.jsx)(N.FormField,{control:L.control,name:"registration_number",render:({field:a})=>(0,b.jsxs)(N.FormItem,{children:[(0,b.jsx)(N.FormLabel,{className:"text-foreground",children:"Registration Number"}),(0,b.jsx)(N.FormControl,{children:(0,b.jsx)(H.Input,{...a,value:a.value||"",className:"bg-background border-input text-foreground font-mono",placeholder:"Registration ID"})}),(0,b.jsx)(N.FormMessage,{})]})})]}),(0,b.jsxs)("div",{className:"grid grid-cols-3 gap-4",children:[(0,b.jsx)(N.FormField,{control:L.control,name:"currency",render:({field:a})=>(0,b.jsxs)(N.FormItem,{children:[(0,b.jsx)(N.FormLabel,{className:"text-foreground",children:"Currency *"}),(0,b.jsxs)(F.Select,{onValueChange:a.onChange,value:a.value,children:[(0,b.jsx)(N.FormControl,{children:(0,b.jsx)(F.SelectTrigger,{className:"bg-background border-input text-foreground",children:(0,b.jsx)(F.SelectValue,{})})}),(0,b.jsx)(F.SelectContent,{className:"bg-popover border-border",children:ak.map(a=>(0,b.jsx)(F.SelectItem,{value:a,className:"text-foreground",children:a},a))})]}),(0,b.jsx)(N.FormMessage,{})]})}),(0,b.jsx)(N.FormField,{control:L.control,name:"formation_date",render:({field:a})=>(0,b.jsxs)(N.FormItem,{className:"col-span-2",children:[(0,b.jsx)(N.FormLabel,{className:"text-foreground",children:"Formation Date"}),(0,b.jsx)(N.FormControl,{children:(0,b.jsx)(H.Input,{type:"date",...a,value:a.value||"",className:"bg-background border-input text-foreground"})}),(0,b.jsx)(N.FormMessage,{})]})})]})]}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsx)("h3",{className:"text-sm font-semibold text-emerald-400 uppercase tracking-wide",children:"Reporting"}),(0,b.jsx)(N.FormField,{control:L.control,name:"requires_reporting",render:({field:a})=>(0,b.jsxs)(N.FormItem,{className:"flex flex-row items-center justify-between rounded-lg border border-border bg-muted/30 p-4",children:[(0,b.jsxs)("div",{className:"space-y-0.5",children:[(0,b.jsx)(N.FormLabel,{className:"text-foreground",children:"Requires Reporting"}),(0,b.jsx)(N.FormDescription,{className:"text-xs text-muted-foreground",children:"Enable if this vehicle has reporting obligations"})]}),(0,b.jsx)(N.FormControl,{children:(0,b.jsx)(ad.Switch,{checked:a.value||!1,onCheckedChange:a.onChange})})]})}),L.watch("requires_reporting")&&(0,b.jsx)(N.FormField,{control:L.control,name:"reporting_type",render:({field:a})=>(0,b.jsxs)(N.FormItem,{children:[(0,b.jsx)(N.FormLabel,{className:"text-foreground",children:"Reporting Type"}),(0,b.jsxs)(F.Select,{onValueChange:a.onChange,value:a.value||"Not Required",children:[(0,b.jsx)(N.FormControl,{children:(0,b.jsx)(F.SelectTrigger,{className:"bg-background border-input text-foreground",children:(0,b.jsx)(F.SelectValue,{})})}),(0,b.jsx)(F.SelectContent,{className:"bg-popover border-border",children:aj.map(a=>(0,b.jsx)(F.SelectItem,{value:a.value,className:"text-foreground",children:a.label},a.value))})]}),(0,b.jsx)(N.FormMessage,{})]})})]}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsx)("h3",{className:"text-sm font-semibold text-emerald-400 uppercase tracking-wide",children:"Branding"}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(I.Label,{className:"text-foreground mb-2 block",children:"Vehicle Logo"}),h?(0,b.jsxs)("div",{className:"flex items-start gap-4",children:[(0,b.jsx)(d.default,{src:h,alt:"Vehicle logo",width:96,height:96,className:"w-24 h-24 object-contain bg-muted rounded border border-border"}),(0,b.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,b.jsxs)(D.Button,{type:"button",variant:"outline",size:"sm",onClick:()=>{n({title:"Remove Logo",description:"Are you sure you want to remove this logo?",confirmText:"Remove",variant:"destructive"},()=>{i(""),L.setValue("logo_url",null),X.toast.success("Logo removed")})},className:"text-red-400 hover:text-red-200 border-red-400/40 hover:bg-red-500/10",disabled:j,children:[(0,b.jsx)(y.Trash2,{className:"h-4 w-4 mr-2"}),"Remove Logo"]}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"Click to remove current logo"})]})]}):(0,b.jsxs)("div",{children:[(0,b.jsx)("input",{type:"file",accept:"image/*",onChange:a=>{let b=a.target.files?.[0];b&&Q(b)},className:"hidden",id:"logo-upload",disabled:j}),(0,b.jsx)("label",{htmlFor:"logo-upload",children:(0,b.jsx)(D.Button,{type:"button",variant:"outline",size:"sm",disabled:j,className:"cursor-pointer border-border text-foreground hover:bg-muted bg-background",onClick:a=>{a.preventDefault(),document.getElementById("logo-upload")?.click()},children:j?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(w.Loader2,{className:"h-4 w-4 mr-2 animate-spin"}),"Uploading..."]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(J.Upload,{className:"h-4 w-4 mr-2"}),"Upload Logo"]})})}),l&&(0,b.jsxs)("p",{className:"text-xs text-red-400 mt-2 flex items-center gap-1",children:[(0,b.jsx)(u.AlertCircle,{className:"h-3 w-3"}),l]})]})]}),(0,b.jsx)(N.FormField,{control:L.control,name:"website_url",render:({field:a})=>(0,b.jsxs)(N.FormItem,{children:[(0,b.jsx)(N.FormLabel,{className:"text-foreground",children:"Website URL"}),(0,b.jsx)(N.FormControl,{children:(0,b.jsx)(H.Input,{...a,value:a.value||"",type:"url",className:"bg-background border-input text-foreground",placeholder:"https://example.com"})}),(0,b.jsx)(N.FormMessage,{})]})})]})]}),(0,b.jsx)(N.FormField,{control:L.control,name:"notes",render:({field:a})=>(0,b.jsxs)(N.FormItem,{children:[(0,b.jsx)(N.FormLabel,{className:"text-foreground",children:"Internal Notes"}),(0,b.jsx)(N.FormControl,{children:(0,b.jsx)(M.Textarea,{...a,value:a.value||"",className:"bg-background border-input text-foreground",placeholder:"Add any internal notes or comments about this vehicle...",rows:4})}),(0,b.jsx)(N.FormDescription,{className:"text-xs text-muted-foreground",children:"These notes are for internal use only and not visible to investors"}),(0,b.jsx)(N.FormMessage,{})]})}),(0,b.jsxs)(G.DialogFooter,{children:[(0,b.jsx)(D.Button,{type:"button",variant:"outline",onClick:f,className:"bg-muted text-foreground border-border hover:bg-muted/80",disabled:P,children:"Cancel"}),(0,b.jsx)(D.Button,{type:"submit",className:"bg-primary hover:bg-primary/90 text-primary-foreground",disabled:P||j,children:P?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(w.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),"Saving..."]}):"Save Changes"})]})]})})]})}),(0,b.jsx)(o,{})]})}function am({open:a,onClose:d,entityId:e,entityName:f}){let g=(0,K.useRouter)(),[h,i]=(0,c.useState)(""),[j,k]=(0,c.useState)(!1),[l,m]=(0,c.useState)(null),[n,o]=(0,c.useState)(!1),p=async a=>{if(a){o(!0);try{let a=await fetch(`/api/entities/${e}`,{method:"DELETE"});if(409===a.status){let b=await a.json();m(b.dependencies)}else if(a.ok)m({directors:0,stakeholders:0,investors:0,documents:0,folders:0,deals:0,subscriptions:0,valuations:0});else{let b=await a.json().catch(()=>({}));X.toast.error(b.error||"Failed to check dependencies"),d()}}catch(a){console.error("Failed to check dependencies:",a),X.toast.error("Failed to check dependencies"),d()}finally{o(!1)}}else i(""),m(null),d()},q=async()=>{if(h!==f)return void X.toast.error("Confirmation text does not match");k(!0);try{let a=await fetch(`/api/entities/${e}`,{method:"DELETE"});if(!a.ok){let b=await a.json().catch(()=>({}));if(409===a.status)X.toast.error("Cannot delete entity with dependencies. Please remove all dependencies first.");else throw Error(b.error||"Failed to delete entity");return}X.toast.success(`Entity "${f}" deleted successfully`),g.push("/versotech_main/entities"),g.refresh()}catch(a){console.error("Failed to delete entity:",a),X.toast.error(a instanceof Error?a.message:"Failed to delete entity")}finally{k(!1),d()}},r=l&&Object.values(l).some(a=>a>0),u=!r&&h===f;return(0,b.jsx)(af.AlertDialog,{open:a,onOpenChange:p,children:(0,b.jsxs)(af.AlertDialogContent,{className:"bg-zinc-950 border-red-500/20 text-white max-w-2xl",children:[(0,b.jsxs)(af.AlertDialogHeader,{children:[(0,b.jsxs)(af.AlertDialogTitle,{className:"flex items-center gap-2 text-red-400",children:[(0,b.jsx)(s.AlertTriangle,{className:"h-5 w-5"}),"Delete Entity: ",f]}),(0,b.jsx)(af.AlertDialogDescription,{className:"text-gray-400",children:"This action cannot be undone. This will permanently delete the entity and all associated data from the system."})]}),n?(0,b.jsxs)("div",{className:"flex items-center justify-center py-8",children:[(0,b.jsx)(w.Loader2,{className:"h-8 w-8 animate-spin text-emerald-400"}),(0,b.jsx)("span",{className:"ml-3 text-gray-400",children:"Checking dependencies..."})]}):l?(0,b.jsxs)("div",{className:"space-y-4",children:[r?(0,b.jsx)("div",{className:"rounded-lg border border-red-500/30 bg-red-500/10 p-4",children:(0,b.jsxs)("div",{className:"flex items-start gap-3",children:[(0,b.jsx)(s.AlertTriangle,{className:"h-5 w-5 text-red-400 shrink-0 mt-0.5"}),(0,b.jsxs)("div",{className:"space-y-2 flex-1",children:[(0,b.jsx)("p",{className:"font-semibold text-red-300",children:"Cannot Delete: Entity Has Dependencies"}),(0,b.jsx)("p",{className:"text-sm text-gray-300",children:"This entity has the following linked data that must be removed first:"}),(0,b.jsxs)("ul",{className:"space-y-1 text-sm",children:[l.directors>0&&(0,b.jsxs)("li",{className:"text-gray-300",children:[" ",l.directors," Director",1!==l.directors?"s":""]}),l.stakeholders>0&&(0,b.jsxs)("li",{className:"text-gray-300",children:[" ",l.stakeholders," Stakeholder",1!==l.stakeholders?"s":""]}),l.investors>0&&(0,b.jsxs)("li",{className:"text-gray-300",children:[" ",l.investors," Investor Relationship",1!==l.investors?"s":""]}),l.subscriptions>0&&(0,b.jsxs)("li",{className:"text-gray-300",children:[" ",l.subscriptions," Subscription",1!==l.subscriptions?"s":""]}),l.documents>0&&(0,b.jsxs)("li",{className:"text-gray-300",children:[" ",l.documents," Document",1!==l.documents?"s":""]}),l.folders>0&&(0,b.jsxs)("li",{className:"text-gray-300",children:[" ",l.folders," Folder",1!==l.folders?"s":""]}),l.deals>0&&(0,b.jsxs)("li",{className:"text-gray-300",children:[" ",l.deals," Deal",1!==l.deals?"s":""]}),l.valuations>0&&(0,b.jsxs)("li",{className:"text-gray-300",children:[" ",l.valuations," Valuation",1!==l.valuations?"s":""]})]}),(0,b.jsx)("p",{className:"text-sm text-gray-400 mt-3",children:"Please remove all dependencies before deleting this entity."})]})]})}):(0,b.jsx)("div",{className:"rounded-lg border border-emerald-500/30 bg-emerald-500/10 p-4",children:(0,b.jsxs)("div",{className:"flex items-start gap-3",children:[(0,b.jsx)(t.CheckCircle2,{className:"h-5 w-5 text-emerald-400 shrink-0 mt-0.5"}),(0,b.jsxs)("div",{className:"space-y-2 flex-1",children:[(0,b.jsx)("p",{className:"font-semibold text-emerald-300",children:"No Dependencies Found"}),(0,b.jsx)("p",{className:"text-sm text-gray-300",children:"This entity has no linked data and can be safely deleted."})]})]})}),!r&&(0,b.jsxs)("div",{className:"space-y-3 pt-2",children:[(0,b.jsxs)(I.Label,{htmlFor:"confirmation",className:"text-white",children:["Type ",(0,b.jsx)("span",{className:"font-mono text-emerald-400",children:f})," to confirm deletion:"]}),(0,b.jsx)(H.Input,{id:"confirmation",value:h,onChange:a=>i(a.target.value),placeholder:f,className:"bg-white/5 border-white/10 text-white placeholder:text-gray-500",autoComplete:"off"})]})]}):null,(0,b.jsxs)(af.AlertDialogFooter,{children:[(0,b.jsx)(af.AlertDialogCancel,{onClick:d,disabled:j,className:"bg-white/10 border-white/10 text-white hover:bg-white/20",children:"Cancel"}),!r&&(0,b.jsx)(af.AlertDialogAction,{onClick:q,disabled:!u||j,className:"bg-red-600 hover:bg-red-700 text-white",children:j?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(w.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),"Deleting..."]}):"Delete Entity"})]})]})})}function an({open:a,onClose:d,document:e,onSuccess:f}){let[g,h]=(0,c.useState)(e.name||""),[i,k]=(0,c.useState)(e.description||""),[l,m]=(0,c.useState)(!1);(0,c.useEffect)(()=>{h(e.name||""),k(e.description||"")},[e]);let n=async a=>{if(a.preventDefault(),!g.trim())return void X.toast.error("Document name is required");m(!0);try{let a=await fetch(`/api/staff/documents/${e.id}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:g.trim(),description:i.trim()||null})});if(!a.ok){let b=await a.json().catch(()=>({}));throw Error(b.error||"Failed to update document")}X.toast.success("Document updated successfully"),f(),d()}catch(a){console.error("Failed to update document:",a),X.toast.error(a instanceof Error?a.message:"Failed to update document")}finally{m(!1)}},o=()=>{l||(h(e.name||""),k(e.description||""),d())};return(0,b.jsx)(G.Dialog,{open:a,onOpenChange:o,children:(0,b.jsxs)(G.DialogContent,{className:"sm:max-w-[500px] bg-zinc-950 border-white/10",children:[(0,b.jsxs)(G.DialogHeader,{children:[(0,b.jsxs)(G.DialogTitle,{className:"text-white flex items-center gap-2",children:[(0,b.jsx)(j.FileText,{className:"h-5 w-5 text-emerald-400"}),"Edit Document"]}),(0,b.jsx)(G.DialogDescription,{className:"text-gray-400",children:"Update document name and description"})]}),(0,b.jsxs)("form",{onSubmit:n,className:"space-y-4 py-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(I.Label,{htmlFor:"name",className:"text-white",children:"Document Name *"}),(0,b.jsx)(H.Input,{id:"name",value:g,onChange:a=>h(a.target.value),placeholder:"Enter document name",className:"bg-white/5 border-white/10 text-white",disabled:l,required:!0})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(I.Label,{htmlFor:"description",className:"text-white",children:"Description"}),(0,b.jsx)(M.Textarea,{id:"description",value:i,onChange:a=>k(a.target.value),placeholder:"Add document description (optional)",rows:3,className:"bg-white/5 border-white/10 text-white",disabled:l})]}),e.file_key&&(0,b.jsxs)("div",{className:"text-xs text-gray-400 pt-2 border-t border-white/10",children:["File: ",e.file_key.split("/").pop()]}),(0,b.jsxs)(G.DialogFooter,{className:"border-t border-white/10 pt-4",children:[(0,b.jsx)(D.Button,{type:"button",variant:"outline",onClick:o,disabled:l,className:"border-white/10 text-white hover:bg-white/10",children:"Cancel"}),(0,b.jsx)(D.Button,{type:"submit",disabled:l||!g.trim(),className:"bg-emerald-600 hover:bg-emerald-700 text-white",children:l?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(w.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),"Saving..."]}):"Save Changes"})]})]})]})})}var ao=a.i(266828);let ap=[{value:"pending",label:"Pending"},{value:"committed",label:"Committed"},{value:"active",label:"Active"},{value:"closed",label:"Closed"},{value:"cancelled",label:"Cancelled"}],aq=[{value:"individual",label:"Individual"},{value:"institutional",label:"Institutional"},{value:"entity",label:"Entity"},{value:"family_office",label:"Family Office"},{value:"fund",label:"Fund"}];function ar({entityId:a,open:d,onClose:e,onSuccess:f}){let[g,h]=(0,c.useState)("existing"),[i,l]=(0,c.useState)(!1),[m,n]=(0,c.useState)(!1),[o,p]=(0,c.useState)(""),[q,r]=(0,c.useState)([]),[s,t]=(0,c.useState)(""),[u,v]=(0,c.useState)(""),[x,y]=(0,c.useState)("pending"),[z,A]=(0,c.useState)(""),[B,J]=(0,c.useState)(!0),[K,L]=(0,c.useState)(""),[N,P]=(0,c.useState)("USD"),[R,S]=(0,c.useState)("pending"),[T,U]=(0,c.useState)(""),[V,W]=(0,c.useState)(""),[Y,Z]=(0,c.useState)(""),[$,_]=(0,c.useState)(""),[aa,ab]=(0,c.useState)({legal_name:"",display_name:"",type:"institutional",email:"",phone:"",country:"",country_of_incorporation:"",tax_residency:""});(0,c.useEffect)(()=>{if(!d){h("existing"),p(""),t(""),v(""),y("pending"),A(""),J(!0),L(""),P("USD"),S("pending"),U(""),W(""),Z(""),_(""),ab({legal_name:"",display_name:"",type:"institutional",email:"",phone:"",country:"",country_of_incorporation:"",tax_residency:""});return}n(!0),fetch("/api/staff/investors").then(a=>a.json()).then(a=>{r(a.investors||[])}).catch(a=>{console.error("Failed to load investors:",a)}).finally(()=>n(!1))},[d]),(0,c.useEffect)(()=>{if(!d)return;let a=new AbortController,b=setTimeout(()=>{n(!0),fetch(o.trim()?`/api/staff/investors?search=${encodeURIComponent(o.trim())}`:"/api/staff/investors",{signal:a.signal}).then(a=>a.json()).then(a=>r(a.investors||[])).catch(a=>{"AbortError"!==a.name&&console.error("Investor search failed:",a)}).finally(()=>n(!1))},300);return()=>{a.abort(),clearTimeout(b)}},[o,d]);let ac=(0,c.useMemo)(()=>q.find(a=>a.id===s),[q,s]),ad=(0,c.useCallback)(async()=>{if(("existing"!==g||s)&&("new"!==g||aa.legal_name.trim())){l(!0);try{let b={relationship_role:u.trim()||null,allocation_status:x,notes:z.trim()||null,send_invite:B},c={};if(K){let a=Number(K);Number.isNaN(a)||(c.commitment=a)}if(Y){let a=Number(Y);Number.isNaN(a)||(c.units=a)}(Object.keys(c).length>0||T||V||$||"pending"!==R||"USD"!==N)&&(c.currency=N.toUpperCase(),c.status=R,c.effective_date=T||null,c.funding_due_at=V||null,c.acknowledgement_notes=$.trim()||null,b.subscription=c),"existing"===g?b.investor_id=s:b.investor={legal_name:aa.legal_name.trim(),display_name:aa.display_name.trim()||null,type:aa.type,email:aa.email.trim()||null,phone:aa.phone.trim()||null,country:aa.country.trim()||null,country_of_incorporation:aa.country_of_incorporation.trim()||null,tax_residency:aa.tax_residency.trim()||null};let d=await fetch(`/api/entities/${a}/investors`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(b)});if(!d.ok){let a=await d.json().catch(()=>({}));throw Error(a.error||"Failed to link investor")}let h=await d.json();f(h.investor),e()}catch(a){throw console.error("Failed to link investor:",a),a}finally{l(!1)}}},[g,s,aa,u,x,z,B,K,Y,N,R,T,V,$,a,e,f]),ae=async()=>{try{await ad()}catch(a){a instanceof Error?X.toast.error(a.message):X.toast.error("Failed to link investor. Please try again.")}};return(0,b.jsx)(G.Dialog,{open:d,onOpenChange:e,children:(0,b.jsxs)(G.DialogContent,{className:"max-w-4xl h-[90vh] bg-zinc-950 border-white/10 flex flex-col gap-0 p-0 overflow-hidden",children:[(0,b.jsxs)(G.DialogHeader,{className:"px-6 pt-6 pb-4 shrink-0 border-b border-white/10",children:[(0,b.jsxs)(G.DialogTitle,{className:"text-white flex items-center gap-2",children:[(0,b.jsx)(k.Plus,{className:"h-5 w-5 text-emerald-400"}),"Allocate Investor to Entity"]}),(0,b.jsx)(G.DialogDescription,{className:"text-gray-400",children:"Link an existing investor or create a new profile and capture their subscription details."})]}),(0,b.jsx)("div",{className:"flex-1 overflow-y-auto px-6",children:(0,b.jsxs)("div",{className:"space-y-6 py-6",children:[(0,b.jsxs)(C.Tabs,{value:g,onValueChange:a=>h(a),children:[(0,b.jsxs)(C.TabsList,{className:"grid grid-cols-2 bg-white/5 border border-white/10 w-full",children:[(0,b.jsx)(C.TabsTrigger,{value:"existing",className:"data-[state=active]:bg-emerald-500/20 data-[state=active]:text-emerald-100 text-white",children:"Select Existing Investor"}),(0,b.jsx)(C.TabsTrigger,{value:"new",className:"data-[state=active]:bg-emerald-500/20 data-[state=active]:text-emerald-100 text-white",children:"Create New Investor"})]}),(0,b.jsxs)(C.TabsContent,{value:"existing",className:"mt-4 space-y-3",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(I.Label,{htmlFor:"investor-search",className:"text-sm font-medium text-white",children:"Search Investors"}),(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)(O.Search,{className:"absolute left-3 top-3 h-4 w-4 text-gray-500"}),(0,b.jsx)(H.Input,{id:"investor-search",className:"pl-9 bg-white/5 border-white/10 text-white placeholder:text-gray-500 focus:border-emerald-400/50 focus:ring-emerald-400/20",placeholder:"Search by name, email, or type",value:o,onChange:a=>p(a.target.value)})]}),(0,b.jsx)("p",{className:"text-xs text-gray-400",children:"Start typing to filter the investor list"})]}),(0,b.jsx)(Q.ScrollArea,{className:"h-[240px] rounded-md border border-white/10 bg-white/5",children:(0,b.jsxs)("div",{className:"divide-y divide-white/5",children:[m&&(0,b.jsxs)("div",{className:"flex items-center justify-center py-8 text-sm text-gray-400",children:[(0,b.jsx)(w.Loader2,{className:"mr-2 h-5 w-5 animate-spin text-emerald-400"}),(0,b.jsx)("span",{children:"Loading investors..."})]}),!m&&0===q.length&&(0,b.jsx)("div",{className:"py-8 text-center text-sm text-gray-400",children:(0,b.jsxs)("div",{className:"flex flex-col items-center gap-2",children:[(0,b.jsx)("div",{className:"h-12 w-12 rounded-full bg-white/5 flex items-center justify-center",children:(0,b.jsx)(O.Search,{className:"h-6 w-6"})}),(0,b.jsx)("p",{className:"text-white",children:"No investors found."}),(0,b.jsx)("p",{className:"text-xs",children:"Try adjusting your search or create a new investor."})]})}),q.map(a=>(0,b.jsx)("button",{type:"button",onClick:()=>t(a.id),className:`w-full px-4 py-3 text-left transition-all ${s===a.id?"bg-emerald-500/10 border-l-2 border-emerald-400":"hover:bg-white/10 border-l-2 border-transparent"}`,children:(0,b.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("p",{className:"font-medium text-white",children:a.legal_name}),(0,b.jsxs)("p",{className:"text-xs text-gray-400 capitalize",children:[a.type?a.type.replace(/_/g," "):"Type unknown",a.email?`  ${a.email}`:""]})]}),s===a.id&&(0,b.jsx)(E.Badge,{variant:"outline",className:"text-xs bg-emerald-500/20 border-emerald-400/40 text-emerald-100",children:"Selected"})]})},a.id))]})}),ac&&(0,b.jsx)("div",{className:"rounded-md border border-emerald-400/40 bg-emerald-500/10 p-4 text-sm",children:(0,b.jsxs)("div",{className:"flex items-start gap-3",children:[(0,b.jsx)("div",{className:"h-10 w-10 rounded-full bg-emerald-500/20 flex items-center justify-center shrink-0",children:(0,b.jsx)("span",{className:"text-emerald-200 font-semibold text-lg",children:ac.legal_name.charAt(0)})}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("p",{className:"font-semibold text-emerald-100",children:ac.legal_name}),ac.email&&(0,b.jsx)("p",{className:"text-emerald-200 text-xs",children:ac.email}),ac.type&&(0,b.jsx)("p",{className:"capitalize text-emerald-300 text-xs mt-1",children:ac.type.replace(/_/g," ")})]})]})})]}),(0,b.jsx)(C.TabsContent,{value:"new",className:"mt-4 space-y-4",children:(0,b.jsxs)("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[(0,b.jsxs)("div",{className:"space-y-2 md:col-span-2",children:[(0,b.jsx)(I.Label,{htmlFor:"new-legal-name",className:"text-sm font-medium text-white",children:"Legal Name *"}),(0,b.jsx)(H.Input,{id:"new-legal-name",value:aa.legal_name,onChange:a=>ab(b=>({...b,legal_name:a.target.value})),placeholder:"Investor legal name",className:"bg-white/5 border-white/10 text-white placeholder:text-gray-500 focus:border-emerald-400/50 focus:ring-emerald-400/20",required:!0})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(I.Label,{htmlFor:"new-display-name",className:"text-sm font-medium text-white",children:"Display Name"}),(0,b.jsx)(H.Input,{id:"new-display-name",value:aa.display_name,onChange:a=>ab(b=>({...b,display_name:a.target.value})),placeholder:"Optional short label",className:"bg-white/5 border-white/10 text-white placeholder:text-gray-500 focus:border-emerald-400/50 focus:ring-emerald-400/20"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(I.Label,{htmlFor:"new-type",className:"text-sm font-medium text-white",children:"Investor Type"}),(0,b.jsxs)(F.Select,{value:aa.type,onValueChange:a=>ab(b=>({...b,type:a})),children:[(0,b.jsx)(F.SelectTrigger,{id:"new-type",className:"bg-white/5 border-white/10 text-white",children:(0,b.jsx)(F.SelectValue,{})}),(0,b.jsx)(F.SelectContent,{className:"bg-zinc-950 border-white/10",children:aq.map(a=>(0,b.jsx)(F.SelectItem,{value:a.value,className:"text-white",children:a.label},a.value))})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(I.Label,{htmlFor:"new-email",className:"text-sm font-medium text-white",children:"Email"}),(0,b.jsx)(H.Input,{id:"new-email",type:"email",value:aa.email,onChange:a=>ab(b=>({...b,email:a.target.value})),placeholder:"investor@email.com",className:"bg-white/5 border-white/10 text-white placeholder:text-gray-500 focus:border-emerald-400/50 focus:ring-emerald-400/20"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(I.Label,{htmlFor:"new-phone",className:"text-sm font-medium text-white",children:"Phone"}),(0,b.jsx)(H.Input,{id:"new-phone",value:aa.phone,onChange:a=>ab(b=>({...b,phone:a.target.value})),placeholder:"+1 (555) 123-4567",className:"bg-white/5 border-white/10 text-white placeholder:text-gray-500 focus:border-emerald-400/50 focus:ring-emerald-400/20"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(I.Label,{htmlFor:"new-country",className:"text-sm font-medium text-white",children:"Country"}),(0,b.jsx)(H.Input,{id:"new-country",value:aa.country,onChange:a=>ab(b=>({...b,country:a.target.value})),placeholder:"Country of residence",className:"bg-white/5 border-white/10 text-white placeholder:text-gray-500 focus:border-emerald-400/50 focus:ring-emerald-400/20"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(I.Label,{htmlFor:"new-incorporation",className:"text-sm font-medium text-white",children:"Country of Incorporation"}),(0,b.jsx)(H.Input,{id:"new-incorporation",value:aa.country_of_incorporation,onChange:a=>ab(b=>({...b,country_of_incorporation:a.target.value})),placeholder:"Jurisdiction",className:"bg-white/5 border-white/10 text-white placeholder:text-gray-500 focus:border-emerald-400/50 focus:ring-emerald-400/20"})]}),(0,b.jsxs)("div",{className:"space-y-2 md:col-span-2",children:[(0,b.jsx)(I.Label,{htmlFor:"new-tax-residency",className:"text-sm font-medium text-white",children:"Tax Residency"}),(0,b.jsx)(H.Input,{id:"new-tax-residency",value:aa.tax_residency,onChange:a=>ab(b=>({...b,tax_residency:a.target.value})),placeholder:"Tax residency",className:"bg-white/5 border-white/10 text-white placeholder:text-gray-500 focus:border-emerald-400/50 focus:ring-emerald-400/20"})]})]})})]}),(0,b.jsxs)("div",{className:"rounded-lg border border-white/10 bg-white/5 p-5 space-y-4",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 pb-2 border-b border-white/10",children:[(0,b.jsx)("div",{className:"h-8 w-8 rounded-full bg-emerald-500/20 flex items-center justify-center",children:(0,b.jsx)(j.FileText,{className:"h-4 w-4 text-emerald-400"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{className:"text-sm font-semibold text-white",children:"Allocation Details"}),(0,b.jsx)("p",{className:"text-xs text-gray-400",children:"Define the investor's role and subscription terms"})]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(I.Label,{htmlFor:"relationship_role",className:"text-sm font-medium text-white",children:"Relationship Role"}),(0,b.jsx)(H.Input,{id:"relationship_role",value:u,onChange:a=>v(a.target.value),placeholder:"e.g., Lead LP, Co-investor, Cornerstone",className:"bg-white/5 border-white/10 text-white placeholder:text-gray-500 focus:border-emerald-400/50 focus:ring-emerald-400/20"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(I.Label,{htmlFor:"allocation_status",className:"text-sm font-medium text-white",children:"Allocation Status"}),(0,b.jsxs)(F.Select,{value:x,onValueChange:a=>y(a),children:[(0,b.jsx)(F.SelectTrigger,{id:"allocation_status",className:"bg-white/5 border-white/10 text-white",children:(0,b.jsx)(F.SelectValue,{})}),(0,b.jsx)(F.SelectContent,{className:"bg-zinc-950 border-white/10",children:ap.map(a=>(0,b.jsx)(F.SelectItem,{value:a.value,className:"text-white",children:a.label},a.value))})]})]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-3",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(I.Label,{htmlFor:"commitment",className:"text-sm font-medium text-white",children:"Commitment Amount"}),(0,b.jsx)(H.Input,{id:"commitment",value:K,onChange:a=>L(a.target.value),placeholder:"e.g., 2500000",inputMode:"numeric",className:"bg-white/5 border-white/10 text-white placeholder:text-gray-500 focus:border-emerald-400/50 focus:ring-emerald-400/20"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(I.Label,{htmlFor:"currency",className:"text-sm font-medium text-white",children:"Currency"}),(0,b.jsx)(H.Input,{id:"currency",value:N,maxLength:3,onChange:a=>P(a.target.value.toUpperCase()),className:"bg-white/5 border-white/10 text-white placeholder:text-gray-500 focus:border-emerald-400/50 focus:ring-emerald-400/20"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(I.Label,{htmlFor:"subscription_status",className:"text-sm font-medium text-white",children:"Subscription Status"}),(0,b.jsxs)(F.Select,{value:R,onValueChange:a=>S(a),children:[(0,b.jsx)(F.SelectTrigger,{id:"subscription_status",className:"bg-white/5 border-white/10 text-white",children:(0,b.jsx)(F.SelectValue,{})}),(0,b.jsx)(F.SelectContent,{className:"bg-zinc-950 border-white/10",children:ap.map(a=>(0,b.jsx)(F.SelectItem,{value:a.value,className:"text-white",children:a.label},a.value))})]})]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-3",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(I.Label,{htmlFor:"effective_date",className:"text-sm font-medium text-white",children:"Effective Date"}),(0,b.jsx)(H.Input,{id:"effective_date",type:"date",value:T,onChange:a=>U(a.target.value),className:"bg-white/5 border-white/10 text-white placeholder:text-gray-500 focus:border-emerald-400/50 focus:ring-emerald-400/20"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(I.Label,{htmlFor:"funding_due_at",className:"text-sm font-medium text-white",children:"Funding Due Date"}),(0,b.jsx)(H.Input,{id:"funding_due_at",type:"date",value:V,onChange:a=>W(a.target.value),className:"bg-white/5 border-white/10 text-white placeholder:text-gray-500 focus:border-emerald-400/50 focus:ring-emerald-400/20"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(I.Label,{htmlFor:"units",className:"text-sm font-medium text-white",children:"Units"}),(0,b.jsx)(H.Input,{id:"units",value:Y,onChange:a=>Z(a.target.value),placeholder:"e.g., 1000",inputMode:"numeric",className:"bg-white/5 border-white/10 text-white placeholder:text-gray-500 focus:border-emerald-400/50 focus:ring-emerald-400/20"})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(I.Label,{htmlFor:"ack-notes",className:"text-sm font-medium text-white",children:"Acknowledgement Notes"}),(0,b.jsx)(M.Textarea,{id:"ack-notes",value:$,onChange:a=>_(a.target.value),placeholder:"Internal notes about subscription acknowledgement or pending actions",rows:2,className:"bg-white/5 border-white/10 text-white placeholder:text-gray-500 focus:border-emerald-400/50 focus:ring-emerald-400/20"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(I.Label,{htmlFor:"investor-notes",className:"text-sm font-medium text-white",children:"Internal Notes"}),(0,b.jsx)(M.Textarea,{id:"investor-notes",value:z,onChange:a=>A(a.target.value),placeholder:"Add any context for the team (not shared with investors)",rows:3,className:"bg-white/5 border-white/10 text-white placeholder:text-gray-500 focus:border-emerald-400/50 focus:ring-emerald-400/20"})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2 rounded-md border border-white/10 bg-white/5 p-3",children:[(0,b.jsx)(ao.Checkbox,{id:"send-invite",checked:B,onCheckedChange:a=>J(!!a),className:"border-white/20 data-[state=checked]:bg-emerald-500 data-[state=checked]:border-emerald-500"}),(0,b.jsx)(I.Label,{htmlFor:"send-invite",className:"text-sm text-white cursor-pointer",children:"Send investor portal invitation (if not already invited)"})]})]})]})}),(0,b.jsxs)(G.DialogFooter,{className:"px-6 py-4 shrink-0 flex flex-col gap-2 sm:flex-row sm:justify-end border-t border-white/10 bg-zinc-950",children:[(0,b.jsx)(D.Button,{variant:"outline",onClick:e,disabled:i,className:"border-white/20 text-white hover:bg-white/10 bg-transparent",children:"Cancel"}),(0,b.jsx)(D.Button,{onClick:ae,disabled:i||"existing"===g&&!s||"new"===g&&!aa.legal_name.trim(),className:"bg-emerald-500 hover:bg-emerald-600 text-emerald-950 font-semibold",children:i?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(w.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),"Linking..."]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(k.Plus,{className:"mr-2 h-4 w-4"}),"Link Investor"]})})]})]})})}let as=[{value:"critical",label:"Critical"},{value:"warning",label:"Warning"},{value:"info",label:"Info"},{value:"success",label:"Success"}],at=[{value:"compliance",label:"Compliance"},{value:"documentation",label:"Documentation"},{value:"reporting",label:"Reporting"},{value:"tasks",label:"Operational Task"},{value:"other",label:"Other"}];function au({entityId:a,open:d,onClose:e,onSuccess:f}){let[g,h]=(0,c.useState)(!1),[i,j]=(0,c.useState)(""),[l,m]=(0,c.useState)("warning"),[n,o]=(0,c.useState)("documentation"),[p,q]=(0,c.useState)(""),[r,s]=(0,c.useState)(""),t=()=>{j(""),m("warning"),o("documentation"),q(""),s("")},u=()=>{g||(t(),e())},v=async()=>{if(!i.trim())return void X.toast.error("A title is required for the flag.");h(!0);try{let b=await fetch(`/api/entities/${a}/flags`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:i.trim(),flag_type:n,severity:l,description:r.trim()||null,due_date:p||null})});if(!b.ok){let a=await b.json().catch(()=>({}));throw Error(a.error||"Failed to create flag")}let c=await b.json();X.toast.success("Flag created for this entity."),f(c.flag),t(),e()}catch(a){console.error("Failed to create flag:",a),X.toast.error(a instanceof Error?a.message:"Unable to create flag.")}finally{h(!1)}};return(0,b.jsx)(G.Dialog,{open:d,onOpenChange:u,children:(0,b.jsxs)(G.DialogContent,{className:"max-w-lg bg-zinc-950 border-white/10 text-white",children:[(0,b.jsxs)(G.DialogHeader,{children:[(0,b.jsx)(G.DialogTitle,{className:"text-white",children:"Raise Entity Flag"}),(0,b.jsx)(G.DialogDescription,{className:"text-gray-400",children:"Highlight a compliance issue, missing documentation, or follow-up item for this vehicle."})]}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(I.Label,{htmlFor:"flag-title",className:"text-white",children:"Title *"}),(0,b.jsx)(H.Input,{id:"flag-title",value:i,onChange:a=>j(a.target.value),placeholder:"e.g., KYC documents outstanding",className:"bg-white/5 border-white/10 text-white placeholder:text-gray-500",autoFocus:!0})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(I.Label,{htmlFor:"flag-severity",className:"text-white",children:"Severity"}),(0,b.jsxs)(F.Select,{value:l,onValueChange:m,children:[(0,b.jsx)(F.SelectTrigger,{id:"flag-severity",className:"bg-white/5 border-white/10 text-white",children:(0,b.jsx)(F.SelectValue,{})}),(0,b.jsx)(F.SelectContent,{className:"bg-zinc-950 border-white/10",children:as.map(a=>(0,b.jsx)(F.SelectItem,{value:a.value,className:"text-white",children:a.label},a.value))})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(I.Label,{htmlFor:"flag-type",className:"text-white",children:"Category"}),(0,b.jsxs)(F.Select,{value:n,onValueChange:o,children:[(0,b.jsx)(F.SelectTrigger,{id:"flag-type",className:"bg-white/5 border-white/10 text-white",children:(0,b.jsx)(F.SelectValue,{})}),(0,b.jsx)(F.SelectContent,{className:"bg-zinc-950 border-white/10",children:at.map(a=>(0,b.jsx)(F.SelectItem,{value:a.value,className:"text-white",children:a.label},a.value))})]})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(I.Label,{htmlFor:"flag-due-date",className:"text-white",children:"Due Date"}),(0,b.jsx)(H.Input,{id:"flag-due-date",type:"date",value:p,onChange:a=>q(a.target.value),className:"bg-white/5 border-white/10 text-white"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(I.Label,{htmlFor:"flag-description",className:"text-white",children:"Details"}),(0,b.jsx)(M.Textarea,{id:"flag-description",rows:4,value:r,onChange:a=>s(a.target.value),placeholder:"Optional context or remediation steps.",className:"bg-white/5 border-white/10 text-white placeholder:text-gray-500"})]})]}),(0,b.jsxs)(G.DialogFooter,{className:"gap-2 sm:gap-0",children:[(0,b.jsx)(D.Button,{variant:"outline",onClick:u,disabled:g,className:"border-white/10 text-white hover:bg-white/10",children:"Cancel"}),(0,b.jsx)(D.Button,{onClick:v,disabled:g,className:"bg-emerald-500 hover:bg-emerald-600 text-emerald-950 font-semibold",children:g?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(w.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),"Saving..."]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(k.Plus,{className:"mr-2 h-4 w-4"}),"Create Flag"]})})]})]})})}var av=a.i(168118),aw=a.i(672606),ax=a.i(926076),ay=a.i(778541);let az={metadata:v.Info,stakeholders:l.Users,directors:P.User,documents:j.FileText,deals:o.Briefcase,investors:p.ShieldCheck},aA={metadata:"Metadata Completeness",stakeholders:"Stakeholder Coverage",directors:"Director Status",documents:"Document Requirements",deals:"Deal Activity",investors:"Investor Status"};function aB(a){switch(a){case"pass":return(0,b.jsx)(t.CheckCircle2,{className:"h-4 w-4 text-emerald-400"});case"warning":return(0,b.jsx)(s.AlertTriangle,{className:"h-4 w-4 text-amber-400"});case"fail":return(0,b.jsx)(u.AlertCircle,{className:"h-4 w-4 text-red-400"})}}function aC(a){switch(a){case"pass":return"text-emerald-400";case"warning":return"text-amber-400";case"fail":return"text-red-400"}}function aD(a){switch(a){case"pass":return"bg-emerald-500/20 border-emerald-400/40 text-emerald-100";case"warning":return"bg-amber-500/20 border-amber-400/40 text-amber-100";case"fail":return"bg-red-500/20 border-red-400/40 text-red-100"}}function aE({check:a,onAction:c}){return(0,b.jsxs)("div",{className:"flex items-start gap-3 p-3 rounded-lg border border-white/10 bg-white/5 hover:bg-white/10 transition-colors",children:[(0,b.jsx)("div",{className:"pt-0.5",children:aB(a.status)}),(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsxs)("div",{className:"flex items-start justify-between gap-2",children:[(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("p",{className:"text-sm font-medium text-foreground",children:a.title}),(0,b.jsx)("p",{className:`text-xs mt-0.5 ${"pass"===a.status?"text-muted-foreground":aC(a.status)}`,children:a.message}),a.details&&(0,b.jsx)("p",{className:"text-xs text-muted-foreground mt-1 italic",children:a.details})]}),(0,b.jsx)(E.Badge,{className:aD(a.status),variant:"outline",children:a.status})]}),a.actionable&&c&&"pass"!==a.status&&(0,b.jsx)(D.Button,{size:"sm",variant:"outline",className:"mt-2 h-7 text-xs",onClick:()=>c(a.actionable.action),children:a.actionable.label})]})]})}function aF({entity:a,directors:d,stakeholders:e,documents:f,folders:g,deals:h,investors:i,onAction:j}){let k=(0,c.useMemo)(()=>{var b,c,j,k,l,m,n;let o,p,q,r,s,t,u,v,w,x;return v=(n=[...(c=(b={entity:a,directors:d,stakeholders:e,documents:f,folders:g,deals:h,investors:i}).entity,(o=[]).push({id:"metadata_name",category:"metadata",title:"Legal Name",status:"pass",message:"Entity has a valid legal name"}),c.entity_code?o.push({id:"metadata_code",category:"metadata",title:"Entity Code",status:"pass",message:`Entity code: ${c.entity_code}`}):o.push({id:"metadata_code",category:"metadata",title:"Entity Code",status:"warning",message:"Entity code is not set",actionable:{label:"Add entity code",action:"edit_metadata"}}),c.status&&"TBD"!==c.status?o.push({id:"metadata_status",category:"metadata",title:"Entity Status",status:"pass",message:`Status: ${c.status}`}):o.push({id:"metadata_status",category:"metadata",title:"Entity Status",status:"warning",message:"Entity status needs clarification",details:"TBD"===c.status?"Status is marked as To Be Determined":"No status set",actionable:{label:"Update status",action:"edit_metadata"}}),c.domicile?o.push({id:"metadata_domicile",category:"metadata",title:"Domicile",status:"pass",message:`Domicile: ${c.domicile}`}):o.push({id:"metadata_domicile",category:"metadata",title:"Domicile",status:"fail",message:"Domicile is required but not set",actionable:{label:"Set domicile",action:"edit_metadata"}}),c.legal_jurisdiction?o.push({id:"metadata_jurisdiction",category:"metadata",title:"Legal Jurisdiction",status:"pass",message:`Jurisdiction: ${c.legal_jurisdiction}`}):o.push({id:"metadata_jurisdiction",category:"metadata",title:"Legal Jurisdiction",status:"warning",message:"Legal jurisdiction not specified",actionable:{label:"Add jurisdiction",action:"edit_metadata"}}),c.formation_date?o.push({id:"metadata_formation",category:"metadata",title:"Formation Date",status:"pass",message:`Formed: ${new Date(c.formation_date).toLocaleDateString()}`}):o.push({id:"metadata_formation",category:"metadata",title:"Formation Date",status:"warning",message:"Formation date not recorded",actionable:{label:"Add formation date",action:"edit_metadata"}}),c.registration_number?o.push({id:"metadata_registration",category:"metadata",title:"Registration Number",status:"pass",message:`Registration: ${c.registration_number}`}):o.push({id:"metadata_registration",category:"metadata",title:"Registration Number",status:"warning",message:"Registration number not recorded",details:"Important for legal documentation and filings",actionable:{label:"Add registration number",action:"edit_metadata"}}),o),...(j=b.stakeholders,p=[],q=j.filter(a=>!a.effective_to),[{role:"lawyer",title:"Legal Counsel",severity:"fail"},{role:"accountant",title:"Accountant",severity:"fail"},{role:"auditor",title:"Auditor",severity:"warning"},{role:"administrator",title:"Administrator",severity:"warning"}].forEach(({role:a,title:b,severity:c})=>{if(q.some(b=>b.role===a)){let c=q.filter(b=>b.role===a).length;p.push({id:`stakeholder_${a}`,category:"stakeholders",title:`${b} Coverage`,status:"pass",message:`${c} active ${b.toLowerCase()}${c>1?"s":""} assigned`})}else p.push({id:`stakeholder_${a}`,category:"stakeholders",title:`${b} Coverage`,status:c,message:`No active ${b.toLowerCase()} assigned`,details:"fail"===c?"This is a critical requirement for entity governance":void 0,actionable:{label:`Add ${b.toLowerCase()}`,action:"add_stakeholder"}})}),0===q.length?p.push({id:"stakeholder_count",category:"stakeholders",title:"Total Stakeholders",status:"fail",message:"No stakeholders assigned to this entity",actionable:{label:"Add stakeholders",action:"add_stakeholder"}}):p.push({id:"stakeholder_count",category:"stakeholders",title:"Total Stakeholders",status:"pass",message:`${q.length} active stakeholder${q.length>1?"s":""}`}),p),...(k=b.directors,r=[],0===(s=k.filter(a=>!a.effective_to)).length?r.push({id:"director_count",category:"directors",title:"Active Directors",status:"fail",message:"Entity has no active directors",details:"At least one director is required for legal compliance",actionable:{label:"Add director",action:"add_director"}}):1===s.length?r.push({id:"director_count",category:"directors",title:"Active Directors",status:"warning",message:"Only one active director",details:"Consider adding additional directors for governance best practices"}):r.push({id:"director_count",category:"directors",title:"Active Directors",status:"pass",message:`${s.length} active directors`}),(t=k.filter(a=>!!a.effective_from&&!!a.effective_to&&new Date(a.effective_to)<new Date(a.effective_from))).length>0?r.push({id:"director_dates",category:"directors",title:"Director Date Validity",status:"fail",message:`${t.length} director(s) have invalid date ranges`,details:"Effective end date is before start date"}):r.push({id:"director_dates",category:"directors",title:"Director Date Validity",status:"pass",message:"All director date ranges are valid"}),r),...(l=b.documents,m=b.folders,u=[],[{type:"kyc",title:"KYC Documents",severity:"fail"},{type:"legal",title:"Legal Documents",severity:"fail"},{type:"formation",title:"Formation Documents",severity:"warning"},{type:"regulatory",title:"Regulatory Filings",severity:"warning"}].forEach(({type:a,title:b,severity:c})=>{let d=m.find(b=>b.folder_type===a);if(!d)return void u.push({id:`documents_${a}`,category:"documents",title:b,status:c,message:`No ${a} folder exists`,actionable:{label:`Create ${a} folder`,action:"create_folder"}});let e=l.filter(a=>a.folder_id===d.id);0===e.length?u.push({id:`documents_${a}`,category:"documents",title:b,status:c,message:`No ${a} documents uploaded`,details:`${b} folder exists but is empty`,actionable:{label:"Upload documents",action:"upload_document"}}):u.push({id:`documents_${a}`,category:"documents",title:b,status:"pass",message:`${e.length} ${a} document${e.length>1?"s":""}`})}),0===l.length?u.push({id:"documents_total",category:"documents",title:"Total Documents",status:"fail",message:"No documents uploaded for this entity",actionable:{label:"Upload document",action:"upload_document"}}):u.push({id:"documents_total",category:"documents",title:"Total Documents",status:"pass",message:`${l.length} document${l.length>1?"s":""} uploaded`}),u),...function(a){let b=[];if(0===a.length)b.push({id:"deal_count",category:"deals",title:"Deal Activity",status:"warning",message:"No deals linked to this entity",details:"Entity may not be actively used for investments"});else{let c=a.filter(a=>"active"===a.status);0===c.length?b.push({id:"deal_active",category:"deals",title:"Active Deals",status:"warning",message:"No active deals",details:`${a.length} total deal${a.length>1?"s":""}, but none are active`}):b.push({id:"deal_active",category:"deals",title:"Active Deals",status:"pass",message:`${c.length} active deal${c.length>1?"s":""}`}),b.push({id:"deal_count",category:"deals",title:"Total Deals",status:"pass",message:`${a.length} deal${a.length>1?"s":""} linked`})}return b}(b.deals),...function(a){let b=[];if(0===a.length)b.push({id:"investor_count",category:"investors",title:"Investor Coverage",status:"warning",message:"No investors linked to this entity",actionable:{label:"Link investor",action:"link_investor"}});else{let c=a.filter(a=>"active"===a.allocation_status||"committed"===a.allocation_status);0===c.length?b.push({id:"investor_active",category:"investors",title:"Active Investors",status:"warning",message:"No active investor allocations",details:`${a.length} investor${a.length>1?"s":""} linked but none are active/committed`}):b.push({id:"investor_active",category:"investors",title:"Active Investors",status:"pass",message:`${c.length} active/committed investor${c.length>1?"s":""}`}),b.push({id:"investor_count",category:"investors",title:"Total Investors",status:"pass",message:`${a.length} investor${a.length>1?"s":""} linked`})}return b}(b.investors)]).filter(a=>"pass"===a.status).length,w=n.filter(a=>"warning"===a.status).length,x=n.filter(a=>"fail"===a.status).length,{overallScore:Math.round(v/n.length*100),overallStatus:x>0?"fail":w>3||w>0?"warning":"pass",checks:n,passCount:v,warningCount:w,failCount:x}},[a,d,e,f,g,h,i]),l=(0,c.useMemo)(()=>{let a={};return k.checks.forEach(b=>{a[b.category]||(a[b.category]=[]),a[b.category].push(b)}),a},[k.checks]),[m,o]=(0,c.useState)(new Set(["metadata"]));return(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)(B.Card,{className:"border border-white/10 bg-gradient-to-br from-white/5 to-white/10",children:[(0,b.jsx)(B.CardHeader,{children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("div",{className:"h-12 w-12 rounded-full bg-emerald-500/20 flex items-center justify-center",children:(0,b.jsx)(n.Activity,{className:"h-6 w-6 text-emerald-400"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)(B.CardTitle,{className:"text-2xl",children:"Entity Health Score"}),(0,b.jsx)(B.CardDescription,{children:"Real-time monitoring of entity compliance and completeness"})]})]}),(0,b.jsxs)("div",{className:"text-right",children:[(0,b.jsxs)("div",{className:`text-4xl font-bold ${aC(k.overallStatus)}`,children:[k.overallScore,"%"]}),(0,b.jsxs)(E.Badge,{className:aD(k.overallStatus),children:["pass"===k.overallStatus&&"Healthy","warning"===k.overallStatus&&"Needs Attention","fail"===k.overallStatus&&"Critical Issues"]})]})]})}),(0,b.jsx)(B.CardContent,{children:(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsx)(ay.Progress,{value:k.overallScore,className:"h-3"}),(0,b.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,b.jsxs)("div",{className:"flex items-center gap-4",children:[(0,b.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,b.jsx)(t.CheckCircle2,{className:"h-4 w-4 text-emerald-400"}),(0,b.jsx)("span",{className:"text-foreground font-medium",children:k.passCount}),(0,b.jsx)("span",{className:"text-muted-foreground",children:"Passed"})]}),(0,b.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,b.jsx)(s.AlertTriangle,{className:"h-4 w-4 text-amber-400"}),(0,b.jsx)("span",{className:"text-foreground font-medium",children:k.warningCount}),(0,b.jsx)("span",{className:"text-muted-foreground",children:"Warnings"})]}),(0,b.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,b.jsx)(u.AlertCircle,{className:"h-4 w-4 text-red-400"}),(0,b.jsx)("span",{className:"text-foreground font-medium",children:k.failCount}),(0,b.jsx)("span",{className:"text-muted-foreground",children:"Failed"})]})]}),(0,b.jsxs)("span",{className:"text-muted-foreground",children:[k.checks.length," total checks"]})]})]})})]}),(0,b.jsx)("div",{className:"space-y-3",children:Object.entries(l).map(([a,c])=>{let d=az[a]||v.Info,e=m.has(a);c.filter(a=>"pass"===a.status).length;let f=c.filter(a=>"warning"===a.status).length,g=c.filter(a=>"fail"===a.status).length,h="pass";return g>0?h="fail":f>0&&(h="warning"),(0,b.jsx)(ax.Collapsible,{open:e,onOpenChange:()=>{o(b=>{let c=new Set(b);return c.has(a)?c.delete(a):c.add(a),c})},children:(0,b.jsxs)(B.Card,{className:"border border-white/10 bg-white/5",children:[(0,b.jsx)(ax.CollapsibleTrigger,{asChild:!0,children:(0,b.jsx)(B.CardHeader,{className:"cursor-pointer hover:bg-white/5 transition-colors",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[e?(0,b.jsx)(av.ChevronDown,{className:"h-5 w-5 text-muted-foreground"}):(0,b.jsx)(aw.ChevronRight,{className:"h-5 w-5 text-muted-foreground"}),(0,b.jsx)("div",{className:`h-10 w-10 rounded-full flex items-center justify-center ${"pass"===h?"bg-emerald-500/20":"warning"===h?"bg-amber-500/20":"bg-red-500/20"}`,children:(0,b.jsx)(d,{className:`h-5 w-5 ${"pass"===h?"text-emerald-400":"warning"===h?"text-amber-400":"text-red-400"}`})}),(0,b.jsxs)("div",{children:[(0,b.jsx)(B.CardTitle,{className:"text-base",children:aA[a]}),(0,b.jsxs)("div",{className:"flex items-center gap-2 mt-1",children:[(0,b.jsxs)("span",{className:"text-xs text-muted-foreground",children:[c.length," check",c.length>1?"s":""]}),g>0&&(0,b.jsxs)(E.Badge,{className:"bg-red-500/20 border-red-400/40 text-red-100 text-xs h-5",children:[g," failed"]}),f>0&&0===g&&(0,b.jsxs)(E.Badge,{className:"bg-amber-500/20 border-amber-400/40 text-amber-100 text-xs h-5",children:[f," warning",f>1?"s":""]})]})]})]}),(0,b.jsx)("div",{className:"text-right",children:aB(h)})]})})}),(0,b.jsx)(ax.CollapsibleContent,{children:(0,b.jsxs)(B.CardContent,{className:"space-y-2 pt-0",children:[(0,b.jsx)("div",{className:"h-px bg-white/10 mb-3"}),c.map(a=>(0,b.jsx)(aE,{check:a,onAction:j},a.id))]})})]})},a)})}),"pass"!==k.overallStatus&&(0,b.jsxs)(B.Card,{className:"border border-emerald-400/40 bg-emerald-500/10",children:[(0,b.jsxs)(B.CardHeader,{children:[(0,b.jsxs)(B.CardTitle,{className:"text-emerald-100 flex items-center gap-2",children:[(0,b.jsx)(n.Activity,{className:"h-5 w-5"}),"Recommended Actions"]}),(0,b.jsx)(B.CardDescription,{className:"text-emerald-200/80",children:"Take these actions to improve your entity health score"})]}),(0,b.jsx)(B.CardContent,{className:"space-y-2",children:k.checks.filter(a=>"pass"!==a.status&&a.actionable).slice(0,5).map(a=>(0,b.jsxs)("div",{className:"flex items-center justify-between p-3 rounded-lg border border-emerald-400/20 bg-emerald-500/5",children:[(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("p",{className:"text-sm font-medium text-emerald-100",children:a.title}),(0,b.jsx)("p",{className:"text-xs text-emerald-200/70",children:a.message})]}),a.actionable&&j&&(0,b.jsx)(D.Button,{size:"sm",variant:"outline",className:"ml-3 border-emerald-400/40 text-emerald-100 hover:bg-emerald-500/20",onClick:()=>j(a.actionable.action),children:a.actionable.label})]},a.id))})]})]})}var aG=a.i(905219),aH=a.i(641428),aI=a.i(458332),aJ=a.i(264634),aK=a.i(216316);let aL=a=>("entity"===a.folder_type||"vehicle_root"===a.folder_type)&&!a.parent_folder_id;function aM({entityId:a,folders:d,documents:e=[],selectedFolderId:f,onFolderSelect:g,onFoldersChange:h}){let[i,j]=(0,c.useState)(new Set),[k,l]=(0,c.useState)(!1),[m,n]=(0,c.useState)(!1),[o,p]=(0,c.useState)(!1),[q,s]=(0,c.useState)(null),[t,u]=(0,c.useState)(null),[v,w]=(0,c.useState)(null),[x,z]=(0,c.useState)(""),[A,B]=(0,c.useState)(!1),C=(0,c.useMemo)(()=>{let a=new Map;e.forEach(b=>{b.folder_id&&a.set(b.folder_id,(a.get(b.folder_id)||0)+1)});let b=d.find(a=>aL(a)),c=d.filter(a=>!b||a.id!==b.id),f=new Map,g=[];c.forEach(b=>{f.set(b.id,{...b,children:[],documentCount:a.get(b.id)||0,isExpanded:i.has(b.id)})}),c.forEach(a=>{let c=f.get(a.id);b&&a.parent_folder_id===b.id?g.push(c):a.parent_folder_id&&f.has(a.parent_folder_id)?f.get(a.parent_folder_id).children.push(c):a.parent_folder_id||g.push(c)});let h=a=>{a.sort((a,b)=>a.name.localeCompare(b.name)),a.forEach(a=>h(a.children))};return h(g),g},[d,e,i]),F=async()=>{if(!x.trim())return void X.toast.error("Folder name is required");let b=d.find(a=>aL(a)),c=q||b?.id||null;B(!0);try{let b=await fetch(`/api/entities/${a}/folders`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:x.trim(),parent_folder_id:c,folder_type:"custom"})});if(!b.ok){let a=await b.json();throw Error(a.error||"Failed to create folder")}X.toast.success("Folder created successfully"),z(""),s(null),l(!1),h()}catch(a){console.error("Failed to create folder:",a),X.toast.error(a instanceof Error?a.message:"Failed to create folder")}finally{B(!1)}},J=async()=>{if(!t||!x.trim())return void X.toast.error("Folder name is required");B(!0);try{let b=await fetch(`/api/entities/${a}/folders/${t.id}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:x.trim()})});if(!b.ok){let a=await b.json();throw Error(a.error||"Failed to rename folder")}X.toast.success("Folder renamed successfully"),z(""),u(null),n(!1),h()}catch(a){console.error("Failed to rename folder:",a),X.toast.error(a instanceof Error?a.message:"Failed to rename folder")}finally{B(!1)}},K=async()=>{if(v){B(!0);try{let b=await fetch(`/api/entities/${a}/folders/${v.id}`,{method:"DELETE"});if(!b.ok){let a=await b.json();throw Error(a.error||"Failed to delete folder")}X.toast.success("Folder deleted successfully"),w(null),p(!1),f===v.id&&g(null),h()}catch(a){console.error("Failed to delete folder:",a),X.toast.error(a instanceof Error?a.message:"Failed to delete folder")}finally{B(!1)}}},L=(a=null)=>{s(a),z(""),l(!0)},M=(a,c=0)=>{let d=f===a.id,e=a.children.length>0,h="vehicle_root"===a.folder_type||"category"===a.folder_type;return(0,b.jsxs)("div",{children:[(0,b.jsxs)("div",{className:`flex items-center justify-between gap-2 px-2 py-1.5 rounded-md cursor-pointer transition-colors ${d?"bg-emerald-500/20 border-l-2 border-emerald-400":"hover:bg-white/5 border-l-2 border-transparent"}`,style:{paddingLeft:`${16*c+8}px`},children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 flex-1 min-w-0",onClick:()=>g(a.id),children:[e&&(0,b.jsx)("button",{onClick:b=>{var c;b.stopPropagation(),c=a.id,j(a=>{let b=new Set(a);return b.has(c)?b.delete(c):b.add(c),b})},className:"p-0.5 hover:bg-white/10 rounded",children:a.isExpanded?(0,b.jsx)(av.ChevronDown,{className:"h-4 w-4 text-muted-foreground"}):(0,b.jsx)(aw.ChevronRight,{className:"h-4 w-4 text-muted-foreground"})}),!e&&(0,b.jsx)("div",{className:"w-5"}),a.isExpanded||d?(0,b.jsx)(r.FolderOpen,{className:"h-4 w-4 text-emerald-400 shrink-0"}):(0,b.jsx)(aG.Folder,{className:"h-4 w-4 text-emerald-400 shrink-0"}),(0,b.jsx)("span",{className:`text-sm truncate ${d?"text-foreground font-medium":"text-muted-foreground"}`,children:a.name}),a.documentCount>0&&(0,b.jsx)(E.Badge,{variant:"outline",className:"text-xs h-5 bg-white/5 border-white/10",children:a.documentCount})]}),!h&&(0,b.jsxs)(aK.DropdownMenu,{children:[(0,b.jsx)(aK.DropdownMenuTrigger,{asChild:!0,onClick:a=>a.stopPropagation(),children:(0,b.jsx)(D.Button,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0 opacity-0 group-hover:opacity-100 hover:bg-white/10",children:(0,b.jsx)(aJ.MoreVertical,{className:"h-3 w-3"})})}),(0,b.jsxs)(aK.DropdownMenuContent,{align:"end",className:"bg-zinc-950 border-white/10",children:[(0,b.jsxs)(aK.DropdownMenuItem,{onClick:()=>L(a.id),className:"gap-2",children:[(0,b.jsx)(aH.FolderPlus,{className:"h-4 w-4"}),"New Subfolder"]}),(0,b.jsxs)(aK.DropdownMenuItem,{onClick:()=>{u(a),z(a.name),n(!0)},className:"gap-2",children:[(0,b.jsx)(aI.Edit2,{className:"h-4 w-4"}),"Rename"]}),(0,b.jsxs)(aK.DropdownMenuItem,{onClick:()=>{w(a),p(!0)},className:"gap-2 text-red-400 focus:text-red-300",children:[(0,b.jsx)(y.Trash2,{className:"h-4 w-4"}),"Delete"]})]})]})]}),a.isExpanded&&a.children.map(a=>M(a,c+1))]},a.id)};return(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("h3",{className:"text-sm font-medium text-foreground",children:"Folders"}),(0,b.jsxs)(D.Button,{size:"sm",variant:"outline",className:"h-7 gap-1 text-xs",onClick:()=>L(null),children:[(0,b.jsx)(aH.FolderPlus,{className:"h-3 w-3"}),"New Folder"]})]}),(0,b.jsx)("div",{className:"border border-white/10 rounded-lg bg-white/5 p-2 space-y-0.5 max-h-[400px] overflow-y-auto",children:0===C.length?(0,b.jsxs)("div",{className:"py-8 text-center text-sm text-muted-foreground",children:[(0,b.jsx)(aG.Folder,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),(0,b.jsx)("p",{children:"No folders yet"}),(0,b.jsx)("p",{className:"text-xs mt-1",children:"Create your first folder to organize documents"})]}):C.map(a=>M(a))}),(0,b.jsx)(G.Dialog,{open:k,onOpenChange:l,children:(0,b.jsxs)(G.DialogContent,{className:"bg-zinc-950 border-white/10 text-white",children:[(0,b.jsxs)(G.DialogHeader,{children:[(0,b.jsxs)(G.DialogTitle,{className:"flex items-center gap-2 text-white",children:[(0,b.jsx)(aH.FolderPlus,{className:"h-5 w-5 text-emerald-400"}),"Create New Folder"]}),(0,b.jsx)(G.DialogDescription,{className:"text-gray-400",children:q?`Creating subfolder in "${d.find(a=>a.id===q)?.name}"`:"Creating folder at root level"})]}),(0,b.jsx)("div",{className:"space-y-4 py-4",children:(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(I.Label,{htmlFor:"folder-name",className:"text-white",children:"Folder Name *"}),(0,b.jsx)(H.Input,{id:"folder-name",value:x,onChange:a=>z(a.target.value),placeholder:"e.g., Q4 2024 Reports",className:"bg-white/5 border-white/10 text-white placeholder:text-gray-500",autoFocus:!0,onKeyDown:a=>{"Enter"===a.key&&x.trim()&&F()}})]})}),(0,b.jsxs)(G.DialogFooter,{children:[(0,b.jsx)(D.Button,{variant:"outline",onClick:()=>l(!1),disabled:A,className:"bg-gray-700 text-white border-gray-600 hover:bg-gray-600",children:"Cancel"}),(0,b.jsx)(D.Button,{onClick:F,disabled:A||!x.trim(),className:"bg-emerald-600 hover:bg-emerald-700 text-white",children:"Create Folder"})]})]})}),(0,b.jsx)(G.Dialog,{open:m,onOpenChange:n,children:(0,b.jsxs)(G.DialogContent,{className:"bg-zinc-950 border-white/10 text-white",children:[(0,b.jsxs)(G.DialogHeader,{children:[(0,b.jsxs)(G.DialogTitle,{className:"flex items-center gap-2 text-white",children:[(0,b.jsx)(aI.Edit2,{className:"h-5 w-5 text-emerald-400"}),"Rename Folder"]}),(0,b.jsxs)(G.DialogDescription,{className:"text-gray-400",children:['Renaming "',t?.name,'"']})]}),(0,b.jsx)("div",{className:"space-y-4 py-4",children:(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(I.Label,{htmlFor:"rename-folder",className:"text-white",children:"New Name *"}),(0,b.jsx)(H.Input,{id:"rename-folder",value:x,onChange:a=>z(a.target.value),placeholder:"Enter new folder name",className:"bg-white/5 border-white/10 text-white placeholder:text-gray-500",autoFocus:!0,onKeyDown:a=>{"Enter"===a.key&&x.trim()&&J()}})]})}),(0,b.jsxs)(G.DialogFooter,{children:[(0,b.jsx)(D.Button,{variant:"outline",onClick:()=>n(!1),disabled:A,className:"bg-gray-700 text-white border-gray-600 hover:bg-gray-600",children:"Cancel"}),(0,b.jsx)(D.Button,{onClick:J,disabled:A||!x.trim(),className:"bg-emerald-600 hover:bg-emerald-700 text-white",children:"Rename"})]})]})}),(0,b.jsx)(G.Dialog,{open:o,onOpenChange:p,children:(0,b.jsxs)(G.DialogContent,{className:"bg-zinc-950 border-white/10 text-white",children:[(0,b.jsxs)(G.DialogHeader,{children:[(0,b.jsxs)(G.DialogTitle,{className:"flex items-center gap-2 text-red-400",children:[(0,b.jsx)(y.Trash2,{className:"h-5 w-5"}),"Delete Folder"]}),(0,b.jsxs)(G.DialogDescription,{className:"text-gray-400",children:['Are you sure you want to delete "',v?.name,'"? This action cannot be undone.']})]}),(0,b.jsx)("div",{className:"py-4 text-sm text-gray-400",children:v&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("p",{className:"mb-2 text-white",children:"The folder must be empty before deletion:"}),(0,b.jsxs)("ul",{className:"list-disc list-inside space-y-1",children:[(0,b.jsx)("li",{children:"Move all documents to another folder"}),(0,b.jsx)("li",{children:"Delete all subfolders first"})]})]})}),(0,b.jsxs)(G.DialogFooter,{children:[(0,b.jsx)(D.Button,{variant:"outline",onClick:()=>p(!1),disabled:A,className:"bg-gray-700 text-white border-gray-600 hover:bg-gray-600",children:"Cancel"}),(0,b.jsx)(D.Button,{variant:"destructive",onClick:K,disabled:A,className:"bg-red-500 hover:bg-red-600 text-white",children:"Delete Folder"})]})]})})]})}let aN=T.z.object({commitment:T.z.number().nonnegative("Commitment must be positive"),currency:T.z.string().length(3,"Currency must be 3 letters").transform(a=>a.toUpperCase()),status:T.z.enum(["pending","committed","partially_funded","funded","active","closed","cancelled"]),effective_date:T.z.string().optional().nullable(),funding_due_at:T.z.string().optional().nullable(),committed_at:T.z.string().optional().nullable(),contract_date:T.z.string().optional().nullable(),price_per_share:T.z.number().nonnegative("Price per share must be positive").optional().nullable(),cost_per_share:T.z.number().nonnegative("Cost per share must be positive").optional().nullable(),num_shares:T.z.number().nonnegative("Number of shares must be positive").optional().nullable(),units:T.z.number().nonnegative("Units must be positive").optional().nullable(),spread_per_share:T.z.number().optional().nullable(),spread_fee_amount:T.z.number().nonnegative("Spread fee must be positive").optional().nullable(),subscription_fee_percent:T.z.number().min(0,"Subscription fee percent must be positive").max(100,"Subscription fee percent cannot exceed 100%").optional().nullable(),subscription_fee_amount:T.z.number().nonnegative("Subscription fee must be positive").optional().nullable(),bd_fee_percent:T.z.number().min(0,"BD fee percent must be positive").max(100,"BD fee percent cannot exceed 100%").optional().nullable(),bd_fee_amount:T.z.number().nonnegative("BD fee must be positive").optional().nullable(),finra_fee_amount:T.z.number().nonnegative("FINRA fee must be positive").optional().nullable(),performance_fee_tier1_percent:T.z.number().min(0,"Performance fee tier 1 percent must be positive").max(100,"Performance fee tier 1 percent cannot exceed 100%").optional().nullable(),performance_fee_tier1_threshold:T.z.number().nonnegative("Performance fee tier 1 threshold must be positive").optional().nullable(),performance_fee_tier2_percent:T.z.number().min(0,"Performance fee tier 2 percent must be positive").max(100,"Performance fee tier 2 percent cannot exceed 100%").optional().nullable(),performance_fee_tier2_threshold:T.z.number().nonnegative("Performance fee tier 2 threshold must be positive").optional().nullable(),funded_amount:T.z.number().nonnegative("Funded amount must be positive").optional().nullable(),outstanding_amount:T.z.number().nonnegative("Outstanding amount must be positive").optional().nullable(),capital_calls_total:T.z.number().nonnegative("Capital calls total must be positive").optional().nullable(),distributions_total:T.z.number().nonnegative("Distributions total must be positive").optional().nullable(),current_nav:T.z.number().optional().nullable(),signed_doc_id:T.z.string().uuid("Signed document ID must be a valid UUID").optional().nullable(),acknowledgement_notes:T.z.string().optional().nullable(),opportunity_name:T.z.string().optional().nullable(),sourcing_contract_ref:T.z.string().optional().nullable(),introducer_id:T.z.string().uuid("Introducer ID must be a valid UUID").optional().nullable(),introduction_id:T.z.string().uuid("Introduction ID must be a valid UUID").optional().nullable()}).refine(a=>!a.effective_date||!a.funding_due_at||new Date(a.effective_date)<=new Date(a.funding_due_at),{message:"Funding due date must be after effective date",path:["funding_due_at"]}).refine(a=>!a.contract_date||new Date(a.contract_date)<=new Date,{message:"Contract date cannot be in the future",path:["contract_date"]}).refine(a=>{if(null!=a.price_per_share&&null!=a.cost_per_share&&null!=a.spread_per_share){let b=a.price_per_share-a.cost_per_share;return .01>=Math.abs(a.spread_per_share-b)}return!0},{message:"Spread per share must equal price per share minus cost per share",path:["spread_per_share"]}).refine(a=>{if(null!=a.subscription_fee_percent&&null!=a.subscription_fee_amount&&a.commitment){let b=a.commitment*a.subscription_fee_percent/100;return .01>=Math.abs(a.subscription_fee_amount-b)}return!0},{message:"Subscription fee amount must match subscription fee percentage",path:["subscription_fee_amount"]}).refine(a=>{if(null!=a.bd_fee_percent&&null!=a.bd_fee_amount&&a.commitment){let b=a.commitment*a.bd_fee_percent/100;return .01>=Math.abs(a.bd_fee_amount-b)}return!0},{message:"BD fee amount must match BD fee percentage",path:["bd_fee_amount"]}).refine(a=>{if(null!=a.spread_per_share&&null!=a.num_shares&&null!=a.spread_fee_amount){let b=a.spread_per_share*a.num_shares;return .01>=Math.abs(a.spread_fee_amount-b)}return!0},{message:"Spread fee amount must equal spread per share times number of shares",path:["spread_fee_amount"]}).refine(a=>null==a.performance_fee_tier1_threshold||null==a.performance_fee_tier2_threshold||a.performance_fee_tier2_threshold>=a.performance_fee_tier1_threshold,{message:"Performance fee tier 2 threshold must be greater than or equal to tier 1 threshold",path:["performance_fee_tier2_threshold"]}).refine(a=>null==a.funded_amount||!a.commitment||a.funded_amount<=a.commitment,{message:"Funded amount cannot exceed commitment",path:["funded_amount"]}).refine(a=>{if(null!=a.funded_amount&&null!=a.outstanding_amount&&a.commitment){let b=a.commitment-a.funded_amount;return .01>=Math.abs(a.outstanding_amount-b)}return!0},{message:"Outstanding amount must equal commitment minus funded amount",path:["outstanding_amount"]});function aO({open:a,onClose:c,entityId:d,investorId:e,defaultValues:f,onSuccess:g}){let{form:h,onSubmit:i,isSubmitting:j}=function({entityId:a,investorId:b,defaultValues:c,onSuccess:d}){let e=(0,R.useForm)({resolver:(0,S.zodResolver)(aN),defaultValues:c||{commitment:0,currency:"USD",status:"pending"}}),f=async c=>{try{let e=await fetch(`/api/entities/${a}/investors/${b}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({allocation_status:c.status,subscription:c})});if(!e.ok){let a=await e.json();throw Error(a.error||"Failed to update subscription")}let f=await e.json();X.toast.success("Subscription updated successfully"),d?.(f)}catch(a){throw console.error("Failed to update subscription:",a),X.toast.error(a instanceof Error?a.message:"Failed to update subscription"),a}};return{form:e,onSubmit:e.handleSubmit(f),isSubmitting:e.formState.isSubmitting}}({entityId:d,investorId:e,defaultValues:f,onSuccess:a=>{g?.(a.investor),c()}});return(0,b.jsx)(G.Dialog,{open:a,onOpenChange:c,children:(0,b.jsxs)(G.DialogContent,{className:"bg-zinc-950 border-white/10 text-white max-w-2xl",children:[(0,b.jsxs)(G.DialogHeader,{children:[(0,b.jsxs)(G.DialogTitle,{className:"flex items-center gap-2 text-white",children:[(0,b.jsx)(q.Edit,{className:"h-5 w-5 text-emerald-400"}),"Edit Subscription"]}),(0,b.jsx)(G.DialogDescription,{className:"text-gray-400",children:"Update subscription details for this investor's commitment to the vehicle"})]}),(0,b.jsx)(N.Form,{...h,children:(0,b.jsxs)("form",{onSubmit:i,className:"space-y-4 py-4",children:[(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,b.jsx)(N.FormField,{control:h.control,name:"commitment",render:({field:a})=>(0,b.jsxs)(N.FormItem,{children:[(0,b.jsx)(N.FormLabel,{className:"text-white",children:"Commitment Amount *"}),(0,b.jsx)(N.FormControl,{children:(0,b.jsx)(H.Input,{type:"number",step:"0.01",placeholder:"0.00",className:"bg-white/5 border-white/10 text-white",...a,onChange:b=>a.onChange(parseFloat(b.target.value)||0)})}),(0,b.jsx)(N.FormMessage,{})]})}),(0,b.jsx)(N.FormField,{control:h.control,name:"currency",render:({field:a})=>(0,b.jsxs)(N.FormItem,{children:[(0,b.jsx)(N.FormLabel,{className:"text-white",children:"Currency *"}),(0,b.jsx)(N.FormControl,{children:(0,b.jsx)(H.Input,{maxLength:3,placeholder:"USD",className:"bg-white/5 border-white/10 text-white uppercase",...a})}),(0,b.jsx)(N.FormMessage,{})]})})]}),(0,b.jsx)(N.FormField,{control:h.control,name:"status",render:({field:a})=>(0,b.jsxs)(N.FormItem,{children:[(0,b.jsx)(N.FormLabel,{className:"text-white",children:"Status *"}),(0,b.jsxs)(F.Select,{onValueChange:a.onChange,defaultValue:a.value,children:[(0,b.jsx)(N.FormControl,{children:(0,b.jsx)(F.SelectTrigger,{className:"bg-white/5 border-white/10 text-white",children:(0,b.jsx)(F.SelectValue,{})})}),(0,b.jsxs)(F.SelectContent,{className:"bg-zinc-950 border-white/10",children:[(0,b.jsx)(F.SelectItem,{value:"pending",className:"text-white",children:"Pending"}),(0,b.jsx)(F.SelectItem,{value:"committed",className:"text-white",children:"Committed"}),(0,b.jsx)(F.SelectItem,{value:"active",className:"text-white",children:"Active"}),(0,b.jsx)(F.SelectItem,{value:"closed",className:"text-white",children:"Closed"}),(0,b.jsx)(F.SelectItem,{value:"cancelled",className:"text-white",children:"Cancelled"})]})]}),(0,b.jsx)(N.FormMessage,{})]})}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,b.jsx)(N.FormField,{control:h.control,name:"effective_date",render:({field:a})=>(0,b.jsxs)(N.FormItem,{children:[(0,b.jsx)(N.FormLabel,{className:"text-white",children:"Effective Date"}),(0,b.jsx)(N.FormControl,{children:(0,b.jsx)(H.Input,{type:"date",className:"bg-white/5 border-white/10 text-white",...a,value:a.value||""})}),(0,b.jsx)(N.FormMessage,{})]})}),(0,b.jsx)(N.FormField,{control:h.control,name:"funding_due_at",render:({field:a})=>(0,b.jsxs)(N.FormItem,{children:[(0,b.jsx)(N.FormLabel,{className:"text-white",children:"Funding Due Date"}),(0,b.jsx)(N.FormControl,{children:(0,b.jsx)(H.Input,{type:"date",className:"bg-white/5 border-white/10 text-white",...a,value:a.value||""})}),(0,b.jsx)(N.FormDescription,{className:"text-xs text-gray-400",children:"Must be after effective date"}),(0,b.jsx)(N.FormMessage,{})]})})]}),(0,b.jsx)(N.FormField,{control:h.control,name:"units",render:({field:a})=>(0,b.jsxs)(N.FormItem,{children:[(0,b.jsx)(N.FormLabel,{className:"text-white",children:"Units"}),(0,b.jsx)(N.FormControl,{children:(0,b.jsx)(H.Input,{type:"number",step:"0.01",placeholder:"Number of units",className:"bg-white/5 border-white/10 text-white",...a,value:a.value||"",onChange:b=>a.onChange(parseFloat(b.target.value)||null)})}),(0,b.jsx)(N.FormMessage,{})]})}),(0,b.jsx)(N.FormField,{control:h.control,name:"acknowledgement_notes",render:({field:a})=>(0,b.jsxs)(N.FormItem,{children:[(0,b.jsx)(N.FormLabel,{className:"text-white",children:"Acknowledgement Notes"}),(0,b.jsx)(N.FormControl,{children:(0,b.jsx)(M.Textarea,{placeholder:"Internal notes about this subscription",className:"bg-white/5 border-white/10 text-white",rows:3,...a,value:a.value||""})}),(0,b.jsx)(N.FormMessage,{})]})}),(0,b.jsxs)(G.DialogFooter,{children:[(0,b.jsx)(D.Button,{type:"button",variant:"outline",onClick:c,className:"bg-gray-700 text-white border-gray-600 hover:bg-gray-600",disabled:j,children:"Cancel"}),(0,b.jsx)(D.Button,{type:"submit",className:"bg-emerald-600 hover:bg-emerald-700 text-white",disabled:j,children:j?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(w.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),"Saving..."]}):"Save Changes"})]})]})})]})})}function aP({vehicleId:a,open:d,onClose:e,onSuccess:f}){let[g,h]=(0,c.useState)(!1),[i,j]=(0,c.useState)(null),[k,l]=(0,c.useState)({nav_total:"",nav_per_unit:"",as_of_date:new Date().toISOString().split("T")[0]}),m=async b=>{b.preventDefault(),h(!0),j(null);try{let b=await fetch(`/api/staff/vehicles/${a}/valuations`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({nav_total:parseFloat(k.nav_total),nav_per_unit:parseFloat(k.nav_per_unit),as_of_date:k.as_of_date})});if(!b.ok){let a=await b.json().catch(()=>({}));throw Error(a.error||"Failed to add valuation")}l({nav_total:"",nav_per_unit:"",as_of_date:new Date().toISOString().split("T")[0]}),f(),e()}catch(a){j(a.message)}finally{h(!1)}};return(0,b.jsx)(G.Dialog,{open:d,onOpenChange:e,children:(0,b.jsx)(G.DialogContent,{className:"sm:max-w-[500px]",children:(0,b.jsxs)("form",{onSubmit:m,children:[(0,b.jsxs)(G.DialogHeader,{children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(A.TrendingUp,{className:"h-5 w-5 text-emerald-500"}),(0,b.jsx)(G.DialogTitle,{children:"Add Valuation"})]}),(0,b.jsx)(G.DialogDescription,{children:"Add a new NAV valuation for this vehicle"})]}),(0,b.jsxs)("div",{className:"space-y-4 py-4",children:[i&&(0,b.jsx)("div",{className:"rounded-md bg-red-500/10 border border-red-500/20 p-3 text-sm text-red-400",children:i}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(I.Label,{htmlFor:"as_of_date",children:"Valuation Date *"}),(0,b.jsx)(H.Input,{id:"as_of_date",type:"date",value:k.as_of_date,onChange:a=>l({...k,as_of_date:a.target.value}),required:!0,className:"bg-background border-border"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(I.Label,{htmlFor:"nav_total",children:"Total NAV *"}),(0,b.jsx)(H.Input,{id:"nav_total",type:"number",step:"0.01",placeholder:"1000000.00",value:k.nav_total,onChange:a=>l({...k,nav_total:a.target.value}),required:!0,className:"bg-background border-border"}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"Total Net Asset Value"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(I.Label,{htmlFor:"nav_per_unit",children:"NAV Per Unit *"}),(0,b.jsx)(H.Input,{id:"nav_per_unit",type:"number",step:"0.0001",placeholder:"100.00",value:k.nav_per_unit,onChange:a=>l({...k,nav_per_unit:a.target.value}),required:!0,className:"bg-background border-border"}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"NAV per individual unit/share"})]})]}),(0,b.jsxs)(G.DialogFooter,{children:[(0,b.jsx)(D.Button,{type:"button",variant:"outline",onClick:e,disabled:g,children:"Cancel"}),(0,b.jsxs)(D.Button,{type:"submit",disabled:g,children:[g&&(0,b.jsx)(w.Loader2,{className:"h-4 w-4 mr-2 animate-spin"}),"Add Valuation"]})]})]})})})}function aQ({vehicleId:a,valuation:d,open:e,onClose:f,onSuccess:g}){let[h,i]=(0,c.useState)(!1),[j,k]=(0,c.useState)(null),[l,m]=(0,c.useState)({nav_total:"",nav_per_unit:"",as_of_date:""});(0,c.useEffect)(()=>{d&&(m({nav_total:null!=d.nav_total?String(d.nav_total):"",nav_per_unit:null!=d.nav_per_unit?String(d.nav_per_unit):"",as_of_date:d.as_of_date}),k(null))},[d]);let n=async b=>{if(b.preventDefault(),d){i(!0),k(null);try{let b=await fetch(`/api/staff/vehicles/${a}/valuations/${d.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({nav_total:parseFloat(l.nav_total),nav_per_unit:parseFloat(l.nav_per_unit),as_of_date:l.as_of_date})});if(!b.ok){let a=await b.json().catch(()=>({}));throw Error(a.error||"Failed to update valuation")}g(),f()}catch(a){k(a.message)}finally{i(!1)}}};return(0,b.jsx)(G.Dialog,{open:e,onOpenChange:f,children:(0,b.jsx)(G.DialogContent,{className:"sm:max-w-[500px] bg-zinc-950 border-white/10",children:(0,b.jsxs)("form",{onSubmit:n,children:[(0,b.jsxs)(G.DialogHeader,{children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(A.TrendingUp,{className:"h-5 w-5 text-emerald-500"}),(0,b.jsx)(G.DialogTitle,{children:"Edit Valuation"})]}),(0,b.jsx)(G.DialogDescription,{children:"Update the NAV valuation for this vehicle"})]}),(0,b.jsxs)("div",{className:"space-y-4 py-4",children:[j&&(0,b.jsx)("div",{className:"rounded-md bg-red-500/10 border border-red-500/20 p-3 text-sm text-red-400",children:j}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(I.Label,{htmlFor:"as_of_date",children:"Valuation Date *"}),(0,b.jsx)(H.Input,{id:"as_of_date",type:"date",value:l.as_of_date,onChange:a=>m({...l,as_of_date:a.target.value}),required:!0,className:"bg-zinc-900 border-white/10"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(I.Label,{htmlFor:"nav_total",children:"Total NAV *"}),(0,b.jsx)(H.Input,{id:"nav_total",type:"number",step:"0.01",placeholder:"1000000.00",value:l.nav_total,onChange:a=>m({...l,nav_total:a.target.value}),required:!0,className:"bg-zinc-900 border-white/10"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(I.Label,{htmlFor:"nav_per_unit",children:"NAV Per Unit *"}),(0,b.jsx)(H.Input,{id:"nav_per_unit",type:"number",step:"0.0001",placeholder:"100.00",value:l.nav_per_unit,onChange:a=>m({...l,nav_per_unit:a.target.value}),required:!0,className:"bg-zinc-900 border-white/10"})]})]}),(0,b.jsxs)(G.DialogFooter,{children:[(0,b.jsx)(D.Button,{type:"button",variant:"outline",onClick:f,disabled:h,children:"Cancel"}),(0,b.jsxs)(D.Button,{type:"submit",disabled:h||!d,children:[h&&(0,b.jsx)(w.Loader2,{className:"h-4 w-4 mr-2 animate-spin"}),"Save Changes"]})]})]})})})}function aR({vehicleId:a,onImported:d}){let[e,f]=(0,c.useState)(!1),[g,h]=(0,c.useState)(null),[i,j]=(0,c.useState)(!1),k=(0,K.useRouter)(),l=async()=>{if(!g)return void X.toast.error("Please select a CSV file");j(!0);try{let b=new FormData;b.append("file",g);let c=await fetch(`/api/staff/vehicles/${a}/valuations/import`,{method:"POST",body:b}),e=await c.json();if(!c.ok)throw Error(e.error||"Failed to import valuations");X.toast.success(e.message||`Imported ${e.imported} valuation(s)`),f(!1),h(null),d?.(),k.refresh()}catch(a){X.toast.error(a.message||"Failed to import valuations")}finally{j(!1)}};return(0,b.jsxs)(G.Dialog,{open:e,onOpenChange:f,children:[(0,b.jsx)(G.DialogTrigger,{asChild:!0,children:(0,b.jsxs)(D.Button,{variant:"outline",size:"sm",children:[(0,b.jsx)(J.Upload,{className:"h-4 w-4 mr-2"}),"Import CSV"]})}),(0,b.jsxs)(G.DialogContent,{className:"bg-zinc-950 border-white/10",children:[(0,b.jsx)(G.DialogHeader,{children:(0,b.jsx)(G.DialogTitle,{className:"text-white",children:"Import Valuations"})}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(I.Label,{htmlFor:"valuation-file",children:"CSV File"}),(0,b.jsx)(H.Input,{id:"valuation-file",type:"file",accept:".csv",onChange:a=>h(a.target.files?.[0]||null),className:"bg-zinc-900 border-white/10"}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Expected columns: as_of_date, nav_total, nav_per_unit (header names flexible)"})]}),(0,b.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,b.jsx)(D.Button,{variant:"outline",onClick:()=>f(!1),disabled:i,children:"Cancel"}),(0,b.jsx)(D.Button,{onClick:l,disabled:!g||i,children:i?"Importing...":"Import"})]})]})]})]})}function aS({vehicleId:a,position:d,open:e,onClose:f,onSuccess:g}){let[h,i]=(0,c.useState)(!1),[j,k]=(0,c.useState)(null),[l,m]=(0,c.useState)({investor_id:"",units:"",cost_basis:"",last_nav:"",as_of_date:""});(0,c.useEffect)(()=>{d?(m({investor_id:d.investor_id,units:null!=d.units?String(d.units):"",cost_basis:null!=d.cost_basis?String(d.cost_basis):"",last_nav:null!=d.last_nav?String(d.last_nav):"",as_of_date:d.as_of_date||""}),k(null)):m({investor_id:"",units:"",cost_basis:"",last_nav:"",as_of_date:""})},[d]);let n=async b=>{b.preventDefault(),i(!0),k(null);try{let b={investor_id:l.investor_id,units:parseFloat(l.units)};l.cost_basis&&(b.cost_basis=parseFloat(l.cost_basis)),l.last_nav&&(b.last_nav=parseFloat(l.last_nav)),l.as_of_date&&(b.as_of_date=l.as_of_date);let c=d?`/api/staff/vehicles/${a}/positions/${d.id}`:`/api/staff/vehicles/${a}/positions`,e=await fetch(c,{method:d?"PUT":"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(b)}),h=await e.json().catch(()=>({}));if(!e.ok)throw Error(h.error||"Failed to save position");g(),f()}catch(a){k(a.message)}finally{i(!1)}};return(0,b.jsx)(G.Dialog,{open:e,onOpenChange:f,children:(0,b.jsx)(G.DialogContent,{className:"sm:max-w-[520px] bg-zinc-950 border-white/10",children:(0,b.jsxs)("form",{onSubmit:n,children:[(0,b.jsxs)(G.DialogHeader,{children:[(0,b.jsx)(G.DialogTitle,{className:"text-white",children:d?"Edit Position":"Add Position"}),(0,b.jsx)(G.DialogDescription,{children:"Manual position entry or correction for this vehicle"})]}),(0,b.jsxs)("div",{className:"space-y-4 py-4",children:[j&&(0,b.jsx)("div",{className:"rounded-md bg-red-500/10 border border-red-500/20 p-3 text-sm text-red-400",children:j}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(I.Label,{htmlFor:"investor_id",children:"Investor ID *"}),(0,b.jsx)(H.Input,{id:"investor_id",value:l.investor_id,onChange:a=>m({...l,investor_id:a.target.value}),required:!0,disabled:!!d,className:"bg-zinc-900 border-white/10"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(I.Label,{htmlFor:"units",children:"Units / Shares *"}),(0,b.jsx)(H.Input,{id:"units",type:"number",step:"0.0001",value:l.units,onChange:a=>m({...l,units:a.target.value}),required:!0,className:"bg-zinc-900 border-white/10"})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(I.Label,{htmlFor:"cost_basis",children:"Cost Basis"}),(0,b.jsx)(H.Input,{id:"cost_basis",type:"number",step:"0.01",value:l.cost_basis,onChange:a=>m({...l,cost_basis:a.target.value}),className:"bg-zinc-900 border-white/10"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(I.Label,{htmlFor:"last_nav",children:"Last NAV"}),(0,b.jsx)(H.Input,{id:"last_nav",type:"number",step:"0.0001",value:l.last_nav,onChange:a=>m({...l,last_nav:a.target.value}),className:"bg-zinc-900 border-white/10"})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(I.Label,{htmlFor:"as_of_date",children:"As of Date"}),(0,b.jsx)(H.Input,{id:"as_of_date",type:"date",value:l.as_of_date,onChange:a=>m({...l,as_of_date:a.target.value}),className:"bg-zinc-900 border-white/10"})]})]}),(0,b.jsxs)(G.DialogFooter,{children:[(0,b.jsx)(D.Button,{type:"button",variant:"outline",onClick:f,disabled:h,children:"Cancel"}),(0,b.jsxs)(D.Button,{type:"submit",disabled:h,children:[h&&(0,b.jsx)(w.Loader2,{className:"h-4 w-4 mr-2 animate-spin"}),d?"Save Changes":"Add Position"]})]})]})})})}function aT({vehicleId:a,onImported:d}){let[e,f]=(0,c.useState)(!1),[g,h]=(0,c.useState)(null),[i,j]=(0,c.useState)(!1),k=(0,K.useRouter)(),l=async()=>{if(!g)return void X.toast.error("Please select a CSV file");j(!0);try{let b=new FormData;b.append("file",g);let c=await fetch(`/api/staff/vehicles/${a}/positions/import`,{method:"POST",body:b}),e=await c.json();if(!c.ok)throw Error(e.error||"Failed to import positions");X.toast.success(e.message||`Imported ${e.imported} position(s)`),f(!1),h(null),d?.(),k.refresh()}catch(a){X.toast.error(a.message||"Failed to import positions")}finally{j(!1)}};return(0,b.jsxs)(G.Dialog,{open:e,onOpenChange:f,children:[(0,b.jsx)(G.DialogTrigger,{asChild:!0,children:(0,b.jsxs)(D.Button,{variant:"outline",size:"sm",children:[(0,b.jsx)(J.Upload,{className:"h-4 w-4 mr-2"}),"Import CSV"]})}),(0,b.jsxs)(G.DialogContent,{className:"bg-zinc-950 border-white/10",children:[(0,b.jsx)(G.DialogHeader,{children:(0,b.jsx)(G.DialogTitle,{className:"text-white",children:"Import Positions"})}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(I.Label,{htmlFor:"positions-file",children:"CSV File"}),(0,b.jsx)(H.Input,{id:"positions-file",type:"file",accept:".csv",onChange:a=>h(a.target.files?.[0]||null),className:"bg-zinc-900 border-white/10"}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Expected columns: investor_id, units, cost_basis, last_nav, as_of_date"})]}),(0,b.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,b.jsx)(D.Button,{variant:"outline",onClick:()=>f(!1),disabled:i,children:"Cancel"}),(0,b.jsx)(D.Button,{onClick:l,disabled:!g||i,children:i?"Importing...":"Import"})]})]})]})]})}let aU={fund:"Fund",spv:"SPV",securitization:"Securitization",note:"Note",venture_capital:"Venture Capital",private_equity:"Private Equity",real_estate:"Real Estate",other:"Other"},aV=(a,b)=>{if(null==a)return null;let c=(b||"USD").toUpperCase();try{return new Intl.NumberFormat("en-US",{style:"currency",currency:c,maximumFractionDigits:0}).format(a)}catch{return`${c} ${a.toLocaleString()}`}},aW=a=>{if(null==a||""===a)return"";let b="number"==typeof a?a:Number(a);if(!Number.isNaN(b)&&b>0){let a=new Date(new Date(1899,11,30).getTime()+24*b*36e5);if(!Number.isNaN(a.getTime()))return a.toLocaleDateString()}if("string"==typeof a){let b=new Date(a);if(!Number.isNaN(b.getTime()))return b.toLocaleDateString()}return String(a)},aX=({notes:a})=>{try{let c=JSON.parse(a),d=Array.isArray(c?.line_items)?c.line_items:[];if(d.length>0)return(0,b.jsxs)("div",{className:"mt-2 space-y-2 rounded-md border border-emerald-400/30 bg-emerald-500/5 p-3 text-xs text-emerald-50",children:[(0,b.jsxs)("div",{className:"flex flex-wrap items-center gap-2 text-emerald-200",children:[(0,b.jsx)("span",{className:"font-semibold uppercase tracking-wide",children:c?.source?String(c.source):"Legacy workbook import"}),c?.run_id&&(0,b.jsxs)("span",{children:["Run ID ",c.run_id]})]}),(0,b.jsx)("div",{className:"space-y-2",children:d.map((a,d)=>{let e=String(a.sheet??"Sheet"),f=null!=a.row?String(a.row):"?",g=a.amount_converted??a.amount_original??void 0,h="number"==typeof g?g:null!=g?Number(g):void 0,i=a.currency_converted??a.currency_original??c?.currency??"USD",j=a.comments?String(a.comments):null,k=aW(a.order_date),l=aW(a.settlement_date),m=null==h||Number.isNaN(h)?null:aV(h,String(i))??h.toLocaleString();return(0,b.jsxs)("div",{className:"rounded border border-emerald-500/20 bg-emerald-500/10 p-2",children:[(0,b.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[(0,b.jsxs)("span",{className:"font-semibold uppercase tracking-wide text-emerald-200",children:[e," #",f]}),m&&(0,b.jsx)("span",{children:m})]}),(0,b.jsxs)("div",{className:"mt-1 flex flex-wrap gap-4 text-emerald-100",children:[""!==k&&(0,b.jsxs)("span",{children:["Order: ",k]}),""!==l&&(0,b.jsxs)("span",{children:["Settlement: ",l]})]}),j&&(0,b.jsx)("p",{className:"mt-1 italic text-emerald-200",children:j})]},`${e}-${f}-${d}`)})})]})}catch(a){}return(0,b.jsx)("p",{className:"mt-2 whitespace-pre-wrap break-words text-emerald-50",children:a})},aY=[{key:"shareholders",label:"Shareholders",roles:["shareholder"]},{key:"legal",label:"Legal & Counsel",roles:["lawyer"]},{key:"accounting",label:"Accounting",roles:["accountant"]},{key:"auditors",label:"Auditors",roles:["auditor"]},{key:"administrators",label:"Administrators",roles:["administrator"]},{key:"strategic",label:"Strategic Partners",roles:["strategic_partner"]},{key:"other",label:"Other Stakeholders",roles:["other"]}],aZ=a=>{if(!a)return null;try{return new URL(a).hostname.replace(/^www\./,"")}catch{return a.replace(/^https?:\/\//,"")}},a$=[{value:"pending",label:"Pending"},{value:"committed",label:"Committed"},{value:"active",label:"Active"},{value:"closed",label:"Closed"},{value:"cancelled",label:"Cancelled"}];function a_({entity:a,directors:G,stakeholders:H,folders:J,flags:K,deals:M,events:N,investors:O,valuations:P,positions:R}){let[S,T]=(0,c.useState)("overview"),[U,V]=(0,c.useState)(a),[W,Z]=(0,c.useState)(G),[$,_]=(0,c.useState)(H),[ad,ae]=(0,c.useState)(J),[af,ah]=(0,c.useState)(K),[ai,aj]=(0,c.useState)([]),[ak,ao]=(0,c.useState)(!0),[ap,aq]=(0,c.useState)(null),[as,at]=(0,c.useState)(null),[av,aw]=(0,c.useState)(N),[ax,ay]=(0,c.useState)(!1),[az,aA]=(0,c.useState)(!1),[aB,aC]=(0,c.useState)("create"),[aD,aE]=(0,c.useState)(null),[aG,aH]=(0,c.useState)(!1),[aI,aJ]=(0,c.useState)("create"),[aK,aL]=(0,c.useState)(null),[aN,aW]=(0,c.useState)(!1),[a_,a0]=(0,c.useState)(!1),[a1,a2]=(0,c.useState)(O),[a3,a4]=(0,c.useState)(P),[a5,a6]=(0,c.useState)(null),[a7,a8]=(0,c.useState)(R),[a9,ba]=(0,c.useState)(!1),[bb,bc]=(0,c.useState)(null),[bd,be]=(0,c.useState)(!1),[bf,bg]=(0,c.useState)(null),[bh,bi]=(0,c.useState)(null),[bj,bk]=(0,c.useState)(!1),[bl,bm]=(0,c.useState)(!1),[bn,bo]=(0,c.useState)(null),[bp,bq]=(0,c.useState)(!1),[br,bs]=(0,c.useState)(!1),bt=(0,ab.useDocumentViewer)(),[bu,bv]=(0,c.useState)(null),[bw,bx]=(0,c.useState)(!1),[by,bz]=(0,c.useState)(null),[bA,bB]=(0,c.useState)(!1),[bC,bD]=(0,c.useState)(!1),[bE,bF]=(0,c.useState)(null),[bG,bH]=(0,c.useState)(null),bI=(0,c.useRef)(null),bJ=(0,c.useRef)(null),bK=(0,c.useRef)(""),bL=(0,c.useRef)(null),bM=(0,c.useRef)(null),bN=(0,c.useRef)(null),bO=(0,c.useRef)(null),{confirm:bP,ConfirmationDialog:bQ}=ag(),bR=(0,c.useCallback)(async()=>{try{let a=await fetch(`/api/entities/${U.id}/folders`);if(!a.ok)throw Error("Failed to fetch folders");let b=await a.json();ae(b.folders||[])}catch(a){console.error("Failed to fetch folders:",a),X.toast.error("Failed to refresh folders")}},[U.id]),bS=(0,c.useCallback)(async()=>{ao(!0),aq(null);try{let a=await fetch(`/api/documents?entity_id=${U.id}`);if(!a.ok){let b=await a.json().catch(()=>({}));throw Error(b.error||"Failed to load documents")}let b=await a.json();aj(b.documents||[])}catch(a){aq(a.message)}finally{ao(!1)}},[U.id]),bT=(0,c.useCallback)(async()=>{try{let a=await fetch(`/api/entities/${U.id}`);if(a.ok){let b=await a.json();V(b.entity),Z(b.directors||[]),_(b.stakeholders||[]),ae(b.folders||[]),ah(b.flags||[]),a2(b.investors||[]),aw(b.entity_events||[])}}catch(a){console.error("Failed to refresh entity data:",a)}},[U.id]);(0,c.useEffect)(()=>{bS()},[bS]),(0,c.useEffect)(()=>{as&&ad.some(a=>a.id===as)||(ad.length>0?at(ad[0].id):at(null))},[ad,as]),(0,c.useMemo)(()=>W.filter(a=>!a.effective_to),[W]),(0,c.useMemo)(()=>W.filter(a=>a.effective_to),[W]);let bU=(0,c.useMemo)(()=>{let a={};return aY.forEach(b=>{a[b.key]=[]}),$.forEach(b=>{let c=aY.find(a=>a.roles.includes(b.role))??aY.find(a=>"other"===a.key),d=c?.key??"other";a[d]||(a[d]=[]),a[d].push(b)}),a},[$]),bV=(0,c.useMemo)(()=>{let a=new Map;return ad.forEach(b=>a.set(b.id,b)),a},[ad]),bW=(0,c.useMemo)(()=>as?ai.filter(a=>a.folder_id===as):ai,[ai,as]),bX=as?bV.get(as)??null:null;(0,c.useMemo)(()=>{let a={open:0,in_progress:1,closed:2};return[...af].sort((b,c)=>{let d=(a[b.status]??3)-(a[c.status]??3);return 0!==d?d:new Date(c.created_at).getTime()-new Date(b.created_at).getTime()})},[af]);let bY=(0,c.useCallback)(async()=>{bk(!0);try{let a=await fetch(`/api/entities/${U.id}/investors`);if(!a.ok){let b=await a.json().catch(()=>({}));throw Error(b.error||"Failed to load investors")}let b=await a.json();a2(b.investors||[])}catch(a){console.error("Failed to refresh investors:",a),X.toast.error("Unable to reload entity investors.")}finally{bk(!1)}},[U.id]),bZ=(0,c.useCallback)(async()=>{bq(!0);try{let a=await fetch(`/api/entities/${U.id}/flags`);if(!a.ok){let b=await a.json().catch(()=>({}));throw Error(b.error||"Failed to load flags")}let b=await a.json();ah(b.flags||[])}catch(a){console.error("Failed to refresh flags:",a),X.toast.error("Unable to reload entity flags.")}finally{bq(!1)}},[U.id]),b$=(0,c.useCallback)(async()=>{try{let a=await fetch(`/api/staff/vehicles/${U.id}/valuations`);if(!a.ok)throw Error("Failed to load valuations");let b=await a.json();a4(b.valuations||[])}catch(a){console.error("Failed to refresh valuations:",a),X.toast.error("Unable to reload valuations.")}},[U.id]),b_=(0,c.useCallback)(async()=>{try{let a=await fetch(`/api/staff/vehicles/${U.id}/positions`);if(!a.ok)throw Error("Failed to load positions");let b=await a.json();a8(b.positions||[])}catch(a){console.error("Failed to refresh positions:",a),X.toast.error("Unable to reload positions.")}},[U.id]),b0=(0,c.useCallback)(a=>{bP({title:"Delete valuation?",description:`This will permanently remove the valuation dated ${new Date(a.as_of_date).toLocaleDateString()}.`,confirmText:"Delete",cancelText:"Cancel",variant:"destructive"},async()=>{try{let b=await fetch(`/api/staff/vehicles/${U.id}/valuations/${a.id}`,{method:"DELETE"});if(!b.ok){let a=await b.json().catch(()=>({}));throw Error(a.error||"Failed to delete valuation")}X.toast.success("Valuation deleted."),await b$()}catch(a){console.error("Failed to delete valuation:",a),X.toast.error(a.message||"Unable to delete valuation.")}})},[bP,U.id,b$]),b1=(0,c.useCallback)(a=>{bP({title:"Delete position?",description:"This will permanently remove this position record.",confirmText:"Delete",cancelText:"Cancel",variant:"destructive"},async()=>{try{let b=await fetch(`/api/staff/vehicles/${U.id}/positions/${a.id}`,{method:"DELETE"});if(!b.ok){let a=await b.json().catch(()=>({}));throw Error(a.error||"Failed to delete position")}X.toast.success("Position deleted."),await b_()}catch(a){console.error("Failed to delete position:",a),X.toast.error(a.message||"Unable to delete position.")}})},[bP,U.id,b_]),b2=(0,c.useCallback)(a=>{a2(b=>[a,...b]),X.toast.success("Investor linked to entity.")},[]),b3=(0,c.useCallback)(async(a,b,c)=>{bg(a);try{let d={allocation_status:b};c&&(d.subscription={status:b});let e=await fetch(`/api/entities/${U.id}/investors/${a}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(d)});if(!e.ok){let a=await e.json().catch(()=>({}));throw Error(a.error||"Failed to update investor")}let f=await e.json();a2(b=>b.map(b=>b.id===a?f.investor:b)),X.toast.success("Investor allocation updated.")}catch(a){console.error("Failed to update investor status:",a),X.toast.error("Unable to update investor allocation.")}finally{bg(null)}},[U.id]);(0,c.useEffect)(()=>{by?.subscription&&(bK.current=by.subscription.status||"pending")},[by]),(0,c.useCallback)(async()=>{if(by){bD(!0);try{let a={},b={};bI.current?.value&&(b.commitment=parseFloat(bI.current.value)),bJ.current?.value&&(b.currency=bJ.current.value.toUpperCase()),bK.current&&(b.status=bK.current,a.allocation_status=bK.current),bL.current?.value&&(b.effective_date=bL.current.value),bM.current?.value&&(b.funding_due_at=bM.current.value),bN.current?.value&&(b.units=parseFloat(bN.current.value)),bO.current?.value!==void 0&&(b.acknowledgement_notes=bO.current.value),a.subscription=b;let c=await fetch(`/api/entities/${U.id}/investors/${by.investorId}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!c.ok){let a=await c.json().catch(()=>({}));throw Error(a.error||"Failed to update subscription")}let d=await c.json();a2(a=>a.map(a=>a.id===by.investorId?d.investor:a)),X.toast.success("Subscription updated successfully!"),bB(!1),bz(null)}catch(a){console.error("Failed to update subscription:",a),X.toast.error("Unable to update subscription.")}finally{bD(!1)}}},[by,U.id]);let b4=(0,c.useCallback)(async(a,b)=>{bP({title:"Remove Investor",description:`Are you sure you want to unlink ${b} from this entity? This action cannot be undone. The entity-investor link data will be permanently deleted.`,confirmText:"Remove Investor",cancelText:"Keep Investor",variant:"destructive"},async()=>{bi(a);try{let b=await fetch(`/api/entities/${U.id}/investors/${a}`,{method:"DELETE"});if(!b.ok){let a=await b.json().catch(()=>({}));throw Error(a.error||"Failed to remove investor")}a2(b=>b.filter(b=>b.id!==a)),X.toast.success("Investor unlinked from entity.")}catch(a){console.error("Failed to remove investor:",a),X.toast.error("Unable to remove investor from entity.")}finally{bi(null)}})},[U.id,bP]),b5=(0,c.useCallback)(async a=>{try{let b=await fetch(`/api/documents/${a}/download`);if(!b.ok)throw Error("Failed to get download URL");let c=await b.json();c.download_url&&window.open(c.download_url,"_blank")}catch(a){console.error("Failed to download document:",a),X.toast.error("Failed to download document")}},[]),b6=(0,c.useCallback)(a=>{bv(a),bx(!0)},[]),b7=(0,c.useCallback)(async(a,b)=>{bP({title:"Delete Document",description:`Are you sure you want to delete "${b}"? This action cannot be undone and will permanently remove the document and all its versions.`,confirmText:"Delete Document",variant:"destructive"},async()=>{try{let b=await fetch(`/api/staff/documents/${a}`,{method:"DELETE"});if(!b.ok){let a=await b.json().catch(()=>({}));throw Error(a.error||"Failed to delete document")}aj(b=>b.filter(b=>b.id!==a)),X.toast.success("Document deleted successfully"),await bS()}catch(a){console.error("Failed to delete document:",a),X.toast.error(a instanceof Error?a.message:"Failed to delete document")}})},[bP,bS]),b8=(0,c.useCallback)(a=>{ah(b=>[a,...b]),X.toast.success("Flag created for this entity.")},[]),b9=(0,c.useCallback)(async(a,b,c)=>{bo(a);try{let d=await fetch(`/api/entities/${U.id}/flags/${a}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(b)});if(!d.ok){let a=await d.json().catch(()=>({}));throw Error(a.error||"Failed to update flag")}let e=await d.json();ah(b=>b.map(b=>b.id===a?e.flag:b)),c&&X.toast.success(c)}catch(a){console.error("Failed to update flag:",a),X.toast.error(a instanceof Error?a.message:"Unable to update flag.")}finally{bo(null)}},[U.id]);(0,c.useCallback)(async a=>{await b9(a,{status:"closed"},"Flag marked as resolved.")},[b9]),(0,c.useCallback)(async a=>{await b9(a,{status:"open",resolution_notes:null,resolved_at:null},"Flag reopened.")},[b9]),(0,c.useCallback)(async a=>{await b9(a,{status:"in_progress"},"Flag marked in progress.")},[b9]),(0,c.useCallback)(async(a,b)=>{bP({title:"Delete Flag",description:`Are you sure you want to delete the flag "${b}"? This action cannot be undone.`,confirmText:"Delete Flag",variant:"destructive"},async()=>{try{let b=await fetch(`/api/entities/${U.id}/flags/${a}`,{method:"DELETE"});if(!b.ok){let a=await b.json().catch(()=>({}));throw Error(a.error||"Failed to remove flag")}ah(b=>b.filter(b=>b.id!==a)),X.toast.success("Flag removed from entity.")}catch(a){console.error("Failed to delete flag:",a),X.toast.error(a instanceof Error?a.message:"Unable to delete flag.")}})},[U.id,bP]);let ca=(0,c.useCallback)(a=>{aE(a),aC("edit"),aA(!0)},[]),cb=(0,c.useCallback)(async(a,b)=>{bP({title:"Delete Director",description:`Are you sure you want to remove ${b} from this entity? This action cannot be undone.`,confirmText:"Delete Director",variant:"destructive"},async()=>{try{let b=await fetch(`/api/entities/${U.id}/directors/${a}`,{method:"DELETE"});if(!b.ok){let a=await b.json().catch(()=>({}));throw Error(a.error||"Failed to delete director")}Z(b=>b.filter(b=>b.id!==a)),X.toast.success("Director removed successfully"),await bT()}catch(a){console.error("Failed to delete director:",a),X.toast.error(a instanceof Error?a.message:"Failed to delete director")}})},[U.id,bP,bT]),cc=(0,c.useCallback)(a=>{aL(a),aJ("edit"),aH(!0)},[]),cd=(0,c.useCallback)(async(a,b)=>{bP({title:"Delete Stakeholder",description:`Are you sure you want to remove ${b} from this entity? This action cannot be undone.`,confirmText:"Delete Stakeholder",variant:"destructive"},async()=>{try{let b=await fetch(`/api/entities/${U.id}/stakeholders/${a}`,{method:"DELETE"});if(!b.ok){let a=await b.json().catch(()=>({}));throw Error(a.error||"Failed to delete stakeholder")}_(b=>b.filter(b=>b.id!==a)),X.toast.success("Stakeholder removed successfully"),await bT()}catch(a){console.error("Failed to delete stakeholder:",a),X.toast.error(a instanceof Error?a.message:"Failed to delete stakeholder")}})},[U.id,bP,bT]),ce=(0,c.useMemo)(()=>[{label:"Vehicle Code",value:U.entity_code||"",icon:m.ClipboardList},{label:"Platform",value:U.platform||"",icon:g.Building2},{label:"Formation Date",value:U.formation_date?new Date(U.formation_date).toLocaleDateString():"",icon:h.CalendarClock},{label:"Active Stakeholders",value:$.filter(a=>!a.effective_to).length.toString(),icon:l.Users}],[U,$]),cf=U.logo_url||"",[cg,ch]=(0,c.useState)(!1);return(0,c.useEffect)(()=>{ch(!1)},[U.id,U.logo_url]),(0,b.jsxs)("div",{className:"p-6 space-y-6",children:[(0,b.jsxs)("div",{className:"flex flex-col md:flex-row md:items-start md:justify-between gap-6",children:[(0,b.jsxs)("div",{className:"space-y-4 max-w-3xl",children:[(0,b.jsx)(e.default,{href:"/versotech_main/entities",className:"inline-flex",children:(0,b.jsxs)(D.Button,{variant:"ghost",size:"sm",className:"gap-2 text-foreground hover:text-emerald-200 hover:bg-white/10",children:[(0,b.jsx)(f.ArrowLeft,{className:"h-4 w-4"}),"Back to Vehicles"]})}),(0,b.jsxs)("div",{className:"flex items-center gap-3 flex-wrap",children:[U.entity_code&&(0,b.jsx)(E.Badge,{variant:"outline",className:"font-mono text-lg px-3 py-1 border-emerald-400/40 text-emerald-100",children:U.entity_code}),(0,b.jsx)("h1",{className:"text-3xl font-bold text-foreground",children:U.name}),(0,b.jsx)(E.Badge,{className:"bg-white/10 border-white/15 text-foreground",children:aU[U.type]||U.type}),U.status&&(0,b.jsx)(E.Badge,{className:"LIVE"===U.status?"bg-emerald-500/20 border-emerald-400/40 text-emerald-100":"CLOSED"===U.status?"bg-red-500/20 border-red-400/40 text-red-100":"bg-amber-500/20 border-amber-400/40 text-amber-100",children:U.status}),(0,b.jsx)(E.Badge,{variant:"outline",className:"border-emerald-400/40 text-emerald-100",children:U.currency})]}),(0,b.jsxs)("div",{className:"text-muted-foreground space-y-1",children:[U.investment_name&&(0,b.jsxs)("p",{className:"font-medium text-foreground text-lg",children:["Investment: ",U.investment_name]}),U.platform&&(0,b.jsxs)("p",{children:["Platform: ",U.platform]}),U.former_entity&&(0,b.jsxs)("p",{children:["Formerly: ",U.former_entity]}),(0,b.jsx)("p",{children:U.domicile||"Domicile unknown"}),(0,b.jsxs)("p",{className:"text-sm",children:["Created ",new Date(U.created_at).toLocaleString(),U.updated_at&&`  Updated ${new Date(U.updated_at).toLocaleString()}`]})]})]}),(0,b.jsxs)("div",{className:"flex flex-col items-center md:items-end gap-4 shrink-0",children:[(0,b.jsxs)("div",{className:"rounded-2xl border border-white/10 bg-white/[0.06] p-5 w-[220px] flex flex-col items-center gap-3 text-sm",children:[(0,b.jsx)("div",{className:"h-24 w-24 rounded-xl border border-white/10 bg-black/60 flex items-center justify-center overflow-hidden",children:cf&&!cg?(0,b.jsx)(d.default,{src:cf,alt:`${U.name} logo`,width:96,height:96,className:"h-full w-full object-contain p-2",unoptimized:!0,onError:()=>{console.error("Failed to load logo:",cf),ch(!0)}}):(0,b.jsx)(g.Building2,{className:"h-10 w-10 text-muted-foreground"})}),(0,b.jsxs)("div",{className:"text-center space-y-1",children:[(0,b.jsx)("p",{className:"text-xs text-muted-foreground uppercase tracking-wide",children:"Branding"}),(0,b.jsx)("p",{className:"text-sm font-medium text-foreground",children:cf&&!cg?"Logo uploaded":cg?"Logo failed to load":"No logo set"}),aZ(U.website_url)&&(0,b.jsx)("a",{href:U.website_url||"#",target:"_blank",rel:"noopener noreferrer",className:"text-xs text-emerald-300 hover:text-emerald-200 transition-colors",children:aZ(U.website_url)})]})]}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsxs)(D.Button,{onClick:()=>aW(!0),className:"gap-2 rounded-full bg-emerald-500 text-emerald-950 px-5 shadow-[0_12px_30px_rgba(16,185,129,0.35)] transition-colors hover:bg-emerald-400",children:[(0,b.jsx)(q.Edit,{className:"h-4 w-4"}),"Edit Metadata"]}),(0,b.jsxs)(D.Button,{onClick:()=>a0(!0),variant:"outline",className:"gap-2 rounded-full border-red-500/50 text-red-400 hover:bg-red-500/10 hover:text-red-300",children:[(0,b.jsx)(y.Trash2,{className:"h-4 w-4"}),"Delete Entity"]})]})]})]}),af.length>0&&(0,b.jsxs)(B.Card,{className:"border-amber-400/40 bg-amber-500/10",children:[(0,b.jsxs)(B.CardHeader,{className:"pb-3 flex flex-row items-center justify-between space-y-0",children:[(0,b.jsxs)(B.CardTitle,{className:"text-amber-100 flex items-center gap-2",children:[(0,b.jsx)(s.AlertTriangle,{className:"h-5 w-5"}),"Action Required (",af.length,")"]}),(0,b.jsxs)(D.Button,{size:"sm",variant:"outline",onClick:()=>bm(!0),className:"gap-2 border-amber-400/40 text-amber-100 hover:bg-amber-500/20",children:[(0,b.jsx)(k.Plus,{className:"h-4 w-4"}),"Add Flag"]})]}),(0,b.jsx)(B.CardContent,{children:(0,b.jsxs)("div",{className:"space-y-2",children:[af.slice(0,3).map(a=>(0,b.jsxs)("div",{className:"flex items-start gap-3 rounded-lg border border-white/10 bg-white/5 p-3",children:[(a=>{switch(a){case"critical":return(0,b.jsx)(s.AlertTriangle,{className:"h-4 w-4 text-red-400"});case"warning":return(0,b.jsx)(u.AlertCircle,{className:"h-4 w-4 text-amber-400"});case"info":return(0,b.jsx)(v.Info,{className:"h-4 w-4 text-blue-400"});case"success":return(0,b.jsx)(t.CheckCircle2,{className:"h-4 w-4 text-emerald-400"});default:return(0,b.jsx)(u.AlertCircle,{className:"h-4 w-4"})}})(a.severity),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("p",{className:"font-medium text-foreground",children:a.title}),a.description&&(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:a.description})]}),(0,b.jsx)(E.Badge,{className:(a=>{switch(a){case"critical":return"bg-red-500/20 border-red-400/40 text-red-100";case"warning":return"bg-amber-500/20 border-amber-400/40 text-amber-100";case"info":return"bg-blue-500/20 border-blue-400/40 text-blue-100";case"success":return"bg-emerald-500/20 border-emerald-400/40 text-emerald-100";default:return"bg-white/10 border-white/10 text-foreground"}})(a.severity),children:a.severity})]},a.id)),af.length>3&&(0,b.jsxs)(D.Button,{variant:"ghost",size:"sm",onClick:()=>T("flags"),children:["View all ",af.length," flags"]})]})})]}),(0,b.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:ce.map(a=>(0,b.jsxs)(B.Card,{className:"border border-white/10 bg-white/5",children:[(0,b.jsxs)(B.CardHeader,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,b.jsx)(B.CardTitle,{className:"text-sm font-medium text-muted-foreground",children:a.label}),(0,b.jsx)(a.icon,{className:"h-4 w-4 text-muted-foreground"})]}),(0,b.jsx)(B.CardContent,{children:(0,b.jsx)("div",{className:"text-lg font-semibold text-foreground",children:a.value})})]},a.label))}),(0,b.jsxs)(C.Tabs,{value:S,onValueChange:T,className:"space-y-4",children:[(0,b.jsxs)(C.TabsList,{className:"bg-white/5 border border-white/10",children:[(0,b.jsxs)(C.TabsTrigger,{value:"overview",className:"gap-2",children:[(0,b.jsx)(g.Building2,{className:"h-4 w-4"}),"Overview"]}),(0,b.jsxs)(C.TabsTrigger,{value:"investors",className:"gap-2",children:[(0,b.jsx)(p.ShieldCheck,{className:"h-4 w-4"}),"Subscriptions (",a1.length,")"]}),(0,b.jsxs)(C.TabsTrigger,{value:"documents",className:"gap-2",children:[(0,b.jsx)(r.FolderOpen,{className:"h-4 w-4"}),"Documents & Folders"]}),(0,b.jsxs)(C.TabsTrigger,{value:"stakeholders",className:"gap-2",children:[(0,b.jsx)(l.Users,{className:"h-4 w-4"}),"Stakeholders (",$.length,")"]}),(0,b.jsxs)(C.TabsTrigger,{value:"directors",className:"gap-2",children:[(0,b.jsx)(l.Users,{className:"h-4 w-4"}),"Directors (",W.length,")"]}),(0,b.jsxs)(C.TabsTrigger,{value:"deals",className:"gap-2",children:[(0,b.jsx)(o.Briefcase,{className:"h-4 w-4"}),"Deals (",M.length,")"]}),(0,b.jsxs)(C.TabsTrigger,{value:"health",className:"gap-2",children:[(0,b.jsx)(n.Activity,{className:"h-4 w-4"}),"Health"]}),(0,b.jsxs)(C.TabsTrigger,{value:"activity",className:"gap-2",children:[(0,b.jsx)(n.Activity,{className:"h-4 w-4"}),"Activity Log"]}),(0,b.jsxs)(C.TabsTrigger,{value:"valuations",className:"gap-2",children:[(0,b.jsx)(A.TrendingUp,{className:"h-4 w-4"}),"Valuations (",a3.length,")"]}),(0,b.jsxs)(C.TabsTrigger,{value:"positions",className:"gap-2",children:[(0,b.jsx)(m.ClipboardList,{className:"h-4 w-4"}),"Positions (",a7.length,")"]})]}),(0,b.jsxs)(C.TabsContent,{value:"overview",className:"space-y-4",children:[(0,b.jsxs)(B.Card,{className:"border border-white/10 bg-white/5",children:[(0,b.jsxs)(B.CardHeader,{children:[(0,b.jsx)(B.CardTitle,{children:"Vehicle Details"}),(0,b.jsx)(B.CardDescription,{children:"Complete information about this vehicle"})]}),(0,b.jsxs)(B.CardContent,{className:"grid grid-cols-1 md:grid-cols-2 gap-6 text-sm",children:[U.entity_code&&(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-muted-foreground",children:"Vehicle Code"}),(0,b.jsx)("p",{className:"text-foreground font-medium font-mono text-lg",children:U.entity_code})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-muted-foreground",children:"Legal Name"}),(0,b.jsx)("p",{className:"text-foreground font-medium",children:U.name})]}),U.investment_name&&(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-muted-foreground",children:"Investment Name"}),(0,b.jsx)("p",{className:"text-foreground font-medium",children:U.investment_name})]}),U.platform&&(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-muted-foreground",children:"Platform"}),(0,b.jsx)("p",{className:"text-foreground font-medium",children:U.platform})]}),U.former_entity&&(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-muted-foreground",children:"Former Entity"}),(0,b.jsx)("p",{className:"text-foreground font-medium",children:U.former_entity})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-muted-foreground",children:"Type"}),(0,b.jsx)("p",{className:"text-foreground font-medium",children:aU[U.type]||U.type})]}),U.status&&(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-muted-foreground",children:"Status"}),(0,b.jsx)(E.Badge,{className:"LIVE"===U.status?"bg-emerald-500/20 border-emerald-400/40 text-emerald-100":"CLOSED"===U.status?"bg-red-500/20 border-red-400/40 text-red-100":"bg-amber-500/20 border-amber-400/40 text-amber-100",children:U.status})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-muted-foreground",children:"Domicile"}),(0,b.jsx)("p",{className:"text-foreground font-medium",children:U.domicile||""})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-muted-foreground",children:"Jurisdiction"}),(0,b.jsx)("p",{className:"text-foreground font-medium",children:U.legal_jurisdiction||""})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-muted-foreground",children:"Registration Number"}),(0,b.jsx)("p",{className:"text-foreground font-medium",children:U.registration_number||""})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-muted-foreground",children:"Currency"}),(0,b.jsx)("p",{className:"text-foreground font-medium",children:U.currency})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-muted-foreground",children:"Formation Date"}),(0,b.jsx)("p",{className:"text-foreground font-medium",children:U.formation_date?new Date(U.formation_date).toLocaleDateString():""})]}),U.reporting_type&&(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-muted-foreground",children:"Reporting Type"}),(0,b.jsx)("p",{className:"text-foreground font-medium",children:U.reporting_type})]}),null!==U.requires_reporting&&(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-muted-foreground",children:"Requires Reporting"}),(0,b.jsx)(E.Badge,{variant:"outline",children:U.requires_reporting?"Yes":"No"})]}),U.address&&(0,b.jsxs)("div",{className:"md:col-span-2",children:[(0,b.jsx)("p",{className:"text-muted-foreground",children:"Address"}),(0,b.jsx)("p",{className:"text-foreground whitespace-pre-wrap",children:U.address})]})]})]}),(0,b.jsxs)(B.Card,{className:"border border-white/10 bg-white/5",children:[(0,b.jsxs)(B.CardHeader,{children:[(0,b.jsx)(B.CardTitle,{className:"text-lg",children:"Service Providers"}),(0,b.jsx)(B.CardDescription,{children:"Arranger and legal counsel assignments for this vehicle"})]}),(0,b.jsxs)(B.CardContent,{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-muted-foreground",children:"Arranger"}),U.arranger_entity?(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-foreground font-medium",children:U.arranger_entity.legal_name}),U.arranger_entity.email&&(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:U.arranger_entity.email})]}):(0,b.jsx)("p",{className:"text-foreground",children:""})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-muted-foreground",children:"Legal Counsel"}),U.lawyer?(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-foreground font-medium",children:U.lawyer.display_name||U.lawyer.firm_name}),U.lawyer.firm_name&&U.lawyer.display_name&&U.lawyer.firm_name!==U.lawyer.display_name&&(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:U.lawyer.firm_name}),U.lawyer.primary_contact_email&&(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:U.lawyer.primary_contact_email})]}):(0,b.jsx)("p",{className:"text-foreground",children:""})]})]})]}),(0,b.jsxs)(B.Card,{className:"border border-white/10 bg-white/5",children:[(0,b.jsx)(B.CardHeader,{children:(0,b.jsx)(B.CardTitle,{className:"text-lg",children:"Notes"})}),(0,b.jsx)(B.CardContent,{children:(0,b.jsx)("p",{className:"text-foreground whitespace-pre-wrap leading-relaxed",children:U.notes?.trim()||"No notes recorded yet."})})]})]}),(0,b.jsx)(C.TabsContent,{value:"investors",className:"space-y-4",children:(0,b.jsxs)(B.Card,{className:"border border-white/10 bg-white/5",children:[(0,b.jsxs)(B.CardHeader,{className:"flex flex-row items-center justify-between gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(B.CardTitle,{children:"Subscriptions & Allocations"}),(0,b.jsx)(B.CardDescription,{children:"Manage allocations, commitments, and onboarding for this vehicle."})]}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsxs)(D.Button,{variant:"outline",size:"sm",onClick:bY,disabled:bj,children:[bj&&(0,b.jsx)(w.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),"Refresh"]}),(0,b.jsxs)(D.Button,{size:"sm",className:"gap-2",onClick:()=>be(!0),children:[(0,b.jsx)(k.Plus,{className:"h-4 w-4"}),"Link Investor"]})]})]}),(0,b.jsx)(B.CardContent,{className:"space-y-3",children:0===a1.length?(0,b.jsx)("div",{className:"text-sm text-muted-foreground",children:"No investors linked yet. Use Link Investor to allocate commitments to this vehicle."}):(0,b.jsx)("div",{className:"space-y-3",children:a1.map(a=>{let c=a.allocation_status||"pending",d=a.investor,e=a.subscriptions??[],f=a.subscription,g=e.length>0,h=a.holdings??[],i=h.length>0,j=a.total_commitment??(g?e.reduce((a,b)=>a+(b.commitment??0),0):null),k=a.total_holdings_amount??(i?h.reduce((a,b)=>a+(b.subscribed_amount??0),0):null);return(0,b.jsx)("div",{className:"rounded-lg border border-white/10 bg-white/5 p-3 transition-colors hover:bg-white/10",children:(0,b.jsxs)("div",{className:"flex flex-col gap-3 md:flex-row md:items-start md:justify-between",children:[(0,b.jsxs)("div",{className:"flex-1 space-y-2.5",children:[(0,b.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,b.jsx)("p",{className:"text-base font-semibold text-foreground",children:d?.legal_name||"Unknown Investor"}),d?.type&&(0,b.jsx)(E.Badge,{variant:"outline",className:"bg-white/10 text-xs capitalize",children:d.type.replace(/_/g," ")}),(0,b.jsx)(E.Badge,{className:(a=>{switch(a){case"active":case"committed":return"bg-emerald-500/20 border-emerald-400/40 text-emerald-100";case"closed":return"bg-blue-500/20 border-blue-400/40 text-blue-100";case"cancelled":return"bg-red-500/20 border-red-400/40 text-red-100";default:return"bg-amber-500/20 border-amber-400/40 text-amber-100"}})(c),children:c.replace(/_/g," ").toUpperCase()})]}),(0,b.jsxs)("div",{className:"text-xs text-muted-foreground flex flex-wrap gap-x-4 gap-y-1",children:[a.relationship_role&&(0,b.jsxs)("span",{children:[(0,b.jsx)("span",{className:"font-medium text-foreground",children:"Role:"})," ",a.relationship_role]}),d?.email&&(0,b.jsx)("span",{children:d.email}),(0,b.jsxs)("span",{children:["Linked ",new Date(a.created_at).toLocaleDateString()]})]}),g&&(0,b.jsxs)("div",{className:"rounded-md border border-emerald-400/30 bg-emerald-500/5 p-2.5",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,b.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,b.jsxs)("h4",{className:"text-xs font-semibold text-emerald-100 uppercase",children:["Subscription",e.length>1?"s":""]}),e.length>1&&(0,b.jsx)(E.Badge,{variant:"outline",className:"border-emerald-400/40 bg-emerald-500/10 text-emerald-100 text-xs h-4 px-1.5",children:e.length})]}),(0,b.jsxs)(D.Button,{variant:"ghost",size:"sm",className:"h-6 px-1.5 text-xs text-emerald-200 hover:text-emerald-100 hover:bg-emerald-500/20",onClick:()=>{bF(a.id),bH(f),bB(!0)},children:[(0,b.jsx)(q.Edit,{className:"h-3 w-3 mr-1"}),"Edit"]})]}),null!=j&&(0,b.jsx)("div",{className:"text-base font-bold text-emerald-100 mb-2",children:aV(j,f?.currency)}),(0,b.jsx)("div",{className:"space-y-2",children:e.map(a=>{let c=aV(a.commitment,a.currency),d=a.commitment&&a.commitment>0&&a.funded_amount?a.funded_amount/a.commitment*100:0,e=a.subscription_fee_amount||a.bd_fee_amount||a.spread_fee_amount||a.finra_fee_amount,f=[a.subscription_fee_amount,a.bd_fee_amount,a.spread_fee_amount,a.finra_fee_amount].reduce((a,b)=>a+(b||0),0),g=a.funded_amount&&a.funded_amount>0&&a.current_nav?a.current_nav/a.funded_amount:null;return(0,b.jsxs)("div",{className:"text-xs border-b border-emerald-400/10 pb-2 last:border-0",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-1.5",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("span",{className:"font-medium text-emerald-100",children:c||"Pending"}),a.opportunity_name&&(0,b.jsxs)("span",{className:"text-emerald-300 italic text-[10px]",children:["(",a.opportunity_name,")"]})]}),(0,b.jsx)(E.Badge,{className:"bg-emerald-500/20 text-emerald-100 text-xs h-4 px-1.5 uppercase",children:a.status?.replace(/_/g," ")||"Pending"})]}),(a.committed_at||a.created_at)&&(0,b.jsxs)("div",{className:"flex gap-3 text-emerald-200 mb-1",children:[a.committed_at&&(0,b.jsxs)("span",{children:[(0,b.jsx)("span",{className:"text-emerald-300",children:"Committed:"})," ",new Date(a.committed_at).toLocaleDateString()]}),a.created_at&&(0,b.jsxs)("span",{children:[(0,b.jsx)("span",{className:"text-emerald-300",children:"Created:"})," ",new Date(a.created_at).toLocaleDateString()]})]}),(a.num_shares||a.price_per_share)&&(0,b.jsxs)("div",{className:"flex gap-3 text-emerald-200 mb-1",children:[a.num_shares&&(0,b.jsxs)("span",{children:[(0,b.jsx)("span",{className:"text-emerald-300",children:"Shares:"})," ",a.num_shares.toLocaleString()]}),a.price_per_share&&(0,b.jsxs)("span",{children:[(0,b.jsx)("span",{className:"text-emerald-300",children:"Price:"})," ",aV(a.price_per_share,a.currency)]}),a.spread_per_share&&a.spread_per_share>0&&(0,b.jsxs)("span",{className:"text-green-300",children:[(0,b.jsx)("span",{className:"text-emerald-300",children:"Spread:"})," ",aV(a.spread_per_share,a.currency)]})]}),(0,b.jsxs)("div",{className:"flex gap-3 text-emerald-200",children:[null!=a.funded_amount&&(0,b.jsxs)("span",{children:[(0,b.jsx)("span",{className:"text-emerald-300",children:"Funded:"})," ",aV(a.funded_amount,a.currency)," (",d.toFixed(0),"%)"]}),e&&(0,b.jsxs)("span",{children:[(0,b.jsx)("span",{className:"text-emerald-300",children:"Fees:"})," ",aV(f,a.currency)]}),null!=g&&(0,b.jsxs)("span",{className:g>=1?"text-green-300":"text-red-300",children:[(0,b.jsx)("span",{className:"text-emerald-300",children:"MOIC:"})," ",g.toFixed(2),"x"]})]}),a.acknowledgement_notes&&(0,b.jsx)(aX,{notes:a.acknowledgement_notes})]},a.id)})})]}),i&&(0,b.jsxs)("div",{className:"rounded-md border border-blue-400/30 bg-blue-500/5 p-2.5",children:[(0,b.jsxs)("div",{className:"flex items-center gap-1.5 mb-2",children:[(0,b.jsx)("h4",{className:"text-xs font-semibold text-blue-100 uppercase",children:"Holdings"}),(0,b.jsx)(E.Badge,{variant:"outline",className:"border-blue-400/40 bg-blue-500/10 text-blue-100 text-xs h-4 px-1.5",children:h.length})]}),null!=k&&(0,b.jsx)("div",{className:"text-base font-bold text-blue-100 mb-2",children:aV(k,h[0]?.currency??f?.currency)}),(0,b.jsx)("div",{className:"space-y-1.5",children:h.map(a=>{let c=aV(a.subscribed_amount,a.currency);return(0,b.jsxs)("div",{className:"text-xs",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"font-medium text-blue-100",children:a.deal_name||"Deal Allocation"}),(0,b.jsx)("div",{className:"font-semibold text-blue-100",children:c||"Pending"})]}),(0,b.jsx)(E.Badge,{className:"bg-blue-500/20 text-blue-100 text-xs h-4 px-1.5 uppercase",children:a.status?.replace(/_/g," ")||"Pending"})]}),(0,b.jsxs)("div",{className:"flex gap-3 text-blue-200",children:[(0,b.jsxs)("span",{children:[(0,b.jsx)("span",{className:"text-blue-300",children:"Eff:"})," ",a.effective_date?new Date(a.effective_date).toLocaleDateString():""]}),(0,b.jsxs)("span",{children:[(0,b.jsx)("span",{className:"text-blue-300",children:"Due:"})," ",a.funding_due_at?new Date(a.funding_due_at).toLocaleDateString():""]})]})]},a.id)})})]}),a.notes&&(0,b.jsx)("div",{className:"text-sm text-muted-foreground whitespace-pre-wrap border-l-2 border-white/10 pl-3 py-1",children:a.notes})]}),(0,b.jsxs)("div",{className:"flex flex-col items-end gap-2 min-w-[160px]",children:[(0,b.jsxs)("div",{className:"space-y-1.5 text-right w-full",children:[(0,b.jsx)(I.Label,{className:"text-xs uppercase text-muted-foreground",children:"Status"}),(0,b.jsxs)(F.Select,{value:c,onValueChange:b=>b3(a.id,b,g),disabled:bf===a.id,children:[(0,b.jsx)(F.SelectTrigger,{className:"w-full h-8 text-xs",children:(0,b.jsx)(F.SelectValue,{})}),(0,b.jsx)(F.SelectContent,{children:a$.map(a=>(0,b.jsx)(F.SelectItem,{value:a.value,children:a.label},a.value))})]})]}),"entity_link"===a.source||"hybrid"===a.source?(0,b.jsxs)(D.Button,{variant:"ghost",size:"sm",className:"text-red-400 hover:text-red-200 text-xs",onClick:()=>b4(a.id,d?.legal_name||"this investor"),disabled:bh===a.id,children:[bh===a.id?(0,b.jsx)(w.Loader2,{className:"mr-1 h-3 w-3 animate-spin"}):null,"Remove"]}):(0,b.jsx)("div",{className:"text-xs text-gray-500 italic",children:"Auto-discovered"})]})]})},a.id)})})})]})}),(0,b.jsxs)(C.TabsContent,{value:"documents",className:"space-y-4",children:[(0,b.jsxs)(B.Card,{className:"border border-white/10 bg-white/5",children:[(0,b.jsx)(B.CardHeader,{children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(B.CardTitle,{children:"Document Folders"}),(0,b.jsx)(B.CardDescription,{children:"Create, organize, and manage document folders with Google Drive-like structure"})]}),(0,b.jsx)(L,{entityId:U.id,triggerLabel:"Upload Document",onUploaded:bS,defaultFolderId:as,folderOptions:ad.filter(a=>!(("entity"===a.folder_type||"vehicle_root"===a.folder_type)&&!a.parent_folder_id)).map(a=>({id:a.id,name:a.name,path:a.path}))})]})}),(0,b.jsx)(B.CardContent,{children:(0,b.jsx)(aM,{entityId:U.id,folders:ad,documents:ai,onFoldersChange:bR,onFolderSelect:at,selectedFolderId:as})})]}),(0,b.jsxs)(B.Card,{className:"border border-white/10 bg-white/5",children:[(0,b.jsxs)(B.CardHeader,{children:[(0,b.jsxs)(B.CardTitle,{children:[bX?`${bX.name} Documents`:"All Documents"," (",bW.length,")"]}),(0,b.jsx)(B.CardDescription,{children:bX?`Showing files stored under ${bX.path}`:"Complete list of all documents across all folders"})]}),(0,b.jsx)(B.CardContent,{children:ak?(0,b.jsx)("div",{className:"text-gray-400 text-sm",children:"Loading documents"}):ap?(0,b.jsx)("div",{className:"text-red-200 text-sm",children:ap}):0===bW.length?(0,b.jsx)("div",{className:"text-gray-400 text-sm",children:'No documents uploaded yet. Use the "Upload Document" button above to add documents.'}):(0,b.jsx)("div",{className:"space-y-3",children:bW.map(a=>{let c=!!a.external_url,d=c?a.external_url:`/api/documents/${a.id}/download`,f=c?"Linked":"Uploaded",g=a.folder_id?bV.get(a.folder_id):null;return(0,b.jsxs)("div",{className:"flex items-center justify-between rounded-lg border border-white/10 bg-white/5 px-4 py-3 hover:bg-white/10 transition-colors",children:[(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,b.jsx)(j.FileText,{className:"h-4 w-4 text-gray-400"}),(0,b.jsx)("span",{className:"font-medium text-white",children:a.name||a.file_key?.split("/").pop()||"Untitled document"}),a.type&&(0,b.jsx)(E.Badge,{className:"bg-white/10 border border-white/10 text-white capitalize",children:a.type.replace("_"," ")}),c&&(0,b.jsx)(E.Badge,{variant:"outline",className:"text-xs bg-emerald-500/10 border-emerald-400/30 text-emerald-100",children:"External Link"})]}),(0,b.jsxs)("p",{className:"text-xs text-gray-400",children:[f," ",new Date(a.created_at).toLocaleString(),a.created_by&&`  ${a.created_by}`]}),g&&(0,b.jsxs)("p",{className:"text-xs text-gray-400",children:["Folder: ",g.path," (",g.folder_type.replace("_"," "),")"]}),a.description&&(0,b.jsx)("p",{className:"text-sm text-gray-400 max-w-2xl",children:a.description}),c&&(0,b.jsx)("p",{className:"text-xs text-emerald-200 break-all",children:a.external_url})]}),(0,b.jsx)("div",{className:"flex items-center gap-2",children:c?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(D.Button,{variant:"outline",size:"sm",className:"gap-2",asChild:!0,children:(0,b.jsxs)(e.default,{href:d,target:"_blank",rel:"noopener noreferrer",children:[(0,b.jsx)(x.ExternalLink,{className:"h-4 w-4"}),"Visit"]})}),(0,b.jsx)(D.Button,{variant:"ghost",size:"sm",className:"h-8 px-2 text-white hover:text-emerald-100 hover:bg-white/10",onClick:()=>b6(a),children:(0,b.jsx)(q.Edit,{className:"h-4 w-4"})}),(0,b.jsx)(D.Button,{variant:"ghost",size:"sm",className:"h-8 px-2 text-white hover:text-red-400 hover:bg-red-500/10",onClick:()=>b7(a.id,a.name||"Untitled document"),children:(0,b.jsx)(y.Trash2,{className:"h-4 w-4"})})]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)(D.Button,{variant:"outline",size:"sm",className:"gap-2",onClick:()=>bt.openPreview({id:a.id,file_name:a.name||a.file_name||"document",mime_type:a.type||void 0,type:a.type||void 0,file_size_bytes:void 0}),children:[(0,b.jsx)(z.Eye,{className:"h-4 w-4"}),"Preview"]}),(0,b.jsxs)(D.Button,{variant:"outline",size:"sm",className:"gap-2",onClick:()=>b5(a.id),children:[(0,b.jsx)(i.Download,{className:"h-4 w-4"}),"Download"]}),(0,b.jsx)(D.Button,{variant:"ghost",size:"sm",className:"h-8 px-2 text-white hover:text-emerald-100 hover:bg-white/10",onClick:()=>b6(a),children:(0,b.jsx)(q.Edit,{className:"h-4 w-4"})}),(0,b.jsx)(D.Button,{variant:"ghost",size:"sm",className:"h-8 px-2 text-white hover:text-red-400 hover:bg-red-500/10",onClick:()=>b7(a.id,a.name||"Untitled document"),children:(0,b.jsx)(y.Trash2,{className:"h-4 w-4"})})]})})]},a.id)})})})]})]}),(0,b.jsx)(C.TabsContent,{value:"stakeholders",className:"space-y-4",children:(0,b.jsxs)(B.Card,{className:"border border-white/10 bg-white/5",children:[(0,b.jsxs)(B.CardHeader,{className:"flex flex-row items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(B.CardTitle,{children:"Stakeholders"}),(0,b.jsx)(B.CardDescription,{children:"Lawyers, accountants, auditors, administrators, and strategic partners"})]}),(0,b.jsxs)(D.Button,{size:"sm",className:"gap-2",onClick:()=>{aJ("create"),aL(null),aH(!0)},children:[(0,b.jsx)(k.Plus,{className:"h-4 w-4"}),"Add Stakeholder"]})]}),(0,b.jsx)(B.CardContent,{children:0===$.length?(0,b.jsx)("div",{className:"text-gray-400 text-sm",children:"No stakeholders recorded yet."}):(0,b.jsx)("div",{className:"space-y-4",children:aY.map(a=>{let c=bU[a.key]??[];return(0,b.jsxs)("div",{className:"rounded-lg border border-white/10 bg-white/5 p-4",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm font-semibold text-white",children:a.label}),(0,b.jsx)("p",{className:"text-xs text-gray-400",children:0===c.length?"No relationships recorded yet.":`Tracking ${c.length} relationship${1===c.length?"":"s"}.`})]}),(0,b.jsx)(E.Badge,{className:"bg-white/10 border border-white/10 text-white",children:c.length})]}),c.length>0&&(0,b.jsx)("div",{className:"space-y-3",children:c.map(a=>(0,b.jsxs)("div",{className:"rounded-md border border-white/10 bg-black/20 px-4 py-3",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("p",{className:"font-medium text-white",children:a.company_name||a.contact_person||"Unnamed"}),(0,b.jsxs)("p",{className:"text-xs text-gray-400",children:[a.contact_person&&`Contact: ${a.contact_person}`,a.email&&`  ${a.email}`,a.phone&&`  ${a.phone}`]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(E.Badge,{className:"bg-white/10 border border-white/10 text-white",children:a.effective_to?"Former":"Active"}),(0,b.jsx)(D.Button,{variant:"ghost",size:"sm",className:"h-8 px-2 text-white hover:text-emerald-100 hover:bg-white/10",onClick:()=>cc(a),children:(0,b.jsx)(q.Edit,{className:"h-4 w-4"})}),(0,b.jsx)(D.Button,{variant:"ghost",size:"sm",className:"h-8 px-2 text-white hover:text-red-400 hover:bg-red-500/10",onClick:()=>cd(a.id,a.company_name||a.contact_person||"stakeholder"),children:(0,b.jsx)(y.Trash2,{className:"h-4 w-4"})})]})]}),(0,b.jsxs)("p",{className:"text-xs text-gray-400 mt-1",children:["Effective ",a.effective_from?new Date(a.effective_from).toLocaleDateString():"unknown",a.effective_to&&`  Ended ${new Date(a.effective_to).toLocaleDateString()}`]}),a.notes&&(0,b.jsx)("p",{className:"text-sm text-gray-400 mt-2",children:a.notes})]},a.id))})]},a.key)})})})]})}),(0,b.jsx)(C.TabsContent,{value:"directors",className:"space-y-4",children:(0,b.jsxs)(B.Card,{className:"border border-white/10 bg-white/5",children:[(0,b.jsxs)(B.CardHeader,{className:"flex flex-row items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(B.CardTitle,{children:"Directors & Officers"}),(0,b.jsx)(B.CardDescription,{children:"Maintain the current roster and historical appointments"})]}),(0,b.jsxs)(D.Button,{size:"sm",className:"gap-2",onClick:()=>{aC("create"),aE(null),aA(!0)},children:[(0,b.jsx)(k.Plus,{className:"h-4 w-4"}),"Add Director"]})]}),(0,b.jsx)(B.CardContent,{children:0===W.length?(0,b.jsx)("div",{className:"text-gray-400 text-sm",children:"No directors recorded yet."}):(0,b.jsx)("div",{className:"space-y-3",children:W.map(a=>(0,b.jsxs)("div",{className:"rounded-lg border border-white/10 bg-white/5 px-4 py-3",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("p",{className:"font-medium text-white",children:a.full_name}),(0,b.jsxs)("p",{className:"text-xs text-gray-400",children:[a.role||"Role not specified",a.email&&`  ${a.email}`]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(E.Badge,{className:"bg-white/10 border border-white/10 text-white",children:a.effective_to?"Former":"Active"}),(0,b.jsx)(D.Button,{variant:"ghost",size:"sm",className:"h-8 px-2 text-white hover:text-emerald-100 hover:bg-white/10",onClick:()=>ca(a),children:(0,b.jsx)(q.Edit,{className:"h-4 w-4"})}),(0,b.jsx)(D.Button,{variant:"ghost",size:"sm",className:"h-8 px-2 text-white hover:text-red-400 hover:bg-red-500/10",onClick:()=>cb(a.id,a.full_name),children:(0,b.jsx)(y.Trash2,{className:"h-4 w-4"})})]})]}),(0,b.jsxs)("div",{className:"text-xs text-gray-400 mt-2",children:["Effective"," ",a.effective_from?new Date(a.effective_from).toLocaleDateString():"unknown",a.effective_to&&`  Ended ${new Date(a.effective_to).toLocaleDateString()}`]}),a.notes&&(0,b.jsx)("p",{className:"text-sm text-gray-400 mt-2",children:a.notes})]},a.id))})})]})}),(0,b.jsx)(C.TabsContent,{value:"deals",className:"space-y-4",children:(0,b.jsxs)(B.Card,{className:"border border-white/10 bg-white/5",children:[(0,b.jsxs)(B.CardHeader,{children:[(0,b.jsxs)(B.CardTitle,{children:["Deals Linked to ",U.name]}),(0,b.jsx)(B.CardDescription,{children:"Click on any deal to view details and manage investment opportunities"})]}),(0,b.jsx)(B.CardContent,{children:0===M.length?(0,b.jsxs)("div",{className:"text-gray-400 text-sm py-8 text-center",children:[(0,b.jsx)(o.Briefcase,{className:"h-12 w-12 mx-auto mb-2 opacity-50"}),(0,b.jsx)("p",{className:"text-white",children:"No deals linked to this entity yet."})]}):(0,b.jsx)("div",{className:"space-y-3",children:M.map(a=>(0,b.jsxs)(e.default,{href:`/versotech_main/deals/${a.id}`,className:"flex items-center justify-between rounded-lg border border-white/10 bg-white/5 px-4 py-3 transition-all hover:bg-white/10 hover:border-emerald-400/30 cursor-pointer group",children:[(0,b.jsxs)("div",{className:"flex items-start gap-3 flex-1",children:[(0,b.jsx)("div",{className:"h-10 w-10 rounded-full bg-emerald-500/10 flex items-center justify-center shrink-0 group-hover:bg-emerald-500/20 transition-colors",children:(0,b.jsx)(o.Briefcase,{className:"h-5 w-5 text-emerald-400"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"font-medium text-white group-hover:text-emerald-100 transition-colors",children:a.name}),(0,b.jsxs)("p",{className:"text-xs text-gray-400 capitalize",children:[a.deal_type.replace("_"," "),"  ",a.currency||""]}),(0,b.jsxs)("p",{className:"text-xs text-gray-400 mt-1",children:["Created ",new Date(a.created_at).toLocaleDateString()]})]})]}),(0,b.jsx)(E.Badge,{className:"active"===a.status?"bg-emerald-500/20 border-emerald-400/40 text-emerald-100":"closed"===a.status?"bg-blue-500/20 border-blue-400/40 text-blue-100":"bg-amber-500/20 border-amber-400/40 text-amber-100",children:a.status}),(0,b.jsx)(x.ExternalLink,{className:"h-4 w-4 text-muted-foreground group-hover:text-emerald-400 transition-colors ml-2"})]},a.id))})})]})}),(0,b.jsxs)(C.TabsContent,{value:"health",className:"space-y-4",children:[(0,b.jsx)(aF,{entity:U,directors:W,stakeholders:$,documents:ai,folders:ad,deals:M,investors:a1,onAction:a=>{switch(a){case"edit_metadata":aW(!0);break;case"add_stakeholder":aH(!0);break;case"add_director":aA(!0);break;case"link_investor":be(!0);break;case"create_flag":bm(!0);break;case"upload_document":case"create_folder":T("documents");break;default:console.log("Action not implemented:",a)}}}),(0,b.jsx)("div",{className:"flex justify-end",children:(0,b.jsxs)(D.Button,{onClick:()=>bm(!0),className:"gap-2 bg-emerald-600 hover:bg-emerald-700 text-white",children:[(0,b.jsx)(k.Plus,{className:"h-4 w-4"}),"Create Health Flag"]})})]}),(0,b.jsx)(C.TabsContent,{value:"activity",className:"space-y-4",children:(0,b.jsxs)(B.Card,{className:"border border-white/10 bg-white/5",children:[(0,b.jsxs)(B.CardHeader,{className:"flex flex-row items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(B.CardTitle,{children:"Change Log"}),(0,b.jsx)(B.CardDescription,{children:"Automatic and manual updates recorded against this entity"})]}),(0,b.jsx)(D.Button,{variant:"outline",size:"sm",onClick:bT,disabled:ax,children:"Refresh"})]}),(0,b.jsx)(B.CardContent,{children:0===av.length?(0,b.jsx)("div",{className:"text-muted-foreground text-sm",children:"No change events recorded yet."}):(0,b.jsx)(Q.ScrollArea,{className:"max-h-[24rem] pr-4",children:(0,b.jsx)("div",{className:"space-y-4",children:av.map(a=>(0,b.jsxs)("div",{className:"border-l-2 border-emerald-400/40 pl-4",children:[(0,b.jsx)("p",{className:"text-sm font-medium text-foreground",children:a.event_type.replace(/_/g," ")}),(0,b.jsxs)("p",{className:"text-xs text-muted-foreground",children:[new Date(a.created_at).toLocaleString(),a.changed_by_profile?.display_name&&`  ${a.changed_by_profile.display_name}`]}),a.description&&(0,b.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:a.description})]},a.id))})})})]})}),(0,b.jsx)(C.TabsContent,{value:"valuations",className:"space-y-4",children:(0,b.jsxs)(B.Card,{className:"border border-white/10 bg-white/5",children:[(0,b.jsxs)(B.CardHeader,{className:"flex flex-row items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(B.CardTitle,{children:"NAV History"}),(0,b.jsx)(B.CardDescription,{children:"Net Asset Value (NAV) entries for this vehicle over time"})]}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)(aR,{vehicleId:U.id,onImported:b$}),(0,b.jsxs)(D.Button,{variant:"outline",size:"sm",onClick:()=>bs(!0),children:[(0,b.jsx)(k.Plus,{className:"h-4 w-4 mr-2"}),"Add Valuation"]})]})]}),(0,b.jsx)(B.CardContent,{children:0===a3.length?(0,b.jsxs)("div",{className:"text-center py-8",children:[(0,b.jsx)(A.TrendingUp,{className:"h-12 w-12 mx-auto text-muted-foreground mb-3"}),(0,b.jsx)("p",{className:"text-muted-foreground text-sm",children:"No valuations recorded yet. Add the first valuation to track NAV over time."})]}):(0,b.jsx)("div",{className:"overflow-x-auto",children:(0,b.jsxs)("table",{className:"w-full",children:[(0,b.jsx)("thead",{children:(0,b.jsxs)("tr",{className:"border-b border-white/10",children:[(0,b.jsx)("th",{className:"text-left py-3 px-4 text-sm font-medium text-muted-foreground",children:"As of Date"}),(0,b.jsx)("th",{className:"text-right py-3 px-4 text-sm font-medium text-muted-foreground",children:"Total NAV"}),(0,b.jsx)("th",{className:"text-right py-3 px-4 text-sm font-medium text-muted-foreground",children:"NAV per Unit"}),(0,b.jsx)("th",{className:"text-right py-3 px-4 text-sm font-medium text-muted-foreground",children:"Actions"})]})}),(0,b.jsx)("tbody",{children:a3.map(a=>(0,b.jsxs)("tr",{className:"border-b border-white/5 hover:bg-white/5",children:[(0,b.jsx)("td",{className:"py-3 px-4 text-sm",children:new Date(a.as_of_date).toLocaleDateString()}),(0,b.jsx)("td",{className:"py-3 px-4 text-sm text-right font-mono",children:a.nav_total?`$${a.nav_total.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`:"-"}),(0,b.jsx)("td",{className:"py-3 px-4 text-sm text-right font-mono",children:a.nav_per_unit?`$${a.nav_per_unit.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:6})}`:"-"}),(0,b.jsx)("td",{className:"py-3 px-4 text-right",children:(0,b.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,b.jsx)(D.Button,{variant:"ghost",size:"sm",onClick:()=>a6(a),children:(0,b.jsx)(q.Edit,{className:"h-4 w-4"})}),(0,b.jsx)(D.Button,{variant:"ghost",size:"sm",onClick:()=>b0(a),children:(0,b.jsx)(y.Trash2,{className:"h-4 w-4"})})]})})]},a.id))})]})})})]})}),(0,b.jsx)(C.TabsContent,{value:"positions",className:"space-y-4",children:(0,b.jsxs)(B.Card,{className:"border border-white/10 bg-white/5",children:[(0,b.jsxs)(B.CardHeader,{className:"flex flex-row items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(B.CardTitle,{children:"Investor Positions"}),(0,b.jsx)(B.CardDescription,{children:"Unit balances and cost basis per investor for this vehicle"})]}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)(aT,{vehicleId:U.id,onImported:b_}),(0,b.jsxs)(D.Button,{variant:"outline",size:"sm",onClick:()=>{bc(null),ba(!0)},children:[(0,b.jsx)(k.Plus,{className:"h-4 w-4 mr-2"}),"Add Position"]})]})]}),(0,b.jsx)(B.CardContent,{children:0===a7.length?(0,b.jsxs)("div",{className:"text-center py-8",children:[(0,b.jsx)(m.ClipboardList,{className:"h-12 w-12 mx-auto text-muted-foreground mb-3"}),(0,b.jsx)("p",{className:"text-muted-foreground text-sm",children:"No position records yet. Import a CSV or add one manually."})]}):(0,b.jsx)("div",{className:"overflow-x-auto",children:(0,b.jsxs)("table",{className:"w-full",children:[(0,b.jsx)("thead",{children:(0,b.jsxs)("tr",{className:"border-b border-white/10",children:[(0,b.jsx)("th",{className:"text-left py-3 px-4 text-sm font-medium text-muted-foreground",children:"Investor"}),(0,b.jsx)("th",{className:"text-right py-3 px-4 text-sm font-medium text-muted-foreground",children:"Units"}),(0,b.jsx)("th",{className:"text-right py-3 px-4 text-sm font-medium text-muted-foreground",children:"Cost Basis"}),(0,b.jsx)("th",{className:"text-right py-3 px-4 text-sm font-medium text-muted-foreground",children:"Last NAV"}),(0,b.jsx)("th",{className:"text-left py-3 px-4 text-sm font-medium text-muted-foreground",children:"As of Date"}),(0,b.jsx)("th",{className:"text-right py-3 px-4 text-sm font-medium text-muted-foreground",children:"Actions"})]})}),(0,b.jsx)("tbody",{children:a7.map(a=>{let c=a.investor?.display_name||a.investor?.legal_name||a.investor?.email||a.investor_id;return(0,b.jsxs)("tr",{className:"border-b border-white/5 hover:bg-white/5",children:[(0,b.jsx)("td",{className:"py-3 px-4 text-sm",children:(0,b.jsxs)("div",{className:"flex flex-col",children:[(0,b.jsx)("span",{className:"text-foreground",children:c}),a.investor?.email&&(0,b.jsx)("span",{className:"text-xs text-muted-foreground",children:a.investor.email})]})}),(0,b.jsx)("td",{className:"py-3 px-4 text-sm text-right font-mono",children:null!=a.units?a.units.toLocaleString("en-US",{minimumFractionDigits:0,maximumFractionDigits:6}):"-"}),(0,b.jsx)("td",{className:"py-3 px-4 text-sm text-right font-mono",children:null!=a.cost_basis?`$${a.cost_basis.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`:"-"}),(0,b.jsx)("td",{className:"py-3 px-4 text-sm text-right font-mono",children:null!=a.last_nav?`$${a.last_nav.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:6})}`:"-"}),(0,b.jsx)("td",{className:"py-3 px-4 text-sm",children:a.as_of_date?new Date(a.as_of_date).toLocaleDateString():"-"}),(0,b.jsx)("td",{className:"py-3 px-4 text-right",children:(0,b.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,b.jsx)(D.Button,{variant:"ghost",size:"sm",onClick:()=>{bc(a),ba(!0)},children:(0,b.jsx)(q.Edit,{className:"h-4 w-4"})}),(0,b.jsx)(D.Button,{variant:"ghost",size:"sm",onClick:()=>b1(a),children:(0,b.jsx)(y.Trash2,{className:"h-4 w-4"})})]})})]},a.id)})})]})})})]})})]}),(0,b.jsx)(Y,{entityId:U.id,open:az,onClose:()=>{aA(!1),aC("create"),aE(null)},onSuccess:bT,mode:aB,existingDirector:aD||void 0}),(0,b.jsx)(aa,{entityId:U.id,open:aG,onClose:()=>{aH(!1),aJ("create"),aL(null)},onSuccess:bT,mode:aI,existingStakeholder:aK||void 0}),(0,b.jsx)(au,{entityId:U.id,open:bl,onClose:()=>bm(!1),onSuccess:a=>{b8(a),bZ()}}),(0,b.jsx)(ar,{entityId:U.id,open:bd,onClose:()=>be(!1),onSuccess:b2}),(0,b.jsx)(aP,{vehicleId:U.id,open:br,onClose:()=>bs(!1),onSuccess:()=>{b$(),X.toast.success("Valuation added successfully")}}),(0,b.jsx)(aQ,{vehicleId:U.id,valuation:a5,open:!!a5,onClose:()=>a6(null),onSuccess:()=>{b$(),X.toast.success("Valuation updated successfully")}}),(0,b.jsx)(aS,{vehicleId:U.id,position:bb,open:a9,onClose:()=>{ba(!1),bc(null)},onSuccess:()=>{b_(),X.toast.success(bb?"Position updated successfully":"Position added successfully")}}),(0,b.jsx)(al,{entity:U,open:aN,onClose:()=>aW(!1),onSuccess:a=>{V(a),aW(!1)}}),(0,b.jsx)(ac.DocumentViewerFullscreen,{isOpen:bt.isOpen,document:bt.document,previewUrl:bt.previewUrl,isLoading:bt.isLoading,error:bt.error,onClose:bt.closePreview,onDownload:bt.downloadDocument}),bE&&(0,b.jsx)(aO,{open:bA,onClose:()=>{bB(!1),bF(null),bH(null)},entityId:U.id,investorId:bE,defaultValues:bG,onSuccess:a=>{a2(b=>b.map(b=>b.id===bE?a:b)),bB(!1),bF(null),bH(null)}}),(0,b.jsx)(am,{open:a_,onClose:()=>a0(!1),entityId:U.id,entityName:U.name}),bu&&(0,b.jsx)(an,{open:bw,onClose:()=>{bx(!1),bv(null)},document:bu,onSuccess:()=>{bS(),bx(!1),bv(null)}}),(0,b.jsx)(bQ,{})]})}a.s(["EntityDetailEnhanced",()=>a_],368180)}];

//# sourceMappingURL=versotech-portal_src_components_entities_entity-detail-enhanced_tsx_063e67c0._.js.map