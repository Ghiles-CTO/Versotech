module.exports=[68020,121736,a=>{"use strict";var b=a.i(352584),c=a.i(611038),d=a.i(421908),e=a.i(284169),f=a.i(3321),g=a.i(38125),h=a.i(477594);function i({onSignatureCapture:a,signerName:i,signerEmail:j,isSubmitting:k=!1}){let l=(0,c.useRef)(null),[m,n]=(0,c.useState)(!1),o=async()=>{if(!l.current||l.current.isEmpty())return;let b=l.current.getTrimmedCanvas().toDataURL("image/png");await a(b)};return(0,b.jsxs)(e.Card,{className:"h-full",children:[(0,b.jsxs)(e.CardHeader,{children:[(0,b.jsx)(e.CardTitle,{children:"Sign Document"}),(0,b.jsx)(e.CardDescription,{children:"Draw your signature below to execute this document"})]}),(0,b.jsxs)(e.CardContent,{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Signing as:"}),(0,b.jsxs)("div",{className:"rounded-lg bg-muted p-3",children:[(0,b.jsx)("p",{className:"font-semibold",children:i}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:j})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm font-medium mb-2",children:"Your Signature"}),(0,b.jsx)("div",{className:"border-2 border-border rounded-lg bg-white dark:bg-zinc-100 overflow-hidden",children:(0,b.jsx)(h.default,{ref:l,canvasProps:{className:"w-full cursor-crosshair",style:{width:"100%",height:"192px"}},penColor:"black",backgroundColor:"white",onEnd:()=>{l.current&&!l.current.isEmpty()&&n(!0)}})}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground mt-2",children:"Draw your signature using your mouse or touchscreen"})]}),(0,b.jsxs)("div",{className:"flex gap-2 pt-4",children:[(0,b.jsxs)(d.Button,{variant:"outline",onClick:()=>{l.current&&(l.current.clear(),n(!1))},disabled:!m||k,className:"flex-1",children:[(0,b.jsx)(g.RotateCcw,{className:"h-4 w-4 mr-2"}),"Clear"]}),(0,b.jsx)(d.Button,{onClick:o,disabled:!m||k,className:"flex-1",children:k?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(f.Loader2,{className:"h-4 w-4 mr-2 animate-spin"}),"Submitting..."]}):"Submit Signature"})]})]})]})}a.s(["SignatureCanvasWidget",()=>i],68020);var j=a.i(816854),k=a.i(618287);function l({pdfUrl:a,documentName:c}){return(0,b.jsxs)(e.Card,{className:"h-full",children:[(0,b.jsx)(e.CardHeader,{children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(j.FileText,{className:"h-5 w-5"}),(0,b.jsx)(e.CardTitle,{className:"text-lg",children:c})]}),(0,b.jsx)(d.Button,{variant:"outline",size:"sm",asChild:!0,children:(0,b.jsxs)("a",{href:a,target:"_blank",rel:"noopener noreferrer",children:["Open in New Tab",(0,b.jsx)(k.ExternalLink,{className:"h-4 w-4 ml-2"})]})})]})}),(0,b.jsx)(e.CardContent,{children:(0,b.jsx)("div",{className:"border rounded-lg bg-gray-50 overflow-hidden",style:{height:"600px"},children:(0,b.jsx)("iframe",{src:a,className:"w-full h-full",title:c})})})]})}a.s(["InlinePdfViewer",()=>l],121736)},250497,a=>{"use strict";var b=a.i(352584),c=a.i(611038),d=a.i(289633),e=a.i(58834),f=a.i(284169),g=a.i(15788),h=a.i(421908),i=a.i(181608),j=a.i(403205),k=a.i(399580),l=a.i(42329),m=a.i(877918),n=a.i(203297),o=a.i(478870),p=a.i(439467),q=a.i(724070),r=a.i(838086),s=a.i(975965),t=a.i(948153),u=a.i(68020),v=a.i(121736);function w({userId:a,signatureGroups:w,stats:x}){let y=(0,d.useRouter)(),[z,A]=(0,c.useState)("countersignatures"),[B,C]=(0,c.useState)(null),[D,E]=(0,c.useState)({active:!1,task:null,signatureRequest:null,token:null}),[F,G]=(0,c.useState)(!1),[H,I]=(0,c.useState)(null),J=async a=>{if(!a.instructions?.action_url)return void I("No signature URL available");let b=(a=>{let b=a.match(/[?&]token=([^&]+)/);if(b)return b[1];let c=a.match(/\/sign\/([^\/\?]+)/);return c?c[1]:null})(a.instructions.action_url);if(!b)return void I("Invalid signature URL");C(a.id),I(null);try{let c=await fetch(`/api/signature/${b}`);if(!c.ok){if(410===c.status)throw Error('This signature request has expired. Please check the "Expired" tab or resend the signature request.');if(400===c.status){let a=await c.json().catch(()=>({}));throw Error(a.error||"This signature request is no longer valid.")}if(404===c.status)throw Error("Signature request not found. It may have been deleted or never created.");throw Error("Failed to fetch signature request")}let d=await c.json();E({active:!0,task:a,signatureRequest:d,token:b}),await fetch("/api/tasks",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:a.id,status:"in_progress",started_at:new Date().toISOString()})})}catch(a){console.error("Error entering signing mode:",a),I(a instanceof Error?a.message:"Failed to load signature request")}finally{C(null)}},K=()=>{E({active:!1,task:null,signatureRequest:null,token:null}),I(null)},L=async a=>{if(D.signatureRequest&&D.token){G(!0),I(null);try{let b=await fetch("/api/signature/submit",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:D.token,signature_data_url:a})});if(!b.ok){let a=await b.json();throw Error(a.error||"Failed to submit signature")}K(),y.refresh()}catch(a){console.error("Error submitting signature:",a),I(a instanceof Error?a.message:"Failed to submit signature")}finally{G(!1)}}};(0,c.useEffect)(()=>{let b=(0,e.createClient)().channel("versosign_tasks").on("postgres_changes",{event:"UPDATE",schema:"public",table:"tasks",filter:`owner_user_id=eq.${a}`},a=>{console.log("Task updated:",a),y.refresh()}).on("postgres_changes",{event:"INSERT",schema:"public",table:"tasks",filter:`owner_user_id=eq.${a}`},a=>{console.log("New task created:",a),y.refresh()}).subscribe();return()=>{b.unsubscribe()}},[a,y]);let M=async a=>{let b=`
Investor: ${a.metadata?.investor_name||"Unknown"}
Email: ${a.instructions?.investor_email||"Not available"}
Signature URL: ${a.instructions?.action_url||"Not available"}

Action Required: ${a.instructions?.action_required||"Send signature link to investor"}
    `;await navigator.clipboard.writeText(b),alert("Follow-up details copied to clipboard!"),C(a.id);try{(await fetch("/api/tasks",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:a.id,status:"in_progress",started_at:new Date().toISOString()})})).ok||console.error("Failed to update task status")}catch(a){console.error("Error updating task:",a)}finally{C(null)}};if(D.active&&D.task&&D.signatureRequest){let a=D.signatureRequest.unsigned_pdf_url||D.signatureRequest.google_drive_url;return(0,b.jsxs)("div",{className:"container mx-auto py-6",children:[(0,b.jsxs)("div",{className:"mb-6",children:[(0,b.jsxs)(h.Button,{variant:"ghost",onClick:K,className:"mb-4",children:[(0,b.jsx)(s.ArrowLeft,{className:"h-4 w-4 mr-2"}),"Back to Tasks"]}),(0,b.jsx)("h1",{className:"text-2xl font-bold text-foreground mb-2",children:D.task.title}),(0,b.jsx)("p",{className:"text-muted-foreground",children:D.task.description})]}),H&&(0,b.jsxs)(j.Alert,{className:"mb-6 border-red-200 bg-red-50",children:[(0,b.jsx)(r.AlertTriangle,{className:"h-4 w-4 text-red-600"}),(0,b.jsx)(j.AlertTitle,{className:"text-red-900",children:"Error"}),(0,b.jsx)(j.AlertDescription,{className:"text-red-700",children:H})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[a&&(0,b.jsx)(v.InlinePdfViewer,{pdfUrl:a,documentName:D.task.title}),(0,b.jsx)(u.SignatureCanvasWidget,{onSignatureCapture:L,signerName:D.signatureRequest.signer_name,signerEmail:D.signatureRequest.signer_email,isSubmitting:F})]})]})}return(0,b.jsxs)("div",{className:"container mx-auto py-6",children:[(0,b.jsxs)("div",{className:"mb-8",children:[(0,b.jsx)("h1",{className:"text-3xl font-bold text-foreground mb-2",children:"VersoSign"}),(0,b.jsx)("p",{className:"text-muted-foreground",children:"Document signature management and countersigning"})]}),H&&(0,b.jsxs)(j.Alert,{className:"mb-6 border-red-200 bg-red-50",children:[(0,b.jsx)(r.AlertTriangle,{className:"h-4 w-4 text-red-600"}),(0,b.jsx)(j.AlertTitle,{className:"text-red-900",children:"Error"}),(0,b.jsx)(j.AlertDescription,{className:"text-red-700",children:H})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-8",children:[(0,b.jsxs)(f.Card,{children:[(0,b.jsx)(f.CardHeader,{className:"pb-3",children:(0,b.jsx)(f.CardTitle,{className:"text-sm font-medium text-muted-foreground",children:"Pending Signatures"})}),(0,b.jsxs)(f.CardContent,{children:[(0,b.jsx)("div",{className:"text-2xl font-bold",children:x.pending}),x.pending>0&&(0,b.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Awaiting action"})]})]}),(0,b.jsxs)(f.Card,{children:[(0,b.jsx)(f.CardHeader,{className:"pb-3",children:(0,b.jsx)(f.CardTitle,{className:"text-sm font-medium text-muted-foreground",children:"In Progress"})}),(0,b.jsxs)(f.CardContent,{children:[(0,b.jsx)("div",{className:"text-2xl font-bold",children:x.in_progress}),x.in_progress>0&&(0,b.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Currently signing"})]})]}),(0,b.jsxs)(f.Card,{children:[(0,b.jsx)(f.CardHeader,{className:"pb-3",children:(0,b.jsx)(f.CardTitle,{className:"text-sm font-medium text-muted-foreground",children:"Completed Today"})}),(0,b.jsxs)(f.CardContent,{children:[(0,b.jsx)("div",{className:"text-2xl font-bold text-green-600",children:x.completed_today}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Signed today"})]})]}),(0,b.jsxs)(f.Card,{children:[(0,b.jsx)(f.CardHeader,{className:"pb-3",children:(0,b.jsx)(f.CardTitle,{className:"text-sm font-medium text-muted-foreground",children:"Overdue"})}),(0,b.jsxs)(f.CardContent,{children:[(0,b.jsx)("div",{className:"text-2xl font-bold text-red-600",children:x.overdue}),x.overdue>0&&(0,b.jsx)("p",{className:"text-xs text-red-600 mt-1",children:"Need immediate attention"})]})]})]}),x.overdue>0&&(0,b.jsxs)(j.Alert,{className:"mb-6 border-red-200 bg-red-50",children:[(0,b.jsx)(r.AlertTriangle,{className:"h-4 w-4 text-red-600"}),(0,b.jsx)(j.AlertTitle,{className:"text-red-900",children:"Overdue Signatures"}),(0,b.jsxs)(j.AlertDescription,{className:"text-red-700",children:["You have ",x.overdue," overdue signature",1!==x.overdue?"s":""," requiring immediate attention."]})]}),(0,b.jsxs)(i.Tabs,{value:z,onValueChange:A,children:[(0,b.jsxs)(i.TabsList,{className:"mb-6",children:[(0,b.jsxs)(i.TabsTrigger,{value:"countersignatures",children:[(0,b.jsx)(n.FileSignature,{className:"h-4 w-4 mr-2"}),"Countersignatures",(w.find(a=>"countersignatures"===a.category)?.tasks.length||0)>0&&(0,b.jsx)(g.Badge,{className:"ml-2",variant:"secondary",children:w.find(a=>"countersignatures"===a.category)?.tasks.length||0})]}),(0,b.jsxs)(i.TabsTrigger,{value:"follow_ups",children:[(0,b.jsx)(o.Users,{className:"h-4 w-4 mr-2"}),"Manual Follow-ups",(w.find(a=>"follow_ups"===a.category)?.tasks.length||0)>0&&(0,b.jsx)(g.Badge,{className:"ml-2",variant:"secondary",children:w.find(a=>"follow_ups"===a.category)?.tasks.length||0})]}),(0,b.jsxs)(i.TabsTrigger,{value:"other",children:[(0,b.jsx)(k.CheckCircle2,{className:"h-4 w-4 mr-2"}),"Completed"]}),(0,b.jsxs)(i.TabsTrigger,{value:"expired",children:[(0,b.jsx)(m.AlertCircle,{className:"h-4 w-4 mr-2"}),"Expired",x.expired>0&&(0,b.jsx)(g.Badge,{className:"ml-2",variant:"destructive",children:x.expired})]})]}),w.map(a=>(0,b.jsx)(i.TabsContent,{value:a.category,children:(0,b.jsxs)(f.Card,{children:[(0,b.jsxs)(f.CardHeader,{children:[(0,b.jsx)(f.CardTitle,{children:a.title}),(0,b.jsx)(f.CardDescription,{children:a.description})]}),(0,b.jsx)(f.CardContent,{children:"expired"===a.category?0===(a.expiredSignatures?.length||0)&&0===(a.tasks?.length||0)?(0,b.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:"No expired signatures"}):(0,b.jsxs)("div",{className:"space-y-4",children:[a.tasks?.map(a=>(0,b.jsx)("div",{className:"border border-red-200 rounded-lg p-4 bg-red-50/50 dark:bg-red-950/20 dark:border-red-900",children:(0,b.jsx)("div",{className:"flex items-start justify-between",children:(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,b.jsx)(m.AlertCircle,{className:"h-4 w-4 text-red-600"}),(0,b.jsx)("h4",{className:"font-semibold text-foreground",children:a.title}),(0,b.jsx)(g.Badge,{variant:"destructive",children:"Expired"})]}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground mb-3",children:a.description||"The signature request for this task has expired."}),(0,b.jsxs)("div",{className:"flex flex-wrap gap-4 text-sm text-muted-foreground",children:[a.instructions?.investor_name&&(0,b.jsxs)("span",{className:"flex items-center gap-1",children:[(0,b.jsx)(o.Users,{className:"h-3 w-3"}),a.instructions.investor_name]}),a.instructions?.investor_email&&(0,b.jsxs)("span",{className:"flex items-center gap-1",children:[(0,b.jsx)(p.Mail,{className:"h-3 w-3"}),a.instructions.investor_email]}),(0,b.jsxs)("span",{className:"flex items-center gap-1",children:[(0,b.jsx)(q.Calendar,{className:"h-3 w-3"}),"Created ",(0,t.format)(new Date(a.created_at),"MMM d, yyyy")]})]})]})})},a.id)),a.expiredSignatures?.map(a=>(0,b.jsx)("div",{className:"border rounded-lg p-4 hover:bg-muted/50 transition-colors",children:(0,b.jsx)("div",{className:"flex items-start justify-between",children:(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,b.jsx)(m.AlertCircle,{className:"h-4 w-4 text-red-600"}),(0,b.jsx)("h4",{className:"font-semibold",children:a.document_type.toUpperCase()}),(0,b.jsx)(g.Badge,{variant:"destructive",children:"Expired"})]}),(0,b.jsxs)("p",{className:"text-sm text-muted-foreground mb-3",children:["Request for ",a.signer_name," expired on ",(0,t.format)(new Date(a.token_expires_at),"MMM d, yyyy")]}),(0,b.jsxs)("div",{className:"flex flex-wrap gap-4 text-sm text-muted-foreground",children:[(0,b.jsxs)("span",{className:"flex items-center gap-1",children:[(0,b.jsx)(o.Users,{className:"h-3 w-3"}),a.investor?.display_name||a.investor?.legal_name||a.signer_name]}),(0,b.jsxs)("span",{className:"flex items-center gap-1",children:[(0,b.jsx)(p.Mail,{className:"h-3 w-3"}),a.signer_email]}),(0,b.jsxs)("span",{className:"flex items-center gap-1",children:[(0,b.jsx)(q.Calendar,{className:"h-3 w-3"}),"Created ",(0,t.format)(new Date(a.created_at),"MMM d, yyyy")]})]})]})})},a.id))]}):0===a.tasks.length?(0,b.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:"No tasks in this category"}):(0,b.jsx)("div",{className:"space-y-4",children:a.tasks.map(a=>(0,b.jsx)("div",{className:"border rounded-lg p-4 hover:bg-muted/50 transition-colors",children:(0,b.jsxs)("div",{className:"flex items-start justify-between",children:[(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(a=>{switch(a){case"completed":return(0,b.jsx)(k.CheckCircle2,{className:"h-4 w-4 text-green-600"});case"in_progress":return(0,b.jsx)(l.Clock,{className:"h-4 w-4 text-blue-600 animate-pulse"});case"overdue":return(0,b.jsx)(r.AlertTriangle,{className:"h-4 w-4 text-red-600"});default:return(0,b.jsx)(m.AlertCircle,{className:"h-4 w-4 text-yellow-600"})}})(a.due_at&&new Date(a.due_at)<new Date&&"pending"===a.status?"overdue":a.status),(0,b.jsx)("h4",{className:"font-semibold",children:a.title}),(0,b.jsx)(g.Badge,{variant:"outline",className:(a=>{switch(a){case"high":return"bg-red-100 text-red-800 border-red-300";case"medium":return"bg-yellow-100 text-yellow-800 border-yellow-300";case"low":return"bg-green-100 text-green-800 border-green-300";default:return"bg-gray-100 text-gray-800 border-gray-300"}})(a.priority),children:a.priority}),a.instructions?.signer_role&&(0,b.jsxs)(g.Badge,{variant:"secondary",className:"text-xs",children:["Signing as: ",a.instructions.signer_role.toUpperCase()]}),a.instructions?.requires_prior_signature&&(0,b.jsx)(g.Badge,{variant:"outline",className:"text-xs text-amber-600 border-amber-300",children:"Awaiting prior signature"})]}),a.description&&(0,b.jsx)("p",{className:"text-sm text-muted-foreground mb-3",children:a.description}),(0,b.jsxs)("div",{className:"flex flex-wrap gap-4 text-sm text-muted-foreground",children:[a.instructions?.investor_name&&(0,b.jsxs)("span",{className:"flex items-center gap-1",children:[(0,b.jsx)(o.Users,{className:"h-3 w-3"}),a.instructions.investor_name]}),a.due_at&&(0,b.jsxs)("span",{className:"flex items-center gap-1",children:[(0,b.jsx)(q.Calendar,{className:"h-3 w-3"}),"Due ",(0,t.format)(new Date(a.due_at),"MMM d, yyyy")]}),a.instructions?.investor_email&&(0,b.jsxs)("span",{className:"flex items-center gap-1",children:[(0,b.jsx)(p.Mail,{className:"h-3 w-3"}),a.instructions.investor_email]})]})]}),(0,b.jsxs)("div",{className:"flex gap-2",children:[("pending"===a.status||"in_progress"===a.status)&&(0,b.jsxs)(b.Fragment,{children:["countersignature"===a.kind&&a.instructions?.action_url&&(0,b.jsxs)(h.Button,{size:"sm",onClick:()=>J(a),disabled:B===a.id,children:[(0,b.jsx)(n.FileSignature,{className:"h-4 w-4 mr-2"}),B===a.id?"Loading...":"Sign Document"]}),a.metadata?.issue==="investor_no_user_account"&&(0,b.jsxs)(h.Button,{size:"sm",variant:"outline",onClick:()=>M(a),disabled:B===a.id,children:[(0,b.jsx)(p.Mail,{className:"h-4 w-4 mr-2"}),"Copy Details"]})]}),"completed"===a.status&&a.completed_at&&(0,b.jsxs)(g.Badge,{variant:"outline",className:"text-green-600",children:["Completed ",(0,t.format)(new Date(a.completed_at),"MMM d")]})]})]})},a.id))})})]})},a.category))]})]})}a.s(["VersoSignPageClient",()=>w])}];

//# sourceMappingURL=versotech-portal_src_cb5a6eb5._.js.map