module.exports=[193695,(a,b,c)=>{b.exports=a.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},9349,a=>{a.n(a.i(142710))},199585,a=>{a.n(a.i(701395))},929852,a=>{a.n(a.i(816404))},516153,a=>{a.n(a.i(422096))},911164,a=>{a.n(a.i(273021))},243085,a=>{"use strict";a.i(483696);var b=a.i(263360),c=a.i(621599);a.i(937413);var d=a.i(131360);let e=["staff_admin","staff_ops","staff_rm","ceo"],f=async()=>{let a=await (0,c.cookies)();return(0,b.createServerClient)("https://ipguxdssecfexudnvtia.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlwZ3V4ZHNzZWNmZXh1ZG52dGlhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTgzNjE4MzcsImV4cCI6MjA3MzkzNzgzN30.AGxM_YW9hfxuu7xDpi_4xhOoRhYM7iGTS1vJ0z2FByE",{cookies:{getAll:()=>a.getAll(),setAll(b){try{b.forEach(({name:b,value:c,options:d})=>a.set(b,c,d))}catch{}}}})};async function g(){try{let a=await f(),{data:{user:b},error:c}=await a.auth.getUser();if(c||!b)return null;let{data:d,error:g}=await a.from("profiles").select("*").eq("id",b.id).single();if(g||!d)return console.error("[auth] Profile not found for user:",b.id,g),null;let h=[];if(e.includes(d.role)){let{data:c}=await a.from("staff_permissions").select("permission").eq("user_id",b.id);h=c?.map(a=>a.permission)||[]}return{id:d.id,email:d.email,displayName:d.display_name||d.email?.split("@")[0]||"User",avatar:d.avatar_url,role:d.role,title:d.title,created_at:d.created_at,permissions:h}}catch(a){return console.error("Error getting current user:",a),null}}async function h(){let a=await g();return a?console.log("[auth] Profile retrieved:",a.email,a.role):console.log("[auth] No profile found"),a}async function i(a){let b=await g();if(b||(0,d.redirect)("/versotech_main/login"),a&&!a.includes(b.role))throw Error("Insufficient permissions");return b}async function j(){let a=await g();if(a||(0,d.redirect)("/versotech_main/login"),"investor"!==a.role)throw Error("Investor access required");return a}async function k(){let a=await g();if(a||(0,d.redirect)("/versotech_main/login"),!e.includes(a.role))throw Error("Staff access required");return a}async function l(a){let b=await f(),{data:c,error:d}=await b.from("profiles").select("role").eq("id",a).single();if(!d&&c&&e.includes(c.role))return!0;let{data:g}=await b.rpc("get_user_personas",{p_user_id:a});return g?.some(a=>"staff"===a.persona_type||"ceo"===a.persona_type)||!1}a.s(["checkStaffAccess",()=>l,"getCurrentUser",()=>g,"getProfile",()=>h,"requireAuth",()=>i,"requireInvestorAuth",()=>j,"requireStaffAuth",()=>k])},912238,a=>{"use strict";a.s(["Sidebar",()=>b]);let b=(0,a.i(578644).registerClientReference)(function(){throw Error("Attempted to call Sidebar() from the server but Sidebar is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/versotech-portal/src/components/layout/sidebar.tsx <module evaluation>","Sidebar")},286563,a=>{"use strict";a.s(["Sidebar",()=>b]);let b=(0,a.i(578644).registerClientReference)(function(){throw Error("Attempted to call Sidebar() from the server but Sidebar is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/versotech-portal/src/components/layout/sidebar.tsx","Sidebar")},496154,a=>{"use strict";a.i(912238);var b=a.i(286563);a.n(b)},445735,a=>{"use strict";a.s(["UserMenu",()=>b]);let b=(0,a.i(578644).registerClientReference)(function(){throw Error("Attempted to call UserMenu() from the server but UserMenu is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/versotech-portal/src/components/layout/user-menu.tsx <module evaluation>","UserMenu")},181058,a=>{"use strict";a.s(["UserMenu",()=>b]);let b=(0,a.i(578644).registerClientReference)(function(){throw Error("Attempted to call UserMenu() from the server but UserMenu is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/versotech-portal/src/components/layout/user-menu.tsx","UserMenu")},455428,a=>{"use strict";a.i(445735);var b=a.i(181058);a.n(b)},365595,a=>{"use strict";a.s(["GlobalKeyboardShortcuts",()=>b]);let b=(0,a.i(578644).registerClientReference)(function(){throw Error("Attempted to call GlobalKeyboardShortcuts() from the server but GlobalKeyboardShortcuts is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/versotech-portal/src/components/layout/global-keyboard-shortcuts.tsx <module evaluation>","GlobalKeyboardShortcuts")},520443,a=>{"use strict";a.s(["GlobalKeyboardShortcuts",()=>b]);let b=(0,a.i(578644).registerClientReference)(function(){throw Error("Attempted to call GlobalKeyboardShortcuts() from the server but GlobalKeyboardShortcuts is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/versotech-portal/src/components/layout/global-keyboard-shortcuts.tsx","GlobalKeyboardShortcuts")},586007,a=>{"use strict";a.i(365595);var b=a.i(520443);a.n(b)},619220,a=>{"use strict";a.s(["ThemeProvider",()=>c,"useTheme",()=>d]);var b=a.i(578644);let c=(0,b.registerClientReference)(function(){throw Error("Attempted to call ThemeProvider() from the server but ThemeProvider is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/versotech-portal/src/components/theme-provider.tsx <module evaluation>","ThemeProvider"),d=(0,b.registerClientReference)(function(){throw Error("Attempted to call useTheme() from the server but useTheme is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/versotech-portal/src/components/theme-provider.tsx <module evaluation>","useTheme")},199017,a=>{"use strict";a.s(["ThemeProvider",()=>c,"useTheme",()=>d]);var b=a.i(578644);let c=(0,b.registerClientReference)(function(){throw Error("Attempted to call ThemeProvider() from the server but ThemeProvider is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/versotech-portal/src/components/theme-provider.tsx","ThemeProvider"),d=(0,b.registerClientReference)(function(){throw Error("Attempted to call useTheme() from the server but useTheme is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/versotech-portal/src/components/theme-provider.tsx","useTheme")},684069,a=>{"use strict";a.i(619220);var b=a.i(199017);a.n(b)},336331,a=>{"use strict";a.s(["KYCAlert",()=>b]);let b=(0,a.i(578644).registerClientReference)(function(){throw Error("Attempted to call KYCAlert() from the server but KYCAlert is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/versotech-portal/src/components/dashboard/kyc-alert.tsx <module evaluation>","KYCAlert")},730807,a=>{"use strict";a.s(["KYCAlert",()=>b]);let b=(0,a.i(578644).registerClientReference)(function(){throw Error("Attempted to call KYCAlert() from the server but KYCAlert is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/versotech-portal/src/components/dashboard/kyc-alert.tsx","KYCAlert")},914402,a=>{"use strict";a.i(336331);var b=a.i(730807);a.n(b)},743513,a=>{"use strict";var b=a.i(714898),c=a.i(496154);let d="#0B5FFF",e={versoholdings:{name:"VERSO",loginPath:"/login",dashboardPath:"/versotech_main/dashboard",primary:d},versotech:{name:"VERSO Tech",loginPath:"/login",dashboardPath:"/versotech_main",primary:d}};function f({brand:a,className:c=""}){let d=e[a];return(0,b.jsx)("div",{className:`flex items-center ${c}`,children:(0,b.jsx)("h1",{className:`text-xl font-bold ${"versotech"===a?"text-foreground":"text-black"}`,children:d.name})})}var g=a.i(455428),h=a.i(586007),i=a.i(684069),j=a.i(243085);a.i(937413);var k=a.i(131360),l=a.i(198307),m=a.i(914402);async function n({children:a,brand:d}){let e=await (0,j.getProfile)();e||(0,k.redirect)("/login");let n=["staff_admin","staff_ops","staff_rm","ceo"].includes(e.role);console.log("[AppLayout] Profile check:",{brand:d,userRole:e.role,isStaffRole:n,email:e.email}),"versoholdings"===d&&"investor"!==e.role&&(console.log("[AppLayout] Redirecting non-investor from versoholdings"),(0,k.redirect)("/versotech_main")),"versotech"!==d||n||(console.log("[AppLayout] Redirecting non-staff from versotech"),(0,k.redirect)("/versotech_main/dashboard")),console.log("[AppLayout] Access granted for",e.email,"to",d);let o="versotech"===d,p="completed";if("versoholdings"===d&&"investor"===e.role)try{let a=await (0,l.createClient)(),{data:b}=await a.from("investor_users").select("investor_id, investors(kyc_status)").eq("user_id",e.id).single();b?.investors&&(p=b.investors.kyc_status||"not_started")}catch(a){console.error("[AppLayout] Error fetching KYC status:",a)}return(0,b.jsx)(i.ThemeProvider,{defaultTheme:o?"staff-dark":"light",children:(0,b.jsxs)("div",{className:"flex h-screen min-h-screen overflow-hidden bg-gradient-to-br from-gray-50 via-blue-50/30 to-indigo-50/20 dark:from-zinc-950 dark:via-zinc-950 dark:to-zinc-950 dark:bg-zinc-950",children:[(0,b.jsx)(h.GlobalKeyboardShortcuts,{brand:d,role:e.role}),(0,b.jsx)(c.Sidebar,{brand:d,userProfile:e}),(0,b.jsxs)("div",{className:"flex-1 flex flex-col overflow-hidden",children:[(0,b.jsxs)("header",{className:"bg-white/80 dark:bg-zinc-950 backdrop-blur-sm border-b border-gray-200 dark:border-white/10 px-6 py-4 flex items-center justify-between",children:[(0,b.jsx)(f,{brand:d}),(0,b.jsx)("div",{className:"flex items-center space-x-4",children:(0,b.jsx)(g.UserMenu,{profile:e,brand:d})})]}),(0,b.jsx)("main",{className:"flex-1 overflow-y-auto scrollbar-hide bg-transparent dark:bg-zinc-950 backdrop-blur-sm",children:(0,b.jsxs)("div",{className:"min-h-full bg-white/60 dark:bg-transparent backdrop-blur-sm dark:backdrop-blur-none",children:[!o&&"completed"!==p&&(0,b.jsx)("div",{className:"px-6 pt-6",children:(0,b.jsx)(m.KYCAlert,{status:p})}),a]})})]})]})})}a.s(["AppLayout",()=>n],743513)},416869,a=>{"use strict";a.s(["CalendarSplitView",()=>b]);let b=(0,a.i(578644).registerClientReference)(function(){throw Error("Attempted to call CalendarSplitView() from the server but CalendarSplitView is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/versotech-portal/src/components/calendar/calendar-split-view.tsx <module evaluation>","CalendarSplitView")},249364,a=>{"use strict";a.s(["CalendarSplitView",()=>b]);let b=(0,a.i(578644).registerClientReference)(function(){throw Error("Attempted to call CalendarSplitView() from the server but CalendarSplitView is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/versotech-portal/src/components/calendar/calendar-split-view.tsx","CalendarSplitView")},77088,a=>{"use strict";a.i(416869);var b=a.i(249364);a.n(b)},196568,a=>{"use strict";var b=a.i(714898);a.i(937413);var c=a.i(131360),d=a.i(743513),e=a.i(77088),f=a.i(198307);let g={high:{id:"task-high",name:"Task • High priority",color:"#dc2626"},medium:{id:"task-medium",name:"Task • Medium priority",color:"#f97316"},low:{id:"task-low",name:"Task • Standard priority",color:"#2563eb"}},h={urgent:{id:"request-urgent",name:"Custom request • Urgent",color:"#be123c"},high:{id:"request-high",name:"Custom request • High",color:"#b45309"},normal:{id:"request-normal",name:"Custom request • Standard",color:"#0ea5e9"},low:{id:"request-low",name:"Custom request • Low",color:"#64748b"}},i={open:{id:"deal-open",name:"Deal window • Open",color:"#4338ca"},allocation_pending:{id:"deal-allocation",name:"Deal window • Allocation pending",color:"#7c3aed"},closed:{id:"deal-closed",name:"Deal window • Closed",color:"#64748b"},cancelled:{id:"deal-cancelled",name:"Deal window • Cancelled",color:"#9ca3af"}};async function j(){let a=await (0,f.createClient)(),{data:{user:j}}=await a.auth.getUser();j||(0,c.redirect)("/login");let{data:m}=await a.from("investor_users").select("investor_id").eq("user_id",j.id),n=m?.map(a=>a.investor_id)??[],o=(0,f.createServiceClient)(),p=o.from("tasks").select("id, title, status, priority, due_at, category, created_at, owner_user_id, owner_investor_id").not("status","eq","completed");p=n.length>0?p.or(`owner_user_id.eq.${j.id},owner_investor_id.in.(${n.join(",")})`):p.eq("owner_user_id",j.id);let{data:q}=await p.order("due_at",{ascending:!0,nullsFirst:!1}).limit(20),r={high:0,medium:1,low:2},s=(q??[]).sort((a,b)=>{let c=r[a.priority]??99,d=r[b.priority]??99;return c!==d?c-d:a.due_at||b.due_at?a.due_at?b.due_at?new Date(a.due_at).getTime()-new Date(b.due_at).getTime():-1:1:0}),{data:t}=await o.from("deals").select(`
      id,
      name,
      status,
      open_at,
      close_at,
      created_at,
      vehicles ( id, name ),
      deal_memberships!inner ( user_id )
    `).eq("deal_memberships.user_id",j.id).order("close_at",{ascending:!0,nullsFirst:!1}).limit(20),u=[];if(n.length>0){let{data:a}=await o.from("request_tickets").select("id, subject, status, priority, due_date, created_at").in("investor_id",n).order("due_date",{ascending:!0,nullsFirst:!1}).limit(20);u=a??[]}let v=[];for(let a of s??[]){let b=g[a.priority||"medium"]??g.low,c=new Date(a.due_at?a.due_at:a.created_at),d=a.due_at?k(c,-1):new Date(a.created_at);v.push({id:`task-${a.id}`,name:a.title,startAt:d.toISOString(),endAt:c.toISOString(),status:b,description:a.category?`Category • ${l(a.category)}`:void 0})}for(let a of t??[]){let b=i[a.status??"open"]??i.open,c=new Date(a.open_at?a.open_at:a.created_at),d=a.close_at?new Date(a.close_at):k(c,21);v.push({id:`deal-${a.id}`,name:a.name,startAt:c.toISOString(),endAt:d.toISOString(),status:b,description:a.vehicles?.[0]?.name?`Vehicle • ${a.vehicles[0].name}`:void 0})}for(let a of u){let b=h[a.priority]??h.normal,c=new Date(a.created_at),d=a.due_date?new Date(a.due_date):k(c,3);v.push({id:`request-${a.id}`,name:a.subject||"Custom request",startAt:c.toISOString(),endAt:d.toISOString(),status:b,description:`Status • ${l(a.status)}`})}return v.sort((a,b)=>new Date(a.startAt).getTime()-new Date(b.startAt).getTime()),(0,b.jsx)(d.AppLayout,{brand:"versoholdings",children:(0,b.jsx)("div",{className:"space-y-8 px-6 py-8",children:(0,b.jsx)(e.CalendarSplitView,{calendarEvents:v,emptyCalendarMessage:"We'll surface deadlines, deal activity, and deliverables here once they are scheduled.",brand:"versoholdings"})})})}function k(a,b){return new Date(a.getTime()+864e5*b)}function l(a){if(a)return a.toLowerCase().split("_").map(a=>a.charAt(0).toUpperCase()+a.slice(1)).join(" ")}a.s(["default",()=>j,"dynamic",0,"force-dynamic"])},361481,a=>{a.v(a=>Promise.resolve().then(()=>a(389018)))}];

//# sourceMappingURL=%5Broot-of-the-server%5D__e0719a09._.js.map