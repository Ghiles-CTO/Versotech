module.exports=[667876,e=>{"use strict";var t=e.i(779444),r=e.i(698261),a=e.i(821776),i=e.i(796417),n=e.i(856890),s=e.i(26996),l=e.i(436944),o=e.i(88281),u=e.i(765944),d=e.i(984788),c=e.i(237011),p=e.i(712007),y=e.i(777657),m=e.i(13180),f=e.i(273827),_=e.i(193695);e.i(947956);var g=e.i(36217),h=e.i(414131),v=e.i(433669);async function w(){try{let e=await (0,v.createClient)(),{data:{user:t},error:r}=await e.auth.getUser();if(r||!t)return h.NextResponse.json({success:!1,error:"Unauthorized"},{status:401});let{data:a}=await e.from("profiles").select("role").eq("id",t.id).single();if(!(a?.role?.startsWith("staff_")||a?.role==="ceo"))return h.NextResponse.json({success:!1,error:"Forbidden"},{status:403});let i=(0,v.createServiceClient)(),n=[],{data:s,error:l}=await i.from("investors").select("id, legal_name, type, kyc_status, country, status, created_at").order("created_at",{ascending:!1}),{data:o}=await i.from("investor_users").select(`
        investor_id,
        user_id,
        role,
        is_primary,
        can_sign,
        profiles:profiles!investor_users_user_id_fkey (
          id,
          display_name,
          email
        )
      `),u=new Map;if(o)for(let e of o){let t=u.get(e.investor_id)||[];t.push({user_id:e.user_id,role:e.role,is_primary:e.is_primary||!1,can_sign:e.can_sign||!1,profiles:Array.isArray(e.profiles)?e.profiles[0]:e.profiles}),u.set(e.investor_id,t)}if(console.log("[unified-users] Investors query result:",{hasError:!!l,errorDetails:l?JSON.stringify(l):null,dataLength:s?.length??"null",firstItem:s?.[0]?JSON.stringify(s[0]).substring(0,200):"null"}),l)console.error("[unified-users] Investors error:",JSON.stringify(l));else if(s)for(let e of s){let t=u.get(e.id)||[];if(0===t.length)n.push({id:`investor-${e.id}-entity`,entityId:e.id,entityType:"investor",entityName:e.legal_name||"Unnamed Investor",userName:"No users assigned",userEmail:"-",userRole:e.type||"individual",isPrimary:!1,canSign:!1,status:"active"===e.status?"active":"inactive",kycStatus:e.kyc_status,country:e.country,createdAt:e.created_at});else for(let r of t)n.push({id:`investor-${e.id}-${r.user_id}`,entityId:e.id,entityType:"investor",entityName:e.legal_name||"Unnamed Investor",userName:r.profiles?.display_name||"Unknown User",userEmail:r.profiles?.email||"-",userRole:e.type||"individual",isPrimary:r.is_primary||!1,canSign:r.can_sign||!1,status:"active"===e.status?"active":"inactive",kycStatus:e.kyc_status,country:e.country,createdAt:e.created_at})}let{data:d,error:c}=await i.from("lawyers").select("id, firm_name, display_name, type, kyc_status, country, is_active, created_at").order("created_at",{ascending:!1}),{data:p}=await i.from("lawyer_users").select(`
        lawyer_id,
        user_id,
        role,
        is_primary,
        can_sign,
        profiles:profiles!lawyer_users_user_fk (id, display_name, email)
      `),y=new Map;if(p)for(let e of p){let t=y.get(e.lawyer_id)||[];t.push({user_id:e.user_id,role:e.role,is_primary:e.is_primary||!1,can_sign:e.can_sign||!1,profiles:Array.isArray(e.profiles)?e.profiles[0]:e.profiles}),y.set(e.lawyer_id,t)}if(console.log("[unified-users] Lawyers query result:",{hasError:!!c,errorDetails:c?JSON.stringify(c):null,dataLength:d?.length??"null"}),c)console.error("[unified-users] Lawyers error:",JSON.stringify(c));else if(d)for(let e of d){let t=y.get(e.id)||[];if(0===t.length)n.push({id:`lawyer-${e.id}-entity`,entityId:e.id,entityType:"lawyer",entityName:e.firm_name||e.display_name||"Unnamed Firm",userName:"No users assigned",userEmail:"-",userRole:e.type||"entity",isPrimary:!1,canSign:!1,status:e.is_active?"active":"inactive",kycStatus:e.kyc_status,country:e.country,createdAt:e.created_at});else for(let r of t)n.push({id:`lawyer-${e.id}-${r.user_id}`,entityId:e.id,entityType:"lawyer",entityName:e.firm_name||e.display_name||"Unnamed Firm",userName:r.profiles?.display_name||"Unknown User",userEmail:r.profiles?.email||"-",userRole:e.type||"entity",isPrimary:r.is_primary||!1,canSign:r.can_sign||!1,status:e.is_active?"active":"inactive",kycStatus:e.kyc_status,country:e.country,createdAt:e.created_at})}let{data:m,error:f}=await i.from("partners").select("id, name, legal_name, type, kyc_status, country, status, created_at").order("created_at",{ascending:!1}),{data:_}=await i.from("partner_users").select(`
        partner_id,
        user_id,
        role,
        is_primary,
        can_sign,
        profiles:profiles!partner_users_user_fk (id, display_name, email)
      `),g=new Map;if(_)for(let e of _){let t=g.get(e.partner_id)||[];t.push({user_id:e.user_id,role:e.role,is_primary:e.is_primary||!1,can_sign:e.can_sign||!1,profiles:Array.isArray(e.profiles)?e.profiles[0]:e.profiles}),g.set(e.partner_id,t)}if(console.log("[unified-users] Partners query result:",{hasError:!!f,errorDetails:f?JSON.stringify(f):null,dataLength:m?.length??"null"}),f)console.error("[unified-users] Partners error:",JSON.stringify(f));else if(m)for(let e of m){let t=g.get(e.id)||[];if(0===t.length)n.push({id:`partner-${e.id}-entity`,entityId:e.id,entityType:"partner",entityName:e.name||e.legal_name||"Unnamed Partner",userName:"No users assigned",userEmail:"-",userRole:e.type||"entity",isPrimary:!1,canSign:!1,status:"active"===e.status?"active":"inactive",kycStatus:e.kyc_status,country:e.country,createdAt:e.created_at});else for(let r of t)n.push({id:`partner-${e.id}-${r.user_id}`,entityId:e.id,entityType:"partner",entityName:e.name||e.legal_name||"Unnamed Partner",userName:r.profiles?.display_name||"Unknown User",userEmail:r.profiles?.email||"-",userRole:e.type||"entity",isPrimary:r.is_primary||!1,canSign:r.can_sign||!1,status:"active"===e.status?"active":"inactive",kycStatus:e.kyc_status,country:e.country,createdAt:e.created_at})}let{data:w,error:R}=await i.from("commercial_partners").select("id, name, legal_name, type, kyc_status, country, status, created_at").order("created_at",{ascending:!1}),{data:N}=await i.from("commercial_partner_users").select(`
        commercial_partner_id,
        user_id,
        role,
        is_primary,
        can_sign,
        profiles:profiles!commercial_partner_users_user_fk (id, display_name, email)
      `),E=new Map;if(N)for(let e of N){let t=E.get(e.commercial_partner_id)||[];t.push({user_id:e.user_id,role:e.role,is_primary:e.is_primary||!1,can_sign:e.can_sign||!1,profiles:Array.isArray(e.profiles)?e.profiles[0]:e.profiles}),E.set(e.commercial_partner_id,t)}if(console.log("[unified-users] Commercial Partners query result:",{hasError:!!R,errorDetails:R?JSON.stringify(R):null,dataLength:w?.length??"null"}),R)console.error("[unified-users] Commercial Partners error:",JSON.stringify(R));else if(w)for(let e of w){let t=E.get(e.id)||[];if(0===t.length)n.push({id:`commercial_partner-${e.id}-entity`,entityId:e.id,entityType:"commercial_partner",entityName:e.name||e.legal_name||"Unnamed Commercial Partner",userName:"No users assigned",userEmail:"-",userRole:e.type||"entity",isPrimary:!1,canSign:!1,status:"active"===e.status?"active":"inactive",kycStatus:e.kyc_status,country:e.country,createdAt:e.created_at});else for(let r of t)n.push({id:`commercial_partner-${e.id}-${r.user_id}`,entityId:e.id,entityType:"commercial_partner",entityName:e.name||e.legal_name||"Unnamed Commercial Partner",userName:r.profiles?.display_name||"Unknown User",userEmail:r.profiles?.email||"-",userRole:e.type||"entity",isPrimary:r.is_primary||!1,canSign:r.can_sign||!1,status:"active"===e.status?"active":"inactive",kycStatus:e.kyc_status,country:e.country,createdAt:e.created_at})}let{data:S,error:A}=await i.from("introducers").select(`
        id,
        legal_name,
        type,
        email,
        contact_name,
        status,
        created_at
      `).order("created_at",{ascending:!1});if(A)console.error("[unified-users] Introducers error:",JSON.stringify(A));else if(S)for(let e of S)n.push({id:`introducer-${e.id}-entity`,entityId:e.id,entityType:"introducer",entityName:e.legal_name||"Unnamed Introducer",userName:e.contact_name||"No contact",userEmail:e.email||"-",userRole:e.type||"individual",isPrimary:!0,canSign:!1,status:"active"===e.status?"active":"inactive",kycStatus:null,country:null,createdAt:e.created_at});let{data:T,error:k}=await i.from("arranger_entities").select(`
        id,
        legal_name,
        type,
        email,
        status,
        kyc_status,
        created_at
      `).order("created_at",{ascending:!1});if(k)console.error("[unified-users] Arrangers error:",JSON.stringify(k));else if(T)for(let e of T)n.push({id:`arranger-${e.id}-entity`,entityId:e.id,entityType:"arranger",entityName:e.legal_name||"Unnamed Arranger",userName:"Entity Contact",userEmail:e.email||"-",userRole:e.type||"entity",isPrimary:!0,canSign:!1,status:"active"===e.status?"active":"inactive",kycStatus:e.kyc_status,country:null,createdAt:e.created_at});console.log("[unified-users] Final allUsers summary:",{total:n.length,byType:{investor:n.filter(e=>"investor"===e.entityType).length,lawyer:n.filter(e=>"lawyer"===e.entityType).length,partner:n.filter(e=>"partner"===e.entityType).length,commercial_partner:n.filter(e=>"commercial_partner"===e.entityType).length,introducer:n.filter(e=>"introducer"===e.entityType).length,arranger:n.filter(e=>"arranger"===e.entityType).length}});let C={total:n.length,investors:n.filter(e=>"investor"===e.entityType).length,lawyers:n.filter(e=>"lawyer"===e.entityType).length,partners:n.filter(e=>"partner"===e.entityType).length,commercialPartners:n.filter(e=>"commercial_partner"===e.entityType).length,introducers:n.filter(e=>"introducer"===e.entityType).length,arrangers:n.filter(e=>"arranger"===e.entityType).length,active:n.filter(e=>"active"===e.status).length,pending:n.filter(e=>"pending"===e.status||"pending"===e.kycStatus).length};return h.NextResponse.json({success:!0,data:n,stats:C})}catch(e){return console.error("[unified-users] Error:",{message:e?.message,details:e?.details,hint:e?.hint,code:e?.code}),h.NextResponse.json({success:!1,error:e?.message||"Failed to fetch users"},{status:500})}}e.s(["GET",()=>w],889022);var R=e.i(889022);let N=new t.AppRouteRouteModule({definition:{kind:r.RouteKind.APP_ROUTE,page:"/api/admin/unified-users/route",pathname:"/api/admin/unified-users",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/versotech-portal/src/app/api/admin/unified-users/route.ts",nextConfigOutput:"",userland:R}),{workAsyncStorage:E,workUnitAsyncStorage:S,serverHooks:A}=N;function T(){return(0,a.patchFetch)({workAsyncStorage:E,workUnitAsyncStorage:S})}async function k(e,t,a){N.isDev&&(0,i.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let h="/api/admin/unified-users/route";h=h.replace(/\/index$/,"")||"/";let v=await N.prepare(e,t,{srcPage:h,multiZoneDraftMode:!1});if(!v)return t.statusCode=400,t.end("Bad Request"),null==a.waitUntil||a.waitUntil.call(a,Promise.resolve()),null;let{buildId:w,params:R,nextConfig:E,parsedUrl:S,isDraftMode:A,prerenderManifest:T,routerServerContext:k,isOnDemandRevalidate:C,revalidateOnlyGenerated:P,resolvedPathname:U,clientReferenceManifest:x,serverActionsManifest:I}=v,O=(0,l.normalizeAppPath)(h),b=!!(T.dynamicRoutes[O]||T.routes[U]),$=async()=>((null==k?void 0:k.render404)?await k.render404(e,t,S,!1):t.end("This page could not be found"),null);if(b&&!A){let e=!!T.routes[U],t=T.dynamicRoutes[O];if(t&&!1===t.fallback&&!e){if(E.experimental.adapterPath)return await $();throw new _.NoFallbackError}}let q=null;!b||N.isDev||A||(q="/index"===(q=U)?"/":q);let D=!0===N.isDev||!b,H=b&&!D;I&&x&&(0,s.setManifestsSingleton)({page:h,clientReferenceManifest:x,serverActionsManifest:I});let M=e.method||"GET",F=(0,n.getTracer)(),j=F.getActiveScopeSpan(),J={params:R,prerenderManifest:T,renderOpts:{experimental:{authInterrupts:!!E.experimental.authInterrupts},cacheComponents:!!E.cacheComponents,supportsDynamicResponse:D,incrementalCache:(0,i.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:E.cacheLife,waitUntil:a.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,a,i)=>N.onRequestError(e,t,a,i,k)},sharedContext:{buildId:w}},L=new o.NodeNextRequest(e),K=new o.NodeNextResponse(t),B=u.NextRequestAdapter.fromNodeNextRequest(L,(0,u.signalFromNodeResponse)(t));try{let s=async e=>N.handle(B,J).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=F.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==d.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let a=r.get("next.route");if(a){let t=`${M} ${a}`;e.setAttributes({"next.route":a,"http.route":a,"next.span_name":t}),e.updateName(t)}else e.updateName(`${M} ${h}`)}),l=!!(0,i.getRequestMeta)(e,"minimalMode"),o=async i=>{var n,o;let u=async({previousCacheEntry:r})=>{try{if(!l&&C&&P&&!r)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let n=await s(i);e.fetchMetrics=J.renderOpts.fetchMetrics;let o=J.renderOpts.pendingWaitUntil;o&&a.waitUntil&&(a.waitUntil(o),o=void 0);let u=J.renderOpts.collectedTags;if(!b)return await (0,p.sendResponse)(L,K,n,J.renderOpts.pendingWaitUntil),null;{let e=await n.blob(),t=(0,y.toNodeOutgoingHttpHeaders)(n.headers);u&&(t[f.NEXT_CACHE_TAGS_HEADER]=u),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==J.renderOpts.collectedRevalidate&&!(J.renderOpts.collectedRevalidate>=f.INFINITE_CACHE)&&J.renderOpts.collectedRevalidate,a=void 0===J.renderOpts.collectedExpire||J.renderOpts.collectedExpire>=f.INFINITE_CACHE?void 0:J.renderOpts.collectedExpire;return{value:{kind:g.CachedRouteKind.APP_ROUTE,status:n.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:a}}}}catch(t){throw(null==r?void 0:r.isStale)&&await N.onRequestError(e,t,{routerKind:"App Router",routePath:h,routeType:"route",revalidateReason:(0,c.getRevalidateReason)({isStaticGeneration:H,isOnDemandRevalidate:C})},!1,k),t}},d=await N.handleResponse({req:e,nextConfig:E,cacheKey:q,routeKind:r.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:T,isRoutePPREnabled:!1,isOnDemandRevalidate:C,revalidateOnlyGenerated:P,responseGenerator:u,waitUntil:a.waitUntil,isMinimalMode:l});if(!b)return null;if((null==d||null==(n=d.value)?void 0:n.kind)!==g.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==d||null==(o=d.value)?void 0:o.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});l||t.setHeader("x-nextjs-cache",C?"REVALIDATED":d.isMiss?"MISS":d.isStale?"STALE":"HIT"),A&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let _=(0,y.fromNodeOutgoingHttpHeaders)(d.value.headers);return l&&b||_.delete(f.NEXT_CACHE_TAGS_HEADER),!d.cacheControl||t.getHeader("Cache-Control")||_.get("Cache-Control")||_.set("Cache-Control",(0,m.getCacheControlHeader)(d.cacheControl)),await (0,p.sendResponse)(L,K,new Response(d.value.body,{headers:_,status:d.value.status||200})),null};j?await o(j):await F.withPropagatedContext(e.headers,()=>F.trace(d.BaseServerSpan.handleRequest,{spanName:`${M} ${h}`,kind:n.SpanKind.SERVER,attributes:{"http.method":M,"http.target":e.url}},o))}catch(t){if(t instanceof _.NoFallbackError||await N.onRequestError(e,t,{routerKind:"App Router",routePath:O,routeType:"route",revalidateReason:(0,c.getRevalidateReason)({isStaticGeneration:H,isOnDemandRevalidate:C})},!1,k),b)throw t;return await (0,p.sendResponse)(L,K,new Response(null,{status:500})),null}}e.s(["handler",()=>k,"patchFetch",()=>T,"routeModule",()=>N,"serverHooks",()=>A,"workAsyncStorage",()=>E,"workUnitAsyncStorage",()=>S],667876)}];

//# sourceMappingURL=6d6b6_next_dist_esm_build_templates_app-route_7200057c.js.map