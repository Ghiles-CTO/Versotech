module.exports=[918622,(e,t,r)=>{t.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},556704,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},832319,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},324725,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/after-task-async-storage.external.js",()=>require("next/dist/server/app-render/after-task-async-storage.external.js"))},270406,(e,t,r)=>{t.exports=e.x("next/dist/compiled/@opentelemetry/api",()=>require("next/dist/compiled/@opentelemetry/api"))},193695,(e,t,r)=>{t.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},433669,e=>{"use strict";e.i(814247);var t=e.i(150615),r=e.i(12049),o=e.i(57824);let n=async()=>{let e=await (0,o.cookies)();return(0,t.createServerClient)("https://ipguxdssecfexudnvtia.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlwZ3V4ZHNzZWNmZXh1ZG52dGlhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTgzNjE4MzcsImV4cCI6MjA3MzkzNzgzN30.AGxM_YW9hfxuu7xDpi_4xhOoRhYM7iGTS1vJ0z2FByE",{cookies:{getAll:()=>e.getAll(),setAll(t){try{t.forEach(({name:t,value:r,options:o})=>{e.set(t,r,o)})}catch(e){}}}})};e.s(["createClient",0,n,"createServiceClient",0,()=>(0,r.createClient)("https://ipguxdssecfexudnvtia.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY,{auth:{autoRefreshToken:!1,persistSession:!1}})])},254799,(e,t,r)=>{t.exports=e.x("crypto",()=>require("crypto"))},751966,e=>{"use strict";var t=e.i(433669),r=e.i(254799);async function o({workflowKey:e,payload:o,entityType:n,entityId:i,user:a}){try{let s=(0,t.createServiceClient)(),{data:l,error:c}=await s.from("workflows").select("*").eq("key",e).eq("is_active",!0).single();if(c||!l)return console.error("Workflow not found:",e),{success:!1,error:"Workflow not found"};let p=r.default.createHash("sha256").update(`${l.id}:${a.id}:${JSON.stringify(o)}`).digest("hex"),d=process.env.N8N_WEBHOOK_SECRET||process.env.N8N_OUTBOUND_SECRET;if(!d)return console.error("N8N_WEBHOOK_SECRET not configured"),{success:!1,error:"Webhook authentication not configured. Cannot trigger workflow."};if("default-webhook-secret"===d)return console.error("CRITICAL: N8N_WEBHOOK_SECRET using insecure default value in production"),{success:!1,error:"Webhook authentication misconfigured. Please set a secure N8N_WEBHOOK_SECRET."};let u=r.default.createHmac("sha256",d).update(p).digest("hex"),{data:g,error:f}=await s.from("workflow_runs").insert({workflow_id:l.id,workflow_key:l.key,triggered_by:a.id,entity_type:n??"process",entity_id:i||null,input_params:o,status:"queued",idempotency_token:p,webhook_signature:u}).select().single();if(f||!g)return console.error("Failed to create workflow run:",f),{success:!1,error:"Failed to create workflow run"};let m={workflow_run_id:g.id,workflow_key:l.key,triggered_by:{id:a.id,email:a.email,display_name:a.displayName,role:a.role,title:a.title},payload:o,entity_type:g.entity_type},_=await fetch(l.n8n_webhook_url,{method:"POST",headers:{"Content-Type":"application/json","x-verso-signature":u,"x-idempotency-key":p,"x-workflow-run-id":g.id},body:JSON.stringify(m)}),h=_.headers.get("content-type")||"",w={};if(["application/octet-stream","application/vnd.openxmlformats-officedocument","application/msword","application/pdf","application/zip","image/","video/","audio/"].some(e=>h.includes(e))){console.log("üîç Detected binary response, Content-Type:",h);let e=await _.arrayBuffer(),t=Buffer.from(e),r=function(e){let t=e.get("content-disposition");if(!t)return;let r=t.match(/filename[^;=\n]*=((['"]).*?\2|[^;\n]*)/);if(r&&r[1])return r[1].replace(/['"]/g,"")}(_.headers),o=t.slice(0,4).toString("hex");console.log("üìÑ Binary file signature:",o,"size:",t.length,"bytes"),w={binary:t,filename:r,mimeType:h,size:t.length,signature:o}}else if(h.includes("application/json")){let e=await _.text();try{w=JSON.parse(e)}catch(t){console.warn("‚ö†Ô∏è Failed to parse JSON response:",t),w={raw:e}}}else{let e=await _.text();try{w=JSON.parse(e)}catch{console.log("‚ö†Ô∏è Unknown content type, treating as potential binary string"),w={raw:e}}}if(!_.ok){let e=w.raw?`Failed to trigger n8n: ${w.raw}`:`Failed to trigger n8n: ${_.status} ${_.statusText}`;return await s.from("workflow_runs").update({status:"failed",error_message:e,completed_at:new Date().toISOString()}).eq("id",g.id),{success:!1,error:"Failed to trigger n8n webhook"}}return await s.from("workflow_runs").update({status:"running",started_at:new Date().toISOString(),output_data:w}).eq("id",g.id),await s.from("audit_logs").insert({event_type:"workflow",actor_id:a.id,action:"workflow_triggered",entity_type:"workflow_runs",entity_id:g.id,action_details:{workflow_key:l.key,payload:o,entity_type:g.entity_type},timestamp:new Date().toISOString()}),{success:!0,workflow_run_id:g.id,n8n_response:w}}catch(e){return console.error("Workflow trigger error:",e),{success:!1,error:"Internal error triggering workflow"}}}e.s(["triggerWorkflow",()=>o])},430586,e=>{"use strict";let t={storage:{bucket:process.env.SIGNATURES_BUCKET||"signatures",paths:{unsigned:(e,t)=>`${e}/${t}_unsigned.pdf`,signed:(e,t)=>`${e}/${t}_signed.pdf`}},token:{lengthBytes:32,expiryDays:7},pdf:{signature:{width:150,height:50},table:{bottom:433,height:112},positions:{party_a:{xPercent:.292},party_b:{xPercent:.704}},metadata:{timestampFontSize:7,timestampOffsetY:12,signerNameOffsetY:22,textColor:{r:.3,g:.3,b:.3}}},email:{fromAddress:"signatures@versoholdings.com",replyTo:"support@versoholdings.com"}};e.s(["SIGNATURE_CONFIG",0,t])},522734,(e,t,r)=>{t.exports=e.x("fs",()=>require("fs"))},40697,e=>{e.v("/server/assets/pdf.worker.6654537e.mjs")},411164,e=>{"use strict";var t=e.i(522734),r=e.i(792509),o=e.i(430586);async function n(o){let n=await e.A(908258),i=[process.env.PDFJS_WORKER_SRC,new URL(e.R(40697)).toString(),new URL(e.R(40697)).toString()].filter(Boolean),a=i.find(e=>{try{let o=e.startsWith("file:")?(0,r.fileURLToPath)(e):e;return(0,t.existsSync)(o)}catch{return!1}})||i[0];n.GlobalWorkerOptions.workerSrc=a;let s=[];try{let e=n.getDocument({data:o,useSystemFonts:!0,disableFontFace:!0}),t=await e.promise;console.log(`üîç [ANCHOR] Scanning ${t.numPages} pages for SIG_ANCHOR markers...`);for(let e=1;e<=t.numPages;e++){let r=await t.getPage(e),o=await r.getTextContent(),n=r.getViewport({scale:1});for(let t of o.items){if(!("str"in t))continue;let r=t.str,o=r.includes("SIG_ANCHOR:"),i=r.includes("SIG ANCHOR:");if(!o&&!i)continue;let a=null;if(o){let e=r.match(/SIG_ANCHOR:(\S+)/);e&&(a=e[1])}else if(i){let e=r.match(/SIG ANCHOR:([a-z0-9_ ]+)/i);e&&(a=e[1].trim().replace(/ /g,"_"),console.log(`   üîß Normalized space-corrupted anchor: "${e[1]}" -> "${a}"`))}if(!a)continue;let l=t.transform[4],c=t.transform[5];s.push({anchorId:a,pageNumber:e,rawX:l,rawY:c,xPercent:l/n.width,yFromBottom:c,pageWidth:n.width,pageHeight:n.height}),console.log(`   üìç Found ${a} on page ${e} at (${l.toFixed(1)}, ${c.toFixed(1)}) - ${(l/n.width*100).toFixed(1)}% from left`)}}}catch(e){throw console.error("‚ùå [ANCHOR] PDF parsing error:",e),e}return console.log(`‚úÖ [ANCHOR] Found ${s.length} anchor(s) total`),s}function i(e,t){let r=new Set(e.map(e=>e.anchorId)),o=t.filter(e=>!r.has(e));if(o.length>0){let e=Array.from(r).join(", ")||"(none)";throw Error(`MISSING_ANCHORS: ${o.join(", ")}. Found: ${e}`)}}function a(e,t,r="subscription"){let n=function(e,t="subscription"){return"introducer_agreement"===t?[{anchorId:e,label:"introducer_agreement"}]:e.startsWith("party_a")?[{anchorId:`${e}_form`,label:"subscription_form"},{anchorId:e,label:"main_agreement"}]:"party_b"===e?[{anchorId:"party_b_form",label:"subscription_form"},{anchorId:"party_b_wire",label:"wire_instructions"},{anchorId:"party_b",label:"main_agreement"},{anchorId:"party_b_tcs",label:"tcs"}]:"party_c"===e?[{anchorId:"party_c",label:"main_agreement"},{anchorId:"party_c_tcs",label:"tcs"}]:(console.warn(`‚ö†Ô∏è [ANCHOR] Unknown position: ${e}`),[])}(t,r),i=[];for(let a of(console.log(`üìç [PLACEMENT] Calculating placements for ${t} (${r}, anchor-based Y)...`),n)){let n=e.find(e=>e.anchorId===a.anchorId);if(n){let e="introducer_agreement"===r?n.xPercent:function(e,t,r="subscription"){return e.startsWith("party_a")?"subscription_form"===t?.63:.29:"party_b"===e?"tcs"===t?.43:"main_agreement"===t?.29:"subscription_form"===t?.2:.25:"party_c"===e&&"tcs"===t?.43:.29}(t,a.label,r),s=function(e,t,r="subscription"){let{metadata:n}=o.SIGNATURE_CONFIG.pdf,i="wire_instructions"===t?14:n.signerNameOffsetY;return e.rawY+i+4}(n,a.label,r);console.log(`   üîç [ANCHOR] ${a.anchorId} on page ${n.pageNumber}`),console.log(`      Anchor position (for reference): (${n.rawX.toFixed(0)}pt, ${n.rawY.toFixed(0)}pt)`),console.log(`   üìç [PLACEMENT] ${t} -> page ${n.pageNumber}`),console.log(`      FIXED X: ${(100*e).toFixed(0)}% | ANCHOR Y: ${s.toFixed(0)}pt (${a.label})`),i.push({page:n.pageNumber,x:e,y:s,label:a.label}),console.log(`   ‚úì ${a.anchorId} -> page ${n.pageNumber}, x=${(100*e).toFixed(0)}%, y=${s.toFixed(0)}pt (${a.label})`)}else console.warn(`   ‚ö†Ô∏è Anchor not found: ${a.anchorId} (expected for ${t})`)}return console.log(`‚úÖ [PLACEMENT] Created ${i.length} placement(s) for ${t}`),i}function s(e){let t=["party_a"];for(let r=1;r<=e;r++){let e=1===r?"party_b":`party_b_${r}`;t.push(e)}return t}e.s(["detectAnchors",()=>n,"getPlacementsFromAnchors",()=>a,"getRequiredAnchorsForIntroducerAgreement",()=>s,"validateRequiredAnchors",()=>i])},261365,e=>{e.v(e=>Promise.resolve().then(()=>e(368899)))},908258,e=>{e.v(t=>Promise.all(["server/chunks/6d6b6_pdfjs-dist_legacy_build_pdf_mjs_b9aeef59._.js"].map(t=>e.l(t))).then(()=>t(217503)))},485685,e=>{e.v(e=>Promise.resolve().then(()=>e(254799)))}];

//# sourceMappingURL=%5Broot-of-the-server%5D__64de6adf._.js.map