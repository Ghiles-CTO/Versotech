module.exports=[828169,e=>{"use strict";var t=e.i(779444),r=e.i(698261),i=e.i(821776),o=e.i(796417),n=e.i(856890),a=e.i(26996),s=e.i(436944),l=e.i(88281),c=e.i(765944),d=e.i(984788),u=e.i(237011),p=e.i(712007),m=e.i(777657),f=e.i(13180),g=e.i(273827),y=e.i(193695);e.i(947956);var b=e.i(36217),_=e.i(414131),h=e.i(433669);let v={questionnaire:{label:"KYC Questionnaire",description:"Investor questionnaire responses",category:"both"},nda_ndnc:{label:"NDA / NDNC",description:"Non-Disclosure and Non-Circumvention Agreement",category:"entity"},incorporation_certificate:{label:"Incorporation Certificate",description:"Certificate of Incorporation",category:"entity"},memo_articles:{label:"Memo & Articles of Association",description:"Memorandum and Articles of Association",category:"entity"},certificate_of_good_standing:{label:"Certificate of Good Standing",description:"Certificate confirming entity is in good standing with registry",category:"entity"},certificate_of_incumbency:{label:"Certificate of Incumbency",description:"Certificate listing current directors and officers",category:"entity"},company_register_extract:{label:"Company Register Extract",description:"Official extract from company registry",category:"entity"},partnership_agreement:{label:"Partnership Agreement",description:"Limited Partnership or General Partnership Agreement",category:"entity"},operating_agreement:{label:"Operating Agreement",description:"LLC Operating Agreement or equivalent",category:"entity"},register_members:{label:"Register of Members",description:"Current register of all members/shareholders",category:"entity"},register_directors:{label:"Register of Directors",description:"Current register of all directors",category:"entity"},register_beneficial_owners:{label:"Register of Beneficial Owners",description:"Register of ultimate beneficial owners (UBOs)",category:"entity"},directors_declaration:{label:"Directors Declaration",description:"Signed declaration from board of directors",category:"entity"},board_resolution:{label:"Board Resolution",description:"Board resolution authorizing investment or account opening",category:"entity"},authorized_signatory_list:{label:"Authorized Signatory List",description:"List of persons authorized to sign on behalf of entity",category:"entity"},power_of_attorney:{label:"Power of Attorney",description:"Power of Attorney document",category:"entity"},bank_confirmation:{label:"Bank Confirmation",description:"Confirmation of bank name and jurisdiction for wire transfers",category:"entity"},financial_statements:{label:"Financial Statements",description:"Audited Financial Statements",category:"entity"},beneficial_ownership:{label:"Beneficial Ownership Declaration",description:"Declaration of ultimate beneficial owners",category:"entity"},trust_deed:{label:"Trust Deed",description:"Trust Deed or Declaration of Trust",category:"entity"},trust_schedule:{label:"Trust Schedule",description:"Schedule of beneficiaries and settlors",category:"entity"},letter_of_wishes:{label:"Letter of Wishes",description:"Settlor letter of wishes",category:"entity"},passport_id:{label:"ID / Passport",description:"Valid government-issued ID or passport",category:"both"},passport:{label:"Passport",description:"Valid passport (photo page)",category:"both"},national_id_card:{label:"National ID Card",description:"Government-issued national identification card",category:"both"},drivers_license:{label:"Driver's License",description:"Government-issued driving license",category:"both"},residence_permit:{label:"Residence Permit",description:"Valid residence permit or visa",category:"both"},utility_bill:{label:"Utility Bill",description:"Recent utility bill (less than 3 months old)",category:"both"},bank_statement:{label:"Bank Statement",description:"Recent bank statement (less than 3 months old)",category:"both"},proof_of_address:{label:"Proof of Address",description:"Recent utility bill, bank statement, or official letter",category:"both"},government_correspondence:{label:"Government Correspondence",description:"Recent letter from government agency with address",category:"both"},council_tax_bill:{label:"Council Tax Bill",description:"Council tax or property tax statement",category:"both"},accreditation_letter:{label:"Accreditation Letter",description:"Accredited Investor verification letter",category:"individual"},professional_qualification:{label:"Professional Qualification",description:"Professional investor qualification or certification",category:"individual"},sophistication_declaration:{label:"Sophistication Declaration",description:"Self-certification as sophisticated investor",category:"individual"},tax_w8_ben:{label:"W-8BEN / W-8BEN-E",description:"IRS form for foreign persons/entities",category:"both"},tax_w9:{label:"W-9",description:"IRS form for US persons",category:"individual"},tax_return:{label:"Tax Return",description:"Recent tax return or tax filing",category:"both"},tax_residency_certificate:{label:"Tax Residency Certificate",description:"Certificate of tax residency from tax authority",category:"both"},source_of_funds:{label:"Source of Funds",description:"Source of Funds Declaration",category:"both"},source_of_wealth:{label:"Source of Wealth",description:"Source of Wealth Declaration",category:"both"},employment_letter:{label:"Employment Letter",description:"Letter confirming employment and salary",category:"individual"},business_ownership_proof:{label:"Business Ownership Proof",description:"Documentation proving business ownership",category:"both"},introducer_agreement:{label:"Introducer Agreement",description:"Signed introducer/referral agreement",category:"entity"},fee_agreement:{label:"Fee Agreement",description:"Signed fee sharing or commission agreement",category:"entity"},regulatory_license:{label:"Regulatory License",description:"Financial services or regulatory license",category:"entity"},professional_indemnity_insurance:{label:"Professional Indemnity Insurance",description:"Certificate of professional indemnity insurance",category:"entity"},practicing_certificate:{label:"Practicing Certificate",description:"Current practicing certificate from bar association",category:"entity"},bar_membership:{label:"Bar Membership",description:"Bar association membership certificate",category:"entity"},law_firm_letterhead:{label:"Law Firm Letterhead",description:"Official letterhead confirming association",category:"entity"},member_passport:{label:"Member Passport/ID",description:"Passport or ID for director/UBO/signatory",category:"both",memberOnly:!0},member_proof_of_address:{label:"Member Proof of Address",description:"Proof of address for director/UBO/signatory",category:"both",memberOnly:!0},specimen_signature:{label:"Specimen Signature",description:"Specimen signature for authorized signatory",category:"both",memberOnly:!0},other:{label:"Other Document",description:"Any other supporting document",category:"both"}},R=[{value:"passport",label:"Passport",description:"Valid passport (photo page)"},{value:"utility_bill",label:"Utility Bill / Proof of Address",description:"Recent utility bill or bank statement (less than 3 months)"}],w=[{value:"incorporation_certificate",label:"Incorporation Certificate",description:"Certificate of Incorporation"},{value:"memo_articles",label:"Memo & Articles",description:"Memorandum and Articles of Association"},{value:"register_directors",label:"Register of Directors",description:"Current list of all directors"},{value:"register_members",label:"Register of Members/Shareholders",description:"Current list of shareholders"},{value:"register_beneficial_owners",label:"Register of UBOs",description:"List of beneficial owners (>25%)"},{value:"bank_confirmation",label:"Bank Confirmation Letter",description:"Bank details for wire transfers"}];var C=e.i(107854);let x=C.z.object({document_type:C.z.enum(["passport","utility_bill","incorporation_certificate","memo_articles","register_directors","register_members","register_beneficial_owners","bank_confirmation","other"],{message:"Invalid document type"}),custom_label:C.z.string().max(200,"Custom label must be less than 200 characters").regex(/^[^<>]*$/,"Custom label cannot contain HTML tags").optional(),metadata:C.z.record(C.z.string(),C.z.unknown()).optional(),status:C.z.enum(["draft","pending"]).optional().default("pending"),investor_member_id:C.z.string().uuid().optional()});async function A(e){try{let e=await (0,h.createClient)(),{data:{user:t},error:r}=await e.auth.getUser();if(r||!t)return _.NextResponse.json({error:"Unauthorized"},{status:401});let{data:i}=await e.from("investor_users").select("investor_id").eq("user_id",t.id);if(!i||0===i.length)return _.NextResponse.json({error:"No investor profile found"},{status:404});let o=i.map(e=>e.investor_id),{data:n,error:a}=await e.from("kyc_submissions").select(`
        *,
        document:documents(id, name, file_key, file_size_bytes, mime_type, created_at),
        reviewer:reviewed_by(display_name, email),
        investor_member:investor_member_id(id, full_name, role)
      `).in("investor_id",o).is("counterparty_entity_id",null).order("created_at",{ascending:!1});if(a)return console.error("Error fetching submissions:",a),_.NextResponse.json({error:"Failed to fetch KYC submissions"},{status:500});let{data:s}=await e.from("investors").select("id, type").in("id",o),l=s?.[0]?.type||"individual",c="individual"!==l,d=[];if(c&&o.length>0){let{data:r}=await e.from("investor_members").select("id, full_name, role").eq("investor_id",o[0]).eq("is_active",!0).order("full_name");d=r||[];let{data:i}=await e.from("investor_users").select("role, can_sign, is_primary").eq("user_id",t.id).eq("investor_id",o[0]).single();if(i&&(i.can_sign||"admin"===i.role||i.is_primary)){let{data:r}=await e.from("profiles").select("display_name, email").eq("id",t.id).single(),o=r?.display_name||r?.email||"Current User";d.some(e=>e.full_name?.toLowerCase()===o.toLowerCase())||d.unshift({id:`self_${t.id}`,full_name:`${o} (You)`,role:"admin"===i.role?"authorized_signatory":"signatory"})}}let u=c?[...w]:[...R],p={};n?.forEach(e=>{let t=e.document_type;p[t]||(p[t]=[]),p[t].push(e)});let m=(n||[]).map(e=>({...e,display_label:function(e,t){if(t)return t;let r=v[e];return r?.label||e.split("_").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" ")}(e.document_type,e.custom_label)}));return _.NextResponse.json({success:!0,submissions:m,grouped_submissions:p,suggested_documents:u,investor_type:l,is_entity_investor:c,investor_members:d,note:"Suggested documents are recommendations. You can upload any document type with a custom label."})}catch(e){return console.error("KYC submissions GET error:",e),_.NextResponse.json({error:"Internal server error"},{status:500})}}async function E(e){try{let t=await (0,h.createClient)(),{data:{user:r},error:i}=await t.auth.getUser();if(i||!r)return _.NextResponse.json({error:"Unauthorized"},{status:401});let{data:o}=await t.from("investor_users").select("investor_id").eq("user_id",r.id).single();if(!o)return _.NextResponse.json({error:"No investor profile found"},{status:404});let n=await e.json(),a=x.safeParse(n);if(!a.success)return _.NextResponse.json({error:a.error.issues[0]?.message||"Invalid input"},{status:400});let{document_type:s,custom_label:l,metadata:c,status:d,investor_member_id:u}=a.data,p=null,m=1,f=t.from("kyc_submissions").select("id, version").eq("investor_id",o.investor_id).eq("document_type",s).is("counterparty_entity_id",null).order("version",{ascending:!1}).limit(1);f=u?f.eq("investor_member_id",u):f.is("investor_member_id",null);let{data:g}=await f;g&&g.length>0&&(m=((p=g[0]).version||1)+1);let{data:y,error:b}=await t.from("kyc_submissions").insert({investor_id:o.investor_id,document_type:s,custom_label:l||null,metadata:c||null,status:d,investor_member_id:u||null,version:m,previous_submission_id:p?.id||null}).select().single();if(b)return console.error("Error creating submission:",b),_.NextResponse.json({error:"Failed to create submission"},{status:500});return _.NextResponse.json({success:!0,submission:y,is_new_version:m>1,version:m})}catch(e){return console.error("KYC submissions POST error:",e),_.NextResponse.json({error:"Internal server error"},{status:500})}}e.s(["GET",()=>A,"POST",()=>E],177538);var P=e.i(177538);let S=new t.AppRouteRouteModule({definition:{kind:r.RouteKind.APP_ROUTE,page:"/api/investors/me/kyc-submissions/route",pathname:"/api/investors/me/kyc-submissions",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/versotech-portal/src/app/api/investors/me/kyc-submissions/route.ts",nextConfigOutput:"",userland:P}),{workAsyncStorage:N,workUnitAsyncStorage:O,serverHooks:D}=S;function I(){return(0,i.patchFetch)({workAsyncStorage:N,workUnitAsyncStorage:O})}async function T(e,t,i){S.isDev&&(0,o.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let _="/api/investors/me/kyc-submissions/route";_=_.replace(/\/index$/,"")||"/";let h=await S.prepare(e,t,{srcPage:_,multiZoneDraftMode:!1});if(!h)return t.statusCode=400,t.end("Bad Request"),null==i.waitUntil||i.waitUntil.call(i,Promise.resolve()),null;let{buildId:v,params:R,nextConfig:w,parsedUrl:C,isDraftMode:x,prerenderManifest:A,routerServerContext:E,isOnDemandRevalidate:P,revalidateOnlyGenerated:N,resolvedPathname:O,clientReferenceManifest:D,serverActionsManifest:I}=h,T=(0,s.normalizeAppPath)(_),k=!!(A.dynamicRoutes[T]||A.routes[O]),q=async()=>((null==E?void 0:E.render404)?await E.render404(e,t,C,!1):t.end("This page could not be found"),null);if(k&&!x){let e=!!A.routes[O],t=A.dynamicRoutes[T];if(t&&!1===t.fallback&&!e){if(w.experimental.adapterPath)return await q();throw new y.NoFallbackError}}let U=null;!k||S.isDev||x||(U="/index"===(U=O)?"/":U);let B=!0===S.isDev||!k,L=k&&!B;I&&D&&(0,a.setManifestsSingleton)({page:_,clientReferenceManifest:D,serverActionsManifest:I});let j=e.method||"GET",M=(0,n.getTracer)(),z=M.getActiveScopeSpan(),H={params:R,prerenderManifest:A,renderOpts:{experimental:{authInterrupts:!!w.experimental.authInterrupts},cacheComponents:!!w.cacheComponents,supportsDynamicResponse:B,incrementalCache:(0,o.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:w.cacheLife,waitUntil:i.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,i,o)=>S.onRequestError(e,t,i,o,E)},sharedContext:{buildId:v}},F=new l.NodeNextRequest(e),K=new l.NodeNextResponse(t),$=c.NextRequestAdapter.fromNodeNextRequest(F,(0,c.signalFromNodeResponse)(t));try{let a=async e=>S.handle($,H).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=M.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==d.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let i=r.get("next.route");if(i){let t=`${j} ${i}`;e.setAttributes({"next.route":i,"http.route":i,"next.span_name":t}),e.updateName(t)}else e.updateName(`${j} ${_}`)}),s=!!(0,o.getRequestMeta)(e,"minimalMode"),l=async o=>{var n,l;let c=async({previousCacheEntry:r})=>{try{if(!s&&P&&N&&!r)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let n=await a(o);e.fetchMetrics=H.renderOpts.fetchMetrics;let l=H.renderOpts.pendingWaitUntil;l&&i.waitUntil&&(i.waitUntil(l),l=void 0);let c=H.renderOpts.collectedTags;if(!k)return await (0,p.sendResponse)(F,K,n,H.renderOpts.pendingWaitUntil),null;{let e=await n.blob(),t=(0,m.toNodeOutgoingHttpHeaders)(n.headers);c&&(t[g.NEXT_CACHE_TAGS_HEADER]=c),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==H.renderOpts.collectedRevalidate&&!(H.renderOpts.collectedRevalidate>=g.INFINITE_CACHE)&&H.renderOpts.collectedRevalidate,i=void 0===H.renderOpts.collectedExpire||H.renderOpts.collectedExpire>=g.INFINITE_CACHE?void 0:H.renderOpts.collectedExpire;return{value:{kind:b.CachedRouteKind.APP_ROUTE,status:n.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:i}}}}catch(t){throw(null==r?void 0:r.isStale)&&await S.onRequestError(e,t,{routerKind:"App Router",routePath:_,routeType:"route",revalidateReason:(0,u.getRevalidateReason)({isStaticGeneration:L,isOnDemandRevalidate:P})},!1,E),t}},d=await S.handleResponse({req:e,nextConfig:w,cacheKey:U,routeKind:r.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:A,isRoutePPREnabled:!1,isOnDemandRevalidate:P,revalidateOnlyGenerated:N,responseGenerator:c,waitUntil:i.waitUntil,isMinimalMode:s});if(!k)return null;if((null==d||null==(n=d.value)?void 0:n.kind)!==b.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==d||null==(l=d.value)?void 0:l.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});s||t.setHeader("x-nextjs-cache",P?"REVALIDATED":d.isMiss?"MISS":d.isStale?"STALE":"HIT"),x&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let y=(0,m.fromNodeOutgoingHttpHeaders)(d.value.headers);return s&&k||y.delete(g.NEXT_CACHE_TAGS_HEADER),!d.cacheControl||t.getHeader("Cache-Control")||y.get("Cache-Control")||y.set("Cache-Control",(0,f.getCacheControlHeader)(d.cacheControl)),await (0,p.sendResponse)(F,K,new Response(d.value.body,{headers:y,status:d.value.status||200})),null};z?await l(z):await M.withPropagatedContext(e.headers,()=>M.trace(d.BaseServerSpan.handleRequest,{spanName:`${j} ${_}`,kind:n.SpanKind.SERVER,attributes:{"http.method":j,"http.target":e.url}},l))}catch(t){if(t instanceof y.NoFallbackError||await S.onRequestError(e,t,{routerKind:"App Router",routePath:T,routeType:"route",revalidateReason:(0,u.getRevalidateReason)({isStaticGeneration:L,isOnDemandRevalidate:P})},!1,E),k)throw t;return await (0,p.sendResponse)(F,K,new Response(null,{status:500})),null}}e.s(["handler",()=>T,"patchFetch",()=>I,"routeModule",()=>S,"serverHooks",()=>D,"workAsyncStorage",()=>N,"workUnitAsyncStorage",()=>O],828169)}];

//# sourceMappingURL=6d6b6_next_dist_esm_build_templates_app-route_6b4874be.js.map