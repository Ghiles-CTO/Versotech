{"version":3,"sources":["../../../../versotech-portal/src/app/api/admin/workflows/route.ts","../../../../versotech-portal/src/lib/workflows.ts","../../../../versotech-portal/node_modules/next/dist/esm/build/templates/app-route.js"],"sourcesContent":["import { NextResponse } from 'next/server'\r\nimport { createServiceClient } from '@/lib/supabase/server'\r\nimport { getCurrentUser } from '@/lib/auth'\r\nimport { processWorkflows } from '@/lib/workflows'\r\n\r\nexport async function GET() {\r\n  try {\r\n    const user = await getCurrentUser()\r\n    if (!user) {\r\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })\r\n    }\r\n\r\n    const supabase = createServiceClient()\r\n\r\n    // Check if user is super admin\r\n    const { data: permission } = await supabase\r\n      .from('staff_permissions')\r\n      .select('permission')\r\n      .eq('user_id', user.id)\r\n      .eq('permission', 'super_admin')\r\n      .single()\r\n\r\n    if (!permission) {\r\n      return NextResponse.json({ error: 'Forbidden' }, { status: 403 })\r\n    }\r\n\r\n    // Fetch workflow configurations from database\r\n    const { data: workflowConfigs } = await supabase\r\n      .from('workflows')\r\n      .select('key, is_active')\r\n\r\n    const configMap = new Map(workflowConfigs?.map((w) => [w.key, w.is_active]) || [])\r\n\r\n    // Fetch workflow run statistics\r\n    const { data: runStats } = await supabase\r\n      .from('workflow_runs')\r\n      .select('workflow_key, status, duration_ms, created_at')\r\n      .gte('created_at', new Date(Date.now() - 30 * 24 * 60 * 60 * 1000).toISOString())\r\n\r\n    // Calculate stats per workflow\r\n    const statsMap: Record<\r\n      string,\r\n      {\r\n        total_runs: number\r\n        successful_runs: number\r\n        failed_runs: number\r\n        total_duration: number\r\n        last_run_at: string | null\r\n      }\r\n    > = {}\r\n\r\n    runStats?.forEach((run) => {\r\n      if (!statsMap[run.workflow_key]) {\r\n        statsMap[run.workflow_key] = {\r\n          total_runs: 0,\r\n          successful_runs: 0,\r\n          failed_runs: 0,\r\n          total_duration: 0,\r\n          last_run_at: null,\r\n        }\r\n      }\r\n\r\n      const stat = statsMap[run.workflow_key]\r\n      stat.total_runs++\r\n      if (run.status === 'completed') stat.successful_runs++\r\n      if (run.status === 'failed') stat.failed_runs++\r\n      if (run.duration_ms) stat.total_duration += run.duration_ms\r\n      if (!stat.last_run_at || run.created_at > stat.last_run_at) {\r\n        stat.last_run_at = run.created_at\r\n      }\r\n    })\r\n\r\n    // Build workflow list from definitions\r\n    const workflows = processWorkflows.map((def) => {\r\n      const stats = statsMap[def.key] || {\r\n        total_runs: 0,\r\n        successful_runs: 0,\r\n        failed_runs: 0,\r\n        total_duration: 0,\r\n        last_run_at: null,\r\n      }\r\n\r\n      return {\r\n        id: def.key,\r\n        key: def.key,\r\n        title: def.title,\r\n        category: def.category,\r\n        enabled: configMap.get(def.key) ?? true, // Read from DB, default to true\r\n        success_rate:\r\n          stats.total_runs > 0\r\n            ? Math.round((stats.successful_runs / stats.total_runs) * 100)\r\n            : 100,\r\n        total_runs: stats.total_runs,\r\n        successful_runs: stats.successful_runs,\r\n        failed_runs: stats.failed_runs,\r\n        last_run_at: stats.last_run_at,\r\n        avg_duration_ms:\r\n          stats.total_runs > 0 ? Math.round(stats.total_duration / stats.total_runs) : 0,\r\n      }\r\n    })\r\n\r\n    return NextResponse.json({\r\n      success: true,\r\n      data: {\r\n        workflows,\r\n      },\r\n    })\r\n  } catch (error) {\r\n    console.error('Workflows API error:', error)\r\n    return NextResponse.json({ error: 'Internal server error' }, { status: 500 })\r\n  }\r\n}\r\n","import { z } from 'zod'\n\nexport const workflowInputFieldSchema = z.object({\n  label: z.string().optional(),\n  type: z.enum(['text', 'email', 'number', 'date', 'datetime', 'select', 'checkbox', 'investor_select', 'vehicle_select', 'conversation_select']),\n  placeholder: z.string().optional(),\n  required: z.boolean().optional(),\n  options: z.array(z.union([z.string(), z.number()])).optional(),\n  helperText: z.string().optional(),\n  defaultValue: z.union([z.string(), z.boolean(), z.number()]).optional(),\n  dependsOn: z.string().optional(), // Field name that this field depends on\n  showWhen: z.union([z.string(), z.number(), z.boolean()]).optional() // Value that triggers this field to show\n})\n\nexport const workflowInputSchema = z.record(z.string(), workflowInputFieldSchema)\n\nexport type WorkflowInputSchema = z.infer<typeof workflowInputSchema>\n\nexport interface WorkflowDefinition {\n  key: string\n  title: string\n  description: string\n  detailedDescription?: string // Full description for drawer\n  icon: string\n  category: 'documents' | 'compliance' | 'communications' | 'data_processing' | 'multi_step'\n  triggerType: 'manual' | 'scheduled' | 'both'\n  requiredRole?: 'staff_admin' | 'staff_ops' | 'staff_rm'\n  requiredTitles?: string[]\n  inputSchema: WorkflowInputSchema\n}\n\nexport const processWorkflows: WorkflowDefinition[] = [\n  {\n    key: 'generate-position-statement',\n    title: 'Position Statement',\n    description: 'Generate investor position statements with current NAV, distributions, and performance metrics',\n    detailedDescription: 'Automatically generate comprehensive position statements for investors showing their current NAV, capital contributions, distributions received, and performance metrics across all vehicles or a specific fund. The statement will be generated as a PDF, watermarked, and ready for distribution.',\n    icon: 'BarChart3',\n    category: 'documents',\n    triggerType: 'manual',\n    requiredRole: 'staff_ops',\n    inputSchema: {\n      investor_id: {\n        label: 'Investor',\n        type: 'investor_select',\n        placeholder: 'Select investor',\n        required: true,\n        helperText: 'Choose the investor to generate the position statement for'\n      },\n      vehicle_id: {\n        label: 'Vehicle (Optional)',\n        type: 'vehicle_select',\n        placeholder: 'All vehicles or select specific vehicle',\n        helperText: 'Leave empty for all vehicles or select a specific fund'\n      },\n      as_of_date: {\n        label: 'As of Date',\n        type: 'date',\n        required: true,\n        helperText: 'The date for which to generate the position statement'\n      }\n    }\n  },\n  {\n    key: 'process-nda',\n    title: 'NDA Agent',\n    description: 'Automated NDA generation, DocuSign processing, and professional investor qualification',\n    detailedDescription: 'Streamline the NDA process with automated generation, DocuSign integration for e-signatures, and professional investor qualification checks. The workflow handles document creation, sending, tracking, and storage of signed NDAs.',\n    icon: 'FileText',\n    category: 'compliance',\n    triggerType: 'manual',\n    requiredRole: 'staff_rm',\n    inputSchema: {\n      series_number: {\n        label: 'Series Number',\n        type: 'text',\n        placeholder: 'VC206',\n        required: true,\n        helperText: 'Series identifier (e.g., VC206)'\n      },\n      project_description: {\n        label: 'Project Description',\n        type: 'text',\n        placeholder: 'VERSO Capital 2 SCSP Series 206',\n        required: true,\n        helperText: 'Full project/series description'\n      },\n      investment_description: {\n        label: 'Investment Description',\n        type: 'text',\n        placeholder: 'OPEN AI Primary Issuance July 2025',\n        required: true,\n        helperText: 'Description of the investment opportunity'\n      },\n      party_a_name: {\n        label: 'Party A Name',\n        type: 'text',\n        placeholder: 'Investor/Company Name',\n        required: true,\n        helperText: 'Name of the investor or company'\n      },\n      party_a_registered_address: {\n        label: 'Party A Address',\n        type: 'text',\n        placeholder: 'Full registered address',\n        required: true,\n        helperText: 'Registered address of Party A'\n      },\n      party_a_city_country: {\n        label: 'Party A City/Country',\n        type: 'text',\n        placeholder: 'City, Country Code',\n        required: true,\n        helperText: 'City and country (e.g., London, GB)'\n      },\n      party_a_representative_name: {\n        label: 'Party A Representative',\n        type: 'text',\n        placeholder: 'Representative Name',\n        required: true,\n        helperText: 'Name of authorized representative'\n      },\n      party_a_representative_title: {\n        label: 'Party A Rep. Title',\n        type: 'text',\n        placeholder: 'CEO, Director, etc.',\n        required: true,\n        helperText: 'Title of the representative'\n      },\n      party_b_name: {\n        label: 'Party B Name',\n        type: 'text',\n        placeholder: 'VERSO Capital 2 SCSP Series 206',\n        defaultValue: 'VERSO Capital 2 SCSP Series 206 (\"VC206\")',\n        helperText: 'VERSO entity name (pre-filled)'\n      },\n      party_b_registered_address: {\n        label: 'Party B Address',\n        type: 'text',\n        placeholder: '2, Avenue Charles de Gaulle – L-1653',\n        defaultValue: '2, Avenue Charles de Gaulle – L-1653',\n        helperText: 'VERSO registered address'\n      },\n      party_b_city_country: {\n        label: 'Party B City/Country',\n        type: 'text',\n        placeholder: 'Luxembourg, LU',\n        defaultValue: 'Luxembourg, LU',\n        helperText: 'VERSO city and country'\n      },\n      party_b_representative_name: {\n        label: 'Party B Representative',\n        type: 'text',\n        placeholder: 'Julien Machot',\n        defaultValue: 'Julien Machot',\n        helperText: 'VERSO representative name'\n      },\n      party_b_representative_title: {\n        label: 'Party B Rep. Title',\n        type: 'text',\n        placeholder: 'Managing Partner',\n        defaultValue: 'Managing Partner',\n        helperText: 'VERSO representative title'\n      },\n      dataroom_email: {\n        label: 'Data Room Email',\n        type: 'email',\n        placeholder: 'investor@example.com',\n        required: true,\n        helperText: 'Email for data room access'\n      },\n      execution_date: {\n        label: 'Execution Date',\n        type: 'date',\n        required: true,\n        helperText: 'Date of NDA execution'\n      },\n      zoho_sign_document_id: {\n        label: 'Zoho Sign Document ID',\n        type: 'text',\n        placeholder: 'Optional - auto-generated if empty',\n        helperText: 'Zoho Sign tracking ID (optional)'\n      }\n    }\n  },\n  {\n    key: 'shared-drive-notification',\n    title: 'Shared-Drive Notification',\n    description: 'Automatically notify investors when documents in shared drives are updated',\n    detailedDescription: 'Monitor shared drive folders for document changes and automatically notify relevant investors when new documents are uploaded or existing ones are updated. This ensures investors stay informed about important updates without manual intervention.',\n    icon: 'Database',\n    category: 'communications',\n    triggerType: 'scheduled',\n    requiredRole: 'staff_ops',\n    inputSchema: {\n      document_category: {\n        label: 'Document Category',\n        type: 'select',\n        options: ['legal', 'financial', 'marketing', 'compliance', 'reports'],\n        required: true,\n        helperText: 'Type of documents to monitor'\n      },\n      notification_group: {\n        label: 'Notification Group',\n        type: 'select',\n        options: ['investors', 'staff', 'compliance', 'all'],\n        required: true,\n        helperText: 'Who should be notified of changes'\n      }\n    }\n  },\n  {\n    key: 'inbox-manager',\n    title: 'Inbox Manager',\n    description: 'Intelligently process and route investor communications to appropriate teams',\n    detailedDescription: 'Automate inbox management by processing incoming emails or VERSOTECH messages, categorizing them based on content, and routing to the appropriate team members. Supports both email filtering and internal messaging workflows.',\n    icon: 'MessageSquare',\n    category: 'communications',\n    triggerType: 'both',\n    requiredRole: 'staff_ops',\n    inputSchema: {\n      inbox_type: {\n        label: 'Inbox Type',\n        type: 'select',\n        options: ['email', 'versotech_messaging'],\n        required: true,\n        helperText: 'Choose the type of inbox to process'\n      },\n      command: {\n        label: 'Command/Action',\n        type: 'text',\n        placeholder: 'e.g., \"route to compliance\", \"create task\"',\n        required: true,\n        helperText: 'Specify the action to perform on matched messages'\n      },\n      email_subject: {\n        label: 'Email Subject Filter',\n        type: 'text',\n        placeholder: 'Subject keywords to match',\n        dependsOn: 'inbox_type',\n        showWhen: 'email',\n        helperText: 'Filter emails by subject line'\n      },\n      conversation_id: {\n        label: 'Conversation',\n        type: 'conversation_select',\n        placeholder: 'Select conversation',\n        dependsOn: 'inbox_type',\n        showWhen: 'versotech_messaging',\n        helperText: 'Choose the conversation to apply the command to'\n      }\n    }\n  },\n  {\n    key: 'linkedin-leads-scraper',\n    title: 'LinkedIn Leads Scraper',\n    description: 'Identify and qualify potential high-net-worth investors and institutional clients',\n    detailedDescription: 'Scrape LinkedIn profiles based on search criteria to identify potential investors. The workflow extracts contact information, professional background, and qualifies leads based on specified parameters for targeted outreach campaigns.',\n    icon: 'Target',\n    category: 'data_processing',\n    triggerType: 'manual',\n    requiredRole: 'staff_rm',\n    inputSchema: {\n      search_url: {\n        label: 'LinkedIn Search URL',\n        type: 'text',\n        placeholder: 'https://www.linkedin.com/search/results/people/?...',\n        required: true,\n        helperText: 'Paste the full LinkedIn search URL with filters applied'\n      },\n      purpose: {\n        label: 'Campaign Purpose',\n        type: 'select',\n        options: ['linkedin_outreach', 'cold_email_campaign'],\n        required: true,\n        helperText: 'Select the intended use for the scraped leads'\n      }\n    }\n  },\n  {\n    key: 'reporting-agent',\n    title: 'Reporting Agent',\n    description: 'Generate comprehensive investor reports, compliance filings, and performance analytics',\n    detailedDescription: 'Automate the generation of investor reports including quarterly statements, annual reports, and compliance filings. Reports can be generated on-demand or scheduled for regular distribution, with support for both public and corporate reporting formats.',\n    icon: 'TrendingUp',\n    category: 'documents',\n    triggerType: 'both',\n    requiredRole: 'staff_rm',\n    inputSchema: {\n      report_category: {\n        label: 'Report Category',\n        type: 'select',\n        options: ['public', 'corporate', 'both'],\n        required: true,\n        helperText: 'Type of report to generate'\n      },\n      investor_id: {\n        label: 'Investor',\n        type: 'investor_select',\n        placeholder: 'Select investor',\n        required: true,\n        helperText: 'Choose the investor to generate the report for'\n      },\n      vehicle_id: {\n        label: 'Vehicle',\n        type: 'vehicle_select',\n        placeholder: 'Select vehicle',\n        required: true,\n        helperText: 'Choose the fund or vehicle for the report'\n      },\n      frequency: {\n        label: 'Report Frequency',\n        type: 'select',\n        options: ['one-time', 'monthly', 'quarterly', 'annual'],\n        required: true,\n        helperText: 'How often the report should be generated'\n      },\n      include_charts: {\n        label: 'Include Charts',\n        type: 'checkbox',\n        defaultValue: true,\n        helperText: 'Add visual charts and graphs to the report'\n      }\n    }\n  },\n  {\n    key: 'kyc-aml-processing',\n    title: 'KYC/AML Processing',\n    description: 'Enhanced due diligence for professional investor qualification and BVI FSC compliance',\n    detailedDescription: 'Perform comprehensive KYC (Know Your Customer) and AML (Anti-Money Laundering) checks with automated sanctions screening, beneficial ownership analysis, and professional investor verification. Ensures full BVI FSC regulatory compliance.',\n    icon: 'Shield',\n    category: 'compliance',\n    triggerType: 'manual',\n    requiredRole: 'staff_admin',\n    inputSchema: {\n      investor_id: {\n        label: 'Investor',\n        type: 'investor_select',\n        placeholder: 'Select investor',\n        required: true,\n        helperText: 'Choose the investor to perform KYC/AML checks on'\n      },\n      investor_type: {\n        label: 'Investor Type',\n        type: 'select',\n        options: ['individual', 'institution', 'corporate'],\n        required: true,\n        helperText: 'Classification of the investor'\n      },\n      jurisdiction: {\n        label: 'Jurisdiction',\n        type: 'text',\n        placeholder: 'e.g., United Kingdom, Cayman Islands',\n        required: true,\n        helperText: 'Legal jurisdiction of the investor'\n      },\n      enhanced_dd: {\n        label: 'Enhanced Due Diligence',\n        type: 'checkbox',\n        helperText: 'Perform additional enhanced due diligence checks'\n      }\n    }\n  },\n  {\n    key: 'capital-call-processing',\n    title: 'Capital Call Processing',\n    description: 'Generate capital call notices, wire instructions, and investor notifications',\n    detailedDescription: 'Automate the capital call process by generating notices, calculating wire instructions per investor, and sending notifications. The workflow handles document generation, email distribution, and tracking of investor responses.',\n    icon: 'Calendar',\n    category: 'communications',\n    triggerType: 'manual',\n    requiredRole: 'staff_admin',\n    requiredTitles: ['bizops'],\n    inputSchema: {\n      vehicle_id: {\n        label: 'Vehicle',\n        type: 'vehicle_select',\n        placeholder: 'Select vehicle',\n        required: true,\n        helperText: 'Choose the fund or vehicle for the capital call'\n      },\n      call_percentage: {\n        label: 'Call Percentage',\n        type: 'number',\n        placeholder: '30.00',\n        required: true,\n        helperText: 'Percentage of committed capital to call (e.g., 30 for 30%)'\n      },\n      due_date: {\n        label: 'Due Date',\n        type: 'date',\n        required: true,\n        helperText: 'Date by which capital must be received'\n      },\n      wire_deadline: {\n        label: 'Wire Deadline',\n        type: 'datetime',\n        required: true,\n        helperText: 'Specific date and time for wire transfer deadline'\n      }\n    }\n  },\n  {\n    key: 'investor-onboarding',\n    title: 'Investor Onboarding',\n    description: 'Complete investor onboarding flow: KYC → NDA → Subscription → First Funding',\n    detailedDescription: 'Execute the full investor onboarding sequence from initial KYC verification through NDA execution, subscription agreement signing, and first capital commitment. This multi-step workflow coordinates all required documentation and compliance checks.',\n    icon: 'Users',\n    category: 'multi_step',\n    triggerType: 'manual',\n    requiredRole: 'staff_ops',\n    inputSchema: {\n      investor_email: {\n        label: 'Investor Email',\n        type: 'email',\n        placeholder: 'investor@example.com',\n        required: true,\n        helperText: 'Primary email address for the new investor'\n      },\n      investment_amount: {\n        label: 'Initial Investment',\n        type: 'number',\n        placeholder: '1000000',\n        required: true,\n        helperText: 'Target investment amount in USD'\n      },\n      target_vehicle: {\n        label: 'Target Vehicle',\n        type: 'vehicle_select',\n        placeholder: 'Select vehicle',\n        required: true,\n        helperText: 'Fund or vehicle the investor will participate in'\n      },\n      investor_type: {\n        label: 'Investor Type',\n        type: 'select',\n        options: ['individual', 'institution', 'corporate'],\n        required: true,\n        helperText: 'Classification for KYC processing'\n      }\n    }\n  },\n  {\n    key: 'generate-subscription-pack',\n    title: 'Subscription Pack',\n    description: 'Generate subscription agreements, PPM, and onboarding documents for new investors',\n    detailedDescription: 'Automatically generate a complete subscription package including subscription agreements, Private Placement Memorandum (PPM), and all required onboarding documents. The package is tailored to the specific vehicle and investor type, ready for e-signature.',\n    icon: 'FileCheck',\n    category: 'documents',\n    triggerType: 'manual',\n    requiredRole: 'staff_ops',\n    inputSchema: {\n      investor_id: {\n        label: 'Investor',\n        type: 'investor_select',\n        placeholder: 'Select investor',\n        required: true,\n        helperText: 'Choose the investor for subscription pack generation'\n      },\n      vehicle_id: {\n        label: 'Vehicle',\n        type: 'vehicle_select',\n        placeholder: 'Select vehicle',\n        required: true,\n        helperText: 'Fund or vehicle for the subscription'\n      },\n      commitment_amount: {\n        label: 'Commitment Amount',\n        type: 'number',\n        placeholder: '1000000',\n        required: true,\n        helperText: 'Total commitment amount in USD'\n      },\n      include_ppm: {\n        label: 'Include PPM',\n        type: 'checkbox',\n        defaultValue: true,\n        helperText: 'Include Private Placement Memorandum'\n      }\n    }\n  },\n  {\n    key: 'generate-investment-certificate',\n    title: 'Investment Certificate',\n    description: 'Generate official investment certificates for fully funded subscriptions',\n    detailedDescription: 'Generate a professional investment certificate for investors who have fully funded their subscription. The certificate includes investment details, shares/units held, and is watermarked for security. Automatically triggered when subscriptions reach fully funded status.',\n    icon: 'Award',\n    category: 'documents',\n    triggerType: 'both',\n    requiredRole: 'staff_ops',\n    inputSchema: {\n      subscription_id: {\n        label: 'Subscription',\n        type: 'text',\n        placeholder: 'Subscription ID',\n        required: true,\n        helperText: 'The subscription to generate a certificate for'\n      },\n      investor_id: {\n        label: 'Investor',\n        type: 'investor_select',\n        placeholder: 'Select investor',\n        required: true,\n        helperText: 'The investor receiving the certificate'\n      },\n      vehicle_id: {\n        label: 'Vehicle',\n        type: 'vehicle_select',\n        placeholder: 'Select vehicle',\n        required: true,\n        helperText: 'The fund or vehicle for the certificate'\n      },\n      certificate_date: {\n        label: 'Certificate Date',\n        type: 'date',\n        required: true,\n        helperText: 'The date to display on the certificate'\n      },\n      include_watermark: {\n        label: 'Include Watermark',\n        type: 'checkbox',\n        defaultValue: true,\n        helperText: 'Add security watermark to the certificate'\n      }\n    }\n  }\n]\n\nexport const workflowDefinitionMap = new Map(\n  processWorkflows.map((workflow) => [workflow.key, workflow])\n)\n\n// Group workflows by category for the Process Center UI\nexport function getWorkflowsByCategory() {\n  const categories = {\n    documents: processWorkflows.filter(w => w.category === 'documents'),\n    compliance: processWorkflows.filter(w => w.category === 'compliance'),\n    communications: processWorkflows.filter(w => w.category === 'communications'),\n    data_processing: processWorkflows.filter(w => w.category === 'data_processing'),\n    multi_step: processWorkflows.filter(w => w.category === 'multi_step')\n  }\n  return categories\n}\n\n// Category metadata for display\nexport const categoryMetadata = {\n  documents: {\n    title: 'Document Generation',\n    description: 'Position statements, reports, and compliance filings',\n    icon: 'FileText',\n    gradient: 'from-blue-500/20 to-cyan-500/20'\n  },\n  compliance: {\n    title: 'Compliance & Verification',\n    description: 'KYC, AML screening, and regulatory checks',\n    icon: 'Shield',\n    gradient: 'from-green-500/20 to-emerald-500/20'\n  },\n  communications: {\n    title: 'Communications',\n    description: 'Inbox management, notifications, and investor outreach',\n    icon: 'MessageSquare',\n    gradient: 'from-purple-500/20 to-pink-500/20'\n  },\n  data_processing: {\n    title: 'Data Processing',\n    description: 'Lead generation, data enrichment, and analytics',\n    icon: 'Target',\n    gradient: 'from-orange-500/20 to-red-500/20'\n  },\n  multi_step: {\n    title: 'Multi-Step Workflows',\n    description: 'Complex orchestrated processes and onboarding',\n    icon: 'Users',\n    gradient: 'from-indigo-500/20 to-violet-500/20'\n  }\n} as const\n\n","import { AppRouteRouteModule } from \"next/dist/esm/server/route-modules/app-route/module.compiled\";\nimport { RouteKind } from \"next/dist/esm/server/route-kind\";\nimport { patchFetch as _patchFetch } from \"next/dist/esm/server/lib/patch-fetch\";\nimport { addRequestMeta, getRequestMeta } from \"next/dist/esm/server/request-meta\";\nimport { getTracer, SpanKind } from \"next/dist/esm/server/lib/trace/tracer\";\nimport { setManifestsSingleton } from \"next/dist/esm/server/app-render/manifests-singleton\";\nimport { normalizeAppPath } from \"next/dist/esm/shared/lib/router/utils/app-paths\";\nimport { NodeNextRequest, NodeNextResponse } from \"next/dist/esm/server/base-http/node\";\nimport { NextRequestAdapter, signalFromNodeResponse } from \"next/dist/esm/server/web/spec-extension/adapters/next-request\";\nimport { BaseServerSpan } from \"next/dist/esm/server/lib/trace/constants\";\nimport { getRevalidateReason } from \"next/dist/esm/server/instrumentation/utils\";\nimport { sendResponse } from \"next/dist/esm/server/send-response\";\nimport { fromNodeOutgoingHttpHeaders, toNodeOutgoingHttpHeaders } from \"next/dist/esm/server/web/utils\";\nimport { getCacheControlHeader } from \"next/dist/esm/server/lib/cache-control\";\nimport { INFINITE_CACHE, NEXT_CACHE_TAGS_HEADER } from \"next/dist/esm/lib/constants\";\nimport { NoFallbackError } from \"next/dist/esm/shared/lib/no-fallback-error.external\";\nimport { CachedRouteKind } from \"next/dist/esm/server/response-cache\";\nimport * as userland from \"INNER_APP_ROUTE\";\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new AppRouteRouteModule({\n    definition: {\n        kind: RouteKind.APP_ROUTE,\n        page: \"/api/admin/workflows/route\",\n        pathname: \"/api/admin/workflows\",\n        filename: \"route\",\n        bundlePath: \"\"\n    },\n    distDir: process.env.__NEXT_RELATIVE_DIST_DIR || '',\n    relativeProjectDir: process.env.__NEXT_RELATIVE_PROJECT_DIR || '',\n    resolvedPagePath: \"[project]/versotech-portal/src/app/api/admin/workflows/route.ts\",\n    nextConfigOutput,\n    userland\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { workAsyncStorage, workUnitAsyncStorage, serverHooks } = routeModule;\nfunction patchFetch() {\n    return _patchFetch({\n        workAsyncStorage,\n        workUnitAsyncStorage\n    });\n}\nexport { routeModule, workAsyncStorage, workUnitAsyncStorage, serverHooks, patchFetch,  };\nexport async function handler(req, res, ctx) {\n    if (routeModule.isDev) {\n        addRequestMeta(req, 'devRequestTimingInternalsEnd', process.hrtime.bigint());\n    }\n    let srcPage = \"/api/admin/workflows/route\";\n    // turbopack doesn't normalize `/index` in the page name\n    // so we need to to process dynamic routes properly\n    // TODO: fix turbopack providing differing value from webpack\n    if (process.env.TURBOPACK) {\n        srcPage = srcPage.replace(/\\/index$/, '') || '/';\n    } else if (srcPage === '/index') {\n        // we always normalize /index specifically\n        srcPage = '/';\n    }\n    const multiZoneDraftMode = process.env.__NEXT_MULTI_ZONE_DRAFT_MODE;\n    const prepareResult = await routeModule.prepare(req, res, {\n        srcPage,\n        multiZoneDraftMode\n    });\n    if (!prepareResult) {\n        res.statusCode = 400;\n        res.end('Bad Request');\n        ctx.waitUntil == null ? void 0 : ctx.waitUntil.call(ctx, Promise.resolve());\n        return null;\n    }\n    const { buildId, params, nextConfig, parsedUrl, isDraftMode, prerenderManifest, routerServerContext, isOnDemandRevalidate, revalidateOnlyGenerated, resolvedPathname, clientReferenceManifest, serverActionsManifest } = prepareResult;\n    const normalizedSrcPage = normalizeAppPath(srcPage);\n    let isIsr = Boolean(prerenderManifest.dynamicRoutes[normalizedSrcPage] || prerenderManifest.routes[resolvedPathname]);\n    const render404 = async ()=>{\n        // TODO: should route-module itself handle rendering the 404\n        if (routerServerContext == null ? void 0 : routerServerContext.render404) {\n            await routerServerContext.render404(req, res, parsedUrl, false);\n        } else {\n            res.end('This page could not be found');\n        }\n        return null;\n    };\n    if (isIsr && !isDraftMode) {\n        const isPrerendered = Boolean(prerenderManifest.routes[resolvedPathname]);\n        const prerenderInfo = prerenderManifest.dynamicRoutes[normalizedSrcPage];\n        if (prerenderInfo) {\n            if (prerenderInfo.fallback === false && !isPrerendered) {\n                if (nextConfig.experimental.adapterPath) {\n                    return await render404();\n                }\n                throw new NoFallbackError();\n            }\n        }\n    }\n    let cacheKey = null;\n    if (isIsr && !routeModule.isDev && !isDraftMode) {\n        cacheKey = resolvedPathname;\n        // ensure /index and / is normalized to one key\n        cacheKey = cacheKey === '/index' ? '/' : cacheKey;\n    }\n    const supportsDynamicResponse = // If we're in development, we always support dynamic HTML\n    routeModule.isDev === true || // If this is not SSG or does not have static paths, then it supports\n    // dynamic HTML.\n    !isIsr;\n    // This is a revalidation request if the request is for a static\n    // page and it is not being resumed from a postponed render and\n    // it is not a dynamic RSC request then it is a revalidation\n    // request.\n    const isStaticGeneration = isIsr && !supportsDynamicResponse;\n    // Before rendering (which initializes component tree modules), we have to\n    // set the reference manifests to our global store so Server Action's\n    // encryption util can access to them at the top level of the page module.\n    if (serverActionsManifest && clientReferenceManifest) {\n        setManifestsSingleton({\n            page: srcPage,\n            clientReferenceManifest,\n            serverActionsManifest\n        });\n    }\n    const method = req.method || 'GET';\n    const tracer = getTracer();\n    const activeSpan = tracer.getActiveScopeSpan();\n    const context = {\n        params,\n        prerenderManifest,\n        renderOpts: {\n            experimental: {\n                authInterrupts: Boolean(nextConfig.experimental.authInterrupts)\n            },\n            cacheComponents: Boolean(nextConfig.cacheComponents),\n            supportsDynamicResponse,\n            incrementalCache: getRequestMeta(req, 'incrementalCache'),\n            cacheLifeProfiles: nextConfig.cacheLife,\n            waitUntil: ctx.waitUntil,\n            onClose: (cb)=>{\n                res.on('close', cb);\n            },\n            onAfterTaskError: undefined,\n            onInstrumentationRequestError: (error, _request, errorContext, silenceLog)=>routeModule.onRequestError(req, error, errorContext, silenceLog, routerServerContext)\n        },\n        sharedContext: {\n            buildId\n        }\n    };\n    const nodeNextReq = new NodeNextRequest(req);\n    const nodeNextRes = new NodeNextResponse(res);\n    const nextReq = NextRequestAdapter.fromNodeNextRequest(nodeNextReq, signalFromNodeResponse(res));\n    try {\n        const invokeRouteModule = async (span)=>{\n            return routeModule.handle(nextReq, context).finally(()=>{\n                if (!span) return;\n                span.setAttributes({\n                    'http.status_code': res.statusCode,\n                    'next.rsc': false\n                });\n                const rootSpanAttributes = tracer.getRootSpanAttributes();\n                // We were unable to get attributes, probably OTEL is not enabled\n                if (!rootSpanAttributes) {\n                    return;\n                }\n                if (rootSpanAttributes.get('next.span_type') !== BaseServerSpan.handleRequest) {\n                    console.warn(`Unexpected root span type '${rootSpanAttributes.get('next.span_type')}'. Please report this Next.js issue https://github.com/vercel/next.js`);\n                    return;\n                }\n                const route = rootSpanAttributes.get('next.route');\n                if (route) {\n                    const name = `${method} ${route}`;\n                    span.setAttributes({\n                        'next.route': route,\n                        'http.route': route,\n                        'next.span_name': name\n                    });\n                    span.updateName(name);\n                } else {\n                    span.updateName(`${method} ${srcPage}`);\n                }\n            });\n        };\n        const isMinimalMode = Boolean(process.env.MINIMAL_MODE || getRequestMeta(req, 'minimalMode'));\n        const handleResponse = async (currentSpan)=>{\n            var _cacheEntry_value;\n            const responseGenerator = async ({ previousCacheEntry })=>{\n                try {\n                    if (!isMinimalMode && isOnDemandRevalidate && revalidateOnlyGenerated && !previousCacheEntry) {\n                        res.statusCode = 404;\n                        // on-demand revalidate always sets this header\n                        res.setHeader('x-nextjs-cache', 'REVALIDATED');\n                        res.end('This page could not be found');\n                        return null;\n                    }\n                    const response = await invokeRouteModule(currentSpan);\n                    req.fetchMetrics = context.renderOpts.fetchMetrics;\n                    let pendingWaitUntil = context.renderOpts.pendingWaitUntil;\n                    // Attempt using provided waitUntil if available\n                    // if it's not we fallback to sendResponse's handling\n                    if (pendingWaitUntil) {\n                        if (ctx.waitUntil) {\n                            ctx.waitUntil(pendingWaitUntil);\n                            pendingWaitUntil = undefined;\n                        }\n                    }\n                    const cacheTags = context.renderOpts.collectedTags;\n                    // If the request is for a static response, we can cache it so long\n                    // as it's not edge.\n                    if (isIsr) {\n                        const blob = await response.blob();\n                        // Copy the headers from the response.\n                        const headers = toNodeOutgoingHttpHeaders(response.headers);\n                        if (cacheTags) {\n                            headers[NEXT_CACHE_TAGS_HEADER] = cacheTags;\n                        }\n                        if (!headers['content-type'] && blob.type) {\n                            headers['content-type'] = blob.type;\n                        }\n                        const revalidate = typeof context.renderOpts.collectedRevalidate === 'undefined' || context.renderOpts.collectedRevalidate >= INFINITE_CACHE ? false : context.renderOpts.collectedRevalidate;\n                        const expire = typeof context.renderOpts.collectedExpire === 'undefined' || context.renderOpts.collectedExpire >= INFINITE_CACHE ? undefined : context.renderOpts.collectedExpire;\n                        // Create the cache entry for the response.\n                        const cacheEntry = {\n                            value: {\n                                kind: CachedRouteKind.APP_ROUTE,\n                                status: response.status,\n                                body: Buffer.from(await blob.arrayBuffer()),\n                                headers\n                            },\n                            cacheControl: {\n                                revalidate,\n                                expire\n                            }\n                        };\n                        return cacheEntry;\n                    } else {\n                        // send response without caching if not ISR\n                        await sendResponse(nodeNextReq, nodeNextRes, response, context.renderOpts.pendingWaitUntil);\n                        return null;\n                    }\n                } catch (err) {\n                    // if this is a background revalidate we need to report\n                    // the request error here as it won't be bubbled\n                    if (previousCacheEntry == null ? void 0 : previousCacheEntry.isStale) {\n                        const silenceLog = false;\n                        await routeModule.onRequestError(req, err, {\n                            routerKind: 'App Router',\n                            routePath: srcPage,\n                            routeType: 'route',\n                            revalidateReason: getRevalidateReason({\n                                isStaticGeneration,\n                                isOnDemandRevalidate\n                            })\n                        }, silenceLog, routerServerContext);\n                    }\n                    throw err;\n                }\n            };\n            const cacheEntry = await routeModule.handleResponse({\n                req,\n                nextConfig,\n                cacheKey,\n                routeKind: RouteKind.APP_ROUTE,\n                isFallback: false,\n                prerenderManifest,\n                isRoutePPREnabled: false,\n                isOnDemandRevalidate,\n                revalidateOnlyGenerated,\n                responseGenerator,\n                waitUntil: ctx.waitUntil,\n                isMinimalMode\n            });\n            // we don't create a cacheEntry for ISR\n            if (!isIsr) {\n                return null;\n            }\n            if ((cacheEntry == null ? void 0 : (_cacheEntry_value = cacheEntry.value) == null ? void 0 : _cacheEntry_value.kind) !== CachedRouteKind.APP_ROUTE) {\n                var _cacheEntry_value1;\n                throw Object.defineProperty(new Error(`Invariant: app-route received invalid cache entry ${cacheEntry == null ? void 0 : (_cacheEntry_value1 = cacheEntry.value) == null ? void 0 : _cacheEntry_value1.kind}`), \"__NEXT_ERROR_CODE\", {\n                    value: \"E701\",\n                    enumerable: false,\n                    configurable: true\n                });\n            }\n            if (!isMinimalMode) {\n                res.setHeader('x-nextjs-cache', isOnDemandRevalidate ? 'REVALIDATED' : cacheEntry.isMiss ? 'MISS' : cacheEntry.isStale ? 'STALE' : 'HIT');\n            }\n            // Draft mode should never be cached\n            if (isDraftMode) {\n                res.setHeader('Cache-Control', 'private, no-cache, no-store, max-age=0, must-revalidate');\n            }\n            const headers = fromNodeOutgoingHttpHeaders(cacheEntry.value.headers);\n            if (!(isMinimalMode && isIsr)) {\n                headers.delete(NEXT_CACHE_TAGS_HEADER);\n            }\n            // If cache control is already set on the response we don't\n            // override it to allow users to customize it via next.config\n            if (cacheEntry.cacheControl && !res.getHeader('Cache-Control') && !headers.get('Cache-Control')) {\n                headers.set('Cache-Control', getCacheControlHeader(cacheEntry.cacheControl));\n            }\n            await sendResponse(nodeNextReq, nodeNextRes, // @ts-expect-error - Argument of type 'Buffer<ArrayBufferLike>' is not assignable to parameter of type 'BodyInit | null | undefined'.\n            new Response(cacheEntry.value.body, {\n                headers,\n                status: cacheEntry.value.status || 200\n            }));\n            return null;\n        };\n        // TODO: activeSpan code path is for when wrapped by\n        // next-server can be removed when this is no longer used\n        if (activeSpan) {\n            await handleResponse(activeSpan);\n        } else {\n            await tracer.withPropagatedContext(req.headers, ()=>tracer.trace(BaseServerSpan.handleRequest, {\n                    spanName: `${method} ${srcPage}`,\n                    kind: SpanKind.SERVER,\n                    attributes: {\n                        'http.method': method,\n                        'http.target': req.url\n                    }\n                }, handleResponse));\n        }\n    } catch (err) {\n        if (!(err instanceof NoFallbackError)) {\n            const silenceLog = false;\n            await routeModule.onRequestError(req, err, {\n                routerKind: 'App Router',\n                routePath: normalizedSrcPage,\n                routeType: 'route',\n                revalidateReason: getRevalidateReason({\n                    isStaticGeneration,\n                    isOnDemandRevalidate\n                })\n            }, silenceLog, routerServerContext);\n        }\n        // rethrow so that we can handle serving error page\n        // If this is during static generation, throw the error again.\n        if (isIsr) throw err;\n        // Otherwise, send a 500 response.\n        await sendResponse(nodeNextReq, nodeNextRes, new Response(null, {\n            status: 500\n        }));\n        return null;\n    }\n}\n\n//# sourceMappingURL=app-route.js.map\n"],"names":[],"mappings":"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A,2BAA4B,CAC1B,MAAO,kBACP,KAAM,OACN,YAAa,uCACb,aAAc,uCACd,WAAY,0BACd,EACA,qBAAsB,CACpB,MAAO,uBACP,KAAM,OACN,YAAa,iBACb,aAAc,iBACd,WAAY,wBACd,EACA,4BAA6B,CAC3B,MAAO,yBACP,KAAM,OACN,YAAa,gBACb,aAAc,gBACd,WAAY,2BACd,EACA,6BAA8B,CAC5B,MAAO,qBACP,KAAM,OACN,YAAa,mBACb,aAAc,mBACd,WAAY,4BACd,EACA,eAAgB,CACd,MAAO,kBACP,KAAM,QACN,YAAa,uBACb,UAAU,EACV,WAAY,4BACd,EACA,eAAgB,CACd,MAAO,iBACP,KAAM,OACN,UAAU,EACV,WAAY,uBACd,EACA,sBAAuB,CACrB,MAAO,wBACP,KAAM,OACN,YAAa,qCACb,WAAY,kCACd,CACF,CACF,EACA,CACE,IAAK,4BACL,MAAO,4BACP,YAAa,6EACb,oBAAqB,wPACrB,KAAM,WACN,SAAU,iBACV,YAAa,YACb,aAAc,YACd,YAAa,CACX,kBAAmB,CACjB,MAAO,oBACP,KAAM,SACN,QAAS,CAAC,QAAS,YAAa,YAAa,aAAc,UAAU,CACrE,UAAU,EACV,WAAY,8BACd,EACA,mBAAoB,CAClB,MAAO,qBACP,KAAM,SACN,QAAS,CAAC,YAAa,QAAS,aAAc,MAAM,CACpD,UAAU,EACV,WAAY,mCACd,CACF,CACF,EACA,CACE,IAAK,gBACL,MAAO,gBACP,YAAa,+EACb,oBAAqB,kOACrB,KAAM,gBACN,SAAU,iBACV,YAAa,OACb,aAAc,YACd,YAAa,CACX,WAAY,CACV,MAAO,aACP,KAAM,SACN,QAAS,CAAC,QAAS,sBAAsB,CACzC,UAAU,EACV,WAAY,qCACd,EACA,QAAS,CACP,MAAO,iBACP,KAAM,OACN,YAAa,6CACb,UAAU,EACV,WAAY,mDACd,EACA,cAAe,CACb,MAAO,uBACP,KAAM,OACN,YAAa,4BACb,UAAW,aACX,SAAU,QACV,WAAY,+BACd,EACA,gBAAiB,CACf,MAAO,eACP,KAAM,sBACN,YAAa,sBACb,UAAW,aACX,SAAU,sBACV,WAAY,iDACd,CACF,CACF,EACA,CACE,IAAK,yBACL,MAAO,yBACP,YAAa,oFACb,oBAAqB,4OACrB,KAAM,SACN,SAAU,kBACV,YAAa,SACb,aAAc,WACd,YAAa,CACX,WAAY,CACV,MAAO,sBACP,KAAM,OACN,YAAa,sDACb,UAAU,EACV,WAAY,yDACd,EACA,QAAS,CACP,MAAO,mBACP,KAAM,SACN,QAAS,CAAC,oBAAqB,sBAAsB,CACrD,UAAU,EACV,WAAY,+CACd,CACF,CACF,EACA,CACE,IAAK,kBACL,MAAO,kBACP,YAAa,yFACb,oBAAqB,8PACrB,KAAM,aACN,SAAU,YACV,YAAa,OACb,aAAc,WACd,YAAa,CACX,gBAAiB,CACf,MAAO,kBACP,KAAM,SACN,QAAS,CAAC,SAAU,YAAa,OAAO,CACxC,UAAU,EACV,WAAY,4BACd,EACA,YAAa,CACX,MAAO,WACP,KAAM,kBACN,YAAa,kBACb,UAAU,EACV,WAAY,gDACd,EACA,WAAY,CACV,MAAO,UACP,KAAM,iBACN,YAAa,iBACb,UAAU,EACV,WAAY,2CACd,EACA,UAAW,CACT,MAAO,mBACP,KAAM,SACN,QAAS,CAAC,WAAY,UAAW,YAAa,SAAS,CACvD,UAAU,EACV,WAAY,0CACd,EACA,eAAgB,CACd,MAAO,iBACP,KAAM,WACN,cAAc,EACd,WAAY,4CACd,CACF,CACF,EACA,CACE,IAAK,qBACL,MAAO,qBACP,YAAa,wFACb,oBAAqB,+OACrB,KAAM,SACN,SAAU,aACV,YAAa,SACb,aAAc,cACd,YAAa,CACX,YAAa,CACX,MAAO,WACP,KAAM,kBACN,YAAa,kBACb,UAAU,EACV,WAAY,kDACd,EACA,cAAe,CACb,MAAO,gBACP,KAAM,SACN,QAAS,CAAC,aAAc,cAAe,YAAY,CACnD,UAAU,EACV,WAAY,gCACd,EACA,aAAc,CACZ,MAAO,eACP,KAAM,OACN,YAAa,uCACb,SAAU,GACV,WAAY,oCACd,EACA,YAAa,CACX,MAAO,yBACP,KAAM,WACN,WAAY,kDACd,CACF,CACF,EACA,CACE,IAAK,0BACL,MAAO,0BACP,YAAa,+EACb,oBAAqB,oOACrB,KAAM,WACN,SAAU,iBACV,YAAa,SACb,aAAc,cACd,eAAgB,CAAC,SAAS,CAC1B,YAAa,CACX,WAAY,CACV,MAAO,UACP,KAAM,iBACN,YAAa,iBACb,UAAU,EACV,WAAY,iDACd,EACA,gBAAiB,CACf,MAAO,kBACP,KAAM,SACN,YAAa,QACb,UAAU,EACV,WAAY,4DACd,EACA,SAAU,CACR,MAAO,WACP,KAAM,OACN,UAAU,EACV,WAAY,wCACd,EACA,cAAe,CACb,MAAO,gBACP,KAAM,WACN,UAAU,EACV,WAAY,mDACd,CACF,CACF,EACA,CACE,IAAK,sBACL,MAAO,sBACP,YAAa,8EACb,oBAAqB,0PACrB,KAAM,QACN,SAAU,aACV,YAAa,SACb,aAAc,YACd,YAAa,CACX,eAAgB,CACd,MAAO,iBACP,KAAM,QACN,YAAa,uBACb,UAAU,EACV,WAAY,4CACd,EACA,kBAAmB,CACjB,MAAO,qBACP,KAAM,SACN,YAAa,UACb,UAAU,EACV,WAAY,iCACd,EACA,eAAgB,CACd,MAAO,iBACP,KAAM,iBACN,YAAa,iBACb,UAAU,EACV,WAAY,kDACd,EACA,cAAe,CACb,MAAO,gBACP,KAAM,SACN,QAAS,CAAC,aAAc,cAAe,YAAY,CACnD,UAAU,EACV,WAAY,mCACd,CACF,CACF,EACA,CACE,IAAK,6BACL,MAAO,oBACP,YAAa,oFACb,oBAAqB,iQACrB,KAAM,YACN,SAAU,YACV,YAAa,SACb,aAAc,YACd,YAAa,CACX,YAAa,CACX,MAAO,WACP,KAAM,kBACN,YAAa,kBACb,UAAU,EACV,WAAY,sDACd,EACA,WAAY,CACV,MAAO,UACP,KAAM,iBACN,YAAa,iBACb,UAAU,EACV,WAAY,sCACd,EACA,kBAAmB,CACjB,MAAO,oBACP,KAAM,SACN,YAAa,UACb,UAAU,EACV,WAAY,gCACd,EACA,YAAa,CACX,MAAO,cACP,KAAM,WACN,cAAc,EACd,WAAY,sCACd,CACF,CACF,EACA,CACE,IAAK,kCACL,MAAO,yBACP,YAAa,2EACb,oBAAqB,gRACrB,KAAM,QACN,SAAU,YAC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","ignoreList":[2]}