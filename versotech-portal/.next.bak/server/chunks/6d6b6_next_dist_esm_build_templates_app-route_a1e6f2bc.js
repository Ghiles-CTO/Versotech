module.exports=[932142,e=>{"use strict";var t=e.i(779444),r=e.i(698261),n=e.i(821776),a=e.i(796417),i=e.i(856890),o=e.i(26996),s=e.i(436944),l=e.i(88281),d=e.i(765944),c=e.i(984788),u=e.i(237011),_=e.i(712007),p=e.i(777657),m=e.i(13180),g=e.i(273827),f=e.i(193695);e.i(947956);var h=e.i(36217),y=e.i(414131),v=e.i(433669),w=e.i(751966),b=e.i(411164);function x(e){return null==e?"USD 0.00":`USD ${e.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`}async function R(t,{params:r}){try{var n;let t,a,i,o=await (0,v.createClient)(),{id:s}=await r,{data:{user:l}}=await o.auth.getUser();if(!l)return y.NextResponse.json({error:"Unauthorized"},{status:401});let{data:d}=await o.from("profiles").select("display_name, role, title").eq("id",l.id).single(),{data:c,error:u}=await o.from("fee_plans").select(`
        *,
        fee_components (*),
        introducer:introducer_id (
          id,
          legal_name,
          contact_name,
          email,
          address_line_1,
          address_line_2,
          city,
          state_province,
          postal_code,
          country,
          default_commission_bps,
          type
        ),
        deal:deal_id (
          id,
          name,
          company_name,
          offer_unit_price,
          arranger_entity_id,
          vehicle_id
        )
      `).eq("id",s).single();if(u||!c)return y.NextResponse.json({error:"Fee plan not found"},{status:404});if(!c.introducer_id)return y.NextResponse.json({error:"Fee plan is not linked to an introducer"},{status:400});if(c.partner_id)return y.NextResponse.json({error:"This endpoint is for introducer agreements. Use generate-placement-agreement for partner fee plans."},{status:400});if(c.generated_agreement_id)return y.NextResponse.json({error:"Agreement already generated for this fee plan"},{status:400});let _=c.fee_components?.find(e=>"subscription"===e.kind),p=c.fee_components?.find(e=>"performance"===e.kind),m=_?.rate_bps||0,g=p?.rate_bps||0,f=p?.hurdle_rate_bps||null,h=p?.has_no_cap===!1,R=h?p?.performance_cap_percent:null,S=_?.payment_days_after_event||3,$=p?.payment_days_after_event||10,E=f?`${(f/100).toFixed(2)}% hurdle rate`:"no hurdle rate",F=h&&R?`${R}% cap`:"no cap",C=`Introduction Fee: ${S} business days after completion. Performance Fee (${E}, ${F}): ${$} business days after redemption.`,A=c.agreement_duration_months?new Date(Date.now()+30*c.agreement_duration_months*864e5).toISOString().split("T")[0]:null,I=new Date,P=I.toISOString().slice(0,10).replace(/-/g,""),{count:O}=await o.from("introducer_agreements").select("*",{count:"exact",head:!0}).gte("created_at",I.toISOString().split("T")[0]),D=String((O||0)+1).padStart(3,"0"),k=`${P}${D}`,N=c.deal?.arranger_entity_id||null,T=c.deal?.vehicle_id||null,U=null;if(T){let{data:e}=await o.from("vehicles").select(`
          name,
          domicile,
          address,
          registration_number,
          legal_jurisdiction,
          issuer_gp_name,
          issuer_gp_description,
          issuer_gp_address,
          issuer_gp_rcc_number
        `).eq("id",T).single();U=e}let q=null;if(N){let{data:e}=await o.from("arranger_entities").select("legal_name, address, registration_number, city, country").eq("id",N).single();q=e}let{data:L}=await o.from("subscriptions").select(`
        commitment,
        num_shares,
        bd_fee_percent,
        bd_fee_amount,
        investor:investor_id (
          legal_name
        )
      `).eq("introducer_id",c.introducer_id).eq("deal_id",c.deal_id).in("status",["signed","funded","active"]),j=(L||[]).map(e=>{var t;return`
      <tr>
        <td>${e.investor?.legal_name||"Unknown Investor"}</td>
        <td>${x(e.commitment)}</td>
        <td>${e.bd_fee_percent?e.bd_fee_percent+"%":""}</td>
        <td>${null==(t=e.num_shares)?"0":t.toLocaleString("en-US")}</td>
        <td>${x(e.bd_fee_amount)}</td>
      </tr>
    `}).join(""),H=(L||[]).reduce((e,t)=>e+(t.commitment||0),0),B=(L||[]).reduce((e,t)=>e+(t.bd_fee_amount||0),0),M=`
      <tr class="totals-row">
        <td><strong>TOTALS</strong></td>
        <td><strong>${x(H)}</strong></td>
        <td></td>
        <td></td>
        <td><strong>${x(B)}</strong></td>
      </tr>
    `,K=(L||[]).length>0?j+M:'<tr><td colspan="5" style="text-align:center; font-style:italic;">No subscriptions completed yet</td></tr>',V=c.introducer?.type||"entity",z="entity"===V,G="individual"===V,W=c.introducer,{data:X,error:Z}=await o.from("introducer_users").select(`
        user_id,
        role,
        is_primary,
        can_sign,
        profiles:user_id (
          display_name,
          email
        )
      `).eq("introducer_id",c.introducer_id).eq("can_sign",!0).order("is_primary",{ascending:!1});Z&&console.error("Error fetching introducer signatories:",Z);let J=(X||[]).map((e,t)=>{let r=Array.isArray(e.profiles)?e.profiles[0]:e.profiles;return{name:r?.display_name||W?.contact_name||W?.legal_name||`Signatory ${t+1}`}}).slice(0,5);(X||[]).length>5&&console.warn(`âš ï¸ Introducer has more than 5 signatories; extra signers will not be included in the agreement.`),0===J.length&&J.push({name:W?.contact_name||W?.legal_name||"Introducer"});let Q="position:absolute;left:50%;top:0;font-size:1px;line-height:1px;color:#ffffff;opacity:0.01;transform:translateX(-50%);",Y=z?J.map((e,t)=>{let r=t+1,n=1===r?"party_b":`party_b_${r}`;return`
      <div style="margin-top: 10px; margin-bottom: 20px; text-align:center;">
        <div class="signature-line" style="margin:3cm auto 0.2cm; position:relative;">
          <span style="${Q}">SIG_ANCHOR:${n}</span>
        </div>
        <div class="signature-name">${e.name}</div>
        <div class="signature-title">Authorised Signatory ${r}</div>
      </div>
      `}).join(""):"",ee=J[0]?J[0]:{name:W?.contact_name||W?.legal_name||"Introducer"},et=G?`
      <div style="margin-top: 10px; margin-bottom: 20px; text-align:center;">
        <div class="signature-line" style="margin:3cm auto 0.2cm; position:relative;">
          <span style="${Q}">SIG_ANCHOR:party_b</span>
        </div>
        <div class="signature-name">${ee.name}</div>
        <div class="signature-title">Introducer</div>
      </div>
      `:"",{data:er,error:en}=await o.from("introducer_agreements").insert({introducer_id:c.introducer_id,deal_id:c.deal_id,fee_plan_id:c.id,arranger_id:N,reference_number:k,agreement_type:"standard",default_commission_bps:m,performance_fee_bps:g,hurdle_rate_bps:f,has_performance_cap:h,performance_cap_percent:R,commission_cap_amount:null,subscription_fee_payment_days:S,performance_fee_payment_days:$,payment_terms:C,effective_date:new Date().toISOString().split("T")[0],expiry_date:A,non_circumvention_months:c.non_circumvention_months,vat_registration_number:c.vat_registration_number,governing_law:c.governing_law||"British Virgin Islands",status:"draft",created_by:l.id}).select().single();if(en)return console.error("Error creating introducer agreement:",en),y.NextResponse.json({error:"Failed to create agreement",details:en.message},{status:500});let{error:ea}=await o.from("fee_plans").update({generated_agreement_id:er.id,status:"pending_signature"}).eq("id",s);ea&&console.error("Error linking agreement to fee plan:",ea);let ei=c.deal,eo=[W?.address_line_1,W?.address_line_2,W?.city,[W?.state_province,W?.postal_code].filter(Boolean).join(" "),W?.country].filter(Boolean).join(", ");t=null===c.non_circumvention_months||void 0===c.non_circumvention_months?"an indefinite period of time":`a period of ${c.non_circumvention_months} months`,a=f&&0!==f?`with a ${(f/100).toFixed(2)}% hurdle rate`:"with no hurdle rate",i=h?` with a ${R}% cap`:" and no cap";let es="";c.vat_registration_number&&(es=` VAT Registration: ${c.vat_registration_number}`);let el=(m/100).toFixed(2),ed=(m/1e4).toFixed(4),ec=(g/100).toFixed(2),eu=(g/1e4).toFixed(2),e_=e=>e?new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}):"",ep=ei?.offer_unit_price||23.52,em=1e4*ep,eg=m/1e4*em,ef=5e5-em,eh=g/1e4*ef,ey=g>0,ev=ey?`
      <p class="sub-header">Performance Fee Determination:</p>
      <p>The Performance Fee should be calculated as a carried interest of <span class="bold">${ec}%</span> ${a}${i}, to be applied on the gross performance calculated at the time of the redemption of the investment opportunity.</p>
    `:"",ew=ey?`
      <p>In case the same investment returns a price per share at redemption ("RP") of USD 50.00 per share, then the following Performance Fee ("Fp") shall apply:</p>
      <p class="formula">RP = (${1e4.toLocaleString()} x 50.00)</p>
      <p class="formula">RP = ${5e5.toLocaleString()}</p>
      <p class="formula">Fp = [(${1e4.toLocaleString()} x 50.00) - (${1e4.toLocaleString()} x ${ep.toFixed(2)})] x ${eu}</p>
      <p class="formula">Fp = ${ef.toLocaleString()} x ${eu}</p>
      <p class="formula">Fp = ${eh.toLocaleString()}</p>
      <p>The Performance Fee payable to the Introducer would be equal to <span class="bold">USD ${eh.toLocaleString()}</span> only.</p>
    `:"",eb=ey?`
      <p>The performance fee is payable by the Arranger no later than <span class="bold">${$} business days</span> post redemption ("Redemption") or exit, defined by default as the end of any regulatory lock-up period (typically 6 to 9 months post IPO, on NASDAQ or NYSE, United States).</p>
    `:"",ex=await (0,w.triggerWorkflow)({workflowKey:"generate-introducer-agreement",payload:{agreement_id:er.id,document_id:k,reference_number:k,agreement_date:e_(er.effective_date),effective_date:e_(er.effective_date),vehicle_name:U?.name||"",vehicle_description:"a Luxembourg special limited partnership (sociÃ©tÃ© en commandite spÃ©ciale)",vehicle_address:U?.address||"",vehicle_registration_country:U?.domicile||"Luxembourg",vehicle_registration_number:U?.registration_number||"",vehicle_gp_name:U?.issuer_gp_name||"",vehicle_gp_description:U?.issuer_gp_description||"a private limited liability company (sociÃ©tÃ© Ã  responsabilitÃ© limitÃ©e)",vehicle_gp_address:U?.issuer_gp_address||U?.address||"",vehicle_gp_registration_number:U?.issuer_gp_rcc_number||"",arranger_name:q?.legal_name||"VERSO Management Ltd",arranger_address:q?(n=q)?[n.address,n.city,n.country].filter(Boolean).join(", "):"":"Trident Chambers, Wickhams Cay, Road Town, Tortola, British Virgin Islands",arranger_registration_number:q?.registration_number||"1901463",introducer_name:W?.legal_name||"",introducer_address:eo,introducer_signatory_name:W?.contact_name||"",introducer_email:W?.email||"",introducer_type:V,company_name:ei?.company_name||ei?.name||"",deal_id:c.deal_id,verso_representative_name:"Julien MACHOT",verso_representative_title:"Managing Partner",non_circumvention_period:t,hurdle_rate_text:a,performance_cap_text:i,vat_registration_text:es,subscription_fee_percent:el,subscription_fee_decimal:ed,performance_fee_percent:ec,performance_fee_decimal:eu,subscription_fee_payment_days:S,performance_fee_payment_days:$,governing_law:c.governing_law||"British Virgin Islands",agreement_duration_months:c.agreement_duration_months||36,example_shares:1e4.toLocaleString(),example_price_per_share:ep.toFixed(2),example_purchase_price:em.toLocaleString(),example_introduction_fee:eg.toLocaleString(),example_redemption_price:"50.00",example_redemption_total:5e5.toLocaleString(),example_profit:ef.toLocaleString(),example_performance_fee:eh.toLocaleString(),schedule_table_html:K,schedule_total_capital:x(H),schedule_total_fee:x(B),schedule_subscriber_count:(L||[]).length,has_performance_fee:ey,is_entity:z,is_individual:G,performance_fee_html:ev,performance_fee_example_html:ew,performance_fee_payment_html:eb,entity_signature_html:Y,individual_signature_html:et,raw_subscription_fee_bps:m,raw_performance_fee_bps:g,raw_hurdle_rate_bps:f,raw_has_performance_cap:h,raw_performance_cap_percent:R},entityType:"introducer_agreement",entityId:er.id,user:{id:l.id,email:l.email||"",displayName:d?.display_name||"",role:d?.role||"staff",title:d?.title||void 0}});if(!ex.success)return console.error("Failed to trigger n8n workflow:",ex.error),y.NextResponse.json({success:!0,agreement_id:er.id,workflow_run_id:ex.workflow_run_id,pdf_generated:!1,message:"Introducer agreement created but PDF generation failed"});console.log("n8n workflow triggered successfully:",ex.workflow_run_id);let eR=null;if(ex.n8n_response)try{let t=ex.n8n_response;console.log("ðŸ“¦ n8n response structure:",Object.keys(t));let r=null;if(t.binary&&Buffer.isBuffer(t.binary)?r=t.binary:t.raw&&"string"==typeof t.raw?r=Buffer.from(t.raw,"latin1"):t.data&&"string"==typeof t.data?r=Buffer.from(t.data,"base64"):"string"==typeof t&&(r=Buffer.from(t,"latin1")),r&&r.length>0){let t=r.slice(0,4).toString();console.log("ðŸ“„ File signature:",t,"size:",r.length,"bytes"),"%PDF"!==t&&console.warn("âš ï¸ File does not appear to be a valid PDF (signature:",t,")");let n=(ei?.company_name||ei?.name||"Company").replace(/[^a-zA-Z0-9]/g,"_").substring(0,30),a=(W?.legal_name||"Unknown").replace(/[^a-zA-Z0-9]/g,"_").substring(0,30),i=`Fee_Agreement_${n}_${a}_${k}.pdf`,s=(0,v.createServiceClient)(),u=`introducer-agreements/${c.deal_id}/${er.id}/${i}`,{error:_}=await s.storage.from("deal-documents").upload(u,r,{contentType:"application/pdf",upsert:!0});if(_)console.error("âŒ Failed to upload introducer agreement PDF:",_);else{console.log("âœ… Introducer agreement PDF uploaded:",u);let{data:t}=s.storage.from("deal-documents").getPublicUrl(u);eR=t?.publicUrl||u;let{error:n}=await o.from("introducer_agreements").update({pdf_url:u}).eq("id",er.id);if(n)console.error("âŒ Failed to update introducer agreement with PDF URL:",n);else{console.log("âœ… Introducer agreement updated with PDF URL"),console.log("ðŸ“ Creating CEO signature request and task...");try{let t={id:l.id,email:l.email||"",display_name:d?.display_name||"CEO"};if(t.email){console.log("ðŸ‘” Found CEO user:",t.email);let n=(await e.A(485685)).randomUUID(),a=new Date(Date.now()+12096e5),i=null;try{let e=await (0,b.detectAnchors)(new Uint8Array(r));if(e.length>0){let t=z?J.length:1,r=(0,b.getRequiredAnchorsForIntroducerAgreement)(t);(0,b.validateRequiredAnchors)(e,r);let n=(0,b.getPlacementsFromAnchors)(e,"party_a","introducer_agreement");n.length>0?i=n:console.warn("âš ï¸ No signature placements found for CEO anchor (party_a)")}else console.warn("âš ï¸ No anchors detected in introducer agreement PDF")}catch(e){console.error("âŒ Failed to detect anchors for introducer agreement:",e)}let{data:o,error:d}=await s.from("signature_requests").insert({introducer_id:c.introducer_id,introducer_agreement_id:er.id,deal_id:c.deal_id,signer_user_id:t.id,signer_email:t.email,signer_name:t.display_name||"CEO",document_type:"introducer_agreement",signer_role:"admin",signature_position:"party_a",signing_token:n,token_expires_at:a.toISOString(),unsigned_pdf_path:u,...i&&i.length>0?{signature_placements:i}:{},status:"pending",created_by:l.id}).select("id").single();if(d||!o)console.error("âŒ Failed to create CEO signature request:",d);else{console.log("âœ… CEO signature request created:",o.id),await s.from("introducer_agreements").update({ceo_signature_request_id:o.id,status:"pending_ceo_signature",updated_at:new Date().toISOString()}).eq("id",er.id);let e=`/sign/${n}`,r=ei?.company_name||ei?.name||"Unknown Deal",i=W?.legal_name||"Unknown Introducer",l=`${el}% subscription fee${ey?`, ${ec}% performance fee`:""}`,{error:d}=await s.from("tasks").insert({owner_user_id:t.id,kind:"countersignature",category:"compliance",title:`Sign Introducer Agreement: ${i} â†’ ${r}`,description:`Review and sign the introducer fee agreement.

â€¢ Introducer: ${i}
â€¢ Deal: ${r}
â€¢ Fees: ${l}
â€¢ Reference: ${k}

After you sign, the introducer will receive a signing link.`,status:"pending",priority:"high",related_entity_type:"signature_request",related_entity_id:o.id,related_deal_id:c.deal_id,due_at:a.toISOString(),action_url:e,instructions:{type:"signature",action_url:e,signature_request_id:o.id,document_type:"introducer_agreement",introducer_id:c.introducer_id,introducer_name:i,introducer_email:W?.email,deal_name:r,agreement_id:er.id,reference_number:k,fee_summary:l}});d?console.error("âš ï¸ Failed to create CEO task:",d):console.log("âœ… CEO task created in VERSOSign")}}else console.warn("âš ï¸ Current user has no email for signature task")}catch(e){console.error("âŒ Error creating CEO signature task:",e)}}}}else console.warn("âš ï¸ No binary PDF data found in n8n response")}catch(e){console.error("âŒ Error processing PDF from n8n:",e)}return y.NextResponse.json({success:!0,agreement_id:er.id,workflow_run_id:ex.workflow_run_id,pdf_generated:!!eR,pdf_url:eR,message:eR?"Introducer agreement created and PDF generated successfully":"Introducer agreement created, PDF generation in progress"})}catch(e){return console.error("Unexpected error generating agreement:",e),y.NextResponse.json({error:"Internal server error"},{status:500})}}e.s(["POST",()=>R],338384);var S=e.i(338384);let $=new t.AppRouteRouteModule({definition:{kind:r.RouteKind.APP_ROUTE,page:"/api/staff/fees/plans/[id]/generate-agreement/route",pathname:"/api/staff/fees/plans/[id]/generate-agreement",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/versotech-portal/src/app/api/staff/fees/plans/[id]/generate-agreement/route.ts",nextConfigOutput:"",userland:S}),{workAsyncStorage:E,workUnitAsyncStorage:F,serverHooks:C}=$;function A(){return(0,n.patchFetch)({workAsyncStorage:E,workUnitAsyncStorage:F})}async function I(e,t,n){$.isDev&&(0,a.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let y="/api/staff/fees/plans/[id]/generate-agreement/route";y=y.replace(/\/index$/,"")||"/";let v=await $.prepare(e,t,{srcPage:y,multiZoneDraftMode:!1});if(!v)return t.statusCode=400,t.end("Bad Request"),null==n.waitUntil||n.waitUntil.call(n,Promise.resolve()),null;let{buildId:w,params:b,nextConfig:x,parsedUrl:R,isDraftMode:S,prerenderManifest:E,routerServerContext:F,isOnDemandRevalidate:C,revalidateOnlyGenerated:A,resolvedPathname:I,clientReferenceManifest:P,serverActionsManifest:O}=v,D=(0,s.normalizeAppPath)(y),k=!!(E.dynamicRoutes[D]||E.routes[I]),N=async()=>((null==F?void 0:F.render404)?await F.render404(e,t,R,!1):t.end("This page could not be found"),null);if(k&&!S){let e=!!E.routes[I],t=E.dynamicRoutes[D];if(t&&!1===t.fallback&&!e){if(x.experimental.adapterPath)return await N();throw new f.NoFallbackError}}let T=null;!k||$.isDev||S||(T="/index"===(T=I)?"/":T);let U=!0===$.isDev||!k,q=k&&!U;O&&P&&(0,o.setManifestsSingleton)({page:y,clientReferenceManifest:P,serverActionsManifest:O});let L=e.method||"GET",j=(0,i.getTracer)(),H=j.getActiveScopeSpan(),B={params:b,prerenderManifest:E,renderOpts:{experimental:{authInterrupts:!!x.experimental.authInterrupts},cacheComponents:!!x.cacheComponents,supportsDynamicResponse:U,incrementalCache:(0,a.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:x.cacheLife,waitUntil:n.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,n,a)=>$.onRequestError(e,t,n,a,F)},sharedContext:{buildId:w}},M=new l.NodeNextRequest(e),K=new l.NodeNextResponse(t),V=d.NextRequestAdapter.fromNodeNextRequest(M,(0,d.signalFromNodeResponse)(t));try{let o=async e=>$.handle(V,B).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=j.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==c.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let n=r.get("next.route");if(n){let t=`${L} ${n}`;e.setAttributes({"next.route":n,"http.route":n,"next.span_name":t}),e.updateName(t)}else e.updateName(`${L} ${y}`)}),s=!!(0,a.getRequestMeta)(e,"minimalMode"),l=async a=>{var i,l;let d=async({previousCacheEntry:r})=>{try{if(!s&&C&&A&&!r)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let i=await o(a);e.fetchMetrics=B.renderOpts.fetchMetrics;let l=B.renderOpts.pendingWaitUntil;l&&n.waitUntil&&(n.waitUntil(l),l=void 0);let d=B.renderOpts.collectedTags;if(!k)return await (0,_.sendResponse)(M,K,i,B.renderOpts.pendingWaitUntil),null;{let e=await i.blob(),t=(0,p.toNodeOutgoingHttpHeaders)(i.headers);d&&(t[g.NEXT_CACHE_TAGS_HEADER]=d),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==B.renderOpts.collectedRevalidate&&!(B.renderOpts.collectedRevalidate>=g.INFINITE_CACHE)&&B.renderOpts.collectedRevalidate,n=void 0===B.renderOpts.collectedExpire||B.renderOpts.collectedExpire>=g.INFINITE_CACHE?void 0:B.renderOpts.collectedExpire;return{value:{kind:h.CachedRouteKind.APP_ROUTE,status:i.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:n}}}}catch(t){throw(null==r?void 0:r.isStale)&&await $.onRequestError(e,t,{routerKind:"App Router",routePath:y,routeType:"route",revalidateReason:(0,u.getRevalidateReason)({isStaticGeneration:q,isOnDemandRevalidate:C})},!1,F),t}},c=await $.handleResponse({req:e,nextConfig:x,cacheKey:T,routeKind:r.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:E,isRoutePPREnabled:!1,isOnDemandRevalidate:C,revalidateOnlyGenerated:A,responseGenerator:d,waitUntil:n.waitUntil,isMinimalMode:s});if(!k)return null;if((null==c||null==(i=c.value)?void 0:i.kind)!==h.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==c||null==(l=c.value)?void 0:l.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});s||t.setHeader("x-nextjs-cache",C?"REVALIDATED":c.isMiss?"MISS":c.isStale?"STALE":"HIT"),S&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let f=(0,p.fromNodeOutgoingHttpHeaders)(c.value.headers);return s&&k||f.delete(g.NEXT_CACHE_TAGS_HEADER),!c.cacheControl||t.getHeader("Cache-Control")||f.get("Cache-Control")||f.set("Cache-Control",(0,m.getCacheControlHeader)(c.cacheControl)),await (0,_.sendResponse)(M,K,new Response(c.value.body,{headers:f,status:c.value.status||200})),null};H?await l(H):await j.withPropagatedContext(e.headers,()=>j.trace(c.BaseServerSpan.handleRequest,{spanName:`${L} ${y}`,kind:i.SpanKind.SERVER,attributes:{"http.method":L,"http.target":e.url}},l))}catch(t){if(t instanceof f.NoFallbackError||await $.onRequestError(e,t,{routerKind:"App Router",routePath:D,routeType:"route",revalidateReason:(0,u.getRevalidateReason)({isStaticGeneration:q,isOnDemandRevalidate:C})},!1,F),k)throw t;return await (0,_.sendResponse)(M,K,new Response(null,{status:500})),null}}e.s(["handler",()=>I,"patchFetch",()=>A,"routeModule",()=>$,"serverHooks",()=>C,"workAsyncStorage",()=>E,"workUnitAsyncStorage",()=>F],932142)}];

//# sourceMappingURL=6d6b6_next_dist_esm_build_templates_app-route_a1e6f2bc.js.map