module.exports=[918622,(e,r,t)=>{r.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},556704,(e,r,t)=>{r.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},832319,(e,r,t)=>{r.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},324725,(e,r,t)=>{r.exports=e.x("next/dist/server/app-render/after-task-async-storage.external.js",()=>require("next/dist/server/app-render/after-task-async-storage.external.js"))},270406,(e,r,t)=>{r.exports=e.x("next/dist/compiled/@opentelemetry/api",()=>require("next/dist/compiled/@opentelemetry/api"))},193695,(e,r,t)=>{r.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},433669,e=>{"use strict";e.i(814247);var r=e.i(150615),t=e.i(12049),a=e.i(57824);let s=async()=>{let e=await (0,a.cookies)();return(0,r.createServerClient)("https://ipguxdssecfexudnvtia.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlwZ3V4ZHNzZWNmZXh1ZG52dGlhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTgzNjE4MzcsImV4cCI6MjA3MzkzNzgzN30.AGxM_YW9hfxuu7xDpi_4xhOoRhYM7iGTS1vJ0z2FByE",{cookies:{getAll:()=>e.getAll(),setAll(r){try{r.forEach(({name:r,value:t,options:a})=>{e.set(r,t,a)})}catch(e){}}}})};e.s(["createClient",0,s,"createServiceClient",0,()=>(0,t.createClient)("https://ipguxdssecfexudnvtia.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY,{auth:{autoRefreshToken:!1,persistSession:!1}})])},196776,e=>{"use strict";var r=e.i(779444),t=e.i(698261),a=e.i(821776),s=e.i(796417),n=e.i(856890),i=e.i(26996),o=e.i(436944),l=e.i(88281),u=e.i(765944),d=e.i(984788),p=e.i(237011),c=e.i(712007),m=e.i(777657),h=e.i(13180),x=e.i(273827),v=e.i(193695);e.i(947956);var y=e.i(36217),f=e.i(414131),_=e.i(433669),R=e.i(107854);let g=["partner","investor","introducer","commercial_partner","lawyer","arranger"],w={partner:"partner_users",investor:"investor_users",introducer:"introducer_users",commercial_partner:"commercial_partner_users",lawyer:"lawyer_users",arranger:"arranger_users"},E={partner:"partner_id",investor:"investor_id",introducer:"introducer_id",commercial_partner:"commercial_partner_id",lawyer:"lawyer_id",arranger:"arranger_id"},b=R.z.object({entity_type:R.z.enum(g),entity_id:R.z.string().uuid(),role:R.z.string().optional(),is_primary:R.z.boolean().optional(),can_sign:R.z.boolean().optional()});async function C(e,{params:r}){try{let{id:t}=await r,a=await (0,_.createClient)(),{data:{user:s},error:n}=await a.auth.getUser();if(n||!s)return f.NextResponse.json({error:"Unauthorized"},{status:401});let i=await e.json(),o=b.safeParse(i);if(!o.success)return f.NextResponse.json({error:"Invalid request body",details:o.error.flatten()},{status:400});let{entity_type:l,entity_id:u,role:d,is_primary:p,can_sign:c}=o.data,m=(0,_.createServiceClient)(),h=w[l],x=E[l],{data:v}=await m.from(h).select("role, is_primary").eq("user_id",s.id).eq(x,u).maybeSingle();if(!v)return f.NextResponse.json({error:"You are not a member of this entity"},{status:403});if(!(v.is_primary||["admin","owner"].includes(v.role)))return f.NextResponse.json({error:"You do not have permission to manage members"},{status:403});if(t===s.id&&!1===p)return f.NextResponse.json({error:"You cannot remove your own primary status"},{status:400});let y={};if(void 0!==d&&(y.role=d),void 0!==p&&(y.is_primary=p),void 0!==c&&(y.can_sign=c),0===Object.keys(y).length)return f.NextResponse.json({error:"No fields to update"},{status:400});!0===p&&await m.from(h).update({is_primary:!1}).eq(x,u).eq("is_primary",!0);let{data:R,error:g}=await m.from(h).update(y).eq("user_id",t).eq(x,u).select(`
        user_id,
        role,
        is_primary,
        can_sign,
        profiles:user_id (
          display_name,
          email,
          avatar_url
        )
      `).single();if(g)return console.error("Error updating member:",g),f.NextResponse.json({error:"Failed to update member"},{status:500});return f.NextResponse.json({member:{id:`${R.user_id}_${u}`,user_id:R.user_id,role:R.role,is_primary:R.is_primary,can_sign:R.can_sign??!1,profile:R.profiles?{display_name:R.profiles.display_name,email:R.profiles.email,avatar_url:R.profiles.avatar_url}:null}})}catch(e){return console.error("Error in PATCH /api/members/[id]:",e),f.NextResponse.json({error:"Internal server error"},{status:500})}}async function N(e,{params:r}){try{let{id:t}=await r,a=await (0,_.createClient)(),{data:{user:s},error:n}=await a.auth.getUser();if(n||!s)return f.NextResponse.json({error:"Unauthorized"},{status:401});let{searchParams:i}=new URL(e.url),o=i.get("entity_type"),l=i.get("entity_id");if(!o||!l)return f.NextResponse.json({error:"Missing required params: entity_type, entity_id"},{status:400});if(!g.includes(o))return f.NextResponse.json({error:"Invalid entity_type"},{status:400});let u=(0,_.createServiceClient)(),d=w[o],p=E[o],{data:c}=await u.from(d).select("role, is_primary").eq("user_id",s.id).eq(p,l).maybeSingle();if(!c)return f.NextResponse.json({error:"You are not a member of this entity"},{status:403});if(!(c.is_primary||["admin","owner"].includes(c.role)))return f.NextResponse.json({error:"You do not have permission to remove members"},{status:403});if(t===s.id)return f.NextResponse.json({error:"You cannot remove yourself from the entity"},{status:400});let{data:m}=await u.from(d).select("is_primary").eq("user_id",t).eq(p,l).maybeSingle();if(m?.is_primary)return f.NextResponse.json({error:"Cannot remove the primary contact. Transfer primary status first."},{status:400});let{error:h}=await u.from(d).delete().eq("user_id",t).eq(p,l);if(h)return console.error("Error removing member:",h),f.NextResponse.json({error:"Failed to remove member"},{status:500});return f.NextResponse.json({success:!0})}catch(e){return console.error("Error in DELETE /api/members/[id]:",e),f.NextResponse.json({error:"Internal server error"},{status:500})}}e.s(["DELETE",()=>N,"PATCH",()=>C],557777);var j=e.i(557777);let A=new r.AppRouteRouteModule({definition:{kind:t.RouteKind.APP_ROUTE,page:"/api/members/[id]/route",pathname:"/api/members/[id]",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/versotech-portal/src/app/api/members/[id]/route.ts",nextConfigOutput:"",userland:j}),{workAsyncStorage:I,workUnitAsyncStorage:q,serverHooks:S}=A;function T(){return(0,a.patchFetch)({workAsyncStorage:I,workUnitAsyncStorage:q})}async function P(e,r,a){A.isDev&&(0,s.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let f="/api/members/[id]/route";f=f.replace(/\/index$/,"")||"/";let _=await A.prepare(e,r,{srcPage:f,multiZoneDraftMode:!1});if(!_)return r.statusCode=400,r.end("Bad Request"),null==a.waitUntil||a.waitUntil.call(a,Promise.resolve()),null;let{buildId:R,params:g,nextConfig:w,parsedUrl:E,isDraftMode:b,prerenderManifest:C,routerServerContext:N,isOnDemandRevalidate:j,revalidateOnlyGenerated:I,resolvedPathname:q,clientReferenceManifest:S,serverActionsManifest:T}=_,P=(0,o.normalizeAppPath)(f),k=!!(C.dynamicRoutes[P]||C.routes[q]),O=async()=>((null==N?void 0:N.render404)?await N.render404(e,r,E,!1):r.end("This page could not be found"),null);if(k&&!b){let e=!!C.routes[q],r=C.dynamicRoutes[P];if(r&&!1===r.fallback&&!e){if(w.experimental.adapterPath)return await O();throw new v.NoFallbackError}}let U=null;!k||A.isDev||b||(U="/index"===(U=q)?"/":U);let z=!0===A.isDev||!k,H=k&&!z;T&&S&&(0,i.setManifestsSingleton)({page:f,clientReferenceManifest:S,serverActionsManifest:T});let M=e.method||"GET",D=(0,n.getTracer)(),F=D.getActiveScopeSpan(),Y={params:g,prerenderManifest:C,renderOpts:{experimental:{authInterrupts:!!w.experimental.authInterrupts},cacheComponents:!!w.cacheComponents,supportsDynamicResponse:z,incrementalCache:(0,s.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:w.cacheLife,waitUntil:a.waitUntil,onClose:e=>{r.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(r,t,a,s)=>A.onRequestError(e,r,a,s,N)},sharedContext:{buildId:R}},$=new l.NodeNextRequest(e),L=new l.NodeNextResponse(r),K=u.NextRequestAdapter.fromNodeNextRequest($,(0,u.signalFromNodeResponse)(r));try{let i=async e=>A.handle(K,Y).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":r.statusCode,"next.rsc":!1});let t=D.getRootSpanAttributes();if(!t)return;if(t.get("next.span_type")!==d.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${t.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let a=t.get("next.route");if(a){let r=`${M} ${a}`;e.setAttributes({"next.route":a,"http.route":a,"next.span_name":r}),e.updateName(r)}else e.updateName(`${M} ${f}`)}),o=!!(0,s.getRequestMeta)(e,"minimalMode"),l=async s=>{var n,l;let u=async({previousCacheEntry:t})=>{try{if(!o&&j&&I&&!t)return r.statusCode=404,r.setHeader("x-nextjs-cache","REVALIDATED"),r.end("This page could not be found"),null;let n=await i(s);e.fetchMetrics=Y.renderOpts.fetchMetrics;let l=Y.renderOpts.pendingWaitUntil;l&&a.waitUntil&&(a.waitUntil(l),l=void 0);let u=Y.renderOpts.collectedTags;if(!k)return await (0,c.sendResponse)($,L,n,Y.renderOpts.pendingWaitUntil),null;{let e=await n.blob(),r=(0,m.toNodeOutgoingHttpHeaders)(n.headers);u&&(r[x.NEXT_CACHE_TAGS_HEADER]=u),!r["content-type"]&&e.type&&(r["content-type"]=e.type);let t=void 0!==Y.renderOpts.collectedRevalidate&&!(Y.renderOpts.collectedRevalidate>=x.INFINITE_CACHE)&&Y.renderOpts.collectedRevalidate,a=void 0===Y.renderOpts.collectedExpire||Y.renderOpts.collectedExpire>=x.INFINITE_CACHE?void 0:Y.renderOpts.collectedExpire;return{value:{kind:y.CachedRouteKind.APP_ROUTE,status:n.status,body:Buffer.from(await e.arrayBuffer()),headers:r},cacheControl:{revalidate:t,expire:a}}}}catch(r){throw(null==t?void 0:t.isStale)&&await A.onRequestError(e,r,{routerKind:"App Router",routePath:f,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:H,isOnDemandRevalidate:j})},!1,N),r}},d=await A.handleResponse({req:e,nextConfig:w,cacheKey:U,routeKind:t.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:C,isRoutePPREnabled:!1,isOnDemandRevalidate:j,revalidateOnlyGenerated:I,responseGenerator:u,waitUntil:a.waitUntil,isMinimalMode:o});if(!k)return null;if((null==d||null==(n=d.value)?void 0:n.kind)!==y.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==d||null==(l=d.value)?void 0:l.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});o||r.setHeader("x-nextjs-cache",j?"REVALIDATED":d.isMiss?"MISS":d.isStale?"STALE":"HIT"),b&&r.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let v=(0,m.fromNodeOutgoingHttpHeaders)(d.value.headers);return o&&k||v.delete(x.NEXT_CACHE_TAGS_HEADER),!d.cacheControl||r.getHeader("Cache-Control")||v.get("Cache-Control")||v.set("Cache-Control",(0,h.getCacheControlHeader)(d.cacheControl)),await (0,c.sendResponse)($,L,new Response(d.value.body,{headers:v,status:d.value.status||200})),null};F?await l(F):await D.withPropagatedContext(e.headers,()=>D.trace(d.BaseServerSpan.handleRequest,{spanName:`${M} ${f}`,kind:n.SpanKind.SERVER,attributes:{"http.method":M,"http.target":e.url}},l))}catch(r){if(r instanceof v.NoFallbackError||await A.onRequestError(e,r,{routerKind:"App Router",routePath:P,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:H,isOnDemandRevalidate:j})},!1,N),k)throw r;return await (0,c.sendResponse)($,L,new Response(null,{status:500})),null}}e.s(["handler",()=>P,"patchFetch",()=>T,"routeModule",()=>A,"serverHooks",()=>S,"workAsyncStorage",()=>I,"workUnitAsyncStorage",()=>q],196776)},261365,e=>{e.v(e=>Promise.resolve().then(()=>e(368899)))}];

//# sourceMappingURL=%5Broot-of-the-server%5D__a76766d2._.js.map