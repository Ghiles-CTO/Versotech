module.exports=[350280,e=>{"use strict";var t=e.i(779444),r=e.i(698261),i=e.i(821776),n=e.i(796417),a=e.i(856890),s=e.i(26996),o=e.i(436944),l=e.i(88281),c=e.i(765944),d=e.i(984788),u=e.i(237011),_=e.i(712007),p=e.i(777657),m=e.i(13180),g=e.i(273827),f=e.i(193695);e.i(947956);var b=e.i(36217),y=e.i(433669),h=e.i(911357),v=e.i(414131),w=e.i(751966),R=e.i(66044),E=e.i(400589);let N=["staff_admin","staff_ops","staff_rm","ceo"];function S(e,t,r,i,n="docx"){let a=i.getUTCDate().toString().padStart(2,"0"),s=(i.getUTCMonth()+1).toString().padStart(2,"0"),o=i.getUTCFullYear().toString().slice(-2),l=`${a}${s}${o}`,c=e.trim(),d=t.trim().replace(/\s+/g," "),u=r.trim().replace(/\s+/g," ");return`${c} - SUBSCRIPTION PACK - ${d} - ${u} - ${l}.${n}`}async function x(e,{params:t}){try{let{id:r}=await t,i=await (0,y.createClient)(),n=(0,y.createServiceClient)(),a="docx";try{let t=await e.json();("pdf"===t.format||"docx"===t.format)&&(a=t.format)}catch{}console.log("ðŸ“„ [REGENERATE] Requested output format:",a);let{data:{user:s},error:o}=await i.auth.getUser();if(o||!s)return v.NextResponse.json({error:"Unauthorized"},{status:401});let{data:l}=await i.from("profiles").select("role, display_name, email").eq("id",s.id).single();if(!l||!N.includes(l.role))return v.NextResponse.json({error:"Staff access required"},{status:403});let c={id:s.id,email:s.email||l.email,displayName:l.display_name,role:l.role,title:""},{data:d,error:u}=await n.from("subscriptions").select(`
        *,
        investor:investors!subscriptions_investor_id_fkey (
          id,
          legal_name,
          display_name,
          type,
          registered_address,
          entity_identifier
        ),
        vehicle:vehicles!subscriptions_vehicle_id_fkey (
          id,
          name,
          series_number,
          series_short_title,
          investment_name,
          entity_code,
          issuer_gp_name,
          issuer_gp_rcc_number,
          issuer_rcc_number,
          issuer_website
        ),
        deal:deals!subscriptions_deal_id_fkey (
          id,
          name,
          company_name,
          company_logo_url,
          currency,
          vehicle_id
        )
      `).eq("id",r).single();if(u||!d)return console.error("Error fetching subscription:",u),v.NextResponse.json({error:"Subscription not found"},{status:404});if(!d.deal_id)return v.NextResponse.json({error:"Cannot regenerate: subscription has no associated deal. Only subscriptions created through the approval workflow can be regenerated."},{status:400});if(!d.investor)return v.NextResponse.json({error:"Cannot regenerate: subscription has no associated investor."},{status:400});let _=d.vehicle;if(!_&&d.deal?.vehicle_id){let{data:e}=await n.from("vehicles").select("id, name, series_number, series_short_title, investment_name, entity_code, issuer_gp_name, issuer_gp_rcc_number, issuer_rcc_number, issuer_website").eq("id",d.deal.vehicle_id).single();_=e}if(!_)return v.NextResponse.json({error:"Cannot regenerate: no vehicle found for this subscription."},{status:400});let p=null,{data:m}=await n.from("deal_subscription_submissions").select("id, subscription_type, counterparty_entity_id, submitted_at").eq("formal_subscription_id",r).single();if(m?.subscription_type==="entity"&&m?.counterparty_entity_id){let{data:e}=await n.from("investor_counterparty").select("*").eq("id",m.counterparty_entity_id).single();p=e}let g=[];if((m?.subscription_type==="entity"||d.investor?.type==="entity"||d.investor?.type==="institutional")&&d.investor_id){let{data:e}=await n.from("investor_members").select("id, full_name, email, role_title").eq("investor_id",d.investor_id).eq("is_signatory",!0).eq("is_active",!0);e&&e.length>0?(g=e.map((e,t)=>({name:e.full_name||"",title:e.role_title||"Authorized Signatory",number:t+1})),console.log(`ðŸ‘¥ [REGENERATE] Found ${g.length} authorized signatories for entity`)):(g=[{name:p?.representative_name||d.investor?.legal_name||"",title:p?.representative_title||"Authorized Representative",number:1}],console.warn("[REGENERATE] No signatories marked, using representative fallback"))}else g=[{name:d.investor?.legal_name||"",title:"Investor",number:1}];let f=(e,t)=>{let r=1===e?"party_a":`party_a_${e}`;return t?`${r}_${t}`:r},b="position:absolute;left:0;top:0;font-size:1px;line-height:1px;color:#ffffff;opacity:0.01;",x=g.map(e=>`
            <div class="signature-block-inline" style="position:relative;margin-bottom: 0.5cm;">
                <div class="signature-line" style="position:relative;"><span style="${b}">SIG_ANCHOR:${f(e.number,"form")}</span></div>
                Name: ${e.name}<br>
                Title: ${e.title}
            </div>`).join(""),C=g.map(e=>`
<div class="signature-block" style="position:relative;margin-bottom: 1.5cm; min-height: 4cm;">
    <p><strong>The Subscriber</strong>, represented by Authorized Signatory ${e.number}</p>
    <div class="signature-line main-line" style="margin-top: 3cm; position:relative;"><span style="${b}">SIG_ANCHOR:${f(e.number)}</span></div>
    <p style="margin-top: 0.3cm;">Name: ${e.name}<br>
    Title: ${e.title}</p>
</div>`).join(""),A=g.map(e=>`
            <div style="margin-bottom: 0.5cm;">
                <div class="signature-line"></div>
                Name: ${e.name}<br>
                Title: ${e.title}
            </div>`).join(""),{data:T}=await n.from("deal_fee_structures").select("*").eq("deal_id",d.deal_id).eq("status","published").order("created_at",{ascending:!1}).limit(1).single();if(!T)return v.NextResponse.json({error:"No published fee structure found for this deal"},{status:400});let $=await (0,E.getCeoSigner)(n),k=$?.displayName||T.issuer_signatory_name||"",D=$?.title||T.issuer_signatory_title||"Authorized Signatory";console.log("[REGENERATE] Issuer signer:",{name:k,title:D});let O=T.arranger_person_name||"",P=T.arranger_person_title||"Director",{data:q}=await n.from("deals").select("arranger_entity_id").eq("id",d.deal_id).single();if(q?.arranger_entity_id){let{data:e}=await n.from("arranger_users").select("user_id, title").eq("arranger_id",q.arranger_entity_id).eq("can_sign",!0).order("is_primary",{ascending:!1}).limit(1).maybeSingle();if(e?.user_id){let{data:t}=await n.from("profiles").select("display_name").eq("id",e.user_id).single();t?.display_name&&(O=t.display_name,P=e.title||P,console.log("[REGENERATE] Arranger signer found:",{name:O,title:P}))}}O||(O="Julien Machot",console.warn("[REGENERATE] Using hardcoded arranger fallback: Julien Machot")),console.log("[REGENERATE] Arranger signer:",{name:O,title:P}),console.log("[REGENERATE] ANCHOR_CSS:",b);let U=`
<div class="signature-block" style="position:relative;margin-bottom: 1.5cm; min-height: 4cm;">
    <p><strong>The Issuer, VERSO Capital 2 SCSP</strong>, duly represented by its general partner <strong>VERSO Capital 2 GP SARL</strong></p>
    <div class="signature-line main-line" style="margin-top: 3cm; position:relative;"><span style="${b}">SIG_ANCHOR:party_b</span></div>
    <p style="margin-top: 0.3cm;">Name: ${k}<br>
    Title: ${D}</p>
</div>`,I=`
<div class="signature-block" style="position:relative;margin-bottom: 1.5cm; min-height: 4cm;">
    <p><strong>The Attorney, Verso Management Ltd.</strong>, for the purpose of the powers granted under Clause 6</p>
    <div class="signature-line main-line" style="margin-top: 3cm; position:relative;"><span style="${b}">SIG_ANCHOR:party_c</span></div>
    <p style="margin-top: 0.3cm;">Name: ${O}<br>
    Title: ${P}</p>
</div>`;console.log("[REGENERATE] ========== SIGNATURE HTML DEBUG =========="),console.log("[REGENERATE] ANCHOR_CSS used:",b),console.log("[REGENERATE] issuerSignatureHtml contains party_b:",U.includes("SIG_ANCHOR:party_b")),console.log("[REGENERATE] arrangerSignatureHtml contains party_c:",I.includes("SIG_ANCHOR:party_c")),console.log("[REGENERATE] arrangerSignatureHtml FULL:",I),console.log("[REGENERATE] ==========================================");let F=Number(d.commitment)||0;if(F<=0)return v.NextResponse.json({error:"Subscription commitment amount must be greater than 0"},{status:400});let G=Number(d.price_per_share),H=parseFloat(T.price_per_share_text?.replace(/[^\d.]/g,"")||"0"),j=G>0?G:H>0?H:1,L=Number(d.num_shares)>0?Number(d.num_shares):Math.floor(F/j),M=Number(d.subscription_fee_percent)||T.subscription_fee_percent||0,B=Number(d.subscription_fee_amount)||M/100*F,z=F+B,K=new Date().toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}),V=T.payment_deadline_days||10,X=new Date(Date.now()+24*V*36e5).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}),W=d.investor,J=d.deal,Y=p?p.legal_name:W.legal_name,Z=p?p.entity_type?.replace(/_/g," ").toUpperCase():W.type||"Corporate Entity",Q=p&&p.registered_address?[p.registered_address.street,[p.registered_address.city,p.registered_address.state,p.registered_address.postal_code].filter(Boolean).join(", "),p.registered_address.country].filter(Boolean).join(", "):W.registered_address||"",ee=p?`${p.legal_name}, a ${p.entity_type?.replace(/_/g," ")} with registered office at ${Q}`:`${W.legal_name}, ${W.type||"entity"} with registered office at ${W.registered_address||""}`,et=p?.representative_title||"Authorized Representative",er=p?.representative_name||p?.legal_name||W.legal_name,ei={output_format:a,series_number:_?.series_number||"",series_title:_?.investment_name||_?.name||"",series_short_title:_?.series_short_title||"",ultimate_investment:J?.company_name||J?.name||"",subscriber_name:Y,subscriber_type:Z,subscriber_address:Q,subscriber_block:ee,subscriber_title:et,subscriber_representative_name:er,investment_logo_url:J?.company_logo_url||"",certificates_count:L.toString(),price_per_share:j.toFixed(2),subscription_amount:F.toFixed(2),subscription_fee_rate:`${M.toFixed(2)}%`,subscription_fee_amount:B.toFixed(2),subscription_fee_text:`${M.toFixed(2)}% upfront subscription fee`,total_subscription_price:z.toFixed(2),currency_code:d.currency||J?.currency||"USD",currency_long:"USD"===(d.currency||J?.currency)?"United States Dollars":d.currency||J?.currency,management_fee_text:`${(T.management_fee_percent||0).toFixed(2)}% of net asset value per annum, calculated and payable quarterly`,performance_fee_text:`${(T.carried_interest_percent||0).toFixed(2)}% performance fee on realized gains`,escrow_fee_text:T.escrow_fee_text||"As per escrow agreement",management_fee_clause:T.management_fee_clause||`The Issuer shall charge a Management Fee of ${(T.management_fee_percent||0).toFixed(2)}% per annum of the net asset value of the Series, calculated on a quarterly basis and payable quarterly in advance.`,performance_fee_clause:T.performance_fee_clause||`The Issuer shall be entitled to a Performance Fee equal to ${(T.carried_interest_percent||0).toFixed(2)}% of the net profits generated by the Series.`,wire_bank_name:T.wire_bank_name||"Banque de Luxembourg",wire_bank_address:T.wire_bank_address||"14, boulevard Royal, L-2449 Luxembourg, Grand Duchy of Luxembourg",wire_account_holder:T.wire_account_holder||"Elvinger Hoss Prussen - Escrow Account",wire_escrow_agent:T.wire_escrow_agent||"Elvinger Hoss Prussen",wire_law_firm_address:T.wire_law_firm_address||"2 Place Winston Churchill, L-1340 Luxembourg, Grand Duchy of Luxembourg",wire_iban:T.wire_iban||"LU28 0019 4855 4447 1000",wire_bic:T.wire_bic||"BLUXLULL",wire_reference:T.wire_reference_format?.replace("{series}",_?.series_number||"")||`${_?.series_number}-${_?.series_short_title}`,wire_description:T.wire_description_format||`Escrow account for ${_?.name}`,wire_arranger:T.exclusive_arranger||"VERSO Management Ltd",wire_contact_email:T.wire_contact_email||"subscription@verso.capital",issuer_gp_name:_?.issuer_gp_name||"VERSO Capital 2 GP SARL",issuer_gp_rcc_number:_?.issuer_gp_rcc_number||"",issuer_rcc_number:_?.issuer_rcc_number||"",issuer_website:_?.issuer_website||"www.verso.capital",issuer_name:k,issuer_title:D,agreement_date:K,payment_deadline_days:V.toString(),payment_deadline_date:X,issue_within_business_days:(T.issue_within_business_days||5).toString(),recital_b_html:T.recital_b_html||`(B) The Issuer intends to issue Certificates which shall track equity interests in ${J?.company_name||J?.name}, and the Subscriber intends to subscribe for ${L} Certificates.`,arranger_name:O,arranger_title:P,arranger_company_name:T.exclusive_arranger||"VERSO Management",lpa_date:"",max_aggregate_amount:"100,000,000",selling_subscriber_name:Y,accession_holder_name:Y,accession_signatory_name:g[0]?.name||"",accession_signatory_title:g[0]?.title||"",signatories_table_html:A,signatories_form_html:x,signatories_signature_html:C,issuer_signature_html:U,arranger_signature_html:I,is_regeneration:!0,original_subscription_id:r};console.log("ðŸ”„ Triggering Subscription Pack REGENERATION:",{subscription_id:r,investor:W.legal_name,amount:F,num_shares:L,price_per_share:j});let en=await (0,w.triggerWorkflow)({workflowKey:"generate-subscription-pack",payload:ei,entityType:"subscription_regeneration",entityId:r,user:{id:c.id,email:c.email,displayName:c.displayName,role:c.role,title:c.title}});if(!en.success)return console.error("âŒ Failed to trigger Subscription Pack regeneration:",en.error),v.NextResponse.json({error:en.error||"Failed to trigger document generation"},{status:500});if(console.log("âœ… Subscription Pack regeneration triggered:",{workflow_run_id:en.workflow_run_id}),en.n8n_response)try{let e,t,i,s,o=en.n8n_response;console.log("ðŸ“¦ n8n regeneration response structure:",Object.keys(o));let l=_?.entity_code||"UNKNOWN",u=_?.investment_name||"INVESTMENT",p=W?.display_name||W?.legal_name||"INVESTOR";if(o.raw&&"string"==typeof o.raw)e=Buffer.from(o.raw,"latin1");else if(o.binary)e=Buffer.from(o.binary);else if(o.data)e=Buffer.from(o.data,"base64");else if("string"==typeof o)e=Buffer.from(o,"latin1");else throw Error("No binary data in n8n response");let g=e.slice(0,4).toString("hex"),f="25504446"===g;if(console.log("ðŸ“„ N8N response file signature:",g,f?"(PDF)":"504b0304"===g?"(DOCX)":"(unknown)","size:",e.length),"pdf"===a)if(f)console.log("âœ… N8N returned PDF directly, skipping Gotenberg conversion"),t=e,i=S(l,u,p,new Date,"pdf"),s="application/pdf";else{console.log("ðŸ”„ Converting DOCX to PDF via Gotenberg...");let r=S(l,u,p,new Date,"docx"),n=await (0,R.convertDocxToPdf)(e,r);if(!n.success||!n.pdfBuffer)return console.error("âŒ Gotenberg conversion failed:",n.error),v.NextResponse.json({error:"Document generated but PDF conversion failed",details:n.error||"Conversion service unavailable"},{status:500});console.log("âœ… DOCX converted to PDF:",{docx_size:e.length,pdf_size:n.pdfBuffer.length}),t=n.pdfBuffer,i=S(l,u,p,new Date,"pdf"),s="application/pdf"}else t=e,i=S(l,u,p,new Date,"docx"),s="application/vnd.openxmlformats-officedocument.wordprocessingml.document";console.log("ðŸ“„ Final document:",{format:a,fileName:i,size:t.length});let b=`subscriptions/${r}/regenerated/${Date.now()}-${i}`,{error:y}=await n.storage.from("deal-documents").upload(b,t,{contentType:s,upsert:!1});if(y)return console.error("âŒ Failed to upload regenerated subscription pack:",y),v.NextResponse.json({error:"Document generated but failed to upload"},{status:500});console.log("âœ… Regenerated subscription pack uploaded:",b);let w=null,E=d.vehicle_id||_?.id;if(E){let{data:e}=await n.from("document_folders").select("id").eq("vehicle_id",E).eq("name","Subscription Documents").limit(1).maybeSingle();w=e?.id||null,console.log("[REGENERATE] Folder lookup:",{vehicleIdForFolder:E,subscriptionFolderId:w})}let{data:N,error:x}=await n.from("documents").insert({subscription_id:r,subscription_submission_id:m?.id||null,deal_id:d.deal_id,vehicle_id:E,folder_id:w,type:"subscription_draft",name:`Subscription Pack (Regenerated) - ${u} - ${p}`,file_key:b,mime_type:s,file_size_bytes:t.length,status:"draft",current_version:1,created_by:c.id}).select().single();return x?console.error("âŒ Failed to create document record:",x):console.log("âœ… Regenerated document record created:",N.id),await n.from("subscriptions").update({pack_generated_at:new Date().toISOString()}).eq("id",r),await h.auditLogger.log({actor_user_id:c.id,action:h.AuditActions.UPDATE,entity:h.AuditEntities.SUBSCRIPTIONS,entity_id:r,metadata:{type:"subscription_pack_regenerated",amount:F,num_shares:L,price_per_share:j,document_id:N?.id,output_format:a}}),v.NextResponse.json({success:!0,message:`Subscription pack regenerated successfully as ${a.toUpperCase()}`,document_id:N?.id,file_key:b,format:a,workflow_run_id:en.workflow_run_id})}catch(e){return console.error("âŒ Error processing regenerated document:",e),v.NextResponse.json({error:"Document generated but failed to process"},{status:500})}return v.NextResponse.json({success:!0,message:"Regeneration workflow triggered",workflow_run_id:en.workflow_run_id})}catch(e){return console.error("Regeneration error:",e),v.NextResponse.json({error:"Internal server error"},{status:500})}}e.s(["POST",()=>x],928882);var C=e.i(928882);let A=new t.AppRouteRouteModule({definition:{kind:r.RouteKind.APP_ROUTE,page:"/api/subscriptions/[id]/regenerate/route",pathname:"/api/subscriptions/[id]/regenerate",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/versotech-portal/src/app/api/subscriptions/[id]/regenerate/route.ts",nextConfigOutput:"",userland:C}),{workAsyncStorage:T,workUnitAsyncStorage:$,serverHooks:k}=A;function D(){return(0,i.patchFetch)({workAsyncStorage:T,workUnitAsyncStorage:$})}async function O(e,t,i){A.isDev&&(0,n.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let y="/api/subscriptions/[id]/regenerate/route";y=y.replace(/\/index$/,"")||"/";let h=await A.prepare(e,t,{srcPage:y,multiZoneDraftMode:!1});if(!h)return t.statusCode=400,t.end("Bad Request"),null==i.waitUntil||i.waitUntil.call(i,Promise.resolve()),null;let{buildId:v,params:w,nextConfig:R,parsedUrl:E,isDraftMode:N,prerenderManifest:S,routerServerContext:x,isOnDemandRevalidate:C,revalidateOnlyGenerated:T,resolvedPathname:$,clientReferenceManifest:k,serverActionsManifest:D}=h,O=(0,o.normalizeAppPath)(y),P=!!(S.dynamicRoutes[O]||S.routes[$]),q=async()=>((null==x?void 0:x.render404)?await x.render404(e,t,E,!1):t.end("This page could not be found"),null);if(P&&!N){let e=!!S.routes[$],t=S.dynamicRoutes[O];if(t&&!1===t.fallback&&!e){if(R.experimental.adapterPath)return await q();throw new f.NoFallbackError}}let U=null;!P||A.isDev||N||(U="/index"===(U=$)?"/":U);let I=!0===A.isDev||!P,F=P&&!I;D&&k&&(0,s.setManifestsSingleton)({page:y,clientReferenceManifest:k,serverActionsManifest:D});let G=e.method||"GET",H=(0,a.getTracer)(),j=H.getActiveScopeSpan(),L={params:w,prerenderManifest:S,renderOpts:{experimental:{authInterrupts:!!R.experimental.authInterrupts},cacheComponents:!!R.cacheComponents,supportsDynamicResponse:I,incrementalCache:(0,n.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:R.cacheLife,waitUntil:i.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,i,n)=>A.onRequestError(e,t,i,n,x)},sharedContext:{buildId:v}},M=new l.NodeNextRequest(e),B=new l.NodeNextResponse(t),z=c.NextRequestAdapter.fromNodeNextRequest(M,(0,c.signalFromNodeResponse)(t));try{let s=async e=>A.handle(z,L).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=H.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==d.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let i=r.get("next.route");if(i){let t=`${G} ${i}`;e.setAttributes({"next.route":i,"http.route":i,"next.span_name":t}),e.updateName(t)}else e.updateName(`${G} ${y}`)}),o=!!(0,n.getRequestMeta)(e,"minimalMode"),l=async n=>{var a,l;let c=async({previousCacheEntry:r})=>{try{if(!o&&C&&T&&!r)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let a=await s(n);e.fetchMetrics=L.renderOpts.fetchMetrics;let l=L.renderOpts.pendingWaitUntil;l&&i.waitUntil&&(i.waitUntil(l),l=void 0);let c=L.renderOpts.collectedTags;if(!P)return await (0,_.sendResponse)(M,B,a,L.renderOpts.pendingWaitUntil),null;{let e=await a.blob(),t=(0,p.toNodeOutgoingHttpHeaders)(a.headers);c&&(t[g.NEXT_CACHE_TAGS_HEADER]=c),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==L.renderOpts.collectedRevalidate&&!(L.renderOpts.collectedRevalidate>=g.INFINITE_CACHE)&&L.renderOpts.collectedRevalidate,i=void 0===L.renderOpts.collectedExpire||L.renderOpts.collectedExpire>=g.INFINITE_CACHE?void 0:L.renderOpts.collectedExpire;return{value:{kind:b.CachedRouteKind.APP_ROUTE,status:a.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:i}}}}catch(t){throw(null==r?void 0:r.isStale)&&await A.onRequestError(e,t,{routerKind:"App Router",routePath:y,routeType:"route",revalidateReason:(0,u.getRevalidateReason)({isStaticGeneration:F,isOnDemandRevalidate:C})},!1,x),t}},d=await A.handleResponse({req:e,nextConfig:R,cacheKey:U,routeKind:r.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:S,isRoutePPREnabled:!1,isOnDemandRevalidate:C,revalidateOnlyGenerated:T,responseGenerator:c,waitUntil:i.waitUntil,isMinimalMode:o});if(!P)return null;if((null==d||null==(a=d.value)?void 0:a.kind)!==b.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==d||null==(l=d.value)?void 0:l.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});o||t.setHeader("x-nextjs-cache",C?"REVALIDATED":d.isMiss?"MISS":d.isStale?"STALE":"HIT"),N&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let f=(0,p.fromNodeOutgoingHttpHeaders)(d.value.headers);return o&&P||f.delete(g.NEXT_CACHE_TAGS_HEADER),!d.cacheControl||t.getHeader("Cache-Control")||f.get("Cache-Control")||f.set("Cache-Control",(0,m.getCacheControlHeader)(d.cacheControl)),await (0,_.sendResponse)(M,B,new Response(d.value.body,{headers:f,status:d.value.status||200})),null};j?await l(j):await H.withPropagatedContext(e.headers,()=>H.trace(d.BaseServerSpan.handleRequest,{spanName:`${G} ${y}`,kind:a.SpanKind.SERVER,attributes:{"http.method":G,"http.target":e.url}},l))}catch(t){if(t instanceof f.NoFallbackError||await A.onRequestError(e,t,{routerKind:"App Router",routePath:O,routeType:"route",revalidateReason:(0,u.getRevalidateReason)({isStaticGeneration:F,isOnDemandRevalidate:C})},!1,x),P)throw t;return await (0,_.sendResponse)(M,B,new Response(null,{status:500})),null}}e.s(["handler",()=>O,"patchFetch",()=>D,"routeModule",()=>A,"serverHooks",()=>k,"workAsyncStorage",()=>T,"workUnitAsyncStorage",()=>$],350280)}];

//# sourceMappingURL=6d6b6_next_dist_esm_build_templates_app-route_be5eb9d9.js.map