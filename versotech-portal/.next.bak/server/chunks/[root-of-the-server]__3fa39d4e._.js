module.exports=[918622,(e,t,r)=>{t.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},556704,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},832319,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},324725,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/after-task-async-storage.external.js",()=>require("next/dist/server/app-render/after-task-async-storage.external.js"))},270406,(e,t,r)=>{t.exports=e.x("next/dist/compiled/@opentelemetry/api",()=>require("next/dist/compiled/@opentelemetry/api"))},193695,(e,t,r)=>{t.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},433669,e=>{"use strict";e.i(814247);var t=e.i(150615),r=e.i(12049),o=e.i(57824);let n=async()=>{let e=await (0,o.cookies)();return(0,t.createServerClient)("https://ipguxdssecfexudnvtia.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlwZ3V4ZHNzZWNmZXh1ZG52dGlhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTgzNjE4MzcsImV4cCI6MjA3MzkzNzgzN30.AGxM_YW9hfxuu7xDpi_4xhOoRhYM7iGTS1vJ0z2FByE",{cookies:{getAll:()=>e.getAll(),setAll(t){try{t.forEach(({name:t,value:r,options:o})=>{e.set(t,r,o)})}catch(e){}}}})};e.s(["createClient",0,n,"createServiceClient",0,()=>(0,r.createClient)("https://ipguxdssecfexudnvtia.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY,{auth:{autoRefreshToken:!1,persistSession:!1}})])},911357,e=>{"use strict";var t=e.i(433669);class r{static instance;static getInstance(){return r.instance||(r.instance=new r),r.instance}async log(e){try{let r=await (0,t.createClient)();await r.from("audit_logs").insert({event_type:"system",actor_id:e.actor_user_id||null,action:e.action,entity_type:e.entity,entity_id:e.entity_id||null,action_details:e.metadata||null,timestamp:new Date().toISOString()})}catch(e){console.error("Audit logging failed:",e)}}async logMany(e){for(let t of e)await this.log(t)}}let o=r.getInstance();e.s(["AuditActions",0,{LOGIN:"login",LOGOUT:"logout",PASSWORD_CHANGE:"password_change",CREATE:"create",READ:"read",UPDATE:"update",DELETE:"delete",DOCUMENT_UPLOAD:"document_upload",DOCUMENT_DOWNLOAD:"document_download",DOCUMENT_DELETE:"document_delete",WORKFLOW_TRIGGER:"workflow_trigger",WORKFLOW_COMPLETED:"workflow_completed",WORKFLOW_FAILED:"workflow_failed",USER_CREATED:"user_created",PROFILE_UPDATED:"profile_updated",ROLE_CHANGED:"role_changed",SUBSCRIPTION_CREATED:"subscription_created",CAPITAL_CALL_CREATED:"capital_call_created",DISTRIBUTION_CREATED:"distribution_created",REPORT_REQUESTED:"report_requested",MESSAGE_SENT:"message_sent",COMMISSION_CREATED:"commission_created",COMMISSION_ACCRUED:"commission_accrued",COMMISSION_INVOICE_REQUESTED:"commission_invoice_requested",COMMISSION_INVOICED:"commission_invoiced",COMMISSION_PAID:"commission_paid",COMMISSION_CANCELLED:"commission_cancelled",AGREEMENT_CREATED:"agreement_created",AGREEMENT_SENT:"agreement_sent",AGREEMENT_APPROVED:"agreement_approved",AGREEMENT_SIGNED:"agreement_signed",AGREEMENT_ACTIVATED:"agreement_activated",AGREEMENT_REJECTED:"agreement_rejected",AGREEMENT_EXPIRED:"agreement_expired"},"AuditEntities",0,{USERS:"users",PROFILES:"profiles",INVESTORS:"investors",VEHICLES:"vehicles",SUBSCRIPTIONS:"subscriptions",POSITIONS:"positions",DOCUMENTS:"documents",WORKFLOWS:"workflows",WORKFLOW_RUNS:"workflow_runs",CONVERSATIONS:"conversations",MESSAGES:"messages",REQUEST_TICKETS:"request_tickets",CAPITAL_CALLS:"capital_calls",DISTRIBUTIONS:"distributions",DEALS:"deals",ALLOCATIONS:"allocations",FEE_EVENTS:"fee_events",INVOICES:"invoices",BANK_TRANSACTIONS:"bank_transactions",PAYMENTS:"payments",ARRANGER:"arranger_entities",INTRODUCER:"introducers",PARTNER:"partners",COMMERCIAL_PARTNER:"commercial_partners",FEE_PLANS:"arranger_fee_plans",CEO_ENTITY:"ceo_entity",CEO_USERS:"ceo_users",INTRODUCER_COMMISSIONS:"introducer_commissions",PARTNER_COMMISSIONS:"partner_commissions",COMMERCIAL_PARTNER_COMMISSIONS:"commercial_partner_commissions",INTRODUCER_AGREEMENTS:"introducer_agreements",PARTNER_AGREEMENTS:"partner_agreements",COMMERCIAL_PARTNER_AGREEMENTS:"commercial_partner_agreements",INTRODUCTIONS:"introductions"},"auditLogger",0,o])},254799,(e,t,r)=>{t.exports=e.x("crypto",()=>require("crypto"))},400589,e=>{"use strict";async function t(e){let{data:t,error:r}=await e.from("ceo_users").select("user_id, can_sign, is_primary, title").eq("can_sign",!0).order("is_primary",{ascending:!1}).order("created_at",{ascending:!0}).limit(1).maybeSingle();if(r)return console.error("[ceo-signer] Failed to load CEO signer:",r),null;if(!t)return console.warn("[ceo-signer] No CEO signer found with can_sign = true"),null;let{data:o,error:n}=await e.from("profiles").select("id, email, display_name").eq("id",t.user_id).single();return n||!o?(console.error("[ceo-signer] Failed to load profile for signer:",n),null):{id:o.id,email:o.email||"",displayName:o.display_name||o.email?.split("@")[0]||"CEO",title:t.title,canSign:t.can_sign??!1}}e.s(["getCeoSigner",()=>t])},751966,e=>{"use strict";var t=e.i(433669),r=e.i(254799);async function o({workflowKey:e,payload:o,entityType:n,entityId:i,user:s}){try{let a=(0,t.createServiceClient)(),{data:c,error:l}=await a.from("workflows").select("*").eq("key",e).eq("is_active",!0).single();if(l||!c)return console.error("Workflow not found:",e),{success:!1,error:"Workflow not found"};let d=r.default.createHash("sha256").update(`${c.id}:${s.id}:${JSON.stringify(o)}`).digest("hex"),u=process.env.N8N_WEBHOOK_SECRET||process.env.N8N_OUTBOUND_SECRET;if(!u)return console.error("N8N_WEBHOOK_SECRET not configured"),{success:!1,error:"Webhook authentication not configured. Cannot trigger workflow."};if("default-webhook-secret"===u)return console.error("CRITICAL: N8N_WEBHOOK_SECRET using insecure default value in production"),{success:!1,error:"Webhook authentication misconfigured. Please set a secure N8N_WEBHOOK_SECRET."};let _=r.default.createHmac("sha256",u).update(d).digest("hex"),{data:E,error:p}=await a.from("workflow_runs").insert({workflow_id:c.id,workflow_key:c.key,triggered_by:s.id,entity_type:n??"process",entity_id:i||null,input_params:o,status:"queued",idempotency_token:d,webhook_signature:_}).select().single();if(p||!E)return console.error("Failed to create workflow run:",p),{success:!1,error:"Failed to create workflow run"};let f={workflow_run_id:E.id,workflow_key:c.key,triggered_by:{id:s.id,email:s.email,display_name:s.displayName,role:s.role,title:s.title},payload:o,entity_type:E.entity_type},m=await fetch(c.n8n_webhook_url,{method:"POST",headers:{"Content-Type":"application/json","x-verso-signature":_,"x-idempotency-key":d,"x-workflow-run-id":E.id},body:JSON.stringify(f)}),g=m.headers.get("content-type")||"",S={};if(["application/octet-stream","application/vnd.openxmlformats-officedocument","application/msword","application/pdf","application/zip","image/","video/","audio/"].some(e=>g.includes(e))){console.log("ðŸ” Detected binary response, Content-Type:",g);let e=await m.arrayBuffer(),t=Buffer.from(e),r=function(e){let t=e.get("content-disposition");if(!t)return;let r=t.match(/filename[^;=\n]*=((['"]).*?\2|[^;\n]*)/);if(r&&r[1])return r[1].replace(/['"]/g,"")}(m.headers),o=t.slice(0,4).toString("hex");console.log("ðŸ“„ Binary file signature:",o,"size:",t.length,"bytes"),S={binary:t,filename:r,mimeType:g,size:t.length,signature:o}}else if(g.includes("application/json")){let e=await m.text();try{S=JSON.parse(e)}catch(t){console.warn("âš ï¸ Failed to parse JSON response:",t),S={raw:e}}}else{let e=await m.text();try{S=JSON.parse(e)}catch{console.log("âš ï¸ Unknown content type, treating as potential binary string"),S={raw:e}}}if(!m.ok){let e=S.raw?`Failed to trigger n8n: ${S.raw}`:`Failed to trigger n8n: ${m.status} ${m.statusText}`;return await a.from("workflow_runs").update({status:"failed",error_message:e,completed_at:new Date().toISOString()}).eq("id",E.id),{success:!1,error:"Failed to trigger n8n webhook"}}return await a.from("workflow_runs").update({status:"running",started_at:new Date().toISOString(),output_data:S}).eq("id",E.id),await a.from("audit_logs").insert({event_type:"workflow",actor_id:s.id,action:"workflow_triggered",entity_type:"workflow_runs",entity_id:E.id,action_details:{workflow_key:c.key,payload:o,entity_type:E.entity_type},timestamp:new Date().toISOString()}),{success:!0,workflow_run_id:E.id,n8n_response:S}}catch(e){return console.error("Workflow trigger error:",e),{success:!1,error:"Internal error triggering workflow"}}}e.s(["triggerWorkflow",()=>o])},66044,e=>{"use strict";let t=process.env.GOTENBERG_URL||"http://gotenberg:3000";async function r(e,o="document.docx"){try{console.log("ðŸ“„ [GOTENBERG] Starting DOCX to PDF conversion:",{input_size:e.length,filename:o});let r=`${t}/forms/libreoffice/convert`,n=new FormData,i=new Blob([new Uint8Array(e)],{type:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"});n.append("files",i,o);let s=await fetch(r,{method:"POST",body:n});if(!s.ok){let e=await s.text();return console.error("âŒ [GOTENBERG] Conversion failed:",{status:s.status,statusText:s.statusText,error:e}),{success:!1,error:`Gotenberg conversion failed: ${s.status} ${s.statusText}`}}let a=await s.arrayBuffer(),c=Buffer.from(a);return console.log("âœ… [GOTENBERG] Conversion successful:",{input_size:e.length,output_size:c.length}),{success:!0,pdfBuffer:c}}catch(e){return console.error("âŒ [GOTENBERG] Conversion error:",e),{success:!1,error:e instanceof Error?e.message:"Unknown conversion error"}}}async function o(e,r="document.html"){try{let o=`${t}/forms/chromium/convert/html`,n=new FormData,i=new Blob([e],{type:"text/html"});n.append("files",i,r);let s=await fetch(o,{method:"POST",body:n});if(!s.ok){let e=await s.text();return{success:!1,error:`HTML to PDF conversion failed: ${s.status} - ${e}`}}let a=await s.arrayBuffer();return{success:!0,pdfBuffer:Buffer.from(a)}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Unknown error"}}}e.s(["convertDocxToPdf",()=>r,"convertHtmlToPdf",()=>o])},261365,e=>{e.v(e=>Promise.resolve().then(()=>e(368899)))}];

//# sourceMappingURL=%5Broot-of-the-server%5D__3fa39d4e._.js.map