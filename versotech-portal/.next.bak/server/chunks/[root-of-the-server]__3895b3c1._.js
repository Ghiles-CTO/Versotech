module.exports=[918622,(e,t,n)=>{t.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},556704,(e,t,n)=>{t.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},832319,(e,t,n)=>{t.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},324725,(e,t,n)=>{t.exports=e.x("next/dist/server/app-render/after-task-async-storage.external.js",()=>require("next/dist/server/app-render/after-task-async-storage.external.js"))},270406,(e,t,n)=>{t.exports=e.x("next/dist/compiled/@opentelemetry/api",()=>require("next/dist/compiled/@opentelemetry/api"))},193695,(e,t,n)=>{t.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},433669,e=>{"use strict";e.i(814247);var t=e.i(150615),n=e.i(12049),i=e.i(57824);let s=async()=>{let e=await (0,i.cookies)();return(0,t.createServerClient)("https://ipguxdssecfexudnvtia.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlwZ3V4ZHNzZWNmZXh1ZG52dGlhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTgzNjE4MzcsImV4cCI6MjA3MzkzNzgzN30.AGxM_YW9hfxuu7xDpi_4xhOoRhYM7iGTS1vJ0z2FByE",{cookies:{getAll:()=>e.getAll(),setAll(t){try{t.forEach(({name:t,value:n,options:i})=>{e.set(t,n,i)})}catch(e){}}}})};e.s(["createClient",0,s,"createServiceClient",0,()=>(0,n.createClient)("https://ipguxdssecfexudnvtia.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY,{auth:{autoRefreshToken:!1,persistSession:!1}})])},911357,e=>{"use strict";var t=e.i(433669);class n{static instance;static getInstance(){return n.instance||(n.instance=new n),n.instance}async log(e){try{let n=await (0,t.createClient)();await n.from("audit_logs").insert({event_type:"system",actor_id:e.actor_user_id||null,action:e.action,entity_type:e.entity,entity_id:e.entity_id||null,action_details:e.metadata||null,timestamp:new Date().toISOString()})}catch(e){console.error("Audit logging failed:",e)}}async logMany(e){for(let t of e)await this.log(t)}}let i=n.getInstance();e.s(["AuditActions",0,{LOGIN:"login",LOGOUT:"logout",PASSWORD_CHANGE:"password_change",CREATE:"create",READ:"read",UPDATE:"update",DELETE:"delete",DOCUMENT_UPLOAD:"document_upload",DOCUMENT_DOWNLOAD:"document_download",DOCUMENT_DELETE:"document_delete",WORKFLOW_TRIGGER:"workflow_trigger",WORKFLOW_COMPLETED:"workflow_completed",WORKFLOW_FAILED:"workflow_failed",USER_CREATED:"user_created",PROFILE_UPDATED:"profile_updated",ROLE_CHANGED:"role_changed",SUBSCRIPTION_CREATED:"subscription_created",CAPITAL_CALL_CREATED:"capital_call_created",DISTRIBUTION_CREATED:"distribution_created",REPORT_REQUESTED:"report_requested",MESSAGE_SENT:"message_sent",COMMISSION_CREATED:"commission_created",COMMISSION_ACCRUED:"commission_accrued",COMMISSION_INVOICE_REQUESTED:"commission_invoice_requested",COMMISSION_INVOICED:"commission_invoiced",COMMISSION_PAID:"commission_paid",COMMISSION_CANCELLED:"commission_cancelled",AGREEMENT_CREATED:"agreement_created",AGREEMENT_SENT:"agreement_sent",AGREEMENT_APPROVED:"agreement_approved",AGREEMENT_SIGNED:"agreement_signed",AGREEMENT_ACTIVATED:"agreement_activated",AGREEMENT_REJECTED:"agreement_rejected",AGREEMENT_EXPIRED:"agreement_expired"},"AuditEntities",0,{USERS:"users",PROFILES:"profiles",INVESTORS:"investors",VEHICLES:"vehicles",SUBSCRIPTIONS:"subscriptions",POSITIONS:"positions",DOCUMENTS:"documents",WORKFLOWS:"workflows",WORKFLOW_RUNS:"workflow_runs",CONVERSATIONS:"conversations",MESSAGES:"messages",REQUEST_TICKETS:"request_tickets",CAPITAL_CALLS:"capital_calls",DISTRIBUTIONS:"distributions",DEALS:"deals",ALLOCATIONS:"allocations",FEE_EVENTS:"fee_events",INVOICES:"invoices",BANK_TRANSACTIONS:"bank_transactions",PAYMENTS:"payments",ARRANGER:"arranger_entities",INTRODUCER:"introducers",PARTNER:"partners",COMMERCIAL_PARTNER:"commercial_partners",FEE_PLANS:"arranger_fee_plans",CEO_ENTITY:"ceo_entity",CEO_USERS:"ceo_users",INTRODUCER_COMMISSIONS:"introducer_commissions",PARTNER_COMMISSIONS:"partner_commissions",COMMERCIAL_PARTNER_COMMISSIONS:"commercial_partner_commissions",INTRODUCER_AGREEMENTS:"introducer_agreements",PARTNER_AGREEMENTS:"partner_agreements",COMMERCIAL_PARTNER_AGREEMENTS:"commercial_partner_agreements",INTRODUCTIONS:"introductions"},"auditLogger",0,i])},221640,e=>{"use strict";async function t(e){let{data:{user:t},error:n}=await e.auth.getUser();return{user:t,error:n}}async function n(e,t){let{data:n}=await e.from("profiles").select("role").eq("id",t.id).single();return n?.role||null}async function i(e,t,n){let{data:i}=await e.from("profiles").select("role").eq("id",t).single();if(i?.role==="ceo")return!0;let{data:s}=await e.from("ceo_users").select("user_id").eq("user_id",t).maybeSingle();if(s)return!0;let{data:r}=await e.from("staff_permissions").select("permission").eq("user_id",t).in("permission",n).limit(1).maybeSingle();return!!r}async function s(e,t){return i(e,t,["super_admin"])}async function r(e,t){let i=await n(e,t);if(i&&(i.startsWith("staff_")||"ceo"===i))return!0;if("multi_persona"===i)try{let{data:n}=await e.rpc("get_user_personas",{p_user_id:t.id});if(n&&Array.isArray(n))return n.some(e=>"staff"===e.persona_type||"ceo"===e.persona_type)}catch(e){console.error("[isStaffUser] Error checking personas:",e)}return!1}e.s(["getAuthenticatedUser",()=>t,"hasPermission",()=>i,"isStaffUser",()=>r,"isSuperAdmin",()=>s])},254799,(e,t,n)=>{t.exports=e.x("crypto",()=>require("crypto"))},589912,e=>{"use strict";var t=e.i(254799);let n={active:0,committed:1,pending:2,closed:3,cancelled:4,archived:5},i={funded:"active",active:"active",pending:"pending",pending_funding:"pending",committed:"committed",closed:"closed",cancelled:"cancelled"};function s(e,n){return{id:n.id??(0,t.randomUUID)(),commitment:n.commitment??null,currency:n.currency??null,status:n.status??null,effective_date:n.effective_date??null,funding_due_at:n.funding_due_at??null,units:n.units??null,acknowledgement_notes:n.acknowledgement_notes??null,created_at:n.created_at??null,origin:e}}function r(e){return s("holding_projection",{id:e.subscription_submission_id??`holding-${e.id}`,commitment:e.subscribed_amount??null,currency:e.currency??null,status:i[e.status??"pending"]??"pending",effective_date:e.effective_date??null,funding_due_at:e.funding_due_at??null,units:null,acknowledgement_notes:null,created_at:e.created_at??null})}function o(e){let t=e.reduce((e,t)=>e+(t.commitment??0),0);return t>0?t:null}function a(e){let t=e.reduce((e,t)=>e+(t.subscribed_amount??0),0);return t>0?t:null}function l(e){return 0===e.length?null:[...e].sort((e,t)=>{let n=e.created_at?new Date(e.created_at).getTime():0;return(t.created_at?new Date(t.created_at).getTime():0)-n})[0]??null}function c({entityInvestors:e=[],subscriptions:t=[],holdings:c=[],deals:u=[]}){let d=new Map,_=new Set,p=new Map;for(let m of(u?.forEach(e=>{e?.id&&p.set(e.id,e.name??null)}),e?.forEach(e=>{let t=e.investor?.id??e.investor_id??e.id,n=[];if(e.subscription){let t=s("linked",e.subscription);n.push(t),_.add(t.id)}let i={id:e.id,relationship_role:e.relationship_role??null,allocation_status:e.allocation_status??null,invite_sent_at:e.invite_sent_at??null,created_at:e.created_at,updated_at:e.updated_at??null,notes:e.notes??null,investor:e.investor??null,subscription:l(n),subscriptions:n,holdings:[],total_commitment:o(n),total_holdings_amount:null,source:"entity_link"};d.set(t,i)}),t?.forEach(e=>{if(!e?.investor_id||_.has(e.id))return;let t=s("auto_discovered",e);_.add(t.id);let n=d.get(e.investor_id);if(n)n.subscriptions=n.subscriptions??[],n.subscriptions.push(t),n.subscription=l(n.subscriptions),n.total_commitment=o(n.subscriptions),n.source="entity_link"===n.source&&(n.holdings?.length??0)>0?"hybrid":"entity_link"===n.source?"entity_link":"subscription_only",n.investor||(n.investor=e.investor??null);else{let n={id:`subscription-${e.id}`,relationship_role:"Subscription Holder",allocation_status:e.status??"pending",invite_sent_at:null,created_at:e.created_at??new Date().toISOString(),updated_at:null,notes:"Auto-discovered via subscription record",investor:e.investor??null,subscription:t,subscriptions:[t],holdings:[],total_commitment:t.commitment??null,total_holdings_amount:null,source:"subscription_only"};d.set(e.investor_id,n)}}),c?.forEach(e=>{let t;if(!e?.investor_id)return;let n=(t=e.deal_id??"unknown",{id:e.id,deal_id:t,deal_name:p.get(t)??null,status:e.status??null,subscribed_amount:e.subscribed_amount??null,currency:e.currency??null,effective_date:e.effective_date??null,funding_due_at:e.funding_due_at??null,funded_at:e.funded_at??null,created_at:e.created_at??null,updated_at:e.updated_at??null}),s=d.get(e.investor_id);if(s){if(s.holdings=s.holdings??[],s.holdings.some(e=>e.id===n.id)||s.holdings.push(n),s.total_holdings_amount=a(s.holdings),!s.subscription&&s.subscriptions&&0===s.subscriptions.length){let t=r(e);s.subscriptions=[t],s.subscription=t,s.total_commitment=o(s.subscriptions)}s.investor||(s.investor=e.investor??null),s.source="entity_link"===s.source?(s.subscriptions?.length??0)>0?"hybrid":"entity_link":(s.subscriptions?.length??0)>0?"hybrid":"holding_only"}else{let t=r(e),s={id:`holding-${e.id}`,relationship_role:"Holding Participant",allocation_status:i[e.status??"pending"]??"pending",invite_sent_at:null,created_at:e.created_at??new Date().toISOString(),updated_at:e.updated_at??null,notes:`Auto-discovered holding for deal ${n.deal_name??e.deal_id??""}`.trim(),investor:e.investor??null,subscription:t,subscriptions:[t],holdings:[n],total_commitment:t.commitment??null,total_holdings_amount:n.subscribed_amount??null,source:"holding_only"};d.set(e.investor_id,s)}}),d.values())){m.subscriptions=m.subscriptions??[],m.holdings=m.holdings??[],m.total_commitment=o(m.subscriptions),m.total_holdings_amount=a(m.holdings),m.subscription=l(m.subscriptions),m.allocation_status=function(e,t,s){let r=[e??null,0===t.length?null:t.map(e=>e.status??"pending").sort((e,t)=>(n[e]??99)-(n[t]??99))[0]??null,0===s.length?null:s.map(e=>i[e.status??"pending"]??"pending").sort((e,t)=>(n[e]??99)-(n[t]??99))[0]??null].filter(e=>!!e);return 0===r.length?"pending":r.sort((e,t)=>(n[e]??99)-(n[t]??99))[0]}(m.allocation_status,m.subscriptions,m.holdings);let e="entity_link"===m.source,t=(m.subscriptions?.length??0)>0,s=(m.holdings?.length??0)>0;e&&(t||s)||!e&&t&&s?m.source="hybrid":e||!t||s?e||t||!s||(m.source="holding_only"):m.source="subscription_only"}return Array.from(d.values()).sort((e,t)=>{let n=e.created_at?new Date(e.created_at).getTime():0;return(t.created_at?new Date(t.created_at).getTime():0)-n})}e.s(["mergeEntityInvestorData",()=>c])},261365,e=>{e.v(e=>Promise.resolve().then(()=>e(368899)))}];

//# sourceMappingURL=%5Broot-of-the-server%5D__3895b3c1._.js.map