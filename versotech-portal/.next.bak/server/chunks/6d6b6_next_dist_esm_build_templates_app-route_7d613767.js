module.exports=[299748,e=>{"use strict";var t=e.i(779444),n=e.i(698261),r=e.i(821776),i=e.i(796417),a=e.i(856890),o=e.i(26996),l=e.i(436944),s=e.i(88281),u=e.i(765944),d=e.i(984788),p=e.i(237011),_=e.i(712007),c=e.i(777657),m=e.i(13180),f=e.i(273827),h=e.i(193695);e.i(947956);var b=e.i(36217),g=e.i(433669),y=e.i(414131),v=e.i(107854);let R={ubo:"beneficial_owner",signatory:"authorized_signatory",authorized_representative:"authorized_signatory",beneficiary:"beneficial_owner"},x=v.z.object({full_name:v.z.string().optional().nullable(),first_name:v.z.string().optional().nullable(),middle_name:v.z.string().optional().nullable(),last_name:v.z.string().optional().nullable(),name_suffix:v.z.string().optional().nullable(),role:v.z.string().min(1,"Role is required"),role_title:v.z.string().optional().nullable(),email:v.z.string().email().optional().nullable().or(v.z.literal("")),phone:v.z.string().optional().nullable(),phone_mobile:v.z.string().optional().nullable(),phone_office:v.z.string().optional().nullable(),residential_street:v.z.string().optional().nullable(),residential_line_2:v.z.string().optional().nullable(),residential_city:v.z.string().optional().nullable(),residential_state:v.z.string().optional().nullable(),residential_postal_code:v.z.string().optional().nullable(),residential_country:v.z.string().optional().nullable(),nationality:v.z.string().optional().nullable(),date_of_birth:v.z.string().optional().nullable(),country_of_birth:v.z.string().optional().nullable(),is_us_citizen:v.z.boolean().optional(),is_us_taxpayer:v.z.boolean().optional(),us_taxpayer_id:v.z.string().optional().nullable(),country_of_tax_residency:v.z.string().optional().nullable(),tax_id_number:v.z.string().optional().nullable(),id_type:v.z.string().optional().nullable(),id_number:v.z.string().optional().nullable(),id_issue_date:v.z.string().optional().nullable(),id_expiry_date:v.z.string().optional().nullable(),id_issuing_country:v.z.string().optional().nullable(),ownership_percentage:v.z.number().min(0).max(100).optional().nullable(),is_beneficial_owner:v.z.boolean().optional(),is_signatory:v.z.boolean().optional(),effective_from:v.z.string().optional().nullable()});async function w(e){let t=await (0,g.createClient)(),n=(0,g.createServiceClient)();try{let{data:{user:e},error:r}=await t.auth.getUser();if(r||!e)return y.NextResponse.json({error:"Unauthorized"},{status:401});let{data:i,error:a}=await n.from("investor_users").select("investor_id").eq("user_id",e.id);if(a||!i||0===i.length)return y.NextResponse.json({error:"No investor profile found"},{status:404});let o=i.map(e=>e.investor_id),{data:l,error:s}=await n.from("investors").select("id, type, display_name").in("id",o).in("type",["entity","institutional"]);if(s)return console.error("Error fetching investors:",s),y.NextResponse.json({error:"Failed to fetch investor info"},{status:500});if(!l||0===l.length)return y.NextResponse.json({members:[],message:"Not an entity-type investor"});let u=l.map(e=>e.id),{data:d,error:p}=await n.from("investor_members").select("*").in("investor_id",u).eq("is_active",!0).order("created_at",{ascending:!1});if(p)return console.error("Error fetching members:",p),y.NextResponse.json({error:"Failed to fetch members"},{status:500});return y.NextResponse.json({members:d||[],investors:l})}catch(e){return console.error("Unexpected error in GET /api/investors/me/members:",e),y.NextResponse.json({error:"Internal server error"},{status:500})}}async function z(e){let t=await (0,g.createClient)(),n=(0,g.createServiceClient)();try{let{data:{user:r},error:i}=await t.auth.getUser();if(i||!r)return y.NextResponse.json({error:"Unauthorized"},{status:401});let{data:a,error:o}=await n.from("investor_users").select("investor_id").eq("user_id",r.id).limit(1);if(o||!a||0===a.length)return y.NextResponse.json({error:"No investor profile found"},{status:404});let l=a[0].investor_id,{data:s,error:u}=await n.from("investors").select("id, type").eq("id",l).single();if(u||!s)return y.NextResponse.json({error:"Investor not found"},{status:404});if(!["entity","institutional"].includes(s.type||""))return y.NextResponse.json({error:"Members can only be added to entity-type investors"},{status:400});let d=await e.json(),p=x.safeParse(d);if(!p.success)return y.NextResponse.json({error:"Invalid request body",details:p.error.flatten()},{status:400});let _=p.data,c=_.full_name;if(!c&&(_.first_name||_.last_name)&&(c=[_.first_name,_.middle_name,_.last_name,_.name_suffix].filter(Boolean).join(" ")),!c)return y.NextResponse.json({error:"Name is required (either full_name or first_name/last_name)"},{status:400});let m=R[_.role]||_.role,f=_.is_beneficial_owner||["ubo","beneficial_owner","beneficiary"].includes(_.role),h=_.is_signatory||["signatory","authorized_signatory","authorized_representative"].includes(_.role),{data:b,error:g}=await n.from("investor_members").insert({investor_id:l,full_name:c,first_name:_.first_name||null,middle_name:_.middle_name||null,last_name:_.last_name||null,name_suffix:_.name_suffix||null,role:m,role_title:_.role_title||null,email:_.email||null,phone:_.phone||_.phone_mobile||null,phone_mobile:_.phone_mobile||null,phone_office:_.phone_office||null,residential_street:_.residential_street||null,residential_line_2:_.residential_line_2||null,residential_city:_.residential_city||null,residential_state:_.residential_state||null,residential_postal_code:_.residential_postal_code||null,residential_country:_.residential_country||null,nationality:_.nationality||null,date_of_birth:_.date_of_birth||null,country_of_birth:_.country_of_birth||null,is_us_citizen:_.is_us_citizen||!1,is_us_taxpayer:_.is_us_taxpayer||!1,us_taxpayer_id:_.us_taxpayer_id||null,country_of_tax_residency:_.country_of_tax_residency||null,tax_id_number:_.tax_id_number||null,id_type:_.id_type||null,id_number:_.id_number||null,id_issue_date:_.id_issue_date||null,id_expiry_date:_.id_expiry_date||null,id_issuing_country:_.id_issuing_country||null,ownership_percentage:_.ownership_percentage||null,is_beneficial_owner:f,is_signatory:h,effective_from:_.effective_from||new Date().toISOString().split("T")[0],created_by:r.id,kyc_status:"pending"}).select().single();if(g)return console.error("Error creating member:",g),console.error("Insert data was:",{investor_id:l,full_name:c,role:m,first_name:_.first_name,last_name:_.last_name}),y.NextResponse.json({error:"Failed to create member",details:g.message},{status:500});return y.NextResponse.json({member:b},{status:201})}catch(e){return console.error("Unexpected error in POST /api/investors/me/members:",e),y.NextResponse.json({error:"Internal server error"},{status:500})}}e.s(["GET",()=>w,"POST",()=>z],684668);var E=e.i(684668);let N=new t.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/investors/me/members/route",pathname:"/api/investors/me/members",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/versotech-portal/src/app/api/investors/me/members/route.ts",nextConfigOutput:"",userland:E}),{workAsyncStorage:C,workUnitAsyncStorage:A,serverHooks:T}=N;function j(){return(0,r.patchFetch)({workAsyncStorage:C,workUnitAsyncStorage:A})}async function P(e,t,r){N.isDev&&(0,i.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let g="/api/investors/me/members/route";g=g.replace(/\/index$/,"")||"/";let y=await N.prepare(e,t,{srcPage:g,multiZoneDraftMode:!1});if(!y)return t.statusCode=400,t.end("Bad Request"),null==r.waitUntil||r.waitUntil.call(r,Promise.resolve()),null;let{buildId:v,params:R,nextConfig:x,parsedUrl:w,isDraftMode:z,prerenderManifest:E,routerServerContext:C,isOnDemandRevalidate:A,revalidateOnlyGenerated:T,resolvedPathname:j,clientReferenceManifest:P,serverActionsManifest:S}=y,O=(0,l.normalizeAppPath)(g),U=!!(E.dynamicRoutes[O]||E.routes[j]),q=async()=>((null==C?void 0:C.render404)?await C.render404(e,t,w,!1):t.end("This page could not be found"),null);if(U&&!z){let e=!!E.routes[j],t=E.dynamicRoutes[O];if(t&&!1===t.fallback&&!e){if(x.experimental.adapterPath)return await q();throw new h.NoFallbackError}}let I=null;!U||N.isDev||z||(I="/index"===(I=j)?"/":I);let H=!0===N.isDev||!U,k=U&&!H;S&&P&&(0,o.setManifestsSingleton)({page:g,clientReferenceManifest:P,serverActionsManifest:S});let D=e.method||"GET",M=(0,a.getTracer)(),F=M.getActiveScopeSpan(),$={params:R,prerenderManifest:E,renderOpts:{experimental:{authInterrupts:!!x.experimental.authInterrupts},cacheComponents:!!x.cacheComponents,supportsDynamicResponse:H,incrementalCache:(0,i.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:x.cacheLife,waitUntil:r.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,n,r,i)=>N.onRequestError(e,t,r,i,C)},sharedContext:{buildId:v}},K=new s.NodeNextRequest(e),B=new s.NodeNextResponse(t),G=u.NextRequestAdapter.fromNodeNextRequest(K,(0,u.signalFromNodeResponse)(t));try{let o=async e=>N.handle(G,$).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let n=M.getRootSpanAttributes();if(!n)return;if(n.get("next.span_type")!==d.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${n.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let r=n.get("next.route");if(r){let t=`${D} ${r}`;e.setAttributes({"next.route":r,"http.route":r,"next.span_name":t}),e.updateName(t)}else e.updateName(`${D} ${g}`)}),l=!!(0,i.getRequestMeta)(e,"minimalMode"),s=async i=>{var a,s;let u=async({previousCacheEntry:n})=>{try{if(!l&&A&&T&&!n)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let a=await o(i);e.fetchMetrics=$.renderOpts.fetchMetrics;let s=$.renderOpts.pendingWaitUntil;s&&r.waitUntil&&(r.waitUntil(s),s=void 0);let u=$.renderOpts.collectedTags;if(!U)return await (0,_.sendResponse)(K,B,a,$.renderOpts.pendingWaitUntil),null;{let e=await a.blob(),t=(0,c.toNodeOutgoingHttpHeaders)(a.headers);u&&(t[f.NEXT_CACHE_TAGS_HEADER]=u),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let n=void 0!==$.renderOpts.collectedRevalidate&&!($.renderOpts.collectedRevalidate>=f.INFINITE_CACHE)&&$.renderOpts.collectedRevalidate,r=void 0===$.renderOpts.collectedExpire||$.renderOpts.collectedExpire>=f.INFINITE_CACHE?void 0:$.renderOpts.collectedExpire;return{value:{kind:b.CachedRouteKind.APP_ROUTE,status:a.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:n,expire:r}}}}catch(t){throw(null==n?void 0:n.isStale)&&await N.onRequestError(e,t,{routerKind:"App Router",routePath:g,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:k,isOnDemandRevalidate:A})},!1,C),t}},d=await N.handleResponse({req:e,nextConfig:x,cacheKey:I,routeKind:n.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:E,isRoutePPREnabled:!1,isOnDemandRevalidate:A,revalidateOnlyGenerated:T,responseGenerator:u,waitUntil:r.waitUntil,isMinimalMode:l});if(!U)return null;if((null==d||null==(a=d.value)?void 0:a.kind)!==b.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==d||null==(s=d.value)?void 0:s.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});l||t.setHeader("x-nextjs-cache",A?"REVALIDATED":d.isMiss?"MISS":d.isStale?"STALE":"HIT"),z&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let h=(0,c.fromNodeOutgoingHttpHeaders)(d.value.headers);return l&&U||h.delete(f.NEXT_CACHE_TAGS_HEADER),!d.cacheControl||t.getHeader("Cache-Control")||h.get("Cache-Control")||h.set("Cache-Control",(0,m.getCacheControlHeader)(d.cacheControl)),await (0,_.sendResponse)(K,B,new Response(d.value.body,{headers:h,status:d.value.status||200})),null};F?await s(F):await M.withPropagatedContext(e.headers,()=>M.trace(d.BaseServerSpan.handleRequest,{spanName:`${D} ${g}`,kind:a.SpanKind.SERVER,attributes:{"http.method":D,"http.target":e.url}},s))}catch(t){if(t instanceof h.NoFallbackError||await N.onRequestError(e,t,{routerKind:"App Router",routePath:O,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:k,isOnDemandRevalidate:A})},!1,C),U)throw t;return await (0,_.sendResponse)(K,B,new Response(null,{status:500})),null}}e.s(["handler",()=>P,"patchFetch",()=>j,"routeModule",()=>N,"serverHooks",()=>T,"workAsyncStorage",()=>C,"workUnitAsyncStorage",()=>A],299748)}];

//# sourceMappingURL=6d6b6_next_dist_esm_build_templates_app-route_7d613767.js.map