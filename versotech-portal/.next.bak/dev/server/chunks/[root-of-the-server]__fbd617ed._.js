module.exports = [
"[externals]/next/dist/compiled/next-server/app-route-turbo.runtime.dev.js [external] (next/dist/compiled/next-server/app-route-turbo.runtime.dev.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/compiled/next-server/app-route-turbo.runtime.dev.js", () => require("next/dist/compiled/next-server/app-route-turbo.runtime.dev.js"));

module.exports = mod;
}),
"[externals]/next/dist/compiled/@opentelemetry/api [external] (next/dist/compiled/@opentelemetry/api, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/compiled/@opentelemetry/api", () => require("next/dist/compiled/@opentelemetry/api"));

module.exports = mod;
}),
"[externals]/next/dist/compiled/next-server/app-page-turbo.runtime.dev.js [external] (next/dist/compiled/next-server/app-page-turbo.runtime.dev.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/compiled/next-server/app-page-turbo.runtime.dev.js", () => require("next/dist/compiled/next-server/app-page-turbo.runtime.dev.js"));

module.exports = mod;
}),
"[externals]/next/dist/server/app-render/work-unit-async-storage.external.js [external] (next/dist/server/app-render/work-unit-async-storage.external.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/server/app-render/work-unit-async-storage.external.js", () => require("next/dist/server/app-render/work-unit-async-storage.external.js"));

module.exports = mod;
}),
"[externals]/next/dist/server/app-render/work-async-storage.external.js [external] (next/dist/server/app-render/work-async-storage.external.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/server/app-render/work-async-storage.external.js", () => require("next/dist/server/app-render/work-async-storage.external.js"));

module.exports = mod;
}),
"[externals]/next/dist/shared/lib/no-fallback-error.external.js [external] (next/dist/shared/lib/no-fallback-error.external.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/shared/lib/no-fallback-error.external.js", () => require("next/dist/shared/lib/no-fallback-error.external.js"));

module.exports = mod;
}),
"[externals]/next/dist/server/app-render/after-task-async-storage.external.js [external] (next/dist/server/app-render/after-task-async-storage.external.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/server/app-render/after-task-async-storage.external.js", () => require("next/dist/server/app-render/after-task-async-storage.external.js"));

module.exports = mod;
}),
"[externals]/stream [external] (stream, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("stream", () => require("stream"));

module.exports = mod;
}),
"[externals]/http [external] (http, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("http", () => require("http"));

module.exports = mod;
}),
"[externals]/url [external] (url, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("url", () => require("url"));

module.exports = mod;
}),
"[externals]/punycode [external] (punycode, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("punycode", () => require("punycode"));

module.exports = mod;
}),
"[externals]/https [external] (https, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("https", () => require("https"));

module.exports = mod;
}),
"[externals]/zlib [external] (zlib, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("zlib", () => require("zlib"));

module.exports = mod;
}),
"[project]/versotech-portal/src/lib/supabase/server.ts [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "createClient",
    ()=>createClient,
    "createServiceClient",
    ()=>createServiceClient
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$versotech$2d$portal$2f$node_modules$2f40$supabase$2f$ssr$2f$dist$2f$module$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/versotech-portal/node_modules/@supabase/ssr/dist/module/index.js [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$versotech$2d$portal$2f$node_modules$2f40$supabase$2f$ssr$2f$dist$2f$module$2f$createServerClient$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/versotech-portal/node_modules/@supabase/ssr/dist/module/createServerClient.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$versotech$2d$portal$2f$node_modules$2f40$supabase$2f$supabase$2d$js$2f$dist$2f$module$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/versotech-portal/node_modules/@supabase/supabase-js/dist/module/index.js [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$versotech$2d$portal$2f$node_modules$2f$next$2f$headers$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/versotech-portal/node_modules/next/headers.js [app-route] (ecmascript)");
;
;
;
const createClient = async ()=>{
    const cookieStore = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$versotech$2d$portal$2f$node_modules$2f$next$2f$headers$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["cookies"])();
    return (0, __TURBOPACK__imported__module__$5b$project$5d2f$versotech$2d$portal$2f$node_modules$2f40$supabase$2f$ssr$2f$dist$2f$module$2f$createServerClient$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createServerClient"])(("TURBOPACK compile-time value", "https://ipguxdssecfexudnvtia.supabase.co"), ("TURBOPACK compile-time value", "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlwZ3V4ZHNzZWNmZXh1ZG52dGlhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTgzNjE4MzcsImV4cCI6MjA3MzkzNzgzN30.AGxM_YW9hfxuu7xDpi_4xhOoRhYM7iGTS1vJ0z2FByE"), {
        cookies: {
            getAll () {
                return cookieStore.getAll();
            },
            setAll (cookiesToSet) {
                try {
                    cookiesToSet.forEach(({ name, value, options })=>{
                        cookieStore.set(name, value, options);
                    });
                } catch (error) {
                // The `setAll` method was called from a Server Component.
                // This can be ignored if you have middleware refreshing
                // user sessions.
                }
            }
        }
    });
};
const createServiceClient = ()=>{
    return (0, __TURBOPACK__imported__module__$5b$project$5d2f$versotech$2d$portal$2f$node_modules$2f40$supabase$2f$supabase$2d$js$2f$dist$2f$module$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__["createClient"])(("TURBOPACK compile-time value", "https://ipguxdssecfexudnvtia.supabase.co"), process.env.SUPABASE_SERVICE_ROLE_KEY, {
        auth: {
            autoRefreshToken: false,
            persistSession: false
        }
    });
};
}),
"[project]/versotech-portal/src/constants/kyc-document-types.ts [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

/**
 * KYC Document Types - VERSO Holdings
 *
 * Compulsory KYC documents for all entities including investors, partners,
 * introducers, lawyers, arrangers, and commercial partners.
 */ __turbopack_context__.s([
    "ENTITY_REQUIRED_DOCS",
    ()=>ENTITY_REQUIRED_DOCS,
    "INDIVIDUAL_REQUIRED_DOCS",
    ()=>INDIVIDUAL_REQUIRED_DOCS,
    "MEMBER_REQUIRED_DOCS",
    ()=>MEMBER_REQUIRED_DOCS,
    "SUGGESTED_KYC_DOCUMENT_TYPES",
    ()=>SUGGESTED_KYC_DOCUMENT_TYPES,
    "getDocumentTypeLabel",
    ()=>getDocumentTypeLabel,
    "getEntityDocumentTypes",
    ()=>getEntityDocumentTypes,
    "getIndividualDocumentTypes",
    ()=>getIndividualDocumentTypes,
    "getMemberDocumentTypes",
    ()=>getMemberDocumentTypes,
    "getSuggestedDocumentTypes",
    ()=>getSuggestedDocumentTypes,
    "isPredefinedDocumentType",
    ()=>isPredefinedDocumentType
]);
const SUGGESTED_KYC_DOCUMENT_TYPES = {
    // ===== QUESTIONNAIRE =====
    questionnaire: {
        label: 'KYC Questionnaire',
        description: 'Investor questionnaire responses',
        category: 'both'
    },
    // ===== ENTITY DOCUMENTS - FORMATION =====
    nda_ndnc: {
        label: 'NDA / NDNC',
        description: 'Non-Disclosure and Non-Circumvention Agreement',
        category: 'entity'
    },
    incorporation_certificate: {
        label: 'Incorporation Certificate',
        description: 'Certificate of Incorporation',
        category: 'entity'
    },
    memo_articles: {
        label: 'Memo & Articles of Association',
        description: 'Memorandum and Articles of Association',
        category: 'entity'
    },
    certificate_of_good_standing: {
        label: 'Certificate of Good Standing',
        description: 'Certificate confirming entity is in good standing with registry',
        category: 'entity'
    },
    certificate_of_incumbency: {
        label: 'Certificate of Incumbency',
        description: 'Certificate listing current directors and officers',
        category: 'entity'
    },
    company_register_extract: {
        label: 'Company Register Extract',
        description: 'Official extract from company registry',
        category: 'entity'
    },
    partnership_agreement: {
        label: 'Partnership Agreement',
        description: 'Limited Partnership or General Partnership Agreement',
        category: 'entity'
    },
    operating_agreement: {
        label: 'Operating Agreement',
        description: 'LLC Operating Agreement or equivalent',
        category: 'entity'
    },
    // ===== ENTITY DOCUMENTS - GOVERNANCE =====
    register_members: {
        label: 'Register of Members',
        description: 'Current register of all members/shareholders',
        category: 'entity'
    },
    register_directors: {
        label: 'Register of Directors',
        description: 'Current register of all directors',
        category: 'entity'
    },
    register_beneficial_owners: {
        label: 'Register of Beneficial Owners',
        description: 'Register of ultimate beneficial owners (UBOs)',
        category: 'entity'
    },
    directors_declaration: {
        label: 'Directors Declaration',
        description: 'Signed declaration from board of directors',
        category: 'entity'
    },
    board_resolution: {
        label: 'Board Resolution',
        description: 'Board resolution authorizing investment or account opening',
        category: 'entity'
    },
    authorized_signatory_list: {
        label: 'Authorized Signatory List',
        description: 'List of persons authorized to sign on behalf of entity',
        category: 'entity'
    },
    power_of_attorney: {
        label: 'Power of Attorney',
        description: 'Power of Attorney document',
        category: 'entity'
    },
    // ===== ENTITY DOCUMENTS - FINANCIAL =====
    bank_confirmation: {
        label: 'Bank Confirmation',
        description: 'Confirmation of bank name and jurisdiction for wire transfers',
        category: 'entity'
    },
    financial_statements: {
        label: 'Financial Statements',
        description: 'Audited Financial Statements',
        category: 'entity'
    },
    beneficial_ownership: {
        label: 'Beneficial Ownership Declaration',
        description: 'Declaration of ultimate beneficial owners',
        category: 'entity'
    },
    // ===== TRUST DOCUMENTS =====
    trust_deed: {
        label: 'Trust Deed',
        description: 'Trust Deed or Declaration of Trust',
        category: 'entity'
    },
    trust_schedule: {
        label: 'Trust Schedule',
        description: 'Schedule of beneficiaries and settlors',
        category: 'entity'
    },
    letter_of_wishes: {
        label: 'Letter of Wishes',
        description: 'Settlor letter of wishes',
        category: 'entity'
    },
    // ===== INDIVIDUAL / MEMBER ID DOCUMENTS =====
    passport_id: {
        label: 'ID / Passport',
        description: 'Valid government-issued ID or passport',
        category: 'both'
    },
    passport: {
        label: 'Passport',
        description: 'Valid passport (photo page)',
        category: 'both'
    },
    national_id_card: {
        label: 'National ID Card',
        description: 'Government-issued national identification card',
        category: 'both'
    },
    drivers_license: {
        label: "Driver's License",
        description: 'Government-issued driving license',
        category: 'both'
    },
    residence_permit: {
        label: 'Residence Permit',
        description: 'Valid residence permit or visa',
        category: 'both'
    },
    // ===== PROOF OF ADDRESS DOCUMENTS =====
    utility_bill: {
        label: 'Utility Bill',
        description: 'Recent utility bill (less than 3 months old)',
        category: 'both'
    },
    bank_statement: {
        label: 'Bank Statement',
        description: 'Recent bank statement (less than 3 months old)',
        category: 'both'
    },
    proof_of_address: {
        label: 'Proof of Address',
        description: 'Recent utility bill, bank statement, or official letter',
        category: 'both'
    },
    government_correspondence: {
        label: 'Government Correspondence',
        description: 'Recent letter from government agency with address',
        category: 'both'
    },
    council_tax_bill: {
        label: 'Council Tax Bill',
        description: 'Council tax or property tax statement',
        category: 'both'
    },
    // ===== ACCREDITATION / QUALIFICATION =====
    accreditation_letter: {
        label: 'Accreditation Letter',
        description: 'Accredited Investor verification letter',
        category: 'individual'
    },
    professional_qualification: {
        label: 'Professional Qualification',
        description: 'Professional investor qualification or certification',
        category: 'individual'
    },
    sophistication_declaration: {
        label: 'Sophistication Declaration',
        description: 'Self-certification as sophisticated investor',
        category: 'individual'
    },
    // ===== TAX DOCUMENTS =====
    tax_w8_ben: {
        label: 'W-8BEN / W-8BEN-E',
        description: 'IRS form for foreign persons/entities',
        category: 'both'
    },
    tax_w9: {
        label: 'W-9',
        description: 'IRS form for US persons',
        category: 'individual'
    },
    tax_return: {
        label: 'Tax Return',
        description: 'Recent tax return or tax filing',
        category: 'both'
    },
    tax_residency_certificate: {
        label: 'Tax Residency Certificate',
        description: 'Certificate of tax residency from tax authority',
        category: 'both'
    },
    // ===== AML / SOURCE OF FUNDS =====
    source_of_funds: {
        label: 'Source of Funds',
        description: 'Source of Funds Declaration',
        category: 'both'
    },
    source_of_wealth: {
        label: 'Source of Wealth',
        description: 'Source of Wealth Declaration',
        category: 'both'
    },
    employment_letter: {
        label: 'Employment Letter',
        description: 'Letter confirming employment and salary',
        category: 'individual'
    },
    business_ownership_proof: {
        label: 'Business Ownership Proof',
        description: 'Documentation proving business ownership',
        category: 'both'
    },
    // ===== PARTNER / INTRODUCER SPECIFIC =====
    introducer_agreement: {
        label: 'Introducer Agreement',
        description: 'Signed introducer/referral agreement',
        category: 'entity'
    },
    fee_agreement: {
        label: 'Fee Agreement',
        description: 'Signed fee sharing or commission agreement',
        category: 'entity'
    },
    regulatory_license: {
        label: 'Regulatory License',
        description: 'Financial services or regulatory license',
        category: 'entity'
    },
    professional_indemnity_insurance: {
        label: 'Professional Indemnity Insurance',
        description: 'Certificate of professional indemnity insurance',
        category: 'entity'
    },
    // ===== LAWYER SPECIFIC =====
    practicing_certificate: {
        label: 'Practicing Certificate',
        description: 'Current practicing certificate from bar association',
        category: 'entity'
    },
    bar_membership: {
        label: 'Bar Membership',
        description: 'Bar association membership certificate',
        category: 'entity'
    },
    law_firm_letterhead: {
        label: 'Law Firm Letterhead',
        description: 'Official letterhead confirming association',
        category: 'entity'
    },
    // ===== MEMBER-SPECIFIC DOCUMENTS =====
    member_passport: {
        label: 'Member Passport/ID',
        description: 'Passport or ID for director/UBO/signatory',
        category: 'both',
        memberOnly: true
    },
    member_proof_of_address: {
        label: 'Member Proof of Address',
        description: 'Proof of address for director/UBO/signatory',
        category: 'both',
        memberOnly: true
    },
    specimen_signature: {
        label: 'Specimen Signature',
        description: 'Specimen signature for authorized signatory',
        category: 'both',
        memberOnly: true
    },
    // ===== OTHER =====
    other: {
        label: 'Other Document',
        description: 'Any other supporting document',
        category: 'both'
    }
};
function getDocumentTypeLabel(documentType, customLabel) {
    if (customLabel) {
        return customLabel;
    }
    const typeInfo = SUGGESTED_KYC_DOCUMENT_TYPES[documentType];
    return typeInfo?.label || formatDocumentType(documentType);
}
/**
 * Format document type string for display (fallback for unknown types)
 */ function formatDocumentType(documentType) {
    return documentType.split('_').map((word)=>word.charAt(0).toUpperCase() + word.slice(1)).join(' ');
}
function getSuggestedDocumentTypes(category, options) {
    return Object.entries(SUGGESTED_KYC_DOCUMENT_TYPES).filter(([_, info])=>{
        // Filter by category
        const categoryMatch = !category || info.category === category || info.category === 'both';
        // Filter member-only documents unless explicitly included
        const memberMatch = options?.includeMemberOnly || !info.memberOnly;
        return categoryMatch && memberMatch;
    }).map(([value, info])=>({
            value,
            label: info.label,
            description: info.description,
            memberOnly: info.memberOnly
        }));
}
const INDIVIDUAL_REQUIRED_DOCS = [
    {
        value: 'passport',
        label: 'Passport',
        description: 'Valid passport (photo page)'
    },
    {
        value: 'utility_bill',
        label: 'Utility Bill / Proof of Address',
        description: 'Recent utility bill or bank statement (less than 3 months)'
    }
];
const ENTITY_REQUIRED_DOCS = [
    {
        value: 'incorporation_certificate',
        label: 'Incorporation Certificate',
        description: 'Certificate of Incorporation'
    },
    {
        value: 'memo_articles',
        label: 'Memo & Articles',
        description: 'Memorandum and Articles of Association'
    },
    {
        value: 'register_directors',
        label: 'Register of Directors',
        description: 'Current list of all directors'
    },
    {
        value: 'register_members',
        label: 'Register of Members/Shareholders',
        description: 'Current list of shareholders'
    },
    {
        value: 'register_beneficial_owners',
        label: 'Register of UBOs',
        description: 'List of beneficial owners (>25%)'
    },
    {
        value: 'bank_confirmation',
        label: 'Bank Confirmation Letter',
        description: 'Bank details for wire transfers'
    }
];
const MEMBER_REQUIRED_DOCS = [
    {
        value: 'passport',
        label: 'Passport / ID',
        description: 'Valid passport or government ID'
    },
    {
        value: 'utility_bill',
        label: 'Proof of Address',
        description: 'Utility bill or bank statement (less than 3 months)'
    }
];
function getIndividualDocumentTypes() {
    return [
        ...INDIVIDUAL_REQUIRED_DOCS
    ];
}
function getEntityDocumentTypes() {
    return [
        ...ENTITY_REQUIRED_DOCS
    ];
}
function getMemberDocumentTypes() {
    return [
        ...MEMBER_REQUIRED_DOCS
    ];
}
function isPredefinedDocumentType(documentType) {
    return documentType in SUGGESTED_KYC_DOCUMENT_TYPES;
}
}),
"[project]/versotech-portal/src/app/api/investors/me/kyc-submissions/route.ts [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "GET",
    ()=>GET,
    "POST",
    ()=>POST
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$versotech$2d$portal$2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/versotech-portal/node_modules/next/server.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$versotech$2d$portal$2f$src$2f$lib$2f$supabase$2f$server$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/versotech-portal/src/lib/supabase/server.ts [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$versotech$2d$portal$2f$src$2f$constants$2f$kyc$2d$document$2d$types$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/versotech-portal/src/constants/kyc-document-types.ts [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$versotech$2d$portal$2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__ = __turbopack_context__.i("[project]/versotech-portal/node_modules/zod/v4/classic/external.js [app-route] (ecmascript) <export * as z>");
;
;
;
;
// Allowed document types for KYC submissions - SIMPLIFIED
const ALLOWED_DOCUMENT_TYPES = [
    // Individual docs
    'passport',
    'utility_bill',
    // Entity docs
    'incorporation_certificate',
    'memo_articles',
    'register_directors',
    'register_members',
    'register_beneficial_owners',
    'bank_confirmation',
    // Custom/other
    'other'
];
// Investors can only set draft or pending status - not approved/rejected
const ALLOWED_INVESTOR_STATUSES = [
    'draft',
    'pending'
];
// Schema for POST body validation
const createSubmissionSchema = __TURBOPACK__imported__module__$5b$project$5d2f$versotech$2d$portal$2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__["z"].object({
    document_type: __TURBOPACK__imported__module__$5b$project$5d2f$versotech$2d$portal$2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__["z"].enum(ALLOWED_DOCUMENT_TYPES, {
        message: 'Invalid document type'
    }),
    custom_label: __TURBOPACK__imported__module__$5b$project$5d2f$versotech$2d$portal$2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__["z"].string().max(200, 'Custom label must be less than 200 characters').regex(/^[^<>]*$/, 'Custom label cannot contain HTML tags').optional(),
    metadata: __TURBOPACK__imported__module__$5b$project$5d2f$versotech$2d$portal$2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__["z"].record(__TURBOPACK__imported__module__$5b$project$5d2f$versotech$2d$portal$2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__["z"].string(), __TURBOPACK__imported__module__$5b$project$5d2f$versotech$2d$portal$2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__["z"].unknown()).optional(),
    status: __TURBOPACK__imported__module__$5b$project$5d2f$versotech$2d$portal$2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__["z"].enum(ALLOWED_INVESTOR_STATUSES).optional().default('pending'),
    investor_member_id: __TURBOPACK__imported__module__$5b$project$5d2f$versotech$2d$portal$2f$node_modules$2f$zod$2f$v4$2f$classic$2f$external$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__["z"].string().uuid().optional()
});
async function GET(request) {
    try {
        // Get authenticated user
        const supabase = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$versotech$2d$portal$2f$src$2f$lib$2f$supabase$2f$server$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createClient"])();
        const { data: { user }, error: authError } = await supabase.auth.getUser();
        if (authError || !user) {
            return __TURBOPACK__imported__module__$5b$project$5d2f$versotech$2d$portal$2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                error: 'Unauthorized'
            }, {
                status: 401
            });
        }
        // Get investor IDs for this user
        // Note: We check investor_users link rather than profile.role to support hybrid personas
        // (e.g., partner_investor, introducer_investor, commercial_partner_investor)
        const { data: investorUsers } = await supabase.from('investor_users').select('investor_id').eq('user_id', user.id);
        if (!investorUsers || investorUsers.length === 0) {
            return __TURBOPACK__imported__module__$5b$project$5d2f$versotech$2d$portal$2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                error: 'No investor profile found'
            }, {
                status: 404
            });
        }
        const investorIds = investorUsers.map((iu)=>iu.investor_id);
        // Get ALL KYC submissions (investor KYC only, not entity KYC)
        const { data: submissions, error: submissionsError } = await supabase.from('kyc_submissions').select(`
        *,
        document:documents(id, name, file_key, file_size_bytes, mime_type, created_at),
        reviewer:reviewed_by(display_name, email),
        investor_member:investor_member_id(id, full_name, role)
      `).in('investor_id', investorIds).is('counterparty_entity_id', null) // Only investor KYC, not entity KYC
        .order('created_at', {
            ascending: false
        });
        if (submissionsError) {
            console.error('Error fetching submissions:', submissionsError);
            return __TURBOPACK__imported__module__$5b$project$5d2f$versotech$2d$portal$2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                error: 'Failed to fetch KYC submissions'
            }, {
                status: 500
            });
        }
        // Get investor type to provide relevant document suggestions
        const { data: investors } = await supabase.from('investors').select('id, type').in('id', investorIds);
        const investorType = investors?.[0]?.type || 'individual';
        const isEntityInvestor = investorType !== 'individual';
        // Get investor members if entity-type investor
        let investorMembers = [];
        if (isEntityInvestor && investorIds.length > 0) {
            const { data: members } = await supabase.from('investor_members').select('id, full_name, role').eq('investor_id', investorIds[0]).eq('is_active', true).order('full_name');
            investorMembers = members || [];
            // Also include the current user if they're a signatory/admin but not already in investor_members
            const { data: currentUserLink } = await supabase.from('investor_users').select('role, can_sign, is_primary').eq('user_id', user.id).eq('investor_id', investorIds[0]).single();
            if (currentUserLink && (currentUserLink.can_sign || currentUserLink.role === 'admin' || currentUserLink.is_primary)) {
                // Get current user's profile info
                const { data: profile } = await supabase.from('profiles').select('display_name, email').eq('id', user.id).single();
                const userName = profile?.display_name || profile?.email || 'Current User';
                // Check if user is not already in the members list (by matching name/email)
                const alreadyInList = investorMembers.some((m)=>m.full_name?.toLowerCase() === userName.toLowerCase());
                if (!alreadyInList) {
                    // Add current user as a pseudo-member with special ID prefix
                    investorMembers.unshift({
                        id: `self_${user.id}`,
                        full_name: `${userName} (You)`,
                        role: currentUserLink.role === 'admin' ? 'authorized_signatory' : 'signatory'
                    });
                }
            }
        }
        // Get suggested documents based on investor type - use SIMPLIFIED lists
        const suggestedDocuments = isEntityInvestor ? (0, __TURBOPACK__imported__module__$5b$project$5d2f$versotech$2d$portal$2f$src$2f$constants$2f$kyc$2d$document$2d$types$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getEntityDocumentTypes"])() : (0, __TURBOPACK__imported__module__$5b$project$5d2f$versotech$2d$portal$2f$src$2f$constants$2f$kyc$2d$document$2d$types$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getIndividualDocumentTypes"])();
        // Group submissions by document type
        const groupedSubmissions = {};
        submissions?.forEach((sub)=>{
            const key = sub.document_type;
            if (!groupedSubmissions[key]) {
                groupedSubmissions[key] = [];
            }
            groupedSubmissions[key].push(sub);
        });
        // Format all submissions with proper labels
        const formattedSubmissions = (submissions || []).map((sub)=>({
                ...sub,
                display_label: (0, __TURBOPACK__imported__module__$5b$project$5d2f$versotech$2d$portal$2f$src$2f$constants$2f$kyc$2d$document$2d$types$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getDocumentTypeLabel"])(sub.document_type, sub.custom_label)
            }));
        return __TURBOPACK__imported__module__$5b$project$5d2f$versotech$2d$portal$2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
            success: true,
            submissions: formattedSubmissions,
            grouped_submissions: groupedSubmissions,
            suggested_documents: suggestedDocuments,
            investor_type: investorType,
            is_entity_investor: isEntityInvestor,
            investor_members: investorMembers,
            note: 'Suggested documents are recommendations. You can upload any document type with a custom label.'
        });
    } catch (error) {
        console.error('KYC submissions GET error:', error);
        return __TURBOPACK__imported__module__$5b$project$5d2f$versotech$2d$portal$2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
            error: 'Internal server error'
        }, {
            status: 500
        });
    }
}
async function POST(request) {
    try {
        const supabase = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$versotech$2d$portal$2f$src$2f$lib$2f$supabase$2f$server$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createClient"])();
        const { data: { user }, error: authError } = await supabase.auth.getUser();
        if (authError || !user) {
            return __TURBOPACK__imported__module__$5b$project$5d2f$versotech$2d$portal$2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                error: 'Unauthorized'
            }, {
                status: 401
            });
        }
        // Get investor ID
        const { data: investorUsers } = await supabase.from('investor_users').select('investor_id').eq('user_id', user.id).single();
        if (!investorUsers) {
            return __TURBOPACK__imported__module__$5b$project$5d2f$versotech$2d$portal$2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                error: 'No investor profile found'
            }, {
                status: 404
            });
        }
        const body = await request.json();
        // Validate input to prevent security issues
        const validation = createSubmissionSchema.safeParse(body);
        if (!validation.success) {
            return __TURBOPACK__imported__module__$5b$project$5d2f$versotech$2d$portal$2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                error: validation.error.issues[0]?.message || 'Invalid input'
            }, {
                status: 400
            });
        }
        const { document_type, custom_label, metadata, status, investor_member_id } = validation.data;
        // Check for existing submissions of this document type for versioning
        // For member-specific docs, check by member_id too
        let previousSubmission = null;
        let newVersion = 1;
        // Build query for previous submissions
        let previousQuery = supabase.from('kyc_submissions').select('id, version').eq('investor_id', investorUsers.investor_id).eq('document_type', document_type).is('counterparty_entity_id', null) // Only investor KYC
        .order('version', {
            ascending: false
        }).limit(1);
        // For member-specific documents, filter by member
        if (investor_member_id) {
            previousQuery = previousQuery.eq('investor_member_id', investor_member_id);
        } else {
            previousQuery = previousQuery.is('investor_member_id', null);
        }
        const { data: previousSubmissions } = await previousQuery;
        if (previousSubmissions && previousSubmissions.length > 0) {
            previousSubmission = previousSubmissions[0];
            newVersion = (previousSubmission.version || 1) + 1;
        }
        // Insert submission with versioning support
        const { data, error } = await supabase.from('kyc_submissions').insert({
            investor_id: investorUsers.investor_id,
            document_type,
            custom_label: custom_label || null,
            metadata: metadata || null,
            status,
            investor_member_id: investor_member_id || null,
            version: newVersion,
            previous_submission_id: previousSubmission?.id || null
        }).select().single();
        if (error) {
            console.error('Error creating submission:', error);
            return __TURBOPACK__imported__module__$5b$project$5d2f$versotech$2d$portal$2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                error: 'Failed to create submission'
            }, {
                status: 500
            });
        }
        return __TURBOPACK__imported__module__$5b$project$5d2f$versotech$2d$portal$2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
            success: true,
            submission: data,
            is_new_version: newVersion > 1,
            version: newVersion
        });
    } catch (error) {
        console.error('KYC submissions POST error:', error);
        return __TURBOPACK__imported__module__$5b$project$5d2f$versotech$2d$portal$2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
            error: 'Internal server error'
        }, {
            status: 500
        });
    }
}
}),
];

//# sourceMappingURL=%5Broot-of-the-server%5D__fbd617ed._.js.map