{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 82, "column": 0}, "map": {"version":3,"sources":["file:///Users/ghilesmoussaoui/Desktop/Versotech/versotech-portal/src/lib/supabase/server.ts"],"sourcesContent":["import { createServerClient } from '@supabase/ssr'\nimport { createClient as createSupabaseClient } from '@supabase/supabase-js'\nimport { cookies } from 'next/headers'\n\nexport const createClient = async () => {\n  const cookieStore = await cookies()\n\n  return createServerClient(\n    process.env.NEXT_PUBLIC_SUPABASE_URL!,\n    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,\n    {\n      cookies: {\n        getAll() {\n          return cookieStore.getAll()\n        },\n        setAll(cookiesToSet) {\n          try {\n            cookiesToSet.forEach(({ name, value, options }) => {\n              cookieStore.set(name, value, options)\n            })\n          } catch (error) {\n            // The `setAll` method was called from a Server Component.\n            // This can be ignored if you have middleware refreshing\n            // user sessions.\n          }\n        },\n      },\n    }\n  )\n}\n\n// Server client with service role for admin operations\n// Uses raw supabase-js client which properly bypasses RLS with service role\nexport const createServiceClient = () => {\n  return createSupabaseClient(\n    process.env.NEXT_PUBLIC_SUPABASE_URL!,\n    process.env.SUPABASE_SERVICE_ROLE_KEY!,\n    {\n      auth: {\n        autoRefreshToken: false,\n        persistSession: false,\n      },\n    }\n  )\n}\n"],"names":[],"mappings":";;;;;;AAAA;AAAA;AACA;AACA;;;;AAEO,MAAM,eAAe;IAC1B,MAAM,cAAc,MAAM,IAAA,mKAAO;IAEjC,OAAO,IAAA,wNAAkB,sUAGvB;QACE,SAAS;YACP;gBACE,OAAO,YAAY,MAAM;YAC3B;YACA,QAAO,YAAY;gBACjB,IAAI;oBACF,aAAa,OAAO,CAAC,CAAC,EAAE,IAAI,EAAE,KAAK,EAAE,OAAO,EAAE;wBAC5C,YAAY,GAAG,CAAC,MAAM,OAAO;oBAC/B;gBACF,EAAE,OAAO,OAAO;gBACd,0DAA0D;gBAC1D,wDAAwD;gBACxD,iBAAiB;gBACnB;YACF;QACF;IACF;AAEJ;AAIO,MAAM,sBAAsB;IACjC,OAAO,IAAA,gOAAoB,gFAEzB,QAAQ,GAAG,CAAC,yBAAyB,EACrC;QACE,MAAM;YACJ,kBAAkB;YAClB,gBAAgB;QAClB;IACF;AAEJ"}},
    {"offset": {"line": 128, "column": 0}, "map": {"version":3,"sources":["file:///Users/ghilesmoussaoui/Desktop/Versotech/versotech-portal/src/app/api/commercial-partners/me/client-transactions/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server'\nimport { createClient, createServiceClient } from '@/lib/supabase/server'\n\ntype MembershipProgression = {\n  interest_confirmed_at?: string | null\n  nda_signed_at?: string | null\n  data_room_granted_at?: string | null\n}\n\ntype ClientTransaction = {\n  id: string\n  client_name: string\n  client_email: string | null\n  client_type: string | null\n  is_active: boolean\n  created_at: string\n  deal_id: string | null\n  deal_name: string | null\n  deal_status: string | null\n  investor_id: string | null\n  subscription_id: string | null\n  subscription_amount: number | null\n  subscription_status: string | null\n  subscription_date: string | null\n  journey_stage: 'new_lead' | 'interested' | 'subscribing' | 'funded' | 'passed'\n  has_termsheet: boolean\n  has_dataroom_access: boolean\n  estimated_commission: number | null\n  commission_rate_bps: number | null\n}\n\ntype Summary = {\n  totalClients: number\n  activeClients: number\n  totalTransactions: number\n  totalValue: number\n  estimatedCommission: number\n}\n\nfunction getJourneyStage(\n  subscriptionStatus: string | null,\n  hasSubscription: boolean,\n  membership?: MembershipProgression\n): ClientTransaction['journey_stage'] {\n  if (!hasSubscription) {\n    if (membership?.data_room_granted_at) return 'interested'\n    if (membership?.nda_signed_at) return 'interested'\n    if (membership?.interest_confirmed_at) return 'interested'\n    return 'new_lead'\n  }\n\n  switch (subscriptionStatus) {\n    case 'funded':\n    case 'active':\n      return 'funded'\n    case 'signed':\n    case 'committed':\n    case 'pending':\n    case 'approved':\n      return 'subscribing'\n    case 'cancelled':\n    case 'rejected':\n    case 'withdrawn':\n      return 'passed'\n    default:\n      return 'interested'\n  }\n}\n\nfunction normalizeJoin<T>(value: T | T[] | null): T | null {\n  if (!value) return null\n  return Array.isArray(value) ? value[0] || null : value\n}\n\nexport async function GET() {\n  const supabase = await createClient()\n  const serviceSupabase = createServiceClient()\n\n  try {\n    const { data: { user }, error: userError } = await supabase.auth.getUser()\n    if (userError || !user) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })\n    }\n\n    const { data: cpUser } = await serviceSupabase\n      .from('commercial_partner_users')\n      .select('commercial_partner_id')\n      .eq('user_id', user.id)\n      .maybeSingle()\n\n    if (!cpUser?.commercial_partner_id) {\n      // Staff fallback - show limited dataset\n      const { data: clientsData } = await serviceSupabase\n        .from('commercial_partner_clients')\n        .select(`\n          id,\n          client_name,\n          client_email,\n          client_type,\n          is_active,\n          created_at,\n          created_for_deal_id,\n          client_investor_id,\n          deal:created_for_deal_id (\n            id,\n            name,\n            status\n          )\n        `)\n        .order('created_at', { ascending: false })\n        .limit(100)\n\n      const processed = (clientsData || []).map((client: any) => {\n        const deal = normalizeJoin(client.deal as any)\n        return {\n          id: client.id,\n          client_name: client.client_name || 'Unknown Client',\n          client_email: client.client_email,\n          client_type: client.client_type,\n          is_active: client.is_active ?? true,\n          created_at: client.created_at,\n          deal_id: client.created_for_deal_id,\n          deal_name: deal?.name || null,\n          deal_status: deal?.status || null,\n          investor_id: client.client_investor_id,\n          subscription_id: null,\n          subscription_amount: null,\n          subscription_status: null,\n          subscription_date: null,\n          journey_stage: 'new_lead',\n          has_termsheet: !!client.created_for_deal_id,\n          has_dataroom_access: false,\n          estimated_commission: null,\n          commission_rate_bps: 0,\n        }\n      })\n\n      const summary: Summary = {\n        totalClients: processed.length,\n        activeClients: processed.filter(c => c.is_active).length,\n        totalTransactions: 0,\n        totalValue: 0,\n        estimatedCommission: 0,\n      }\n\n      return NextResponse.json({\n        staff_view: true,\n        partner: null,\n        placement_agreement: null,\n        clients: processed,\n        summary,\n      })\n    }\n\n    const cpId = cpUser.commercial_partner_id\n\n    const { data: partner } = await serviceSupabase\n      .from('commercial_partners')\n      .select('id, name, legal_name, type, status, logo_url')\n      .eq('id', cpId)\n      .single()\n\n    const { data: agreement } = await serviceSupabase\n      .from('placement_agreements')\n      .select('id, default_commission_bps, status')\n      .eq('commercial_partner_id', cpId)\n      .eq('status', 'active')\n      .maybeSingle()\n\n    const { data: clientsData, error: clientsError } = await serviceSupabase\n      .from('commercial_partner_clients')\n      .select(`\n        id,\n        client_name,\n        client_email,\n        client_type,\n        is_active,\n        created_at,\n        created_for_deal_id,\n        client_investor_id,\n        deal:created_for_deal_id (\n          id,\n          name,\n          status\n        )\n      `)\n      .eq('commercial_partner_id', cpId)\n      .order('created_at', { ascending: false })\n\n    if (clientsError) {\n      console.error('[cp-client-transactions] Clients fetch error:', clientsError)\n      return NextResponse.json({ error: 'Failed to load clients' }, { status: 500 })\n    }\n\n    const investorIds = (clientsData || [])\n      .filter((client: any) => client.client_investor_id)\n      .map((client: any) => client.client_investor_id)\n\n    // Get dealIds from client records (will combine with subscription dealIds after fetch)\n    const dealIdsFromClients = (clientsData || [])\n      .filter((client: any) => client.created_for_deal_id)\n      .map((client: any) => client.created_for_deal_id)\n\n    let subscriptionsMap: Record<string, any[]> = {}\n    if (investorIds.length > 0) {\n      const { data: subs } = await serviceSupabase\n        .from('subscriptions')\n        .select(`\n          id,\n          investor_id,\n          deal_id,\n          commitment,\n          status,\n          subscription_date,\n          deals (\n            id,\n            name,\n            status\n          )\n        `)\n        .in('investor_id', investorIds)\n        .eq('proxy_commercial_partner_id', cpId)\n        .order('created_at', { ascending: false })\n\n      if (subs) {\n        subs.forEach((sub: any) => {\n          if (!subscriptionsMap[sub.investor_id]) {\n            subscriptionsMap[sub.investor_id] = []\n          }\n          subscriptionsMap[sub.investor_id].push(sub)\n        })\n      }\n    }\n\n    // Combine dealIds from BOTH client links AND subscriptions\n    const dealIdsFromSubscriptions = Object.values(subscriptionsMap)\n      .flat()\n      .map((sub: any) => sub.deal_id)\n      .filter(Boolean)\n\n    const allDealIds = [...new Set([...dealIdsFromClients, ...dealIdsFromSubscriptions])]\n\n    let membershipMap: Record<string, MembershipProgression> = {}\n    if (investorIds.length > 0 && allDealIds.length > 0) {\n      const { data: memberships } = await serviceSupabase\n        .from('deal_memberships')\n        .select('investor_id, deal_id, interest_confirmed_at, nda_signed_at, data_room_granted_at')\n        .in('investor_id', investorIds)\n        .in('deal_id', allDealIds)\n\n      if (memberships) {\n        memberships.forEach((m: any) => {\n          const key = `${m.investor_id}:${m.deal_id}`\n          membershipMap[key] = {\n            interest_confirmed_at: m.interest_confirmed_at,\n            nda_signed_at: m.nda_signed_at,\n            data_room_granted_at: m.data_room_granted_at,\n          }\n        })\n      }\n    }\n\n    let dataroomAccessMap: Record<string, boolean> = {}\n    if (allDealIds.length > 0 && investorIds.length > 0) {\n      const { data: accessRecords } = await serviceSupabase\n        .from('deal_data_room_access')\n        .select('deal_id, investor_id')\n        .in('deal_id', allDealIds)\n        .in('investor_id', investorIds)\n        .is('revoked_at', null)\n        .or(`expires_at.is.null,expires_at.gte.${new Date().toISOString()}`)\n\n      if (accessRecords) {\n        accessRecords.forEach((record: any) => {\n          const key = `${record.deal_id}:${record.investor_id}`\n          dataroomAccessMap[key] = true\n        })\n      }\n    }\n\n    const commissionBps = agreement?.default_commission_bps || 0\n    const processed: ClientTransaction[] = []\n\n    ;(clientsData || []).forEach((client: any) => {\n      const subscriptions = client.client_investor_id\n        ? subscriptionsMap[client.client_investor_id] || []\n        : []\n\n      if (subscriptions.length === 0) {\n        // Try to find membership from explicit deal link first\n        let membership: MembershipProgression | undefined = undefined\n\n        if (client.client_investor_id && client.created_for_deal_id) {\n          const explicitKey = `${client.client_investor_id}:${client.created_for_deal_id}`\n          membership = membershipMap[explicitKey]\n        }\n\n        // If no explicit link membership, check if there are any memberships for this investor\n        // (This handles cases where the client is associated via other paths)\n        if (!membership && client.client_investor_id) {\n          // Find any membership for this investor in our membershipMap\n          const investorPrefix = `${client.client_investor_id}:`\n          const matchingKey = Object.keys(membershipMap).find(key => key.startsWith(investorPrefix))\n          if (matchingKey) {\n            membership = membershipMap[matchingKey]\n          }\n        }\n\n        const deal = normalizeJoin(client.deal as any)\n\n        processed.push({\n          id: client.id,\n          client_name: client.client_name || 'Unknown Client',\n          client_email: client.client_email,\n          client_type: client.client_type,\n          is_active: client.is_active ?? true,\n          created_at: client.created_at,\n          deal_id: client.created_for_deal_id,\n          deal_name: deal?.name || null,\n          deal_status: deal?.status || null,\n          investor_id: client.client_investor_id,\n          subscription_id: null,\n          subscription_amount: null,\n          subscription_status: null,\n          subscription_date: null,\n          journey_stage: getJourneyStage(null, false, membership),\n          has_termsheet: !!client.created_for_deal_id,\n          has_dataroom_access: !!(\n            client.created_for_deal_id &&\n            client.client_investor_id &&\n            dataroomAccessMap[`${client.created_for_deal_id}:${client.client_investor_id}`]\n          ),\n          estimated_commission: null,\n          commission_rate_bps: commissionBps,\n        })\n      } else {\n        subscriptions.forEach((sub: any) => {\n          const commitment = sub.commitment || 0\n          const estimatedComm = commissionBps > 0 ? (commitment * commissionBps) / 10000 : null\n          const membershipKey = client.client_investor_id && sub.deal_id\n            ? `${client.client_investor_id}:${sub.deal_id}`\n            : ''\n          const membership = membershipKey ? membershipMap[membershipKey] : undefined\n\n          const deal = normalizeJoin(sub.deals as any) || normalizeJoin(client.deal as any)\n\n          processed.push({\n            id: `${client.id}-${sub.id}`,\n            client_name: client.client_name || 'Unknown Client',\n            client_email: client.client_email,\n            client_type: client.client_type,\n            is_active: client.is_active ?? true,\n            created_at: sub.subscription_date || client.created_at,\n            deal_id: sub.deal_id,\n            deal_name: deal?.name || null,\n            deal_status: deal?.status || null,\n            investor_id: client.client_investor_id,\n            subscription_id: sub.id,\n            subscription_amount: commitment,\n            subscription_status: sub.status,\n            subscription_date: sub.subscription_date,\n            journey_stage: getJourneyStage(sub.status, true, membership),\n            has_termsheet: true,\n            has_dataroom_access: !!(\n              sub.deal_id &&\n              client.client_investor_id &&\n              dataroomAccessMap[`${sub.deal_id}:${client.client_investor_id}`]\n            ),\n            estimated_commission: estimatedComm,\n            commission_rate_bps: commissionBps,\n          })\n        })\n      }\n    })\n\n    const uniqueClients = new Set((clientsData || []).map((client: any) => client.id))\n    const activeClients = (clientsData || []).filter((client: any) => client.is_active).length\n    const withSubscription = processed.filter(client => client.subscription_amount)\n    const totalValue = withSubscription.reduce((sum, client) => sum + (client.subscription_amount || 0), 0)\n    const estimatedCommission = withSubscription.reduce((sum, client) => sum + (client.estimated_commission || 0), 0)\n\n    const summary: Summary = {\n      totalClients: uniqueClients.size,\n      activeClients,\n      totalTransactions: withSubscription.length,\n      totalValue,\n      estimatedCommission,\n    }\n\n    return NextResponse.json({\n      staff_view: false,\n      partner,\n      placement_agreement: agreement,\n      clients: processed,\n      summary,\n    })\n  } catch (error) {\n    console.error('[cp-client-transactions] Unexpected error:', error)\n    return NextResponse.json({ error: 'Internal server error' }, { status: 500 })\n  }\n}\n"],"names":[],"mappings":"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"}}]
}