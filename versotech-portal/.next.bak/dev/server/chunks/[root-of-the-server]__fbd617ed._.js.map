{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 82, "column": 0}, "map": {"version":3,"sources":["file:///Users/ghilesmoussaoui/Desktop/Versotech/versotech-portal/src/lib/supabase/server.ts"],"sourcesContent":["import { createServerClient } from '@supabase/ssr'\nimport { createClient as createSupabaseClient } from '@supabase/supabase-js'\nimport { cookies } from 'next/headers'\n\nexport const createClient = async () => {\n  const cookieStore = await cookies()\n\n  return createServerClient(\n    process.env.NEXT_PUBLIC_SUPABASE_URL!,\n    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,\n    {\n      cookies: {\n        getAll() {\n          return cookieStore.getAll()\n        },\n        setAll(cookiesToSet) {\n          try {\n            cookiesToSet.forEach(({ name, value, options }) => {\n              cookieStore.set(name, value, options)\n            })\n          } catch (error) {\n            // The `setAll` method was called from a Server Component.\n            // This can be ignored if you have middleware refreshing\n            // user sessions.\n          }\n        },\n      },\n    }\n  )\n}\n\n// Server client with service role for admin operations\n// Uses raw supabase-js client which properly bypasses RLS with service role\nexport const createServiceClient = () => {\n  return createSupabaseClient(\n    process.env.NEXT_PUBLIC_SUPABASE_URL!,\n    process.env.SUPABASE_SERVICE_ROLE_KEY!,\n    {\n      auth: {\n        autoRefreshToken: false,\n        persistSession: false,\n      },\n    }\n  )\n}\n"],"names":[],"mappings":";;;;;;AAAA;AAAA;AACA;AACA;;;;AAEO,MAAM,eAAe;IAC1B,MAAM,cAAc,MAAM,IAAA,mKAAO;IAEjC,OAAO,IAAA,wNAAkB,sUAGvB;QACE,SAAS;YACP;gBACE,OAAO,YAAY,MAAM;YAC3B;YACA,QAAO,YAAY;gBACjB,IAAI;oBACF,aAAa,OAAO,CAAC,CAAC,EAAE,IAAI,EAAE,KAAK,EAAE,OAAO,EAAE;wBAC5C,YAAY,GAAG,CAAC,MAAM,OAAO;oBAC/B;gBACF,EAAE,OAAO,OAAO;gBACd,0DAA0D;gBAC1D,wDAAwD;gBACxD,iBAAiB;gBACnB;YACF;QACF;IACF;AAEJ;AAIO,MAAM,sBAAsB;IACjC,OAAO,IAAA,gOAAoB,gFAEzB,QAAQ,GAAG,CAAC,yBAAyB,EACrC;QACE,MAAM;YACJ,kBAAkB;YAClB,gBAAgB;QAClB;IACF;AAEJ"}},
    {"offset": {"line": 128, "column": 0}, "map": {"version":3,"sources":["file:///Users/ghilesmoussaoui/Desktop/Versotech/versotech-portal/src/constants/kyc-document-types.ts"],"sourcesContent":["/**\r\n * KYC Document Types - VERSO Holdings\r\n *\r\n * Compulsory KYC documents for all entities including investors, partners,\r\n * introducers, lawyers, arrangers, and commercial partners.\r\n */\r\n\r\nexport interface KYCDocumentTypeInfo {\r\n  label: string\r\n  description: string\r\n  category: 'individual' | 'entity' | 'both'\r\n  /** For member-specific documents */\r\n  memberOnly?: boolean\r\n}\r\n\r\n/**\r\n * KYC document types\r\n *\r\n * Entity documents: Required for entity-level KYC\r\n * Individual documents: Required for individuals, directors, shareholders, and members\r\n */\r\nexport const SUGGESTED_KYC_DOCUMENT_TYPES: Record<string, KYCDocumentTypeInfo> = {\r\n  // ===== QUESTIONNAIRE =====\r\n  questionnaire: {\r\n    label: 'KYC Questionnaire',\r\n    description: 'Investor questionnaire responses',\r\n    category: 'both',\r\n  },\r\n\r\n  // ===== ENTITY DOCUMENTS - FORMATION =====\r\n  nda_ndnc: {\r\n    label: 'NDA / NDNC',\r\n    description: 'Non-Disclosure and Non-Circumvention Agreement',\r\n    category: 'entity',\r\n  },\r\n  incorporation_certificate: {\r\n    label: 'Incorporation Certificate',\r\n    description: 'Certificate of Incorporation',\r\n    category: 'entity',\r\n  },\r\n  memo_articles: {\r\n    label: 'Memo & Articles of Association',\r\n    description: 'Memorandum and Articles of Association',\r\n    category: 'entity',\r\n  },\r\n  certificate_of_good_standing: {\r\n    label: 'Certificate of Good Standing',\r\n    description: 'Certificate confirming entity is in good standing with registry',\r\n    category: 'entity',\r\n  },\r\n  certificate_of_incumbency: {\r\n    label: 'Certificate of Incumbency',\r\n    description: 'Certificate listing current directors and officers',\r\n    category: 'entity',\r\n  },\r\n  company_register_extract: {\r\n    label: 'Company Register Extract',\r\n    description: 'Official extract from company registry',\r\n    category: 'entity',\r\n  },\r\n  partnership_agreement: {\r\n    label: 'Partnership Agreement',\r\n    description: 'Limited Partnership or General Partnership Agreement',\r\n    category: 'entity',\r\n  },\r\n  operating_agreement: {\r\n    label: 'Operating Agreement',\r\n    description: 'LLC Operating Agreement or equivalent',\r\n    category: 'entity',\r\n  },\r\n\r\n  // ===== ENTITY DOCUMENTS - GOVERNANCE =====\r\n  register_members: {\r\n    label: 'Register of Members',\r\n    description: 'Current register of all members/shareholders',\r\n    category: 'entity',\r\n  },\r\n  register_directors: {\r\n    label: 'Register of Directors',\r\n    description: 'Current register of all directors',\r\n    category: 'entity',\r\n  },\r\n  register_beneficial_owners: {\r\n    label: 'Register of Beneficial Owners',\r\n    description: 'Register of ultimate beneficial owners (UBOs)',\r\n    category: 'entity',\r\n  },\r\n  directors_declaration: {\r\n    label: 'Directors Declaration',\r\n    description: 'Signed declaration from board of directors',\r\n    category: 'entity',\r\n  },\r\n  board_resolution: {\r\n    label: 'Board Resolution',\r\n    description: 'Board resolution authorizing investment or account opening',\r\n    category: 'entity',\r\n  },\r\n  authorized_signatory_list: {\r\n    label: 'Authorized Signatory List',\r\n    description: 'List of persons authorized to sign on behalf of entity',\r\n    category: 'entity',\r\n  },\r\n  power_of_attorney: {\r\n    label: 'Power of Attorney',\r\n    description: 'Power of Attorney document',\r\n    category: 'entity',\r\n  },\r\n\r\n  // ===== ENTITY DOCUMENTS - FINANCIAL =====\r\n  bank_confirmation: {\r\n    label: 'Bank Confirmation',\r\n    description: 'Confirmation of bank name and jurisdiction for wire transfers',\r\n    category: 'entity',\r\n  },\r\n  financial_statements: {\r\n    label: 'Financial Statements',\r\n    description: 'Audited Financial Statements',\r\n    category: 'entity',\r\n  },\r\n  beneficial_ownership: {\r\n    label: 'Beneficial Ownership Declaration',\r\n    description: 'Declaration of ultimate beneficial owners',\r\n    category: 'entity',\r\n  },\r\n\r\n  // ===== TRUST DOCUMENTS =====\r\n  trust_deed: {\r\n    label: 'Trust Deed',\r\n    description: 'Trust Deed or Declaration of Trust',\r\n    category: 'entity',\r\n  },\r\n  trust_schedule: {\r\n    label: 'Trust Schedule',\r\n    description: 'Schedule of beneficiaries and settlors',\r\n    category: 'entity',\r\n  },\r\n  letter_of_wishes: {\r\n    label: 'Letter of Wishes',\r\n    description: 'Settlor letter of wishes',\r\n    category: 'entity',\r\n  },\r\n\r\n  // ===== INDIVIDUAL / MEMBER ID DOCUMENTS =====\r\n  passport_id: {\r\n    label: 'ID / Passport',\r\n    description: 'Valid government-issued ID or passport',\r\n    category: 'both',\r\n  },\r\n  passport: {\r\n    label: 'Passport',\r\n    description: 'Valid passport (photo page)',\r\n    category: 'both',\r\n  },\r\n  national_id_card: {\r\n    label: 'National ID Card',\r\n    description: 'Government-issued national identification card',\r\n    category: 'both',\r\n  },\r\n  drivers_license: {\r\n    label: \"Driver's License\",\r\n    description: 'Government-issued driving license',\r\n    category: 'both',\r\n  },\r\n  residence_permit: {\r\n    label: 'Residence Permit',\r\n    description: 'Valid residence permit or visa',\r\n    category: 'both',\r\n  },\r\n\r\n  // ===== PROOF OF ADDRESS DOCUMENTS =====\r\n  utility_bill: {\r\n    label: 'Utility Bill',\r\n    description: 'Recent utility bill (less than 3 months old)',\r\n    category: 'both',\r\n  },\r\n  bank_statement: {\r\n    label: 'Bank Statement',\r\n    description: 'Recent bank statement (less than 3 months old)',\r\n    category: 'both',\r\n  },\r\n  proof_of_address: {\r\n    label: 'Proof of Address',\r\n    description: 'Recent utility bill, bank statement, or official letter',\r\n    category: 'both',\r\n  },\r\n  government_correspondence: {\r\n    label: 'Government Correspondence',\r\n    description: 'Recent letter from government agency with address',\r\n    category: 'both',\r\n  },\r\n  council_tax_bill: {\r\n    label: 'Council Tax Bill',\r\n    description: 'Council tax or property tax statement',\r\n    category: 'both',\r\n  },\r\n\r\n  // ===== ACCREDITATION / QUALIFICATION =====\r\n  accreditation_letter: {\r\n    label: 'Accreditation Letter',\r\n    description: 'Accredited Investor verification letter',\r\n    category: 'individual',\r\n  },\r\n  professional_qualification: {\r\n    label: 'Professional Qualification',\r\n    description: 'Professional investor qualification or certification',\r\n    category: 'individual',\r\n  },\r\n  sophistication_declaration: {\r\n    label: 'Sophistication Declaration',\r\n    description: 'Self-certification as sophisticated investor',\r\n    category: 'individual',\r\n  },\r\n\r\n  // ===== TAX DOCUMENTS =====\r\n  tax_w8_ben: {\r\n    label: 'W-8BEN / W-8BEN-E',\r\n    description: 'IRS form for foreign persons/entities',\r\n    category: 'both',\r\n  },\r\n  tax_w9: {\r\n    label: 'W-9',\r\n    description: 'IRS form for US persons',\r\n    category: 'individual',\r\n  },\r\n  tax_return: {\r\n    label: 'Tax Return',\r\n    description: 'Recent tax return or tax filing',\r\n    category: 'both',\r\n  },\r\n  tax_residency_certificate: {\r\n    label: 'Tax Residency Certificate',\r\n    description: 'Certificate of tax residency from tax authority',\r\n    category: 'both',\r\n  },\r\n\r\n  // ===== AML / SOURCE OF FUNDS =====\r\n  source_of_funds: {\r\n    label: 'Source of Funds',\r\n    description: 'Source of Funds Declaration',\r\n    category: 'both',\r\n  },\r\n  source_of_wealth: {\r\n    label: 'Source of Wealth',\r\n    description: 'Source of Wealth Declaration',\r\n    category: 'both',\r\n  },\r\n  employment_letter: {\r\n    label: 'Employment Letter',\r\n    description: 'Letter confirming employment and salary',\r\n    category: 'individual',\r\n  },\r\n  business_ownership_proof: {\r\n    label: 'Business Ownership Proof',\r\n    description: 'Documentation proving business ownership',\r\n    category: 'both',\r\n  },\r\n\r\n  // ===== PARTNER / INTRODUCER SPECIFIC =====\r\n  introducer_agreement: {\r\n    label: 'Introducer Agreement',\r\n    description: 'Signed introducer/referral agreement',\r\n    category: 'entity',\r\n  },\r\n  fee_agreement: {\r\n    label: 'Fee Agreement',\r\n    description: 'Signed fee sharing or commission agreement',\r\n    category: 'entity',\r\n  },\r\n  regulatory_license: {\r\n    label: 'Regulatory License',\r\n    description: 'Financial services or regulatory license',\r\n    category: 'entity',\r\n  },\r\n  professional_indemnity_insurance: {\r\n    label: 'Professional Indemnity Insurance',\r\n    description: 'Certificate of professional indemnity insurance',\r\n    category: 'entity',\r\n  },\r\n\r\n  // ===== LAWYER SPECIFIC =====\r\n  practicing_certificate: {\r\n    label: 'Practicing Certificate',\r\n    description: 'Current practicing certificate from bar association',\r\n    category: 'entity',\r\n  },\r\n  bar_membership: {\r\n    label: 'Bar Membership',\r\n    description: 'Bar association membership certificate',\r\n    category: 'entity',\r\n  },\r\n  law_firm_letterhead: {\r\n    label: 'Law Firm Letterhead',\r\n    description: 'Official letterhead confirming association',\r\n    category: 'entity',\r\n  },\r\n\r\n  // ===== MEMBER-SPECIFIC DOCUMENTS =====\r\n  member_passport: {\r\n    label: 'Member Passport/ID',\r\n    description: 'Passport or ID for director/UBO/signatory',\r\n    category: 'both',\r\n    memberOnly: true,\r\n  },\r\n  member_proof_of_address: {\r\n    label: 'Member Proof of Address',\r\n    description: 'Proof of address for director/UBO/signatory',\r\n    category: 'both',\r\n    memberOnly: true,\r\n  },\r\n  specimen_signature: {\r\n    label: 'Specimen Signature',\r\n    description: 'Specimen signature for authorized signatory',\r\n    category: 'both',\r\n    memberOnly: true,\r\n  },\r\n\r\n  // ===== OTHER =====\r\n  other: {\r\n    label: 'Other Document',\r\n    description: 'Any other supporting document',\r\n    category: 'both',\r\n  },\r\n} as const\r\n\r\nexport type KYCDocumentType = keyof typeof SUGGESTED_KYC_DOCUMENT_TYPES\r\n\r\n/**\r\n * Get display label for a document type\r\n */\r\nexport function getDocumentTypeLabel(documentType: string, customLabel?: string | null): string {\r\n  if (customLabel) {\r\n    return customLabel\r\n  }\r\n\r\n  const typeInfo = SUGGESTED_KYC_DOCUMENT_TYPES[documentType]\r\n  return typeInfo?.label || formatDocumentType(documentType)\r\n}\r\n\r\n/**\r\n * Format document type string for display (fallback for unknown types)\r\n */\r\nfunction formatDocumentType(documentType: string): string {\r\n  return documentType\r\n    .split('_')\r\n    .map(word => word.charAt(0).toUpperCase() + word.slice(1))\r\n    .join(' ')\r\n}\r\n\r\n/**\r\n * Get suggested document types for a specific category\r\n */\r\nexport function getSuggestedDocumentTypes(\r\n  category?: 'individual' | 'entity' | 'both',\r\n  options?: { includeMemberOnly?: boolean }\r\n): Array<{\r\n  value: string\r\n  label: string\r\n  description: string\r\n  memberOnly?: boolean\r\n}> {\r\n  return Object.entries(SUGGESTED_KYC_DOCUMENT_TYPES)\r\n    .filter(([_, info]) => {\r\n      // Filter by category\r\n      const categoryMatch = !category || info.category === category || info.category === 'both'\r\n      // Filter member-only documents unless explicitly included\r\n      const memberMatch = options?.includeMemberOnly || !info.memberOnly\r\n      return categoryMatch && memberMatch\r\n    })\r\n    .map(([value, info]) => ({\r\n      value,\r\n      label: info.label,\r\n      description: info.description,\r\n      memberOnly: info.memberOnly,\r\n    }))\r\n}\r\n\r\n/**\r\n * ==============================================\r\n * SIMPLIFIED KYC DOCUMENT TYPES\r\n * ==============================================\r\n *\r\n * INDIVIDUAL INVESTOR: ID + Proof of Address\r\n * ENTITY INVESTOR: Company docs + ID/Address for each director/UBO\r\n */\r\n\r\n/**\r\n * Documents for INDIVIDUAL investors - ID + Proof of Address\r\n */\r\nexport const INDIVIDUAL_REQUIRED_DOCS = [\r\n  { value: 'passport', label: 'Passport', description: 'Valid passport (photo page)' },\r\n  { value: 'utility_bill', label: 'Utility Bill / Proof of Address', description: 'Recent utility bill or bank statement (less than 3 months)' },\r\n] as const\r\n\r\n/**\r\n * Documents for ENTITY-LEVEL (the company itself)\r\n * NO NDA - that's handled separately in deal flow\r\n */\r\nexport const ENTITY_REQUIRED_DOCS = [\r\n  { value: 'incorporation_certificate', label: 'Incorporation Certificate', description: 'Certificate of Incorporation' },\r\n  { value: 'memo_articles', label: 'Memo & Articles', description: 'Memorandum and Articles of Association' },\r\n  { value: 'register_directors', label: 'Register of Directors', description: 'Current list of all directors' },\r\n  { value: 'register_members', label: 'Register of Members/Shareholders', description: 'Current list of shareholders' },\r\n  { value: 'register_beneficial_owners', label: 'Register of UBOs', description: 'List of beneficial owners (>25%)' },\r\n  { value: 'bank_confirmation', label: 'Bank Confirmation Letter', description: 'Bank details for wire transfers' },\r\n] as const\r\n\r\n/**\r\n * Documents for MEMBERS (Directors, UBOs) - personal ID docs\r\n */\r\nexport const MEMBER_REQUIRED_DOCS = [\r\n  { value: 'passport', label: 'Passport / ID', description: 'Valid passport or government ID' },\r\n  { value: 'utility_bill', label: 'Proof of Address', description: 'Utility bill or bank statement (less than 3 months)' },\r\n] as const\r\n\r\n/**\r\n * Get document types for INDIVIDUAL investors\r\n */\r\nexport function getIndividualDocumentTypes() {\r\n  return [...INDIVIDUAL_REQUIRED_DOCS]\r\n}\r\n\r\n/**\r\n * Get document types for ENTITY-level uploads\r\n */\r\nexport function getEntityDocumentTypes() {\r\n  return [...ENTITY_REQUIRED_DOCS]\r\n}\r\n\r\n/**\r\n * Get document types for MEMBER uploads (personal ID for directors/UBOs)\r\n */\r\nexport function getMemberDocumentTypes() {\r\n  return [...MEMBER_REQUIRED_DOCS]\r\n}\r\n\r\n/**\r\n * Check if a document type is a predefined type\r\n */\r\nexport function isPredefinedDocumentType(documentType: string): boolean {\r\n  return documentType in SUGGESTED_KYC_DOCUMENT_TYPES\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 548, "column": 0}, "map": {"version":3,"sources":["file:///Users/ghilesmoussaoui/Desktop/Versotech/versotech-portal/src/app/api/investors/me/kyc-submissions/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server'\r\nimport { createClient } from '@/lib/supabase/server'\r\nimport { getDocumentTypeLabel, getIndividualDocumentTypes, getEntityDocumentTypes } from '@/constants/kyc-document-types'\r\nimport { z } from 'zod'\r\n\r\n// Allowed document types for KYC submissions - SIMPLIFIED\r\nconst ALLOWED_DOCUMENT_TYPES = [\r\n  // Individual docs\r\n  'passport',\r\n  'utility_bill',\r\n  // Entity docs\r\n  'incorporation_certificate',\r\n  'memo_articles',\r\n  'register_directors',\r\n  'register_members',\r\n  'register_beneficial_owners',\r\n  'bank_confirmation',\r\n  // Custom/other\r\n  'other'\r\n] as const\r\n\r\n// Investors can only set draft or pending status - not approved/rejected\r\nconst ALLOWED_INVESTOR_STATUSES = ['draft', 'pending'] as const\r\n\r\n// Schema for POST body validation\r\nconst createSubmissionSchema = z.object({\r\n  document_type: z.enum(ALLOWED_DOCUMENT_TYPES, { message: 'Invalid document type' }),\r\n  custom_label: z.string()\r\n    .max(200, 'Custom label must be less than 200 characters')\r\n    .regex(/^[^<>]*$/, 'Custom label cannot contain HTML tags')\r\n    .optional(),\r\n  metadata: z.record(z.string(), z.unknown()).optional(),\r\n  status: z.enum(ALLOWED_INVESTOR_STATUSES).optional().default('pending'),\r\n  investor_member_id: z.string().uuid().optional()\r\n})\r\n\r\nexport async function GET(request: NextRequest) {\r\n  try {\r\n    // Get authenticated user\r\n    const supabase = await createClient()\r\n    const { data: { user }, error: authError } = await supabase.auth.getUser()\r\n\r\n    if (authError || !user) {\r\n      return NextResponse.json(\r\n        { error: 'Unauthorized' },\r\n        { status: 401 }\r\n      )\r\n    }\r\n\r\n    // Get investor IDs for this user\r\n    // Note: We check investor_users link rather than profile.role to support hybrid personas\r\n    // (e.g., partner_investor, introducer_investor, commercial_partner_investor)\r\n    const { data: investorUsers } = await supabase\r\n      .from('investor_users')\r\n      .select('investor_id')\r\n      .eq('user_id', user.id)\r\n\r\n    if (!investorUsers || investorUsers.length === 0) {\r\n      return NextResponse.json(\r\n        { error: 'No investor profile found' },\r\n        { status: 404 }\r\n      )\r\n    }\r\n\r\n    const investorIds = investorUsers.map(iu => iu.investor_id)\r\n\r\n    // Get ALL KYC submissions (investor KYC only, not entity KYC)\r\n    const { data: submissions, error: submissionsError } = await supabase\r\n      .from('kyc_submissions')\r\n      .select(`\r\n        *,\r\n        document:documents(id, name, file_key, file_size_bytes, mime_type, created_at),\r\n        reviewer:reviewed_by(display_name, email),\r\n        investor_member:investor_member_id(id, full_name, role)\r\n      `)\r\n      .in('investor_id', investorIds)\r\n      .is('counterparty_entity_id', null) // Only investor KYC, not entity KYC\r\n      .order('created_at', { ascending: false })\r\n\r\n    if (submissionsError) {\r\n      console.error('Error fetching submissions:', submissionsError)\r\n      return NextResponse.json(\r\n        { error: 'Failed to fetch KYC submissions' },\r\n        { status: 500 }\r\n      )\r\n    }\r\n\r\n    // Get investor type to provide relevant document suggestions\r\n    const { data: investors } = await supabase\r\n      .from('investors')\r\n      .select('id, type')\r\n      .in('id', investorIds)\r\n\r\n    const investorType = investors?.[0]?.type || 'individual'\r\n    const isEntityInvestor = investorType !== 'individual'\r\n\r\n    // Get investor members if entity-type investor\r\n    let investorMembers: any[] = []\r\n    if (isEntityInvestor && investorIds.length > 0) {\r\n      const { data: members } = await supabase\r\n        .from('investor_members')\r\n        .select('id, full_name, role')\r\n        .eq('investor_id', investorIds[0])\r\n        .eq('is_active', true)\r\n        .order('full_name')\r\n\r\n      investorMembers = members || []\r\n\r\n      // Also include the current user if they're a signatory/admin but not already in investor_members\r\n      const { data: currentUserLink } = await supabase\r\n        .from('investor_users')\r\n        .select('role, can_sign, is_primary')\r\n        .eq('user_id', user.id)\r\n        .eq('investor_id', investorIds[0])\r\n        .single()\r\n\r\n      if (currentUserLink && (currentUserLink.can_sign || currentUserLink.role === 'admin' || currentUserLink.is_primary)) {\r\n        // Get current user's profile info\r\n        const { data: profile } = await supabase\r\n          .from('profiles')\r\n          .select('display_name, email')\r\n          .eq('id', user.id)\r\n          .single()\r\n\r\n        const userName = profile?.display_name || profile?.email || 'Current User'\r\n\r\n        // Check if user is not already in the members list (by matching name/email)\r\n        const alreadyInList = investorMembers.some(m =>\r\n          m.full_name?.toLowerCase() === userName.toLowerCase()\r\n        )\r\n\r\n        if (!alreadyInList) {\r\n          // Add current user as a pseudo-member with special ID prefix\r\n          investorMembers.unshift({\r\n            id: `self_${user.id}`,\r\n            full_name: `${userName} (You)`,\r\n            role: currentUserLink.role === 'admin' ? 'authorized_signatory' : 'signatory'\r\n          })\r\n        }\r\n      }\r\n    }\r\n\r\n    // Get suggested documents based on investor type - use SIMPLIFIED lists\r\n    const suggestedDocuments = isEntityInvestor\r\n      ? getEntityDocumentTypes()\r\n      : getIndividualDocumentTypes()\r\n\r\n    // Group submissions by document type\r\n    const groupedSubmissions: Record<string, any[]> = {}\r\n    submissions?.forEach(sub => {\r\n      const key = sub.document_type\r\n      if (!groupedSubmissions[key]) {\r\n        groupedSubmissions[key] = []\r\n      }\r\n      groupedSubmissions[key].push(sub)\r\n    })\r\n\r\n    // Format all submissions with proper labels\r\n    const formattedSubmissions = (submissions || []).map(sub => ({\r\n      ...sub,\r\n      display_label: getDocumentTypeLabel(sub.document_type, sub.custom_label)\r\n    }))\r\n\r\n    return NextResponse.json({\r\n      success: true,\r\n      submissions: formattedSubmissions,\r\n      grouped_submissions: groupedSubmissions,\r\n      suggested_documents: suggestedDocuments,\r\n      investor_type: investorType,\r\n      is_entity_investor: isEntityInvestor,\r\n      investor_members: investorMembers,\r\n      note: 'Suggested documents are recommendations. You can upload any document type with a custom label.'\r\n    })\r\n\r\n  } catch (error) {\r\n    console.error('KYC submissions GET error:', error)\r\n    return NextResponse.json(\r\n      { error: 'Internal server error' },\r\n      { status: 500 }\r\n    )\r\n  }\r\n}\r\n\r\nexport async function POST(request: NextRequest) {\r\n  try {\r\n    const supabase = await createClient()\r\n    const { data: { user }, error: authError } = await supabase.auth.getUser()\r\n\r\n    if (authError || !user) {\r\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })\r\n    }\r\n\r\n    // Get investor ID\r\n    const { data: investorUsers } = await supabase\r\n      .from('investor_users')\r\n      .select('investor_id')\r\n      .eq('user_id', user.id)\r\n      .single()\r\n\r\n    if (!investorUsers) {\r\n      return NextResponse.json({ error: 'No investor profile found' }, { status: 404 })\r\n    }\r\n\r\n    const body = await request.json()\r\n\r\n    // Validate input to prevent security issues\r\n    const validation = createSubmissionSchema.safeParse(body)\r\n    if (!validation.success) {\r\n      return NextResponse.json({\r\n        error: validation.error.issues[0]?.message || 'Invalid input'\r\n      }, { status: 400 })\r\n    }\r\n\r\n    const { document_type, custom_label, metadata, status, investor_member_id } = validation.data\r\n\r\n    // Check for existing submissions of this document type for versioning\r\n    // For member-specific docs, check by member_id too\r\n    let previousSubmission: any = null\r\n    let newVersion = 1\r\n\r\n    // Build query for previous submissions\r\n    let previousQuery = supabase\r\n      .from('kyc_submissions')\r\n      .select('id, version')\r\n      .eq('investor_id', investorUsers.investor_id)\r\n      .eq('document_type', document_type)\r\n      .is('counterparty_entity_id', null) // Only investor KYC\r\n      .order('version', { ascending: false })\r\n      .limit(1)\r\n\r\n    // For member-specific documents, filter by member\r\n    if (investor_member_id) {\r\n      previousQuery = previousQuery.eq('investor_member_id', investor_member_id)\r\n    } else {\r\n      previousQuery = previousQuery.is('investor_member_id', null)\r\n    }\r\n\r\n    const { data: previousSubmissions } = await previousQuery\r\n\r\n    if (previousSubmissions && previousSubmissions.length > 0) {\r\n      previousSubmission = previousSubmissions[0]\r\n      newVersion = (previousSubmission.version || 1) + 1\r\n    }\r\n\r\n    // Insert submission with versioning support\r\n    const { data, error } = await supabase\r\n      .from('kyc_submissions')\r\n      .insert({\r\n        investor_id: investorUsers.investor_id,\r\n        document_type,\r\n        custom_label: custom_label || null,\r\n        metadata: metadata || null,\r\n        status,\r\n        investor_member_id: investor_member_id || null,\r\n        version: newVersion,\r\n        previous_submission_id: previousSubmission?.id || null\r\n      })\r\n      .select()\r\n      .single()\r\n\r\n    if (error) {\r\n      console.error('Error creating submission:', error)\r\n      return NextResponse.json({ error: 'Failed to create submission' }, { status: 500 })\r\n    }\r\n\r\n    return NextResponse.json({\r\n      success: true,\r\n      submission: data,\r\n      is_new_version: newVersion > 1,\r\n      version: newVersion\r\n    })\r\n\r\n  } catch (error) {\r\n    console.error('KYC submissions POST error:', error)\r\n    return NextResponse.json({ error: 'Internal server error' }, { status: 500 })\r\n  }\r\n}\r\n"],"names":[],"mappings":"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"}}]
}