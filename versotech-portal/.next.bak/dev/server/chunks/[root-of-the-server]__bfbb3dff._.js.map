{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 82, "column": 0}, "map": {"version":3,"sources":["file:///Users/ghilesmoussaoui/Desktop/Versotech/versotech-portal/src/lib/supabase/server.ts"],"sourcesContent":["import { createServerClient } from '@supabase/ssr'\nimport { createClient as createSupabaseClient } from '@supabase/supabase-js'\nimport { cookies } from 'next/headers'\n\nexport const createClient = async () => {\n  const cookieStore = await cookies()\n\n  return createServerClient(\n    process.env.NEXT_PUBLIC_SUPABASE_URL!,\n    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,\n    {\n      cookies: {\n        getAll() {\n          return cookieStore.getAll()\n        },\n        setAll(cookiesToSet) {\n          try {\n            cookiesToSet.forEach(({ name, value, options }) => {\n              cookieStore.set(name, value, options)\n            })\n          } catch (error) {\n            // The `setAll` method was called from a Server Component.\n            // This can be ignored if you have middleware refreshing\n            // user sessions.\n          }\n        },\n      },\n    }\n  )\n}\n\n// Server client with service role for admin operations\n// Uses raw supabase-js client which properly bypasses RLS with service role\nexport const createServiceClient = () => {\n  return createSupabaseClient(\n    process.env.NEXT_PUBLIC_SUPABASE_URL!,\n    process.env.SUPABASE_SERVICE_ROLE_KEY!,\n    {\n      auth: {\n        autoRefreshToken: false,\n        persistSession: false,\n      },\n    }\n  )\n}\n"],"names":[],"mappings":";;;;;;AAAA;AAAA;AACA;AACA;;;;AAEO,MAAM,eAAe;IAC1B,MAAM,cAAc,MAAM,IAAA,mKAAO;IAEjC,OAAO,IAAA,wNAAkB,sUAGvB;QACE,SAAS;YACP;gBACE,OAAO,YAAY,MAAM;YAC3B;YACA,QAAO,YAAY;gBACjB,IAAI;oBACF,aAAa,OAAO,CAAC,CAAC,EAAE,IAAI,EAAE,KAAK,EAAE,OAAO,EAAE;wBAC5C,YAAY,GAAG,CAAC,MAAM,OAAO;oBAC/B;gBACF,EAAE,OAAO,OAAO;gBACd,0DAA0D;gBAC1D,wDAAwD;gBACxD,iBAAiB;gBACnB;YACF;QACF;IACF;AAEJ;AAIO,MAAM,sBAAsB;IACjC,OAAO,IAAA,gOAAoB,gFAEzB,QAAQ,GAAG,CAAC,yBAAyB,EACrC;QACE,MAAM;YACJ,kBAAkB;YAClB,gBAAgB;QAClB;IACF;AAEJ"}},
    {"offset": {"line": 128, "column": 0}, "map": {"version":3,"sources":["file:///Users/ghilesmoussaoui/Desktop/Versotech/versotech-portal/src/app/api/commercial-partners/proxy-subscribe/route.ts"],"sourcesContent":["import { createClient, createServiceClient } from '@/lib/supabase/server'\r\nimport { NextResponse } from 'next/server'\r\nimport { z } from 'zod'\r\n\r\nconst proxySubscribeSchema = z.object({\r\n  deal_id: z.string().uuid(),\r\n  client_investor_id: z.string().uuid(),\r\n  commitment: z.number().positive(),\r\n  stock_type: z.enum(['common', 'preferred', 'convertible', 'warrant', 'bond', 'note', 'other']).optional().default('common'),\r\n  notes: z.string().optional(),\r\n  proxy_authorization_doc_id: z.string().uuid().optional() // Optional reference to authorization document\r\n})\r\n\r\n/**\r\n * POST /api/commercial-partners/proxy-subscribe\r\n * Commercial Partner submits a subscription on behalf of a client investor\r\n *\r\n * This is \"MODE 2\" - Commercial Partner acts as proxy for their client\r\n */\r\nexport async function POST(request: Request) {\r\n  const supabase = await createClient()\r\n  const serviceSupabase = createServiceClient()\r\n\r\n  try {\r\n    // Authenticate user\r\n    const { data: { user }, error: userError } = await supabase.auth.getUser()\r\n    if (userError || !user) {\r\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })\r\n    }\r\n\r\n    // Verify user is a commercial partner with proxy capability\r\n    const { data: cpLinks } = await serviceSupabase\r\n      .from('commercial_partner_users')\r\n      .select(`\r\n        commercial_partner_id,\r\n        can_execute_for_clients,\r\n        role,\r\n        commercial_partners (\r\n          id,\r\n          name,\r\n          legal_name,\r\n          status,\r\n          cp_type\r\n        )\r\n      `)\r\n      .eq('user_id', user.id)\r\n      .eq('can_execute_for_clients', true)\r\n\r\n    if (!cpLinks || cpLinks.length === 0) {\r\n      return NextResponse.json({\r\n        error: 'Forbidden',\r\n        message: 'You are not authorized to execute subscriptions for clients. Contact your administrator to enable proxy capability.'\r\n      }, { status: 403 })\r\n    }\r\n\r\n    const cpLink = cpLinks[0]\r\n    const commercialPartner = cpLink.commercial_partners as any\r\n\r\n    if (commercialPartner?.status !== 'active') {\r\n      return NextResponse.json({\r\n        error: 'Commercial partner not active',\r\n        message: 'Your commercial partner account is not active.'\r\n      }, { status: 403 })\r\n    }\r\n\r\n    // Parse and validate request body\r\n    const body = await request.json()\r\n    const validation = proxySubscribeSchema.safeParse(body)\r\n    if (!validation.success) {\r\n      return NextResponse.json(\r\n        { error: 'Invalid request', details: validation.error.flatten() },\r\n        { status: 400 }\r\n      )\r\n    }\r\n\r\n    const { deal_id, client_investor_id, commitment, stock_type, notes, proxy_authorization_doc_id } = validation.data\r\n\r\n    // Verify deal exists and is open\r\n    const { data: deal, error: dealError } = await serviceSupabase\r\n      .from('deals')\r\n      .select('id, name, status, vehicle_id, minimum_investment, maximum_investment')\r\n      .eq('id', deal_id)\r\n      .single()\r\n\r\n    if (dealError || !deal) {\r\n      return NextResponse.json({ error: 'Deal not found' }, { status: 404 })\r\n    }\r\n\r\n    if (deal.status !== 'open' && deal.status !== 'allocation_pending') {\r\n      return NextResponse.json({\r\n        error: 'Deal not open for subscriptions',\r\n        message: `Deal is currently ${deal.status}`\r\n      }, { status: 400 })\r\n    }\r\n\r\n    // SECURITY: Verify the commercial partner user has been dispatched to this deal\r\n    // This prevents CPs from subscribing to deals they don't have access to\r\n    // NOTE: deal_memberships uses composite key (deal_id, user_id), not a separate id column\r\n    const { data: cpDealMembership } = await serviceSupabase\r\n      .from('deal_memberships')\r\n      .select('deal_id, user_id, role, dispatched_at')\r\n      .eq('deal_id', deal_id)\r\n      .eq('user_id', user.id)\r\n      .in('role', ['commercial_partner_investor', 'commercial_partner_proxy'])\r\n      .maybeSingle()\r\n\r\n    if (!cpDealMembership) {\r\n      return NextResponse.json({\r\n        error: 'Not authorized for this deal',\r\n        message: 'You have not been dispatched to this deal. Contact your relationship manager for access.'\r\n      }, { status: 403 })\r\n    }\r\n\r\n    // Verify client investor exists\r\n    const { data: clientInvestor, error: investorError } = await serviceSupabase\r\n      .from('investors')\r\n      .select('id, legal_name, type, kyc_status')\r\n      .eq('id', client_investor_id)\r\n      .single()\r\n\r\n    if (investorError || !clientInvestor) {\r\n      return NextResponse.json({ error: 'Client investor not found' }, { status: 404 })\r\n    }\r\n\r\n    // Verify client investor has completed KYC\r\n    if (clientInvestor.kyc_status !== 'approved' && clientInvestor.kyc_status !== 'verified') {\r\n      return NextResponse.json({\r\n        error: 'Client KYC not complete',\r\n        message: 'Client investor must complete KYC before subscribing.',\r\n        kyc_status: clientInvestor.kyc_status\r\n      }, { status: 400 })\r\n    }\r\n\r\n    // Check commitment limits\r\n    if (deal.minimum_investment && commitment < deal.minimum_investment) {\r\n      return NextResponse.json({\r\n        error: 'Below minimum investment',\r\n        message: `Minimum investment is ${deal.minimum_investment}`\r\n      }, { status: 400 })\r\n    }\r\n\r\n    if (deal.maximum_investment && commitment > deal.maximum_investment) {\r\n      return NextResponse.json({\r\n        error: 'Exceeds maximum investment',\r\n        message: `Maximum investment is ${deal.maximum_investment}`\r\n      }, { status: 400 })\r\n    }\r\n\r\n    // Check if subscription already exists\r\n    const { data: existingSub } = await serviceSupabase\r\n      .from('subscriptions')\r\n      .select('id, status')\r\n      .eq('deal_id', deal_id)\r\n      .eq('investor_id', client_investor_id)\r\n      .not('status', 'in', '(cancelled,rejected)')\r\n      .maybeSingle()\r\n\r\n    if (existingSub) {\r\n      return NextResponse.json({\r\n        error: 'Subscription already exists',\r\n        message: 'Client already has a subscription for this deal.',\r\n        subscription_id: existingSub.id,\r\n        status: existingSub.status\r\n      }, { status: 400 })\r\n    }\r\n\r\n    // Create the subscription as proxy\r\n    const now = new Date().toISOString()\r\n    const { data: subscription, error: subError } = await serviceSupabase\r\n      .from('subscriptions')\r\n      .insert({\r\n        deal_id,\r\n        vehicle_id: deal.vehicle_id,\r\n        investor_id: client_investor_id,\r\n        commitment,\r\n        funded_amount: 0,\r\n        status: 'pending',\r\n        // Note: stock_type removed - column doesn't exist in subscriptions table\r\n        // Use acknowledgement_notes instead of notes (correct column name)\r\n        acknowledgement_notes: notes,\r\n        // Proxy-specific fields\r\n        submitted_by_proxy: true,\r\n        proxy_user_id: user.id,\r\n        proxy_commercial_partner_id: cpLink.commercial_partner_id,\r\n        proxy_authorization_doc_id,\r\n        created_at: now\r\n      })\r\n      .select()\r\n      .single()\r\n\r\n    if (subError) {\r\n      console.error('Error creating proxy subscription:', subError)\r\n      // Check if it's a missing column error\r\n      if (subError.message?.includes('submitted_by_proxy')) {\r\n        // Fallback without proxy fields if columns don't exist yet\r\n        const { data: fallbackSub, error: fallbackError } = await serviceSupabase\r\n          .from('subscriptions')\r\n          .insert({\r\n            deal_id,\r\n            vehicle_id: deal.vehicle_id,\r\n            investor_id: client_investor_id,\r\n            commitment,\r\n            funded_amount: 0,\r\n            status: 'pending',\r\n            acknowledgement_notes: `${notes || ''}\\n[Submitted by proxy: ${commercialPartner?.name} via ${user.email}]`.trim(),\r\n            created_at: now\r\n          })\r\n          .select()\r\n          .single()\r\n\r\n        if (fallbackError) {\r\n          return NextResponse.json({ error: 'Failed to create subscription' }, { status: 500 })\r\n        }\r\n\r\n        // Log audit event with proxy info\r\n        await serviceSupabase.from('audit_logs').insert({\r\n          user_id: user.id,\r\n          action: 'proxy_subscription_created',\r\n          entity_type: 'subscription',\r\n          entity_id: fallbackSub.id,\r\n          details: {\r\n            deal_id,\r\n            deal_name: deal.name,\r\n            client_investor_id,\r\n            client_name: clientInvestor.legal_name,\r\n            commitment,\r\n            commercial_partner_id: cpLink.commercial_partner_id,\r\n            commercial_partner_name: commercialPartner?.name\r\n          },\r\n          created_at: now\r\n        })\r\n\r\n        return NextResponse.json({\r\n          success: true,\r\n          subscription_id: fallbackSub.id,\r\n          message: `Subscription submitted on behalf of ${clientInvestor.legal_name}`,\r\n          proxy_mode: true,\r\n          client: {\r\n            id: client_investor_id,\r\n            name: clientInvestor.legal_name\r\n          },\r\n          deal: {\r\n            id: deal_id,\r\n            name: deal.name\r\n          },\r\n          commitment\r\n        })\r\n      }\r\n      return NextResponse.json({ error: 'Failed to create subscription' }, { status: 500 })\r\n    }\r\n\r\n    // Log audit event\r\n    await serviceSupabase.from('audit_logs').insert({\r\n      user_id: user.id,\r\n      action: 'proxy_subscription_created',\r\n      entity_type: 'subscription',\r\n      entity_id: subscription.id,\r\n      details: {\r\n        deal_id,\r\n        deal_name: deal.name,\r\n        client_investor_id,\r\n        client_name: clientInvestor.legal_name,\r\n        commitment,\r\n        commercial_partner_id: cpLink.commercial_partner_id,\r\n        commercial_partner_name: commercialPartner?.name,\r\n        proxy_authorization_doc_id\r\n      },\r\n      created_at: now\r\n    })\r\n\r\n    // Create notification for client investor's users\r\n    const { data: clientUsers } = await serviceSupabase\r\n      .from('investor_users')\r\n      .select('user_id')\r\n      .eq('investor_id', client_investor_id)\r\n\r\n    if (clientUsers && clientUsers.length > 0) {\r\n      const notifications = clientUsers.map(u => ({\r\n        user_id: u.user_id,\r\n        investor_id: client_investor_id,\r\n        title: 'Subscription Submitted',\r\n        message: `${commercialPartner?.name} has submitted a subscription of ${commitment.toLocaleString()} for ${deal.name} on your behalf.`,\r\n        link: '/versotech_main/tasks',\r\n        metadata: {\r\n          type: 'proxy_subscription',\r\n          subscription_id: subscription.id,\r\n          deal_id,\r\n          commercial_partner_id: cpLink.commercial_partner_id\r\n        }\r\n      }))\r\n\r\n      await serviceSupabase.from('investor_notifications').insert(notifications)\r\n    }\r\n\r\n    return NextResponse.json({\r\n      success: true,\r\n      subscription_id: subscription.id,\r\n      message: `Subscription submitted on behalf of ${clientInvestor.legal_name}`,\r\n      proxy_mode: true,\r\n      client: {\r\n        id: client_investor_id,\r\n        name: clientInvestor.legal_name,\r\n        type: clientInvestor.type\r\n      },\r\n      deal: {\r\n        id: deal_id,\r\n        name: deal.name\r\n      },\r\n      commitment,\r\n      status: 'pending'\r\n    })\r\n  } catch (error) {\r\n    console.error('Unexpected error in POST /api/commercial-partners/proxy-subscribe:', error)\r\n    return NextResponse.json({ error: 'Internal server error' }, { status: 500 })\r\n  }\r\n}\r\n\r\n/**\r\n * GET /api/commercial-partners/proxy-subscribe\r\n * Get list of clients available for proxy subscription\r\n */\r\nexport async function GET(request: Request) {\r\n  const supabase = await createClient()\r\n  const serviceSupabase = createServiceClient()\r\n\r\n  try {\r\n    const { data: { user }, error: userError } = await supabase.auth.getUser()\r\n    if (userError || !user) {\r\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })\r\n    }\r\n\r\n    // Verify user is a commercial partner with proxy capability\r\n    const { data: cpLinks } = await serviceSupabase\r\n      .from('commercial_partner_users')\r\n      .select(`\r\n        commercial_partner_id,\r\n        can_execute_for_clients,\r\n        commercial_partners (\r\n          id,\r\n          name,\r\n          status\r\n        )\r\n      `)\r\n      .eq('user_id', user.id)\r\n      .eq('can_execute_for_clients', true)\r\n\r\n    // Return empty response if not a commercial partner (don't 403, just indicate no proxy capability)\r\n    if (!cpLinks || cpLinks.length === 0) {\r\n      return NextResponse.json({\r\n        commercial_partner_id: null,\r\n        commercial_partner_name: null,\r\n        clients: [],\r\n        can_execute_for_clients: false\r\n      })\r\n    }\r\n\r\n    const cpId = cpLinks[0].commercial_partner_id\r\n\r\n    // Get clients from commercial_partner_clients table (primary source)\r\n    const { data: cpClients } = await serviceSupabase\r\n      .from('commercial_partner_clients')\r\n      .select(`\r\n        id,\r\n        client_name,\r\n        client_email,\r\n        client_type,\r\n        client_investor_id,\r\n        is_active,\r\n        investor:client_investor_id (\r\n          id,\r\n          legal_name,\r\n          type,\r\n          kyc_status\r\n        )\r\n      `)\r\n      .eq('commercial_partner_id', cpId)\r\n      .eq('is_active', true)\r\n      .order('client_name')\r\n\r\n    // Also get legacy clients linked via investors.commercial_partner_id\r\n    const { data: legacyClients } = await serviceSupabase\r\n      .from('investors')\r\n      .select(`\r\n        id,\r\n        legal_name,\r\n        type,\r\n        kyc_status\r\n      `)\r\n      .eq('commercial_partner_id', cpId)\r\n      .eq('status', 'active')\r\n      .order('legal_name')\r\n\r\n    // Combine and dedupe clients (client_investor_id from cpClients overlaps with legacyClients)\r\n    const clientInvestorIds = new Set((cpClients || []).map(c => c.client_investor_id).filter(Boolean))\r\n    const uniqueLegacyClients = (legacyClients || []).filter(lc => !clientInvestorIds.has(lc.id))\r\n\r\n    // Format clients for response\r\n    // IMPORTANT: Field names must match the Client interface in proxy-mode-context.tsx\r\n    // Interface expects: { id, name, investor_type, kyc_status }\r\n    const formattedClients = [\r\n      // Clients from commercial_partner_clients (with or without linked investors)\r\n      ...(cpClients || [])\r\n        .map(c => {\r\n          const investor = c.investor as any\r\n          return {\r\n            id: investor?.id || null,  // null if no investor linked\r\n            name: investor?.legal_name || c.client_name,\r\n            investor_type: investor?.type || c.client_type || 'entity',\r\n            kyc_status: investor?.kyc_status || 'not_linked',  // Custom status for unlinked\r\n            client_record_id: c.id // Include the client record ID for reference\r\n          }\r\n        }),\r\n      // Legacy clients directly linked to CP\r\n      ...uniqueLegacyClients.map(lc => ({\r\n        id: lc.id,\r\n        name: lc.legal_name,\r\n        investor_type: lc.type,\r\n        kyc_status: lc.kyc_status\r\n      }))\r\n    ]\r\n\r\n    return NextResponse.json({\r\n      commercial_partner_id: cpId,\r\n      commercial_partner_name: (cpLinks[0].commercial_partners as any)?.name,\r\n      clients: formattedClients,\r\n      can_execute_for_clients: true\r\n    })\r\n  } catch (error) {\r\n    console.error('Unexpected error in GET /api/commercial-partners/proxy-subscribe:', error)\r\n    return NextResponse.json({ error: 'Internal server error' }, { status: 500 })\r\n  }\r\n}\r\n"],"names":[],"mappings":"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"}}]
}