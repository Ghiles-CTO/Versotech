{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 82, "column": 0}, "map": {"version":3,"sources":["file:///Users/ghilesmoussaoui/Desktop/Versotech/versotech-portal/src/lib/supabase/server.ts"],"sourcesContent":["import { createServerClient } from '@supabase/ssr'\nimport { createClient as createSupabaseClient } from '@supabase/supabase-js'\nimport { cookies } from 'next/headers'\n\nexport const createClient = async () => {\n  const cookieStore = await cookies()\n\n  return createServerClient(\n    process.env.NEXT_PUBLIC_SUPABASE_URL!,\n    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,\n    {\n      cookies: {\n        getAll() {\n          return cookieStore.getAll()\n        },\n        setAll(cookiesToSet) {\n          try {\n            cookiesToSet.forEach(({ name, value, options }) => {\n              cookieStore.set(name, value, options)\n            })\n          } catch (error) {\n            // The `setAll` method was called from a Server Component.\n            // This can be ignored if you have middleware refreshing\n            // user sessions.\n          }\n        },\n      },\n    }\n  )\n}\n\n// Server client with service role for admin operations\n// Uses raw supabase-js client which properly bypasses RLS with service role\nexport const createServiceClient = () => {\n  return createSupabaseClient(\n    process.env.NEXT_PUBLIC_SUPABASE_URL!,\n    process.env.SUPABASE_SERVICE_ROLE_KEY!,\n    {\n      auth: {\n        autoRefreshToken: false,\n        persistSession: false,\n      },\n    }\n  )\n}\n"],"names":[],"mappings":";;;;;;AAAA;AAAA;AACA;AACA;;;;AAEO,MAAM,eAAe;IAC1B,MAAM,cAAc,MAAM,IAAA,mKAAO;IAEjC,OAAO,IAAA,wNAAkB,sUAGvB;QACE,SAAS;YACP;gBACE,OAAO,YAAY,MAAM;YAC3B;YACA,QAAO,YAAY;gBACjB,IAAI;oBACF,aAAa,OAAO,CAAC,CAAC,EAAE,IAAI,EAAE,KAAK,EAAE,OAAO,EAAE;wBAC5C,YAAY,GAAG,CAAC,MAAM,OAAO;oBAC/B;gBACF,EAAE,OAAO,OAAO;gBACd,0DAA0D;gBAC1D,wDAAwD;gBACxD,iBAAiB;gBACnB;YACF;QACF;IACF;AAEJ;AAIO,MAAM,sBAAsB;IACjC,OAAO,IAAA,gOAAoB,gFAEzB,QAAQ,GAAG,CAAC,yBAAyB,EACrC;QACE,MAAM;YACJ,kBAAkB;YAClB,gBAAgB;QAClB;IACF;AAEJ"}},
    {"offset": {"line": 128, "column": 0}, "map": {"version":3,"sources":["file:///Users/ghilesmoussaoui/Desktop/Versotech/versotech-portal/src/lib/audit.ts"],"sourcesContent":["import { createClient } from './supabase/server'\r\n\r\nexport interface AuditLogEntry {\r\n  actor_user_id?: string\r\n  action: string\r\n  entity: string\r\n  entity_id?: string\r\n  metadata?: Record<string, any>\r\n}\r\n\r\nclass AuditLogger {\r\n  private static instance: AuditLogger\r\n\r\n  static getInstance(): AuditLogger {\r\n    if (!AuditLogger.instance) {\r\n      AuditLogger.instance = new AuditLogger()\r\n    }\r\n    return AuditLogger.instance\r\n  }\r\n\r\n  async log(entry: AuditLogEntry): Promise<void> {\r\n    try {\r\n      const supabase = await createClient()\r\n\r\n      // Insert into audit_logs with correct column names\r\n      await supabase.from('audit_logs').insert({\r\n        event_type: 'system',\r\n        actor_id: entry.actor_user_id || null,\r\n        action: entry.action,\r\n        entity_type: entry.entity,\r\n        entity_id: entry.entity_id || null,\r\n        action_details: entry.metadata || null,\r\n        timestamp: new Date().toISOString()\r\n      })\r\n\r\n    } catch (error) {\r\n      console.error('Audit logging failed:', error)\r\n      // Don't throw to avoid breaking the main operation\r\n    }\r\n  }\r\n\r\n  async logMany(entries: AuditLogEntry[]): Promise<void> {\r\n    for (const entry of entries) {\r\n      await this.log(entry)\r\n    }\r\n  }\r\n}\r\n\r\nexport const auditLogger = AuditLogger.getInstance()\r\n\r\n// Common audit actions as constants\r\nexport const AuditActions = {\r\n  // Authentication\r\n  LOGIN: 'login',\r\n  LOGOUT: 'logout',\r\n  PASSWORD_CHANGE: 'password_change',\r\n\r\n  // Data operations\r\n  CREATE: 'create',\r\n  READ: 'read', \r\n  UPDATE: 'update',\r\n  DELETE: 'delete',\r\n\r\n  // Documents\r\n  DOCUMENT_UPLOAD: 'document_upload',\r\n  DOCUMENT_DOWNLOAD: 'document_download',\r\n  DOCUMENT_DELETE: 'document_delete',\r\n\r\n  // Workflows\r\n  WORKFLOW_TRIGGER: 'workflow_trigger',\r\n  WORKFLOW_COMPLETED: 'workflow_completed',\r\n  WORKFLOW_FAILED: 'workflow_failed',\r\n\r\n  // System operations\r\n  USER_CREATED: 'user_created',\r\n  PROFILE_UPDATED: 'profile_updated',\r\n  ROLE_CHANGED: 'role_changed',\r\n\r\n  // Business operations\r\n  SUBSCRIPTION_CREATED: 'subscription_created',\r\n  CAPITAL_CALL_CREATED: 'capital_call_created',\r\n  DISTRIBUTION_CREATED: 'distribution_created',\r\n  REPORT_REQUESTED: 'report_requested',\r\n  MESSAGE_SENT: 'message_sent',\r\n\r\n  // Commission lifecycle (GAP-7)\r\n  COMMISSION_CREATED: 'commission_created',\r\n  COMMISSION_ACCRUED: 'commission_accrued',\r\n  COMMISSION_INVOICE_REQUESTED: 'commission_invoice_requested',\r\n  COMMISSION_INVOICED: 'commission_invoiced',\r\n  COMMISSION_PAID: 'commission_paid',\r\n  COMMISSION_CANCELLED: 'commission_cancelled',\r\n\r\n  // Agreement events (GAP-8)\r\n  AGREEMENT_CREATED: 'agreement_created',\r\n  AGREEMENT_SENT: 'agreement_sent',\r\n  AGREEMENT_APPROVED: 'agreement_approved',\r\n  AGREEMENT_SIGNED: 'agreement_signed',\r\n  AGREEMENT_ACTIVATED: 'agreement_activated',\r\n  AGREEMENT_REJECTED: 'agreement_rejected',\r\n  AGREEMENT_EXPIRED: 'agreement_expired'\r\n} as const\r\n\r\n// Entity types\r\nexport const AuditEntities = {\r\n  USERS: 'users',\r\n  PROFILES: 'profiles',\r\n  INVESTORS: 'investors',\r\n  VEHICLES: 'vehicles',\r\n  SUBSCRIPTIONS: 'subscriptions',\r\n  POSITIONS: 'positions',\r\n  DOCUMENTS: 'documents',\r\n  WORKFLOWS: 'workflows',\r\n  WORKFLOW_RUNS: 'workflow_runs',\r\n  CONVERSATIONS: 'conversations',\r\n  MESSAGES: 'messages',\r\n  REQUEST_TICKETS: 'request_tickets',\r\n  CAPITAL_CALLS: 'capital_calls',\r\n  DISTRIBUTIONS: 'distributions',\r\n  DEALS: 'deals',\r\n  // RESERVATIONS: 'reservations', // Deprecated - removed from workflow\r\n  ALLOCATIONS: 'allocations',\r\n  FEE_EVENTS: 'fee_events',\r\n  INVOICES: 'invoices',\r\n  BANK_TRANSACTIONS: 'bank_transactions',\r\n  PAYMENTS: 'payments',\r\n  ARRANGER: 'arranger_entities',\r\n  INTRODUCER: 'introducers',\r\n  PARTNER: 'partners',\r\n  COMMERCIAL_PARTNER: 'commercial_partners',\r\n  FEE_PLANS: 'arranger_fee_plans',\r\n  CEO_ENTITY: 'ceo_entity',\r\n  CEO_USERS: 'ceo_users',\r\n  // Commission entities (GAP-7)\r\n  INTRODUCER_COMMISSIONS: 'introducer_commissions',\r\n  PARTNER_COMMISSIONS: 'partner_commissions',\r\n  COMMERCIAL_PARTNER_COMMISSIONS: 'commercial_partner_commissions',\r\n  // Agreement entities (GAP-8)\r\n  INTRODUCER_AGREEMENTS: 'introducer_agreements',\r\n  PARTNER_AGREEMENTS: 'partner_agreements',\r\n  COMMERCIAL_PARTNER_AGREEMENTS: 'commercial_partner_agreements',\r\n  // Introductions\r\n  INTRODUCTIONS: 'introductions',\r\n} as const\r\n\r\n"],"names":[],"mappings":";;;;;;;;AAAA;;AAUA,MAAM;IACJ,OAAe,SAAqB;IAEpC,OAAO,cAA2B;QAChC,IAAI,CAAC,YAAY,QAAQ,EAAE;YACzB,YAAY,QAAQ,GAAG,IAAI;QAC7B;QACA,OAAO,YAAY,QAAQ;IAC7B;IAEA,MAAM,IAAI,KAAoB,EAAiB;QAC7C,IAAI;YACF,MAAM,WAAW,MAAM,IAAA,yKAAY;YAEnC,mDAAmD;YACnD,MAAM,SAAS,IAAI,CAAC,cAAc,MAAM,CAAC;gBACvC,YAAY;gBACZ,UAAU,MAAM,aAAa,IAAI;gBACjC,QAAQ,MAAM,MAAM;gBACpB,aAAa,MAAM,MAAM;gBACzB,WAAW,MAAM,SAAS,IAAI;gBAC9B,gBAAgB,MAAM,QAAQ,IAAI;gBAClC,WAAW,IAAI,OAAO,WAAW;YACnC;QAEF,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,yBAAyB;QACvC,mDAAmD;QACrD;IACF;IAEA,MAAM,QAAQ,OAAwB,EAAiB;QACrD,KAAK,MAAM,SAAS,QAAS;YAC3B,MAAM,IAAI,CAAC,GAAG,CAAC;QACjB;IACF;AACF;AAEO,MAAM,cAAc,YAAY,WAAW;AAG3C,MAAM,eAAe;IAC1B,iBAAiB;IACjB,OAAO;IACP,QAAQ;IACR,iBAAiB;IAEjB,kBAAkB;IAClB,QAAQ;IACR,MAAM;IACN,QAAQ;IACR,QAAQ;IAER,YAAY;IACZ,iBAAiB;IACjB,mBAAmB;IACnB,iBAAiB;IAEjB,YAAY;IACZ,kBAAkB;IAClB,oBAAoB;IACpB,iBAAiB;IAEjB,oBAAoB;IACpB,cAAc;IACd,iBAAiB;IACjB,cAAc;IAEd,sBAAsB;IACtB,sBAAsB;IACtB,sBAAsB;IACtB,sBAAsB;IACtB,kBAAkB;IAClB,cAAc;IAEd,+BAA+B;IAC/B,oBAAoB;IACpB,oBAAoB;IACpB,8BAA8B;IAC9B,qBAAqB;IACrB,iBAAiB;IACjB,sBAAsB;IAEtB,2BAA2B;IAC3B,mBAAmB;IACnB,gBAAgB;IAChB,oBAAoB;IACpB,kBAAkB;IAClB,qBAAqB;IACrB,oBAAoB;IACpB,mBAAmB;AACrB;AAGO,MAAM,gBAAgB;IAC3B,OAAO;IACP,UAAU;IACV,WAAW;IACX,UAAU;IACV,eAAe;IACf,WAAW;IACX,WAAW;IACX,WAAW;IACX,eAAe;IACf,eAAe;IACf,UAAU;IACV,iBAAiB;IACjB,eAAe;IACf,eAAe;IACf,OAAO;IACP,sEAAsE;IACtE,aAAa;IACb,YAAY;IACZ,UAAU;IACV,mBAAmB;IACnB,UAAU;IACV,UAAU;IACV,YAAY;IACZ,SAAS;IACT,oBAAoB;IACpB,WAAW;IACX,YAAY;IACZ,WAAW;IACX,8BAA8B;IAC9B,wBAAwB;IACxB,qBAAqB;IACrB,gCAAgC;IAChC,6BAA6B;IAC7B,uBAAuB;IACvB,oBAAoB;IACpB,+BAA+B;IAC/B,gBAAgB;IAChB,eAAe;AACjB"}},
    {"offset": {"line": 259, "column": 0}, "map": {"version":3,"sources":["file:///Users/ghilesmoussaoui/Desktop/Versotech/versotech-portal/src/app/api/deals/%5Bid%5D/fee-structures/%5BstructureId%5D/attachment/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server'\nimport { createClient, createServiceClient } from '@/lib/supabase/server'\nimport { auditLogger, AuditActions, AuditEntities } from '@/lib/audit'\n\nexport const dynamic = 'force-dynamic'\n\n/**\n * Check if user has access to view this term sheet based on their persona\n * Returns { allowed: boolean, reason?: string }\n */\nasync function checkTermsheetAccess(\n  serviceSupabase: ReturnType<typeof createServiceClient>,\n  userId: string,\n  dealId: string,\n  structureId: string\n): Promise<{ allowed: boolean; reason?: string }> {\n  // Get user personas\n  const { data: personas, error: personaError } = await serviceSupabase.rpc('get_user_personas', {\n    p_user_id: userId,\n  })\n\n  console.log('üîç [TERMSHEET ACCESS] userId:', userId)\n  console.log('üîç [TERMSHEET ACCESS] personas:', JSON.stringify(personas))\n  console.log('üîç [TERMSHEET ACCESS] personaError:', personaError)\n\n  if (personaError || !personas || personas.length === 0) {\n    console.log('üîç [TERMSHEET ACCESS] No personas found, denying access')\n    return { allowed: false, reason: 'No personas found' }\n  }\n\n  // Check persona types\n  const isStaff = personas.some((p: any) => p.persona_type === 'staff')\n  const isCeo = personas.some((p: any) => p.persona_type === 'ceo')\n  const investorPersona = personas.find((p: any) => p.persona_type === 'investor')\n  const partnerPersona = personas.find((p: any) => p.persona_type === 'partner')\n  const commercialPartnerPersona = personas.find((p: any) => p.persona_type === 'commercial_partner')\n  const arrangerPersona = personas.find((p: any) => p.persona_type === 'arranger')\n\n  console.log('üîç [TERMSHEET ACCESS] isStaff:', isStaff, 'isCeo:', isCeo)\n\n  // Staff and CEO have full access\n  if (isStaff || isCeo) {\n    console.log('üîç [TERMSHEET ACCESS] Granting access - staff/ceo')\n    return { allowed: true }\n  }\n\n  // Verify the fee structure is published (non-staff can only view published termsheets)\n  const { data: feeStructure } = await serviceSupabase\n    .from('deal_fee_structures')\n    .select('status')\n    .eq('id', structureId)\n    .eq('deal_id', dealId)\n    .single()\n\n  if (!feeStructure || feeStructure.status !== 'published') {\n    return { allowed: false, reason: 'Term sheet not published' }\n  }\n\n  // Investor: Check deal membership\n  if (investorPersona) {\n    const { data: membership } = await serviceSupabase\n      .from('deal_memberships')\n      .select('deal_id')\n      .eq('deal_id', dealId)\n      .eq('investor_id', investorPersona.entity_id)\n      .maybeSingle()\n\n    if (membership) {\n      return { allowed: true }\n    }\n  }\n\n  // Partner: Check fee_plans or deal_memberships referrals\n  if (partnerPersona) {\n    // Check if partner has a fee plan for this term sheet\n    const { data: feePlan } = await serviceSupabase\n      .from('fee_plans')\n      .select('id')\n      .eq('deal_id', dealId)\n      .eq('partner_id', partnerPersona.entity_id)\n      .maybeSingle()\n\n    if (feePlan) {\n      return { allowed: true }\n    }\n\n    // Check if partner has referred investors to this deal\n    const { data: referral } = await serviceSupabase\n      .from('deal_memberships')\n      .select('deal_id')\n      .eq('deal_id', dealId)\n      .eq('referred_by_entity_type', 'partner')\n      .eq('referred_by_entity_id', partnerPersona.entity_id)\n      .limit(1)\n      .maybeSingle()\n\n    if (referral) {\n      return { allowed: true }\n    }\n  }\n\n  // Commercial Partner: Same logic as partner\n  if (commercialPartnerPersona) {\n    const { data: feePlan } = await serviceSupabase\n      .from('fee_plans')\n      .select('id')\n      .eq('deal_id', dealId)\n      .eq('commercial_partner_id', commercialPartnerPersona.entity_id)\n      .maybeSingle()\n\n    if (feePlan) {\n      return { allowed: true }\n    }\n\n    const { data: referral } = await serviceSupabase\n      .from('deal_memberships')\n      .select('deal_id')\n      .eq('deal_id', dealId)\n      .eq('referred_by_entity_type', 'commercial_partner')\n      .eq('referred_by_entity_id', commercialPartnerPersona.entity_id)\n      .limit(1)\n      .maybeSingle()\n\n    if (referral) {\n      return { allowed: true }\n    }\n  }\n\n  // Arranger: Check if deal belongs to their vehicle\n  if (arrangerPersona) {\n    const { data: deal } = await serviceSupabase\n      .from('deals')\n      .select('vehicle_id')\n      .eq('id', dealId)\n      .single()\n\n    if (deal?.vehicle_id) {\n      const { data: vehicle } = await serviceSupabase\n        .from('vehicles')\n        .select('arranger_entity_id')\n        .eq('id', deal.vehicle_id)\n        .single()\n\n      if (vehicle?.arranger_entity_id === arrangerPersona.entity_id) {\n        return { allowed: true }\n      }\n    }\n  }\n\n  return { allowed: false, reason: 'Access denied' }\n}\n\n/**\n * GET /api/deals/[id]/fee-structures/[structureId]/attachment\n * Get signed URL for term sheet attachment preview/download\n *\n * Access: Staff, Investors (with deal membership), Partners/Commercial Partners (with referrals or fee plans), Arrangers (for their vehicles)\n */\nexport async function GET(\n  request: NextRequest,\n  { params }: { params: Promise<{ id: string; structureId: string }> }\n) {\n  const { id: dealId, structureId } = await params\n\n  const clientSupabase = await createClient()\n  const { data: { user }, error: authError } = await clientSupabase.auth.getUser()\n\n  if (authError || !user) {\n    return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })\n  }\n\n  const serviceSupabase = createServiceClient()\n\n  // Check persona-based access\n  const accessCheck = await checkTermsheetAccess(serviceSupabase, user.id, dealId, structureId)\n  if (!accessCheck.allowed) {\n    return NextResponse.json({ error: accessCheck.reason || 'Access denied' }, { status: 403 })\n  }\n\n  // Fetch the term sheet to get attachment key\n  const { data: feeStructure, error: fetchError } = await serviceSupabase\n    .from('deal_fee_structures')\n    .select('term_sheet_attachment_key')\n    .eq('deal_id', dealId)\n    .eq('id', structureId)\n    .single()\n\n  if (fetchError || !feeStructure) {\n    return NextResponse.json({ error: 'Term sheet not found' }, { status: 404 })\n  }\n\n  if (!feeStructure.term_sheet_attachment_key) {\n    return NextResponse.json({ error: 'No attachment uploaded' }, { status: 404 })\n  }\n\n  // Term sheets are stored in 'deal-documents' bucket\n  const bucket = 'deal-documents'\n\n  // Create signed URL for preview (1 hour expiry)\n  const { data: signedUrlData, error: signedUrlError } = await serviceSupabase.storage\n    .from(bucket)\n    .createSignedUrl(feeStructure.term_sheet_attachment_key, 3600)\n\n  if (signedUrlError || !signedUrlData?.signedUrl) {\n    console.error('Failed to create signed URL:', signedUrlError)\n    return NextResponse.json({ error: 'Failed to generate preview URL' }, { status: 500 })\n  }\n\n  return NextResponse.json({\n    url: signedUrlData.signedUrl,\n    key: feeStructure.term_sheet_attachment_key\n  })\n}\n\nconst ALLOWED_MIME_TYPES = new Set([\n  'application/pdf',\n  'application/vnd.openxmlformats-officedocument.wordprocessingml.document',\n  'application/msword'\n])\n\nexport async function POST(\n  request: NextRequest,\n  { params }: { params: Promise<{ id: string; structureId: string }> }\n) {\n  const { id: dealId, structureId } = await params\n\n  const clientSupabase = await createClient()\n  const { data: { user }, error: authError } = await clientSupabase.auth.getUser()\n\n  if (authError || !user) {\n    return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })\n  }\n\n  const { data: profile } = await clientSupabase\n    .from('profiles')\n    .select('role')\n    .eq('id', user.id)\n    .single()\n\n  if (!(profile?.role?.startsWith('staff_') || profile?.role === 'ceo')) {\n    return NextResponse.json({ error: 'Staff access required' }, { status: 403 })\n  }\n\n  const formData = await request.formData()\n  const file = formData.get('file') as File | null\n\n  if (!file) {\n    return NextResponse.json({ error: 'File is required' }, { status: 400 })\n  }\n\n  if (!ALLOWED_MIME_TYPES.has(file.type)) {\n    return NextResponse.json(\n      { error: 'Unsupported file type. Upload a PDF or DOCX term sheet.' },\n      { status: 400 }\n    )\n  }\n\n  const serviceSupabase = createServiceClient()\n\n  // Fetch existing record to remove previous attachment if necessary\n  const { data: feeStructure, error: fetchError } = await serviceSupabase\n    .from('deal_fee_structures')\n    .select('term_sheet_attachment_key')\n    .eq('deal_id', dealId)\n    .eq('id', structureId)\n    .single()\n\n  if (fetchError || !feeStructure) {\n    return NextResponse.json({ error: 'Term sheet not found' }, { status: 404 })\n  }\n\n  // Term sheets are stored in 'deal-documents' bucket\n  const bucket = 'deal-documents'\n  const timestamp = Date.now()\n  const sanitizedName = file.name.replace(/[^a-zA-Z0-9.-]/g, '_')\n  const fileKey = `term-sheets/${dealId}/${structureId}/${timestamp}-${sanitizedName}`\n\n  try {\n    const arrayBuffer = await file.arrayBuffer()\n    const buffer = Buffer.from(arrayBuffer)\n\n    const { error: uploadError } = await serviceSupabase.storage\n      .from(bucket)\n      .upload(fileKey, buffer, {\n        contentType: file.type,\n        upsert: false\n      })\n\n    if (uploadError) {\n      console.error('Failed to upload term sheet attachment', uploadError)\n      return NextResponse.json(\n        { error: 'Failed to upload term sheet attachment' },\n        { status: 500 }\n      )\n    }\n\n    const { error: updateError } = await serviceSupabase\n      .from('deal_fee_structures')\n      .update({\n        term_sheet_attachment_key: fileKey,\n        updated_at: new Date().toISOString()\n      })\n      .eq('id', structureId)\n      .eq('deal_id', dealId)\n\n    if (updateError) {\n      console.error('Failed to update deal_fee_structures with attachment', updateError)\n      // Clean up uploaded file\n      await serviceSupabase.storage.from(bucket).remove([fileKey])\n      return NextResponse.json(\n        { error: 'Failed to update term sheet record' },\n        { status: 500 }\n      )\n    }\n\n    if (feeStructure.term_sheet_attachment_key && feeStructure.term_sheet_attachment_key !== fileKey) {\n      await serviceSupabase.storage.from(bucket).remove([feeStructure.term_sheet_attachment_key])\n    }\n\n    await auditLogger.log({\n      actor_user_id: user.id,\n      action: AuditActions.UPDATE,\n      entity: AuditEntities.DEALS,\n      entity_id: structureId,\n      metadata: {\n        type: 'term_sheet_attachment_uploaded',\n        deal_id: dealId,\n        storage_key: fileKey,\n        file_name: file.name,\n        file_size: file.size\n      }\n    })\n\n    return NextResponse.json({\n      success: true,\n      term_sheet_attachment_key: fileKey\n    })\n  } catch (error) {\n    console.error('Unexpected error uploading term sheet attachment', error)\n    return NextResponse.json(\n      { error: 'Unexpected error uploading term sheet attachment' },\n      { status: 500 }\n    )\n  }\n}\n"],"names":[],"mappings":"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"}}]
}