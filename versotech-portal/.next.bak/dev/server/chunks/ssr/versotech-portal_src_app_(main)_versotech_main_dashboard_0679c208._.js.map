{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/ghilesmoussaoui/Desktop/Versotech/versotech-portal/src/app/%28main%29/versotech_main/dashboard/ceo-dashboard.tsx"],"sourcesContent":["'use client'\n\nimport { EnhancedStaffDashboard } from '@/components/dashboard/enhanced-staff-dashboard'\nimport { RealtimeStaffDashboard } from '@/components/dashboard/realtime-staff-dashboard'\n\ninterface CEODashboardProps {\n  dashboardData: any\n  realtimeMetrics: {\n    activeLps: number\n    pendingKyc: number\n    workflowRuns: number\n    complianceRate: number\n    kycPipeline: number\n    ndaInProgress: number\n    subscriptionReview: number\n    activeDeals: number\n    activeRequests: number\n    lastUpdated: string\n  }\n}\n\n/**\n * CEO Dashboard - Full executive dashboard with real-time metrics\n * Wraps the enhanced staff dashboard components for use in the unified portal\n */\nexport function CEODashboard({ dashboardData, realtimeMetrics }: CEODashboardProps) {\n  return (\n    <div className=\"space-y-6\">\n      {/* Real-time connection and live metrics */}\n      <RealtimeStaffDashboard initialData={realtimeMetrics} />\n\n      {/* Main comprehensive dashboard */}\n      <EnhancedStaffDashboard initialData={dashboardData} />\n    </div>\n  )\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;AAHA;;;;AAyBO,SAAS,aAAa,EAAE,aAAa,EAAE,eAAe,EAAqB;IAChF,qBACE,qQAAC;QAAI,WAAU;;0BAEb,qQAAC,kNAAsB;gBAAC,aAAa;;;;;;0BAGrC,qQAAC,kNAAsB;gBAAC,aAAa;;;;;;;;;;;;AAG3C"}},
    {"offset": {"line": 44, "column": 0}, "map": {"version":3,"sources":["file:///Users/ghilesmoussaoui/Desktop/Versotech/versotech-portal/src/app/%28main%29/versotech_main/dashboard/investor-dashboard.tsx"],"sourcesContent":["'use client'\r\n\r\nimport { useEffect, useState } from 'react'\r\nimport Link from 'next/link'\r\nimport Image from 'next/image'\r\nimport { createClient } from '@/lib/supabase/client'\r\nimport { usePersona, Persona } from '@/contexts/persona-context'\r\nimport { useTheme } from '@/components/theme-provider'\r\nimport { InvestorActionCenter, DashboardTask, DashboardActivity } from '@/components/dashboard/investor-action-center'\r\nimport { FeaturedDealsSection, FeaturedDeal } from '@/components/dashboard/featured-deals-section'\r\nimport { VideoIntroModal } from '@/components/video/video-intro-modal'\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle, CardFooter } from '@/components/ui/card'\r\nimport { Badge } from '@/components/ui/badge'\r\nimport { Button } from '@/components/ui/button'\r\nimport { Separator } from '@/components/ui/separator'\r\nimport { Skeleton } from '@/components/ui/skeleton'\r\nimport { cn } from '@/lib/utils'\r\nimport {\r\n  ArrowUpRight,\r\n  Building2,\r\n  CalendarClock,\r\n  FileText,\r\n  Layers,\r\n  MapPin,\r\n  MessageSquare,\r\n  Target,\r\n  User as UserIcon,\r\n  Loader2\r\n} from 'lucide-react'\r\n\r\ninterface PortfolioVehicle {\r\n  id: string\r\n  name: string\r\n  type: string\r\n  domicile?: string | null\r\n  currency?: string | null\r\n}\r\n\r\ninterface InvestorDashboardData {\r\n  profile: {\r\n    displayName: string | null\r\n    avatarUrl: string | null\r\n    hasSeenIntroVideo: boolean\r\n  } | null\r\n  vehicles: PortfolioVehicle[]\r\n  featuredDeals: FeaturedDeal[]\r\n  tasks: DashboardTask[]\r\n  tasksTotal: number\r\n  recentActivity: DashboardActivity[]\r\n  hasPortfolioData: boolean\r\n}\r\n\r\ninterface InvestorDashboardProps {\r\n  investorId: string\r\n  userId: string\r\n  persona: Persona\r\n}\r\n\r\nfunction formatVehicleMeta(vehicle: PortfolioVehicle) {\r\n  const typeLabel = vehicle.type ? vehicle.type.replace(/_/g, ' ') : 'Vehicle'\r\n  const location = vehicle.domicile || vehicle.currency || 'Global'\r\n  return `${typeLabel} • ${location}`\r\n}\r\n\r\nfunction DashboardSkeleton() {\r\n  const { theme } = useTheme()\r\n  const isDark = theme === 'staff-dark'\r\n\r\n  return (\r\n    <div className=\"space-y-8 animate-pulse\">\r\n      <div className={cn(\r\n        \"rounded-3xl border p-8\",\r\n        isDark ? \"border-white/10 bg-white/5\" : \"border-slate-200/80 bg-white\"\r\n      )}>\r\n        {/* Responsive: single column on mobile, two columns on tablet+ */}\r\n        <div className=\"grid gap-6 md:gap-8 md:grid-cols-[1.9fr,1fr]\">\r\n          <div className=\"space-y-6\">\r\n            <div className=\"flex items-center gap-4\">\r\n              <Skeleton className=\"h-16 w-16 rounded-full\" />\r\n              <div className=\"space-y-2\">\r\n                <Skeleton className=\"h-4 w-24\" />\r\n                <Skeleton className=\"h-8 w-48\" />\r\n                <Skeleton className=\"h-4 w-64\" />\r\n              </div>\r\n            </div>\r\n            {/* Responsive: stack on phone, 2 cols on small, 3 on medium+ */}\r\n            <div className=\"grid gap-3 md:gap-4 grid-cols-1 sm:grid-cols-2 md:grid-cols-3\">\r\n              {[1, 2, 3].map(i => (\r\n                <Skeleton key={i} className=\"h-24 rounded-2xl\" />\r\n              ))}\r\n            </div>\r\n          </div>\r\n          <Skeleton className=\"h-48 rounded-2xl\" />\r\n        </div>\r\n      </div>\r\n      <div className=\"grid gap-6 md:grid-cols-3\">\r\n        {[1, 2, 3].map(i => (\r\n          <Skeleton key={i} className=\"h-64 rounded-2xl\" />\r\n        ))}\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n\r\nfunction HoldingsSnapshot({ vehicles }: { vehicles: PortfolioVehicle[] }) {\r\n  const { theme } = useTheme()\r\n  const isDark = theme === 'staff-dark'\r\n  const displayed = vehicles.slice(0, 4)\r\n\r\n  return (\r\n    <Card className={cn(\r\n      \"h-full overflow-hidden rounded-2xl border shadow-sm\",\r\n      isDark ? \"border-white/10 bg-card\" : \"border-slate-200/80\"\r\n    )}>\r\n      <CardHeader className=\"space-y-1.5 border-b p-6\">\r\n        <CardTitle className={cn(\r\n          \"text-base font-semibold\",\r\n          isDark ? \"text-white\" : \"text-slate-900\"\r\n        )}>Portfolio snapshot</CardTitle>\r\n        <CardDescription className={cn(\r\n          \"text-sm\",\r\n          isDark ? \"text-gray-400\" : \"text-slate-600\"\r\n        )}>\r\n          At-a-glance view of the vehicles you&apos;re currently allocated to.\r\n        </CardDescription>\r\n      </CardHeader>\r\n      <CardContent className=\"space-y-4 p-6\">\r\n        {displayed.length === 0 ? (\r\n          <div className={cn(\r\n            \"rounded-xl border border-dashed p-6 text-center text-sm\",\r\n            isDark\r\n              ? \"border-white/10 bg-white/5 text-gray-400\"\r\n              : \"border-slate-200/80 bg-slate-50/80 text-slate-500\"\r\n          )}>\r\n            No active holdings yet. Allocations will appear here once your onboarding is complete.\r\n          </div>\r\n        ) : (\r\n          <div className=\"space-y-3\">\r\n            {displayed.map((vehicle) => (\r\n              <Link\r\n                key={vehicle.id}\r\n                href={`/versotech_main/opportunities?vehicle=${vehicle.id}`}\r\n                className={cn(\r\n                  \"flex items-center justify-between gap-4 rounded-xl border p-4 transition-all hover:border-primary/40 hover:bg-primary/5\",\r\n                  isDark\r\n                    ? \"border-white/10 bg-white/5\"\r\n                    : \"border-slate-200/80 bg-white/90\"\r\n                )}\r\n              >\r\n                <div className=\"space-y-1\">\r\n                  <p className={cn(\r\n                    \"text-sm font-semibold\",\r\n                    isDark ? \"text-white\" : \"text-slate-900\"\r\n                  )}>{vehicle.name}</p>\r\n                  <p className={cn(\r\n                    \"text-xs\",\r\n                    isDark ? \"text-gray-400\" : \"text-slate-500\"\r\n                  )}>{formatVehicleMeta(vehicle)}</p>\r\n                </div>\r\n                <ArrowUpRight className=\"h-4 w-4 text-primary\" />\r\n              </Link>\r\n            ))}\r\n          </div>\r\n        )}\r\n      </CardContent>\r\n      <CardFooter className=\"flex flex-wrap items-center justify-between gap-3 border-t p-6\">\r\n        <Badge variant=\"outline\" className={cn(\r\n          \"rounded-full\",\r\n          isDark\r\n            ? \"border-white/10 bg-white/5 text-gray-300\"\r\n            : \"border-slate-200/80 bg-slate-50 text-slate-600\"\r\n        )}>\r\n          {vehicles.length} vehicle{vehicles.length === 1 ? '' : 's'} tracked\r\n        </Badge>\r\n        <Link href=\"/versotech_main/opportunities\">\r\n          <Button variant=\"outline\" size=\"sm\">\r\n            Open holdings workspace\r\n            <ArrowUpRight className=\"ml-2 h-4 w-4\" />\r\n          </Button>\r\n        </Link>\r\n      </CardFooter>\r\n    </Card>\r\n  )\r\n}\r\n\r\nfunction VersoServicesCard() {\r\n  const { theme } = useTheme()\r\n  const isDark = theme === 'staff-dark'\r\n\r\n  return (\r\n    <Card className={cn(\r\n      \"h-full overflow-hidden rounded-2xl border shadow-sm\",\r\n      isDark ? \"border-white/10 bg-card\" : \"border-slate-200/80\"\r\n    )}>\r\n      <CardHeader className=\"space-y-1.5 border-b p-6\">\r\n        <CardTitle className={cn(\r\n          \"text-base font-semibold\",\r\n          isDark ? \"text-white\" : \"text-slate-900\"\r\n        )}>VERSO concierge</CardTitle>\r\n        <CardDescription className={cn(\r\n          \"text-sm\",\r\n          isDark ? \"text-gray-400\" : \"text-slate-600\"\r\n        )}>\r\n          Direct access to deal rooms, bespoke reporting, and support.\r\n        </CardDescription>\r\n      </CardHeader>\r\n      <CardContent className=\"space-y-3 p-6\">\r\n        <Link href=\"/versotech_main/opportunities\">\r\n          <Button className={cn(\r\n            \"w-full justify-start rounded-xl border hover:border-primary/40 hover:bg-primary/5\",\r\n            isDark\r\n              ? \"border-white/10 bg-white/5 text-gray-200\"\r\n              : \"border-slate-200/80 bg-white/80 text-slate-700\"\r\n          )} variant=\"outline\">\r\n            <Layers className=\"mr-2 h-4 w-4\" />\r\n            Concluder™ Deal Room\r\n          </Button>\r\n        </Link>\r\n        <Link href=\"/versotech_main/opportunities\">\r\n          <Button className={cn(\r\n            \"w-full justify-start rounded-xl border hover:border-primary/40 hover:bg-primary/5\",\r\n            isDark\r\n              ? \"border-white/10 bg-white/5 text-gray-200\"\r\n              : \"border-slate-200/80 bg-white/80 text-slate-700\"\r\n          )} variant=\"outline\">\r\n            <Target className=\"mr-2 h-4 w-4\" />\r\n            Off-market opportunities\r\n          </Button>\r\n        </Link>\r\n        <Link href=\"/versotech_main/documents\">\r\n          <Button className={cn(\r\n            \"w-full justify-start rounded-xl border hover:border-primary/40 hover:bg-primary/5\",\r\n            isDark\r\n              ? \"border-white/10 bg-white/5 text-gray-200\"\r\n              : \"border-slate-200/80 bg-white/80 text-slate-700\"\r\n          )} variant=\"outline\">\r\n            <FileText className=\"mr-2 h-4 w-4\" />\r\n            Request position statement\r\n          </Button>\r\n        </Link>\r\n        <Link href=\"/versotech_main/inbox\">\r\n          <Button className={cn(\r\n            \"w-full justify-start rounded-xl border hover:border-primary/40 hover:bg-primary/5\",\r\n            isDark\r\n              ? \"border-white/10 bg-white/5 text-gray-200\"\r\n              : \"border-slate-200/80 bg-white/80 text-slate-700\"\r\n          )} variant=\"outline\">\r\n            <MessageSquare className=\"mr-2 h-4 w-4\" />\r\n            Custom analytics request\r\n          </Button>\r\n        </Link>\r\n      </CardContent>\r\n    </Card>\r\n  )\r\n}\r\n\r\nfunction WelcomePanel() {\r\n  const { theme } = useTheme()\r\n  const isDark = theme === 'staff-dark'\r\n\r\n  const highlights = [\r\n    {\r\n      id: 'fund',\r\n      title: 'VERSO FUND',\r\n      description: 'BVI professional mutual fund access',\r\n      icon: <Building2 className=\"h-6 w-6\" />\r\n    },\r\n    {\r\n      id: 'real-estate',\r\n      title: 'REAL Empire',\r\n      description: 'Institutional real estate securitisation',\r\n      icon: <Target className=\"h-6 w-6\" />\r\n    },\r\n    {\r\n      id: 'lux',\r\n      title: 'Luxembourg Platforms',\r\n      description: 'European investment infrastructure',\r\n      icon: <MapPin className=\"h-6 w-6\" />\r\n    }\r\n  ]\r\n\r\n  return (\r\n    <section className={cn(\r\n      \"rounded-3xl border px-8 py-10 shadow-sm\",\r\n      isDark ? \"border-white/10 bg-card\" : \"border-slate-200/80 bg-white\"\r\n    )}>\r\n      <div className=\"mx-auto flex max-w-4xl flex-col gap-8\">\r\n        <div className=\"flex flex-col items-center gap-6 text-center sm:flex-row sm:items-start sm:text-left\">\r\n          <div className={cn(\r\n            \"flex h-16 w-16 items-center justify-center rounded-2xl shadow-sm\",\r\n            isDark ? \"bg-white/10 text-white\" : \"bg-slate-900 text-white\"\r\n          )}>\r\n            <Building2 className=\"h-7 w-7\" />\r\n          </div>\r\n          <div className=\"space-y-3\">\r\n            <p className={cn(\r\n              \"text-[11px] font-semibold uppercase tracking-wider\",\r\n              isDark ? \"text-gray-400\" : \"text-slate-500\"\r\n            )}>\r\n              Investor onboarding\r\n            </p>\r\n            <h2 className={cn(\r\n              \"text-3xl font-semibold\",\r\n              isDark ? \"text-white\" : \"text-slate-900\"\r\n            )}>\r\n              Welcome to VERSO Holdings\r\n            </h2>\r\n            <p className={cn(\r\n              \"text-sm\",\r\n              isDark ? \"text-gray-400\" : \"text-slate-600\"\r\n            )}>\r\n              Complete your onboarding steps to unlock performance analytics, live deal access, and bespoke reporting matched to your mandate.\r\n            </p>\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"grid gap-4 sm:grid-cols-3\">\r\n          {highlights.map((highlight) => (\r\n            <Card\r\n              key={highlight.id}\r\n              className={cn(\r\n                \"rounded-2xl border p-6 text-left shadow-sm\",\r\n                isDark\r\n                  ? \"border-white/10 bg-white/5\"\r\n                  : \"border-slate-200/80 bg-slate-50/60\"\r\n              )}\r\n            >\r\n              <div className={cn(\r\n                \"flex h-12 w-12 items-center justify-center rounded-xl shadow-sm\",\r\n                isDark\r\n                  ? \"bg-white/10 text-white\"\r\n                  : \"bg-white text-slate-900\"\r\n              )}>\r\n                {highlight.icon}\r\n              </div>\r\n              <h3 className={cn(\r\n                \"mt-4 text-sm font-semibold\",\r\n                isDark ? \"text-white\" : \"text-slate-900\"\r\n              )}>{highlight.title}</h3>\r\n              <p className={cn(\r\n                \"mt-1 text-xs\",\r\n                isDark ? \"text-gray-400\" : \"text-slate-600\"\r\n              )}>{highlight.description}</p>\r\n            </Card>\r\n          ))}\r\n        </div>\r\n\r\n        <div className=\"flex flex-col items-center gap-3 sm:flex-row sm:justify-end\">\r\n          <Link href=\"/versotech_main/tasks\" className=\"w-full sm:w-auto\">\r\n            <Button size=\"lg\" className=\"w-full sm:w-auto\">\r\n              Complete onboarding\r\n            </Button>\r\n          </Link>\r\n          <Link href=\"/versotech_main/inbox\" className=\"w-full sm:w-auto\">\r\n            <Button variant=\"outline\" size=\"lg\" className=\"w-full sm:w-auto\">\r\n              Contact VERSO team\r\n            </Button>\r\n          </Link>\r\n        </div>\r\n      </div>\r\n    </section>\r\n  )\r\n}\r\n\r\nexport function InvestorDashboard({ investorId, userId, persona }: InvestorDashboardProps) {\r\n  const { theme } = useTheme()\r\n  const isDark = theme === 'staff-dark'\r\n  const [data, setData] = useState<InvestorDashboardData | null>(null)\r\n  const [loading, setLoading] = useState(true)\r\n  const [error, setError] = useState<string | null>(null)\r\n  const [showVideoModal, setShowVideoModal] = useState(false)\r\n\r\n  // Video intro URL from Supabase storage\r\n  // TODO: Migrate video to new Supabase project and update URL\r\n  // For now, using the old project URL where the video exists\r\n  const videoUrl = 'https://ipguxdssecfexudnvtia.supabase.co/storage/v1/object/public/public-assets/videos/intro-video.mp4'\r\n\r\n  // Show video modal if user hasn't seen it\r\n  useEffect(() => {\r\n    if (data?.profile && !data.profile.hasSeenIntroVideo) {\r\n      setShowVideoModal(true)\r\n    }\r\n  }, [data?.profile])\r\n\r\n  // Handle video completion\r\n  const handleVideoComplete = async () => {\r\n    try {\r\n      const response = await fetch('/api/profiles/intro-video-seen', {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' }\r\n      })\r\n      if (!response.ok) {\r\n        throw new Error('Failed to mark video as seen')\r\n      }\r\n      // Update local state to reflect video has been seen\r\n      if (data?.profile) {\r\n        setData({\r\n          ...data,\r\n          profile: { ...data.profile, hasSeenIntroVideo: true }\r\n        })\r\n      }\r\n    } finally {\r\n      setShowVideoModal(false)\r\n    }\r\n  }\r\n\r\n  useEffect(() => {\r\n    async function fetchDashboardData() {\r\n      setLoading(true)\r\n      setError(null)\r\n\r\n      try {\r\n        const supabase = createClient()\r\n        const investorIds = [investorId]\r\n\r\n        // Fetch all data in parallel\r\n        const [\r\n          profileRes,\r\n          vehiclesRes,\r\n          dealsRes,\r\n          tasksRes,\r\n          activityRes,\r\n          positionsRes\r\n        ] = await Promise.all([\r\n          // Profile (includes intro video status)\r\n          supabase\r\n            .from('profiles')\r\n            .select('display_name, avatar_url, has_seen_intro_video')\r\n            .eq('id', userId)\r\n            .single(),\r\n\r\n          // Vehicles with active subscriptions\r\n          supabase\r\n            .from('vehicles')\r\n            .select(`\r\n              id,\r\n              name,\r\n              type,\r\n              domicile,\r\n              currency,\r\n              subscriptions!inner(investor_id, status)\r\n            `)\r\n            .in('subscriptions.investor_id', investorIds)\r\n            .eq('subscriptions.status', 'active'),\r\n\r\n          // Featured deals user has access to (with published fee structures for unit price)\r\n          supabase\r\n            .from('deals')\r\n            .select(`\r\n              id,\r\n              name,\r\n              status,\r\n              deal_type,\r\n              currency,\r\n              offer_unit_price,\r\n              open_at,\r\n              close_at,\r\n              company_name,\r\n              company_logo_url,\r\n              sector,\r\n              location,\r\n              vehicles ( id, name, type ),\r\n              deal_memberships!inner ( user_id ),\r\n              deal_fee_structures ( id, price_per_share_text, allocation_up_to, minimum_ticket, status, effective_at )\r\n            `)\r\n            .eq('deal_memberships.user_id', userId)\r\n            .eq('status', 'open')\r\n            .order('close_at', { ascending: true, nullsFirst: false })\r\n            .limit(3),\r\n\r\n          // Tasks\r\n          supabase\r\n            .from('tasks')\r\n            .select('id, title, status, priority, due_at, category', { count: 'exact' })\r\n            .not('status', 'eq', 'completed')\r\n            .not('status', 'eq', 'waived')\r\n            .or(`owner_user_id.eq.${userId},owner_investor_id.in.(${investorIds.join(',')})`)\r\n            .order('due_at', { ascending: true, nullsFirst: false })\r\n            .limit(12),\r\n\r\n          // Activity\r\n          supabase\r\n            .from('deal_activity_events')\r\n            .select(`\r\n              id,\r\n              event_type,\r\n              payload,\r\n              occurred_at,\r\n              deal_id,\r\n              deals:deal_id(name)\r\n            `)\r\n            .in('investor_id', investorIds)\r\n            .order('occurred_at', { ascending: false })\r\n            .limit(10),\r\n\r\n          // Positions (to check if user has portfolio data)\r\n          supabase\r\n            .from('positions')\r\n            .select('id')\r\n            .in('investor_id', investorIds)\r\n            .limit(1)\r\n        ])\r\n\r\n        // Map activity events to dashboard activity format\r\n        const eventTypeMap: Record<string, { title: string; activity_type: string }> = {\r\n          im_interested: { title: 'Expressed Interest', activity_type: 'deal' },\r\n          nda_completed: { title: 'NDA Signed', activity_type: 'document' },\r\n          data_room_submit: { title: 'Allocation Submitted', activity_type: 'allocation' },\r\n          subscription_completed: { title: 'Subscription Completed', activity_type: 'deal' },\r\n          data_room_granted: { title: 'Data Room Access', activity_type: 'document' },\r\n          closed_deal_interest: { title: 'Interest Registered', activity_type: 'deal' },\r\n        }\r\n\r\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n        const recentActivity: DashboardActivity[] = (activityRes.data ?? []).map((event: any) => {\r\n          const mapping = eventTypeMap[event.event_type] || { title: event.event_type, activity_type: 'deal' }\r\n          const dealName = event.deals?.name || 'Deal'\r\n          const amount = (event.payload?.commitment || event.payload?.indicative_amount) as number | undefined\r\n\r\n          return {\r\n            id: event.id,\r\n            title: mapping.title,\r\n            description: amount ? `${dealName} - $${amount.toLocaleString()}` : dealName,\r\n            activity_type: mapping.activity_type,\r\n            created_at: event.occurred_at,\r\n            importance: 'normal',\r\n            read_status: null\r\n          }\r\n        })\r\n\r\n        // Sort tasks by priority then due date\r\n        const priorityOrder: Record<string, number> = { high: 0, medium: 1, low: 2 }\r\n        const sortedTasks = (tasksRes.data ?? []).sort((a, b) => {\r\n          const pA = priorityOrder[a.priority] ?? 99\r\n          const pB = priorityOrder[b.priority] ?? 99\r\n          if (pA !== pB) return pA - pB\r\n          if (!a.due_at && !b.due_at) return 0\r\n          if (!a.due_at) return 1\r\n          if (!b.due_at) return -1\r\n          return new Date(a.due_at).getTime() - new Date(b.due_at).getTime()\r\n        })\r\n\r\n        // Process deals to pick the latest published fee structure for each deal\r\n        const processedDeals = (dealsRes.data ?? []).map((deal: any) => {\r\n          const feeStructures = deal.deal_fee_structures ?? []\r\n          // Find the latest published fee structure (ordered by effective_at desc)\r\n          const publishedStructures = feeStructures\r\n            .filter((fs: any) => fs.status === 'published')\r\n            .sort((a: any, b: any) => {\r\n              const dateA = a.effective_at ? new Date(a.effective_at).getTime() : 0\r\n              const dateB = b.effective_at ? new Date(b.effective_at).getTime() : 0\r\n              return dateB - dateA // descending\r\n            })\r\n          const latestFeeStructure = publishedStructures[0] ?? null\r\n\r\n          return {\r\n            ...deal,\r\n            fee_structure: latestFeeStructure ? {\r\n              id: latestFeeStructure.id,\r\n              price_per_share_text: latestFeeStructure.price_per_share_text,\r\n              allocation_up_to: latestFeeStructure.allocation_up_to,\r\n              minimum_ticket: latestFeeStructure.minimum_ticket,\r\n            } : null,\r\n            deal_fee_structures: undefined // Remove raw array from final object\r\n          }\r\n        })\r\n\r\n        setData({\r\n          profile: profileRes.data ? {\r\n            displayName: profileRes.data.display_name,\r\n            avatarUrl: profileRes.data.avatar_url,\r\n            hasSeenIntroVideo: profileRes.data.has_seen_intro_video ?? true\r\n          } : null,\r\n          vehicles: (vehiclesRes.data ?? []) as PortfolioVehicle[],\r\n          featuredDeals: processedDeals as FeaturedDeal[],\r\n          tasks: sortedTasks as DashboardTask[],\r\n          tasksTotal: tasksRes.count ?? sortedTasks.length,\r\n          recentActivity,\r\n          hasPortfolioData: (positionsRes.data?.length ?? 0) > 0 || (vehiclesRes.data?.length ?? 0) > 0\r\n        })\r\n      } catch (err) {\r\n        console.error('[InvestorDashboard] Error fetching data:', err)\r\n        setError('Failed to load dashboard data')\r\n      } finally {\r\n        setLoading(false)\r\n      }\r\n    }\r\n\r\n    if (investorId && userId) {\r\n      fetchDashboardData()\r\n    }\r\n  }, [investorId, userId])\r\n\r\n  if (loading) {\r\n    return <DashboardSkeleton />\r\n  }\r\n\r\n  if (error || !data) {\r\n    return (\r\n      <div className=\"p-8 text-center\">\r\n        <p className=\"text-red-500\">{error || 'Unable to load dashboard'}</p>\r\n        <Button variant=\"outline\" className=\"mt-4\" onClick={() => window.location.reload()}>\r\n          Retry\r\n        </Button>\r\n      </div>\r\n    )\r\n  }\r\n\r\n  const displayName = persona?.entity_name || data.profile?.displayName || 'Investor'\r\n  const firstName = (displayName || 'Investor').split(' ')[0] || 'Investor'\r\n\r\n  const summaryTiles = [\r\n    {\r\n      label: 'Open opportunities',\r\n      value: data.featuredDeals.length,\r\n      helper: 'Available deals'\r\n    },\r\n    {\r\n      label: 'Outstanding tasks',\r\n      value: data.tasksTotal,\r\n      helper: data.tasksTotal ? 'Pending actions' : 'All caught up'\r\n    },\r\n    {\r\n      label: 'Active holdings',\r\n      value: data.vehicles.length,\r\n      helper: 'Investment vehicles'\r\n    }\r\n  ]\r\n\r\n  return (\r\n    <div className=\"space-y-12 px-0 pb-16 pt-2\">\r\n      {/* Video Intro Modal - shown for first-time users */}\r\n      <VideoIntroModal\r\n        open={showVideoModal}\r\n        videoUrl={videoUrl}\r\n        onComplete={handleVideoComplete}\r\n      />\r\n\r\n      {/* Welcome Header Section */}\r\n      <section className={cn(\r\n        \"rounded-3xl border p-4 sm:p-6 md:p-8 shadow-sm\",\r\n        isDark ? \"border-white/10 bg-card\" : \"border-slate-200/80 bg-white\"\r\n      )}>\r\n        {/* Responsive: single column on mobile, two columns on tablet+ */}\r\n        <div className=\"grid gap-6 md:gap-8 md:grid-cols-[1.9fr,1fr]\">\r\n          <div className=\"space-y-6\">\r\n            <div className=\"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between\">\r\n              <div className=\"flex items-center gap-4\">\r\n                <div className={cn(\r\n                  \"flex h-16 w-16 items-center justify-center rounded-full border shadow-sm overflow-hidden\",\r\n                  isDark\r\n                    ? \"bg-gradient-to-br from-white/10 to-white/5 border-white/10\"\r\n                    : \"bg-gradient-to-br from-slate-100 to-slate-200 border-slate-200\"\r\n                )}>\r\n                  {data.profile?.avatarUrl ? (\r\n                    <Image\r\n                      src={data.profile.avatarUrl}\r\n                      alt={displayName}\r\n                      width={64}\r\n                      height={64}\r\n                      className=\"object-cover w-full h-full\"\r\n                      priority\r\n                    />\r\n                  ) : persona.entity_logo_url ? (\r\n                    <Image\r\n                      src={persona.entity_logo_url}\r\n                      alt={displayName}\r\n                      width={64}\r\n                      height={64}\r\n                      className=\"object-cover w-full h-full\"\r\n                      priority\r\n                    />\r\n                  ) : (\r\n                    <UserIcon className={cn(\r\n                      \"h-8 w-8\",\r\n                      isDark ? \"text-gray-400\" : \"text-slate-400\"\r\n                    )} />\r\n                  )}\r\n                </div>\r\n                <div className=\"space-y-1\">\r\n                  <p className={cn(\r\n                    \"text-[11px] font-semibold uppercase tracking-wide\",\r\n                    isDark ? \"text-gray-400\" : \"text-slate-500\"\r\n                  )}>\r\n                    Investor portal\r\n                  </p>\r\n                  <h1 className={cn(\r\n                    \"text-3xl font-semibold\",\r\n                    isDark ? \"text-white\" : \"text-slate-900\"\r\n                  )}>\r\n                    Welcome, {firstName}\r\n                  </h1>\r\n                  <p className={cn(\r\n                    \"text-sm\",\r\n                    isDark ? \"text-gray-400\" : \"text-slate-600\"\r\n                  )}>\r\n                    VERSO Holdings • Merchant Banking Group • Since 1958\r\n                  </p>\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Responsive: stack on phone, 2 cols on small, 3 on medium+ */}\r\n            <div className=\"grid gap-3 md:gap-4 grid-cols-1 sm:grid-cols-2 md:grid-cols-3\">\r\n              {summaryTiles.map((tile) => (\r\n                <div\r\n                  key={tile.label}\r\n                  className={cn(\r\n                    \"rounded-2xl border p-4 shadow-sm\",\r\n                    isDark\r\n                      ? \"border-white/10 bg-white/5\"\r\n                      : \"border-slate-200/80 bg-slate-50/70\"\r\n                  )}\r\n                >\r\n                  <p className={cn(\r\n                    \"text-[11px] font-semibold uppercase tracking-wide\",\r\n                    isDark ? \"text-gray-400\" : \"text-slate-500\"\r\n                  )}>\r\n                    {tile.label}\r\n                  </p>\r\n                  <p className={cn(\r\n                    \"mt-2 text-2xl font-semibold\",\r\n                    isDark ? \"text-white\" : \"text-slate-900\"\r\n                  )}>{tile.value}</p>\r\n                  <p className={cn(\r\n                    \"mt-1 text-xs\",\r\n                    isDark ? \"text-gray-400\" : \"text-slate-600\"\r\n                  )}>{tile.helper}</p>\r\n                </div>\r\n              ))}\r\n            </div>\r\n\r\n            <div className={cn(\r\n              \"flex flex-wrap items-center gap-2 text-xs font-medium\",\r\n              isDark ? \"text-gray-400\" : \"text-slate-600\"\r\n            )}>\r\n              <Badge variant=\"outline\" className={cn(\r\n                \"rounded-full\",\r\n                isDark\r\n                  ? \"border-white/10 bg-white/5 text-gray-300\"\r\n                  : \"border-slate-200/80 bg-slate-50 text-slate-600\"\r\n              )}>\r\n                <MapPin className=\"mr-1 h-3 w-3\" /> Luxembourg HQ\r\n              </Badge>\r\n              <Badge variant=\"outline\" className={cn(\r\n                \"rounded-full\",\r\n                isDark\r\n                  ? \"border-white/10 bg-white/5 text-gray-300\"\r\n                  : \"border-slate-200/80 bg-slate-50 text-slate-600\"\r\n              )}>\r\n                <Building2 className=\"mr-1 h-3 w-3\" /> BVI Professional Fund\r\n              </Badge>\r\n              <Badge variant=\"outline\" className={cn(\r\n                \"rounded-full\",\r\n                isDark\r\n                  ? \"border-white/10 bg-white/5 text-gray-300\"\r\n                  : \"border-slate-200/80 bg-slate-50 text-slate-600\"\r\n              )}>\r\n                <Target className=\"mr-1 h-3 w-3\" /> PE • VC • Real Estate\r\n              </Badge>\r\n            </div>\r\n\r\n            <div className=\"flex flex-col gap-3 pt-2 sm:flex-row\">\r\n              <Link href=\"/versotech_main/opportunities\" className=\"w-full sm:w-auto\">\r\n                <Button size=\"sm\" className=\"w-full sm:w-auto\">\r\n                  View holdings\r\n                  <ArrowUpRight className=\"ml-2 h-4 w-4\" />\r\n                </Button>\r\n              </Link>\r\n              <Link href=\"/versotech_main/tasks\" className=\"w-full sm:w-auto\">\r\n                <Button size=\"sm\" variant=\"outline\" className=\"w-full sm:w-auto\">\r\n                  Calendar & deadlines\r\n                  <CalendarClock className=\"ml-2 h-4 w-4\" />\r\n                </Button>\r\n              </Link>\r\n            </div>\r\n          </div>\r\n\r\n          <div className={cn(\r\n            \"rounded-2xl border p-6 shadow-sm\",\r\n            isDark\r\n              ? \"border-white/10 bg-white/5\"\r\n              : \"border-slate-200/80 bg-slate-50/70\"\r\n          )}>\r\n            <p className={cn(\r\n              \"text-[11px] font-semibold uppercase tracking-wide\",\r\n              isDark ? \"text-gray-400\" : \"text-slate-500\"\r\n            )}>\r\n              Portal snapshot\r\n            </p>\r\n            <p className={cn(\r\n              \"mt-3 text-2xl font-semibold\",\r\n              isDark ? \"text-white\" : \"text-slate-900\"\r\n            )}>\r\n              {new Date().toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' })}\r\n            </p>\r\n            <Separator className=\"my-4\" />\r\n            <p className={cn(\r\n              \"text-sm\",\r\n              isDark ? \"text-gray-400\" : \"text-slate-600\"\r\n            )}>\r\n              Your investment dashboard with key metrics and upcoming deadlines.\r\n            </p>\r\n            <Link\r\n              href=\"/versotech_main/tasks\"\r\n              className=\"mt-4 inline-flex items-center gap-2 text-xs font-semibold text-primary hover:underline\"\r\n            >\r\n              Review action centre\r\n              <ArrowUpRight className=\"h-3 w-3\" />\r\n            </Link>\r\n          </div>\r\n        </div>\r\n      </section>\r\n\r\n      {/* Featured Deals */}\r\n      <FeaturedDealsSection deals={data.featuredDeals} />\r\n\r\n      {/* Action Center */}\r\n      <InvestorActionCenter\r\n        tasks={data.tasks}\r\n        tasksTotal={data.tasksTotal}\r\n        recentActivity={data.recentActivity}\r\n      />\r\n\r\n      {/* Holdings or Welcome Panel */}\r\n      {data.hasPortfolioData ? (\r\n        <div className=\"grid gap-4 lg:grid-cols-2\">\r\n          <HoldingsSnapshot vehicles={data.vehicles} />\r\n          <VersoServicesCard />\r\n        </div>\r\n      ) : (\r\n        <WelcomePanel />\r\n      )}\r\n\r\n      {data.hasPortfolioData && <VersoServicesCard />}\r\n    </div>\r\n  )\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1398, "column": 0}, "map": {"version":3,"sources":["file:///Users/ghilesmoussaoui/Desktop/Versotech/versotech-portal/src/app/%28main%29/versotech_main/dashboard/introducer-dashboard.tsx"],"sourcesContent":["'use client'\r\n\r\nimport { useEffect, useState } from 'react'\r\nimport Link from 'next/link'\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card'\r\nimport { Badge } from '@/components/ui/badge'\r\nimport { Button } from '@/components/ui/button'\r\nimport { DateRangePicker } from '@/components/ui/date-range-picker'\r\nimport {\r\n  UserPlus,\r\n  Users,\r\n  DollarSign,\r\n  FileSignature,\r\n  TrendingUp,\r\n  TrendingDown,\r\n  Clock,\r\n  CheckCircle2,\r\n  AlertTriangle,\r\n  ArrowRight,\r\n  Loader2,\r\n  PenLine,\r\n  BarChart3,\r\n  Target,\r\n  Wallet,\r\n  X,\r\n} from 'lucide-react'\r\nimport { createClient } from '@/lib/supabase/client'\r\nimport { formatCurrency, formatDate } from '@/lib/format'\r\nimport { useTheme } from '@/components/theme-provider'\r\nimport type { DateRange } from 'react-day-picker'\r\nimport { format } from 'date-fns'\r\n\r\ntype Persona = {\r\n  persona_type: string\r\n  entity_id: string\r\n  entity_name: string\r\n  role_in_entity?: string | null\r\n  can_sign?: boolean\r\n  logo_url?: string | null\r\n}\r\n\r\ntype JourneyStage = 'interested' | 'approved' | 'signed' | 'funded' | 'passed'\r\n\r\nfunction getStageFromIntroduction(status: string | null): JourneyStage {\r\n  switch (status) {\r\n    case 'allocated':\r\n      return 'signed'\r\n    case 'joined':\r\n      return 'approved'\r\n    case 'lost':\r\n    case 'inactive':\r\n      return 'passed'\r\n    case 'invited':\r\n    default:\r\n      return 'interested'\r\n  }\r\n}\r\n\r\nfunction resolveJourneyStage(status: string | null, hasCommission: boolean): JourneyStage {\r\n  const base = getStageFromIntroduction(status)\r\n  if (status === 'allocated' && hasCommission) {\r\n    return 'funded'\r\n  }\r\n  return base\r\n}\r\n\r\ninterface IntroducerDashboardProps {\r\n  introducerId: string\r\n  userId: string\r\n  persona: Persona\r\n}\r\n\r\ntype IntroducerMetrics = {\r\n  totalIntroductions: number\r\n  interestedIntroductions: number\r\n  approvedIntroductions: number\r\n  signedIntroductions: number\r\n  fundedIntroductions: number\r\n  passedIntroductions: number\r\n  totalCommissionEarned: number\r\n  pendingCommission: number\r\n  conversionRate: number\r\n}\r\n\r\ntype PerformanceMetrics = {\r\n  thisMonthIntroductions: number\r\n  lastMonthIntroductions: number\r\n  introductionGrowth: number\r\n  avgCommissionPerIntro: number\r\n}\r\n\r\ntype Agreement = {\r\n  id: string\r\n  status: string\r\n  default_commission_bps: number | null\r\n  effective_date: string | null\r\n  expiry_date: string | null\r\n  signed_date: string | null\r\n}\r\n\r\ntype RecentIntroduction = {\r\n  id: string\r\n  prospect_email: string\r\n  status: string\r\n  introduced_at: string\r\n  deal: {\r\n    id: string\r\n    name: string\r\n  } | null\r\n}\r\n\r\nexport function IntroducerDashboard({ introducerId, userId, persona }: IntroducerDashboardProps) {\r\n  const { theme } = useTheme()\r\n  // Theme system uses 'staff-dark' for dark mode across all personas\r\n  const isDark = theme === 'staff-dark'\r\n\r\n  const [loading, setLoading] = useState(true)\r\n  const [metrics, setMetrics] = useState<IntroducerMetrics | null>(null)\r\n  const [performance, setPerformance] = useState<PerformanceMetrics | null>(null)\r\n  const [activeAgreement, setActiveAgreement] = useState<Agreement | null>(null)\r\n  const [pendingAgreement, setPendingAgreement] = useState<Agreement | null>(null)\r\n  const [recentIntroductions, setRecentIntroductions] = useState<RecentIntroduction[]>([])\r\n  const [dateRange, setDateRange] = useState<DateRange | undefined>(undefined)\r\n\r\n  useEffect(() => {\r\n    async function fetchData() {\r\n      try {\r\n        const supabase = createClient()\r\n\r\n        // Fetch introductions for metrics\r\n        const { data: introductions } = await supabase\r\n          .from('introductions')\r\n          .select('id, status, prospect_email, introduced_at, deal:deal_id(id, name)')\r\n          .eq('introducer_id', introducerId)\r\n          .order('introduced_at', { ascending: false })\r\n\r\n        const allIntros = introductions || []\r\n\r\n        // Apply date range filter\r\n        const intros = allIntros.filter(i => {\r\n          if (!dateRange?.from) return true\r\n          if (!i.introduced_at) return false\r\n\r\n          const introDate = new Date(i.introduced_at)\r\n          const fromDate = new Date(dateRange.from)\r\n          fromDate.setHours(0, 0, 0, 0)\r\n\r\n          if (introDate < fromDate) return false\r\n\r\n          if (dateRange.to) {\r\n            const toDate = new Date(dateRange.to)\r\n            toDate.setHours(23, 59, 59, 999)\r\n            if (introDate > toDate) return false\r\n          }\r\n\r\n          return true\r\n        })\r\n\r\n        // Fetch commissions (using created_at as the date column)\r\n        const { data: commissions } = await supabase\r\n          .from('introducer_commissions')\r\n          .select('id, accrual_amount, status, created_at, introduction_id')\r\n          .eq('introducer_id', introducerId)\r\n\r\n        const allComms = commissions || []\r\n\r\n        // Apply date range filter to commissions\r\n        const comms = allComms.filter(c => {\r\n          if (!dateRange?.from) return true\r\n          if (!c.created_at) return false\r\n\r\n          const commDate = new Date(c.created_at)\r\n          const fromDate = new Date(dateRange.from)\r\n          fromDate.setHours(0, 0, 0, 0)\r\n\r\n          if (commDate < fromDate) return false\r\n\r\n          if (dateRange.to) {\r\n            const toDate = new Date(dateRange.to)\r\n            toDate.setHours(23, 59, 59, 999)\r\n            if (commDate > toDate) return false\r\n          }\r\n\r\n          return true\r\n        })\r\n\r\n        const fundedIntroIds = new Set(\r\n          comms\r\n            .filter(c => c.introduction_id)\r\n            .map(c => c.introduction_id)\r\n        )\r\n\r\n        const stagedIntros = intros.map(i => ({\r\n          ...i,\r\n          journey_stage: resolveJourneyStage(i.status, fundedIntroIds.has(i.id))\r\n        }))\r\n\r\n        const interested = stagedIntros.filter(i => i.journey_stage === 'interested').length\r\n        const approved = stagedIntros.filter(i => i.journey_stage === 'approved').length\r\n        const signed = stagedIntros.filter(i => i.journey_stage === 'signed').length\r\n        const funded = stagedIntros.filter(i => i.journey_stage === 'funded').length\r\n        const passed = stagedIntros.filter(i => i.journey_stage === 'passed').length\r\n\r\n        const totalEarned = comms\r\n          .filter(c => c.status === 'paid')\r\n          .reduce((sum, c) => sum + (c.accrual_amount || 0), 0)\r\n        const pendingComm = comms\n          .filter(c => ['accrued', 'invoice_requested', 'invoice_submitted', 'invoiced'].includes(c.status))\n          .reduce((sum, c) => sum + (c.accrual_amount || 0), 0)\r\n\r\n        setMetrics({\r\n          totalIntroductions: intros.length,\r\n          interestedIntroductions: interested,\r\n          approvedIntroductions: approved,\r\n          signedIntroductions: signed,\r\n          fundedIntroductions: funded,\r\n          passedIntroductions: passed,\r\n          totalCommissionEarned: totalEarned,\r\n          pendingCommission: pendingComm,\r\n          conversionRate: intros.length > 0 ? (funded / intros.length) * 100 : 0,\r\n        })\r\n\r\n        // Calculate performance metrics based on date range or default to monthly comparison\r\n        const now = new Date()\r\n        const startOfThisMonth = new Date(now.getFullYear(), now.getMonth(), 1)\r\n        const startOfLastMonth = new Date(now.getFullYear(), now.getMonth() - 1, 1)\r\n\r\n        const thisMonthIntroductions = intros.filter(i =>\r\n          i.introduced_at && new Date(i.introduced_at) >= startOfThisMonth\r\n        ).length\r\n\r\n        const lastMonthIntroductions = allIntros.filter(i =>\r\n          i.introduced_at &&\r\n          new Date(i.introduced_at) >= startOfLastMonth &&\r\n          new Date(i.introduced_at) < startOfThisMonth\r\n        ).length\r\n\r\n        const introductionGrowth = lastMonthIntroductions > 0\r\n          ? Math.round(((thisMonthIntroductions - lastMonthIntroductions) / lastMonthIntroductions) * 100)\r\n          : thisMonthIntroductions > 0 ? 100 : 0\r\n\r\n        const avgCommissionPerIntro = funded > 0\r\n          ? Math.round(totalEarned / funded)\r\n          : 0\r\n\r\n        setPerformance({\r\n          thisMonthIntroductions,\r\n          lastMonthIntroductions,\r\n          introductionGrowth,\r\n          avgCommissionPerIntro\r\n        })\r\n\r\n        // Map introductions to match expected type (deal is single object, not array)\r\n        const mappedIntros: RecentIntroduction[] = stagedIntros.slice(0, 5).map((intro: any) => ({\r\n          id: intro.id,\r\n          prospect_email: intro.prospect_email,\r\n          status: intro.journey_stage,\r\n          introduced_at: intro.introduced_at,\r\n          deal: Array.isArray(intro.deal) ? intro.deal[0] || null : intro.deal,\r\n        }))\r\n        setRecentIntroductions(mappedIntros)\r\n\r\n        // Fetch agreements (not affected by date filter)\r\n        const { data: agreements } = await supabase\r\n          .from('introducer_agreements')\r\n          .select('id, status, default_commission_bps, effective_date, expiry_date, signed_date')\r\n          .eq('introducer_id', introducerId)\r\n          .order('created_at', { ascending: false })\r\n\r\n        if (agreements) {\r\n          const active = agreements.find(a => a.status === 'active')\r\n          const pending = agreements.find(a =>\r\n            ['pending_approval', 'pending_ceo_signature', 'pending_introducer_signature'].includes(a.status)\r\n          )\r\n          setActiveAgreement(active || null)\r\n          setPendingAgreement(pending || null)\r\n        }\r\n      } catch (error) {\r\n        console.error('Error fetching introducer data:', error)\r\n      } finally {\r\n        setLoading(false)\r\n      }\r\n    }\r\n\r\n    fetchData()\r\n  }, [introducerId, dateRange])\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"p-8 text-center flex flex-col items-center gap-3\">\r\n        <Loader2 className=\"h-8 w-8 animate-spin text-gray-400\" />\r\n        <p className=\"text-gray-500\">Loading dashboard...</p>\r\n      </div>\r\n    )\r\n  }\r\n\r\n  const statusStyles: Record<string, string> = {\n    interested: 'bg-blue-500/20 text-blue-400',\n    approved: 'bg-purple-500/20 text-purple-400',\n    signed: 'bg-amber-500/20 text-amber-400',\n    funded: 'bg-green-500/20 text-green-400',\n    passed: 'bg-gray-500/20 text-gray-400',\n  }\n\r\n  return (\r\n    <div className=\"p-6 space-y-6\">\r\n      {/* Header */}\r\n      <div className=\"flex items-center justify-between\">\r\n        <div>\r\n          <h1 className={`text-2xl font-bold ${isDark ? 'text-white' : 'text-gray-900'}`}>\r\n            Introducer Dashboard\r\n          </h1>\r\n          <p className={`mt-1 ${isDark ? 'text-gray-400' : 'text-gray-600'}`}>\r\n            {persona.entity_name}\r\n          </p>\r\n        </div>\r\n        {persona.logo_url && (\r\n          <img\r\n            src={persona.logo_url}\r\n            alt={persona.entity_name}\r\n            className=\"h-12 w-auto object-contain\"\r\n          />\r\n        )}\r\n      </div>\r\n\r\n      {/* Alert for Pending Agreement */}\r\n      {pendingAgreement && (\r\n        <Card className={`border-amber-500/30 ${isDark ? 'bg-amber-500/10' : 'bg-amber-50'}`}>\r\n          <CardContent className=\"py-4\">\r\n            <div className=\"flex items-center justify-between\">\r\n              <div className=\"flex items-center gap-3\">\r\n                <div className=\"p-2 rounded-full bg-amber-500/20\">\r\n                  <PenLine className=\"h-5 w-5 text-amber-500\" />\r\n                </div>\r\n                <div>\r\n                  <p className={`font-medium ${isDark ? 'text-white' : 'text-gray-900'}`}>\r\n                    {pendingAgreement.status === 'pending_approval'\r\n                      ? 'Agreement Awaiting Your Approval'\r\n                      : pendingAgreement.status === 'pending_ceo_signature' || pendingAgreement.status === 'approved'\r\n                      ? 'Agreement Awaiting CEO Signature'\r\n                      : 'Agreement Awaiting Your Signature'}\r\n                  </p>\r\n                  <p className={`text-sm ${isDark ? 'text-gray-400' : 'text-gray-600'}`}>\r\n                    {pendingAgreement.status === 'pending_approval'\r\n                      ? 'Please review and approve your fee agreement'\r\n                      : pendingAgreement.status === 'pending_ceo_signature' || pendingAgreement.status === 'approved'\r\n                      ? 'You have approved. Awaiting CEO signature.'\r\n                      : 'CEO has signed. Please countersign to activate.'}\r\n                  </p>\r\n                </div>\r\n              </div>\r\n              <Button asChild>\r\n                <Link href={`/versotech_main/introducer-agreements/${pendingAgreement.id}`}>\r\n                  {pendingAgreement.status === 'pending_approval' ? 'Review'\r\n                    : pendingAgreement.status === 'pending_ceo_signature' || pendingAgreement.status === 'approved' ? 'View'\r\n                    : 'Sign Now'}\r\n                  <ArrowRight className=\"h-4 w-4 ml-2\" />\r\n                </Link>\r\n              </Button>\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n      )}\r\n\r\n      {/* Alert for No Active Agreement */}\r\n      {!activeAgreement && !pendingAgreement && (\r\n        <Card className={`border-red-500/30 ${isDark ? 'bg-red-500/10' : 'bg-red-50'}`}>\r\n          <CardContent className=\"py-4\">\r\n            <div className=\"flex items-center gap-3\">\r\n              <div className=\"p-2 rounded-full bg-red-500/20\">\r\n                <AlertTriangle className=\"h-5 w-5 text-red-500\" />\r\n              </div>\r\n              <div>\r\n                <p className={`font-medium ${isDark ? 'text-white' : 'text-gray-900'}`}>\r\n                  No Active Agreement\r\n                </p>\r\n                <p className={`text-sm ${isDark ? 'text-gray-400' : 'text-gray-600'}`}>\r\n                  You need an active fee agreement to make introductions. Contact your relationship manager.\r\n                </p>\r\n              </div>\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n      )}\r\n\r\n      {/* Date Range Filter */}\r\n      <Card className={isDark ? 'bg-white/5 border-white/10' : ''}>\r\n        <CardContent className=\"py-4\">\r\n          <div className=\"flex items-center justify-between\">\r\n            <div className=\"flex items-center gap-3\">\r\n              <p className={`text-sm font-medium ${isDark ? 'text-gray-400' : 'text-gray-700'}`}>\r\n                Filter by Date Range:\r\n              </p>\r\n              <DateRangePicker\r\n                value={dateRange}\r\n                onChange={setDateRange}\r\n                variant={isDark ? 'dark' : 'default'}\r\n              />\r\n            </div>\r\n            {dateRange?.from && (\r\n              <Button\r\n                variant=\"ghost\"\r\n                size=\"sm\"\r\n                onClick={() => setDateRange(undefined)}\r\n                className={isDark ? 'text-gray-400 hover:text-white' : ''}\r\n              >\r\n                <X className=\"h-4 w-4 mr-1\" />\r\n                Clear Filter\r\n              </Button>\r\n            )}\r\n          </div>\r\n          {dateRange?.from && (\r\n            <p className={`text-xs mt-2 ${isDark ? 'text-gray-500' : 'text-gray-500'}`}>\r\n              {dateRange.to\r\n                ? `Showing data from ${format(dateRange.from, 'MMM dd, yyyy')} to ${format(dateRange.to, 'MMM dd, yyyy')}`\r\n                : `Showing data from ${format(dateRange.from, 'MMM dd, yyyy')} onwards`\r\n              }\r\n            </p>\r\n          )}\r\n          {!dateRange?.from && (\r\n            <p className={`text-xs mt-2 ${isDark ? 'text-gray-500' : 'text-gray-500'}`}>\r\n              Showing all-time data\r\n            </p>\r\n          )}\r\n        </CardContent>\r\n      </Card>\r\n\r\n      {/* Metrics Grid */}\r\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\r\n        <Card className={isDark ? 'bg-white/5 border-white/10' : ''}>\r\n          <CardHeader className=\"flex flex-row items-center justify-between pb-2\">\r\n            <CardTitle className={`text-sm font-medium ${isDark ? 'text-gray-400' : 'text-gray-500'}`}>\r\n              Total Introductions\r\n            </CardTitle>\r\n            <Users className={`h-4 w-4 ${isDark ? 'text-gray-500' : 'text-gray-400'}`} />\r\n          </CardHeader>\r\n          <CardContent>\r\n            <div className={`text-2xl font-bold ${isDark ? 'text-white' : 'text-gray-900'}`}>\r\n              {metrics?.totalIntroductions || 0}\r\n            </div>\r\n            <p className={`text-xs ${isDark ? 'text-gray-500' : 'text-gray-500'}`}>\r\n              {metrics?.interestedIntroductions || 0} interested\r\n            </p>\r\n          </CardContent>\r\n        </Card>\r\n\r\n        <Card className={isDark ? 'bg-white/5 border-white/10' : ''}>\r\n          <CardHeader className=\"flex flex-row items-center justify-between pb-2\">\r\n            <CardTitle className={`text-sm font-medium ${isDark ? 'text-gray-400' : 'text-gray-500'}`}>\r\n              Conversion Rate\r\n            </CardTitle>\r\n            <TrendingUp className={`h-4 w-4 ${isDark ? 'text-gray-500' : 'text-gray-400'}`} />\r\n          </CardHeader>\r\n          <CardContent>\r\n            <div className={`text-2xl font-bold ${isDark ? 'text-white' : 'text-gray-900'}`}>\r\n              {metrics?.conversionRate.toFixed(1) || 0}%\r\n            </div>\r\n            <p className={`text-xs ${isDark ? 'text-gray-500' : 'text-gray-500'}`}>\r\n              {metrics?.fundedIntroductions || 0} funded\r\n            </p>\r\n          </CardContent>\r\n        </Card>\r\n\r\n        <Card className={isDark ? 'bg-white/5 border-white/10' : ''}>\r\n          <CardHeader className=\"flex flex-row items-center justify-between pb-2\">\r\n            <CardTitle className={`text-sm font-medium ${isDark ? 'text-gray-400' : 'text-gray-500'}`}>\r\n              Commission Earned\r\n            </CardTitle>\r\n            <DollarSign className={`h-4 w-4 ${isDark ? 'text-gray-500' : 'text-gray-400'}`} />\r\n          </CardHeader>\r\n          <CardContent>\r\n            <div className={`text-2xl font-bold text-green-500`}>\r\n              {formatCurrency(metrics?.totalCommissionEarned || 0)}\r\n            </div>\r\n            <p className={`text-xs ${isDark ? 'text-gray-500' : 'text-gray-500'}`}>\r\n              Total paid to date\r\n            </p>\r\n          </CardContent>\r\n        </Card>\r\n\r\n        <Card className={isDark ? 'bg-white/5 border-white/10' : ''}>\r\n          <CardHeader className=\"flex flex-row items-center justify-between pb-2\">\r\n            <CardTitle className={`text-sm font-medium ${isDark ? 'text-gray-400' : 'text-gray-500'}`}>\r\n              Pending Commission\r\n            </CardTitle>\r\n            <Clock className={`h-4 w-4 ${isDark ? 'text-gray-500' : 'text-gray-400'}`} />\r\n          </CardHeader>\r\n          <CardContent>\r\n            <div className={`text-2xl font-bold text-amber-500`}>\r\n              {formatCurrency(metrics?.pendingCommission || 0)}\r\n            </div>\r\n            <p className={`text-xs ${isDark ? 'text-gray-500' : 'text-gray-500'}`}>\n              Accrued or awaiting approval\n            </p>\n          </CardContent>\r\n        </Card>\r\n      </div>\r\n\r\n      {/* Performance Analytics */}\r\n      {performance && (\r\n        <Card className={isDark ? 'bg-white/5 border-white/10' : ''}>\r\n          <CardHeader>\r\n            <CardTitle className={`flex items-center gap-2 ${isDark ? 'text-white' : ''}`}>\r\n              <BarChart3 className=\"h-5 w-5\" />\r\n              Performance Analytics\r\n            </CardTitle>\r\n            <CardDescription>Your introduction performance trends</CardDescription>\r\n          </CardHeader>\r\n          <CardContent>\r\n            <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\r\n              <div className={`p-4 rounded-lg border ${isDark ? 'bg-white/5 border-white/10' : 'bg-muted/30'}`}>\r\n                <div className={`flex items-center gap-2 text-sm mb-1 ${isDark ? 'text-gray-400' : 'text-muted-foreground'}`}>\r\n                  {performance.introductionGrowth >= 0 ? (\r\n                    <TrendingUp className=\"h-4 w-4 text-green-500\" />\r\n                  ) : (\r\n                    <TrendingDown className=\"h-4 w-4 text-red-500\" />\r\n                  )}\r\n                  This Month\r\n                </div>\r\n                <div className={`text-2xl font-bold ${isDark ? 'text-white' : 'text-gray-900'}`}>\r\n                  {performance.thisMonthIntroductions}\r\n                </div>\r\n                <p className={`text-xs mt-1 ${isDark ? 'text-gray-500' : 'text-muted-foreground'}`}>\r\n                  <span className={performance.introductionGrowth >= 0 ? 'text-green-500' : 'text-red-500'}>\r\n                    {performance.introductionGrowth >= 0 ? '+' : ''}{performance.introductionGrowth}%\r\n                  </span>\r\n                  {' '}vs last month ({performance.lastMonthIntroductions})\r\n                </p>\r\n              </div>\r\n\r\n              <div className={`p-4 rounded-lg border ${isDark ? 'bg-white/5 border-white/10' : 'bg-muted/30'}`}>\r\n                <div className={`flex items-center gap-2 text-sm mb-1 ${isDark ? 'text-gray-400' : 'text-muted-foreground'}`}>\r\n                  <Target className=\"h-4 w-4\" />\r\n                  Conversion Rate\r\n                </div>\r\n                <div className={`text-2xl font-bold ${isDark ? 'text-white' : 'text-gray-900'}`}>\r\n                  {metrics?.conversionRate.toFixed(1) || 0}%\r\n                </div>\r\n                <p className={`text-xs mt-1 ${isDark ? 'text-gray-500' : 'text-muted-foreground'}`}>\r\n                  {metrics?.fundedIntroductions || 0} of {metrics?.totalIntroductions || 0} funded\r\n                </p>\r\n              </div>\r\n\r\n              <div className={`p-4 rounded-lg border ${isDark ? 'bg-white/5 border-white/10' : 'bg-muted/30'}`}>\r\n                <div className={`flex items-center gap-2 text-sm mb-1 ${isDark ? 'text-gray-400' : 'text-muted-foreground'}`}>\r\n                  <Wallet className=\"h-4 w-4\" />\r\n                  Avg Commission\r\n                </div>\r\n                <div className={`text-2xl font-bold ${isDark ? 'text-white' : 'text-gray-900'}`}>\r\n                  {formatCurrency(performance.avgCommissionPerIntro)}\r\n                </div>\r\n                <p className={`text-xs mt-1 ${isDark ? 'text-gray-500' : 'text-muted-foreground'}`}>\r\n                  Per successful introduction\r\n                </p>\r\n              </div>\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n      )}\r\n\r\n      {/* Two Column Layout */}\r\n      <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\r\n        {/* Recent Introductions */}\r\n        <Card className={isDark ? 'bg-white/5 border-white/10' : ''}>\r\n          <CardHeader className=\"flex flex-row items-center justify-between\">\r\n            <div>\r\n              <CardTitle className={isDark ? 'text-white' : ''}>Recent Introductions</CardTitle>\r\n              <CardDescription>Your latest referrals</CardDescription>\r\n            </div>\r\n            <Button variant=\"ghost\" size=\"sm\" asChild>\r\n              <Link href=\"/versotech_main/introductions\">\r\n                View All\r\n                <ArrowRight className=\"h-4 w-4 ml-1\" />\r\n              </Link>\r\n            </Button>\r\n          </CardHeader>\r\n          <CardContent>\r\n            {recentIntroductions.length === 0 ? (\r\n              <div className=\"text-center py-8\">\r\n                <UserPlus className={`h-10 w-10 mx-auto mb-3 ${isDark ? 'text-gray-600' : 'text-gray-400'}`} />\r\n                <p className={`text-sm ${isDark ? 'text-gray-400' : 'text-gray-500'}`}>\r\n                  No introductions yet\r\n                </p>\r\n              </div>\r\n            ) : (\r\n              <div className=\"space-y-3\">\r\n                {recentIntroductions.map((intro) => (\r\n                  <div\r\n                    key={intro.id}\r\n                    className={`flex items-center justify-between p-3 rounded-lg ${\r\n                      isDark ? 'bg-white/5' : 'bg-gray-50'\r\n                    }`}\r\n                  >\r\n                    <div>\r\n                      <p className={`font-medium ${isDark ? 'text-white' : 'text-gray-900'}`}>\r\n                        {intro.prospect_email}\r\n                      </p>\r\n                      <p className={`text-sm ${isDark ? 'text-gray-400' : 'text-gray-500'}`}>\r\n                        {intro.deal?.name || 'Unknown Deal'}\r\n                      </p>\r\n                    </div>\r\n                    <Badge className={statusStyles[intro.status] || 'bg-gray-500/20 text-gray-400'}>\r\n                      {intro.status}\r\n                    </Badge>\r\n                  </div>\r\n                ))}\r\n              </div>\r\n            )}\r\n          </CardContent>\r\n        </Card>\r\n\r\n        {/* Active Agreement */}\r\n        <Card className={isDark ? 'bg-white/5 border-white/10' : ''}>\r\n          <CardHeader>\r\n            <CardTitle className={isDark ? 'text-white' : ''}>Fee Agreement</CardTitle>\r\n            <CardDescription>Your current commission terms</CardDescription>\r\n          </CardHeader>\r\n          <CardContent>\r\n            {activeAgreement ? (\r\n              <div className=\"space-y-4\">\r\n                <div className=\"flex items-center gap-2\">\r\n                  <CheckCircle2 className=\"h-5 w-5 text-green-500\" />\r\n                  <span className={`font-medium ${isDark ? 'text-white' : 'text-gray-900'}`}>\r\n                    Active Agreement\r\n                  </span>\r\n                </div>\r\n\r\n                <div className=\"grid grid-cols-2 gap-4\">\r\n                  <div>\r\n                    <p className={`text-sm ${isDark ? 'text-gray-400' : 'text-gray-500'}`}>Commission Rate</p>\r\n                    <p className={`text-lg font-semibold ${isDark ? 'text-white' : 'text-gray-900'}`}>\r\n                      {activeAgreement.default_commission_bps\r\n                        ? `${(activeAgreement.default_commission_bps / 100).toFixed(2)}%`\r\n                        : 'N/A'}\r\n                    </p>\r\n                  </div>\r\n                  <div>\r\n                    <p className={`text-sm ${isDark ? 'text-gray-400' : 'text-gray-500'}`}>Effective Since</p>\r\n                    <p className={`text-lg font-semibold ${isDark ? 'text-white' : 'text-gray-900'}`}>\r\n                      {activeAgreement.effective_date\r\n                        ? formatDate(activeAgreement.effective_date)\r\n                        : 'N/A'}\r\n                    </p>\r\n                  </div>\r\n                  <div>\r\n                    <p className={`text-sm ${isDark ? 'text-gray-400' : 'text-gray-500'}`}>Expires</p>\r\n                    <p className={`text-lg font-semibold ${isDark ? 'text-white' : 'text-gray-900'}`}>\r\n                      {activeAgreement.expiry_date\r\n                        ? formatDate(activeAgreement.expiry_date)\r\n                        : 'No Expiry'}\r\n                    </p>\r\n                  </div>\r\n                  <div>\r\n                    <p className={`text-sm ${isDark ? 'text-gray-400' : 'text-gray-500'}`}>Signed</p>\r\n                    <p className={`text-lg font-semibold ${isDark ? 'text-white' : 'text-gray-900'}`}>\r\n                      {activeAgreement.signed_date\r\n                        ? formatDate(activeAgreement.signed_date)\r\n                        : 'N/A'}\r\n                    </p>\r\n                  </div>\r\n                </div>\r\n\r\n                <Button variant=\"outline\" size=\"sm\" asChild className=\"w-full\">\r\n                  <Link href={`/versotech_main/introducer-agreements/${activeAgreement.id}`}>\r\n                    <FileSignature className=\"h-4 w-4 mr-2\" />\r\n                    View Agreement\r\n                  </Link>\r\n                </Button>\r\n              </div>\r\n            ) : (\r\n              <div className=\"text-center py-8\">\r\n                <FileSignature className={`h-10 w-10 mx-auto mb-3 ${isDark ? 'text-gray-600' : 'text-gray-400'}`} />\r\n                <p className={`text-sm ${isDark ? 'text-gray-400' : 'text-gray-500'}`}>\r\n                  No active agreement\r\n                </p>\r\n                <p className={`text-xs ${isDark ? 'text-gray-500' : 'text-gray-400'} mt-1`}>\r\n                  Contact your relationship manager to set up an agreement\r\n                </p>\r\n              </div>\r\n            )}\r\n          </CardContent>\r\n        </Card>\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2769, "column": 0}, "map": {"version":3,"sources":["file:///Users/ghilesmoussaoui/Desktop/Versotech/versotech-portal/src/app/%28main%29/versotech_main/dashboard/partner-dashboard.tsx"],"sourcesContent":["'use client'\n\nimport { useEffect, useState } from 'react'\nimport Link from 'next/link'\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card'\nimport { Badge } from '@/components/ui/badge'\nimport { Button } from '@/components/ui/button'\nimport {\n  Users,\n  DollarSign,\n  TrendingUp,\n  TrendingDown,\n  Clock,\n  CheckCircle2,\n  ArrowRight,\n  Loader2,\n  Briefcase,\n  Eye,\n  HandCoins,\n  Activity,\n  BarChart3,\n  Target,\n  Wallet\n} from 'lucide-react'\nimport { formatCurrency } from '@/lib/format'\nimport { FeeModelView } from '@/components/partner/FeeModelView'\n\ntype Persona = {\n  persona_type: string\n  entity_id: string\n  entity_name: string\n  role_in_entity?: string | null\n  can_sign?: boolean\n  logo_url?: string | null\n}\n\ninterface PartnerDashboardProps {\n  partnerId: string\n  userId: string\n  persona: Persona\n}\n\ntype PartnerMetrics = {\n  totalReferredInvestors: number\n  subscribedInvestors: number\n  pipelineInvestors: number\n  totalCommitment: number\n  commitmentCurrency: string\n  pendingCommissions: number\n  pendingCommissionCurrency: string\n  trackedDeals: number\n  investableDeals: number\n}\n\ntype PerformanceMetrics = {\n  conversionRate: number\n  thisMonthReferrals: number\n  lastMonthReferrals: number\n  referralGrowth: number\n  paidCommissions: number\n  avgCommitmentPerInvestor: number\n  avgCommitmentCurrency: string\n}\n\ntype RecentReferral = {\n  deal_id: string | null\n  deal_name: string | null\n  deal_status: string | null\n  investor_id: string | null\n  investor_name: string | null\n  dispatched_at: string | null\n  interest_confirmed_at: string | null\n  subscription: {\n    commitment: number | null\n    status: string | null\n    signed_at: string | null\n  } | null\n}\n\nexport function PartnerDashboard({ partnerId, userId, persona }: PartnerDashboardProps) {\n  const [loading, setLoading] = useState(true)\n  const [error, setError] = useState<string | null>(null)\n  const [metrics, setMetrics] = useState<PartnerMetrics | null>(null)\n  const [performance, setPerformance] = useState<PerformanceMetrics | null>(null)\n  const [recentReferrals, setRecentReferrals] = useState<RecentReferral[]>([])\n\n  useEffect(() => {\n    async function fetchDashboard() {\n      try {\n        setLoading(true)\n        setError(null)\n\n        const response = await fetch('/api/partners/me/dashboard')\n        const data = await response.json()\n\n        if (!response.ok) {\n          throw new Error(data.error || 'Failed to load partner dashboard')\n        }\n\n        setMetrics(data.metrics)\n        setPerformance(data.performance || null)\n        setRecentReferrals(data.recent_referrals || [])\n      } catch (err) {\n        console.error('Error fetching partner dashboard data:', err)\n        setError(err instanceof Error ? err.message : 'Failed to load partner dashboard')\n      } finally {\n        setLoading(false)\n      }\n    }\n\n    if (partnerId && userId) {\n      fetchDashboard()\n    }\n  }, [partnerId, userId])\n\n  if (loading) {\n    return (\n      <div className=\"flex items-center justify-center min-h-[400px]\">\n        <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\n      </div>\n    )\n  }\n\n  if (error) {\n    return (\n      <div className=\"p-6\">\n        <Card>\n          <CardHeader>\n            <CardTitle>Partner Dashboard</CardTitle>\n            <CardDescription>{error}</CardDescription>\n          </CardHeader>\n        </Card>\n      </div>\n    )\n  }\n\n  const commitmentCurrency = metrics?.commitmentCurrency || 'USD'\n  const pendingCurrency = metrics?.pendingCommissionCurrency || 'USD'\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Welcome Section */}\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h1 className=\"text-2xl font-bold\">Welcome back, {persona.entity_name}</h1>\n          <p className=\"text-muted-foreground\">\n            Partner Dashboard - Track your referrals and investment opportunities\n          </p>\n        </div>\n        <Link href=\"/versotech_main/opportunities\">\n          <Button>\n            <TrendingUp className=\"mr-2 h-4 w-4\" />\n            View Opportunities\n          </Button>\n        </Link>\n      </div>\n\n      {/* Key Metrics */}\n      <div className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-4\">\n        <Link href=\"/versotech_main/opportunities\" className=\"block\">\n          <Card className=\"h-full hover:border-foreground/20 transition-colors\">\n            <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n              <CardTitle className=\"text-sm font-medium\">Deals Available</CardTitle>\n              <Briefcase className=\"h-4 w-4 text-muted-foreground\" />\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold\">{metrics?.investableDeals || 0}</div>\n              <p className=\"text-xs text-muted-foreground\">\n                {metrics?.trackedDeals || 0} tracking\n              </p>\n            </CardContent>\n          </Card>\n        </Link>\n\n        <Link href=\"/versotech_main/partner-transactions\" className=\"block\">\n          <Card className=\"h-full hover:border-foreground/20 transition-colors\">\n            <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n              <CardTitle className=\"text-sm font-medium\">Referred Investors</CardTitle>\n              <Users className=\"h-4 w-4 text-muted-foreground\" />\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold\">{metrics?.totalReferredInvestors || 0}</div>\n              <p className=\"text-xs text-muted-foreground\">\n                {metrics?.subscribedInvestors || 0} subscribed, {metrics?.pipelineInvestors || 0} in pipeline\n              </p>\n            </CardContent>\n          </Card>\n        </Link>\n\n        <Card>\n          <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Total Referred Amount</CardTitle>\n            <DollarSign className=\"h-4 w-4 text-muted-foreground\" />\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\">\n              {formatCurrency(metrics?.totalCommitment || 0, commitmentCurrency)}\n            </div>\n            <p className=\"text-xs text-muted-foreground\">\n              Committed by referred investors\n            </p>\n          </CardContent>\n        </Card>\n\n        <Link href=\"/versotech_main/partner-transactions\" className=\"block\">\n          <Card className=\"h-full hover:border-foreground/20 transition-colors\">\n            <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n              <CardTitle className=\"text-sm font-medium\">Pending Commissions</CardTitle>\n              <Activity className=\"h-4 w-4 text-muted-foreground\" />\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold\">\n                {formatCurrency(metrics?.pendingCommissions || 0, pendingCurrency)}\n              </div>\n              <p className=\"text-xs text-muted-foreground\">\n                Accrued and invoiced fees\n              </p>\n            </CardContent>\n          </Card>\n        </Link>\n      </div>\n\n      {/* Performance Metrics */}\n      {performance && (\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <BarChart3 className=\"h-5 w-5\" />\n              Performance Analytics\n            </CardTitle>\n            <CardDescription>Your referral performance metrics</CardDescription>\n          </CardHeader>\n          <CardContent>\n            <div className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-4\">\n              <div className=\"p-4 rounded-lg border bg-muted/30\">\n                <div className=\"flex items-center gap-2 text-sm text-muted-foreground mb-1\">\n                  <Target className=\"h-4 w-4\" />\n                  Conversion Rate\n                </div>\n                <div className=\"text-2xl font-bold\">{performance.conversionRate}%</div>\n                <p className=\"text-xs text-muted-foreground mt-1\">\n                  Referrals that subscribed\n                </p>\n              </div>\n\n              <div className=\"p-4 rounded-lg border bg-muted/30\">\n                <div className=\"flex items-center gap-2 text-sm text-muted-foreground mb-1\">\n                  {performance.referralGrowth >= 0 ? (\n                    <TrendingUp className=\"h-4 w-4 text-green-500\" />\n                  ) : (\n                    <TrendingDown className=\"h-4 w-4 text-red-500\" />\n                  )}\n                  This Month\n                </div>\n                <div className=\"text-2xl font-bold\">{performance.thisMonthReferrals}</div>\n                <p className=\"text-xs text-muted-foreground mt-1\">\n                  <span className={performance.referralGrowth >= 0 ? 'text-green-500' : 'text-red-500'}>\n                    {performance.referralGrowth >= 0 ? '+' : ''}{performance.referralGrowth}%\n                  </span>\n                  {' '}vs last month ({performance.lastMonthReferrals})\n                </p>\n              </div>\n\n              <div className=\"p-4 rounded-lg border bg-muted/30\">\n                <div className=\"flex items-center gap-2 text-sm text-muted-foreground mb-1\">\n                  <DollarSign className=\"h-4 w-4\" />\n                  Avg Commitment\n                </div>\n                <div className=\"text-2xl font-bold\">\n                  {formatCurrency(performance.avgCommitmentPerInvestor, performance.avgCommitmentCurrency)}\n                </div>\n                <p className=\"text-xs text-muted-foreground mt-1\">\n                  Per subscribed investor\n                </p>\n              </div>\n\n              <div className=\"p-4 rounded-lg border bg-muted/30\">\n                <div className=\"flex items-center gap-2 text-sm text-muted-foreground mb-1\">\n                  <Wallet className=\"h-4 w-4\" />\n                  Paid Commissions\n                </div>\n                <div className=\"text-2xl font-bold text-green-500\">\n                  {formatCurrency(performance.paidCommissions, pendingCurrency)}\n                </div>\n                <p className=\"text-xs text-muted-foreground mt-1\">\n                  Total received\n                </p>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n      )}\n\n      {/* Main Content */}\n      <div className=\"grid gap-6 lg:grid-cols-2\">\n        {/* Recent Referrals */}\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <HandCoins className=\"h-5 w-5\" />\n              Recent Referrals\n            </CardTitle>\n            <CardDescription>Investors you have referred to deals</CardDescription>\n          </CardHeader>\n          <CardContent>\n            {recentReferrals.length === 0 ? (\n              <div className=\"text-center py-8 text-muted-foreground\">\n                <Users className=\"h-12 w-12 mx-auto mb-4 opacity-20\" />\n                <p>No referrals yet</p>\n                <p className=\"text-sm mt-1\">\n                  Share deals with investors to start tracking\n                </p>\n              </div>\n            ) : (\n              <div className=\"space-y-4\">\n                {recentReferrals.map((referral, idx) => {\n                  const status = referral.subscription?.status\n                  const hasCommitment = status === 'committed' || status === 'active'\n                  const isPending = status === 'pending'\n                  const isInterested = !status && referral.interest_confirmed_at\n                  const badgeLabel = hasCommitment\n                    ? 'Committed'\n                    : isPending\n                      ? 'Pending'\n                      : isInterested\n                        ? 'Interested'\n                        : 'Dispatched'\n                  const badgeVariant = hasCommitment ? 'default' : isPending || isInterested ? 'secondary' : 'outline'\n\n                  return (\n                    <div\n                      key={`${referral.deal_id}-${referral.investor_id || idx}`}\n                      className=\"flex items-center justify-between p-3 rounded-lg border\"\n                    >\n                      <div className=\"flex items-center gap-3\">\n                        <div className={`p-2 rounded-full ${\n                          hasCommitment\n                            ? 'bg-green-100 text-green-600'\n                            : isPending\n                              ? 'bg-yellow-100 text-yellow-600'\n                              : isInterested\n                                ? 'bg-blue-100 text-blue-600'\n                                : 'bg-gray-100 text-gray-600'\n                        }`}>\n                          {hasCommitment ? (\n                            <CheckCircle2 className=\"h-4 w-4\" />\n                          ) : isPending ? (\n                            <Clock className=\"h-4 w-4\" />\n                          ) : isInterested ? (\n                            <Eye className=\"h-4 w-4\" />\n                          ) : (\n                            <Eye className=\"h-4 w-4\" />\n                          )}\n                        </div>\n                        <div>\n                          <p className=\"font-medium\">{referral.investor_name || 'Unknown Investor'}</p>\n                          <p className=\"text-sm text-muted-foreground\">\n                            {referral.deal_name || 'Unknown Deal'}\n                          </p>\n                        </div>\n                      </div>\n                      <div className=\"text-right\">\n                        {referral.subscription?.commitment ? (\n                          <p className=\"font-medium\">\n                            {formatCurrency(referral.subscription.commitment, commitmentCurrency)}\n                          </p>\n                        ) : null}\n                        <Badge variant={badgeVariant}>{badgeLabel}</Badge>\n                      </div>\n                    </div>\n                  )\n                })}\n                <Link href=\"/versotech_main/partner-transactions\">\n                  <Button variant=\"outline\" className=\"w-full\">\n                    View All Transactions\n                    <ArrowRight className=\"ml-2 h-4 w-4\" />\n                  </Button>\n                </Link>\n              </div>\n            )}\n          </CardContent>\n        </Card>\n\n        <FeeModelView />\n      </div>\n\n      {/* Quick Actions */}\n      <Card>\n        <CardHeader>\n          <CardTitle>Quick Actions</CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className=\"grid gap-4 sm:grid-cols-2 lg:grid-cols-4\">\n            <Link href=\"/versotech_main/opportunities\">\n              <Button variant=\"outline\" className=\"w-full justify-start\">\n                <TrendingUp className=\"mr-2 h-4 w-4\" />\n                Browse Opportunities\n              </Button>\n            </Link>\n            <Link href=\"/versotech_main/partner-transactions\">\n              <Button variant=\"outline\" className=\"w-full justify-start\">\n                <Users className=\"mr-2 h-4 w-4\" />\n                View Transactions\n              </Button>\n            </Link>\n            <Link href=\"/versotech_main/shared-transactions\">\n              <Button variant=\"outline\" className=\"w-full justify-start\">\n                <HandCoins className=\"mr-2 h-4 w-4\" />\n                Shared Deals\n              </Button>\n            </Link>\n            <Link href=\"/versotech_main/messages\">\n              <Button variant=\"outline\" className=\"w-full justify-start\">\n                <Activity className=\"mr-2 h-4 w-4\" />\n                Messages\n              </Button>\n            </Link>\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  )\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 3851, "column": 0}, "map": {"version":3,"sources":["file:///Users/ghilesmoussaoui/Desktop/Versotech/versotech-portal/src/app/%28main%29/versotech_main/dashboard/lawyer-dashboard.tsx"],"sourcesContent":["'use client'\r\n\r\nimport { useEffect, useState } from 'react'\r\nimport Link from 'next/link'\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card'\r\nimport { Badge } from '@/components/ui/badge'\r\nimport { Button } from '@/components/ui/button'\r\nimport {\r\n  Scale,\r\n  Briefcase,\r\n  DollarSign,\r\n  FileText,\r\n  CheckCircle2,\r\n  ArrowRight,\r\n  Loader2,\r\n  AlertCircle,\r\n  Users,\r\n} from 'lucide-react'\r\nimport { createClient } from '@/lib/supabase/client'\r\nimport { formatCurrency, formatDate } from '@/lib/format'\r\nimport { useTheme } from '@/components/theme-provider'\r\n\r\ntype Persona = {\r\n  persona_type: string\r\n  entity_id: string\r\n  entity_name: string\r\n  role_in_entity?: string | null\r\n  can_sign?: boolean\r\n  logo_url?: string | null\r\n}\r\n\r\ninterface LawyerDashboardProps {\r\n  lawyerId: string\r\n  userId: string\r\n  persona: Persona\r\n}\r\n\r\ntype CurrencyTotal = {\r\n  currency: string\r\n  amount: number\r\n}\r\n\r\ntype LawyerMetrics = {\r\n  assignedDeals: number\r\n  pendingEscrowConfirmations: number\r\n  pendingPaymentConfirmations: number\r\n  signedSubscriptions: number\r\n  fullyFundedSubscriptions: number\r\n  commitmentsByCurrency: CurrencyTotal[]\r\n  fundedByCurrency: CurrencyTotal[]\r\n}\r\n\r\ntype RecentSubscription = {\r\n  id: string\r\n  deal_name: string\r\n  investor_name: string\r\n  commitment: number\r\n  funded_amount: number\r\n  currency: string\r\n  status: string\r\n  committed_at: string | null\r\n}\r\n\r\ntype AssignedDeal = {\r\n  id: string\r\n  name: string\r\n  status: string\r\n  target_amount: number | null\r\n  currency: string\r\n}\r\n\r\nexport function LawyerDashboard({ lawyerId, userId, persona }: LawyerDashboardProps) {\r\n  const { theme } = useTheme()\r\n  const isDark = theme === 'staff-dark'\r\n\r\n  const [loading, setLoading] = useState(true)\r\n  const [error, setError] = useState<string | null>(null)\r\n  const [metrics, setMetrics] = useState<LawyerMetrics | null>(null)\r\n  const [lawyerInfo, setLawyerInfo] = useState<{\r\n    firm_name: string\r\n    display_name: string\r\n    specializations: string[] | null\r\n    is_active: boolean\r\n  } | null>(null)\r\n  const [recentSubscriptions, setRecentSubscriptions] = useState<RecentSubscription[]>([])\r\n  const [assignedDeals, setAssignedDeals] = useState<AssignedDeal[]>([])\r\n\r\n  useEffect(() => {\r\n    async function fetchData() {\r\n      try {\r\n        const supabase = createClient()\r\n\r\n        // Fetch lawyer info\r\n        const { data: lawyer } = await supabase\r\n          .from('lawyers')\r\n          .select('id, firm_name, display_name, specializations, is_active, assigned_deals')\r\n          .eq('id', lawyerId)\r\n          .maybeSingle()\r\n\r\n        if (lawyer) {\r\n          setLawyerInfo({\r\n            firm_name: lawyer.firm_name || '',\r\n            display_name: lawyer.display_name || '',\r\n            specializations: lawyer.specializations,\r\n            is_active: lawyer.is_active ?? true,\r\n          })\r\n        }\r\n\r\n        // VEHICLE-LEVEL ARCHITECTURE: Get vehicles assigned to this lawyer first\r\n        const { data: lawyerVehicles } = await supabase\r\n          .from('vehicles')\r\n          .select('id, name')\r\n          .eq('lawyer_id', lawyerId)\r\n\r\n        const vehicleIds = (lawyerVehicles || []).map((v: any) => v.id)\r\n\r\n        // Then get all deals under those vehicles\r\n        let dealsFromVehicles: AssignedDeal[] = []\r\n        let dealIds: string[] = []\r\n\r\n        if (vehicleIds.length > 0) {\r\n          const { data: vehicleDeals } = await supabase\r\n            .from('deals')\r\n            .select('id, name, status, target_amount, currency, vehicle_id')\r\n            .in('vehicle_id', vehicleIds)\r\n            .order('created_at', { ascending: false })\r\n            .limit(10)\r\n\r\n          dealsFromVehicles = (vehicleDeals || []).map((d: any) => ({\r\n            id: d.id,\r\n            name: d.name,\r\n            status: d.status,\r\n            target_amount: d.target_amount,\r\n            currency: d.currency || 'USD',\r\n          }))\r\n\r\n          dealIds = (vehicleDeals || []).map((d: any) => d.id)\r\n        }\r\n\r\n        // Fallback to lawyers.assigned_deals if no vehicle assignments (legacy support)\r\n        if (!dealIds.length && lawyer?.assigned_deals?.length) {\r\n          dealIds = lawyer.assigned_deals\r\n        }\r\n\r\n        // Set assigned deals from vehicle query result\r\n        setAssignedDeals(dealsFromVehicles)\r\n\r\n        if (dealIds.length > 0) {\r\n          // Fetch subscriptions for these deals (signed/committed statuses)\r\n          const { data: subscriptions } = await supabase\r\n            .from('subscriptions')\r\n            .select(`\r\n              id,\r\n              deal_id,\r\n              investor_id,\r\n              status,\r\n              commitment,\r\n              funded_amount,\r\n              currency,\r\n              committed_at,\r\n              deals (id, name),\r\n              investors (id, display_name, legal_name)\r\n            `)\r\n            .in('deal_id', dealIds)\r\n            .in('status', ['committed', 'partially_funded', 'funded', 'active'])\n            .order('committed_at', { ascending: false })\r\n\r\n          const subs = subscriptions || []\r\n\r\n          // Query fee events for pending payment confirmations\r\n          const { data: feeEvents } = await supabase\r\n            .from('fee_events')\r\n            .select('id, status')\r\n            .in('deal_id', dealIds)\r\n            .in('status', ['accrued', 'invoiced'])\r\n\r\n          const pendingFeePayments = (feeEvents || []).length\r\n\r\n          // Calculate metrics\r\n          const committed = subs.filter((s: any) => s.status === 'committed')\r\n          const partiallyFunded = subs.filter((s: any) => s.status === 'partially_funded')\r\n          const fullyFunded = subs.filter((s: any) => s.status === 'funded' || s.status === 'active')\n\r\n          // Group totals by currency to avoid mixing USD/EUR/GBP\r\n          const commitmentMap = new Map<string, number>()\r\n          const fundedMap = new Map<string, number>()\r\n\r\n          subs.forEach((s: any) => {\r\n            const currency = s.currency || 'USD'\r\n            commitmentMap.set(currency, (commitmentMap.get(currency) || 0) + (s.commitment || 0))\r\n            fundedMap.set(currency, (fundedMap.get(currency) || 0) + (s.funded_amount || 0))\r\n          })\r\n\r\n          // Convert to sorted arrays (USD first, then alphabetically)\r\n          const sortCurrencies = (a: CurrencyTotal, b: CurrencyTotal) => {\r\n            if (a.currency === 'USD') return -1\r\n            if (b.currency === 'USD') return 1\r\n            return a.currency.localeCompare(b.currency)\r\n          }\r\n\r\n          const commitmentsByCurrency = Array.from(commitmentMap.entries())\r\n            .map(([currency, amount]) => ({ currency, amount }))\r\n            .filter(c => c.amount > 0)\r\n            .sort(sortCurrencies)\r\n\r\n          const fundedByCurrency = Array.from(fundedMap.entries())\r\n            .map(([currency, amount]) => ({ currency, amount }))\r\n            .filter(c => c.amount > 0)\r\n            .sort(sortCurrencies)\r\n\r\n          setMetrics({\r\n            assignedDeals: dealIds.length,\r\n            pendingEscrowConfirmations: committed.length + partiallyFunded.length,\r\n            pendingPaymentConfirmations: pendingFeePayments,\r\n            signedSubscriptions: subs.length,\r\n            fullyFundedSubscriptions: fullyFunded.length,\r\n            commitmentsByCurrency,\r\n            fundedByCurrency,\r\n          })\r\n\r\n          // Map recent subscriptions\r\n          const recentSubs: RecentSubscription[] = subs.slice(0, 5).map((sub: any) => {\r\n            const deal = Array.isArray(sub.deals) ? sub.deals[0] : sub.deals\r\n            const investor = Array.isArray(sub.investors) ? sub.investors[0] : sub.investors\r\n\r\n            return {\r\n              id: sub.id,\r\n              deal_name: deal?.name || 'Unknown Deal',\r\n              investor_name: investor?.display_name || investor?.legal_name || 'Unknown Investor',\r\n              commitment: sub.commitment || 0,\r\n              funded_amount: sub.funded_amount || 0,\r\n              currency: sub.currency || 'USD',\r\n              status: sub.status,\r\n              committed_at: sub.committed_at,\r\n            }\r\n          })\r\n\r\n          setRecentSubscriptions(recentSubs)\r\n        } else {\r\n          // No deals assigned\r\n          setMetrics({\r\n            assignedDeals: 0,\r\n            pendingEscrowConfirmations: 0,\r\n            pendingPaymentConfirmations: 0,\r\n            signedSubscriptions: 0,\r\n            fullyFundedSubscriptions: 0,\r\n            commitmentsByCurrency: [],\r\n            fundedByCurrency: [],\r\n          })\r\n        }\r\n      } catch (err) {\r\n        console.error('Error fetching lawyer data:', err)\r\n        setError(err instanceof Error ? err.message : 'Failed to load dashboard data')\r\n      } finally {\r\n        setLoading(false)\r\n      }\r\n    }\r\n\r\n    fetchData()\r\n  }, [lawyerId, userId])\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"p-8 text-center flex flex-col items-center gap-3\">\r\n        <Loader2 className=\"h-8 w-8 animate-spin text-gray-400\" />\r\n        <p className=\"text-gray-500\">Loading dashboard...</p>\r\n      </div>\r\n    )\r\n  }\r\n\r\n  if (error) {\r\n    return (\r\n      <div className=\"p-8 text-center flex flex-col items-center gap-3\">\r\n        <AlertCircle className=\"h-12 w-12 text-destructive\" />\r\n        <h3 className=\"text-lg font-medium\">Error Loading Dashboard</h3>\r\n        <p className=\"text-muted-foreground\">{error}</p>\r\n        <Button variant=\"outline\" onClick={() => window.location.reload()}>\r\n          Try Again\r\n        </Button>\r\n      </div>\r\n    )\r\n  }\r\n\r\n  const statusStyles: Record<string, string> = {\n    committed: 'bg-blue-500/20 text-blue-400',\n    partially_funded: 'bg-amber-500/20 text-amber-400',\n    funded: 'bg-emerald-500/20 text-emerald-400',\n    active: 'bg-green-500/20 text-green-400',\n  }\n\n  const statusLabels: Record<string, string> = {\n    committed: 'Awaiting Funding',\n    partially_funded: 'Partial',\n    funded: 'Fully Funded',\n    active: 'Active',\n  }\n\r\n  const dealStatusStyles: Record<string, string> = {\r\n    open: 'bg-green-500/20 text-green-400',\r\n    draft: 'bg-gray-500/20 text-gray-400',\r\n    allocation_pending: 'bg-yellow-500/20 text-yellow-400',\r\n    fully_subscribed: 'bg-blue-500/20 text-blue-400',\r\n    closed: 'bg-purple-500/20 text-purple-400',\r\n    cancelled: 'bg-red-500/20 text-red-400',\r\n  }\r\n\r\n  return (\r\n    <div className=\"p-6 space-y-6\">\r\n      {/* Header */}\r\n      <div className=\"flex items-center justify-between\">\r\n        <div>\r\n          <h1 className={`text-2xl font-bold ${isDark ? 'text-white' : 'text-gray-900'}`}>\r\n            Lawyer Dashboard\r\n          </h1>\r\n          <p className={`mt-1 ${isDark ? 'text-gray-400' : 'text-gray-600'}`}>\r\n            {lawyerInfo?.display_name || persona.entity_name}\r\n            {lawyerInfo?.firm_name && ` - ${lawyerInfo.firm_name}`}\r\n          </p>\r\n        </div>\r\n        {lawyerInfo?.specializations?.length ? (\r\n          <div className=\"flex gap-2\">\r\n            {lawyerInfo.specializations.slice(0, 3).map((spec, idx) => (\r\n              <Badge key={idx} variant=\"outline\" className=\"capitalize\">\r\n                {spec}\r\n              </Badge>\r\n            ))}\r\n          </div>\r\n        ) : null}\r\n      </div>\r\n\r\n      {/* Alert for inactive lawyer */}\r\n      {lawyerInfo && !lawyerInfo.is_active && (\r\n        <Card className={`border-amber-500/30 ${isDark ? 'bg-amber-500/10' : 'bg-amber-50'}`}>\r\n          <CardContent className=\"py-4\">\r\n            <div className=\"flex items-center gap-3\">\r\n              <div className=\"p-2 rounded-full bg-amber-500/20\">\r\n                <AlertCircle className=\"h-5 w-5 text-amber-500\" />\r\n              </div>\r\n              <div>\r\n                <p className={`font-medium ${isDark ? 'text-white' : 'text-gray-900'}`}>\r\n                  Account Inactive\r\n                </p>\r\n                <p className={`text-sm ${isDark ? 'text-gray-400' : 'text-gray-600'}`}>\r\n                  Your lawyer account is currently inactive. Contact the VERSO team for assistance.\r\n                </p>\r\n              </div>\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n      )}\r\n\r\n      {/* Pending Escrow Alert */}\r\n      {metrics && metrics.pendingEscrowConfirmations > 0 && (\r\n        <Card className={`border-blue-500/30 ${isDark ? 'bg-blue-500/10' : 'bg-blue-50'}`}>\r\n          <CardContent className=\"py-4\">\r\n            <div className=\"flex items-center justify-between\">\r\n              <div className=\"flex items-center gap-3\">\r\n                <div className=\"p-2 rounded-full bg-blue-500/20\">\r\n                  <DollarSign className=\"h-5 w-5 text-blue-500\" />\r\n                </div>\r\n                <div>\r\n                  <p className={`font-medium ${isDark ? 'text-white' : 'text-gray-900'}`}>\r\n                    {metrics.pendingEscrowConfirmations} Pending Escrow Confirmation{metrics.pendingEscrowConfirmations !== 1 ? 's' : ''}\r\n                  </p>\r\n                  <p className={`text-sm ${isDark ? 'text-gray-400' : 'text-gray-600'}`}>\r\n                    Signed subscriptions awaiting funding confirmation\r\n                  </p>\r\n                </div>\r\n              </div>\r\n              <Button asChild>\r\n                <Link href=\"/versotech_main/escrow\">\r\n                  Confirm Funding\r\n                  <ArrowRight className=\"h-4 w-4 ml-2\" />\r\n                </Link>\r\n              </Button>\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n      )}\r\n\r\n      {/* Pending Payment Confirmations Alert */}\r\n      {metrics && metrics.pendingPaymentConfirmations > 0 && (\r\n        <Card className={`border-purple-500/30 ${isDark ? 'bg-purple-500/10' : 'bg-purple-50'}`}>\r\n          <CardContent className=\"py-4\">\r\n            <div className=\"flex items-center justify-between\">\r\n              <div className=\"flex items-center gap-3\">\r\n                <div className=\"p-2 rounded-full bg-purple-500/20\">\r\n                  <DollarSign className=\"h-5 w-5 text-purple-500\" />\r\n                </div>\r\n                <div>\r\n                  <p className={`font-medium ${isDark ? 'text-white' : 'text-gray-900'}`}>\r\n                    {metrics.pendingPaymentConfirmations} Pending Fee Payment{metrics.pendingPaymentConfirmations !== 1 ? 's' : ''}\r\n                  </p>\r\n                  <p className={`text-sm ${isDark ? 'text-gray-400' : 'text-gray-600'}`}>\r\n                    Fee payments awaiting confirmation\r\n                  </p>\r\n                </div>\r\n              </div>\r\n              <Button asChild variant=\"outline\">\r\n                <Link href=\"/versotech_main/lawyer-reconciliation\">\r\n                  View Fees\r\n                  <ArrowRight className=\"h-4 w-4 ml-2\" />\r\n                </Link>\r\n              </Button>\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n      )}\r\n\r\n      {/* Metrics Grid */}\r\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\r\n        <Card className={isDark ? 'bg-white/5 border-white/10' : ''}>\r\n          <CardHeader className=\"flex flex-row items-center justify-between pb-2\">\r\n            <CardTitle className={`text-sm font-medium ${isDark ? 'text-gray-400' : 'text-gray-500'}`}>\r\n              Assigned Deals\r\n            </CardTitle>\r\n            <Briefcase className={`h-4 w-4 ${isDark ? 'text-gray-500' : 'text-gray-400'}`} />\r\n          </CardHeader>\r\n          <CardContent>\r\n            <div className={`text-2xl font-bold ${isDark ? 'text-white' : 'text-gray-900'}`}>\r\n              {metrics?.assignedDeals || 0}\r\n            </div>\r\n            <p className={`text-xs ${isDark ? 'text-gray-500' : 'text-gray-500'}`}>\r\n              Deals under your counsel\r\n            </p>\r\n          </CardContent>\r\n        </Card>\r\n\r\n        <Card className={isDark ? 'bg-white/5 border-white/10' : ''}>\r\n          <CardHeader className=\"flex flex-row items-center justify-between pb-2\">\r\n            <CardTitle className={`text-sm font-medium ${isDark ? 'text-gray-400' : 'text-gray-500'}`}>\r\n              Signed Subscriptions\r\n            </CardTitle>\r\n            <FileText className={`h-4 w-4 ${isDark ? 'text-gray-500' : 'text-gray-400'}`} />\r\n          </CardHeader>\r\n          <CardContent>\r\n            <div className={`text-2xl font-bold ${isDark ? 'text-white' : 'text-gray-900'}`}>\r\n              {metrics?.signedSubscriptions || 0}\r\n            </div>\r\n            <p className={`text-xs ${isDark ? 'text-gray-500' : 'text-gray-500'}`}>\r\n              {metrics?.fullyFundedSubscriptions || 0} fully funded\r\n            </p>\r\n          </CardContent>\r\n        </Card>\r\n\r\n        <Card className={isDark ? 'bg-white/5 border-white/10' : ''}>\r\n          <CardHeader className=\"flex flex-row items-center justify-between pb-2\">\r\n            <CardTitle className={`text-sm font-medium ${isDark ? 'text-gray-400' : 'text-gray-500'}`}>\r\n              Total Committed\r\n            </CardTitle>\r\n            <DollarSign className={`h-4 w-4 ${isDark ? 'text-gray-500' : 'text-gray-400'}`} />\r\n          </CardHeader>\r\n          <CardContent>\r\n            {metrics?.commitmentsByCurrency && metrics.commitmentsByCurrency.length > 0 ? (\r\n              <div className=\"space-y-1\">\r\n                {metrics.commitmentsByCurrency.map((c, i) => (\r\n                  <div key={c.currency} className={`${i === 0 ? 'text-2xl font-bold' : 'text-sm font-medium'} text-blue-500`}>\r\n                    {formatCurrency(c.amount, c.currency)}\r\n                  </div>\r\n                ))}\r\n              </div>\r\n            ) : (\r\n              <div className={`text-2xl font-bold text-blue-500`}>\r\n                {formatCurrency(0)}\r\n              </div>\r\n            )}\r\n            <p className={`text-xs mt-1 ${isDark ? 'text-gray-500' : 'text-gray-500'}`}>\r\n              Across all subscriptions\r\n            </p>\r\n          </CardContent>\r\n        </Card>\r\n\r\n        <Card className={isDark ? 'bg-white/5 border-white/10' : ''}>\r\n          <CardHeader className=\"flex flex-row items-center justify-between pb-2\">\r\n            <CardTitle className={`text-sm font-medium ${isDark ? 'text-gray-400' : 'text-gray-500'}`}>\r\n              Total Funded\r\n            </CardTitle>\r\n            <CheckCircle2 className={`h-4 w-4 ${isDark ? 'text-gray-500' : 'text-gray-400'}`} />\r\n          </CardHeader>\r\n          <CardContent>\r\n            {metrics?.fundedByCurrency && metrics.fundedByCurrency.length > 0 ? (\r\n              <div className=\"space-y-1\">\r\n                {metrics.fundedByCurrency.map((c, i) => (\r\n                  <div key={c.currency} className={`${i === 0 ? 'text-2xl font-bold' : 'text-sm font-medium'} text-green-500`}>\r\n                    {formatCurrency(c.amount, c.currency)}\r\n                  </div>\r\n                ))}\r\n              </div>\r\n            ) : (\r\n              <div className={`text-2xl font-bold text-green-500`}>\r\n                {formatCurrency(0)}\r\n              </div>\r\n            )}\r\n            <p className={`text-xs mt-1 ${isDark ? 'text-gray-500' : 'text-gray-500'}`}>\r\n              Escrow confirmed\r\n            </p>\r\n          </CardContent>\r\n        </Card>\r\n      </div>\r\n\r\n      {/* Two Column Layout */}\r\n      <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\r\n        {/* Recent Signed Subscriptions */}\r\n        <Card className={isDark ? 'bg-white/5 border-white/10' : ''}>\r\n          <CardHeader className=\"flex flex-row items-center justify-between\">\r\n            <div>\r\n              <CardTitle className={isDark ? 'text-white' : ''}>Recent Subscriptions</CardTitle>\r\n              <CardDescription>Recently signed subscription packs</CardDescription>\r\n            </div>\r\n            <Button variant=\"ghost\" size=\"sm\" asChild>\r\n              <Link href=\"/versotech_main/subscription-packs\">\r\n                View All\r\n                <ArrowRight className=\"h-4 w-4 ml-1\" />\r\n              </Link>\r\n            </Button>\r\n          </CardHeader>\r\n          <CardContent>\r\n            {recentSubscriptions.length === 0 ? (\r\n              <div className=\"text-center py-8\">\r\n                <FileText className={`h-10 w-10 mx-auto mb-3 ${isDark ? 'text-gray-600' : 'text-gray-400'}`} />\r\n                <p className={`text-sm ${isDark ? 'text-gray-400' : 'text-gray-500'}`}>\r\n                  No signed subscriptions yet\r\n                </p>\r\n              </div>\r\n            ) : (\r\n              <div className=\"space-y-3\">\r\n                {recentSubscriptions.map((sub) => (\r\n                  <div\r\n                    key={sub.id}\r\n                    className={`flex items-center justify-between p-3 rounded-lg ${\r\n                      isDark ? 'bg-white/5' : 'bg-gray-50'\r\n                    }`}\r\n                  >\r\n                    <div className=\"flex-1 min-w-0\">\r\n                      <p className={`font-medium truncate ${isDark ? 'text-white' : 'text-gray-900'}`}>\r\n                        {sub.investor_name}\r\n                      </p>\r\n                      <p className={`text-sm truncate ${isDark ? 'text-gray-400' : 'text-gray-500'}`}>\r\n                        {sub.deal_name}\r\n                      </p>\r\n                      <p className={`text-xs ${isDark ? 'text-gray-500' : 'text-gray-400'}`}>\r\n                        {formatCurrency(sub.commitment, sub.currency)} committed\r\n                      </p>\r\n                    </div>\r\n                    <Badge className={statusStyles[sub.status] || 'bg-gray-500/20 text-gray-400'}>\r\n                      {statusLabels[sub.status] || sub.status}\r\n                    </Badge>\r\n                  </div>\r\n                ))}\r\n              </div>\r\n            )}\r\n          </CardContent>\r\n        </Card>\r\n\r\n        {/* Assigned Deals */}\r\n        <Card className={isDark ? 'bg-white/5 border-white/10' : ''}>\r\n          <CardHeader className=\"flex flex-row items-center justify-between\">\r\n            <div>\r\n              <CardTitle className={isDark ? 'text-white' : ''}>Assigned Deals</CardTitle>\r\n              <CardDescription>Deals under your legal counsel</CardDescription>\r\n            </div>\r\n            <Button variant=\"ghost\" size=\"sm\" asChild>\r\n              <Link href=\"/versotech_main/assigned-deals\">\r\n                View All\r\n                <ArrowRight className=\"h-4 w-4 ml-1\" />\r\n              </Link>\r\n            </Button>\r\n          </CardHeader>\r\n          <CardContent>\r\n            {assignedDeals.length === 0 ? (\r\n              <div className=\"text-center py-8\">\r\n                <Briefcase className={`h-10 w-10 mx-auto mb-3 ${isDark ? 'text-gray-600' : 'text-gray-400'}`} />\r\n                <p className={`text-sm ${isDark ? 'text-gray-400' : 'text-gray-500'}`}>\r\n                  No deals assigned yet\r\n                </p>\r\n                <p className={`text-xs ${isDark ? 'text-gray-500' : 'text-gray-400'} mt-1`}>\r\n                  Contact the VERSO team to be assigned to deals\r\n                </p>\r\n              </div>\r\n            ) : (\r\n              <div className=\"space-y-3\">\r\n                {assignedDeals.map((deal) => (\r\n                  <Link\r\n                    key={deal.id}\r\n                    href={`/versotech_main/opportunities/${deal.id}`}\r\n                    className={`flex items-center justify-between p-3 rounded-lg transition-colors ${\r\n                      isDark ? 'bg-white/5 hover:bg-white/10' : 'bg-gray-50 hover:bg-gray-100'\r\n                    }`}\r\n                  >\r\n                    <div className=\"flex-1 min-w-0\">\r\n                      <p className={`font-medium truncate ${isDark ? 'text-white' : 'text-gray-900'}`}>\r\n                        {deal.name}\r\n                      </p>\r\n                      <p className={`text-sm ${isDark ? 'text-gray-400' : 'text-gray-500'}`}>\r\n                        {deal.target_amount\r\n                          ? `${formatCurrency(deal.target_amount, deal.currency)} target`\r\n                          : 'No target set'}\r\n                      </p>\r\n                    </div>\r\n                    <Badge className={dealStatusStyles[deal.status] || 'bg-gray-500/20 text-gray-400'}>\r\n                      {deal.status}\r\n                    </Badge>\r\n                  </Link>\r\n                ))}\r\n              </div>\r\n            )}\r\n          </CardContent>\r\n        </Card>\r\n      </div>\r\n\r\n      {/* Quick Actions */}\r\n      <Card className={isDark ? 'bg-white/5 border-white/10' : ''}>\r\n        <CardHeader>\r\n          <CardTitle className={isDark ? 'text-white' : ''}>Quick Actions</CardTitle>\r\n          <CardDescription>Common tasks and workflows</CardDescription>\r\n        </CardHeader>\r\n        <CardContent>\r\n          <div className=\"grid grid-cols-2 md:grid-cols-3 gap-4\">\r\n            <Button variant=\"outline\" asChild className=\"h-auto py-4 flex-col gap-2\">\r\n              <Link href=\"/versotech_main/subscription-packs\">\r\n                <FileText className=\"h-5 w-5\" />\r\n                <span>View Signed Packs</span>\r\n              </Link>\r\n            </Button>\r\n            <Button variant=\"outline\" asChild className=\"h-auto py-4 flex-col gap-2\">\r\n              <Link href=\"/versotech_main/escrow\">\r\n                <DollarSign className=\"h-5 w-5\" />\r\n                <span>Confirm Escrow</span>\r\n              </Link>\r\n            </Button>\r\n            <Button variant=\"outline\" asChild className=\"h-auto py-4 flex-col gap-2\">\r\n              <Link href=\"/versotech_main/assigned-deals\">\r\n                <Briefcase className=\"h-5 w-5\" />\r\n                <span>View Deals</span>\r\n              </Link>\r\n            </Button>\r\n          </div>\r\n        </CardContent>\r\n      </Card>\r\n    </div>\r\n  )\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 5176, "column": 0}, "map": {"version":3,"sources":["file:///Users/ghilesmoussaoui/Desktop/Versotech/versotech-portal/src/app/%28main%29/versotech_main/dashboard/arranger-dashboard.tsx"],"sourcesContent":["'use client'\r\n\r\nimport { useEffect, useState } from 'react'\r\nimport Link from 'next/link'\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card'\r\nimport { Badge } from '@/components/ui/badge'\r\nimport { Button } from '@/components/ui/button'\r\nimport {\r\n  Briefcase,\r\n  Users,\r\n  UserPlus,\r\n  Building2,\r\n  Scale,\r\n  DollarSign,\r\n  FileText,\r\n  Clock,\r\n  CheckCircle2,\r\n  ArrowRight,\r\n  Loader2,\r\n  AlertCircle,\r\n  TrendingUp,\r\n  FileSignature,\r\n  Wallet,\r\n  Receipt,\r\n} from 'lucide-react'\r\nimport { Alert, AlertDescription } from '@/components/ui/alert'\r\nimport { createClient } from '@/lib/supabase/client'\r\nimport { formatCurrency, formatDate } from '@/lib/format'\r\nimport { useTheme } from '@/components/theme-provider'\r\nimport { ArrangerOnboardingChecklist } from '@/components/arranger/arranger-onboarding-checklist'\r\n\r\ntype Persona = {\r\n  persona_type: string\r\n  entity_id: string\r\n  entity_name: string\r\n  role_in_entity?: string | null\r\n  can_sign?: boolean\r\n  logo_url?: string | null\r\n}\r\n\r\ninterface ArrangerDashboardProps {\r\n  arrangerId: string\r\n  userId: string\r\n  persona: Persona\r\n}\r\n\r\ntype ArrangerMetrics = {\r\n  totalMandates: number\r\n  activeMandates: number\r\n  pendingMandates: number\r\n  totalPartners: number\r\n  totalIntroducers: number\r\n  totalCommercialPartners: number\r\n  totalLawyers: number\r\n  pendingAgreements: number\r\n  totalCommitmentValue: number\r\n}\r\n\r\ntype RecentMandate = {\r\n  id: string\r\n  name: string\r\n  status: string\r\n  target_amount: number | null\r\n  currency: string\r\n  created_at: string\r\n}\r\n\r\ntype PendingAgreement = {\r\n  id: string\r\n  entity_name: string\r\n  entity_type: 'introducer' | 'commercial_partner'\r\n  status: string\r\n  created_at: string\r\n}\r\n\r\n// New metrics types for User Story compliance (2.5.2, 2.6.1, 2.2.4/2.3.4/2.4.4)\r\ntype EscrowMetrics = {\r\n  totalExpected: number      // SUM(commitment) for committed subscriptions\r\n  totalFunded: number        // SUM(funded_amount)\r\n  totalOutstanding: number   // SUM(outstanding_amount)\r\n  fundingRate: number        // percentage\r\n  pendingInvestors: number   // COUNT where funded_amount < commitment\r\n}\r\n\r\ntype SubscriptionPackMetrics = {\r\n  awaitingInvestorSignature: number\r\n  awaitingArrangerSignature: number\r\n  awaitingCEOSignature: number\r\n  signedThisMonth: number\r\n  totalPending: number\r\n}\r\n\r\ntype FeeMetrics = {\r\n  totalAccrued: number       // status = 'accrued'\r\n  totalInvoiced: number      // status = 'invoiced'\r\n  totalPaid: number          // status = 'paid'\r\n  feePipeline: number        // accrued + invoiced (not yet paid)\r\n}\r\n\r\nexport function ArrangerDashboard({ arrangerId, userId, persona }: ArrangerDashboardProps) {\r\n  const { theme } = useTheme()\r\n  const isDark = theme === 'staff-dark'\r\n\r\n  const [loading, setLoading] = useState(true)\r\n  const [metrics, setMetrics] = useState<ArrangerMetrics | null>(null)\r\n  const [arrangerInfo, setArrangerInfo] = useState<{\r\n    legal_name: string\r\n    status: string\r\n    kyc_status: string | null\r\n  } | null>(null)\r\n  const [recentMandates, setRecentMandates] = useState<RecentMandate[]>([])\r\n  const [pendingAgreements, setPendingAgreements] = useState<PendingAgreement[]>([])\r\n  // New state for User Story compliance metrics\r\n  const [escrowMetrics, setEscrowMetrics] = useState<EscrowMetrics | null>(null)\r\n  const [subPackMetrics, setSubPackMetrics] = useState<SubscriptionPackMetrics | null>(null)\r\n  const [feeMetrics, setFeeMetrics] = useState<FeeMetrics | null>(null)\r\n\r\n  useEffect(() => {\r\n    async function fetchData() {\r\n      try {\r\n        const supabase = createClient()\r\n\r\n        // Fetch arranger entity info\r\n        const { data: arranger } = await supabase\r\n          .from('arranger_entities')\r\n          .select('id, legal_name, status, kyc_status')\r\n          .eq('id', arrangerId)\r\n          .maybeSingle()\r\n\r\n        if (arranger) {\r\n          setArrangerInfo({\r\n            legal_name: arranger.legal_name,\r\n            status: arranger.status,\r\n            kyc_status: arranger.kyc_status,\r\n          })\r\n        }\r\n\r\n        // VEHICLE-LEVEL ARCHITECTURE: Fetch vehicles assigned to this arranger first\r\n        const { data: arrangerVehicles } = await supabase\r\n          .from('vehicles')\r\n          .select('id, name, lawyer_id')\r\n          .eq('arranger_entity_id', arrangerId)\r\n\r\n        const vehicleIds = (arrangerVehicles || []).map((v: any) => v.id)\r\n\r\n        // Then fetch all deals under those vehicles (mandates)\r\n        let deals: any[] = []\r\n        if (vehicleIds.length > 0) {\r\n          const { data: vehicleDeals } = await supabase\r\n            .from('deals')\r\n            .select('id, name, status, target_amount, currency, created_at, vehicle_id')\r\n            .in('vehicle_id', vehicleIds)\r\n            .order('created_at', { ascending: false })\r\n          deals = vehicleDeals || []\r\n        }\r\n\r\n        const mandates = deals || []\r\n        // Deal statuses: draft, open, allocation_pending, closed, cancelled\r\n        const activeMandates = mandates.filter((d: any) => d.status === 'open' || d.status === 'allocation_pending')\r\n        const pendingMandates = mandates.filter((d: any) => d.status === 'draft')\r\n\r\n        setRecentMandates(mandates.slice(0, 5).map((d: any) => ({\r\n          id: d.id,\r\n          name: d.name,\r\n          status: d.status,\r\n          target_amount: d.target_amount,\r\n          currency: d.currency || 'USD',\r\n          created_at: d.created_at,\r\n        })))\r\n\r\n        // Get total commitment value from subscriptions on arranger's deals\r\n        const dealIds = mandates.map((d: any) => d.id)\r\n        let totalCommitment = 0\r\n\r\n        if (dealIds.length > 0) {\r\n          const { data: subscriptions } = await supabase\r\n            .from('subscriptions')\r\n            .select('commitment')\r\n            .in('deal_id', dealIds)\r\n            .in('status', ['committed', 'active', 'signed', 'funded'])\r\n\r\n          totalCommitment = (subscriptions || []).reduce(\r\n            (sum: number, s: any) => sum + (s.commitment || 0),\r\n            0\r\n          )\r\n        }\r\n\r\n        // Count related entities - SCOPED TO ARRANGER'S DEALS\r\n        let partnersCount = 0\r\n        let introducersCount = 0\r\n        let cpCount = 0\r\n\r\n        // VEHICLE-LEVEL: Lawyers are assigned to vehicles, count them regardless of deals\r\n        const uniqueLawyers = new Set(\r\n          (arrangerVehicles || [])\r\n            .filter((v: any) => v.lawyer_id)\r\n            .map((v: any) => v.lawyer_id)\r\n        )\r\n        const lawyersCount = uniqueLawyers.size\r\n\r\n        if (dealIds.length > 0) {\r\n          // Get subscriptions on arranger's deals for relationship tracking\r\n          const { data: dealSubscriptions } = await supabase\r\n            .from('subscriptions')\r\n            .select('id, investor_id, introducer_id, proxy_commercial_partner_id')\r\n            .in('deal_id', dealIds)\r\n\r\n          // Count unique introducers who have introduced to arranger's deals\r\n          const introducerIds = new Set(\r\n            (dealSubscriptions || [])\r\n              .filter((s: any) => s.introducer_id)\r\n              .map((s: any) => s.introducer_id)\r\n          )\r\n          introducersCount = introducerIds.size\r\n\r\n          // Count unique partners who have referred investors to arranger's deals\r\n          // Partners are tracked via deal_memberships.referred_by_entity_id (not subscriptions)\r\n          const { data: partnerReferrals } = await supabase\r\n            .from('deal_memberships')\r\n            .select('referred_by_entity_id')\r\n            .in('deal_id', dealIds)\r\n            .eq('referred_by_entity_type', 'partner')\r\n            .not('referred_by_entity_id', 'is', null)\r\n\r\n          const uniquePartnerIds = new Set(\r\n            (partnerReferrals || []).map((r: any) => r.referred_by_entity_id)\r\n          )\r\n          partnersCount = uniquePartnerIds.size\r\n\r\n          // Count unique commercial partners on arranger's deals (via subscriptions)\r\n          const cpIds = new Set(\r\n            (dealSubscriptions || [])\r\n              .filter((s: any) => s.proxy_commercial_partner_id)\r\n              .map((s: any) => s.proxy_commercial_partner_id)\r\n          )\r\n          cpCount = cpIds.size\r\n        }\r\n\r\n        // Fetch pending agreements (introducer and placement) - SCOPED TO THIS ARRANGER\r\n        const { data: introducerAgreements } = await supabase\r\n          .from('introducer_agreements')\r\n          .select(`\r\n            id,\r\n            status,\r\n            created_at,\r\n            introducers (id, display_name, legal_name)\r\n          `)\r\n          .eq('arranger_id', arrangerId)\r\n          .in('status', ['sent', 'pending_approval', 'approved', 'pending_ceo_signature', 'pending_introducer_signature'])\r\n          .order('created_at', { ascending: false })\r\n          .limit(5)\r\n\r\n        const { data: placementAgreements } = await supabase\r\n          .from('placement_agreements')\r\n          .select(`\r\n            id,\r\n            status,\r\n            created_at,\r\n            commercial_partners (id, display_name, legal_name)\r\n          `)\r\n          .eq('arranger_id', arrangerId)\r\n          .in('status', ['sent', 'pending_approval', 'approved', 'pending_ceo_signature', 'pending_cp_signature'])\r\n          .order('created_at', { ascending: false })\r\n          .limit(5)\r\n\r\n        const allPendingAgreements: PendingAgreement[] = []\r\n\r\n        ;(introducerAgreements || []).forEach((a: any) => {\r\n          const intro = Array.isArray(a.introducers) ? a.introducers[0] : a.introducers\r\n          allPendingAgreements.push({\r\n            id: a.id,\r\n            entity_name: intro?.display_name || intro?.legal_name || 'Unknown',\r\n            entity_type: 'introducer',\r\n            status: a.status,\r\n            created_at: a.created_at,\r\n          })\r\n        })\r\n\r\n        ;(placementAgreements || []).forEach((a: any) => {\r\n          const cp = Array.isArray(a.commercial_partners) ? a.commercial_partners[0] : a.commercial_partners\r\n          allPendingAgreements.push({\r\n            id: a.id,\r\n            entity_name: cp?.display_name || cp?.legal_name || 'Unknown',\r\n            entity_type: 'commercial_partner',\r\n            status: a.status,\r\n            created_at: a.created_at,\r\n          })\r\n        })\r\n\r\n        // Sort by created_at and take top 5\r\n        allPendingAgreements.sort((a, b) =>\r\n          new Date(b.created_at).getTime() - new Date(a.created_at).getTime()\r\n        )\r\n        setPendingAgreements(allPendingAgreements.slice(0, 5))\r\n\r\n        // ========== NEW METRICS: User Story Compliance ==========\r\n\r\n        // 1. ESCROW/FUNDING METRICS (User Story 2.5.2)\r\n        if (dealIds.length > 0) {\r\n          const { data: fundingData } = await supabase\r\n            .from('subscriptions')\r\n            .select('commitment, funded_amount, outstanding_amount, status, investor_id')\r\n            .in('deal_id', dealIds)\r\n            .in('status', ['committed', 'partially_funded', 'funded', 'active', 'signed'])\n\r\n          const totalExpected = (fundingData || []).reduce((sum: number, s: any) => sum + (s.commitment || 0), 0)\r\n          const totalFunded = (fundingData || []).reduce((sum: number, s: any) => sum + (s.funded_amount || 0), 0)\r\n          const totalOutstanding = (fundingData || []).reduce((sum: number, s: any) => sum + (s.outstanding_amount || 0), 0)\r\n          const pendingInvestors = (fundingData || []).filter((s: any) => (s.funded_amount || 0) < (s.commitment || 0)).length\r\n\r\n          setEscrowMetrics({\r\n            totalExpected,\r\n            totalFunded,\r\n            totalOutstanding,\r\n            fundingRate: totalExpected > 0 ? (totalFunded / totalExpected) * 100 : 0,\r\n            pendingInvestors,\r\n          })\r\n\r\n          // 2. SUBSCRIPTION PACK PIPELINE METRICS (User Story 2.6.1)\r\n          // Query documents with subscription pack type and their signature requests\r\n          const { data: subDocs } = await supabase\r\n            .from('documents')\r\n            .select(`\r\n              id,\r\n              subscription_id,\r\n              status,\r\n              ready_for_signature,\r\n              signature_requests(id, signer_role, status)\r\n            `)\r\n            .not('subscription_id', 'is', null)\r\n            .in('status', ['published', 'pending_signature'])\r\n\r\n          // Filter to only documents for this arranger's deals\r\n          // We need to check which subscriptions belong to this arranger's deals\r\n          const { data: arrangerSubscriptions } = await supabase\r\n            .from('subscriptions')\r\n            .select('id')\r\n            .in('deal_id', dealIds)\r\n\r\n          const arrangerSubIds = new Set((arrangerSubscriptions || []).map((s: any) => s.id))\r\n\r\n          // Filter documents to only those for arranger's subscriptions\r\n          const arrangerDocs = (subDocs || []).filter((doc: any) => arrangerSubIds.has(doc.subscription_id))\r\n\r\n          let awaitingInvestor = 0\r\n          let awaitingArranger = 0\r\n          let awaitingCEO = 0\r\n\r\n          arrangerDocs.forEach((doc: any) => {\r\n            if (doc.status !== 'pending_signature') return\r\n            const requests = doc.signature_requests || []\r\n            const hasPendingInvestor = requests.some((r: any) => r.signer_role === 'investor' && r.status === 'pending')\r\n            const hasPendingArranger = requests.some((r: any) => r.signer_role === 'arranger' && r.status === 'pending')\r\n            const hasPendingCEO = requests.some((r: any) => r.signer_role === 'admin' && r.status === 'pending')\r\n\r\n            if (hasPendingInvestor) awaitingInvestor++\r\n            if (hasPendingArranger) awaitingArranger++\r\n            if (hasPendingCEO) awaitingCEO++\r\n          })\r\n\r\n          // Get signed this month count\r\n          const startOfMonth = new Date()\r\n          startOfMonth.setDate(1)\r\n          startOfMonth.setHours(0, 0, 0, 0)\r\n\r\n          const { count: signedThisMonth } = await supabase\r\n            .from('subscriptions')\r\n            .select('id', { count: 'exact', head: true })\r\n            .in('deal_id', dealIds)\r\n            .not('signed_at', 'is', null)\r\n            .gte('signed_at', startOfMonth.toISOString())\r\n\r\n          setSubPackMetrics({\r\n            awaitingInvestorSignature: awaitingInvestor,\r\n            awaitingArrangerSignature: awaitingArranger,\r\n            awaitingCEOSignature: awaitingCEO,\r\n            signedThisMonth: signedThisMonth || 0,\r\n            totalPending: awaitingInvestor + awaitingArranger + awaitingCEO,\r\n          })\r\n        } else {\r\n          // No deals - set empty metrics\r\n          setEscrowMetrics({\r\n            totalExpected: 0,\r\n            totalFunded: 0,\r\n            totalOutstanding: 0,\r\n            fundingRate: 0,\r\n            pendingInvestors: 0,\r\n          })\r\n          setSubPackMetrics({\r\n            awaitingInvestorSignature: 0,\r\n            awaitingArrangerSignature: 0,\r\n            awaitingCEOSignature: 0,\r\n            signedThisMonth: 0,\r\n            totalPending: 0,\r\n          })\r\n        }\r\n\r\n        // 3. FEE METRICS (User Story 2.2.4, 2.3.4, 2.4.4)\r\n        const { data: feeData } = await supabase\r\n          .from('fee_events')\r\n          .select('computed_amount, status')\r\n          .eq('payee_arranger_id', arrangerId)\r\n\r\n        const validFees = (feeData || []).filter((f: any) => f.status !== 'voided' && f.status !== 'cancelled')\r\n        const totalAccrued = validFees.filter((f: any) => f.status === 'accrued').reduce((s: number, f: any) => s + (f.computed_amount || 0), 0)\r\n        const totalInvoiced = validFees.filter((f: any) => f.status === 'invoiced').reduce((s: number, f: any) => s + (f.computed_amount || 0), 0)\r\n        const totalPaid = validFees.filter((f: any) => f.status === 'paid').reduce((s: number, f: any) => s + (f.computed_amount || 0), 0)\r\n\r\n        setFeeMetrics({\r\n          totalAccrued,\r\n          totalInvoiced,\r\n          totalPaid,\r\n          feePipeline: totalAccrued + totalInvoiced,\r\n        })\r\n\r\n        // ========== END NEW METRICS ==========\r\n\r\n        setMetrics({\r\n          totalMandates: mandates.length,\r\n          activeMandates: activeMandates.length,\r\n          pendingMandates: pendingMandates.length,\r\n          totalPartners: partnersCount || 0,\r\n          totalIntroducers: introducersCount || 0,\r\n          totalCommercialPartners: cpCount || 0,\r\n          totalLawyers: lawyersCount,\r\n          pendingAgreements: allPendingAgreements.length,\r\n          totalCommitmentValue: totalCommitment,\r\n        })\r\n      } catch (error) {\r\n        console.error('Error fetching arranger data:', error)\r\n      } finally {\r\n        setLoading(false)\r\n      }\r\n    }\r\n\r\n    fetchData()\r\n  }, [arrangerId])\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"p-8 text-center flex flex-col items-center gap-3\">\r\n        <Loader2 className=\"h-8 w-8 animate-spin text-gray-400\" />\r\n        <p className=\"text-gray-500\">Loading dashboard...</p>\r\n      </div>\r\n    )\r\n  }\r\n\r\n  // Deal status enum: draft, open, allocation_pending, closed, cancelled\r\n  const dealStatusStyles: Record<string, string> = {\r\n    draft: 'bg-gray-500/20 text-gray-400',\r\n    open: 'bg-green-500/20 text-green-400',\r\n    allocation_pending: 'bg-amber-500/20 text-amber-400',\r\n    closed: 'bg-purple-500/20 text-purple-400',\r\n    cancelled: 'bg-red-500/20 text-red-400',\r\n  }\r\n\r\n  const agreementStatusStyles: Record<string, string> = {\r\n    sent: 'bg-blue-500/20 text-blue-400',\r\n    pending_approval: 'bg-amber-500/20 text-amber-400',\r\n    approved: 'bg-green-500/20 text-green-400',\r\n    pending_ceo_signature: 'bg-purple-500/20 text-purple-400',\r\n    pending_introducer_signature: 'bg-indigo-500/20 text-indigo-400',\r\n    pending_cp_signature: 'bg-indigo-500/20 text-indigo-400',\r\n  }\r\n\r\n  const agreementStatusLabels: Record<string, string> = {\r\n    sent: 'Sent',\r\n    pending_approval: 'Pending Approval',\r\n    approved: 'Approved',\r\n    pending_ceo_signature: 'Awaiting CEO Signature',\r\n    pending_introducer_signature: 'Awaiting Signature',\r\n    pending_cp_signature: 'Awaiting Signature',\r\n  }\r\n\r\n  return (\r\n    <div className=\"p-6 space-y-6\">\r\n      {/* Header */}\r\n      <div className=\"flex items-center justify-between\">\r\n        <div>\r\n          <h1 className={`text-2xl font-bold ${isDark ? 'text-white' : 'text-gray-900'}`}>\r\n            Arranger Dashboard\r\n          </h1>\r\n          <p className={`mt-1 ${isDark ? 'text-gray-400' : 'text-gray-600'}`}>\r\n            {arrangerInfo?.legal_name || persona.entity_name}\r\n          </p>\r\n        </div>\r\n        {arrangerInfo?.kyc_status && (\r\n          <Badge\r\n            variant=\"outline\"\r\n            className={\r\n              arrangerInfo.kyc_status === 'approved'\r\n                ? 'border-green-500/50 text-green-500'\r\n                : arrangerInfo.kyc_status === 'pending'\r\n                ? 'border-amber-500/50 text-amber-500'\r\n                : 'border-gray-500/50 text-gray-500'\r\n            }\r\n          >\r\n            KYC: {arrangerInfo.kyc_status}\r\n          </Badge>\r\n        )}\r\n      </div>\r\n\r\n      {/* Alert for inactive/pending arranger */}\r\n      {arrangerInfo && arrangerInfo.status !== 'active' && (\r\n        <Card className={`border-amber-500/30 ${isDark ? 'bg-amber-500/10' : 'bg-amber-50'}`}>\r\n          <CardContent className=\"py-4\">\r\n            <div className=\"flex items-center gap-3\">\r\n              <div className=\"p-2 rounded-full bg-amber-500/20\">\r\n                <AlertCircle className=\"h-5 w-5 text-amber-500\" />\r\n              </div>\r\n              <div>\r\n                <p className={`font-medium ${isDark ? 'text-white' : 'text-gray-900'}`}>\r\n                  Account {arrangerInfo.status === 'pending' ? 'Pending Approval' : 'Inactive'}\r\n                </p>\r\n                <p className={`text-sm ${isDark ? 'text-gray-400' : 'text-gray-600'}`}>\r\n                  {arrangerInfo.status === 'pending'\r\n                    ? 'Your arranger account is pending approval. Contact the VERSO team for status updates.'\r\n                    : 'Your arranger account is currently inactive. Contact the VERSO team for assistance.'}\r\n                </p>\r\n              </div>\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n      )}\r\n\r\n      {/* Pending Agreements Alert */}\r\n      {metrics && metrics.pendingAgreements > 0 && (\r\n        <Card className={`border-blue-500/30 ${isDark ? 'bg-blue-500/10' : 'bg-blue-50'}`}>\r\n          <CardContent className=\"py-4\">\r\n            <div className=\"flex items-center justify-between\">\r\n              <div className=\"flex items-center gap-3\">\r\n                <div className=\"p-2 rounded-full bg-blue-500/20\">\r\n                  <FileSignature className=\"h-5 w-5 text-blue-500\" />\r\n                </div>\r\n                <div>\r\n                  <p className={`font-medium ${isDark ? 'text-white' : 'text-gray-900'}`}>\r\n                    {metrics.pendingAgreements} Pending Agreement{metrics.pendingAgreements !== 1 ? 's' : ''}\r\n                  </p>\r\n                  <p className={`text-sm ${isDark ? 'text-gray-400' : 'text-gray-600'}`}>\r\n                    Agreements awaiting approval or signature\r\n                  </p>\r\n                </div>\r\n              </div>\r\n              <Button asChild>\r\n                <Link href=\"/versotech_main/versosign\">\r\n                  View in VERSOSign\r\n                  <ArrowRight className=\"h-4 w-4 ml-2\" />\r\n                </Link>\r\n              </Button>\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n      )}\r\n\r\n      {/* Onboarding Checklist - Show when KYC not approved */}\r\n      {arrangerInfo?.kyc_status !== 'approved' && (\r\n        <ArrangerOnboardingChecklist arrangerId={arrangerId} compact />\r\n      )}\r\n\r\n      {/* Metrics Grid */}\r\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\r\n        <Card className={isDark ? 'bg-white/5 border-white/10' : ''}>\r\n          <CardHeader className=\"flex flex-row items-center justify-between pb-2\">\r\n            <CardTitle className={`text-sm font-medium ${isDark ? 'text-gray-400' : 'text-gray-500'}`}>\r\n              Total Mandates\r\n            </CardTitle>\r\n            <Briefcase className={`h-4 w-4 ${isDark ? 'text-gray-500' : 'text-gray-400'}`} />\r\n          </CardHeader>\r\n          <CardContent>\r\n            <div className={`text-2xl font-bold ${isDark ? 'text-white' : 'text-gray-900'}`}>\r\n              {metrics?.totalMandates || 0}\r\n            </div>\r\n            <p className={`text-xs ${isDark ? 'text-gray-500' : 'text-gray-500'}`}>\r\n              {metrics?.activeMandates || 0} active, {metrics?.pendingMandates || 0} pending\r\n            </p>\r\n          </CardContent>\r\n        </Card>\r\n\r\n        <Card className={isDark ? 'bg-white/5 border-white/10' : ''}>\r\n          <CardHeader className=\"flex flex-row items-center justify-between pb-2\">\r\n            <CardTitle className={`text-sm font-medium ${isDark ? 'text-gray-400' : 'text-gray-500'}`}>\r\n              Active Network\r\n            </CardTitle>\r\n            <Users className={`h-4 w-4 ${isDark ? 'text-gray-500' : 'text-gray-400'}`} />\r\n          </CardHeader>\r\n          <CardContent>\r\n            <div className={`text-2xl font-bold ${isDark ? 'text-white' : 'text-gray-900'}`}>\r\n              {(metrics?.totalPartners || 0) + (metrics?.totalIntroducers || 0) + (metrics?.totalCommercialPartners || 0)}\r\n            </div>\r\n            <p className={`text-xs ${isDark ? 'text-gray-500' : 'text-gray-500'}`}>\r\n              On your mandates\r\n            </p>\r\n          </CardContent>\r\n        </Card>\r\n\r\n        <Card className={isDark ? 'bg-white/5 border-white/10' : ''}>\r\n          <CardHeader className=\"flex flex-row items-center justify-between pb-2\">\r\n            <CardTitle className={`text-sm font-medium ${isDark ? 'text-gray-400' : 'text-gray-500'}`}>\r\n              Total Commitment\r\n            </CardTitle>\r\n            <DollarSign className={`h-4 w-4 ${isDark ? 'text-gray-500' : 'text-gray-400'}`} />\r\n          </CardHeader>\r\n          <CardContent>\r\n            <div className={`text-2xl font-bold text-green-500`}>\r\n              {formatCurrency(metrics?.totalCommitmentValue || 0)}\r\n            </div>\r\n            <p className={`text-xs ${isDark ? 'text-gray-500' : 'text-gray-500'}`}>\r\n              Across all mandates\r\n            </p>\r\n          </CardContent>\r\n        </Card>\r\n\r\n        <Card className={isDark ? 'bg-white/5 border-white/10' : ''}>\r\n          <CardHeader className=\"flex flex-row items-center justify-between pb-2\">\r\n            <CardTitle className={`text-sm font-medium ${isDark ? 'text-gray-400' : 'text-gray-500'}`}>\r\n              Assigned Lawyers\r\n            </CardTitle>\r\n            <Scale className={`h-4 w-4 ${isDark ? 'text-gray-500' : 'text-gray-400'}`} />\r\n          </CardHeader>\r\n          <CardContent>\r\n            <div className={`text-2xl font-bold ${isDark ? 'text-white' : 'text-gray-900'}`}>\r\n              {metrics?.totalLawyers || 0}\r\n            </div>\r\n            <p className={`text-xs ${isDark ? 'text-gray-500' : 'text-gray-500'}`}>\r\n              On your mandates\r\n            </p>\r\n          </CardContent>\r\n        </Card>\r\n      </div>\r\n\r\n      {/* NEW: Escrow & Fee Metrics Row (User Story 2.5.2, 2.2.4/2.3.4/2.4.4) */}\r\n      <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n        {/* Escrow Funding Status Card */}\r\n        <Card className={isDark ? 'bg-white/5 border-white/10' : ''}>\r\n          <CardHeader className=\"flex flex-row items-center justify-between pb-2\">\r\n            <CardTitle className={`text-sm font-medium ${isDark ? 'text-gray-400' : 'text-gray-500'}`}>\r\n              Escrow Funding Status\r\n            </CardTitle>\r\n            <Wallet className={`h-4 w-4 ${isDark ? 'text-gray-500' : 'text-gray-400'}`} />\r\n          </CardHeader>\r\n          <CardContent>\r\n            <div className={`text-2xl font-bold ${(escrowMetrics?.fundingRate || 0) >= 75 ? 'text-green-500' : 'text-amber-500'}`}>\r\n              {(escrowMetrics?.fundingRate || 0).toFixed(0)}% Funded\r\n            </div>\r\n            <p className={`text-xs ${isDark ? 'text-gray-500' : 'text-gray-500'}`}>\r\n              {formatCurrency(escrowMetrics?.totalFunded || 0)} of {formatCurrency(escrowMetrics?.totalExpected || 0)}\r\n            </p>\r\n            {/* Progress bar */}\r\n            <div className={`mt-2 h-2 ${isDark ? 'bg-gray-700' : 'bg-gray-200'} rounded-full overflow-hidden`}>\r\n              <div\r\n                className=\"h-full bg-green-500 transition-all duration-300\"\r\n                style={{ width: `${Math.min(escrowMetrics?.fundingRate || 0, 100)}%` }}\r\n              />\r\n            </div>\r\n            {(escrowMetrics?.pendingInvestors || 0) > 0 && (\r\n              <p className=\"text-xs text-amber-400 mt-2\">\r\n                {escrowMetrics?.pendingInvestors} investor(s) pending funding\r\n              </p>\r\n            )}\r\n            <div className=\"mt-3 pt-3 border-t border-gray-700/50 flex justify-between text-xs\">\r\n              <span className={isDark ? 'text-gray-400' : 'text-gray-500'}>Outstanding:</span>\r\n              <span className=\"text-amber-400 font-medium\">{formatCurrency(escrowMetrics?.totalOutstanding || 0)}</span>\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n\r\n        {/* Fee Pipeline Card */}\r\n        <Card className={isDark ? 'bg-white/5 border-white/10' : ''}>\r\n          <CardHeader className=\"flex flex-row items-center justify-between pb-2\">\r\n            <CardTitle className={`text-sm font-medium ${isDark ? 'text-gray-400' : 'text-gray-500'}`}>\r\n              Fee Pipeline\r\n            </CardTitle>\r\n            <Receipt className={`h-4 w-4 ${isDark ? 'text-gray-500' : 'text-gray-400'}`} />\r\n          </CardHeader>\r\n          <CardContent>\r\n            <div className=\"text-2xl font-bold text-green-500\">\r\n              {formatCurrency(feeMetrics?.feePipeline || 0)}\r\n            </div>\r\n            <p className={`text-xs ${isDark ? 'text-gray-500' : 'text-gray-500'}`}>\r\n              Pending collection\r\n            </p>\r\n            <div className=\"mt-3 space-y-2 text-xs\">\r\n              <div className=\"flex justify-between items-center\">\r\n                <span className={isDark ? 'text-gray-400' : 'text-gray-500'}>Accrued:</span>\r\n                <span className=\"text-amber-400 font-medium\">{formatCurrency(feeMetrics?.totalAccrued || 0)}</span>\r\n              </div>\r\n              <div className=\"flex justify-between items-center\">\r\n                <span className={isDark ? 'text-gray-400' : 'text-gray-500'}>Invoiced:</span>\r\n                <span className=\"text-blue-400 font-medium\">{formatCurrency(feeMetrics?.totalInvoiced || 0)}</span>\r\n              </div>\r\n              <div className=\"flex justify-between items-center pt-2 border-t border-gray-700/50\">\r\n                <span className={isDark ? 'text-gray-400' : 'text-gray-500'}>Total Paid:</span>\r\n                <span className=\"text-green-400 font-medium\">{formatCurrency(feeMetrics?.totalPaid || 0)}</span>\r\n              </div>\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n      </div>\r\n\r\n      {/* NEW: Subscription Pack Pipeline (User Story 2.6.1) */}\r\n      <Card className={isDark ? 'bg-white/5 border-white/10' : ''}>\r\n        <CardHeader>\r\n          <CardTitle className={isDark ? 'text-white' : ''}>Subscription Pack Pipeline</CardTitle>\r\n          <CardDescription>Document signing status across your mandates</CardDescription>\r\n        </CardHeader>\r\n        <CardContent>\r\n          <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\r\n            <div className={`text-center p-4 rounded-lg ${isDark ? 'bg-amber-500/10' : 'bg-amber-50'}`}>\r\n              <p className=\"text-2xl font-bold text-amber-500\">{subPackMetrics?.awaitingInvestorSignature || 0}</p>\r\n              <p className={`text-xs ${isDark ? 'text-gray-400' : 'text-gray-500'}`}>Awaiting Investor</p>\r\n            </div>\r\n            <div className={`text-center p-4 rounded-lg ${isDark ? 'bg-purple-500/10' : 'bg-purple-50'}`}>\r\n              <p className=\"text-2xl font-bold text-purple-500\">{subPackMetrics?.awaitingArrangerSignature || 0}</p>\r\n              <p className={`text-xs ${isDark ? 'text-gray-400' : 'text-gray-500'}`}>Awaiting Your Signature</p>\r\n            </div>\r\n            <div className={`text-center p-4 rounded-lg ${isDark ? 'bg-blue-500/10' : 'bg-blue-50'}`}>\r\n              <p className=\"text-2xl font-bold text-blue-500\">{subPackMetrics?.awaitingCEOSignature || 0}</p>\r\n              <p className={`text-xs ${isDark ? 'text-gray-400' : 'text-gray-500'}`}>Awaiting CEO</p>\r\n            </div>\r\n            <div className={`text-center p-4 rounded-lg ${isDark ? 'bg-green-500/10' : 'bg-green-50'}`}>\r\n              <p className=\"text-2xl font-bold text-green-500\">{subPackMetrics?.signedThisMonth || 0}</p>\r\n              <p className={`text-xs ${isDark ? 'text-gray-400' : 'text-gray-500'}`}>Signed This Month</p>\r\n            </div>\r\n          </div>\r\n          {/* Action alert if arranger has docs to sign */}\r\n          {(subPackMetrics?.awaitingArrangerSignature || 0) > 0 && (\r\n            <Alert className={`mt-4 border-purple-500/30 ${isDark ? 'bg-purple-500/10' : 'bg-purple-50'}`}>\r\n              <FileSignature className=\"h-4 w-4 text-purple-500\" />\r\n              <AlertDescription className={`flex items-center justify-between ${isDark ? 'text-gray-300' : 'text-gray-700'}`}>\r\n                <span>You have {subPackMetrics?.awaitingArrangerSignature} document(s) awaiting your signature.</span>\r\n                <Button variant=\"link\" asChild className=\"p-0 h-auto text-purple-500\">\r\n                  <Link href=\"/versotech_main/versosign\">Sign Now →</Link>\r\n                </Button>\r\n              </AlertDescription>\r\n            </Alert>\r\n          )}\r\n        </CardContent>\r\n      </Card>\r\n\r\n      {/* Entity Breakdown */}\r\n      <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\r\n        <Card className={isDark ? 'bg-white/5 border-white/10' : ''}>\r\n          <CardContent className=\"pt-6\">\r\n            <div className=\"flex items-center gap-4\">\r\n              <div className=\"p-3 rounded-full bg-pink-500/20\">\r\n                <Users className=\"h-6 w-6 text-pink-500\" />\r\n              </div>\r\n              <div>\r\n                <p className={`text-2xl font-bold ${isDark ? 'text-white' : 'text-gray-900'}`}>\r\n                  {metrics?.totalPartners || 0}\r\n                </p>\r\n                <p className={`text-sm ${isDark ? 'text-gray-400' : 'text-gray-500'}`}>Partners</p>\r\n              </div>\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n\r\n        <Card className={isDark ? 'bg-white/5 border-white/10' : ''}>\r\n          <CardContent className=\"pt-6\">\r\n            <div className=\"flex items-center gap-4\">\r\n              <div className=\"p-3 rounded-full bg-orange-500/20\">\r\n                <UserPlus className=\"h-6 w-6 text-orange-500\" />\r\n              </div>\r\n              <div>\r\n                <p className={`text-2xl font-bold ${isDark ? 'text-white' : 'text-gray-900'}`}>\r\n                  {metrics?.totalIntroducers || 0}\r\n                </p>\r\n                <p className={`text-sm ${isDark ? 'text-gray-400' : 'text-gray-500'}`}>Introducers</p>\r\n              </div>\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n\r\n        <Card className={isDark ? 'bg-white/5 border-white/10' : ''}>\r\n          <CardContent className=\"pt-6\">\r\n            <div className=\"flex items-center gap-4\">\r\n              <div className=\"p-3 rounded-full bg-cyan-500/20\">\r\n                <Building2 className=\"h-6 w-6 text-cyan-500\" />\r\n              </div>\r\n              <div>\r\n                <p className={`text-2xl font-bold ${isDark ? 'text-white' : 'text-gray-900'}`}>\r\n                  {metrics?.totalCommercialPartners || 0}\r\n                </p>\r\n                <p className={`text-sm ${isDark ? 'text-gray-400' : 'text-gray-500'}`}>Commercial Partners</p>\r\n              </div>\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n      </div>\r\n\r\n      {/* Two Column Layout */}\r\n      <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\r\n        {/* Recent Mandates */}\r\n        <Card className={isDark ? 'bg-white/5 border-white/10' : ''}>\r\n          <CardHeader className=\"flex flex-row items-center justify-between\">\r\n            <div>\r\n              <CardTitle className={isDark ? 'text-white' : ''}>Recent Mandates</CardTitle>\r\n              <CardDescription>Your managed deals</CardDescription>\r\n            </div>\r\n            <Button variant=\"ghost\" size=\"sm\" asChild>\r\n              <Link href=\"/versotech_main/my-mandates\">\r\n                View All\r\n                <ArrowRight className=\"h-4 w-4 ml-1\" />\r\n              </Link>\r\n            </Button>\r\n          </CardHeader>\r\n          <CardContent>\r\n            {recentMandates.length === 0 ? (\r\n              <div className=\"text-center py-8\">\r\n                <Briefcase className={`h-10 w-10 mx-auto mb-3 ${isDark ? 'text-gray-600' : 'text-gray-400'}`} />\r\n                <p className={`text-sm ${isDark ? 'text-gray-400' : 'text-gray-500'}`}>\r\n                  No mandates assigned yet\r\n                </p>\r\n                <p className={`text-xs ${isDark ? 'text-gray-500' : 'text-gray-400'} mt-1`}>\r\n                  Contact the VERSO team to be assigned mandates\r\n                </p>\r\n              </div>\r\n            ) : (\r\n              <div className=\"space-y-3\">\r\n                {recentMandates.map((mandate) => (\r\n                  <Link\r\n                    key={mandate.id}\r\n                    href={`/versotech_main/my-mandates`}\r\n                    className={`flex items-center justify-between p-3 rounded-lg transition-colors ${\r\n                      isDark ? 'bg-white/5 hover:bg-white/10' : 'bg-gray-50 hover:bg-gray-100'\r\n                    }`}\r\n                  >\r\n                    <div className=\"flex-1 min-w-0\">\r\n                      <p className={`font-medium truncate ${isDark ? 'text-white' : 'text-gray-900'}`}>\r\n                        {mandate.name}\r\n                      </p>\r\n                      <p className={`text-sm ${isDark ? 'text-gray-400' : 'text-gray-500'}`}>\r\n                        {mandate.target_amount\r\n                          ? `${formatCurrency(mandate.target_amount, mandate.currency)} target`\r\n                          : 'No target set'}\r\n                      </p>\r\n                    </div>\r\n                    <Badge className={dealStatusStyles[mandate.status] || 'bg-gray-500/20 text-gray-400'}>\r\n                      {mandate.status}\r\n                    </Badge>\r\n                  </Link>\r\n                ))}\r\n              </div>\r\n            )}\r\n          </CardContent>\r\n        </Card>\r\n\r\n        {/* Pending Agreements */}\r\n        <Card className={isDark ? 'bg-white/5 border-white/10' : ''}>\r\n          <CardHeader className=\"flex flex-row items-center justify-between\">\r\n            <div>\r\n              <CardTitle className={isDark ? 'text-white' : ''}>Pending Agreements</CardTitle>\r\n              <CardDescription>Agreements awaiting action</CardDescription>\r\n            </div>\r\n            <Button variant=\"ghost\" size=\"sm\" asChild>\r\n              <Link href=\"/versotech_main/versosign\">\r\n                View All\r\n                <ArrowRight className=\"h-4 w-4 ml-1\" />\r\n              </Link>\r\n            </Button>\r\n          </CardHeader>\r\n          <CardContent>\r\n            {pendingAgreements.length === 0 ? (\r\n              <div className=\"text-center py-8\">\r\n                <FileSignature className={`h-10 w-10 mx-auto mb-3 ${isDark ? 'text-gray-600' : 'text-gray-400'}`} />\r\n                <p className={`text-sm ${isDark ? 'text-gray-400' : 'text-gray-500'}`}>\r\n                  No pending agreements\r\n                </p>\r\n                <p className={`text-xs ${isDark ? 'text-gray-500' : 'text-gray-400'} mt-1`}>\r\n                  All agreements are up to date\r\n                </p>\r\n              </div>\r\n            ) : (\r\n              <div className=\"space-y-3\">\r\n                {pendingAgreements.map((agreement) => (\r\n                  <div\r\n                    key={agreement.id}\r\n                    className={`flex items-center justify-between p-3 rounded-lg ${\r\n                      isDark ? 'bg-white/5' : 'bg-gray-50'\r\n                    }`}\r\n                  >\r\n                    <div className=\"flex-1 min-w-0\">\r\n                      <p className={`font-medium truncate ${isDark ? 'text-white' : 'text-gray-900'}`}>\r\n                        {agreement.entity_name}\r\n                      </p>\r\n                      <p className={`text-sm ${isDark ? 'text-gray-400' : 'text-gray-500'}`}>\r\n                        {agreement.entity_type === 'introducer' ? 'Introducer Agreement' : 'Placement Agreement'}\r\n                      </p>\r\n                    </div>\r\n                    <Badge className={agreementStatusStyles[agreement.status] || 'bg-gray-500/20 text-gray-400'}>\r\n                      {agreementStatusLabels[agreement.status] || agreement.status}\r\n                    </Badge>\r\n                  </div>\r\n                ))}\r\n              </div>\r\n            )}\r\n          </CardContent>\r\n        </Card>\r\n      </div>\r\n\r\n      {/* Quick Actions */}\r\n      <Card className={isDark ? 'bg-white/5 border-white/10' : ''}>\r\n        <CardHeader>\r\n          <CardTitle className={isDark ? 'text-white' : ''}>Quick Actions</CardTitle>\r\n          <CardDescription>Common tasks and workflows</CardDescription>\r\n        </CardHeader>\r\n        <CardContent>\r\n          <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\r\n            <Button variant=\"outline\" asChild className=\"h-auto py-4 flex-col gap-2\">\r\n              <Link href=\"/versotech_main/my-mandates\">\r\n                <Briefcase className=\"h-5 w-5\" />\r\n                <span>View Mandates</span>\r\n              </Link>\r\n            </Button>\r\n            <Button variant=\"outline\" asChild className=\"h-auto py-4 flex-col gap-2\">\r\n              <Link href=\"/versotech_main/my-partners\">\r\n                <Users className=\"h-5 w-5\" />\r\n                <span>My Partners</span>\r\n              </Link>\r\n            </Button>\r\n            <Button variant=\"outline\" asChild className=\"h-auto py-4 flex-col gap-2\">\r\n              <Link href=\"/versotech_main/my-introducers\">\r\n                <UserPlus className=\"h-5 w-5\" />\r\n                <span>My Introducers</span>\r\n              </Link>\r\n            </Button>\r\n            <Button variant=\"outline\" asChild className=\"h-auto py-4 flex-col gap-2\">\r\n              <Link href=\"/versotech_main/versosign\">\r\n                <FileSignature className=\"h-5 w-5\" />\r\n                <span>VERSOSign</span>\r\n              </Link>\r\n            </Button>\r\n          </div>\r\n        </CardContent>\r\n      </Card>\r\n    </div>\r\n  )\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 7142, "column": 0}, "map": {"version":3,"sources":["file:///Users/ghilesmoussaoui/Desktop/Versotech/versotech-portal/src/app/%28main%29/versotech_main/dashboard/commercial-partner-dashboard.tsx"],"sourcesContent":["'use client'\r\n\r\nimport { useEffect, useState } from 'react'\r\nimport Link from 'next/link'\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card'\r\nimport { Badge } from '@/components/ui/badge'\r\nimport { Button } from '@/components/ui/button'\r\nimport {\r\n  Building2,\r\n  Users,\r\n  FileText,\r\n  DollarSign,\r\n  Clock,\r\n  CheckCircle2,\r\n  ArrowRight,\r\n  Loader2,\r\n  AlertCircle,\r\n  TrendingUp,\r\n  FileSignature,\r\n  Briefcase,\r\n  UserCheck,\r\n  Eye,\r\n  PenTool,\r\n} from 'lucide-react'\r\nimport { createClient } from '@/lib/supabase/client'\r\nimport { formatCurrency, formatDate } from '@/lib/format'\r\nimport { useTheme } from '@/components/theme-provider'\r\n\r\ntype Persona = {\r\n  persona_type: string\r\n  entity_id: string\r\n  entity_name: string\r\n  role_in_entity?: string | null\r\n  can_sign?: boolean\r\n  can_execute_for_clients?: boolean\r\n  logo_url?: string | null\r\n}\r\n\r\ninterface CommercialPartnerDashboardProps {\r\n  commercialPartnerId: string\r\n  userId: string\r\n  persona: Persona\r\n}\r\n\r\ntype CPMetrics = {\r\n  totalClients: number\r\n  activeClients: number\r\n  dispatchedDeals: number\r\n  activeOpportunities: number\r\n  totalSubscriptions: number\r\n  pendingSubscriptions: number\r\n  ownInvestmentValue: number\r\n  clientInvestmentValue: number\r\n  pendingAgreements: number\r\n  activeAgreements: number\r\n  // Commission aggregations from commercial_partner_commissions\r\n  commissionPaid: number\r\n  commissionAccrued: number\r\n  commissionPending: number\r\n}\r\n\r\ntype RecentSubscription = {\r\n  id: string\r\n  deal_name: string\r\n  investor_name: string\r\n  commitment: number\r\n  status: string\r\n  created_at: string\r\n  is_proxy: boolean\r\n}\r\n\r\ntype PlacementAgreement = {\r\n  id: string\r\n  agreement_type: string\r\n  status: string\r\n  default_commission_bps: number\r\n  created_at: string\r\n}\r\n\r\nexport function CommercialPartnerDashboard({ commercialPartnerId, userId, persona }: CommercialPartnerDashboardProps) {\r\n  const { theme } = useTheme()\r\n  const isDark = theme === 'staff-dark'\r\n\r\n  const [loading, setLoading] = useState(true)\r\n  const [metrics, setMetrics] = useState<CPMetrics | null>(null)\r\n  const [cpInfo, setCpInfo] = useState<{\r\n    name: string\r\n    legal_name: string\r\n    status: string\r\n    kyc_status: string | null\r\n    cp_type: string\r\n  } | null>(null)\r\n  const [recentSubscriptions, setRecentSubscriptions] = useState<RecentSubscription[]>([])\r\n  const [placementAgreements, setPlacementAgreements] = useState<PlacementAgreement[]>([])\r\n  const [canExecuteForClients, setCanExecuteForClients] = useState(false)\r\n\r\n  useEffect(() => {\r\n    async function fetchData() {\r\n      try {\r\n        const supabase = createClient()\r\n\r\n        // Fetch commercial partner entity info\r\n        const { data: cp } = await supabase\r\n          .from('commercial_partners')\r\n          .select('id, name, legal_name, status, kyc_status, cp_type')\r\n          .eq('id', commercialPartnerId)\r\n          .maybeSingle()\r\n\r\n        if (cp) {\r\n          setCpInfo({\r\n            name: cp.name,\r\n            legal_name: cp.legal_name,\r\n            status: cp.status,\r\n            kyc_status: cp.kyc_status,\r\n            cp_type: cp.cp_type,\r\n          })\r\n        }\r\n\r\n        // Check if user can execute for clients\r\n        const { data: cpUser } = await supabase\r\n          .from('commercial_partner_users')\r\n          .select('can_execute_for_clients')\r\n          .eq('commercial_partner_id', commercialPartnerId)\r\n          .eq('user_id', userId)\r\n          .maybeSingle()\r\n\r\n        setCanExecuteForClients(cpUser?.can_execute_for_clients || false)\r\n\r\n        // Fetch clients from commercial_partner_clients table\r\n        const { data: clients, count: clientCount } = await supabase\r\n          .from('commercial_partner_clients')\r\n          .select('id, is_active, client_investor_id', { count: 'exact' })\r\n          .eq('commercial_partner_id', commercialPartnerId)\r\n\r\n        const totalClients = clientCount || 0\r\n        const activeClients = (clients || []).filter((c: any) => c.is_active).length\r\n\r\n        // Get client investor IDs for subscription queries\r\n        const clientInvestorIds = (clients || [])\r\n          .filter((c: any) => c.client_investor_id)\r\n          .map((c: any) => c.client_investor_id)\r\n\r\n        // Get user's investor link (for MODE 1 - direct investment)\r\n        const { data: investorLinks } = await supabase\r\n          .from('investor_users')\r\n          .select('investor_id')\r\n          .eq('user_id', userId)\r\n\r\n        const ownInvestorIds = (investorLinks || []).map((l: any) => l.investor_id)\r\n\r\n        // Fetch dispatched deals - deals where CP is dispatched\r\n        const { data: dealMemberships } = await supabase\r\n          .from('deal_memberships')\r\n          .select('deal_id, role')\r\n          .eq('user_id', userId)\r\n          .in('role', ['commercial_partner_investor', 'commercial_partner_proxy'])\r\n\r\n        const dispatchedDeals = (dealMemberships || []).length\r\n        const dispatchedDealIds = (dealMemberships || []).map((dm: any) => dm.deal_id)\r\n\r\n        // Count active opportunities (deals with status open/allocation_pending that CP is dispatched to)\r\n        let activeOpportunities = 0\r\n        if (dispatchedDealIds.length > 0) {\r\n          const { count: activeDealsCount } = await supabase\r\n            .from('deals')\r\n            .select('id', { count: 'exact', head: true })\r\n            .in('id', dispatchedDealIds)\r\n            .in('status', ['open', 'allocation_pending', 'active'])\r\n\r\n          activeOpportunities = activeDealsCount || 0\r\n        }\r\n\r\n        // Fetch subscriptions - both own investments (MODE 1) and client subscriptions (MODE 2)\r\n        let ownInvestmentValue = 0\r\n        let clientInvestmentValue = 0\r\n        let totalSubscriptions = 0\r\n        let pendingSubscriptions = 0\r\n        const allSubscriptions: RecentSubscription[] = []\r\n\r\n        // MODE 1 - Own investments\r\n        if (ownInvestorIds.length > 0) {\r\n          const { data: ownSubs } = await supabase\r\n            .from('subscriptions')\r\n            .select(`\r\n              id, commitment, status, created_at,\r\n              deals (id, name),\r\n              investors (id, legal_name)\r\n            `)\r\n            .in('investor_id', ownInvestorIds)\r\n            .order('created_at', { ascending: false })\r\n            .limit(10)\r\n\r\n          ;(ownSubs || []).forEach((sub: any) => {\r\n            if (['committed', 'active', 'signed', 'funded'].includes(sub.status)) {\r\n              ownInvestmentValue += sub.commitment || 0\r\n            }\r\n            totalSubscriptions++\r\n            if (sub.status === 'pending') pendingSubscriptions++\r\n\r\n            allSubscriptions.push({\r\n              id: sub.id,\r\n              deal_name: sub.deals?.name || 'Unknown Deal',\r\n              investor_name: 'My Investment',\r\n              commitment: sub.commitment || 0,\r\n              status: sub.status,\r\n              created_at: sub.created_at,\r\n              is_proxy: false,\r\n            })\r\n          })\r\n        }\r\n\r\n        // MODE 2 - Client subscriptions\r\n        if (clientInvestorIds.length > 0) {\r\n          const { data: clientSubs } = await supabase\r\n            .from('subscriptions')\r\n            .select(`\r\n              id, commitment, status, created_at,\r\n              deals (id, name),\r\n              investors (id, legal_name)\r\n            `)\r\n            .in('investor_id', clientInvestorIds)\r\n            .order('created_at', { ascending: false })\r\n            .limit(10)\r\n\r\n          ;(clientSubs || []).forEach((sub: any) => {\r\n            if (['committed', 'active', 'signed', 'funded'].includes(sub.status)) {\r\n              clientInvestmentValue += sub.commitment || 0\r\n            }\r\n            totalSubscriptions++\r\n            if (sub.status === 'pending') pendingSubscriptions++\r\n\r\n            allSubscriptions.push({\r\n              id: sub.id,\r\n              deal_name: sub.deals?.name || 'Unknown Deal',\r\n              investor_name: sub.investors?.legal_name || 'Client',\r\n              commitment: sub.commitment || 0,\r\n              status: sub.status,\r\n              created_at: sub.created_at,\r\n              is_proxy: true,\r\n            })\r\n          })\r\n        }\r\n\r\n        // Sort all subscriptions by date and take top 5\r\n        allSubscriptions.sort((a, b) =>\r\n          new Date(b.created_at).getTime() - new Date(a.created_at).getTime()\r\n        )\r\n        setRecentSubscriptions(allSubscriptions.slice(0, 5))\r\n\r\n        // Fetch placement agreements\r\n        const { data: agreements } = await supabase\r\n          .from('placement_agreements')\r\n          .select('id, agreement_type, status, default_commission_bps, created_at')\r\n          .eq('commercial_partner_id', commercialPartnerId)\r\n          .order('created_at', { ascending: false })\r\n\r\n        setPlacementAgreements(agreements || [])\r\n\r\n        const pendingAgreements = (agreements || []).filter((a: any) =>\r\n          ['sent', 'pending_approval', 'approved', 'pending_ceo_signature', 'pending_cp_signature'].includes(a.status)\r\n        ).length\r\n        const activeAgreements = (agreements || []).filter((a: any) => a.status === 'active').length\r\n\r\n        // Fetch commission aggregations from commercial_partner_commissions\r\n        let commissionPaid = 0\r\n        let commissionAccrued = 0\r\n        let commissionPending = 0\r\n\r\n        const { data: commissions } = await supabase\r\n          .from('commercial_partner_commissions')\r\n          .select('status, accrual_amount')\r\n          .eq('commercial_partner_id', commercialPartnerId)\r\n\r\n        if (commissions && commissions.length > 0) {\r\n          commissions.forEach((c: any) => {\r\n            const amount = parseFloat(c.accrual_amount) || 0\r\n            switch (c.status) {\r\n              case 'paid':\r\n                commissionPaid += amount\r\n                break\r\n              case 'accrued':\r\n                commissionAccrued += amount\r\n                break\r\n              case 'invoice_requested':\r\n              case 'invoiced':\r\n                commissionPending += amount\r\n                break\r\n            }\r\n          })\r\n        }\r\n\r\n        setMetrics({\r\n          totalClients,\r\n          activeClients,\r\n          dispatchedDeals,\r\n          activeOpportunities,\r\n          totalSubscriptions,\r\n          pendingSubscriptions,\r\n          ownInvestmentValue,\r\n          clientInvestmentValue,\r\n          pendingAgreements,\r\n          activeAgreements,\r\n          commissionPaid,\r\n          commissionAccrued,\r\n          commissionPending,\r\n        })\r\n      } catch (error) {\r\n        console.error('Error fetching commercial partner data:', error)\r\n      } finally {\r\n        setLoading(false)\r\n      }\r\n    }\r\n\r\n    fetchData()\r\n  }, [commercialPartnerId, userId])\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"p-8 text-center flex flex-col items-center gap-3\">\r\n        <Loader2 className=\"h-8 w-8 animate-spin text-gray-400\" />\r\n        <p className=\"text-gray-500\">Loading dashboard...</p>\r\n      </div>\r\n    )\r\n  }\r\n\r\n  const subscriptionStatusStyles: Record<string, string> = {\r\n    pending: 'bg-amber-500/20 text-amber-400',\r\n    committed: 'bg-blue-500/20 text-blue-400',\r\n    active: 'bg-green-500/20 text-green-400',\r\n    signed: 'bg-purple-500/20 text-purple-400',\r\n    funded: 'bg-emerald-500/20 text-emerald-400',\r\n    cancelled: 'bg-red-500/20 text-red-400',\r\n    rejected: 'bg-red-500/20 text-red-400',\r\n  }\r\n\r\n  const agreementStatusStyles: Record<string, string> = {\r\n    draft: 'bg-gray-500/20 text-gray-400',\r\n    sent: 'bg-blue-500/20 text-blue-400',\r\n    pending_approval: 'bg-amber-500/20 text-amber-400',\r\n    approved: 'bg-green-500/20 text-green-400',\r\n    pending_ceo_signature: 'bg-purple-500/20 text-purple-400',\r\n    pending_cp_signature: 'bg-indigo-500/20 text-indigo-400',\r\n    active: 'bg-emerald-500/20 text-emerald-400',\r\n    expired: 'bg-red-500/20 text-red-400',\r\n    terminated: 'bg-red-500/20 text-red-400',\r\n  }\r\n\r\n  const agreementStatusLabels: Record<string, string> = {\r\n    draft: 'Draft',\r\n    sent: 'Sent',\r\n    pending_approval: 'Pending Approval',\r\n    approved: 'Approved',\r\n    pending_ceo_signature: 'Awaiting CEO Signature',\r\n    pending_cp_signature: 'Your Signature Required',\r\n    active: 'Active',\r\n    expired: 'Expired',\r\n    terminated: 'Terminated',\r\n  }\r\n\r\n  return (\r\n    <div className=\"p-6 space-y-6\">\r\n      {/* Header */}\r\n      <div className=\"flex items-center justify-between\">\r\n        <div>\r\n          <h1 className={`text-2xl font-bold ${isDark ? 'text-white' : 'text-gray-900'}`}>\r\n            Commercial Partner Dashboard\r\n          </h1>\r\n          <p className={`mt-1 ${isDark ? 'text-gray-400' : 'text-gray-600'}`}>\r\n            {cpInfo?.legal_name || cpInfo?.name || persona.entity_name}\r\n          </p>\r\n        </div>\r\n        <div className=\"flex items-center gap-2\">\r\n          {cpInfo?.cp_type && (\r\n            <Badge variant=\"outline\" className={isDark ? 'border-gray-600' : ''}>\r\n              {cpInfo.cp_type.replace(/_/g, ' ').toUpperCase()}\r\n            </Badge>\r\n          )}\r\n          {cpInfo?.kyc_status && (\r\n            <Badge\r\n              variant=\"outline\"\r\n              className={\r\n                cpInfo.kyc_status === 'approved'\r\n                  ? 'border-green-500/50 text-green-500'\r\n                  : cpInfo.kyc_status === 'pending'\r\n                  ? 'border-amber-500/50 text-amber-500'\r\n                  : 'border-gray-500/50 text-gray-500'\r\n              }\r\n            >\r\n              KYC: {cpInfo.kyc_status}\r\n            </Badge>\r\n          )}\r\n        </div>\r\n      </div>\r\n\r\n      {/* Alert for inactive/pending CP */}\r\n      {cpInfo && cpInfo.status !== 'active' && (\r\n        <Card className={`border-amber-500/30 ${isDark ? 'bg-amber-500/10' : 'bg-amber-50'}`}>\r\n          <CardContent className=\"py-4\">\r\n            <div className=\"flex items-center gap-3\">\r\n              <div className=\"p-2 rounded-full bg-amber-500/20\">\r\n                <AlertCircle className=\"h-5 w-5 text-amber-500\" />\r\n              </div>\r\n              <div>\r\n                <p className={`font-medium ${isDark ? 'text-white' : 'text-gray-900'}`}>\r\n                  Account {cpInfo.status === 'pending' ? 'Pending Approval' : 'Inactive'}\r\n                </p>\r\n                <p className={`text-sm ${isDark ? 'text-gray-400' : 'text-gray-600'}`}>\r\n                  {cpInfo.status === 'pending'\r\n                    ? 'Your commercial partner account is pending approval. Contact the VERSO team for status updates.'\r\n                    : 'Your commercial partner account is currently inactive. Contact the VERSO team for assistance.'}\r\n                </p>\r\n              </div>\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n      )}\r\n\r\n      {/* Pending Signature Alert */}\r\n      {metrics && metrics.pendingAgreements > 0 && (\r\n        <Card className={`border-orange-500/30 ${isDark ? 'bg-orange-500/10' : 'bg-orange-50'}`}>\r\n          <CardContent className=\"py-4\">\r\n            <div className=\"flex items-center justify-between\">\r\n              <div className=\"flex items-center gap-3\">\r\n                <div className=\"p-2 rounded-full bg-orange-500/20\">\r\n                  <FileSignature className=\"h-5 w-5 text-orange-500\" />\r\n                </div>\r\n                <div>\r\n                  <p className={`font-medium ${isDark ? 'text-white' : 'text-gray-900'}`}>\r\n                    {metrics.pendingAgreements} Pending Agreement{metrics.pendingAgreements !== 1 ? 's' : ''}\r\n                  </p>\r\n                  <p className={`text-sm ${isDark ? 'text-gray-400' : 'text-gray-600'}`}>\r\n                    Agreements awaiting approval or signature\r\n                  </p>\r\n                </div>\r\n              </div>\r\n              <Button asChild>\r\n                <Link href=\"/versotech_main/placement-agreements\">\r\n                  View Agreements\r\n                  <ArrowRight className=\"h-4 w-4 ml-2\" />\r\n                </Link>\r\n              </Button>\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n      )}\r\n\r\n      {/* Metrics Grid */}\r\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\r\n        <Card className={isDark ? 'bg-white/5 border-white/10' : ''}>\r\n          <CardHeader className=\"flex flex-row items-center justify-between pb-2\">\r\n            <CardTitle className={`text-sm font-medium ${isDark ? 'text-gray-400' : 'text-gray-500'}`}>\r\n              Clients Managed\r\n            </CardTitle>\r\n            <Users className={`h-4 w-4 ${isDark ? 'text-gray-500' : 'text-gray-400'}`} />\r\n          </CardHeader>\r\n          <CardContent>\r\n            <div className={`text-2xl font-bold ${isDark ? 'text-white' : 'text-gray-900'}`}>\r\n              {metrics?.totalClients || 0}\r\n            </div>\r\n            <p className={`text-xs ${isDark ? 'text-gray-500' : 'text-gray-500'}`}>\r\n              {metrics?.activeClients || 0} active clients\r\n            </p>\r\n          </CardContent>\r\n        </Card>\r\n\r\n        <Card className={isDark ? 'bg-white/5 border-white/10' : ''}>\r\n          <CardHeader className=\"flex flex-row items-center justify-between pb-2\">\r\n            <CardTitle className={`text-sm font-medium ${isDark ? 'text-gray-400' : 'text-gray-500'}`}>\r\n              Active Opportunities\r\n            </CardTitle>\r\n            <TrendingUp className={`h-4 w-4 ${isDark ? 'text-gray-500' : 'text-gray-400'}`} />\r\n          </CardHeader>\r\n          <CardContent>\r\n            <div className={`text-2xl font-bold ${isDark ? 'text-white' : 'text-gray-900'}`}>\r\n              {metrics?.activeOpportunities || 0}\r\n            </div>\r\n            <p className={`text-xs ${isDark ? 'text-gray-500' : 'text-gray-500'}`}>\r\n              {metrics?.dispatchedDeals || 0} total dispatched\r\n            </p>\r\n          </CardContent>\r\n        </Card>\r\n\r\n        <Card className={isDark ? 'bg-white/5 border-white/10' : ''}>\r\n          <CardHeader className=\"flex flex-row items-center justify-between pb-2\">\r\n            <CardTitle className={`text-sm font-medium ${isDark ? 'text-gray-400' : 'text-gray-500'}`}>\r\n              Client Investments\r\n            </CardTitle>\r\n            <DollarSign className={`h-4 w-4 ${isDark ? 'text-gray-500' : 'text-gray-400'}`} />\r\n          </CardHeader>\r\n          <CardContent>\r\n            <div className={`text-2xl font-bold text-green-500`}>\r\n              {formatCurrency(metrics?.clientInvestmentValue || 0)}\r\n            </div>\r\n            <p className={`text-xs ${isDark ? 'text-gray-500' : 'text-gray-500'}`}>\r\n              Via proxy subscriptions\r\n            </p>\r\n          </CardContent>\r\n        </Card>\r\n\r\n        <Card className={isDark ? 'bg-white/5 border-white/10' : ''}>\r\n          <CardHeader className=\"flex flex-row items-center justify-between pb-2\">\r\n            <CardTitle className={`text-sm font-medium ${isDark ? 'text-gray-400' : 'text-gray-500'}`}>\r\n              Own Investments\r\n            </CardTitle>\r\n            <Briefcase className={`h-4 w-4 ${isDark ? 'text-gray-500' : 'text-gray-400'}`} />\r\n          </CardHeader>\r\n          <CardContent>\r\n            <div className={`text-2xl font-bold ${isDark ? 'text-white' : 'text-gray-900'}`}>\r\n              {formatCurrency(metrics?.ownInvestmentValue || 0)}\r\n            </div>\r\n            <p className={`text-xs ${isDark ? 'text-gray-500' : 'text-gray-500'}`}>\r\n              Direct investments\r\n            </p>\r\n          </CardContent>\r\n        </Card>\r\n      </div>\r\n\r\n      {/* Commission Earnings Summary */}\r\n      {(metrics?.commissionPaid || 0) + (metrics?.commissionAccrued || 0) + (metrics?.commissionPending || 0) > 0 && (\r\n        <Card className={isDark ? 'bg-white/5 border-white/10' : ''}>\r\n          <CardHeader>\r\n            <div className=\"flex items-center justify-between\">\r\n              <div>\r\n                <CardTitle className={isDark ? 'text-white' : ''}>Commission Earnings</CardTitle>\r\n                <CardDescription>Your commission totals across all deals</CardDescription>\r\n              </div>\r\n              <div className=\"p-2 rounded-full bg-purple-500/20\">\r\n                <DollarSign className=\"h-5 w-5 text-purple-500\" />\r\n              </div>\r\n            </div>\r\n          </CardHeader>\r\n          <CardContent>\r\n            <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\r\n              <div className={`p-4 rounded-lg ${isDark ? 'bg-white/5' : 'bg-green-50'}`}>\r\n                <p className={`text-xs font-medium ${isDark ? 'text-gray-400' : 'text-gray-500'} mb-1`}>Paid</p>\r\n                <p className=\"text-xl font-bold text-green-500\">\r\n                  {formatCurrency(metrics?.commissionPaid || 0)}\r\n                </p>\r\n              </div>\r\n              <div className={`p-4 rounded-lg ${isDark ? 'bg-white/5' : 'bg-blue-50'}`}>\r\n                <p className={`text-xs font-medium ${isDark ? 'text-gray-400' : 'text-gray-500'} mb-1`}>Accrued</p>\r\n                <p className=\"text-xl font-bold text-blue-500\">\r\n                  {formatCurrency(metrics?.commissionAccrued || 0)}\r\n                </p>\r\n              </div>\r\n              <div className={`p-4 rounded-lg ${isDark ? 'bg-white/5' : 'bg-amber-50'}`}>\r\n                <p className={`text-xs font-medium ${isDark ? 'text-gray-400' : 'text-gray-500'} mb-1`}>Pending</p>\r\n                <p className=\"text-xl font-bold text-amber-500\">\r\n                  {formatCurrency(metrics?.commissionPending || 0)}\r\n                </p>\r\n              </div>\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n      )}\r\n\r\n      {/* Subscriptions & Agreements Summary */}\r\n      <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n        <Card className={isDark ? 'bg-white/5 border-white/10' : ''}>\r\n          <CardContent className=\"pt-6\">\r\n            <div className=\"flex items-center gap-4\">\r\n              <div className=\"p-3 rounded-full bg-blue-500/20\">\r\n                <FileText className=\"h-6 w-6 text-blue-500\" />\r\n              </div>\r\n              <div>\r\n                <p className={`text-2xl font-bold ${isDark ? 'text-white' : 'text-gray-900'}`}>\r\n                  {metrics?.totalSubscriptions || 0}\r\n                </p>\r\n                <p className={`text-sm ${isDark ? 'text-gray-400' : 'text-gray-500'}`}>\r\n                  Total Subscriptions ({metrics?.pendingSubscriptions || 0} pending)\r\n                </p>\r\n              </div>\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n\r\n        <Card className={isDark ? 'bg-white/5 border-white/10' : ''}>\r\n          <CardContent className=\"pt-6\">\r\n            <div className=\"flex items-center gap-4\">\r\n              <div className=\"p-3 rounded-full bg-emerald-500/20\">\r\n                <CheckCircle2 className=\"h-6 w-6 text-emerald-500\" />\r\n              </div>\r\n              <div>\r\n                <p className={`text-2xl font-bold ${isDark ? 'text-white' : 'text-gray-900'}`}>\r\n                  {metrics?.activeAgreements || 0}\r\n                </p>\r\n                <p className={`text-sm ${isDark ? 'text-gray-400' : 'text-gray-500'}`}>\r\n                  Active Placement Agreements\r\n                </p>\r\n              </div>\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n      </div>\r\n\r\n      {/* Two Column Layout */}\r\n      <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\r\n        {/* Recent Subscriptions */}\r\n        <Card className={isDark ? 'bg-white/5 border-white/10' : ''}>\r\n          <CardHeader className=\"flex flex-row items-center justify-between\">\r\n            <div>\r\n              <CardTitle className={isDark ? 'text-white' : ''}>Recent Transactions</CardTitle>\r\n              <CardDescription>Latest subscription activity</CardDescription>\r\n            </div>\r\n            <Button variant=\"ghost\" size=\"sm\" asChild>\r\n              <Link href=\"/versotech_main/client-transactions\">\r\n                View All\r\n                <ArrowRight className=\"h-4 w-4 ml-1\" />\r\n              </Link>\r\n            </Button>\r\n          </CardHeader>\r\n          <CardContent>\r\n            {recentSubscriptions.length === 0 ? (\r\n              <div className=\"text-center py-8\">\r\n                <FileText className={`h-10 w-10 mx-auto mb-3 ${isDark ? 'text-gray-600' : 'text-gray-400'}`} />\r\n                <p className={`text-sm ${isDark ? 'text-gray-400' : 'text-gray-500'}`}>\r\n                  No subscriptions yet\r\n                </p>\r\n                <p className={`text-xs ${isDark ? 'text-gray-500' : 'text-gray-400'} mt-1`}>\r\n                  Browse opportunities to start investing\r\n                </p>\r\n              </div>\r\n            ) : (\r\n              <div className=\"space-y-3\">\r\n                {recentSubscriptions.map((sub) => (\r\n                  <div\r\n                    key={sub.id}\r\n                    className={`flex items-center justify-between p-3 rounded-lg ${\r\n                      isDark ? 'bg-white/5' : 'bg-gray-50'\r\n                    }`}\r\n                  >\r\n                    <div className=\"flex-1 min-w-0\">\r\n                      <div className=\"flex items-center gap-2\">\r\n                        <p className={`font-medium truncate ${isDark ? 'text-white' : 'text-gray-900'}`}>\r\n                          {sub.deal_name}\r\n                        </p>\r\n                        {sub.is_proxy && (\r\n                          <Badge variant=\"outline\" className=\"text-xs\">\r\n                            Proxy\r\n                          </Badge>\r\n                        )}\r\n                      </div>\r\n                      <p className={`text-sm ${isDark ? 'text-gray-400' : 'text-gray-500'}`}>\r\n                        {sub.investor_name} • {formatCurrency(sub.commitment)}\r\n                      </p>\r\n                    </div>\r\n                    <Badge className={subscriptionStatusStyles[sub.status] || 'bg-gray-500/20 text-gray-400'}>\r\n                      {sub.status}\r\n                    </Badge>\r\n                  </div>\r\n                ))}\r\n              </div>\r\n            )}\r\n          </CardContent>\r\n        </Card>\r\n\r\n        {/* Placement Agreements */}\r\n        <Card className={isDark ? 'bg-white/5 border-white/10' : ''}>\r\n          <CardHeader className=\"flex flex-row items-center justify-between\">\r\n            <div>\r\n              <CardTitle className={isDark ? 'text-white' : ''}>Placement Agreements</CardTitle>\r\n              <CardDescription>Your commission agreements</CardDescription>\r\n            </div>\r\n            <Button variant=\"ghost\" size=\"sm\" asChild>\r\n              <Link href=\"/versotech_main/placement-agreements\">\r\n                View All\r\n                <ArrowRight className=\"h-4 w-4 ml-1\" />\r\n              </Link>\r\n            </Button>\r\n          </CardHeader>\r\n          <CardContent>\r\n            {placementAgreements.length === 0 ? (\r\n              <div className=\"text-center py-8\">\r\n                <FileSignature className={`h-10 w-10 mx-auto mb-3 ${isDark ? 'text-gray-600' : 'text-gray-400'}`} />\r\n                <p className={`text-sm ${isDark ? 'text-gray-400' : 'text-gray-500'}`}>\r\n                  No placement agreements\r\n                </p>\r\n                <p className={`text-xs ${isDark ? 'text-gray-500' : 'text-gray-400'} mt-1`}>\r\n                  Agreements will appear here once created\r\n                </p>\r\n              </div>\r\n            ) : (\r\n              <div className=\"space-y-3\">\r\n                {placementAgreements.slice(0, 5).map((agreement) => (\r\n                  <Link\r\n                    key={agreement.id}\r\n                    href={`/versotech_main/placement-agreements/${agreement.id}`}\r\n                    className={`flex items-center justify-between p-3 rounded-lg transition-colors ${\r\n                      isDark ? 'bg-white/5 hover:bg-white/10' : 'bg-gray-50 hover:bg-gray-100'\r\n                    }`}\r\n                  >\r\n                    <div className=\"flex-1 min-w-0\">\r\n                      <p className={`font-medium ${isDark ? 'text-white' : 'text-gray-900'}`}>\r\n                        {agreement.agreement_type.replace(/_/g, ' ').replace(/\\b\\w/g, l => l.toUpperCase())} Agreement\r\n                      </p>\r\n                      <p className={`text-sm ${isDark ? 'text-gray-400' : 'text-gray-500'}`}>\r\n                        Commission: {(agreement.default_commission_bps / 100).toFixed(2)}%\r\n                      </p>\r\n                    </div>\r\n                    <Badge className={agreementStatusStyles[agreement.status] || 'bg-gray-500/20 text-gray-400'}>\r\n                      {agreementStatusLabels[agreement.status] || agreement.status}\r\n                    </Badge>\r\n                  </Link>\r\n                ))}\r\n              </div>\r\n            )}\r\n          </CardContent>\r\n        </Card>\r\n      </div>\r\n\r\n      {/* Quick Actions */}\r\n      <Card className={isDark ? 'bg-white/5 border-white/10' : ''}>\r\n        <CardHeader>\r\n          <CardTitle className={isDark ? 'text-white' : ''}>Quick Actions</CardTitle>\r\n          <CardDescription>Common tasks and workflows</CardDescription>\r\n        </CardHeader>\r\n        <CardContent>\r\n          <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\r\n            <Button variant=\"outline\" asChild className=\"h-auto py-4 flex-col gap-2\">\r\n              <Link href=\"/versotech_main/opportunities\">\r\n                <TrendingUp className=\"h-5 w-5\" />\r\n                <span>View Opportunities</span>\r\n              </Link>\r\n            </Button>\r\n            {canExecuteForClients && (\r\n              <Button variant=\"outline\" asChild className=\"h-auto py-4 flex-col gap-2\">\r\n                <Link href=\"/versotech_main/client-transactions\">\r\n                  <Users className=\"h-5 w-5\" />\r\n                  <span>Client Transactions</span>\r\n                </Link>\r\n              </Button>\r\n            )}\r\n            <Button variant=\"outline\" asChild className=\"h-auto py-4 flex-col gap-2\">\r\n              <Link href=\"/versotech_main/portfolio\">\r\n                <Briefcase className=\"h-5 w-5\" />\r\n                <span>My Portfolio</span>\r\n              </Link>\r\n            </Button>\r\n            <Button variant=\"outline\" asChild className=\"h-auto py-4 flex-col gap-2\">\r\n              <Link href=\"/versotech_main/placement-agreements\">\r\n                <FileSignature className=\"h-5 w-5\" />\r\n                <span>Agreements</span>\r\n              </Link>\r\n            </Button>\r\n          </div>\r\n        </CardContent>\r\n      </Card>\r\n\r\n      {/* Mode Capabilities Notice */}\r\n      <Card className={`${isDark ? 'bg-cyan-500/10 border-cyan-500/20' : 'bg-cyan-50 border-cyan-200'}`}>\r\n        <CardContent className=\"py-4\">\r\n          <div className=\"flex items-center gap-3\">\r\n            <div className=\"h-10 w-10 rounded-full bg-cyan-500 flex items-center justify-center\">\r\n              <Building2 className=\"h-5 w-5 text-white\" />\r\n            </div>\r\n            <div className=\"flex-1\">\r\n              <div className={`font-medium ${isDark ? 'text-white' : 'text-gray-900'}`}>\r\n                Commercial Partner Capabilities\r\n              </div>\r\n              <div className={`text-sm ${isDark ? 'text-gray-400' : 'text-gray-600'}`}>\r\n                {canExecuteForClients ? (\r\n                  <>You can invest directly <strong>(MODE 1)</strong> and execute on behalf of clients <strong>(MODE 2)</strong>.</>\r\n                ) : (\r\n                  <>You can invest directly <strong>(MODE 1)</strong>. Contact admin to enable client execution.</>\r\n                )}\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </CardContent>\r\n      </Card>\r\n    </div>\r\n  )\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 8806, "column": 0}, "map": {"version":3,"sources":["file:///Users/ghilesmoussaoui/Desktop/Versotech/versotech-portal/src/app/%28main%29/versotech_main/dashboard/persona-dashboard.tsx"],"sourcesContent":["'use client'\n\nimport { useEffect, useState } from 'react'\nimport { usePersona } from '@/contexts/persona-context'\nimport { useTheme } from '@/components/theme-provider'\nimport { createClient } from '@/lib/supabase/client'\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card'\nimport { Badge } from '@/components/ui/badge'\nimport { Button } from '@/components/ui/button'\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs'\nimport { InvestorDashboard } from './investor-dashboard'\nimport { IntroducerDashboard } from './introducer-dashboard'\nimport { PartnerDashboard } from './partner-dashboard'\nimport { LawyerDashboard } from './lawyer-dashboard'\nimport { ArrangerDashboard } from './arranger-dashboard'\nimport { CommercialPartnerDashboard } from './commercial-partner-dashboard'\nimport {\n  Building2,\n  Users,\n  UserPlus,\n  Briefcase,\n  Scale,\n  User,\n  TrendingUp,\n  FileText,\n  CheckSquare,\n  Loader2,\n  Wallet,\n  ArrowLeftRight\n} from 'lucide-react'\n\nconst PERSONA_ICONS: Record<string, React.ComponentType<{ className?: string }>> = {\n  staff: Building2,\n  investor: User,\n  arranger: Briefcase,\n  introducer: UserPlus,\n  partner: Users,\n  commercial_partner: Building2,\n  lawyer: Scale,\n}\n\nconst PERSONA_COLORS: Record<string, string> = {\n  staff: 'bg-blue-500',\n  investor: 'bg-green-500',\n  arranger: 'bg-purple-500',\n  introducer: 'bg-orange-500',\n  partner: 'bg-pink-500',\n  commercial_partner: 'bg-cyan-500',\n  lawyer: 'bg-indigo-500',\n}\n\n/**\n * Persona-aware dashboard for non-CEO users\n * Routes to persona-specific dashboards based on active persona type\n */\n// Check if a partner/introducer also has investments\nasync function checkUserHasInvestments(userId: string): Promise<{\n  hasInvestments: boolean\n  investorId: string | null\n  investmentCount: number\n}> {\n  try {\n    const supabase = createClient()\n\n    // Check if user is linked to an investor entity\n    const { data: investorLinks } = await supabase\n      .from('investor_users')\n      .select('investor_id')\n      .eq('user_id', userId)\n      .limit(1)\n\n    if (!investorLinks || investorLinks.length === 0) {\n      // No investor entity - check if they have subscriptions via deal_memberships\n      const { data: subscriptions } = await supabase\n        .from('subscriptions')\n        .select('id')\n        .or(`investor_id.in.(select investor_id from investor_users where user_id=${userId})`)\n        .limit(1)\n\n      return { hasInvestments: false, investorId: null, investmentCount: 0 }\n    }\n\n    const investorId = investorLinks[0].investor_id\n\n    // Count active subscriptions for this investor\n    const { data: subscriptions, count } = await supabase\n      .from('subscriptions')\n      .select('id', { count: 'exact', head: true })\n      .eq('investor_id', investorId)\n      .in('status', ['active', 'signed', 'funded', 'pending'])\n\n    return {\n      hasInvestments: (count || 0) > 0,\n      investorId,\n      investmentCount: count || 0\n    }\n  } catch (error) {\n    console.error('Error checking investments:', error)\n    return { hasInvestments: false, investorId: null, investmentCount: 0 }\n  }\n}\n\nexport function PersonaDashboard() {\n  const { activePersona, personas, isCEO } = usePersona()\n  const { theme } = useTheme()\n  const [userId, setUserId] = useState<string | null>(null)\n  const [loadingUser, setLoadingUser] = useState(true)\n  const [investmentInfo, setInvestmentInfo] = useState<{\n    hasInvestments: boolean\n    investorId: string | null\n    investmentCount: number\n  } | null>(null)\n  const [activeView, setActiveView] = useState<'partner' | 'investor'>('partner')\n\n  // Fetch the current user ID on mount\n  useEffect(() => {\n    async function fetchUser() {\n      const supabase = createClient()\n      const { data: { user } } = await supabase.auth.getUser()\n      setUserId(user?.id ?? null)\n      setLoadingUser(false)\n    }\n    fetchUser()\n  }, [])\n\n  // Check if partner/introducer has investments\n  useEffect(() => {\n    async function checkInvestments() {\n      if (!userId || !activePersona) return\n\n      // Only check for partners and introducers\n      if (activePersona.persona_type === 'partner' || activePersona.persona_type === 'introducer') {\n        const info = await checkUserHasInvestments(userId)\n        setInvestmentInfo(info)\n      }\n    }\n    checkInvestments()\n  }, [userId, activePersona])\n\n  // Use actual theme system (user-controlled via toggle in header)\n  const isDark = theme === 'staff-dark'\n\n  // Show loading state while fetching user\n  if (loadingUser || !activePersona) {\n    return (\n      <div className=\"p-8 text-center flex flex-col items-center gap-3\">\n        <Loader2 className=\"h-8 w-8 animate-spin text-gray-400\" />\n        <p className=\"text-gray-500\">Loading dashboard...</p>\n      </div>\n    )\n  }\n\n  // Route investor personas to the investor-specific dashboard\n  if (activePersona.persona_type === 'investor' && userId) {\n    return (\n      <InvestorDashboard\n        investorId={activePersona.entity_id}\n        userId={userId}\n        persona={activePersona}\n      />\n    )\n  }\n\n  // Route introducer personas to the introducer-specific dashboard\n  // If introducer also has investments, show a tabbed view\n  if (activePersona.persona_type === 'introducer' && userId) {\n    // Introducer also has investments - show dual view\n    if (investmentInfo?.hasInvestments && investmentInfo.investorId) {\n      return (\n        <div className=\"space-y-5\">\n          {/* Refined Context Switcher */}\n          <div className={`\n            relative overflow-hidden rounded-xl\n            ${isDark\n              ? 'bg-zinc-900/80 border border-zinc-800'\n              : 'bg-gradient-to-br from-slate-50 via-white to-stone-50 border border-slate-200/80 shadow-sm'\n            }\n          `}>\n            {/* Subtle pattern overlay */}\n            <div className={`absolute inset-0 opacity-[0.015] pointer-events-none`}\n              style={{\n                backgroundImage: `url(\"data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23${isDark ? 'ffffff' : '000000'}' fill-opacity='1'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E\")`,\n              }}\n            />\n\n            <div className=\"relative px-5 py-4\">\n              <div className=\"flex items-center justify-between flex-wrap gap-4\">\n                {/* Left side - Context info */}\n                <div className=\"flex items-center gap-4\">\n                  <div className={`\n                    h-11 w-11 rounded-xl flex items-center justify-center\n                    ${isDark\n                      ? 'bg-zinc-800 ring-1 ring-zinc-700'\n                      : 'bg-white ring-1 ring-slate-200 shadow-sm'\n                    }\n                  `}>\n                    <ArrowLeftRight className={`h-5 w-5 ${isDark ? 'text-zinc-400' : 'text-slate-500'}`} />\n                  </div>\n                  <div>\n                    <p className={`text-sm font-semibold tracking-tight ${isDark ? 'text-zinc-100' : 'text-slate-800'}`}>\n                      Dual Role Access\n                    </p>\n                    <p className={`text-[13px] ${isDark ? 'text-zinc-500' : 'text-slate-500'}`}>\n                      Introducer · {investmentInfo.investmentCount} investment{investmentInfo.investmentCount !== 1 ? 's' : ''}\n                    </p>\n                  </div>\n                </div>\n\n                {/* Right side - Segment control */}\n                <div className={`\n                  inline-flex p-1 rounded-lg\n                  ${isDark\n                    ? 'bg-zinc-800/80 ring-1 ring-zinc-700/50'\n                    : 'bg-slate-100/80 ring-1 ring-slate-200/50'\n                  }\n                `}>\n                  <button\n                    onClick={() => setActiveView('partner')}\n                    className={`\n                      relative px-4 py-2 rounded-md text-sm font-medium transition-all duration-200\n                      flex items-center gap-2\n                      ${activeView === 'partner'\n                        ? isDark\n                          ? 'bg-zinc-700 text-white shadow-sm ring-1 ring-zinc-600'\n                          : 'bg-white text-slate-900 shadow-sm ring-1 ring-slate-200'\n                        : isDark\n                          ? 'text-zinc-400 hover:text-zinc-200'\n                          : 'text-slate-500 hover:text-slate-700'\n                      }\n                    `}\n                  >\n                    <UserPlus className=\"h-4 w-4\" />\n                    <span>Referrals</span>\n                  </button>\n                  <button\n                    onClick={() => setActiveView('investor')}\n                    className={`\n                      relative px-4 py-2 rounded-md text-sm font-medium transition-all duration-200\n                      flex items-center gap-2\n                      ${activeView === 'investor'\n                        ? isDark\n                          ? 'bg-zinc-700 text-white shadow-sm ring-1 ring-zinc-600'\n                          : 'bg-white text-slate-900 shadow-sm ring-1 ring-slate-200'\n                        : isDark\n                          ? 'text-zinc-400 hover:text-zinc-200'\n                          : 'text-slate-500 hover:text-slate-700'\n                      }\n                    `}\n                  >\n                    <Wallet className=\"h-4 w-4\" />\n                    <span>Portfolio</span>\n                  </button>\n                </div>\n              </div>\n            </div>\n          </div>\n\n          {/* Active Dashboard */}\n          {activeView === 'partner' ? (\n            <IntroducerDashboard\n              introducerId={activePersona.entity_id}\n              userId={userId}\n              persona={activePersona}\n            />\n          ) : (\n            <InvestorDashboard\n              investorId={investmentInfo.investorId}\n              userId={userId}\n              persona={{\n                ...activePersona,\n                persona_type: 'investor',\n                entity_id: investmentInfo.investorId,\n                entity_name: 'My Investments'\n              }}\n            />\n          )}\n        </div>\n      )\n    }\n\n    // Regular introducer view (no investments)\n    return (\n      <IntroducerDashboard\n        introducerId={activePersona.entity_id}\n        userId={userId}\n        persona={activePersona}\n      />\n    )\n  }\n\n  // Route partner personas to the partner-specific dashboard\n  // If partner also has investments, show a tabbed view\n  if (activePersona.persona_type === 'partner' && userId) {\n    // Partner also has investments - show dual view\n    if (investmentInfo?.hasInvestments && investmentInfo.investorId) {\n      return (\n        <div className=\"space-y-5\">\n          {/* Refined Context Switcher */}\n          <div className={`\n            relative overflow-hidden rounded-xl\n            ${isDark\n              ? 'bg-zinc-900/80 border border-zinc-800'\n              : 'bg-gradient-to-br from-slate-50 via-white to-stone-50 border border-slate-200/80 shadow-sm'\n            }\n          `}>\n            {/* Subtle pattern overlay */}\n            <div className={`absolute inset-0 opacity-[0.015] pointer-events-none`}\n              style={{\n                backgroundImage: `url(\"data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23${isDark ? 'ffffff' : '000000'}' fill-opacity='1'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E\")`,\n              }}\n            />\n\n            <div className=\"relative px-5 py-4\">\n              <div className=\"flex items-center justify-between flex-wrap gap-4\">\n                {/* Left side - Context info */}\n                <div className=\"flex items-center gap-4\">\n                  <div className={`\n                    h-11 w-11 rounded-xl flex items-center justify-center\n                    ${isDark\n                      ? 'bg-zinc-800 ring-1 ring-zinc-700'\n                      : 'bg-white ring-1 ring-slate-200 shadow-sm'\n                    }\n                  `}>\n                    <ArrowLeftRight className={`h-5 w-5 ${isDark ? 'text-zinc-400' : 'text-slate-500'}`} />\n                  </div>\n                  <div>\n                    <p className={`text-sm font-semibold tracking-tight ${isDark ? 'text-zinc-100' : 'text-slate-800'}`}>\n                      Dual Role Access\n                    </p>\n                    <p className={`text-[13px] ${isDark ? 'text-zinc-500' : 'text-slate-500'}`}>\n                      Partner · {investmentInfo.investmentCount} investment{investmentInfo.investmentCount !== 1 ? 's' : ''}\n                    </p>\n                  </div>\n                </div>\n\n                {/* Right side - Segment control */}\n                <div className={`\n                  inline-flex p-1 rounded-lg\n                  ${isDark\n                    ? 'bg-zinc-800/80 ring-1 ring-zinc-700/50'\n                    : 'bg-slate-100/80 ring-1 ring-slate-200/50'\n                  }\n                `}>\n                  <button\n                    onClick={() => setActiveView('partner')}\n                    className={`\n                      relative px-4 py-2 rounded-md text-sm font-medium transition-all duration-200\n                      flex items-center gap-2\n                      ${activeView === 'partner'\n                        ? isDark\n                          ? 'bg-zinc-700 text-white shadow-sm ring-1 ring-zinc-600'\n                          : 'bg-white text-slate-900 shadow-sm ring-1 ring-slate-200'\n                        : isDark\n                          ? 'text-zinc-400 hover:text-zinc-200'\n                          : 'text-slate-500 hover:text-slate-700'\n                      }\n                    `}\n                  >\n                    <Users className=\"h-4 w-4\" />\n                    <span>Referrals</span>\n                  </button>\n                  <button\n                    onClick={() => setActiveView('investor')}\n                    className={`\n                      relative px-4 py-2 rounded-md text-sm font-medium transition-all duration-200\n                      flex items-center gap-2\n                      ${activeView === 'investor'\n                        ? isDark\n                          ? 'bg-zinc-700 text-white shadow-sm ring-1 ring-zinc-600'\n                          : 'bg-white text-slate-900 shadow-sm ring-1 ring-slate-200'\n                        : isDark\n                          ? 'text-zinc-400 hover:text-zinc-200'\n                          : 'text-slate-500 hover:text-slate-700'\n                      }\n                    `}\n                  >\n                    <Wallet className=\"h-4 w-4\" />\n                    <span>Portfolio</span>\n                  </button>\n                </div>\n              </div>\n            </div>\n          </div>\n\n          {/* Active Dashboard */}\n          {activeView === 'partner' ? (\n            <PartnerDashboard\n              partnerId={activePersona.entity_id}\n              userId={userId}\n              persona={activePersona}\n            />\n          ) : (\n            <InvestorDashboard\n              investorId={investmentInfo.investorId}\n              userId={userId}\n              persona={{\n                ...activePersona,\n                persona_type: 'investor',\n                entity_id: investmentInfo.investorId,\n                entity_name: 'My Investments'\n              }}\n            />\n          )}\n        </div>\n      )\n    }\n\n    // Regular partner view (no investments)\n    return (\n      <PartnerDashboard\n        partnerId={activePersona.entity_id}\n        userId={userId}\n        persona={activePersona}\n      />\n    )\n  }\n\n  // Route lawyer personas to the lawyer-specific dashboard\n  if (activePersona.persona_type === 'lawyer' && userId) {\n    return (\n      <LawyerDashboard\n        lawyerId={activePersona.entity_id}\n        userId={userId}\n        persona={activePersona}\n      />\n    )\n  }\n\n  // Route arranger personas to the arranger-specific dashboard\n  if (activePersona.persona_type === 'arranger' && userId) {\n    return (\n      <ArrangerDashboard\n        arrangerId={activePersona.entity_id}\n        userId={userId}\n        persona={activePersona}\n      />\n    )\n  }\n\n  // Route commercial partner personas to the commercial partner-specific dashboard\n  if (activePersona.persona_type === 'commercial_partner' && userId) {\n    return (\n      <CommercialPartnerDashboard\n        commercialPartnerId={activePersona.entity_id}\n        userId={userId}\n        persona={activePersona}\n      />\n    )\n  }\n\n  const ActiveIcon = PERSONA_ICONS[activePersona.persona_type] || User\n\n  // Generic dashboard for other persona types (arranger, commercial_partner, lawyer, etc.)\n  return (\n    <div className=\"p-6 space-y-6\">\n      {/* Welcome Header */}\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h1 className={`text-2xl font-bold ${isDark ? 'text-white' : 'text-gray-900'}`}>\n            Welcome to VERSO\n          </h1>\n          <p className={`mt-1 ${isDark ? 'text-gray-400' : 'text-gray-600'}`}>\n            Unified Platform Dashboard\n          </p>\n        </div>\n\n        {/* Active Persona Badge */}\n        <div className={`flex items-center gap-3 px-4 py-2 rounded-lg ${isDark ? 'bg-white/5 border border-white/10' : 'bg-gray-50 border border-gray-100'}`}>\n          <div className={`h-10 w-10 rounded-full ${PERSONA_COLORS[activePersona.persona_type]} flex items-center justify-center`}>\n            <ActiveIcon className=\"h-5 w-5 text-white\" />\n          </div>\n          <div>\n            <div className={`font-medium ${isDark ? 'text-white' : 'text-gray-900'}`}>\n              {activePersona.entity_name}\n            </div>\n            <div className={`text-sm ${isDark ? 'text-gray-400' : 'text-gray-500'}`}>\n              {activePersona.persona_type === 'staff'\n                ? (activePersona.role_in_entity === 'staff_admin' || activePersona.role_in_entity === 'ceo' ? 'CEO' : activePersona.role_in_entity?.toUpperCase())\n                : activePersona.persona_type.replace('_', ' ').toUpperCase()}\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* Persona Overview Cards */}\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n        {personas.map((persona) => {\n          const Icon = PERSONA_ICONS[persona.persona_type] || User\n          const isActive = activePersona?.entity_id === persona.entity_id\n\n          return (\n            <Card\n              key={persona.entity_id}\n              className={`${isDark ? 'bg-white/5 border-white/10' : 'bg-white border-gray-200'} ${isActive ? 'ring-2 ring-blue-500' : ''}`}\n            >\n              <CardHeader className=\"flex flex-row items-center gap-4 pb-2\">\n                <div className={`h-12 w-12 rounded-full ${PERSONA_COLORS[persona.persona_type]} flex items-center justify-center`}>\n                  <Icon className=\"h-6 w-6 text-white\" />\n                </div>\n                <div className=\"flex-1\">\n                  <CardTitle className={`text-lg ${isDark ? 'text-white' : 'text-gray-900'}`}>\n                    {persona.entity_name}\n                  </CardTitle>\n                  <CardDescription className={isDark ? 'text-gray-400' : 'text-gray-500'}>\n                    {persona.persona_type === 'staff'\n                      ? (persona.role_in_entity === 'staff_admin' || persona.role_in_entity === 'ceo' ? 'CEO' : persona.role_in_entity)\n                      : persona.persona_type.replace('_', ' ')}\n                  </CardDescription>\n                </div>\n                {isActive && (\n                  <Badge variant=\"secondary\" className=\"bg-blue-500/20 text-blue-400\">\n                    Active\n                  </Badge>\n                )}\n              </CardHeader>\n              <CardContent>\n                <div className=\"flex gap-2 flex-wrap\">\n                  {persona.can_sign && (\n                    <Badge variant=\"outline\" className={isDark ? 'border-white/20 text-gray-300' : ''}>\n                      Can Sign\n                    </Badge>\n                  )}\n                  {persona.can_execute_for_clients && (\n                    <Badge variant=\"outline\" className={isDark ? 'border-white/20 text-gray-300' : ''}>\n                      Can Execute\n                    </Badge>\n                  )}\n                  {persona.is_primary && (\n                    <Badge variant=\"outline\" className={isDark ? 'border-white/20 text-gray-300' : ''}>\n                      Primary\n                    </Badge>\n                  )}\n                </div>\n              </CardContent>\n            </Card>\n          )\n        })}\n      </div>\n\n      {/* Quick Stats (placeholder for non-CEO users) */}\n      <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n        <Card className={isDark ? 'bg-white/5 border-white/10' : 'bg-white border-gray-200'}>\n          <CardHeader className=\"flex flex-row items-center justify-between pb-2\">\n            <CardTitle className={`text-sm font-medium ${isDark ? 'text-gray-400' : 'text-gray-500'}`}>\n              Pending Tasks\n            </CardTitle>\n            <CheckSquare className={`h-4 w-4 ${isDark ? 'text-gray-500' : 'text-gray-400'}`} />\n          </CardHeader>\n          <CardContent>\n            <div className={`text-2xl font-bold ${isDark ? 'text-white' : 'text-gray-900'}`}>0</div>\n            <p className={`text-xs ${isDark ? 'text-gray-500' : 'text-gray-500'}`}>\n              No pending tasks\n            </p>\n          </CardContent>\n        </Card>\n\n        <Card className={isDark ? 'bg-white/5 border-white/10' : 'bg-white border-gray-200'}>\n          <CardHeader className=\"flex flex-row items-center justify-between pb-2\">\n            <CardTitle className={`text-sm font-medium ${isDark ? 'text-gray-400' : 'text-gray-500'}`}>\n              Active Deals\n            </CardTitle>\n            <TrendingUp className={`h-4 w-4 ${isDark ? 'text-gray-500' : 'text-gray-400'}`} />\n          </CardHeader>\n          <CardContent>\n            <div className={`text-2xl font-bold ${isDark ? 'text-white' : 'text-gray-900'}`}>-</div>\n            <p className={`text-xs ${isDark ? 'text-gray-500' : 'text-gray-500'}`}>\n              Data loading...\n            </p>\n          </CardContent>\n        </Card>\n\n        <Card className={isDark ? 'bg-white/5 border-white/10' : 'bg-white border-gray-200'}>\n          <CardHeader className=\"flex flex-row items-center justify-between pb-2\">\n            <CardTitle className={`text-sm font-medium ${isDark ? 'text-gray-400' : 'text-gray-500'}`}>\n              Documents\n            </CardTitle>\n            <FileText className={`h-4 w-4 ${isDark ? 'text-gray-500' : 'text-gray-400'}`} />\n          </CardHeader>\n          <CardContent>\n            <div className={`text-2xl font-bold ${isDark ? 'text-white' : 'text-gray-900'}`}>-</div>\n            <p className={`text-xs ${isDark ? 'text-gray-500' : 'text-gray-500'}`}>\n              Data loading...\n            </p>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* CEO Notice - shown for staff who might have CEO access but viewing persona dashboard */}\n      {isCEO && (\n        <Card className={`${isDark ? 'bg-blue-500/10 border-blue-500/20' : 'bg-blue-50 border-blue-200'}`}>\n          <CardContent className=\"py-4\">\n            <div className=\"flex items-center gap-3\">\n              <div className=\"h-10 w-10 rounded-full bg-blue-500 flex items-center justify-center\">\n                <Building2 className=\"h-5 w-5 text-white\" />\n              </div>\n              <div>\n                <div className={`font-medium ${isDark ? 'text-white' : 'text-gray-900'}`}>\n                  CEO Access Enabled\n                </div>\n                <div className={`text-sm ${isDark ? 'text-gray-400' : 'text-gray-600'}`}>\n                  You have access to KYC Review, Fees, Audit, and Admin sections.\n                </div>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n      )}\n    </div>\n  )\n}\n"],"names":[],"mappings":"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"}}]
}