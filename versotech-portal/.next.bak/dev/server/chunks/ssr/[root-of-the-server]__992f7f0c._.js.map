{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 22, "column": 0}, "map": {"version":3,"sources":["file:///Users/ghilesmoussaoui/Desktop/Versotech/versotech-portal/src/components/approvals/approvals-page-client.tsx/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport const ApprovalsPageClient = registerClientReference(\n    function() { throw new Error(\"Attempted to call ApprovalsPageClient() from the server but ApprovalsPageClient is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/versotech-portal/src/components/approvals/approvals-page-client.tsx <module evaluation>\",\n    \"ApprovalsPageClient\",\n);\n"],"names":[],"mappings":";;;;AAAA,uEAAuE;AACvE;;AACO,MAAM,sBAAsB,IAAA,+RAAuB,EACtD;IAAa,MAAM,IAAI,MAAM;AAAsP,GACnR,qGACA","ignoreList":[0]}},
    {"offset": {"line": 36, "column": 0}, "map": {"version":3,"sources":["file:///Users/ghilesmoussaoui/Desktop/Versotech/versotech-portal/src/components/approvals/approvals-page-client.tsx/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport const ApprovalsPageClient = registerClientReference(\n    function() { throw new Error(\"Attempted to call ApprovalsPageClient() from the server but ApprovalsPageClient is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/versotech-portal/src/components/approvals/approvals-page-client.tsx\",\n    \"ApprovalsPageClient\",\n);\n"],"names":[],"mappings":";;;;AAAA,uEAAuE;AACvE;;AACO,MAAM,sBAAsB,IAAA,+RAAuB,EACtD;IAAa,MAAM,IAAI,MAAM;AAAsP,GACnR,iFACA","ignoreList":[0]}},
    {"offset": {"line": 50, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":""}},
    {"offset": {"line": 58, "column": 0}, "map": {"version":3,"sources":["file:///Users/ghilesmoussaoui/Desktop/Versotech/versotech-portal/src/app/%28main%29/versotech_main/approvals/page.tsx"],"sourcesContent":["import { ApprovalsPageClient } from '@/components/approvals/approvals-page-client'\r\nimport { Approval, ApprovalStats } from '@/types/approvals'\r\nimport { createClient, createServiceClient } from '@/lib/supabase/server'\r\nimport { AlertCircle } from 'lucide-react'\r\nimport { checkStaffAccess } from '@/lib/auth'\r\n\r\nexport const dynamic = 'force-dynamic'\r\n\r\n/**\r\n * Approvals Page for Unified Portal (versotech_main)\r\n *\r\n * Persona-aware approval management:\r\n * - Staff/CEO personas: Full access to approval queue\r\n * - Other personas: Access denied\r\n */\r\nexport default async function ApprovalsPage() {\r\n  const clientSupabase = await createClient()\r\n  const { data: { user }, error: userError } = await clientSupabase.auth.getUser()\r\n\r\n  if (!user || userError) {\r\n    return (\r\n      <div className=\"p-6\">\r\n        <div className=\"text-center py-16\">\r\n          <AlertCircle className=\"h-12 w-12 text-gray-400 mx-auto mb-4\" />\r\n          <h3 className=\"text-lg font-medium text-foreground mb-2\">\r\n            Authentication Required\r\n          </h3>\r\n          <p className=\"text-muted-foreground\">\r\n            Please log in to view approvals.\r\n          </p>\r\n        </div>\r\n      </div>\r\n    )\r\n  }\r\n\r\n  // Check if user has staff/CEO persona for full access\r\n  const hasStaffAccess = await checkStaffAccess(user.id)\r\n  const serviceSupabase = createServiceClient()\r\n\r\n  if (!hasStaffAccess) {\r\n    return (\r\n      <div className=\"p-6\">\r\n        <div className=\"text-center py-16\">\r\n          <AlertCircle className=\"h-12 w-12 text-gray-400 mx-auto mb-4\" />\r\n          <h3 className=\"text-lg font-medium text-foreground mb-2\">\r\n            Access Restricted\r\n          </h3>\r\n          <p className=\"text-muted-foreground\">\r\n            Approval management is only available to staff members.\r\n          </p>\r\n        </div>\r\n      </div>\r\n    )\r\n  }\r\n\r\n  // Fetch approval data\r\n  const thirtyDaysAgo = new Date()\r\n  thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30)\r\n\r\n  const { data: approvals, error: approvalsError } = await serviceSupabase\r\n    .from('approvals')\r\n    .select(`\r\n      *,\r\n      requested_by_profile:requested_by (\r\n        id,\r\n        display_name,\r\n        email,\r\n        role\r\n      ),\r\n      assigned_to_profile:assigned_to (\r\n        id,\r\n        display_name,\r\n        email,\r\n        role\r\n      ),\r\n      approved_by_profile:approved_by (\r\n        id,\r\n        display_name,\r\n        email,\r\n        role\r\n      ),\r\n      related_deal:deals (\r\n        id,\r\n        name,\r\n        status,\r\n        deal_type,\r\n        currency\r\n      ),\r\n      related_investor:investors (\r\n        id,\r\n        legal_name,\r\n        kyc_status,\r\n        type\r\n      )\r\n    `)\r\n    .or(`status.eq.pending,and(status.in.(approved,rejected),resolved_at.gte.${thirtyDaysAgo.toISOString()})`)\r\n    .order('sla_breach_at', { ascending: true, nullsFirst: false })\r\n    .order('created_at', { ascending: false })\r\n\r\n  if (approvalsError) {\r\n    console.error('[Approvals] Error fetching approvals:', approvalsError)\r\n  }\r\n\r\n  // Get statistics\r\n  const { data: statsData } = await serviceSupabase\r\n    .rpc('get_approval_stats', { p_staff_id: null })\r\n    .single()\r\n\r\n  const stats: ApprovalStats = (statsData || {\r\n    total_pending: approvals?.length || 0,\r\n    overdue_count: 0,\r\n    avg_processing_time_hours: 0,\r\n    approval_rate_24h: 0,\r\n    total_approved_30d: 0,\r\n    total_rejected_30d: 0,\r\n    total_awaiting_info: 0\r\n  }) as ApprovalStats\r\n\r\n  const counts = {\r\n    pending: stats.total_pending,\r\n    approved: stats.total_approved_30d,\r\n    rejected: stats.total_rejected_30d\r\n  }\r\n\r\n  return (\r\n    <div className=\"p-6 space-y-8\">\r\n      {/* Header */}\r\n      <div className=\"border-b border-gray-800 pb-6\">\r\n        <h1 className=\"text-3xl font-bold text-foreground\">Approval Queue</h1>\r\n        <p className=\"text-lg text-muted-foreground mt-1\">\r\n          Review and approve investor commitments and allocations\r\n        </p>\r\n      </div>\r\n\r\n      {/* Client Component with Interactive Features */}\r\n      <ApprovalsPageClient\r\n        initialApprovals={(approvals || []) as Approval[]}\r\n        initialStats={stats}\r\n        initialCounts={counts}\r\n      />\r\n    </div>\r\n  )\r\n}\r\n"],"names":[],"mappings":";;;;;;;AAAA;AAEA;AACA;AACA;;;;;;AAEO,MAAM,UAAU;AASR,eAAe;IAC5B,MAAM,iBAAiB,MAAM,IAAA,uKAAY;IACzC,MAAM,EAAE,MAAM,EAAE,IAAI,EAAE,EAAE,OAAO,SAAS,EAAE,GAAG,MAAM,eAAe,IAAI,CAAC,OAAO;IAE9E,IAAI,CAAC,QAAQ,WAAW;QACtB,qBACE,qQAAC;YAAI,WAAU;sBACb,cAAA,qQAAC;gBAAI,WAAU;;kCACb,qQAAC,0PAAW;wBAAC,WAAU;;;;;;kCACvB,qQAAC;wBAAG,WAAU;kCAA2C;;;;;;kCAGzD,qQAAC;wBAAE,WAAU;kCAAwB;;;;;;;;;;;;;;;;;IAM7C;IAEA,sDAAsD;IACtD,MAAM,iBAAiB,MAAM,IAAA,6JAAgB,EAAC,KAAK,EAAE;IACrD,MAAM,kBAAkB,IAAA,8KAAmB;IAE3C,IAAI,CAAC,gBAAgB;QACnB,qBACE,qQAAC;YAAI,WAAU;sBACb,cAAA,qQAAC;gBAAI,WAAU;;kCACb,qQAAC,0PAAW;wBAAC,WAAU;;;;;;kCACvB,qQAAC;wBAAG,WAAU;kCAA2C;;;;;;kCAGzD,qQAAC;wBAAE,WAAU;kCAAwB;;;;;;;;;;;;;;;;;IAM7C;IAEA,sBAAsB;IACtB,MAAM,gBAAgB,IAAI;IAC1B,cAAc,OAAO,CAAC,cAAc,OAAO,KAAK;IAEhD,MAAM,EAAE,MAAM,SAAS,EAAE,OAAO,cAAc,EAAE,GAAG,MAAM,gBACtD,IAAI,CAAC,aACL,MAAM,CAAC,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;IAiCT,CAAC,EACA,EAAE,CAAC,CAAC,oEAAoE,EAAE,cAAc,WAAW,GAAG,CAAC,CAAC,EACxG,KAAK,CAAC,iBAAiB;QAAE,WAAW;QAAM,YAAY;IAAM,GAC5D,KAAK,CAAC,cAAc;QAAE,WAAW;IAAM;IAE1C,IAAI,gBAAgB;QAClB,QAAQ,KAAK,CAAC,yCAAyC;IACzD;IAEA,iBAAiB;IACjB,MAAM,EAAE,MAAM,SAAS,EAAE,GAAG,MAAM,gBAC/B,GAAG,CAAC,sBAAsB;QAAE,YAAY;IAAK,GAC7C,MAAM;IAET,MAAM,QAAwB,aAAa;QACzC,eAAe,WAAW,UAAU;QACpC,eAAe;QACf,2BAA2B;QAC3B,mBAAmB;QACnB,oBAAoB;QACpB,oBAAoB;QACpB,qBAAqB;IACvB;IAEA,MAAM,SAAS;QACb,SAAS,MAAM,aAAa;QAC5B,UAAU,MAAM,kBAAkB;QAClC,UAAU,MAAM,kBAAkB;IACpC;IAEA,qBACE,qQAAC;QAAI,WAAU;;0BAEb,qQAAC;gBAAI,WAAU;;kCACb,qQAAC;wBAAG,WAAU;kCAAqC;;;;;;kCACnD,qQAAC;wBAAE,WAAU;kCAAqC;;;;;;;;;;;;0BAMpD,qQAAC,4MAAmB;gBAClB,kBAAmB,aAAa,EAAE;gBAClC,cAAc;gBACd,eAAe;;;;;;;;;;;;AAIvB"}}]
}