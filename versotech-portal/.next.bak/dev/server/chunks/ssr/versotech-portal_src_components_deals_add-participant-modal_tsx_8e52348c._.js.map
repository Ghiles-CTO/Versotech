{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/ghilesmoussaoui/Desktop/Versotech/versotech-portal/src/components/deals/add-participant-modal.tsx"],"sourcesContent":["'use client'\r\n\r\nimport { useState, useEffect, useCallback } from 'react'\r\nimport {\r\n  Dialog,\r\n  DialogContent,\r\n  DialogDescription,\r\n  DialogHeader,\r\n  DialogTitle,\r\n  DialogTrigger,\r\n} from '@/components/ui/dialog'\r\nimport { Button } from '@/components/ui/button'\r\nimport { Input } from '@/components/ui/input'\r\nimport { Label } from '@/components/ui/label'\r\nimport {\r\n  Select,\r\n  SelectContent,\r\n  SelectItem,\r\n  SelectTrigger,\r\n  SelectValue,\r\n} from '@/components/ui/select'\r\nimport {\r\n  Plus,\r\n  Loader2,\r\n  Users,\r\n  Building2,\r\n  Briefcase,\r\n  UserCircle,\r\n  Trash2,\r\n  AlertCircle,\r\n} from 'lucide-react'\r\nimport { useRouter } from 'next/navigation'\r\nimport { cn } from '@/lib/utils'\r\n\r\ninterface AddParticipantModalProps {\r\n  dealId: string\r\n  onParticipantAdded?: () => void\r\n}\r\n\r\ntype ParticipantCategory = 'investor' | 'partner' | 'introducer' | 'commercial_partner'\r\ntype ReferringEntityType = 'partner' | 'introducer' | 'commercial_partner'\r\n\r\ninterface FeeComponent {\r\n  kind: string\r\n  rate_bps?: number\r\n  flat_amount?: number\r\n}\r\n\r\ninterface FeePlan {\r\n  id: string\r\n  name: string\r\n  description?: string\r\n  status: string\r\n  is_default: boolean\r\n  is_active: boolean\r\n  accepted_at?: string\r\n  fee_components: FeeComponent[]\r\n}\r\n\r\ninterface FeePlansResponse {\r\n  fee_plans: FeePlan[]\r\n  accepted_plans: FeePlan[]\r\n  can_dispatch: boolean\r\n  message: string | null\r\n  entity_name: string\r\n}\r\n\r\ninterface TermSheet {\r\n  id: string\r\n  version: number\r\n  status: string\r\n  subscription_fee_percent: number | null\r\n  management_fee_percent: number | null\r\n  carried_interest_percent: number | null\r\n  term_sheet_date: string | null\r\n}\r\n\r\n// Types for the new Introducer dispatch flow\r\ninterface ActiveAgreement {\r\n  id: string\r\n  introducer_id: string\r\n  introducer_name: string\r\n  fee_plan_id: string\r\n  fee_plan_name: string\r\n  term_sheet_id: string\r\n  term_sheet_version: number\r\n  reference_number?: string\r\n  signed_date?: string\r\n}\r\n\r\ninterface LinkableInvestor {\r\n  user_id: string\r\n  investor_id: string\r\n  display_name: string\r\n  email: string\r\n  current_role: string\r\n}\r\n\r\n// Roles that require a referring entity and fee plan\r\nconst ROLES_REQUIRING_REFERRER: Record<string, ReferringEntityType> = {\r\n  'partner_investor': 'partner',\r\n  'introducer_investor': 'introducer',\r\n  'commercial_partner_investor': 'commercial_partner',\r\n}\r\n\r\nconst PARTICIPANT_CATEGORIES = [\r\n  {\r\n    value: 'investor' as const,\r\n    label: 'Investor',\r\n    icon: UserCircle,\r\n    description: 'Individual or entity investing in this deal',\r\n    color: 'bg-emerald-500/20 text-emerald-300 border-emerald-500/30',\r\n  },\r\n  {\r\n    value: 'partner' as const,\r\n    label: 'Partner',\r\n    icon: Building2,\r\n    description: 'Distribution or syndicate partner',\r\n    color: 'bg-purple-500/20 text-purple-300 border-purple-500/30',\r\n  },\r\n  {\r\n    value: 'introducer' as const,\r\n    label: 'Introducer',\r\n    icon: Users,\r\n    description: 'Individual or entity introducing investors',\r\n    color: 'bg-orange-500/20 text-orange-300 border-orange-500/30',\r\n  },\r\n  {\r\n    value: 'commercial_partner' as const,\r\n    label: 'Commercial Partner',\r\n    icon: Briefcase,\r\n    description: 'Wealth manager, placement agent, etc.',\r\n    color: 'bg-cyan-500/20 text-cyan-300 border-cyan-500/30',\r\n  },\r\n]\r\n\r\nconst INVESTOR_ROLES = [\r\n  { value: 'investor', label: 'Investor' },\r\n  { value: 'co_investor', label: 'Co-Investor' },\r\n  { value: 'partner_investor', label: 'Partner Investor' },\r\n  { value: 'introducer_investor', label: 'Introducer Investor' },\r\n  { value: 'commercial_partner_investor', label: 'Commercial Partner Investor' },\r\n]\r\n\r\nconst FEE_KINDS = [\r\n  { value: 'subscription', label: 'Subscription Fee' },\r\n  { value: 'management', label: 'Management Fee' },\r\n  { value: 'performance', label: 'Performance Fee' },\r\n  { value: 'spread_markup', label: 'Spread Markup' },\r\n  { value: 'flat', label: 'Flat Fee' },\r\n]\r\n\r\nexport function AddParticipantModal({ dealId, onParticipantAdded }: AddParticipantModalProps) {\r\n  const router = useRouter()\r\n  const [open, setOpen] = useState(false)\r\n  const [loading, setLoading] = useState(false)\r\n  const [error, setError] = useState<string | null>(null)\r\n\r\n  // Step 1: Category selection\r\n  const [category, setCategory] = useState<ParticipantCategory | null>(null)\r\n\r\n  // Entity lists for dropdowns\r\n  const [investors, setInvestors] = useState<any[]>([])\r\n  const [partners, setPartners] = useState<any[]>([])\r\n  const [introducers, setIntroducers] = useState<any[]>([])\r\n  const [commercialPartners, setCommercialPartners] = useState<any[]>([])\r\n  const [entitiesLoading, setEntitiesLoading] = useState(false)\r\n\r\n  // Selected entity\r\n  const [selectedEntityId, setSelectedEntityId] = useState<string>('')\r\n  const [selectedEntity, setSelectedEntity] = useState<any>(null)\r\n\r\n  // Investor-specific fields\r\n  const [investorRole, setInvestorRole] = useState('investor')\r\n\r\n  // Referring entity for investor roles that require it\r\n  const [selectedReferringEntityId, setSelectedReferringEntityId] = useState<string>('')\r\n  const [selectedReferringEntity, setSelectedReferringEntity] = useState<any>(null)\r\n\r\n  // Fee plan selection (when dispatching through an entity)\r\n  const [feePlansData, setFeePlansData] = useState<FeePlansResponse | null>(null)\r\n  const [feePlansLoading, setFeePlansLoading] = useState(false)\r\n  const [selectedFeePlanId, setSelectedFeePlanId] = useState<string>('')\r\n\r\n  // Term sheet selection (for all investors - determines investor class)\r\n  const [publishedTermSheets, setPublishedTermSheets] = useState<TermSheet[]>([])\r\n  const [selectedTermSheetId, setSelectedTermSheetId] = useState<string>('')\r\n  const [termSheetsLoading, setTermSheetsLoading] = useState(false)\r\n\r\n  // Entity-specific fields (partner/commercial_partner only - introducer uses dispatch flow)\r\n  const [feePlanName, setFeePlanName] = useState('')\r\n  const [feeComponents, setFeeComponents] = useState<FeeComponent[]>([\r\n    { kind: 'subscription', rate_bps: 200 },\r\n  ])\r\n\r\n  // Introducer dispatch flow state\r\n  const [activeAgreements, setActiveAgreements] = useState<ActiveAgreement[]>([])\r\n  const [activeAgreementsLoading, setActiveAgreementsLoading] = useState(false)\r\n  const [selectedAgreementId, setSelectedAgreementId] = useState<string>('')\r\n  const [selectedAgreement, setSelectedAgreement] = useState<ActiveAgreement | null>(null)\r\n  const [linkableInvestors, setLinkableInvestors] = useState<LinkableInvestor[]>([])\r\n  const [linkableInvestorsLoading, setLinkableInvestorsLoading] = useState(false)\r\n  const [selectedLinkableInvestorId, setSelectedLinkableInvestorId] = useState<string>('')\r\n\r\n  // Check if current role requires a referring entity\r\n  const requiresReferrer = !!ROLES_REQUIRING_REFERRER[investorRole]\r\n  const referrerEntityType = ROLES_REQUIRING_REFERRER[investorRole]\r\n\r\n  // ===== CALLBACKS (defined first, before useEffects) =====\r\n\r\n  // Get the appropriate entity list for referring entity dropdown\r\n  const getReferringEntityList = useCallback(() => {\r\n    if (referrerEntityType === 'partner') return partners\r\n    if (referrerEntityType === 'introducer') return introducers\r\n    if (referrerEntityType === 'commercial_partner') return commercialPartners\r\n    return []\r\n  }, [referrerEntityType, partners, introducers, commercialPartners])\r\n\r\n  const loadAllEntities = useCallback(async () => {\r\n    setEntitiesLoading(true)\r\n    try {\r\n      // Load all entity types in parallel\r\n      const [investorsRes, partnersRes, introducersRes, cpRes] = await Promise.all([\r\n        fetch('/api/investors?has_users=true'),\r\n        fetch('/api/admin/partners?status=active'),\r\n        fetch('/api/admin/introducers?status=active'),\r\n        fetch('/api/admin/commercial-partners?status=active'),\r\n      ])\r\n\r\n      if (investorsRes.ok) {\r\n        const data = await investorsRes.json()\r\n        setInvestors(data.investors || data.data || [])\r\n      }\r\n      if (partnersRes.ok) {\r\n        const data = await partnersRes.json()\r\n        setPartners(data.partners || data.data || [])\r\n      }\r\n      if (introducersRes.ok) {\r\n        const data = await introducersRes.json()\r\n        setIntroducers(data.introducers || data.data || [])\r\n      }\r\n      if (cpRes.ok) {\r\n        const data = await cpRes.json()\r\n        setCommercialPartners(data.partners || data.commercial_partners || data.data || [])\r\n      }\r\n    } catch (err) {\r\n      console.error('Failed to load entities:', err)\r\n    } finally {\r\n      setEntitiesLoading(false)\r\n    }\r\n  }, [])\r\n\r\n  const fetchPublishedTermSheets = useCallback(async () => {\r\n    setTermSheetsLoading(true)\r\n    try {\r\n      const response = await fetch(`/api/deals/${dealId}/fee-structures?status=published`)\r\n      if (response.ok) {\r\n        const data = await response.json()\r\n        setPublishedTermSheets(data.term_sheets || [])\r\n      }\r\n    } catch (err) {\r\n      console.error('Term sheets fetch failed:', err)\r\n    } finally {\r\n      setTermSheetsLoading(false)\r\n    }\r\n  }, [dealId])\r\n\r\n  const fetchFeePlans = useCallback(async () => {\r\n    if (!selectedReferringEntity || !referrerEntityType) return\r\n\r\n    setFeePlansLoading(true)\r\n    setFeePlansData(null)\r\n    setSelectedFeePlanId('')\r\n    try {\r\n      let endpoint = `/api/deals/${dealId}/dispatch/fee-plans?entity_id=${selectedReferringEntity.id}&entity_type=${referrerEntityType}`\r\n      if (selectedTermSheetId) {\r\n        endpoint += `&term_sheet_id=${selectedTermSheetId}`\r\n      }\r\n      const response = await fetch(endpoint)\r\n\r\n      if (response.ok) {\r\n        const data: FeePlansResponse = await response.json()\r\n        setFeePlansData(data)\r\n        // Auto-select if only one accepted plan\r\n        if (data.accepted_plans.length === 1) {\r\n          setSelectedFeePlanId(data.accepted_plans[0].id)\r\n        }\r\n      }\r\n    } catch (err) {\r\n      console.error('Fee plans fetch failed:', err)\r\n    } finally {\r\n      setFeePlansLoading(false)\r\n    }\r\n  }, [dealId, selectedReferringEntity, referrerEntityType, selectedTermSheetId])\r\n\r\n  // Fetch active introducer agreements for the selected introducer on this deal\r\n  const fetchActiveAgreements = useCallback(async (introducerId: string) => {\r\n    setActiveAgreementsLoading(true)\r\n    setActiveAgreements([])\r\n    setSelectedAgreementId('')\r\n    setSelectedAgreement(null)\r\n    setLinkableInvestors([])\r\n    setSelectedLinkableInvestorId('')\r\n    try {\r\n      const response = await fetch(`/api/deals/${dealId}/active-agreements?introducer_id=${introducerId}`)\r\n      if (response.ok) {\r\n        const data = await response.json()\r\n        setActiveAgreements(data.agreements || [])\r\n      }\r\n    } catch (err) {\r\n      console.error('Active agreements fetch failed:', err)\r\n    } finally {\r\n      setActiveAgreementsLoading(false)\r\n    }\r\n  }, [dealId])\r\n\r\n  // Fetch linkable investors for a specific term sheet\r\n  const fetchLinkableInvestors = useCallback(async (termSheetId: string) => {\r\n    setLinkableInvestorsLoading(true)\r\n    setLinkableInvestors([])\r\n    setSelectedLinkableInvestorId('')\r\n    try {\r\n      const response = await fetch(`/api/deals/${dealId}/linkable-investors?term_sheet_id=${termSheetId}`)\r\n      if (response.ok) {\r\n        const data = await response.json()\r\n        setLinkableInvestors(data.investors || [])\r\n      }\r\n    } catch (err) {\r\n      console.error('Linkable investors fetch failed:', err)\r\n    } finally {\r\n      setLinkableInvestorsLoading(false)\r\n    }\r\n  }, [dealId])\r\n\r\n  // ===== USE EFFECTS (after callbacks are defined) =====\r\n\r\n  // Reset form when modal closes\r\n  useEffect(() => {\r\n    if (!open) {\r\n      setCategory(null)\r\n      setSelectedEntityId('')\r\n      setSelectedEntity(null)\r\n      setInvestorRole('investor')\r\n      setFeePlanName('')\r\n      setFeeComponents([{ kind: 'subscription', rate_bps: 200 }])\r\n      setError(null)\r\n      setSelectedReferringEntityId('')\r\n      setSelectedReferringEntity(null)\r\n      setFeePlansData(null)\r\n      setSelectedFeePlanId('')\r\n      setPublishedTermSheets([])\r\n      setSelectedTermSheetId('')\r\n      // Reset introducer dispatch state\r\n      setActiveAgreements([])\r\n      setSelectedAgreementId('')\r\n      setSelectedAgreement(null)\r\n      setLinkableInvestors([])\r\n      setSelectedLinkableInvestorId('')\r\n    }\r\n  }, [open])\r\n\r\n  // Load all entity lists when modal opens\r\n  useEffect(() => {\r\n    if (open) {\r\n      loadAllEntities()\r\n    }\r\n  }, [open, loadAllEntities])\r\n\r\n  // Reset selections when category changes\r\n  useEffect(() => {\r\n    setSelectedEntityId('')\r\n    setSelectedEntity(null)\r\n    setInvestorRole('investor')\r\n    setSelectedReferringEntityId('')\r\n    setSelectedReferringEntity(null)\r\n    setFeePlansData(null)\r\n    setSelectedFeePlanId('')\r\n    setFeePlanName('')\r\n    // Reset introducer dispatch state\r\n    setActiveAgreements([])\r\n    setSelectedAgreementId('')\r\n    setSelectedAgreement(null)\r\n    setLinkableInvestors([])\r\n    setSelectedLinkableInvestorId('')\r\n  }, [category])\r\n\r\n  // Reset referring entity when role changes\r\n  useEffect(() => {\r\n    setSelectedReferringEntityId('')\r\n    setSelectedReferringEntity(null)\r\n    setFeePlansData(null)\r\n    setSelectedFeePlanId('')\r\n  }, [investorRole])\r\n\r\n  // Fetch published term sheets when category is investor\r\n  useEffect(() => {\r\n    if (category === 'investor' && open) {\r\n      fetchPublishedTermSheets()\r\n    } else {\r\n      setPublishedTermSheets([])\r\n      setSelectedTermSheetId('')\r\n    }\r\n  }, [category, open, fetchPublishedTermSheets])\r\n\r\n  // Fetch active agreements when an introducer is selected (for dispatch flow)\r\n  useEffect(() => {\r\n    if (category === 'introducer' && selectedEntity?.id) {\r\n      fetchActiveAgreements(selectedEntity.id)\r\n    } else if (category === 'introducer') {\r\n      // Reset agreement state when introducer is deselected\r\n      setActiveAgreements([])\r\n      setSelectedAgreementId('')\r\n      setSelectedAgreement(null)\r\n      setLinkableInvestors([])\r\n      setSelectedLinkableInvestorId('')\r\n    }\r\n  }, [category, selectedEntity?.id, fetchActiveAgreements])\r\n\r\n  // Update selectedAgreement and fetch linkable investors when agreement is selected\r\n  useEffect(() => {\r\n    if (!selectedAgreementId) {\r\n      setSelectedAgreement(null)\r\n      setLinkableInvestors([])\r\n      setSelectedLinkableInvestorId('')\r\n      return\r\n    }\r\n\r\n    const agreement = activeAgreements.find(a => a.id === selectedAgreementId)\r\n    setSelectedAgreement(agreement || null)\r\n\r\n    // Fetch linkable investors for this agreement's term sheet\r\n    if (agreement?.term_sheet_id) {\r\n      fetchLinkableInvestors(agreement.term_sheet_id)\r\n    }\r\n  }, [selectedAgreementId, activeAgreements, fetchLinkableInvestors])\r\n\r\n  // Fetch fee plans when referring entity is selected AND term sheet is selected\r\n  useEffect(() => {\r\n    if (selectedReferringEntity && referrerEntityType && selectedTermSheetId) {\r\n      fetchFeePlans()\r\n    } else {\r\n      setFeePlansData(null)\r\n      setSelectedFeePlanId('')\r\n    }\r\n  }, [selectedReferringEntity, referrerEntityType, selectedTermSheetId, fetchFeePlans])\r\n\r\n  // Update selectedEntity when dropdown changes\r\n  useEffect(() => {\r\n    if (!selectedEntityId) {\r\n      setSelectedEntity(null)\r\n      return\r\n    }\r\n\r\n    let entityList: any[] = []\r\n    if (category === 'investor') entityList = investors\r\n    else if (category === 'partner') entityList = partners\r\n    else if (category === 'introducer') entityList = introducers\r\n    else if (category === 'commercial_partner') entityList = commercialPartners\r\n\r\n    const entity = entityList.find(e => e.id === selectedEntityId)\r\n    setSelectedEntity(entity || null)\r\n\r\n    // Auto-fill fee plan name for non-investor entities\r\n    if (entity && category !== 'investor') {\r\n      const entityName = entity.name || entity.legal_name || 'Unknown'\r\n      setFeePlanName(`${entityName} Fee Plan`)\r\n    }\r\n  }, [selectedEntityId, category, investors, partners, introducers, commercialPartners])\r\n\r\n  // Update selectedReferringEntity when dropdown changes\r\n  useEffect(() => {\r\n    if (!selectedReferringEntityId) {\r\n      setSelectedReferringEntity(null)\r\n      return\r\n    }\r\n\r\n    const entityList = getReferringEntityList()\r\n    const entity = entityList.find(e => e.id === selectedReferringEntityId)\r\n    setSelectedReferringEntity(entity || null)\r\n  }, [selectedReferringEntityId, getReferringEntityList])\r\n\r\n  const handleAddFeeComponent = () => {\r\n    setFeeComponents([...feeComponents, { kind: 'subscription', rate_bps: 100 }])\r\n  }\r\n\r\n  const handleRemoveFeeComponent = (index: number) => {\r\n    setFeeComponents(feeComponents.filter((_, i) => i !== index))\r\n  }\r\n\r\n  const handleFeeComponentChange = (index: number, field: keyof FeeComponent, value: any) => {\r\n    const updated = [...feeComponents]\r\n    updated[index] = { ...updated[index], [field]: value }\r\n    if (field === 'rate_bps') delete updated[index].flat_amount\r\n    if (field === 'flat_amount') delete updated[index].rate_bps\r\n    setFeeComponents(updated)\r\n  }\r\n\r\n  const handleSubmit = async () => {\r\n    if (!category) {\r\n      setError('Please select a participant type')\r\n      return\r\n    }\r\n\r\n    if (category === 'investor') {\r\n      if (!selectedEntity) {\r\n        setError('Please select an investor')\r\n        return\r\n      }\r\n      if (!selectedTermSheetId) {\r\n        setError('Please select a term sheet for this investor')\r\n        return\r\n      }\r\n      if (requiresReferrer) {\r\n        if (!selectedReferringEntity) {\r\n          const entityLabel = referrerEntityType?.replace('_', ' ') || 'entity'\r\n          setError(`Please select a ${entityLabel} for this investor role`)\r\n          return\r\n        }\r\n        if (!feePlansData?.can_dispatch) {\r\n          setError(feePlansData?.message || 'No accepted fee plan available for this entity')\r\n          return\r\n        }\r\n        if (!selectedFeePlanId) {\r\n          setError('Please select a fee plan')\r\n          return\r\n        }\r\n      }\r\n    } else if (category === 'introducer') {\r\n      // Introducer dispatch flow validation\r\n      if (!selectedAgreement) {\r\n        setError('Please select an active introducer agreement')\r\n        return\r\n      }\r\n      if (!selectedLinkableInvestorId) {\r\n        setError('Please select an investor to link to this introducer')\r\n        return\r\n      }\r\n    } else {\r\n      // Partner / Commercial Partner flow\r\n      if (!selectedEntity) {\r\n        setError(`Please select a ${category.replace('_', ' ')}`)\r\n        return\r\n      }\r\n      if (!feePlanName.trim()) {\r\n        setError('Please enter a fee plan name')\r\n        return\r\n      }\r\n    }\r\n\r\n    setLoading(true)\r\n    setError(null)\r\n\r\n    try {\r\n      if (category === 'investor') {\r\n        const requestBody: Record<string, any> = {\r\n          investor_id: selectedEntity.id,\r\n          role: investorRole,\r\n          send_notification: true,\r\n          term_sheet_id: selectedTermSheetId,\r\n        }\r\n\r\n        if (requiresReferrer && selectedReferringEntity && selectedFeePlanId) {\r\n          requestBody.referred_by_entity_id = selectedReferringEntity.id\r\n          requestBody.referred_by_entity_type = referrerEntityType\r\n          requestBody.assigned_fee_plan_id = selectedFeePlanId\r\n        }\r\n\r\n        const response = await fetch(`/api/deals/${dealId}/members`, {\r\n          method: 'POST',\r\n          headers: { 'Content-Type': 'application/json' },\r\n          body: JSON.stringify(requestBody),\r\n        })\r\n\r\n        if (!response.ok) {\r\n          const data = await response.json()\r\n          throw new Error(data.message || data.error || 'Failed to add investor')\r\n        }\r\n      } else if (category === 'introducer') {\r\n        // Introducer dispatch flow - link existing investor to introducer\r\n        const linkedInvestor = linkableInvestors.find(i => i.user_id === selectedLinkableInvestorId)\r\n        if (!linkedInvestor || !selectedAgreement) {\r\n          throw new Error('Invalid selection')\r\n        }\r\n\r\n        const response = await fetch(`/api/deals/${dealId}/members/${linkedInvestor.user_id}`, {\r\n          method: 'PATCH',\r\n          headers: { 'Content-Type': 'application/json' },\r\n          body: JSON.stringify({\r\n            referred_by_entity_id: selectedAgreement.introducer_id,\r\n            referred_by_entity_type: 'introducer',\r\n            assigned_fee_plan_id: selectedAgreement.fee_plan_id,\r\n            role: 'introducer_investor'\r\n          }),\r\n        })\r\n\r\n        if (!response.ok) {\r\n          const data = await response.json()\r\n          throw new Error(data.error || 'Failed to link investor to introducer')\r\n        }\r\n      } else {\r\n        // Partner / Commercial Partner flow\r\n        const response = await fetch(`/api/deals/${dealId}/partners`, {\r\n          method: 'POST',\r\n          headers: { 'Content-Type': 'application/json' },\r\n          body: JSON.stringify({\r\n            entity_type: category,\r\n            entity_id: selectedEntity.id,\r\n            fee_plan_name: feePlanName.trim(),\r\n            fee_components: feeComponents.filter(fc =>\r\n              (fc.rate_bps !== undefined && fc.rate_bps !== null) ||\r\n              (fc.flat_amount !== undefined && fc.flat_amount !== null)\r\n            ),\r\n          }),\r\n        })\r\n\r\n        if (!response.ok) {\r\n          const data = await response.json()\r\n          throw new Error(data.error || `Failed to add ${category.replace('_', ' ')}`)\r\n        }\r\n      }\r\n\r\n      setOpen(false)\r\n      onParticipantAdded?.()\r\n      router.refresh()\r\n    } catch (err: any) {\r\n      setError(err.message)\r\n    } finally {\r\n      setLoading(false)\r\n    }\r\n  }\r\n\r\n  const getEntityDisplayName = (entity: any) => {\r\n    return entity.legal_name || entity.name || 'Unknown'\r\n  }\r\n\r\n  const selectedCategoryInfo = PARTICIPANT_CATEGORIES.find(c => c.value === category)\r\n\r\n  // Get the entity list for current category\r\n  const getEntityListForCategory = () => {\r\n    if (category === 'investor') return investors\r\n    if (category === 'partner') return partners\r\n    if (category === 'introducer') return introducers\r\n    if (category === 'commercial_partner') return commercialPartners\r\n    return []\r\n  }\r\n\r\n  // Check if form is valid for submission\r\n  const isFormValid = () => {\r\n    if (!category) return false\r\n    if (category === 'investor') {\r\n      if (!selectedEntity) return false\r\n      if (!selectedTermSheetId) return false\r\n      if (requiresReferrer) {\r\n        if (!selectedReferringEntity) return false\r\n        if (!feePlansData?.can_dispatch) return false\r\n        if (!selectedFeePlanId) return false\r\n      }\r\n      return true\r\n    } else if (category === 'introducer') {\r\n      // Introducer dispatch flow validation\r\n      return !!(selectedAgreement && selectedLinkableInvestorId)\r\n    } else {\r\n      // Partner / Commercial Partner\r\n      return !!(selectedEntity && feePlanName.trim())\r\n    }\r\n  }\r\n\r\n  return (\r\n    <Dialog open={open} onOpenChange={setOpen}>\r\n      <DialogTrigger asChild>\r\n        <Button className=\"gap-2\">\r\n          <Plus className=\"h-4 w-4\" />\r\n          Add Participant\r\n        </Button>\r\n      </DialogTrigger>\r\n      <DialogContent className=\"max-w-2xl max-h-[90vh] overflow-y-auto\">\r\n        <DialogHeader>\r\n          <DialogTitle>Add Deal Participant</DialogTitle>\r\n          <DialogDescription>\r\n            Add an investor, partner, introducer, or commercial partner to this deal\r\n          </DialogDescription>\r\n        </DialogHeader>\r\n\r\n        <div className=\"space-y-6 py-4\">\r\n          {/* Step 1: Category Selection */}\r\n          <div className=\"space-y-3\">\r\n            <Label>Participant Type</Label>\r\n            <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-3\">\r\n              {PARTICIPANT_CATEGORIES.map((cat) => {\r\n                const Icon = cat.icon\r\n                const isSelected = category === cat.value\r\n                return (\r\n                  <button\r\n                    key={cat.value}\r\n                    type=\"button\"\r\n                    onClick={() => setCategory(cat.value)}\r\n                    className={cn(\r\n                      'p-4 rounded-lg border text-left transition-all',\r\n                      isSelected\r\n                        ? cat.color + ' border-2'\r\n                        : 'border-border hover:border-primary hover:bg-muted'\r\n                    )}\r\n                  >\r\n                    <div className=\"flex items-center gap-3\">\r\n                      <Icon className=\"h-5 w-5\" />\r\n                      <div>\r\n                        <div className=\"font-medium\">{cat.label}</div>\r\n                        <div className=\"text-xs text-muted-foreground\">{cat.description}</div>\r\n                      </div>\r\n                    </div>\r\n                  </button>\r\n                )\r\n              })}\r\n            </div>\r\n          </div>\r\n\r\n          {/* Step 2: Entity Selection Dropdown */}\r\n          {category && (\r\n            <>\r\n              <div className=\"space-y-2\">\r\n                <Label>Select {selectedCategoryInfo?.label}</Label>\r\n                {entitiesLoading ? (\r\n                  <div className=\"flex items-center gap-2 py-3\">\r\n                    <Loader2 className=\"h-4 w-4 animate-spin text-muted-foreground\" />\r\n                    <span className=\"text-sm text-muted-foreground\">Loading {selectedCategoryInfo?.label.toLowerCase()}s...</span>\r\n                  </div>\r\n                ) : getEntityListForCategory().length === 0 ? (\r\n                  <div className=\"p-3 rounded-lg border border-amber-500/30 bg-amber-500/5 text-amber-300 text-sm\">\r\n                    <div className=\"flex items-center gap-2\">\r\n                      <AlertCircle className=\"h-4 w-4\" />\r\n                      <span>No {selectedCategoryInfo?.label.toLowerCase()}s available.</span>\r\n                    </div>\r\n                  </div>\r\n                ) : (\r\n                  <Select value={selectedEntityId} onValueChange={setSelectedEntityId}>\r\n                    <SelectTrigger className={cn(selectedEntity && selectedCategoryInfo?.color)}>\r\n                      <SelectValue placeholder={`Select a ${selectedCategoryInfo?.label.toLowerCase()}`} />\r\n                    </SelectTrigger>\r\n                    <SelectContent>\r\n                      {getEntityListForCategory().map((entity) => (\r\n                        <SelectItem key={entity.id} value={entity.id}>\r\n                          <div className=\"flex flex-col\">\r\n                            <span>{getEntityDisplayName(entity)}</span>\r\n                            {entity.contact_email && (\r\n                              <span className=\"text-xs text-muted-foreground\">{entity.contact_email}</span>\r\n                            )}\r\n                          </div>\r\n                        </SelectItem>\r\n                      ))}\r\n                    </SelectContent>\r\n                  </Select>\r\n                )}\r\n              </div>\r\n\r\n              {/* Investor Role Selection */}\r\n              {category === 'investor' && selectedEntity && (\r\n                <div className=\"space-y-2\">\r\n                  <Label>Role</Label>\r\n                  <Select value={investorRole} onValueChange={setInvestorRole}>\r\n                    <SelectTrigger>\r\n                      <SelectValue />\r\n                    </SelectTrigger>\r\n                    <SelectContent>\r\n                      {INVESTOR_ROLES.map((role) => (\r\n                        <SelectItem key={role.value} value={role.value}>\r\n                          {role.label}\r\n                        </SelectItem>\r\n                      ))}\r\n                    </SelectContent>\r\n                  </Select>\r\n                </div>\r\n              )}\r\n\r\n              {/* Term Sheet Selection - Required for ALL investors */}\r\n              {category === 'investor' && selectedEntity && (\r\n                <div className=\"space-y-2\">\r\n                  <Label>Term Sheet (Investor Class) *</Label>\r\n                  {termSheetsLoading ? (\r\n                    <div className=\"flex items-center gap-2 py-3\">\r\n                      <Loader2 className=\"h-4 w-4 animate-spin text-muted-foreground\" />\r\n                      <span className=\"text-sm text-muted-foreground\">Loading term sheets...</span>\r\n                    </div>\r\n                  ) : publishedTermSheets.length === 0 ? (\r\n                    <div className=\"p-3 rounded-lg border border-amber-500/30 bg-amber-500/5 text-amber-300 text-sm\">\r\n                      <div className=\"flex items-center gap-2\">\r\n                        <AlertCircle className=\"h-4 w-4\" />\r\n                        <span>No published term sheets available. Please publish a term sheet first.</span>\r\n                      </div>\r\n                    </div>\r\n                  ) : (\r\n                    <Select value={selectedTermSheetId} onValueChange={setSelectedTermSheetId}>\r\n                      <SelectTrigger>\r\n                        <SelectValue placeholder=\"Select term sheet\" />\r\n                      </SelectTrigger>\r\n                      <SelectContent>\r\n                        {publishedTermSheets.map((ts) => (\r\n                          <SelectItem key={ts.id} value={ts.id}>\r\n                            v{ts.version} — {ts.subscription_fee_percent ?? 0}% sub / {ts.management_fee_percent ?? 0}% mgmt / {ts.carried_interest_percent ?? 0}% carry\r\n                          </SelectItem>\r\n                        ))}\r\n                      </SelectContent>\r\n                    </Select>\r\n                  )}\r\n                </div>\r\n              )}\r\n\r\n              {/* Referring Entity Selection - for roles requiring an introducer/partner/commercial_partner */}\r\n              {category === 'investor' && selectedEntity && requiresReferrer && (\r\n                <div className=\"space-y-3 p-4 rounded-lg border border-amber-500/30 bg-amber-500/5\">\r\n                  <div className=\"flex items-center gap-2\">\r\n                    <AlertCircle className=\"h-4 w-4 text-amber-400\" />\r\n                    <Label className=\"text-amber-300\">\r\n                      Referring {referrerEntityType?.replace('_', ' ')} Required\r\n                    </Label>\r\n                  </div>\r\n\r\n                  <Select value={selectedReferringEntityId} onValueChange={setSelectedReferringEntityId}>\r\n                    <SelectTrigger>\r\n                      <SelectValue placeholder={`Select ${referrerEntityType?.replace('_', ' ')}`} />\r\n                    </SelectTrigger>\r\n                    <SelectContent>\r\n                      {getReferringEntityList().map((entity) => (\r\n                        <SelectItem key={entity.id} value={entity.id}>\r\n                          {getEntityDisplayName(entity)}\r\n                        </SelectItem>\r\n                      ))}\r\n                    </SelectContent>\r\n                  </Select>\r\n\r\n                  {/* Term sheet required message */}\r\n                  {selectedReferringEntity && !selectedTermSheetId && (\r\n                    <div className=\"p-3 rounded-lg bg-blue-500/10 border border-blue-500/30\">\r\n                      <div className=\"flex items-start gap-2\">\r\n                        <AlertCircle className=\"h-4 w-4 text-blue-400 mt-0.5\" />\r\n                        <div>\r\n                          <p className=\"text-sm text-blue-300 font-medium\">Term Sheet Required</p>\r\n                          <p className=\"text-xs text-blue-300/80 mt-1\">\r\n                            Please select a term sheet above first. Fee plans are linked to specific term sheets.\r\n                          </p>\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  )}\r\n\r\n                  {/* Fee Plan Selection */}\r\n                  {selectedReferringEntity && selectedTermSheetId && feePlansLoading && (\r\n                    <div className=\"flex items-center gap-2 py-3\">\r\n                      <Loader2 className=\"h-4 w-4 animate-spin text-muted-foreground\" />\r\n                      <span className=\"text-sm text-muted-foreground\">Loading fee plans...</span>\r\n                    </div>\r\n                  )}\r\n\r\n                  {selectedReferringEntity && selectedTermSheetId && !feePlansLoading && feePlansData && !feePlansData.can_dispatch && (\r\n                    <div className=\"p-3 rounded-lg bg-destructive/10 border border-destructive/30\">\r\n                      <div className=\"flex items-start gap-2\">\r\n                        <AlertCircle className=\"h-4 w-4 text-destructive mt-0.5\" />\r\n                        <div>\r\n                          <p className=\"text-sm text-destructive font-medium\">Cannot Dispatch</p>\r\n                          <p className=\"text-xs text-destructive/80 mt-1\">\r\n                            {feePlansData.message || 'No accepted fee plan available for this term sheet'}\r\n                          </p>\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  )}\r\n\r\n                  {selectedReferringEntity && selectedTermSheetId && !feePlansLoading && feePlansData && feePlansData.can_dispatch && (\r\n                    <div className=\"space-y-2\">\r\n                      <Label>Fee Plan</Label>\r\n                      <Select value={selectedFeePlanId} onValueChange={setSelectedFeePlanId}>\r\n                        <SelectTrigger>\r\n                          <SelectValue placeholder=\"Select fee plan\" />\r\n                        </SelectTrigger>\r\n                        <SelectContent>\r\n                          {feePlansData.accepted_plans.map((plan) => (\r\n                            <SelectItem key={plan.id} value={plan.id}>\r\n                              <div className=\"flex items-center gap-2\">\r\n                                <span>{plan.name}</span>\r\n                                {plan.is_default && (\r\n                                  <span className=\"text-xs bg-primary/20 text-primary px-1.5 py-0.5 rounded\">\r\n                                    Default\r\n                                  </span>\r\n                                )}\r\n                              </div>\r\n                            </SelectItem>\r\n                          ))}\r\n                        </SelectContent>\r\n                      </Select>\r\n\r\n                      {/* Display selected fee plan details */}\r\n                      {selectedFeePlanId && (\r\n                        <div className=\"p-2 rounded bg-muted/30 text-xs space-y-1\">\r\n                          {feePlansData.accepted_plans\r\n                            .find(p => p.id === selectedFeePlanId)\r\n                            ?.fee_components.map((fc, idx) => (\r\n                              <div key={idx} className=\"flex justify-between\">\r\n                                <span className=\"text-muted-foreground capitalize\">\r\n                                  {fc.kind.replace('_', ' ')}\r\n                                </span>\r\n                                <span>\r\n                                  {fc.rate_bps !== undefined\r\n                                    ? `${(fc.rate_bps / 100).toFixed(2)}%`\r\n                                    : fc.flat_amount !== undefined\r\n                                      ? `$${fc.flat_amount.toLocaleString()}`\r\n                                      : '-'}\r\n                                </span>\r\n                              </div>\r\n                            ))}\r\n                        </div>\r\n                      )}\r\n                    </div>\r\n                  )}\r\n                </div>\r\n              )}\r\n\r\n              {/* Fee Plan for entities (partner/commercial_partner only - introducer uses dispatch flow) */}\r\n              {category !== 'investor' && category !== 'introducer' && selectedEntity && (\r\n                <>\r\n                  <div className=\"space-y-2\">\r\n                    <Label>Fee Plan Name</Label>\r\n                    <Input\r\n                      value={feePlanName}\r\n                      onChange={(e) => setFeePlanName(e.target.value)}\r\n                      placeholder=\"e.g., Standard Partner Fee\"\r\n                    />\r\n                  </div>\r\n\r\n                  <div className=\"space-y-3\">\r\n                    <div className=\"flex items-center justify-between\">\r\n                      <Label>Fee Components</Label>\r\n                      <Button\r\n                        type=\"button\"\r\n                        variant=\"ghost\"\r\n                        size=\"sm\"\r\n                        onClick={handleAddFeeComponent}\r\n                        className=\"gap-1 text-xs\"\r\n                      >\r\n                        <Plus className=\"h-3 w-3\" />\r\n                        Add\r\n                      </Button>\r\n                    </div>\r\n\r\n                    <div className=\"space-y-2\">\r\n                      {feeComponents.map((fc, idx) => (\r\n                        <div key={idx} className=\"flex items-center gap-2 p-3 rounded-md bg-muted/50\">\r\n                          <Select\r\n                            value={fc.kind}\r\n                            onValueChange={(v) => handleFeeComponentChange(idx, 'kind', v)}\r\n                          >\r\n                            <SelectTrigger className=\"w-36\">\r\n                              <SelectValue />\r\n                            </SelectTrigger>\r\n                            <SelectContent>\r\n                              {FEE_KINDS.map((k) => (\r\n                                <SelectItem key={k.value} value={k.value}>\r\n                                  {k.label}\r\n                                </SelectItem>\r\n                              ))}\r\n                            </SelectContent>\r\n                          </Select>\r\n\r\n                          <Input\r\n                            type=\"number\"\r\n                            step=\"0.01\"\r\n                            placeholder=\"Rate %\"\r\n                            value={fc.rate_bps !== undefined && fc.rate_bps !== null ? fc.rate_bps / 100 : ''}\r\n                            onChange={(e) =>\r\n                              handleFeeComponentChange(\r\n                                idx,\r\n                                'rate_bps',\r\n                                e.target.value ? parseFloat(e.target.value) * 100 : undefined\r\n                              )\r\n                            }\r\n                            className=\"w-20\"\r\n                          />\r\n                          <span className=\"text-xs text-muted-foreground\">or</span>\r\n                          <Input\r\n                            type=\"number\"\r\n                            step=\"0.01\"\r\n                            placeholder=\"Flat $\"\r\n                            value={fc.flat_amount !== undefined && fc.flat_amount !== null ? fc.flat_amount : ''}\r\n                            onChange={(e) =>\r\n                              handleFeeComponentChange(\r\n                                idx,\r\n                                'flat_amount',\r\n                                e.target.value ? parseFloat(e.target.value) : undefined\r\n                              )\r\n                            }\r\n                            className=\"w-20\"\r\n                          />\r\n\r\n                          {feeComponents.length > 1 && (\r\n                            <Button\r\n                              type=\"button\"\r\n                              variant=\"ghost\"\r\n                              size=\"icon\"\r\n                              onClick={() => handleRemoveFeeComponent(idx)}\r\n                              className=\"h-8 w-8 text-destructive\"\r\n                            >\r\n                              <Trash2 className=\"h-4 w-4\" />\r\n                            </Button>\r\n                          )}\r\n                        </div>\r\n                      ))}\r\n                    </div>\r\n                  </div>\r\n                </>\r\n              )}\r\n            </>\r\n          )}\r\n\r\n          {/* Introducer Dispatch Flow - Shows AFTER an introducer is selected */}\r\n          {category === 'introducer' && selectedEntity && (\r\n            <div className=\"space-y-4 p-4 rounded-lg border border-orange-500/30 bg-orange-500/5\">\r\n              <div className=\"flex items-center gap-2\">\r\n                <Users className=\"h-5 w-5 text-orange-400\" />\r\n                <div>\r\n                  <h4 className=\"font-medium text-orange-300\">Link Investor to {getEntityDisplayName(selectedEntity)}</h4>\r\n                  <p className=\"text-xs text-muted-foreground\">\r\n                    Select an active agreement, then choose an investor to link\r\n                  </p>\r\n                </div>\r\n              </div>\r\n\r\n              {/* Step 2: Select Active Agreement for this introducer */}\r\n              <div className=\"space-y-2\">\r\n                <Label>Select Agreement (Term Sheet)</Label>\r\n                {activeAgreementsLoading ? (\r\n                  <div className=\"flex items-center gap-2 py-3\">\r\n                    <Loader2 className=\"h-4 w-4 animate-spin text-muted-foreground\" />\r\n                    <span className=\"text-sm text-muted-foreground\">Loading agreements...</span>\r\n                  </div>\r\n                ) : activeAgreements.length === 0 ? (\r\n                  <div className=\"p-3 rounded-lg border border-amber-500/30 bg-amber-500/5 text-amber-300 text-sm\">\r\n                    <div className=\"flex items-start gap-2\">\r\n                      <AlertCircle className=\"h-4 w-4 mt-0.5\" />\r\n                      <div>\r\n                        <p className=\"font-medium\">No active agreements for this introducer</p>\r\n                        <p className=\"text-xs text-amber-300/80 mt-1\">\r\n                          {getEntityDisplayName(selectedEntity)} has no signed agreements on this deal.\r\n                          Create and sign an introducer agreement in the Introducers tab first.\r\n                        </p>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                ) : (\r\n                  <Select value={selectedAgreementId} onValueChange={setSelectedAgreementId}>\r\n                    <SelectTrigger className={cn(selectedAgreement && 'border-orange-500/50')}>\r\n                      <SelectValue placeholder=\"Select an agreement\" />\r\n                    </SelectTrigger>\r\n                    <SelectContent>\r\n                      {activeAgreements.map((agreement) => (\r\n                        <SelectItem key={agreement.id} value={agreement.id}>\r\n                          <div className=\"flex flex-col\">\r\n                            <span className=\"font-medium\">{agreement.fee_plan_name}</span>\r\n                            <span className=\"text-xs text-muted-foreground\">\r\n                              Term Sheet v{agreement.term_sheet_version} {agreement.reference_number ? `• ${agreement.reference_number}` : ''}\r\n                            </span>\r\n                          </div>\r\n                        </SelectItem>\r\n                      ))}\r\n                    </SelectContent>\r\n                  </Select>\r\n                )}\r\n              </div>\r\n\r\n              {/* Step 3: Select Investor (shown after agreement is selected) */}\r\n              {selectedAgreement && (\r\n                <div className=\"space-y-2\">\r\n                  <Label>Select Investor to Link</Label>\r\n                  {linkableInvestorsLoading ? (\r\n                    <div className=\"flex items-center gap-2 py-3\">\r\n                      <Loader2 className=\"h-4 w-4 animate-spin text-muted-foreground\" />\r\n                      <span className=\"text-sm text-muted-foreground\">Loading eligible investors...</span>\r\n                    </div>\r\n                  ) : linkableInvestors.length === 0 ? (\r\n                    <div className=\"p-3 rounded-lg border border-blue-500/30 bg-blue-500/5 text-blue-300 text-sm\">\r\n                      <div className=\"flex items-start gap-2\">\r\n                        <AlertCircle className=\"h-4 w-4 mt-0.5\" />\r\n                        <div>\r\n                          <p className=\"font-medium\">No eligible investors</p>\r\n                          <p className=\"text-xs text-blue-300/80 mt-1\">\r\n                            No investors on Term Sheet v{selectedAgreement.term_sheet_version} are available to link.\r\n                            They may already be linked to an introducer, or you need to add investors to this term sheet first.\r\n                          </p>\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  ) : (\r\n                    <Select value={selectedLinkableInvestorId} onValueChange={setSelectedLinkableInvestorId}>\r\n                      <SelectTrigger className={cn(selectedLinkableInvestorId && 'border-orange-500/50')}>\r\n                        <SelectValue placeholder=\"Select an investor\" />\r\n                      </SelectTrigger>\r\n                      <SelectContent>\r\n                        {linkableInvestors.map((investor) => (\r\n                          <SelectItem key={investor.user_id} value={investor.user_id}>\r\n                            <div className=\"flex flex-col\">\r\n                              <span>{investor.display_name}</span>\r\n                              {investor.email && (\r\n                                <span className=\"text-xs text-muted-foreground\">{investor.email}</span>\r\n                              )}\r\n                            </div>\r\n                          </SelectItem>\r\n                        ))}\r\n                      </SelectContent>\r\n                    </Select>\r\n                  )}\r\n                </div>\r\n              )}\r\n\r\n              {/* Summary of what will happen */}\r\n              {selectedAgreement && selectedLinkableInvestorId && (\r\n                <div className=\"p-3 rounded-lg bg-emerald-500/10 border border-emerald-500/30\">\r\n                  <div className=\"flex items-start gap-2\">\r\n                    <div className=\"text-emerald-400 mt-0.5\">✓</div>\r\n                    <div className=\"text-sm\">\r\n                      <p className=\"text-emerald-300 font-medium\">Ready to link</p>\r\n                      <p className=\"text-emerald-300/80 text-xs mt-1\">\r\n                        This investor will be linked to <strong>{getEntityDisplayName(selectedEntity)}</strong> using\r\n                        the <strong>{selectedAgreement.fee_plan_name}</strong> fee plan (Term Sheet v{selectedAgreement.term_sheet_version}).\r\n                      </p>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              )}\r\n            </div>\r\n          )}\r\n\r\n          {/* Error Display */}\r\n          {error && (\r\n            <div className=\"p-3 rounded-lg bg-destructive/10 text-destructive text-sm\">\r\n              {error}\r\n            </div>\r\n          )}\r\n\r\n          {/* Actions */}\r\n          <div className=\"flex justify-end gap-2 pt-4\">\r\n            <Button variant=\"outline\" onClick={() => setOpen(false)} disabled={loading}>\r\n              Cancel\r\n            </Button>\r\n            <Button\r\n              onClick={handleSubmit}\r\n              disabled={loading || !isFormValid()}\r\n            >\r\n              {loading ? (\r\n                <>\r\n                  <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\r\n                  {category === 'introducer' ? 'Linking...' : 'Adding...'}\r\n                </>\r\n              ) : category === 'introducer' ? (\r\n                'Link Investor to Introducer'\r\n              ) : (\r\n                `Add ${selectedCategoryInfo?.label || 'Participant'}`\r\n              )}\r\n            </Button>\r\n          </div>\r\n        </div>\r\n      </DialogContent>\r\n    </Dialog>\r\n  )\r\n}\r\n"],"names":[],"mappings":"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"}}]
}