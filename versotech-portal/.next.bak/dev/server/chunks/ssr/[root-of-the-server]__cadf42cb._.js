module.exports = [
"[project]/versotech-portal/src/app/favicon.ico.mjs { IMAGE => \"[project]/versotech-portal/src/app/favicon.ico (static in ecmascript, tag client)\" } [app-rsc] (structured image object, ecmascript, Next.js Server Component)", ((__turbopack_context__) => {

__turbopack_context__.n(__turbopack_context__.i("[project]/versotech-portal/src/app/favicon.ico.mjs { IMAGE => \"[project]/versotech-portal/src/app/favicon.ico (static in ecmascript, tag client)\" } [app-rsc] (structured image object, ecmascript)"));
}),
"[externals]/next/dist/shared/lib/no-fallback-error.external.js [external] (next/dist/shared/lib/no-fallback-error.external.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/shared/lib/no-fallback-error.external.js", () => require("next/dist/shared/lib/no-fallback-error.external.js"));

module.exports = mod;
}),
"[project]/versotech-portal/src/app/layout.tsx [app-rsc] (ecmascript, Next.js Server Component)", ((__turbopack_context__) => {

__turbopack_context__.n(__turbopack_context__.i("[project]/versotech-portal/src/app/layout.tsx [app-rsc] (ecmascript)"));
}),
"[project]/versotech-portal/src/app/(main)/versotech_main/layout.tsx [app-rsc] (ecmascript, Next.js Server Component)", ((__turbopack_context__) => {

__turbopack_context__.n(__turbopack_context__.i("[project]/versotech-portal/src/app/(main)/versotech_main/layout.tsx [app-rsc] (ecmascript)"));
}),
"[project]/versotech-portal/src/app/(main)/versotech_main/dashboard/ceo-dashboard.tsx [app-rsc] (client reference proxy) <module evaluation>", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "CEODashboard",
    ()=>CEODashboard
]);
// This file is generated by next-core EcmascriptClientReferenceModule.
var __TURBOPACK__imported__module__$5b$project$5d2f$versotech$2d$portal$2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$rsc$2f$react$2d$server$2d$dom$2d$turbopack$2d$server$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/versotech-portal/node_modules/next/dist/server/route-modules/app-page/vendored/rsc/react-server-dom-turbopack-server.js [app-rsc] (ecmascript)");
;
const CEODashboard = (0, __TURBOPACK__imported__module__$5b$project$5d2f$versotech$2d$portal$2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$rsc$2f$react$2d$server$2d$dom$2d$turbopack$2d$server$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["registerClientReference"])(function() {
    throw new Error("Attempted to call CEODashboard() from the server but CEODashboard is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.");
}, "[project]/versotech-portal/src/app/(main)/versotech_main/dashboard/ceo-dashboard.tsx <module evaluation>", "CEODashboard");
}),
"[project]/versotech-portal/src/app/(main)/versotech_main/dashboard/ceo-dashboard.tsx [app-rsc] (client reference proxy)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "CEODashboard",
    ()=>CEODashboard
]);
// This file is generated by next-core EcmascriptClientReferenceModule.
var __TURBOPACK__imported__module__$5b$project$5d2f$versotech$2d$portal$2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$rsc$2f$react$2d$server$2d$dom$2d$turbopack$2d$server$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/versotech-portal/node_modules/next/dist/server/route-modules/app-page/vendored/rsc/react-server-dom-turbopack-server.js [app-rsc] (ecmascript)");
;
const CEODashboard = (0, __TURBOPACK__imported__module__$5b$project$5d2f$versotech$2d$portal$2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$rsc$2f$react$2d$server$2d$dom$2d$turbopack$2d$server$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["registerClientReference"])(function() {
    throw new Error("Attempted to call CEODashboard() from the server but CEODashboard is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.");
}, "[project]/versotech-portal/src/app/(main)/versotech_main/dashboard/ceo-dashboard.tsx", "CEODashboard");
}),
"[project]/versotech-portal/src/app/(main)/versotech_main/dashboard/ceo-dashboard.tsx [app-rsc] (ecmascript)", ((__turbopack_context__) => {
"use strict";

var __TURBOPACK__imported__module__$5b$project$5d2f$versotech$2d$portal$2f$src$2f$app$2f28$main$292f$versotech_main$2f$dashboard$2f$ceo$2d$dashboard$2e$tsx__$5b$app$2d$rsc$5d$__$28$client__reference__proxy$29$__$3c$module__evaluation$3e$__ = __turbopack_context__.i("[project]/versotech-portal/src/app/(main)/versotech_main/dashboard/ceo-dashboard.tsx [app-rsc] (client reference proxy) <module evaluation>");
var __TURBOPACK__imported__module__$5b$project$5d2f$versotech$2d$portal$2f$src$2f$app$2f28$main$292f$versotech_main$2f$dashboard$2f$ceo$2d$dashboard$2e$tsx__$5b$app$2d$rsc$5d$__$28$client__reference__proxy$29$__ = __turbopack_context__.i("[project]/versotech-portal/src/app/(main)/versotech_main/dashboard/ceo-dashboard.tsx [app-rsc] (client reference proxy)");
;
__turbopack_context__.n(__TURBOPACK__imported__module__$5b$project$5d2f$versotech$2d$portal$2f$src$2f$app$2f28$main$292f$versotech_main$2f$dashboard$2f$ceo$2d$dashboard$2e$tsx__$5b$app$2d$rsc$5d$__$28$client__reference__proxy$29$__);
}),
"[project]/versotech-portal/src/app/(main)/versotech_main/dashboard/persona-dashboard.tsx [app-rsc] (client reference proxy) <module evaluation>", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "PersonaDashboard",
    ()=>PersonaDashboard
]);
// This file is generated by next-core EcmascriptClientReferenceModule.
var __TURBOPACK__imported__module__$5b$project$5d2f$versotech$2d$portal$2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$rsc$2f$react$2d$server$2d$dom$2d$turbopack$2d$server$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/versotech-portal/node_modules/next/dist/server/route-modules/app-page/vendored/rsc/react-server-dom-turbopack-server.js [app-rsc] (ecmascript)");
;
const PersonaDashboard = (0, __TURBOPACK__imported__module__$5b$project$5d2f$versotech$2d$portal$2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$rsc$2f$react$2d$server$2d$dom$2d$turbopack$2d$server$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["registerClientReference"])(function() {
    throw new Error("Attempted to call PersonaDashboard() from the server but PersonaDashboard is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.");
}, "[project]/versotech-portal/src/app/(main)/versotech_main/dashboard/persona-dashboard.tsx <module evaluation>", "PersonaDashboard");
}),
"[project]/versotech-portal/src/app/(main)/versotech_main/dashboard/persona-dashboard.tsx [app-rsc] (client reference proxy)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "PersonaDashboard",
    ()=>PersonaDashboard
]);
// This file is generated by next-core EcmascriptClientReferenceModule.
var __TURBOPACK__imported__module__$5b$project$5d2f$versotech$2d$portal$2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$rsc$2f$react$2d$server$2d$dom$2d$turbopack$2d$server$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/versotech-portal/node_modules/next/dist/server/route-modules/app-page/vendored/rsc/react-server-dom-turbopack-server.js [app-rsc] (ecmascript)");
;
const PersonaDashboard = (0, __TURBOPACK__imported__module__$5b$project$5d2f$versotech$2d$portal$2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$rsc$2f$react$2d$server$2d$dom$2d$turbopack$2d$server$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["registerClientReference"])(function() {
    throw new Error("Attempted to call PersonaDashboard() from the server but PersonaDashboard is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.");
}, "[project]/versotech-portal/src/app/(main)/versotech_main/dashboard/persona-dashboard.tsx", "PersonaDashboard");
}),
"[project]/versotech-portal/src/app/(main)/versotech_main/dashboard/persona-dashboard.tsx [app-rsc] (ecmascript)", ((__turbopack_context__) => {
"use strict";

var __TURBOPACK__imported__module__$5b$project$5d2f$versotech$2d$portal$2f$src$2f$app$2f28$main$292f$versotech_main$2f$dashboard$2f$persona$2d$dashboard$2e$tsx__$5b$app$2d$rsc$5d$__$28$client__reference__proxy$29$__$3c$module__evaluation$3e$__ = __turbopack_context__.i("[project]/versotech-portal/src/app/(main)/versotech_main/dashboard/persona-dashboard.tsx [app-rsc] (client reference proxy) <module evaluation>");
var __TURBOPACK__imported__module__$5b$project$5d2f$versotech$2d$portal$2f$src$2f$app$2f28$main$292f$versotech_main$2f$dashboard$2f$persona$2d$dashboard$2e$tsx__$5b$app$2d$rsc$5d$__$28$client__reference__proxy$29$__ = __turbopack_context__.i("[project]/versotech-portal/src/app/(main)/versotech_main/dashboard/persona-dashboard.tsx [app-rsc] (client reference proxy)");
;
__turbopack_context__.n(__TURBOPACK__imported__module__$5b$project$5d2f$versotech$2d$portal$2f$src$2f$app$2f28$main$292f$versotech_main$2f$dashboard$2f$persona$2d$dashboard$2e$tsx__$5b$app$2d$rsc$5d$__$28$client__reference__proxy$29$__);
}),
"[project]/versotech-portal/src/lib/staff/dashboard-data.ts [app-rsc] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "getStaffDashboardData",
    ()=>getStaffDashboardData
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$versotech$2d$portal$2f$src$2f$lib$2f$supabase$2f$server$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/versotech-portal/src/lib/supabase/server.ts [app-rsc] (ecmascript)");
;
const startOfMonthISO = ()=>{
    const now = new Date();
    return new Date(Date.UTC(now.getUTCFullYear(), now.getUTCMonth(), 1)).toISOString();
};
const twelveMonthsAgoISO = ()=>{
    const now = new Date();
    now.setFullYear(now.getFullYear() - 1);
    return now.toISOString();
};
async function fetchCount(queryPromise, metricName) {
    try {
        const { count, error } = await queryPromise;
        if (error) {
            console.error(`[dashboard-data] Error fetching ${metricName}:`, error.message);
            return {
                count: null,
                error: error.message
            };
        }
        return {
            count: count ?? 0,
            error: null
        };
    } catch (error) {
        const errorMsg = error instanceof Error ? error.message : 'Unknown error';
        console.error(`[dashboard-data] Exception fetching ${metricName}:`, errorMsg);
        return {
            count: null,
            error: errorMsg
        };
    }
}
// SQL-based aggregation for fee events (replaces JavaScript aggregation)
async function getFeeChartData(supabase, startDate) {
    const { data, error } = await supabase.rpc('aggregate_fee_events_by_date', {
        start_date: startDate
    });
    if (error) {
        console.error('[dashboard-data] Error fetching aggregated fee data:', error);
        // Fallback to manual aggregation if RPC doesn't exist
        return {
            data: null,
            error
        };
    }
    return {
        data,
        error: null
    };
}
// SQL-based aggregation for subscriptions (replaces JavaScript aggregation)
async function getSubscriptionChartData(supabase, startDate) {
    const { data, error } = await supabase.rpc('aggregate_subscriptions_by_date', {
        start_date: startDate
    });
    if (error) {
        console.error('[dashboard-data] Error fetching aggregated subscription data:', error);
        // Fallback to manual aggregation if RPC doesn't exist
        return {
            data: null,
            error
        };
    }
    return {
        data,
        error: null
    };
}
// Fallback: Helper to aggregate data by date if SQL aggregation fails
function aggregateByDate(data, dateKey, amountKey) {
    const map = new Map();
    data.forEach((item)=>{
        if (!item[dateKey]) return;
        // Ensure we use the date part only, handling potential timezones by taking the ISO date string directly
        const date = new Date(item[dateKey]).toISOString().split('T')[0];
        const amount = Number(item[amountKey]) || 0;
        if (!map.has(date)) {
            map.set(date, {
                date,
                amount: 0
            });
        }
        const entry = map.get(date);
        entry.amount += amount;
    });
    return Array.from(map.values()).sort((a, b)=>a.date.localeCompare(b.date));
}
async function getStaffDashboardData(dateRangeFilter) {
    // Note: Auth validation is handled in the page component before calling this function
    // Use service role client here because:
    // 1. This function is called within unstable_cache() which cannot access cookies
    // 2. Auth is already validated in the page component
    // 3. Dashboard data is not user-specific - it shows all data for staff admins
    const supabase = (0, __TURBOPACK__imported__module__$5b$project$5d2f$versotech$2d$portal$2f$src$2f$lib$2f$supabase$2f$server$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["createServiceClient"])();
    const errors = [];
    const startOfMonth = startOfMonthISO();
    // Use provided date range or default to 12 months ago
    const chartStartDate = dateRangeFilter?.from ? new Date(dateRangeFilter.from).toISOString() : twelveMonthsAgoISO();
    const [activeLpsRes, pendingKycRes, highPriorityKycRes, workflowRunsRes, totalInvestorsRes, compliantInvestorsRes, workflowsRes, dealsRes, requestsRes, // Replaced generic activity feed with specific business logic queries
    latestFeesRes, latestSubscriptionsRes, latestInvestorsRes, feesRes, subscriptionsRes] = await Promise.all([
        fetchCount(supabase.from('investors').select('id', {
            head: true,
            count: 'exact'
        }).eq('status', 'active'), 'Active LPs'),
        fetchCount(supabase.from('investors').select('id', {
            head: true,
            count: 'exact'
        }).in('kyc_status', [
            'pending',
            'review',
            'completed'
        ]), 'Pending KYC'),
        fetchCount(supabase.from('tasks').select('id', {
            head: true,
            count: 'exact'
        }).in('kind', [
            'kyc_individual',
            'kyc_entity',
            'kyc_aml_check',
            'onboarding_profile',
            'compliance_tax_forms'
        ]).in('status', [
            'pending',
            'in_progress'
        ]).eq('priority', 'high'), 'High Priority KYC'),
        fetchCount(supabase.from('workflow_runs').select('id', {
            head: true,
            count: 'exact'
        }).gte('created_at', startOfMonth), 'Workflow Runs (MTD)'),
        fetchCount(supabase.from('investors').select('id', {
            head: true,
            count: 'exact'
        }), 'Total Investors'),
        fetchCount(supabase.from('investors').select('id', {
            head: true,
            count: 'exact'
        }).eq('kyc_status', 'approved'), 'Compliant Investors'),
        fetchCount(supabase.from('workflows').select('id', {
            head: true,
            count: 'exact'
        }).eq('is_active', true), 'Active Workflows'),
        fetchCount(supabase.from('deals').select('id', {
            head: true,
            count: 'exact'
        }).in('status', [
            'open',
            'allocation_pending',
            'draft'
        ]), 'Active Deals'),
        fetchCount(supabase.from('request_tickets').select('id', {
            head: true,
            count: 'exact'
        }).in('status', [
            'open',
            'assigned',
            'in_progress'
        ]), 'Active Requests'),
        // 1. Latest Fees
        supabase.from('fee_events').select('id, computed_amount, fee_type, created_at').order('created_at', {
            ascending: false
        }).limit(5),
        // 2. Latest Subscriptions
        supabase.from('subscriptions').select('id, commitment, status, created_at').order('created_at', {
            ascending: false
        }).limit(5),
        // 3. Latest Investors (e.g. newly approved)
        supabase.from('investors').select('id, status, kyc_status, created_at').order('created_at', {
            ascending: false
        }).limit(5),
        // Chart Data - Try SQL aggregation first, fallback to full data fetch
        getFeeChartData(supabase, chartStartDate),
        getSubscriptionChartData(supabase, chartStartDate)
    ]);
    // Collect errors with specific metric names
    if (latestFeesRes.error) {
        errors.push({
            metric: 'Latest Fees',
            message: latestFeesRes.error.message
        });
    }
    if (latestSubscriptionsRes.error) {
        errors.push({
            metric: 'Latest Subscriptions',
            message: latestSubscriptionsRes.error.message
        });
    }
    if (latestInvestorsRes.error) {
        errors.push({
            metric: 'Latest Investors',
            message: latestInvestorsRes.error.message
        });
    }
    const totalInvestors = totalInvestorsRes.count ?? 0;
    const compliantInvestors = compliantInvestorsRes.count ?? 0;
    const complianceRate = totalInvestors > 0 ? compliantInvestors / totalInvestors * 100 : null;
    // Process chart data with fallback
    let aggregatedFees = [];
    let aggregatedSubscriptions = [];
    // Fees chart data
    if (feesRes.error) {
        errors.push({
            metric: 'Fee Chart Data',
            message: feesRes.error.message
        });
        // Try fallback: fetch raw data and aggregate in JavaScript
        const fallbackFees = await supabase.from('fee_events').select('computed_amount, created_at, fee_type').gte('created_at', chartStartDate).order('created_at', {
            ascending: true
        });
        if (!fallbackFees.error && fallbackFees.data) {
            aggregatedFees = aggregateByDate(fallbackFees.data, 'created_at', 'computed_amount');
        }
    } else {
        aggregatedFees = feesRes.data ?? [];
    }
    // Subscriptions chart data
    if (subscriptionsRes.error) {
        errors.push({
            metric: 'Subscription Chart Data',
            message: subscriptionsRes.error.message
        });
        // Try fallback: fetch raw data and aggregate in JavaScript
        const fallbackSubs = await supabase.from('subscriptions').select('commitment, created_at, status').gte('created_at', chartStartDate).order('created_at', {
            ascending: true
        });
        if (!fallbackSubs.error && fallbackSubs.data) {
            aggregatedSubscriptions = aggregateByDate(fallbackSubs.data, 'created_at', 'commitment');
        }
    } else {
        aggregatedSubscriptions = subscriptionsRes.data ?? [];
    }
    // Build Recent Activity
    const activities = [];
    // Add Fees
    latestFeesRes.data?.forEach((fee)=>{
        activities.push({
            id: fee.id,
            title: 'Fee Calculated',
            description: `${fee.fee_type} fee of $${fee.computed_amount?.toLocaleString()}`,
            activityType: 'fee',
            createdAt: fee.created_at,
            amount: fee.computed_amount,
            status: 'processed'
        });
    });
    // Add Subscriptions
    latestSubscriptionsRes.data?.forEach((sub)=>{
        activities.push({
            id: sub.id,
            title: 'New Subscription',
            description: `Commitment: $${sub.commitment?.toLocaleString() ?? '0'}`,
            activityType: 'subscription',
            createdAt: sub.created_at,
            amount: sub.commitment,
            status: sub.status
        });
    });
    // Add Investors
    latestInvestorsRes.data?.forEach((inv)=>{
        activities.push({
            id: inv.id,
            title: 'Investor Update',
            description: `Status: ${inv.status}, KYC: ${inv.kyc_status}`,
            activityType: 'investor',
            createdAt: inv.created_at,
            status: inv.kyc_status
        });
    });
    // Sort and limit to top 10 most recent
    activities.sort((a, b)=>new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime());
    const recentActivity = activities.slice(0, 10);
    // Collect errors from count queries
    const countResults = [
        {
            name: 'Active LPs',
            result: activeLpsRes
        },
        {
            name: 'Pending KYC',
            result: pendingKycRes
        },
        {
            name: 'High Priority KYC',
            result: highPriorityKycRes
        },
        {
            name: 'Workflow Runs (MTD)',
            result: workflowRunsRes
        },
        {
            name: 'Total Investors',
            result: totalInvestorsRes
        },
        {
            name: 'Compliant Investors',
            result: compliantInvestorsRes
        },
        {
            name: 'Active Workflows',
            result: workflowsRes
        },
        {
            name: 'Active Deals',
            result: dealsRes
        },
        {
            name: 'Active Requests',
            result: requestsRes
        }
    ];
    countResults.forEach(({ name, result })=>{
        if (result.error) {
            errors.push({
                metric: name,
                message: result.error
            });
        }
    });
    const data = {
        generatedAt: new Date().toISOString(),
        kpis: {
            activeLps: activeLpsRes.count,
            pendingKyc: pendingKycRes.count,
            highPriorityKyc: highPriorityKycRes.count,
            workflowRunsThisMonth: workflowRunsRes.count,
            complianceRate: complianceRate
        },
        processCenter: {
            activeWorkflows: workflowsRes.count
        },
        management: {
            activeDeals: dealsRes.count,
            activeRequests: requestsRes.count,
            complianceRate: complianceRate,
            activeInvestors: activeLpsRes.count
        },
        recentActivity,
        charts: {
            fees: aggregatedFees.map((fee)=>({
                    ...fee,
                    type: fee.type || 'total'
                })),
            subscriptions: aggregatedSubscriptions.map((sub)=>({
                    ...sub,
                    status: sub.status || 'active'
                }))
        }
    };
    if (errors.length > 0) {
        data.errors = errors;
    }
    return data;
}
}),
"[project]/versotech-portal/src/lib/staff/dashboard-cache.ts [app-rsc] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "getCacheConfig",
    ()=>getCacheConfig,
    "getCachedStaffDashboardData",
    ()=>getCachedStaffDashboardData,
    "invalidateByTable",
    ()=>invalidateByTable,
    "invalidateDashboardCache",
    ()=>invalidateDashboardCache
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$versotech$2d$portal$2f$node_modules$2f$next$2f$cache$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/versotech-portal/node_modules/next/cache.js [app-rsc] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$versotech$2d$portal$2f$src$2f$lib$2f$staff$2f$dashboard$2d$data$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/versotech-portal/src/lib/staff/dashboard-data.ts [app-rsc] (ecmascript)");
;
;
/**
 * Production-ready cache using Next.js cache API
 * Works correctly in serverless environments (Vercel, AWS Lambda, etc.)
 *
 * Cache strategy:
 * - TTL: 5 minutes (300 seconds)
 * - Tag: 'staff-dashboard' for targeted revalidation
 * - Revalidation: Can be triggered manually via revalidateTag()
 */ const CACHE_TTL = 300 // 5 minutes in seconds
;
const CACHE_TAG = 'staff-dashboard';
async function getCachedStaffDashboardData(dateRangeFilter, forceRefresh = false) {
    if (forceRefresh) {
        console.log('[Dashboard Cache] Force refresh requested, bypassing cache');
        return await (0, __TURBOPACK__imported__module__$5b$project$5d2f$versotech$2d$portal$2f$src$2f$lib$2f$staff$2f$dashboard$2d$data$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["getStaffDashboardData"])(dateRangeFilter);
    }
    // Create cache key that includes date range to ensure different ranges are cached separately
    const cacheKey = dateRangeFilter?.from || dateRangeFilter?.to ? `staff-dashboard-data-${dateRangeFilter.from?.toString()}-${dateRangeFilter.to?.toString()}` : 'staff-dashboard-data-default';
    // Create a cached version for this specific date range
    const getCachedDashboardData = (0, __TURBOPACK__imported__module__$5b$project$5d2f$versotech$2d$portal$2f$node_modules$2f$next$2f$cache$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["unstable_cache"])(async ()=>{
        console.log('[Dashboard Cache] Fetching fresh data from database for range:', dateRangeFilter);
        return await (0, __TURBOPACK__imported__module__$5b$project$5d2f$versotech$2d$portal$2f$src$2f$lib$2f$staff$2f$dashboard$2d$data$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["getStaffDashboardData"])(dateRangeFilter);
    }, [
        cacheKey
    ], {
        revalidate: CACHE_TTL,
        tags: [
            CACHE_TAG
        ]
    });
    return await getCachedDashboardData();
}
async function invalidateDashboardCache() {
    const { revalidateTag } = await __turbopack_context__.A("[project]/versotech-portal/node_modules/next/cache.js [app-rsc] (ecmascript, async loader)");
    // Next.js 16 requires cacheLife profile as second argument
    // Using { expire: 0 } for immediate cache expiration (not stale-while-revalidate)
    revalidateTag(CACHE_TAG, {
        expire: 0
    });
    console.log('[Dashboard Cache] Cache invalidated');
}
async function invalidateByTable(tableName) {
    const tablesAffectingDashboard = [
        'investors',
        'tasks',
        'workflow_runs',
        'workflows',
        'deals',
        'request_tickets',
        'fee_events',
        'subscriptions'
    ];
    if (tablesAffectingDashboard.includes(tableName)) {
        console.log(`[Dashboard Cache] Table ${tableName} modified, invalidating cache`);
        await invalidateDashboardCache();
    }
}
function getCacheConfig() {
    return {
        ttl: CACHE_TTL,
        tag: CACHE_TAG,
        strategy: 'next-js-cache',
        note: 'Using Next.js built-in cache (production-ready for serverless)'
    };
}
}),
"[project]/versotech-portal/src/app/(main)/versotech_main/dashboard/page.tsx [app-rsc] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "default",
    ()=>UnifiedDashboardPage,
    "dynamic",
    ()=>dynamic
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$versotech$2d$portal$2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$rsc$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/versotech-portal/node_modules/next/dist/server/route-modules/app-page/vendored/rsc/react-jsx-dev-runtime.js [app-rsc] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$versotech$2d$portal$2f$src$2f$lib$2f$auth$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/versotech-portal/src/lib/auth.ts [app-rsc] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$versotech$2d$portal$2f$node_modules$2f$next$2f$dist$2f$api$2f$navigation$2e$react$2d$server$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/versotech-portal/node_modules/next/dist/api/navigation.react-server.js [app-rsc] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$versotech$2d$portal$2f$node_modules$2f$next$2f$dist$2f$client$2f$components$2f$navigation$2e$react$2d$server$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/versotech-portal/node_modules/next/dist/client/components/navigation.react-server.js [app-rsc] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$versotech$2d$portal$2f$node_modules$2f$next$2f$headers$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/versotech-portal/node_modules/next/headers.js [app-rsc] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$versotech$2d$portal$2f$src$2f$app$2f28$main$292f$versotech_main$2f$dashboard$2f$ceo$2d$dashboard$2e$tsx__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/versotech-portal/src/app/(main)/versotech_main/dashboard/ceo-dashboard.tsx [app-rsc] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$versotech$2d$portal$2f$src$2f$app$2f28$main$292f$versotech_main$2f$dashboard$2f$persona$2d$dashboard$2e$tsx__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/versotech-portal/src/app/(main)/versotech_main/dashboard/persona-dashboard.tsx [app-rsc] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$versotech$2d$portal$2f$src$2f$lib$2f$staff$2f$dashboard$2d$cache$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/versotech-portal/src/lib/staff/dashboard-cache.ts [app-rsc] (ecmascript)");
;
;
;
;
;
;
;
const dynamic = 'force-dynamic';
async function UnifiedDashboardPage() {
    const user = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$versotech$2d$portal$2f$src$2f$lib$2f$auth$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["getCurrentUser"])();
    if (!user) {
        (0, __TURBOPACK__imported__module__$5b$project$5d2f$versotech$2d$portal$2f$node_modules$2f$next$2f$dist$2f$client$2f$components$2f$navigation$2e$react$2d$server$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["redirect"])('/versotech_main/login');
    }
    // Check the active persona from cookie (set by client-side persona switcher)
    const cookieStore = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$versotech$2d$portal$2f$node_modules$2f$next$2f$headers$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["cookies"])();
    const activePersonaType = cookieStore.get('verso_active_persona_type')?.value;
    // CEO users (ceo or staff_admin) get the full executive dashboard
    // UNLESS they've switched to a different persona via the persona switcher
    const isCEOUser = user.role === 'staff_admin' || user.role === 'ceo';
    const isViewingAsCEO = !activePersonaType || activePersonaType === 'ceo' || activePersonaType === 'staff';
    if (isCEOUser && isViewingAsCEO) {
        // Fetch real dashboard data for CEO users viewing as CEO/staff
        const data = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$versotech$2d$portal$2f$src$2f$lib$2f$staff$2f$dashboard$2d$cache$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["getCachedStaffDashboardData"])();
        // Transform data for realtime component
        const realtimeMetrics = {
            activeLps: data.kpis.activeLps ?? 0,
            pendingKyc: data.kpis.pendingKyc ?? 0,
            workflowRuns: data.kpis.workflowRunsThisMonth ?? 0,
            complianceRate: data.kpis.complianceRate ?? 0,
            kycPipeline: data.kpis.highPriorityKyc ?? 0,
            ndaInProgress: 0,
            subscriptionReview: 0,
            activeDeals: data.management.activeDeals ?? 0,
            activeRequests: data.management.activeRequests ?? 0,
            lastUpdated: data.generatedAt
        };
        return /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$versotech$2d$portal$2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$rsc$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$versotech$2d$portal$2f$src$2f$app$2f28$main$292f$versotech_main$2f$dashboard$2f$ceo$2d$dashboard$2e$tsx__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["CEODashboard"], {
            dashboardData: data,
            realtimeMetrics: realtimeMetrics
        }, void 0, false, {
            fileName: "[project]/versotech-portal/src/app/(main)/versotech_main/dashboard/page.tsx",
            lineNumber: 44,
            columnNumber: 12
        }, this);
    }
    // Non-CEO users get the persona-aware dashboard
    return /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$versotech$2d$portal$2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$rsc$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$versotech$2d$portal$2f$src$2f$app$2f28$main$292f$versotech_main$2f$dashboard$2f$persona$2d$dashboard$2e$tsx__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["PersonaDashboard"], {}, void 0, false, {
        fileName: "[project]/versotech-portal/src/app/(main)/versotech_main/dashboard/page.tsx",
        lineNumber: 48,
        columnNumber: 10
    }, this);
}
}),
"[project]/versotech-portal/src/app/(main)/versotech_main/dashboard/page.tsx [app-rsc] (ecmascript, Next.js Server Component)", ((__turbopack_context__) => {

__turbopack_context__.n(__turbopack_context__.i("[project]/versotech-portal/src/app/(main)/versotech_main/dashboard/page.tsx [app-rsc] (ecmascript)"));
}),
];

//# sourceMappingURL=%5Broot-of-the-server%5D__cadf42cb._.js.map