{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 26, "column": 0}, "map": {"version":3,"sources":["file:///Users/ghilesmoussaoui/Desktop/Versotech/versotech-portal/src/components/profile/profile-page-client.tsx/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport const ProfilePageClient = registerClientReference(\n    function() { throw new Error(\"Attempted to call ProfilePageClient() from the server but ProfilePageClient is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/versotech-portal/src/components/profile/profile-page-client.tsx <module evaluation>\",\n    \"ProfilePageClient\",\n);\n"],"names":[],"mappings":";;;;AAAA,uEAAuE;AACvE;;AACO,MAAM,oBAAoB,IAAA,+RAAuB,EACpD;IAAa,MAAM,IAAI,MAAM;AAAkP,GAC/Q,iGACA","ignoreList":[0]}},
    {"offset": {"line": 40, "column": 0}, "map": {"version":3,"sources":["file:///Users/ghilesmoussaoui/Desktop/Versotech/versotech-portal/src/components/profile/profile-page-client.tsx/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport const ProfilePageClient = registerClientReference(\n    function() { throw new Error(\"Attempted to call ProfilePageClient() from the server but ProfilePageClient is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/versotech-portal/src/components/profile/profile-page-client.tsx\",\n    \"ProfilePageClient\",\n);\n"],"names":[],"mappings":";;;;AAAA,uEAAuE;AACvE;;AACO,MAAM,oBAAoB,IAAA,+RAAuB,EACpD;IAAa,MAAM,IAAI,MAAM;AAAkP,GAC/Q,6EACA","ignoreList":[0]}},
    {"offset": {"line": 54, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":""}},
    {"offset": {"line": 62, "column": 0}, "map": {"version":3,"sources":["file:///Users/ghilesmoussaoui/Desktop/Versotech/versotech-portal/src/app/%28main%29/versotech_main/profile/page.tsx"],"sourcesContent":["import { redirect } from 'next/navigation'\r\nimport { cookies } from 'next/headers'\r\nimport { createClient, createServiceClient } from '@/lib/supabase/server'\r\nimport { ProfilePageClient } from '@/components/profile/profile-page-client'\r\n\r\nexport const dynamic = 'force-dynamic'\r\nexport const revalidate = 0\r\n\r\nexport default async function ProfilePage({\r\n  searchParams,\r\n}: {\r\n  searchParams: Promise<{ tab?: string }>\r\n}) {\r\n  const resolvedSearchParams = await searchParams\r\n  const defaultTab = resolvedSearchParams.tab || 'overview'\r\n  const supabase = await createClient()\r\n  const serviceSupabase = createServiceClient()\r\n\r\n  // Get the current user\r\n  const { data: { user }, error: authError } = await supabase.auth.getUser()\r\n  if (authError || !user) {\r\n    redirect('/versotech_main/login')\r\n  }\r\n\r\n  // Get active persona from cookie (set by persona switcher)\r\n  const cookieStore = await cookies()\r\n  const activePersonaType = cookieStore.get('verso_active_persona_type')?.value\r\n\r\n  // Fetch complete profile data\r\n  const { data: profile, error } = await supabase\r\n    .from('profiles')\r\n    .select('*')\r\n    .eq('id', user.id)\r\n    .single()\r\n\r\n  if (error || !profile) {\r\n    return (\r\n      <div className=\"p-6\">\r\n        <div className=\"max-w-2xl mx-auto text-center py-12\">\r\n          <h1 className=\"text-2xl font-bold text-foreground mb-2\">Error Loading Profile</h1>\r\n          <p className=\"text-muted-foreground\">\r\n            Unable to load your profile data. Please try again.\r\n          </p>\r\n        </div>\r\n      </div>\r\n    )\r\n  }\r\n\r\n  // ALWAYS check if user has an investor link - we need this data regardless of persona\r\n  let investorInfo = null\r\n  let investorUserInfo = null\r\n\r\n  // Check if user is associated with an investor\r\n  const { data: investorUser, error: investorUserError } = await serviceSupabase\r\n    .from('investor_users')\r\n    .select('investor_id, role, is_primary, can_sign')\r\n    .eq('user_id', user.id)\r\n    .maybeSingle()\r\n\r\n  if (investorUserError) {\r\n    console.error('[ProfilePage] Error fetching investor_users:', investorUserError)\r\n  }\r\n\r\n  console.log('[ProfilePage] investorUser result:', { investorUser, investorUserError })\r\n\r\n  if (investorUser) {\r\n    // Fetch investor entity details including KYC fields\r\n    const { data: investor, error: investorError } = await serviceSupabase\r\n      .from('investors')\r\n      .select(`\r\n        id,\r\n        legal_name,\r\n        display_name,\r\n        type,\r\n        status,\r\n        kyc_status,\r\n        onboarding_status,\r\n        country,\r\n        country_of_incorporation,\r\n        tax_residency,\r\n        email,\r\n        phone,\r\n        website,\r\n        registered_address,\r\n        city,\r\n        representative_name,\r\n        representative_title,\r\n        is_professional_investor,\r\n        is_qualified_purchaser,\r\n        aml_risk_rating,\r\n        logo_url,\r\n        first_name,\r\n        middle_name,\r\n        last_name,\r\n        name_suffix,\r\n        date_of_birth,\r\n        country_of_birth,\r\n        nationality,\r\n        phone_mobile,\r\n        phone_office,\r\n        residential_street,\r\n        residential_line_2,\r\n        residential_city,\r\n        residential_state,\r\n        residential_postal_code,\r\n        residential_country,\r\n        registered_address_line_1,\r\n        registered_address_line_2,\r\n        registered_city,\r\n        registered_state,\r\n        registered_postal_code,\r\n        registered_country,\r\n        is_us_citizen,\r\n        is_us_taxpayer,\r\n        us_taxpayer_id,\r\n        id_type,\r\n        id_number,\r\n        id_issue_date,\r\n        id_expiry_date,\r\n        id_issuing_country,\r\n        middle_initial,\r\n        proof_of_address_date,\r\n        proof_of_address_expiry,\r\n        tax_id_number\r\n      `)\r\n      .eq('id', investorUser.investor_id)\r\n      .single()\r\n\r\n    if (investorError) {\r\n      console.error('[ProfilePage] Error fetching investor:', investorError)\r\n    }\r\n\r\n    console.log('[ProfilePage] investor result:', { investor: investor?.id, investorError })\r\n\r\n    if (investor) {\r\n      investorInfo = {\r\n        id: investor.id,\r\n        legal_name: investor.legal_name,\r\n        display_name: investor.display_name,\r\n        type: investor.type,\r\n        status: investor.status,\r\n        kyc_status: investor.kyc_status,\r\n        onboarding_status: investor.onboarding_status,\r\n        country: investor.country,\r\n        country_of_incorporation: investor.country_of_incorporation,\r\n        tax_residency: investor.tax_residency,\r\n        email: investor.email,\r\n        phone: investor.phone,\r\n        website: investor.website,\r\n        registered_address: investor.registered_address,\r\n        city: investor.city,\r\n        representative_name: investor.representative_name,\r\n        representative_title: investor.representative_title,\r\n        is_professional_investor: investor.is_professional_investor,\r\n        is_qualified_purchaser: investor.is_qualified_purchaser,\r\n        aml_risk_rating: investor.aml_risk_rating,\r\n        logo_url: investor.logo_url,\r\n        // Individual KYC fields\r\n        first_name: investor.first_name,\r\n        middle_name: investor.middle_name,\r\n        last_name: investor.last_name,\r\n        name_suffix: investor.name_suffix,\r\n        date_of_birth: investor.date_of_birth,\r\n        country_of_birth: investor.country_of_birth,\r\n        nationality: investor.nationality,\r\n        // Phone numbers\r\n        phone_mobile: investor.phone_mobile,\r\n        phone_office: investor.phone_office,\r\n        // Residential address (for individuals)\r\n        residential_street: investor.residential_street,\r\n        residential_line_2: investor.residential_line_2,\r\n        residential_city: investor.residential_city,\r\n        residential_state: investor.residential_state,\r\n        residential_postal_code: investor.residential_postal_code,\r\n        residential_country: investor.residential_country,\r\n        // Registered address (for entities)\r\n        registered_address_line_1: investor.registered_address_line_1,\r\n        registered_address_line_2: investor.registered_address_line_2,\r\n        registered_city: investor.registered_city,\r\n        registered_state: investor.registered_state,\r\n        registered_postal_code: investor.registered_postal_code,\r\n        registered_country: investor.registered_country,\r\n        // US Tax compliance\r\n        is_us_citizen: investor.is_us_citizen,\r\n        is_us_taxpayer: investor.is_us_taxpayer,\r\n        us_taxpayer_id: investor.us_taxpayer_id,\r\n        country_of_tax_residency: investor.tax_residency,  // Column is named tax_residency in DB\r\n        // ID Document\r\n        id_type: investor.id_type,\r\n        id_number: investor.id_number,\r\n        id_issue_date: investor.id_issue_date,\r\n        id_expiry_date: investor.id_expiry_date,\r\n        id_issuing_country: investor.id_issuing_country,\r\n        // Additional KYC fields\r\n        middle_initial: investor.middle_initial,\r\n        proof_of_address_date: investor.proof_of_address_date,\r\n        proof_of_address_expiry: investor.proof_of_address_expiry,\r\n        tax_id_number: investor.tax_id_number,\r\n      }\r\n\r\n      investorUserInfo = {\r\n        role: investorUser.role,\r\n        is_primary: investorUser.is_primary,\r\n        can_sign: investorUser.can_sign || false\r\n      }\r\n    }\r\n  }\r\n\r\n  // Determine variant based on active persona cookie\r\n  // If persona is 'investor' OR user has investor link and no persona set, show investor profile\r\n  const staffPersonaTypes = ['ceo', 'staff']\r\n  const isActivePersonaStaff = activePersonaType ? staffPersonaTypes.includes(activePersonaType) : false\r\n  const isProfileRoleStaff = ['staff_admin', 'staff_ops', 'staff_rm', 'staff', 'admin'].includes(profile.role)\r\n\r\n  // Show investor profile if:\r\n  // 1. Active persona is 'investor', OR\r\n  // 2. User has investor link AND (no active persona OR active persona is investor-type)\r\n  const hasInvestorLink = !!investorInfo\r\n  const showAsStaff = activePersonaType\r\n    ? isActivePersonaStaff && !hasInvestorLink  // Staff persona but ONLY if no investor link\r\n    : isProfileRoleStaff && !hasInvestorLink     // Staff role but ONLY if no investor link\r\n\r\n  // Debug logging\r\n  console.log('[ProfilePage] Debug:', {\r\n    email: profile.email,\r\n    activePersonaType,\r\n    isActivePersonaStaff,\r\n    isProfileRoleStaff,\r\n    hasInvestorLink,\r\n    showAsStaff,\r\n    variant: showAsStaff ? 'staff' : 'investor',\r\n    investorInfo: investorInfo ? { id: investorInfo.id, legal_name: investorInfo.legal_name, type: investorInfo.type } : null,\r\n    investorUserInfo,\r\n  })\r\n\r\n  return (\r\n    <ProfilePageClient\r\n      userEmail={user.email || ''}\r\n      profile={{\r\n        id: profile.id,\r\n        email: profile.email,\r\n        display_name: profile.display_name,\r\n        full_name: profile.display_name,\r\n        title: profile.title,\r\n        avatar_url: profile.avatar_url,\r\n        phone: profile.phone,\r\n        office_location: profile.office_location,\r\n        bio: profile.bio,\r\n        role: profile.role,\r\n        created_at: profile.created_at\r\n      }}\r\n      variant={showAsStaff ? 'staff' : 'investor'}\r\n      defaultTab={defaultTab}\r\n      investorInfo={investorInfo}\r\n      investorUserInfo={investorUserInfo}\r\n    />\r\n  )\r\n}\r\n"],"names":[],"mappings":"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"}}]
}