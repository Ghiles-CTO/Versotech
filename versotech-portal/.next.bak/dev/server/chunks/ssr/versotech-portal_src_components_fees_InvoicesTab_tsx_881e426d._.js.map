{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/ghilesmoussaoui/Desktop/Versotech/versotech-portal/src/components/fees/InvoicesTab.tsx"],"sourcesContent":["/**\r\n * Invoices Tab - Manage invoices and payments\r\n */\r\n\r\n'use client';\r\n\r\nimport { useEffect, useState, useCallback } from 'react';\r\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Badge } from '@/components/ui/badge';\r\nimport { Plus, Send, DollarSign, X, FileText, AlertCircle, AlertTriangle, RefreshCw, Loader2 } from 'lucide-react';\r\nimport { Popover, PopoverContent, PopoverTrigger } from '@/components/ui/popover';\r\nimport type { InvoiceWithLines } from '@/lib/fees/types';\r\nimport { formatCurrency } from '@/lib/fees/calculations';\r\nimport { GenerateInvoiceModal } from './GenerateInvoiceModal';\r\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\r\n\r\nconst statusColors = {\r\n  draft: 'secondary',\r\n  sent: 'default',\r\n  paid: 'default',\r\n  partially_paid: 'default',\r\n  overdue: 'destructive',\r\n  cancelled: 'secondary',\r\n  disputed: 'destructive',\r\n} as const;\r\n\r\ninterface FeeEvent {\r\n  id: string;\r\n  fee_type: string;\r\n  computed_amount: number;\r\n  event_date: string;\r\n  status: string;\r\n  allocation_id?: string;\r\n  investor?: {\r\n    id: string;\r\n    legal_name: string;\r\n    display_name: string;\r\n  };\r\n  deal?: {\r\n    id: string;\r\n    name: string;\r\n  };\r\n  subscription?: {\r\n    id: string;\r\n    subscription_number: string;\r\n    commitment: number;\r\n    vehicle?: {\r\n      id: string;\r\n      name: string;\r\n      short_name?: string;\r\n    };\r\n  };\r\n}\r\n\r\nexport default function InvoicesTab() {\r\n  const [invoices, setInvoices] = useState<InvoiceWithLines[]>([]);\r\n  const [feeEvents, setFeeEvents] = useState<FeeEvent[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [filter, setFilter] = useState('all');\r\n  const [showGenerateModal, setShowGenerateModal] = useState(false);\r\n  const [selectedInvestorId, setSelectedInvestorId] = useState<string | undefined>(undefined);\r\n  const [backfillLoading, setBackfillLoading] = useState(false);\r\n\r\n  const fetchInvoices = useCallback(async () => {\r\n    try {\r\n      const url = filter === 'all'\r\n        ? '/api/staff/fees/invoices?limit=100&offset=0'\r\n        : `/api/staff/fees/invoices?status=${filter}&limit=100&offset=0`;\r\n      const res = await fetch(url);\r\n      const json = await res.json();\r\n      setInvoices(json.data || []);\r\n    } catch (error) {\r\n      console.error('Error fetching invoices:', error);\r\n    }\r\n  }, [filter]);\r\n\r\n  const fetchFeeEvents = useCallback(async () => {\r\n    try {\r\n      const res = await fetch('/api/staff/fees/events?status=accrued&limit=100&offset=0');\r\n      const json = await res.json();\r\n      console.log('[InvoicesTab] Fee events fetched:', json.data?.length || 0, 'events');\r\n      if (json.data?.length > 0) {\r\n        console.log('[InvoicesTab] First fee event:', json.data[0]);\r\n        console.log('[InvoicesTab] First investor data:', json.data[0]?.investor);\r\n      }\r\n      setFeeEvents(json.data || []);\r\n    } catch (error) {\r\n      console.error('Error fetching fee events:', error);\r\n    }\r\n  }, []);\r\n\r\n  const fetchData = useCallback(async () => {\r\n    setLoading(true);\r\n    await Promise.all([fetchInvoices(), fetchFeeEvents()]);\r\n    setLoading(false);\r\n  }, [fetchInvoices, fetchFeeEvents]);\r\n\r\n  useEffect(() => {\r\n    fetchData();\r\n  }, [fetchData]);\r\n\r\n  const handleSend = async (invoiceId: string) => {\r\n    try {\r\n      const res = await fetch(`/api/staff/fees/invoices/${invoiceId}/send`, {\r\n        method: 'POST',\r\n      });\r\n\r\n      const data = await res.json();\r\n\r\n      if (res.ok) {\r\n        // Success - invoice was sent and status updated\r\n        alert(data.message || 'Invoice sent successfully');\r\n        fetchInvoices();\r\n      } else {\r\n        // Failed - show error message\r\n        console.error('Error sending invoice:', data);\r\n        alert(data.error + (data.details ? `\\n\\n${data.details}` : ''));\r\n      }\r\n    } catch (error) {\r\n      console.error('Error sending invoice:', error);\r\n      alert('Failed to send invoice. Please try again.');\r\n    }\r\n  };\r\n\r\n  const handleMarkPaid = async (invoiceId: string, amount: number) => {\r\n    try {\r\n      const res = await fetch(`/api/staff/fees/invoices/${invoiceId}/mark-paid`, {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({ paid_amount: amount }),\r\n      });\r\n      if (res.ok) {\r\n        fetchInvoices();\r\n      }\r\n    } catch (error) {\r\n      console.error('Error marking invoice as paid:', error);\r\n    }\r\n  };\r\n\r\n  const handleBackfillFeeEvents = async () => {\r\n    if (!confirm('This will calculate fee events for all existing committed subscriptions that don\\'t have fee events yet. Continue?')) {\r\n      return;\r\n    }\r\n\r\n    setBackfillLoading(true);\r\n    try {\r\n      const res = await fetch('/api/staff/fees/events/backfill', {\r\n        method: 'POST',\r\n      });\r\n\r\n      const result = await res.json();\r\n\r\n      if (res.ok) {\r\n        alert(`Backfill complete!\\n\\nProcessed: ${result.results.processed}\\nSkipped: ${result.results.skipped}\\nFailed: ${result.results.failed}\\nTotal Fee Events Created: ${result.results.created_events}`);\r\n        fetchData(); // Refresh data\r\n      } else {\r\n        alert(`Backfill failed: ${result.error}`);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error running backfill:', error);\r\n      alert('Failed to run backfill');\r\n    } finally {\r\n      setBackfillLoading(false);\r\n    }\r\n  };\r\n\r\n  if (loading) {\r\n    return <div>Loading...</div>;\r\n  }\r\n\r\n  // Group fee events by investor and then by subscription\r\n  const feeEventsByInvestor = feeEvents.reduce((acc, event) => {\r\n    const investorId = event.investor?.id || 'unknown';\r\n    if (!acc[investorId]) {\r\n      acc[investorId] = {\r\n        investor: event.investor,\r\n        subscriptions: {},\r\n        total: 0,\r\n      };\r\n    }\r\n\r\n    // Group by subscription within investor\r\n    const subscriptionId = event.allocation_id || 'no-subscription';\r\n    const subscriptionName = event.subscription\r\n      ? `${event.subscription.subscription_number} - ${event.subscription.vehicle?.name || 'Unknown Vehicle'}`\r\n      : 'Direct Fee';\r\n\r\n    if (!acc[investorId].subscriptions[subscriptionId]) {\r\n      acc[investorId].subscriptions[subscriptionId] = {\r\n        subscription: event.subscription,\r\n        name: subscriptionName,\r\n        events: [],\r\n        total: 0,\r\n      };\r\n    }\r\n\r\n    acc[investorId].subscriptions[subscriptionId].events.push(event);\r\n    acc[investorId].subscriptions[subscriptionId].total += Number(event.computed_amount);\r\n    acc[investorId].total += Number(event.computed_amount);\r\n\r\n    return acc;\r\n  }, {} as Record<string, {\r\n    investor: any;\r\n    subscriptions: Record<string, {\r\n      subscription: any;\r\n      name: string;\r\n      events: FeeEvent[];\r\n      total: number;\r\n    }>;\r\n    total: number;\r\n  }>);\r\n\r\n  const totalUninvoiced = feeEvents.reduce((sum, e) => sum + Number(e.computed_amount), 0);\r\n\r\n  return (\r\n    <>\r\n      <div className=\"space-y-6\">\r\n        <div className=\"flex items-center justify-between\">\r\n          <div>\r\n            <h2 className=\"text-2xl font-bold\">Fee Billing</h2>\r\n            <p className=\"text-sm text-muted-foreground mt-1\">\r\n              Manage recurring fee billing and invoices. For initial investment fees, see Subscriptions.\r\n            </p>\r\n          </div>\r\n          <div className=\"flex gap-2\">\r\n            <Button\r\n              variant=\"outline\"\r\n              onClick={handleBackfillFeeEvents}\r\n              disabled={backfillLoading}\r\n            >\r\n              {backfillLoading ? (\r\n                <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\r\n              ) : (\r\n                <RefreshCw className=\"mr-2 h-4 w-4\" />\r\n              )}\r\n              Backfill Fee Events\r\n            </Button>\r\n            <Button onClick={() => setShowGenerateModal(true)}>\r\n              <Plus className=\"mr-2 h-4 w-4\" />\r\n              Generate Invoice\r\n            </Button>\r\n          </div>\r\n        </div>\r\n\r\n        <Tabs defaultValue=\"uninvoiced\" className=\"w-full\" id=\"invoices-tab-tabs\">\r\n          <TabsList>\r\n            <TabsTrigger value=\"uninvoiced\">\r\n              Uninvoiced Fees\r\n              {feeEvents.length > 0 && (\r\n                <Badge variant=\"secondary\" className=\"ml-2\">\r\n                  {feeEvents.length}\r\n                </Badge>\r\n              )}\r\n            </TabsTrigger>\r\n            <TabsTrigger value=\"invoices\">Invoices</TabsTrigger>\r\n          </TabsList>\r\n\r\n          {/* Uninvoiced Fee Events Tab */}\r\n          <TabsContent value=\"uninvoiced\" className=\"space-y-4\">\r\n            {feeEvents.length === 0 ? (\r\n              <Card>\r\n                <CardContent className=\"py-10 text-center\">\r\n                  <FileText className=\"mx-auto h-12 w-12 text-muted-foreground/50 mb-4\" />\r\n                  <p className=\"text-muted-foreground\">No uninvoiced fee events</p>\r\n                  <p className=\"text-sm text-muted-foreground mt-1\">\r\n                    Fee events are automatically created when subscriptions are committed\r\n                  </p>\r\n                </CardContent>\r\n              </Card>\r\n            ) : (\r\n              <>\r\n                {/* Summary Card */}\r\n                <Card>\r\n                  <CardContent className=\"py-4\">\r\n                    <div className=\"flex items-center justify-between\">\r\n                      <div>\r\n                        <p className=\"text-sm text-muted-foreground\">Total Uninvoiced</p>\r\n                        <p className=\"text-2xl font-bold\">{formatCurrency(totalUninvoiced)}</p>\r\n                      </div>\r\n                      <div className=\"text-right\">\r\n                        <p className=\"text-sm text-muted-foreground\">Fee Events</p>\r\n                        <p className=\"text-2xl font-bold\">{feeEvents.length}</p>\r\n                      </div>\r\n                      <div className=\"text-right\">\r\n                        <p className=\"text-sm text-muted-foreground\">Investors</p>\r\n                        <p className=\"text-2xl font-bold\">\r\n                          {Object.keys(feeEventsByInvestor).length}\r\n                        </p>\r\n                      </div>\r\n                    </div>\r\n                  </CardContent>\r\n                </Card>\r\n\r\n                {/* Fee Events Grouped by Investor and Subscription */}\r\n                {Object.values(feeEventsByInvestor).map(({ investor, subscriptions, total }) => (\r\n                  <Card key={investor?.id || 'unknown'}>\r\n                    <CardHeader>\r\n                      <div className=\"flex items-start justify-between\">\r\n                        <div>\r\n                          <CardTitle className=\"text-lg\">\r\n                            {investor?.legal_name || investor?.display_name || 'Unknown Investor'}\r\n                          </CardTitle>\r\n                          <p className=\"text-sm text-muted-foreground mt-1\">\r\n                            {Object.keys(subscriptions).length} subscription(s) • {formatCurrency(total)}\r\n                          </p>\r\n                        </div>\r\n                        <Button\r\n                          size=\"sm\"\r\n                          onClick={() => {\r\n                            console.log('[InvoicesTab] Invoice button clicked for investor:', investor);\r\n                            console.log('[InvoicesTab] Investor ID:', investor?.id, 'Type:', typeof investor?.id);\r\n\r\n                            // Only open modal if we have a valid investor ID\r\n                            if (investor?.id && investor.id !== 'unknown') {\r\n                              console.log('[InvoicesTab] Setting selectedInvestorId to:', investor.id);\r\n                              setSelectedInvestorId(investor.id);\r\n                              setShowGenerateModal(true);\r\n                            } else {\r\n                              alert('Cannot generate invoice: Investor information is missing');\r\n                            }\r\n                          }}\r\n                          disabled={!investor?.id || investor.id === 'unknown'}\r\n                        >\r\n                          <Plus className=\"mr-2 h-4 w-4\" />\r\n                          Invoice All\r\n                        </Button>\r\n                      </div>\r\n                    </CardHeader>\r\n                    <CardContent>\r\n                      <div className=\"space-y-4\">\r\n                        {/* Group by Subscription */}\r\n                        {Object.values(subscriptions).map((subGroup) => (\r\n                          <div key={subGroup.name} className=\"border-l-2 border-primary/20 pl-4\">\r\n                            <div className=\"mb-2\">\r\n                              <p className=\"font-medium text-sm\">\r\n                                {subGroup.name}\r\n                              </p>\r\n                              <p className=\"text-xs text-muted-foreground\">\r\n                                {subGroup.events.length} fee(s) • {formatCurrency(subGroup.total)}\r\n                              </p>\r\n                            </div>\r\n                            <div className=\"space-y-2\">\r\n                              {subGroup.events.map((event) => (\r\n                                <div\r\n                                  key={event.id}\r\n                                  className=\"flex items-center justify-between p-2 bg-accent/50 rounded\"\r\n                                >\r\n                                  <div>\r\n                                    <div className=\"font-medium text-sm\">\r\n                                      <Badge variant=\"outline\" className=\"mr-2 text-xs\">\r\n                                        {event.fee_type === 'flat' ? 'Investment' : event.fee_type.replace('_', ' ')}\r\n                                      </Badge>\r\n                                      {formatCurrency(event.computed_amount)}\r\n                                    </div>\r\n                                    <div className=\"text-xs text-muted-foreground\">\r\n                                      {new Date(event.event_date).toLocaleDateString()}\r\n                                    </div>\r\n                                  </div>\r\n                                </div>\r\n                              ))}\r\n                            </div>\r\n                          </div>\r\n                        ))}\r\n                      </div>\r\n                    </CardContent>\r\n                  </Card>\r\n                ))}\r\n              </>\r\n            )}\r\n          </TabsContent>\r\n\r\n          {/* Invoices Tab */}\r\n          <TabsContent value=\"invoices\" className=\"space-y-4\">\r\n            {/* Filters */}\r\n            <div className=\"flex gap-2\">\r\n              {['all', 'draft', 'sent', 'paid', 'overdue'].map((status) => (\r\n                <Button\r\n                  key={status}\r\n                  variant={filter === status ? 'default' : 'outline'}\r\n                  size=\"sm\"\r\n                  onClick={() => setFilter(status)}\r\n                >\r\n                  {status.charAt(0).toUpperCase() + status.slice(1)}\r\n                </Button>\r\n              ))}\r\n            </div>\r\n\r\n            {/* Invoices List */}\r\n            {invoices.length === 0 ? (\r\n              <Card>\r\n                <CardContent className=\"py-10 text-center\">\r\n                  <FileText className=\"mx-auto h-12 w-12 text-muted-foreground/50 mb-4\" />\r\n                  <p className=\"text-muted-foreground\">No invoices found</p>\r\n                </CardContent>\r\n              </Card>\r\n            ) : (\r\n              <div className=\"space-y-4\">\r\n                {invoices.map((invoice) => (\r\n                  <Card key={invoice.id}>\r\n                    <CardHeader>\r\n                      <div className=\"flex items-start justify-between\">\r\n                        <div className=\"flex items-start gap-2\">\r\n                          <div>\r\n                            <CardTitle className=\"text-lg\">{invoice.invoice_number}</CardTitle>\r\n                            <p className=\"text-sm text-muted-foreground mt-1\">\r\n                              {invoice.investor?.display_name || 'Unknown Investor'}\r\n                              {invoice.deal && ` • ${invoice.deal.name}`}\r\n                            </p>\r\n                          </div>\r\n                          {/* Discrepancy Warning Badge */}\r\n                          {invoice.has_discrepancy && (\r\n                            <Popover>\r\n                              <PopoverTrigger asChild>\r\n                                <button\r\n                                  className=\"flex items-center gap-1 px-2 py-1 text-xs font-medium text-amber-600 bg-amber-100 dark:bg-amber-900/30 dark:text-amber-400 rounded-md hover:bg-amber-200 dark:hover:bg-amber-900/50 transition-colors cursor-pointer\"\r\n                                >\r\n                                  <AlertTriangle className=\"h-3.5 w-3.5\" />\r\n                                  <span>Discrepancy</span>\r\n                                </button>\r\n                              </PopoverTrigger>\r\n                              <PopoverContent className=\"w-80\" side=\"bottom\" align=\"start\">\r\n                                <div className=\"space-y-3\">\r\n                                  <div className=\"flex items-center gap-2 text-amber-600 dark:text-amber-400\">\r\n                                    <AlertTriangle className=\"h-4 w-4\" />\r\n                                    <h4 className=\"font-medium\">Invoice Discrepancy Detected</h4>\r\n                                  </div>\r\n                                  <p className=\"text-sm text-muted-foreground\">\r\n                                    The invoice total does not match the sum of linked fee events.\r\n                                  </p>\r\n                                  <div className=\"space-y-2 p-3 bg-muted/50 rounded-md\">\r\n                                    <div className=\"flex justify-between text-sm\">\r\n                                      <span className=\"text-muted-foreground\">Invoice Total:</span>\r\n                                      <span className=\"font-medium\">{formatCurrency(invoice.total)}</span>\r\n                                    </div>\r\n                                    <div className=\"flex justify-between text-sm\">\r\n                                      <span className=\"text-muted-foreground\">Expected Total:</span>\r\n                                      <span className=\"font-medium\">\r\n                                        {formatCurrency(invoice.total - (invoice.discrepancy_amount || 0))}\r\n                                      </span>\r\n                                    </div>\r\n                                    <div className=\"border-t border-border pt-2 mt-2\">\r\n                                      <div className=\"flex justify-between text-sm\">\r\n                                        <span className=\"text-amber-600 dark:text-amber-400 font-medium\">Discrepancy:</span>\r\n                                        <span className=\"text-amber-600 dark:text-amber-400 font-medium\">\r\n                                          {(invoice.discrepancy_amount || 0) > 0 ? '+' : ''}{formatCurrency(invoice.discrepancy_amount || 0)}\r\n                                        </span>\r\n                                      </div>\r\n                                    </div>\r\n                                  </div>\r\n                                  <p className=\"text-xs text-muted-foreground\">\r\n                                    Please review the invoice line items and linked fee events to resolve this discrepancy.\r\n                                  </p>\r\n                                </div>\r\n                              </PopoverContent>\r\n                            </Popover>\r\n                          )}\r\n                        </div>\r\n                        <Badge variant={statusColors[invoice.status]}>\r\n                          {invoice.status.replace('_', ' ')}\r\n                        </Badge>\r\n                      </div>\r\n                    </CardHeader>\r\n                    <CardContent>\r\n                      <div className=\"flex items-center justify-between\">\r\n                        <div className=\"space-y-1\">\r\n                          <div className=\"text-2xl font-bold\">\r\n                            {formatCurrency(invoice.total)}\r\n                          </div>\r\n                          <div className=\"text-sm text-muted-foreground\">\r\n                            Due: {new Date(invoice.due_date).toLocaleDateString()}\r\n                            {invoice.balance_due && invoice.balance_due > 0 && (\r\n                              <span className=\"ml-2\">\r\n                                • Balance: {formatCurrency(invoice.balance_due)}\r\n                              </span>\r\n                            )}\r\n                          </div>\r\n                        </div>\r\n                        <div className=\"flex gap-2\">\r\n                          {invoice.status === 'draft' && (\r\n                            <Button\r\n                              size=\"sm\"\r\n                              onClick={() => handleSend(invoice.id)}\r\n                            >\r\n                              <Send className=\"mr-2 h-4 w-4\" />\r\n                              Send\r\n                            </Button>\r\n                          )}\r\n                          {['sent', 'partially_paid', 'overdue'].includes(invoice.status) && (\r\n                            <Button\r\n                              size=\"sm\"\r\n                              onClick={() => handleMarkPaid(invoice.id, invoice.balance_due || invoice.total)}\r\n                            >\r\n                              <DollarSign className=\"mr-2 h-4 w-4\" />\r\n                              Mark Paid\r\n                            </Button>\r\n                          )}\r\n                        </div>\r\n                      </div>\r\n                    </CardContent>\r\n                  </Card>\r\n                ))}\r\n              </div>\r\n            )}\r\n          </TabsContent>\r\n        </Tabs>\r\n      </div>\r\n\r\n      {/* Generate Invoice Modal */}\r\n      <GenerateInvoiceModal\r\n        open={showGenerateModal}\r\n        onClose={() => {\r\n          setShowGenerateModal(false);\r\n          setSelectedInvestorId(undefined);\r\n        }}\r\n        onSuccess={() => fetchData()}\r\n        preselectedInvestorId={selectedInvestorId}\r\n      />\r\n    </>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}}]
}