{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/ghilesmoussaoui/Desktop/Versotech/versotech-portal/src/components/ui/card.tsx"],"sourcesContent":["import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction Card({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"card\"\n      className={cn(\n        \"bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction CardHeader({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"card-header\"\n      className={cn(\n        \"@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-1.5 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction CardTitle({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"card-title\"\n      className={cn(\"leading-none font-semibold\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction CardDescription({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"card-description\"\n      className={cn(\"text-muted-foreground text-sm\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction CardAction({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"card-action\"\n      className={cn(\n        \"col-start-2 row-span-2 row-start-1 self-start justify-self-end\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction CardContent({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"card-content\"\n      className={cn(\"px-6\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction CardFooter({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"card-footer\"\n      className={cn(\"flex items-center px-6 [.border-t]:pt-6\", className)}\n      {...props}\n    />\n  )\n}\n\nexport {\n  Card,\n  CardHeader,\n  CardFooter,\n  CardTitle,\n  CardAction,\n  CardDescription,\n  CardContent,\n}\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;AAEA;;;AAEA,SAAS,KAAK,EAAE,SAAS,EAAE,GAAG,OAAoC;IAChE,qBACE,qQAAC;QACC,aAAU;QACV,WAAW,IAAA,gJAAE,EACX,qFACA;QAED,GAAG,KAAK;;;;;;AAGf;AAEA,SAAS,WAAW,EAAE,SAAS,EAAE,GAAG,OAAoC;IACtE,qBACE,qQAAC;QACC,aAAU;QACV,WAAW,IAAA,gJAAE,EACX,8JACA;QAED,GAAG,KAAK;;;;;;AAGf;AAEA,SAAS,UAAU,EAAE,SAAS,EAAE,GAAG,OAAoC;IACrE,qBACE,qQAAC;QACC,aAAU;QACV,WAAW,IAAA,gJAAE,EAAC,8BAA8B;QAC3C,GAAG,KAAK;;;;;;AAGf;AAEA,SAAS,gBAAgB,EAAE,SAAS,EAAE,GAAG,OAAoC;IAC3E,qBACE,qQAAC;QACC,aAAU;QACV,WAAW,IAAA,gJAAE,EAAC,iCAAiC;QAC9C,GAAG,KAAK;;;;;;AAGf;AAEA,SAAS,WAAW,EAAE,SAAS,EAAE,GAAG,OAAoC;IACtE,qBACE,qQAAC;QACC,aAAU;QACV,WAAW,IAAA,gJAAE,EACX,kEACA;QAED,GAAG,KAAK;;;;;;AAGf;AAEA,SAAS,YAAY,EAAE,SAAS,EAAE,GAAG,OAAoC;IACvE,qBACE,qQAAC;QACC,aAAU;QACV,WAAW,IAAA,gJAAE,EAAC,QAAQ;QACrB,GAAG,KAAK;;;;;;AAGf;AAEA,SAAS,WAAW,EAAE,SAAS,EAAE,GAAG,OAAoC;IACtE,qBACE,qQAAC;QACC,aAAU;QACV,WAAW,IAAA,gJAAE,EAAC,2CAA2C;QACxD,GAAG,KAAK;;;;;;AAGf"}},
    {"offset": {"line": 106, "column": 0}, "map": {"version":3,"sources":["file:///Users/ghilesmoussaoui/Desktop/Versotech/versotech-portal/src/components/ui/checkbox.tsx"],"sourcesContent":["\"use client\"\n\nimport * as React from \"react\"\nimport * as CheckboxPrimitive from \"@radix-ui/react-checkbox\"\nimport { Check } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Checkbox = React.forwardRef<\n  React.ElementRef<typeof CheckboxPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof CheckboxPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <CheckboxPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"peer h-5 w-5 md:h-4 md:w-4 shrink-0 rounded border border-white/20 bg-white/5 data-[state=checked]:bg-blue-600 data-[state=checked]:border-blue-600 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-400/20 focus-visible:border-blue-400/50 disabled:cursor-not-allowed disabled:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <CheckboxPrimitive.Indicator\n      className={cn(\"flex items-center justify-center text-white\")}\n    >\n      <Check className=\"h-4 w-4 md:h-3.5 md:w-3.5\" />\n    </CheckboxPrimitive.Indicator>\n  </CheckboxPrimitive.Root>\n))\nCheckbox.displayName = CheckboxPrimitive.Root.displayName\n\nexport { Checkbox }\n\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AAEA;AANA;;;;;;AAQA,MAAM,yBAAW,0OAAgB,CAG/B,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,qQAAC,mMAAsB;QACrB,KAAK;QACL,WAAW,IAAA,gJAAE,EACX,uTACA;QAED,GAAG,KAAK;kBAET,cAAA,qQAAC,wMAA2B;YAC1B,WAAW,IAAA,gJAAE,EAAC;sBAEd,cAAA,qQAAC,oOAAK;gBAAC,WAAU;;;;;;;;;;;;;;;;AAIvB,SAAS,WAAW,GAAG,mMAAsB,CAAC,WAAW"}},
    {"offset": {"line": 150, "column": 0}, "map": {"version":3,"sources":["file:///Users/ghilesmoussaoui/Desktop/Versotech/versotech-portal/src/components/fees/TermSheetSelector.tsx"],"sourcesContent":["/**\n * Term Sheet Selector Component\n *\n * Allows selection of a published term sheet for a deal.\n * Fee models must be derived from term sheets per business requirements.\n */\n\n'use client';\n\nimport { useState, useEffect } from 'react';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { Label } from '@/components/ui/label';\nimport { Badge } from '@/components/ui/badge';\nimport { Loader2, FileText, AlertCircle } from 'lucide-react';\n\nexport interface TermSheet {\n  id: string;\n  deal_id: string;\n  version: number;\n  status: string;\n  term_sheet_date: string | null;\n  subscription_fee_percent: number | null;\n  management_fee_percent: number | null;\n  carried_interest_percent: number | null;\n  published_at: string | null;\n}\n\ninterface TermSheetSelectorProps {\n  dealId: string | undefined;\n  value?: string;\n  onChange: (termSheetId: string | undefined, termSheet: TermSheet | null) => void;\n  required?: boolean;\n  disabled?: boolean;\n}\n\nexport function TermSheetSelector({\n  dealId,\n  value,\n  onChange,\n  required = true,\n  disabled = false,\n}: TermSheetSelectorProps) {\n  const [loading, setLoading] = useState(false);\n  const [termSheets, setTermSheets] = useState<TermSheet[]>([]);\n  const [error, setError] = useState<string | null>(null);\n\n  useEffect(() => {\n    if (dealId) {\n      loadTermSheets(dealId);\n    } else {\n      setTermSheets([]);\n      onChange(undefined, null);\n    }\n  }, [dealId]);\n\n  const loadTermSheets = async (dId: string) => {\n    setLoading(true);\n    setError(null);\n    try {\n      const res = await fetch(`/api/deals/${dId}/fee-structures?status=published`);\n      if (!res.ok) {\n        throw new Error('Failed to load term sheets');\n      }\n      const json = await res.json();\n      const sheets = json.term_sheets || [];\n      setTermSheets(sheets);\n\n      // If current value is not in the list, clear it\n      if (value && !sheets.find((ts: TermSheet) => ts.id === value)) {\n        onChange(undefined, null);\n      }\n    } catch (err) {\n      console.error('Error loading term sheets:', err);\n      setError('Failed to load term sheets');\n      setTermSheets([]);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleChange = (termSheetId: string) => {\n    if (termSheetId === 'none') {\n      onChange(undefined, null);\n    } else {\n      const selected = termSheets.find(ts => ts.id === termSheetId);\n      onChange(termSheetId, selected || null);\n    }\n  };\n\n  const formatFeePercent = (value: number | null | undefined): string => {\n    if (value === null || value === undefined) return '-';\n    return `${value}%`;\n  };\n\n  const selectedTermSheet = termSheets.find(ts => ts.id === value);\n\n  if (!dealId) {\n    return (\n      <div className=\"space-y-2\">\n        <Label className=\"text-white font-medium\">\n          Term Sheet {required && <span className=\"text-red-400\">*</span>}\n        </Label>\n        <div className=\"flex items-center gap-2 text-amber-400 text-sm bg-amber-500/10 p-3 rounded border border-amber-500/30\">\n          <AlertCircle className=\"h-4 w-4\" />\n          <span>Select a deal first to see available term sheets</span>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-2\">\n      <Label className=\"text-white font-medium\">\n        Term Sheet {required && <span className=\"text-red-400\">*</span>}\n      </Label>\n\n      {loading ? (\n        <div className=\"flex items-center gap-2 text-gray-400 h-11 px-3 border border-gray-700 rounded-md bg-black\">\n          <Loader2 className=\"h-4 w-4 animate-spin\" />\n          <span className=\"text-sm\">Loading term sheets...</span>\n        </div>\n      ) : error ? (\n        <div className=\"flex items-center gap-2 text-red-400 text-sm bg-red-500/10 p-3 rounded border border-red-500/30\">\n          <AlertCircle className=\"h-4 w-4\" />\n          <span>{error}</span>\n        </div>\n      ) : termSheets.length === 0 ? (\n        <div className=\"flex items-center gap-2 text-amber-400 text-sm bg-amber-500/10 p-3 rounded border border-amber-500/30\">\n          <AlertCircle className=\"h-4 w-4\" />\n          <span>No published term sheets available for this deal. Create and publish a term sheet first.</span>\n        </div>\n      ) : (\n        <>\n          <Select\n            value={value || 'none'}\n            onValueChange={handleChange}\n            disabled={disabled}\n          >\n            <SelectTrigger className=\"bg-black border-gray-700 text-white h-11\">\n              <SelectValue placeholder=\"Select a term sheet\" />\n            </SelectTrigger>\n            <SelectContent className=\"bg-black border-gray-700 text-white\">\n              {!required && (\n                <SelectItem value=\"none\">No term sheet</SelectItem>\n              )}\n              {termSheets.map((ts) => (\n                <SelectItem key={ts.id} value={ts.id}>\n                  <div className=\"flex items-center gap-2\">\n                    <FileText className=\"h-4 w-4 text-gray-400\" />\n                    <span>Version {ts.version}</span>\n                    {ts.term_sheet_date && (\n                      <span className=\"text-gray-400 text-xs\">\n                        ({new Date(ts.term_sheet_date).toLocaleDateString()})\n                      </span>\n                    )}\n                  </div>\n                </SelectItem>\n              ))}\n            </SelectContent>\n          </Select>\n\n          {/* Show fee summary when a term sheet is selected */}\n          {selectedTermSheet && (\n            <div className=\"bg-gray-900/50 border border-gray-700 rounded-md p-3 mt-2\">\n              <p className=\"text-xs text-gray-400 mb-2 font-medium\">Term Sheet Fee Limits:</p>\n              <div className=\"flex flex-wrap gap-2\">\n                <Badge variant=\"outline\" className=\"text-xs border-blue-500/30 text-blue-400\">\n                  Subscription: {formatFeePercent(selectedTermSheet.subscription_fee_percent)}\n                </Badge>\n                <Badge variant=\"outline\" className=\"text-xs border-green-500/30 text-green-400\">\n                  Management: {formatFeePercent(selectedTermSheet.management_fee_percent)}\n                </Badge>\n                <Badge variant=\"outline\" className=\"text-xs border-purple-500/30 text-purple-400\">\n                  Performance: {formatFeePercent(selectedTermSheet.carried_interest_percent)}\n                </Badge>\n              </div>\n              <p className=\"text-xs text-gray-500 mt-2\">\n                Fee model values must not exceed these limits.\n              </p>\n            </div>\n          )}\n        </>\n      )}\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 536, "column": 0}, "map": {"version":3,"sources":["file:///Users/ghilesmoussaoui/Desktop/Versotech/versotech-portal/src/components/fees/EntitySelector.tsx"],"sourcesContent":["/**\n * Entity Selector Component\n *\n * Allows selection of an introducer, partner, or commercial partner for a fee model.\n * Fee models are commercial agreements with entities, not investor-facing.\n */\n\n'use client';\n\nimport { useState, useEffect } from 'react';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { Label } from '@/components/ui/label';\nimport { Loader2, Users, Building2, Briefcase, AlertCircle } from 'lucide-react';\n\nexport type EntityType = 'introducer' | 'partner' | 'commercial_partner';\n\ninterface Entity {\n  id: string;\n  name: string;\n  email?: string;\n  company_name?: string;\n}\n\ninterface EntitySelectorProps {\n  dealId: string | undefined;\n  entityType: EntityType | undefined;\n  onEntityTypeChange: (type: EntityType | undefined) => void;\n  entityId: string | undefined;\n  onEntityIdChange: (id: string | undefined) => void;\n  required?: boolean;\n  disabled?: boolean;\n  /** Entity types to exclude from selection */\n  excludeTypes?: EntityType[];\n}\n\nexport function EntitySelector({\n  dealId,\n  entityType,\n  onEntityTypeChange,\n  entityId,\n  onEntityIdChange,\n  required = true,\n  disabled = false,\n  excludeTypes = [],\n}: EntitySelectorProps) {\n  const [loading, setLoading] = useState(false);\n  const [entities, setEntities] = useState<Entity[]>([]);\n  const [error, setError] = useState<string | null>(null);\n\n  useEffect(() => {\n    if (dealId && entityType) {\n      loadEntities(dealId, entityType);\n    } else {\n      setEntities([]);\n      onEntityIdChange(undefined);\n    }\n  }, [dealId, entityType]);\n\n  const loadEntities = async (dId: string, type: EntityType) => {\n    setLoading(true);\n    setError(null);\n    try {\n      // Load entities dispatched to this deal based on type\n      let endpoint = '';\n      switch (type) {\n        case 'introducer':\n          endpoint = `/api/deals/${dId}/introducers`;\n          break;\n        case 'partner':\n          endpoint = `/api/deals/${dId}/partners`;\n          break;\n        case 'commercial_partner':\n          endpoint = `/api/deals/${dId}/commercial-partners`;\n          break;\n      }\n\n      const res = await fetch(endpoint);\n      if (!res.ok) {\n        // If endpoint doesn't exist or returns error, try fallback\n        console.warn(`Entity endpoint ${endpoint} not available, trying fallback`);\n        await loadEntitiesFallback(type);\n        return;\n      }\n\n      const json = await res.json();\n      // Handle different response formats from various endpoints\n      let entityList = json.introducers || json.partners || json.commercial_partners || [];\n\n      // Deal-specific endpoints return { data: [...] } with transformed entities\n      if (entityList.length === 0 && json.data && Array.isArray(json.data)) {\n        // Transform the deal-specific format to entity format\n        entityList = json.data\n          .filter((item: any) => item.entity_type === type.replace('_', ''))\n          .map((item: any) => ({\n            id: item.entity_id,\n            name: item.entity_name,\n            email: item.entity_email,\n          }));\n      }\n\n      // If still empty, fall back to admin endpoint to get ALL entities\n      if (entityList.length === 0) {\n        console.log(`No ${type}s found for deal, loading all ${type}s from admin endpoint`);\n        await loadEntitiesFallback(type);\n        return;\n      }\n\n      setEntities(entityList);\n\n      // If current value is not in the list, clear it\n      if (entityId && !entityList.find((e: Entity) => e.id === entityId)) {\n        onEntityIdChange(undefined);\n      }\n    } catch (err) {\n      console.error('Error loading entities:', err);\n      await loadEntitiesFallback(type);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  // Fallback to load all entities of a type (not deal-specific)\n  // Uses admin endpoints which list all entities in the system\n  const loadEntitiesFallback = async (type: EntityType) => {\n    try {\n      let endpoint = '';\n      switch (type) {\n        case 'introducer':\n          endpoint = '/api/admin/introducers';\n          break;\n        case 'partner':\n          endpoint = '/api/admin/partners';\n          break;\n        case 'commercial_partner':\n          endpoint = '/api/admin/commercial-partners';\n          break;\n      }\n\n      const res = await fetch(endpoint);\n      if (!res.ok) {\n        throw new Error(`Failed to load ${type}s`);\n      }\n\n      const json = await res.json();\n      // Admin endpoints return data in various formats - handle all possibilities\n      const entityList = json.introducers || json.partners || json.commercial_partners || json.data || [];\n\n      // Map the entity list to a common format\n      const normalizedEntities = entityList.map((entity: any) => ({\n        id: entity.id,\n        name: entity.name || entity.legal_name || entity.company_name || entity.contact_name,\n        email: entity.email || entity.contact_email,\n        company_name: entity.company_name || entity.legal_name,\n      }));\n\n      setEntities(normalizedEntities);\n    } catch (err) {\n      console.error('Error in fallback loading:', err);\n      setError(`Failed to load ${type}s`);\n      setEntities([]);\n    }\n  };\n\n  const handleEntityTypeChange = (value: string) => {\n    if (value === 'none') {\n      onEntityTypeChange(undefined);\n      onEntityIdChange(undefined);\n    } else {\n      onEntityTypeChange(value as EntityType);\n      onEntityIdChange(undefined); // Reset entity when type changes\n    }\n  };\n\n  const handleEntityChange = (value: string) => {\n    if (value === 'none') {\n      onEntityIdChange(undefined);\n    } else {\n      onEntityIdChange(value);\n    }\n  };\n\n  const getEntityTypeIcon = (type: EntityType | undefined) => {\n    switch (type) {\n      case 'introducer':\n        return <Users className=\"h-4 w-4\" />;\n      case 'partner':\n        return <Building2 className=\"h-4 w-4\" />;\n      case 'commercial_partner':\n        return <Briefcase className=\"h-4 w-4\" />;\n      default:\n        return null;\n    }\n  };\n\n  const getEntityTypeLabel = (type: EntityType): string => {\n    switch (type) {\n      case 'introducer':\n        return 'Introducer';\n      case 'partner':\n        return 'Partner';\n      case 'commercial_partner':\n        return 'Commercial Partner';\n    }\n  };\n\n  if (!dealId) {\n    return (\n      <div className=\"space-y-4\">\n        <div className=\"space-y-2\">\n          <Label className=\"text-white font-medium\">\n            Entity Type {required && <span className=\"text-red-400\">*</span>}\n          </Label>\n          <div className=\"flex items-center gap-2 text-amber-400 text-sm bg-amber-500/10 p-3 rounded border border-amber-500/30\">\n            <AlertCircle className=\"h-4 w-4\" />\n            <span>Select a deal first to assign an entity</span>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-4\">\n      {/* Entity Type Selector */}\n      <div className=\"space-y-2\">\n        <Label className=\"text-white font-medium\">\n          Entity Type {required && <span className=\"text-red-400\">*</span>}\n        </Label>\n        <Select\n          value={entityType || 'none'}\n          onValueChange={handleEntityTypeChange}\n          disabled={disabled}\n        >\n          <SelectTrigger className=\"bg-black border-gray-700 text-white h-11\">\n            <SelectValue placeholder=\"Select entity type\" />\n          </SelectTrigger>\n          <SelectContent className=\"bg-black border-gray-700 text-white\">\n            {!required && (\n              <SelectItem value=\"none\">No entity</SelectItem>\n            )}\n            {!excludeTypes.includes('introducer') && (\n              <SelectItem value=\"introducer\">\n                <div className=\"flex items-center gap-2\">\n                  <Users className=\"h-4 w-4 text-blue-400\" />\n                  <span>Introducer</span>\n                </div>\n              </SelectItem>\n            )}\n            {!excludeTypes.includes('partner') && (\n              <SelectItem value=\"partner\">\n                <div className=\"flex items-center gap-2\">\n                  <Building2 className=\"h-4 w-4 text-green-400\" />\n                  <span>Partner</span>\n                </div>\n              </SelectItem>\n            )}\n            {!excludeTypes.includes('commercial_partner') && (\n              <SelectItem value=\"commercial_partner\">\n                <div className=\"flex items-center gap-2\">\n                  <Briefcase className=\"h-4 w-4 text-purple-400\" />\n                  <span>Commercial Partner</span>\n                </div>\n              </SelectItem>\n            )}\n          </SelectContent>\n        </Select>\n      </div>\n\n      {/* Entity Selector (only shown when type is selected) */}\n      {entityType && (\n        <div className=\"space-y-2\">\n          <Label className=\"text-white font-medium\">\n            {getEntityTypeLabel(entityType)} {required && <span className=\"text-red-400\">*</span>}\n          </Label>\n\n          {loading ? (\n            <div className=\"flex items-center gap-2 text-gray-400 h-11 px-3 border border-gray-700 rounded-md bg-black\">\n              <Loader2 className=\"h-4 w-4 animate-spin\" />\n              <span className=\"text-sm\">Loading {entityType}s...</span>\n            </div>\n          ) : error ? (\n            <div className=\"flex items-center gap-2 text-red-400 text-sm bg-red-500/10 p-3 rounded border border-red-500/30\">\n              <AlertCircle className=\"h-4 w-4\" />\n              <span>{error}</span>\n            </div>\n          ) : entities.length === 0 ? (\n            <div className=\"flex items-center gap-2 text-amber-400 text-sm bg-amber-500/10 p-3 rounded border border-amber-500/30\">\n              <AlertCircle className=\"h-4 w-4\" />\n              <span>No {entityType}s available. Add {entityType}s to the system first.</span>\n            </div>\n          ) : (\n            <Select\n              value={entityId || 'none'}\n              onValueChange={handleEntityChange}\n              disabled={disabled}\n            >\n              <SelectTrigger className=\"bg-black border-gray-700 text-white h-11\">\n                <SelectValue placeholder={`Select ${getEntityTypeLabel(entityType)}`} />\n              </SelectTrigger>\n              <SelectContent className=\"bg-black border-gray-700 text-white max-h-60\">\n                {!required && (\n                  <SelectItem value=\"none\">No selection</SelectItem>\n                )}\n                {entities.map((entity) => (\n                  <SelectItem key={entity.id} value={entity.id}>\n                    <div className=\"flex items-center gap-2\">\n                      {getEntityTypeIcon(entityType)}\n                      <span>{entity.name || entity.company_name}</span>\n                      {entity.email && (\n                        <span className=\"text-gray-400 text-xs\">({entity.email})</span>\n                      )}\n                    </div>\n                  </SelectItem>\n                ))}\n              </SelectContent>\n            </Select>\n          )}\n        </div>\n      )}\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1137, "column": 0}, "map": {"version":3,"sources":["file:///Users/ghilesmoussaoui/Desktop/Versotech/versotech-portal/src/lib/fees/term-sheet-sync.ts"],"sourcesContent":["/**\r\n * Term Sheet & Fee Plan Utilities\r\n *\r\n * IMPORTANT ARCHITECTURAL NOTE:\r\n * Term sheets and fee plans/models serve DIFFERENT purposes:\r\n * - Term sheets: Investor-facing fee disclosures\r\n * - Fee models: Introducer/Partner commission agreements\r\n *\r\n * Fee models must be MANUALLY created and linked to term sheets.\r\n * Auto-sync between term sheets and fee plans has been DEPRECATED.\r\n */\r\n\r\nimport { SupabaseClient } from '@supabase/supabase-js';\r\n\r\n/**\r\n * Convert percent to basis points\r\n * @param percent - Percentage value (e.g., 2.5 for 2.5%)\r\n * @returns Basis points (e.g., 250 for 2.5%)\r\n */\r\nexport function percentToBps(percent: number | null | undefined): number | null {\r\n  if (percent === null || percent === undefined) return null;\r\n  return Math.round(percent * 100);\r\n}\r\n\r\n/**\r\n * Convert basis points to percent\r\n * @param bps - Basis points (e.g., 250 for 2.5%)\r\n * @returns Percentage value (e.g., 2.5 for 2.5%)\r\n */\r\nexport function bpsToPercent(bps: number | null | undefined): number | null {\r\n  if (bps === null || bps === undefined) return null;\r\n  return bps / 100;\r\n}\r\n\r\n/**\r\n * Validate that fee model values do not exceed term sheet limits\r\n * @param feeComponents - Array of fee components to validate\r\n * @param termSheet - The term sheet to validate against\r\n * @returns Array of validation error messages (empty if valid)\r\n */\r\nexport function validateFeeComponentsAgainstTermSheet(\r\n  feeComponents: Array<{ kind: string; rate_bps?: number | null }>,\r\n  termSheet: {\r\n    subscription_fee_percent?: number | null;\r\n    management_fee_percent?: number | null;\r\n    carried_interest_percent?: number | null;\r\n  }\r\n): string[] {\r\n  const errors: string[] = [];\r\n\r\n  for (const comp of feeComponents) {\r\n    if (!comp.rate_bps) continue;\r\n\r\n    const compPercent = bpsToPercent(comp.rate_bps);\r\n    if (compPercent === null) continue;\r\n\r\n    switch (comp.kind) {\r\n      case 'subscription':\r\n        if (termSheet.subscription_fee_percent !== null &&\r\n            termSheet.subscription_fee_percent !== undefined &&\r\n            compPercent > termSheet.subscription_fee_percent) {\r\n          errors.push(\r\n            `Subscription fee (${compPercent}%) exceeds term sheet limit (${termSheet.subscription_fee_percent}%)`\r\n          );\r\n        }\r\n        break;\r\n      case 'management':\r\n        if (termSheet.management_fee_percent !== null &&\r\n            termSheet.management_fee_percent !== undefined &&\r\n            compPercent > termSheet.management_fee_percent) {\r\n          errors.push(\r\n            `Management fee (${compPercent}%) exceeds term sheet limit (${termSheet.management_fee_percent}%)`\r\n          );\r\n        }\r\n        break;\r\n      case 'performance':\r\n        if (termSheet.carried_interest_percent !== null &&\r\n            termSheet.carried_interest_percent !== undefined &&\r\n            compPercent > termSheet.carried_interest_percent) {\r\n          errors.push(\r\n            `Performance fee (${compPercent}%) exceeds term sheet limit (${termSheet.carried_interest_percent}%)`\r\n          );\r\n        }\r\n        break;\r\n    }\r\n  }\r\n\r\n  return errors;\r\n}\r\n\r\n/**\r\n * @deprecated Fee models must be manually created. Auto-sync is disabled.\r\n *\r\n * This function previously auto-generated fee plans from published term sheets.\r\n * Per business requirements (Fred), fee models are commercial agreements with\r\n * introducers/partners and must be manually created, not auto-generated.\r\n *\r\n * The function is kept for backward compatibility but does nothing.\r\n * All callers should be removed.\r\n */\r\nexport async function syncTermSheetToFeePlan(\r\n  supabase: SupabaseClient,\r\n  termSheet: {\r\n    id: string;\r\n    subscription_fee_percent?: number | null;\r\n    management_fee_percent?: number | null;\r\n    carried_interest_percent?: number | null;\r\n  },\r\n  dealId: string,\r\n  userId: string\r\n): Promise<{ success: boolean; error?: string; feePlanId?: string }> {\r\n  console.warn(\r\n    '[DEPRECATED] syncTermSheetToFeePlan() called but auto-sync is disabled. ' +\r\n    'Fee models must be manually created by staff and linked to term sheets. ' +\r\n    `Term sheet: ${termSheet.id}, Deal: ${dealId}`\r\n  );\r\n\r\n  // No-op - return success without creating anything\r\n  return { success: true };\r\n}\r\n\r\n/**\r\n * @deprecated Fee models and term sheets serve different purposes - no sync.\r\n *\r\n * This function previously synced fee plan values back to term sheets.\r\n * Per business requirements (Fred):\r\n * - Term sheets are investor-facing fee disclosures\r\n * - Fee models are introducer/partner commission agreements\r\n *\r\n * They should NOT sync as they have different values for different audiences.\r\n * The function is kept for backward compatibility but does nothing.\r\n */\r\nexport async function syncFeePlanToTermSheet(\r\n  supabase: SupabaseClient,\r\n  feePlanId: string,\r\n  dealId: string\r\n): Promise<{ success: boolean; error?: string }> {\r\n  console.warn(\r\n    '[DEPRECATED] syncFeePlanToTermSheet() called but sync is disabled. ' +\r\n    'Term sheets (investor-facing) and fee models (partner/introducer agreements) ' +\r\n    'serve different purposes and should not sync. ' +\r\n    `Fee plan: ${feePlanId}, Deal: ${dealId}`\r\n  );\r\n\r\n  // No-op - return success without doing anything\r\n  return { success: true };\r\n}\r\n"],"names":[],"mappings":"AAAA;;;;;;;;;;CAUC;;;;;;;;;;;;AASM,SAAS,aAAa,OAAkC;IAC7D,IAAI,YAAY,QAAQ,YAAY,WAAW,OAAO;IACtD,OAAO,KAAK,KAAK,CAAC,UAAU;AAC9B;AAOO,SAAS,aAAa,GAA8B;IACzD,IAAI,QAAQ,QAAQ,QAAQ,WAAW,OAAO;IAC9C,OAAO,MAAM;AACf;AAQO,SAAS,sCACd,aAAgE,EAChE,SAIC;IAED,MAAM,SAAmB,EAAE;IAE3B,KAAK,MAAM,QAAQ,cAAe;QAChC,IAAI,CAAC,KAAK,QAAQ,EAAE;QAEpB,MAAM,cAAc,aAAa,KAAK,QAAQ;QAC9C,IAAI,gBAAgB,MAAM;QAE1B,OAAQ,KAAK,IAAI;YACf,KAAK;gBACH,IAAI,UAAU,wBAAwB,KAAK,QACvC,UAAU,wBAAwB,KAAK,aACvC,cAAc,UAAU,wBAAwB,EAAE;oBACpD,OAAO,IAAI,CACT,CAAC,kBAAkB,EAAE,YAAY,6BAA6B,EAAE,UAAU,wBAAwB,CAAC,EAAE,CAAC;gBAE1G;gBACA;YACF,KAAK;gBACH,IAAI,UAAU,sBAAsB,KAAK,QACrC,UAAU,sBAAsB,KAAK,aACrC,cAAc,UAAU,sBAAsB,EAAE;oBAClD,OAAO,IAAI,CACT,CAAC,gBAAgB,EAAE,YAAY,6BAA6B,EAAE,UAAU,sBAAsB,CAAC,EAAE,CAAC;gBAEtG;gBACA;YACF,KAAK;gBACH,IAAI,UAAU,wBAAwB,KAAK,QACvC,UAAU,wBAAwB,KAAK,aACvC,cAAc,UAAU,wBAAwB,EAAE;oBACpD,OAAO,IAAI,CACT,CAAC,iBAAiB,EAAE,YAAY,6BAA6B,EAAE,UAAU,wBAAwB,CAAC,EAAE,CAAC;gBAEzG;gBACA;QACJ;IACF;IAEA,OAAO;AACT;AAYO,eAAe,uBACpB,QAAwB,EACxB,SAKC,EACD,MAAc,EACd,MAAc;IAEd,QAAQ,IAAI,CACV,6EACA,6EACA,CAAC,YAAY,EAAE,UAAU,EAAE,CAAC,QAAQ,EAAE,QAAQ;IAGhD,mDAAmD;IACnD,OAAO;QAAE,SAAS;IAAK;AACzB;AAaO,eAAe,uBACpB,QAAwB,EACxB,SAAiB,EACjB,MAAc;IAEd,QAAQ,IAAI,CACV,wEACA,kFACA,mDACA,CAAC,UAAU,EAAE,UAAU,QAAQ,EAAE,QAAQ;IAG3C,gDAAgD;IAChD,OAAO;QAAE,SAAS;IAAK;AACzB"}},
    {"offset": {"line": 1211, "column": 0}, "map": {"version":3,"sources":["file:///Users/ghilesmoussaoui/Desktop/Versotech/versotech-portal/src/components/fees/FeePlanEditModal.tsx"],"sourcesContent":["/**\r\n * Fee Plan Edit Modal - Redesigned\r\n *\r\n * A clean, wizard-style modal for creating and editing fee plans.\r\n * Uses progressive disclosure to reduce cognitive load.\r\n */\r\n\r\n'use client';\r\n\r\nimport { useState, useEffect, useCallback, useMemo } from 'react';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\nimport {\r\n  Dialog,\r\n  DialogContent,\r\n  DialogHeader,\r\n  DialogTitle,\r\n} from '@/components/ui/dialog';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Input } from '@/components/ui/input';\r\nimport { Label } from '@/components/ui/label';\r\nimport { Textarea } from '@/components/ui/textarea';\r\nimport {\r\n  Select,\r\n  SelectContent,\r\n  SelectItem,\r\n  SelectTrigger,\r\n  SelectValue,\r\n} from '@/components/ui/select';\r\nimport { Checkbox } from '@/components/ui/checkbox';\r\nimport { Badge } from '@/components/ui/badge';\r\nimport {\r\n  Plus,\r\n  Trash2,\r\n  Loader2,\r\n  AlertTriangle,\r\n  ChevronDown,\r\n  FileText,\r\n  DollarSign,\r\n  ScrollText,\r\n  Check,\r\n  Building2,\r\n} from 'lucide-react';\r\nimport type { FeePlanWithComponents } from '@/lib/fees/types';\r\nimport { TermSheetSelector, type TermSheet } from './TermSheetSelector';\r\nimport { EntitySelector, type EntityType } from './EntitySelector';\r\nimport { validateFeeComponentsAgainstTermSheet } from '@/lib/fees/term-sheet-sync';\r\n\r\n// ============================================================================\r\n// TYPES\r\n// ============================================================================\r\n\r\ninterface FeePlanEditModalProps {\r\n  open: boolean;\r\n  onClose: () => void;\r\n  onSuccess: () => void;\r\n  feePlan?: FeePlanWithComponents | null;\r\n  dealId?: string;\r\n  initialTermSheetId?: string;\r\n}\r\n\r\ninterface FeeComponent {\r\n  id?: string;\r\n  kind: 'subscription' | 'management' | 'performance' | 'spread_markup' | 'flat' | 'bd_fee' | 'finra_fee' | 'other';\r\n  calc_method: string;\r\n  frequency: string;\r\n  rate_bps?: number;\r\n  flat_amount?: number;\r\n  notes?: string;\r\n  payment_schedule?: string;\r\n  duration_periods?: number;\r\n  duration_unit?: string;\r\n  tier_threshold_multiplier?: number;\r\n}\r\n\r\ninterface AgreementTerms {\r\n  duration_months: number;\r\n  non_circumvention_months: number | null;\r\n  non_circumvention_indefinite: boolean;\r\n  governing_law: string;\r\n  vat_number: string;\r\n  intro_payment_days: number;\r\n  perf_payment_days: number;\r\n  hurdle_rate_bps?: number;\r\n  has_catchup: boolean;\r\n  catchup_rate_bps?: number;\r\n  has_high_water_mark: boolean;\r\n  has_no_cap: boolean;\r\n  performance_cap_percent?: number;\r\n}\r\n\r\n// ============================================================================\r\n// CONSTANTS\r\n// ============================================================================\r\n\r\nconst FEE_KINDS = [\r\n  { value: 'subscription', label: 'Subscription Fee', color: 'blue' },\r\n  { value: 'management', label: 'Management Fee', color: 'green' },\r\n  { value: 'performance', label: 'Performance Fee', color: 'purple' },\r\n  { value: 'flat', label: 'Flat Fee', color: 'amber' },\r\n  { value: 'spread_markup', label: 'Spread/Markup', color: 'cyan' },\r\n  { value: 'other', label: 'Other', color: 'gray' },\r\n] as const;\r\n\r\nconst CALC_METHODS = [\r\n  { value: 'percent_of_investment', label: '% of Investment' },\r\n  { value: 'percent_per_annum', label: '% per Annum' },\r\n  { value: 'percent_of_profit', label: '% of Profit' },\r\n  { value: 'fixed_amount', label: 'Fixed Amount' },\r\n] as const;\r\n\r\nconst GOVERNING_LAWS = [\r\n  'British Virgin Islands',\r\n  'England and Wales',\r\n  'Cayman Islands',\r\n  'Delaware, USA',\r\n  'Singapore',\r\n] as const;\r\n\r\nconst DEFAULT_AGREEMENT_TERMS: AgreementTerms = {\r\n  duration_months: 36,\r\n  non_circumvention_months: null,\r\n  non_circumvention_indefinite: true,\r\n  governing_law: 'British Virgin Islands',\r\n  vat_number: '',\r\n  intro_payment_days: 3,\r\n  perf_payment_days: 10,\r\n  has_catchup: false,\r\n  has_high_water_mark: false,\r\n  has_no_cap: true,\r\n};\r\n\r\n// ============================================================================\r\n// SECTION COMPONENTS\r\n// ============================================================================\r\n\r\ninterface CollapsibleSectionProps {\r\n  title: string;\r\n  icon: React.ReactNode;\r\n  isOpen: boolean;\r\n  onToggle: () => void;\r\n  children: React.ReactNode;\r\n  badge?: string;\r\n  status?: 'complete' | 'incomplete' | 'error';\r\n}\r\n\r\nfunction CollapsibleSection({\r\n  title,\r\n  icon,\r\n  isOpen,\r\n  onToggle,\r\n  children,\r\n  badge,\r\n  status,\r\n}: CollapsibleSectionProps) {\r\n  return (\r\n    <div className=\"border border-gray-700/50 rounded-2xl overflow-hidden bg-gray-900/40 shadow-lg\">\r\n      <button\r\n        type=\"button\"\r\n        onClick={onToggle}\r\n        className=\"w-full px-8 py-6 flex items-center justify-between hover:bg-gray-800/40 transition-colors\"\r\n      >\r\n        <div className=\"flex items-center gap-5\">\r\n          <div className=\"text-blue-400 p-2 bg-blue-500/10 rounded-lg\">{icon}</div>\r\n          <span className=\"font-bold text-white text-xl\">{title}</span>\r\n          {badge && (\r\n            <Badge variant=\"outline\" className=\"text-sm border-gray-500 text-gray-200 px-3 py-1 font-medium\">\r\n              {badge}\r\n            </Badge>\r\n          )}\r\n        </div>\r\n        <div className=\"flex items-center gap-5\">\r\n          {status === 'complete' && (\r\n            <div className=\"w-8 h-8 rounded-full bg-green-500/20 flex items-center justify-center\">\r\n              <Check className=\"w-5 h-5 text-green-400\" />\r\n            </div>\r\n          )}\r\n          {status === 'error' && (\r\n            <div className=\"w-8 h-8 rounded-full bg-red-500/20 flex items-center justify-center\">\r\n              <AlertTriangle className=\"w-5 h-5 text-red-400\" />\r\n            </div>\r\n          )}\r\n          <motion.div\r\n            animate={{ rotate: isOpen ? 180 : 0 }}\r\n            transition={{ duration: 0.2 }}\r\n            className=\"p-1\"\r\n          >\r\n            <ChevronDown className=\"w-6 h-6 text-gray-400\" />\r\n          </motion.div>\r\n        </div>\r\n      </button>\r\n      <AnimatePresence>\r\n        {isOpen && (\r\n          <motion.div\r\n            initial={{ height: 0, opacity: 0 }}\r\n            animate={{ height: 'auto', opacity: 1 }}\r\n            exit={{ height: 0, opacity: 0 }}\r\n            transition={{ duration: 0.25, ease: 'easeInOut' }}\r\n          >\r\n            <div className=\"px-8 pb-8 pt-6 border-t border-gray-700/50 bg-black/20\">\r\n              {children}\r\n            </div>\r\n          </motion.div>\r\n        )}\r\n      </AnimatePresence>\r\n    </div>\r\n  );\r\n}\r\n\r\n// ============================================================================\r\n// FEE COMPONENT CARD\r\n// ============================================================================\r\n\r\ninterface FeeComponentCardProps {\r\n  component: FeeComponent;\r\n  index: number;\r\n  onChange: (updates: Partial<FeeComponent>) => void;\r\n  onRemove: () => void;\r\n  termSheetLimits?: { subscription?: number; management?: number; performance?: number };\r\n}\r\n\r\nfunction FeeComponentCard({\r\n  component,\r\n  index,\r\n  onChange,\r\n  onRemove,\r\n  termSheetLimits,\r\n}: FeeComponentCardProps) {\r\n  const kindConfig = FEE_KINDS.find((k) => k.value === component.kind);\r\n\r\n  const ratePercent = component.rate_bps ? (component.rate_bps / 100).toFixed(2) : null;\r\n\r\n  // Check if rate exceeds term sheet limit\r\n  const exceedsLimit = useMemo(() => {\r\n    if (!termSheetLimits || !component.rate_bps) return false;\r\n    const limitKey = component.kind as keyof typeof termSheetLimits;\r\n    const limit = termSheetLimits[limitKey];\r\n    if (!limit) return false;\r\n    return (component.rate_bps / 100) > limit;\r\n  }, [termSheetLimits, component.rate_bps, component.kind]);\r\n\r\n  // Color mapping for Tailwind (can't use dynamic class names)\r\n  const getBorderColor = () => {\r\n    switch (kindConfig?.color) {\r\n      case 'blue': return 'border-blue-500/40';\r\n      case 'green': return 'border-green-500/40';\r\n      case 'purple': return 'border-purple-500/40';\r\n      case 'amber': return 'border-amber-500/40';\r\n      case 'cyan': return 'border-cyan-500/40';\r\n      default: return 'border-gray-600';\r\n    }\r\n  };\r\n\r\n  const getBadgeColor = () => {\r\n    switch (kindConfig?.color) {\r\n      case 'blue': return 'bg-blue-500/20 text-blue-400';\r\n      case 'green': return 'bg-green-500/20 text-green-400';\r\n      case 'purple': return 'bg-purple-500/20 text-purple-400';\r\n      case 'amber': return 'bg-amber-500/20 text-amber-400';\r\n      case 'cyan': return 'bg-cyan-500/20 text-cyan-400';\r\n      default: return 'bg-gray-500/20 text-gray-400';\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className={`border-2 rounded-2xl p-6 bg-gray-900/40 ${getBorderColor()} transition-all hover:bg-gray-900/60`}>\r\n      {/* Header Row */}\r\n      <div className=\"flex items-center justify-between mb-6\">\r\n        <div className=\"flex items-center gap-5\">\r\n          <div className={`w-12 h-12 rounded-xl ${getBadgeColor()} flex items-center justify-center font-bold text-lg`}>\r\n            {index + 1}\r\n          </div>\r\n          <div className=\"space-y-1\">\r\n            <Label className=\"text-sm text-gray-400\">Fee Type</Label>\r\n            <Select\r\n              value={component.kind}\r\n              onValueChange={(val) => onChange({ kind: val as FeeComponent['kind'] })}\r\n            >\r\n              <SelectTrigger className=\"w-64 bg-black/60 border-gray-600 text-white h-12 text-base font-medium\">\r\n                <SelectValue />\r\n              </SelectTrigger>\r\n              <SelectContent className=\"bg-gray-900 border-gray-700\">\r\n                {FEE_KINDS.map((kind) => (\r\n                  <SelectItem key={kind.value} value={kind.value} className=\"text-base py-3\">\r\n                    {kind.label}\r\n                  </SelectItem>\r\n                ))}\r\n              </SelectContent>\r\n            </Select>\r\n          </div>\r\n        </div>\r\n        <Button\r\n          type=\"button\"\r\n          variant=\"ghost\"\r\n          size=\"icon\"\r\n          onClick={onRemove}\r\n          className=\"text-gray-500 hover:text-red-400 hover:bg-red-500/10 h-12 w-12 rounded-xl\"\r\n        >\r\n          <Trash2 className=\"w-6 h-6\" />\r\n        </Button>\r\n      </div>\r\n\r\n      {/* Fields - 4 columns with more gap */}\r\n      <div className=\"grid grid-cols-4 gap-6\">\r\n        {/* Calculation Method */}\r\n        <div className=\"space-y-2\">\r\n          <Label className=\"text-sm text-gray-400 font-medium\">Calculation Method</Label>\r\n          <Select\r\n            value={component.calc_method}\r\n            onValueChange={(val) => onChange({ calc_method: val })}\r\n          >\r\n            <SelectTrigger className=\"bg-black/60 border-gray-600 text-white h-12 text-base\">\r\n              <SelectValue />\r\n            </SelectTrigger>\r\n            <SelectContent className=\"bg-gray-900 border-gray-700\">\r\n              {CALC_METHODS.map((method) => (\r\n                <SelectItem key={method.value} value={method.value} className=\"text-base py-2.5\">\r\n                  {method.label}\r\n                </SelectItem>\r\n              ))}\r\n            </SelectContent>\r\n          </Select>\r\n        </div>\r\n\r\n        {/* Conditional: Rate OR Flat Amount based on calc_method */}\r\n        {component.calc_method === 'fixed_amount' ? (\r\n          <div className=\"space-y-2\">\r\n            <Label className=\"text-sm text-gray-400 font-medium\">Amount (USD)</Label>\r\n            <Input\r\n              type=\"number\"\r\n              step=\"0.01\"\r\n              min=\"0\"\r\n              value={component.flat_amount || ''}\r\n              onChange={(e) => onChange({ flat_amount: e.target.value ? Number(e.target.value) : undefined })}\r\n              placeholder=\"5,000.00\"\r\n              className=\"bg-black/60 border-gray-600 text-white h-12 text-lg font-mono\"\r\n            />\r\n            {component.flat_amount && (\r\n              <p className=\"text-base text-green-400 font-semibold\">\r\n                ${component.flat_amount.toLocaleString()}\r\n              </p>\r\n            )}\r\n          </div>\r\n        ) : (\r\n          <div className=\"space-y-2\">\r\n            <Label className=\"text-sm text-gray-400 font-medium\">Rate (Basis Points)</Label>\r\n            <Input\r\n              type=\"number\"\r\n              value={component.rate_bps || ''}\r\n              onChange={(e) => onChange({ rate_bps: e.target.value ? Number(e.target.value) : undefined })}\r\n              placeholder=\"200\"\r\n              className={`bg-black/60 border-gray-600 text-white h-12 text-lg font-mono ${exceedsLimit ? 'border-red-500 bg-red-500/10' : ''}`}\r\n            />\r\n            {ratePercent && (\r\n              <p className={`text-base font-semibold ${exceedsLimit ? 'text-red-400' : 'text-blue-400'}`}>\r\n                = {ratePercent}%\r\n                {exceedsLimit && '  exceeds limit'}\r\n              </p>\r\n            )}\r\n          </div>\r\n        )}\r\n\r\n        {/* Payment Schedule */}\r\n        <div className=\"space-y-2\">\r\n          <Label className=\"text-sm text-gray-400 font-medium\">Payment Schedule</Label>\r\n          <Select\r\n            value={component.payment_schedule || 'upfront'}\r\n            onValueChange={(val) => onChange({ payment_schedule: val })}\r\n          >\r\n            <SelectTrigger className=\"bg-black/60 border-gray-600 text-white h-12 text-base\">\r\n              <SelectValue />\r\n            </SelectTrigger>\r\n            <SelectContent className=\"bg-gray-900 border-gray-700\">\r\n              <SelectItem value=\"upfront\" className=\"text-base py-2.5\">Upfront</SelectItem>\r\n              <SelectItem value=\"recurring\" className=\"text-base py-2.5\">Recurring</SelectItem>\r\n              <SelectItem value=\"on_demand\" className=\"text-base py-2.5\">On Demand</SelectItem>\r\n            </SelectContent>\r\n          </Select>\r\n        </div>\r\n\r\n        {/* Notes */}\r\n        <div className=\"space-y-2\">\r\n          <Label className=\"text-sm text-gray-400 font-medium\">Notes</Label>\r\n          <Input\r\n            value={component.notes || ''}\r\n            onChange={(e) => onChange({ notes: e.target.value })}\r\n            placeholder=\"Optional notes...\"\r\n            className=\"bg-black/60 border-gray-600 text-white h-12 text-base\"\r\n          />\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\n// ============================================================================\r\n// MAIN MODAL COMPONENT\r\n// ============================================================================\r\n\r\nexport default function FeePlanEditModal({\r\n  open,\r\n  onClose,\r\n  onSuccess,\r\n  feePlan,\r\n  dealId,\r\n  initialTermSheetId,\r\n}: FeePlanEditModalProps) {\r\n  // UI State\r\n  const [loading, setLoading] = useState(false);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [expandedSections, setExpandedSections] = useState({\r\n    basic: true,\r\n    components: true,\r\n    agreement: false,\r\n  });\r\n\r\n  // Data State\r\n  const [deals, setDeals] = useState<Array<{ id: string; name: string }>>([]);\r\n  const [validationErrors, setValidationErrors] = useState<string[]>([]);\r\n\r\n  // Form State - Basic Info\r\n  const [name, setName] = useState('');\r\n  const [description, setDescription] = useState('');\r\n  const [selectedDealId, setSelectedDealId] = useState<string | undefined>(dealId);\r\n  const [isActive, setIsActive] = useState(true);\r\n\r\n  // Form State - Term Sheet & Entity\r\n  const [termSheetId, setTermSheetId] = useState<string | undefined>(initialTermSheetId);\r\n  const [selectedTermSheet, setSelectedTermSheet] = useState<TermSheet | null>(null);\r\n  const [entityType, setEntityType] = useState<EntityType | undefined>();\r\n  const [entityId, setEntityId] = useState<string | undefined>();\r\n\r\n  // Form State - Components\r\n  const [components, setComponents] = useState<FeeComponent[]>([]);\r\n\r\n  // Form State - Agreement Terms\r\n  const [agreementTerms, setAgreementTerms] = useState<AgreementTerms>(DEFAULT_AGREEMENT_TERMS);\r\n\r\n  // Derived State\r\n  const isEditing = !!feePlan;\r\n  const hasPerformanceComponent = components.some((c) => c.kind === 'performance');\r\n  const hasSubscriptionComponent = components.some((c) => c.kind === 'subscription');\r\n\r\n  const termSheetLimits = useMemo(() => {\r\n    if (!selectedTermSheet) return undefined;\r\n    return {\r\n      subscription: selectedTermSheet.subscription_fee_percent || undefined,\r\n      management: selectedTermSheet.management_fee_percent || undefined,\r\n      performance: selectedTermSheet.carried_interest_percent || undefined,\r\n    };\r\n  }, [selectedTermSheet]);\r\n\r\n  // Check section completion\r\n  const basicInfoComplete = name.trim() && selectedDealId && termSheetId && entityType && entityId;\r\n  const componentsValid = validationErrors.length === 0;\r\n\r\n  // ============================================================================\r\n  // EFFECTS\r\n  // ============================================================================\r\n\r\n  // Load deals on open\r\n  useEffect(() => {\r\n    if (open) {\r\n      loadDeals();\r\n    }\r\n  }, [open]);\r\n\r\n  // Initialize form when opening\r\n  useEffect(() => {\r\n    if (!open) return;\r\n\r\n    if (feePlan) {\r\n      // Edit mode - load existing data\r\n      setName(feePlan.name);\r\n      setDescription(feePlan.description || '');\r\n      setSelectedDealId(feePlan.deal_id || undefined);\r\n      setIsActive(feePlan.is_active);\r\n\r\n      const fp = feePlan as any;\r\n      setTermSheetId(fp.term_sheet_id || undefined);\r\n\r\n      // Determine entity\r\n      if (fp.introducer_id) {\r\n        setEntityType('introducer');\r\n        setEntityId(fp.introducer_id);\r\n      } else if (fp.partner_id) {\r\n        setEntityType('partner');\r\n        setEntityId(fp.partner_id);\r\n      } else if (fp.commercial_partner_id) {\r\n        setEntityType('commercial_partner');\r\n        setEntityId(fp.commercial_partner_id);\r\n      }\r\n\r\n      // Load agreement terms\r\n      setAgreementTerms({\r\n        duration_months: fp.agreement_duration_months ?? 36,\r\n        non_circumvention_months: fp.non_circumvention_months ?? null,\r\n        non_circumvention_indefinite: fp.non_circumvention_months == null,\r\n        governing_law: fp.governing_law ?? 'British Virgin Islands',\r\n        vat_number: fp.vat_registration_number ?? '',\r\n        intro_payment_days: 3,\r\n        perf_payment_days: 10,\r\n        hurdle_rate_bps: undefined,\r\n        has_catchup: false,\r\n        catchup_rate_bps: undefined,\r\n        has_high_water_mark: false,\r\n        has_no_cap: true,\r\n        performance_cap_percent: undefined,\r\n      });\r\n\r\n      // Load components\r\n      const existingComponents = (feePlan.components || []) as any[];\r\n      const subComp = existingComponents.find((c) => c.kind === 'subscription');\r\n      const perfComp = existingComponents.find((c) => c.kind === 'performance');\r\n\r\n      // Extract agreement terms from components\r\n      if (subComp) {\r\n        setAgreementTerms((prev) => ({\r\n          ...prev,\r\n          intro_payment_days: subComp.payment_days_after_event ?? 3,\r\n        }));\r\n      }\r\n      if (perfComp) {\r\n        setAgreementTerms((prev) => ({\r\n          ...prev,\r\n          perf_payment_days: perfComp.payment_days_after_event ?? 10,\r\n          hurdle_rate_bps: perfComp.hurdle_rate_bps,\r\n          has_catchup: perfComp.has_catchup ?? false,\r\n          catchup_rate_bps: perfComp.catchup_rate_bps,\r\n          has_high_water_mark: perfComp.has_high_water_mark ?? false,\r\n          has_no_cap: perfComp.has_no_cap ?? true,\r\n          performance_cap_percent: perfComp.performance_cap_percent,\r\n        }));\r\n      }\r\n\r\n      setComponents(\r\n        existingComponents.map((c: any) => ({\r\n          id: c.id,\r\n          kind: c.kind,\r\n          calc_method: c.calc_method || 'percent_of_investment',\r\n          frequency: c.frequency || 'one_time',\r\n          rate_bps: c.rate_bps,\r\n          flat_amount: c.flat_amount,\r\n          notes: c.notes || '',\r\n          payment_schedule: c.payment_schedule || 'upfront',\r\n          duration_periods: c.duration_periods,\r\n          duration_unit: c.duration_unit,\r\n        }))\r\n      );\r\n    } else {\r\n      // Create mode - reset form\r\n      resetForm();\r\n    }\r\n  }, [open, feePlan, dealId, initialTermSheetId]);\r\n\r\n  // Validate components against term sheet\r\n  useEffect(() => {\r\n    if (selectedTermSheet && components.length > 0) {\r\n      const errors = validateFeeComponentsAgainstTermSheet(components, selectedTermSheet);\r\n      setValidationErrors(errors);\r\n    } else {\r\n      setValidationErrors([]);\r\n    }\r\n  }, [components, selectedTermSheet]);\r\n\r\n  // Auto-expand agreement section when entity is selected\r\n  useEffect(() => {\r\n    if (entityType && entityId) {\r\n      setExpandedSections((prev) => ({ ...prev, agreement: true }));\r\n    }\r\n  }, [entityType, entityId]);\r\n\r\n  // ============================================================================\r\n  // HANDLERS\r\n  // ============================================================================\r\n\r\n  const resetForm = useCallback(() => {\r\n    setName('');\r\n    setDescription('');\r\n    setSelectedDealId(dealId);\r\n    setIsActive(true);\r\n    setTermSheetId(initialTermSheetId);\r\n    setSelectedTermSheet(null);\r\n    setEntityType(undefined);\r\n    setEntityId(undefined);\r\n    setComponents([]);\r\n    setAgreementTerms(DEFAULT_AGREEMENT_TERMS);\r\n    setError(null);\r\n    setValidationErrors([]);\r\n    setExpandedSections({ basic: true, components: true, agreement: false });\r\n  }, [dealId, initialTermSheetId]);\r\n\r\n  const loadDeals = async () => {\r\n    try {\r\n      const res = await fetch('/api/deals');\r\n      const json = await res.json();\r\n      setDeals(json.deals || []);\r\n    } catch (err) {\r\n      console.error('Error loading deals:', err);\r\n    }\r\n  };\r\n\r\n  const toggleSection = (section: keyof typeof expandedSections) => {\r\n    setExpandedSections((prev) => ({ ...prev, [section]: !prev[section] }));\r\n  };\r\n\r\n  const addComponent = () => {\r\n    setComponents([\r\n      ...components,\r\n      {\r\n        kind: 'subscription',\r\n        calc_method: 'percent_of_investment',\r\n        frequency: 'one_time',\r\n        payment_schedule: 'upfront',\r\n      },\r\n    ]);\r\n  };\r\n\r\n  const updateComponent = (index: number, updates: Partial<FeeComponent>) => {\r\n    setComponents((prev) => {\r\n      const updated = [...prev];\r\n      updated[index] = { ...updated[index], ...updates };\r\n      return updated;\r\n    });\r\n  };\r\n\r\n  const removeComponent = (index: number) => {\r\n    setComponents((prev) => prev.filter((_, i) => i !== index));\r\n  };\r\n\r\n  const updateAgreementTerms = (updates: Partial<AgreementTerms>) => {\r\n    setAgreementTerms((prev) => ({ ...prev, ...updates }));\r\n  };\r\n\r\n  const handleSave = async () => {\r\n    // Validate\r\n    if (!name.trim()) {\r\n      setError('Plan name is required');\r\n      return;\r\n    }\r\n    if (!selectedDealId) {\r\n      setError('A deal must be selected');\r\n      return;\r\n    }\r\n    if (!termSheetId) {\r\n      setError('A term sheet must be selected');\r\n      return;\r\n    }\r\n    if (!entityType || !entityId) {\r\n      setError('An entity must be selected');\r\n      return;\r\n    }\r\n    if (validationErrors.length > 0) {\r\n      setError(`Fee values exceed term sheet limits: ${validationErrors.join('; ')}`);\r\n      return;\r\n    }\r\n\r\n    setLoading(true);\r\n    setError(null);\r\n\r\n    try {\r\n      // Build entity fields\r\n      const entityFields = {\r\n        introducer_id: entityType === 'introducer' ? entityId : undefined,\r\n        partner_id: entityType === 'partner' ? entityId : undefined,\r\n        commercial_partner_id: entityType === 'commercial_partner' ? entityId : undefined,\r\n      };\r\n\r\n      // Build components with agreement terms merged\r\n      // IMPORTANT: has_catchup and has_high_water_mark are NOT NULL in DB\r\n      const processedComponents = components.map((c) => {\r\n        const { id, notes, ...rest } = c;\r\n\r\n        // Base fields for ALL components - include NOT NULL boolean defaults\r\n        const base = {\r\n          ...rest,\r\n          notes: notes?.trim() || undefined,\r\n          // These columns are NOT NULL in DB - must always provide values\r\n          has_catchup: false,\r\n          has_high_water_mark: false,\r\n          ...(id && id.length > 10 ? { id } : {}),\r\n        };\r\n\r\n        if (c.kind === 'subscription') {\r\n          return {\r\n            ...base,\r\n            payment_days_after_event: agreementTerms.intro_payment_days,\r\n          };\r\n        }\r\n\r\n        if (c.kind === 'performance') {\r\n          return {\r\n            ...base,\r\n            payment_days_after_event: agreementTerms.perf_payment_days,\r\n            hurdle_rate_bps: agreementTerms.hurdle_rate_bps || undefined,\r\n            has_catchup: agreementTerms.has_catchup,\r\n            catchup_rate_bps: agreementTerms.has_catchup ? agreementTerms.catchup_rate_bps : undefined,\r\n            has_high_water_mark: agreementTerms.has_high_water_mark,\r\n            has_no_cap: agreementTerms.has_no_cap,\r\n            performance_cap_percent: agreementTerms.has_no_cap ? undefined : agreementTerms.performance_cap_percent,\r\n          };\r\n        }\r\n\r\n        return base;\r\n      });\r\n\r\n      const payload = {\r\n        name: name.trim(),\r\n        description: description.trim() || undefined,\r\n        deal_id: selectedDealId,\r\n        term_sheet_id: termSheetId,\r\n        ...entityFields,\r\n        is_active: isActive,\r\n        agreement_duration_months: agreementTerms.duration_months,\r\n        non_circumvention_months: agreementTerms.non_circumvention_indefinite ? null : agreementTerms.non_circumvention_months,\r\n        governing_law: agreementTerms.governing_law,\r\n        vat_registration_number: agreementTerms.vat_number.trim() || null,\r\n        components: processedComponents,\r\n      };\r\n\r\n      const url = feePlan ? `/api/staff/fees/plans/${feePlan.id}` : '/api/staff/fees/plans';\r\n      const res = await fetch(url, {\r\n        method: feePlan ? 'PUT' : 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify(payload),\r\n      });\r\n\r\n      if (!res.ok) {\r\n        const errorData = await res.json().catch(() => ({ error: `HTTP ${res.status}` }));\r\n        const msg = errorData.error || 'Failed to save';\r\n        const details = errorData.details ? `\\n${errorData.details}` : '';\r\n        throw new Error(`${msg}${details}`);\r\n      }\r\n\r\n      onSuccess();\r\n    } catch (err) {\r\n      setError(err instanceof Error ? err.message : 'Failed to save fee plan');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  // ============================================================================\r\n  // RENDER\r\n  // ============================================================================\r\n\r\n  return (\r\n    <Dialog open={open} onOpenChange={(isOpen) => !isOpen && onClose()}>\r\n      <DialogContent\r\n        showCloseButton={false}\r\n        className=\"!max-w-[1400px] !w-[96vw] !max-h-[94vh] !p-0 bg-[#080810] border-gray-700/50 text-white overflow-hidden flex flex-col\"\r\n      >\r\n        {/* Header */}\r\n        <DialogHeader className=\"px-10 py-6 border-b border-gray-800 bg-gradient-to-r from-blue-900/10 via-gray-900/30 to-transparent shrink-0\">\r\n          <div className=\"flex items-center justify-between\">\r\n            <div>\r\n              <DialogTitle className=\"text-2xl font-bold text-white tracking-tight\">\r\n                {isEditing ? 'Edit Fee Plan' : 'Create New Fee Plan'}\r\n              </DialogTitle>\r\n              <p className=\"text-base text-gray-400 mt-2\">\r\n                {isEditing ? 'Modify fee structure and agreement terms' : 'Define a fee structure for a partner or introducer agreement'}\r\n              </p>\r\n            </div>\r\n            <div className=\"flex items-center gap-6\">\r\n              <div className=\"flex items-center gap-3 bg-gray-900/50 px-4 py-2 rounded-lg border border-gray-800\">\r\n                <Checkbox\r\n                  id=\"is_active\"\r\n                  checked={isActive}\r\n                  onCheckedChange={(checked) => setIsActive(checked as boolean)}\r\n                  className=\"border-gray-500 h-5 w-5\"\r\n                />\r\n                <Label htmlFor=\"is_active\" className=\"text-sm text-gray-300 cursor-pointer font-medium\">\r\n                  Plan Active\r\n                </Label>\r\n              </div>\r\n              <Button\r\n                type=\"button\"\r\n                variant=\"ghost\"\r\n                size=\"icon\"\r\n                onClick={onClose}\r\n                className=\"h-10 w-10 text-gray-400 hover:text-white hover:bg-gray-800 rounded-lg\"\r\n              >\r\n                <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\"><path d=\"M18 6 6 18\"/><path d=\"m6 6 12 12\"/></svg>\r\n              </Button>\r\n            </div>\r\n          </div>\r\n        </DialogHeader>\r\n\r\n        {/* Error Banner */}\r\n        <AnimatePresence>\r\n          {error && (\r\n            <motion.div\r\n              initial={{ height: 0, opacity: 0 }}\r\n              animate={{ height: 'auto', opacity: 1 }}\r\n              exit={{ height: 0, opacity: 0 }}\r\n              className=\"px-10 py-4 bg-red-500/10 border-b border-red-500/30 shrink-0\"\r\n            >\r\n              <div className=\"flex items-center gap-3 text-red-400\">\r\n                <AlertTriangle className=\"w-5 h-5 shrink-0\" />\r\n                <span className=\"text-base\">{error}</span>\r\n              </div>\r\n            </motion.div>\r\n          )}\r\n        </AnimatePresence>\r\n\r\n        {/* Scrollable Content */}\r\n        <div className=\"flex-1 overflow-y-auto px-10 py-8 space-y-6\">\r\n          {/* Section 1: Basic Information */}\r\n          <CollapsibleSection\r\n            title=\"Basic Information\"\r\n            icon={<FileText className=\"w-5 h-5\" />}\r\n            isOpen={expandedSections.basic}\r\n            onToggle={() => toggleSection('basic')}\r\n            status={basicInfoComplete ? 'complete' : undefined}\r\n          >\r\n            <div className=\"space-y-6\">\r\n              {/* Row 1: Plan Name & Description side by side */}\r\n              <div className=\"grid grid-cols-2 gap-8\">\r\n                <div className=\"space-y-3\">\r\n                  <Label className=\"text-base text-gray-200 font-medium\">\r\n                    Plan Name <span className=\"text-red-400\">*</span>\r\n                  </Label>\r\n                  <Input\r\n                    value={name}\r\n                    onChange={(e) => setName(e.target.value)}\r\n                    placeholder=\"e.g., Standard Introducer Fee Plan\"\r\n                    className=\"bg-black/60 border-gray-600 text-white h-12 text-base focus:border-blue-500 focus:ring-1 focus:ring-blue-500/30\"\r\n                  />\r\n                </div>\r\n                <div className=\"space-y-3\">\r\n                  <Label className=\"text-base text-gray-200 font-medium\">Description</Label>\r\n                  <Input\r\n                    value={description}\r\n                    onChange={(e) => setDescription(e.target.value)}\r\n                    placeholder=\"Optional description of this fee arrangement...\"\r\n                    className=\"bg-black/60 border-gray-600 text-white h-12 text-base focus:border-blue-500\"\r\n                  />\r\n                </div>\r\n              </div>\r\n\r\n              {/* Row 2: Deal, Term Sheet, Entity - 3 columns */}\r\n              <div className=\"grid grid-cols-3 gap-8\">\r\n                {/* Deal */}\r\n                <div className=\"space-y-3\">\r\n                  {dealId ? (\r\n                    <>\r\n                      <Label className=\"text-base text-gray-200 font-medium\">Deal</Label>\r\n                      <div className=\"flex items-center gap-3 px-4 py-3 bg-gray-800/50 border border-gray-600 rounded-lg text-white h-12\">\r\n                        <Building2 className=\"w-5 h-5 text-blue-400\" />\r\n                        <span className=\"text-base truncate\">{deals.find((d) => d.id === dealId)?.name || 'Loading...'}</span>\r\n                      </div>\r\n                    </>\r\n                  ) : (\r\n                    <>\r\n                      <Label className=\"text-base text-gray-200 font-medium\">\r\n                        Deal <span className=\"text-red-400\">*</span>\r\n                      </Label>\r\n                      <Select\r\n                        value={selectedDealId || ''}\r\n                        onValueChange={(val) => {\r\n                          setSelectedDealId(val || undefined);\r\n                          setTermSheetId(undefined);\r\n                          setSelectedTermSheet(null);\r\n                          setEntityType(undefined);\r\n                          setEntityId(undefined);\r\n                        }}\r\n                      >\r\n                        <SelectTrigger className=\"bg-black/60 border-gray-600 text-white h-12 text-base\">\r\n                          <SelectValue placeholder=\"Select a deal\" />\r\n                        </SelectTrigger>\r\n                        <SelectContent className=\"bg-gray-900 border-gray-700\">\r\n                          {deals.map((deal) => (\r\n                            <SelectItem key={deal.id} value={deal.id} className=\"text-base py-2.5\">\r\n                              {deal.name}\r\n                            </SelectItem>\r\n                          ))}\r\n                        </SelectContent>\r\n                      </Select>\r\n                    </>\r\n                  )}\r\n                </div>\r\n\r\n                {/* Term Sheet */}\r\n                <div className=\"space-y-3\">\r\n                  <TermSheetSelector\r\n                    dealId={selectedDealId}\r\n                    value={termSheetId}\r\n                    onChange={(id, ts) => {\r\n                      setTermSheetId(id);\r\n                      setSelectedTermSheet(ts);\r\n                    }}\r\n                    required={true}\r\n                  />\r\n                </div>\r\n\r\n                {/* Entity Type Quick Select - simplified */}\r\n                <div className=\"space-y-3\">\r\n                  <Label className=\"text-base text-gray-200 font-medium\">\r\n                    Entity Type <span className=\"text-red-400\">*</span>\r\n                  </Label>\r\n                  <Select\r\n                    value={entityType || ''}\r\n                    onValueChange={(val) => {\r\n                      setEntityType(val as EntityType || undefined);\r\n                      setEntityId(undefined);\r\n                    }}\r\n                    disabled={!selectedDealId}\r\n                  >\r\n                    <SelectTrigger className=\"bg-black/60 border-gray-600 text-white h-12 text-base\">\r\n                      <SelectValue placeholder={selectedDealId ? \"Select type\" : \"Select deal first\"} />\r\n                    </SelectTrigger>\r\n                    <SelectContent className=\"bg-gray-900 border-gray-700\">\r\n                      <SelectItem value=\"introducer\" className=\"text-base py-2.5\">Introducer</SelectItem>\r\n                      <SelectItem value=\"partner\" className=\"text-base py-2.5\">Partner</SelectItem>\r\n                    </SelectContent>\r\n                  </Select>\r\n                </div>\r\n              </div>\r\n\r\n              {/* Row 3: Entity Selection (only if type selected) */}\r\n              {entityType && selectedDealId && (\r\n                <div className=\"pt-4 border-t border-gray-800\">\r\n                  <EntitySelector\r\n                    dealId={selectedDealId}\r\n                    entityType={entityType}\r\n                    onEntityTypeChange={setEntityType}\r\n                    entityId={entityId}\r\n                    onEntityIdChange={setEntityId}\r\n                    required={true}\r\n                    excludeTypes={['commercial_partner']}\r\n                  />\r\n                </div>\r\n              )}\r\n            </div>\r\n          </CollapsibleSection>\r\n\r\n          {/* Section 2: Fee Components */}\r\n          <CollapsibleSection\r\n            title=\"Fee Components\"\r\n            icon={<DollarSign className=\"w-5 h-5\" />}\r\n            isOpen={expandedSections.components}\r\n            onToggle={() => toggleSection('components')}\r\n            badge={`${components.length} component${components.length !== 1 ? 's' : ''}`}\r\n            status={components.length > 0 ? (componentsValid ? 'complete' : 'error') : undefined}\r\n          >\r\n            <div className=\"space-y-4\">\r\n              {/* Validation Errors */}\r\n              {validationErrors.length > 0 && (\r\n                <div className=\"p-3 bg-red-500/10 border border-red-500/30 rounded-lg\">\r\n                  <div className=\"flex items-start gap-2\">\r\n                    <AlertTriangle className=\"w-4 h-4 text-red-400 mt-0.5\" />\r\n                    <div className=\"text-sm text-red-400\">\r\n                      <p className=\"font-medium\">Fees exceed term sheet limits:</p>\r\n                      <ul className=\"mt-1 space-y-1\">\r\n                        {validationErrors.map((err, i) => (\r\n                          <li key={i}> {err}</li>\r\n                        ))}\r\n                      </ul>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              )}\r\n\r\n              {/* Components List */}\r\n              {components.length === 0 ? (\r\n                <div className=\"text-center py-8 border-2 border-dashed border-gray-800 rounded-lg\">\r\n                  <DollarSign className=\"w-8 h-8 text-gray-600 mx-auto mb-2\" />\r\n                  <p className=\"text-gray-500 text-sm\">No fee components defined</p>\r\n                  <Button\r\n                    type=\"button\"\r\n                    onClick={addComponent}\r\n                    variant=\"outline\"\r\n                    size=\"sm\"\r\n                    className=\"mt-3 border-gray-700 text-gray-300 hover:bg-gray-800\"\r\n                  >\r\n                    <Plus className=\"w-4 h-4 mr-2\" />\r\n                    Add First Component\r\n                  </Button>\r\n                </div>\r\n              ) : (\r\n                <div className=\"space-y-3\">\r\n                  {components.map((comp, index) => (\r\n                    <FeeComponentCard\r\n                      key={index}\r\n                      component={comp}\r\n                      index={index}\r\n                      onChange={(updates) => updateComponent(index, updates)}\r\n                      onRemove={() => removeComponent(index)}\r\n                      termSheetLimits={termSheetLimits}\r\n                    />\r\n                  ))}\r\n                  <Button\r\n                    type=\"button\"\r\n                    onClick={addComponent}\r\n                    variant=\"outline\"\r\n                    size=\"sm\"\r\n                    className=\"w-full border-gray-700 border-dashed text-gray-400 hover:bg-gray-800 hover:text-white\"\r\n                  >\r\n                    <Plus className=\"w-4 h-4 mr-2\" />\r\n                    Add Component\r\n                  </Button>\r\n                </div>\r\n              )}\r\n            </div>\r\n          </CollapsibleSection>\r\n\r\n          {/* Section 3: Agreement Terms (only for introducers/partners) */}\r\n          {(entityType === 'introducer' || entityType === 'partner') && (\r\n            <CollapsibleSection\r\n              title=\"Agreement Terms\"\r\n              icon={<ScrollText className=\"w-5 h-5\" />}\r\n              isOpen={expandedSections.agreement}\r\n              onToggle={() => toggleSection('agreement')}\r\n              badge={entityType === 'introducer' ? 'DOC 3' : 'Placement'}\r\n            >\r\n              <div className=\"space-y-6\">\r\n                {/* General Terms */}\r\n                <div className=\"space-y-4\">\r\n                  <h4 className=\"text-sm font-medium text-white flex items-center gap-2\">\r\n                    <div className=\"w-2 h-2 rounded-full bg-blue-500\" />\r\n                    General Terms\r\n                  </h4>\r\n                  <div className=\"grid grid-cols-3 gap-4 pl-4\">\r\n                    {/* Duration */}\r\n                    <div className=\"space-y-2\">\r\n                      <Label className=\"text-xs text-gray-400\">Agreement Duration</Label>\r\n                      <div className=\"flex items-center gap-2\">\r\n                        <Input\r\n                          type=\"number\"\r\n                          min=\"1\"\r\n                          value={agreementTerms.duration_months}\r\n                          onChange={(e) => updateAgreementTerms({ duration_months: Number(e.target.value) || 36 })}\r\n                          className=\"bg-black/50 border-gray-700 text-white h-9 w-20\"\r\n                        />\r\n                        <span className=\"text-xs text-gray-500\">months</span>\r\n                      </div>\r\n                    </div>\r\n\r\n                    {/* Non-Circumvention */}\r\n                    <div className=\"space-y-2\">\r\n                      <Label className=\"text-xs text-gray-400\">Non-Circumvention</Label>\r\n                      <div className=\"flex items-center gap-2\">\r\n                        <Checkbox\r\n                          checked={agreementTerms.non_circumvention_indefinite}\r\n                          onCheckedChange={(checked) => {\r\n                            updateAgreementTerms({\r\n                              non_circumvention_indefinite: !!checked,\r\n                              non_circumvention_months: checked ? null : 24,\r\n                            });\r\n                          }}\r\n                          className=\"border-gray-600\"\r\n                        />\r\n                        <span className=\"text-xs text-gray-400\">Indefinite</span>\r\n                        {!agreementTerms.non_circumvention_indefinite && (\r\n                          <>\r\n                            <Input\r\n                              type=\"number\"\r\n                              min=\"1\"\r\n                              value={agreementTerms.non_circumvention_months || ''}\r\n                              onChange={(e) => updateAgreementTerms({ non_circumvention_months: Number(e.target.value) || null })}\r\n                              className=\"bg-black/50 border-gray-700 text-white h-8 w-16\"\r\n                            />\r\n                            <span className=\"text-xs text-gray-500\">mo</span>\r\n                          </>\r\n                        )}\r\n                      </div>\r\n                    </div>\r\n\r\n                    {/* Governing Law */}\r\n                    <div className=\"space-y-2\">\r\n                      <Label className=\"text-xs text-gray-400\">Governing Law</Label>\r\n                      <Select\r\n                        value={agreementTerms.governing_law}\r\n                        onValueChange={(val) => updateAgreementTerms({ governing_law: val })}\r\n                      >\r\n                        <SelectTrigger className=\"bg-black/50 border-gray-700 text-white h-9 text-xs\">\r\n                          <SelectValue />\r\n                        </SelectTrigger>\r\n                        <SelectContent className=\"bg-gray-900 border-gray-700\">\r\n                          {GOVERNING_LAWS.map((law) => (\r\n                            <SelectItem key={law} value={law} className=\"text-xs\">\r\n                              {law}\r\n                            </SelectItem>\r\n                          ))}\r\n                        </SelectContent>\r\n                      </Select>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n\r\n                {/* Introduction Fee Terms */}\r\n                {hasSubscriptionComponent && (\r\n                  <div className=\"space-y-4\">\r\n                    <h4 className=\"text-sm font-medium text-white flex items-center gap-2\">\r\n                      <div className=\"w-2 h-2 rounded-full bg-green-500\" />\r\n                      Introduction Fee Payment\r\n                    </h4>\r\n                    <div className=\"pl-4\">\r\n                      <div className=\"space-y-2\">\r\n                        <Label className=\"text-xs text-gray-400\">Payment After Closing</Label>\r\n                        <div className=\"flex items-center gap-2\">\r\n                          <Input\r\n                            type=\"number\"\r\n                            min=\"1\"\r\n                            max=\"90\"\r\n                            value={agreementTerms.intro_payment_days}\r\n                            onChange={(e) => updateAgreementTerms({ intro_payment_days: Number(e.target.value) || 3 })}\r\n                            className=\"bg-black/50 border-gray-700 text-white h-9 w-20\"\r\n                          />\r\n                          <span className=\"text-xs text-gray-500\">business days after share certificate</span>\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                )}\r\n\r\n                {/* Performance Fee Terms */}\r\n                {hasPerformanceComponent && (\r\n                  <div className=\"space-y-4\">\r\n                    <h4 className=\"text-sm font-medium text-white flex items-center gap-2\">\r\n                      <div className=\"w-2 h-2 rounded-full bg-purple-500\" />\r\n                      Performance Fee (Carried Interest)\r\n                    </h4>\r\n                    <div className=\"pl-4 space-y-4\">\r\n                      <div className=\"grid grid-cols-3 gap-4\">\r\n                        {/* Payment Days */}\r\n                        <div className=\"space-y-2\">\r\n                          <Label className=\"text-xs text-gray-400\">Payment After Redemption</Label>\r\n                          <div className=\"flex items-center gap-2\">\r\n                            <Input\r\n                              type=\"number\"\r\n                              min=\"1\"\r\n                              max=\"90\"\r\n                              value={agreementTerms.perf_payment_days}\r\n                              onChange={(e) => updateAgreementTerms({ perf_payment_days: Number(e.target.value) || 10 })}\r\n                              className=\"bg-black/50 border-gray-700 text-white h-9 w-20\"\r\n                            />\r\n                            <span className=\"text-xs text-gray-500\">days</span>\r\n                          </div>\r\n                        </div>\r\n\r\n                        {/* Hurdle Rate */}\r\n                        <div className=\"space-y-2\">\r\n                          <Label className=\"text-xs text-gray-400\">Hurdle Rate</Label>\r\n                          <div className=\"flex items-center gap-2\">\r\n                            <Input\r\n                              type=\"number\"\r\n                              min=\"0\"\r\n                              value={agreementTerms.hurdle_rate_bps || ''}\r\n                              onChange={(e) => updateAgreementTerms({ hurdle_rate_bps: e.target.value ? Number(e.target.value) : undefined })}\r\n                              placeholder=\"800\"\r\n                              className=\"bg-black/50 border-gray-700 text-white h-9 w-24\"\r\n                            />\r\n                            <span className=\"text-xs text-gray-500\">bps</span>\r\n                          </div>\r\n                          {agreementTerms.hurdle_rate_bps && (\r\n                            <p className=\"text-xs text-blue-400\">= {(agreementTerms.hurdle_rate_bps / 100).toFixed(2)}%</p>\r\n                          )}\r\n                        </div>\r\n                      </div>\r\n\r\n                      {/* Checkboxes Row */}\r\n                      <div className=\"flex flex-wrap gap-6\">\r\n                        {/* GP Catchup */}\r\n                        <div className=\"flex items-center gap-2\">\r\n                          <Checkbox\r\n                            checked={agreementTerms.has_catchup}\r\n                            onCheckedChange={(checked) => updateAgreementTerms({ has_catchup: !!checked })}\r\n                            className=\"border-gray-600\"\r\n                          />\r\n                          <span className=\"text-sm text-gray-300\">GP Catchup</span>\r\n                          {agreementTerms.has_catchup && (\r\n                            <div className=\"flex items-center gap-1 ml-2\">\r\n                              <Input\r\n                                type=\"number\"\r\n                                value={agreementTerms.catchup_rate_bps || ''}\r\n                                onChange={(e) => updateAgreementTerms({ catchup_rate_bps: e.target.value ? Number(e.target.value) : undefined })}\r\n                                className=\"bg-black/50 border-gray-700 text-white h-8 w-20\"\r\n                              />\r\n                              <span className=\"text-xs text-gray-500\">bps</span>\r\n                            </div>\r\n                          )}\r\n                        </div>\r\n\r\n                        {/* High Water Mark */}\r\n                        <div className=\"flex items-center gap-2\">\r\n                          <Checkbox\r\n                            checked={agreementTerms.has_high_water_mark}\r\n                            onCheckedChange={(checked) => updateAgreementTerms({ has_high_water_mark: !!checked })}\r\n                            className=\"border-gray-600\"\r\n                          />\r\n                          <span className=\"text-sm text-gray-300\">High Water Mark</span>\r\n                        </div>\r\n\r\n                        {/* No Cap */}\r\n                        <div className=\"flex items-center gap-2\">\r\n                          <Checkbox\r\n                            checked={agreementTerms.has_no_cap}\r\n                            onCheckedChange={(checked) => {\r\n                              updateAgreementTerms({\r\n                                has_no_cap: !!checked,\r\n                                performance_cap_percent: checked ? undefined : 20,\r\n                              });\r\n                            }}\r\n                            className=\"border-gray-600\"\r\n                          />\r\n                          <span className=\"text-sm text-gray-300\">No Cap</span>\r\n                          {!agreementTerms.has_no_cap && (\r\n                            <div className=\"flex items-center gap-1 ml-2\">\r\n                              <Input\r\n                                type=\"number\"\r\n                                step=\"0.1\"\r\n                                min=\"0\"\r\n                                max=\"100\"\r\n                                value={agreementTerms.performance_cap_percent || ''}\r\n                                onChange={(e) => updateAgreementTerms({ performance_cap_percent: e.target.value ? Number(e.target.value) : undefined })}\r\n                                className=\"bg-black/50 border-gray-700 text-white h-8 w-16\"\r\n                              />\r\n                              <span className=\"text-xs text-gray-500\">%</span>\r\n                            </div>\r\n                          )}\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                )}\r\n\r\n                {/* VAT */}\r\n                <div className=\"space-y-4\">\r\n                  <h4 className=\"text-sm font-medium text-white flex items-center gap-2\">\r\n                    <div className=\"w-2 h-2 rounded-full bg-amber-500\" />\r\n                    VAT Information\r\n                  </h4>\r\n                  <div className=\"pl-4\">\r\n                    <div className=\"space-y-2 max-w-xs\">\r\n                      <Label className=\"text-xs text-gray-400\">VAT Registration Number</Label>\r\n                      <Input\r\n                        value={agreementTerms.vat_number}\r\n                        onChange={(e) => updateAgreementTerms({ vat_number: e.target.value })}\r\n                        placeholder=\"e.g., GB123456789\"\r\n                        className=\"bg-black/50 border-gray-700 text-white h-9\"\r\n                      />\r\n                      <p className=\"text-xs text-gray-600\">Leave blank if not VAT registered</p>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </CollapsibleSection>\r\n          )}\r\n        </div>\r\n\r\n        {/* Footer */}\r\n        <div className=\"px-10 py-6 border-t border-gray-700/50 bg-gray-900/60 flex items-center justify-between shrink-0\">\r\n          <div className=\"text-base text-gray-400\">\r\n            <span className=\"font-semibold text-white text-lg\">{components.length}</span> fee component{components.length !== 1 ? 's' : ''} defined\r\n            {validationErrors.length > 0 && (\r\n              <span className=\"text-red-400 ml-4 inline-flex items-center gap-2\">\r\n                <AlertTriangle className=\"w-5 h-5\" />\r\n                {validationErrors.length} validation error{validationErrors.length !== 1 ? 's' : ''}\r\n              </span>\r\n            )}\r\n          </div>\r\n          <div className=\"flex items-center gap-5\">\r\n            <Button\r\n              type=\"button\"\r\n              variant=\"outline\"\r\n              onClick={onClose}\r\n              disabled={loading}\r\n              className=\"border-gray-500 text-gray-200 hover:bg-gray-800 hover:text-white h-12 px-8 text-base font-medium\"\r\n            >\r\n              Cancel\r\n            </Button>\r\n            <Button\r\n              type=\"button\"\r\n              onClick={handleSave}\r\n              disabled={loading || !basicInfoComplete || validationErrors.length > 0}\r\n              className=\"bg-blue-600 hover:bg-blue-500 h-12 px-10 min-w-[180px] text-base font-semibold shadow-lg shadow-blue-500/20\"\r\n            >\r\n              {loading ? (\r\n                <>\r\n                  <Loader2 className=\"w-5 h-5 mr-2 animate-spin\" />\r\n                  Saving...\r\n                </>\r\n              ) : (\r\n                <>{isEditing ? 'Update Fee Plan' : 'Create Fee Plan'}</>\r\n              )}\r\n            </Button>\r\n          </div>\r\n        </div>\r\n      </DialogContent>\r\n    </Dialog>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 3736, "column": 0}, "map": {"version":3,"sources":["file:///Users/ghilesmoussaoui/Desktop/Versotech/versotech-portal/src/lib/format.ts"],"sourcesContent":["export const formatCurrency = (value: number | null | undefined, currency: string = 'USD') => {\n  if (!value) return '$0'\n  return new Intl.NumberFormat('en-US', {\n    style: 'currency',\n    currency: currency,\n    maximumFractionDigits: 0,\n  }).format(value)\n}\n\nexport const formatBps = (bps: number | null | undefined) => {\n  if (bps === null || bps === undefined) return ''\n  return `${bps} bps`\n}\n\nexport const formatPercentage = (value: number | null | undefined) => {\n  if (!value) return '0%'\n  return `${(value * 100).toFixed(1)}%`\n}\n\nexport const formatDate = (value: string | Date | null | undefined) => {\n  if (!value) return ''\n  const date = typeof value === 'string' ? new Date(value) : value\n  if (Number.isNaN(date?.getTime?.())) return ''\n  // Use explicit locale to prevent hydration mismatch between server/client\n  return date.toLocaleDateString('en-US', {\n    year: 'numeric',\n    month: 'short',\n    day: 'numeric'\n  })\n}\n\n\n\n\n"],"names":[],"mappings":";;;;;;;;;;AAAO,MAAM,iBAAiB,CAAC,OAAkC,WAAmB,KAAK;IACvF,IAAI,CAAC,OAAO,OAAO;IACnB,OAAO,IAAI,KAAK,YAAY,CAAC,SAAS;QACpC,OAAO;QACP,UAAU;QACV,uBAAuB;IACzB,GAAG,MAAM,CAAC;AACZ;AAEO,MAAM,YAAY,CAAC;IACxB,IAAI,QAAQ,QAAQ,QAAQ,WAAW,OAAO;IAC9C,OAAO,GAAG,IAAI,IAAI,CAAC;AACrB;AAEO,MAAM,mBAAmB,CAAC;IAC/B,IAAI,CAAC,OAAO,OAAO;IACnB,OAAO,GAAG,CAAC,QAAQ,GAAG,EAAE,OAAO,CAAC,GAAG,CAAC,CAAC;AACvC;AAEO,MAAM,aAAa,CAAC;IACzB,IAAI,CAAC,OAAO,OAAO;IACnB,MAAM,OAAO,OAAO,UAAU,WAAW,IAAI,KAAK,SAAS;IAC3D,IAAI,OAAO,KAAK,CAAC,MAAM,cAAc,OAAO;IAC5C,0EAA0E;IAC1E,OAAO,KAAK,kBAAkB,CAAC,SAAS;QACtC,MAAM;QACN,OAAO;QACP,KAAK;IACP;AACF"}},
    {"offset": {"line": 3777, "column": 0}, "map": {"version":3,"sources":["file:///Users/ghilesmoussaoui/Desktop/Versotech/versotech-portal/src/components/staff/introducers/add-introducer-context.tsx"],"sourcesContent":["\"use client\"\n\nimport { createContext, useContext, useState, useCallback } from \"react\"\nimport { useRouter } from \"next/navigation\"\n\ninterface AddIntroducerContextValue {\n  open: boolean\n  setOpen: (open: boolean) => void\n  refresh: () => void\n}\n\nconst AddIntroducerContext = createContext<AddIntroducerContextValue | undefined>(undefined)\n\nexport function AddIntroducerProvider({ children }: { children: React.ReactNode }) {\n  const [open, setOpen] = useState(false)\n  const router = useRouter()\n\n  const refresh = useCallback(() => {\n    router.refresh()\n  }, [router])\n\n  return (\n    <AddIntroducerContext.Provider value={{ open, setOpen, refresh }}>\n      {children}\n    </AddIntroducerContext.Provider>\n  )\n}\n\nexport function useAddIntroducer() {\n  const context = useContext(AddIntroducerContext)\n  if (!context) {\n    throw new Error(\"useAddIntroducer must be used within a AddIntroducerProvider\")\n  }\n  return context\n}\n"],"names":[],"mappings":";;;;;;;AAEA;AACA;AAHA;;;;AAWA,MAAM,qCAAuB,IAAA,6OAAa,EAAwC;AAE3E,SAAS,sBAAsB,EAAE,QAAQ,EAAiC;IAC/E,MAAM,CAAC,MAAM,QAAQ,GAAG,IAAA,wOAAQ,EAAC;IACjC,MAAM,SAAS,IAAA,sKAAS;IAExB,MAAM,UAAU,IAAA,2OAAW,EAAC;QAC1B,OAAO,OAAO;IAChB,GAAG;QAAC;KAAO;IAEX,qBACE,qQAAC,qBAAqB,QAAQ;QAAC,OAAO;YAAE;YAAM;YAAS;QAAQ;kBAC5D;;;;;;AAGP;AAEO,SAAS;IACd,MAAM,UAAU,IAAA,0OAAU,EAAC;IAC3B,IAAI,CAAC,SAAS;QACZ,MAAM,IAAI,MAAM;IAClB;IACA,OAAO;AACT"}},
    {"offset": {"line": 3823, "column": 0}, "map": {"version":3,"sources":["file:///Users/ghilesmoussaoui/Desktop/Versotech/versotech-portal/src/components/ui/textarea.tsx"],"sourcesContent":["import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nexport type TextareaProps = React.TextareaHTMLAttributes<HTMLTextAreaElement>\n\nconst Textarea = React.forwardRef<HTMLTextAreaElement, TextareaProps>(\n  ({ className, ...props }, ref) => {\n    return (\n      <textarea\n        className={cn(\n          \"flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:border-ring disabled:cursor-not-allowed disabled:opacity-50\",\n          className\n        )}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nTextarea.displayName = \"Textarea\"\n\nexport { Textarea }\n"],"names":[],"mappings":";;;;;AAAA;AAEA;;;;AAIA,MAAM,yBAAW,0OAAgB,CAC/B,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE;IACxB,qBACE,qQAAC;QACC,WAAW,IAAA,gJAAE,EACX,+RACA;QAEF,KAAK;QACJ,GAAG,KAAK;;;;;;AAGf;AAEF,SAAS,WAAW,GAAG"}},
    {"offset": {"line": 3850, "column": 0}, "map": {"version":3,"sources":["file:///Users/ghilesmoussaoui/Desktop/Versotech/versotech-portal/src/components/staff/introducers/edit-introducer-dialog.tsx"],"sourcesContent":["'use client'\r\n\r\nimport { useState, useTransition, useEffect } from 'react'\r\nimport { Dialog, DialogContent, DialogDescription, DialogFooter, DialogHeader, DialogTitle } from '@/components/ui/dialog'\r\nimport { Button } from '@/components/ui/button'\r\nimport { Input } from '@/components/ui/input'\r\nimport { Label } from '@/components/ui/label'\r\nimport { Textarea } from '@/components/ui/textarea'\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select'\r\nimport { toast } from 'sonner'\r\nimport { useRouter } from 'next/navigation'\r\n\r\ntype Introducer = {\r\n  id: string\r\n  legalName: string\r\n  contactName: string | null\r\n  email: string | null\r\n  defaultCommissionBps: number\r\n  commissionCapAmount: number | null\r\n  paymentTerms: string | null\r\n  status: string\r\n  notes?: string | null\r\n}\r\n\r\ntype EditIntroducerDialogProps = {\r\n  open: boolean\r\n  onOpenChange: (open: boolean) => void\r\n  introducer: Introducer | null\r\n}\r\n\r\nexport function EditIntroducerDialog({ open, onOpenChange, introducer }: EditIntroducerDialogProps) {\r\n  const [legalName, setLegalName] = useState('')\r\n  const [contactName, setContactName] = useState('')\r\n  const [email, setEmail] = useState('')\r\n  const [commissionBps, setCommissionBps] = useState<number | ''>('')\r\n  const [commissionCapAmount, setCommissionCapAmount] = useState<number | ''>('')\r\n  const [paymentTerms, setPaymentTerms] = useState('net_30')\r\n  const [status, setStatus] = useState('active')\r\n  const [notes, setNotes] = useState('')\r\n  const [isPending, startTransition] = useTransition()\r\n  const router = useRouter()\r\n\r\n  useEffect(() => {\r\n    if (introducer) {\r\n      setLegalName(introducer.legalName)\r\n      setContactName(introducer.contactName || '')\r\n      setEmail(introducer.email || '')\r\n      setCommissionBps(introducer.defaultCommissionBps || '')\r\n      setCommissionCapAmount(introducer.commissionCapAmount || '')\r\n      setPaymentTerms(introducer.paymentTerms || 'net_30')\r\n      setStatus(introducer.status)\r\n      setNotes(introducer.notes || '')\r\n    }\r\n  }, [introducer])\r\n\r\n  const handleUpdate = () => {\r\n    if (!introducer) return\r\n\r\n    startTransition(async () => {\r\n      if (!legalName.trim()) {\r\n        toast.error('Legal name is required')\r\n        return\r\n      }\r\n\r\n      if (commissionBps !== '' && (Number(commissionBps) < 0 || Number(commissionBps) > 300)) {\r\n        toast.error('Default commission must be between 0 and 300 bps')\r\n        return\r\n      }\r\n\r\n      try {\r\n        const response = await fetch(`/api/staff/introducers/${introducer.id}`, {\r\n          method: 'PATCH',\r\n          headers: { 'Content-Type': 'application/json' },\r\n          body: JSON.stringify({\r\n            legal_name: legalName.trim(),\r\n            contact_name: contactName.trim() || null,\r\n            email: email.trim() || null,\r\n            default_commission_bps: commissionBps === '' ? null : Number(commissionBps),\r\n            commission_cap_amount: commissionCapAmount === '' ? null : Number(commissionCapAmount),\r\n            payment_terms: paymentTerms,\r\n            status,\r\n            notes: notes.trim() || null,\r\n          }),\r\n        })\r\n\r\n        if (!response.ok) {\r\n          const data = await response.json().catch(() => null)\r\n          toast.error(data?.error ?? 'Failed to update introducer')\r\n          return\r\n        }\r\n\r\n        toast.success('Introducer updated')\r\n        onOpenChange(false)\r\n        router.refresh()\r\n      } catch (err) {\r\n        toast.error('Failed to update introducer')\r\n      }\r\n    })\r\n  }\r\n\r\n  const handleDelete = () => {\r\n    if (!introducer) return\r\n\r\n    if (!confirm('Are you sure you want to delete this introducer? This action cannot be undone.')) {\r\n      return\r\n    }\r\n\r\n    startTransition(async () => {\r\n      try {\r\n        const response = await fetch(`/api/staff/introducers/${introducer.id}`, {\r\n          method: 'DELETE',\r\n        })\r\n\r\n        if (!response.ok) {\r\n          const text = await response.text()\r\n\r\n          let data\r\n          try {\r\n            data = JSON.parse(text)\r\n          } catch (e) {\r\n            toast.error(`Failed to delete introducer: ${text || 'Unknown error'}`)\r\n            return\r\n          }\r\n\r\n          toast.error(data?.error ?? 'Failed to delete introducer')\r\n          return\r\n        }\r\n\r\n        toast.success('Introducer deleted')\r\n        onOpenChange(false)\r\n        router.refresh()\r\n      } catch (err) {\r\n        toast.error('Failed to delete introducer')\r\n      }\r\n    })\r\n  }\r\n\r\n  if (!introducer) return null\r\n\r\n  return (\r\n    <Dialog open={open} onOpenChange={onOpenChange}>\r\n      <DialogContent className=\"max-w-lg max-h-[90vh] overflow-y-auto\">\r\n        <DialogHeader>\r\n          <DialogTitle>Edit Introducer</DialogTitle>\r\n          <DialogDescription>Update introducer contact information and commercial terms.</DialogDescription>\r\n        </DialogHeader>\r\n        <div className=\"space-y-4\">\r\n          <div className=\"grid gap-2\">\r\n            <Label htmlFor=\"legalName\">Legal Name</Label>\r\n            <Input\r\n              id=\"legalName\"\r\n              value={legalName}\r\n              onChange={(event) => setLegalName(event.target.value)}\r\n              placeholder=\"e.g. Meridian Capital Partners\"\r\n              autoFocus\r\n            />\r\n          </div>\r\n          <div className=\"grid gap-2\">\r\n            <Label htmlFor=\"contactName\">Primary Contact</Label>\r\n            <Input\r\n              id=\"contactName\"\r\n              value={contactName}\r\n              onChange={(event) => setContactName(event.target.value)}\r\n              placeholder=\"e.g. Jane Smith\"\r\n            />\r\n          </div>\r\n          <div className=\"grid gap-2\">\r\n            <Label htmlFor=\"contactEmail\">Contact Email</Label>\r\n            <Input\r\n              id=\"contactEmail\"\r\n              type=\"email\"\r\n              value={email}\r\n              onChange={(event) => setEmail(event.target.value)}\r\n              placeholder=\"jane.smith@example.com\"\r\n            />\r\n          </div>\r\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n            <div className=\"grid gap-2\">\r\n              <Label htmlFor=\"commissionBps\">Default Commission (bps)</Label>\r\n              <Input\r\n                id=\"commissionBps\"\r\n                type=\"number\"\r\n                min={0}\r\n                max={300}\r\n                value={commissionBps}\r\n                onChange={(event) => setCommissionBps(event.target.value === '' ? '' : Number(event.target.value))}\r\n                placeholder=\"150\"\r\n              />\r\n            </div>\r\n            <div className=\"grid gap-2\">\r\n              <Label htmlFor=\"commissionCap\">Commission Cap (optional)</Label>\r\n              <Input\r\n                id=\"commissionCap\"\r\n                type=\"number\"\r\n                min={0}\r\n                value={commissionCapAmount}\r\n                onChange={(event) => setCommissionCapAmount(event.target.value === '' ? '' : Number(event.target.value))}\r\n                placeholder=\"50000\"\r\n              />\r\n            </div>\r\n          </div>\r\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n            <div className=\"grid gap-2\">\r\n              <Label>Payment Terms</Label>\r\n              <Select value={paymentTerms} onValueChange={setPaymentTerms}>\r\n                <SelectTrigger>\r\n                  <SelectValue placeholder=\"Select terms\" />\r\n                </SelectTrigger>\r\n                <SelectContent>\r\n                  <SelectItem value=\"net_15\">Net 15</SelectItem>\r\n                  <SelectItem value=\"net_30\">Net 30</SelectItem>\r\n                  <SelectItem value=\"net_45\">Net 45</SelectItem>\r\n                  <SelectItem value=\"net_60\">Net 60</SelectItem>\r\n                </SelectContent>\r\n              </Select>\r\n            </div>\r\n            <div className=\"grid gap-2\">\r\n              <Label>Status</Label>\r\n              <Select value={status} onValueChange={setStatus}>\r\n                <SelectTrigger>\r\n                  <SelectValue placeholder=\"Select status\" />\r\n                </SelectTrigger>\r\n                <SelectContent>\r\n                  <SelectItem value=\"active\">Active</SelectItem>\r\n                  <SelectItem value=\"inactive\">Inactive</SelectItem>\r\n                  <SelectItem value=\"suspended\">Suspended</SelectItem>\r\n                </SelectContent>\r\n              </Select>\r\n            </div>\r\n          </div>\r\n          <div className=\"grid gap-2\">\r\n            <Label htmlFor=\"notes\">Notes</Label>\r\n            <Textarea\r\n              id=\"notes\"\r\n              value={notes}\r\n              onChange={(event) => setNotes(event.target.value)}\r\n              placeholder=\"Commission arrangements, regional focus, etc.\"\r\n              rows={3}\r\n            />\r\n          </div>\r\n        </div>\r\n        <DialogFooter className=\"flex justify-between\">\r\n          <Button variant=\"destructive\" onClick={handleDelete} disabled={isPending}>\r\n            Delete\r\n          </Button>\r\n          <div className=\"flex gap-2\">\r\n            <Button variant=\"outline\" onClick={() => onOpenChange(false)} disabled={isPending}>\r\n              Cancel\r\n            </Button>\r\n            <Button onClick={handleUpdate} disabled={isPending}>\r\n              {isPending ? 'Updating' : 'Update Introducer'}\r\n            </Button>\r\n          </div>\r\n        </DialogFooter>\r\n      </DialogContent>\r\n    </Dialog>\r\n  )\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 4410, "column": 0}, "map": {"version":3,"sources":["file:///Users/ghilesmoussaoui/Desktop/Versotech/versotech-portal/src/components/ui/alert.tsx"],"sourcesContent":["import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst alertVariants = cva(\n  \"relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-background text-foreground\",\n        destructive:\n          \"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Alert = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & VariantProps<typeof alertVariants>\n>(({ className, variant, ...props }, ref) => (\n  <div\n    ref={ref}\n    role=\"alert\"\n    className={cn(alertVariants({ variant }), className)}\n    {...props}\n  />\n))\nAlert.displayName = \"Alert\"\n\nconst AlertTitle = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLHeadingElement>\n>(({ className, ...props }, ref) => (\n  <h5\n    ref={ref}\n    className={cn(\"mb-1 font-medium leading-none tracking-tight\", className)}\n    {...props}\n  />\n))\nAlertTitle.displayName = \"AlertTitle\"\n\nconst AlertDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm [&_p]:leading-relaxed\", className)}\n    {...props}\n  />\n))\nAlertDescription.displayName = \"AlertDescription\"\n\nexport { Alert, AlertTitle, AlertDescription }\n"],"names":[],"mappings":";;;;;;;;;AAAA;AACA;AAEA;;;;;AAEA,MAAM,gBAAgB,IAAA,8LAAG,EACvB,6JACA;IACE,UAAU;QACR,SAAS;YACP,SAAS;YACT,aACE;QACJ;IACF;IACA,iBAAiB;QACf,SAAS;IACX;AACF;AAGF,MAAM,sBAAQ,0OAAgB,CAG5B,CAAC,EAAE,SAAS,EAAE,OAAO,EAAE,GAAG,OAAO,EAAE,oBACnC,qQAAC;QACC,KAAK;QACL,MAAK;QACL,WAAW,IAAA,gJAAE,EAAC,cAAc;YAAE;QAAQ,IAAI;QACzC,GAAG,KAAK;;;;;;AAGb,MAAM,WAAW,GAAG;AAEpB,MAAM,2BAAa,0OAAgB,CAGjC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,qQAAC;QACC,KAAK;QACL,WAAW,IAAA,gJAAE,EAAC,gDAAgD;QAC7D,GAAG,KAAK;;;;;;AAGb,WAAW,WAAW,GAAG;AAEzB,MAAM,iCAAmB,0OAAgB,CAGvC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,qQAAC;QACC,KAAK;QACL,WAAW,IAAA,gJAAE,EAAC,iCAAiC;QAC9C,GAAG,KAAK;;;;;;AAGb,iBAAiB,WAAW,GAAG"}},
    {"offset": {"line": 4475, "column": 0}, "map": {"version":3,"sources":["file:///Users/ghilesmoussaoui/Desktop/Versotech/versotech-portal/src/components/staff/introducers/add-introduction-dialog.tsx"],"sourcesContent":["'use client'\r\n\r\nimport { useState, useTransition, useEffect } from 'react'\r\nimport { Dialog, DialogContent, DialogDescription, DialogFooter, DialogHeader, DialogTitle } from '@/components/ui/dialog'\r\nimport { Button } from '@/components/ui/button'\r\nimport { Input } from '@/components/ui/input'\r\nimport { Label } from '@/components/ui/label'\r\nimport { Textarea } from '@/components/ui/textarea'\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select'\r\nimport { toast } from 'sonner'\r\nimport { useRouter } from 'next/navigation'\r\nimport { Alert, AlertDescription } from '@/components/ui/alert'\r\nimport { AlertTriangle, CheckCircle2, Loader2, FileSignature } from 'lucide-react'\r\nimport { createClient } from '@/lib/supabase/client'\r\nimport Link from 'next/link'\r\n\r\ntype AgreementStatus = 'loading' | 'valid' | 'invalid' | 'none'\r\n\r\ntype AddIntroductionDialogProps = {\r\n  open: boolean\r\n  onOpenChange: (open: boolean) => void\r\n  introducers: Array<{ id: string; legalName: string }>\r\n  deals: Array<{ id: string; name: string }>\r\n}\r\n\r\nexport function AddIntroductionDialog({ open, onOpenChange, introducers, deals }: AddIntroductionDialogProps) {\r\n  const [introducerId, setIntroducerId] = useState('')\r\n  const [prospectEmail, setProspectEmail] = useState('')\r\n  const [dealId, setDealId] = useState('')\r\n  const [commissionOverride, setCommissionOverride] = useState<number | ''>('')\r\n  const [notes, setNotes] = useState('')\r\n  const [isPending, startTransition] = useTransition()\r\n  const [agreementStatus, setAgreementStatus] = useState<AgreementStatus>('none')\r\n  const router = useRouter()\r\n\r\n  // Check if selected introducer has a valid agreement\r\n  useEffect(() => {\r\n    if (!introducerId) {\r\n      setAgreementStatus('none')\r\n      return\r\n    }\r\n\r\n    const checkAgreement = async () => {\r\n      setAgreementStatus('loading')\r\n      try {\r\n        const supabase = createClient()\r\n        const today = new Date().toISOString().split('T')[0]\r\n\r\n        const { data, error } = await supabase\r\n          .from('introducer_agreements')\r\n          .select('id, status, signed_date, expiry_date')\r\n          .eq('introducer_id', introducerId)\r\n          .eq('status', 'active')\r\n          .not('signed_date', 'is', null)\r\n          .or(`expiry_date.is.null,expiry_date.gte.${today}`)\r\n          .limit(1)\r\n\r\n        if (error) {\r\n          console.error('Error checking agreement:', error)\r\n          setAgreementStatus('invalid')\r\n          return\r\n        }\r\n\r\n        if (data && data.length > 0) {\r\n          setAgreementStatus('valid')\r\n        } else {\r\n          setAgreementStatus('invalid')\r\n        }\r\n      } catch (err) {\r\n        console.error('Error checking agreement:', err)\r\n        setAgreementStatus('invalid')\r\n      }\r\n    }\r\n\r\n    checkAgreement()\r\n  }, [introducerId])\r\n\r\n  const resetForm = () => {\r\n    setIntroducerId('')\r\n    setProspectEmail('')\r\n    setDealId('')\r\n    setCommissionOverride('')\r\n    setNotes('')\r\n    setAgreementStatus('none')\r\n  }\r\n\r\n  const handleCreate = () => {\r\n    startTransition(async () => {\r\n      if (!introducerId || introducerId.trim() === '') {\r\n        toast.error('Please select an introducer')\r\n        return\r\n      }\r\n\r\n      if (!prospectEmail.trim()) {\r\n        toast.error('Prospect email is required')\r\n        return\r\n      }\r\n\r\n      if (!dealId || dealId.trim() === '') {\r\n        toast.error('Please select a deal')\r\n        return\r\n      }\r\n\r\n      if (commissionOverride !== '' && (Number(commissionOverride) < 0 || Number(commissionOverride) > 300)) {\r\n        toast.error('Commission override must be between 0 and 300 bps')\r\n        return\r\n      }\r\n\r\n      try {\r\n        const payload = {\r\n          introducer_id: introducerId,\r\n          prospect_email: prospectEmail.trim(),\r\n          deal_id: dealId,\r\n          commission_rate_override_bps: commissionOverride === '' ? null : Number(commissionOverride),\r\n          notes: notes.trim() || null,\r\n        }\r\n\r\n        const response = await fetch('/api/staff/introductions', {\r\n          method: 'POST',\r\n          headers: { 'Content-Type': 'application/json' },\r\n          body: JSON.stringify(payload),\r\n        })\r\n\r\n        if (!response.ok) {\r\n          const text = await response.text()\r\n\r\n          let data\r\n          try {\r\n            data = JSON.parse(text)\r\n          } catch (e) {\r\n            toast.error(`Failed to create introduction: ${text || 'Unknown error'}`)\r\n            return\r\n          }\r\n\r\n          if (data?.details) {\r\n            toast.error(`Validation failed: ${JSON.stringify(data.details.fieldErrors || data.details)}`)\r\n          } else {\r\n            toast.error(data?.error ?? 'Failed to create introduction')\r\n          }\r\n          return\r\n        }\r\n\r\n        toast.success('Introduction recorded')\r\n        onOpenChange(false)\r\n        resetForm()\r\n        router.refresh()\r\n      } catch (err) {\r\n        toast.error('Failed to create introduction')\r\n      }\r\n    })\r\n  }\r\n\r\n  return (\r\n    <Dialog\r\n      open={open}\r\n      onOpenChange={(value) => {\r\n        onOpenChange(value)\r\n        if (!value) {\r\n          resetForm()\r\n        }\r\n      }}\r\n    >\r\n      <DialogContent className=\"max-w-lg\">\r\n        <DialogHeader>\r\n          <DialogTitle>Record Introduction</DialogTitle>\r\n          <DialogDescription>Track a new referral from an introducer partner.</DialogDescription>\r\n        </DialogHeader>\r\n        <div className=\"space-y-4\">\r\n          <div className=\"grid gap-2\">\r\n            <Label>Introducer</Label>\r\n            <Select value={introducerId} onValueChange={setIntroducerId}>\r\n              <SelectTrigger>\r\n                <SelectValue placeholder=\"Select introducer\" />\r\n              </SelectTrigger>\r\n              <SelectContent>\r\n                {introducers.map((intro) => (\r\n                  <SelectItem key={intro.id} value={intro.id}>\r\n                    {intro.legalName}\r\n                  </SelectItem>\r\n                ))}\r\n              </SelectContent>\r\n            </Select>\r\n\r\n            {/* Agreement Status Warning */}\r\n            {introducerId && agreementStatus === 'loading' && (\r\n              <div className=\"flex items-center gap-2 text-sm text-muted-foreground mt-1\">\r\n                <Loader2 className=\"h-3 w-3 animate-spin\" />\r\n                Checking agreement status...\r\n              </div>\r\n            )}\r\n            {introducerId && agreementStatus === 'valid' && (\r\n              <div className=\"flex items-center gap-2 text-sm text-green-600 mt-1\">\r\n                <CheckCircle2 className=\"h-3 w-3\" />\r\n                Valid signed agreement on file\r\n              </div>\r\n            )}\r\n            {introducerId && agreementStatus === 'invalid' && (\r\n              <Alert variant=\"destructive\" className=\"mt-2\">\r\n                <AlertTriangle className=\"h-4 w-4\" />\r\n                <AlertDescription className=\"flex items-center justify-between\">\r\n                  <span>This introducer does not have a valid signed agreement.</span>\r\n                  <Link\r\n                    href={`/versotech_main/introducers/${introducerId}?tab=agreements`}\r\n                    className=\"text-xs underline ml-2 whitespace-nowrap\"\r\n                  >\r\n                    Create Agreement\r\n                  </Link>\r\n                </AlertDescription>\r\n              </Alert>\r\n            )}\r\n          </div>\r\n\r\n          <div className=\"grid gap-2\">\r\n            <Label htmlFor=\"prospectEmail\">Prospect Email</Label>\r\n            <Input\r\n              id=\"prospectEmail\"\r\n              type=\"email\"\r\n              value={prospectEmail}\r\n              onChange={(event) => setProspectEmail(event.target.value)}\r\n              placeholder=\"prospect@example.com\"\r\n            />\r\n          </div>\r\n\r\n          <div className=\"grid gap-2\">\r\n            <Label>Deal</Label>\r\n            <Select value={dealId} onValueChange={setDealId}>\r\n              <SelectTrigger>\r\n                <SelectValue placeholder=\"Select deal\" />\r\n              </SelectTrigger>\r\n              <SelectContent>\r\n                {deals.map((deal) => (\r\n                  <SelectItem key={deal.id} value={deal.id}>\r\n                    {deal.name}\r\n                  </SelectItem>\r\n                ))}\r\n              </SelectContent>\r\n            </Select>\r\n          </div>\r\n\r\n          <div className=\"grid gap-2\">\r\n            <Label htmlFor=\"commissionOverride\">Commission Rate Override (bps, optional)</Label>\r\n            <Input\r\n              id=\"commissionOverride\"\r\n              type=\"number\"\r\n              min={0}\r\n              max={300}\r\n              value={commissionOverride}\r\n              onChange={(event) =>\r\n                setCommissionOverride(event.target.value === '' ? '' : Number(event.target.value))\r\n              }\r\n              placeholder=\"Leave empty to use introducer's default rate\"\r\n            />\r\n          </div>\r\n\r\n          <div className=\"grid gap-2\">\r\n            <Label htmlFor=\"notes\">Notes</Label>\r\n            <Textarea\r\n              id=\"notes\"\r\n              value={notes}\r\n              onChange={(event) => setNotes(event.target.value)}\r\n              placeholder=\"Additional context about this introduction...\"\r\n              rows={3}\r\n            />\r\n          </div>\r\n        </div>\r\n        <DialogFooter>\r\n          <Button variant=\"outline\" onClick={() => onOpenChange(false)} disabled={isPending}>\r\n            Cancel\r\n          </Button>\r\n          <Button\r\n            onClick={handleCreate}\r\n            disabled={isPending || agreementStatus === 'invalid' || agreementStatus === 'loading'}\r\n          >\r\n            {isPending ? 'Recording' : 'Record Introduction'}\r\n          </Button>\r\n        </DialogFooter>\r\n      </DialogContent>\r\n    </Dialog>\r\n  )\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 4969, "column": 0}, "map": {"version":3,"sources":["file:///Users/ghilesmoussaoui/Desktop/Versotech/versotech-portal/src/components/staff/introducers/edit-introduction-dialog.tsx"],"sourcesContent":["'use client'\r\n\r\nimport { useState, useTransition, useEffect } from 'react'\r\nimport { Dialog, DialogContent, DialogDescription, DialogFooter, DialogHeader, DialogTitle } from '@/components/ui/dialog'\r\nimport { Button } from '@/components/ui/button'\r\nimport { Input } from '@/components/ui/input'\r\nimport { Label } from '@/components/ui/label'\r\nimport { Textarea } from '@/components/ui/textarea'\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select'\r\nimport { toast } from 'sonner'\r\nimport { useRouter } from 'next/navigation'\r\n\r\ntype Introduction = {\r\n  id: string\r\n  introducerId?: string\r\n  introducerName: string\r\n  prospectEmail: string\r\n  dealId?: string\r\n  dealName: string\r\n  status: string\r\n  introducedAt: string | null\r\n  commissionAmount: number | null\r\n  commissionStatus: string | null\r\n  commissionRateOverrideBps?: number | null\r\n  notes?: string | null\r\n}\r\n\r\ntype EditIntroductionDialogProps = {\r\n  open: boolean\r\n  onOpenChange: (open: boolean) => void\r\n  introduction: Introduction | null\r\n  introducers?: Array<{ id: string; legalName: string }>\r\n  deals?: Array<{ id: string; name: string }>\r\n}\r\n\r\nexport function EditIntroductionDialog({\r\n  open,\r\n  onOpenChange,\r\n  introduction,\r\n  introducers = [],\r\n  deals = []\r\n}: EditIntroductionDialogProps) {\r\n  const [introducerId, setIntroducerId] = useState('')\r\n  const [prospectEmail, setProspectEmail] = useState('')\r\n  const [dealId, setDealId] = useState('')\r\n  const [status, setStatus] = useState('')\r\n  const [commissionOverride, setCommissionOverride] = useState<number | ''>('')\r\n  const [notes, setNotes] = useState('')\r\n  const [isPending, startTransition] = useTransition()\r\n  const router = useRouter()\r\n\r\n  useEffect(() => {\r\n    if (introduction) {\r\n      setIntroducerId(introduction.introducerId || '')\r\n      setProspectEmail(introduction.prospectEmail)\r\n      setDealId(introduction.dealId || '')\r\n      setStatus(introduction.status)\r\n      setCommissionOverride(introduction.commissionRateOverrideBps || '')\r\n      setNotes(introduction.notes || '')\r\n    }\r\n  }, [introduction])\r\n\r\n  const handleUpdate = () => {\r\n    if (!introduction) return\r\n\r\n    startTransition(async () => {\r\n      if (!prospectEmail.trim()) {\r\n        toast.error('Prospect email is required')\r\n        return\r\n      }\r\n\r\n      if (commissionOverride !== '' && (Number(commissionOverride) < 0 || Number(commissionOverride) > 300)) {\r\n        toast.error('Commission override must be between 0 and 300 bps')\r\n        return\r\n      }\r\n\r\n      try {\r\n        const payload: Record<string, any> = {\r\n          status,\r\n          commission_rate_override_bps: commissionOverride === '' ? null : Number(commissionOverride),\r\n          notes: notes.trim() || null,\r\n        }\r\n\r\n        // Only include changed fields\r\n        if (introducerId && introducerId !== introduction.introducerId) {\r\n          payload.introducer_id = introducerId\r\n        }\r\n        if (prospectEmail.trim() !== introduction.prospectEmail) {\r\n          payload.prospect_email = prospectEmail.trim()\r\n        }\r\n        if (dealId && dealId !== introduction.dealId) {\r\n          payload.deal_id = dealId\r\n        }\r\n\r\n        const response = await fetch(`/api/staff/introductions/${introduction.id}`, {\r\n          method: 'PATCH',\r\n          headers: { 'Content-Type': 'application/json' },\r\n          body: JSON.stringify(payload),\r\n        })\r\n\r\n        if (!response.ok) {\r\n          const text = await response.text()\r\n\r\n          let data\r\n          try {\r\n            data = JSON.parse(text)\r\n          } catch (e) {\r\n            toast.error(`Failed to update introduction: ${text || 'Unknown error'}`)\r\n            return\r\n          }\r\n\r\n          if (data?.details) {\r\n            toast.error(`Validation failed: ${JSON.stringify(data.details.fieldErrors || data.details)}`)\r\n          } else {\r\n            toast.error(data?.error ?? 'Failed to update introduction')\r\n          }\r\n          return\r\n        }\r\n\r\n        toast.success('Introduction updated')\r\n        onOpenChange(false)\r\n        router.refresh()\r\n      } catch (err) {\r\n        toast.error('Failed to update introduction')\r\n      }\r\n    })\r\n  }\r\n\r\n  const handleDelete = () => {\r\n    if (!introduction) return\r\n\r\n    if (!confirm('Are you sure you want to delete this introduction? This action cannot be undone.')) {\r\n      return\r\n    }\r\n\r\n    startTransition(async () => {\r\n      try {\r\n        const response = await fetch(`/api/staff/introductions/${introduction.id}`, {\r\n          method: 'DELETE',\r\n        })\r\n\r\n        if (!response.ok) {\r\n          const data = await response.json().catch(() => null)\r\n          toast.error(data?.error ?? 'Failed to delete introduction')\r\n          return\r\n        }\r\n\r\n        toast.success('Introduction deleted')\r\n        onOpenChange(false)\r\n        router.refresh()\r\n      } catch (err) {\r\n        toast.error('Failed to delete introduction')\r\n      }\r\n    })\r\n  }\r\n\r\n  if (!introduction) return null\r\n\r\n  return (\r\n    <Dialog open={open} onOpenChange={onOpenChange}>\r\n      <DialogContent className=\"max-w-lg\">\r\n        <DialogHeader>\r\n          <DialogTitle>Edit Introduction</DialogTitle>\r\n          <DialogDescription>Update introduction status and details.</DialogDescription>\r\n        </DialogHeader>\r\n        <div className=\"space-y-4\">\r\n          <div className=\"grid gap-2\">\r\n            <Label>Introducer</Label>\r\n            {introducers.length > 0 ? (\r\n              <Select value={introducerId} onValueChange={setIntroducerId}>\r\n                <SelectTrigger>\r\n                  <SelectValue placeholder=\"Select introducer\" />\r\n                </SelectTrigger>\r\n                <SelectContent>\r\n                  {introducers.map((intro) => (\r\n                    <SelectItem key={intro.id} value={intro.id}>\r\n                      {intro.legalName}\r\n                    </SelectItem>\r\n                  ))}\r\n                </SelectContent>\r\n              </Select>\r\n            ) : (\r\n              <Input value={introduction.introducerName} disabled className=\"bg-muted\" />\r\n            )}\r\n          </div>\r\n\r\n          <div className=\"grid gap-2\">\r\n            <Label htmlFor=\"prospectEmail\">Prospect Email</Label>\r\n            <Input\r\n              id=\"prospectEmail\"\r\n              type=\"email\"\r\n              value={prospectEmail}\r\n              onChange={(e) => setProspectEmail(e.target.value)}\r\n              placeholder=\"prospect@example.com\"\r\n            />\r\n          </div>\r\n\r\n          <div className=\"grid gap-2\">\r\n            <Label>Deal</Label>\r\n            {deals.length > 0 ? (\r\n              <Select value={dealId} onValueChange={setDealId}>\r\n                <SelectTrigger>\r\n                  <SelectValue placeholder=\"Select deal\" />\r\n                </SelectTrigger>\r\n                <SelectContent>\r\n                  {deals.map((deal) => (\r\n                    <SelectItem key={deal.id} value={deal.id}>\r\n                      {deal.name}\r\n                    </SelectItem>\r\n                  ))}\r\n                </SelectContent>\r\n              </Select>\r\n            ) : (\r\n              <Input value={introduction.dealName} disabled className=\"bg-muted\" />\r\n            )}\r\n          </div>\r\n\r\n          <div className=\"grid gap-2\">\r\n            <Label>Status</Label>\r\n            <Select value={status} onValueChange={setStatus}>\r\n              <SelectTrigger>\r\n                <SelectValue placeholder=\"Select status\" />\r\n              </SelectTrigger>\r\n              <SelectContent>\r\n                <SelectItem value=\"invited\">Invited</SelectItem>\r\n                <SelectItem value=\"joined\">Joined</SelectItem>\r\n                <SelectItem value=\"allocated\">Allocated</SelectItem>\r\n                <SelectItem value=\"lost\">Lost</SelectItem>\r\n                <SelectItem value=\"inactive\">Inactive</SelectItem>\r\n              </SelectContent>\r\n            </Select>\r\n          </div>\r\n\r\n          <div className=\"grid gap-2\">\r\n            <Label htmlFor=\"commissionOverride\">Commission Rate Override (bps, optional)</Label>\r\n            <Input\r\n              id=\"commissionOverride\"\r\n              type=\"number\"\r\n              min={0}\r\n              max={300}\r\n              value={commissionOverride}\r\n              onChange={(event) =>\r\n                setCommissionOverride(event.target.value === '' ? '' : Number(event.target.value))\r\n              }\r\n              placeholder=\"Leave empty to use introducer's default rate\"\r\n            />\r\n          </div>\r\n\r\n          <div className=\"grid gap-2\">\r\n            <Label htmlFor=\"notes\">Notes</Label>\r\n            <Textarea\r\n              id=\"notes\"\r\n              value={notes}\r\n              onChange={(event) => setNotes(event.target.value)}\r\n              placeholder=\"Additional context about this introduction...\"\r\n              rows={3}\r\n            />\r\n          </div>\r\n        </div>\r\n        <DialogFooter className=\"flex justify-between\">\r\n          <Button variant=\"destructive\" onClick={handleDelete} disabled={isPending}>\r\n            Delete\r\n          </Button>\r\n          <div className=\"flex gap-2\">\r\n            <Button variant=\"outline\" onClick={() => onOpenChange(false)} disabled={isPending}>\r\n              Cancel\r\n            </Button>\r\n            <Button onClick={handleUpdate} disabled={isPending}>\r\n              {isPending ? 'Updating' : 'Update Introduction'}\r\n            </Button>\r\n          </div>\r\n        </DialogFooter>\r\n      </DialogContent>\r\n    </Dialog>\r\n  )\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 5492, "column": 0}, "map": {"version":3,"sources":["file:///Users/ghilesmoussaoui/Desktop/Versotech/versotech-portal/src/components/ui/switch.tsx"],"sourcesContent":["\"use client\"\n\nimport * as React from \"react\"\nimport * as SwitchPrimitives from \"@radix-ui/react-switch\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Switch = React.forwardRef<\n  React.ElementRef<typeof SwitchPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof SwitchPrimitives.Root>\n>(({ className, ...props }, ref) => (\n  <SwitchPrimitives.Root\n    className={cn(\n      \"peer inline-flex h-7 md:h-6 w-12 md:w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  >\n    <SwitchPrimitives.Thumb\n      className={cn(\n        \"pointer-events-none block h-6 w-6 md:h-5 md:w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0\"\n      )}\n    />\n  </SwitchPrimitives.Root>\n))\nSwitch.displayName = SwitchPrimitives.Root.displayName\n\nexport { Switch }"],"names":[],"mappings":";;;;;AAEA;AACA;AAEA;AALA;;;;;AAOA,MAAM,uBAAS,0OAAgB,CAG7B,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,qQAAC,iMAAqB;QACpB,WAAW,IAAA,gJAAE,EACX,qYACA;QAED,GAAG,KAAK;QACT,KAAK;kBAEL,cAAA,qQAAC,kMAAsB;YACrB,WAAW,IAAA,gJAAE,EACX;;;;;;;;;;;AAKR,OAAO,WAAW,GAAG,iMAAqB,CAAC,WAAW"}},
    {"offset": {"line": 5527, "column": 0}, "map": {"version":3,"sources":["file:///Users/ghilesmoussaoui/Desktop/Versotech/versotech-portal/src/components/users/invite-user-dialog.tsx"],"sourcesContent":["'use client'\n\nimport { useState } from 'react'\nimport { useForm } from 'react-hook-form'\nimport { zodResolver } from '@hookform/resolvers/zod'\nimport { z } from 'zod'\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n} from '@/components/ui/dialog'\nimport { Button } from '@/components/ui/button'\nimport { Input } from '@/components/ui/input'\nimport { Label } from '@/components/ui/label'\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from '@/components/ui/select'\nimport { Switch } from '@/components/ui/switch'\nimport { Loader2, Mail, User, Briefcase } from 'lucide-react'\nimport { toast } from 'sonner'\n\nconst inviteUserSchema = z.object({\n  email: z.string().email('Please enter a valid email address'),\n  display_name: z.string().min(2, 'Display name must be at least 2 characters'),\n  title: z.string().optional(),\n  role: z.string(),\n  is_primary: z.boolean(),\n  is_signatory: z.boolean(),\n  can_sign: z.boolean(),\n})\n\ntype InviteUserFormData = z.infer<typeof inviteUserSchema>\n\nexport type EntityType = 'investor' | 'arranger' | 'lawyer' | 'introducer' | 'partner' | 'commercial_partner'\n\ninterface InviteUserDialogProps {\n  entityType: EntityType\n  entityId: string\n  entityName: string\n  open: boolean\n  onOpenChange: (open: boolean) => void\n  onSuccess?: () => void\n}\n\nconst ENTITY_TYPE_LABELS: Record<EntityType, string> = {\n  investor: 'Investor',\n  arranger: 'Arranger',\n  lawyer: 'Law Firm',\n  introducer: 'Introducer',\n  partner: 'Partner',\n  commercial_partner: 'Commercial Partner',\n}\n\n// Role options per entity type (from database constraints)\nconst ROLE_OPTIONS_BY_ENTITY: Record<EntityType, { value: string; label: string }[]> = {\n  investor: [\n    { value: 'admin', label: 'Admin' },\n    { value: 'member', label: 'Member' },\n    { value: 'viewer', label: 'Viewer' },\n  ],\n  arranger: [\n    { value: 'admin', label: 'Admin' },\n    { value: 'member', label: 'Member' },\n    { value: 'viewer', label: 'Viewer' },\n  ],\n  lawyer: [\n    { value: 'admin', label: 'Admin' },\n    { value: 'member', label: 'Member' },\n    { value: 'viewer', label: 'Viewer' },\n  ],\n  partner: [\n    { value: 'admin', label: 'Admin' },\n    { value: 'member', label: 'Member' },\n    { value: 'viewer', label: 'Viewer' },\n  ],\n  introducer: [\n    { value: 'admin', label: 'Admin' },\n    { value: 'contact', label: 'Contact' },\n    { value: 'payment_contact', label: 'Payment Contact' },\n    { value: 'legal_contact', label: 'Legal Contact' },\n  ],\n  commercial_partner: [\n    { value: 'admin', label: 'Admin' },\n    { value: 'contact', label: 'Contact' },\n    { value: 'billing_contact', label: 'Billing Contact' },\n    { value: 'technical_contact', label: 'Technical Contact' },\n  ],\n}\n\n// Default role per entity type\nconst DEFAULT_ROLE_BY_ENTITY: Record<EntityType, string> = {\n  investor: 'member',\n  arranger: 'member',\n  lawyer: 'member',\n  partner: 'member',\n  introducer: 'contact',\n  commercial_partner: 'contact',\n}\n\nexport function InviteUserDialog({\n  entityType,\n  entityId,\n  entityName,\n  open,\n  onOpenChange,\n  onSuccess,\n}: InviteUserDialogProps) {\n  const [isSubmitting, setIsSubmitting] = useState(false)\n\n  // Get role options and default for this entity type\n  const roleOptions = ROLE_OPTIONS_BY_ENTITY[entityType]\n  const defaultRole = DEFAULT_ROLE_BY_ENTITY[entityType]\n\n  const {\n    register,\n    handleSubmit,\n    reset,\n    watch,\n    setValue,\n    formState: { errors },\n  } = useForm<InviteUserFormData>({\n    resolver: zodResolver(inviteUserSchema),\n    defaultValues: {\n      email: '',\n      display_name: '',\n      title: '',\n      role: defaultRole,\n      is_primary: false,\n      is_signatory: false,\n      can_sign: false,\n    },\n  })\n\n  const isPrimary = watch('is_primary')\n  const isSignatory = watch('is_signatory')\n  const canSign = watch('can_sign')\n  const role = watch('role')\n\n  const onSubmit = async (data: InviteUserFormData) => {\n    setIsSubmitting(true)\n    try {\n      const response = await fetch('/api/admin/entity-invite', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          entity_type: entityType,\n          entity_id: entityId,\n          ...data,\n        }),\n      })\n\n      const result = await response.json()\n\n      if (!response.ok) {\n        throw new Error(result.error || 'Failed to invite user')\n      }\n\n      toast.success(result.message || `User invited to ${entityName}`)\n      reset()\n      onOpenChange(false)\n      onSuccess?.()\n    } catch (error) {\n      console.error('Invite error:', error)\n      toast.error(error instanceof Error ? error.message : 'Failed to invite user')\n    } finally {\n      setIsSubmitting(false)\n    }\n  }\n\n  const handleClose = () => {\n    reset()\n    onOpenChange(false)\n  }\n\n  return (\n    <Dialog open={open} onOpenChange={handleClose}>\n      <DialogContent className=\"sm:max-w-[500px]\">\n        <DialogHeader>\n          <DialogTitle className=\"flex items-center gap-2\">\n            <Mail className=\"h-5 w-5\" />\n            Invite User to {ENTITY_TYPE_LABELS[entityType]}\n          </DialogTitle>\n          <DialogDescription>\n            Send an invitation email to join <span className=\"font-medium\">{entityName}</span>.\n            They will receive instructions to set up their account.\n          </DialogDescription>\n        </DialogHeader>\n\n        <form onSubmit={handleSubmit(onSubmit)} className=\"space-y-4\">\n          <div className=\"space-y-2\">\n            <Label htmlFor=\"email\">Email Address *</Label>\n            <div className=\"relative\">\n              <Mail className=\"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground\" />\n              <Input\n                id=\"email\"\n                type=\"email\"\n                placeholder=\"user@example.com\"\n                className=\"pl-10\"\n                {...register('email')}\n              />\n            </div>\n            {errors.email && (\n              <p className=\"text-sm text-destructive\">{errors.email.message}</p>\n            )}\n          </div>\n\n          <div className=\"space-y-2\">\n            <Label htmlFor=\"display_name\">Display Name *</Label>\n            <div className=\"relative\">\n              <User className=\"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground\" />\n              <Input\n                id=\"display_name\"\n                placeholder=\"John Smith\"\n                className=\"pl-10\"\n                {...register('display_name')}\n              />\n            </div>\n            {errors.display_name && (\n              <p className=\"text-sm text-destructive\">{errors.display_name.message}</p>\n            )}\n          </div>\n\n          <div className=\"space-y-2\">\n            <Label htmlFor=\"title\">Title (Optional)</Label>\n            <div className=\"relative\">\n              <Briefcase className=\"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground\" />\n              <Input\n                id=\"title\"\n                placeholder=\"Managing Director\"\n                className=\"pl-10\"\n                {...register('title')}\n              />\n            </div>\n          </div>\n\n          <div className=\"space-y-2\">\n            <Label htmlFor=\"role\">Role</Label>\n            <Select\n              value={role}\n              onValueChange={(value) => setValue('role', value)}\n            >\n              <SelectTrigger>\n                <SelectValue placeholder=\"Select role\" />\n              </SelectTrigger>\n              <SelectContent>\n                {roleOptions.map((option) => (\n                  <SelectItem key={option.value} value={option.value}>\n                    {option.label}\n                  </SelectItem>\n                ))}\n              </SelectContent>\n            </Select>\n          </div>\n\n          <div className=\"flex items-center justify-between rounded-lg border p-3\">\n            <div className=\"space-y-0.5\">\n              <Label htmlFor=\"is_primary\" className=\"text-sm font-medium\">\n                Primary Contact\n              </Label>\n              <p className=\"text-xs text-muted-foreground\">\n                Set as the main point of contact for this entity\n              </p>\n            </div>\n            <Switch\n              id=\"is_primary\"\n              checked={isPrimary}\n              onCheckedChange={(checked) => setValue('is_primary', checked)}\n            />\n          </div>\n\n          {entityType === 'lawyer' && (\n            <div className=\"flex items-center justify-between rounded-lg border p-3\">\n              <div className=\"space-y-0.5\">\n                <Label htmlFor=\"can_sign\" className=\"text-sm font-medium\">\n                  Can Sign Documents\n                </Label>\n                <p className=\"text-xs text-muted-foreground\">\n                  Has authority to sign on behalf of the law firm\n                </p>\n              </div>\n              <Switch\n                id=\"can_sign\"\n                checked={canSign}\n                onCheckedChange={(checked) => setValue('can_sign', checked)}\n              />\n            </div>\n          )}\n\n          <DialogFooter className=\"gap-2 sm:gap-0\">\n            <Button type=\"button\" variant=\"outline\" onClick={handleClose}>\n              Cancel\n            </Button>\n            <Button type=\"submit\" disabled={isSubmitting}>\n              {isSubmitting ? (\n                <>\n                  <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n                  Sending Invite...\n                </>\n              ) : (\n                <>\n                  <Mail className=\"mr-2 h-4 w-4\" />\n                  Send Invitation\n                </>\n              )}\n            </Button>\n          </DialogFooter>\n        </form>\n      </DialogContent>\n    </Dialog>\n  )\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 6150, "column": 0}, "map": {"version":3,"sources":["file:///Users/ghilesmoussaoui/Desktop/Versotech/versotech-portal/src/components/staff/introducers/introducers-dashboard.tsx"],"sourcesContent":["'use client'\r\n\r\nimport { useMemo, useState, useTransition } from 'react'\r\nimport { useRouter } from 'next/navigation'\r\nimport { toast } from 'sonner'\r\nimport Link from 'next/link'\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card'\r\nimport { Badge } from '@/components/ui/badge'\r\nimport { Button } from '@/components/ui/button'\r\nimport { Input } from '@/components/ui/input'\r\nimport {\r\n  Select,\r\n  SelectContent,\r\n  SelectItem,\r\n  SelectTrigger,\r\n  SelectValue,\r\n} from '@/components/ui/select'\r\nimport {\r\n  HandHeart,\r\n  Users,\r\n  DollarSign,\r\n  Clock,\r\n  Plus,\r\n  Filter,\r\n  Search,\r\n  TrendingUp,\r\n  Edit,\r\n  UserPlus,\r\n  FileText,\r\n  Send,\r\n  MoreHorizontal,\r\n} from 'lucide-react'\r\nimport {\r\n  DropdownMenu,\r\n  DropdownMenuContent,\r\n  DropdownMenuItem,\r\n  DropdownMenuLabel,\r\n  DropdownMenuSeparator,\r\n  DropdownMenuTrigger,\r\n} from '@/components/ui/dropdown-menu'\r\nimport FeePlanEditModal from '@/components/fees/FeePlanEditModal'\r\nimport { cn } from '@/lib/utils'\r\nimport { formatCurrency, formatDate, formatBps } from '@/lib/format'\r\nimport { CheckCircle2 } from 'lucide-react'\r\nimport { useAddIntroducer } from '@/components/staff/introducers/add-introducer-context'\r\nimport { EditIntroducerDialog } from '@/components/staff/introducers/edit-introducer-dialog'\r\nimport { AddIntroductionDialog } from '@/components/staff/introducers/add-introduction-dialog'\r\nimport { EditIntroductionDialog } from '@/components/staff/introducers/edit-introduction-dialog'\r\nimport { InviteUserDialog } from '@/components/users/invite-user-dialog'\r\n\r\nexport type IntroducersDashboardProps = {\r\n  summary: {\r\n    totalIntroducers: number\r\n    activeIntroducers: number\r\n    totalIntroductions: number\r\n    totalAllocations: number\r\n    totalCommissionPaid: number\r\n    pendingCommission: number\r\n  }\r\n  introducers: Array<{\r\n    id: string\r\n    legalName: string\r\n    contactName: string | null\r\n    email: string | null\r\n    defaultCommissionBps: number\r\n    commissionCapAmount: number | null\r\n    paymentTerms: string | null\r\n    status: string\r\n    createdAt: string | null\r\n    totalIntroductions: number\r\n    successfulAllocations: number\r\n    totalCommissionPaid: number\r\n    pendingCommission: number\r\n    lastIntroductionAt: string | null\r\n    feePlans?: {\r\n      total: number\r\n      accepted: number\r\n      pending: number\r\n    }\r\n  }>\r\n  recentIntroductions: Array<{\r\n    id: string\r\n    introducerId?: string\r\n    introducerName: string\r\n    prospectEmail: string\r\n    dealId?: string\r\n    dealName: string\r\n    status: string\r\n    introducedAt: string | null\r\n    commissionAmount: number | null\r\n    commissionStatus: string | null\r\n    commissionRateOverrideBps?: number | null\r\n    notes?: string | null\r\n  }>\r\n  deals?: Array<{ id: string; name: string }>\r\n  isDemo?: boolean\r\n  showAddButtons?: boolean\r\n}\r\n\r\nconst statusFilters = [\r\n  { label: 'All status', value: 'all' },\r\n  { label: 'Active', value: 'active' },\r\n  { label: 'Inactive', value: 'inactive' },\r\n  { label: 'Suspended', value: 'suspended' },\r\n]\r\n\r\nexport function IntroducersDashboard({ summary, introducers, recentIntroductions, deals = [], isDemo = false, showAddButtons = true }: IntroducersDashboardProps) {\r\n  const router = useRouter()\r\n  const [search, setSearch] = useState('')\r\n  const [statusFilter, setStatusFilter] = useState<string>('all')\r\n  const [editingIntroducer, setEditingIntroducer] = useState<IntroducersDashboardProps['introducers'][number] | null>(null)\r\n  const [editingIntroduction, setEditingIntroduction] = useState<IntroducersDashboardProps['recentIntroductions'][number] | null>(null)\r\n  const [addIntroductionOpen, setAddIntroductionOpen] = useState(false)\r\n  const [inviteDialogIntroducer, setInviteDialogIntroducer] = useState<IntroducersDashboardProps['introducers'][number] | null>(null)\r\n  const { setOpen } = useAddIntroducer()\r\n\r\n  // Fee plan modal state\r\n  const [feePlanModalOpen, setFeePlanModalOpen] = useState(false)\r\n  const [selectedIntroducerForFeePlan, setSelectedIntroducerForFeePlan] = useState<IntroducersDashboardProps['introducers'][number] | null>(null)\r\n\r\n  // Handler for creating a fee plan for an introducer\r\n  const handleCreateFeePlan = (introducer: IntroducersDashboardProps['introducers'][number]) => {\r\n    setSelectedIntroducerForFeePlan(introducer)\r\n    setFeePlanModalOpen(true)\r\n  }\r\n\r\n  const handleFeePlanSuccess = () => {\r\n    setFeePlanModalOpen(false)\r\n    setSelectedIntroducerForFeePlan(null)\r\n    toast.success('Fee plan created successfully')\r\n    router.refresh()\r\n  }\r\n\r\n  // Handler for dispatching investor through an introducer\r\n  const handleDispatchInvestor = (introducer: IntroducersDashboardProps['introducers'][number]) => {\r\n    // Navigate to dispatch page with introducer pre-selected\r\n    // For now, show toast with info - will implement full dispatch modal in next phase\r\n    toast.info(`To dispatch an investor through ${introducer.legalName}, go to a deal's Members tab and use \"Add Participant\"`)\r\n  }\r\n\r\n  const filteredIntroducers = useMemo(() => {\r\n    return introducers.filter((introducer) => {\r\n      const matchesStatus = statusFilter === 'all' || introducer.status === statusFilter\r\n      const matchesSearch = !search || introducer.legalName.toLowerCase().includes(search.toLowerCase())\r\n        || (introducer.contactName?.toLowerCase().includes(search.toLowerCase()) ?? false)\r\n        || (introducer.email?.toLowerCase().includes(search.toLowerCase()) ?? false)\r\n      return matchesStatus && matchesSearch\r\n    })\r\n  }, [introducers, statusFilter, search])\r\n\r\n  return (\r\n    <div className=\"p-6 space-y-6\">\r\n      <div className=\"flex items-center justify-between\">\r\n        <div>\r\n          <h1 className=\"text-2xl font-bold text-foreground\">Introducer Management</h1>\r\n          <p className=\"text-muted-foreground mt-1\">\r\n            Manage introducer relationships, commissions, and performance tracking\r\n          </p>\r\n        </div>\r\n        {showAddButtons && (\r\n          <div className=\"flex items-center gap-3\">\r\n            <Button variant=\"outline\" onClick={() => setAddIntroductionOpen(true)}>\r\n              <UserPlus className=\"h-4 w-4 mr-2\" />\r\n              Record Introduction\r\n            </Button>\r\n            <Button onClick={() => setOpen(true)}>\r\n              <Plus className=\"h-4 w-4 mr-2\" />\r\n              Add Introducer\r\n            </Button>\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      <div className=\"grid grid-cols-1 md:grid-cols-4 gap-6\">\r\n        <DashboardStatCard\r\n          icon={<HandHeart className=\"h-4 w-4\" />}\r\n          label=\"Active Introducers\"\r\n          primary={summary.activeIntroducers}\r\n          secondary={`${summary.totalIntroducers} total`}\r\n        />\r\n        <DashboardStatCard\r\n          icon={<Users className=\"h-4 w-4\" />}\r\n          label=\"Total Introductions\"\r\n          primary={summary.totalIntroductions}\r\n          secondary={`${summary.totalAllocations} allocated`}\r\n        />\r\n        <DashboardStatCard\r\n          icon={<DollarSign className=\"h-4 w-4\" />}\r\n          label=\"Commissions Paid\"\r\n          primary={formatCurrency(summary.totalCommissionPaid)}\r\n          secondary=\"All-time\"\r\n        />\r\n        <DashboardStatCard\r\n          icon={<Clock className=\"h-4 w-4\" />}\r\n          label=\"Pending Commission\"\r\n          primary={formatCurrency(summary.pendingCommission)}\r\n          secondary=\"Awaiting payment\"\r\n          primaryClassName=\"text-orange-500\"\r\n        />\r\n      </div>\r\n\r\n      <Card>\r\n        <CardHeader>\r\n          <CardTitle>Search & Filters</CardTitle>\r\n          <CardDescription>\r\n            Narrow down introducers by status, performance, or keywords\r\n          </CardDescription>\r\n        </CardHeader>\r\n        <CardContent className=\"space-y-4\">\r\n          <div className=\"flex flex-col md:flex-row gap-4\">\r\n            <div className=\"flex-1\">\r\n              <div className=\"relative\">\r\n                <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\r\n                <Input\r\n                  placeholder=\"Search introducers, contacts, emails...\"\r\n                  value={search}\r\n                  onChange={(event) => setSearch(event.target.value)}\r\n                  className=\"pl-10\"\r\n                />\r\n              </div>\r\n            </div>\r\n            <Select value={statusFilter} onValueChange={setStatusFilter}>\r\n              <SelectTrigger className=\"w-full md:w-48\">\r\n                <SelectValue placeholder=\"Filter status\" />\r\n              </SelectTrigger>\r\n              <SelectContent>\r\n                {statusFilters.map((option) => (\r\n                  <SelectItem key={option.value} value={option.value}>\r\n                    {option.label}\r\n                  </SelectItem>\r\n                ))}\r\n              </SelectContent>\r\n            </Select>\r\n          </div>\r\n\r\n          {isDemo && (\r\n            <div className=\"flex items-center gap-2 text-sm text-muted-foreground\">\r\n              <Filter className=\"h-4 w-4\" />\r\n              Showing demo dataset. Re-run with a staff session to load live data.\r\n            </div>\r\n          )}\r\n        </CardContent>\r\n      </Card>\r\n\r\n      <Card>\r\n        <CardHeader>\r\n          <CardTitle>Introducers</CardTitle>\r\n          <CardDescription>\r\n            Performance summary for each introducer partner\r\n          </CardDescription>\r\n        </CardHeader>\r\n        <CardContent className=\"space-y-4\">\r\n          {filteredIntroducers.length === 0 ? (\r\n            <EmptyState message={search ? 'No introducers match your filters.' : 'No introducers available yet.'} />\r\n          ) : (\r\n            filteredIntroducers.map((introducer) => (\r\n              <IntroducerRow\r\n                key={introducer.id}\r\n                introducer={introducer}\r\n                onEdit={() => setEditingIntroducer(introducer)}\r\n                onInvite={() => setInviteDialogIntroducer(introducer)}\r\n                onCreateFeePlan={() => handleCreateFeePlan(introducer)}\r\n                onDispatchInvestor={() => handleDispatchInvestor(introducer)}\r\n              />\r\n            ))\r\n          )}\r\n        </CardContent>\r\n      </Card>\r\n\r\n      <Card>\r\n        <CardHeader>\r\n          <CardTitle>Recent Introductions</CardTitle>\r\n          <CardDescription>\r\n            Latest introducer activity across deals\r\n          </CardDescription>\r\n        </CardHeader>\r\n        <CardContent className=\"space-y-4\">\r\n          {recentIntroductions.length === 0 ? (\r\n            <EmptyState message=\"No recent introductions \" />\r\n          ) : (\r\n            recentIntroductions.map((introduction) => (\r\n              <RecentIntroductionRow\r\n                key={introduction.id}\r\n                introduction={introduction}\r\n                onEdit={() => setEditingIntroduction(introduction)}\r\n              />\r\n            ))\r\n          )}\r\n        </CardContent>\r\n      </Card>\r\n\r\n      <EditIntroducerDialog\r\n        open={!!editingIntroducer}\r\n        onOpenChange={(open) => !open && setEditingIntroducer(null)}\r\n        introducer={editingIntroducer}\r\n      />\r\n\r\n      <AddIntroductionDialog\r\n        open={addIntroductionOpen}\r\n        onOpenChange={setAddIntroductionOpen}\r\n        introducers={introducers.map((i) => ({ id: i.id, legalName: i.legalName }))}\r\n        deals={deals}\r\n      />\r\n\r\n      <EditIntroductionDialog\r\n        open={!!editingIntroduction}\r\n        onOpenChange={(open) => !open && setEditingIntroduction(null)}\r\n        introduction={editingIntroduction}\r\n        introducers={introducers.map((i) => ({ id: i.id, legalName: i.legalName }))}\r\n        deals={deals}\r\n      />\r\n\r\n      {inviteDialogIntroducer && (\r\n        <InviteUserDialog\r\n          open={!!inviteDialogIntroducer}\r\n          onOpenChange={(open) => !open && setInviteDialogIntroducer(null)}\r\n          entityType=\"introducer\"\r\n          entityId={inviteDialogIntroducer.id}\r\n          entityName={inviteDialogIntroducer.legalName}\r\n        />\r\n      )}\r\n\r\n      {/* Fee Plan Modal for creating fee plans with pre-selected introducer */}\r\n      <FeePlanEditModal\r\n        open={feePlanModalOpen}\r\n        onClose={() => {\r\n          setFeePlanModalOpen(false)\r\n          setSelectedIntroducerForFeePlan(null)\r\n        }}\r\n        onSuccess={handleFeePlanSuccess}\r\n      />\r\n    </div>\r\n  )\r\n}\r\n\r\nfunction DashboardStatCard({\r\n  icon,\r\n  label,\r\n  primary,\r\n  secondary,\r\n  primaryClassName,\r\n}: {\r\n  icon: React.ReactNode\r\n  label: string\r\n  primary: React.ReactNode\r\n  secondary: React.ReactNode\r\n  primaryClassName?: string\r\n}) {\r\n  return (\r\n    <Card>\r\n      <CardHeader className=\"pb-3\">\r\n        <CardTitle className=\"text-sm font-medium text-muted-foreground flex items-center gap-2\">\r\n          {icon}\r\n          {label}\r\n        </CardTitle>\r\n      </CardHeader>\r\n      <CardContent>\r\n        <div className={cn('text-2xl font-bold', primaryClassName)}>{primary}</div>\r\n        <div className=\"text-sm text-muted-foreground mt-1\">{secondary}</div>\r\n      </CardContent>\r\n    </Card>\r\n  )\r\n}\r\n\r\nfunction IntroducerRow({\r\n  introducer,\r\n  onEdit,\r\n  onInvite,\r\n  onCreateFeePlan,\r\n  onDispatchInvestor,\r\n}: {\r\n  introducer: IntroducersDashboardProps['introducers'][number]\r\n  onEdit: () => void\r\n  onInvite: () => void\r\n  onCreateFeePlan: () => void\r\n  onDispatchInvestor: () => void\r\n}) {\r\n  const statusStyles: Record<string, string> = {\r\n    active: 'bg-green-100 text-green-800',\r\n    inactive: 'bg-gray-100 text-gray-800',\r\n    suspended: 'bg-yellow-100 text-yellow-800',\r\n  }\r\n\r\n  return (\r\n    <div className=\"border border-border rounded-lg p-4 bg-background/60 hover:bg-background/80 transition-colors\">\r\n      <div className=\"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4\">\r\n        <div className=\"flex items-start gap-4 flex-1\">\r\n          <div className=\"w-12 h-12 rounded-lg border border-primary/30 bg-primary/10 flex items-center justify-center\">\r\n            <TrendingUp className=\"h-6 w-6 text-primary\" />\r\n          </div>\r\n          <div className=\"space-y-1 flex-1\">\r\n            <div className=\"flex items-center gap-2\">\r\n              <Link href={`/versotech_main/introducers/${introducer.id}`}>\r\n                <h3 className=\"text-lg font-semibold text-foreground hover:text-primary transition-colors cursor-pointer\">\r\n                  {introducer.legalName}\r\n                </h3>\r\n              </Link>\r\n              <DropdownMenu>\r\n                <DropdownMenuTrigger asChild>\r\n                  <Button variant=\"ghost\" size=\"sm\" className=\"h-7 w-7 p-0\">\r\n                    <MoreHorizontal className=\"h-4 w-4\" />\r\n                  </Button>\r\n                </DropdownMenuTrigger>\r\n                <DropdownMenuContent align=\"start\">\r\n                  <DropdownMenuLabel>Actions</DropdownMenuLabel>\r\n                  <DropdownMenuSeparator />\r\n                  <DropdownMenuItem onClick={onEdit}>\r\n                    <Edit className=\"mr-2 h-4 w-4\" />\r\n                    Edit Introducer\r\n                  </DropdownMenuItem>\r\n                  <DropdownMenuItem onClick={onInvite}>\r\n                    <UserPlus className=\"mr-2 h-4 w-4\" />\r\n                    Invite User\r\n                  </DropdownMenuItem>\r\n                  <DropdownMenuSeparator />\r\n                  <DropdownMenuItem onClick={onCreateFeePlan}>\r\n                    <FileText className=\"mr-2 h-4 w-4\" />\r\n                    Create Fee Plan\r\n                  </DropdownMenuItem>\r\n                  <DropdownMenuItem onClick={onDispatchInvestor}>\r\n                    <Send className=\"mr-2 h-4 w-4\" />\r\n                    Dispatch Investor\r\n                  </DropdownMenuItem>\r\n                </DropdownMenuContent>\r\n              </DropdownMenu>\r\n            </div>\r\n            <div className=\"text-sm text-muted-foreground\">\r\n              {introducer.contactName || 'No contact'}  {introducer.email || 'No email provided'}\r\n            </div>\r\n            <div className=\"text-sm text-muted-foreground flex flex-wrap gap-2\">\r\n              <span>Default commission: {formatBps(introducer.defaultCommissionBps)}</span>\r\n              {introducer.commissionCapAmount ? (\r\n                <span>Cap: {formatCurrency(introducer.commissionCapAmount)}</span>\r\n              ) : null}\r\n              {introducer.paymentTerms ? <span>Terms: {introducer.paymentTerms}</span> : null}\r\n            </div>\r\n          </div>\r\n        </div>\r\n        <div className=\"flex flex-wrap items-center gap-6\">\r\n          <Stat label=\"Introductions\" value={introducer.totalIntroductions} />\r\n          <Stat label=\"Allocated\" value={introducer.successfulAllocations} />\r\n          {/* Fee Plans count with status indicator */}\r\n          {introducer.feePlans && (\r\n            <div className=\"text-center\">\r\n              <div className=\"flex items-center justify-center gap-1 font-semibold tabular-nums\">\r\n                <FileText className=\"h-3.5 w-3.5 text-muted-foreground\" />\r\n                <span>{introducer.feePlans.accepted}/{introducer.feePlans.total}</span>\r\n                {introducer.feePlans.accepted === introducer.feePlans.total && introducer.feePlans.total > 0 && (\r\n                  <CheckCircle2 className=\"h-3.5 w-3.5 text-green-400\" />\r\n                )}\r\n                {introducer.feePlans.pending > 0 && (\r\n                  <Clock className=\"h-3.5 w-3.5 text-yellow-400\" />\r\n                )}\r\n              </div>\r\n              <div className=\"text-xs text-muted-foreground uppercase tracking-wide\">Fee Plans</div>\r\n            </div>\r\n          )}\r\n          <Stat label=\"Paid\" value={formatCurrency(introducer.totalCommissionPaid)} />\r\n          <Stat label=\"Pending\" value={formatCurrency(introducer.pendingCommission)} className=\"text-orange-500\" />\r\n          <div className=\"flex flex-col items-start gap-2\">\r\n            <Badge className={cn('capitalize', statusStyles[introducer.status] ?? 'bg-gray-100 text-foreground')}>\r\n              {introducer.status}\r\n            </Badge>\r\n            <span className=\"text-xs text-muted-foreground\">\r\n              Last intro: {introducer.lastIntroductionAt ? formatDate(introducer.lastIntroductionAt) : ''}\r\n            </span>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n\r\nfunction Stat({ label, value, className }: { label: string; value: React.ReactNode; className?: string }) {\r\n  return (\r\n    <div className=\"text-center\">\r\n      <div className={cn('font-semibold tabular-nums', className)}>{value}</div>\r\n      <div className=\"text-xs text-muted-foreground uppercase tracking-wide\">{label}</div>\r\n    </div>\r\n  )\r\n}\r\n\r\nfunction RecentIntroductionRow({\r\n  introduction,\r\n  onEdit\r\n}: {\r\n  introduction: IntroducersDashboardProps['recentIntroductions'][number]\r\n  onEdit: () => void\r\n}) {\r\n  const [status, setStatus] = useState(introduction.status)\r\n  const [isPending, startTransition] = useTransition()\r\n  const router = useRouter()\r\n\r\n  const statusStyles: Record<string, string> = {\r\n    allocated: 'border-green-200 text-green-700',\r\n    joined: 'border-blue-200 text-blue-700',\r\n    invited: 'border-yellow-200 text-yellow-700',\r\n    lost: 'border-red-200 text-red-700',\r\n    inactive: 'border-gray-200 text-gray-700',\r\n  }\r\n\r\n  const handleStatusChange = (newStatus: string) => {\r\n    startTransition(async () => {\r\n      try {\r\n        const response = await fetch(`/api/staff/introductions/${introduction.id}`, {\r\n          method: 'PATCH',\r\n          headers: { 'Content-Type': 'application/json' },\r\n          body: JSON.stringify({ status: newStatus }),\r\n        })\r\n\r\n        if (!response.ok) {\r\n          toast.error('Failed to update introduction status')\r\n          return\r\n        }\r\n\r\n        setStatus(newStatus)\r\n        toast.success('Introduction status updated')\r\n        router.refresh()\r\n      } catch (err) {\r\n        toast.error('Failed to update introduction status')\r\n      }\r\n    })\r\n  }\r\n\r\n  return (\r\n    <div className=\"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 border border-border rounded-lg p-4\">\r\n      <div className=\"space-y-1 flex-1\">\r\n        <div className=\"flex items-center gap-2 flex-wrap\">\r\n          <h4 className=\"text-sm font-semibold text-foreground\">{introduction.prospectEmail}</h4>\r\n          <Select value={status} onValueChange={handleStatusChange} disabled={isPending}>\r\n            <SelectTrigger className={cn('w-32 h-7 text-xs capitalize', statusStyles[status] ?? 'border-gray-200 text-foreground')}>\r\n              <SelectValue />\r\n            </SelectTrigger>\r\n            <SelectContent>\r\n              <SelectItem value=\"invited\">Invited</SelectItem>\r\n              <SelectItem value=\"joined\">Joined</SelectItem>\r\n              <SelectItem value=\"allocated\">Allocated</SelectItem>\r\n              <SelectItem value=\"lost\">Lost</SelectItem>\r\n              <SelectItem value=\"inactive\">Inactive</SelectItem>\r\n            </SelectContent>\r\n          </Select>\r\n        </div>\r\n        <div className=\"text-sm text-muted-foreground\">\r\n          {introduction.introducerName}  {introduction.dealName}\r\n        </div>\r\n        <div className=\"text-xs text-muted-foreground\">\r\n          Introduced {introduction.introducedAt ? formatDate(introduction.introducedAt) : ''}\r\n        </div>\r\n      </div>\r\n      <div className=\"flex items-center gap-3\">\r\n        <div className=\"text-right\">\r\n          <div className=\"text-sm font-medium\">\r\n            {introduction.commissionAmount ? formatCurrency(introduction.commissionAmount) : 'Commission TBD'}\r\n          </div>\r\n          <div className=\"text-xs text-muted-foreground\">\r\n            {introduction.commissionStatus ? `Status: ${introduction.commissionStatus}` : 'Awaiting accrual'}\r\n          </div>\r\n        </div>\r\n        <Button\r\n          variant=\"outline\"\r\n          size=\"sm\"\r\n          onClick={onEdit}\r\n          className=\"h-8 w-8 p-0\"\r\n        >\r\n          <Edit className=\"h-4 w-4\" />\r\n        </Button>\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n\r\nfunction EmptyState({ message }: { message: string }) {\r\n  return (\r\n    <div className=\"border border-dashed border-muted rounded-lg py-12 flex flex-col items-center justify-center text-center space-y-2\">\r\n      <TrendingUp className=\"h-10 w-10 text-muted-foreground\" />\r\n      <p className=\"text-sm text-muted-foreground\">{message}</p>\r\n    </div>\r\n  )\r\n}\r\n\r\n"],"names":[],"mappings":"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"}}]
}