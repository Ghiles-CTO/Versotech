module.exports = [
"[project]/versotech-portal/src/app/favicon.ico.mjs { IMAGE => \"[project]/versotech-portal/src/app/favicon.ico (static in ecmascript, tag client)\" } [app-rsc] (structured image object, ecmascript, Next.js Server Component)", ((__turbopack_context__) => {

__turbopack_context__.n(__turbopack_context__.i("[project]/versotech-portal/src/app/favicon.ico.mjs { IMAGE => \"[project]/versotech-portal/src/app/favicon.ico (static in ecmascript, tag client)\" } [app-rsc] (structured image object, ecmascript)"));
}),
"[externals]/next/dist/shared/lib/no-fallback-error.external.js [external] (next/dist/shared/lib/no-fallback-error.external.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/shared/lib/no-fallback-error.external.js", () => require("next/dist/shared/lib/no-fallback-error.external.js"));

module.exports = mod;
}),
"[project]/versotech-portal/src/app/layout.tsx [app-rsc] (ecmascript, Next.js Server Component)", ((__turbopack_context__) => {

__turbopack_context__.n(__turbopack_context__.i("[project]/versotech-portal/src/app/layout.tsx [app-rsc] (ecmascript)"));
}),
"[project]/versotech-portal/src/app/not-found.tsx [app-rsc] (ecmascript, Next.js Server Component)", ((__turbopack_context__) => {

__turbopack_context__.n(__turbopack_context__.i("[project]/versotech-portal/src/app/not-found.tsx [app-rsc] (ecmascript)"));
}),
"[project]/versotech-portal/src/app/(main)/versotech_main/layout.tsx [app-rsc] (ecmascript, Next.js Server Component)", ((__turbopack_context__) => {

__turbopack_context__.n(__turbopack_context__.i("[project]/versotech-portal/src/app/(main)/versotech_main/layout.tsx [app-rsc] (ecmascript)"));
}),
"[project]/versotech-portal/src/components/deals/deal-detail-client.tsx [app-rsc] (client reference proxy) <module evaluation>", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "DealDetailClient",
    ()=>DealDetailClient
]);
// This file is generated by next-core EcmascriptClientReferenceModule.
var __TURBOPACK__imported__module__$5b$project$5d2f$versotech$2d$portal$2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$rsc$2f$react$2d$server$2d$dom$2d$turbopack$2d$server$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/versotech-portal/node_modules/next/dist/server/route-modules/app-page/vendored/rsc/react-server-dom-turbopack-server.js [app-rsc] (ecmascript)");
;
const DealDetailClient = (0, __TURBOPACK__imported__module__$5b$project$5d2f$versotech$2d$portal$2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$rsc$2f$react$2d$server$2d$dom$2d$turbopack$2d$server$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["registerClientReference"])(function() {
    throw new Error("Attempted to call DealDetailClient() from the server but DealDetailClient is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.");
}, "[project]/versotech-portal/src/components/deals/deal-detail-client.tsx <module evaluation>", "DealDetailClient");
}),
"[project]/versotech-portal/src/components/deals/deal-detail-client.tsx [app-rsc] (client reference proxy)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "DealDetailClient",
    ()=>DealDetailClient
]);
// This file is generated by next-core EcmascriptClientReferenceModule.
var __TURBOPACK__imported__module__$5b$project$5d2f$versotech$2d$portal$2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$rsc$2f$react$2d$server$2d$dom$2d$turbopack$2d$server$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/versotech-portal/node_modules/next/dist/server/route-modules/app-page/vendored/rsc/react-server-dom-turbopack-server.js [app-rsc] (ecmascript)");
;
const DealDetailClient = (0, __TURBOPACK__imported__module__$5b$project$5d2f$versotech$2d$portal$2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$rsc$2f$react$2d$server$2d$dom$2d$turbopack$2d$server$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["registerClientReference"])(function() {
    throw new Error("Attempted to call DealDetailClient() from the server but DealDetailClient is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.");
}, "[project]/versotech-portal/src/components/deals/deal-detail-client.tsx", "DealDetailClient");
}),
"[project]/versotech-portal/src/components/deals/deal-detail-client.tsx [app-rsc] (ecmascript)", ((__turbopack_context__) => {
"use strict";

var __TURBOPACK__imported__module__$5b$project$5d2f$versotech$2d$portal$2f$src$2f$components$2f$deals$2f$deal$2d$detail$2d$client$2e$tsx__$5b$app$2d$rsc$5d$__$28$client__reference__proxy$29$__$3c$module__evaluation$3e$__ = __turbopack_context__.i("[project]/versotech-portal/src/components/deals/deal-detail-client.tsx [app-rsc] (client reference proxy) <module evaluation>");
var __TURBOPACK__imported__module__$5b$project$5d2f$versotech$2d$portal$2f$src$2f$components$2f$deals$2f$deal$2d$detail$2d$client$2e$tsx__$5b$app$2d$rsc$5d$__$28$client__reference__proxy$29$__ = __turbopack_context__.i("[project]/versotech-portal/src/components/deals/deal-detail-client.tsx [app-rsc] (client reference proxy)");
;
__turbopack_context__.n(__TURBOPACK__imported__module__$5b$project$5d2f$versotech$2d$portal$2f$src$2f$components$2f$deals$2f$deal$2d$detail$2d$client$2e$tsx__$5b$app$2d$rsc$5d$__$28$client__reference__proxy$29$__);
}),
"[project]/versotech-portal/src/app/(main)/versotech_main/deals/[id]/page.tsx [app-rsc] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "default",
    ()=>DealDetailPage,
    "dynamic",
    ()=>dynamic
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$versotech$2d$portal$2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$rsc$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/versotech-portal/node_modules/next/dist/server/route-modules/app-page/vendored/rsc/react-jsx-dev-runtime.js [app-rsc] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$versotech$2d$portal$2f$src$2f$lib$2f$supabase$2f$server$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/versotech-portal/src/lib/supabase/server.ts [app-rsc] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$versotech$2d$portal$2f$node_modules$2f$next$2f$dist$2f$api$2f$navigation$2e$react$2d$server$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/versotech-portal/node_modules/next/dist/api/navigation.react-server.js [app-rsc] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$versotech$2d$portal$2f$node_modules$2f$next$2f$dist$2f$client$2f$components$2f$navigation$2e$react$2d$server$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/versotech-portal/node_modules/next/dist/client/components/navigation.react-server.js [app-rsc] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$versotech$2d$portal$2f$src$2f$components$2f$deals$2f$deal$2d$detail$2d$client$2e$tsx__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/versotech-portal/src/components/deals/deal-detail-client.tsx [app-rsc] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$versotech$2d$portal$2f$src$2f$lib$2f$auth$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/versotech-portal/src/lib/auth.ts [app-rsc] (ecmascript)");
;
;
;
;
;
const dynamic = 'force-dynamic';
async function DealDetailPage({ params }) {
    const { id: dealId } = await params;
    const clientSupabase = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$versotech$2d$portal$2f$src$2f$lib$2f$supabase$2f$server$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["createClient"])();
    const { data: { user }, error: userError } = await clientSupabase.auth.getUser();
    if (!user || userError) {
        (0, __TURBOPACK__imported__module__$5b$project$5d2f$versotech$2d$portal$2f$node_modules$2f$next$2f$dist$2f$client$2f$components$2f$navigation$2e$react$2d$server$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["redirect"])('/versotech_main/login');
    }
    // Check staff access via personas
    const hasStaffAccess = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$versotech$2d$portal$2f$src$2f$lib$2f$auth$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["checkStaffAccess"])(user.id);
    const serviceSupabase = (0, __TURBOPACK__imported__module__$5b$project$5d2f$versotech$2d$portal$2f$src$2f$lib$2f$supabase$2f$server$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["createServiceClient"])();
    if (!hasStaffAccess) {
        (0, __TURBOPACK__imported__module__$5b$project$5d2f$versotech$2d$portal$2f$node_modules$2f$next$2f$dist$2f$client$2f$components$2f$navigation$2e$react$2d$server$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["redirect"])('/versotech_main/deals');
    }
    // Get user profile for role
    const { data: userProfile } = await clientSupabase.from('profiles').select('role').eq('id', user.id).single();
    const userRole = userProfile?.role || 'staff_ops';
    // Fetch arranger entities for edit dropdown
    // Note: arranger_entities has no 'company_name' - use legal_name only
    const { data: arrangerEntities } = await serviceSupabase.from('arranger_entities').select('id, legal_name').eq('status', 'active').order('legal_name');
    // Fetch deal with all related data
    const { data: deal, error: dealError } = await serviceSupabase.from('deals').select(`
      *,
      vehicles (
        id,
        name,
        type,
        currency
      ),
      arranger_entities:arranger_entity_id (
        id,
        legal_name
      ),
      deal_memberships (
        user_id,
        investor_id,
        role,
        invited_at,
        accepted_at,
        dispatched_at,
        viewed_at,
        interest_confirmed_at,
        nda_signed_at,
        data_room_granted_at,
        profiles:user_id (
          id,
          display_name,
          email
        ),
        investors:investor_id (
          id,
          legal_name,
          type,
          kyc_status
        ),
        invited_by_profile:invited_by (
          display_name,
          email
        )
      ),
      fee_plans (
        id,
        deal_id,
        name,
        description,
        is_default,
        is_active,
        term_sheet_id,
        introducer_id,
        partner_id,
        commercial_partner_id,
        status,
        accepted_at,
        generated_agreement_id,
        generated_placement_agreement_id,
        agreement_duration_months,
        non_circumvention_months,
        governing_law,
        vat_registration_number,
        fee_components (
          id,
          kind,
          calc_method,
          rate_bps,
          flat_amount,
          frequency,
          payment_schedule,
          duration_periods,
          duration_unit,
          hurdle_rate_bps,
          has_catchup,
          catchup_rate_bps,
          has_high_water_mark,
          has_no_cap,
          performance_cap_percent,
          payment_days_after_event,
          tier_threshold_multiplier,
          base_calculation,
          notes
        ),
        term_sheet:term_sheet_id (
          id,
          version,
          status,
          term_sheet_date,
          subscription_fee_percent,
          management_fee_percent,
          carried_interest_percent
        ),
        introducer:introducer_id (
          id,
          legal_name,
          contact_name,
          email
        ),
        partner:partner_id (
          id,
          name,
          legal_name,
          contact_name,
          contact_email
        ),
        commercial_partner:commercial_partner_id (
          id,
          name,
          legal_name,
          contact_name,
          contact_email
        ),
        introducer_agreement:generated_agreement_id (
          id,
          reference_number,
          status,
          pdf_url
        ),
        placement_agreement:generated_placement_agreement_id (
          id,
          reference_number,
          status,
          pdf_url
        )
      ),
      share_lots (
        id,
        source_id,
        units_total,
        unit_cost,
        units_remaining,
        currency,
        acquired_at,
        lockup_until,
        status,
        share_sources:source_id (
          id,
          kind,
          counterparty_name,
          notes
        )
      )
    `).eq('id', dealId).single();
    if (dealError || !deal) {
        (0, __TURBOPACK__imported__module__$5b$project$5d2f$versotech$2d$portal$2f$node_modules$2f$next$2f$dist$2f$client$2f$components$2f$navigation$2e$react$2d$server$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["notFound"])();
    }
    // Fetch inventory summary
    const { data: inventorySummary } = await serviceSupabase.rpc('fn_deal_inventory_summary', {
        p_deal_id: dealId
    });
    // Fetch deal-scoped documents
    const { data: documents } = await serviceSupabase.from('deal_data_room_documents').select(`
      id,
      file_key,
      created_at,
      created_by,
      created_by_profile:created_by (
        display_name
      )
    `).eq('deal_id', dealId).order('created_at', {
        ascending: false
    });
    // Fetch term sheet versions
    const { data: termSheets } = await serviceSupabase.from('deal_fee_structures').select('*').eq('deal_id', dealId).order('created_at', {
        ascending: false
    });
    // Fetch investor interest submissions
    const { data: interests } = await serviceSupabase.from('investor_deal_interest').select(`
      *,
      investors (
        id,
        legal_name
      )
    `).eq('deal_id', dealId).order('submitted_at', {
        ascending: false
    });
    // Fetch data room access records
    const { data: dataRoomAccess } = await serviceSupabase.from('deal_data_room_access').select(`
      *,
      investors (
        id,
        legal_name
      )
    `).eq('deal_id', dealId).order('granted_at', {
        ascending: false
    });
    // Fetch data room documents
    const { data: dataRoomDocuments } = await serviceSupabase.from('deal_data_room_documents').select('*').eq('deal_id', dealId).order('folder', {
        ascending: true
    }).order('created_at', {
        ascending: true
    });
    // Fetch subscription submissions (for Subscriptions tab)
    const { data: subscriptionSubmissions } = await serviceSupabase.from('deal_subscription_submissions').select(`
      *,
      investors (
        id,
        legal_name
      )
    `).eq('deal_id', dealId).order('submitted_at', {
        ascending: false
    });
    // Fetch subscriptions with journey tracking fields (for Members tab journey)
    const { data: subscriptionsForJourney } = await serviceSupabase.from('subscriptions').select(`
      id,
      investor_id,
      commitment,
      funded_amount,
      status,
      pack_generated_at,
      pack_sent_at,
      signed_at,
      funded_at
    `).eq('deal_id', dealId);
    // Fetch activity events for summary (last 90 days)
    const ninetyDaysAgo = new Date(Date.now() - 90 * 24 * 60 * 60 * 1000).toISOString();
    const { data: activityEvents } = await serviceSupabase.from('deal_activity_events').select('event_type, occurred_at').eq('deal_id', dealId).gte('occurred_at', ninetyDaysAgo);
    const activitySummary = (activityEvents ?? []).reduce((acc, event)=>{
        acc[event.event_type] = (acc[event.event_type] ?? 0) + 1;
        return acc;
    }, {});
    // Filter only active fee plans
    const dealWithActiveFeePlans = {
        ...deal,
        fee_plans: (deal.fee_plans || []).filter((plan)=>plan.is_active !== false)
    };
    return /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$versotech$2d$portal$2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$rsc$2f$react$2d$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$versotech$2d$portal$2f$src$2f$components$2f$deals$2f$deal$2d$detail$2d$client$2e$tsx__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["DealDetailClient"], {
        deal: dealWithActiveFeePlans,
        inventorySummary: inventorySummary?.[0] || {
            total_units: 0,
            available_units: 0,
            reserved_units: 0,
            allocated_units: 0
        },
        documents: documents || [],
        termSheets: termSheets || [],
        interests: interests || [],
        dataRoomAccess: dataRoomAccess || [],
        dataRoomDocuments: dataRoomDocuments || [],
        subscriptions: subscriptionSubmissions || [],
        subscriptionsForJourney: subscriptionsForJourney || [],
        activitySummary: activitySummary,
        userProfile: {
            role: userRole
        },
        arrangerEntities: arrangerEntities || []
    }, void 0, false, {
        fileName: "[project]/versotech-portal/src/app/(main)/versotech_main/deals/[id]/page.tsx",
        lineNumber: 313,
        columnNumber: 5
    }, this);
}
}),
"[project]/versotech-portal/src/app/(main)/versotech_main/deals/[id]/page.tsx [app-rsc] (ecmascript, Next.js Server Component)", ((__turbopack_context__) => {

__turbopack_context__.n(__turbopack_context__.i("[project]/versotech-portal/src/app/(main)/versotech_main/deals/[id]/page.tsx [app-rsc] (ecmascript)"));
}),
];

//# sourceMappingURL=%5Broot-of-the-server%5D__9cd2b9d9._.js.map