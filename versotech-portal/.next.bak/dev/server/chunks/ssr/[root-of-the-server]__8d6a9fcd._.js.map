{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 22, "column": 0}, "map": {"version":3,"sources":["file:///Users/ghilesmoussaoui/Desktop/Versotech/versotech-portal/src/components/deals/deals-list-client.tsx/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport const DealsListClient = registerClientReference(\n    function() { throw new Error(\"Attempted to call DealsListClient() from the server but DealsListClient is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/versotech-portal/src/components/deals/deals-list-client.tsx <module evaluation>\",\n    \"DealsListClient\",\n);\n"],"names":[],"mappings":";;;;AAAA,uEAAuE;AACvE;;AACO,MAAM,kBAAkB,IAAA,+RAAuB,EAClD;IAAa,MAAM,IAAI,MAAM;AAA8O,GAC3Q,6FACA","ignoreList":[0]}},
    {"offset": {"line": 36, "column": 0}, "map": {"version":3,"sources":["file:///Users/ghilesmoussaoui/Desktop/Versotech/versotech-portal/src/components/deals/deals-list-client.tsx/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport const DealsListClient = registerClientReference(\n    function() { throw new Error(\"Attempted to call DealsListClient() from the server but DealsListClient is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/versotech-portal/src/components/deals/deals-list-client.tsx\",\n    \"DealsListClient\",\n);\n"],"names":[],"mappings":";;;;AAAA,uEAAuE;AACvE;;AACO,MAAM,kBAAkB,IAAA,+RAAuB,EAClD;IAAa,MAAM,IAAI,MAAM;AAA8O,GAC3Q,yEACA","ignoreList":[0]}},
    {"offset": {"line": 50, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":""}},
    {"offset": {"line": 58, "column": 0}, "map": {"version":3,"sources":["file:///Users/ghilesmoussaoui/Desktop/Versotech/versotech-portal/src/app/%28main%29/versotech_main/deals/page.tsx"],"sourcesContent":["import { createClient, createServiceClient } from '@/lib/supabase/server'\r\nimport { DealsListClient } from '@/components/deals/deals-list-client'\r\nimport { AlertCircle } from 'lucide-react'\r\nimport { checkStaffAccess } from '@/lib/auth'\r\n\r\nexport const dynamic = 'force-dynamic'\r\n\r\ninterface Deal {\r\n  id: string\r\n  name: string\r\n  deal_type: string\r\n  status: string\r\n  currency: string\r\n  offer_unit_price: number | null\r\n  created_at: string\r\n  vehicles?: {\r\n    name: string\r\n    type: string\r\n  }\r\n  deal_memberships: any[]\r\n}\r\n\r\n/**\r\n * Deals Page for Unified Portal (versotech_main)\r\n *\r\n * Persona-aware deal management:\r\n * - CEO/Staff personas: See all deals (bypass RLS via service client)\r\n * - Other personas (arranger, investor, etc.): See deals they're members of\r\n */\r\nexport default async function DealsPage() {\r\n  const clientSupabase = await createClient()\r\n  const { data: { user }, error: userError } = await clientSupabase.auth.getUser()\r\n\r\n  if (!user || userError) {\r\n    return (\r\n      <div className=\"p-6\">\r\n        <div className=\"text-center py-16\">\r\n          <AlertCircle className=\"h-12 w-12 text-gray-400 mx-auto mb-4\" />\r\n          <h3 className=\"text-lg font-medium text-foreground mb-2\">\r\n            Authentication Required\r\n          </h3>\r\n          <p className=\"text-muted-foreground\">\r\n            Please log in to view deals.\r\n          </p>\r\n        </div>\r\n      </div>\r\n    )\r\n  }\r\n\r\n  // Check if user has staff/CEO persona for full access\r\n  const hasStaffAccess = await checkStaffAccess(user.id)\r\n  const serviceSupabase = createServiceClient()\r\n\r\n  let dealsData: Deal[] = []\r\n\r\n  if (hasStaffAccess) {\r\n    // Staff/CEO: Full access to all deals\r\n    const { data: deals } = await serviceSupabase\r\n      .from('deals')\r\n      .select(`\r\n        *,\r\n        vehicles (\r\n          name,\r\n          type\r\n        ),\r\n        deal_memberships (\r\n          user_id,\r\n          role\r\n        )\r\n      `)\r\n      .order('created_at', { ascending: false })\r\n\r\n    dealsData = deals || []\r\n  } else {\r\n    // Other personas: Only deals they're members of\r\n    const { data: deals } = await serviceSupabase\r\n      .from('deals')\r\n      .select(`\r\n        *,\r\n        vehicles (\r\n          name,\r\n          type\r\n        ),\r\n        deal_memberships!inner (\r\n          user_id,\r\n          role\r\n        )\r\n      `)\r\n      .eq('deal_memberships.user_id', user.id)\r\n      .order('created_at', { ascending: false })\r\n\r\n    dealsData = deals || []\r\n  }\r\n\r\n  // Calculate summary statistics\r\n  const summary = {\r\n    total: dealsData.length,\r\n    open: dealsData.filter(d => d.status === 'open').length,\r\n    draft: dealsData.filter(d => d.status === 'draft').length,\r\n    closed: dealsData.filter(d => d.status === 'closed').length,\r\n    totalValue: dealsData.reduce((sum, deal) => {\r\n      const price = deal.offer_unit_price || 0\r\n      return sum + price * 1000\r\n    }, 0)\r\n  }\r\n\r\n  return (\r\n    <DealsListClient\r\n      deals={dealsData}\r\n      summary={summary}\r\n      basePath=\"/versotech_main\"\r\n    />\r\n  )\r\n}\r\n"],"names":[],"mappings":";;;;;;;AAAA;AACA;AACA;AACA;;;;;;AAEO,MAAM,UAAU;AAwBR,eAAe;IAC5B,MAAM,iBAAiB,MAAM,IAAA,uKAAY;IACzC,MAAM,EAAE,MAAM,EAAE,IAAI,EAAE,EAAE,OAAO,SAAS,EAAE,GAAG,MAAM,eAAe,IAAI,CAAC,OAAO;IAE9E,IAAI,CAAC,QAAQ,WAAW;QACtB,qBACE,qQAAC;YAAI,WAAU;sBACb,cAAA,qQAAC;gBAAI,WAAU;;kCACb,qQAAC,0PAAW;wBAAC,WAAU;;;;;;kCACvB,qQAAC;wBAAG,WAAU;kCAA2C;;;;;;kCAGzD,qQAAC;wBAAE,WAAU;kCAAwB;;;;;;;;;;;;;;;;;IAM7C;IAEA,sDAAsD;IACtD,MAAM,iBAAiB,MAAM,IAAA,6JAAgB,EAAC,KAAK,EAAE;IACrD,MAAM,kBAAkB,IAAA,8KAAmB;IAE3C,IAAI,YAAoB,EAAE;IAE1B,IAAI,gBAAgB;QAClB,sCAAsC;QACtC,MAAM,EAAE,MAAM,KAAK,EAAE,GAAG,MAAM,gBAC3B,IAAI,CAAC,SACL,MAAM,CAAC,CAAC;;;;;;;;;;MAUT,CAAC,EACA,KAAK,CAAC,cAAc;YAAE,WAAW;QAAM;QAE1C,YAAY,SAAS,EAAE;IACzB,OAAO;QACL,gDAAgD;QAChD,MAAM,EAAE,MAAM,KAAK,EAAE,GAAG,MAAM,gBAC3B,IAAI,CAAC,SACL,MAAM,CAAC,CAAC;;;;;;;;;;MAUT,CAAC,EACA,EAAE,CAAC,4BAA4B,KAAK,EAAE,EACtC,KAAK,CAAC,cAAc;YAAE,WAAW;QAAM;QAE1C,YAAY,SAAS,EAAE;IACzB;IAEA,+BAA+B;IAC/B,MAAM,UAAU;QACd,OAAO,UAAU,MAAM;QACvB,MAAM,UAAU,MAAM,CAAC,CAAA,IAAK,EAAE,MAAM,KAAK,QAAQ,MAAM;QACvD,OAAO,UAAU,MAAM,CAAC,CAAA,IAAK,EAAE,MAAM,KAAK,SAAS,MAAM;QACzD,QAAQ,UAAU,MAAM,CAAC,CAAA,IAAK,EAAE,MAAM,KAAK,UAAU,MAAM;QAC3D,YAAY,UAAU,MAAM,CAAC,CAAC,KAAK;YACjC,MAAM,QAAQ,KAAK,gBAAgB,IAAI;YACvC,OAAO,MAAM,QAAQ;QACvB,GAAG;IACL;IAEA,qBACE,qQAAC,gMAAe;QACd,OAAO;QACP,SAAS;QACT,UAAS;;;;;;AAGf"}}]
}