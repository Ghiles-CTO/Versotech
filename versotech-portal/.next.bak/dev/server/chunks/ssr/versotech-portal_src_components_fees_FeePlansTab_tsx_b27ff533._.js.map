{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/ghilesmoussaoui/Desktop/Versotech/versotech-portal/src/components/fees/FeePlansTab.tsx"],"sourcesContent":["/**\r\n * Fee Plans Tab - List and manage fee structures\r\n */\r\n\r\n'use client';\r\n\r\nimport { useEffect, useState, useCallback } from 'react';\r\nimport { useRouter, useSearchParams } from 'next/navigation';\r\nimport {\r\n  Select,\r\n  SelectContent,\r\n  SelectItem,\r\n  SelectTrigger,\r\n  SelectValue,\r\n} from '@/components/ui/select';\r\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Badge } from '@/components/ui/badge';\r\nimport {\r\n  Table,\r\n  TableBody,\r\n  TableCell,\r\n  TableHead,\r\n  TableHeader,\r\n  TableRow,\r\n} from '@/components/ui/table';\r\nimport {\r\n  AlertDialog,\r\n  AlertDialogAction,\r\n  AlertDialogCancel,\r\n  AlertDialogContent,\r\n  AlertDialogDescription,\r\n  AlertDialogFooter,\r\n  AlertDialogHeader,\r\n  AlertDialogTitle,\r\n} from '@/components/ui/alert-dialog';\r\nimport { Plus, Edit, Copy, FileText, Building2, Trash2, Users, Briefcase, FileCheck, AlertTriangle, ChevronDown, ChevronRight, CheckCircle, Clock, XCircle, Send, FileSignature, Loader2, Eye, Download, Building } from 'lucide-react';\r\nimport { toast } from 'sonner';\r\nimport { Collapsible, CollapsibleContent, CollapsibleTrigger } from '@/components/ui/collapsible';\r\nimport { Tooltip, TooltipContent, TooltipProvider, TooltipTrigger } from '@/components/ui/tooltip';\r\nimport type { FeePlanWithComponents } from '@/lib/fees/types';\r\nimport { formatBps } from '@/lib/fees/calculations';\r\nimport FeePlanEditModal from './FeePlanEditModal';\r\n\r\ninterface FeePlanWithDeal extends FeePlanWithComponents {\r\n  deal?: {\r\n    id: string;\r\n    name: string;\r\n  };\r\n  term_sheet?: {\r\n    id: string;\r\n    version: number;\r\n    status: string;\r\n    subscription_fee_percent?: number | null;\r\n    management_fee_percent?: number | null;\r\n    carried_interest_percent?: number | null;\r\n  } | null;\r\n  introducer?: {\r\n    id: string;\r\n    legal_name: string;\r\n  } | null;\r\n  partner?: {\r\n    id: string;\r\n    name: string;\r\n  } | null;\r\n  commercial_partner?: {\r\n    id: string;\r\n    name: string;\r\n  } | null;\r\n  introducer_agreement?: {\r\n    id: string;\r\n    reference_number: string | null;\r\n    status: string;\r\n    pdf_url: string | null;\r\n  } | null;\r\n  placement_agreement?: {\r\n    id: string;\r\n    reference_number: string | null;\r\n    status: string;\r\n    pdf_url: string | null;\r\n  } | null;\r\n  subscription_count?: number;\r\n  status?: string;\r\n}\r\n\r\n// Map fee component kinds to term sheet fields\r\nconst componentToTermSheetField: Record<string, 'subscription_fee_percent' | 'management_fee_percent' | 'carried_interest_percent'> = {\r\n  subscription: 'subscription_fee_percent',\r\n  management: 'management_fee_percent',\r\n  performance: 'carried_interest_percent',\r\n  carried_interest: 'carried_interest_percent',\r\n};\r\n\r\n// Check if a fee component exceeds term sheet limits\r\nfunction getComponentValidation(\r\n  component: { kind: string; rate_bps?: number | null },\r\n  termSheet?: FeePlanWithDeal['term_sheet']\r\n): { isValid: boolean; message?: string; termSheetLimit?: number } {\r\n  if (!termSheet || !component.rate_bps) {\r\n    return { isValid: true };\r\n  }\r\n\r\n  const fieldName = componentToTermSheetField[component.kind];\r\n  if (!fieldName) {\r\n    return { isValid: true };\r\n  }\r\n\r\n  const termSheetLimit = termSheet[fieldName];\r\n  if (termSheetLimit === null || termSheetLimit === undefined) {\r\n    return { isValid: true };\r\n  }\r\n\r\n  // Convert rate_bps to percent (100 bps = 1%)\r\n  const componentPercent = component.rate_bps / 100;\r\n\r\n  if (componentPercent > termSheetLimit) {\r\n    return {\r\n      isValid: false,\r\n      message: `Exceeds term sheet limit (${termSheetLimit}%)`,\r\n      termSheetLimit,\r\n    };\r\n  }\r\n\r\n  return { isValid: true, termSheetLimit };\r\n}\r\n\r\nconst feePlanStatusStyles: Record<string, string> = {\r\n  draft: 'bg-slate-500/20 text-slate-400',\r\n  sent: 'bg-blue-500/20 text-blue-400',\r\n  pending_signature: 'bg-purple-500/20 text-purple-400',\r\n  accepted: 'bg-green-500/20 text-green-400',\r\n  rejected: 'bg-red-500/20 text-red-400',\r\n};\r\n\r\n// Helper function to render fee plan status badge with consistent styling\r\nfunction getFeePlanStatusBadge(status: string | undefined) {\r\n  const planStatus = status || 'draft';\r\n  switch (planStatus) {\r\n    case 'accepted':\r\n      return (\r\n        <Badge className=\"bg-green-500/20 text-green-400 border-green-500/30\">\r\n          <CheckCircle className=\"h-3 w-3 mr-1\" />\r\n          Accepted\r\n        </Badge>\r\n      );\r\n    case 'sent':\r\n      return (\r\n        <Badge className=\"bg-blue-500/20 text-blue-400 border-blue-500/30\">\r\n          <Send className=\"h-3 w-3 mr-1\" />\r\n          Sent\r\n        </Badge>\r\n      );\r\n    case 'pending_signature':\r\n      return (\r\n        <Badge className=\"bg-amber-500/20 text-amber-400 border-amber-500/30\">\r\n          <Clock className=\"h-3 w-3 mr-1\" />\r\n          Pending Signature\r\n        </Badge>\r\n      );\r\n    case 'rejected':\r\n      return (\r\n        <Badge className=\"bg-red-500/20 text-red-400 border-red-500/30\">\r\n          <XCircle className=\"h-3 w-3 mr-1\" />\r\n          Rejected\r\n        </Badge>\r\n      );\r\n    default:\r\n      return (\r\n        <Badge variant=\"outline\" className=\"border-gray-500/30 text-gray-400\">\r\n          Draft\r\n        </Badge>\r\n      );\r\n  }\r\n}\r\n\r\ninterface Deal {\r\n  id: string;\r\n  name: string;\r\n  status: string;\r\n}\r\n\r\n// Props are now optional - the component manages its own deal selection\r\ninterface FeePlansTabProps {\r\n  // Intentionally empty - deal selection is now internal\r\n}\r\n\r\n// Entity type configuration for grouping fee plans\r\ntype EntityGroup = 'introducers' | 'partners' | 'commercial_partners';\r\nconst entityGroupConfig: Record<EntityGroup, { label: string; icon: typeof Users; iconColor: string }> = {\r\n  introducers: { label: 'Introducers', icon: Users, iconColor: 'text-blue-400' },\r\n  partners: { label: 'Partners', icon: Briefcase, iconColor: 'text-purple-400' },\r\n  commercial_partners: { label: 'Commercial Partners', icon: Building2, iconColor: 'text-green-400' },\r\n};\r\n\r\n// Helper to group fee plans by entity type\r\nfunction groupPlansByEntityType(plans: FeePlanWithDeal[]): Record<EntityGroup, FeePlanWithDeal[]> {\r\n  const groups: Record<EntityGroup, FeePlanWithDeal[]> = {\r\n    introducers: [],\r\n    partners: [],\r\n    commercial_partners: [],\r\n  };\r\n\r\n  for (const plan of plans) {\r\n    if (plan.introducer) {\r\n      groups.introducers.push(plan);\r\n    } else if (plan.partner) {\r\n      groups.partners.push(plan);\r\n    } else if (plan.commercial_partner) {\r\n      groups.commercial_partners.push(plan);\r\n    }\r\n    // Plans without an entity are not shown in grouped view\r\n  }\r\n\r\n  return groups;\r\n}\r\n\r\nexport default function FeePlansTab({}: FeePlansTabProps) {\r\n  const router = useRouter();\r\n  const searchParams = useSearchParams();\r\n\r\n  // Deal selection state (managed internally)\r\n  const [deals, setDeals] = useState<Deal[]>([]);\r\n  const [loadingDeals, setLoadingDeals] = useState(true);\r\n  const dealId = searchParams.get('deal_id') || undefined;\r\n\r\n  const [plans, setPlans] = useState<FeePlanWithDeal[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [viewMode, setViewMode] = useState<'table' | 'cards'>('table');\r\n  const [editModalOpen, setEditModalOpen] = useState(false);\r\n  const [selectedPlan, setSelectedPlan] = useState<FeePlanWithDeal | null>(null);\r\n  const [deleteDialogOpen, setDeleteDialogOpen] = useState(false);\r\n  const [planToDelete, setPlanToDelete] = useState<FeePlanWithDeal | null>(null);\r\n  const [duplicateDialogOpen, setDuplicateDialogOpen] = useState(false);\r\n  const [planToDuplicate, setPlanToDuplicate] = useState<FeePlanWithDeal | null>(null);\r\n  const [expandedGroups, setExpandedGroups] = useState<Record<EntityGroup, boolean>>({\r\n    introducers: true,\r\n    partners: true,\r\n    commercial_partners: true,\r\n  });\r\n  const [generatingAgreement, setGeneratingAgreement] = useState<string | null>(null);\r\n  const [downloadingPdf, setDownloadingPdf] = useState<string | null>(null);\r\n\r\n  // Fetch deals for the selector\r\n  const fetchDeals = useCallback(async () => {\r\n    try {\r\n      const res = await fetch('/api/deals');\r\n      const data = await res.json();\r\n      setDeals(data.deals || []);\r\n    } catch (error) {\r\n      console.error('Error fetching deals:', error);\r\n    } finally {\r\n      setLoadingDeals(false);\r\n    }\r\n  }, []);\r\n\r\n  // Handle deal selection change - updates URL for deep linking\r\n  const handleDealChange = (selectedDealId: string) => {\r\n    const params = new URLSearchParams(searchParams.toString());\r\n\r\n    if (selectedDealId === 'none') {\r\n      params.delete('deal_id');\r\n    } else {\r\n      params.set('deal_id', selectedDealId);\r\n    }\r\n\r\n    router.push(`/versotech_main/fees?${params.toString()}`);\r\n  };\r\n\r\n  useEffect(() => {\r\n    fetchDeals();\r\n  }, [fetchDeals]);\r\n\r\n  useEffect(() => {\r\n    fetchPlans();\r\n  }, [dealId]);\r\n\r\n  const fetchPlans = async () => {\r\n    setLoading(true);\r\n    try {\r\n      // Build API URL with deal filter if provided\r\n      const plansUrl = dealId\r\n        ? `/api/staff/fees/plans?include_components=true&deal_id=${dealId}`\r\n        : '/api/staff/fees/plans?include_components=true';\r\n\r\n      // Fetch plans and deals in parallel\r\n      const [plansRes, dealsRes] = await Promise.all([\r\n        fetch(plansUrl),\r\n        fetch('/api/deals')\r\n      ]);\r\n\r\n      const [plansJson, dealsJson] = await Promise.all([\r\n        plansRes.json(),\r\n        dealsRes.json()\r\n      ]);\r\n\r\n      let plans = plansJson.data || [];\r\n      const allDeals = dealsJson.deals || [];\r\n      const dealsMap = new Map(allDeals.map((d: any) => [d.id, d]));\r\n\r\n      // Filter plans by deal_id on client side as fallback (if API doesn't support filtering)\r\n      if (dealId) {\r\n        plans = plans.filter((plan: any) => plan.deal_id === dealId);\r\n      }\r\n\r\n      // Map deals to plans\r\n      const plansWithDeals = plans.map((plan: any) => ({\r\n        ...plan,\r\n        deal: plan.deal_id ? dealsMap.get(plan.deal_id) : undefined,\r\n      }));\r\n\r\n      setPlans(plansWithDeals);\r\n    } catch (error) {\r\n      console.error('Error fetching fee plans:', error);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleDuplicateClick = (plan: FeePlanWithDeal) => {\r\n    setPlanToDuplicate(plan);\r\n    setDuplicateDialogOpen(true);\r\n  };\r\n\r\n  const handleDuplicateConfirm = async () => {\r\n    if (!planToDuplicate) return;\r\n\r\n    try {\r\n      const res = await fetch(`/api/staff/fees/plans/${planToDuplicate.id}/duplicate`, {\r\n        method: 'POST',\r\n      });\r\n      if (res.ok) {\r\n        const { data: duplicatedPlan } = await res.json();\r\n        await fetchPlans();\r\n        setDuplicateDialogOpen(false);\r\n        setPlanToDuplicate(null);\r\n\r\n        // Open edit modal for the new plan\r\n        if (duplicatedPlan) {\r\n          setSelectedPlan(duplicatedPlan);\r\n          setEditModalOpen(true);\r\n        }\r\n      }\r\n    } catch (error) {\r\n      console.error('Error duplicating plan:', error);\r\n    }\r\n  };\r\n\r\n  const handleCreateNew = () => {\r\n    setSelectedPlan(null);\r\n    setEditModalOpen(true);\r\n  };\r\n\r\n  const handleEdit = (plan: FeePlanWithDeal) => {\r\n    setSelectedPlan(plan);\r\n    setEditModalOpen(true);\r\n  };\r\n\r\n  const handleModalClose = () => {\r\n    setEditModalOpen(false);\r\n    setSelectedPlan(null);\r\n  };\r\n\r\n  const handleModalSuccess = () => {\r\n    fetchPlans();\r\n    handleModalClose();\r\n  };\r\n\r\n  const handleDeleteClick = (plan: FeePlanWithDeal) => {\r\n    setPlanToDelete(plan);\r\n    setDeleteDialogOpen(true);\r\n  };\r\n\r\n  const handleDeleteConfirm = async () => {\r\n    if (!planToDelete) return;\r\n\r\n    try {\r\n      const res = await fetch(`/api/staff/fees/plans/${planToDelete.id}`, {\r\n        method: 'DELETE',\r\n      });\r\n      if (res.ok) {\r\n        fetchPlans();\r\n        setDeleteDialogOpen(false);\r\n        setPlanToDelete(null);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error deleting plan:', error);\r\n    }\r\n  };\r\n\r\n  const toggleGroup = (group: EntityGroup) => {\r\n    setExpandedGroups((prev) => ({ ...prev, [group]: !prev[group] }));\r\n  };\r\n\r\n  // Check if agreement has been generated for this plan\r\n  const hasGeneratedAgreement = (plan: FeePlanWithDeal) => {\r\n    if (plan.introducer && (plan as any).generated_agreement_id) return true;\r\n    if (plan.partner && (plan as any).generated_placement_agreement_id) return true;\r\n    return false;\r\n  };\r\n\r\n  // Check if this plan can have an agreement generated\r\n  const canGenerateAgreement = (plan: FeePlanWithDeal) => {\r\n    // Introducers: need introducer and no existing agreement\r\n    if (plan.introducer && !(plan as any).generated_agreement_id) return true;\r\n    // Partners: need partner and no existing placement agreement\r\n    if (plan.partner && !(plan as any).generated_placement_agreement_id) return true;\r\n    return false;\r\n  };\r\n\r\n  // Get appropriate tooltip for generate button\r\n  const getGenerateTooltip = (plan: FeePlanWithDeal) => {\r\n    if (plan.introducer) return 'Generate Introducer Agreement';\r\n    if (plan.partner) return 'Generate Placement Agreement';\r\n    return '';\r\n  };\r\n\r\n  // Generate Introducer Agreement\r\n  const handleGenerateIntroducerAgreement = async (plan: FeePlanWithDeal) => {\r\n    if (!plan.introducer) return;\r\n\r\n    setGeneratingAgreement(plan.id);\r\n    try {\r\n      const res = await fetch(`/api/staff/fees/plans/${plan.id}/generate-agreement`, {\r\n        method: 'POST',\r\n      });\r\n\r\n      if (!res.ok) {\r\n        const data = await res.json();\r\n        toast.error(`Failed to generate agreement: ${data.error || 'Unknown error'}`);\r\n        return;\r\n      }\r\n\r\n      toast.success('Introducer Agreement generated successfully!');\r\n      fetchPlans();\r\n    } catch (error) {\r\n      console.error('Error generating introducer agreement:', error);\r\n      toast.error('Failed to generate agreement');\r\n    } finally {\r\n      setGeneratingAgreement(null);\r\n    }\r\n  };\r\n\r\n  // Generate Partner Placement Agreement\r\n  const handleGeneratePartnerAgreement = async (plan: FeePlanWithDeal) => {\r\n    if (!plan.partner) return;\r\n\r\n    setGeneratingAgreement(plan.id);\r\n    try {\r\n      const res = await fetch(`/api/staff/fees/plans/${plan.id}/generate-placement-agreement`, {\r\n        method: 'POST',\r\n      });\r\n\r\n      if (!res.ok) {\r\n        const data = await res.json();\r\n        toast.error(`Failed to generate placement agreement: ${data.error || 'Unknown error'}`);\r\n        return;\r\n      }\r\n\r\n      toast.success('Placement Agreement generated successfully!');\r\n      fetchPlans();\r\n    } catch (error) {\r\n      console.error('Error generating placement agreement:', error);\r\n      toast.error('Failed to generate placement agreement');\r\n    } finally {\r\n      setGeneratingAgreement(null);\r\n    }\r\n  };\r\n\r\n  // Unified handler that routes to correct agreement type\r\n  const handleGenerateAgreement = async (plan: FeePlanWithDeal) => {\r\n    if (plan.introducer) {\r\n      await handleGenerateIntroducerAgreement(plan);\r\n    } else if (plan.partner) {\r\n      await handleGeneratePartnerAgreement(plan);\r\n    }\r\n  };\r\n\r\n  // Get PDF URL from agreement (introducer or placement)\r\n  const getAgreementPdfInfo = (plan: FeePlanWithDeal): { pdfUrl: string | null; referenceNumber: string | null } => {\r\n    if (plan.introducer_agreement?.pdf_url) {\r\n      return {\r\n        pdfUrl: plan.introducer_agreement.pdf_url,\r\n        referenceNumber: plan.introducer_agreement.reference_number\r\n      };\r\n    }\r\n    if (plan.placement_agreement?.pdf_url) {\r\n      return {\r\n        pdfUrl: plan.placement_agreement.pdf_url,\r\n        referenceNumber: plan.placement_agreement.reference_number\r\n      };\r\n    }\r\n    return { pdfUrl: null, referenceNumber: null };\r\n  };\r\n\r\n  // Handle PDF download from Supabase storage\r\n  const handleDownloadPdf = async (pdfUrl: string, referenceNumber: string | null) => {\r\n    setDownloadingPdf(pdfUrl);\r\n    try {\r\n      const response = await fetch(`/api/storage/download?path=${encodeURIComponent(pdfUrl)}&bucket=deal-documents`);\r\n      if (!response.ok) {\r\n        throw new Error('Failed to download file');\r\n      }\r\n      const blob = await response.blob();\r\n      const url = window.URL.createObjectURL(blob);\r\n      const link = document.createElement('a');\r\n      link.href = url;\r\n      // Extract actual filename from storage path, or fall back to reference number\r\n      const actualFilename = pdfUrl.split('/').pop() || `${referenceNumber || 'agreement'}.pdf`;\r\n      link.download = actualFilename;\r\n      document.body.appendChild(link);\r\n      link.click();\r\n      document.body.removeChild(link);\r\n      window.URL.revokeObjectURL(url);\r\n      toast.success('PDF downloaded successfully');\r\n    } catch (error) {\r\n      console.error('Error downloading PDF:', error);\r\n      toast.error('Failed to download PDF');\r\n    } finally {\r\n      setDownloadingPdf(null);\r\n    }\r\n  };\r\n\r\n  // Handle PDF preview in new tab\r\n  const handlePreviewPdf = async (pdfUrl: string) => {\r\n    try {\r\n      const response = await fetch(`/api/storage/download?path=${encodeURIComponent(pdfUrl)}&bucket=deal-documents`);\r\n      if (!response.ok) {\r\n        throw new Error('Failed to load file');\r\n      }\r\n      const blob = await response.blob();\r\n      const url = window.URL.createObjectURL(blob);\r\n      window.open(url, '_blank');\r\n    } catch (error) {\r\n      console.error('Error previewing PDF:', error);\r\n      toast.error('Failed to preview PDF');\r\n    }\r\n  };\r\n\r\n  // Group plans by entity type for the grouped view\r\n  const groupedPlans = groupPlansByEntityType(plans);\r\n\r\n  if (loading) {\r\n    return <div className=\"text-white\">Loading fee plans...</div>;\r\n  }\r\n\r\n  // Get selected deal info for display\r\n  const selectedDeal = deals.find((d) => d.id === dealId);\r\n\r\n  // Deal selector component (reused in both views)\r\n  const DealSelector = () => (\r\n    <div className=\"flex items-center gap-4\">\r\n      <div className=\"flex items-center gap-2\">\r\n        <Building2 className=\"h-5 w-5 text-muted-foreground\" />\r\n        <span className=\"text-sm font-medium\">Deal:</span>\r\n      </div>\r\n      <Select\r\n        value={dealId || 'none'}\r\n        onValueChange={handleDealChange}\r\n        disabled={loadingDeals}\r\n      >\r\n        <SelectTrigger className=\"w-[350px]\">\r\n          {loadingDeals ? (\r\n            <div className=\"flex items-center gap-2\">\r\n              <Loader2 className=\"h-4 w-4 animate-spin\" />\r\n              <span>Loading deals...</span>\r\n            </div>\r\n          ) : (\r\n            <SelectValue placeholder=\"Select a deal to view fee plans\" />\r\n          )}\r\n        </SelectTrigger>\r\n        <SelectContent>\r\n          <SelectItem value=\"none\">\r\n            <span className=\"text-muted-foreground\">Select a deal to view fee plans</span>\r\n          </SelectItem>\r\n          {deals.map((deal) => (\r\n            <SelectItem key={deal.id} value={deal.id}>\r\n              <div className=\"flex items-center gap-2\">\r\n                <span>{deal.name}</span>\r\n                <span className=\"text-xs text-muted-foreground capitalize\">\r\n                  ({deal.status})\r\n                </span>\r\n              </div>\r\n            </SelectItem>\r\n          ))}\r\n        </SelectContent>\r\n      </Select>\r\n      {selectedDeal && (\r\n        <span className=\"text-sm text-muted-foreground\">\r\n          Viewing fee plans for: <strong>{selectedDeal.name}</strong>\r\n        </span>\r\n      )}\r\n    </div>\r\n  );\r\n\r\n  // Show prompt if no deal is selected\r\n  if (!dealId) {\r\n    return (\r\n      <div className=\"space-y-6\">\r\n        <div className=\"flex items-center justify-between\">\r\n          <div>\r\n            <h2 className=\"text-2xl font-bold text-white\">Fee Plans</h2>\r\n            <p className=\"text-gray-400\">\r\n              Manage fee structure templates for a specific deal\r\n            </p>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Deal Selector */}\r\n        <DealSelector />\r\n\r\n        <Card>\r\n          <CardContent className=\"py-10 text-center\">\r\n            <Building2 className=\"h-12 w-12 text-muted-foreground mx-auto mb-4\" />\r\n            <h3 className=\"text-lg font-medium text-foreground mb-2\">Select a deal to view fee plans</h3>\r\n            <p className=\"text-muted-foreground\">\r\n              Use the deal selector above to choose a deal and view its associated fee plans.\r\n            </p>\r\n          </CardContent>\r\n        </Card>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      <div className=\"flex items-center justify-between\">\r\n        <div>\r\n          <h2 className=\"text-2xl font-bold text-white\">Fee Plans</h2>\r\n          <p className=\"text-gray-400\">\r\n            Manage fee structure templates for this deal\r\n          </p>\r\n        </div>\r\n        <div className=\"flex gap-2\">\r\n          <Button variant=\"outline\" onClick={() => setViewMode(viewMode === 'table' ? 'cards' : 'table')}>\r\n            {viewMode === 'table' ? 'Card View' : 'Table View'}\r\n          </Button>\r\n          <Button onClick={handleCreateNew}>\r\n            <Plus className=\"mr-2 h-4 w-4\" />\r\n            Create Fee Plan\r\n          </Button>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Deal Selector */}\r\n      <DealSelector />\r\n\r\n      {/* Explanation Card */}\r\n      <Card className=\"bg-blue-500/10 border-blue-500/30\">\r\n        <CardContent className=\"pt-6\">\r\n          <p className=\"text-sm text-gray-300 leading-relaxed\">\r\n            <strong className=\"text-blue-400\">How Fee Plans Work:</strong> Fee plans are commercial agreements with introducers/partners.\r\n            Each fee plan must be linked to a <strong>published term sheet</strong> and an <strong>entity</strong> (introducer, partner, or commercial partner).\r\n            Fee values cannot exceed the limits set in the term sheet. When an entity accepts a fee plan, investors can be dispatched through them.\r\n          </p>\r\n        </CardContent>\r\n      </Card>\r\n\r\n      {plans.length === 0 ? (\r\n        <Card>\r\n          <CardContent className=\"py-10 text-center\">\r\n            <p className=\"text-gray-400 mb-4\">No fee plans created yet</p>\r\n            <Button onClick={handleCreateNew}>\r\n              <Plus className=\"mr-2 h-4 w-4\" />\r\n              Create Your First Fee Plan\r\n            </Button>\r\n          </CardContent>\r\n        </Card>\r\n      ) : (\r\n        <div className=\"space-y-4\">\r\n          {/* Grouped Fee Plans by Entity Type */}\r\n          {(Object.entries(entityGroupConfig) as [EntityGroup, typeof entityGroupConfig[EntityGroup]][]).map(\r\n            ([groupKey, config]) => {\r\n              const GroupIcon = config.icon;\r\n              const groupPlans = groupedPlans[groupKey];\r\n              const isExpanded = expandedGroups[groupKey];\r\n\r\n              return (\r\n                <Collapsible\r\n                  key={groupKey}\r\n                  open={isExpanded}\r\n                  onOpenChange={() => toggleGroup(groupKey)}\r\n                >\r\n                  <Card>\r\n                    <CollapsibleTrigger asChild>\r\n                      <CardHeader className=\"cursor-pointer hover:bg-white/5 transition-colors\">\r\n                        <div className=\"flex items-center justify-between\">\r\n                          <div className=\"flex items-center gap-3\">\r\n                            <GroupIcon className={`h-5 w-5 ${config.iconColor}`} />\r\n                            <CardTitle className=\"text-lg\">\r\n                              {config.label} ({groupPlans.length})\r\n                            </CardTitle>\r\n                          </div>\r\n                          {isExpanded ? (\r\n                            <ChevronDown className=\"h-5 w-5 text-muted-foreground\" />\r\n                          ) : (\r\n                            <ChevronRight className=\"h-5 w-5 text-muted-foreground\" />\r\n                          )}\r\n                        </div>\r\n                      </CardHeader>\r\n                    </CollapsibleTrigger>\r\n                    <CollapsibleContent>\r\n                      <CardContent className=\"pt-0\">\r\n                        {groupPlans.length === 0 ? (\r\n                          <div className=\"py-6 text-center text-muted-foreground\">\r\n                            No fee plans\r\n                          </div>\r\n                        ) : viewMode === 'table' ? (\r\n                          <Table>\r\n                            <TableHeader>\r\n                              <TableRow>\r\n                                <TableHead>Plan Name</TableHead>\r\n                                <TableHead>Entity</TableHead>\r\n                                <TableHead>Term Sheet</TableHead>\r\n                                <TableHead>Fee Components</TableHead>\r\n                                <TableHead>Status</TableHead>\r\n                                <TableHead className=\"text-right\">Actions</TableHead>\r\n                              </TableRow>\r\n                            </TableHeader>\r\n                            <TableBody>\r\n                              {groupPlans.map((plan) => (\r\n                                <TableRow key={plan.id}>\r\n                                  <TableCell>\r\n                                    <div className=\"flex items-center gap-2\">\r\n                                      <FileText className=\"h-4 w-4 text-muted-foreground\" />\r\n                                      <div>\r\n                                        <div className=\"font-medium\">{plan.name}</div>\r\n                                        {plan.description && (\r\n                                          <div className=\"text-sm text-muted-foreground\">\r\n                                            {plan.description}\r\n                                          </div>\r\n                                        )}\r\n                                      </div>\r\n                                    </div>\r\n                                  </TableCell>\r\n                                  <TableCell>\r\n                                    <div className=\"flex items-center gap-2\">\r\n                                      <GroupIcon className={`h-4 w-4 ${config.iconColor}`} />\r\n                                      <span>\r\n                                        {plan.introducer?.legal_name ||\r\n                                          plan.partner?.name ||\r\n                                          plan.commercial_partner?.name}\r\n                                      </span>\r\n                                    </div>\r\n                                  </TableCell>\r\n                                  <TableCell>\r\n                                    {plan.term_sheet ? (\r\n                                      <div className=\"flex items-center gap-2\">\r\n                                        <FileCheck className=\"h-3 w-3 text-muted-foreground\" />\r\n                                        <span className=\"text-sm text-muted-foreground\">\r\n                                          v{plan.term_sheet.version}\r\n                                        </span>\r\n                                      </div>\r\n                                    ) : (\r\n                                      <span className=\"text-sm text-muted-foreground\">\r\n                                        No term sheet\r\n                                      </span>\r\n                                    )}\r\n                                  </TableCell>\r\n                                  <TableCell>\r\n                                    <TooltipProvider>\r\n                                      <div className=\"flex flex-wrap gap-1\">\r\n                                        {plan.components?.map((comp) => {\r\n                                          const validation = getComponentValidation(\r\n                                            comp,\r\n                                            plan.term_sheet\r\n                                          );\r\n                                          return (\r\n                                            <Tooltip key={comp.id}>\r\n                                              <TooltipTrigger asChild>\r\n                                                <Badge\r\n                                                  variant=\"outline\"\r\n                                                  className={`text-xs ${\r\n                                                    !validation.isValid\r\n                                                      ? 'border-red-500/50 bg-red-500/10'\r\n                                                      : ''\r\n                                                  }`}\r\n                                                >\r\n                                                  {!validation.isValid && (\r\n                                                    <AlertTriangle className=\"h-3 w-3 mr-1 text-red-400\" />\r\n                                                  )}\r\n                                                  {comp.kind}:{' '}\r\n                                                  {comp.rate_bps\r\n                                                    ? formatBps(comp.rate_bps)\r\n                                                    : comp.flat_amount\r\n                                                    ? `$${comp.flat_amount}`\r\n                                                    : 'N/A'}\r\n                                                </Badge>\r\n                                              </TooltipTrigger>\r\n                                              {!validation.isValid && (\r\n                                                <TooltipContent className=\"bg-red-900 border-red-700\">\r\n                                                  <p className=\"text-red-200\">\r\n                                                    {validation.message}\r\n                                                  </p>\r\n                                                </TooltipContent>\r\n                                              )}\r\n                                            </Tooltip>\r\n                                          );\r\n                                        })}\r\n                                      </div>\r\n                                    </TooltipProvider>\r\n                                  </TableCell>\r\n                                  <TableCell>\r\n                                    <div className=\"flex flex-wrap gap-1\">\r\n                                      {getFeePlanStatusBadge(plan.status)}\r\n                                    </div>\r\n                                  </TableCell>\r\n                                  <TableCell className=\"text-right\">\r\n                                    <div className=\"flex gap-1 justify-end items-center\">\r\n                                      {/* Generate Agreement button */}\r\n                                      {canGenerateAgreement(plan) && (\r\n                                        <Button\r\n                                          variant=\"ghost\"\r\n                                          size=\"sm\"\r\n                                          onClick={() => handleGenerateAgreement(plan)}\r\n                                          disabled={generatingAgreement === plan.id}\r\n                                          className=\"text-green-400 hover:text-green-300\"\r\n                                          title={getGenerateTooltip(plan)}\r\n                                        >\r\n                                          {generatingAgreement === plan.id ? (\r\n                                            <Loader2 className=\"h-4 w-4 animate-spin\" />\r\n                                          ) : (\r\n                                            <FileSignature className=\"h-4 w-4\" />\r\n                                          )}\r\n                                        </Button>\r\n                                      )}\r\n                                      {hasGeneratedAgreement(plan) && (\r\n                                        <Badge className=\"bg-green-500/20 text-green-400 border-green-500/30 text-xs\">\r\n                                          Agreement\r\n                                        </Badge>\r\n                                      )}\r\n                                      {/* PDF Preview/Download buttons */}\r\n                                      {(() => {\r\n                                        const { pdfUrl, referenceNumber } = getAgreementPdfInfo(plan);\r\n                                        if (!pdfUrl) return null;\r\n                                        return (\r\n                                          <>\r\n                                            <Button\r\n                                              variant=\"ghost\"\r\n                                              size=\"sm\"\r\n                                              onClick={() => handlePreviewPdf(pdfUrl)}\r\n                                              className=\"text-blue-400 hover:text-blue-300\"\r\n                                              title=\"Preview PDF\"\r\n                                            >\r\n                                              <Eye className=\"h-4 w-4\" />\r\n                                            </Button>\r\n                                            <Button\r\n                                              variant=\"ghost\"\r\n                                              size=\"sm\"\r\n                                              onClick={() => handleDownloadPdf(pdfUrl, referenceNumber)}\r\n                                              disabled={downloadingPdf === pdfUrl}\r\n                                              className=\"text-green-400 hover:text-green-300\"\r\n                                              title=\"Download PDF\"\r\n                                            >\r\n                                              {downloadingPdf === pdfUrl ? (\r\n                                                <Loader2 className=\"h-4 w-4 animate-spin\" />\r\n                                              ) : (\r\n                                                <Download className=\"h-4 w-4\" />\r\n                                              )}\r\n                                            </Button>\r\n                                          </>\r\n                                        );\r\n                                      })()}\r\n                                      <Button\r\n                                        variant=\"ghost\"\r\n                                        size=\"sm\"\r\n                                        onClick={() => handleEdit(plan)}\r\n                                      >\r\n                                        <Edit className=\"h-4 w-4\" />\r\n                                      </Button>\r\n                                      <Button\r\n                                        variant=\"ghost\"\r\n                                        size=\"sm\"\r\n                                        onClick={() => handleDuplicateClick(plan)}\r\n                                      >\r\n                                        <Copy className=\"h-4 w-4\" />\r\n                                      </Button>\r\n                                      <Button\r\n                                        variant=\"ghost\"\r\n                                        size=\"sm\"\r\n                                        onClick={() => handleDeleteClick(plan)}\r\n                                      >\r\n                                        <Trash2 className=\"h-4 w-4 text-red-500\" />\r\n                                      </Button>\r\n                                    </div>\r\n                                  </TableCell>\r\n                                </TableRow>\r\n                              ))}\r\n                            </TableBody>\r\n                          </Table>\r\n                        ) : (\r\n                          <div className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-3\">\r\n                            {groupPlans.map((plan) => (\r\n                              <Card key={plan.id} className=\"bg-white/5 border-white/10\">\r\n                                <CardHeader className=\"pb-2\">\r\n                                  <div className=\"flex items-start justify-between\">\r\n                                    <div className=\"flex-1\">\r\n                                      <div className=\"flex items-center gap-2 mb-1\">\r\n                                        <CardTitle className=\"text-lg\">{plan.name}</CardTitle>\r\n                                        {getFeePlanStatusBadge(plan.status)}\r\n                                      </div>\r\n                                      <div className=\"flex items-center gap-2 text-sm text-muted-foreground\">\r\n                                        <GroupIcon className={`h-4 w-4 ${config.iconColor}`} />\r\n                                        <span>\r\n                                          {plan.introducer?.legal_name ||\r\n                                            plan.partner?.name ||\r\n                                            plan.commercial_partner?.name}\r\n                                        </span>\r\n                                      </div>\r\n                                    </div>\r\n                                    <div className=\"flex gap-1 items-center\">\r\n                                      {/* Generate Agreement button */}\r\n                                      {canGenerateAgreement(plan) && (\r\n                                        <Button\r\n                                          variant=\"ghost\"\r\n                                          size=\"icon\"\r\n                                          onClick={() => handleGenerateAgreement(plan)}\r\n                                          disabled={generatingAgreement === plan.id}\r\n                                          className=\"text-green-400 hover:text-green-300\"\r\n                                          title={getGenerateTooltip(plan)}\r\n                                        >\r\n                                          {generatingAgreement === plan.id ? (\r\n                                            <Loader2 className=\"h-4 w-4 animate-spin\" />\r\n                                          ) : (\r\n                                            <FileSignature className=\"h-4 w-4\" />\r\n                                          )}\r\n                                        </Button>\r\n                                      )}\r\n                                      {hasGeneratedAgreement(plan) && (\r\n                                        <Badge className=\"bg-green-500/20 text-green-400 border-green-500/30 text-xs\">\r\n                                          Agreement\r\n                                        </Badge>\r\n                                      )}\r\n                                      <Button\r\n                                        variant=\"ghost\"\r\n                                        size=\"icon\"\r\n                                        onClick={() => handleEdit(plan)}\r\n                                      >\r\n                                        <Edit className=\"h-4 w-4\" />\r\n                                      </Button>\r\n                                      <Button\r\n                                        variant=\"ghost\"\r\n                                        size=\"icon\"\r\n                                        onClick={() => handleDuplicateClick(plan)}\r\n                                      >\r\n                                        <Copy className=\"h-4 w-4\" />\r\n                                      </Button>\r\n                                      <Button\r\n                                        variant=\"ghost\"\r\n                                        size=\"icon\"\r\n                                        onClick={() => handleDeleteClick(plan)}\r\n                                      >\r\n                                        <Trash2 className=\"h-4 w-4 text-red-500\" />\r\n                                      </Button>\r\n                                    </div>\r\n                                  </div>\r\n                                </CardHeader>\r\n                                <CardContent>\r\n                                  {plan.description && (\r\n                                    <p className=\"text-sm text-muted-foreground mb-3\">\r\n                                      {plan.description}\r\n                                    </p>\r\n                                  )}\r\n                                  <TooltipProvider>\r\n                                    <div className=\"space-y-2\">\r\n                                      {plan.components?.map((comp) => {\r\n                                        const validation = getComponentValidation(\r\n                                          comp,\r\n                                          plan.term_sheet\r\n                                        );\r\n                                        return (\r\n                                          <div\r\n                                            key={comp.id}\r\n                                            className={`text-sm flex justify-between items-center ${\r\n                                              !validation.isValid ? 'text-red-400' : ''\r\n                                            }`}\r\n                                          >\r\n                                            <span className=\"capitalize flex items-center gap-1\">\r\n                                              {!validation.isValid && (\r\n                                                <Tooltip>\r\n                                                  <TooltipTrigger>\r\n                                                    <AlertTriangle className=\"h-3 w-3 text-red-400\" />\r\n                                                  </TooltipTrigger>\r\n                                                  <TooltipContent className=\"bg-red-900 border-red-700\">\r\n                                                    <p className=\"text-red-200\">\r\n                                                      {validation.message}\r\n                                                    </p>\r\n                                                  </TooltipContent>\r\n                                                </Tooltip>\r\n                                              )}\r\n                                              {comp.kind}\r\n                                            </span>\r\n                                            <span className=\"font-medium\">\r\n                                              {comp.rate_bps\r\n                                                ? formatBps(comp.rate_bps)\r\n                                                : comp.flat_amount\r\n                                                ? `$${comp.flat_amount}`\r\n                                                : 'N/A'}\r\n                                            </span>\r\n                                          </div>\r\n                                        );\r\n                                      })}\r\n                                    </div>\r\n                                  </TooltipProvider>\r\n\r\n                                  {/* Agreement Document Section */}\r\n                                  {(() => {\r\n                                    const { pdfUrl, referenceNumber } = getAgreementPdfInfo(plan);\r\n                                    if (!pdfUrl) return null;\r\n\r\n                                    return (\r\n                                      <div className=\"mt-4 pt-4 border-t border-white/10\">\r\n                                        <div className=\"flex items-center justify-between\">\r\n                                          <div className=\"flex items-center gap-3\">\r\n                                            <div className=\"p-2 rounded-lg bg-green-500/10\">\r\n                                              <FileText className=\"h-5 w-5 text-green-400\" />\r\n                                            </div>\r\n                                            <div>\r\n                                              <p className=\"text-sm font-medium text-foreground\">\r\n                                                {plan.introducer ? 'Introducer Agreement' : 'Placement Agreement'}\r\n                                              </p>\r\n                                              <p className=\"text-xs text-muted-foreground\">\r\n                                                {referenceNumber || 'Document ready'}\r\n                                              </p>\r\n                                            </div>\r\n                                          </div>\r\n                                          <div className=\"flex items-center gap-2\">\r\n                                            <Button\r\n                                              variant=\"outline\"\r\n                                              size=\"sm\"\r\n                                              onClick={() => handlePreviewPdf(pdfUrl)}\r\n                                              className=\"text-blue-400 border-blue-400/30 hover:bg-blue-400/10\"\r\n                                            >\r\n                                              <Eye className=\"h-4 w-4 mr-1\" />\r\n                                              Preview\r\n                                            </Button>\r\n                                            <Button\r\n                                              variant=\"outline\"\r\n                                              size=\"sm\"\r\n                                              onClick={() => handleDownloadPdf(pdfUrl, referenceNumber)}\r\n                                              disabled={downloadingPdf === pdfUrl}\r\n                                              className=\"text-green-400 border-green-400/30 hover:bg-green-400/10\"\r\n                                            >\r\n                                              {downloadingPdf === pdfUrl ? (\r\n                                                <Loader2 className=\"h-4 w-4 mr-1 animate-spin\" />\r\n                                              ) : (\r\n                                                <Download className=\"h-4 w-4 mr-1\" />\r\n                                              )}\r\n                                              Download\r\n                                            </Button>\r\n                                          </div>\r\n                                        </div>\r\n                                      </div>\r\n                                    );\r\n                                  })()}\r\n                                </CardContent>\r\n                              </Card>\r\n                            ))}\r\n                          </div>\r\n                        )}\r\n                      </CardContent>\r\n                    </CollapsibleContent>\r\n                  </Card>\r\n                </Collapsible>\r\n              );\r\n            }\r\n          )}\r\n        </div>\r\n      )}\r\n\r\n      {/* Edit Modal */}\r\n      <FeePlanEditModal\r\n        open={editModalOpen}\r\n        onClose={handleModalClose}\r\n        onSuccess={handleModalSuccess}\r\n        feePlan={selectedPlan}\r\n      />\r\n\r\n      {/* Duplicate Confirmation Dialog */}\r\n      <AlertDialog open={duplicateDialogOpen} onOpenChange={setDuplicateDialogOpen}>\r\n        <AlertDialogContent>\r\n          <AlertDialogHeader>\r\n            <AlertDialogTitle>Duplicate Fee Plan?</AlertDialogTitle>\r\n            <AlertDialogDescription asChild>\r\n              <div className=\"space-y-3\">\r\n                <div>\r\n                  Create a copy of <strong>{planToDuplicate?.name}</strong> with all fee components.\r\n                </div>\r\n                <div>\r\n                  This is useful for:\r\n                </div>\r\n                <ul className=\"list-disc list-inside space-y-1 ml-2\">\r\n                  <li>Creating a similar plan for a new deal</li>\r\n                  <li>Testing modifications without affecting the original</li>\r\n                  <li>Creating variations for special investor terms</li>\r\n                </ul>\r\n                <div className=\"text-muted-foreground\">\r\n                  After duplication, you'll be able to immediately edit the new plan.\r\n                </div>\r\n              </div>\r\n            </AlertDialogDescription>\r\n          </AlertDialogHeader>\r\n          <AlertDialogFooter>\r\n            <AlertDialogCancel>Cancel</AlertDialogCancel>\r\n            <AlertDialogAction onClick={handleDuplicateConfirm}>\r\n              Duplicate & Edit\r\n            </AlertDialogAction>\r\n          </AlertDialogFooter>\r\n        </AlertDialogContent>\r\n      </AlertDialog>\r\n\r\n      {/* Delete Confirmation Dialog */}\r\n      <AlertDialog open={deleteDialogOpen} onOpenChange={setDeleteDialogOpen}>\r\n        <AlertDialogContent>\r\n          <AlertDialogHeader>\r\n            <AlertDialogTitle>Delete Fee Plan?</AlertDialogTitle>\r\n            <AlertDialogDescription asChild>\r\n              <div className=\"space-y-3\">\r\n                <div>\r\n                  Are you sure you want to delete <strong>{planToDelete?.name}</strong>?\r\n                </div>\r\n                {planToDelete && planToDelete.subscription_count && planToDelete.subscription_count > 0 ? (\r\n                  <div className=\"text-yellow-500\">\r\n                     This fee plan is used by {planToDelete.subscription_count} subscription\r\n                    {planToDelete.subscription_count !== 1 ? 's' : ''}. Deleting it won't affect those\r\n                    subscriptions, but you won't be able to apply this plan to new deals.\r\n                  </div>\r\n                ) : (\r\n                  <div>This fee plan is not currently used by any subscriptions.</div>\r\n                )}\r\n                {planToDelete?.is_default && (\r\n                  <div className=\"text-red-500\">\r\n                     This is the default fee plan for {planToDelete?.deal?.name || 'this deal'}.\r\n                    You may want to set another plan as default before deleting this one.\r\n                  </div>\r\n                )}\r\n              </div>\r\n            </AlertDialogDescription>\r\n          </AlertDialogHeader>\r\n          <AlertDialogFooter>\r\n            <AlertDialogCancel>Cancel</AlertDialogCancel>\r\n            <AlertDialogAction\r\n              onClick={handleDeleteConfirm}\r\n              className=\"bg-red-500 hover:bg-red-600\"\r\n            >\r\n              Delete\r\n            </AlertDialogAction>\r\n          </AlertDialogFooter>\r\n        </AlertDialogContent>\r\n      </AlertDialog>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}}]
}