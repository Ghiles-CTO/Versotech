{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 82, "column": 0}, "map": {"version":3,"sources":["file:///Users/ghilesmoussaoui/Desktop/Versotech/versotech-portal/src/lib/supabase/server.ts"],"sourcesContent":["import { createServerClient } from '@supabase/ssr'\nimport { createClient as createSupabaseClient } from '@supabase/supabase-js'\nimport { cookies } from 'next/headers'\n\nexport const createClient = async () => {\n  const cookieStore = await cookies()\n\n  return createServerClient(\n    process.env.NEXT_PUBLIC_SUPABASE_URL!,\n    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,\n    {\n      cookies: {\n        getAll() {\n          return cookieStore.getAll()\n        },\n        setAll(cookiesToSet) {\n          try {\n            cookiesToSet.forEach(({ name, value, options }) => {\n              cookieStore.set(name, value, options)\n            })\n          } catch (error) {\n            // The `setAll` method was called from a Server Component.\n            // This can be ignored if you have middleware refreshing\n            // user sessions.\n          }\n        },\n      },\n    }\n  )\n}\n\n// Server client with service role for admin operations\n// Uses raw supabase-js client which properly bypasses RLS with service role\nexport const createServiceClient = () => {\n  return createSupabaseClient(\n    process.env.NEXT_PUBLIC_SUPABASE_URL!,\n    process.env.SUPABASE_SERVICE_ROLE_KEY!,\n    {\n      auth: {\n        autoRefreshToken: false,\n        persistSession: false,\n      },\n    }\n  )\n}\n"],"names":[],"mappings":";;;;;;AAAA;AAAA;AACA;AACA;;;;AAEO,MAAM,eAAe;IAC1B,MAAM,cAAc,MAAM,IAAA,mKAAO;IAEjC,OAAO,IAAA,wNAAkB,sUAGvB;QACE,SAAS;YACP;gBACE,OAAO,YAAY,MAAM;YAC3B;YACA,QAAO,YAAY;gBACjB,IAAI;oBACF,aAAa,OAAO,CAAC,CAAC,EAAE,IAAI,EAAE,KAAK,EAAE,OAAO,EAAE;wBAC5C,YAAY,GAAG,CAAC,MAAM,OAAO;oBAC/B;gBACF,EAAE,OAAO,OAAO;gBACd,0DAA0D;gBAC1D,wDAAwD;gBACxD,iBAAiB;gBACnB;YACF;QACF;IACF;AAEJ;AAIO,MAAM,sBAAsB;IACjC,OAAO,IAAA,gOAAoB,gFAEzB,QAAQ,GAAG,CAAC,yBAAyB,EACrC;QACE,MAAM;YACJ,kBAAkB;YAClB,gBAAgB;QAClB;IACF;AAEJ"}},
    {"offset": {"line": 128, "column": 0}, "map": {"version":3,"sources":["file:///Users/ghilesmoussaoui/Desktop/Versotech/versotech-portal/src/app/api/deals/%5Bid%5D/activity/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server'\nimport { createClient, createServiceClient } from '@/lib/supabase/server'\n\nexport async function GET(\n  request: NextRequest,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  const { id: dealId } = await params\n\n  const supabase = await createClient()\n  const serviceSupabase = createServiceClient()\n\n  const { data: { user }, error: authError } = await supabase.auth.getUser()\n  if (authError || !user) {\n    return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })\n  }\n\n  const { data: profile } = await supabase\n    .from('profiles')\n    .select('role')\n    .eq('id', user.id)\n    .single()\n\n  if (!profile || !(profile.role.startsWith('staff_') || profile.role === 'ceo')) {\n    return NextResponse.json({ error: 'Staff access required' }, { status: 403 })\n  }\n\n  const since = request.nextUrl.searchParams.get('since') ?? new Date(Date.now() - 90 * 24 * 60 * 60 * 1000).toISOString()\n  const limit = parseInt(request.nextUrl.searchParams.get('limit') ?? '50')\n  const offset = parseInt(request.nextUrl.searchParams.get('offset') ?? '0')\n\n  try {\n    // Fetch deal activity events (conversion events)\n    const { data: activityEvents, error: activityError } = await serviceSupabase\n      .from('deal_activity_events')\n      .select(`\n        id,\n        event_type,\n        payload,\n        occurred_at,\n        investor_id,\n        investors (\n          legal_name,\n          display_name\n        )\n      `)\n      .eq('deal_id', dealId)\n      .gte('occurred_at', since)\n\n    if (activityError) {\n      console.error('Failed to fetch deal activity events', activityError)\n      return NextResponse.json({ error: 'Failed to load activity events', details: activityError.message }, { status: 500 })\n    }\n\n    // Fetch audit logs for this deal\n    const { data: auditLogs, error: auditError } = await serviceSupabase\n      .from('audit_logs')\n      .select('*')\n      .eq('entity_type', 'deals')\n      .eq('entity_id', dealId)\n      .gte('timestamp', since)\n\n    if (auditError) {\n      console.error('Failed to fetch audit logs', auditError)\n    }\n\n    // Fetch interest workflow events\n    const { data: interests, error: interestsError } = await serviceSupabase\n      .from('investor_deal_interest')\n      .select(`\n        id,\n        submitted_at,\n        approved_at,\n        updated_at,\n        status,\n        indicative_amount,\n        investor_id,\n        investors (\n          legal_name,\n          display_name\n        )\n      `)\n      .eq('deal_id', dealId)\n      .gte('submitted_at', since)\n\n    if (interestsError) {\n      console.error('Failed to fetch interests', interestsError)\n    }\n\n    // Fetch subscription workflow events\n    const { data: subscriptions, error: subscriptionsError } = await serviceSupabase\n      .from('deal_subscription_submissions')\n      .select(`\n        id,\n        submitted_at,\n        decided_at,\n        status,\n        payload_json,\n        investor_id,\n        investors (\n          legal_name,\n          display_name\n        ),\n        decided_by_profile:profiles!deal_subscription_submissions_decided_by_fkey (\n          display_name,\n          email,\n          role\n        )\n      `)\n      .eq('deal_id', dealId)\n      .gte('submitted_at', since)\n\n    if (subscriptionsError) {\n      console.error('Failed to fetch subscriptions', subscriptionsError)\n    }\n\n    // Fetch data room access events\n    const { data: dataRoomAccess, error: dataRoomError } = await serviceSupabase\n      .from('deal_data_room_access')\n      .select(`\n        id,\n        granted_at,\n        revoked_at,\n        auto_granted,\n        investor_id,\n        investors (\n          legal_name,\n          display_name\n        ),\n        granted_by_profile:profiles!deal_data_room_access_granted_by_fkey (\n          display_name,\n          email,\n          role\n        ),\n        revoked_by_profile:profiles!deal_data_room_access_revoked_by_fkey (\n          display_name,\n          email,\n          role\n        )\n      `)\n      .eq('deal_id', dealId)\n      .gte('granted_at', since)\n\n    if (dataRoomError) {\n      console.error('Failed to fetch data room access', dataRoomError)\n    }\n\n    // Fetch team member events\n    const { data: members, error: membersError } = await serviceSupabase\n      .from('deal_memberships')\n      .select(`\n        id,\n        invited_at,\n        accepted_at,\n        role,\n        user_id,\n        member_profile:profiles!deal_memberships_user_id_fkey (\n          display_name,\n          email,\n          role\n        ),\n        invited_by_profile:profiles!deal_memberships_invited_by_fkey (\n          display_name,\n          email,\n          role\n        )\n      `)\n      .eq('deal_id', dealId)\n      .gte('invited_at', since)\n\n    if (membersError) {\n      console.error('Failed to fetch members', membersError)\n    }\n\n    // Combine and format all events\n    const allEvents: Array<{\n      id: string\n      timestamp: string\n      type: string\n      category: 'conversion' | 'audit' | 'membership' | 'interest' | 'access' | 'subscription'\n      actor: {\n        name: string | null\n        email: string | null\n        role: string | null\n      }\n      description: string\n      details?: Record<string, any>\n    }> = []\n\n    // Add activity events (basic conversion events)\n    activityEvents?.forEach(event => {\n      const investor = Array.isArray(event.investors) ? event.investors[0] : event.investors\n      const investorName = investor?.legal_name || investor?.display_name || 'Unknown Investor'\n\n      allEvents.push({\n        id: event.id,\n        timestamp: event.occurred_at,\n        type: event.event_type,\n        category: 'conversion',\n        actor: {\n          name: investorName,\n          email: null,\n          role: 'investor'\n        },\n        description: formatActivityEventDescription(event.event_type, investorName),\n        details: event.payload as Record<string, any>\n      })\n    })\n\n    // Add interest workflow events\n    interests?.forEach(interest => {\n      const investor = Array.isArray(interest.investors) ? interest.investors[0] : interest.investors\n      const investorName = investor?.legal_name || investor?.display_name || 'Unknown Investor'\n\n      // Interest submitted\n      if (interest.submitted_at) {\n        allEvents.push({\n          id: `interest-submitted-${interest.id}`,\n          timestamp: interest.submitted_at,\n          type: 'interest_submitted',\n          category: 'interest',\n          actor: {\n            name: investorName,\n            email: null,\n            role: 'investor'\n          },\n          description: `${investorName} submitted interest${interest.indicative_amount ? ` for ${formatAmount(interest.indicative_amount)}` : ''}`,\n          details: {\n            interest_id: interest.id,\n            indicative_amount: interest.indicative_amount,\n            status: interest.status\n          }\n        })\n      }\n\n      // Interest approved\n      if (interest.approved_at && interest.status === 'approved') {\n        allEvents.push({\n          id: `interest-approved-${interest.id}`,\n          timestamp: interest.approved_at,\n          type: 'interest_approved',\n          category: 'interest',\n          actor: {\n            name: 'Staff',\n            email: null,\n            role: 'staff'\n          },\n          description: `Approved interest from ${investorName}${interest.indicative_amount ? ` (${formatAmount(interest.indicative_amount)})` : ''}`,\n          details: {\n            interest_id: interest.id,\n            investor_name: investorName,\n            indicative_amount: interest.indicative_amount\n          }\n        })\n      }\n\n      // Interest rejected (use updated_at as timestamp since rejected_at doesn't exist)\n      if (interest.status === 'rejected' && interest.updated_at) {\n        allEvents.push({\n          id: `interest-rejected-${interest.id}`,\n          timestamp: interest.updated_at,\n          type: 'interest_rejected',\n          category: 'interest',\n          actor: {\n            name: 'Staff',\n            email: null,\n            role: 'staff'\n          },\n          description: `Rejected interest from ${investorName}`,\n          details: {\n            interest_id: interest.id,\n            investor_name: investorName\n          }\n        })\n      }\n    })\n\n    // Add subscription workflow events\n    subscriptions?.forEach(sub => {\n      const investor = Array.isArray(sub.investors) ? sub.investors[0] : sub.investors\n      const investorName = investor?.legal_name || investor?.display_name || 'Unknown Investor'\n      // Extract subscription amount from payload_json if available\n      const payload = sub.payload_json as Record<string, any> | null\n      const subscriptionAmount = payload?.commitment_amount || payload?.subscription_amount || null\n\n      // Subscription submitted\n      if (sub.submitted_at) {\n        allEvents.push({\n          id: `subscription-submitted-${sub.id}`,\n          timestamp: sub.submitted_at,\n          type: 'subscription_submitted',\n          category: 'subscription',\n          actor: {\n            name: investorName,\n            email: null,\n            role: 'investor'\n          },\n          description: `${investorName} submitted subscription${subscriptionAmount ? ` for ${formatAmount(subscriptionAmount)}` : ''}`,\n          details: {\n            subscription_id: sub.id,\n            subscription_amount: subscriptionAmount,\n            status: sub.status\n          }\n        })\n      }\n\n      // Subscription approved/rejected\n      if (sub.decided_at) {\n        const decider = Array.isArray(sub.decided_by_profile)\n          ? sub.decided_by_profile[0]\n          : sub.decided_by_profile\n        const isApproved = sub.status === 'approved'\n        allEvents.push({\n          id: `subscription-${sub.status}-${sub.id}`,\n          timestamp: sub.decided_at,\n          type: `subscription_${sub.status}`,\n          category: 'subscription',\n          actor: {\n            name: decider?.display_name || 'Staff',\n            email: decider?.email || null,\n            role: decider?.role || 'staff'\n          },\n          description: `${isApproved ? 'Approved' : 'Rejected'} subscription from ${investorName}${subscriptionAmount ? ` (${formatAmount(subscriptionAmount)})` : ''}`,\n          details: {\n            subscription_id: sub.id,\n            investor_name: investorName,\n            subscription_amount: subscriptionAmount\n          }\n        })\n      }\n    })\n\n    // Add data room access events\n    dataRoomAccess?.forEach(access => {\n      const investor = Array.isArray(access.investors) ? access.investors[0] : access.investors\n      const investorName = investor?.legal_name || investor?.display_name || 'Unknown Investor'\n\n      // Access granted\n      if (access.granted_at) {\n        const granter = Array.isArray(access.granted_by_profile)\n          ? access.granted_by_profile[0]\n          : access.granted_by_profile\n        const isAutoGranted = access.auto_granted === true\n        allEvents.push({\n          id: `access-granted-${access.id}`,\n          timestamp: access.granted_at,\n          type: 'data_room_granted',\n          category: 'access',\n          actor: {\n            name: granter?.display_name || (isAutoGranted ? 'System' : 'Staff'),\n            email: granter?.email || null,\n            role: granter?.role || (isAutoGranted ? 'system' : 'staff')\n          },\n          description: `${isAutoGranted ? 'Auto-granted' : 'Manually granted'} data room access to ${investorName}`,\n          details: {\n            access_id: access.id,\n            auto_granted: access.auto_granted,\n            investor_name: investorName\n          }\n        })\n      }\n\n      // Access revoked\n      if (access.revoked_at) {\n        const revoker = Array.isArray(access.revoked_by_profile)\n          ? access.revoked_by_profile[0]\n          : access.revoked_by_profile\n        allEvents.push({\n          id: `access-revoked-${access.id}`,\n          timestamp: access.revoked_at,\n          type: 'data_room_revoked',\n          category: 'access',\n          actor: {\n            name: revoker?.display_name || 'Staff',\n            email: revoker?.email || null,\n            role: revoker?.role || 'staff'\n          },\n          description: `Revoked data room access from ${investorName}`,\n          details: {\n            access_id: access.id,\n            investor_name: investorName\n          }\n        })\n      }\n    })\n\n    // Add team member events\n    members?.forEach(member => {\n      const memberProfile = Array.isArray(member.member_profile)\n        ? member.member_profile[0]\n        : member.member_profile\n      const inviter = Array.isArray(member.invited_by_profile)\n        ? member.invited_by_profile[0]\n        : member.invited_by_profile\n      const memberName = memberProfile?.display_name || 'Unknown Member'\n\n      // Member invited/added\n      if (member.invited_at) {\n        allEvents.push({\n          id: `member-added-${member.id}`,\n          timestamp: member.invited_at,\n          type: 'member_added',\n          category: 'membership',\n          actor: {\n            name: inviter?.display_name || 'System',\n            email: inviter?.email || null,\n            role: inviter?.role || 'staff'\n          },\n          description: `Added ${memberName} as ${member.role || 'team member'}`,\n          details: {\n            membership_id: member.id,\n            member_name: memberName,\n            member_role: member.role\n          }\n        })\n      }\n    })\n\n    // Add audit log events\n    auditLogs?.forEach(log => {\n      allEvents.push({\n        id: log.id,\n        timestamp: log.timestamp,\n        type: `${log.action}_${log.event_type}`,\n        category: 'audit',\n        actor: {\n          name: log.actor_name,\n          email: log.actor_email,\n          role: log.actor_role\n        },\n        description: formatAuditLogDescription(log.action, log.event_type, log.actor_name),\n        details: log.action_details as Record<string, any> || {}\n      })\n    })\n\n    // Sort by timestamp (newest first)\n    allEvents.sort((a, b) => new Date(b.timestamp).getTime() - new Date(a.timestamp).getTime())\n\n    // Paginate\n    const paginatedEvents = allEvents.slice(offset, offset + limit)\n\n    return NextResponse.json({\n      deal_id: dealId,\n      since,\n      events: paginatedEvents,\n      total: allEvents.length,\n      limit,\n      offset\n    })\n  } catch (error) {\n    console.error('Failed to fetch deal activity timeline', error)\n    return NextResponse.json({ error: 'Failed to load activity timeline' }, { status: 500 })\n  }\n}\n\nfunction formatAmount(amount: number | string | null): string {\n  if (!amount) return ''\n  const num = typeof amount === 'string' ? parseFloat(amount) : amount\n  return `$${num.toLocaleString('en-US', { maximumFractionDigits: 0 })}`\n}\n\nfunction formatActivityEventDescription(eventType: string, investorName: string): string {\n  const descriptions: Record<string, string> = {\n    // Actual event types in database\n    'im_interested': `${investorName} expressed interest in the deal`,\n    'data_room_submit': `${investorName} submitted subscription documents to data room`,\n\n    // Legacy/future event types\n    'interest_submitted': `${investorName} submitted interest in the deal`,\n    'interest_approved': `Interest from ${investorName} was approved`,\n    'interest_rejected': `Interest from ${investorName} was rejected`,\n    'nda_granted': `${investorName} was granted NDA access`,\n    'nda_completed': `${investorName} completed NDA signing`,\n    'data_room_granted': `${investorName} was granted data room access`,\n    'subscription_started': `${investorName} started subscription process`,\n    'subscription_submitted': `${investorName} submitted subscription documents`,\n    'subscription_approved': `Subscription from ${investorName} was approved`,\n    'allocation_confirmed': `Allocation confirmed for ${investorName}`,\n    'capital_called': `Capital call sent to ${investorName}`,\n    'capital_funded': `${investorName} funded capital call`\n  }\n\n  return descriptions[eventType] || `${investorName} - ${eventType.replace(/_/g, ' ')}`\n}\n\nfunction formatAuditLogDescription(action: string, eventType: string, actorName: string | null): string {\n  const actor = actorName || 'System'\n\n  const descriptions: Record<string, string> = {\n    'create': `${actor} created the deal`,\n    'update': `${actor} updated deal information`,\n    'delete': `${actor} deleted the deal`,\n    'publish': `${actor} published the deal`,\n    'archive': `${actor} archived the deal`,\n    'member_added': `${actor} added a team member`,\n    'member_removed': `${actor} removed a team member`,\n    'term_sheet_published': `${actor} published term sheet`,\n    'allocation_updated': `${actor} updated allocations`\n  }\n\n  const key = eventType ? eventType : action\n  return descriptions[key] || `${actor} performed ${action}`\n}\n"],"names":[],"mappings":"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"}}]
}