{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 82, "column": 0}, "map": {"version":3,"sources":["file:///Users/ghilesmoussaoui/Desktop/Versotech/versotech-portal/src/lib/supabase/server.ts"],"sourcesContent":["import { createServerClient } from '@supabase/ssr'\nimport { createClient as createSupabaseClient } from '@supabase/supabase-js'\nimport { cookies } from 'next/headers'\n\nexport const createClient = async () => {\n  const cookieStore = await cookies()\n\n  return createServerClient(\n    process.env.NEXT_PUBLIC_SUPABASE_URL!,\n    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,\n    {\n      cookies: {\n        getAll() {\n          return cookieStore.getAll()\n        },\n        setAll(cookiesToSet) {\n          try {\n            cookiesToSet.forEach(({ name, value, options }) => {\n              cookieStore.set(name, value, options)\n            })\n          } catch (error) {\n            // The `setAll` method was called from a Server Component.\n            // This can be ignored if you have middleware refreshing\n            // user sessions.\n          }\n        },\n      },\n    }\n  )\n}\n\n// Server client with service role for admin operations\n// Uses raw supabase-js client which properly bypasses RLS with service role\nexport const createServiceClient = () => {\n  return createSupabaseClient(\n    process.env.NEXT_PUBLIC_SUPABASE_URL!,\n    process.env.SUPABASE_SERVICE_ROLE_KEY!,\n    {\n      auth: {\n        autoRefreshToken: false,\n        persistSession: false,\n      },\n    }\n  )\n}\n"],"names":[],"mappings":";;;;;;AAAA;AAAA;AACA;AACA;;;;AAEO,MAAM,eAAe;IAC1B,MAAM,cAAc,MAAM,IAAA,mKAAO;IAEjC,OAAO,IAAA,wNAAkB,sUAGvB;QACE,SAAS;YACP;gBACE,OAAO,YAAY,MAAM;YAC3B;YACA,QAAO,YAAY;gBACjB,IAAI;oBACF,aAAa,OAAO,CAAC,CAAC,EAAE,IAAI,EAAE,KAAK,EAAE,OAAO,EAAE;wBAC5C,YAAY,GAAG,CAAC,MAAM,OAAO;oBAC/B;gBACF,EAAE,OAAO,OAAO;gBACd,0DAA0D;gBAC1D,wDAAwD;gBACxD,iBAAiB;gBACnB;YACF;QACF;IACF;AAEJ;AAIO,MAAM,sBAAsB;IACjC,OAAO,IAAA,gOAAoB,gFAEzB,QAAQ,GAAG,CAAC,yBAAyB,EACrC;QACE,MAAM;YACJ,kBAAkB;YAClB,gBAAgB;QAClB;IACF;AAEJ"}},
    {"offset": {"line": 134, "column": 0}, "map": {"version":3,"sources":["file:///Users/ghilesmoussaoui/Desktop/Versotech/versotech-portal/src/lib/auth.ts"],"sourcesContent":["import { createServerClient } from '@supabase/ssr'\r\nimport { cookies } from 'next/headers'\r\nimport { redirect } from 'next/navigation'\r\nimport type { User, Session } from '@supabase/supabase-js'\r\n\r\n// Profile roles (stored in profiles.role)\r\nexport type ProfileRole =\r\n  | 'investor'\r\n  | 'staff_admin'\r\n  | 'staff_ops'\r\n  | 'staff_rm'\r\n  | 'arranger'\r\n  | 'introducer'\r\n  | 'partner'\r\n  | 'commercial_partner'\r\n  | 'lawyer'\r\n  | 'ceo'\r\n\r\n// All persona types (from get_user_personas())\r\nexport type PersonaType = 'staff' | 'investor' | 'arranger' | 'introducer' | 'partner' | 'commercial_partner' | 'lawyer'\r\n\r\n// UserRole = ProfileRole for backward compatibility\r\nexport type UserRole = ProfileRole\r\n\r\nconst STAFF_ROLES: ProfileRole[] = ['staff_admin', 'staff_ops', 'staff_rm', 'ceo']\r\n\r\nexport interface AuthUser {\r\n  id: string\r\n  email: string\r\n  displayName: string\r\n  avatar?: string\r\n  role: UserRole\r\n  title?: string\r\n  created_at: string\r\n  permissions?: string[]\r\n}\r\n\r\n// Alias for backward compatibility\r\nexport type Profile = AuthUser\r\n\r\nexport interface AuthSession {\r\n  user: AuthUser\r\n  session: Session\r\n}\r\n\r\nexport class AuthError extends Error {\r\n  constructor(message: string, public code?: string) {\r\n    super(message)\r\n    this.name = 'AuthError'\r\n  }\r\n}\r\n\r\n// Server-side Supabase client\r\nconst createServerSupabaseClient = async () => {\r\n  const cookieStore = await cookies()\r\n\r\n  return createServerClient(\r\n    process.env.NEXT_PUBLIC_SUPABASE_URL!,\r\n    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,\r\n    {\r\n      cookies: {\r\n        getAll() {\r\n          return cookieStore.getAll()\r\n        },\r\n        setAll(cookiesToSet) {\r\n          try {\r\n            cookiesToSet.forEach(({ name, value, options }) =>\r\n              cookieStore.set(name, value, options)\r\n            )\r\n          } catch {\r\n            // The `setAll` method was called from a Server Component.\r\n            // This can be ignored if you have middleware refreshing\r\n            // user sessions.\r\n          }\r\n        },\r\n      },\r\n    }\r\n  )\r\n}\r\n\r\n// Get current user with profile data\r\nexport async function getCurrentUser(): Promise<AuthUser | null> {\r\n  try {\r\n    const supabase = await createServerSupabaseClient()\r\n\r\n    // Get current auth user\r\n    const { data: { user }, error: userError } = await supabase.auth.getUser()\r\n\r\n    if (userError || !user) {\r\n      return null\r\n    }\r\n\r\n    // Get profile data from database\r\n    const { data: profile, error: profileError } = await supabase\r\n      .from('profiles')\r\n      .select('*')\r\n      .eq('id', user.id)\r\n      .single()\r\n\r\n    if (profileError || !profile) {\r\n      console.error('[auth] Profile not found for user:', user.id, profileError)\r\n      return null\r\n    }\r\n\r\n    // Fetch permissions for staff users\r\n    let permissions: string[] = []\r\n    const isStaffRole = STAFF_ROLES.includes(profile.role)\r\n\r\n    if (isStaffRole) {\r\n      const { data: permissionsData } = await supabase\r\n        .from('staff_permissions')\r\n        .select('permission')\r\n        .eq('user_id', user.id)\r\n\r\n      permissions = permissionsData?.map(p => p.permission) || []\r\n    }\r\n\r\n    return {\r\n      id: profile.id,\r\n      email: profile.email,\r\n      displayName: profile.display_name || profile.email?.split('@')[0] || 'User',\r\n      avatar: profile.avatar_url,\r\n      role: profile.role as UserRole,\r\n      title: profile.title,\r\n      created_at: profile.created_at,\r\n      permissions\r\n    }\r\n  } catch (error) {\r\n    console.error('Error getting current user:', error)\r\n    return null\r\n  }\r\n}\r\n\r\n// Get current session\r\nexport async function getCurrentSession(): Promise<Session | null> {\r\n  try {\r\n    const supabase = await createServerSupabaseClient()\r\n\r\n    const { data: { session }, error } = await supabase.auth.getSession()\r\n\r\n    if (error) {\r\n      console.error('Error getting session:', error)\r\n      return null\r\n    }\r\n\r\n    return session\r\n  } catch (error) {\r\n    console.error('Error getting session:', error)\r\n    return null\r\n  }\r\n}\r\n\r\n// Get profile (alias for getCurrentUser for backward compatibility)\r\nexport async function getProfile(): Promise<AuthUser | null> {\r\n  const user = await getCurrentUser()\r\n  if (user) {\r\n    console.log('[auth] Profile retrieved:', user.email, user.role)\r\n  } else {\r\n    console.log('[auth] No profile found')\r\n  }\r\n  return user\r\n}\r\n\r\n// Require authentication\r\nexport async function requireAuth(allowedRoles?: UserRole[]) {\r\n  const user = await getCurrentUser()\r\n\r\n  if (!user) {\r\n    redirect('/versotech_main/login')\r\n  }\r\n\r\n  if (allowedRoles && !allowedRoles.includes(user.role)) {\r\n    throw new Error('Insufficient permissions')\r\n  }\r\n\r\n  return user\r\n}\r\n\r\n// Require investor auth\r\nexport async function requireInvestorAuth() {\r\n  const user = await getCurrentUser()\r\n\r\n  if (!user) {\r\n    redirect('/versotech_main/login')\r\n  }\r\n\r\n  if (user.role !== 'investor') {\r\n    throw new Error('Investor access required')\r\n  }\r\n\r\n  return user\r\n}\r\n\r\n// Require staff auth\r\nexport async function requireStaffAuth() {\r\n  const user = await getCurrentUser()\r\n\r\n  if (!user) {\r\n    redirect('/versotech_main/login')\r\n  }\r\n\r\n  if (!STAFF_ROLES.includes(user.role)) {\r\n    throw new Error('Staff access required')\r\n  }\r\n\r\n  return user\r\n}\r\n\r\n/**\r\n * Check if a user has staff-level access for page authorization.\r\n *\r\n * IMPORTANT: Staff users (staff_admin, ceo, staff_ops, staff_rm) don't have\r\n * traditional database persona entries. Their \"personas\" are created synthetically\r\n * in the layout. This function checks BOTH:\r\n * 1. Profile role (for staff users without persona entries)\r\n * 2. Database personas (for users with explicit staff/ceo persona entries)\r\n *\r\n * @param userId - The user's ID\r\n * @returns true if user has staff access (via role OR persona)\r\n */\r\nexport async function checkStaffAccess(userId: string): Promise<boolean> {\r\n  const supabase = await createServerSupabaseClient()\r\n\r\n  // Check profile role first (handles synthetic staff personas)\r\n  const { data: profile, error: profileError } = await supabase\r\n    .from('profiles')\r\n    .select('role')\r\n    .eq('id', userId)\r\n    .single()\r\n\r\n  if (!profileError && profile && STAFF_ROLES.includes(profile.role as ProfileRole)) {\r\n    return true\r\n  }\r\n\r\n  // Fallback: check database personas (for edge cases)\r\n  const { data: personas } = await supabase.rpc('get_user_personas', {\r\n    p_user_id: userId\r\n  })\r\n\r\n  return personas?.some(\r\n    (p: { persona_type: string }) => p.persona_type === 'staff' || p.persona_type === 'ceo'\r\n  ) || false\r\n}\r\n\r\n/**\r\n * Check if a user has CEO-level access (full admin access).\r\n * CEO access is granted to users with 'ceo' or 'staff_admin' profile roles.\r\n */\r\nexport async function checkCeoAccess(userId: string): Promise<boolean> {\r\n  const supabase = await createServerSupabaseClient()\r\n\r\n  const { data: profile } = await supabase\r\n    .from('profiles')\r\n    .select('role')\r\n    .eq('id', userId)\r\n    .single()\r\n\r\n  return profile?.role === 'ceo' || profile?.role === 'staff_admin'\r\n}\r\n\r\n// Export STAFF_ROLES for use in pages\r\nexport { STAFF_ROLES }\r\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AACA;AACA;AAAA;;;;AAsBA,MAAM,cAA6B;IAAC;IAAe;IAAa;IAAY;CAAM;AAqB3E,MAAM,kBAAkB;;IAC7B,YAAY,OAAe,EAAE,AAAO,IAAa,CAAE;QACjD,KAAK,CAAC,eAD4B,OAAA;QAElC,IAAI,CAAC,IAAI,GAAG;IACd;AACF;AAEA,8BAA8B;AAC9B,MAAM,6BAA6B;IACjC,MAAM,cAAc,MAAM,IAAA,mKAAO;IAEjC,OAAO,IAAA,wNAAkB,sUAGvB;QACE,SAAS;YACP;gBACE,OAAO,YAAY,MAAM;YAC3B;YACA,QAAO,YAAY;gBACjB,IAAI;oBACF,aAAa,OAAO,CAAC,CAAC,EAAE,IAAI,EAAE,KAAK,EAAE,OAAO,EAAE,GAC5C,YAAY,GAAG,CAAC,MAAM,OAAO;gBAEjC,EAAE,OAAM;gBACN,0DAA0D;gBAC1D,wDAAwD;gBACxD,iBAAiB;gBACnB;YACF;QACF;IACF;AAEJ;AAGO,eAAe;IACpB,IAAI;QACF,MAAM,WAAW,MAAM;QAEvB,wBAAwB;QACxB,MAAM,EAAE,MAAM,EAAE,IAAI,EAAE,EAAE,OAAO,SAAS,EAAE,GAAG,MAAM,SAAS,IAAI,CAAC,OAAO;QAExE,IAAI,aAAa,CAAC,MAAM;YACtB,OAAO;QACT;QAEA,iCAAiC;QACjC,MAAM,EAAE,MAAM,OAAO,EAAE,OAAO,YAAY,EAAE,GAAG,MAAM,SAClD,IAAI,CAAC,YACL,MAAM,CAAC,KACP,EAAE,CAAC,MAAM,KAAK,EAAE,EAChB,MAAM;QAET,IAAI,gBAAgB,CAAC,SAAS;YAC5B,QAAQ,KAAK,CAAC,sCAAsC,KAAK,EAAE,EAAE;YAC7D,OAAO;QACT;QAEA,oCAAoC;QACpC,IAAI,cAAwB,EAAE;QAC9B,MAAM,cAAc,YAAY,QAAQ,CAAC,QAAQ,IAAI;QAErD,IAAI,aAAa;YACf,MAAM,EAAE,MAAM,eAAe,EAAE,GAAG,MAAM,SACrC,IAAI,CAAC,qBACL,MAAM,CAAC,cACP,EAAE,CAAC,WAAW,KAAK,EAAE;YAExB,cAAc,iBAAiB,IAAI,CAAA,IAAK,EAAE,UAAU,KAAK,EAAE;QAC7D;QAEA,OAAO;YACL,IAAI,QAAQ,EAAE;YACd,OAAO,QAAQ,KAAK;YACpB,aAAa,QAAQ,YAAY,IAAI,QAAQ,KAAK,EAAE,MAAM,IAAI,CAAC,EAAE,IAAI;YACrE,QAAQ,QAAQ,UAAU;YAC1B,MAAM,QAAQ,IAAI;YAClB,OAAO,QAAQ,KAAK;YACpB,YAAY,QAAQ,UAAU;YAC9B;QACF;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,+BAA+B;QAC7C,OAAO;IACT;AACF;AAGO,eAAe;IACpB,IAAI;QACF,MAAM,WAAW,MAAM;QAEvB,MAAM,EAAE,MAAM,EAAE,OAAO,EAAE,EAAE,KAAK,EAAE,GAAG,MAAM,SAAS,IAAI,CAAC,UAAU;QAEnE,IAAI,OAAO;YACT,QAAQ,KAAK,CAAC,0BAA0B;YACxC,OAAO;QACT;QAEA,OAAO;IACT,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,0BAA0B;QACxC,OAAO;IACT;AACF;AAGO,eAAe;IACpB,MAAM,OAAO,MAAM;IACnB,IAAI,MAAM;QACR,QAAQ,GAAG,CAAC,6BAA6B,KAAK,KAAK,EAAE,KAAK,IAAI;IAChE,OAAO;QACL,QAAQ,GAAG,CAAC;IACd;IACA,OAAO;AACT;AAGO,eAAe,YAAY,YAAyB;IACzD,MAAM,OAAO,MAAM;IAEnB,IAAI,CAAC,MAAM;QACT,IAAA,0NAAQ,EAAC;IACX;IAEA,IAAI,gBAAgB,CAAC,aAAa,QAAQ,CAAC,KAAK,IAAI,GAAG;QACrD,MAAM,IAAI,MAAM;IAClB;IAEA,OAAO;AACT;AAGO,eAAe;IACpB,MAAM,OAAO,MAAM;IAEnB,IAAI,CAAC,MAAM;QACT,IAAA,0NAAQ,EAAC;IACX;IAEA,IAAI,KAAK,IAAI,KAAK,YAAY;QAC5B,MAAM,IAAI,MAAM;IAClB;IAEA,OAAO;AACT;AAGO,eAAe;IACpB,MAAM,OAAO,MAAM;IAEnB,IAAI,CAAC,MAAM;QACT,IAAA,0NAAQ,EAAC;IACX;IAEA,IAAI,CAAC,YAAY,QAAQ,CAAC,KAAK,IAAI,GAAG;QACpC,MAAM,IAAI,MAAM;IAClB;IAEA,OAAO;AACT;AAcO,eAAe,iBAAiB,MAAc;IACnD,MAAM,WAAW,MAAM;IAEvB,8DAA8D;IAC9D,MAAM,EAAE,MAAM,OAAO,EAAE,OAAO,YAAY,EAAE,GAAG,MAAM,SAClD,IAAI,CAAC,YACL,MAAM,CAAC,QACP,EAAE,CAAC,MAAM,QACT,MAAM;IAET,IAAI,CAAC,gBAAgB,WAAW,YAAY,QAAQ,CAAC,QAAQ,IAAI,GAAkB;QACjF,OAAO;IACT;IAEA,qDAAqD;IACrD,MAAM,EAAE,MAAM,QAAQ,EAAE,GAAG,MAAM,SAAS,GAAG,CAAC,qBAAqB;QACjE,WAAW;IACb;IAEA,OAAO,UAAU,KACf,CAAC,IAAgC,EAAE,YAAY,KAAK,WAAW,EAAE,YAAY,KAAK,UAC/E;AACP;AAMO,eAAe,eAAe,MAAc;IACjD,MAAM,WAAW,MAAM;IAEvB,MAAM,EAAE,MAAM,OAAO,EAAE,GAAG,MAAM,SAC7B,IAAI,CAAC,YACL,MAAM,CAAC,QACP,EAAE,CAAC,MAAM,QACT,MAAM;IAET,OAAO,SAAS,SAAS,SAAS,SAAS,SAAS;AACtD"}},
    {"offset": {"line": 309, "column": 0}, "map": {"version":3,"sources":["file:///Users/ghilesmoussaoui/Desktop/Versotech/versotech-portal/src/app/api/admin/metrics/dashboard/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server'\r\nimport { createServiceClient } from '@/lib/supabase/server'\r\nimport { getCurrentUser } from '@/lib/auth'\r\n\r\nexport async function GET(request: Request) {\r\n  try {\r\n    const user = await getCurrentUser()\r\n    if (!user) {\r\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })\r\n    }\r\n\r\n    // Parse query parameters\r\n    const { searchParams } = new URL(request.url)\r\n    const days = Math.min(Math.max(parseInt(searchParams.get('days') || '30', 10), 7), 90)\r\n\r\n    const supabase = createServiceClient()\r\n\r\n    // Check if user is super admin\r\n    const { data: permission } = await supabase\r\n      .from('staff_permissions')\r\n      .select('permission')\r\n      .eq('user_id', user.id)\r\n      .eq('permission', 'super_admin')\r\n      .single()\r\n\r\n    if (!permission) {\r\n      return NextResponse.json({ error: 'Forbidden' }, { status: 403 })\r\n    }\r\n\r\n    // Fetch all data in parallel\r\n    const [\r\n      subscriptionsResult,\r\n      investorResult,\r\n      dealResult,\r\n      pendingResult,\r\n      feeEventsResult,\r\n      pipelineResult,\r\n      investorDistResult,\r\n      alertsResult,\r\n      // Admin-only metrics\r\n      securityMetrics,\r\n      staffActivityResult,\r\n      approvalQueueResult,\r\n      workflowTrendResult,\r\n      complianceForecastResult,\r\n      userActivityTrendResult,\r\n    ] = await Promise.all([\r\n      // Subscriptions for AUM and Revenue metrics (limit to prevent billing spikes)\r\n      supabase\r\n        .from('subscriptions')\r\n        .select('id, commitment, funded_amount, current_nav, spread_fee_amount, subscription_fee_amount, management_fee_amount, status, subscription_date')\r\n        .in('status', ['active', 'committed', 'funded'])\r\n        .limit(50000),\r\n\r\n      // Investor stats (limit to prevent billing spikes)\r\n      supabase\r\n        .from('investors')\r\n        .select('id, status, created_at, kyc_status, type, country', { count: 'exact' })\r\n        .eq('status', 'active')\r\n        .limit(50000),\r\n\r\n      // Deal pipeline (limit to prevent billing spikes)\r\n      supabase.from('deals').select('id, status, target_amount, raised_amount').limit(5000),\r\n\r\n      // Pending items\r\n      Promise.all([\r\n        supabase.from('approvals').select('id', { count: 'exact' }).eq('status', 'pending'),\r\n        supabase.from('tasks').select('id', { count: 'exact' }).in('status', ['pending', 'overdue']),\r\n        supabase\r\n          .from('investors')\r\n          .select('id', { count: 'exact' })\r\n          .eq('kyc_status', 'pending'),\r\n      ]),\r\n\r\n      // Fee events for revenue by month chart (limit to prevent billing spikes)\r\n      supabase\r\n        .from('fee_events')\r\n        .select('id, fee_type, computed_amount, created_at')\r\n        .gte('created_at', new Date(Date.now() - 365 * 24 * 60 * 60 * 1000).toISOString())\r\n        .limit(10000),\r\n\r\n      // Subscription pipeline\r\n      Promise.all([\r\n        supabase.from('investor_deal_interest').select('id', { count: 'exact', head: true }),\r\n        supabase.from('deal_data_room_access').select('id', { count: 'exact', head: true }).is('revoked_at', null),\r\n        supabase\r\n          .from('deal_subscription_submissions')\r\n          .select('id', { count: 'exact', head: true })\r\n          .in('status', ['pending_review', 'approved', 'pending']),\r\n        supabase\r\n          .from('subscriptions')\r\n          .select('id', { count: 'exact', head: true })\r\n          .gt('funded_amount', 0),\r\n      ]),\r\n\r\n      // Investor distribution (limit to prevent billing spikes)\r\n      supabase.from('investors').select('type, kyc_status, country').eq('status', 'active').limit(50000),\r\n\r\n      // Compliance alerts\r\n      supabase\r\n        .from('investors')\r\n        .select('id, legal_name, kyc_expiry_date, kyc_status')\r\n        .eq('status', 'active')\r\n        .not('kyc_expiry_date', 'is', null)\r\n        .gte('kyc_expiry_date', new Date().toISOString().split('T')[0])\r\n        .lte(\r\n          'kyc_expiry_date',\r\n          new Date(Date.now() + 90 * 24 * 60 * 60 * 1000).toISOString().split('T')[0]\r\n        ),\r\n\r\n      // Admin-only: Security metrics (failed logins, new accounts)\r\n      fetchSecurityMetrics(supabase),\r\n\r\n      // Admin-only: Staff activity from audit_logs\r\n      fetchStaffActivity(supabase),\r\n\r\n      // Admin-only: Approval queue age distribution\r\n      fetchApprovalQueueHealth(supabase),\r\n\r\n      // Admin-only: Workflow success trend over past 30 days\r\n      fetchWorkflowTrend(supabase),\r\n\r\n      // Admin-only: KYC expiry forecast\r\n      fetchComplianceForecast(supabase),\r\n\r\n      // Admin-only: User activity trend for the specified time period\r\n      fetchUserActivityTrend(supabase, days),\r\n    ])\r\n\r\n    // Calculate AUM and Revenue from ACTUAL subscription data\r\n    const subscriptions = subscriptionsResult.data || []\r\n    const totalAum = subscriptions.reduce((sum, s) => sum + (s.current_nav || s.commitment || 0), 0)\r\n    const totalCommitment = subscriptions.reduce((sum, s) => sum + (s.commitment || 0), 0)\r\n    const totalFunded = subscriptions.reduce((sum, s) => sum + (s.funded_amount || 0), 0)\r\n    const fundingRate = totalCommitment > 0 ? Math.round((totalFunded / totalCommitment) * 100) : 0\r\n\r\n    // VERSO's PRIMARY REVENUE - Spread fees\r\n    const spreadFeeRevenue = subscriptions.reduce((sum, s) => sum + (s.spread_fee_amount || 0), 0)\r\n    const subscriptionFeeRevenue = subscriptions.reduce((sum, s) => sum + (s.subscription_fee_amount || 0), 0)\r\n    const managementFeeRevenue = subscriptions.reduce((sum, s) => sum + (s.management_fee_amount || 0), 0)\r\n    const totalRevenue = spreadFeeRevenue + subscriptionFeeRevenue + managementFeeRevenue\r\n\r\n    // Calculate investor metrics\r\n    const investors = investorResult.data || []\r\n    const totalInvestors = investorResult.count || 0\r\n    const newInvestorsMtd = investors.filter((i) => {\r\n      const createdDate = new Date(i.created_at)\r\n      const now = new Date()\r\n      return (\r\n        createdDate.getMonth() === now.getMonth() &&\r\n        createdDate.getFullYear() === now.getFullYear()\r\n      )\r\n    }).length\r\n\r\n    // Calculate deal metrics\r\n    const deals = dealResult.data || []\r\n    const openDeals = deals.filter(\r\n      (d) => d.status === 'open' || d.status === 'allocation_pending'\r\n    ).length\r\n    const pipelineValue = deals\r\n      .filter((d) => d.status === 'open' || d.status === 'allocation_pending')\r\n      .reduce((sum, d) => sum + (d.target_amount || 0), 0)\r\n\r\n    // Pending items\r\n    const [approvalsRes, tasksRes, kycRes] = pendingResult\r\n    const pendingApprovals = approvalsRes.count || 0\r\n    const pendingTasks = tasksRes.count || 0\r\n    const pendingKyc = kycRes.count || 0\r\n\r\n    // Revenue by month from fee_events\r\n    const feeEvents = feeEventsResult.data || []\r\n    const revenueByMonth: Record<string, { month: string; subscription_fees: number; management_fees: number; performance_fees: number; spread_fees: number; total: number }> = {}\r\n\r\n    feeEvents.forEach((fe) => {\r\n      const date = new Date(fe.created_at)\r\n      const monthKey = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`\r\n      if (!revenueByMonth[monthKey]) {\r\n        revenueByMonth[monthKey] = {\r\n          month: monthKey,\r\n          subscription_fees: 0,\r\n          management_fees: 0,\r\n          performance_fees: 0,\r\n          spread_fees: 0,\r\n          total: 0,\r\n        }\r\n      }\r\n\r\n      const amount = fe.computed_amount || 0\r\n      if (fe.fee_type === 'subscription') revenueByMonth[monthKey].subscription_fees += amount\r\n      else if (fe.fee_type === 'management') revenueByMonth[monthKey].management_fees += amount\r\n      else if (fe.fee_type === 'performance') revenueByMonth[monthKey].performance_fees += amount\r\n      else if (fe.fee_type === 'spread') revenueByMonth[monthKey].spread_fees += amount\r\n      revenueByMonth[monthKey].total += amount\r\n    })\r\n\r\n    const revenueByMonthArray = Object.values(revenueByMonth).sort((a, b) => a.month.localeCompare(b.month))\r\n\r\n    // Subscription pipeline\r\n    const [interestRes, ndaRes, submittedRes, fundedRes] = pipelineResult\r\n    const subscriptionPipeline = {\r\n      interest: interestRes.count || 0,\r\n      nda_signed: ndaRes.count || 0,\r\n      submitted: submittedRes.count || 0,\r\n      funded: fundedRes.count || 0,\r\n    }\r\n\r\n    // Deal pipeline by status\r\n    const dealsByStatus = {\r\n      draft: { count: 0, value: 0 },\r\n      open: { count: 0, value: 0 },\r\n      allocation_pending: { count: 0, value: 0 },\r\n      closed: { count: 0, value: 0 },\r\n      cancelled: { count: 0, value: 0 },\r\n    }\r\n    deals.forEach((d) => {\r\n      const status = d.status as keyof typeof dealsByStatus\r\n      if (dealsByStatus[status]) {\r\n        dealsByStatus[status].count++\r\n        dealsByStatus[status].value += d.target_amount || 0\r\n      }\r\n    })\r\n\r\n    // Investor distribution\r\n    const investorDist = investorDistResult.data || []\r\n    const byType: Record<string, number> = {}\r\n    const byKyc: Record<string, number> = {}\r\n    const byCountry: Record<string, number> = {}\r\n\r\n    investorDist.forEach((i) => {\r\n      const type = i.type || 'Unknown'\r\n      byType[type] = (byType[type] || 0) + 1\r\n\r\n      const kyc = i.kyc_status || 'not_started'\r\n      byKyc[kyc] = (byKyc[kyc] || 0) + 1\r\n\r\n      const country = i.country || 'Unknown'\r\n      byCountry[country] = (byCountry[country] || 0) + 1\r\n    })\r\n\r\n    // Format investor distribution for charts\r\n    const investorsByType = Object.entries(byType).map(([type, count]) => ({ type, count }))\r\n    const investorsByKyc = Object.entries(byKyc).map(([status, count]) => ({ status, count }))\r\n    const investorsByCountry = Object.entries(byCountry)\r\n      .map(([country, count]) => ({ country, count }))\r\n      .sort((a, b) => b.count - a.count)\r\n      .slice(0, 5)\r\n\r\n    // Compliance alerts\r\n    const kycAlerts = (alertsResult.data || []).map((i) => {\r\n      const expiryDate = new Date(i.kyc_expiry_date)\r\n      const today = new Date()\r\n      const daysUntil = Math.ceil(\r\n        (expiryDate.getTime() - today.getTime()) / (1000 * 60 * 60 * 24)\r\n      )\r\n      let severity: 'critical' | 'high' | 'medium' = 'medium'\r\n      if (daysUntil <= 7) severity = 'critical'\r\n      else if (daysUntil <= 30) severity = 'high'\r\n\r\n      return {\r\n        id: i.id,\r\n        type: 'kyc_expiry' as const,\r\n        severity,\r\n        investor_id: i.id,\r\n        investor_name: i.legal_name,\r\n        details: `KYC expires in ${daysUntil} days`,\r\n        due_date: i.kyc_expiry_date,\r\n        days_until_due: daysUntil,\r\n        created_at: new Date().toISOString(),\r\n      }\r\n    })\r\n\r\n    // Build action items from alerts\r\n    const criticalAlerts = kycAlerts.filter((a) => a.severity === 'critical')\r\n    const highAlerts = kycAlerts.filter((a) => a.severity === 'high')\r\n    const mediumAlerts = kycAlerts.filter((a) => a.severity === 'medium')\r\n\r\n    const actionItems = {\r\n      critical:\r\n        criticalAlerts.length > 0\r\n          ? [\r\n              {\r\n                id: 'kyc-critical',\r\n                category: 'kyc',\r\n                title: 'KYC Expiring (Critical)',\r\n                description: `${criticalAlerts.length} investors with KYC expiring within 7 days`,\r\n                count: criticalAlerts.length,\r\n                link: '/versotech/staff/investors?kyc_status=expiring',\r\n              },\r\n            ]\r\n          : [],\r\n      high: [\r\n        ...(pendingApprovals > 0\r\n          ? [\r\n              {\r\n                id: 'approvals',\r\n                category: 'approval',\r\n                title: 'Pending Approvals',\r\n                description: `${pendingApprovals} approvals waiting for review`,\r\n                count: pendingApprovals,\r\n                link: '/versotech/staff/approvals',\r\n              },\r\n            ]\r\n          : []),\r\n        ...(highAlerts.length > 0\r\n          ? [\r\n              {\r\n                id: 'kyc-high',\r\n                category: 'kyc',\r\n                title: 'KYC Expiring Soon',\r\n                description: `${highAlerts.length} investors with KYC expiring within 30 days`,\r\n                count: highAlerts.length,\r\n                link: '/versotech/staff/investors?kyc_status=expiring',\r\n              },\r\n            ]\r\n          : []),\r\n      ],\r\n      medium: [\r\n        ...(pendingTasks > 0\r\n          ? [\r\n              {\r\n                id: 'tasks',\r\n                category: 'task',\r\n                title: 'Pending Tasks',\r\n                description: `${pendingTasks} tasks requiring attention`,\r\n                count: pendingTasks,\r\n                link: '/versotech/staff/tasks',\r\n              },\r\n            ]\r\n          : []),\r\n        ...(mediumAlerts.length > 0\r\n          ? [\r\n              {\r\n                id: 'kyc-medium',\r\n                category: 'kyc',\r\n                title: 'KYC Expiring (90 days)',\r\n                description: `${mediumAlerts.length} investors with KYC expiring within 90 days`,\r\n                count: mediumAlerts.length,\r\n                link: '/versotech/staff/investors?kyc_status=expiring',\r\n              },\r\n            ]\r\n          : []),\r\n      ],\r\n    }\r\n\r\n    return NextResponse.json({\r\n      success: true,\r\n      data: {\r\n        kpis: {\r\n          aum: {\r\n            value: totalAum,\r\n            commitment: totalCommitment,\r\n            funded: totalFunded,\r\n            funding_rate: fundingRate,\r\n            change_mtd: null, // Requires historical snapshots to calculate\r\n            trend: null, // Requires historical snapshots to calculate\r\n          },\r\n          revenue: {\r\n            total: totalRevenue,\r\n            spread_fees: spreadFeeRevenue,\r\n            subscription_fees: subscriptionFeeRevenue,\r\n            management_fees: managementFeeRevenue,\r\n          },\r\n          investors: {\r\n            active: totalInvestors,\r\n            new_mtd: newInvestorsMtd,\r\n            trend: newInvestorsMtd > 0 ? 'up' : null,\r\n          },\r\n          deals: {\r\n            open: openDeals,\r\n            pipeline_value: pipelineValue,\r\n            trend: null, // Requires historical snapshots to calculate\r\n          },\r\n          pending: {\r\n            approvals: pendingApprovals,\r\n            tasks: pendingTasks,\r\n            kyc: pendingKyc,\r\n          },\r\n        },\r\n        charts: {\r\n          revenueByMonth: revenueByMonthArray,\r\n          subscriptionPipeline,\r\n          dealsByStatus,\r\n          investorsByType,\r\n          investorsByKyc,\r\n          investorsByCountry,\r\n        },\r\n        alerts: actionItems,\r\n        // Admin-only metrics\r\n        adminMetrics: {\r\n          security: securityMetrics,\r\n          staffActivity: staffActivityResult,\r\n          approvalQueue: approvalQueueResult,\r\n          workflowTrend: workflowTrendResult,\r\n          complianceForecast: complianceForecastResult,\r\n          userActivityTrend: userActivityTrendResult,\r\n        },\r\n      },\r\n    })\r\n  } catch (error) {\r\n    console.error('Dashboard metrics error:', error)\r\n    return NextResponse.json(\r\n      { error: 'Failed to fetch dashboard metrics' },\r\n      { status: 500 }\r\n    )\r\n  }\r\n}\r\n\r\n// Helper functions for admin-only metrics\r\n\r\nasync function fetchSecurityMetrics(supabase: any) {\r\n  const now = new Date()\r\n  const day24h = new Date(now.getTime() - 24 * 60 * 60 * 1000).toISOString()\r\n  const day7d = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000).toISOString()\r\n\r\n  // Failed logins from audit_logs (limit to prevent billing spikes during attacks)\r\n  const { data: loginAttempts } = await supabase\r\n    .from('audit_logs')\r\n    .select('created_at')\r\n    .eq('action', 'failed_login_attempt')\r\n    .gte('created_at', day7d)\r\n    .limit(10000)\r\n\r\n  const failed24h = loginAttempts?.filter(\r\n    (l: any) => new Date(l.created_at) >= new Date(day24h)\r\n  ).length || 0\r\n  const failed7d = loginAttempts?.length || 0\r\n\r\n  // New accounts created in past 7 days\r\n  const { count: newAccounts } = await supabase\r\n    .from('profiles')\r\n    .select('*', { count: 'exact', head: true })\r\n    .gte('created_at', day7d)\r\n\r\n  // Pending approvals count\r\n  const { count: pendingApprovals } = await supabase\r\n    .from('approvals')\r\n    .select('*', { count: 'exact', head: true })\r\n    .eq('status', 'pending')\r\n\r\n  return {\r\n    failed_logins_24h: failed24h,\r\n    failed_logins_7d: failed7d,\r\n    new_accounts_7d: newAccounts || 0,\r\n    pending_approvals: pendingApprovals || 0,\r\n  }\r\n}\r\n\r\nasync function fetchStaffActivity(supabase: any) {\r\n  const day7d = new Date(Date.now() - 7 * 24 * 60 * 60 * 1000).toISOString()\r\n\r\n  // Get staff profiles first\r\n  const { data: staffProfiles } = await supabase\r\n    .from('profiles')\r\n    .select('id, display_name, email')\r\n    .in('role', ['staff_admin', 'staff_ops', 'staff_rm', 'ceo'])\r\n\r\n  if (!staffProfiles?.length) {\r\n    return []\r\n  }\r\n\r\n  const staffIds = staffProfiles.map((p: any) => p.id)\r\n\r\n  // Get audit log counts grouped by staff (limit to prevent billing spikes)\r\n  const { data: activityLogs } = await supabase\r\n    .from('audit_logs')\r\n    .select('actor_id, action, created_at')\r\n    .in('actor_id', staffIds)\r\n    .gte('created_at', day7d)\r\n    .limit(50000)\r\n\r\n  // Aggregate by staff\r\n  const activityMap: Record<string, { count: number; lastAction: string | null }> = {}\r\n  staffIds.forEach((id: string) => {\r\n    activityMap[id] = { count: 0, lastAction: null }\r\n  })\r\n\r\n  activityLogs?.forEach((log: any) => {\r\n    const entry = activityMap[log.actor_id]\r\n    if (entry) {\r\n      entry.count++\r\n      if (!entry.lastAction || log.created_at > entry.lastAction) {\r\n        entry.lastAction = log.created_at\r\n      }\r\n    }\r\n  })\r\n\r\n  // Map to staff with names\r\n  const staffActivity = staffProfiles.map((staff: any) => ({\r\n    staff_id: staff.id,\r\n    name: staff.display_name || staff.email?.split('@')[0] || 'Unknown',\r\n    action_count: activityMap[staff.id]?.count || 0,\r\n    last_action: activityMap[staff.id]?.lastAction,\r\n  }))\r\n\r\n  // Sort by action count descending\r\n  return staffActivity.sort((a: any, b: any) => b.action_count - a.action_count)\r\n}\r\n\r\nasync function fetchApprovalQueueHealth(supabase: any) {\r\n  const now = new Date()\r\n  const day1 = new Date(now.getTime() - 1 * 24 * 60 * 60 * 1000)\r\n  const day3 = new Date(now.getTime() - 3 * 24 * 60 * 60 * 1000)\r\n  const day7 = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000)\r\n\r\n  const { data: pendingApprovals } = await supabase\r\n    .from('approvals')\r\n    .select('created_at')\r\n    .eq('status', 'pending')\r\n    .limit(10000)\r\n\r\n  let under_1_day = 0\r\n  let days_1_to_3 = 0\r\n  let days_3_to_7 = 0\r\n  let over_7_days = 0\r\n\r\n  pendingApprovals?.forEach((approval: any) => {\r\n    const createdAt = new Date(approval.created_at)\r\n    if (createdAt >= day1) {\r\n      under_1_day++\r\n    } else if (createdAt >= day3) {\r\n      days_1_to_3++\r\n    } else if (createdAt >= day7) {\r\n      days_3_to_7++\r\n    } else {\r\n      over_7_days++\r\n    }\r\n  })\r\n\r\n  return {\r\n    under_1_day,\r\n    days_1_to_3,\r\n    days_3_to_7,\r\n    over_7_days,\r\n    total: pendingApprovals?.length || 0,\r\n  }\r\n}\r\n\r\nasync function fetchWorkflowTrend(supabase: any) {\r\n  const day30 = new Date(Date.now() - 30 * 24 * 60 * 60 * 1000).toISOString()\r\n\r\n  const { data: runs } = await supabase\r\n    .from('workflow_runs')\r\n    .select('status, created_at')\r\n    .gte('created_at', day30)\r\n    .order('created_at', { ascending: true })\r\n    .limit(50000)\r\n\r\n  // Group by date\r\n  const byDate: Record<string, { total: number; completed: number; failed: number }> = {}\r\n\r\n  runs?.forEach((run: any) => {\r\n    const date = run.created_at.split('T')[0]\r\n    if (!byDate[date]) {\r\n      byDate[date] = { total: 0, completed: 0, failed: 0 }\r\n    }\r\n    byDate[date].total++\r\n    if (run.status === 'completed') {\r\n      byDate[date].completed++\r\n    } else if (run.status === 'failed') {\r\n      byDate[date].failed++\r\n    }\r\n  })\r\n\r\n  // Convert to array with success rate\r\n  return Object.entries(byDate).map(([date, stats]) => ({\r\n    date,\r\n    total_runs: stats.total,\r\n    completed: stats.completed,\r\n    failed: stats.failed,\r\n    success_rate: stats.total > 0 ? Math.round((stats.completed / stats.total) * 100) : 0,\r\n  }))\r\n}\r\n\r\nasync function fetchComplianceForecast(supabase: any) {\r\n  const now = new Date()\r\n  const day7 = new Date(now.getTime() + 7 * 24 * 60 * 60 * 1000).toISOString()\r\n  const day30 = new Date(now.getTime() + 30 * 24 * 60 * 60 * 1000).toISOString()\r\n  const day90 = new Date(now.getTime() + 90 * 24 * 60 * 60 * 1000).toISOString()\r\n\r\n  const { data: investors } = await supabase\r\n    .from('investors')\r\n    .select('kyc_expiry_date')\r\n    .not('kyc_expiry_date', 'is', null)\r\n    .gte('kyc_expiry_date', now.toISOString())\r\n    .lte('kyc_expiry_date', day90)\r\n\r\n  let next_7_days = 0\r\n  let next_30_days = 0\r\n  let next_90_days = 0\r\n\r\n  investors?.forEach((inv: any) => {\r\n    const expiry = new Date(inv.kyc_expiry_date)\r\n    if (expiry <= new Date(day7)) {\r\n      next_7_days++\r\n    } else if (expiry <= new Date(day30)) {\r\n      next_30_days++\r\n    } else {\r\n      next_90_days++\r\n    }\r\n  })\r\n\r\n  return {\r\n    next_7_days,\r\n    next_30_days,\r\n    next_90_days,\r\n    total: investors?.length || 0,\r\n  }\r\n}\r\n\r\nasync function fetchUserActivityTrend(supabase: any, days: number) {\r\n  const startDate = new Date(Date.now() - days * 24 * 60 * 60 * 1000).toISOString()\r\n\r\n  // Get audit logs grouped by date and count unique users per day\r\n  const { data: activityLogs } = await supabase\r\n    .from('audit_logs')\r\n    .select('actor_id, created_at')\r\n    .gte('created_at', startDate)\r\n    .not('actor_id', 'is', null)\r\n    .order('created_at', { ascending: true })\r\n    .limit(100000)\r\n\r\n  // Group by date and count unique users\r\n  const byDate: Record<string, Set<string>> = {}\r\n\r\n  // Initialize all dates in range with empty sets\r\n  for (let i = 0; i < days; i++) {\r\n    const date = new Date(Date.now() - (days - 1 - i) * 24 * 60 * 60 * 1000)\r\n    const dateKey = date.toISOString().split('T')[0]\r\n    byDate[dateKey] = new Set()\r\n  }\r\n\r\n  // Populate with actual data\r\n  activityLogs?.forEach((log: any) => {\r\n    const dateKey = log.created_at.split('T')[0]\r\n    if (byDate[dateKey] && log.actor_id) {\r\n      byDate[dateKey].add(log.actor_id)\r\n    }\r\n  })\r\n\r\n  // Convert to array format for the chart\r\n  return Object.entries(byDate).map(([date, userSet]) => ({\r\n    date,\r\n    activeUsers: userSet.size,\r\n    // Format date for display (e.g., \"Jan 15\")\r\n    label: new Date(date).toLocaleDateString('en-US', { month: 'short', day: 'numeric' }),\r\n  }))\r\n}\r\n"],"names":[],"mappings":"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"}}]
}