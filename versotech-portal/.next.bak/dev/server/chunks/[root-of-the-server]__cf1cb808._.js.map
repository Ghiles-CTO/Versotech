{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 82, "column": 0}, "map": {"version":3,"sources":["file:///Users/ghilesmoussaoui/Desktop/Versotech/versotech-portal/src/lib/supabase/server.ts"],"sourcesContent":["import { createServerClient } from '@supabase/ssr'\nimport { createClient as createSupabaseClient } from '@supabase/supabase-js'\nimport { cookies } from 'next/headers'\n\nexport const createClient = async () => {\n  const cookieStore = await cookies()\n\n  return createServerClient(\n    process.env.NEXT_PUBLIC_SUPABASE_URL!,\n    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,\n    {\n      cookies: {\n        getAll() {\n          return cookieStore.getAll()\n        },\n        setAll(cookiesToSet) {\n          try {\n            cookiesToSet.forEach(({ name, value, options }) => {\n              cookieStore.set(name, value, options)\n            })\n          } catch (error) {\n            // The `setAll` method was called from a Server Component.\n            // This can be ignored if you have middleware refreshing\n            // user sessions.\n          }\n        },\n      },\n    }\n  )\n}\n\n// Server client with service role for admin operations\n// Uses raw supabase-js client which properly bypasses RLS with service role\nexport const createServiceClient = () => {\n  return createSupabaseClient(\n    process.env.NEXT_PUBLIC_SUPABASE_URL!,\n    process.env.SUPABASE_SERVICE_ROLE_KEY!,\n    {\n      auth: {\n        autoRefreshToken: false,\n        persistSession: false,\n      },\n    }\n  )\n}\n"],"names":[],"mappings":";;;;;;AAAA;AAAA;AACA;AACA;;;;AAEO,MAAM,eAAe;IAC1B,MAAM,cAAc,MAAM,IAAA,mKAAO;IAEjC,OAAO,IAAA,wNAAkB,sUAGvB;QACE,SAAS;YACP;gBACE,OAAO,YAAY,MAAM;YAC3B;YACA,QAAO,YAAY;gBACjB,IAAI;oBACF,aAAa,OAAO,CAAC,CAAC,EAAE,IAAI,EAAE,KAAK,EAAE,OAAO,EAAE;wBAC5C,YAAY,GAAG,CAAC,MAAM,OAAO;oBAC/B;gBACF,EAAE,OAAO,OAAO;gBACd,0DAA0D;gBAC1D,wDAAwD;gBACxD,iBAAiB;gBACnB;YACF;QACF;IACF;AAEJ;AAIO,MAAM,sBAAsB;IACjC,OAAO,IAAA,gOAAoB,gFAEzB,QAAQ,GAAG,CAAC,yBAAyB,EACrC;QACE,MAAM;YACJ,kBAAkB;YAClB,gBAAgB;QAClB;IACF;AAEJ"}},
    {"offset": {"line": 128, "column": 0}, "map": {"version":3,"sources":["file:///Users/ghilesmoussaoui/Desktop/Versotech/versotech-portal/src/app/api/vehicles/dropdown-options/route.ts"],"sourcesContent":["import { createClient, createServiceClient } from '@/lib/supabase/server'\nimport { NextResponse } from 'next/server'\n\n/**\n * GET /api/vehicles/dropdown-options\n *\n * Returns lists of arrangers, lawyers, and managing partners (CEO users)\n * for use in vehicle create/edit forms.\n */\nexport async function GET() {\n  try {\n    const supabase = await createClient()\n    const serviceSupabase = createServiceClient()\n\n    // Check authentication\n    const { data: { user }, error: authError } = await supabase.auth.getUser()\n    if (authError || !user) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })\n    }\n\n    // Fetch all dropdown options in parallel using service client to bypass RLS\n    const [\n      { data: arrangers, error: arrangersError },\n      { data: lawyers, error: lawyersError }\n    ] = await Promise.all([\n      // Arrangers from arranger_entities\n      serviceSupabase\n        .from('arranger_entities')\n        .select('id, legal_name, email, status')\n        .or('status.eq.active,status.is.null')\n        .order('legal_name', { ascending: true }),\n\n      // Lawyers from lawyers table\n      serviceSupabase\n        .from('lawyers')\n        .select('id, firm_name, display_name, primary_contact_email, is_active')\n        .or('is_active.eq.true,is_active.is.null')\n        .order('firm_name', { ascending: true })\n    ])\n\n    if (arrangersError) {\n      console.error('[dropdown-options] Error fetching arrangers:', arrangersError)\n    }\n    if (lawyersError) {\n      console.error('[dropdown-options] Error fetching lawyers:', lawyersError)\n    }\n\n    return NextResponse.json({\n      arrangers: (arrangers || []).map((a: any) => ({\n        id: a.id,\n        name: a.legal_name,\n        email: a.email\n      })),\n      lawyers: (lawyers || []).map((l: any) => ({\n        id: l.id,\n        name: l.display_name || l.firm_name,\n        firm_name: l.firm_name,\n        email: l.primary_contact_email\n      }))\n    })\n\n  } catch (error) {\n    console.error('[dropdown-options] Unexpected error:', error)\n    return NextResponse.json(\n      { error: 'Internal server error' },\n      { status: 500 }\n    )\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAQO,eAAe;IACpB,IAAI;QACF,MAAM,WAAW,MAAM,IAAA,yKAAY;QACnC,MAAM,kBAAkB,IAAA,gLAAmB;QAE3C,uBAAuB;QACvB,MAAM,EAAE,MAAM,EAAE,IAAI,EAAE,EAAE,OAAO,SAAS,EAAE,GAAG,MAAM,SAAS,IAAI,CAAC,OAAO;QACxE,IAAI,aAAa,CAAC,MAAM;YACtB,OAAO,uKAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAe,GAAG;gBAAE,QAAQ;YAAI;QACpE;QAEA,4EAA4E;QAC5E,MAAM,CACJ,EAAE,MAAM,SAAS,EAAE,OAAO,cAAc,EAAE,EAC1C,EAAE,MAAM,OAAO,EAAE,OAAO,YAAY,EAAE,CACvC,GAAG,MAAM,QAAQ,GAAG,CAAC;YACpB,mCAAmC;YACnC,gBACG,IAAI,CAAC,qBACL,MAAM,CAAC,iCACP,EAAE,CAAC,mCACH,KAAK,CAAC,cAAc;gBAAE,WAAW;YAAK;YAEzC,6BAA6B;YAC7B,gBACG,IAAI,CAAC,WACL,MAAM,CAAC,iEACP,EAAE,CAAC,uCACH,KAAK,CAAC,aAAa;gBAAE,WAAW;YAAK;SACzC;QAED,IAAI,gBAAgB;YAClB,QAAQ,KAAK,CAAC,gDAAgD;QAChE;QACA,IAAI,cAAc;YAChB,QAAQ,KAAK,CAAC,8CAA8C;QAC9D;QAEA,OAAO,uKAAY,CAAC,IAAI,CAAC;YACvB,WAAW,CAAC,aAAa,EAAE,EAAE,GAAG,CAAC,CAAC,IAAW,CAAC;oBAC5C,IAAI,EAAE,EAAE;oBACR,MAAM,EAAE,UAAU;oBAClB,OAAO,EAAE,KAAK;gBAChB,CAAC;YACD,SAAS,CAAC,WAAW,EAAE,EAAE,GAAG,CAAC,CAAC,IAAW,CAAC;oBACxC,IAAI,EAAE,EAAE;oBACR,MAAM,EAAE,YAAY,IAAI,EAAE,SAAS;oBACnC,WAAW,EAAE,SAAS;oBACtB,OAAO,EAAE,qBAAqB;gBAChC,CAAC;QACH;IAEF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,wCAAwC;QACtD,OAAO,uKAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAAwB,GACjC;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}