{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/ghilesmoussaoui/Desktop/Versotech/versotech-portal/src/lib/messaging/supabase.ts"],"sourcesContent":["import { createClient } from '@/lib/supabase/client'\nimport type {\n  ConversationFilters,\n  ConversationMessage,\n  ConversationSummary,\n  MessageSender,\n} from '@/types/messaging'\n\ninterface FetchConversationsOptions extends ConversationFilters {\n  limit?: number\n  offset?: number\n  includeMessages?: boolean\n}\n\ninterface FetchConversationsResponse {\n  conversations: ConversationSummary[]\n  total: number\n  limit: number\n  offset: number\n  hasMore: boolean\n}\n\ninterface FetchMessagesOptions {\n  limit?: number\n  offset?: number\n}\n\nexport async function fetchConversationsClient(\n  filters: FetchConversationsOptions\n): Promise<FetchConversationsResponse> {\n  const params = new URLSearchParams()\n\n  if (filters.visibility) params.set('visibility', filters.visibility)\n  if (filters.type) params.set('type', filters.type)\n  if (filters.unreadOnly) params.set('unread', 'true')\n  if (filters.search) params.set('search', filters.search)\n  if (filters.dealId) params.set('dealId', filters.dealId)\n  if (typeof filters.limit === 'number') params.set('limit', String(filters.limit))\n  if (typeof filters.offset === 'number') params.set('offset', String(filters.offset))\n  if (filters.includeMessages === false) params.set('includeMessages', 'false')\n\n  const response = await fetch(`/api/conversations?${params.toString()}`, {\n    cache: 'no-store',\n  })\n\n  if (!response.ok) {\n    const error = await response.json().catch(() => null)\n    throw new Error(error?.error || 'Failed to load conversations')\n  }\n\n  const data = await response.json()\n\n  return {\n    conversations: data.conversations as ConversationSummary[],\n    total: data.pagination.total,\n    limit: data.pagination.limit,\n    offset: data.pagination.offset,\n    hasMore: data.pagination.has_more,\n  }\n}\n\nexport function normalizeConversation(raw: any): ConversationSummary {\n  const participants = Array.isArray(raw?.conversation_participants)\n    ? raw.conversation_participants.map((participant: any) => {\n        const profile = participant?.profiles || {}\n        return {\n          id: profile.id || participant.user_id,\n          displayName: profile.display_name || profile.email || null,\n          email: profile.email || null,\n          role: profile.role || null,\n          avatarUrl: profile.avatar_url ?? null,\n          participantRole: participant?.participant_role ?? 'member',\n          joinedAt: participant?.joined_at,\n          lastReadAt: participant?.last_read_at ?? null,\n          lastNotifiedAt: participant?.last_notified_at ?? null,\n          isMuted: participant?.is_muted ?? false,\n          isPinned: participant?.is_pinned ?? false,\n        }\n      })\n    : []\n\n  const latestMessageRaw = Array.isArray(raw?.messages) ? raw.messages[0] : null\n  const latestMessage = latestMessageRaw ? normalizeMessage(latestMessageRaw) : null\n\n  return {\n    id: raw.id,\n    subject: raw.subject ?? null,\n    preview: raw.preview ?? null,\n    type: raw.type ?? 'dm',\n    visibility: raw.visibility ?? 'internal',\n    ownerTeam: raw.owner_team ?? null,\n    dealId: raw.deal_id ?? null,\n    createdBy: raw.created_by ?? null,\n    createdAt: raw.created_at,\n    updatedAt: raw.updated_at,\n    lastMessageAt: raw.last_message_at ?? null,\n    lastMessageId: raw.last_message_id ?? null,\n    archivedAt: raw.archived_at ?? null,\n    metadata: raw.metadata ?? {},\n    participants,\n    unreadCount: raw.unreadCount ?? 0,\n    latestMessage,\n    participantCount: participants.length,\n  }\n}\n\nexport async function fetchConversationMessages(\n  conversationId: string,\n  options: FetchMessagesOptions = {}\n): Promise<ConversationMessage[]> {\n  const params = new URLSearchParams()\n  if (typeof options.limit === 'number') params.set('limit', String(options.limit))\n  if (typeof options.offset === 'number') params.set('offset', String(options.offset))\n\n  const response = await fetch(`/api/conversations/${conversationId}/messages?${params.toString()}`)\n\n  if (!response.ok) {\n    const error = await response.json().catch(() => null)\n    throw new Error(error?.error || 'Failed to fetch messages')\n  }\n\n  const data = await response.json()\n  return data.messages as ConversationMessage[]\n}\n\nexport async function markConversationRead(conversationId: string) {\n  await fetch(`/api/conversations/${conversationId}/read`, { method: 'POST' })\n}\n\nexport function getClientSupabase() {\n  return createClient()\n}\n\nexport function subscribeToConversationUpdates(\n  conversationId: string,\n  callbacks: {\n    onMessage?: (message: ConversationMessage) => void\n    onUpdate?: () => void\n  }\n) {\n  const supabase = createClient()\n\n  \n\n  const channel = supabase\n    .channel(`conversation-${conversationId}`)\n    .on(\n      'postgres_changes',\n      {\n        event: 'INSERT',\n        schema: 'public',\n        table: 'messages',\n        filter: `conversation_id=eq.${conversationId}`,\n      },\n      (payload) => {\n        if (payload.eventType === 'INSERT') {\n          callbacks.onMessage?.(normalizeMessage(payload.new))\n        }\n        callbacks.onUpdate?.()\n      }\n    )\n    .on(\n      'postgres_changes',\n      {\n        event: '*',\n        schema: 'public',\n        table: 'conversation_participants',\n        filter: `conversation_id=eq.${conversationId}`,\n      },\n      (payload) => {\n        callbacks.onUpdate?.()\n      }\n    )\n    .subscribe()\n\n  return () => {\n    supabase.removeChannel(channel)\n  }\n}\n\nexport function normalizeMessage(raw: any): ConversationMessage {\n  // Handle both API responses (with joined sender) and realtime events (without joins)\n  const sender = raw.sender as MessageSender | undefined\n\n  return {\n    id: raw.id,\n    conversationId: raw.conversation_id,\n    senderId: raw.sender_id,\n    body: raw.body ?? null,\n    messageType: raw.message_type ?? 'text',\n    fileKey: raw.file_key ?? null,\n    replyToMessageId: raw.reply_to_message_id ?? null,\n    metadata: raw.metadata ?? {},\n    createdAt: raw.created_at,\n    editedAt: raw.edited_at ?? null,\n    deletedAt: raw.deleted_at ?? null,\n    // Sender might not be available in realtime payloads, that's ok\n    sender: sender ? {\n      id: sender.id ?? null,\n      displayName: sender.displayName ?? (sender as any).display_name ?? null,\n      email: sender.email ?? null,\n      role: sender.role ?? null,\n      avatarUrl: sender.avatarUrl ?? (sender as any).avatar_url ?? null,\n    } : null,\n    readBy: Array.isArray(raw.read_by) ? raw.read_by : [],\n  }\n}\n\n\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 165, "column": 0}, "map": {"version":3,"sources":["file:///Users/ghilesmoussaoui/Desktop/Versotech/versotech-portal/src/lib/messaging/selectors.ts"],"sourcesContent":["import type { ConversationSummary, ConversationFilters } from '@/types/messaging'\n\nexport function applyConversationFilters(\n  conversations: ConversationSummary[],\n  filters: ConversationFilters\n) {\n  return conversations.filter((conversation) => {\n    if (filters.type !== 'all' && conversation.type !== filters.type) return false\n    if (filters.visibility !== 'all' && conversation.visibility !== filters.visibility) return false\n    if (filters.dealId && conversation.dealId !== filters.dealId) return false\n    if (filters.unreadOnly && (!conversation.unreadCount || conversation.unreadCount === 0)) return false\n\n    if (filters.search) {\n      const query = filters.search.toLowerCase()\n      const haystack: string[] = []\n\n      if (conversation.subject) haystack.push(conversation.subject)\n      if (conversation.preview) haystack.push(conversation.preview)\n      if (conversation.ownerTeam) haystack.push(conversation.ownerTeam)\n\n      conversation.participants.forEach((participant) => {\n        if (participant.displayName) haystack.push(participant.displayName)\n        if (participant.email) haystack.push(participant.email)\n      })\n\n      const matches = haystack.some((entry) => entry.toLowerCase().includes(query))\n      if (!matches) return false\n    }\n\n    return true\n  })\n}\n\nexport function sortConversations(conversations: ConversationSummary[]) {\n  return [...conversations].sort((a, b) => {\n    const aTime = a.lastMessageAt ? new Date(a.lastMessageAt).getTime() : new Date(a.createdAt).getTime()\n    const bTime = b.lastMessageAt ? new Date(b.lastMessageAt).getTime() : new Date(b.createdAt).getTime()\n    return bTime - aTime\n  })\n}\n\n\n\n"],"names":[],"mappings":";;;;;;AAEO,SAAS,yBACd,aAAoC,EACpC,OAA4B;IAE5B,OAAO,cAAc,MAAM,CAAC,CAAC;QAC3B,IAAI,QAAQ,IAAI,KAAK,SAAS,aAAa,IAAI,KAAK,QAAQ,IAAI,EAAE,OAAO;QACzE,IAAI,QAAQ,UAAU,KAAK,SAAS,aAAa,UAAU,KAAK,QAAQ,UAAU,EAAE,OAAO;QAC3F,IAAI,QAAQ,MAAM,IAAI,aAAa,MAAM,KAAK,QAAQ,MAAM,EAAE,OAAO;QACrE,IAAI,QAAQ,UAAU,IAAI,CAAC,CAAC,aAAa,WAAW,IAAI,aAAa,WAAW,KAAK,CAAC,GAAG,OAAO;QAEhG,IAAI,QAAQ,MAAM,EAAE;YAClB,MAAM,QAAQ,QAAQ,MAAM,CAAC,WAAW;YACxC,MAAM,WAAqB,EAAE;YAE7B,IAAI,aAAa,OAAO,EAAE,SAAS,IAAI,CAAC,aAAa,OAAO;YAC5D,IAAI,aAAa,OAAO,EAAE,SAAS,IAAI,CAAC,aAAa,OAAO;YAC5D,IAAI,aAAa,SAAS,EAAE,SAAS,IAAI,CAAC,aAAa,SAAS;YAEhE,aAAa,YAAY,CAAC,OAAO,CAAC,CAAC;gBACjC,IAAI,YAAY,WAAW,EAAE,SAAS,IAAI,CAAC,YAAY,WAAW;gBAClE,IAAI,YAAY,KAAK,EAAE,SAAS,IAAI,CAAC,YAAY,KAAK;YACxD;YAEA,MAAM,UAAU,SAAS,IAAI,CAAC,CAAC,QAAU,MAAM,WAAW,GAAG,QAAQ,CAAC;YACtE,IAAI,CAAC,SAAS,OAAO;QACvB;QAEA,OAAO;IACT;AACF;AAEO,SAAS,kBAAkB,aAAoC;IACpE,OAAO;WAAI;KAAc,CAAC,IAAI,CAAC,CAAC,GAAG;QACjC,MAAM,QAAQ,EAAE,aAAa,GAAG,IAAI,KAAK,EAAE,aAAa,EAAE,OAAO,KAAK,IAAI,KAAK,EAAE,SAAS,EAAE,OAAO;QACnG,MAAM,QAAQ,EAAE,aAAa,GAAG,IAAI,KAAK,EAAE,aAAa,EAAE,OAAO,KAAK,IAAI,KAAK,EAAE,SAAS,EAAE,OAAO;QACnG,OAAO,QAAQ;IACjB;AACF"}},
    {"offset": {"line": 209, "column": 0}, "map": {"version":3,"sources":["file:///Users/ghilesmoussaoui/Desktop/Versotech/versotech-portal/src/lib/messaging/utils.ts"],"sourcesContent":["import type { ConversationMessage } from '@/types/messaging'\n\n/**\n * Format a timestamp as relative time (e.g., \"2m ago\", \"Yesterday at 3:45 PM\")\n */\nexport function formatRelativeTime(timestamp: string): string {\n  const now = new Date()\n  const messageTime = new Date(timestamp)\n  const diffInSeconds = Math.floor((now.getTime() - messageTime.getTime()) / 1000)\n  \n  // Less than a minute\n  if (diffInSeconds < 60) {\n    return 'Just now'\n  }\n  \n  // Less than an hour\n  if (diffInSeconds < 3600) {\n    const minutes = Math.floor(diffInSeconds / 60)\n    return `${minutes}m ago`\n  }\n  \n  // Less than 24 hours\n  if (diffInSeconds < 86400) {\n    const hours = Math.floor(diffInSeconds / 3600)\n    return `${hours}h ago`\n  }\n  \n  // Yesterday\n  const yesterday = new Date(now)\n  yesterday.setDate(yesterday.getDate() - 1)\n  if (messageTime.toDateString() === yesterday.toDateString()) {\n    return `Yesterday at ${messageTime.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit', hour12: true })}`\n  }\n  \n  // Less than a week\n  if (diffInSeconds < 604800) {\n    const days = Math.floor(diffInSeconds / 86400)\n    return `${days}d ago`\n  }\n  \n  // Older - show full date\n  return messageTime.toLocaleDateString('en-US', { \n    month: 'short', \n    day: 'numeric',\n    year: messageTime.getFullYear() !== now.getFullYear() ? 'numeric' : undefined\n  })\n}\n\n/**\n * Format a full timestamp for display\n */\nexport function formatFullTimestamp(timestamp: string): string {\n  const date = new Date(timestamp)\n  return date.toLocaleString('en-US', {\n    month: 'short',\n    day: 'numeric',\n    year: 'numeric',\n    hour: 'numeric',\n    minute: '2-digit',\n    hour12: true\n  })\n}\n\n/**\n * Group consecutive messages from the same sender within a time window\n */\nexport interface GroupedMessage extends ConversationMessage {\n  isGroupStart: boolean\n  isGroupEnd: boolean\n  showAvatar: boolean\n  showTimestamp: boolean\n}\n\nexport function groupMessages(\n  messages: ConversationMessage[],\n  groupWindowMinutes = 5\n): GroupedMessage[] {\n  if (messages.length === 0) return []\n  \n  const grouped: GroupedMessage[] = []\n  \n  for (let i = 0; i < messages.length; i++) {\n    const current = messages[i]\n    const prev = i > 0 ? messages[i - 1] : null\n    const next = i < messages.length - 1 ? messages[i + 1] : null\n    \n    // Check if this message should be grouped with the previous one\n    const shouldGroupWithPrev = prev && \n      prev.senderId === current.senderId &&\n      !prev.deletedAt &&\n      !current.deletedAt &&\n      (new Date(current.createdAt).getTime() - new Date(prev.createdAt).getTime()) < (groupWindowMinutes * 60 * 1000)\n    \n    // Check if this message should be grouped with the next one\n    const shouldGroupWithNext = next &&\n      next.senderId === current.senderId &&\n      !next.deletedAt &&\n      !current.deletedAt &&\n      (new Date(next.createdAt).getTime() - new Date(current.createdAt).getTime()) < (groupWindowMinutes * 60 * 1000)\n    \n    grouped.push({\n      ...current,\n      isGroupStart: !shouldGroupWithPrev,\n      isGroupEnd: !shouldGroupWithNext,\n      showAvatar: !shouldGroupWithPrev, // Only show avatar at start of group\n      showTimestamp: !shouldGroupWithNext, // Only show timestamp at end of group\n    })\n  }\n  \n  return grouped\n}\n\n/**\n * Get initials from a name for avatar fallback\n */\nexport function getInitials(name: string | null | undefined): string {\n  if (!name) return '?'\n  \n  const parts = name.trim().split(' ')\n  if (parts.length >= 2) {\n    return `${parts[0][0]}${parts[1][0]}`.toUpperCase()\n  }\n  \n  return name.substring(0, 2).toUpperCase()\n}\n\n/**\n * Truncate text to a maximum length with ellipsis\n */\nexport function truncateText(text: string, maxLength: number): string {\n  if (text.length <= maxLength) return text\n  return text.substring(0, maxLength).trim() + '…'\n}\n\n/**\n * Get date divider label for grouping messages by date\n */\nexport function getDateDivider(timestamp: string): string {\n  const messageDate = new Date(timestamp)\n  const today = new Date()\n  const yesterday = new Date(today)\n  yesterday.setDate(yesterday.getDate() - 1)\n  \n  // Reset time to midnight for comparison\n  const messageDateOnly = new Date(messageDate.getFullYear(), messageDate.getMonth(), messageDate.getDate())\n  const todayOnly = new Date(today.getFullYear(), today.getMonth(), today.getDate())\n  const yesterdayOnly = new Date(yesterday.getFullYear(), yesterday.getMonth(), yesterday.getDate())\n  \n  if (messageDateOnly.getTime() === todayOnly.getTime()) {\n    return 'Today'\n  }\n  \n  if (messageDateOnly.getTime() === yesterdayOnly.getTime()) {\n    return 'Yesterday'\n  }\n  \n  // Within this week\n  const diffDays = Math.floor((todayOnly.getTime() - messageDateOnly.getTime()) / (1000 * 60 * 60 * 24))\n  if (diffDays < 7) {\n    return messageDate.toLocaleDateString('en-US', { weekday: 'long' })\n  }\n  \n  // Older\n  return messageDate.toLocaleDateString('en-US', { \n    month: 'long', \n    day: 'numeric',\n    year: messageDate.getFullYear() !== today.getFullYear() ? 'numeric' : undefined\n  })\n}\n\n/**\n * Check if two messages should have a date divider between them\n */\nexport function shouldShowDateDivider(currentMessage: ConversationMessage, previousMessage?: ConversationMessage): boolean {\n  if (!previousMessage) return true\n  \n  const currentDate = new Date(currentMessage.createdAt)\n  const previousDate = new Date(previousMessage.createdAt)\n  \n  // Different day\n  return currentDate.toDateString() !== previousDate.toDateString()\n}\n\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 352, "column": 0}, "map": {"version":3,"sources":["file:///Users/ghilesmoussaoui/Desktop/Versotech/versotech-portal/src/lib/messaging/index.ts"],"sourcesContent":["export * from './supabase'\nexport * from './selectors'\nexport * from './utils'\n\n\n"],"names":[],"mappings":";AAAA;AACA;AACA"}},
    {"offset": {"line": 366, "column": 0}, "map": {"version":3,"sources":["file:///Users/ghilesmoussaoui/Desktop/Versotech/versotech-portal/src/components/messaging/staff/sidebar.tsx"],"sourcesContent":["import type { ConversationFilters, ConversationSummary } from '@/types/messaging'\nimport { cn } from '@/lib/utils'\nimport { Button } from '@/components/ui/button'\nimport { Badge } from '@/components/ui/badge'\nimport { Input } from '@/components/ui/input'\nimport { Avatar, AvatarFallback, AvatarImage } from '@/components/ui/avatar'\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select'\nimport { Loader2, RefreshCw, MessageSquarePlus, Search } from 'lucide-react'\nimport { useMemo, useState } from 'react'\nimport { applyConversationFilters, sortConversations, formatRelativeTime, getInitials, truncateText } from '@/lib/messaging'\n\ninterface ConversationsSidebarProps {\n  conversations: ConversationSummary[]\n  filters: ConversationFilters\n  onFiltersChange: (filters: ConversationFilters) => void\n  onRefresh: () => void\n  onSelectConversation: (conversationId: string) => void\n  onCreateConversation: (mode: 'dm' | 'group') => void\n  activeConversationId: string | null\n  isLoading: boolean\n  errorMessage: string | null\n  /** If false, hides New Chat/Group buttons. Default: true */\n  canCreateConversation?: boolean\n}\n\nconst VISIBILITY_FILTERS: Array<{ value: ConversationFilters['visibility']; label: string }> = [\n  { value: 'all', label: 'All' },\n  { value: 'investor', label: 'Investor' },\n  { value: 'internal', label: 'Internal' },\n  { value: 'deal', label: 'Deals' },\n]\n\nconst TYPE_FILTERS: Array<{ value: ConversationFilters['type']; label: string }> = [\n  { value: 'all', label: 'All Types' },\n  { value: 'dm', label: 'Direct' },\n  { value: 'group', label: 'Group' },\n  { value: 'deal_room', label: 'Deal Rooms' },\n  { value: 'broadcast', label: 'Broadcasts' },\n]\n\nexport function ConversationsSidebar({\n  conversations,\n  filters,\n  onFiltersChange,\n  onRefresh,\n  onSelectConversation,\n  onCreateConversation,\n  activeConversationId,\n  isLoading,\n  errorMessage,\n  canCreateConversation = true,\n}: ConversationsSidebarProps) {\n  const [searchValue, setSearchValue] = useState(filters.search || '')\n\n  const filteredConversations = useMemo(() => {\n    const nextFilters: ConversationFilters = {\n      ...filters,\n      search: searchValue || undefined,\n    }\n    const filtered = applyConversationFilters(conversations, nextFilters)\n    return sortConversations(filtered)\n  }, [conversations, filters, searchValue])\n\n  const handleVisibilityChange = (value: ConversationFilters['visibility']) => {\n    onFiltersChange({ ...filters, visibility: value })\n  }\n\n  const handleTypeChange = (value: ConversationFilters['type']) => {\n    onFiltersChange({ ...filters, type: value })\n  }\n\n  const toggleUnread = () => {\n    onFiltersChange({ ...filters, unreadOnly: !filters.unreadOnly })\n  }\n\n  const handleSearchChange = (value: string) => {\n    setSearchValue(value)\n    onFiltersChange({ ...filters, search: value || undefined })\n  }\n\n  const unreadTotals = useMemo(() => {\n    const totals: Record<ConversationFilters['visibility'], number> = {\n      all: 0,\n      investor: 0,\n      internal: 0,\n      deal: 0,\n    }\n\n    for (const conversation of conversations) {\n      totals.all += conversation.unreadCount || 0\n      totals[conversation.visibility] += conversation.unreadCount || 0\n    }\n\n    return totals\n  }, [conversations])\n\n  return (\n    <aside className=\"w-full sm:w-[360px] border-r border-border bg-card flex flex-col text-foreground\">\n      <div className=\"p-4 border-b border-border space-y-3\">\n        <div className=\"flex items-center justify-between gap-2 text-foreground\">\n          <div>\n            <h2 className=\"text-lg font-semibold\">Messages</h2>\n            <p className=\"text-xs text-muted-foreground\">Track investor and internal threads</p>\n          </div>\n          <Button\n            variant=\"ghost\"\n            size=\"icon\"\n            onClick={onRefresh}\n            disabled={isLoading}\n            className=\"text-foreground hover:text-foreground hover:bg-muted\"\n          >\n            {isLoading ? <Loader2 className=\"h-4 w-4 animate-spin\" /> : <RefreshCw className=\"h-4 w-4\" />}\n          </Button>\n        </div>\n\n        <div className=\"grid grid-cols-2 gap-2\">\n          <Select value={filters.visibility} onValueChange={handleVisibilityChange}>\n            <SelectTrigger className=\"bg-muted border-border text-foreground\">\n              <SelectValue placeholder=\"Visibility\" />\n            </SelectTrigger>\n            <SelectContent className=\"bg-muted text-popover-foreground border-border\">\n              {VISIBILITY_FILTERS.map(filter => (\n                <SelectItem key={filter.value} value={filter.value}>\n                  <div className=\"flex items-center justify-between gap-2\">\n                    <span>{filter.label}</span>\n                    <Badge variant=\"secondary\" className=\"bg-secondary text-foreground\">\n                      {unreadTotals[filter.value]}\n                    </Badge>\n                  </div>\n                </SelectItem>\n              ))}\n            </SelectContent>\n          </Select>\n\n          <Select value={filters.type} onValueChange={handleTypeChange}>\n            <SelectTrigger className=\"bg-muted border-border text-foreground\">\n              <SelectValue placeholder=\"Type\" />\n            </SelectTrigger>\n            <SelectContent className=\"bg-muted text-popover-foreground border-border\">\n              {TYPE_FILTERS.map(filter => (\n                <SelectItem key={filter.value} value={filter.value}>\n                  {filter.label}\n                </SelectItem>\n              ))}\n            </SelectContent>\n          </Select>\n        </div>\n\n        <div className=\"space-y-2\">\n          <Button\n            variant={filters.unreadOnly ? 'default' : 'outline'}\n            size=\"sm\"\n            className=\"w-full text-popover-foreground\"\n            onClick={toggleUnread}\n          >\n            Unread {filters.unreadOnly ? '' : `(${unreadTotals.all})`}\n          </Button>\n\n          {canCreateConversation && (\n            <div className=\"grid grid-cols-2 gap-2\">\n              <Button\n                size=\"sm\"\n                variant=\"default\"\n                className=\"bg-blue-600 hover:bg-blue-700 text-white\"\n                onClick={() => onCreateConversation('dm')}\n              >\n                <MessageSquarePlus className=\"h-3.5 w-3.5 mr-1.5\" />\n                New Chat\n              </Button>\n              <Button\n                size=\"sm\"\n                variant=\"outline\"\n                className=\"border-border text-popover-foreground hover:bg-muted\"\n                onClick={() => onCreateConversation('group')}\n              >\n                <MessageSquarePlus className=\"h-3.5 w-3.5 mr-1.5\" />\n                New Group\n              </Button>\n            </div>\n          )}\n        </div>\n\n        <Input\n          placeholder=\"Search conversations\"\n          value={searchValue}\n          onChange={event => handleSearchChange(event.target.value)}\n          className=\"bg-muted border-border text-popover-foreground placeholder:text-muted-foreground\"\n        />\n\n        {errorMessage ? (\n          <div className=\"text-xs text-red-300 border border-red-500/40 bg-red-500/10 p-2 rounded\">\n            {errorMessage}\n          </div>\n        ) : null}\n      </div>\n\n      <div className=\"flex-1 overflow-y-auto bg-background\">\n        {filteredConversations.length === 0 ? (\n          <div className=\"flex flex-col items-center justify-center h-full text-muted-foreground text-sm\">\n            {isLoading ? 'Loading conversations…' : 'No conversations match your filters.'}\n          </div>\n        ) : (\n          <ul className=\"p-2 space-y-1\">\n            {filteredConversations.map(conversation => {\n              const isActive = conversation.id === activeConversationId\n              const firstParticipant = conversation.participants[0]\n              const timestamp = conversation.lastMessageAt || conversation.createdAt\n              \n              return (\n                <li key={conversation.id}>\n                  <button\n                    className={cn(\n                      'w-full text-left px-3 py-3 rounded-lg group',\n                      'transition-all duration-200 ease-out',\n                      'hover:bg-muted/80 hover:shadow-md hover:scale-[1.02]',\n                      'focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2',\n                      'active:scale-[0.98]',\n                      isActive ? 'bg-muted shadow-sm scale-[1.01]' : 'bg-transparent'\n                    )}\n                    onClick={() => onSelectConversation(conversation.id)}\n                  >\n                    <div className=\"flex items-start gap-3\">\n                      {/* Avatar */}\n                      <div className=\"relative\">\n                        <Avatar className=\"h-11 w-11 transition-transform duration-200 group-hover:scale-110\">\n                          {firstParticipant?.avatarUrl && (\n                            <AvatarImage src={firstParticipant.avatarUrl} alt={firstParticipant.displayName || firstParticipant.email || 'User'} />\n                          )}\n                          <AvatarFallback className=\"bg-secondary text-foreground text-sm font-medium\">\n                            {getInitials(firstParticipant?.displayName || firstParticipant?.email)}\n                          </AvatarFallback>\n                        </Avatar>\n                        {conversation.unreadCount > 0 && (\n                          <div className=\"absolute -top-1 -right-1 h-5 w-5 rounded-full bg-blue-500 flex items-center justify-center shadow-lg animate-pulse\">\n                            <span className=\"text-[10px] font-bold text-white\">\n                              {conversation.unreadCount > 9 ? '9+' : conversation.unreadCount}\n                            </span>\n                          </div>\n                        )}\n                      </div>\n\n                      {/* Content */}\n                      <div className=\"flex-1 min-w-0\">\n                        <div className=\"flex items-baseline justify-between gap-2 mb-1\">\n                          <span className={cn(\n                            \"font-semibold truncate text-sm\",\n                            conversation.unreadCount > 0 ? \"text-white\" : \"text-foreground\"\n                          )}>\n                            {conversation.subject || 'Untitled Conversation'}\n                          </span>\n                          <span className=\"text-[10px] text-muted-foreground shrink-0\" suppressHydrationWarning>\n                            {formatRelativeTime(timestamp)}\n                          </span>\n                        </div>\n                        \n                        <p className={cn(\n                          \"text-xs truncate\",\n                          conversation.unreadCount > 0 ? \"text-foreground/80 font-medium\" : \"text-muted-foreground\"\n                        )}>\n                          {truncateText(conversation.preview || conversation.latestMessage?.body || 'No messages yet', 60)}\n                        </p>\n                        \n                        <div className=\"flex items-center gap-2 mt-1.5\">\n                          <Badge variant=\"outline\" className=\"text-[10px] capitalize border-border text-muted-foreground px-1.5 py-0\">\n                            {conversation.type.replace('_', ' ')}\n                          </Badge>\n                          {conversation.participants.length > 1 && (\n                            <span className=\"text-[10px] text-muted-foreground\">\n                              {conversation.participants.length} participants\n                            </span>\n                          )}\n                        </div>\n                      </div>\n                    </div>\n                  </button>\n                </li>\n              )\n            })}\n          </ul>\n        )}\n      </div>\n    </aside>\n  )\n}\n\n\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 952, "column": 0}, "map": {"version":3,"sources":["file:///Users/ghilesmoussaoui/Desktop/Versotech/versotech-portal/src/components/messaging/shared/message-bubble.tsx"],"sourcesContent":["'use client'\n\nimport type { ConversationMessage } from '@/types/messaging'\nimport { Avatar, AvatarFallback, AvatarImage } from '@/components/ui/avatar'\nimport { Button } from '@/components/ui/button'\nimport { cn } from '@/lib/utils'\nimport { formatRelativeTime, formatFullTimestamp, getInitials } from '@/lib/messaging/utils'\nimport { CheckCheck, Check, Trash2 } from 'lucide-react'\nimport { motion } from 'framer-motion'\n\ninterface MessageBubbleProps {\n  message: ConversationMessage\n  senderName: string\n  senderEmail?: string | null\n  senderAvatarUrl?: string | null\n  isSelf: boolean\n  isGroupStart: boolean\n  isGroupEnd: boolean\n  showAvatar: boolean\n  showTimestamp: boolean\n  onDelete?: (messageId: string) => void\n}\n\nexport function MessageBubble({\n  message,\n  senderName,\n  senderEmail,\n  senderAvatarUrl,\n  isSelf,\n  isGroupStart,\n  isGroupEnd,\n  showAvatar,\n  showTimestamp,\n  onDelete,\n}: MessageBubbleProps) {\n  \n  if (message.deletedAt) {\n    return (\n      <div className={cn('flex items-center gap-2 py-1', isSelf ? 'justify-end' : 'justify-start')}>\n        <span className=\"text-xs italic text-muted-foreground\">\n          Message deleted\n        </span>\n      </div>\n    )\n  }\n\n  return (\n    <motion.div\n      initial={{ opacity: 0, y: 10, scale: 0.98 }}\n      animate={{ opacity: 1, y: 0, scale: 1 }}\n      transition={{\n        duration: 0.25,\n        ease: [0.25, 0.1, 0.25, 1],\n      }}\n      className={cn(\n        'flex gap-2 group',\n        isSelf ? 'flex-row-reverse' : 'flex-row',\n        !isGroupStart && 'mt-0.5',\n        isGroupStart && 'mt-5'\n      )}\n    >\n      {/* Avatar */}\n      <div className={cn('flex-shrink-0 self-end', !showAvatar && 'w-9')}>\n        {showAvatar ? (\n          <Avatar className=\"h-9 w-9 border-2 border-background shadow-sm transition-transform duration-200 group-hover:scale-110\">\n            {senderAvatarUrl && (\n              <AvatarImage src={senderAvatarUrl} alt={senderName} />\n            )}\n            <AvatarFallback className=\"text-xs bg-muted text-foreground font-medium\">\n              {getInitials(senderName)}\n            </AvatarFallback>\n          </Avatar>\n        ) : null}\n      </div>\n\n      {/* Message Content */}\n      <div className={cn('flex flex-col gap-1 max-w-[75%] md:max-w-[65%] relative', isSelf && 'items-end')}>\n        {/* Delete Button (shows on hover) */}\n        {isSelf && onDelete && !message.deletedAt && (\n          <Button\n            variant=\"ghost\"\n            size=\"icon\"\n            className=\"absolute -left-10 top-1 h-7 w-7 opacity-0 group-hover:opacity-100 transition-opacity text-muted-foreground hover:text-red-500\"\n            onClick={() => onDelete(message.id)}\n          >\n            <Trash2 className=\"h-4 w-4\" />\n          </Button>\n        )}\n        \n        {/* Sender Name (only at group start) */}\n        {isGroupStart && !isSelf && (\n          <span className=\"text-xs font-semibold text-foreground/80 px-2 mb-0.5\">\n            {senderName}\n          </span>\n        )}\n\n        {/* Message Bubble (WhatsApp style) */}\n        <div\n          className={cn(\n            'relative px-3.5 py-2.5 rounded-lg text-[14px] leading-relaxed',\n            'transition-all duration-200 ease-out',\n            isSelf\n              ? 'bg-primary text-primary-foreground shadow-md shadow-primary/20'\n              : 'bg-card text-foreground border border-border shadow-sm',\n            // Rounded corners with tail effect\n            'rounded-tl-2xl rounded-tr-2xl',\n            isSelf ? 'rounded-bl-2xl rounded-br-md' : 'rounded-bl-md rounded-br-2xl',\n            isGroupStart && (isSelf ? 'rounded-br-2xl' : 'rounded-bl-2xl'),\n            'group-hover:shadow-xl group-hover:-translate-y-0.5',\n            isSelf ? 'group-hover:shadow-primary/30' : 'group-hover:shadow-lg',\n            'max-w-full'\n          )}\n          title={formatFullTimestamp(message.createdAt)}\n        >\n          <div className=\"flex flex-col\">\n            <p className=\"whitespace-pre-wrap break-words\">\n              {message.body}\n            </p>\n            \n            {/* Inline metadata (WhatsApp style - time in corner) */}\n            <div className={cn(\n              'flex items-center gap-1 mt-1 justify-end select-none',\n              isSelf ? 'text-primary-foreground/60' : 'text-muted-foreground/70'\n            )}>\n              {message.editedAt && (\n                <span className=\"text-[9px] italic mr-1\">Edited</span>\n              )}\n              <span className=\"text-[9px] font-medium\">\n                {new Date(message.createdAt).toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit', hour12: true })}\n              </span>\n              {isSelf && (\n                <span className=\"ml-0.5\">\n                  {message.readBy && message.readBy.length > 0 \n                    ? <CheckCheck className=\"h-3.5 w-3.5\" />\n                    : <Check className=\"h-3.5 w-3.5\" />\n                  }\n                </span>\n              )}\n            </div>\n          </div>\n        </div>\n      </div>\n    </motion.div>\n  )\n}\n\n"],"names":[],"mappings":";;;;;AAGA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AARA;;;;;;;;AAuBO,SAAS,cAAc,EAC5B,OAAO,EACP,UAAU,EACV,WAAW,EACX,eAAe,EACf,MAAM,EACN,YAAY,EACZ,UAAU,EACV,UAAU,EACV,aAAa,EACb,QAAQ,EACW;IAEnB,IAAI,QAAQ,SAAS,EAAE;QACrB,qBACE,oNAAC;YAAI,WAAW,IAAA,mJAAE,EAAC,gCAAgC,SAAS,gBAAgB;sBAC1E,cAAA,oNAAC;gBAAK,WAAU;0BAAuC;;;;;;;;;;;IAK7D;IAEA,qBACE,oNAAC,8NAAM,CAAC,GAAG;QACT,SAAS;YAAE,SAAS;YAAG,GAAG;YAAI,OAAO;QAAK;QAC1C,SAAS;YAAE,SAAS;YAAG,GAAG;YAAG,OAAO;QAAE;QACtC,YAAY;YACV,UAAU;YACV,MAAM;gBAAC;gBAAM;gBAAK;gBAAM;aAAE;QAC5B;QACA,WAAW,IAAA,mJAAE,EACX,oBACA,SAAS,qBAAqB,YAC9B,CAAC,gBAAgB,UACjB,gBAAgB;;0BAIlB,oNAAC;gBAAI,WAAW,IAAA,mJAAE,EAAC,0BAA0B,CAAC,cAAc;0BACzD,2BACC,oNAAC,sKAAM;oBAAC,WAAU;;wBACf,iCACC,oNAAC,2KAAW;4BAAC,KAAK;4BAAiB,KAAK;;;;;;sCAE1C,oNAAC,8KAAc;4BAAC,WAAU;sCACvB,IAAA,yKAAW,EAAC;;;;;;;;;;;2BAGf;;;;;;0BAIN,oNAAC;gBAAI,WAAW,IAAA,mJAAE,EAAC,2DAA2D,UAAU;;oBAErF,UAAU,YAAY,CAAC,QAAQ,SAAS,kBACvC,oNAAC,sKAAM;wBACL,SAAQ;wBACR,MAAK;wBACL,WAAU;wBACV,SAAS,IAAM,SAAS,QAAQ,EAAE;kCAElC,cAAA,oNAAC,8OAAM;4BAAC,WAAU;;;;;;;;;;;oBAKrB,gBAAgB,CAAC,wBAChB,oNAAC;wBAAK,WAAU;kCACb;;;;;;kCAKL,oNAAC;wBACC,WAAW,IAAA,mJAAE,EACX,iEACA,wCACA,SACI,mEACA,0DACJ,mCAAmC;wBACnC,iCACA,SAAS,iCAAiC,gCAC1C,gBAAgB,CAAC,SAAS,mBAAmB,gBAAgB,GAC7D,sDACA,SAAS,kCAAkC,yBAC3C;wBAEF,OAAO,IAAA,iLAAmB,EAAC,QAAQ,SAAS;kCAE5C,cAAA,oNAAC;4BAAI,WAAU;;8CACb,oNAAC;oCAAE,WAAU;8CACV,QAAQ,IAAI;;;;;;8CAIf,oNAAC;oCAAI,WAAW,IAAA,mJAAE,EAChB,wDACA,SAAS,+BAA+B;;wCAEvC,QAAQ,QAAQ,kBACf,oNAAC;4CAAK,WAAU;sDAAyB;;;;;;sDAE3C,oNAAC;4CAAK,WAAU;sDACb,IAAI,KAAK,QAAQ,SAAS,EAAE,kBAAkB,CAAC,SAAS;gDAAE,MAAM;gDAAW,QAAQ;gDAAW,QAAQ;4CAAK;;;;;;wCAE7G,wBACC,oNAAC;4CAAK,WAAU;sDACb,QAAQ,MAAM,IAAI,QAAQ,MAAM,CAAC,MAAM,GAAG,kBACvC,oNAAC,0PAAU;gDAAC,WAAU;;;;;qEACtB,oNAAC,uOAAK;gDAAC,WAAU;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAUvC;KAzHgB"}},
    {"offset": {"line": 1171, "column": 0}, "map": {"version":3,"sources":["file:///Users/ghilesmoussaoui/Desktop/Versotech/versotech-portal/src/components/messaging/message-skeleton.tsx"],"sourcesContent":["import { cn } from '@/lib/utils'\r\n\r\ninterface MessageSkeletonProps {\r\n  isSent?: boolean\r\n  count?: number\r\n}\r\n\r\nfunction SingleMessageSkeleton({ isSent = false }: { isSent?: boolean }) {\r\n  return (\r\n    <div\r\n      className={cn(\r\n        'flex gap-3 animate-pulse',\r\n        isSent ? 'justify-end' : 'justify-start'\r\n      )}\r\n    >\r\n      {!isSent && (\r\n        <div className=\"h-8 w-8 rounded-full bg-muted/60 shrink-0\" />\r\n      )}\r\n      <div\r\n        className={cn(\r\n          'flex flex-col gap-2 max-w-[70%]',\r\n          isSent ? 'items-end' : 'items-start'\r\n        )}\r\n      >\r\n        {!isSent && <div className=\"h-3 w-24 bg-muted/60 rounded\" />}\r\n        <div\r\n          className={cn(\r\n            'rounded-2xl bg-muted/60',\r\n            isSent ? 'rounded-br-md' : 'rounded-bl-md',\r\n            'h-20 w-full min-w-[200px]'\r\n          )}\r\n        />\r\n        <div className=\"h-2 w-16 bg-muted/40 rounded\" />\r\n      </div>\r\n      {isSent && (\r\n        <div className=\"h-8 w-8 rounded-full bg-muted/60 shrink-0\" />\r\n      )}\r\n    </div>\r\n  )\r\n}\r\n\r\nexport function MessageSkeleton({ isSent, count = 3 }: MessageSkeletonProps) {\r\n  return (\r\n    <div className=\"space-y-4 p-4\">\r\n      {Array.from({ length: count }).map((_, i) => (\r\n        <SingleMessageSkeleton\r\n          key={i}\r\n          isSent={isSent !== undefined ? isSent : i % 2 === 0}\r\n        />\r\n      ))}\r\n    </div>\r\n  )\r\n}\r\n"],"names":[],"mappings":";;;;;AAAA;;;AAOA,SAAS,sBAAsB,EAAE,SAAS,KAAK,EAAwB;IACrE,qBACE,oNAAC;QACC,WAAW,IAAA,mJAAE,EACX,4BACA,SAAS,gBAAgB;;YAG1B,CAAC,wBACA,oNAAC;gBAAI,WAAU;;;;;;0BAEjB,oNAAC;gBACC,WAAW,IAAA,mJAAE,EACX,mCACA,SAAS,cAAc;;oBAGxB,CAAC,wBAAU,oNAAC;wBAAI,WAAU;;;;;;kCAC3B,oNAAC;wBACC,WAAW,IAAA,mJAAE,EACX,2BACA,SAAS,kBAAkB,iBAC3B;;;;;;kCAGJ,oNAAC;wBAAI,WAAU;;;;;;;;;;;;YAEhB,wBACC,oNAAC;gBAAI,WAAU;;;;;;;;;;;;AAIvB;KAhCS;AAkCF,SAAS,gBAAgB,EAAE,MAAM,EAAE,QAAQ,CAAC,EAAwB;IACzE,qBACE,oNAAC;QAAI,WAAU;kBACZ,MAAM,IAAI,CAAC;YAAE,QAAQ;QAAM,GAAG,GAAG,CAAC,CAAC,GAAG,kBACrC,oNAAC;gBAEC,QAAQ,WAAW,YAAY,SAAS,IAAI,MAAM;eAD7C;;;;;;;;;;AAMf;MAXgB"}},
    {"offset": {"line": 1264, "column": 0}, "map": {"version":3,"sources":["file:///Users/ghilesmoussaoui/Desktop/Versotech/versotech-portal/src/components/ui/auto-expand-textarea.tsx"],"sourcesContent":["'use client'\r\n\r\nimport * as React from 'react'\r\nimport { cn } from '@/lib/utils'\r\n\r\nexport type AutoExpandTextareaProps = React.TextareaHTMLAttributes<HTMLTextAreaElement>\r\n\r\nconst AutoExpandTextarea = React.forwardRef<HTMLTextAreaElement, AutoExpandTextareaProps>(\r\n  ({ className, onChange, ...props }, ref) => {\r\n    const textareaRef = React.useRef<HTMLTextAreaElement | null>(null)\r\n\r\n    const adjustHeight = React.useCallback(() => {\r\n      const textarea = textareaRef.current\r\n      if (textarea) {\r\n        textarea.style.height = 'auto'\r\n        textarea.style.height = `${textarea.scrollHeight}px`\r\n      }\r\n    }, [])\r\n\r\n    React.useEffect(() => {\r\n      adjustHeight()\r\n    }, [props.value, adjustHeight])\r\n\r\n    const handleChange = (e: React.ChangeEvent<HTMLTextAreaElement>) => {\r\n      adjustHeight()\r\n      onChange?.(e)\r\n    }\r\n\r\n    const setRefs = React.useCallback(\r\n      (node: HTMLTextAreaElement | null) => {\r\n        textareaRef.current = node\r\n        if (typeof ref === 'function') {\r\n          ref(node)\r\n        } else if (ref) {\r\n          ref.current = node\r\n        }\r\n      },\r\n      [ref]\r\n    )\r\n\r\n    return (\r\n      <textarea\r\n        ref={setRefs}\r\n        className={cn(\r\n          'flex min-h-[44px] max-h-[200px] w-full rounded-md border border-input',\r\n          'bg-background px-3 py-2 text-sm ring-offset-background',\r\n          'placeholder:text-muted-foreground',\r\n          'focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2',\r\n          'disabled:cursor-not-allowed disabled:opacity-50',\r\n          'resize-none overflow-y-auto',\r\n          'transition-all duration-200 ease-out',\r\n          className\r\n        )}\r\n        onChange={handleChange}\r\n        {...props}\r\n      />\r\n    )\r\n  }\r\n)\r\nAutoExpandTextarea.displayName = 'AutoExpandTextarea'\r\n\r\nexport { AutoExpandTextarea }\r\n"],"names":[],"mappings":";;;;;AAEA;AACA;;;AAHA;;;AAOA,MAAM,mCAAqB,GAAA,kMAAgB,SACzC,CAAC,EAAE,SAAS,EAAE,QAAQ,EAAE,GAAG,OAAO,EAAE;;IAClC,MAAM,cAAc,8LAAY,CAA6B;IAE7D,MAAM,eAAe,mMAAiB;wDAAC;YACrC,MAAM,WAAW,YAAY,OAAO;YACpC,IAAI,UAAU;gBACZ,SAAS,KAAK,CAAC,MAAM,GAAG;gBACxB,SAAS,KAAK,CAAC,MAAM,GAAG,GAAG,SAAS,YAAY,CAAC,EAAE,CAAC;YACtD;QACF;uDAAG,EAAE;IAEL,iMAAe;wCAAC;YACd;QACF;uCAAG;QAAC,MAAM,KAAK;QAAE;KAAa;IAE9B,MAAM,eAAe,CAAC;QACpB;QACA,WAAW;IACb;IAEA,MAAM,UAAU,mMAAiB;mDAC/B,CAAC;YACC,YAAY,OAAO,GAAG;YACtB,IAAI,OAAO,QAAQ,YAAY;gBAC7B,IAAI;YACN,OAAO,IAAI,KAAK;gBACd,IAAI,OAAO,GAAG;YAChB;QACF;kDACA;QAAC;KAAI;IAGP,qBACE,oNAAC;QACC,KAAK;QACL,WAAW,IAAA,mJAAE,EACX,yEACA,0DACA,qCACA,uGACA,mDACA,+BACA,wCACA;QAEF,UAAU;QACT,GAAG,KAAK;;;;;;AAGf;;AAEF,mBAAmB,WAAW,GAAG"}},
    {"offset": {"line": 1336, "column": 0}, "map": {"version":3,"sources":["file:///Users/ghilesmoussaoui/Desktop/Versotech/versotech-portal/src/components/ui/scroll-area.tsx"],"sourcesContent":["\"use client\"\n\nimport * as React from \"react\"\nimport * as ScrollAreaPrimitive from \"@radix-ui/react-scroll-area\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ScrollArea = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <ScrollAreaPrimitive.Root\n    ref={ref}\n    className={cn(\"relative overflow-hidden\", className)}\n    {...props}\n  >\n    <ScrollAreaPrimitive.Viewport className=\"h-full w-full rounded-[inherit]\">\n      {children}\n    </ScrollAreaPrimitive.Viewport>\n    <ScrollBar />\n    <ScrollAreaPrimitive.Corner />\n  </ScrollAreaPrimitive.Root>\n))\nScrollArea.displayName = ScrollAreaPrimitive.Root.displayName\n\nconst ScrollBar = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>\n>(({ className, orientation = \"vertical\", ...props }, ref) => (\n  <ScrollAreaPrimitive.ScrollAreaScrollbar\n    ref={ref}\n    orientation={orientation}\n    className={cn(\n      \"flex touch-none select-none transition-colors\",\n      orientation === \"vertical\" &&\n        \"h-full w-2.5 border-l border-l-transparent p-[1px]\",\n      orientation === \"horizontal\" &&\n        \"h-2.5 flex-col border-t border-t-transparent p-[1px]\",\n      className\n    )}\n    {...props}\n  >\n    <ScrollAreaPrimitive.ScrollAreaThumb className=\"relative flex-1 rounded-full bg-border\" />\n  </ScrollAreaPrimitive.ScrollAreaScrollbar>\n))\nScrollBar.displayName = ScrollAreaPrimitive.ScrollAreaScrollbar.displayName\n\nexport { ScrollArea, ScrollBar }\n"],"names":[],"mappings":";;;;;;;AAEA;AACA;AAEA;AALA;;;;;AAOA,MAAM,2BAAa,kMAAgB,MAGjC,CAAC,EAAE,SAAS,EAAE,QAAQ,EAAE,GAAG,OAAO,EAAE,oBACpC,oNAAC,4MAAwB;QACvB,KAAK;QACL,WAAW,IAAA,mJAAE,EAAC,4BAA4B;QACzC,GAAG,KAAK;;0BAET,oNAAC,gNAA4B;gBAAC,WAAU;0BACrC;;;;;;0BAEH,oNAAC;;;;;0BACD,oNAAC,8MAA0B;;;;;;;;;;;;AAG/B,WAAW,WAAW,GAAG,4MAAwB,CAAC,WAAW;AAE7D,MAAM,0BAAY,kMAAgB,CAGhC,CAAC,EAAE,SAAS,EAAE,cAAc,UAAU,EAAE,GAAG,OAAO,EAAE,oBACpD,oNAAC,2NAAuC;QACtC,KAAK;QACL,aAAa;QACb,WAAW,IAAA,mJAAE,EACX,iDACA,gBAAgB,cACd,sDACF,gBAAgB,gBACd,wDACF;QAED,GAAG,KAAK;kBAET,cAAA,oNAAC,uNAAmC;YAAC,WAAU;;;;;;;;;;;MAjB7C;AAoBN,UAAU,WAAW,GAAG,2NAAuC,CAAC,WAAW"}},
    {"offset": {"line": 1413, "column": 0}, "map": {"version":3,"sources":["file:///Users/ghilesmoussaoui/Desktop/Versotech/versotech-portal/src/components/ui/alert-dialog.tsx"],"sourcesContent":["\"use client\"\n\nimport * as React from \"react\"\nimport * as AlertDialogPrimitive from \"@radix-ui/react-alert-dialog\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nfunction AlertDialog({\n  ...props\n}: React.ComponentProps<typeof AlertDialogPrimitive.Root>) {\n  return <AlertDialogPrimitive.Root data-slot=\"alert-dialog\" {...props} />\n}\n\nfunction AlertDialogTrigger({\n  ...props\n}: React.ComponentProps<typeof AlertDialogPrimitive.Trigger>) {\n  return (\n    <AlertDialogPrimitive.Trigger data-slot=\"alert-dialog-trigger\" {...props} />\n  )\n}\n\nfunction AlertDialogPortal({\n  ...props\n}: React.ComponentProps<typeof AlertDialogPrimitive.Portal>) {\n  return (\n    <AlertDialogPrimitive.Portal data-slot=\"alert-dialog-portal\" {...props} />\n  )\n}\n\nfunction AlertDialogOverlay({\n  className,\n  ...props\n}: React.ComponentProps<typeof AlertDialogPrimitive.Overlay>) {\n  return (\n    <AlertDialogPrimitive.Overlay\n      data-slot=\"alert-dialog-overlay\"\n      className={cn(\n        \"data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/80 backdrop-blur-sm\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction AlertDialogContent({\n  className,\n  ...props\n}: React.ComponentProps<typeof AlertDialogPrimitive.Content>) {\n  return (\n    <AlertDialogPortal>\n      <AlertDialogOverlay />\n      <AlertDialogPrimitive.Content\n        data-slot=\"alert-dialog-content\"\n        className={cn(\n          \"bg-background border-border text-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg backdrop-blur-xl\",\n          className\n        )}\n        {...props}\n      />\n    </AlertDialogPortal>\n  )\n}\n\nfunction AlertDialogHeader({\n  className,\n  ...props\n}: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"alert-dialog-header\"\n      className={cn(\"flex flex-col gap-2 text-center sm:text-left\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction AlertDialogFooter({\n  className,\n  ...props\n}: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"alert-dialog-footer\"\n      className={cn(\n        \"flex flex-col-reverse gap-2 sm:flex-row sm:justify-end\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction AlertDialogTitle({\n  className,\n  ...props\n}: React.ComponentProps<typeof AlertDialogPrimitive.Title>) {\n  return (\n    <AlertDialogPrimitive.Title\n      data-slot=\"alert-dialog-title\"\n      className={cn(\"text-lg font-semibold text-foreground\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction AlertDialogDescription({\n  className,\n  ...props\n}: React.ComponentProps<typeof AlertDialogPrimitive.Description>) {\n  return (\n    <AlertDialogPrimitive.Description\n      data-slot=\"alert-dialog-description\"\n      className={cn(\"text-muted-foreground text-sm\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction AlertDialogAction({\n  className,\n  ...props\n}: React.ComponentProps<typeof AlertDialogPrimitive.Action>) {\n  return (\n    <AlertDialogPrimitive.Action\n      className={cn(buttonVariants(), className)}\n      {...props}\n    />\n  )\n}\n\nfunction AlertDialogCancel({\n  className,\n  ...props\n}: React.ComponentProps<typeof AlertDialogPrimitive.Cancel>) {\n  return (\n    <AlertDialogPrimitive.Cancel\n      className={cn(buttonVariants({ variant: \"outline\" }), className)}\n      {...props}\n    />\n  )\n}\n\nexport {\n  AlertDialog,\n  AlertDialogPortal,\n  AlertDialogOverlay,\n  AlertDialogTrigger,\n  AlertDialogContent,\n  AlertDialogHeader,\n  AlertDialogFooter,\n  AlertDialogTitle,\n  AlertDialogDescription,\n  AlertDialogAction,\n  AlertDialogCancel,\n}\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;AAGA;AAEA;AACA;AANA;;;;;AAQA,SAAS,YAAY,EACnB,GAAG,OACoD;IACvD,qBAAO,oNAAC,6MAAyB;QAAC,aAAU;QAAgB,GAAG,KAAK;;;;;;AACtE;KAJS;AAMT,SAAS,mBAAmB,EAC1B,GAAG,OACuD;IAC1D,qBACE,oNAAC,gNAA4B;QAAC,aAAU;QAAwB,GAAG,KAAK;;;;;;AAE5E;MANS;AAQT,SAAS,kBAAkB,EACzB,GAAG,OACsD;IACzD,qBACE,oNAAC,+MAA2B;QAAC,aAAU;QAAuB,GAAG,KAAK;;;;;;AAE1E;MANS;AAQT,SAAS,mBAAmB,EAC1B,SAAS,EACT,GAAG,OACuD;IAC1D,qBACE,oNAAC,gNAA4B;QAC3B,aAAU;QACV,WAAW,IAAA,mJAAE,EACX,2KACA;QAED,GAAG,KAAK;;;;;;AAGf;MAdS;AAgBT,SAAS,mBAAmB,EAC1B,SAAS,EACT,GAAG,OACuD;IAC1D,qBACE,oNAAC;;0BACC,oNAAC;;;;;0BACD,oNAAC,gNAA4B;gBAC3B,aAAU;gBACV,WAAW,IAAA,mJAAE,EACX,8ZACA;gBAED,GAAG,KAAK;;;;;;;;;;;;AAIjB;MAjBS;AAmBT,SAAS,kBAAkB,EACzB,SAAS,EACT,GAAG,OACyB;IAC5B,qBACE,oNAAC;QACC,aAAU;QACV,WAAW,IAAA,mJAAE,EAAC,gDAAgD;QAC7D,GAAG,KAAK;;;;;;AAGf;MAXS;AAaT,SAAS,kBAAkB,EACzB,SAAS,EACT,GAAG,OACyB;IAC5B,qBACE,oNAAC;QACC,aAAU;QACV,WAAW,IAAA,mJAAE,EACX,0DACA;QAED,GAAG,KAAK;;;;;;AAGf;MAdS;AAgBT,SAAS,iBAAiB,EACxB,SAAS,EACT,GAAG,OACqD;IACxD,qBACE,oNAAC,8MAA0B;QACzB,aAAU;QACV,WAAW,IAAA,mJAAE,EAAC,yCAAyC;QACtD,GAAG,KAAK;;;;;;AAGf;MAXS;AAaT,SAAS,uBAAuB,EAC9B,SAAS,EACT,GAAG,OAC2D;IAC9D,qBACE,oNAAC,oNAAgC;QAC/B,aAAU;QACV,WAAW,IAAA,mJAAE,EAAC,iCAAiC;QAC9C,GAAG,KAAK;;;;;;AAGf;MAXS;AAaT,SAAS,kBAAkB,EACzB,SAAS,EACT,GAAG,OACsD;IACzD,qBACE,oNAAC,+MAA2B;QAC1B,WAAW,IAAA,mJAAE,EAAC,IAAA,8KAAc,KAAI;QAC/B,GAAG,KAAK;;;;;;AAGf;MAVS;AAYT,SAAS,kBAAkB,EACzB,SAAS,EACT,GAAG,OACsD;IACzD,qBACE,oNAAC,+MAA2B;QAC1B,WAAW,IAAA,mJAAE,EAAC,IAAA,8KAAc,EAAC;YAAE,SAAS;QAAU,IAAI;QACrD,GAAG,KAAK;;;;;;AAGf;OAVS"}},
    {"offset": {"line": 1608, "column": 0}, "map": {"version":3,"sources":["file:///Users/ghilesmoussaoui/Desktop/Versotech/versotech-portal/src/components/messaging/staff/conversation-view.tsx"],"sourcesContent":["'use client'\n\nimport type { ConversationSummary, ConversationMessage } from '@/types/messaging'\nimport { useEffect, useMemo, useState, useRef } from 'react'\nimport { fetchConversationMessages, markConversationRead, subscribeToConversationUpdates } from '@/lib/messaging'\nimport { groupMessages, getInitials, formatRelativeTime, getDateDivider, shouldShowDateDivider } from '@/lib/messaging/utils'\nimport { MessageBubble } from '@/components/messaging/shared/message-bubble'\nimport { MessageSkeleton } from '@/components/messaging/message-skeleton'\nimport { AutoExpandTextarea } from '@/components/ui/auto-expand-textarea'\nimport { Avatar, AvatarFallback, AvatarImage } from '@/components/ui/avatar'\nimport { ScrollArea } from '@/components/ui/scroll-area'\nimport { Badge } from '@/components/ui/badge'\nimport { Button } from '@/components/ui/button'\nimport { cn } from '@/lib/utils'\nimport { Send, Paperclip, MoreVertical, Users, Smile, Trash2, MessageSquare } from 'lucide-react'\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuSeparator,\n  DropdownMenuTrigger,\n} from '@/components/ui/dropdown-menu'\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n} from '@/components/ui/alert-dialog'\n\ninterface ConversationViewProps {\n  conversation: ConversationSummary\n  currentUserId: string\n  onRead?: () => void\n  onError?: (message: string) => void\n  onDelete?: (conversationId: string) => void\n}\n\nexport function ConversationView({ conversation, currentUserId, onRead, onError, onDelete }: ConversationViewProps) {\n  const [messages, setMessages] = useState<ConversationMessage[]>([])\n  const [isLoading, setIsLoading] = useState(true)\n  const [composerMessage, setComposerMessage] = useState('')\n  const [isSending, setIsSending] = useState(false)\n  const [showDeleteDialog, setShowDeleteDialog] = useState(false)\n  const [messageToDelete, setMessageToDelete] = useState<string | null>(null)\n  const scrollAreaRef = useRef<HTMLDivElement>(null)\n  const messagesEndRef = useRef<HTMLDivElement>(null)\n\n  console.log('[ConversationView] Rendering with', messages.length, 'messages for conversation:', conversation.id)\n  \n  const handleDeleteConversation = async () => {\n    try {\n      const response = await fetch(`/api/conversations/${conversation.id}`, {\n        method: 'DELETE',\n      })\n      \n      if (!response.ok) {\n        throw new Error('Failed to delete conversation')\n      }\n      \n      onDelete?.(conversation.id)\n      setShowDeleteDialog(false)\n    } catch (error: any) {\n      onError?.(error.message || 'Failed to delete conversation')\n    }\n  }\n  \n  const handleDeleteMessage = async (messageId: string) => {\n    try {\n      const response = await fetch(`/api/conversations/${conversation.id}/messages/${messageId}`, {\n        method: 'DELETE',\n      })\n      \n      if (!response.ok) {\n        throw new Error('Failed to delete message')\n      }\n      \n      // Remove message from local state\n      setMessages(prev => prev.filter(m => m.id !== messageId))\n      setMessageToDelete(null)\n    } catch (error: any) {\n      onError?.(error.message || 'Failed to delete message')\n    }\n  }\n\n  const participantsLookup = useMemo(() => {\n    const map = new Map<string, { name: string, email: string | null }>()\n    conversation.participants.forEach(participant => {\n      if (participant.id) {\n        map.set(participant.id, {\n          name: participant.displayName || participant.email || 'Unknown User',\n          email: participant.email\n        })\n      }\n    })\n    // Also add current user if not in participants\n    if (currentUserId && !map.has(currentUserId)) {\n      map.set(currentUserId, { name: 'You', email: null })\n    }\n    return map\n  }, [conversation.participants, currentUserId])\n\n  // Group messages for better visual flow\n  const groupedMessages = useMemo(() => {\n    return groupMessages(messages)\n  }, [messages])\n\n  // Auto-scroll to bottom when messages change\n  useEffect(() => {\n    console.log('[ConversationView] Auto-scroll triggered, messages:', messages.length)\n    if (messages.length > 0 && messagesEndRef.current) {\n      console.log('[ConversationView] Scrolling to bottom')\n      messagesEndRef.current.scrollIntoView({ behavior: 'smooth' })\n    }\n  }, [messages])\n\n  // Load initial messages\n  useEffect(() => {\n    let isMounted = true\n    setIsLoading(true)\n    setMessages([])\n    \n    fetchConversationMessages(conversation.id, { limit: 200 })\n      .then(data => {\n        if (!isMounted) return\n        setMessages(data)\n        onRead?.()\n        markConversationRead(conversation.id).catch(console.error)\n      })\n      .catch(error => {\n        console.error('Load messages error', error)\n      })\n      .finally(() => {\n        if (isMounted) setIsLoading(false)\n      })\n\n    return () => {\n      isMounted = false\n    }\n  }, [conversation.id, onRead])\n\n  // Handle message sending with optimistic update\n  const handleSend = async () => {\n    if (!composerMessage.trim()) return\n    \n    console.log('[ConversationView] Sending message:', composerMessage)\n    setIsSending(true)\n\n    try {\n      const response = await fetch(`/api/conversations/${conversation.id}/messages`, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ body: composerMessage }),\n      })\n\n      if (!response.ok) {\n        const error = await response.json().catch(() => null)\n        throw new Error(error?.error || 'Failed to send message')\n      }\n\n      const result = await response.json()\n      console.log('[ConversationView] Message sent, adding optimistically:', result.message)\n      \n      // Add message optimistically\n      if (result.message) {\n        setMessages(prev => {\n          if (prev.some(m => m.id === result.message.id)) return prev\n          return [...prev, result.message]\n        })\n      }\n      \n      setComposerMessage('')\n    } catch (error: any) {\n      console.error('[ConversationView] Send error:', error)\n      onError?.(error.message || 'Failed to send message')\n    } finally {\n      setIsSending(false)\n    }\n  }\n\n  const handleKeyDown = (event: React.KeyboardEvent<HTMLTextAreaElement>) => {\n    if (event.key === 'Enter' && (event.ctrlKey || event.metaKey)) {\n      event.preventDefault()\n      handleSend()\n    }\n  }\n\n  // Subscribe to new messages in realtime (for messages from OTHER users)\n  useEffect(() => {\n    console.log('[ConversationView] Setting up realtime for conversation:', conversation.id)\n    \n    const cleanup = subscribeToConversationUpdates(conversation.id, {\n      onMessage: (newMessage) => {\n        console.log('[ConversationView] Received new message from realtime:', newMessage)\n        setMessages(prev => {\n          console.log('[ConversationView] Current messages before add:', prev.length)\n          // Avoid duplicates\n          if (prev.some(m => m.id === newMessage.id)) {\n            console.log('[ConversationView] Message already exists, skipping')\n            return prev\n          }\n          console.log('[ConversationView] Adding realtime message to list')\n          const updated = [...prev, newMessage]\n          console.log('[ConversationView] Messages after add:', updated.length)\n          return updated\n        })\n        // Mark as read if we&apos;re viewing\n        markConversationRead(conversation.id).catch(console.error)\n      }\n    })\n\n    return () => {\n      console.log('[ConversationView] Cleaning up realtime for conversation:', conversation.id)\n      cleanup()\n    }\n  }, [conversation.id])\n\n  return (\n    <div className=\"flex-1 flex flex-col min-h-0\">\n      {/* Enhanced Header */}\n      <header className=\"relative z-10 border-b border-border bg-card px-6 py-4\">\n        <div className=\"flex items-center justify-between\">\n          <div className=\"flex items-center gap-3\">\n            {/* Participant Avatars */}\n            <div className=\"flex -space-x-2\">\n              {conversation.participants.slice(0, 3).map((participant, idx) => (\n                <Avatar key={participant.id} className=\"h-9 w-9 border-2 border-background\">\n                  {participant.avatarUrl && (\n                    <AvatarImage src={participant.avatarUrl} alt={participant.displayName || participant.email || 'User'} />\n                  )}\n                  <AvatarFallback className=\"text-xs bg-muted text-foreground\">\n                    {getInitials(participant.displayName || participant.email)}\n                  </AvatarFallback>\n                </Avatar>\n              ))}\n              {conversation.participants.length > 3 && (\n                <Avatar className=\"h-9 w-9 border-2 border-background\">\n                  <AvatarFallback className=\"text-xs bg-muted text-foreground\">\n                    +{conversation.participants.length - 3}\n                  </AvatarFallback>\n                </Avatar>\n              )}\n            </div>\n            \n            {/* Conversation Info */}\n            <div className=\"flex-1\">\n              <h3 className=\"text-base font-semibold text-foreground\">\n                {conversation.subject || 'Untitled Conversation'}\n              </h3>\n              <div className=\"flex items-center gap-2 text-xs text-muted-foreground\">\n                <Users className=\"h-3 w-3\" />\n                <span>{conversation.participants.length} participant{conversation.participants.length !== 1 ? 's' : ''}</span>\n              </div>\n            </div>\n          </div>\n\n          {/* Actions */}\n          <div className=\"flex items-center gap-2\">\n            <Badge variant=\"outline\" className=\"capitalize border-border text-foreground\">\n              {conversation.type.replace('_', ' ')}\n            </Badge>\n            \n            <DropdownMenu>\n              <DropdownMenuTrigger asChild>\n                <Button variant=\"ghost\" size=\"icon\" className=\"h-8 w-8\">\n                  <MoreVertical className=\"h-4 w-4\" />\n                </Button>\n              </DropdownMenuTrigger>\n              <DropdownMenuContent align=\"end\" className=\"w-48\">\n                <DropdownMenuItem className=\"cursor-pointer\">\n                  View Details\n                </DropdownMenuItem>\n                <DropdownMenuItem className=\"cursor-pointer\">\n                  Mute Notifications\n                </DropdownMenuItem>\n                <DropdownMenuSeparator />\n                <DropdownMenuItem \n                  className=\"cursor-pointer text-red-600 focus:text-red-600\"\n                  onClick={() => setShowDeleteDialog(true)}\n                >\n                  <Trash2 className=\"h-4 w-4 mr-2\" />\n                  Delete Conversation\n                </DropdownMenuItem>\n              </DropdownMenuContent>\n            </DropdownMenu>\n          </div>\n        </div>\n      </header>\n\n      <ScrollArea className=\"flex-1 min-h-0 bg-muted/20\">\n        <div className=\"px-4 py-6 md:px-8\">\n          {isLoading ? (\n            <MessageSkeleton count={3} />\n          ) : messages.length === 0 ? (\n            <div className=\"flex flex-col items-center justify-center h-full min-h-[400px] text-center px-4\">\n              <div className=\"relative mb-6\">\n                <div className=\"rounded-full bg-gradient-to-br from-primary/10 to-primary/5 p-8 backdrop-blur-sm border border-primary/10\">\n                  <MessageSquare className=\"h-12 w-12 text-primary/60\" />\n                </div>\n                <div className=\"absolute -top-1 -right-1 h-4 w-4 rounded-full bg-primary/20 animate-ping\" />\n              </div>\n              <h3 className=\"text-xl font-semibold text-foreground mb-2\">\n                Start the Conversation\n              </h3>\n              <p className=\"text-sm text-muted-foreground max-w-md leading-relaxed\">\n                No messages yet. Break the ice and send the first message to{' '}\n                <span className=\"font-medium text-foreground\">\n                  {conversation.participants.filter(p => p.id !== currentUserId)[0]?.displayName || 'your team'}\n                </span>\n                .\n              </p>\n            </div>\n          ) : (\n            <div className=\"space-y-0\">\n              {groupedMessages.map((message, index) => {\n                const isSelf = message.senderId === currentUserId\n                const senderInfo = message.sender?.displayName \n                  ? { name: message.sender.displayName, email: message.sender.email }\n                  : participantsLookup.get(message.senderId || '')\n                const displayName = senderInfo?.name || 'Unknown User'\n                \n                // Check if we need a date divider\n                const previousMessage = index > 0 ? groupedMessages[index - 1] : undefined\n                const showDivider = shouldShowDateDivider(message, previousMessage)\n\n                return (\n                  <div key={message.id}>\n                    {/* Date Divider (WhatsApp/Slack style) */}\n                    {showDivider && (\n                      <div className=\"flex items-center justify-center my-6\">\n                        <div className=\"px-3 py-1 rounded-full bg-muted/50 backdrop-blur-sm\">\n                          <span className=\"text-xs font-medium text-muted-foreground\">\n                            {getDateDivider(message.createdAt)}\n                          </span>\n                        </div>\n                      </div>\n                    )}\n                    \n                    <MessageBubble\n                      message={message}\n                      senderName={displayName}\n                      senderEmail={senderInfo?.email}\n                      senderAvatarUrl={message.sender?.avatarUrl ?? null}\n                      isSelf={isSelf}\n                      isGroupStart={message.isGroupStart}\n                      isGroupEnd={message.isGroupEnd}\n                      showAvatar={message.showAvatar}\n                      showTimestamp={message.showTimestamp}\n                      onDelete={setMessageToDelete}\n                    />\n                  </div>\n                )\n              })}\n            </div>\n          )}\n          <div ref={messagesEndRef} />\n        </div>\n      </ScrollArea>\n      \n      {/* Enhanced Composer (WhatsApp/Slack style) */}\n      <div className=\"relative z-10 border-t border-border bg-card px-6 py-4\">\n        <div className=\"flex items-end gap-2\">\n          {/* Action Buttons */}\n          <div className=\"flex items-center gap-1 shrink-0\">\n            <Button\n              variant=\"ghost\"\n              size=\"icon\"\n              className=\"h-9 w-9 text-muted-foreground hover:text-foreground\"\n              disabled={isSending}\n              title=\"Add emoji\"\n            >\n              <Smile className=\"h-5 w-5\" />\n            </Button>\n            <Button\n              variant=\"ghost\"\n              size=\"icon\"\n              className=\"h-9 w-9 text-muted-foreground hover:text-foreground\"\n              disabled={isSending}\n              title=\"Attach file\"\n            >\n              <Paperclip className=\"h-5 w-5\" />\n            </Button>\n          </div>\n\n          {/* Message Input Container */}\n          <div className=\"flex-1 relative\">\n            <AutoExpandTextarea\n              value={composerMessage}\n              onChange={event => setComposerMessage(event.target.value)}\n              onKeyDown={handleKeyDown}\n              placeholder=\"Type a message…\"\n              disabled={isSending}\n              className={cn(\n                \"min-h-[44px] max-h-[200px]\",\n                \"bg-background text-foreground\",\n                \"border-border focus-within:border-primary\",\n                \"placeholder:text-muted-foreground\",\n                \"transition-all duration-200\",\n                \"px-4 py-3\"\n              )}\n            />\n          </div>\n\n          {/* Send Button */}\n          <Button\n            onClick={handleSend}\n            disabled={isSending || !composerMessage.trim()}\n            size=\"icon\"\n            className={cn(\n              \"h-11 w-11 shrink-0 rounded-full shadow-lg\",\n              \"transition-all duration-200 ease-out\",\n              composerMessage.trim()\n                ? \"scale-100 opacity-100 hover:scale-105 hover:shadow-xl active:scale-95\"\n                : \"scale-90 opacity-50 cursor-not-allowed\"\n            )}\n          >\n            {isSending ? (\n              <div className=\"h-4 w-4 border-2 border-primary-foreground/30 border-t-primary-foreground rounded-full animate-spin\" />\n            ) : (\n              <Send className=\"h-4 w-4\" />\n            )}\n          </Button>\n        </div>\n        \n        {/* Helper Text */}\n        {composerMessage.trim() && !isSending && (\n          <p className=\"text-[10px] text-muted-foreground mt-2 px-1\">\n            Press <kbd className=\"px-1 py-0.5 rounded bg-muted text-foreground text-[10px]\">Ctrl</kbd> + <kbd className=\"px-1 py-0.5 rounded bg-muted text-foreground text-[10px]\">Enter</kbd> to send\n          </p>\n        )}\n      </div>\n      \n      {/* Delete Conversation Dialog */}\n      <AlertDialog open={showDeleteDialog} onOpenChange={setShowDeleteDialog}>\n        <AlertDialogContent>\n          <AlertDialogHeader>\n            <AlertDialogTitle>Delete Conversation?</AlertDialogTitle>\n            <AlertDialogDescription>\n              This will permanently delete this conversation and all its messages. This action cannot be undone.\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter>\n            <AlertDialogCancel>Cancel</AlertDialogCancel>\n            <AlertDialogAction \n              onClick={handleDeleteConversation}\n              className=\"bg-red-600 hover:bg-red-700\"\n            >\n              Delete\n            </AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n      \n      {/* Delete Message Dialog */}\n      <AlertDialog open={!!messageToDelete} onOpenChange={(open) => !open && setMessageToDelete(null)}>\n        <AlertDialogContent>\n          <AlertDialogHeader>\n            <AlertDialogTitle>Delete Message?</AlertDialogTitle>\n            <AlertDialogDescription>\n              This will permanently delete this message. This action cannot be undone.\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter>\n            <AlertDialogCancel>Cancel</AlertDialogCancel>\n            <AlertDialogAction \n              onClick={() => messageToDelete && handleDeleteMessage(messageToDelete)}\n              className=\"bg-red-600 hover:bg-red-700\"\n            >\n              Delete\n            </AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n    </div>\n  )\n}\n\n\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2516, "column": 0}, "map": {"version":3,"sources":["file:///Users/ghilesmoussaoui/Desktop/Versotech/versotech-portal/src/components/ui/textarea.tsx"],"sourcesContent":["import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nexport type TextareaProps = React.TextareaHTMLAttributes<HTMLTextAreaElement>\n\nconst Textarea = React.forwardRef<HTMLTextAreaElement, TextareaProps>(\n  ({ className, ...props }, ref) => {\n    return (\n      <textarea\n        className={cn(\n          \"flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:border-ring disabled:cursor-not-allowed disabled:opacity-50\",\n          className\n        )}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nTextarea.displayName = \"Textarea\"\n\nexport { Textarea }\n"],"names":[],"mappings":";;;;;AAAA;AAEA;;;;AAIA,MAAM,yBAAW,kMAAgB,MAC/B,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE;IACxB,qBACE,oNAAC;QACC,WAAW,IAAA,mJAAE,EACX,+RACA;QAEF,KAAK;QACJ,GAAG,KAAK;;;;;;AAGf;;AAEF,SAAS,WAAW,GAAG"}},
    {"offset": {"line": 2550, "column": 0}, "map": {"version":3,"sources":["file:///Users/ghilesmoussaoui/Desktop/Versotech/versotech-portal/src/components/ui/checkbox.tsx"],"sourcesContent":["\"use client\"\n\nimport * as React from \"react\"\nimport * as CheckboxPrimitive from \"@radix-ui/react-checkbox\"\nimport { Check } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Checkbox = React.forwardRef<\n  React.ElementRef<typeof CheckboxPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof CheckboxPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <CheckboxPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"peer h-5 w-5 md:h-4 md:w-4 shrink-0 rounded border border-white/20 bg-white/5 data-[state=checked]:bg-blue-600 data-[state=checked]:border-blue-600 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-400/20 focus-visible:border-blue-400/50 disabled:cursor-not-allowed disabled:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <CheckboxPrimitive.Indicator\n      className={cn(\"flex items-center justify-center text-white\")}\n    >\n      <Check className=\"h-4 w-4 md:h-3.5 md:w-3.5\" />\n    </CheckboxPrimitive.Indicator>\n  </CheckboxPrimitive.Root>\n))\nCheckbox.displayName = CheckboxPrimitive.Root.displayName\n\nexport { Checkbox }\n\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AAEA;AANA;;;;;;AAQA,MAAM,yBAAW,kMAAgB,MAG/B,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,oNAAC,sMAAsB;QACrB,KAAK;QACL,WAAW,IAAA,mJAAE,EACX,uTACA;QAED,GAAG,KAAK;kBAET,cAAA,oNAAC,2MAA2B;YAC1B,WAAW,IAAA,mJAAE,EAAC;sBAEd,cAAA,oNAAC,uOAAK;gBAAC,WAAU;;;;;;;;;;;;;;;;;AAIvB,SAAS,WAAW,GAAG,sMAAsB,CAAC,WAAW"}},
    {"offset": {"line": 2601, "column": 0}, "map": {"version":3,"sources":["file:///Users/ghilesmoussaoui/Desktop/Versotech/versotech-portal/src/components/messaging/staff/new-conversation-dialog.tsx"],"sourcesContent":["'use client'\n\nimport { useMemo, useState } from 'react'\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n  DialogClose,\n} from '@/components/ui/dialog'\nimport { Button } from '@/components/ui/button'\nimport { Input } from '@/components/ui/input'\nimport { Textarea } from '@/components/ui/textarea'\nimport { Checkbox } from '@/components/ui/checkbox'\nimport { Badge } from '@/components/ui/badge'\nimport type { ConversationFilters } from '@/types/messaging'\nimport { cn } from '@/lib/utils'\n\nexport interface StaffDirectoryEntry {\n  id: string\n  display_name: string | null\n  email: string | null\n  role: string\n}\n\nexport interface InvestorDirectoryEntry {\n  id: string\n  display_name: string | null\n  email: string | null\n  role: string\n  investor_id: string | null\n  entity_name: string | null\n  entity_type: string | null\n}\n\ninterface NewConversationDialogProps {\n  open: boolean\n  onOpenChange: (open: boolean) => void\n  mode: 'dm' | 'group'\n  onCreate: (payload: {\n    subject: string\n    participantIds: string[]\n    visibility: ConversationFilters['visibility']\n    type: ConversationFilters['type']\n    initialMessage?: string\n  }) => void\n  staffDirectory: StaffDirectoryEntry[]\n  investorDirectory: InvestorDirectoryEntry[]\n  isSubmitting: boolean\n}\n\nconst CARD_CLASS = 'border border-slate-700 bg-slate-900/70 rounded-lg backdrop-blur'\n\ntype DirectoryItem =\n  | { kind: 'section'; title: string; description: string; count: number }\n  | { kind: 'group'; title: string }\n  | { kind: 'staff'; entry: StaffDirectoryEntry }\n  | { kind: 'investor'; entry: InvestorDirectoryEntry }\n  | { kind: 'empty'; message: string }\n\nexport function NewConversationDialog({\n  open,\n  onOpenChange,\n  mode,\n  onCreate,\n  staffDirectory,\n  investorDirectory,\n  isSubmitting,\n}: NewConversationDialogProps) {\n  const [subject, setSubject] = useState('')\n  const [initialMessage, setInitialMessage] = useState('')\n  const [selectedStaffIds, setSelectedStaffIds] = useState<string[]>([])\n  const [selectedInvestorIds, setSelectedInvestorIds] = useState<string[]>([])\n  const [searchQuery, setSearchQuery] = useState('')\n\n  console.log('[NewConversationDialog] Mode:', mode, 'Staff:', staffDirectory.length, 'Investors:', investorDirectory.length)\n\n  const isDM = mode === 'dm'\n  const isGroup = mode === 'group'\n\n  const totalSelected = selectedStaffIds.length + selectedInvestorIds.length\n  const hasInvestors = selectedInvestorIds.length > 0\n  \n  // For DM mode, get the selected person's name\n  const selectedPerson = useMemo(() => {\n    const allPeople = [...staffDirectory, ...investorDirectory]\n    const selectedId = [...selectedStaffIds, ...selectedInvestorIds][0]\n    return allPeople.find(p => p.id === selectedId)\n  }, [selectedStaffIds, selectedInvestorIds, staffDirectory, investorDirectory])\n\n  // Filter and group data\n  const filteredStaff = useMemo(() => {\n    if (!searchQuery) return staffDirectory\n    const query = searchQuery.toLowerCase()\n    return staffDirectory.filter(s => \n      s.display_name?.toLowerCase().includes(query) ||\n      s.email?.toLowerCase().includes(query)\n    )\n  }, [staffDirectory, searchQuery])\n  \n  const filteredInvestors = useMemo(() => {\n    if (!searchQuery) return investorDirectory\n    const query = searchQuery.toLowerCase()\n    return investorDirectory.filter(i =>\n      i.display_name?.toLowerCase().includes(query) ||\n      i.email?.toLowerCase().includes(query) ||\n      i.entity_name?.toLowerCase().includes(query)\n    )\n  }, [investorDirectory, searchQuery])\n  \n  // Group investors by entity\n  const investorsByEntity = useMemo(() => {\n    const groups = new Map<string, InvestorDirectoryEntry[]>()\n    \n    filteredInvestors.forEach(investor => {\n      const entityKey = investor.entity_name || 'Individual Investors'\n      if (!groups.has(entityKey)) {\n        groups.set(entityKey, [])\n      }\n      groups.get(entityKey)!.push(investor)\n    })\n    \n    return Array.from(groups.entries()).sort((a, b) => a[0].localeCompare(b[0]))\n  }, [filteredInvestors])\n\n  const combinedDirectoryItems = useMemo<DirectoryItem[]>(() => {\n    const items: DirectoryItem[] = []\n\n    items.push({\n      kind: 'section',\n      title: 'Staff Members',\n      description: 'Internal team available for messaging',\n      count: filteredStaff.length,\n    })\n\n    if (filteredStaff.length === 0) {\n      items.push({\n        kind: 'empty',\n        message: searchQuery ? 'No staff found' : 'No staff members available',\n      })\n    } else {\n      for (const entry of filteredStaff) {\n        items.push({ kind: 'staff', entry })\n      }\n    }\n\n    items.push({\n      kind: 'section',\n      title: 'Investors',\n      description: 'Include investor contacts in this thread',\n      count: filteredInvestors.length,\n    })\n\n    if (filteredInvestors.length === 0) {\n      items.push({\n        kind: 'empty',\n        message: searchQuery ? 'No investors found' : 'No investors available',\n      })\n    } else {\n      for (const [entityName, investors] of investorsByEntity) {\n        items.push({ kind: 'group', title: entityName })\n        for (const entry of investors) {\n          items.push({ kind: 'investor', entry })\n        }\n      }\n    }\n\n    return items\n  }, [filteredStaff, filteredInvestors, investorsByEntity, searchQuery])\n\n  const handleToggleStaff = (id: string) => {\n    if (isDM) {\n      // DM mode: Only one person total\n      setSelectedStaffIds([id])\n      setSelectedInvestorIds([]) // Clear investors\n    } else {\n      // Group mode: Multiple people\n    setSelectedStaffIds(prev =>\n      prev.includes(id) ? prev.filter(value => value !== id) : [...prev, id]\n    )\n    }\n  }\n\n  const handleToggleInvestor = (id: string) => {\n    if (isDM) {\n      // DM mode: Only one person total\n      setSelectedInvestorIds([id])\n      setSelectedStaffIds([]) // Clear staff\n    } else {\n      // Group mode: Multiple people\n    setSelectedInvestorIds(prev =>\n      prev.includes(id) ? prev.filter(value => value !== id) : [...prev, id]\n    )\n    }\n  }\n\n  const resetForm = () => {\n    setSubject('')\n    setInitialMessage('')\n    setSearchQuery('')\n    setSelectedStaffIds([])\n    setSelectedInvestorIds([])\n  }\n\n  const handleOpenChange = (next: boolean) => {\n    if (!next) {\n      resetForm()\n    }\n    onOpenChange(next)\n  }\n\n  const handleSubmit = () => {\n    const participantIds = [...selectedStaffIds, ...selectedInvestorIds]\n    \n    // For DM mode, use the selected person's name as subject\n    let finalSubject = subject.trim()\n    if (isDM && selectedPerson) {\n      finalSubject = selectedPerson.display_name || selectedPerson.email || 'Direct Message'\n    } else if (!finalSubject) {\n      finalSubject = 'Untitled conversation'\n    }\n    \n    const effectiveVisibility: ConversationFilters['visibility'] = hasInvestors ? 'investor' : 'internal'\n    const conversationType: ConversationFilters['type'] = isDM ? 'dm' : 'group'\n\n    console.log('[NewConversationDialog] Submitting:', {\n      mode,\n      subject: finalSubject,\n      participantIds,\n      totalParticipants: participantIds.length,\n      visibility: effectiveVisibility,\n      type: conversationType,\n    })\n\n    onCreate({\n      subject: finalSubject,\n      participantIds,\n      visibility: effectiveVisibility,\n      type: conversationType,\n      initialMessage: initialMessage.trim() || undefined,\n    })\n  }\n  \n  // Validation\n  const canSubmit = isDM ? totalSelected === 1 : totalSelected > 0\n\n  return (\n    <Dialog open={open} onOpenChange={handleOpenChange}>\n      <DialogContent\n        className=\"w-[min(95vw,1100px)] rounded-2xl border border-slate-700 bg-slate-950 p-0 text-slate-50\"\n        showCloseButton={false}\n      >\n        <div className=\"flex h-[min(90vh,880px)] flex-col\">\n          <div className=\"flex items-start justify-between gap-3 border-b border-slate-800 px-6 py-5\">\n            <DialogHeader className=\"flex-1 gap-1\">\n              <DialogTitle className=\"text-2xl font-semibold text-white\">\n            {isDM ? 'Start New Direct Conversation' : 'Create New Group'}\n          </DialogTitle>\n              <DialogDescription className=\"mt-1 text-base text-slate-300\">\n            {isDM \n              ? 'Select one person to start a direct conversation with.'\n              : 'Select multiple people and give your group a name.'}\n          </DialogDescription>\n        </DialogHeader>\n            <DialogClose className=\"rounded-md border border-slate-600 px-3 py-1 text-sm text-slate-200 transition-colors hover:bg-slate-800 hover:text-white\">\n              Close\n            </DialogClose>\n          </div>\n\n          <div className=\"flex-1 min-h-0 overflow-hidden\">\n            <div className=\"h-full overflow-y-auto px-6 py-6 space-y-6\">\n          {isGroup && (\n            <div className=\"space-y-2\">\n              <label htmlFor=\"group-name\" className=\"text-sm font-semibold text-white\">\n                Group Name <span className=\"text-red-400\">*</span>\n              </label>\n              <Input\n                id=\"group-name\"\n                placeholder=\"e.g., Q4 Planning Team\"\n                value={subject}\n                onChange={event => setSubject(event.target.value)}\n                    className=\"h-11 bg-slate-900 border-slate-700 text-white placeholder:text-slate-400\"\n              />\n            </div>\n          )}\n          \n          {isDM && selectedPerson && (\n                <div className=\"rounded-lg border border-blue-500/40 bg-blue-500/10 p-4\">\n                  <p className=\"text-xs font-semibold uppercase tracking-wider text-blue-300\">Starting conversation with</p>\n                  <p className=\"mt-1 text-lg font-semibold text-white\">\n                {selectedPerson.display_name || selectedPerson.email}\n              </p>\n              <p className=\"text-sm text-slate-300\">{selectedPerson.email}</p>\n            </div>\n          )}\n\n          <div className=\"space-y-3\">\n              <label htmlFor=\"initial-message\" className=\"text-base font-semibold text-white\">\n                {isDM ? 'First message' : 'Initial message'} <span className=\"text-slate-400 font-normal\">(optional)</span>\n              </label>\n              <Textarea\n                id=\"initial-message\"\n                placeholder={isDM ? 'Say hello...' : 'Kick off the conversation...'}\n                value={initialMessage}\n                onChange={event => setInitialMessage(event.target.value)}\n                rows={3}\n                className=\"bg-slate-900 border border-slate-700 text-white placeholder:text-slate-500 focus:border-blue-500\"\n              />\n            </div>\n\n            <div className=\"space-y-3\">\n              <label htmlFor=\"search-people\" className=\"text-base font-semibold text-white\">\n                {isDM ? 'Select one person' : 'Select participants'}\n              </label>\n              <Input\n                id=\"search-people\"\n                placeholder=\"Search by name or email...\"\n                value={searchQuery}\n                onChange={event => setSearchQuery(event.target.value)}\n                className=\"h-12 bg-slate-900 border border-slate-700 text-white placeholder:text-slate-500 focus:border-blue-500\"\n              />\n            </div>\n\n            <section className=\"rounded-xl border border-slate-800 bg-slate-900/70\">\n              <div className=\"max-h-[calc(80vh-240px)] overflow-y-auto px-5 py-4 space-y-4\">\n                {combinedDirectoryItems.map((item, index) => {\n                  switch (item.kind) {\n                    case 'section':\n                      return (\n                        <div key={`${item.kind}-${item.title}-${index}`} className=\"flex items-center justify-between\">\n                          <div>\n                            <p className=\"text-sm font-semibold text-white\">{item.title}</p>\n                            <p className=\"text-xs text-slate-400\">{item.description}</p>\n                          </div>\n                          <Badge variant=\"outline\" className=\"border-slate-600 bg-slate-800 text-xs font-semibold uppercase text-slate-200\">\n                            {item.count}\n                          </Badge>\n                        </div>\n                      )\n                    case 'group':\n                      return (\n                        <div key={`group-${item.title}-${index}`} className=\"pt-3 text-xs font-semibold uppercase tracking-wider text-slate-300\">\n                          {item.title}\n                        </div>\n                      )\n                    case 'empty':\n                      return (\n                        <p key={`empty-${item.message}-${index}`} className=\"py-6 text-center text-sm text-slate-400\">\n                          {item.message}\n                        </p>\n                      )\n                    case 'staff': {\n                      const entry = item.entry\n                      const isSelected = selectedStaffIds.includes(entry.id)\n                      return (\n                        <label\n                          key={`staff-${entry.id}-${index}`}\n                          className={cn(\n                            'flex flex-col gap-2 rounded-xl border px-4 py-4 transition-colors',\n                            isSelected\n                              ? 'border-blue-500 bg-blue-500/15 shadow-[0_0_0_1px_rgba(59,130,246,0.35)]'\n                              : 'border-slate-700 hover:border-slate-600 hover:bg-slate-800/60'\n                          )}\n                          onClick={() => handleToggleStaff(entry.id)}\n                        >\n                          <div className=\"flex items-center justify-between gap-4\">\n                            <div className=\"flex items-center gap-2\">\n                              {isGroup ? (\n                                <Checkbox\n                                  checked={isSelected}\n                                  onCheckedChange={() => handleToggleStaff(entry.id)}\n                                  className=\"h-5 w-5\"\n                                />\n                              ) : (\n                                <span\n                                  className={cn(\n                                    'flex h-5 w-5 items-center justify-center rounded-full border-2',\n                                    isSelected ? 'border-blue-400 bg-blue-500' : 'border-slate-500'\n                                  )}\n                                >\n                                  {isSelected && <span className=\"h-2.5 w-2.5 rounded-full bg-white\" />}\n                                </span>\n                              )}\n                              <p className=\"text-base font-semibold text-white leading-tight whitespace-normal\">\n                                {entry.display_name || entry.email || 'Staff member'}\n                              </p>\n                            </div>\n                            <Badge variant=\"outline\" className=\"border-slate-600 bg-slate-800 text-xs font-semibold uppercase text-slate-200\">\n                              {entry.role.replace('staff_', '')}\n                            </Badge>\n                          </div>\n                          <p className=\"text-sm text-slate-300 leading-tight whitespace-normal\">\n                            {entry.email}\n                          </p>\n                        </label>\n                      )\n                    }\n                    case 'investor': {\n                      const entry = item.entry\n                      const isSelected = selectedInvestorIds.includes(entry.id)\n                      return (\n                        <label\n                          key={`investor-${entry.id}-${index}`}\n                          className={cn(\n                            'flex flex-col gap-2 rounded-xl border px-4 py-4 transition-colors',\n                            isSelected\n                              ? 'border-blue-500 bg-blue-500/15 shadow-[0_0_0_1px_rgba(59,130,246,0.35)]'\n                              : 'border-slate-700 hover-border-slate-600 hover:bg-slate-800/60'\n                          )}\n                          onClick={() => handleToggleInvestor(entry.id)}\n                        >\n                          <div className=\"flex items-center justify-between gap-4\">\n                            <div className=\"flex items-center gap-2\">\n                              {isGroup ? (\n                                <Checkbox\n                                  checked={isSelected}\n                                  onCheckedChange={() => handleToggleInvestor(entry.id)}\n                                  className=\"h-5 w-5\"\n                                />\n                              ) : (\n                                <span\n                                  className={cn(\n                                    'flex h-5 w-5 items-center justify-center rounded-full border-2',\n                                    isSelected ? 'border-blue-400 bg-blue-500' : 'border-slate-500'\n                                  )}\n                                >\n                                  {isSelected && <span className=\"h-2.5 w-2.5 rounded-full bg-white\" />}\n                                </span>\n                              )}\n                              <span className=\"text-base font-semibold text-white leading-tight whitespace-normal\">\n                                {entry.display_name || entry.email || 'Investor'}\n                              </span>\n                            </div>\n                            {entry.entity_type && (\n                              <Badge variant=\"outline\" className=\"border-blue-400/60 bg-blue-500/10 text-xs font-semibold capitalize text-blue-200\">\n                                {entry.entity_type}\n                              </Badge>\n                            )}\n                          </div>\n                          <p className=\"text-sm text-slate-300 leading-tight whitespace-normal\">\n                            {entry.email}\n                          </p>\n                        </label>\n                      )\n                    }\n                  }\n                })}\n              </div>\n            </section>\n\n            <div className=\"rounded-xl border border-slate-800 bg-slate-900/70 px-6 py-4\">\n              <p className=\"text-sm font-semibold uppercase tracking-wide text-white\">Summary</p>\n              <p className=\"mt-2 text-base text-white\">\n                {isDM ? (\n                  totalSelected === 1 \n                    ? `Ready to message ${selectedPerson?.display_name || selectedPerson?.email}`\n                    : 'Select one person to continue'\n                ) : (\n                  `${totalSelected} participant${totalSelected === 1 ? '' : 's'} selected`\n                )}\n              </p>\n              {hasInvestors && (\n                <p className=\"mt-2 text-sm font-medium text-blue-300\">\n                  ✓ Contains investors • Visibility automatically set to Investor\n                </p>\n              )}\n              {!canSubmit && (\n                <p className=\"mt-2 text-sm text-red-300\">\n                  {isDM ? '⚠ Select exactly one person' : '⚠ Select at least one participant'}\n                </p>\n              )}\n              {isGroup && !subject.trim() && (\n                <p className=\"mt-2 text-sm text-red-300\">⚠ Group name is required</p>\n              )}\n            </div>\n          </div>\n        </div>\n\n        <DialogFooter className=\"gap-3 border-t border-slate-800 px-6 py-4\">\n          <Button\n            type=\"button\"\n            variant=\"outline\"\n            onClick={() => handleOpenChange(false)}\n            disabled={isSubmitting}\n            className=\"h-11 border border-slate-600 bg-slate-900 text-slate-100 transition-colors hover:bg-slate-800 hover:text-white\"\n          >\n            Cancel\n          </Button>\n          <Button\n            type=\"button\"\n            onClick={handleSubmit}\n            disabled={isSubmitting || !canSubmit || (isGroup && !subject.trim())}\n              className=\"h-11 bg-blue-600 px-8 text-base font-semibold text-white shadow-[0_8px_16px_rgba(37,99,235,0.35)] transition-colors hover:bg-blue-500\"\n          >\n            {isSubmitting ? 'Creating…' : isDM ? 'Start Conversation' : 'Create Group'}\n          </Button>\n        </DialogFooter>\n        </div>\n      </DialogContent>\n    </Dialog>\n  )\n}"],"names":[],"mappings":";;;;;AAEA;AACA;AASA;AACA;AACA;AACA;AACA;AAEA;;;AAlBA;;;;;;;;;AAqDA,MAAM,aAAa;AASZ,SAAS,sBAAsB,EACpC,IAAI,EACJ,YAAY,EACZ,IAAI,EACJ,QAAQ,EACR,cAAc,EACd,iBAAiB,EACjB,YAAY,EACe;;IAC3B,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,gMAAQ,EAAC;IACvC,MAAM,CAAC,gBAAgB,kBAAkB,GAAG,IAAA,gMAAQ,EAAC;IACrD,MAAM,CAAC,kBAAkB,oBAAoB,GAAG,IAAA,gMAAQ,EAAW,EAAE;IACrE,MAAM,CAAC,qBAAqB,uBAAuB,GAAG,IAAA,gMAAQ,EAAW,EAAE;IAC3E,MAAM,CAAC,aAAa,eAAe,GAAG,IAAA,gMAAQ,EAAC;IAE/C,QAAQ,GAAG,CAAC,iCAAiC,MAAM,UAAU,eAAe,MAAM,EAAE,cAAc,kBAAkB,MAAM;IAE1H,MAAM,OAAO,SAAS;IACtB,MAAM,UAAU,SAAS;IAEzB,MAAM,gBAAgB,iBAAiB,MAAM,GAAG,oBAAoB,MAAM;IAC1E,MAAM,eAAe,oBAAoB,MAAM,GAAG;IAElD,8CAA8C;IAC9C,MAAM,iBAAiB,IAAA,+LAAO;yDAAC;YAC7B,MAAM,YAAY;mBAAI;mBAAmB;aAAkB;YAC3D,MAAM,aAAa;mBAAI;mBAAqB;aAAoB,CAAC,EAAE;YACnE,OAAO,UAAU,IAAI;iEAAC,CAAA,IAAK,EAAE,EAAE,KAAK;;QACtC;wDAAG;QAAC;QAAkB;QAAqB;QAAgB;KAAkB;IAE7E,wBAAwB;IACxB,MAAM,gBAAgB,IAAA,+LAAO;wDAAC;YAC5B,IAAI,CAAC,aAAa,OAAO;YACzB,MAAM,QAAQ,YAAY,WAAW;YACrC,OAAO,eAAe,MAAM;gEAAC,CAAA,IAC3B,EAAE,YAAY,EAAE,cAAc,SAAS,UACvC,EAAE,KAAK,EAAE,cAAc,SAAS;;QAEpC;uDAAG;QAAC;QAAgB;KAAY;IAEhC,MAAM,oBAAoB,IAAA,+LAAO;4DAAC;YAChC,IAAI,CAAC,aAAa,OAAO;YACzB,MAAM,QAAQ,YAAY,WAAW;YACrC,OAAO,kBAAkB,MAAM;oEAAC,CAAA,IAC9B,EAAE,YAAY,EAAE,cAAc,SAAS,UACvC,EAAE,KAAK,EAAE,cAAc,SAAS,UAChC,EAAE,WAAW,EAAE,cAAc,SAAS;;QAE1C;2DAAG;QAAC;QAAmB;KAAY;IAEnC,4BAA4B;IAC5B,MAAM,oBAAoB,IAAA,+LAAO;4DAAC;YAChC,MAAM,SAAS,IAAI;YAEnB,kBAAkB,OAAO;oEAAC,CAAA;oBACxB,MAAM,YAAY,SAAS,WAAW,IAAI;oBAC1C,IAAI,CAAC,OAAO,GAAG,CAAC,YAAY;wBAC1B,OAAO,GAAG,CAAC,WAAW,EAAE;oBAC1B;oBACA,OAAO,GAAG,CAAC,WAAY,IAAI,CAAC;gBAC9B;;YAEA,OAAO,MAAM,IAAI,CAAC,OAAO,OAAO,IAAI,IAAI;oEAAC,CAAC,GAAG,IAAM,CAAC,CAAC,EAAE,CAAC,aAAa,CAAC,CAAC,CAAC,EAAE;;QAC5E;2DAAG;QAAC;KAAkB;IAEtB,MAAM,yBAAyB,IAAA,+LAAO;iEAAkB;YACtD,MAAM,QAAyB,EAAE;YAEjC,MAAM,IAAI,CAAC;gBACT,MAAM;gBACN,OAAO;gBACP,aAAa;gBACb,OAAO,cAAc,MAAM;YAC7B;YAEA,IAAI,cAAc,MAAM,KAAK,GAAG;gBAC9B,MAAM,IAAI,CAAC;oBACT,MAAM;oBACN,SAAS,cAAc,mBAAmB;gBAC5C;YACF,OAAO;gBACL,KAAK,MAAM,SAAS,cAAe;oBACjC,MAAM,IAAI,CAAC;wBAAE,MAAM;wBAAS;oBAAM;gBACpC;YACF;YAEA,MAAM,IAAI,CAAC;gBACT,MAAM;gBACN,OAAO;gBACP,aAAa;gBACb,OAAO,kBAAkB,MAAM;YACjC;YAEA,IAAI,kBAAkB,MAAM,KAAK,GAAG;gBAClC,MAAM,IAAI,CAAC;oBACT,MAAM;oBACN,SAAS,cAAc,uBAAuB;gBAChD;YACF,OAAO;gBACL,KAAK,MAAM,CAAC,YAAY,UAAU,IAAI,kBAAmB;oBACvD,MAAM,IAAI,CAAC;wBAAE,MAAM;wBAAS,OAAO;oBAAW;oBAC9C,KAAK,MAAM,SAAS,UAAW;wBAC7B,MAAM,IAAI,CAAC;4BAAE,MAAM;4BAAY;wBAAM;oBACvC;gBACF;YACF;YAEA,OAAO;QACT;gEAAG;QAAC;QAAe;QAAmB;QAAmB;KAAY;IAErE,MAAM,oBAAoB,CAAC;QACzB,IAAI,MAAM;YACR,iCAAiC;YACjC,oBAAoB;gBAAC;aAAG;YACxB,uBAAuB,EAAE,GAAE,kBAAkB;QAC/C,OAAO;YACL,8BAA8B;YAChC,oBAAoB,CAAA,OAClB,KAAK,QAAQ,CAAC,MAAM,KAAK,MAAM,CAAC,CAAA,QAAS,UAAU,MAAM;uBAAI;oBAAM;iBAAG;QAExE;IACF;IAEA,MAAM,uBAAuB,CAAC;QAC5B,IAAI,MAAM;YACR,iCAAiC;YACjC,uBAAuB;gBAAC;aAAG;YAC3B,oBAAoB,EAAE,GAAE,cAAc;QACxC,OAAO;YACL,8BAA8B;YAChC,uBAAuB,CAAA,OACrB,KAAK,QAAQ,CAAC,MAAM,KAAK,MAAM,CAAC,CAAA,QAAS,UAAU,MAAM;uBAAI;oBAAM;iBAAG;QAExE;IACF;IAEA,MAAM,YAAY;QAChB,WAAW;QACX,kBAAkB;QAClB,eAAe;QACf,oBAAoB,EAAE;QACtB,uBAAuB,EAAE;IAC3B;IAEA,MAAM,mBAAmB,CAAC;QACxB,IAAI,CAAC,MAAM;YACT;QACF;QACA,aAAa;IACf;IAEA,MAAM,eAAe;QACnB,MAAM,iBAAiB;eAAI;eAAqB;SAAoB;QAEpE,yDAAyD;QACzD,IAAI,eAAe,QAAQ,IAAI;QAC/B,IAAI,QAAQ,gBAAgB;YAC1B,eAAe,eAAe,YAAY,IAAI,eAAe,KAAK,IAAI;QACxE,OAAO,IAAI,CAAC,cAAc;YACxB,eAAe;QACjB;QAEA,MAAM,sBAAyD,eAAe,aAAa;QAC3F,MAAM,mBAAgD,OAAO,OAAO;QAEpE,QAAQ,GAAG,CAAC,uCAAuC;YACjD;YACA,SAAS;YACT;YACA,mBAAmB,eAAe,MAAM;YACxC,YAAY;YACZ,MAAM;QACR;QAEA,SAAS;YACP,SAAS;YACT;YACA,YAAY;YACZ,MAAM;YACN,gBAAgB,eAAe,IAAI,MAAM;QAC3C;IACF;IAEA,aAAa;IACb,MAAM,YAAY,OAAO,kBAAkB,IAAI,gBAAgB;IAE/D,qBACE,oNAAC,sKAAM;QAAC,MAAM;QAAM,cAAc;kBAChC,cAAA,oNAAC,6KAAa;YACZ,WAAU;YACV,iBAAiB;sBAEjB,cAAA,oNAAC;gBAAI,WAAU;;kCACb,oNAAC;wBAAI,WAAU;;0CACb,oNAAC,4KAAY;gCAAC,WAAU;;kDACtB,oNAAC,2KAAW;wCAAC,WAAU;kDACxB,OAAO,kCAAkC;;;;;;kDAExC,oNAAC,iLAAiB;wCAAC,WAAU;kDAC9B,OACG,2DACA;;;;;;;;;;;;0CAGJ,oNAAC,2KAAW;gCAAC,WAAU;0CAA4H;;;;;;;;;;;;kCAKrJ,oNAAC;wBAAI,WAAU;kCACb,cAAA,oNAAC;4BAAI,WAAU;;gCAChB,yBACC,oNAAC;oCAAI,WAAU;;sDACb,oNAAC;4CAAM,SAAQ;4CAAa,WAAU;;gDAAmC;8DAC5D,oNAAC;oDAAK,WAAU;8DAAe;;;;;;;;;;;;sDAE5C,oNAAC,oKAAK;4CACJ,IAAG;4CACH,aAAY;4CACZ,OAAO;4CACP,UAAU,CAAA,QAAS,WAAW,MAAM,MAAM,CAAC,KAAK;4CAC5C,WAAU;;;;;;;;;;;;gCAKnB,QAAQ,gCACH,oNAAC;oCAAI,WAAU;;sDACb,oNAAC;4CAAE,WAAU;sDAA+D;;;;;;sDAC5E,oNAAC;4CAAE,WAAU;sDACd,eAAe,YAAY,IAAI,eAAe,KAAK;;;;;;sDAEtD,oNAAC;4CAAE,WAAU;sDAA0B,eAAe,KAAK;;;;;;;;;;;;8CAI/D,oNAAC;oCAAI,WAAU;;sDACX,oNAAC;4CAAM,SAAQ;4CAAkB,WAAU;;gDACxC,OAAO,kBAAkB;gDAAkB;8DAAC,oNAAC;oDAAK,WAAU;8DAA6B;;;;;;;;;;;;sDAE5F,oNAAC,0KAAQ;4CACP,IAAG;4CACH,aAAa,OAAO,iBAAiB;4CACrC,OAAO;4CACP,UAAU,CAAA,QAAS,kBAAkB,MAAM,MAAM,CAAC,KAAK;4CACvD,MAAM;4CACN,WAAU;;;;;;;;;;;;8CAId,oNAAC;oCAAI,WAAU;;sDACb,oNAAC;4CAAM,SAAQ;4CAAgB,WAAU;sDACtC,OAAO,sBAAsB;;;;;;sDAEhC,oNAAC,oKAAK;4CACJ,IAAG;4CACH,aAAY;4CACZ,OAAO;4CACP,UAAU,CAAA,QAAS,eAAe,MAAM,MAAM,CAAC,KAAK;4CACpD,WAAU;;;;;;;;;;;;8CAId,oNAAC;oCAAQ,WAAU;8CACjB,cAAA,oNAAC;wCAAI,WAAU;kDACZ,uBAAuB,GAAG,CAAC,CAAC,MAAM;4CACjC,OAAQ,KAAK,IAAI;gDACf,KAAK;oDACH,qBACE,oNAAC;wDAAgD,WAAU;;0EACzD,oNAAC;;kFACC,oNAAC;wEAAE,WAAU;kFAAoC,KAAK,KAAK;;;;;;kFAC3D,oNAAC;wEAAE,WAAU;kFAA0B,KAAK,WAAW;;;;;;;;;;;;0EAEzD,oNAAC,oKAAK;gEAAC,SAAQ;gEAAU,WAAU;0EAChC,KAAK,KAAK;;;;;;;uDANL,GAAG,KAAK,IAAI,CAAC,CAAC,EAAE,KAAK,KAAK,CAAC,CAAC,EAAE,OAAO;;;;;gDAUnD,KAAK;oDACH,qBACE,oNAAC;wDAAyC,WAAU;kEACjD,KAAK,KAAK;uDADH,CAAC,MAAM,EAAE,KAAK,KAAK,CAAC,CAAC,EAAE,OAAO;;;;;gDAI5C,KAAK;oDACH,qBACE,oNAAC;wDAAyC,WAAU;kEACjD,KAAK,OAAO;uDADP,CAAC,MAAM,EAAE,KAAK,OAAO,CAAC,CAAC,EAAE,OAAO;;;;;gDAI5C,KAAK;oDAAS;wDACZ,MAAM,QAAQ,KAAK,KAAK;wDACxB,MAAM,aAAa,iBAAiB,QAAQ,CAAC,MAAM,EAAE;wDACrD,qBACE,oNAAC;4DAEC,WAAW,IAAA,mJAAE,EACX,qEACA,aACI,4EACA;4DAEN,SAAS,IAAM,kBAAkB,MAAM,EAAE;;8EAEzC,oNAAC;oEAAI,WAAU;;sFACb,oNAAC;4EAAI,WAAU;;gFACZ,wBACC,oNAAC,0KAAQ;oFACP,SAAS;oFACT,iBAAiB,IAAM,kBAAkB,MAAM,EAAE;oFACjD,WAAU;;;;;yGAGZ,oNAAC;oFACC,WAAW,IAAA,mJAAE,EACX,kEACA,aAAa,gCAAgC;8FAG9C,4BAAc,oNAAC;wFAAK,WAAU;;;;;;;;;;;8FAGnC,oNAAC;oFAAE,WAAU;8FACV,MAAM,YAAY,IAAI,MAAM,KAAK,IAAI;;;;;;;;;;;;sFAG1C,oNAAC,oKAAK;4EAAC,SAAQ;4EAAU,WAAU;sFAChC,MAAM,IAAI,CAAC,OAAO,CAAC,UAAU;;;;;;;;;;;;8EAGlC,oNAAC;oEAAE,WAAU;8EACV,MAAM,KAAK;;;;;;;2DApCT,CAAC,MAAM,EAAE,MAAM,EAAE,CAAC,CAAC,EAAE,OAAO;;;;;oDAwCvC;gDACA,KAAK;oDAAY;wDACf,MAAM,QAAQ,KAAK,KAAK;wDACxB,MAAM,aAAa,oBAAoB,QAAQ,CAAC,MAAM,EAAE;wDACxD,qBACE,oNAAC;4DAEC,WAAW,IAAA,mJAAE,EACX,qEACA,aACI,4EACA;4DAEN,SAAS,IAAM,qBAAqB,MAAM,EAAE;;8EAE5C,oNAAC;oEAAI,WAAU;;sFACb,oNAAC;4EAAI,WAAU;;gFACZ,wBACC,oNAAC,0KAAQ;oFACP,SAAS;oFACT,iBAAiB,IAAM,qBAAqB,MAAM,EAAE;oFACpD,WAAU;;;;;yGAGZ,oNAAC;oFACC,WAAW,IAAA,mJAAE,EACX,kEACA,aAAa,gCAAgC;8FAG9C,4BAAc,oNAAC;wFAAK,WAAU;;;;;;;;;;;8FAGnC,oNAAC;oFAAK,WAAU;8FACb,MAAM,YAAY,IAAI,MAAM,KAAK,IAAI;;;;;;;;;;;;wEAGzC,MAAM,WAAW,kBAChB,oNAAC,oKAAK;4EAAC,SAAQ;4EAAU,WAAU;sFAChC,MAAM,WAAW;;;;;;;;;;;;8EAIxB,oNAAC;oEAAE,WAAU;8EACV,MAAM,KAAK;;;;;;;2DAtCT,CAAC,SAAS,EAAE,MAAM,EAAE,CAAC,CAAC,EAAE,OAAO;;;;;oDA0C1C;4CACF;wCACF;;;;;;;;;;;8CAIJ,oNAAC;oCAAI,WAAU;;sDACb,oNAAC;4CAAE,WAAU;sDAA2D;;;;;;sDACxE,oNAAC;4CAAE,WAAU;sDACV,OACC,kBAAkB,IACd,CAAC,iBAAiB,EAAE,gBAAgB,gBAAgB,gBAAgB,OAAO,GAC3E,kCAEJ,GAAG,cAAc,YAAY,EAAE,kBAAkB,IAAI,KAAK,IAAI,SAAS,CAAC;;;;;;wCAG3E,8BACC,oNAAC;4CAAE,WAAU;sDAAyC;;;;;;wCAIvD,CAAC,2BACA,oNAAC;4CAAE,WAAU;sDACV,OAAO,gCAAgC;;;;;;wCAG3C,WAAW,CAAC,QAAQ,IAAI,oBACvB,oNAAC;4CAAE,WAAU;sDAA4B;;;;;;;;;;;;;;;;;;;;;;;kCAMjD,oNAAC,4KAAY;wBAAC,WAAU;;0CACtB,oNAAC,sKAAM;gCACL,MAAK;gCACL,SAAQ;gCACR,SAAS,IAAM,iBAAiB;gCAChC,UAAU;gCACV,WAAU;0CACX;;;;;;0CAGD,oNAAC,sKAAM;gCACL,MAAK;gCACL,SAAS;gCACT,UAAU,gBAAgB,CAAC,aAAc,WAAW,CAAC,QAAQ,IAAI;gCAC/D,WAAU;0CAEX,eAAe,cAAc,OAAO,uBAAuB;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAOxE;GAzbgB;KAAA"}},
    {"offset": {"line": 3391, "column": 0}, "map": {"version":3,"sources":["file:///Users/ghilesmoussaoui/Desktop/Versotech/versotech-portal/src/components/messaging/staff/messaging-client.tsx"],"sourcesContent":["'use client'\r\n\r\nimport { useCallback, useMemo, useRef, useState, useEffect } from 'react'\r\nimport type { ConversationSummary, ConversationFilters } from '@/types/messaging'\r\nimport { fetchConversationsClient, markConversationRead } from '@/lib/messaging'\r\nimport { ConversationsSidebar } from './sidebar'\r\nimport { ConversationView } from './conversation-view'\r\nimport { createClient } from '@/lib/supabase/client'\r\nimport { toast } from 'sonner'\r\nimport { NewConversationDialog } from './new-conversation-dialog'\r\nimport type { StaffDirectoryEntry, InvestorDirectoryEntry } from './new-conversation-dialog'\r\n\r\ninterface MessagingClientProps {\r\n  initialConversations: ConversationSummary[]\r\n  currentUserId: string\r\n  /** If false, hides \"New Conversation\" and doesn't load staff/investor directories. Default: true (staff behavior) */\r\n  canCreateConversation?: boolean\r\n}\r\n\r\nconst INITIAL_FILTERS: ConversationFilters = {\r\n  visibility: 'all',\r\n  type: 'all',\r\n}\r\n\r\nexport function MessagingClient({ initialConversations, currentUserId, canCreateConversation = true }: MessagingClientProps) {\r\n  const supabase = useMemo(() => createClient(), [])\r\n  const [filters, setFilters] = useState<ConversationFilters>(INITIAL_FILTERS)\r\n  const [conversations, setConversations] = useState<ConversationSummary[]>(initialConversations)\r\n  const [isLoading, setIsLoading] = useState(false)\r\n  const [activeConversationId, setActiveConversationId] = useState<string | null>(initialConversations[0]?.id || null)\r\n  const [errorMessage, setErrorMessage] = useState<string | null>(null)\r\n  const [isNewConversationOpen, setIsNewConversationOpen] = useState(false)\r\n  const [conversationMode, setConversationMode] = useState<'dm' | 'group'>('dm')\r\n  const [staffDirectory, setStaffDirectory] = useState<StaffDirectoryEntry[]>([])\r\n  const [investorDirectory, setInvestorDirectory] = useState<InvestorDirectoryEntry[]>([])\r\n  const [isCreatingConversation, setIsCreatingConversation] = useState(false)\r\n\r\n  // Ref to track active conversation without recreating subscriptions\r\n  const activeConversationIdRef = useRef(activeConversationId)\r\n  activeConversationIdRef.current = activeConversationId\r\n\r\n  console.log('[MessagingClient] Initial conversations:', initialConversations.length)\r\n  console.log('[MessagingClient] Current conversations state:', conversations.length)\r\n  console.log('[MessagingClient] Filters:', filters)\r\n\r\n  const activeConversation = conversations.find(conv => conv.id === activeConversationId) || null\r\n\r\n  const loadConversations = useCallback(async (nextFilters?: ConversationFilters, silent = false) => {\r\n    console.log('[MessagingClient] loadConversations called with filters:', nextFilters || filters, 'silent:', silent)\r\n    if (!silent) setIsLoading(true)\r\n    setErrorMessage(null)\r\n    try {\r\n      const filtersToUse = nextFilters || filters\r\n      const { conversations: data } = await fetchConversationsClient({ ...filtersToUse, includeMessages: true, limit: 50 })\r\n      console.log('[MessagingClient] Fetched conversations:', data.length)\r\n      setConversations(data)\r\n\r\n      // If no conversations found and we have an active one, keep it\r\n      // Otherwise select the first one\r\n      if (data.length > 0 && !activeConversationId) {\r\n        setActiveConversationId(data[0].id)\r\n      }\r\n    } catch (error: any) {\r\n      console.error('[MessagingClient] Load conversations error', error)\r\n      setErrorMessage(error.message || 'Failed to load conversations')\r\n    } finally {\r\n      if (!silent) setIsLoading(false)\r\n    }\r\n  }, [filters, activeConversationId])\r\n\r\n  const handleFiltersChange = useCallback((nextFilters: ConversationFilters) => {\r\n    setFilters(nextFilters)\r\n    loadConversations(nextFilters)\r\n  }, [loadConversations])\r\n\r\n  const handleRefresh = useCallback(() => {\r\n    loadConversations(filters)\r\n  }, [loadConversations, filters])\r\n\r\n  const handleSelectConversation = useCallback((conversationId: string) => {\r\n    setActiveConversationId(conversationId)\r\n    // Optimistically update local state to clear unread badge immediately\r\n    setConversations(prev => prev.map(conv =>\r\n      conv.id === conversationId ? { ...conv, unreadCount: 0 } : conv\r\n    ))\r\n    markConversationRead(conversationId).catch(console.error)\r\n  }, [])\r\n\r\n  // Global realtime subscription for conversations and messages\r\n  useEffect(() => {\r\n    console.log('[Staff Messages] Setting up realtime subscription')\r\n\r\n    const channel = supabase\r\n      .channel('staff_conversations_all')\r\n      .on('postgres_changes', {\r\n        event: 'INSERT',\r\n        schema: 'public',\r\n        table: 'conversations'\r\n      }, () => {\r\n        console.log('[Realtime] New conversation created, refreshing list')\r\n        void fetchConversationsClient({ ...filters, includeMessages: true, limit: 50 })\r\n          .then(({ conversations: data }) => {\r\n            setConversations(data)\r\n          })\r\n          .catch(console.error)\r\n      })\r\n      .on('postgres_changes', {\r\n        event: 'INSERT',\r\n        schema: 'public',\r\n        table: 'messages'\r\n      }, (payload) => {\r\n        // Refresh conversation list when new messages arrive in non-active conversations\r\n        // This updates preview text, timestamps, and unread counts\r\n        const messageConvId = (payload.new as { conversation_id?: string })?.conversation_id\r\n        if (messageConvId && messageConvId !== activeConversationIdRef.current) {\r\n          console.log('[Realtime] New message in background conversation, refreshing list')\r\n          void fetchConversationsClient({ ...filters, includeMessages: true, limit: 50 })\r\n            .then(({ conversations: data }) => {\r\n              setConversations(data)\r\n            })\r\n            .catch(console.error)\r\n        }\r\n      })\r\n      .subscribe((status) => {\r\n        console.log('[Realtime] Subscription status:', status)\r\n      })\r\n\r\n    return () => {\r\n      console.log('[Staff Messages] Cleaning up realtime subscription')\r\n      supabase.removeChannel(channel)\r\n    }\r\n  }, [supabase, filters])\r\n\r\n  const handleComposerError = useCallback((message: string) => {\r\n    toast.error(message)\r\n  }, [])\r\n  \r\n  const handleDeleteConversation = useCallback((conversationId: string) => {\r\n    console.log('[MessagingClient] Deleting conversation:', conversationId)\r\n    // Remove from local state\r\n    setConversations(prev => prev.filter(c => c.id !== conversationId))\r\n    setActiveConversationId(null)\r\n    toast.success('Conversation deleted')\r\n  }, [])\r\n\r\n  useEffect(() => {\r\n    // Only load directories if user can create conversations (staff only)\r\n    if (!canCreateConversation) {\r\n      console.log('[MessagingClient] Skipping directory load - user cannot create conversations')\r\n      return\r\n    }\r\n\r\n    const loadDirectories = async () => {\r\n      try {\r\n        console.log('[MessagingClient] Loading staff and investor directories...')\r\n        const [staffResponse, investorResponse] = await Promise.all([\r\n          fetch('/api/staff/available'),\r\n          fetch('/api/investors/available'),\r\n        ])\r\n\r\n        if (staffResponse.ok) {\r\n          const data = await staffResponse.json()\r\n          console.log('[MessagingClient] Staff directory loaded:', data.staff?.length || 0, 'members')\r\n          setStaffDirectory(data.staff || [])\r\n        } else {\r\n          console.error('[MessagingClient] Staff fetch failed:', staffResponse.status)\r\n        }\r\n\r\n        if (investorResponse.ok) {\r\n          const data = await investorResponse.json()\r\n          console.log('[MessagingClient] Investor directory loaded:', data.investors?.length || 0, 'investors')\r\n          console.log('[MessagingClient] Sample investor:', data.investors?.[0])\r\n          setInvestorDirectory(data.investors || [])\r\n        } else {\r\n          console.error('[MessagingClient] Investor fetch failed:', investorResponse.status)\r\n        }\r\n      } catch (error) {\r\n        console.error('[MessagingClient] Failed to load directories', error)\r\n      }\r\n    }\r\n\r\n    loadDirectories()\r\n  }, [canCreateConversation])\r\n\r\n  const handleCreateConversation = async (payload: {\r\n    subject: string\r\n    participantIds: string[]\r\n    visibility: ConversationFilters['visibility']\r\n    type: ConversationFilters['type']\r\n    initialMessage?: string\r\n  }) => {\r\n    const uniqueParticipants = Array.from(new Set(payload.participantIds))\r\n\r\n    console.log('[MessagingClient] Creating conversation:', {\r\n      subject: payload.subject,\r\n      participants: uniqueParticipants.length,\r\n      type: payload.type,\r\n      visibility: payload.visibility\r\n    })\r\n\r\n    if (!uniqueParticipants.length) {\r\n      toast.error('Select at least one participant')\r\n      return\r\n    }\r\n\r\n    setIsCreatingConversation(true)\r\n    try {\r\n      const requestBody = {\r\n        subject: payload.subject,\r\n        participant_ids: uniqueParticipants,\r\n        type: payload.type,\r\n        visibility: payload.visibility === 'all' ? 'internal' : payload.visibility,\r\n        initial_message: payload.initialMessage,\r\n      }\r\n      \r\n      console.log('[MessagingClient] Request payload:', requestBody)\r\n\r\n      const response = await fetch('/api/conversations', {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify(requestBody),\r\n      })\r\n\r\n      if (!response.ok) {\r\n        const data = await response.json().catch(() => null)\r\n        console.error('[MessagingClient] Create conversation error:', data)\r\n        throw new Error(data?.error || 'Failed to create conversation')\r\n      }\r\n\r\n      const result = await response.json()\r\n      console.log('[MessagingClient] Conversation created:', result)\r\n\r\n      toast.success('Conversation created successfully!')\r\n      setIsNewConversationOpen(false)\r\n      await loadConversations(filters)\r\n\r\n      if (result?.conversation?.id) {\r\n        setActiveConversationId(result.conversation.id)\r\n      }\r\n    } catch (error: any) {\r\n      console.error('[MessagingClient] Create conversation failed:', error)\r\n      toast.error(error.message || 'Unable to create conversation')\r\n    } finally {\r\n      setIsCreatingConversation(false)\r\n    }\r\n  }\r\n\r\n  return (\r\n    <div className=\"flex h-[calc(100vh-4rem)] overflow-hidden\">\r\n      <ConversationsSidebar\r\n        conversations={conversations}\r\n        filters={filters}\r\n        onFiltersChange={handleFiltersChange}\r\n        onRefresh={handleRefresh}\r\n        onSelectConversation={handleSelectConversation}\r\n        onCreateConversation={(mode) => {\r\n          setConversationMode(mode)\r\n          setIsNewConversationOpen(true)\r\n        }}\r\n        activeConversationId={activeConversationId}\r\n        isLoading={isLoading}\r\n        errorMessage={errorMessage}\r\n        canCreateConversation={canCreateConversation}\r\n      />\r\n      <div className=\"flex-1 flex flex-col\">\r\n        {activeConversation ? (\r\n          <ConversationView\r\n            key={activeConversation.id}\r\n            conversation={activeConversation}\r\n            currentUserId={currentUserId}\r\n            onRead={() => markConversationRead(activeConversation.id)}\r\n            onError={handleComposerError}\r\n            onDelete={handleDeleteConversation}\r\n          />\r\n        ) : (\r\n          <div className=\"flex items-center justify-center h-full text-muted-foreground\">\r\n            Select a conversation to get started\r\n          </div>\r\n        )}\r\n      </div>\r\n      {canCreateConversation && (\r\n        <NewConversationDialog\r\n          open={isNewConversationOpen}\r\n          onOpenChange={setIsNewConversationOpen}\r\n          mode={conversationMode}\r\n          staffDirectory={staffDirectory}\r\n          investorDirectory={investorDirectory}\r\n          onCreate={handleCreateConversation}\r\n          isSubmitting={isCreatingConversation}\r\n        />\r\n      )}\r\n    </div>\r\n  )\r\n}\r\n\r\n\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 3745, "column": 0}, "map": {"version":3,"sources":["file:///Users/ghilesmoussaoui/Desktop/Versotech/versotech-portal/src/app/%28main%29/versotech_main/inbox/messages-content.tsx"],"sourcesContent":["'use client'\r\n\r\nimport { useEffect, useState } from 'react'\r\nimport { MessagingClient } from '@/components/messaging/staff/messaging-client'\r\nimport { normalizeConversation } from '@/lib/messaging/supabase'\r\nimport { AlertCircle, Loader2 } from 'lucide-react'\r\nimport { createClient } from '@/lib/supabase/client'\r\nimport { usePersona } from '@/contexts/persona-context'\r\n\r\nexport default function MessagesContent() {\r\n  const { activePersona, isCEO, isStaff } = usePersona()\r\n  // Staff/CEO can create new conversations (requires access to investor/staff directories)\r\n  // Use isCEO/isStaff which check ALL personas, not just active - so CEO with multiple personas retains this ability\r\n  const canCreateConversation = isCEO || isStaff\r\n  const [conversations, setConversations] = useState<any[]>([])\r\n  const [currentUserId, setCurrentUserId] = useState<string | null>(null)\r\n  const [loading, setLoading] = useState(true)\r\n  const [error, setError] = useState<string | null>(null)\r\n\r\n  useEffect(() => {\r\n    async function fetchConversations() {\r\n      try {\r\n        setLoading(true)\r\n        const supabase = createClient()\r\n        const { data: { user } } = await supabase.auth.getUser()\r\n\r\n        if (!user) {\r\n          setError('Not authenticated')\r\n          return\r\n        }\r\n\r\n        setCurrentUserId(user.id)\r\n\r\n        // Fetch conversations\r\n        const { data, error: fetchError } = await supabase\r\n          .from('conversations')\r\n          .select(`\r\n            *,\r\n            conversation_participants (\r\n              conversation_id,\r\n              user_id,\r\n              participant_role,\r\n              joined_at,\r\n              last_read_at,\r\n              last_notified_at,\r\n              is_muted,\r\n              is_pinned,\r\n              profiles:user_id (\r\n                id,\r\n                display_name,\r\n                email,\r\n                role,\r\n                avatar_url\r\n              )\r\n            ),\r\n            messages (\r\n              id,\r\n              conversation_id,\r\n              sender_id,\r\n              body,\r\n              message_type,\r\n              file_key,\r\n              reply_to_message_id,\r\n              metadata,\r\n              created_at,\r\n              edited_at,\r\n              deleted_at,\r\n              sender:sender_id (\r\n                id,\r\n                display_name,\r\n                email,\r\n                role,\r\n                avatar_url\r\n              )\r\n            )\r\n          `)\r\n          .order('last_message_at', { ascending: false, nullsFirst: false })\r\n          .order('created_at', { foreignTable: 'messages', ascending: false })\r\n          .limit(1, { foreignTable: 'messages' })\r\n          .limit(50)\r\n\r\n        if (fetchError) throw fetchError\r\n\r\n        // Normalize conversations\r\n        const normalizedConversations = (data || []).map(normalizeConversation)\r\n\r\n        // Get unread counts\r\n        const conversationIds = normalizedConversations.map(conv => conv.id)\r\n        if (conversationIds.length > 0) {\r\n          const { data: unreadData } = await supabase.rpc('get_conversation_unread_counts', {\r\n            p_user_id: user.id,\r\n            p_conversation_ids: conversationIds,\r\n          })\r\n\r\n          const unreadMap = new Map<string, number>()\r\n          for (const row of unreadData || []) {\r\n            if (row?.conversation_id) {\r\n              unreadMap.set(row.conversation_id, Number(row.unread_count) || 0)\r\n            }\r\n          }\r\n\r\n          for (const conversation of normalizedConversations) {\r\n            conversation.unreadCount = unreadMap.get(conversation.id) ?? 0\r\n          }\r\n        }\r\n\r\n        setConversations(normalizedConversations)\r\n        setError(null)\r\n      } catch (err) {\r\n        console.error('[MessagesContent] Error:', err)\r\n        setError(err instanceof Error ? err.message : 'Failed to load messages')\r\n      } finally {\r\n        setLoading(false)\r\n      }\r\n    }\r\n\r\n    fetchConversations()\r\n  }, [])\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"flex items-center justify-center py-16\">\r\n        <Loader2 className=\"h-8 w-8 animate-spin text-muted-foreground\" />\r\n        <span className=\"ml-3 text-muted-foreground\">Loading messages...</span>\r\n      </div>\r\n    )\r\n  }\r\n\r\n  if (error) {\r\n    return (\r\n      <div className=\"text-center py-16\">\r\n        <AlertCircle className=\"h-12 w-12 text-destructive mx-auto mb-4\" />\r\n        <h3 className=\"text-lg font-medium text-foreground mb-2\">Error Loading Messages</h3>\r\n        <p className=\"text-muted-foreground\">{error}</p>\r\n      </div>\r\n    )\r\n  }\r\n\r\n  if (!currentUserId) {\r\n    return (\r\n      <div className=\"text-center py-16\">\r\n        <AlertCircle className=\"h-12 w-12 text-muted-foreground mx-auto mb-4\" />\r\n        <h3 className=\"text-lg font-medium text-foreground mb-2\">Not Authenticated</h3>\r\n        <p className=\"text-muted-foreground\">Please log in to view messages.</p>\r\n      </div>\r\n    )\r\n  }\r\n\r\n  return (\r\n    <MessagingClient\r\n      initialConversations={conversations}\r\n      currentUserId={currentUserId}\r\n      canCreateConversation={canCreateConversation}\r\n    />\r\n  )\r\n}\r\n"],"names":[],"mappings":"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"}}]
}