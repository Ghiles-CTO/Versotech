{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/ghilesmoussaoui/Desktop/Versotech/versotech-portal/src/components/fees/TermSheetSelector.tsx"],"sourcesContent":["/**\n * Term Sheet Selector Component\n *\n * Allows selection of a published term sheet for a deal.\n * Fee models must be derived from term sheets per business requirements.\n */\n\n'use client';\n\nimport { useState, useEffect } from 'react';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { Label } from '@/components/ui/label';\nimport { Badge } from '@/components/ui/badge';\nimport { Loader2, FileText, AlertCircle } from 'lucide-react';\n\nexport interface TermSheet {\n  id: string;\n  deal_id: string;\n  version: number;\n  status: string;\n  term_sheet_date: string | null;\n  subscription_fee_percent: number | null;\n  management_fee_percent: number | null;\n  carried_interest_percent: number | null;\n  published_at: string | null;\n}\n\ninterface TermSheetSelectorProps {\n  dealId: string | undefined;\n  value?: string;\n  onChange: (termSheetId: string | undefined, termSheet: TermSheet | null) => void;\n  required?: boolean;\n  disabled?: boolean;\n}\n\nexport function TermSheetSelector({\n  dealId,\n  value,\n  onChange,\n  required = true,\n  disabled = false,\n}: TermSheetSelectorProps) {\n  const [loading, setLoading] = useState(false);\n  const [termSheets, setTermSheets] = useState<TermSheet[]>([]);\n  const [error, setError] = useState<string | null>(null);\n\n  useEffect(() => {\n    if (dealId) {\n      loadTermSheets(dealId);\n    } else {\n      setTermSheets([]);\n      onChange(undefined, null);\n    }\n  }, [dealId]);\n\n  const loadTermSheets = async (dId: string) => {\n    setLoading(true);\n    setError(null);\n    try {\n      const res = await fetch(`/api/deals/${dId}/fee-structures?status=published`);\n      if (!res.ok) {\n        throw new Error('Failed to load term sheets');\n      }\n      const json = await res.json();\n      const sheets = json.term_sheets || [];\n      setTermSheets(sheets);\n\n      // If current value is not in the list, clear it\n      if (value && !sheets.find((ts: TermSheet) => ts.id === value)) {\n        onChange(undefined, null);\n      }\n    } catch (err) {\n      console.error('Error loading term sheets:', err);\n      setError('Failed to load term sheets');\n      setTermSheets([]);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleChange = (termSheetId: string) => {\n    if (termSheetId === 'none') {\n      onChange(undefined, null);\n    } else {\n      const selected = termSheets.find(ts => ts.id === termSheetId);\n      onChange(termSheetId, selected || null);\n    }\n  };\n\n  const formatFeePercent = (value: number | null | undefined): string => {\n    if (value === null || value === undefined) return '-';\n    return `${value}%`;\n  };\n\n  const selectedTermSheet = termSheets.find(ts => ts.id === value);\n\n  if (!dealId) {\n    return (\n      <div className=\"space-y-2\">\n        <Label className=\"text-white font-medium\">\n          Term Sheet {required && <span className=\"text-red-400\">*</span>}\n        </Label>\n        <div className=\"flex items-center gap-2 text-amber-400 text-sm bg-amber-500/10 p-3 rounded border border-amber-500/30\">\n          <AlertCircle className=\"h-4 w-4\" />\n          <span>Select a deal first to see available term sheets</span>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-2\">\n      <Label className=\"text-white font-medium\">\n        Term Sheet {required && <span className=\"text-red-400\">*</span>}\n      </Label>\n\n      {loading ? (\n        <div className=\"flex items-center gap-2 text-gray-400 h-11 px-3 border border-gray-700 rounded-md bg-black\">\n          <Loader2 className=\"h-4 w-4 animate-spin\" />\n          <span className=\"text-sm\">Loading term sheets...</span>\n        </div>\n      ) : error ? (\n        <div className=\"flex items-center gap-2 text-red-400 text-sm bg-red-500/10 p-3 rounded border border-red-500/30\">\n          <AlertCircle className=\"h-4 w-4\" />\n          <span>{error}</span>\n        </div>\n      ) : termSheets.length === 0 ? (\n        <div className=\"flex items-center gap-2 text-amber-400 text-sm bg-amber-500/10 p-3 rounded border border-amber-500/30\">\n          <AlertCircle className=\"h-4 w-4\" />\n          <span>No published term sheets available for this deal. Create and publish a term sheet first.</span>\n        </div>\n      ) : (\n        <>\n          <Select\n            value={value || 'none'}\n            onValueChange={handleChange}\n            disabled={disabled}\n          >\n            <SelectTrigger className=\"bg-black border-gray-700 text-white h-11\">\n              <SelectValue placeholder=\"Select a term sheet\" />\n            </SelectTrigger>\n            <SelectContent className=\"bg-black border-gray-700 text-white\">\n              {!required && (\n                <SelectItem value=\"none\">No term sheet</SelectItem>\n              )}\n              {termSheets.map((ts) => (\n                <SelectItem key={ts.id} value={ts.id}>\n                  <div className=\"flex items-center gap-2\">\n                    <FileText className=\"h-4 w-4 text-gray-400\" />\n                    <span>Version {ts.version}</span>\n                    {ts.term_sheet_date && (\n                      <span className=\"text-gray-400 text-xs\">\n                        ({new Date(ts.term_sheet_date).toLocaleDateString()})\n                      </span>\n                    )}\n                  </div>\n                </SelectItem>\n              ))}\n            </SelectContent>\n          </Select>\n\n          {/* Show fee summary when a term sheet is selected */}\n          {selectedTermSheet && (\n            <div className=\"bg-gray-900/50 border border-gray-700 rounded-md p-3 mt-2\">\n              <p className=\"text-xs text-gray-400 mb-2 font-medium\">Term Sheet Fee Limits:</p>\n              <div className=\"flex flex-wrap gap-2\">\n                <Badge variant=\"outline\" className=\"text-xs border-blue-500/30 text-blue-400\">\n                  Subscription: {formatFeePercent(selectedTermSheet.subscription_fee_percent)}\n                </Badge>\n                <Badge variant=\"outline\" className=\"text-xs border-green-500/30 text-green-400\">\n                  Management: {formatFeePercent(selectedTermSheet.management_fee_percent)}\n                </Badge>\n                <Badge variant=\"outline\" className=\"text-xs border-purple-500/30 text-purple-400\">\n                  Performance: {formatFeePercent(selectedTermSheet.carried_interest_percent)}\n                </Badge>\n              </div>\n              <p className=\"text-xs text-gray-500 mt-2\">\n                Fee model values must not exceed these limits.\n              </p>\n            </div>\n          )}\n        </>\n      )}\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 401, "column": 0}, "map": {"version":3,"sources":["file:///Users/ghilesmoussaoui/Desktop/Versotech/versotech-portal/src/components/fees/EntitySelector.tsx"],"sourcesContent":["/**\n * Entity Selector Component\n *\n * Allows selection of an introducer, partner, or commercial partner for a fee model.\n * Fee models are commercial agreements with entities, not investor-facing.\n */\n\n'use client';\n\nimport { useState, useEffect } from 'react';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { Label } from '@/components/ui/label';\nimport { Loader2, Users, Building2, Briefcase, AlertCircle } from 'lucide-react';\n\nexport type EntityType = 'introducer' | 'partner' | 'commercial_partner';\n\ninterface Entity {\n  id: string;\n  name: string;\n  email?: string;\n  company_name?: string;\n}\n\ninterface EntitySelectorProps {\n  dealId: string | undefined;\n  entityType: EntityType | undefined;\n  onEntityTypeChange: (type: EntityType | undefined) => void;\n  entityId: string | undefined;\n  onEntityIdChange: (id: string | undefined) => void;\n  required?: boolean;\n  disabled?: boolean;\n  /** Entity types to exclude from selection */\n  excludeTypes?: EntityType[];\n}\n\nexport function EntitySelector({\n  dealId,\n  entityType,\n  onEntityTypeChange,\n  entityId,\n  onEntityIdChange,\n  required = true,\n  disabled = false,\n  excludeTypes = [],\n}: EntitySelectorProps) {\n  const [loading, setLoading] = useState(false);\n  const [entities, setEntities] = useState<Entity[]>([]);\n  const [error, setError] = useState<string | null>(null);\n\n  useEffect(() => {\n    if (dealId && entityType) {\n      loadEntities(dealId, entityType);\n    } else {\n      setEntities([]);\n      onEntityIdChange(undefined);\n    }\n  }, [dealId, entityType]);\n\n  const loadEntities = async (dId: string, type: EntityType) => {\n    setLoading(true);\n    setError(null);\n    try {\n      // Load entities dispatched to this deal based on type\n      let endpoint = '';\n      switch (type) {\n        case 'introducer':\n          endpoint = `/api/deals/${dId}/introducers`;\n          break;\n        case 'partner':\n          endpoint = `/api/deals/${dId}/partners`;\n          break;\n        case 'commercial_partner':\n          endpoint = `/api/deals/${dId}/commercial-partners`;\n          break;\n      }\n\n      const res = await fetch(endpoint);\n      if (!res.ok) {\n        // If endpoint doesn't exist or returns error, try fallback\n        console.warn(`Entity endpoint ${endpoint} not available, trying fallback`);\n        await loadEntitiesFallback(type);\n        return;\n      }\n\n      const json = await res.json();\n      // Handle different response formats from various endpoints\n      let entityList = json.introducers || json.partners || json.commercial_partners || [];\n\n      // Deal-specific endpoints return { data: [...] } with transformed entities\n      if (entityList.length === 0 && json.data && Array.isArray(json.data)) {\n        // Transform the deal-specific format to entity format\n        entityList = json.data\n          .filter((item: any) => item.entity_type === type.replace('_', ''))\n          .map((item: any) => ({\n            id: item.entity_id,\n            name: item.entity_name,\n            email: item.entity_email,\n          }));\n      }\n\n      // If still empty, fall back to admin endpoint to get ALL entities\n      if (entityList.length === 0) {\n        console.log(`No ${type}s found for deal, loading all ${type}s from admin endpoint`);\n        await loadEntitiesFallback(type);\n        return;\n      }\n\n      setEntities(entityList);\n\n      // If current value is not in the list, clear it\n      if (entityId && !entityList.find((e: Entity) => e.id === entityId)) {\n        onEntityIdChange(undefined);\n      }\n    } catch (err) {\n      console.error('Error loading entities:', err);\n      await loadEntitiesFallback(type);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  // Fallback to load all entities of a type (not deal-specific)\n  // Uses admin endpoints which list all entities in the system\n  const loadEntitiesFallback = async (type: EntityType) => {\n    try {\n      let endpoint = '';\n      switch (type) {\n        case 'introducer':\n          endpoint = '/api/admin/introducers';\n          break;\n        case 'partner':\n          endpoint = '/api/admin/partners';\n          break;\n        case 'commercial_partner':\n          endpoint = '/api/admin/commercial-partners';\n          break;\n      }\n\n      const res = await fetch(endpoint);\n      if (!res.ok) {\n        throw new Error(`Failed to load ${type}s`);\n      }\n\n      const json = await res.json();\n      // Admin endpoints return data in various formats - handle all possibilities\n      const entityList = json.introducers || json.partners || json.commercial_partners || json.data || [];\n\n      // Map the entity list to a common format\n      const normalizedEntities = entityList.map((entity: any) => ({\n        id: entity.id,\n        name: entity.name || entity.legal_name || entity.company_name || entity.contact_name,\n        email: entity.email || entity.contact_email,\n        company_name: entity.company_name || entity.legal_name,\n      }));\n\n      setEntities(normalizedEntities);\n    } catch (err) {\n      console.error('Error in fallback loading:', err);\n      setError(`Failed to load ${type}s`);\n      setEntities([]);\n    }\n  };\n\n  const handleEntityTypeChange = (value: string) => {\n    if (value === 'none') {\n      onEntityTypeChange(undefined);\n      onEntityIdChange(undefined);\n    } else {\n      onEntityTypeChange(value as EntityType);\n      onEntityIdChange(undefined); // Reset entity when type changes\n    }\n  };\n\n  const handleEntityChange = (value: string) => {\n    if (value === 'none') {\n      onEntityIdChange(undefined);\n    } else {\n      onEntityIdChange(value);\n    }\n  };\n\n  const getEntityTypeIcon = (type: EntityType | undefined) => {\n    switch (type) {\n      case 'introducer':\n        return <Users className=\"h-4 w-4\" />;\n      case 'partner':\n        return <Building2 className=\"h-4 w-4\" />;\n      case 'commercial_partner':\n        return <Briefcase className=\"h-4 w-4\" />;\n      default:\n        return null;\n    }\n  };\n\n  const getEntityTypeLabel = (type: EntityType): string => {\n    switch (type) {\n      case 'introducer':\n        return 'Introducer';\n      case 'partner':\n        return 'Partner';\n      case 'commercial_partner':\n        return 'Commercial Partner';\n    }\n  };\n\n  if (!dealId) {\n    return (\n      <div className=\"space-y-4\">\n        <div className=\"space-y-2\">\n          <Label className=\"text-white font-medium\">\n            Entity Type {required && <span className=\"text-red-400\">*</span>}\n          </Label>\n          <div className=\"flex items-center gap-2 text-amber-400 text-sm bg-amber-500/10 p-3 rounded border border-amber-500/30\">\n            <AlertCircle className=\"h-4 w-4\" />\n            <span>Select a deal first to assign an entity</span>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-4\">\n      {/* Entity Type Selector */}\n      <div className=\"space-y-2\">\n        <Label className=\"text-white font-medium\">\n          Entity Type {required && <span className=\"text-red-400\">*</span>}\n        </Label>\n        <Select\n          value={entityType || 'none'}\n          onValueChange={handleEntityTypeChange}\n          disabled={disabled}\n        >\n          <SelectTrigger className=\"bg-black border-gray-700 text-white h-11\">\n            <SelectValue placeholder=\"Select entity type\" />\n          </SelectTrigger>\n          <SelectContent className=\"bg-black border-gray-700 text-white\">\n            {!required && (\n              <SelectItem value=\"none\">No entity</SelectItem>\n            )}\n            {!excludeTypes.includes('introducer') && (\n              <SelectItem value=\"introducer\">\n                <div className=\"flex items-center gap-2\">\n                  <Users className=\"h-4 w-4 text-blue-400\" />\n                  <span>Introducer</span>\n                </div>\n              </SelectItem>\n            )}\n            {!excludeTypes.includes('partner') && (\n              <SelectItem value=\"partner\">\n                <div className=\"flex items-center gap-2\">\n                  <Building2 className=\"h-4 w-4 text-green-400\" />\n                  <span>Partner</span>\n                </div>\n              </SelectItem>\n            )}\n            {!excludeTypes.includes('commercial_partner') && (\n              <SelectItem value=\"commercial_partner\">\n                <div className=\"flex items-center gap-2\">\n                  <Briefcase className=\"h-4 w-4 text-purple-400\" />\n                  <span>Commercial Partner</span>\n                </div>\n              </SelectItem>\n            )}\n          </SelectContent>\n        </Select>\n      </div>\n\n      {/* Entity Selector (only shown when type is selected) */}\n      {entityType && (\n        <div className=\"space-y-2\">\n          <Label className=\"text-white font-medium\">\n            {getEntityTypeLabel(entityType)} {required && <span className=\"text-red-400\">*</span>}\n          </Label>\n\n          {loading ? (\n            <div className=\"flex items-center gap-2 text-gray-400 h-11 px-3 border border-gray-700 rounded-md bg-black\">\n              <Loader2 className=\"h-4 w-4 animate-spin\" />\n              <span className=\"text-sm\">Loading {entityType}s...</span>\n            </div>\n          ) : error ? (\n            <div className=\"flex items-center gap-2 text-red-400 text-sm bg-red-500/10 p-3 rounded border border-red-500/30\">\n              <AlertCircle className=\"h-4 w-4\" />\n              <span>{error}</span>\n            </div>\n          ) : entities.length === 0 ? (\n            <div className=\"flex items-center gap-2 text-amber-400 text-sm bg-amber-500/10 p-3 rounded border border-amber-500/30\">\n              <AlertCircle className=\"h-4 w-4\" />\n              <span>No {entityType}s available. Add {entityType}s to the system first.</span>\n            </div>\n          ) : (\n            <Select\n              value={entityId || 'none'}\n              onValueChange={handleEntityChange}\n              disabled={disabled}\n            >\n              <SelectTrigger className=\"bg-black border-gray-700 text-white h-11\">\n                <SelectValue placeholder={`Select ${getEntityTypeLabel(entityType)}`} />\n              </SelectTrigger>\n              <SelectContent className=\"bg-black border-gray-700 text-white max-h-60\">\n                {!required && (\n                  <SelectItem value=\"none\">No selection</SelectItem>\n                )}\n                {entities.map((entity) => (\n                  <SelectItem key={entity.id} value={entity.id}>\n                    <div className=\"flex items-center gap-2\">\n                      {getEntityTypeIcon(entityType)}\n                      <span>{entity.name || entity.company_name}</span>\n                      {entity.email && (\n                        <span className=\"text-gray-400 text-xs\">({entity.email})</span>\n                      )}\n                    </div>\n                  </SelectItem>\n                ))}\n              </SelectContent>\n            </Select>\n          )}\n        </div>\n      )}\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1013, "column": 0}, "map": {"version":3,"sources":["file:///Users/ghilesmoussaoui/Desktop/Versotech/versotech-portal/src/components/fees/GenerateInvoiceModal.tsx"],"sourcesContent":["/**\r\n * Generate Invoice Modal\r\n * Form to create invoices from accrued fee events\r\n */\r\n\r\n'use client';\r\n\r\nimport { useState, useEffect, useCallback } from 'react';\r\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from '@/components/ui/dialog';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Input } from '@/components/ui/input';\r\nimport { Label } from '@/components/ui/label';\r\nimport { Textarea } from '@/components/ui/textarea';\r\nimport { Checkbox } from '@/components/ui/checkbox';\r\nimport {\r\n  Select,\r\n  SelectContent,\r\n  SelectItem,\r\n  SelectTrigger,\r\n  SelectValue,\r\n} from '@/components/ui/select';\r\nimport { Badge } from '@/components/ui/badge';\r\nimport { Plus, Trash2, Loader2 } from 'lucide-react';\r\nimport { formatCurrency } from '@/lib/fees/calculations';\r\n\r\ninterface FeeEvent {\r\n  id: string;\r\n  fee_type: string;\r\n  computed_amount: number;\r\n  event_date: string;\r\n  investor?: {\r\n    id: string;\r\n    legal_name: string;\r\n    display_name: string;\r\n  };\r\n  deal?: {\r\n    id: string;\r\n    name: string;\r\n  };\r\n}\r\n\r\ninterface CustomLineItem {\r\n  description: string;\r\n  amount: number;\r\n  quantity: number;\r\n}\r\n\r\ninterface Subscription {\r\n  id: string;\r\n  subscription_number: string;\r\n  commitment: number;\r\n  vehicle?: {\r\n    id: string;\r\n    name: string;\r\n    short_name?: string;\r\n  };\r\n}\r\n\r\ninterface Props {\r\n  open: boolean;\r\n  onClose: () => void;\r\n  onSuccess: () => void;\r\n  preselectedInvestorId?: string; // If set, auto-select investor and fetch their fee events\r\n}\r\n\r\nexport function GenerateInvoiceModal({ open, onClose, onSuccess, preselectedInvestorId }: Props) {\r\n  const [loading, setLoading] = useState(false);\r\n  const [fetchingEvents, setFetchingEvents] = useState(false);\r\n  const [fetchingSubscriptions, setFetchingSubscriptions] = useState(false);\r\n\r\n  // Form state\r\n  const [investorId, setInvestorId] = useState<string>('');\r\n  const [subscriptionId, setSubscriptionId] = useState<string>('');\r\n  const [dealId, setDealId] = useState<string>('');\r\n  const [dueDate, setDueDate] = useState<string>('');\r\n  const [notes, setNotes] = useState<string>('');\r\n  const [selectedEventIds, setSelectedEventIds] = useState<Set<string>>(new Set());\r\n  const [customLineItems, setCustomLineItems] = useState<CustomLineItem[]>([]);\r\n\r\n  // Data state\r\n  const [feeEvents, setFeeEvents] = useState<FeeEvent[]>([]);\r\n  const [investors, setInvestors] = useState<any[]>([]);\r\n  const [subscriptions, setSubscriptions] = useState<Subscription[]>([]);\r\n\r\n  // Set preselected investor on mount\r\n  useEffect(() => {\r\n    if (open && preselectedInvestorId) {\r\n      console.log('[GenerateInvoiceModal] Preselected investor ID:', preselectedInvestorId, 'Type:', typeof preselectedInvestorId);\r\n\r\n      // Validate the investor ID is a valid UUID format\r\n      const uuidRegex = /^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i;\r\n      if (uuidRegex.test(preselectedInvestorId)) {\r\n        console.log('[GenerateInvoiceModal] Valid UUID, setting investorId');\r\n        setInvestorId(preselectedInvestorId);\r\n      } else {\r\n        console.error('[GenerateInvoiceModal] Invalid investor ID format:', preselectedInvestorId);\r\n        alert(`Invalid investor ID format: ${preselectedInvestorId}`);\r\n      }\r\n    }\r\n  }, [open, preselectedInvestorId]);\r\n\r\n  const fetchInvestors = useCallback(async () => {\r\n    try {\r\n      console.log('[GenerateInvoiceModal] Fetching investors...');\r\n      const res = await fetch('/api/investors?limit=1000');\r\n      const json = await res.json();\r\n      console.log('[GenerateInvoiceModal] Investors fetched:', json.data?.length || 0);\r\n      setInvestors(json.data || []);\r\n    } catch (error) {\r\n      console.error('Error fetching investors:', error);\r\n    }\r\n  }, []);\r\n\r\n  // Fetch investors on mount\r\n  useEffect(() => {\r\n    if (open) {\r\n      fetchInvestors();\r\n    }\r\n  }, [open, fetchInvestors]);\r\n\r\n  const fetchSubscriptions = useCallback(async () => {\r\n    if (!investorId) return;\r\n\r\n    setFetchingSubscriptions(true);\r\n    try {\r\n      console.log('[GenerateInvoiceModal] Fetching ALL subscriptions for investor:', investorId);\r\n\r\n      // Fetch ALL subscriptions for this investor (not just committed)\r\n      const subsRes = await fetch(`/api/subscriptions?investor_id=${investorId}`);\r\n      const subsJson = await subsRes.json();\r\n      const allSubs = subsJson.data || [];\r\n\r\n      console.log('[GenerateInvoiceModal] All subscriptions fetched:', allSubs.length);\r\n\r\n      // Now fetch fee events to see which subs have fees\r\n      const feeEventsRes = await fetch(`/api/staff/fees/events?status=accrued&investor_id=${investorId}&limit=500`);\r\n      const feeEventsJson = await feeEventsRes.json();\r\n\r\n      if (!feeEventsRes.ok) {\r\n        console.error('[GenerateInvoiceModal] Fee events API error:', feeEventsJson);\r\n        setSubscriptions([]);\r\n        setFetchingSubscriptions(false);\r\n        return;\r\n      }\r\n\r\n      const allFeeEvents = feeEventsJson.data || [];\r\n\r\n      console.log('[GenerateInvoiceModal] Fee events fetched:', allFeeEvents.length);\r\n      console.log('[GenerateInvoiceModal] Sample fee event:', allFeeEvents[0]);\r\n\r\n      // Get unique subscription IDs from fee events (check allocation_id)\r\n      const subscriptionIdsWithFees = [...new Set(\r\n        allFeeEvents\r\n          .map((event: any) => event.allocation_id)\r\n          .filter(Boolean)\r\n      )];\r\n\r\n      console.log('[GenerateInvoiceModal] Subscription IDs with fee events:', subscriptionIdsWithFees);\r\n\r\n      // Filter subscriptions to only those with fee events\r\n      const subsWithFees = allSubs.filter((sub: any) =>\r\n        subscriptionIdsWithFees.includes(sub.id)\r\n      );\r\n\r\n      console.log('[GenerateInvoiceModal] Subscriptions that have fees:', subsWithFees.length);\r\n      console.log('[GenerateInvoiceModal] Subscription details:', subsWithFees);\r\n\r\n      setSubscriptions(subsWithFees);\r\n\r\n      // If only one subscription, auto-select it\r\n      if (subsWithFees.length === 1) {\r\n        console.log('[GenerateInvoiceModal] Auto-selecting single subscription:', subsWithFees[0].id);\r\n        setSubscriptionId(subsWithFees[0].id);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error fetching subscriptions:', error);\r\n      setSubscriptions([]);\r\n    } finally {\r\n      setFetchingSubscriptions(false);\r\n    }\r\n  }, [investorId]);\r\n\r\n  const fetchFeeEvents = useCallback(async () => {\r\n    if (!investorId || !subscriptionId) {\r\n      console.log('[GenerateInvoiceModal] Missing investor or subscription ID, skipping fetch');\r\n      return;\r\n    }\r\n\r\n    console.log('[GenerateInvoiceModal] Starting fetchFeeEvents with investorId:', investorId, 'subscriptionId:', subscriptionId);\r\n\r\n    setFetchingEvents(true);\r\n    try {\r\n      const params = new URLSearchParams({\r\n        status: 'accrued',\r\n        investor_id: investorId,\r\n        allocation_id: subscriptionId, // Filter by specific subscription\r\n        limit: '100',\r\n        offset: '0',\r\n      });\r\n\r\n      console.log('[GenerateInvoiceModal] Fetching fee events for investor:', investorId, 'subscription:', subscriptionId);\r\n      console.log('[GenerateInvoiceModal] URL params:', params.toString());\r\n      const res = await fetch(`/api/staff/fees/events?${params}`);\r\n      const json = await res.json();\r\n      console.log('[GenerateInvoiceModal] Fee events response:', json);\r\n\r\n      // Check for API errors\r\n      if (!res.ok || json.error) {\r\n        console.error('[GenerateInvoiceModal] API error:', json.error || res.statusText);\r\n        console.error('[GenerateInvoiceModal] Validation details:', JSON.stringify(json.details, null, 2));\r\n\r\n        // Format validation errors for display\r\n        let errorMessage = `Failed to load fee events: ${json.error || res.statusText}`;\r\n        if (json.details && Array.isArray(json.details)) {\r\n          errorMessage += '\\n\\nValidation errors:';\r\n          json.details.forEach((issue: any) => {\r\n            errorMessage += `\\n- Field: ${issue.path?.join('.')}, Error: ${issue.message}`;\r\n          });\r\n        }\r\n\r\n        alert(errorMessage);\r\n        setFeeEvents([]);\r\n        return;\r\n      }\r\n\r\n      setFeeEvents(json.data || []);\r\n      console.log('[GenerateInvoiceModal] Set fee events count:', json.data?.length || 0);\r\n    } catch (error) {\r\n      console.error('Error fetching fee events:', error);\r\n      alert(`Error loading fee events: ${error instanceof Error ? error.message : 'Unknown error'}`);\r\n      setFeeEvents([]);\r\n    } finally {\r\n      setFetchingEvents(false);\r\n    }\r\n  }, [investorId, subscriptionId]);\r\n\r\n  // Fetch subscriptions when investor changes\r\n  useEffect(() => {\r\n    if (investorId) {\r\n      fetchSubscriptions();\r\n    } else {\r\n      setSubscriptions([]);\r\n      setSubscriptionId('');\r\n    }\r\n  }, [investorId, fetchSubscriptions]);\r\n\r\n  // Fetch fee events when investor or subscription changes\r\n  useEffect(() => {\r\n    if (investorId && subscriptionId) {\r\n      fetchFeeEvents();\r\n    } else if (investorId && !subscriptionId) {\r\n      // Clear fee events when no subscription selected\r\n      setFeeEvents([]);\r\n    }\r\n  }, [investorId, subscriptionId, fetchFeeEvents]);\r\n\r\n  const toggleEventSelection = (eventId: string) => {\r\n    const newSelection = new Set(selectedEventIds);\r\n    if (newSelection.has(eventId)) {\r\n      newSelection.delete(eventId);\r\n    } else {\r\n      newSelection.add(eventId);\r\n    }\r\n    setSelectedEventIds(newSelection);\r\n  };\r\n\r\n  const addCustomLineItem = () => {\r\n    setCustomLineItems([\r\n      ...customLineItems,\r\n      { description: '', amount: 0, quantity: 1 },\r\n    ]);\r\n  };\r\n\r\n  const removeCustomLineItem = (index: number) => {\r\n    setCustomLineItems(customLineItems.filter((_, i) => i !== index));\r\n  };\r\n\r\n  const updateCustomLineItem = (index: number, field: keyof CustomLineItem, value: any) => {\r\n    const updated = [...customLineItems];\r\n    updated[index] = { ...updated[index], [field]: value };\r\n    setCustomLineItems(updated);\r\n  };\r\n\r\n  const calculateTotal = () => {\r\n    const eventsTotal = feeEvents\r\n      .filter((event) => selectedEventIds.has(event.id))\r\n      .reduce((sum, event) => sum + Number(event.computed_amount), 0);\r\n\r\n    const customTotal = customLineItems.reduce(\r\n      (sum, item) => sum + (item.amount * item.quantity),\r\n      0\r\n    );\r\n\r\n    return eventsTotal + customTotal;\r\n  };\r\n\r\n  const handleSubmit = async () => {\r\n    console.log('[GenerateInvoiceModal] handleSubmit called');\r\n    console.log('[GenerateInvoiceModal] Current state:', {\r\n      investorId,\r\n      selectedEventIds: Array.from(selectedEventIds),\r\n      dueDate,\r\n      notes,\r\n      customLineItems,\r\n    });\r\n\r\n    if (!investorId || !subscriptionId || selectedEventIds.size === 0 || !dueDate) {\r\n      alert('Please select an investor, subscription, at least one fee event, and a due date');\r\n      return;\r\n    }\r\n\r\n    setLoading(true);\r\n    try {\r\n      // Format due date as ISO string with time at end of day\r\n      const formattedDueDate = dueDate ? new Date(dueDate + 'T23:59:59').toISOString() : '';\r\n\r\n      const requestBody = {\r\n        investor_id: investorId,\r\n        deal_id: dealId || undefined,\r\n        fee_event_ids: Array.from(selectedEventIds),\r\n        due_date: formattedDueDate,\r\n        notes: notes || undefined,\r\n        custom_line_items: customLineItems.length > 0 ? customLineItems : undefined,\r\n      };\r\n\r\n      console.log('[GenerateInvoiceModal] Request body created:', requestBody);\r\n      console.log('[GenerateInvoiceModal] Sending request to /api/staff/fees/invoices/generate-simple');\r\n\r\n      // Use simplified endpoint\r\n      const res = await fetch('/api/staff/fees/invoices/generate-simple', {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify(requestBody),\r\n      });\r\n\r\n      if (!res.ok) {\r\n        const error = await res.json();\r\n        console.error('[GenerateInvoiceModal] Invoice generation failed:', error);\r\n        console.error('[GenerateInvoiceModal] Request body was:', {\r\n          investor_id: investorId,\r\n          deal_id: dealId || undefined,\r\n          fee_event_ids: Array.from(selectedEventIds),\r\n          due_date: dueDate,\r\n          notes,\r\n          custom_line_items: customLineItems.length > 0 ? customLineItems : undefined,\r\n        });\r\n        throw new Error(error.error || error.details ? JSON.stringify(error.details, null, 2) : 'Failed to generate invoice');\r\n      }\r\n\r\n      onSuccess();\r\n      handleClose();\r\n    } catch (error) {\r\n      console.error('Error generating invoice:', error);\r\n      alert(error instanceof Error ? error.message : 'Failed to generate invoice');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleClose = () => {\r\n    setInvestorId('');\r\n    setSubscriptionId('');\r\n    setDealId('');\r\n    setDueDate('');\r\n    setNotes('');\r\n    setSelectedEventIds(new Set());\r\n    setCustomLineItems([]);\r\n    setFeeEvents([]);\r\n    setSubscriptions([]);\r\n    onClose();\r\n  };\r\n\r\n  const total = calculateTotal();\r\n\r\n  return (\r\n    <Dialog open={open} onOpenChange={handleClose}>\r\n      <DialogContent className=\"max-w-4xl max-h-[90vh] overflow-y-auto\">\r\n        <DialogHeader>\r\n          <DialogTitle>Generate Invoice</DialogTitle>\r\n        </DialogHeader>\r\n\r\n        <div className=\"space-y-6\">\r\n          {/* Investor Selection or Display */}\r\n          {preselectedInvestorId ? (\r\n            // Show the preselected investor as read-only\r\n            <div>\r\n              <Label className=\"text-white\">Investor</Label>\r\n              <div className=\"flex items-center gap-2 p-2 border border-white/20 rounded-md bg-black/20\">\r\n                <span className=\"text-sm font-medium text-white\">\r\n                  {investors.find(i => i.id === investorId)?.legal_name ||\r\n                   investors.find(i => i.id === investorId)?.display_name ||\r\n                   feeEvents[0]?.investor?.legal_name ||\r\n                   feeEvents[0]?.investor?.display_name ||\r\n                   'Loading...'}\r\n                </span>\r\n                <Badge variant=\"outline\" className=\"ml-auto text-white border-white/20\">Pre-selected</Badge>\r\n              </div>\r\n            </div>\r\n          ) : (\r\n            // Show investor selector only when not preselected\r\n            <div>\r\n              <Label htmlFor=\"investor\" className=\"text-white\">Investor *</Label>\r\n              <Select value={investorId} onValueChange={setInvestorId}>\r\n                <SelectTrigger id=\"investor\">\r\n                  <SelectValue placeholder=\"Select investor\" />\r\n                </SelectTrigger>\r\n                <SelectContent>\r\n                  {investors.map((investor) => (\r\n                    <SelectItem key={investor.id} value={investor.id}>\r\n                      {investor.legal_name || investor.display_name}\r\n                    </SelectItem>\r\n                  ))}\r\n                </SelectContent>\r\n              </Select>\r\n            </div>\r\n          )}\r\n\r\n          {/* Subscription Selection - shows after investor is selected */}\r\n          {investorId && (\r\n            <div>\r\n              <Label htmlFor=\"subscription\" className=\"text-white\">Subscription *</Label>\r\n              {fetchingSubscriptions ? (\r\n                <div className=\"flex items-center justify-center p-2 border border-white/20 rounded-md\">\r\n                  <Loader2 className=\"h-4 w-4 animate-spin mr-2\" />\r\n                  <span className=\"text-sm text-muted-foreground\">Loading subscriptions...</span>\r\n                </div>\r\n              ) : subscriptions.length === 0 ? (\r\n                <div className=\"p-2 border border-red-500/30 rounded-md bg-red-500/10\">\r\n                  <p className=\"text-sm text-red-300 font-medium\">No subscriptions with accrued fees found</p>\r\n                  <p className=\"text-xs text-red-400 mt-1\">\r\n                    This investor has no uninvoiced fee events. Fee events may not have been calculated yet, or all fees have already been invoiced.\r\n                  </p>\r\n                </div>\r\n              ) : (\r\n                <Select value={subscriptionId} onValueChange={setSubscriptionId}>\r\n                  <SelectTrigger id=\"subscription\">\r\n                    <SelectValue placeholder=\"Select subscription\" />\r\n                  </SelectTrigger>\r\n                  <SelectContent>\r\n                    {subscriptions.map((subscription) => (\r\n                      <SelectItem key={subscription.id} value={subscription.id}>\r\n                        {subscription.subscription_number} - {subscription.vehicle?.name || 'Unknown Vehicle'}\r\n                        ({formatCurrency(subscription.commitment)})\r\n                      </SelectItem>\r\n                    ))}\r\n                  </SelectContent>\r\n                </Select>\r\n              )}\r\n            </div>\r\n          )}\r\n\r\n          {/* Due Date */}\r\n          <div>\r\n            <Label htmlFor=\"due_date\" className=\"text-white\">Due Date *</Label>\r\n            <Input\r\n              id=\"due_date\"\r\n              type=\"date\"\r\n              value={dueDate}\r\n              onChange={(e) => setDueDate(e.target.value)}\r\n            />\r\n          </div>\r\n\r\n          {/* Fee Events Selection - shows after subscription is selected */}\r\n          {investorId && subscriptionId && (\r\n            <div>\r\n              <div className=\"flex items-center justify-between mb-2\">\r\n                <Label className=\"text-white\">Fee Events to Invoice *</Label>\r\n                {feeEvents.length > 0 && (\r\n                  <Button\r\n                    type=\"button\"\r\n                    variant=\"outline\"\r\n                    size=\"sm\"\r\n                    onClick={() => {\r\n                      if (selectedEventIds.size === feeEvents.length) {\r\n                        // Deselect all\r\n                        setSelectedEventIds(new Set());\r\n                      } else {\r\n                        // Select all\r\n                        setSelectedEventIds(new Set(feeEvents.map(e => e.id)));\r\n                      }\r\n                    }}\r\n                  >\r\n                    {selectedEventIds.size === feeEvents.length ? 'Deselect All' : 'Select All'}\r\n                  </Button>\r\n                )}\r\n              </div>\r\n              {fetchingEvents ? (\r\n                <div className=\"py-4 text-center text-sm text-muted-foreground\">\r\n                  Loading fee events...\r\n                </div>\r\n              ) : feeEvents.length === 0 ? (\r\n                <div className=\"py-4 text-center text-sm text-muted-foreground\">\r\n                  No accrued fee events found for this investor\r\n                </div>\r\n              ) : (\r\n                <div className=\"mt-2 space-y-2 border border-border rounded-lg p-4 max-h-60 overflow-y-auto\">\r\n                  {feeEvents.map((event) => (\r\n                    <div\r\n                      key={event.id}\r\n                      className=\"flex items-center justify-between p-2 hover:bg-accent/10 rounded\"\r\n                    >\r\n                      <div className=\"flex items-center gap-3\">\r\n                        <Checkbox\r\n                          checked={selectedEventIds.has(event.id)}\r\n                          onCheckedChange={() => toggleEventSelection(event.id)}\r\n                        />\r\n                        <div>\r\n                          <div className=\"font-medium text-white\">\r\n                            <Badge variant=\"outline\" className=\"mr-2 text-white border-white/20\">\r\n                              {event.fee_type === 'flat' ? 'Investment' : event.fee_type.replace('_', ' ')}\r\n                            </Badge>\r\n                            <span className=\"text-white\">{formatCurrency(event.computed_amount)}</span>\r\n                          </div>\r\n                          <div className=\"text-sm text-gray-400\">\r\n                            {new Date(event.event_date).toLocaleDateString()}\r\n                            {event.deal && ` â€¢ ${event.deal.name}`}\r\n                          </div>\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  ))}\r\n                </div>\r\n              )}\r\n            </div>\r\n          )}\r\n\r\n          {/* Custom Line Items */}\r\n          <div>\r\n            <div className=\"flex items-center justify-between mb-2\">\r\n              <Label className=\"text-white\">Custom Line Items (Optional)</Label>\r\n              <Button\r\n                type=\"button\"\r\n                variant=\"outline\"\r\n                size=\"sm\"\r\n                onClick={addCustomLineItem}\r\n              >\r\n                <Plus className=\"mr-2 h-4 w-4\" />\r\n                Add Line Item\r\n              </Button>\r\n            </div>\r\n            {customLineItems.map((item, index) => (\r\n              <div key={index} className=\"flex gap-2 mb-2\">\r\n                <Input\r\n                  placeholder=\"Description\"\r\n                  value={item.description}\r\n                  onChange={(e) =>\r\n                    updateCustomLineItem(index, 'description', e.target.value)\r\n                  }\r\n                  className=\"flex-1\"\r\n                />\r\n                <Input\r\n                  type=\"number\"\r\n                  placeholder=\"Qty\"\r\n                  value={item.quantity}\r\n                  onChange={(e) =>\r\n                    updateCustomLineItem(index, 'quantity', parseFloat(e.target.value))\r\n                  }\r\n                  className=\"w-20\"\r\n                />\r\n                <Input\r\n                  type=\"number\"\r\n                  placeholder=\"Amount\"\r\n                  value={item.amount}\r\n                  onChange={(e) =>\r\n                    updateCustomLineItem(index, 'amount', parseFloat(e.target.value))\r\n                  }\r\n                  className=\"w-32\"\r\n                />\r\n                <Button\r\n                  type=\"button\"\r\n                  variant=\"ghost\"\r\n                  size=\"icon\"\r\n                  onClick={() => removeCustomLineItem(index)}\r\n                >\r\n                  <Trash2 className=\"h-4 w-4\" />\r\n                </Button>\r\n              </div>\r\n            ))}\r\n          </div>\r\n\r\n          {/* Notes */}\r\n          <div>\r\n            <Label htmlFor=\"notes\" className=\"text-white\">Notes (Optional)</Label>\r\n            <Textarea\r\n              id=\"notes\"\r\n              value={notes}\r\n              onChange={(e) => setNotes(e.target.value)}\r\n              placeholder=\"Add any additional notes for the invoice\"\r\n              rows={3}\r\n            />\r\n          </div>\r\n\r\n          {/* Total Preview */}\r\n          {selectedEventIds.size > 0 && (\r\n            <div className=\"bg-accent p-4 rounded-lg\">\r\n              <div className=\"flex items-center justify-between text-lg font-bold\">\r\n                <span>Total Amount:</span>\r\n                <span>{formatCurrency(total)}</span>\r\n              </div>\r\n              <div className=\"text-sm text-muted-foreground mt-1\">\r\n                {selectedEventIds.size} fee event(s)\r\n                {customLineItems.length > 0 && ` + ${customLineItems.length} custom item(s)`}\r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n          {/* Actions */}\r\n          <div className=\"flex justify-end gap-2\">\r\n            <Button variant=\"outline\" onClick={handleClose} disabled={loading}>\r\n              Cancel\r\n            </Button>\r\n            <Button onClick={handleSubmit} disabled={loading || selectedEventIds.size === 0}>\r\n              {loading && <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />}\r\n              Generate Invoice\r\n            </Button>\r\n          </div>\r\n        </div>\r\n      </DialogContent>\r\n    </Dialog>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1981, "column": 0}, "map": {"version":3,"sources":["file:///Users/ghilesmoussaoui/Desktop/Versotech/versotech-portal/src/components/fees/CommissionsTab.tsx"],"sourcesContent":["/**\r\n * Commissions Tab - Manage entity commissions (introducers, partners, commercial partners)\r\n */\r\n\r\n'use client';\r\n\r\nimport { useEffect, useState, useCallback } from 'react';\r\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Badge } from '@/components/ui/badge';\r\nimport { DollarSign, CheckCircle, Clock, AlertCircle, ExternalLink, FileText, Users, Briefcase, Building2, Send } from 'lucide-react';\r\nimport { formatCurrency } from '@/lib/fees/calculations';\r\nimport Link from 'next/link';\r\n\r\ntype EntityType = 'introducer' | 'partner' | 'commercial_partner';\r\n\r\ninterface Commission {\r\n  id: string;\r\n  entity_type: EntityType;\r\n  entity_id: string;\r\n  entity_name: string;\r\n  entity_contact?: string;\r\n  entity_email?: string;\r\n  deal_id: string | null;\r\n  deal_name?: string;\r\n  investor_id: string | null;\r\n  investor_name?: string;\r\n  fee_plan_id?: string | null;\r\n  fee_plan_name?: string;\r\n  basis_type: string;\r\n  rate_bps: number;\r\n  accrual_amount: number;\r\n  currency: string;\r\n  status: 'accrued' | 'invoice_requested' | 'invoice_submitted' | 'invoiced' | 'paid' | 'rejected' | 'cancelled';\n  invoice_id: string | null;\r\n  paid_at: string | null;\r\n  created_at: string;\r\n  base_amount: number;\r\n  payment_due_date: string | null;\r\n  payment_reference: string | null;\r\n  notes: string | null;\r\n}\r\n\r\ninterface EntityGroup {\r\n  entity_type: EntityType;\r\n  entity: {\r\n    id: string;\r\n    name: string;\r\n    contact_name?: string;\r\n    email?: string;\r\n  };\r\n  commissions: Commission[];\r\n  totals: {\r\n    accrued: number;\r\n    invoiced: number;\r\n    paid: number;\r\n    total: number;\r\n  };\r\n}\r\n\r\ninterface CommissionsData {\r\n  data: Commission[];\r\n  summary: {\r\n    total_accrued: number;\r\n    total_invoiced: number;\r\n    total_paid: number;\r\n    total_overdue: number;\r\n    total_owed: number;\r\n  };\r\n  by_entity: EntityGroup[];\r\n}\r\n\r\nconst statusColors = {\n  accrued: 'secondary',\n  invoice_requested: 'outline',\n  invoice_submitted: 'default',\n  invoiced: 'default',\n  paid: 'default',\n  rejected: 'destructive',\n  cancelled: 'secondary',\n} as const;\n\nconst statusIcons = {\n  accrued: Clock,\n  invoice_requested: Send,\n  invoice_submitted: FileText,\n  invoiced: FileText,\n  paid: CheckCircle,\n  rejected: AlertCircle,\n  cancelled: AlertCircle,\n};\n\r\n// Entity type configuration\r\nconst entityConfig: Record<EntityType, { label: string; icon: typeof Users; linkPath: string; color: string }> = {\r\n  introducer: {\r\n    label: 'Introducer',\r\n    icon: Users,\r\n    linkPath: '/versotech_main/introducers',\r\n    color: 'text-blue-400',\r\n  },\r\n  partner: {\r\n    label: 'Partner',\r\n    icon: Briefcase,\r\n    linkPath: '/versotech_main/partners',\r\n    color: 'text-purple-400',\r\n  },\r\n  commercial_partner: {\r\n    label: 'Commercial Partner',\r\n    icon: Building2,\r\n    linkPath: '/versotech_main/commercial-partners',\r\n    color: 'text-orange-400',\r\n  },\r\n};\r\n\r\n// Fallback for unknown entity types\r\nconst getEntityConfig = (type: EntityType) => {\r\n  return entityConfig[type] || entityConfig.introducer;\r\n};\r\n\r\nexport default function CommissionsTab() {\r\n  const [data, setData] = useState<CommissionsData | null>(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [statusFilter, setStatusFilter] = useState<'all' | 'accrued' | 'invoice_requested' | 'invoice_submitted' | 'invoiced' | 'paid' | 'rejected' | 'cancelled'>('all');\n  const [entityTypeFilter, setEntityTypeFilter] = useState<'all' | EntityType>('all');\r\n  const [actionLoading, setActionLoading] = useState<string | null>(null);\r\n\r\n  const fetchCommissions = useCallback(async () => {\r\n    setLoading(true);\r\n    try {\r\n      const params = new URLSearchParams();\r\n      if (statusFilter !== 'all') params.set('status', statusFilter);\r\n      if (entityTypeFilter !== 'all') params.set('entity_type', entityTypeFilter);\r\n\r\n      const url = params.toString()\r\n        ? `/api/staff/fees/commissions?${params.toString()}`\r\n        : '/api/staff/fees/commissions';\r\n      const res = await fetch(url);\r\n      const json = await res.json();\r\n      setData(json);\r\n    } catch (error) {\r\n      console.error('Error fetching commissions:', error);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }, [statusFilter, entityTypeFilter]);\r\n\r\n  useEffect(() => {\r\n    fetchCommissions();\r\n  }, [statusFilter, entityTypeFilter, fetchCommissions]);\r\n\r\n  const handleMarkInvoiced = async (commissionId: string, entityType: EntityType) => {\r\n    setActionLoading(commissionId);\r\n    try {\r\n      const res = await fetch(`/api/staff/fees/commissions/${commissionId}/mark-invoiced`, {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({ entity_type: entityType }),\r\n      });\r\n      if (res.ok) {\r\n        fetchCommissions();\r\n      } else {\r\n        const error = await res.json();\r\n        alert(`Failed to mark as invoiced: ${error.error}`);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error marking as invoiced:', error);\r\n      alert('Failed to mark as invoiced');\r\n    } finally {\r\n      setActionLoading(null);\r\n    }\r\n  };\r\n\r\n  const handleMarkPaid = async (commissionId: string, entityType: EntityType) => {\r\n    const reference = prompt('Enter payment reference (optional):');\r\n\r\n    setActionLoading(commissionId);\r\n    try {\r\n      const res = await fetch(`/api/staff/fees/commissions/${commissionId}/mark-paid`, {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({ payment_reference: reference, entity_type: entityType }),\r\n      });\r\n      if (res.ok) {\r\n        fetchCommissions();\r\n      } else {\r\n        const error = await res.json();\r\n        alert(`Failed to mark as paid: ${error.error}`);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error marking as paid:', error);\r\n      alert('Failed to mark as paid');\r\n    } finally {\r\n      setActionLoading(null);\r\n    }\r\n  };\r\n\r\n  if (loading) {\r\n    return <div className=\"text-white\">Loading commissions...</div>;\r\n  }\r\n\r\n  if (!data) {\r\n    return <div className=\"text-white\">Failed to load commissions data</div>;\r\n  }\r\n\r\n  const isOverdue = (commission: Commission) => {\r\n    if (commission.status === 'paid') return false;\r\n    if (!commission.payment_due_date) return false;\r\n    return new Date(commission.payment_due_date) < new Date();\r\n  };\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      {/* Header */}\r\n      <div>\r\n        <h2 className=\"text-2xl font-bold text-white\">Entity Commissions</h2>\r\n        <p className=\"text-gray-400\">Track and manage commission payments to introducers, partners, and commercial partners</p>\r\n      </div>\r\n\r\n      {/* Summary Cards */}\r\n      <div className=\"grid gap-4 md:grid-cols-4\">\r\n        <Card>\r\n          <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\r\n            <CardTitle className=\"text-sm font-medium\">Total Owed</CardTitle>\r\n            <DollarSign className=\"h-4 w-4 text-muted-foreground\" />\r\n          </CardHeader>\r\n          <CardContent>\r\n            <div className=\"text-2xl font-bold text-white\">\r\n              {formatCurrency(data.summary.total_owed)}\r\n            </div>\r\n            <p className=\"text-xs text-gray-400\">\r\n              Accrued + Invoiced\r\n            </p>\r\n          </CardContent>\r\n        </Card>\r\n\r\n        <Card>\r\n          <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\r\n            <CardTitle className=\"text-sm font-medium\">Accrued</CardTitle>\r\n            <Clock className=\"h-4 w-4 text-blue-400\" />\r\n          </CardHeader>\r\n          <CardContent>\r\n            <div className=\"text-2xl font-bold text-white\">\r\n              {formatCurrency(data.summary.total_accrued)}\r\n            </div>\r\n            <p className=\"text-xs text-gray-400\">\r\n              Not yet invoiced\r\n            </p>\r\n          </CardContent>\r\n        </Card>\r\n\r\n        <Card>\r\n          <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\r\n            <CardTitle className=\"text-sm font-medium\">Paid (YTD)</CardTitle>\r\n            <CheckCircle className=\"h-4 w-4 text-green-400\" />\r\n          </CardHeader>\r\n          <CardContent>\r\n            <div className=\"text-2xl font-bold text-white\">\r\n              {formatCurrency(data.summary.total_paid)}\r\n            </div>\r\n            <p className=\"text-xs text-gray-400\">\r\n              Settled commissions\r\n            </p>\r\n          </CardContent>\r\n        </Card>\r\n\r\n        <Card>\r\n          <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\r\n            <CardTitle className=\"text-sm font-medium\">Overdue</CardTitle>\r\n            <AlertCircle className=\"h-4 w-4 text-destructive\" />\r\n          </CardHeader>\r\n          <CardContent>\r\n            <div className=\"text-2xl font-bold text-destructive\">\r\n              {formatCurrency(data.summary.total_overdue)}\r\n            </div>\r\n            <p className=\"text-xs text-gray-400\">\r\n              Past due date\r\n            </p>\r\n          </CardContent>\r\n        </Card>\r\n      </div>\r\n\r\n      {/* Filters */}\r\n      <div className=\"flex flex-wrap gap-4\">\r\n        {/* Status Filter */}\r\n        <div className=\"flex gap-2\">\r\n          <span className=\"text-sm text-gray-400 self-center mr-1\">Status:</span>\r\n          {(['all', 'accrued', 'invoice_requested', 'invoice_submitted', 'invoiced', 'paid', 'rejected', 'cancelled'] as const).map((status) => (\n            <Button\n              key={status}\n              variant={statusFilter === status ? 'default' : 'outline'}\n              size=\"sm\"\n              onClick={() => setStatusFilter(status)}\n            >\n              {status === 'invoice_requested'\n                ? 'Invoice Requested'\n                : status === 'invoice_submitted'\n                ? 'Invoice Submitted'\n                : status.charAt(0).toUpperCase() + status.slice(1)}\n            </Button>\n          ))}\n        </div>\r\n\r\n        {/* Entity Type Filter */}\r\n        <div className=\"flex gap-2\">\r\n          <span className=\"text-sm text-gray-400 self-center mr-1\">Entity:</span>\r\n          <Button\r\n            variant={entityTypeFilter === 'all' ? 'default' : 'outline'}\r\n            size=\"sm\"\r\n            onClick={() => setEntityTypeFilter('all')}\r\n          >\r\n            All\r\n          </Button>\r\n          {(Object.keys(entityConfig) as EntityType[]).map((type) => {\r\n            const config = entityConfig[type];\r\n            const Icon = config.icon;\r\n            return (\r\n              <Button\r\n                key={type}\r\n                variant={entityTypeFilter === type ? 'default' : 'outline'}\r\n                size=\"sm\"\r\n                onClick={() => setEntityTypeFilter(type)}\r\n                className=\"flex items-center gap-1\"\r\n              >\r\n                <Icon className={`h-3 w-3 ${entityTypeFilter === type ? '' : config.color}`} />\r\n                {config.label}\r\n              </Button>\r\n            );\r\n          })}\r\n        </div>\r\n      </div>\r\n\r\n      {/* Commissions Grouped by Entity */}\r\n      {data.by_entity.length === 0 ? (\r\n        <Card>\r\n          <CardContent className=\"py-10 text-center\">\r\n            <p className=\"text-gray-400\">No commissions found</p>\r\n          </CardContent>\r\n        </Card>\r\n      ) : (\r\n        <div className=\"space-y-4\">\r\n          {data.by_entity.map((group) => {\r\n            const config = getEntityConfig(group.entity_type);\r\n            const EntityIcon = config.icon;\r\n\r\n            return (\r\n              <Card key={`${group.entity_type}:${group.entity.id}`}>\r\n                <CardHeader>\r\n                  <div className=\"flex items-start justify-between\">\r\n                    <div>\r\n                      <CardTitle className=\"text-lg text-white flex items-center gap-2\">\r\n                        <EntityIcon className={`h-5 w-5 ${config.color}`} />\r\n                        {group.entity.name}\r\n                        <Badge variant=\"outline\" className={`text-xs ${config.color}`}>\r\n                          {config.label}\r\n                        </Badge>\r\n                        <Link href={`${config.linkPath}/${group.entity.id}`}>\r\n                          <Button variant=\"ghost\" size=\"sm\" className=\"h-6 px-2\">\r\n                            <ExternalLink className=\"h-3 w-3\" />\r\n                          </Button>\r\n                        </Link>\r\n                      </CardTitle>\r\n                      {(group.entity.contact_name || group.entity.email) && (\r\n                        <p className=\"text-sm text-gray-400 mt-1\">\r\n                          {group.entity.contact_name && group.entity.email\r\n                            ? `${group.entity.contact_name} â€¢ ${group.entity.email}`\r\n                            : group.entity.contact_name || group.entity.email}\r\n                        </p>\r\n                      )}\r\n                    </div>\r\n                    <div className=\"text-right\">\r\n                      <p className=\"text-2xl font-bold text-white\">\r\n                        {formatCurrency(group.totals.total)}\r\n                      </p>\r\n                      <p className=\"text-xs text-gray-400\">\r\n                        {group.commissions.length} commission{group.commissions.length !== 1 ? 's' : ''}\r\n                      </p>\r\n                    </div>\r\n                  </div>\r\n                </CardHeader>\r\n                <CardContent>\r\n                  <div className=\"space-y-3\">\r\n                    {group.commissions.map((commission) => {\r\n                      const StatusIcon = statusIcons[commission.status];\r\n                      const overdue = isOverdue(commission);\r\n\r\n                      return (\r\n                        <div\r\n                          key={commission.id}\r\n                          className={`p-4 rounded border ${\r\n                            overdue\r\n                              ? 'bg-red-900/20 border-red-700'\r\n                              : 'bg-gray-900 border-gray-700'\r\n                          }`}\r\n                        >\r\n                          <div className=\"flex items-start justify-between\">\r\n                            <div className=\"flex-1\">\r\n                              <div className=\"flex items-center gap-2 mb-2\">\r\n                                <Badge variant={statusColors[commission.status]}>\r\n                                  <StatusIcon className=\"h-3 w-3 mr-1\" />\r\n                                  {commission.status === 'invoice_requested'\n                                    ? 'Invoice Requested'\n                                    : commission.status === 'invoice_submitted'\n                                    ? 'Invoice Submitted'\n                                    : commission.status}\n                                </Badge>\r\n                                {overdue && (\r\n                                  <Badge variant=\"destructive\">\r\n                                    <AlertCircle className=\"h-3 w-3 mr-1\" />\r\n                                    Overdue\r\n                                  </Badge>\r\n                                )}\r\n                              </div>\r\n                              <p className=\"font-medium text-white\">\r\n                                {commission.deal_name || 'Direct commission'}\r\n                              </p>\r\n                              {commission.investor_name && (\r\n                                <p className=\"text-sm text-gray-300\">\r\n                                  Investor: {commission.investor_name}\r\n                                </p>\r\n                              )}\r\n                              {commission.fee_plan_name && (\r\n                                <p className=\"text-sm text-gray-400\">\r\n                                  Fee Plan: {commission.fee_plan_name}\r\n                                </p>\r\n                              )}\r\n                              <p className=\"text-sm text-gray-400 mt-1\">\r\n                                {(commission.rate_bps / 100).toFixed(2)}% of {formatCurrency(commission.base_amount)}\r\n                                {commission.payment_due_date && (\r\n                                  <span className=\"ml-2\">\r\n                                    â€¢ Due: {new Date(commission.payment_due_date).toLocaleDateString()}\r\n                                  </span>\r\n                                )}\r\n                              </p>\r\n                              {commission.notes && (\r\n                                <p className=\"text-xs text-gray-500 mt-1\">{commission.notes}</p>\r\n                              )}\r\n                              {commission.payment_reference && (\r\n                                <p className=\"text-xs text-green-400 mt-1\">\r\n                                  Payment ref: {commission.payment_reference}\r\n                                </p>\r\n                              )}\r\n                            </div>\r\n                            <div className=\"flex items-center gap-2 ml-4\">\r\n                              <div className=\"text-right mr-4\">\r\n                                <p className=\"text-xl font-bold text-white\">\r\n                                  {formatCurrency(commission.accrual_amount)}\r\n                                </p>\r\n                              </div>\r\n                              <div className=\"flex flex-col gap-2\">\r\n                                {commission.status === 'invoice_submitted' && (\n                                  <Button\n                                    size=\"sm\"\n                                    onClick={() => handleMarkInvoiced(commission.id, commission.entity_type)}\n                                    disabled={actionLoading === commission.id}\n                                  >\n                                    {actionLoading === commission.id ? 'Processing...' : 'Mark Invoiced'}\n                                  </Button>\n                                )}\n                                {commission.status === 'invoiced' && (\n                                  <Button\n                                    size=\"sm\"\n                                    variant=\"default\"\n                                    onClick={() => handleMarkPaid(commission.id, commission.entity_type)}\n                                    disabled={actionLoading === commission.id}\n                                  >\n                                    {actionLoading === commission.id ? 'Processing...' : 'Mark Paid'}\r\n                                  </Button>\r\n                                )}\r\n                                {commission.status === 'paid' && commission.paid_at && (\r\n                                  <p className=\"text-xs text-green-400\">\r\n                                    Paid {new Date(commission.paid_at).toLocaleDateString()}\r\n                                  </p>\r\n                                )}\r\n                              </div>\r\n                            </div>\r\n                          </div>\r\n                        </div>\r\n                      );\r\n                    })}\r\n                  </div>\r\n                </CardContent>\r\n              </Card>\r\n            );\r\n          })}\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}}]
}