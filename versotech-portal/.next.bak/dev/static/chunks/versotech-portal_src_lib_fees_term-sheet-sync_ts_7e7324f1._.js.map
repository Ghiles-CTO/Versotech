{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/ghilesmoussaoui/Desktop/Versotech/versotech-portal/src/lib/fees/term-sheet-sync.ts"],"sourcesContent":["/**\r\n * Term Sheet & Fee Plan Utilities\r\n *\r\n * IMPORTANT ARCHITECTURAL NOTE:\r\n * Term sheets and fee plans/models serve DIFFERENT purposes:\r\n * - Term sheets: Investor-facing fee disclosures\r\n * - Fee models: Introducer/Partner commission agreements\r\n *\r\n * Fee models must be MANUALLY created and linked to term sheets.\r\n * Auto-sync between term sheets and fee plans has been DEPRECATED.\r\n */\r\n\r\nimport { SupabaseClient } from '@supabase/supabase-js';\r\n\r\n/**\r\n * Convert percent to basis points\r\n * @param percent - Percentage value (e.g., 2.5 for 2.5%)\r\n * @returns Basis points (e.g., 250 for 2.5%)\r\n */\r\nexport function percentToBps(percent: number | null | undefined): number | null {\r\n  if (percent === null || percent === undefined) return null;\r\n  return Math.round(percent * 100);\r\n}\r\n\r\n/**\r\n * Convert basis points to percent\r\n * @param bps - Basis points (e.g., 250 for 2.5%)\r\n * @returns Percentage value (e.g., 2.5 for 2.5%)\r\n */\r\nexport function bpsToPercent(bps: number | null | undefined): number | null {\r\n  if (bps === null || bps === undefined) return null;\r\n  return bps / 100;\r\n}\r\n\r\n/**\r\n * Validate that fee model values do not exceed term sheet limits\r\n * @param feeComponents - Array of fee components to validate\r\n * @param termSheet - The term sheet to validate against\r\n * @returns Array of validation error messages (empty if valid)\r\n */\r\nexport function validateFeeComponentsAgainstTermSheet(\r\n  feeComponents: Array<{ kind: string; rate_bps?: number | null }>,\r\n  termSheet: {\r\n    subscription_fee_percent?: number | null;\r\n    management_fee_percent?: number | null;\r\n    carried_interest_percent?: number | null;\r\n  }\r\n): string[] {\r\n  const errors: string[] = [];\r\n\r\n  for (const comp of feeComponents) {\r\n    if (!comp.rate_bps) continue;\r\n\r\n    const compPercent = bpsToPercent(comp.rate_bps);\r\n    if (compPercent === null) continue;\r\n\r\n    switch (comp.kind) {\r\n      case 'subscription':\r\n        if (termSheet.subscription_fee_percent !== null &&\r\n            termSheet.subscription_fee_percent !== undefined &&\r\n            compPercent > termSheet.subscription_fee_percent) {\r\n          errors.push(\r\n            `Subscription fee (${compPercent}%) exceeds term sheet limit (${termSheet.subscription_fee_percent}%)`\r\n          );\r\n        }\r\n        break;\r\n      case 'management':\r\n        if (termSheet.management_fee_percent !== null &&\r\n            termSheet.management_fee_percent !== undefined &&\r\n            compPercent > termSheet.management_fee_percent) {\r\n          errors.push(\r\n            `Management fee (${compPercent}%) exceeds term sheet limit (${termSheet.management_fee_percent}%)`\r\n          );\r\n        }\r\n        break;\r\n      case 'performance':\r\n        if (termSheet.carried_interest_percent !== null &&\r\n            termSheet.carried_interest_percent !== undefined &&\r\n            compPercent > termSheet.carried_interest_percent) {\r\n          errors.push(\r\n            `Performance fee (${compPercent}%) exceeds term sheet limit (${termSheet.carried_interest_percent}%)`\r\n          );\r\n        }\r\n        break;\r\n    }\r\n  }\r\n\r\n  return errors;\r\n}\r\n\r\n/**\r\n * @deprecated Fee models must be manually created. Auto-sync is disabled.\r\n *\r\n * This function previously auto-generated fee plans from published term sheets.\r\n * Per business requirements (Fred), fee models are commercial agreements with\r\n * introducers/partners and must be manually created, not auto-generated.\r\n *\r\n * The function is kept for backward compatibility but does nothing.\r\n * All callers should be removed.\r\n */\r\nexport async function syncTermSheetToFeePlan(\r\n  supabase: SupabaseClient,\r\n  termSheet: {\r\n    id: string;\r\n    subscription_fee_percent?: number | null;\r\n    management_fee_percent?: number | null;\r\n    carried_interest_percent?: number | null;\r\n  },\r\n  dealId: string,\r\n  userId: string\r\n): Promise<{ success: boolean; error?: string; feePlanId?: string }> {\r\n  console.warn(\r\n    '[DEPRECATED] syncTermSheetToFeePlan() called but auto-sync is disabled. ' +\r\n    'Fee models must be manually created by staff and linked to term sheets. ' +\r\n    `Term sheet: ${termSheet.id}, Deal: ${dealId}`\r\n  );\r\n\r\n  // No-op - return success without creating anything\r\n  return { success: true };\r\n}\r\n\r\n/**\r\n * @deprecated Fee models and term sheets serve different purposes - no sync.\r\n *\r\n * This function previously synced fee plan values back to term sheets.\r\n * Per business requirements (Fred):\r\n * - Term sheets are investor-facing fee disclosures\r\n * - Fee models are introducer/partner commission agreements\r\n *\r\n * They should NOT sync as they have different values for different audiences.\r\n * The function is kept for backward compatibility but does nothing.\r\n */\r\nexport async function syncFeePlanToTermSheet(\r\n  supabase: SupabaseClient,\r\n  feePlanId: string,\r\n  dealId: string\r\n): Promise<{ success: boolean; error?: string }> {\r\n  console.warn(\r\n    '[DEPRECATED] syncFeePlanToTermSheet() called but sync is disabled. ' +\r\n    'Term sheets (investor-facing) and fee models (partner/introducer agreements) ' +\r\n    'serve different purposes and should not sync. ' +\r\n    `Fee plan: ${feePlanId}, Deal: ${dealId}`\r\n  );\r\n\r\n  // No-op - return success without doing anything\r\n  return { success: true };\r\n}\r\n"],"names":[],"mappings":"AAAA;;;;;;;;;;CAUC;;;;;;;;;;;;AASM,SAAS,aAAa,OAAkC;IAC7D,IAAI,YAAY,QAAQ,YAAY,WAAW,OAAO;IACtD,OAAO,KAAK,KAAK,CAAC,UAAU;AAC9B;AAOO,SAAS,aAAa,GAA8B;IACzD,IAAI,QAAQ,QAAQ,QAAQ,WAAW,OAAO;IAC9C,OAAO,MAAM;AACf;AAQO,SAAS,sCACd,aAAgE,EAChE,SAIC;IAED,MAAM,SAAmB,EAAE;IAE3B,KAAK,MAAM,QAAQ,cAAe;QAChC,IAAI,CAAC,KAAK,QAAQ,EAAE;QAEpB,MAAM,cAAc,aAAa,KAAK,QAAQ;QAC9C,IAAI,gBAAgB,MAAM;QAE1B,OAAQ,KAAK,IAAI;YACf,KAAK;gBACH,IAAI,UAAU,wBAAwB,KAAK,QACvC,UAAU,wBAAwB,KAAK,aACvC,cAAc,UAAU,wBAAwB,EAAE;oBACpD,OAAO,IAAI,CACT,CAAC,kBAAkB,EAAE,YAAY,6BAA6B,EAAE,UAAU,wBAAwB,CAAC,EAAE,CAAC;gBAE1G;gBACA;YACF,KAAK;gBACH,IAAI,UAAU,sBAAsB,KAAK,QACrC,UAAU,sBAAsB,KAAK,aACrC,cAAc,UAAU,sBAAsB,EAAE;oBAClD,OAAO,IAAI,CACT,CAAC,gBAAgB,EAAE,YAAY,6BAA6B,EAAE,UAAU,sBAAsB,CAAC,EAAE,CAAC;gBAEtG;gBACA;YACF,KAAK;gBACH,IAAI,UAAU,wBAAwB,KAAK,QACvC,UAAU,wBAAwB,KAAK,aACvC,cAAc,UAAU,wBAAwB,EAAE;oBACpD,OAAO,IAAI,CACT,CAAC,iBAAiB,EAAE,YAAY,6BAA6B,EAAE,UAAU,wBAAwB,CAAC,EAAE,CAAC;gBAEzG;gBACA;QACJ;IACF;IAEA,OAAO;AACT;AAYO,eAAe,uBACpB,QAAwB,EACxB,SAKC,EACD,MAAc,EACd,MAAc;IAEd,QAAQ,IAAI,CACV,6EACA,6EACA,CAAC,YAAY,EAAE,UAAU,EAAE,CAAC,QAAQ,EAAE,QAAQ;IAGhD,mDAAmD;IACnD,OAAO;QAAE,SAAS;IAAK;AACzB;AAaO,eAAe,uBACpB,QAAwB,EACxB,SAAiB,EACjB,MAAc;IAEd,QAAQ,IAAI,CACV,wEACA,kFACA,mDACA,CAAC,UAAU,EAAE,UAAU,QAAQ,EAAE,QAAQ;IAG3C,gDAAgD;IAChD,OAAO;QAAE,SAAS;IAAK;AACzB"}}]
}