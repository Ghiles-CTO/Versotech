{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/ghilesmoussaoui/Desktop/Versotech/versotech-portal/src/lib/utils.ts"],"sourcesContent":["import { clsx, type ClassValue } from \"clsx\"\nimport { twMerge } from \"tailwind-merge\"\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs))\n}\n\n/**\n * Format file size in bytes to human-readable format\n * @param bytes - File size in bytes\n * @returns Formatted file size string (e.g., \"1.5 MB\")\n */\nexport function formatFileSize(bytes?: number): string {\n  if (!bytes || bytes === 0) return '0 Bytes'\n\n  const k = 1024\n  const sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB']\n  const i = Math.floor(Math.log(bytes) / Math.log(k))\n\n  return `${(bytes / Math.pow(k, i)).toFixed(2)} ${sizes[i]}`\n}\n"],"names":[],"mappings":";;;;;;AAAA;AACA;;;AAEO,SAAS,GAAG,GAAG,MAAoB;IACxC,OAAO,IAAA,gMAAO,EAAC,IAAA,uKAAI,EAAC;AACtB;AAOO,SAAS,eAAe,KAAc;IAC3C,IAAI,CAAC,SAAS,UAAU,GAAG,OAAO;IAElC,MAAM,IAAI;IACV,MAAM,QAAQ;QAAC;QAAS;QAAM;QAAM;QAAM;KAAK;IAC/C,MAAM,IAAI,KAAK,KAAK,CAAC,KAAK,GAAG,CAAC,SAAS,KAAK,GAAG,CAAC;IAEhD,OAAO,GAAG,CAAC,QAAQ,KAAK,GAAG,CAAC,GAAG,EAAE,EAAE,OAAO,CAAC,GAAG,CAAC,EAAE,KAAK,CAAC,EAAE,EAAE;AAC7D"}},
    {"offset": {"line": 37, "column": 0}, "map": {"version":3,"sources":["file:///Users/ghilesmoussaoui/Desktop/Versotech/versotech-portal/src/components/ui/card.tsx"],"sourcesContent":["import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction Card({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"card\"\n      className={cn(\n        \"bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction CardHeader({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"card-header\"\n      className={cn(\n        \"@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-1.5 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction CardTitle({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"card-title\"\n      className={cn(\"leading-none font-semibold\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction CardDescription({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"card-description\"\n      className={cn(\"text-muted-foreground text-sm\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction CardAction({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"card-action\"\n      className={cn(\n        \"col-start-2 row-span-2 row-start-1 self-start justify-self-end\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction CardContent({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"card-content\"\n      className={cn(\"px-6\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction CardFooter({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"card-footer\"\n      className={cn(\"flex items-center px-6 [.border-t]:pt-6\", className)}\n      {...props}\n    />\n  )\n}\n\nexport {\n  Card,\n  CardHeader,\n  CardFooter,\n  CardTitle,\n  CardAction,\n  CardDescription,\n  CardContent,\n}\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;AAEA;;;AAEA,SAAS,KAAK,EAAE,SAAS,EAAE,GAAG,OAAoC;IAChE,qBACE,oNAAC;QACC,aAAU;QACV,WAAW,IAAA,mJAAE,EACX,qFACA;QAED,GAAG,KAAK;;;;;;AAGf;KAXS;AAaT,SAAS,WAAW,EAAE,SAAS,EAAE,GAAG,OAAoC;IACtE,qBACE,oNAAC;QACC,aAAU;QACV,WAAW,IAAA,mJAAE,EACX,8JACA;QAED,GAAG,KAAK;;;;;;AAGf;MAXS;AAaT,SAAS,UAAU,EAAE,SAAS,EAAE,GAAG,OAAoC;IACrE,qBACE,oNAAC;QACC,aAAU;QACV,WAAW,IAAA,mJAAE,EAAC,8BAA8B;QAC3C,GAAG,KAAK;;;;;;AAGf;MARS;AAUT,SAAS,gBAAgB,EAAE,SAAS,EAAE,GAAG,OAAoC;IAC3E,qBACE,oNAAC;QACC,aAAU;QACV,WAAW,IAAA,mJAAE,EAAC,iCAAiC;QAC9C,GAAG,KAAK;;;;;;AAGf;MARS;AAUT,SAAS,WAAW,EAAE,SAAS,EAAE,GAAG,OAAoC;IACtE,qBACE,oNAAC;QACC,aAAU;QACV,WAAW,IAAA,mJAAE,EACX,kEACA;QAED,GAAG,KAAK;;;;;;AAGf;MAXS;AAaT,SAAS,YAAY,EAAE,SAAS,EAAE,GAAG,OAAoC;IACvE,qBACE,oNAAC;QACC,aAAU;QACV,WAAW,IAAA,mJAAE,EAAC,QAAQ;QACrB,GAAG,KAAK;;;;;;AAGf;MARS;AAUT,SAAS,WAAW,EAAE,SAAS,EAAE,GAAG,OAAoC;IACtE,qBACE,oNAAC;QACC,aAAU;QACV,WAAW,IAAA,mJAAE,EAAC,2CAA2C;QACxD,GAAG,KAAK;;;;;;AAGf;MARS"}},
    {"offset": {"line": 157, "column": 0}, "map": {"version":3,"sources":["file:///Users/ghilesmoussaoui/Desktop/Versotech/versotech-portal/src/components/ui/button.tsx"],"sourcesContent":["import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst buttonVariants = cva(\n  \"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-gradient-to-r from-blue-600 to-blue-700 text-white hover:from-blue-700 hover:to-blue-800 hover:shadow-lg hover:scale-[1.02] transition-all duration-200 shadow-md\",\n        destructive:\n          \"bg-destructive text-destructive-foreground hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60\",\n        outline:\n          \"border border-input bg-background text-foreground shadow-sm hover:bg-accent hover:text-accent-foreground\",\n        secondary:\n          \"bg-secondary text-secondary-foreground hover:bg-secondary/80\",\n        ghost:\n          \"text-foreground hover:bg-accent hover:text-accent-foreground\",\n        link: \"text-primary underline-offset-4 hover:underline\",\n      },\n      size: {\n        // Mobile-first touch targets (≥44px on mobile per Apple/Google guidelines)\n        default: \"h-11 md:h-9 px-4 py-2 has-[>svg]:px-3\",\n        sm: \"h-10 md:h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5\",\n        lg: \"h-12 md:h-10 rounded-md px-6 has-[>svg]:px-4\",\n        icon: \"size-11 md:size-9\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nfunction Button({\n  className,\n  variant,\n  size,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"button\"> &\n  VariantProps<typeof buttonVariants> & {\n    asChild?: boolean\n  }) {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      data-slot=\"button\"\n      className={cn(buttonVariants({ variant, size, className }))}\n      {...props}\n    />\n  )\n}\n\nexport { Button, buttonVariants }\n"],"names":[],"mappings":";;;;;;;AACA;AACA;AAEA;;;;;AAEA,MAAM,iBAAiB,IAAA,iMAAG,EACxB,+bACA;IACE,UAAU;QACR,SAAS;YACP,SAAS;YACT,aACE;YACF,SACE;YACF,WACE;YACF,OACE;YACF,MAAM;QACR;QACA,MAAM;YACJ,2EAA2E;YAC3E,SAAS;YACT,IAAI;YACJ,IAAI;YACJ,MAAM;QACR;IACF;IACA,iBAAiB;QACf,SAAS;QACT,MAAM;IACR;AACF;AAGF,SAAS,OAAO,EACd,SAAS,EACT,OAAO,EACP,IAAI,EACJ,UAAU,KAAK,EACf,GAAG,OAIF;IACD,MAAM,OAAO,UAAU,kMAAI,GAAG;IAE9B,qBACE,oNAAC;QACC,aAAU;QACV,WAAW,IAAA,mJAAE,EAAC,eAAe;YAAE;YAAS;YAAM;QAAU;QACvD,GAAG,KAAK;;;;;;AAGf;KAnBS"}},
    {"offset": {"line": 221, "column": 0}, "map": {"version":3,"sources":["file:///Users/ghilesmoussaoui/Desktop/Versotech/versotech-portal/src/components/ui/input.tsx"],"sourcesContent":["import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction Input({ className, type, ...props }: React.ComponentProps<\"input\">) {\n  return (\n    <input\n      type={type}\n      data-slot=\"input\"\n      className={cn(\n        \"file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground bg-background border-input h-11 md:h-9 w-full min-w-0 rounded-md border px-3 py-1 text-base text-foreground shadow-sm transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n        \"focus-visible:border-blue-500 focus-visible:ring-blue-500/20 focus-visible:ring-[3px]\",\n        \"aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nexport { Input }\n"],"names":[],"mappings":";;;;;AAEA;;;AAEA,SAAS,MAAM,EAAE,SAAS,EAAE,IAAI,EAAE,GAAG,OAAsC;IACzE,qBACE,oNAAC;QACC,MAAM;QACN,aAAU;QACV,WAAW,IAAA,mJAAE,EACX,ocACA,yFACA,0GACA;QAED,GAAG,KAAK;;;;;;AAGf;KAdS"}},
    {"offset": {"line": 252, "column": 0}, "map": {"version":3,"sources":["file:///Users/ghilesmoussaoui/Desktop/Versotech/versotech-portal/src/components/ui/label.tsx"],"sourcesContent":["\"use client\"\n\nimport * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction Label({\n  className,\n  ...props\n}: React.ComponentProps<typeof LabelPrimitive.Root>) {\n  return (\n    <LabelPrimitive.Root\n      data-slot=\"label\"\n      className={cn(\n        \"flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50 text-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nexport { Label }\n"],"names":[],"mappings":";;;;;AAGA;AAEA;AALA;;;;AAOA,SAAS,MAAM,EACb,SAAS,EACT,GAAG,OAC8C;IACjD,qBACE,oNAAC,mMAAmB;QAClB,aAAU;QACV,WAAW,IAAA,mJAAE,EACX,uOACA;QAED,GAAG,KAAK;;;;;;AAGf;KAdS"}},
    {"offset": {"line": 285, "column": 0}, "map": {"version":3,"sources":["file:///Users/ghilesmoussaoui/Desktop/Versotech/versotech-portal/src/lib/supabase/client.ts"],"sourcesContent":["'use client'\r\n\r\nimport { createBrowserClient } from '@supabase/ssr'\r\nimport type { SupabaseClient } from '@supabase/supabase-js'\r\n\r\n// Singleton instance to prevent multiple clients from competing for token refresh\r\nlet client: SupabaseClient | null = null\r\n\r\n/**\r\n * Create a Supabase client for browser-side use (singleton pattern)\r\n *\r\n * This uses the default Supabase storage implementation which:\r\n * - Stores session in localStorage for persistence across browser sessions\r\n * - Automatically refreshes tokens before expiration\r\n * - Handles session detection from URL (for OAuth callbacks and magic links)\r\n *\r\n * Uses singleton pattern to prevent \"Invalid Refresh Token: Already Used\" errors\r\n * that occur when multiple client instances try to refresh the same token\r\n */\r\nexport const createClient = () => {\r\n  // Return existing client if already created\r\n  if (client) {\r\n    return client\r\n  }\r\n\r\n  const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL\r\n  const supabaseAnonKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY\r\n\r\n  if (!supabaseUrl || !supabaseAnonKey) {\r\n    const message = 'Missing Supabase browser credentials. Set NEXT_PUBLIC_SUPABASE_URL and NEXT_PUBLIC_SUPABASE_ANON_KEY.'\r\n    if (process.env.NODE_ENV !== 'production') {\r\n      console.warn(message)\r\n    }\r\n    throw new Error(message)\r\n  }\r\n\r\n  // Create new client instance\r\n  client = createBrowserClient(supabaseUrl, supabaseAnonKey, {\r\n    auth: {\r\n      persistSession: true,\r\n      detectSessionInUrl: true,\r\n      // CRITICAL: Disabled to prevent dual-refresh conflict with middleware\r\n      // Middleware handles all token refresh to avoid \"Refresh Token Already Used\" errors\r\n      autoRefreshToken: false,\r\n      // Use default storage key to match middleware cookie expectations\r\n      // Previously used 'supabase.auth.token' which caused mismatch with middleware\r\n      flowType: 'pkce',\r\n    },\r\n  })\r\n\r\n  return client\r\n}\r\n\r\n/**\r\n * Reset the Supabase client singleton\r\n *\r\n * This should be called when authentication definitively fails and the client\r\n * needs to be recreated with fresh state. Common scenarios:\r\n * - Refresh token has expired and cannot be renewed\r\n * - Session conflicts detected\r\n * - Before re-authentication after failed login attempts\r\n *\r\n * After calling this, the next call to createClient() will create a new instance.\r\n */\r\nexport const resetClient = () => {\r\n  if (client) {\r\n    console.info('[supabase-client] Resetting client singleton due to auth failure')\r\n    client = null\r\n  }\r\n}\r\n\r\n/**\r\n * Check if the current client has a valid session\r\n * Returns true if there's an active session, false otherwise\r\n */\r\nexport const hasActiveSession = async (): Promise<boolean> => {\r\n  if (!client) {\r\n    return false\r\n  }\r\n\r\n  try {\r\n    const { data: { session } } = await client.auth.getSession()\r\n    return session !== null\r\n  } catch {\r\n    return false\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;;;;;AAyBsB;AAvBtB;AAAA;AAFA;;AAKA,kFAAkF;AAClF,IAAI,SAAgC;AAa7B,MAAM,eAAe;IAC1B,4CAA4C;IAC5C,IAAI,QAAQ;QACV,OAAO;IACT;IAEA,MAAM;IACN,MAAM;IAEN;;IAQA,6BAA6B;IAC7B,SAAS,IAAA,2NAAmB,EAAC,aAAa,iBAAiB;QACzD,MAAM;YACJ,gBAAgB;YAChB,oBAAoB;YACpB,sEAAsE;YACtE,oFAAoF;YACpF,kBAAkB;YAClB,kEAAkE;YAClE,8EAA8E;YAC9E,UAAU;QACZ;IACF;IAEA,OAAO;AACT;AAaO,MAAM,cAAc;IACzB,IAAI,QAAQ;QACV,QAAQ,IAAI,CAAC;QACb,SAAS;IACX;AACF;AAMO,MAAM,mBAAmB;IAC9B,IAAI,CAAC,QAAQ;QACX,OAAO;IACT;IAEA,IAAI;QACF,MAAM,EAAE,MAAM,EAAE,OAAO,EAAE,EAAE,GAAG,MAAM,OAAO,IAAI,CAAC,UAAU;QAC1D,OAAO,YAAY;IACrB,EAAE,OAAM;QACN,OAAO;IACT;AACF"}},
    {"offset": {"line": 348, "column": 0}, "map": {"version":3,"sources":["file:///Users/ghilesmoussaoui/Desktop/Versotech/versotech-portal/src/lib/session-manager.ts"],"sourcesContent":["'use client'\r\n\r\n/**\r\n * Simplified Session Manager\r\n * \r\n * Provides basic session management utilities without forcing re-authentication.\r\n * Supabase handles session persistence and expiration automatically.\r\n */\r\n\r\nconst AUTH_KEY_HINTS = ['supabase', 'sb-', 'auth', 'supabase.auth.token']\r\n\r\nconst removeAuthKeys = (storage: Storage) => {\r\n  const keysToRemove = new Set<string>()\r\n\r\n  AUTH_KEY_HINTS.forEach((hint) => {\r\n    Object.keys(storage)\r\n      .filter((key) => key.includes(hint))\r\n      .forEach((key) => keysToRemove.add(key))\r\n  })\r\n\r\n  keysToRemove.forEach((key) => storage.removeItem(key))\r\n}\r\n\r\nclass SessionManager {\r\n  private static instance: SessionManager\r\n  private isInitialized = false\r\n\r\n  private constructor() {}\r\n\r\n  static getInstance(): SessionManager {\r\n    if (!SessionManager.instance) {\r\n      SessionManager.instance = new SessionManager()\r\n    }\r\n\r\n    return SessionManager.instance\r\n  }\r\n\r\n  /**\r\n   * Initialize session manager\r\n   * Sets up storage event listeners to handle cross-tab logout\r\n   */\r\n  init(): void {\r\n    if (this.isInitialized || typeof window === 'undefined') {\r\n      return\r\n    }\r\n\r\n    try {\r\n      this.isInitialized = true\r\n\r\n      // Listen for storage changes in other tabs (cross-tab logout)\r\n      window.addEventListener('storage', this.handleStorageChange)\r\n\r\n      console.info('[auth-session] Session manager initialized')\r\n    } catch (error) {\r\n      console.error('[auth-session] Failed to initialize session manager:', error)\r\n      this.isInitialized = false\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Clear all auth-related cookies\r\n   * Cookies need to be cleared with exact path and domain to work properly\r\n   */\r\n  private clearAuthCookies(): void {\r\n    if (typeof document === 'undefined') {\r\n      return\r\n    }\r\n\r\n    // Get all cookies\r\n    const cookies = document.cookie.split(';')\r\n    const authCookieNames: string[] = []\r\n\r\n    // Find all auth-related cookies\r\n    cookies.forEach(cookie => {\r\n      const cookieName = cookie.split('=')[0].trim()\r\n      if (AUTH_KEY_HINTS.some(hint => cookieName.includes(hint))) {\r\n        authCookieNames.push(cookieName)\r\n      }\r\n    })\r\n\r\n    // Clear each auth cookie with multiple path/domain combinations\r\n    authCookieNames.forEach(name => {\r\n      // Try various path combinations\r\n      const paths = ['/', '/versoholdings', '/versotech', '/versotech_main']\n      const domains = [window.location.hostname, `.${window.location.hostname}`, '']\r\n\r\n      paths.forEach(path => {\r\n        domains.forEach(domain => {\r\n          const domainStr = domain ? `domain=${domain};` : ''\r\n          document.cookie = `${name}=; ${domainStr}path=${path}; expires=Thu, 01 Jan 1970 00:00:00 GMT; max-age=0`\r\n        })\r\n      })\r\n    })\r\n\r\n    console.info('[auth-session] Cleared auth cookies:', authCookieNames)\r\n  }\r\n\r\n  /**\r\n   * Clear all auth data - localStorage, sessionStorage, and cookies\r\n   * This is the most comprehensive cleanup and should be used before re-authentication\r\n   */\r\n  clearAllAuthData(): void {\r\n    if (typeof window === 'undefined') {\r\n      return\r\n    }\r\n\r\n    console.info('[auth-session] Clearing ALL auth data (storage + cookies)')\r\n\r\n    // Clear storage\r\n    removeAuthKeys(window.localStorage)\r\n    removeAuthKeys(window.sessionStorage)\r\n\r\n    // Clear cookies\r\n    this.clearAuthCookies()\r\n  }\r\n\r\n  /**\r\n   * Force sign out by clearing all auth-related storage\r\n   * Used during logout to ensure clean state\r\n   */\r\n  forceSignOut(): void {\r\n    if (typeof window === 'undefined') {\r\n      return\r\n    }\r\n\r\n    console.info('[auth-session] Force sign out - clearing all auth state')\r\n\r\n    // Clear all local auth data\r\n    this.clearAllAuthData()\r\n\r\n    // Call logout API to clear server-side session\r\n    void fetch('/api/auth/logout', {\r\n      method: 'POST',\r\n      credentials: 'include',\r\n    }).catch((error) => {\r\n      console.error('[auth-session] Failed to revoke server session', error)\r\n    })\r\n  }\r\n\r\n  /**\r\n   * Handle storage changes from other tabs\r\n   * If auth keys are removed in another tab, redirect to login\r\n   */\r\n  private handleStorageChange = (event: StorageEvent): void => {\r\n    if (event.key && AUTH_KEY_HINTS.some((hint) => event.key?.includes(hint)) && event.newValue === null) {\r\n      console.info('[auth-session] Auth state cleared in another tab, redirecting to login')\r\n      window.location.href = '/versotech_main/login?error=signed_out'\n    }\r\n  }\r\n\r\n  /**\r\n   * Mark session as authenticated\r\n   * This is called after successful login to update session state\r\n   */\r\n  markAuthenticated(): void {\r\n    if (typeof window === 'undefined') {\r\n      return\r\n    }\r\n\r\n    console.info('[auth-session] Session marked as authenticated')\r\n  }\r\n\r\n  /**\r\n   * Get debug information about current session state\r\n   * Useful for troubleshooting auth issues\r\n   */\r\n  getDebugInfo(): Record<string, unknown> {\r\n    if (typeof window === 'undefined') {\r\n      return { error: 'Not in browser' }\r\n    }\r\n\r\n    return {\r\n      localStorageKeys: Object.keys(localStorage).filter((key) =>\r\n        AUTH_KEY_HINTS.some((hint) => key.includes(hint))\r\n      ),\r\n      sessionStorageKeys: Object.keys(sessionStorage).filter((key) =>\r\n        AUTH_KEY_HINTS.some((hint) => key.includes(hint))\r\n      ),\r\n    }\r\n  }\r\n}\r\n\r\nexport const sessionManager = SessionManager.getInstance()\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 505, "column": 0}, "map": {"version":3,"sources":["file:///Users/ghilesmoussaoui/Desktop/Versotech/versotech-portal/src/lib/auth-client.ts"],"sourcesContent":["'use client'\r\n\r\nimport { createClient, resetClient } from '@/lib/supabase/client'\r\nimport { sessionManager } from '@/lib/session-manager'\r\nimport type { User, Session } from '@supabase/supabase-js'\r\n\r\nexport interface AuthUser {\r\n  id: string\r\n  email: string\r\n  displayName: string\r\n  avatar?: string\r\n  role:\r\n    | 'investor'\r\n    | 'staff_admin'\r\n    | 'staff_ops'\r\n    | 'staff_rm'\r\n    | 'arranger'\r\n    | 'introducer'\r\n    | 'partner'\r\n    | 'commercial_partner'\r\n    | 'lawyer'\r\n    | 'ceo'\r\n  title?: string\r\n  created_at: string\r\n}\r\n\r\nexport interface AuthSession {\r\n  user: AuthUser\r\n  session: Session\r\n}\r\n\r\nexport interface SignInApiResponse {\r\n  success?: boolean\r\n  redirect?: string\r\n  session?: {\r\n    access_token: string\r\n    refresh_token: string\r\n    expires_at?: number | null\r\n  }\r\n  user?: {\r\n    id: string\r\n    email: string\r\n    role: string\r\n    displayName?: string\r\n  }\r\n  error?: string\r\n}\r\n\r\nconst syncBrowserSession = async (session?: { access_token: string; refresh_token: string }) => {\r\n  console.log('[auth] syncBrowserSession called, session provided:', !!session)\r\n\r\n  if (!session) {\r\n    console.log('[auth] No session to sync, returning true')\r\n    return true\r\n  }\r\n\r\n  const supabase = createClient()\r\n\r\n  console.log('[auth] Calling supabase.auth.setSession...')\r\n  const { data, error } = await supabase.auth.setSession({\r\n    access_token: session.access_token,\r\n    refresh_token: session.refresh_token\r\n  })\r\n\r\n  if (error) {\r\n    console.error('[auth] Client session sync failed:', error)\r\n    return false\r\n  }\r\n\r\n  console.log('[auth] Session synced successfully, user:', data?.user?.email)\r\n  return true\r\n}\r\n\r\nexport class AuthError extends Error {\r\n  constructor(message: string, public code?: string) {\r\n    super(message)\r\n    this.name = 'AuthError'\r\n  }\r\n}\r\n\r\n/**\r\n * SIGNUP - DISABLED\r\n *\r\n * This platform is invite-only. Self-registration is not allowed.\r\n * This function is kept for backwards compatibility but will always fail.\r\n *\r\n * @deprecated Use admin invitation flow instead\r\n */\r\nexport const signUp = async (email: string, password: string, displayName: string, portal: 'investor' | 'staff' = 'investor') => {\r\n  console.warn('[auth-client] signUp() called but self-registration is disabled')\r\n  throw new AuthError('Self-registration is disabled. This platform is invite-only. Please contact your administrator or relationship manager to request access.')\r\n}\r\n\r\n// Sign in with email and password\r\nexport const signIn = async (email: string, password: string, portal: 'investor' | 'staff' = 'investor') => {\r\n  try {\r\n    // CRITICAL FIX: Clear all auth data before attempting sign-in\r\n    // This prevents \"Invalid Refresh Token\" and session conflict errors\r\n    console.log('[auth-client] Clearing all auth data before sign-in...')\r\n    sessionManager.clearAllAuthData()\r\n\r\n    // Reset the Supabase client singleton to get fresh instance\r\n    resetClient()\r\n\r\n    // Small delay to ensure storage clearing completes\r\n    await new Promise(resolve => setTimeout(resolve, 100))\r\n\r\n    const response = await fetch('/api/auth/signin', {\r\n      method: 'POST',\r\n      headers: {\r\n        'Content-Type': 'application/json'\r\n      },\r\n      body: JSON.stringify({ email, password, portal })\r\n    })\r\n\r\n    const payload: SignInApiResponse = await response.json().catch(() => ({}))\r\n\r\n    if (!response.ok || !payload.success) {\r\n      const message = typeof payload.error === 'string' && payload.error.trim()\r\n        ? payload.error\r\n        : 'Authentication failed. Please check your credentials.'\r\n      throw new AuthError(message)\r\n    }\r\n\r\n    const synced = await syncBrowserSession(payload.session ? {\r\n      access_token: payload.session.access_token,\r\n      refresh_token: payload.session.refresh_token\r\n    } : undefined)\r\n\r\n    if (!synced) {\r\n      throw new AuthError('Unable to establish session. Please try again.')\r\n    }\r\n\r\n    sessionManager.markAuthenticated()\r\n\r\n    return payload\r\n  } catch (error) {\r\n    if (error instanceof AuthError) {\r\n      throw error\r\n    }\r\n\r\n    console.error('Sign in failed:', error)\r\n    throw new AuthError('Sign in failed. Please check your credentials.')\r\n  }\r\n}\r\n\r\n/**\r\n * GOOGLE OAUTH - DISABLED\r\n *\r\n * Google OAuth has been disabled for security reasons.\r\n * This platform is invite-only with email/password authentication.\r\n *\r\n * @deprecated OAuth providers have been disabled\r\n */\r\nexport const signInWithGoogle = async (portalType: 'staff' | 'investor' = 'investor') => {\r\n  console.warn('[auth-client] signInWithGoogle() called but OAuth is disabled')\r\n  throw new AuthError('Google sign-in is disabled. Please use your email and password to sign in.')\r\n}\r\n\r\n// Sign out with comprehensive session clearing\r\nexport const signOut = async () => {\r\n  const supabase = createClient()\r\n\r\n  let signOutError: unknown = null\r\n\r\n  try {\r\n    const { error } = await supabase.auth.signOut()\r\n\r\n    if (error) {\r\n      console.error('[auth] Supabase signOut error:', error)\r\n      signOutError = error\r\n    }\r\n  } catch (error) {\r\n    console.error('[auth] Sign out error:', error)\r\n    signOutError = error\r\n  } finally {\r\n    if (typeof window !== 'undefined') {\r\n      sessionManager.forceSignOut()\r\n      // Reset the Supabase client singleton after sign-out\r\n      resetClient()\r\n    }\r\n  }\r\n\r\n  if (signOutError) {\r\n    throw new AuthError('Sign out failed. Please try again.')\r\n  }\r\n}\r\n\r\n// Get current user with profile data\r\nexport const getCurrentUser = async (): Promise<AuthUser | null> => {\r\n  const supabase = createClient()\r\n\r\n  try {\r\n    // Get current auth user\r\n    const { data: { user }, error: userError } = await supabase.auth.getUser()\r\n\r\n    if (userError || !user) {\r\n      return null\r\n    }\r\n\r\n    // Get profile data from database\r\n    const { data: profile, error: profileError } = await supabase\r\n      .from('profiles')\r\n      .select('*')\r\n      .eq('id', user.id)\r\n      .single()\r\n\r\n    if (profileError || !profile) {\r\n      console.error('Error getting profile:', profileError)\r\n      return null\r\n    }\r\n\r\n    return {\r\n      id: profile.id,\r\n      email: profile.email,\r\n      displayName: profile.display_name || profile.email?.split('@')[0] || 'User',\r\n      avatar: profile.avatar,\r\n      role: profile.role as AuthUser['role'],\r\n      title: profile.title,\r\n      created_at: profile.created_at\r\n    }\r\n  } catch (error) {\r\n    console.error('Error getting current user:', error)\r\n    return null\r\n  }\r\n}\r\n\r\n// Get current session\r\nexport const getCurrentSession = async (): Promise<Session | null> => {\r\n  const supabase = createClient()\r\n\r\n  try {\r\n    const { data: { session }, error } = await supabase.auth.getSession()\r\n\r\n    if (error) {\r\n      console.error('Error getting session:', error)\r\n      return null\r\n    }\r\n\r\n    return session\r\n  } catch (error) {\r\n    console.error('Error getting session:', error)\r\n    return null\r\n  }\r\n}\r\n\r\n// Auth state listener\r\nexport const onAuthStateChange = (callback: (event: string, session: Session | null) => void) => {\r\n  const supabase = createClient()\r\n\r\n  return supabase.auth.onAuthStateChange(callback)\r\n}\r\n\r\n// Password reset - uses custom API with Resend email\r\nexport const resetPassword = async (email: string) => {\r\n  try {\r\n    const response = await fetch('/api/auth/request-reset', {\r\n      method: 'POST',\r\n      headers: {\r\n        'Content-Type': 'application/json'\r\n      },\r\n      body: JSON.stringify({ email })\r\n    })\r\n\r\n    const data = await response.json()\r\n\r\n    if (!response.ok) {\r\n      // Include detail error for debugging\r\n      const errorMsg = data.detail\r\n        ? `${data.error} (${data.detail})`\r\n        : data.error || 'Password reset failed. Please try again.'\r\n      throw new AuthError(errorMsg)\r\n    }\r\n\r\n    // Success - email sent (or would have been if account exists)\r\n    return { success: true, message: data.message }\r\n  } catch (error) {\r\n    if (error instanceof AuthError) throw error\r\n    throw new AuthError('Password reset failed. Please try again.')\r\n  }\r\n}\r\n\r\n// Update password\r\nexport const updatePassword = async (newPassword: string) => {\r\n  const supabase = createClient()\r\n\r\n  try {\r\n    const { error } = await supabase.auth.updateUser({\r\n      password: newPassword\r\n    })\r\n\r\n    if (error) {\r\n      throw new AuthError(error.message, error.message)\r\n    }\r\n  } catch (error) {\r\n    if (error instanceof AuthError) throw error\r\n    throw new AuthError('Password update failed. Please try again.')\r\n  }\r\n}\r\n\r\n// Update user profile\r\nexport const updateProfile = async (updates: Partial<Pick<AuthUser, 'displayName' | 'title'>>) => {\r\n  const supabase = createClient()\r\n\r\n  try {\r\n    const user = await getCurrentUser()\r\n    if (!user) {\r\n      throw new AuthError('No authenticated user found')\r\n    }\r\n\r\n    const { error } = await supabase\r\n      .from('profiles')\r\n      .update({\r\n        display_name: updates.displayName,\r\n        title: updates.title\r\n      })\r\n      .eq('id', user.id)\r\n\r\n    if (error) {\r\n      throw new AuthError(error.message, error.message)\r\n    }\r\n\r\n    // Also update auth user metadata\r\n    if (updates.displayName) {\r\n      const { error: authError } = await supabase.auth.updateUser({\r\n        data: { display_name: updates.displayName }\r\n      })\r\n\r\n      if (authError) {\r\n        console.error('Error updating auth metadata:', authError)\r\n      }\r\n    }\r\n  } catch (error) {\r\n    if (error instanceof AuthError) throw error\r\n    throw new AuthError('Profile update failed. Please try again.')\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;AAEA;AACA;AAHA;;;AAgDA,MAAM,qBAAqB,OAAO;IAChC,QAAQ,GAAG,CAAC,uDAAuD,CAAC,CAAC;IAErE,IAAI,CAAC,SAAS;QACZ,QAAQ,GAAG,CAAC;QACZ,OAAO;IACT;IAEA,MAAM,WAAW,IAAA,0KAAY;IAE7B,QAAQ,GAAG,CAAC;IACZ,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,SAAS,IAAI,CAAC,UAAU,CAAC;QACrD,cAAc,QAAQ,YAAY;QAClC,eAAe,QAAQ,aAAa;IACtC;IAEA,IAAI,OAAO;QACT,QAAQ,KAAK,CAAC,sCAAsC;QACpD,OAAO;IACT;IAEA,QAAQ,GAAG,CAAC,6CAA6C,MAAM,MAAM;IACrE,OAAO;AACT;AAEO,MAAM,kBAAkB;;IAC7B,YAAY,OAAe,EAAE,AAAO,IAAa,CAAE;QACjD,KAAK,CAAC,eAD4B,OAAA;QAElC,IAAI,CAAC,IAAI,GAAG;IACd;AACF;AAUO,MAAM,SAAS,OAAO,OAAe,UAAkB,aAAqB,SAA+B,UAAU;IAC1H,QAAQ,IAAI,CAAC;IACb,MAAM,IAAI,UAAU;AACtB;AAGO,MAAM,SAAS,OAAO,OAAe,UAAkB,SAA+B,UAAU;IACrG,IAAI;QACF,8DAA8D;QAC9D,oEAAoE;QACpE,QAAQ,GAAG,CAAC;QACZ,4KAAc,CAAC,gBAAgB;QAE/B,4DAA4D;QAC5D,IAAA,yKAAW;QAEX,mDAAmD;QACnD,MAAM,IAAI,QAAQ,CAAA,UAAW,WAAW,SAAS;QAEjD,MAAM,WAAW,MAAM,MAAM,oBAAoB;YAC/C,QAAQ;YACR,SAAS;gBACP,gBAAgB;YAClB;YACA,MAAM,KAAK,SAAS,CAAC;gBAAE;gBAAO;gBAAU;YAAO;QACjD;QAEA,MAAM,UAA6B,MAAM,SAAS,IAAI,GAAG,KAAK,CAAC,IAAM,CAAC,CAAC,CAAC;QAExE,IAAI,CAAC,SAAS,EAAE,IAAI,CAAC,QAAQ,OAAO,EAAE;YACpC,MAAM,UAAU,OAAO,QAAQ,KAAK,KAAK,YAAY,QAAQ,KAAK,CAAC,IAAI,KACnE,QAAQ,KAAK,GACb;YACJ,MAAM,IAAI,UAAU;QACtB;QAEA,MAAM,SAAS,MAAM,mBAAmB,QAAQ,OAAO,GAAG;YACxD,cAAc,QAAQ,OAAO,CAAC,YAAY;YAC1C,eAAe,QAAQ,OAAO,CAAC,aAAa;QAC9C,IAAI;QAEJ,IAAI,CAAC,QAAQ;YACX,MAAM,IAAI,UAAU;QACtB;QAEA,4KAAc,CAAC,iBAAiB;QAEhC,OAAO;IACT,EAAE,OAAO,OAAO;QACd,IAAI,iBAAiB,WAAW;YAC9B,MAAM;QACR;QAEA,QAAQ,KAAK,CAAC,mBAAmB;QACjC,MAAM,IAAI,UAAU;IACtB;AACF;AAUO,MAAM,mBAAmB,OAAO,aAAmC,UAAU;IAClF,QAAQ,IAAI,CAAC;IACb,MAAM,IAAI,UAAU;AACtB;AAGO,MAAM,UAAU;IACrB,MAAM,WAAW,IAAA,0KAAY;IAE7B,IAAI,eAAwB;IAE5B,IAAI;QACF,MAAM,EAAE,KAAK,EAAE,GAAG,MAAM,SAAS,IAAI,CAAC,OAAO;QAE7C,IAAI,OAAO;YACT,QAAQ,KAAK,CAAC,kCAAkC;YAChD,eAAe;QACjB;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,0BAA0B;QACxC,eAAe;IACjB,SAAU;QACR,wCAAmC;YACjC,4KAAc,CAAC,YAAY;YAC3B,qDAAqD;YACrD,IAAA,yKAAW;QACb;IACF;IAEA,IAAI,cAAc;QAChB,MAAM,IAAI,UAAU;IACtB;AACF;AAGO,MAAM,iBAAiB;IAC5B,MAAM,WAAW,IAAA,0KAAY;IAE7B,IAAI;QACF,wBAAwB;QACxB,MAAM,EAAE,MAAM,EAAE,IAAI,EAAE,EAAE,OAAO,SAAS,EAAE,GAAG,MAAM,SAAS,IAAI,CAAC,OAAO;QAExE,IAAI,aAAa,CAAC,MAAM;YACtB,OAAO;QACT;QAEA,iCAAiC;QACjC,MAAM,EAAE,MAAM,OAAO,EAAE,OAAO,YAAY,EAAE,GAAG,MAAM,SAClD,IAAI,CAAC,YACL,MAAM,CAAC,KACP,EAAE,CAAC,MAAM,KAAK,EAAE,EAChB,MAAM;QAET,IAAI,gBAAgB,CAAC,SAAS;YAC5B,QAAQ,KAAK,CAAC,0BAA0B;YACxC,OAAO;QACT;QAEA,OAAO;YACL,IAAI,QAAQ,EAAE;YACd,OAAO,QAAQ,KAAK;YACpB,aAAa,QAAQ,YAAY,IAAI,QAAQ,KAAK,EAAE,MAAM,IAAI,CAAC,EAAE,IAAI;YACrE,QAAQ,QAAQ,MAAM;YACtB,MAAM,QAAQ,IAAI;YAClB,OAAO,QAAQ,KAAK;YACpB,YAAY,QAAQ,UAAU;QAChC;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,+BAA+B;QAC7C,OAAO;IACT;AACF;AAGO,MAAM,oBAAoB;IAC/B,MAAM,WAAW,IAAA,0KAAY;IAE7B,IAAI;QACF,MAAM,EAAE,MAAM,EAAE,OAAO,EAAE,EAAE,KAAK,EAAE,GAAG,MAAM,SAAS,IAAI,CAAC,UAAU;QAEnE,IAAI,OAAO;YACT,QAAQ,KAAK,CAAC,0BAA0B;YACxC,OAAO;QACT;QAEA,OAAO;IACT,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,0BAA0B;QACxC,OAAO;IACT;AACF;AAGO,MAAM,oBAAoB,CAAC;IAChC,MAAM,WAAW,IAAA,0KAAY;IAE7B,OAAO,SAAS,IAAI,CAAC,iBAAiB,CAAC;AACzC;AAGO,MAAM,gBAAgB,OAAO;IAClC,IAAI;QACF,MAAM,WAAW,MAAM,MAAM,2BAA2B;YACtD,QAAQ;YACR,SAAS;gBACP,gBAAgB;YAClB;YACA,MAAM,KAAK,SAAS,CAAC;gBAAE;YAAM;QAC/B;QAEA,MAAM,OAAO,MAAM,SAAS,IAAI;QAEhC,IAAI,CAAC,SAAS,EAAE,EAAE;YAChB,qCAAqC;YACrC,MAAM,WAAW,KAAK,MAAM,GACxB,GAAG,KAAK,KAAK,CAAC,EAAE,EAAE,KAAK,MAAM,CAAC,CAAC,CAAC,GAChC,KAAK,KAAK,IAAI;YAClB,MAAM,IAAI,UAAU;QACtB;QAEA,8DAA8D;QAC9D,OAAO;YAAE,SAAS;YAAM,SAAS,KAAK,OAAO;QAAC;IAChD,EAAE,OAAO,OAAO;QACd,IAAI,iBAAiB,WAAW,MAAM;QACtC,MAAM,IAAI,UAAU;IACtB;AACF;AAGO,MAAM,iBAAiB,OAAO;IACnC,MAAM,WAAW,IAAA,0KAAY;IAE7B,IAAI;QACF,MAAM,EAAE,KAAK,EAAE,GAAG,MAAM,SAAS,IAAI,CAAC,UAAU,CAAC;YAC/C,UAAU;QACZ;QAEA,IAAI,OAAO;YACT,MAAM,IAAI,UAAU,MAAM,OAAO,EAAE,MAAM,OAAO;QAClD;IACF,EAAE,OAAO,OAAO;QACd,IAAI,iBAAiB,WAAW,MAAM;QACtC,MAAM,IAAI,UAAU;IACtB;AACF;AAGO,MAAM,gBAAgB,OAAO;IAClC,MAAM,WAAW,IAAA,0KAAY;IAE7B,IAAI;QACF,MAAM,OAAO,MAAM;QACnB,IAAI,CAAC,MAAM;YACT,MAAM,IAAI,UAAU;QACtB;QAEA,MAAM,EAAE,KAAK,EAAE,GAAG,MAAM,SACrB,IAAI,CAAC,YACL,MAAM,CAAC;YACN,cAAc,QAAQ,WAAW;YACjC,OAAO,QAAQ,KAAK;QACtB,GACC,EAAE,CAAC,MAAM,KAAK,EAAE;QAEnB,IAAI,OAAO;YACT,MAAM,IAAI,UAAU,MAAM,OAAO,EAAE,MAAM,OAAO;QAClD;QAEA,iCAAiC;QACjC,IAAI,QAAQ,WAAW,EAAE;YACvB,MAAM,EAAE,OAAO,SAAS,EAAE,GAAG,MAAM,SAAS,IAAI,CAAC,UAAU,CAAC;gBAC1D,MAAM;oBAAE,cAAc,QAAQ,WAAW;gBAAC;YAC5C;YAEA,IAAI,WAAW;gBACb,QAAQ,KAAK,CAAC,iCAAiC;YACjD;QACF;IACF,EAAE,OAAO,OAAO;QACd,IAAI,iBAAiB,WAAW,MAAM;QACtC,MAAM,IAAI,UAAU;IACtB;AACF"}},
    {"offset": {"line": 758, "column": 0}, "map": {"version":3,"sources":["file:///Users/ghilesmoussaoui/Desktop/Versotech/versotech-portal/src/app/%28public%29/versotech_main/login/page.tsx"],"sourcesContent":["'use client'\r\n\r\nimport { useState, useEffect, Suspense } from 'react'\r\nimport { useRouter, useSearchParams } from 'next/navigation'\r\nimport { Card, CardContent } from '@/components/ui/card'\r\nimport { Button } from '@/components/ui/button'\r\nimport { Input } from '@/components/ui/input'\r\nimport { Label } from '@/components/ui/label'\r\nimport { signIn, AuthError } from '@/lib/auth-client'\r\nimport {\r\n  Loader2,\r\n  Eye,\r\n  EyeOff,\r\n  Lock\r\n} from 'lucide-react'\r\nimport Link from 'next/link'\r\nimport Image from 'next/image'\r\n\r\n/**\r\n * INVITE-ONLY LOGIN PAGE\r\n *\r\n * This platform is invite-only. Users cannot self-register.\r\n * All accounts are created via admin invitation from the Users page.\r\n *\r\n * Removed:\r\n * - Google OAuth (security risk, bypass invite flow)\r\n * - Self-signup (must be invited by admin)\r\n */\r\n\r\nfunction UnifiedLoginContent() {\r\n  const router = useRouter()\r\n  const searchParams = useSearchParams()\r\n  const [email, setEmail] = useState('')\r\n  const [password, setPassword] = useState('')\r\n  const [showPassword, setShowPassword] = useState(false)\r\n  const [isLoading, setIsLoading] = useState(false)\r\n  const [message, setMessage] = useState<{ type: 'error' | 'success' | 'info', text: string } | null>(null)\r\n\r\n\r\n  useEffect(() => {\r\n    const error = searchParams.get('error')\r\n    const messageParam = searchParams.get('message')\r\n\r\n    if (error) {\r\n      let errorMessage = 'Authentication error occurred'\r\n      switch (error) {\r\n        case 'session_expired': errorMessage = 'Your session has expired. Please sign in again.'; break\r\n        case 'profile_not_found': errorMessage = 'User profile not found. Please contact support.'; break\r\n        case 'auth_failed': errorMessage = 'Authentication failed. Please try again.'; break\r\n        case 'auth_required': errorMessage = 'Please sign in to continue.'; break\r\n        case 'session_not_found': errorMessage = 'Session not found. Please try your invitation link again or contact support.'; break\r\n        case 'no_personas': errorMessage = 'No access configured. Please contact your administrator.'; break\r\n        case 'link_expired': errorMessage = 'This link has expired. Please request a new password reset.'; break\r\n        case 'access_denied': errorMessage = 'Access denied. The link may be invalid or already used.'; break\r\n        default: errorMessage = 'An error occurred. Please try again.';\r\n      }\r\n      setMessage({ type: 'error', text: errorMessage })\r\n    } else if (messageParam === 'password_set') {\r\n      setMessage({ type: 'success', text: 'Password set successfully! Please sign in with your new credentials.' })\r\n    } else if (messageParam === 'password_reset') {\r\n      setMessage({ type: 'success', text: 'Password reset successfully! Please sign in with your new password.' })\r\n    } else if (messageParam === 'signed_out') {\r\n      setMessage({ type: 'info', text: 'You have been signed out.' })\r\n    }\r\n  }, [searchParams])\r\n\r\n  const handleEmailAuth = async (e: React.FormEvent) => {\r\n    e.preventDefault()\r\n    setIsLoading(true)\r\n    setMessage(null)\r\n\r\n    try {\r\n      console.log('[login] Attempting sign in for:', email)\r\n      const result = await signIn(email, password, 'investor')\r\n      console.log('[login] SignIn result:', JSON.stringify(result, null, 2))\r\n\r\n      if (result?.success) {\r\n        // Check for redirect param (e.g., from invite link), otherwise go to dashboard\r\n        const redirectParam = searchParams.get('redirect')\r\n        const redirectUrl = redirectParam && redirectParam.startsWith('/')\r\n          ? decodeURIComponent(redirectParam)\r\n          : '/versotech_main/dashboard'\r\n\r\n        console.log('[login] Redirecting to:', redirectUrl)\r\n\r\n        // CRITICAL: Use window.location.href for reliable redirect on all browsers/mobile\r\n        // router.replace() can fail silently on some browsers (especially mobile Safari)\r\n        window.location.href = redirectUrl\r\n\r\n        // Keep loading state while redirecting to prevent button flicker\r\n        return\r\n      } else {\r\n        // Sign in returned but success was false/undefined\r\n        console.error('[login] SignIn returned without success:', result)\r\n        setMessage({ type: 'error', text: result?.error || 'Sign in failed. Please try again.' })\r\n      }\r\n    } catch (error) {\r\n      console.error('[login] SignIn error:', error)\r\n      if (error instanceof AuthError) setMessage({ type: 'error', text: error.message })\r\n      else setMessage({ type: 'error', text: 'Authentication failed. Please try again.' })\r\n    } finally {\r\n      setIsLoading(false)\r\n    }\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen flex flex-col items-center justify-center bg-[#050505] p-4 font-sans text-zinc-100\">\r\n\r\n      <div className=\"w-full max-w-md space-y-8 animate-in fade-in zoom-in-95 duration-700\">\r\n\r\n        <div className=\"text-center\">\r\n          <div className=\"flex justify-center mb-6\">\r\n             <div className=\"relative w-48 h-16\">\r\n                <Image\r\n                  src=\"/versotech-logo.jpg\"\r\n                  alt=\"VERSO\"\r\n                  fill\r\n                  className=\"object-contain invert\"\r\n                  priority\r\n                />\r\n             </div>\r\n          </div>\r\n          <h1 className=\"text-3xl font-light tracking-tight text-white sr-only\">VERSO</h1>\r\n        </div>\r\n\r\n        <Card className=\"bg-zinc-900/50 border-white/5 backdrop-blur-sm shadow-2xl shadow-black\">\r\n          <CardContent className=\"p-8 space-y-6\">\r\n\r\n            {message && (\r\n              <div className={`p-3 rounded-md text-sm font-medium border ${\r\n                message.type === 'error' ? 'bg-red-900/20 border-red-900/50 text-red-400' :\r\n                message.type === 'success' ? 'bg-emerald-900/20 border-emerald-900/50 text-emerald-400' :\r\n                'bg-blue-900/20 border-blue-900/50 text-blue-400'\r\n              }`}>\r\n                {message.text}\r\n              </div>\r\n            )}\r\n\r\n            <form onSubmit={handleEmailAuth} className=\"space-y-5\">\r\n              <div className=\"space-y-1.5\">\r\n                <Label className=\"text-xs font-semibold text-zinc-500 uppercase\">Email Address</Label>\r\n                <Input\r\n                  type=\"email\"\r\n                  placeholder=\"name@example.com\"\r\n                  className=\"h-11 bg-black/50 border-white/10 text-white placeholder:text-zinc-700 focus:border-white/30 focus:ring-0 transition-all\"\r\n                  value={email}\r\n                  onChange={(e) => setEmail(e.target.value)}\r\n                  required\r\n                />\r\n              </div>\r\n\r\n              <div className=\"space-y-1.5\">\r\n                <div className=\"flex items-center justify-between\">\r\n                  <Label className=\"text-xs font-semibold text-zinc-500 uppercase\">Password</Label>\r\n                  <Link\r\n                    href=\"/versotech_main/reset-password\"\r\n                    className=\"text-xs text-zinc-500 hover:text-white transition-colors\"\r\n                  >\r\n                    Forgot Password?\r\n                  </Link>\r\n                </div>\r\n                <div className=\"relative\">\r\n                  <Input\r\n                    type={showPassword ? 'text' : 'password'}\r\n                    placeholder=\"••••••••\"\r\n                    className=\"h-11 bg-black/50 border-white/10 text-white placeholder:text-zinc-700 focus:border-white/30 focus:ring-0 transition-all pr-10\"\r\n                    value={password}\r\n                    onChange={(e) => setPassword(e.target.value)}\r\n                    required\r\n                  />\r\n                  <button\r\n                    type=\"button\"\r\n                    onClick={() => setShowPassword(!showPassword)}\r\n                    className=\"absolute right-3 top-3 text-zinc-600 hover:text-white transition-colors\"\r\n                  >\r\n                    {showPassword ? <EyeOff className=\"h-5 w-5\" /> : <Eye className=\"h-5 w-5\" />}\r\n                  </button>\r\n                </div>\r\n              </div>\r\n\r\n              <Button\r\n                type=\"submit\"\r\n                disabled={isLoading}\r\n                className=\"w-full h-12 bg-white hover:bg-zinc-200 text-black font-medium tracking-wide transition-all mt-4\"\r\n              >\r\n                {isLoading ? <Loader2 className=\"h-5 w-5 animate-spin\" /> : (\r\n                    <span className=\"flex items-center gap-2\">\r\n                        <Lock className=\"w-4 h-4\" /> SIGN IN\r\n                    </span>\r\n                )}\r\n              </Button>\r\n            </form>\r\n\r\n            {/* Request Access */}\r\n            <div className=\"text-center pt-2\">\r\n              <p className=\"text-sm text-zinc-400\">\r\n                Request Access: Please contact us at{' '}\r\n                <a\r\n                  href=\"mailto:contact@versotech.com\"\r\n                  className=\"text-white hover:text-zinc-300 underline underline-offset-2 transition-colors\"\r\n                >\r\n                  contact@versotech.com\r\n                </a>\r\n              </p>\r\n            </div>\r\n\r\n          </CardContent>\r\n        </Card>\r\n\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default function UnifiedLoginPage() {\r\n  return (\r\n    <Suspense fallback={\r\n      <div className=\"min-h-screen bg-[#050505] flex items-center justify-center\">\r\n        <Loader2 className=\"h-8 w-8 animate-spin text-white\" />\r\n      </div>\r\n    }>\r\n      <UnifiedLoginContent />\r\n    </Suspense>\r\n  )\r\n}\r\n"],"names":[],"mappings":"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"}}]
}