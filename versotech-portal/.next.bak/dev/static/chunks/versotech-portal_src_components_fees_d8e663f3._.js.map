{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/ghilesmoussaoui/Desktop/Versotech/versotech-portal/src/components/fees/TermSheetSelector.tsx"],"sourcesContent":["/**\n * Term Sheet Selector Component\n *\n * Allows selection of a published term sheet for a deal.\n * Fee models must be derived from term sheets per business requirements.\n */\n\n'use client';\n\nimport { useState, useEffect } from 'react';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { Label } from '@/components/ui/label';\nimport { Badge } from '@/components/ui/badge';\nimport { Loader2, FileText, AlertCircle } from 'lucide-react';\n\nexport interface TermSheet {\n  id: string;\n  deal_id: string;\n  version: number;\n  status: string;\n  term_sheet_date: string | null;\n  subscription_fee_percent: number | null;\n  management_fee_percent: number | null;\n  carried_interest_percent: number | null;\n  published_at: string | null;\n}\n\ninterface TermSheetSelectorProps {\n  dealId: string | undefined;\n  value?: string;\n  onChange: (termSheetId: string | undefined, termSheet: TermSheet | null) => void;\n  required?: boolean;\n  disabled?: boolean;\n}\n\nexport function TermSheetSelector({\n  dealId,\n  value,\n  onChange,\n  required = true,\n  disabled = false,\n}: TermSheetSelectorProps) {\n  const [loading, setLoading] = useState(false);\n  const [termSheets, setTermSheets] = useState<TermSheet[]>([]);\n  const [error, setError] = useState<string | null>(null);\n\n  useEffect(() => {\n    if (dealId) {\n      loadTermSheets(dealId);\n    } else {\n      setTermSheets([]);\n      onChange(undefined, null);\n    }\n  }, [dealId]);\n\n  const loadTermSheets = async (dId: string) => {\n    setLoading(true);\n    setError(null);\n    try {\n      const res = await fetch(`/api/deals/${dId}/fee-structures?status=published`);\n      if (!res.ok) {\n        throw new Error('Failed to load term sheets');\n      }\n      const json = await res.json();\n      const sheets = json.term_sheets || [];\n      setTermSheets(sheets);\n\n      // If current value is not in the list, clear it\n      if (value && !sheets.find((ts: TermSheet) => ts.id === value)) {\n        onChange(undefined, null);\n      }\n    } catch (err) {\n      console.error('Error loading term sheets:', err);\n      setError('Failed to load term sheets');\n      setTermSheets([]);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleChange = (termSheetId: string) => {\n    if (termSheetId === 'none') {\n      onChange(undefined, null);\n    } else {\n      const selected = termSheets.find(ts => ts.id === termSheetId);\n      onChange(termSheetId, selected || null);\n    }\n  };\n\n  const formatFeePercent = (value: number | null | undefined): string => {\n    if (value === null || value === undefined) return '-';\n    return `${value}%`;\n  };\n\n  const selectedTermSheet = termSheets.find(ts => ts.id === value);\n\n  if (!dealId) {\n    return (\n      <div className=\"space-y-2\">\n        <Label className=\"text-foreground font-medium\">\n          Term Sheet {required && <span className=\"text-red-500 dark:text-red-400\">*</span>}\n        </Label>\n        <div className=\"flex items-center gap-2 text-amber-600 dark:text-amber-400 text-sm bg-amber-500/10 p-3 rounded border border-amber-500/30\">\n          <AlertCircle className=\"h-4 w-4\" />\n          <span>Select a deal first to see available term sheets</span>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-2\">\n      <Label className=\"text-foreground font-medium\">\n        Term Sheet {required && <span className=\"text-red-500 dark:text-red-400\">*</span>}\n      </Label>\n\n      {loading ? (\n        <div className=\"flex items-center gap-2 text-muted-foreground h-11 px-3 border border-border rounded-md bg-muted/50\">\n          <Loader2 className=\"h-4 w-4 animate-spin\" />\n          <span className=\"text-sm\">Loading term sheets...</span>\n        </div>\n      ) : error ? (\n        <div className=\"flex items-center gap-2 text-red-500 dark:text-red-400 text-sm bg-red-500/10 p-3 rounded border border-red-500/30\">\n          <AlertCircle className=\"h-4 w-4\" />\n          <span>{error}</span>\n        </div>\n      ) : termSheets.length === 0 ? (\n        <div className=\"flex items-center gap-2 text-amber-600 dark:text-amber-400 text-sm bg-amber-500/10 p-3 rounded border border-amber-500/30\">\n          <AlertCircle className=\"h-4 w-4\" />\n          <span>No published term sheets available for this deal. Create and publish a term sheet first.</span>\n        </div>\n      ) : (\n        <>\n          <Select\n            value={value || 'none'}\n            onValueChange={handleChange}\n            disabled={disabled}\n          >\n            <SelectTrigger className=\"bg-muted/50 border-border text-foreground h-11\">\n              <SelectValue placeholder=\"Select a term sheet\" />\n            </SelectTrigger>\n            <SelectContent className=\"bg-popover border-border\">\n              {!required && (\n                <SelectItem value=\"none\">No term sheet</SelectItem>\n              )}\n              {termSheets.map((ts) => (\n                <SelectItem key={ts.id} value={ts.id}>\n                  <div className=\"flex items-center gap-2\">\n                    <FileText className=\"h-4 w-4 text-muted-foreground\" />\n                    <span>Version {ts.version}</span>\n                    {ts.term_sheet_date && (\n                      <span className=\"text-muted-foreground text-xs\">\n                        ({new Date(ts.term_sheet_date).toLocaleDateString()})\n                      </span>\n                    )}\n                  </div>\n                </SelectItem>\n              ))}\n            </SelectContent>\n          </Select>\n\n          {/* Show fee summary when a term sheet is selected */}\n          {selectedTermSheet && (\n            <div className=\"bg-muted/50 border border-border rounded-md p-3 mt-2\">\n              <p className=\"text-xs text-muted-foreground mb-2 font-medium\">Term Sheet Fee Limits:</p>\n              <div className=\"flex flex-wrap gap-2\">\n                <Badge variant=\"outline\" className=\"text-xs border-blue-500/30 text-blue-600 dark:text-blue-400\">\n                  Subscription: {formatFeePercent(selectedTermSheet.subscription_fee_percent)}\n                </Badge>\n                <Badge variant=\"outline\" className=\"text-xs border-green-500/30 text-green-600 dark:text-green-400\">\n                  Management: {formatFeePercent(selectedTermSheet.management_fee_percent)}\n                </Badge>\n                <Badge variant=\"outline\" className=\"text-xs border-purple-500/30 text-purple-600 dark:text-purple-400\">\n                  Performance: {formatFeePercent(selectedTermSheet.carried_interest_percent)}\n                </Badge>\n              </div>\n              <p className=\"text-xs text-muted-foreground mt-2\">\n                Fee model values must not exceed these limits.\n              </p>\n            </div>\n          )}\n        </>\n      )}\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 401, "column": 0}, "map": {"version":3,"sources":["file:///Users/ghilesmoussaoui/Desktop/Versotech/versotech-portal/src/components/fees/EntitySelector.tsx"],"sourcesContent":["/**\n * Entity Selector Component\n *\n * Allows selection of an introducer, partner, or commercial partner for a fee model.\n * Fee models are commercial agreements with entities, not investor-facing.\n */\n\n'use client';\n\nimport { useState, useEffect } from 'react';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { Label } from '@/components/ui/label';\nimport { Loader2, Users, Building2, Briefcase, AlertCircle } from 'lucide-react';\n\nexport type EntityType = 'introducer' | 'partner' | 'commercial_partner';\n\ninterface Entity {\n  id: string;\n  name: string;\n  email?: string;\n  company_name?: string;\n}\n\ninterface EntitySelectorProps {\n  dealId: string | undefined;\n  entityType: EntityType | undefined;\n  onEntityTypeChange: (type: EntityType | undefined) => void;\n  entityId: string | undefined;\n  onEntityIdChange: (id: string | undefined) => void;\n  required?: boolean;\n  disabled?: boolean;\n  /** Entity types to exclude from selection */\n  excludeTypes?: EntityType[];\n}\n\nexport function EntitySelector({\n  dealId,\n  entityType,\n  onEntityTypeChange,\n  entityId,\n  onEntityIdChange,\n  required = true,\n  disabled = false,\n  excludeTypes = [],\n}: EntitySelectorProps) {\n  const [loading, setLoading] = useState(false);\n  const [entities, setEntities] = useState<Entity[]>([]);\n  const [error, setError] = useState<string | null>(null);\n\n  useEffect(() => {\n    if (dealId && entityType) {\n      loadEntities(dealId, entityType);\n    } else {\n      setEntities([]);\n      onEntityIdChange(undefined);\n    }\n  }, [dealId, entityType]);\n\n  const loadEntities = async (dId: string, type: EntityType) => {\n    setLoading(true);\n    setError(null);\n    try {\n      // Load entities dispatched to this deal based on type\n      let endpoint = '';\n      switch (type) {\n        case 'introducer':\n          endpoint = `/api/deals/${dId}/introducers`;\n          break;\n        case 'partner':\n          endpoint = `/api/deals/${dId}/partners`;\n          break;\n        case 'commercial_partner':\n          endpoint = `/api/deals/${dId}/commercial-partners`;\n          break;\n      }\n\n      const res = await fetch(endpoint);\n      if (!res.ok) {\n        // If endpoint doesn't exist or returns error, try fallback\n        console.warn(`Entity endpoint ${endpoint} not available, trying fallback`);\n        await loadEntitiesFallback(type);\n        return;\n      }\n\n      const json = await res.json();\n      // Handle different response formats from various endpoints\n      let entityList = json.introducers || json.partners || json.commercial_partners || [];\n\n      // Deal-specific endpoints return { data: [...] } with transformed entities\n      if (entityList.length === 0 && json.data && Array.isArray(json.data)) {\n        // Transform the deal-specific format to entity format\n        entityList = json.data\n          .filter((item: any) => item.entity_type === type.replace('_', ''))\n          .map((item: any) => ({\n            id: item.entity_id,\n            name: item.entity_name,\n            email: item.entity_email,\n          }));\n      }\n\n      // If still empty, fall back to admin endpoint to get ALL entities\n      if (entityList.length === 0) {\n        console.log(`No ${type}s found for deal, loading all ${type}s from admin endpoint`);\n        await loadEntitiesFallback(type);\n        return;\n      }\n\n      setEntities(entityList);\n\n      // If current value is not in the list, clear it\n      if (entityId && !entityList.find((e: Entity) => e.id === entityId)) {\n        onEntityIdChange(undefined);\n      }\n    } catch (err) {\n      console.error('Error loading entities:', err);\n      await loadEntitiesFallback(type);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  // Fallback to load all entities of a type (not deal-specific)\n  // Uses admin endpoints which list all entities in the system\n  const loadEntitiesFallback = async (type: EntityType) => {\n    try {\n      let endpoint = '';\n      switch (type) {\n        case 'introducer':\n          endpoint = '/api/admin/introducers';\n          break;\n        case 'partner':\n          endpoint = '/api/admin/partners';\n          break;\n        case 'commercial_partner':\n          endpoint = '/api/admin/commercial-partners';\n          break;\n      }\n\n      const res = await fetch(endpoint);\n      if (!res.ok) {\n        throw new Error(`Failed to load ${type}s`);\n      }\n\n      const json = await res.json();\n      // Admin endpoints return data in various formats - handle all possibilities\n      const entityList = json.introducers || json.partners || json.commercial_partners || json.data || [];\n\n      // Map the entity list to a common format\n      const normalizedEntities = entityList.map((entity: any) => ({\n        id: entity.id,\n        name: entity.name || entity.legal_name || entity.company_name || entity.contact_name,\n        email: entity.email || entity.contact_email,\n        company_name: entity.company_name || entity.legal_name,\n      }));\n\n      setEntities(normalizedEntities);\n    } catch (err) {\n      console.error('Error in fallback loading:', err);\n      setError(`Failed to load ${type}s`);\n      setEntities([]);\n    }\n  };\n\n  const handleEntityTypeChange = (value: string) => {\n    if (value === 'none') {\n      onEntityTypeChange(undefined);\n      onEntityIdChange(undefined);\n    } else {\n      onEntityTypeChange(value as EntityType);\n      onEntityIdChange(undefined); // Reset entity when type changes\n    }\n  };\n\n  const handleEntityChange = (value: string) => {\n    if (value === 'none') {\n      onEntityIdChange(undefined);\n    } else {\n      onEntityIdChange(value);\n    }\n  };\n\n  const getEntityTypeIcon = (type: EntityType | undefined) => {\n    switch (type) {\n      case 'introducer':\n        return <Users className=\"h-4 w-4\" />;\n      case 'partner':\n        return <Building2 className=\"h-4 w-4\" />;\n      case 'commercial_partner':\n        return <Briefcase className=\"h-4 w-4\" />;\n      default:\n        return null;\n    }\n  };\n\n  const getEntityTypeLabel = (type: EntityType): string => {\n    switch (type) {\n      case 'introducer':\n        return 'Introducer';\n      case 'partner':\n        return 'Partner';\n      case 'commercial_partner':\n        return 'Commercial Partner';\n    }\n  };\n\n  if (!dealId) {\n    return (\n      <div className=\"space-y-4\">\n        <div className=\"space-y-2\">\n          <Label className=\"text-white font-medium\">\n            Entity Type {required && <span className=\"text-red-400\">*</span>}\n          </Label>\n          <div className=\"flex items-center gap-2 text-amber-400 text-sm bg-amber-500/10 p-3 rounded border border-amber-500/30\">\n            <AlertCircle className=\"h-4 w-4\" />\n            <span>Select a deal first to assign an entity</span>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-4\">\n      {/* Entity Type Selector */}\n      <div className=\"space-y-2\">\n        <Label className=\"text-white font-medium\">\n          Entity Type {required && <span className=\"text-red-400\">*</span>}\n        </Label>\n        <Select\n          value={entityType || 'none'}\n          onValueChange={handleEntityTypeChange}\n          disabled={disabled}\n        >\n          <SelectTrigger className=\"bg-black border-gray-700 text-white h-11\">\n            <SelectValue placeholder=\"Select entity type\" />\n          </SelectTrigger>\n          <SelectContent className=\"bg-black border-gray-700 text-white\">\n            {!required && (\n              <SelectItem value=\"none\">No entity</SelectItem>\n            )}\n            {!excludeTypes.includes('introducer') && (\n              <SelectItem value=\"introducer\">\n                <div className=\"flex items-center gap-2\">\n                  <Users className=\"h-4 w-4 text-blue-400\" />\n                  <span>Introducer</span>\n                </div>\n              </SelectItem>\n            )}\n            {!excludeTypes.includes('partner') && (\n              <SelectItem value=\"partner\">\n                <div className=\"flex items-center gap-2\">\n                  <Building2 className=\"h-4 w-4 text-green-400\" />\n                  <span>Partner</span>\n                </div>\n              </SelectItem>\n            )}\n            {!excludeTypes.includes('commercial_partner') && (\n              <SelectItem value=\"commercial_partner\">\n                <div className=\"flex items-center gap-2\">\n                  <Briefcase className=\"h-4 w-4 text-purple-400\" />\n                  <span>Commercial Partner</span>\n                </div>\n              </SelectItem>\n            )}\n          </SelectContent>\n        </Select>\n      </div>\n\n      {/* Entity Selector (only shown when type is selected) */}\n      {entityType && (\n        <div className=\"space-y-2\">\n          <Label className=\"text-white font-medium\">\n            {getEntityTypeLabel(entityType)} {required && <span className=\"text-red-400\">*</span>}\n          </Label>\n\n          {loading ? (\n            <div className=\"flex items-center gap-2 text-gray-400 h-11 px-3 border border-gray-700 rounded-md bg-black\">\n              <Loader2 className=\"h-4 w-4 animate-spin\" />\n              <span className=\"text-sm\">Loading {entityType}s...</span>\n            </div>\n          ) : error ? (\n            <div className=\"flex items-center gap-2 text-red-400 text-sm bg-red-500/10 p-3 rounded border border-red-500/30\">\n              <AlertCircle className=\"h-4 w-4\" />\n              <span>{error}</span>\n            </div>\n          ) : entities.length === 0 ? (\n            <div className=\"flex items-center gap-2 text-amber-400 text-sm bg-amber-500/10 p-3 rounded border border-amber-500/30\">\n              <AlertCircle className=\"h-4 w-4\" />\n              <span>No {entityType}s available. Add {entityType}s to the system first.</span>\n            </div>\n          ) : (\n            <Select\n              value={entityId || 'none'}\n              onValueChange={handleEntityChange}\n              disabled={disabled}\n            >\n              <SelectTrigger className=\"bg-black border-gray-700 text-white h-11\">\n                <SelectValue placeholder={`Select ${getEntityTypeLabel(entityType)}`} />\n              </SelectTrigger>\n              <SelectContent className=\"bg-black border-gray-700 text-white max-h-60\">\n                {!required && (\n                  <SelectItem value=\"none\">No selection</SelectItem>\n                )}\n                {entities.map((entity) => (\n                  <SelectItem key={entity.id} value={entity.id}>\n                    <div className=\"flex items-center gap-2\">\n                      {getEntityTypeIcon(entityType)}\n                      <span>{entity.name || entity.company_name}</span>\n                      {entity.email && (\n                        <span className=\"text-gray-400 text-xs\">({entity.email})</span>\n                      )}\n                    </div>\n                  </SelectItem>\n                ))}\n              </SelectContent>\n            </Select>\n          )}\n        </div>\n      )}\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1013, "column": 0}, "map": {"version":3,"sources":["file:///Users/ghilesmoussaoui/Desktop/Versotech/versotech-portal/src/components/fees/FeePlanEditModal.tsx"],"sourcesContent":["/**\r\n * Fee Plan Edit Modal - Redesigned\r\n *\r\n * A clean, wizard-style modal for creating and editing fee plans.\r\n * Uses progressive disclosure to reduce cognitive load.\r\n */\r\n\r\n'use client';\r\n\r\nimport { useState, useEffect, useCallback, useMemo } from 'react';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\nimport {\r\n  Dialog,\r\n  DialogContent,\r\n  DialogHeader,\r\n  DialogTitle,\r\n} from '@/components/ui/dialog';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Input } from '@/components/ui/input';\r\nimport { Label } from '@/components/ui/label';\r\nimport { Textarea } from '@/components/ui/textarea';\r\nimport {\r\n  Select,\r\n  SelectContent,\r\n  SelectItem,\r\n  SelectTrigger,\r\n  SelectValue,\r\n} from '@/components/ui/select';\r\nimport { Checkbox } from '@/components/ui/checkbox';\r\nimport { Badge } from '@/components/ui/badge';\r\nimport {\r\n  Plus,\r\n  Trash2,\r\n  Loader2,\r\n  AlertTriangle,\r\n  ChevronDown,\r\n  FileText,\r\n  DollarSign,\r\n  ScrollText,\r\n  Check,\r\n  Building2,\r\n} from 'lucide-react';\r\nimport type { FeePlanWithComponents } from '@/lib/fees/types';\r\nimport { TermSheetSelector, type TermSheet } from './TermSheetSelector';\r\nimport { EntitySelector, type EntityType } from './EntitySelector';\r\nimport { validateFeeComponentsAgainstTermSheet } from '@/lib/fees/term-sheet-sync';\r\n\r\n// ============================================================================\r\n// TYPES\r\n// ============================================================================\r\n\r\ninterface FeePlanEditModalProps {\r\n  open: boolean;\r\n  onClose: () => void;\r\n  onSuccess: () => void;\r\n  feePlan?: FeePlanWithComponents | null;\r\n  dealId?: string;\r\n  initialTermSheetId?: string;\r\n}\r\n\r\ninterface FeeComponent {\r\n  id?: string;\r\n  kind: 'subscription' | 'management' | 'performance' | 'spread_markup' | 'flat' | 'bd_fee' | 'finra_fee' | 'other';\r\n  calc_method: string;\r\n  frequency: string;\r\n  rate_bps?: number;\r\n  flat_amount?: number;\r\n  notes?: string;\r\n  payment_schedule?: string;\r\n  duration_periods?: number;\r\n  duration_unit?: string;\r\n  tier_threshold_multiplier?: number;\r\n}\r\n\r\ninterface AgreementTerms {\r\n  duration_months: number;\r\n  non_circumvention_months: number | null;\r\n  non_circumvention_indefinite: boolean;\r\n  governing_law: string;\r\n  vat_number: string;\r\n  intro_payment_days: number;\r\n  perf_payment_days: number;\r\n  hurdle_rate_bps?: number;\r\n  has_catchup: boolean;\r\n  catchup_rate_bps?: number;\r\n  has_high_water_mark: boolean;\r\n  has_no_cap: boolean;\r\n  performance_cap_percent?: number;\r\n}\r\n\r\n// ============================================================================\r\n// CONSTANTS\r\n// ============================================================================\r\n\r\nconst FEE_KINDS = [\r\n  { value: 'subscription', label: 'Subscription Fee', color: 'blue' },\r\n  { value: 'management', label: 'Management Fee', color: 'green' },\r\n  { value: 'performance', label: 'Performance Fee', color: 'purple' },\r\n  { value: 'flat', label: 'Flat Fee', color: 'amber' },\r\n  { value: 'spread_markup', label: 'Spread/Markup', color: 'cyan' },\r\n  { value: 'other', label: 'Other', color: 'gray' },\r\n] as const;\r\n\r\nconst CALC_METHODS = [\r\n  { value: 'percent_of_investment', label: '% of Investment' },\r\n  { value: 'percent_per_annum', label: '% per Annum' },\r\n  { value: 'percent_of_profit', label: '% of Profit' },\r\n  { value: 'fixed_amount', label: 'Fixed Amount' },\r\n] as const;\r\n\r\nconst GOVERNING_LAWS = [\r\n  'British Virgin Islands',\r\n  'England and Wales',\r\n  'Cayman Islands',\r\n  'Delaware, USA',\r\n  'Singapore',\r\n] as const;\r\n\r\nconst DEFAULT_AGREEMENT_TERMS: AgreementTerms = {\r\n  duration_months: 36,\r\n  non_circumvention_months: null,\r\n  non_circumvention_indefinite: true,\r\n  governing_law: 'British Virgin Islands',\r\n  vat_number: '',\r\n  intro_payment_days: 3,\r\n  perf_payment_days: 10,\r\n  has_catchup: false,\r\n  has_high_water_mark: false,\r\n  has_no_cap: true,\r\n};\r\n\r\n// ============================================================================\r\n// SECTION COMPONENTS\r\n// ============================================================================\r\n\r\ninterface CollapsibleSectionProps {\r\n  title: string;\r\n  icon: React.ReactNode;\r\n  isOpen: boolean;\r\n  onToggle: () => void;\r\n  children: React.ReactNode;\r\n  badge?: string;\r\n  status?: 'complete' | 'incomplete' | 'error';\r\n}\r\n\r\nfunction CollapsibleSection({\r\n  title,\r\n  icon,\r\n  isOpen,\r\n  onToggle,\r\n  children,\r\n  badge,\r\n  status,\r\n}: CollapsibleSectionProps) {\r\n  return (\r\n    <div className=\"border border-border rounded-2xl overflow-hidden bg-card shadow-lg\">\r\n      <button\r\n        type=\"button\"\r\n        onClick={onToggle}\r\n        className=\"w-full px-8 py-6 flex items-center justify-between hover:bg-muted/60 transition-colors\"\r\n      >\r\n        <div className=\"flex items-center gap-5\">\r\n          <div className=\"text-blue-500 dark:text-blue-400 p-2 bg-blue-500/10 rounded-lg\">{icon}</div>\r\n          <span className=\"font-bold text-foreground text-xl\">{title}</span>\r\n          {badge && (\r\n            <Badge variant=\"outline\" className=\"text-sm border-border text-foreground px-3 py-1 font-medium\">\r\n              {badge}\r\n            </Badge>\r\n          )}\r\n        </div>\r\n        <div className=\"flex items-center gap-5\">\r\n          {status === 'complete' && (\r\n            <div className=\"w-8 h-8 rounded-full bg-green-500/20 flex items-center justify-center\">\r\n              <Check className=\"w-5 h-5 text-green-500 dark:text-green-400\" />\r\n            </div>\r\n          )}\r\n          {status === 'error' && (\r\n            <div className=\"w-8 h-8 rounded-full bg-red-500/20 flex items-center justify-center\">\r\n              <AlertTriangle className=\"w-5 h-5 text-red-500 dark:text-red-400\" />\r\n            </div>\r\n          )}\r\n          <motion.div\r\n            animate={{ rotate: isOpen ? 180 : 0 }}\r\n            transition={{ duration: 0.2 }}\r\n            className=\"p-1\"\r\n          >\r\n            <ChevronDown className=\"w-6 h-6 text-muted-foreground\" />\r\n          </motion.div>\r\n        </div>\r\n      </button>\r\n      <AnimatePresence>\r\n        {isOpen && (\r\n          <motion.div\r\n            initial={{ height: 0, opacity: 0 }}\r\n            animate={{ height: 'auto', opacity: 1 }}\r\n            exit={{ height: 0, opacity: 0 }}\r\n            transition={{ duration: 0.25, ease: 'easeInOut' }}\r\n          >\r\n            <div className=\"px-8 pb-8 pt-6 border-t border-border bg-muted/30\">\r\n              {children}\r\n            </div>\r\n          </motion.div>\r\n        )}\r\n      </AnimatePresence>\r\n    </div>\r\n  );\r\n}\r\n\r\n// ============================================================================\r\n// FEE COMPONENT CARD\r\n// ============================================================================\r\n\r\ninterface FeeComponentCardProps {\r\n  component: FeeComponent;\r\n  index: number;\r\n  onChange: (updates: Partial<FeeComponent>) => void;\r\n  onRemove: () => void;\r\n  termSheetLimits?: { subscription?: number; management?: number; performance?: number };\r\n}\r\n\r\nfunction FeeComponentCard({\r\n  component,\r\n  index,\r\n  onChange,\r\n  onRemove,\r\n  termSheetLimits,\r\n}: FeeComponentCardProps) {\r\n  const kindConfig = FEE_KINDS.find((k) => k.value === component.kind);\r\n\r\n  const ratePercent = component.rate_bps ? (component.rate_bps / 100).toFixed(2) : null;\r\n\r\n  // Check if rate exceeds term sheet limit\r\n  const exceedsLimit = useMemo(() => {\r\n    if (!termSheetLimits || !component.rate_bps) return false;\r\n    const limitKey = component.kind as keyof typeof termSheetLimits;\r\n    const limit = termSheetLimits[limitKey];\r\n    if (!limit) return false;\r\n    return (component.rate_bps / 100) > limit;\r\n  }, [termSheetLimits, component.rate_bps, component.kind]);\r\n\r\n  // Color mapping for Tailwind (can't use dynamic class names)\r\n  const getBorderColor = () => {\r\n    switch (kindConfig?.color) {\r\n      case 'blue': return 'border-blue-500/40';\r\n      case 'green': return 'border-green-500/40';\r\n      case 'purple': return 'border-purple-500/40';\r\n      case 'amber': return 'border-amber-500/40';\r\n      case 'cyan': return 'border-cyan-500/40';\r\n      default: return 'border-border';\r\n    }\r\n  };\r\n\r\n  const getBadgeColor = () => {\r\n    switch (kindConfig?.color) {\r\n      case 'blue': return 'bg-blue-500/20 text-blue-400';\r\n      case 'green': return 'bg-green-500/20 text-green-400';\r\n      case 'purple': return 'bg-purple-500/20 text-purple-400';\r\n      case 'amber': return 'bg-amber-500/20 text-amber-400';\r\n      case 'cyan': return 'bg-cyan-500/20 text-cyan-400';\r\n      default: return 'bg-muted text-muted-foreground';\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className={`border-2 rounded-2xl p-6 bg-card ${getBorderColor()} transition-all hover:bg-muted/60`}>\r\n      {/* Header Row */}\r\n      <div className=\"flex items-center justify-between mb-6\">\r\n        <div className=\"flex items-center gap-5\">\r\n          <div className={`w-12 h-12 rounded-xl ${getBadgeColor()} flex items-center justify-center font-bold text-lg`}>\r\n            {index + 1}\r\n          </div>\r\n          <div className=\"space-y-1\">\r\n            <Label className=\"text-sm text-muted-foreground\">Fee Type</Label>\r\n            <Select\r\n              value={component.kind}\r\n              onValueChange={(val) => onChange({ kind: val as FeeComponent['kind'] })}\r\n            >\r\n              <SelectTrigger className=\"w-64 bg-muted/50 border-border text-foreground h-12 text-base font-medium\">\r\n                <SelectValue />\r\n              </SelectTrigger>\r\n              <SelectContent className=\"bg-popover border-border\">\r\n                {FEE_KINDS.map((kind) => (\r\n                  <SelectItem key={kind.value} value={kind.value} className=\"text-base py-3\">\r\n                    {kind.label}\r\n                  </SelectItem>\r\n                ))}\r\n              </SelectContent>\r\n            </Select>\r\n          </div>\r\n        </div>\r\n        <Button\r\n          type=\"button\"\r\n          variant=\"ghost\"\r\n          size=\"icon\"\r\n          onClick={onRemove}\r\n          className=\"text-muted-foreground hover:text-red-500 dark:hover:text-red-400 hover:bg-red-500/10 h-12 w-12 rounded-xl\"\r\n        >\r\n          <Trash2 className=\"w-6 h-6\" />\r\n        </Button>\r\n      </div>\r\n\r\n      {/* Fields - 4 columns with more gap */}\r\n      <div className=\"grid grid-cols-4 gap-6\">\r\n        {/* Calculation Method */}\r\n        <div className=\"space-y-2\">\r\n          <Label className=\"text-sm text-muted-foreground font-medium\">Calculation Method</Label>\r\n          <Select\r\n            value={component.calc_method}\r\n            onValueChange={(val) => onChange({ calc_method: val })}\r\n          >\r\n            <SelectTrigger className=\"bg-muted/50 border-border text-foreground h-12 text-base\">\r\n              <SelectValue />\r\n            </SelectTrigger>\r\n            <SelectContent className=\"bg-popover border-border\">\r\n              {CALC_METHODS.map((method) => (\r\n                <SelectItem key={method.value} value={method.value} className=\"text-base py-2.5\">\r\n                  {method.label}\r\n                </SelectItem>\r\n              ))}\r\n            </SelectContent>\r\n          </Select>\r\n        </div>\r\n\r\n        {/* Conditional: Rate OR Flat Amount based on calc_method */}\r\n        {component.calc_method === 'fixed_amount' ? (\r\n          <div className=\"space-y-2\">\r\n            <Label className=\"text-sm text-muted-foreground font-medium\">Amount (USD)</Label>\r\n            <Input\r\n              type=\"number\"\r\n              step=\"0.01\"\r\n              min=\"0\"\r\n              value={component.flat_amount || ''}\r\n              onChange={(e) => onChange({ flat_amount: e.target.value ? Number(e.target.value) : undefined })}\r\n              placeholder=\"5,000.00\"\r\n              className=\"bg-muted/50 border-border text-foreground h-12 text-lg font-mono\"\r\n            />\r\n            {component.flat_amount && (\r\n              <p className=\"text-base text-green-600 dark:text-green-400 font-semibold\">\r\n                ${component.flat_amount.toLocaleString()}\r\n              </p>\r\n            )}\r\n          </div>\r\n        ) : (\r\n          <div className=\"space-y-2\">\r\n            <Label className=\"text-sm text-muted-foreground font-medium\">Rate (Basis Points)</Label>\r\n            <Input\r\n              type=\"number\"\r\n              value={component.rate_bps || ''}\r\n              onChange={(e) => onChange({ rate_bps: e.target.value ? Number(e.target.value) : undefined })}\r\n              placeholder=\"200\"\r\n              className={`bg-muted/50 border-border text-foreground h-12 text-lg font-mono ${exceedsLimit ? 'border-red-500 bg-red-500/10' : ''}`}\r\n            />\r\n            {ratePercent && (\r\n              <p className={`text-base font-semibold ${exceedsLimit ? 'text-red-500 dark:text-red-400' : 'text-blue-600 dark:text-blue-400'}`}>\r\n                = {ratePercent}%\r\n                {exceedsLimit && ' ⚠️ exceeds limit'}\r\n              </p>\r\n            )}\r\n          </div>\r\n        )}\r\n\r\n        {/* Payment Schedule */}\r\n        <div className=\"space-y-2\">\r\n          <Label className=\"text-sm text-muted-foreground font-medium\">Payment Schedule</Label>\r\n          <Select\r\n            value={component.payment_schedule || 'upfront'}\r\n            onValueChange={(val) => onChange({ payment_schedule: val })}\r\n          >\r\n            <SelectTrigger className=\"bg-muted/50 border-border text-foreground h-12 text-base\">\r\n              <SelectValue />\r\n            </SelectTrigger>\r\n            <SelectContent className=\"bg-popover border-border\">\r\n              <SelectItem value=\"upfront\" className=\"text-base py-2.5\">Upfront</SelectItem>\r\n              <SelectItem value=\"recurring\" className=\"text-base py-2.5\">Recurring</SelectItem>\r\n              <SelectItem value=\"on_demand\" className=\"text-base py-2.5\">On Demand</SelectItem>\r\n            </SelectContent>\r\n          </Select>\r\n        </div>\r\n\r\n        {/* Notes */}\r\n        <div className=\"space-y-2\">\r\n          <Label className=\"text-sm text-muted-foreground font-medium\">Notes</Label>\r\n          <Input\r\n            value={component.notes || ''}\r\n            onChange={(e) => onChange({ notes: e.target.value })}\r\n            placeholder=\"Optional notes...\"\r\n            className=\"bg-muted/50 border-border text-foreground h-12 text-base\"\r\n          />\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\n// ============================================================================\r\n// MAIN MODAL COMPONENT\r\n// ============================================================================\r\n\r\nexport default function FeePlanEditModal({\r\n  open,\r\n  onClose,\r\n  onSuccess,\r\n  feePlan,\r\n  dealId,\r\n  initialTermSheetId,\r\n}: FeePlanEditModalProps) {\r\n  // UI State\r\n  const [loading, setLoading] = useState(false);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [expandedSections, setExpandedSections] = useState({\r\n    basic: true,\r\n    components: true,\r\n    agreement: false,\r\n  });\r\n\r\n  // Data State\r\n  const [deals, setDeals] = useState<Array<{ id: string; name: string }>>([]);\r\n  const [validationErrors, setValidationErrors] = useState<string[]>([]);\r\n\r\n  // Form State - Basic Info\r\n  const [name, setName] = useState('');\r\n  const [description, setDescription] = useState('');\r\n  const [selectedDealId, setSelectedDealId] = useState<string | undefined>(dealId);\r\n  const [isActive, setIsActive] = useState(true);\r\n\r\n  // Form State - Term Sheet & Entity\r\n  const [termSheetId, setTermSheetId] = useState<string | undefined>(initialTermSheetId);\r\n  const [selectedTermSheet, setSelectedTermSheet] = useState<TermSheet | null>(null);\r\n  const [entityType, setEntityType] = useState<EntityType | undefined>();\r\n  const [entityId, setEntityId] = useState<string | undefined>();\r\n\r\n  // Form State - Components\r\n  const [components, setComponents] = useState<FeeComponent[]>([]);\r\n\r\n  // Form State - Agreement Terms\r\n  const [agreementTerms, setAgreementTerms] = useState<AgreementTerms>(DEFAULT_AGREEMENT_TERMS);\r\n\r\n  // Derived State\r\n  const isEditing = !!feePlan;\r\n  const hasPerformanceComponent = components.some((c) => c.kind === 'performance');\r\n  const hasSubscriptionComponent = components.some((c) => c.kind === 'subscription');\r\n\r\n  const termSheetLimits = useMemo(() => {\r\n    if (!selectedTermSheet) return undefined;\r\n    return {\r\n      subscription: selectedTermSheet.subscription_fee_percent || undefined,\r\n      management: selectedTermSheet.management_fee_percent || undefined,\r\n      performance: selectedTermSheet.carried_interest_percent || undefined,\r\n    };\r\n  }, [selectedTermSheet]);\r\n\r\n  // Check section completion\r\n  const basicInfoComplete = name.trim() && selectedDealId && termSheetId && entityType && entityId;\r\n  const componentsValid = validationErrors.length === 0;\r\n\r\n  // ============================================================================\r\n  // EFFECTS\r\n  // ============================================================================\r\n\r\n  // Load deals on open\r\n  useEffect(() => {\r\n    if (open) {\r\n      loadDeals();\r\n    }\r\n  }, [open]);\r\n\r\n  // Initialize form when opening\r\n  useEffect(() => {\r\n    if (!open) return;\r\n\r\n    if (feePlan) {\r\n      // Edit mode - load existing data\r\n      setName(feePlan.name);\r\n      setDescription(feePlan.description || '');\r\n      setSelectedDealId(feePlan.deal_id || undefined);\r\n      setIsActive(feePlan.is_active);\r\n\r\n      const fp = feePlan as any;\r\n      setTermSheetId(fp.term_sheet_id || undefined);\r\n\r\n      // Determine entity\r\n      if (fp.introducer_id) {\r\n        setEntityType('introducer');\r\n        setEntityId(fp.introducer_id);\r\n      } else if (fp.partner_id) {\r\n        setEntityType('partner');\r\n        setEntityId(fp.partner_id);\r\n      } else if (fp.commercial_partner_id) {\r\n        setEntityType('commercial_partner');\r\n        setEntityId(fp.commercial_partner_id);\r\n      }\r\n\r\n      // Load agreement terms\r\n      setAgreementTerms({\r\n        duration_months: fp.agreement_duration_months ?? 36,\r\n        non_circumvention_months: fp.non_circumvention_months ?? null,\r\n        non_circumvention_indefinite: fp.non_circumvention_months == null,\r\n        governing_law: fp.governing_law ?? 'British Virgin Islands',\r\n        vat_number: fp.vat_registration_number ?? '',\r\n        intro_payment_days: 3,\r\n        perf_payment_days: 10,\r\n        hurdle_rate_bps: undefined,\r\n        has_catchup: false,\r\n        catchup_rate_bps: undefined,\r\n        has_high_water_mark: false,\r\n        has_no_cap: true,\r\n        performance_cap_percent: undefined,\r\n      });\r\n\r\n      // Load components\r\n      const existingComponents = (feePlan.components || []) as any[];\r\n      const subComp = existingComponents.find((c) => c.kind === 'subscription');\r\n      const perfComp = existingComponents.find((c) => c.kind === 'performance');\r\n\r\n      // Extract agreement terms from components\r\n      if (subComp) {\r\n        setAgreementTerms((prev) => ({\r\n          ...prev,\r\n          intro_payment_days: subComp.payment_days_after_event ?? 3,\r\n        }));\r\n      }\r\n      if (perfComp) {\r\n        setAgreementTerms((prev) => ({\r\n          ...prev,\r\n          perf_payment_days: perfComp.payment_days_after_event ?? 10,\r\n          hurdle_rate_bps: perfComp.hurdle_rate_bps,\r\n          has_catchup: perfComp.has_catchup ?? false,\r\n          catchup_rate_bps: perfComp.catchup_rate_bps,\r\n          has_high_water_mark: perfComp.has_high_water_mark ?? false,\r\n          has_no_cap: perfComp.has_no_cap ?? true,\r\n          performance_cap_percent: perfComp.performance_cap_percent,\r\n        }));\r\n      }\r\n\r\n      setComponents(\r\n        existingComponents.map((c: any) => ({\r\n          id: c.id,\r\n          kind: c.kind,\r\n          calc_method: c.calc_method || 'percent_of_investment',\r\n          frequency: c.frequency || 'one_time',\r\n          rate_bps: c.rate_bps,\r\n          flat_amount: c.flat_amount,\r\n          notes: c.notes || '',\r\n          payment_schedule: c.payment_schedule || 'upfront',\r\n          duration_periods: c.duration_periods,\r\n          duration_unit: c.duration_unit,\r\n        }))\r\n      );\r\n    } else {\r\n      // Create mode - reset form\r\n      resetForm();\r\n    }\r\n  }, [open, feePlan, dealId, initialTermSheetId]);\r\n\r\n  // Validate components against term sheet\r\n  useEffect(() => {\r\n    if (selectedTermSheet && components.length > 0) {\r\n      const errors = validateFeeComponentsAgainstTermSheet(components, selectedTermSheet);\r\n      setValidationErrors(errors);\r\n    } else {\r\n      setValidationErrors([]);\r\n    }\r\n  }, [components, selectedTermSheet]);\r\n\r\n  // Auto-expand agreement section when entity is selected\r\n  useEffect(() => {\r\n    if (entityType && entityId) {\r\n      setExpandedSections((prev) => ({ ...prev, agreement: true }));\r\n    }\r\n  }, [entityType, entityId]);\r\n\r\n  // ============================================================================\r\n  // HANDLERS\r\n  // ============================================================================\r\n\r\n  const resetForm = useCallback(() => {\r\n    setName('');\r\n    setDescription('');\r\n    setSelectedDealId(dealId);\r\n    setIsActive(true);\r\n    setTermSheetId(initialTermSheetId);\r\n    setSelectedTermSheet(null);\r\n    setEntityType(undefined);\r\n    setEntityId(undefined);\r\n    setComponents([]);\r\n    setAgreementTerms(DEFAULT_AGREEMENT_TERMS);\r\n    setError(null);\r\n    setValidationErrors([]);\r\n    setExpandedSections({ basic: true, components: true, agreement: false });\r\n  }, [dealId, initialTermSheetId]);\r\n\r\n  const loadDeals = async () => {\r\n    try {\r\n      const res = await fetch('/api/deals');\r\n      const json = await res.json();\r\n      setDeals(json.deals || []);\r\n    } catch (err) {\r\n      console.error('Error loading deals:', err);\r\n    }\r\n  };\r\n\r\n  const toggleSection = (section: keyof typeof expandedSections) => {\r\n    setExpandedSections((prev) => ({ ...prev, [section]: !prev[section] }));\r\n  };\r\n\r\n  const addComponent = () => {\r\n    setComponents([\r\n      ...components,\r\n      {\r\n        kind: 'subscription',\r\n        calc_method: 'percent_of_investment',\r\n        frequency: 'one_time',\r\n        payment_schedule: 'upfront',\r\n      },\r\n    ]);\r\n  };\r\n\r\n  const updateComponent = (index: number, updates: Partial<FeeComponent>) => {\r\n    setComponents((prev) => {\r\n      const updated = [...prev];\r\n      updated[index] = { ...updated[index], ...updates };\r\n      return updated;\r\n    });\r\n  };\r\n\r\n  const removeComponent = (index: number) => {\r\n    setComponents((prev) => prev.filter((_, i) => i !== index));\r\n  };\r\n\r\n  const updateAgreementTerms = (updates: Partial<AgreementTerms>) => {\r\n    setAgreementTerms((prev) => ({ ...prev, ...updates }));\r\n  };\r\n\r\n  const handleSave = async () => {\r\n    // Validate\r\n    if (!name.trim()) {\r\n      setError('Plan name is required');\r\n      return;\r\n    }\r\n    if (!selectedDealId) {\r\n      setError('A deal must be selected');\r\n      return;\r\n    }\r\n    if (!termSheetId) {\r\n      setError('A term sheet must be selected');\r\n      return;\r\n    }\r\n    if (!entityType || !entityId) {\r\n      setError('An entity must be selected');\r\n      return;\r\n    }\r\n    if (validationErrors.length > 0) {\r\n      setError(`Fee values exceed term sheet limits: ${validationErrors.join('; ')}`);\r\n      return;\r\n    }\r\n\r\n    setLoading(true);\r\n    setError(null);\r\n\r\n    try {\r\n      // Build entity fields\r\n      const entityFields = {\r\n        introducer_id: entityType === 'introducer' ? entityId : undefined,\r\n        partner_id: entityType === 'partner' ? entityId : undefined,\r\n        commercial_partner_id: entityType === 'commercial_partner' ? entityId : undefined,\r\n      };\r\n\r\n      // Build components with agreement terms merged\r\n      // IMPORTANT: has_catchup and has_high_water_mark are NOT NULL in DB\r\n      const processedComponents = components.map((c) => {\r\n        const { id, notes, ...rest } = c;\r\n\r\n        // Base fields for ALL components - include NOT NULL boolean defaults\r\n        const base = {\r\n          ...rest,\r\n          notes: notes?.trim() || undefined,\r\n          // These columns are NOT NULL in DB - must always provide values\r\n          has_catchup: false,\r\n          has_high_water_mark: false,\r\n          ...(id && id.length > 10 ? { id } : {}),\r\n        };\r\n\r\n        if (c.kind === 'subscription') {\r\n          return {\r\n            ...base,\r\n            payment_days_after_event: agreementTerms.intro_payment_days,\r\n          };\r\n        }\r\n\r\n        if (c.kind === 'performance') {\r\n          return {\r\n            ...base,\r\n            payment_days_after_event: agreementTerms.perf_payment_days,\r\n            hurdle_rate_bps: agreementTerms.hurdle_rate_bps || undefined,\r\n            has_catchup: agreementTerms.has_catchup,\r\n            catchup_rate_bps: agreementTerms.has_catchup ? agreementTerms.catchup_rate_bps : undefined,\r\n            has_high_water_mark: agreementTerms.has_high_water_mark,\r\n            has_no_cap: agreementTerms.has_no_cap,\r\n            performance_cap_percent: agreementTerms.has_no_cap ? undefined : agreementTerms.performance_cap_percent,\r\n          };\r\n        }\r\n\r\n        return base;\r\n      });\r\n\r\n      const payload = {\r\n        name: name.trim(),\r\n        description: description.trim() || undefined,\r\n        deal_id: selectedDealId,\r\n        term_sheet_id: termSheetId,\r\n        ...entityFields,\r\n        is_active: isActive,\r\n        agreement_duration_months: agreementTerms.duration_months,\r\n        non_circumvention_months: agreementTerms.non_circumvention_indefinite ? null : agreementTerms.non_circumvention_months,\r\n        governing_law: agreementTerms.governing_law,\r\n        vat_registration_number: agreementTerms.vat_number.trim() || null,\r\n        components: processedComponents,\r\n      };\r\n\r\n      const url = feePlan ? `/api/staff/fees/plans/${feePlan.id}` : '/api/staff/fees/plans';\r\n      const res = await fetch(url, {\r\n        method: feePlan ? 'PUT' : 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify(payload),\r\n      });\r\n\r\n      if (!res.ok) {\r\n        const errorData = await res.json().catch(() => ({ error: `HTTP ${res.status}` }));\r\n        const msg = errorData.error || 'Failed to save';\r\n        const details = errorData.details ? `\\n${errorData.details}` : '';\r\n        throw new Error(`${msg}${details}`);\r\n      }\r\n\r\n      onSuccess();\r\n    } catch (err) {\r\n      setError(err instanceof Error ? err.message : 'Failed to save fee plan');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  // ============================================================================\r\n  // RENDER\r\n  // ============================================================================\r\n\r\n  return (\r\n    <Dialog open={open} onOpenChange={(isOpen) => !isOpen && onClose()}>\r\n      <DialogContent\r\n        showCloseButton={false}\r\n        className=\"!max-w-[1400px] !w-[96vw] !max-h-[94vh] !p-0 bg-background border-border text-foreground overflow-hidden flex flex-col\"\r\n      >\r\n        {/* Header */}\r\n        <DialogHeader className=\"px-10 py-6 border-b border-border bg-gradient-to-r from-blue-500/5 dark:from-blue-900/10 via-muted/30 to-transparent shrink-0\">\r\n          <div className=\"flex items-center justify-between\">\r\n            <div>\r\n              <DialogTitle className=\"text-2xl font-bold text-foreground tracking-tight\">\r\n                {isEditing ? 'Edit Fee Plan' : 'Create New Fee Plan'}\r\n              </DialogTitle>\r\n              <p className=\"text-base text-muted-foreground mt-2\">\r\n                {isEditing ? 'Modify fee structure and agreement terms' : 'Define a fee structure for a partner or introducer agreement'}\r\n              </p>\r\n            </div>\r\n            <div className=\"flex items-center gap-6\">\r\n              <div className=\"flex items-center gap-3 bg-muted/50 px-4 py-2 rounded-lg border border-border\">\r\n                <Checkbox\r\n                  id=\"is_active\"\r\n                  checked={isActive}\r\n                  onCheckedChange={(checked) => setIsActive(checked as boolean)}\r\n                  className=\"border-border h-5 w-5\"\r\n                />\r\n                <Label htmlFor=\"is_active\" className=\"text-sm text-muted-foreground cursor-pointer font-medium\">\r\n                  Plan Active\r\n                </Label>\r\n              </div>\r\n              <Button\r\n                type=\"button\"\r\n                variant=\"ghost\"\r\n                size=\"icon\"\r\n                onClick={onClose}\r\n                className=\"h-10 w-10 text-muted-foreground hover:text-foreground hover:bg-muted rounded-lg\"\r\n              >\r\n                <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\"><path d=\"M18 6 6 18\"/><path d=\"m6 6 12 12\"/></svg>\r\n              </Button>\r\n            </div>\r\n          </div>\r\n        </DialogHeader>\r\n\r\n        {/* Error Banner */}\r\n        <AnimatePresence>\r\n          {error && (\r\n            <motion.div\r\n              initial={{ height: 0, opacity: 0 }}\r\n              animate={{ height: 'auto', opacity: 1 }}\r\n              exit={{ height: 0, opacity: 0 }}\r\n              className=\"px-10 py-4 bg-red-500/10 border-b border-red-500/30 shrink-0\"\r\n            >\r\n              <div className=\"flex items-center gap-3 text-red-400\">\r\n                <AlertTriangle className=\"w-5 h-5 shrink-0\" />\r\n                <span className=\"text-base\">{error}</span>\r\n              </div>\r\n            </motion.div>\r\n          )}\r\n        </AnimatePresence>\r\n\r\n        {/* Scrollable Content */}\r\n        <div className=\"flex-1 overflow-y-auto px-10 py-8 space-y-6\">\r\n          {/* Section 1: Basic Information */}\r\n          <CollapsibleSection\r\n            title=\"Basic Information\"\r\n            icon={<FileText className=\"w-5 h-5\" />}\r\n            isOpen={expandedSections.basic}\r\n            onToggle={() => toggleSection('basic')}\r\n            status={basicInfoComplete ? 'complete' : undefined}\r\n          >\r\n            <div className=\"space-y-6\">\r\n              {/* Row 1: Plan Name & Description side by side */}\r\n              <div className=\"grid grid-cols-2 gap-8\">\r\n                <div className=\"space-y-3\">\r\n                  <Label className=\"text-base text-foreground font-medium\">\r\n                    Plan Name <span className=\"text-red-500 dark:text-red-400\">*</span>\r\n                  </Label>\r\n                  <Input\r\n                    value={name}\r\n                    onChange={(e) => setName(e.target.value)}\r\n                    placeholder=\"e.g., Standard Introducer Fee Plan\"\r\n                    className=\"bg-muted/50 border-border text-foreground h-12 text-base focus:border-blue-500 focus:ring-1 focus:ring-blue-500/30\"\r\n                  />\r\n                </div>\r\n                <div className=\"space-y-3\">\r\n                  <Label className=\"text-base text-foreground font-medium\">Description</Label>\r\n                  <Input\r\n                    value={description}\r\n                    onChange={(e) => setDescription(e.target.value)}\r\n                    placeholder=\"Optional description of this fee arrangement...\"\r\n                    className=\"bg-muted/50 border-border text-foreground h-12 text-base focus:border-blue-500\"\r\n                  />\r\n                </div>\r\n              </div>\r\n\r\n              {/* Row 2: Deal, Term Sheet, Entity - 3 columns */}\r\n              <div className=\"grid grid-cols-3 gap-8\">\r\n                {/* Deal */}\r\n                <div className=\"space-y-3\">\r\n                  {dealId ? (\r\n                    <>\r\n                      <Label className=\"text-base text-foreground font-medium\">Deal</Label>\r\n                      <div className=\"flex items-center gap-3 px-4 py-3 bg-muted/50 border border-border rounded-lg text-foreground h-12\">\r\n                        <Building2 className=\"w-5 h-5 text-blue-500 dark:text-blue-400\" />\r\n                        <span className=\"text-base truncate\">{deals.find((d) => d.id === dealId)?.name || 'Loading...'}</span>\r\n                      </div>\r\n                    </>\r\n                  ) : (\r\n                    <>\r\n                      <Label className=\"text-base text-foreground font-medium\">\r\n                        Deal <span className=\"text-red-500 dark:text-red-400\">*</span>\r\n                      </Label>\r\n                      <Select\r\n                        value={selectedDealId || ''}\r\n                        onValueChange={(val) => {\r\n                          setSelectedDealId(val || undefined);\r\n                          setTermSheetId(undefined);\r\n                          setSelectedTermSheet(null);\r\n                          setEntityType(undefined);\r\n                          setEntityId(undefined);\r\n                        }}\r\n                      >\r\n                        <SelectTrigger className=\"bg-muted/50 border-border text-foreground h-12 text-base\">\r\n                          <SelectValue placeholder=\"Select a deal\" />\r\n                        </SelectTrigger>\r\n                        <SelectContent className=\"bg-popover border-border\">\r\n                          {deals.map((deal) => (\r\n                            <SelectItem key={deal.id} value={deal.id} className=\"text-base py-2.5\">\r\n                              {deal.name}\r\n                            </SelectItem>\r\n                          ))}\r\n                        </SelectContent>\r\n                      </Select>\r\n                    </>\r\n                  )}\r\n                </div>\r\n\r\n                {/* Term Sheet */}\r\n                <div className=\"space-y-3\">\r\n                  <TermSheetSelector\r\n                    dealId={selectedDealId}\r\n                    value={termSheetId}\r\n                    onChange={(id, ts) => {\r\n                      setTermSheetId(id);\r\n                      setSelectedTermSheet(ts);\r\n                    }}\r\n                    required={true}\r\n                  />\r\n                </div>\r\n\r\n                {/* Entity Type Quick Select - simplified */}\r\n                <div className=\"space-y-3\">\r\n                  <Label className=\"text-base text-foreground font-medium\">\r\n                    Entity Type <span className=\"text-red-500 dark:text-red-400\">*</span>\r\n                  </Label>\r\n                  <Select\r\n                    value={entityType || ''}\r\n                    onValueChange={(val) => {\r\n                      setEntityType(val as EntityType || undefined);\r\n                      setEntityId(undefined);\r\n                    }}\r\n                    disabled={!selectedDealId}\r\n                  >\r\n                    <SelectTrigger className=\"bg-muted/50 border-border text-foreground h-12 text-base\">\r\n                      <SelectValue placeholder={selectedDealId ? \"Select type\" : \"Select deal first\"} />\r\n                    </SelectTrigger>\r\n                    <SelectContent className=\"bg-popover border-border\">\r\n                      <SelectItem value=\"introducer\" className=\"text-base py-2.5\">Introducer</SelectItem>\r\n                      <SelectItem value=\"partner\" className=\"text-base py-2.5\">Partner</SelectItem>\r\n                    </SelectContent>\r\n                  </Select>\r\n                </div>\r\n              </div>\r\n\r\n              {/* Row 3: Entity Selection (only if type selected) */}\r\n              {entityType && selectedDealId && (\r\n                <div className=\"pt-4 border-t border-border\">\r\n                  <EntitySelector\r\n                    dealId={selectedDealId}\r\n                    entityType={entityType}\r\n                    onEntityTypeChange={setEntityType}\r\n                    entityId={entityId}\r\n                    onEntityIdChange={setEntityId}\r\n                    required={true}\r\n                    excludeTypes={['commercial_partner']}\r\n                  />\r\n                </div>\r\n              )}\r\n            </div>\r\n          </CollapsibleSection>\r\n\r\n          {/* Section 2: Fee Components */}\r\n          <CollapsibleSection\r\n            title=\"Fee Components\"\r\n            icon={<DollarSign className=\"w-5 h-5\" />}\r\n            isOpen={expandedSections.components}\r\n            onToggle={() => toggleSection('components')}\r\n            badge={`${components.length} component${components.length !== 1 ? 's' : ''}`}\r\n            status={components.length > 0 ? (componentsValid ? 'complete' : 'error') : undefined}\r\n          >\r\n            <div className=\"space-y-4\">\r\n              {/* Validation Errors */}\r\n              {validationErrors.length > 0 && (\r\n                <div className=\"p-3 bg-red-500/10 border border-red-500/30 rounded-lg\">\r\n                  <div className=\"flex items-start gap-2\">\r\n                    <AlertTriangle className=\"w-4 h-4 text-red-400 mt-0.5\" />\r\n                    <div className=\"text-sm text-red-400\">\r\n                      <p className=\"font-medium\">Fees exceed term sheet limits:</p>\r\n                      <ul className=\"mt-1 space-y-1\">\r\n                        {validationErrors.map((err, i) => (\r\n                          <li key={i}>• {err}</li>\r\n                        ))}\r\n                      </ul>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              )}\r\n\r\n              {/* Components List */}\r\n              {components.length === 0 ? (\r\n                <div className=\"text-center py-8 border-2 border-dashed border-border rounded-lg\">\r\n                  <DollarSign className=\"w-8 h-8 text-muted-foreground mx-auto mb-2\" />\r\n                  <p className=\"text-muted-foreground text-sm\">No fee components defined</p>\r\n                  <Button\r\n                    type=\"button\"\r\n                    onClick={addComponent}\r\n                    variant=\"outline\"\r\n                    size=\"sm\"\r\n                    className=\"mt-3 border-border text-muted-foreground hover:bg-muted\"\r\n                  >\r\n                    <Plus className=\"w-4 h-4 mr-2\" />\r\n                    Add First Component\r\n                  </Button>\r\n                </div>\r\n              ) : (\r\n                <div className=\"space-y-3\">\r\n                  {components.map((comp, index) => (\r\n                    <FeeComponentCard\r\n                      key={index}\r\n                      component={comp}\r\n                      index={index}\r\n                      onChange={(updates) => updateComponent(index, updates)}\r\n                      onRemove={() => removeComponent(index)}\r\n                      termSheetLimits={termSheetLimits}\r\n                    />\r\n                  ))}\r\n                  <Button\r\n                    type=\"button\"\r\n                    onClick={addComponent}\r\n                    variant=\"outline\"\r\n                    size=\"sm\"\r\n                    className=\"w-full border-border border-dashed text-muted-foreground hover:bg-muted hover:text-foreground\"\r\n                  >\r\n                    <Plus className=\"w-4 h-4 mr-2\" />\r\n                    Add Component\r\n                  </Button>\r\n                </div>\r\n              )}\r\n            </div>\r\n          </CollapsibleSection>\r\n\r\n          {/* Section 3: Agreement Terms (only for introducers/partners) */}\r\n          {(entityType === 'introducer' || entityType === 'partner') && (\r\n            <CollapsibleSection\r\n              title=\"Agreement Terms\"\r\n              icon={<ScrollText className=\"w-5 h-5\" />}\r\n              isOpen={expandedSections.agreement}\r\n              onToggle={() => toggleSection('agreement')}\r\n              badge={entityType === 'introducer' ? 'DOC 3' : 'Placement'}\r\n            >\r\n              <div className=\"space-y-6\">\r\n                {/* General Terms */}\r\n                <div className=\"space-y-4\">\r\n                  <h4 className=\"text-sm font-medium text-foreground flex items-center gap-2\">\r\n                    <div className=\"w-2 h-2 rounded-full bg-blue-500\" />\r\n                    General Terms\r\n                  </h4>\r\n                  <div className=\"grid grid-cols-3 gap-4 pl-4\">\r\n                    {/* Duration */}\r\n                    <div className=\"space-y-2\">\r\n                      <Label className=\"text-xs text-muted-foreground\">Agreement Duration</Label>\r\n                      <div className=\"flex items-center gap-2\">\r\n                        <Input\r\n                          type=\"number\"\r\n                          min=\"1\"\r\n                          value={agreementTerms.duration_months}\r\n                          onChange={(e) => updateAgreementTerms({ duration_months: Number(e.target.value) || 36 })}\r\n                          className=\"bg-muted/50 border-border text-foreground h-9 w-20\"\r\n                        />\r\n                        <span className=\"text-xs text-muted-foreground\">months</span>\r\n                      </div>\r\n                    </div>\r\n\r\n                    {/* Non-Circumvention */}\r\n                    <div className=\"space-y-2\">\r\n                      <Label className=\"text-xs text-muted-foreground\">Non-Circumvention</Label>\r\n                      <div className=\"flex items-center gap-2\">\r\n                        <Checkbox\r\n                          checked={agreementTerms.non_circumvention_indefinite}\r\n                          onCheckedChange={(checked) => {\r\n                            updateAgreementTerms({\r\n                              non_circumvention_indefinite: !!checked,\r\n                              non_circumvention_months: checked ? null : 24,\r\n                            });\r\n                          }}\r\n                          className=\"border-border\"\r\n                        />\r\n                        <span className=\"text-xs text-muted-foreground\">Indefinite</span>\r\n                        {!agreementTerms.non_circumvention_indefinite && (\r\n                          <>\r\n                            <Input\r\n                              type=\"number\"\r\n                              min=\"1\"\r\n                              value={agreementTerms.non_circumvention_months || ''}\r\n                              onChange={(e) => updateAgreementTerms({ non_circumvention_months: Number(e.target.value) || null })}\r\n                              className=\"bg-muted/50 border-border text-foreground h-8 w-16\"\r\n                            />\r\n                            <span className=\"text-xs text-muted-foreground\">mo</span>\r\n                          </>\r\n                        )}\r\n                      </div>\r\n                    </div>\r\n\r\n                    {/* Governing Law */}\r\n                    <div className=\"space-y-2\">\r\n                      <Label className=\"text-xs text-muted-foreground\">Governing Law</Label>\r\n                      <Select\r\n                        value={agreementTerms.governing_law}\r\n                        onValueChange={(val) => updateAgreementTerms({ governing_law: val })}\r\n                      >\r\n                        <SelectTrigger className=\"bg-muted/50 border-border text-foreground h-9 text-xs\">\r\n                          <SelectValue />\r\n                        </SelectTrigger>\r\n                        <SelectContent className=\"bg-popover border-border\">\r\n                          {GOVERNING_LAWS.map((law) => (\r\n                            <SelectItem key={law} value={law} className=\"text-xs\">\r\n                              {law}\r\n                            </SelectItem>\r\n                          ))}\r\n                        </SelectContent>\r\n                      </Select>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n\r\n                {/* Introduction Fee Terms */}\r\n                {hasSubscriptionComponent && (\r\n                  <div className=\"space-y-4\">\r\n                    <h4 className=\"text-sm font-medium text-foreground flex items-center gap-2\">\r\n                      <div className=\"w-2 h-2 rounded-full bg-green-500\" />\r\n                      Introduction Fee Payment\r\n                    </h4>\r\n                    <div className=\"pl-4\">\r\n                      <div className=\"space-y-2\">\r\n                        <Label className=\"text-xs text-muted-foreground\">Payment After Closing</Label>\r\n                        <div className=\"flex items-center gap-2\">\r\n                          <Input\r\n                            type=\"number\"\r\n                            min=\"1\"\r\n                            max=\"90\"\r\n                            value={agreementTerms.intro_payment_days}\r\n                            onChange={(e) => updateAgreementTerms({ intro_payment_days: Number(e.target.value) || 3 })}\r\n                            className=\"bg-muted/50 border-border text-foreground h-9 w-20\"\r\n                          />\r\n                          <span className=\"text-xs text-muted-foreground\">business days after share certificate</span>\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                )}\r\n\r\n                {/* Performance Fee Terms */}\r\n                {hasPerformanceComponent && (\r\n                  <div className=\"space-y-4\">\r\n                    <h4 className=\"text-sm font-medium text-foreground flex items-center gap-2\">\r\n                      <div className=\"w-2 h-2 rounded-full bg-purple-500\" />\r\n                      Performance Fee (Carried Interest)\r\n                    </h4>\r\n                    <div className=\"pl-4 space-y-4\">\r\n                      <div className=\"grid grid-cols-3 gap-4\">\r\n                        {/* Payment Days */}\r\n                        <div className=\"space-y-2\">\r\n                          <Label className=\"text-xs text-muted-foreground\">Payment After Redemption</Label>\r\n                          <div className=\"flex items-center gap-2\">\r\n                            <Input\r\n                              type=\"number\"\r\n                              min=\"1\"\r\n                              max=\"90\"\r\n                              value={agreementTerms.perf_payment_days}\r\n                              onChange={(e) => updateAgreementTerms({ perf_payment_days: Number(e.target.value) || 10 })}\r\n                              className=\"bg-muted/50 border-border text-foreground h-9 w-20\"\r\n                            />\r\n                            <span className=\"text-xs text-muted-foreground\">days</span>\r\n                          </div>\r\n                        </div>\r\n\r\n                        {/* Hurdle Rate */}\r\n                        <div className=\"space-y-2\">\r\n                          <Label className=\"text-xs text-muted-foreground\">Hurdle Rate</Label>\r\n                          <div className=\"flex items-center gap-2\">\r\n                            <Input\r\n                              type=\"number\"\r\n                              min=\"0\"\r\n                              value={agreementTerms.hurdle_rate_bps || ''}\r\n                              onChange={(e) => updateAgreementTerms({ hurdle_rate_bps: e.target.value ? Number(e.target.value) : undefined })}\r\n                              placeholder=\"800\"\r\n                              className=\"bg-muted/50 border-border text-foreground h-9 w-24\"\r\n                            />\r\n                            <span className=\"text-xs text-muted-foreground\">bps</span>\r\n                          </div>\r\n                          {agreementTerms.hurdle_rate_bps && (\r\n                            <p className=\"text-xs text-blue-600 dark:text-blue-400\">= {(agreementTerms.hurdle_rate_bps / 100).toFixed(2)}%</p>\r\n                          )}\r\n                        </div>\r\n                      </div>\r\n\r\n                      {/* Checkboxes Row */}\r\n                      <div className=\"flex flex-wrap gap-6\">\r\n                        {/* GP Catchup */}\r\n                        <div className=\"flex items-center gap-2\">\r\n                          <Checkbox\r\n                            checked={agreementTerms.has_catchup}\r\n                            onCheckedChange={(checked) => updateAgreementTerms({ has_catchup: !!checked })}\r\n                            className=\"border-border\"\r\n                          />\r\n                          <span className=\"text-sm text-muted-foreground\">GP Catchup</span>\r\n                          {agreementTerms.has_catchup && (\r\n                            <div className=\"flex items-center gap-1 ml-2\">\r\n                              <Input\r\n                                type=\"number\"\r\n                                value={agreementTerms.catchup_rate_bps || ''}\r\n                                onChange={(e) => updateAgreementTerms({ catchup_rate_bps: e.target.value ? Number(e.target.value) : undefined })}\r\n                                className=\"bg-muted/50 border-border text-foreground h-8 w-20\"\r\n                              />\r\n                              <span className=\"text-xs text-muted-foreground\">bps</span>\r\n                            </div>\r\n                          )}\r\n                        </div>\r\n\r\n                        {/* High Water Mark */}\r\n                        <div className=\"flex items-center gap-2\">\r\n                          <Checkbox\r\n                            checked={agreementTerms.has_high_water_mark}\r\n                            onCheckedChange={(checked) => updateAgreementTerms({ has_high_water_mark: !!checked })}\r\n                            className=\"border-border\"\r\n                          />\r\n                          <span className=\"text-sm text-muted-foreground\">High Water Mark</span>\r\n                        </div>\r\n\r\n                        {/* No Cap */}\r\n                        <div className=\"flex items-center gap-2\">\r\n                          <Checkbox\r\n                            checked={agreementTerms.has_no_cap}\r\n                            onCheckedChange={(checked) => {\r\n                              updateAgreementTerms({\r\n                                has_no_cap: !!checked,\r\n                                performance_cap_percent: checked ? undefined : 20,\r\n                              });\r\n                            }}\r\n                            className=\"border-border\"\r\n                          />\r\n                          <span className=\"text-sm text-muted-foreground\">No Cap</span>\r\n                          {!agreementTerms.has_no_cap && (\r\n                            <div className=\"flex items-center gap-1 ml-2\">\r\n                              <Input\r\n                                type=\"number\"\r\n                                step=\"0.1\"\r\n                                min=\"0\"\r\n                                max=\"100\"\r\n                                value={agreementTerms.performance_cap_percent || ''}\r\n                                onChange={(e) => updateAgreementTerms({ performance_cap_percent: e.target.value ? Number(e.target.value) : undefined })}\r\n                                className=\"bg-muted/50 border-border text-foreground h-8 w-16\"\r\n                              />\r\n                              <span className=\"text-xs text-muted-foreground\">%</span>\r\n                            </div>\r\n                          )}\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                )}\r\n\r\n                {/* VAT */}\r\n                <div className=\"space-y-4\">\r\n                  <h4 className=\"text-sm font-medium text-foreground flex items-center gap-2\">\r\n                    <div className=\"w-2 h-2 rounded-full bg-amber-500\" />\r\n                    VAT Information\r\n                  </h4>\r\n                  <div className=\"pl-4\">\r\n                    <div className=\"space-y-2 max-w-xs\">\r\n                      <Label className=\"text-xs text-muted-foreground\">VAT Registration Number</Label>\r\n                      <Input\r\n                        value={agreementTerms.vat_number}\r\n                        onChange={(e) => updateAgreementTerms({ vat_number: e.target.value })}\r\n                        placeholder=\"e.g., GB123456789\"\r\n                        className=\"bg-muted/50 border-border text-foreground h-9\"\r\n                      />\r\n                      <p className=\"text-xs text-muted-foreground\">Leave blank if not VAT registered</p>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </CollapsibleSection>\r\n          )}\r\n        </div>\r\n\r\n        {/* Footer */}\r\n        <div className=\"px-10 py-6 border-t border-border bg-muted/60 flex items-center justify-between shrink-0\">\r\n          <div className=\"text-base text-muted-foreground\">\r\n            <span className=\"font-semibold text-foreground text-lg\">{components.length}</span> fee component{components.length !== 1 ? 's' : ''} defined\r\n            {validationErrors.length > 0 && (\r\n              <span className=\"text-red-500 dark:text-red-400 ml-4 inline-flex items-center gap-2\">\r\n                <AlertTriangle className=\"w-5 h-5\" />\r\n                {validationErrors.length} validation error{validationErrors.length !== 1 ? 's' : ''}\r\n              </span>\r\n            )}\r\n          </div>\r\n          <div className=\"flex items-center gap-5\">\r\n            <Button\r\n              type=\"button\"\r\n              variant=\"outline\"\r\n              onClick={onClose}\r\n              disabled={loading}\r\n              className=\"border-border text-foreground hover:bg-muted h-12 px-8 text-base font-medium\"\r\n            >\r\n              Cancel\r\n            </Button>\r\n            <Button\r\n              type=\"button\"\r\n              onClick={handleSave}\r\n              disabled={loading || !basicInfoComplete || validationErrors.length > 0}\r\n              className=\"bg-blue-600 hover:bg-blue-500 h-12 px-10 min-w-[180px] text-base font-semibold shadow-lg shadow-blue-500/20\"\r\n            >\r\n              {loading ? (\r\n                <>\r\n                  <Loader2 className=\"w-5 h-5 mr-2 animate-spin\" />\r\n                  Saving...\r\n                </>\r\n              ) : (\r\n                <>{isEditing ? 'Update Fee Plan' : 'Create Fee Plan'}</>\r\n              )}\r\n            </Button>\r\n          </div>\r\n        </div>\r\n      </DialogContent>\r\n    </Dialog>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}}]
}