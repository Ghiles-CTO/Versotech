{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/ghilesmoussaoui/Desktop/Versotech/versotech-portal/src/components/deals/deal-overview-tab.tsx"],"sourcesContent":["'use client'\r\n\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card'\r\nimport { Badge } from '@/components/ui/badge'\r\nimport {\r\n  CalendarDays,\r\n  TrendingUp,\r\n  DollarSign,\r\n  Building2\r\n} from 'lucide-react'\r\n\r\ninterface DealOverviewTabProps {\r\n  deal: any\r\n  memberships?: any[]\r\n  subscriptionsForJourney?: any[]\r\n}\r\n\r\nexport function DealOverviewTab({ deal, memberships = [], subscriptionsForJourney = [] }: DealOverviewTabProps) {\r\n  const progressPercent = deal.target_amount\r\n    ? Math.round((deal.raised_amount / deal.target_amount) * 100)\r\n    : 0\r\n\r\n  // Create subscription map for journey tracking\r\n  const subscriptionMap = new Map(\r\n    subscriptionsForJourney.map(s => [s.investor_id, s])\r\n  )\r\n\r\n  // Enhance memberships with subscription data\r\n  const enhancedMembers = memberships.map(m => ({\r\n    ...m,\r\n    subscription: m.investor_id ? subscriptionMap.get(m.investor_id) : null\r\n  }))\r\n\r\n  // Calculate journey stats\r\n  const journeyStats = {\r\n    total: enhancedMembers.length,\r\n    dispatched: enhancedMembers.filter(m => m.dispatched_at).length,\r\n    viewed: enhancedMembers.filter(m => m.viewed_at).length,\r\n    interested: enhancedMembers.filter(m => m.interest_confirmed_at).length,\r\n    ndaSigned: enhancedMembers.filter(m => m.nda_signed_at).length,\r\n    dataRoom: enhancedMembers.filter(m => m.data_room_granted_at).length,\r\n    packGen: enhancedMembers.filter(m => m.subscription?.pack_generated_at).length,\r\n    packSent: enhancedMembers.filter(m => m.subscription?.pack_sent_at).length,\r\n    signed: enhancedMembers.filter(m => m.subscription?.signed_at).length,\r\n    funded: enhancedMembers.filter(m => m.subscription?.funded_at).length,\r\n  }\r\n\r\n  const journeyStages = [\r\n    { label: 'Dispatched', count: journeyStats.dispatched },\r\n    { label: 'Viewed', count: journeyStats.viewed },\r\n    { label: 'Interested', count: journeyStats.interested },\r\n    { label: 'NDA', count: journeyStats.ndaSigned },\r\n    { label: 'Data Room', count: journeyStats.dataRoom },\r\n    { label: 'Pack Gen', count: journeyStats.packGen },\r\n    { label: 'Pack Sent', count: journeyStats.packSent },\r\n    { label: 'Signed', count: journeyStats.signed },\r\n    { label: 'Funded', count: journeyStats.funded },\r\n  ]\r\n\r\n  // Calculate conversion from previous stage\r\n  const getConversion = (idx: number) => {\r\n    if (idx === 0) return journeyStats.total > 0 ? Math.round((journeyStages[0].count / journeyStats.total) * 100) : 0\r\n    const prev = journeyStages[idx - 1].count\r\n    if (prev === 0) return 0\r\n    return Math.round((journeyStages[idx].count / prev) * 100)\r\n  }\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      {/* Investor Journey Pipeline - Minimalist Design */}\r\n      {memberships.length > 0 && (\r\n        <Card className=\"border border-border bg-muted/30 overflow-hidden\">\r\n          <CardHeader className=\"pb-2 pt-4 px-6\">\r\n            <div className=\"flex items-center justify-between\">\r\n              <CardTitle className=\"text-sm font-medium text-muted-foreground tracking-wide uppercase\">\r\n                Investor Pipeline\r\n              </CardTitle>\r\n              <span className=\"text-xs text-muted-foreground\">\r\n                {journeyStats.total} total\r\n              </span>\r\n            </div>\r\n          </CardHeader>\r\n          <CardContent className=\"px-6 pb-5\">\r\n            {/* Pipeline visualization */}\r\n            <div className=\"relative pt-2\">\r\n              {/* Connecting line */}\r\n              <div className=\"absolute top-[26px] left-5 right-5 h-[2px] bg-gradient-to-r from-emerald-500/20 via-emerald-500/10 to-transparent\" />\r\n\r\n              {/* Stage nodes */}\r\n              <div className=\"relative flex items-start justify-between\">\r\n                {journeyStages.map((stage, idx) => {\r\n                  const isActive = stage.count > 0\r\n                  const isFinal = stage.label === 'Funded'\r\n                  const conversion = getConversion(idx)\r\n\r\n                  return (\r\n                    <div\r\n                      key={stage.label}\r\n                      className=\"flex flex-col items-center group\"\r\n                      style={{ flex: '1 1 0' }}\r\n                    >\r\n                      {/* Node circle */}\r\n                      <div\r\n                        className={`\r\n                          relative z-10 w-11 h-11 rounded-full flex items-center justify-center\r\n                          text-sm font-semibold transition-all duration-300 cursor-default\r\n                          ${isActive\r\n                            ? isFinal\r\n                              ? 'bg-emerald-500/25 text-emerald-300 ring-2 ring-emerald-500/40 shadow-[0_0_20px_rgba(16,185,129,0.15)]'\r\n                              : 'bg-emerald-500/15 text-emerald-400 ring-1 ring-emerald-500/25'\r\n                            : 'bg-muted text-muted-foreground/60'\r\n                          }\r\n                          group-hover:scale-110 group-hover:ring-emerald-400/40\r\n                        `}\r\n                      >\r\n                        {stage.count}\r\n                      </div>\r\n\r\n                      {/* Label */}\r\n                      <span className={`\r\n                        text-[10px] mt-2 text-center leading-tight transition-colors\r\n                        ${isActive ? 'text-foreground/70' : 'text-muted-foreground/50'}\r\n                        group-hover:text-foreground\r\n                      `}>\r\n                        {stage.label}\r\n                      </span>\r\n\r\n                      {/* Conversion rate tooltip on hover */}\r\n                      {idx > 0 && (\r\n                        <span className={`\r\n                          text-[9px] mt-0.5 transition-opacity\r\n                          ${stage.count > 0 ? 'text-emerald-400/60' : 'text-muted-foreground/30'}\r\n                        `}>\r\n                          {conversion}%\r\n                        </span>\r\n                      )}\r\n                    </div>\r\n                  )\r\n                })}\r\n              </div>\r\n            </div>\r\n\r\n            {/* Summary stats row */}\r\n            <div className=\"flex items-center justify-center gap-8 mt-6 pt-4 border-t border-border\">\r\n              <div className=\"text-center\">\r\n                <div className=\"text-lg font-semibold text-foreground\">{journeyStats.funded}</div>\r\n                <div className=\"text-[10px] text-muted-foreground uppercase tracking-wider\">Funded</div>\r\n              </div>\r\n              <div className=\"w-px h-8 bg-muted\" />\r\n              <div className=\"text-center\">\r\n                <div className=\"text-lg font-semibold text-foreground\">\r\n                  {journeyStats.total > 0 ? Math.round((journeyStats.funded / journeyStats.total) * 100) : 0}%\r\n                </div>\r\n                <div className=\"text-[10px] text-muted-foreground uppercase tracking-wider\">Conversion</div>\r\n              </div>\r\n              <div className=\"w-px h-8 bg-muted\" />\r\n              <div className=\"text-center\">\r\n                <div className=\"text-lg font-semibold text-foreground\">{journeyStats.signed}</div>\r\n                <div className=\"text-[10px] text-muted-foreground uppercase tracking-wider\">Signed</div>\r\n              </div>\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n      )}\r\n\r\n      {/* Deal Information */}\r\n      <Card className=\"border border-border bg-muted/50\">\r\n        <CardHeader>\r\n          <CardTitle className=\"text-foreground\">Deal Information</CardTitle>\r\n          <CardDescription>Core details and structure</CardDescription>\r\n        </CardHeader>\r\n        <CardContent className=\"space-y-4\">\r\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\r\n            <div>\r\n              <label className=\"text-sm font-medium text-muted-foreground\">Deal Name</label>\r\n              <p className=\"text-lg text-foreground mt-1\">{deal.name}</p>\r\n            </div>\r\n\r\n            <div>\r\n              <label className=\"text-sm font-medium text-muted-foreground\">Company</label>\r\n              <p className=\"text-lg text-foreground mt-1\">{deal.company_name || '—'}</p>\r\n            </div>\r\n\r\n            <div>\r\n              <label className=\"text-sm font-medium text-muted-foreground\">Vehicle</label>\r\n              <div className=\"flex items-center gap-2 mt-1\">\r\n                {deal.vehicles ? (\r\n                  <>\r\n                    <Building2 className=\"h-4 w-4 text-muted-foreground\" />\r\n                    <span className=\"text-foreground\">{deal.vehicles.name}</span>\r\n                    <Badge variant=\"outline\" className=\"border-border\">\r\n                      {deal.vehicles.type}\r\n                    </Badge>\r\n                  </>\r\n                ) : (\r\n                  <span className=\"text-muted-foreground\">No vehicle assigned</span>\r\n                )}\r\n              </div>\r\n            </div>\r\n\r\n            <div>\r\n              <label className=\"text-sm font-medium text-muted-foreground\">Arranger</label>\r\n              <div className=\"flex items-center gap-2 mt-1\">\r\n                {deal.arranger_entities ? (\r\n                  <>\r\n                    <Building2 className=\"h-4 w-4 text-amber-500\" />\r\n                    <span className=\"text-foreground\">\r\n                      {deal.arranger_entities.company_name || deal.arranger_entities.legal_name}\r\n                    </span>\r\n                    <Badge variant=\"outline\" className=\"border-amber-500/30 text-amber-400 bg-amber-500/10\">\r\n                      Mandate\r\n                    </Badge>\r\n                  </>\r\n                ) : (\r\n                  <span className=\"text-muted-foreground\">No arranger assigned</span>\r\n                )}\r\n              </div>\r\n            </div>\r\n\r\n            <div>\r\n              <label className=\"text-sm font-medium text-muted-foreground\">Sector / Stage</label>\r\n              <p className=\"text-foreground mt-1\">\r\n                {deal.sector || '—'} {deal.stage && `• ${deal.stage}`}\r\n              </p>\r\n            </div>\r\n\r\n            <div>\r\n              <label className=\"text-sm font-medium text-muted-foreground\">Location</label>\r\n              <p className=\"text-foreground mt-1\">{deal.location || '—'}</p>\r\n            </div>\r\n\r\n            <div>\r\n              <label className=\"text-sm font-medium text-muted-foreground\">Currency</label>\r\n              <p className=\"text-foreground mt-1\">{deal.currency}</p>\r\n            </div>\r\n          </div>\r\n        </CardContent>\r\n      </Card>\r\n\r\n      {/* Financial Details */}\r\n      <Card className=\"border border-border bg-muted/50\">\r\n        <CardHeader>\r\n          <CardTitle className=\"text-foreground flex items-center gap-2\">\r\n            <DollarSign className=\"h-5 w-5\" />\r\n            Fundraising Progress\r\n          </CardTitle>\r\n          <CardDescription>Target and raised amounts. Investment terms (price, min/max) are defined in the Term Sheet.</CardDescription>\r\n        </CardHeader>\r\n        <CardContent className=\"space-y-6\">\r\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\r\n            <div>\r\n              <label className=\"text-sm font-medium text-muted-foreground\">Target Amount</label>\r\n              <p className=\"text-2xl font-bold text-foreground mt-1\">\r\n                {deal.currency} {deal.target_amount?.toLocaleString() || '—'}\r\n              </p>\r\n            </div>\r\n\r\n            <div>\r\n              <label className=\"text-sm font-medium text-muted-foreground\">Raised Amount</label>\r\n              <p className=\"text-2xl font-bold text-emerald-400 mt-1\">\r\n                {deal.currency} {deal.raised_amount?.toLocaleString() || 0}\r\n              </p>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Progress Bar */}\r\n          {deal.target_amount > 0 && (\r\n            <div className=\"space-y-2\">\r\n              <div className=\"flex items-center justify-between text-sm\">\r\n                <span className=\"text-muted-foreground\">Progress</span>\r\n                <span className=\"font-medium text-foreground\">\r\n                  {progressPercent}% of target\r\n                </span>\r\n              </div>\r\n              <div className=\"h-2 bg-muted rounded-full overflow-hidden\">\r\n                <div\r\n                  className=\"h-full bg-emerald-500 transition-all duration-300\"\r\n                  style={{ width: `${Math.min(progressPercent, 100)}%` }}\r\n                />\r\n              </div>\r\n            </div>\r\n          )}\r\n        </CardContent>\r\n      </Card>\r\n\r\n      {/* Timeline */}\r\n      <Card className=\"border border-border bg-muted/50\">\r\n        <CardHeader>\r\n          <CardTitle className=\"text-foreground flex items-center gap-2\">\r\n            <CalendarDays className=\"h-5 w-5\" />\r\n            Timeline\r\n          </CardTitle>\r\n          <CardDescription>Important dates and deadlines</CardDescription>\r\n        </CardHeader>\r\n        <CardContent>\r\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\r\n            <div>\r\n              <label className=\"text-sm font-medium text-muted-foreground\">Open Date</label>\r\n              <p className=\"text-foreground mt-1\">\r\n                {deal.open_at ? new Date(deal.open_at).toLocaleDateString('en-US', {\r\n                  year: 'numeric',\r\n                  month: 'long',\r\n                  day: 'numeric'\r\n                }) : '—'}\r\n              </p>\r\n            </div>\r\n\r\n            <div>\r\n              <label className=\"text-sm font-medium text-muted-foreground\">Close Date</label>\r\n              <p className=\"text-foreground mt-1\">\r\n                {deal.close_at ? new Date(deal.close_at).toLocaleDateString('en-US', {\r\n                  year: 'numeric',\r\n                  month: 'long',\r\n                  day: 'numeric'\r\n                }) : '—'}\r\n              </p>\r\n            </div>\r\n\r\n            <div>\r\n              <label className=\"text-sm font-medium text-muted-foreground\">Created</label>\r\n              <p className=\"text-foreground mt-1\">\r\n                {new Date(deal.created_at).toLocaleDateString('en-US', {\r\n                  year: 'numeric',\r\n                  month: 'long',\r\n                  day: 'numeric'\r\n                })}\r\n              </p>\r\n            </div>\r\n\r\n            {deal.close_at && new Date(deal.close_at) > new Date() && (\r\n              <div>\r\n                <label className=\"text-sm font-medium text-muted-foreground\">Days Remaining</label>\r\n                <p className=\"text-2xl font-bold text-emerald-200 mt-1\">\r\n                  {Math.ceil((new Date(deal.close_at).getTime() - new Date().getTime()) / (1000 * 60 * 60 * 24))}\r\n                </p>\r\n              </div>\r\n            )}\r\n          </div>\r\n        </CardContent>\r\n      </Card>\r\n\r\n      {/* Description & Thesis */}\r\n      {(deal.description || deal.investment_thesis) && (\r\n        <Card className=\"border border-border bg-muted/50\">\r\n          <CardHeader>\r\n            <CardTitle className=\"text-foreground flex items-center gap-2\">\r\n              <TrendingUp className=\"h-5 w-5\" />\r\n              Deal Overview\r\n            </CardTitle>\r\n          </CardHeader>\r\n          <CardContent className=\"space-y-4\">\r\n            {deal.description && (\r\n              <div>\r\n                <label className=\"text-sm font-medium text-muted-foreground\">Description</label>\r\n                <p className=\"text-foreground mt-2 whitespace-pre-wrap\">{deal.description}</p>\r\n              </div>\r\n            )}\r\n\r\n            {deal.investment_thesis && (\r\n              <div>\r\n                <label className=\"text-sm font-medium text-muted-foreground\">Investment Thesis</label>\r\n                <p className=\"text-foreground mt-2 whitespace-pre-wrap\">{deal.investment_thesis}</p>\r\n              </div>\r\n            )}\r\n          </CardContent>\r\n        </Card>\r\n      )}\r\n    </div>\r\n  )\r\n}\r\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AAAA;AAAA;AAAA;AAJA;;;;;AAiBO,SAAS,gBAAgB,EAAE,IAAI,EAAE,cAAc,EAAE,EAAE,0BAA0B,EAAE,EAAwB;IAC5G,MAAM,kBAAkB,KAAK,aAAa,GACtC,KAAK,KAAK,CAAC,AAAC,KAAK,aAAa,GAAG,KAAK,aAAa,GAAI,OACvD;IAEJ,+CAA+C;IAC/C,MAAM,kBAAkB,IAAI,IAC1B,wBAAwB,GAAG,CAAC,CAAA,IAAK;YAAC,EAAE,WAAW;YAAE;SAAE;IAGrD,6CAA6C;IAC7C,MAAM,kBAAkB,YAAY,GAAG,CAAC,CAAA,IAAK,CAAC;YAC5C,GAAG,CAAC;YACJ,cAAc,EAAE,WAAW,GAAG,gBAAgB,GAAG,CAAC,EAAE,WAAW,IAAI;QACrE,CAAC;IAED,0BAA0B;IAC1B,MAAM,eAAe;QACnB,OAAO,gBAAgB,MAAM;QAC7B,YAAY,gBAAgB,MAAM,CAAC,CAAA,IAAK,EAAE,aAAa,EAAE,MAAM;QAC/D,QAAQ,gBAAgB,MAAM,CAAC,CAAA,IAAK,EAAE,SAAS,EAAE,MAAM;QACvD,YAAY,gBAAgB,MAAM,CAAC,CAAA,IAAK,EAAE,qBAAqB,EAAE,MAAM;QACvE,WAAW,gBAAgB,MAAM,CAAC,CAAA,IAAK,EAAE,aAAa,EAAE,MAAM;QAC9D,UAAU,gBAAgB,MAAM,CAAC,CAAA,IAAK,EAAE,oBAAoB,EAAE,MAAM;QACpE,SAAS,gBAAgB,MAAM,CAAC,CAAA,IAAK,EAAE,YAAY,EAAE,mBAAmB,MAAM;QAC9E,UAAU,gBAAgB,MAAM,CAAC,CAAA,IAAK,EAAE,YAAY,EAAE,cAAc,MAAM;QAC1E,QAAQ,gBAAgB,MAAM,CAAC,CAAA,IAAK,EAAE,YAAY,EAAE,WAAW,MAAM;QACrE,QAAQ,gBAAgB,MAAM,CAAC,CAAA,IAAK,EAAE,YAAY,EAAE,WAAW,MAAM;IACvE;IAEA,MAAM,gBAAgB;QACpB;YAAE,OAAO;YAAc,OAAO,aAAa,UAAU;QAAC;QACtD;YAAE,OAAO;YAAU,OAAO,aAAa,MAAM;QAAC;QAC9C;YAAE,OAAO;YAAc,OAAO,aAAa,UAAU;QAAC;QACtD;YAAE,OAAO;YAAO,OAAO,aAAa,SAAS;QAAC;QAC9C;YAAE,OAAO;YAAa,OAAO,aAAa,QAAQ;QAAC;QACnD;YAAE,OAAO;YAAY,OAAO,aAAa,OAAO;QAAC;QACjD;YAAE,OAAO;YAAa,OAAO,aAAa,QAAQ;QAAC;QACnD;YAAE,OAAO;YAAU,OAAO,aAAa,MAAM;QAAC;QAC9C;YAAE,OAAO;YAAU,OAAO,aAAa,MAAM;QAAC;KAC/C;IAED,2CAA2C;IAC3C,MAAM,gBAAgB,CAAC;QACrB,IAAI,QAAQ,GAAG,OAAO,aAAa,KAAK,GAAG,IAAI,KAAK,KAAK,CAAC,AAAC,aAAa,CAAC,EAAE,CAAC,KAAK,GAAG,aAAa,KAAK,GAAI,OAAO;QACjH,MAAM,OAAO,aAAa,CAAC,MAAM,EAAE,CAAC,KAAK;QACzC,IAAI,SAAS,GAAG,OAAO;QACvB,OAAO,KAAK,KAAK,CAAC,AAAC,aAAa,CAAC,IAAI,CAAC,KAAK,GAAG,OAAQ;IACxD;IAEA,qBACE,oNAAC;QAAI,WAAU;;YAEZ,YAAY,MAAM,GAAG,mBACpB,oNAAC,kKAAI;gBAAC,WAAU;;kCACd,oNAAC,wKAAU;wBAAC,WAAU;kCACpB,cAAA,oNAAC;4BAAI,WAAU;;8CACb,oNAAC,uKAAS;oCAAC,WAAU;8CAAoE;;;;;;8CAGzF,oNAAC;oCAAK,WAAU;;wCACb,aAAa,KAAK;wCAAC;;;;;;;;;;;;;;;;;;kCAI1B,oNAAC,yKAAW;wBAAC,WAAU;;0CAErB,oNAAC;gCAAI,WAAU;;kDAEb,oNAAC;wCAAI,WAAU;;;;;;kDAGf,oNAAC;wCAAI,WAAU;kDACZ,cAAc,GAAG,CAAC,CAAC,OAAO;4CACzB,MAAM,WAAW,MAAM,KAAK,GAAG;4CAC/B,MAAM,UAAU,MAAM,KAAK,KAAK;4CAChC,MAAM,aAAa,cAAc;4CAEjC,qBACE,oNAAC;gDAEC,WAAU;gDACV,OAAO;oDAAE,MAAM;gDAAQ;;kEAGvB,oNAAC;wDACC,WAAW,CAAC;;;0BAGV,EAAE,WACE,UACE,0GACA,kEACF,oCACH;;wBAEH,CAAC;kEAEA,MAAM,KAAK;;;;;;kEAId,oNAAC;wDAAK,WAAW,CAAC;;wBAEhB,EAAE,WAAW,uBAAuB,2BAA2B;;sBAEjE,CAAC;kEACE,MAAM,KAAK;;;;;;oDAIb,MAAM,mBACL,oNAAC;wDAAK,WAAW,CAAC;;0BAEhB,EAAE,MAAM,KAAK,GAAG,IAAI,wBAAwB,2BAA2B;wBACzE,CAAC;;4DACE;4DAAW;;;;;;;;+CApCX,MAAM,KAAK;;;;;wCAyCtB;;;;;;;;;;;;0CAKJ,oNAAC;gCAAI,WAAU;;kDACb,oNAAC;wCAAI,WAAU;;0DACb,oNAAC;gDAAI,WAAU;0DAAyC,aAAa,MAAM;;;;;;0DAC3E,oNAAC;gDAAI,WAAU;0DAA6D;;;;;;;;;;;;kDAE9E,oNAAC;wCAAI,WAAU;;;;;;kDACf,oNAAC;wCAAI,WAAU;;0DACb,oNAAC;gDAAI,WAAU;;oDACZ,aAAa,KAAK,GAAG,IAAI,KAAK,KAAK,CAAC,AAAC,aAAa,MAAM,GAAG,aAAa,KAAK,GAAI,OAAO;oDAAE;;;;;;;0DAE7F,oNAAC;gDAAI,WAAU;0DAA6D;;;;;;;;;;;;kDAE9E,oNAAC;wCAAI,WAAU;;;;;;kDACf,oNAAC;wCAAI,WAAU;;0DACb,oNAAC;gDAAI,WAAU;0DAAyC,aAAa,MAAM;;;;;;0DAC3E,oNAAC;gDAAI,WAAU;0DAA6D;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;0BAQtF,oNAAC,kKAAI;gBAAC,WAAU;;kCACd,oNAAC,wKAAU;;0CACT,oNAAC,uKAAS;gCAAC,WAAU;0CAAkB;;;;;;0CACvC,oNAAC,6KAAe;0CAAC;;;;;;;;;;;;kCAEnB,oNAAC,yKAAW;wBAAC,WAAU;kCACrB,cAAA,oNAAC;4BAAI,WAAU;;8CACb,oNAAC;;sDACC,oNAAC;4CAAM,WAAU;sDAA4C;;;;;;sDAC7D,oNAAC;4CAAE,WAAU;sDAAgC,KAAK,IAAI;;;;;;;;;;;;8CAGxD,oNAAC;;sDACC,oNAAC;4CAAM,WAAU;sDAA4C;;;;;;sDAC7D,oNAAC;4CAAE,WAAU;sDAAgC,KAAK,YAAY,IAAI;;;;;;;;;;;;8CAGpE,oNAAC;;sDACC,oNAAC;4CAAM,WAAU;sDAA4C;;;;;;sDAC7D,oNAAC;4CAAI,WAAU;sDACZ,KAAK,QAAQ,iBACZ;;kEACE,oNAAC,uPAAS;wDAAC,WAAU;;;;;;kEACrB,oNAAC;wDAAK,WAAU;kEAAmB,KAAK,QAAQ,CAAC,IAAI;;;;;;kEACrD,oNAAC,oKAAK;wDAAC,SAAQ;wDAAU,WAAU;kEAChC,KAAK,QAAQ,CAAC,IAAI;;;;;;;6EAIvB,oNAAC;gDAAK,WAAU;0DAAwB;;;;;;;;;;;;;;;;;8CAK9C,oNAAC;;sDACC,oNAAC;4CAAM,WAAU;sDAA4C;;;;;;sDAC7D,oNAAC;4CAAI,WAAU;sDACZ,KAAK,iBAAiB,iBACrB;;kEACE,oNAAC,uPAAS;wDAAC,WAAU;;;;;;kEACrB,oNAAC;wDAAK,WAAU;kEACb,KAAK,iBAAiB,CAAC,YAAY,IAAI,KAAK,iBAAiB,CAAC,UAAU;;;;;;kEAE3E,oNAAC,oKAAK;wDAAC,SAAQ;wDAAU,WAAU;kEAAqD;;;;;;;6EAK1F,oNAAC;gDAAK,WAAU;0DAAwB;;;;;;;;;;;;;;;;;8CAK9C,oNAAC;;sDACC,oNAAC;4CAAM,WAAU;sDAA4C;;;;;;sDAC7D,oNAAC;4CAAE,WAAU;;gDACV,KAAK,MAAM,IAAI;gDAAI;gDAAE,KAAK,KAAK,IAAI,CAAC,EAAE,EAAE,KAAK,KAAK,EAAE;;;;;;;;;;;;;8CAIzD,oNAAC;;sDACC,oNAAC;4CAAM,WAAU;sDAA4C;;;;;;sDAC7D,oNAAC;4CAAE,WAAU;sDAAwB,KAAK,QAAQ,IAAI;;;;;;;;;;;;8CAGxD,oNAAC;;sDACC,oNAAC;4CAAM,WAAU;sDAA4C;;;;;;sDAC7D,oNAAC;4CAAE,WAAU;sDAAwB,KAAK,QAAQ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;0BAO1D,oNAAC,kKAAI;gBAAC,WAAU;;kCACd,oNAAC,wKAAU;;0CACT,oNAAC,uKAAS;gCAAC,WAAU;;kDACnB,oNAAC,0PAAU;wCAAC,WAAU;;;;;;oCAAY;;;;;;;0CAGpC,oNAAC,6KAAe;0CAAC;;;;;;;;;;;;kCAEnB,oNAAC,yKAAW;wBAAC,WAAU;;0CACrB,oNAAC;gCAAI,WAAU;;kDACb,oNAAC;;0DACC,oNAAC;gDAAM,WAAU;0DAA4C;;;;;;0DAC7D,oNAAC;gDAAE,WAAU;;oDACV,KAAK,QAAQ;oDAAC;oDAAE,KAAK,aAAa,EAAE,oBAAoB;;;;;;;;;;;;;kDAI7D,oNAAC;;0DACC,oNAAC;gDAAM,WAAU;0DAA4C;;;;;;0DAC7D,oNAAC;gDAAE,WAAU;;oDACV,KAAK,QAAQ;oDAAC;oDAAE,KAAK,aAAa,EAAE,oBAAoB;;;;;;;;;;;;;;;;;;;4BAM9D,KAAK,aAAa,GAAG,mBACpB,oNAAC;gCAAI,WAAU;;kDACb,oNAAC;wCAAI,WAAU;;0DACb,oNAAC;gDAAK,WAAU;0DAAwB;;;;;;0DACxC,oNAAC;gDAAK,WAAU;;oDACb;oDAAgB;;;;;;;;;;;;;kDAGrB,oNAAC;wCAAI,WAAU;kDACb,cAAA,oNAAC;4CACC,WAAU;4CACV,OAAO;gDAAE,OAAO,GAAG,KAAK,GAAG,CAAC,iBAAiB,KAAK,CAAC,CAAC;4CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;0BASjE,oNAAC,kKAAI;gBAAC,WAAU;;kCACd,oNAAC,wKAAU;;0CACT,oNAAC,uKAAS;gCAAC,WAAU;;kDACnB,oNAAC,gQAAY;wCAAC,WAAU;;;;;;oCAAY;;;;;;;0CAGtC,oNAAC,6KAAe;0CAAC;;;;;;;;;;;;kCAEnB,oNAAC,yKAAW;kCACV,cAAA,oNAAC;4BAAI,WAAU;;8CACb,oNAAC;;sDACC,oNAAC;4CAAM,WAAU;sDAA4C;;;;;;sDAC7D,oNAAC;4CAAE,WAAU;sDACV,KAAK,OAAO,GAAG,IAAI,KAAK,KAAK,OAAO,EAAE,kBAAkB,CAAC,SAAS;gDACjE,MAAM;gDACN,OAAO;gDACP,KAAK;4CACP,KAAK;;;;;;;;;;;;8CAIT,oNAAC;;sDACC,oNAAC;4CAAM,WAAU;sDAA4C;;;;;;sDAC7D,oNAAC;4CAAE,WAAU;sDACV,KAAK,QAAQ,GAAG,IAAI,KAAK,KAAK,QAAQ,EAAE,kBAAkB,CAAC,SAAS;gDACnE,MAAM;gDACN,OAAO;gDACP,KAAK;4CACP,KAAK;;;;;;;;;;;;8CAIT,oNAAC;;sDACC,oNAAC;4CAAM,WAAU;sDAA4C;;;;;;sDAC7D,oNAAC;4CAAE,WAAU;sDACV,IAAI,KAAK,KAAK,UAAU,EAAE,kBAAkB,CAAC,SAAS;gDACrD,MAAM;gDACN,OAAO;gDACP,KAAK;4CACP;;;;;;;;;;;;gCAIH,KAAK,QAAQ,IAAI,IAAI,KAAK,KAAK,QAAQ,IAAI,IAAI,wBAC9C,oNAAC;;sDACC,oNAAC;4CAAM,WAAU;sDAA4C;;;;;;sDAC7D,oNAAC;4CAAE,WAAU;sDACV,KAAK,IAAI,CAAC,CAAC,IAAI,KAAK,KAAK,QAAQ,EAAE,OAAO,KAAK,IAAI,OAAO,OAAO,EAAE,IAAI,CAAC,OAAO,KAAK,KAAK,EAAE;;;;;;;;;;;;;;;;;;;;;;;;;;;;;YASvG,CAAC,KAAK,WAAW,IAAI,KAAK,iBAAiB,mBAC1C,oNAAC,kKAAI;gBAAC,WAAU;;kCACd,oNAAC,wKAAU;kCACT,cAAA,oNAAC,uKAAS;4BAAC,WAAU;;8CACnB,oNAAC,0PAAU;oCAAC,WAAU;;;;;;gCAAY;;;;;;;;;;;;kCAItC,oNAAC,yKAAW;wBAAC,WAAU;;4BACpB,KAAK,WAAW,kBACf,oNAAC;;kDACC,oNAAC;wCAAM,WAAU;kDAA4C;;;;;;kDAC7D,oNAAC;wCAAE,WAAU;kDAA4C,KAAK,WAAW;;;;;;;;;;;;4BAI5E,KAAK,iBAAiB,kBACrB,oNAAC;;kDACC,oNAAC;wCAAM,WAAU;kDAA4C;;;;;;kDAC7D,oNAAC;wCAAE,WAAU;kDAA4C,KAAK,iBAAiB;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAQ/F;KAhWgB"}},
    {"offset": {"line": 1053, "column": 0}, "map": {"version":3,"sources":["file:///Users/ghilesmoussaoui/Desktop/Versotech/versotech-portal/src/components/deals/add-share-lot-modal.tsx"],"sourcesContent":["'use client'\r\n\r\nimport { useState } from 'react'\r\nimport { Dialog, DialogContent, DialogDescription, DialogHeader, DialogTitle, DialogTrigger } from '@/components/ui/dialog'\r\nimport { Button } from '@/components/ui/button'\r\nimport { Input } from '@/components/ui/input'\r\nimport { Label } from '@/components/ui/label'\r\nimport { Textarea } from '@/components/ui/textarea'\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select'\r\nimport { Plus, Loader2 } from 'lucide-react'\r\nimport { useRouter } from 'next/navigation'\r\n\r\ninterface AddShareLotModalProps {\r\n  dealId: string\r\n  onSuccess?: () => void\r\n}\r\n\r\nexport function AddShareLotModal({ dealId, onSuccess }: AddShareLotModalProps) {\r\n  const router = useRouter()\r\n  const [open, setOpen] = useState(false)\r\n  const [loading, setLoading] = useState(false)\r\n  const [error, setError] = useState<string | null>(null)\r\n\r\n  const [formData, setFormData] = useState({\r\n    source_type: 'company',\r\n    counterparty_name: '',\r\n    units_total: '',\r\n    unit_cost: '',\r\n    currency: 'USD',\r\n    acquired_at: '',\r\n    lockup_until: '',\r\n    notes: ''\r\n  })\r\n\r\n  const updateField = (field: string, value: string) => {\r\n    setFormData(prev => ({ ...prev, [field]: value }))\r\n  }\r\n\r\n  const handleSubmit = async () => {\r\n    if (!formData.units_total || !formData.unit_cost) {\r\n      setError('Units and cost are required')\r\n      return\r\n    }\r\n\r\n    setLoading(true)\r\n    setError(null)\r\n\r\n    try {\r\n      const response = await fetch(`/api/deals/${dealId}/inventory`, {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({\r\n          source_type: formData.source_type,\r\n          counterparty_name: formData.counterparty_name,\r\n          units_total: parseFloat(formData.units_total),\r\n          unit_cost: parseFloat(formData.unit_cost),\r\n          currency: formData.currency,\r\n          acquired_at: formData.acquired_at || null,\r\n          lockup_until: formData.lockup_until || null,\r\n          notes: formData.notes || null\r\n        })\r\n      })\r\n\r\n      if (!response.ok) {\r\n        const data = await response.json()\r\n        throw new Error(data.error || 'Failed to add share lot')\r\n      }\r\n\r\n      // Reset form and close modal\r\n      setFormData({\r\n        source_type: 'company',\r\n        counterparty_name: '',\r\n        units_total: '',\r\n        unit_cost: '',\r\n        currency: 'USD',\r\n        acquired_at: '',\r\n        lockup_until: '',\r\n        notes: ''\r\n      })\r\n      setOpen(false)\r\n\r\n      // Trigger callback to refresh parent component\r\n      if (onSuccess) {\r\n        onSuccess()\r\n      }\r\n\r\n      router.refresh()\r\n    } catch (err: any) {\r\n      setError(err.message)\r\n    } finally {\r\n      setLoading(false)\r\n    }\r\n  }\r\n\r\n  return (\r\n    <Dialog open={open} onOpenChange={setOpen}>\r\n      <DialogTrigger asChild>\r\n        <Button className=\"gap-2\">\r\n          <Plus className=\"h-4 w-4\" />\r\n          Add Share Lot\r\n        </Button>\r\n      </DialogTrigger>\r\n      <DialogContent className=\"max-w-2xl max-h-[90vh] overflow-y-auto\">\r\n        <DialogHeader>\r\n          <DialogTitle>Add Share Lot</DialogTitle>\r\n          <DialogDescription>\r\n            Add inventory to this deal from a share source\r\n          </DialogDescription>\r\n        </DialogHeader>\r\n\r\n        <div className=\"space-y-4\">\r\n          <div className=\"grid grid-cols-2 gap-4\">\r\n            <div className=\"space-y-2\">\r\n              <Label htmlFor=\"source_type\">Source Type *</Label>\r\n              <Select value={formData.source_type} onValueChange={(v) => updateField('source_type', v)}>\r\n                <SelectTrigger>\r\n                  <SelectValue />\r\n                </SelectTrigger>\r\n                <SelectContent>\r\n                  <SelectItem value=\"company\">Company</SelectItem>\r\n                  <SelectItem value=\"fund\">Fund</SelectItem>\r\n                  <SelectItem value=\"colleague\">Colleague</SelectItem>\r\n                  <SelectItem value=\"other\">Other</SelectItem>\r\n                </SelectContent>\r\n              </Select>\r\n            </div>\r\n\r\n            <div className=\"space-y-2\">\r\n              <Label htmlFor=\"counterparty_name\">Counterparty Name</Label>\r\n              <Input\r\n                id=\"counterparty_name\"\r\n                placeholder=\"e.g., Former Employee\"\r\n                value={formData.counterparty_name}\r\n                onChange={(e) => updateField('counterparty_name', e.target.value)}\r\n              />\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"grid grid-cols-2 gap-4\">\r\n            <div className=\"space-y-2\">\r\n              <Label htmlFor=\"units_total\">Total Units *</Label>\r\n              <Input\r\n                id=\"units_total\"\r\n                type=\"number\"\r\n                step=\"0.00000001\"\r\n                placeholder=\"50000\"\r\n                value={formData.units_total}\r\n                onChange={(e) => updateField('units_total', e.target.value)}\r\n                required\r\n              />\r\n            </div>\r\n\r\n            <div className=\"space-y-2\">\r\n              <Label htmlFor=\"unit_cost\">Unit Cost *</Label>\r\n              <Input\r\n                id=\"unit_cost\"\r\n                type=\"number\"\r\n                step=\"0.000001\"\r\n                placeholder=\"120.00\"\r\n                value={formData.unit_cost}\r\n                onChange={(e) => updateField('unit_cost', e.target.value)}\r\n                required\r\n              />\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"grid grid-cols-3 gap-4\">\r\n            <div className=\"space-y-2\">\r\n              <Label htmlFor=\"currency\">Currency</Label>\r\n              <Select value={formData.currency} onValueChange={(v) => updateField('currency', v)}>\r\n                <SelectTrigger>\r\n                  <SelectValue />\r\n                </SelectTrigger>\r\n                <SelectContent>\r\n                  <SelectItem value=\"USD\">USD</SelectItem>\r\n                  <SelectItem value=\"EUR\">EUR</SelectItem>\r\n                  <SelectItem value=\"GBP\">GBP</SelectItem>\r\n                </SelectContent>\r\n              </Select>\r\n            </div>\r\n\r\n            <div className=\"space-y-2\">\r\n              <Label htmlFor=\"acquired_at\">Acquired Date</Label>\r\n              <Input\r\n                id=\"acquired_at\"\r\n                type=\"date\"\r\n                value={formData.acquired_at}\r\n                onChange={(e) => updateField('acquired_at', e.target.value)}\r\n              />\r\n            </div>\r\n\r\n            <div className=\"space-y-2\">\r\n              <Label htmlFor=\"lockup_until\">Lockup Until</Label>\r\n              <Input\r\n                id=\"lockup_until\"\r\n                type=\"date\"\r\n                value={formData.lockup_until}\r\n                onChange={(e) => updateField('lockup_until', e.target.value)}\r\n              />\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"space-y-2\">\r\n            <Label htmlFor=\"notes\">Notes</Label>\r\n            <Textarea\r\n              id=\"notes\"\r\n              placeholder=\"Additional information about this share lot...\"\r\n              rows={3}\r\n              value={formData.notes}\r\n              onChange={(e) => updateField('notes', e.target.value)}\r\n            />\r\n          </div>\r\n\r\n          {error && (\r\n            <div className=\"p-3 rounded-lg bg-red-500/20 border border-red-400/30 text-red-200 text-sm\">\r\n              {error}\r\n            </div>\r\n          )}\r\n\r\n          <div className=\"flex justify-end gap-2 pt-4\">\r\n            <Button variant=\"outline\" onClick={() => setOpen(false)} disabled={loading}>\r\n              Cancel\r\n            </Button>\r\n            <Button onClick={handleSubmit} disabled={loading}>\r\n              {loading ? (\r\n                <>\r\n                  <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\r\n                  Adding...\r\n                </>\r\n              ) : (\r\n                'Add Share Lot'\r\n              )}\r\n            </Button>\r\n          </div>\r\n        </div>\r\n      </DialogContent>\r\n    </Dialog>\r\n  )\r\n}\r\n\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1634, "column": 0}, "map": {"version":3,"sources":["file:///Users/ghilesmoussaoui/Desktop/Versotech/versotech-portal/src/components/deals/deal-inventory-tab.tsx"],"sourcesContent":["'use client'\r\n\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card'\r\nimport { Button } from '@/components/ui/button'\r\nimport { Badge } from '@/components/ui/badge'\r\nimport { Plus, Package } from 'lucide-react'\r\nimport { AddShareLotModal } from './add-share-lot-modal'\r\n\r\ninterface DealInventoryTabProps {\r\n  dealId: string\r\n  shareLots: any[]\r\n  inventorySummary: {\r\n    total_units: number\r\n    available_units: number\r\n    reserved_units: number\r\n    allocated_units: number\r\n  }\r\n  onRefresh?: () => void\r\n}\r\n\r\nexport function DealInventoryTab({ dealId, shareLots, inventorySummary, onRefresh }: DealInventoryTabProps) {\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      {/* Summary Cards */}\r\n      <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\r\n        <Card className=\"border-border bg-muted/50\">\r\n          <CardHeader className=\"pb-2\">\r\n            <CardTitle className=\"text-sm font-medium text-muted-foreground\">Total Units</CardTitle>\r\n          </CardHeader>\r\n          <CardContent>\r\n            <p className=\"text-2xl font-bold text-foreground\">\r\n              {inventorySummary.total_units.toLocaleString()}\r\n            </p>\r\n          </CardContent>\r\n        </Card>\r\n\r\n        <Card className=\"border-border bg-muted/50\">\r\n          <CardHeader className=\"pb-2\">\r\n            <CardTitle className=\"text-sm font-medium text-muted-foreground\">Available</CardTitle>\r\n          </CardHeader>\r\n          <CardContent>\r\n            <p className=\"text-2xl font-bold text-emerald-200\">\r\n              {inventorySummary.available_units.toLocaleString()}\r\n            </p>\r\n          </CardContent>\r\n        </Card>\r\n\r\n        <Card className=\"border-border bg-muted/50\">\r\n          <CardHeader className=\"pb-2\">\r\n            <CardTitle className=\"text-sm font-medium text-muted-foreground\">Reserved</CardTitle>\r\n          </CardHeader>\r\n          <CardContent>\r\n            <p className=\"text-2xl font-bold text-amber-200\">\r\n              {inventorySummary.reserved_units.toLocaleString()}\r\n            </p>\r\n          </CardContent>\r\n        </Card>\r\n\r\n        <Card className=\"border-border bg-muted/50\">\r\n          <CardHeader className=\"pb-2\">\r\n            <CardTitle className=\"text-sm font-medium text-muted-foreground\">Allocated</CardTitle>\r\n          </CardHeader>\r\n          <CardContent>\r\n            <p className=\"text-2xl font-bold text-sky-200\">\r\n              {inventorySummary.allocated_units.toLocaleString()}\r\n            </p>\r\n          </CardContent>\r\n        </Card>\r\n      </div>\r\n\r\n      {/* Share Lots Table */}\r\n      <Card className=\"border-border bg-muted/50\">\r\n        <CardHeader>\r\n          <div className=\"flex items-center justify-between\">\r\n            <div>\r\n              <CardTitle className=\"text-foreground flex items-center gap-2\">\r\n                <Package className=\"h-5 w-5\" />\r\n                Share Lots\r\n              </CardTitle>\r\n              <CardDescription>Inventory sources and allocation tracking</CardDescription>\r\n            </div>\r\n            <AddShareLotModal dealId={dealId} onSuccess={onRefresh} />\r\n          </div>\r\n        </CardHeader>\r\n        <CardContent>\r\n          {!shareLots || shareLots.length === 0 ? (\r\n            <div className=\"text-center py-8 text-muted-foreground\">\r\n              No share lots added yet. Click \"Add Share Lot\" to begin.\r\n            </div>\r\n          ) : (\r\n            <div className=\"space-y-3\">\r\n              {shareLots.map((lot) => (\r\n                <div\r\n                  key={lot.id}\r\n                  className=\"border border-border rounded-lg p-4 bg-muted/50 hover:bg-muted transition-colors\"\r\n                >\r\n                  <div className=\"flex items-start justify-between\">\r\n                    <div className=\"space-y-1\">\r\n                      <div className=\"flex items-center gap-2\">\r\n                        <span className=\"font-medium text-foreground\">\r\n                          {lot.share_sources?.counterparty_name || 'Unknown Source'}\r\n                        </span>\r\n                        <Badge variant=\"outline\" className=\"border-border text-xs\">\r\n                          {lot.share_sources?.kind}\r\n                        </Badge>\r\n                        <Badge className={\r\n                          lot.status === 'available' ? 'bg-emerald-500/20 text-emerald-200' :\r\n                          lot.status === 'exhausted' ? 'bg-red-500/20 text-red-200' :\r\n                          'bg-amber-500/20 text-amber-200'\r\n                        }>\r\n                          {lot.status}\r\n                        </Badge>\r\n                      </div>\r\n                      <div className=\"flex items-center gap-4 text-sm text-muted-foreground\">\r\n                        <span>Total: {lot.units_total.toLocaleString()} units</span>\r\n                        <span>Remaining: {lot.units_remaining.toLocaleString()} units</span>\r\n                        <span>Cost: {lot.currency} {lot.unit_cost.toFixed(2)}/unit</span>\r\n                        {lot.acquired_at && (\r\n                          <span>Acquired: {new Date(lot.acquired_at).toLocaleDateString()}</span>\r\n                        )}\r\n                      </div>\r\n                    </div>\r\n                    <Button variant=\"outline\" size=\"sm\">Edit</Button>\r\n                  </div>\r\n                </div>\r\n              ))}\r\n            </div>\r\n          )}\r\n        </CardContent>\r\n      </Card>\r\n    </div>\r\n  )\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2039, "column": 0}, "map": {"version":3,"sources":["file:///Users/ghilesmoussaoui/Desktop/Versotech/versotech-portal/src/components/deals/deal-fee-plans-tab.tsx"],"sourcesContent":["'use client'\r\n\r\nimport { useState } from 'react'\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card'\r\nimport { Button } from '@/components/ui/button'\r\nimport { Badge } from '@/components/ui/badge'\r\nimport { Plus, DollarSign, Edit, FileText, Users, Building2, Briefcase, CheckCircle, Clock, XCircle, FileSignature, Loader2, FileDown, Eye, Download } from 'lucide-react'\r\nimport { toast } from 'sonner'\r\nimport FeePlanEditModal from '@/components/fees/FeePlanEditModal'\r\nimport { useRouter } from 'next/navigation'\r\n\r\ninterface DealFeePlansTabProps {\r\n  dealId: string\r\n  feePlans: any[]\r\n}\r\n\r\nexport function DealFeePlansTab({ dealId, feePlans }: DealFeePlansTabProps) {\r\n  const router = useRouter()\r\n  const [modalOpen, setModalOpen] = useState(false)\r\n  const [selectedPlan, setSelectedPlan] = useState<any>(null)\r\n  const [generatingAgreement, setGeneratingAgreement] = useState<string | null>(null)\r\n  const [downloadingPdf, setDownloadingPdf] = useState<string | null>(null)\r\n\r\n  // Handle PDF download from Supabase storage\r\n  const handleDownloadPdf = async (pdfUrl: string, referenceNumber: string | null) => {\r\n    setDownloadingPdf(pdfUrl)\r\n    try {\r\n      const response = await fetch(`/api/storage/download?path=${encodeURIComponent(pdfUrl)}&bucket=deal-documents`)\r\n      if (!response.ok) {\r\n        throw new Error('Failed to download file')\r\n      }\r\n      const blob = await response.blob()\r\n      const url = window.URL.createObjectURL(blob)\r\n      const link = document.createElement('a')\r\n      link.href = url\r\n      // Extract actual filename from storage path, or fall back to reference number\r\n      const actualFilename = pdfUrl.split('/').pop() || `${referenceNumber || 'agreement'}.pdf`\r\n      link.download = actualFilename\r\n      document.body.appendChild(link)\r\n      link.click()\r\n      document.body.removeChild(link)\r\n      window.URL.revokeObjectURL(url)\r\n      toast.success('PDF downloaded successfully')\r\n    } catch (error) {\r\n      console.error('Error downloading PDF:', error)\r\n      toast.error('Failed to download PDF')\r\n    } finally {\r\n      setDownloadingPdf(null)\r\n    }\r\n  }\r\n\r\n  // Handle PDF preview in new tab\r\n  const handlePreviewPdf = async (pdfUrl: string) => {\r\n    try {\r\n      const response = await fetch(`/api/storage/download?path=${encodeURIComponent(pdfUrl)}&bucket=deal-documents`)\r\n      if (!response.ok) {\r\n        throw new Error('Failed to load file')\r\n      }\r\n      const blob = await response.blob()\r\n      const url = window.URL.createObjectURL(blob)\r\n      window.open(url, '_blank')\r\n    } catch (error) {\r\n      console.error('Error previewing PDF:', error)\r\n      toast.error('Failed to preview PDF')\r\n    }\r\n  }\r\n\r\n  // Get PDF URL from agreement (introducer or placement)\r\n  const getAgreementPdfInfo = (plan: any): { pdfUrl: string | null; referenceNumber: string | null } => {\r\n    if (plan.introducer_agreement?.pdf_url) {\r\n      return {\r\n        pdfUrl: plan.introducer_agreement.pdf_url,\r\n        referenceNumber: plan.introducer_agreement.reference_number\r\n      }\r\n    }\r\n    if (plan.placement_agreement?.pdf_url) {\r\n      return {\r\n        pdfUrl: plan.placement_agreement.pdf_url,\r\n        referenceNumber: plan.placement_agreement.reference_number\r\n      }\r\n    }\r\n    return { pdfUrl: null, referenceNumber: null }\r\n  }\r\n\r\n  const feeKindLabels: Record<string, string> = {\r\n    subscription: 'Subscription Fee',\r\n    management: 'Management Fee',\r\n    performance: 'Performance Fee',\r\n    spread_markup: 'Spread Markup',\r\n    flat: 'Flat Fee',\r\n    other: 'Other'\r\n  }\r\n\r\n  // Helper to get entity display info\r\n  const getEntityInfo = (plan: any) => {\r\n    if (plan.introducer_id) {\r\n      return {\r\n        type: 'Introducer',\r\n        icon: <Users className=\"h-4 w-4 text-blue-400\" />,\r\n        // Introducers table uses 'legal_name', not 'name' or 'company_name'\r\n        name: plan.introducer?.legal_name || plan.introducer?.name || plan.introducer?.company_name || 'Unknown'\r\n      }\r\n    }\r\n    if (plan.partner_id) {\r\n      return {\r\n        type: 'Partner',\r\n        icon: <Building2 className=\"h-4 w-4 text-green-400\" />,\r\n        // Partners table has 'name' and 'legal_name'\r\n        name: plan.partner?.name || plan.partner?.legal_name || plan.partner?.company_name || 'Unknown'\r\n      }\r\n    }\r\n    if (plan.commercial_partner_id) {\r\n      return {\r\n        type: 'Commercial Partner',\r\n        icon: <Briefcase className=\"h-4 w-4 text-purple-400\" />,\r\n        // Commercial partners table has 'name' and 'legal_name'\r\n        name: plan.commercial_partner?.name || plan.commercial_partner?.legal_name || plan.commercial_partner?.company_name || 'Unknown'\r\n      }\r\n    }\r\n    return null\r\n  }\r\n\r\n  // Helper to get status badge\r\n  const getStatusBadge = (plan: any) => {\r\n    const status = plan.status || 'draft'\r\n    switch (status) {\r\n      case 'accepted':\r\n        return (\r\n          <Badge className=\"bg-green-100 dark:bg-green-500/20 text-green-700 dark:text-green-400 border-green-300 dark:border-green-500/30\">\r\n            <CheckCircle className=\"h-3 w-3 mr-1\" />\r\n            Accepted\r\n          </Badge>\r\n        )\r\n      case 'sent':\r\n      case 'pending_signature':\r\n        return (\r\n          <Badge className=\"bg-amber-100 dark:bg-amber-500/20 text-amber-700 dark:text-amber-400 border-amber-300 dark:border-amber-500/30\">\r\n            <Clock className=\"h-3 w-3 mr-1\" />\r\n            Pending\r\n          </Badge>\r\n        )\r\n      case 'rejected':\r\n        return (\r\n          <Badge className=\"bg-red-100 dark:bg-red-500/20 text-red-700 dark:text-red-400 border-red-300 dark:border-red-500/30\">\r\n            <XCircle className=\"h-3 w-3 mr-1\" />\r\n            Rejected\r\n          </Badge>\r\n        )\r\n      default:\r\n        return (\r\n          <Badge variant=\"outline\" className=\"border-border text-muted-foreground\">\r\n            Draft\r\n          </Badge>\r\n        )\r\n    }\r\n  }\r\n\r\n  const handleCreateNew = () => {\r\n    setSelectedPlan(null)\r\n    setModalOpen(true)\r\n  }\r\n\r\n  const handleEdit = (plan: any) => {\r\n    // Transform fee_components to components for the modal\r\n    const normalizedPlan = {\r\n      ...plan,\r\n      components: plan.fee_components || []\r\n    }\r\n    setSelectedPlan(normalizedPlan)\r\n    setModalOpen(true)\r\n  }\r\n\r\n  const handleModalSuccess = () => {\r\n    setModalOpen(false)\r\n    setSelectedPlan(null)\r\n    router.refresh()\r\n  }\r\n\r\n  const handleModalClose = () => {\r\n    setModalOpen(false)\r\n    setSelectedPlan(null)\r\n  }\r\n\r\n  // Generate Introducer Agreement (DOC 3)\r\n  const handleGenerateIntroducerAgreement = async (plan: any) => {\r\n    if (!plan.introducer_id) return\r\n\r\n    setGeneratingAgreement(plan.id)\r\n    try {\r\n      const res = await fetch(`/api/staff/fees/plans/${plan.id}/generate-agreement`, {\r\n        method: 'POST',\r\n      })\r\n\r\n      if (!res.ok) {\r\n        const data = await res.json()\r\n        alert(`Failed to generate agreement: ${data.error || 'Unknown error'}`)\r\n        return\r\n      }\r\n\r\n      alert('Introducer Agreement generated successfully!')\r\n      router.refresh()\r\n    } catch (error) {\r\n      console.error('Error generating introducer agreement:', error)\r\n      alert('Failed to generate agreement')\r\n    } finally {\r\n      setGeneratingAgreement(null)\r\n    }\r\n  }\r\n\r\n  // Generate Partner Placement Agreement\r\n  const handleGeneratePartnerAgreement = async (plan: any) => {\r\n    if (!plan.partner_id) return\r\n\r\n    setGeneratingAgreement(plan.id)\r\n    try {\r\n      const res = await fetch(`/api/staff/fees/plans/${plan.id}/generate-placement-agreement`, {\r\n        method: 'POST',\r\n      })\r\n\r\n      if (!res.ok) {\r\n        const data = await res.json()\r\n        alert(`Failed to generate placement agreement: ${data.error || 'Unknown error'}`)\r\n        return\r\n      }\r\n\r\n      alert('Placement Agreement generated successfully!')\r\n      router.refresh()\r\n    } catch (error) {\r\n      console.error('Error generating placement agreement:', error)\r\n      alert('Failed to generate placement agreement')\r\n    } finally {\r\n      setGeneratingAgreement(null)\r\n    }\r\n  }\r\n\r\n  // Unified handler that routes to correct agreement type\r\n  const handleGenerateAgreement = async (plan: any) => {\r\n    if (plan.introducer_id) {\r\n      await handleGenerateIntroducerAgreement(plan)\r\n    } else if (plan.partner_id) {\r\n      await handleGeneratePartnerAgreement(plan)\r\n    }\r\n  }\r\n\r\n  // Check if agreement has been generated for this plan\r\n  const hasGeneratedAgreement = (plan: any) => {\r\n    if (plan.introducer_id && plan.generated_agreement_id) return true\r\n    if (plan.partner_id && plan.generated_placement_agreement_id) return true\r\n    return false\r\n  }\r\n\r\n  // Check if this plan can have an agreement generated\r\n  const canGenerateAgreement = (plan: any) => {\r\n    // Introducers: need introducer_id and no existing agreement\r\n    if (plan.introducer_id && !plan.generated_agreement_id) return true\r\n    // Partners: need partner_id and no existing placement agreement\r\n    if (plan.partner_id && !plan.generated_placement_agreement_id) return true\r\n    return false\r\n  }\r\n\r\n  // Get appropriate tooltip for generate button\r\n  const getGenerateTooltip = (plan: any) => {\r\n    if (plan.introducer_id) return 'Generate Introducer Agreement (DOC 3)'\r\n    if (plan.partner_id) return 'Generate Placement Agreement'\r\n    return ''\r\n  }\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      {/* Fee Plans Section (for investors) */}\r\n      <Card className=\"border border-border bg-muted/50\">\r\n        <CardHeader>\r\n          <div className=\"flex items-center justify-between\">\r\n            <div>\r\n              <CardTitle className=\"text-foreground flex items-center gap-2\">\r\n                <DollarSign className=\"h-5 w-5\" />\r\n                Fee Plans\r\n              </CardTitle>\r\n              <CardDescription>Configure fee structures for investors</CardDescription>\r\n            </div>\r\n            <Button onClick={handleCreateNew} className=\"gap-2\">\r\n              <Plus className=\"h-4 w-4\" />\r\n              Create Fee Plan\r\n            </Button>\r\n          </div>\r\n        </CardHeader>\r\n        <CardContent>\r\n          {!feePlans || feePlans.length === 0 ? (\r\n            <div className=\"text-center py-8 text-muted-foreground\">\r\n              No fee plans created yet. Click \"Create Fee Plan\" to begin.\r\n            </div>\r\n          ) : (\r\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n              {feePlans.map((plan) => {\r\n                const entityInfo = getEntityInfo(plan)\r\n                return (\r\n                  <Card key={plan.id} className=\"border border-border bg-muted/50\">\r\n                    <CardHeader>\r\n                      <div className=\"flex items-start justify-between\">\r\n                        <div className=\"flex-1\">\r\n                          <div className=\"flex items-center gap-2 mb-1\">\r\n                            <CardTitle className=\"text-lg text-foreground\">\r\n                              {plan.name}\r\n                            </CardTitle>\r\n                            {getStatusBadge(plan)}\r\n                          </div>\r\n                          {plan.description && (\r\n                            <CardDescription className=\"mt-1\">{plan.description}</CardDescription>\r\n                          )}\r\n                        </div>\r\n                        <div className=\"flex items-center gap-1\">\r\n                          {/* Generate Agreement button - for introducers and partners */}\r\n                          {canGenerateAgreement(plan) && (\r\n                            <Button\r\n                              variant=\"ghost\"\r\n                              size=\"sm\"\r\n                              onClick={() => handleGenerateAgreement(plan)}\r\n                              disabled={generatingAgreement === plan.id}\r\n                              className=\"text-green-400 hover:text-green-300\"\r\n                              title={getGenerateTooltip(plan)}\r\n                            >\r\n                              {generatingAgreement === plan.id ? (\r\n                                <Loader2 className=\"h-4 w-4 animate-spin\" />\r\n                              ) : (\r\n                                <FileSignature className=\"h-4 w-4\" />\r\n                              )}\r\n                            </Button>\r\n                          )}\r\n                          {hasGeneratedAgreement(plan) && (\r\n                            <Badge className=\"bg-green-500/20 text-green-400 border-green-500/30 text-xs\">\r\n                              Agreement Generated\r\n                            </Badge>\r\n                          )}\r\n                          <Button\r\n                            variant=\"ghost\"\r\n                            size=\"sm\"\r\n                            onClick={() => handleEdit(plan)}\r\n                            className=\"text-blue-400 hover:text-blue-300\"\r\n                          >\r\n                            <Edit className=\"h-4 w-4\" />\r\n                          </Button>\r\n                        </div>\r\n                      </div>\r\n\r\n                      {/* Term Sheet & Entity Info */}\r\n                      <div className=\"mt-3 space-y-2\">\r\n                        {plan.term_sheet_id && plan.term_sheet && (\r\n                          <div className=\"flex items-center gap-2 text-sm text-muted-foreground\">\r\n                            <FileText className=\"h-4 w-4 text-muted-foreground\" />\r\n                            <span>\r\n                              Term Sheet v{plan.term_sheet.version}\r\n                              {plan.term_sheet.term_sheet_date && (\r\n                                <span className=\"text-muted-foreground ml-1\">\r\n                                  ({new Date(plan.term_sheet.term_sheet_date).toLocaleDateString()})\r\n                                </span>\r\n                              )}\r\n                            </span>\r\n                          </div>\r\n                        )}\r\n                        {!plan.term_sheet_id && (\r\n                          <div className=\"flex items-center gap-2 text-sm text-amber-400\">\r\n                            <FileText className=\"h-4 w-4\" />\r\n                            <span>No term sheet linked</span>\r\n                          </div>\r\n                        )}\r\n\r\n                        {entityInfo && (\r\n                          <div className=\"flex items-center gap-2 text-sm text-muted-foreground\">\r\n                            {entityInfo.icon}\r\n                            <span>{entityInfo.type}: {entityInfo.name}</span>\r\n                          </div>\r\n                        )}\r\n                        {!entityInfo && (\r\n                          <div className=\"flex items-center gap-2 text-sm text-amber-400\">\r\n                            <Users className=\"h-4 w-4\" />\r\n                            <span>No entity linked</span>\r\n                          </div>\r\n                        )}\r\n\r\n                        {plan.accepted_at && (\r\n                          <div className=\"flex items-center gap-2 text-sm text-green-400\">\r\n                            <CheckCircle className=\"h-4 w-4\" />\r\n                            <span>Accepted {new Date(plan.accepted_at).toLocaleDateString()}</span>\r\n                          </div>\r\n                        )}\r\n                      </div>\r\n                    </CardHeader>\r\n                    <CardContent className=\"space-y-3\">\r\n                      {plan.fee_components && plan.fee_components.length > 0 ? (\r\n                        <div className=\"space-y-2\">\r\n                          {plan.fee_components.map((component: any) => (\r\n                            <div\r\n                              key={component.id}\r\n                              className=\"flex items-center justify-between py-2 px-3 rounded bg-muted/50\"\r\n                            >\r\n                              <span className=\"text-sm text-foreground\">\r\n                                {feeKindLabels[component.kind]}\r\n                              </span>\r\n                              <Badge variant=\"outline\" className=\"border-border text-muted-foreground\">\r\n                                {component.rate_bps ? `${component.rate_bps / 100}%` :\r\n                                 component.flat_amount ? `$${component.flat_amount}` : '—'}\r\n                              </Badge>\r\n                            </div>\r\n                          ))}\r\n                        </div>\r\n                      ) : (\r\n                        <div className=\"text-center py-4\">\r\n                          <p className=\"text-sm text-muted-foreground mb-2\">No components added yet</p>\r\n                          <Button\r\n                            variant=\"outline\"\r\n                            size=\"sm\"\r\n                            onClick={() => handleEdit(plan)}\r\n                            className=\"text-xs\"\r\n                          >\r\n                            Add Components\r\n                          </Button>\r\n                        </div>\r\n                      )}\r\n\r\n                      {/* Agreement Document Section */}\r\n                      {(() => {\r\n                        const { pdfUrl, referenceNumber } = getAgreementPdfInfo(plan)\r\n                        if (!pdfUrl) return null\r\n\r\n                        return (\r\n                          <div className=\"mt-4 pt-4 border-t border-border\">\r\n                            <div className=\"flex items-center justify-between\">\r\n                              <div className=\"flex items-center gap-3\">\r\n                                <div className=\"p-2 rounded-lg bg-green-500/10\">\r\n                                  <FileText className=\"h-5 w-5 text-green-400\" />\r\n                                </div>\r\n                                <div>\r\n                                  <p className=\"text-sm font-medium text-foreground\">\r\n                                    {plan.introducer_id ? 'Introducer Agreement' : 'Placement Agreement'}\r\n                                  </p>\r\n                                  <p className=\"text-xs text-muted-foreground\">\r\n                                    {referenceNumber || 'Document ready'}\r\n                                  </p>\r\n                                </div>\r\n                              </div>\r\n                              <div className=\"flex items-center gap-2\">\r\n                                <Button\r\n                                  variant=\"outline\"\r\n                                  size=\"sm\"\r\n                                  onClick={() => handlePreviewPdf(pdfUrl)}\r\n                                  className=\"text-blue-400 border-blue-400/30 hover:bg-blue-400/10\"\r\n                                >\r\n                                  <Eye className=\"h-4 w-4 mr-1\" />\r\n                                  Preview\r\n                                </Button>\r\n                                <Button\r\n                                  variant=\"outline\"\r\n                                  size=\"sm\"\r\n                                  onClick={() => handleDownloadPdf(pdfUrl, referenceNumber)}\r\n                                  disabled={downloadingPdf === pdfUrl}\r\n                                  className=\"text-green-400 border-green-400/30 hover:bg-green-400/10\"\r\n                                >\r\n                                  {downloadingPdf === pdfUrl ? (\r\n                                    <Loader2 className=\"h-4 w-4 mr-1 animate-spin\" />\r\n                                  ) : (\r\n                                    <Download className=\"h-4 w-4 mr-1\" />\r\n                                  )}\r\n                                  Download\r\n                                </Button>\r\n                              </div>\r\n                            </div>\r\n                          </div>\r\n                        )\r\n                      })()}\r\n                    </CardContent>\r\n                  </Card>\r\n                )\r\n              })}\r\n            </div>\r\n          )}\r\n        </CardContent>\r\n      </Card>\r\n\r\n      {/* Fee Plan Edit Modal */}\r\n      <FeePlanEditModal\r\n        open={modalOpen}\r\n        onClose={handleModalClose}\r\n        onSuccess={handleModalSuccess}\r\n        feePlan={selectedPlan}\r\n        dealId={dealId}\r\n      />\r\n    </div>\r\n  )\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2948, "column": 0}, "map": {"version":3,"sources":["file:///Users/ghilesmoussaoui/Desktop/Versotech/versotech-portal/src/components/deals/data-room-document-upload.tsx"],"sourcesContent":["'use client'\r\n\r\nimport { useState, useCallback, useEffect } from 'react'\r\nimport { useRouter } from 'next/navigation'\r\nimport { useDropzone } from 'react-dropzone'\r\nimport { Dialog, DialogContent, DialogDescription, DialogHeader, DialogTitle } from '@/components/ui/dialog'\r\nimport { Button } from '@/components/ui/button'\r\nimport { Input } from '@/components/ui/input'\r\nimport { Label } from '@/components/ui/label'\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select'\r\nimport { Checkbox } from '@/components/ui/checkbox'\r\nimport { Progress } from '@/components/ui/progress'\r\nimport { Upload, File, X, Loader2, FolderOpen } from 'lucide-react'\r\nimport { toast } from 'sonner'\r\n\r\ninterface DocumentUploadProps {\r\n  dealId: string\r\n  onUploadComplete?: () => void\r\n  trigger: React.ReactNode\r\n}\r\n\r\ninterface DealFolder {\r\n  id: string\r\n  name: string\r\n  path: string\r\n  folder_type: string\r\n}\r\n\r\n// Fallback folders if database folders aren't available\r\nconst DEFAULT_FOLDERS = [\r\n  'Term Sheets',\r\n  'Data Room',\r\n  'Subscription Documents',\r\n  'Legal Documents',\r\n  'Financial Reports',\r\n  'Due Diligence'\r\n]\r\n\r\nexport function DataRoomDocumentUpload({ dealId, onUploadComplete, trigger }: DocumentUploadProps) {\r\n  const router = useRouter()\r\n  const [open, setOpen] = useState(false)\r\n  const [files, setFiles] = useState<File[]>([])\r\n  const [dealFolders, setDealFolders] = useState<DealFolder[]>([])\r\n  const [selectedFolderId, setSelectedFolderId] = useState<string | null>(null)\r\n  const [folder, setFolder] = useState('Data Room') // Default folder name for backward compatibility\r\n  const [visibleToInvestors, setVisibleToInvestors] = useState(false)\r\n  const [isFeatured, setIsFeatured] = useState(false)\r\n  const [uploading, setUploading] = useState(false)\r\n  const [uploadProgress, setUploadProgress] = useState(0)\r\n  const [uploadMode, setUploadMode] = useState<'file' | 'link'>('file')\r\n  const [externalLink, setExternalLink] = useState('')\r\n  const [linkFileName, setLinkFileName] = useState('')\r\n  const [loadingFolders, setLoadingFolders] = useState(false)\r\n\r\n  const fetchDealFolders = useCallback(async () => {\r\n    setLoadingFolders(true)\r\n    try {\r\n      const response = await fetch(`/api/deals/${dealId}/folders`)\r\n      if (response.ok) {\r\n        const data = await response.json()\r\n        setDealFolders(data.folders || [])\r\n\r\n        // Set default folder (prefer Data Room folder)\r\n        const dataRoomFolder = data.folders?.find((f: DealFolder) =>\r\n          f.name === 'Data Room' || f.path?.includes('/Data Room')\r\n        )\r\n        if (dataRoomFolder) {\r\n          setSelectedFolderId(dataRoomFolder.id)\r\n          setFolder('Data Room')\r\n        } else if (data.folders?.length > 0) {\r\n          setSelectedFolderId(data.folders[0].id)\r\n          setFolder(data.folders[0].name)\r\n        }\r\n      } else {\r\n        // If folder fetch fails, folders might not be created yet\r\n        console.warn('Could not fetch deal folders, using defaults')\r\n      }\r\n    } catch (error) {\r\n      console.error('Error fetching deal folders:', error)\r\n    } finally {\r\n      setLoadingFolders(false)\r\n    }\r\n  }, [dealId])\r\n\r\n  // Fetch deal folders when dialog opens\r\n  useEffect(() => {\r\n    if (open && dealId) {\r\n      fetchDealFolders()\r\n    }\r\n  }, [open, dealId, fetchDealFolders])\r\n\r\n  const onDrop = useCallback((acceptedFiles: File[]) => {\r\n    setFiles(prev => [...prev, ...acceptedFiles])\r\n  }, [])\r\n\r\n  const { getRootProps, getInputProps, isDragActive } = useDropzone({\r\n    onDrop,\r\n    multiple: true\r\n  })\r\n\r\n  const removeFile = (index: number) => {\r\n    setFiles(prev => prev.filter((_, i) => i !== index))\r\n  }\r\n\r\n  const handleUpload = async () => {\r\n    if (uploadMode === 'file' && files.length === 0) {\r\n      toast.error('Please select files to upload')\r\n      return\r\n    }\r\n\r\n    if (uploadMode === 'link') {\r\n      if (!externalLink.trim()) {\r\n        toast.error('Please enter a link')\r\n        return\r\n      }\r\n      if (!linkFileName.trim()) {\r\n        toast.error('Please enter a document name')\r\n        return\r\n      }\r\n    }\r\n\r\n    setUploading(true)\r\n    setUploadProgress(0)\r\n\r\n    try {\r\n      if (uploadMode === 'link') {\r\n        // Upload external link\r\n        const response = await fetch(`/api/deals/${dealId}/documents/link`, {\r\n          method: 'POST',\r\n          headers: { 'Content-Type': 'application/json' },\r\n          body: JSON.stringify({\r\n            external_link: externalLink,\r\n            file_name: linkFileName,\r\n            folder,\r\n            folder_id: selectedFolderId, // Include folder_id when available\r\n            visible_to_investors: visibleToInvestors,\r\n            is_featured: isFeatured\r\n          })\r\n        })\r\n\r\n        if (!response.ok) {\r\n          const error = await response.json()\r\n          toast.error(`Failed to add link: ${error.error}`)\r\n        } else {\r\n          toast.success('Link added successfully')\r\n        }\r\n\r\n        setUploadProgress(100)\r\n      } else {\r\n        // Upload files\r\n        let successCount = 0\r\n\r\n        for (let i = 0; i < files.length; i++) {\r\n          const file = files[i]\r\n          const formData = new FormData()\r\n          formData.append('file', file)\r\n          formData.append('folder', folder)\r\n          if (selectedFolderId) {\r\n            formData.append('folder_id', selectedFolderId) // Include folder_id when available\r\n          }\r\n          formData.append('visible_to_investors', visibleToInvestors.toString())\r\n          formData.append('is_featured', isFeatured.toString())\r\n\r\n          const response = await fetch(`/api/deals/${dealId}/documents/upload`, {\r\n            method: 'POST',\r\n            body: formData\r\n          })\r\n\r\n          if (!response.ok) {\r\n            const error = await response.json()\r\n            toast.error(`Failed to upload ${file.name}: ${error.error}`)\r\n            continue\r\n          }\r\n\r\n          successCount++\r\n          setUploadProgress(Math.round(((i + 1) / files.length) * 100))\r\n        }\r\n\r\n        toast.success(`Successfully uploaded ${successCount} of ${files.length} files`)\r\n      }\r\n\r\n      // Reset form\r\n      setFiles([])\r\n      setFolder('Legal')\r\n      setVisibleToInvestors(false)\r\n      setIsFeatured(false)\r\n      setExternalLink('')\r\n      setLinkFileName('')\r\n      setOpen(false)\r\n\r\n      // Refresh to show new documents\r\n      onUploadComplete?.()\r\n      router.refresh()\r\n    } catch (error) {\r\n      console.error('Upload error:', error)\r\n      toast.error('Failed to upload documents')\r\n    } finally {\r\n      setUploading(false)\r\n      setUploadProgress(0)\r\n    }\r\n  }\r\n\r\n  return (\r\n    <>\r\n      <div onClick={() => setOpen(true)}>{trigger}</div>\r\n      \r\n      <Dialog open={open} onOpenChange={setOpen}>\r\n        <DialogContent className=\"sm:max-w-2xl\">\r\n          <DialogHeader>\r\n            <DialogTitle>Add Documents</DialogTitle>\r\n            <DialogDescription>\r\n              Upload files or add links to external documents (Google Drive, Dropbox, etc.)\r\n            </DialogDescription>\r\n          </DialogHeader>\r\n\r\n          <div className=\"space-y-4\">\r\n            {/* Mode Selector */}\r\n            <div className=\"flex gap-2 border-b\">\r\n              <Button\r\n                variant={uploadMode === 'file' ? 'default' : 'ghost'}\r\n                onClick={() => setUploadMode('file')}\r\n                className=\"flex-1\"\r\n              >\r\n                Upload Files\r\n              </Button>\r\n              <Button\r\n                variant={uploadMode === 'link' ? 'default' : 'ghost'}\r\n                onClick={() => setUploadMode('link')}\r\n                className=\"flex-1\"\r\n              >\r\n                Add Link\r\n              </Button>\r\n            </div>\r\n\r\n            {uploadMode === 'file' ? (\r\n              <>\r\n                {/* Dropzone */}\r\n                <div\r\n                  {...getRootProps()}\r\n                  className={`border-2 border-dashed rounded-lg p-8 text-center cursor-pointer transition-colors ${\r\n                    isDragActive ? 'border-blue-500 bg-blue-500/10' : 'border-border hover:border-muted-foreground'\r\n                  }`}\r\n                >\r\n                  <input {...getInputProps()} />\r\n                  <Upload className=\"h-12 w-12 mx-auto mb-4 text-muted-foreground\" />\r\n                  {isDragActive ? (\r\n                    <p className=\"text-blue-600 dark:text-blue-400 font-medium\">Drop files here...</p>\r\n                  ) : (\r\n                    <>\r\n                      <p className=\"text-foreground font-medium mb-1\">\r\n                        Drag and drop files here, or click to browse\r\n                      </p>\r\n                      <p className=\"text-sm text-muted-foreground\">\r\n                        Supports all document types (PDF, DOCX, XLSX, JSON, etc.)\r\n                      </p>\r\n                    </>\r\n                  )}\r\n                </div>\r\n              </>\r\n            ) : (\r\n              <>\r\n                {/* Link Input */}\r\n                <div className=\"space-y-4\">\r\n                  <div className=\"space-y-2\">\r\n                    <Label htmlFor=\"linkUrl\">Document Link</Label>\r\n                    <Input\r\n                      id=\"linkUrl\"\r\n                      type=\"url\"\r\n                      value={externalLink}\r\n                      onChange={(e) => setExternalLink(e.target.value)}\r\n                      placeholder=\"https://drive.google.com/file/d/...\"\r\n                    />\r\n                    <p className=\"text-xs text-muted-foreground\">\r\n                      Paste a Google Drive, Dropbox, or any public link\r\n                    </p>\r\n                  </div>\r\n\r\n                  <div className=\"space-y-2\">\r\n                    <Label htmlFor=\"linkName\">Document Name</Label>\r\n                    <Input\r\n                      id=\"linkName\"\r\n                      value={linkFileName}\r\n                      onChange={(e) => setLinkFileName(e.target.value)}\r\n                      placeholder=\"Q4 2024 Report\"\r\n                    />\r\n                  </div>\r\n                </div>\r\n              </>\r\n            )}\r\n\r\n            {/* File List */}\r\n            {uploadMode === 'file' && files.length > 0 && (\r\n              <div className=\"space-y-2\">\r\n                <Label>Selected Files ({files.length})</Label>\r\n                <div className=\"max-h-48 overflow-y-auto space-y-2\">\r\n                  {files.map((file, index) => (\r\n                    <div\r\n                      key={index}\r\n                      className=\"flex items-center justify-between p-2 bg-muted rounded border border-border\"\r\n                    >\r\n                      <div className=\"flex items-center gap-2 flex-1 min-w-0\">\r\n                        <File className=\"h-4 w-4 text-muted-foreground flex-shrink-0\" />\r\n                        <span className=\"text-sm truncate\">{file.name}</span>\r\n                        <span className=\"text-xs text-muted-foreground flex-shrink-0\">\r\n                          ({(file.size / 1024).toFixed(1)} KB)\r\n                        </span>\r\n                      </div>\r\n                      <Button\r\n                        variant=\"ghost\"\r\n                        size=\"sm\"\r\n                        onClick={() => removeFile(index)}\r\n                        disabled={uploading}\r\n                      >\r\n                        <X className=\"h-4 w-4\" />\r\n                      </Button>\r\n                    </div>\r\n                  ))}\r\n                </div>\r\n              </div>\r\n            )}\r\n\r\n            {/* Settings */}\r\n            <div className=\"space-y-4\">\r\n              <div className=\"space-y-2\">\r\n                <Label>Folder</Label>\r\n                <Select\r\n                  value={selectedFolderId || folder}\r\n                  onValueChange={(value) => {\r\n                    // Check if value is a folder ID (UUID) or folder name\r\n                    const folderObj = dealFolders.find(f => f.id === value)\r\n                    if (folderObj) {\r\n                      setSelectedFolderId(folderObj.id)\r\n                      setFolder(folderObj.name)\r\n                    } else {\r\n                      // Fallback to using folder name directly\r\n                      setSelectedFolderId(null)\r\n                      setFolder(value)\r\n                    }\r\n                  }}\r\n                  disabled={uploading || loadingFolders}\r\n                >\r\n                  <SelectTrigger>\r\n                    <SelectValue placeholder={loadingFolders ? \"Loading folders...\" : \"Select folder\"} />\r\n                  </SelectTrigger>\r\n                  <SelectContent>\r\n                    {dealFolders.length > 0 ? (\r\n                      dealFolders.map(f => (\r\n                        <SelectItem key={f.id} value={f.id}>\r\n                          <div className=\"flex items-center gap-2\">\r\n                            <FolderOpen className=\"h-3 w-3\" />\r\n                            <span>{f.name}</span>\r\n                          </div>\r\n                        </SelectItem>\r\n                      ))\r\n                    ) : (\r\n                      DEFAULT_FOLDERS.map(f => (\r\n                        <SelectItem key={f} value={f}>\r\n                          {f}\r\n                        </SelectItem>\r\n                      ))\r\n                    )}\r\n                  </SelectContent>\r\n                </Select>\r\n              </div>\r\n\r\n              <div className=\"grid grid-cols-2 gap-4\">\r\n                <div className=\"flex items-center space-x-2\">\r\n                  <Checkbox\r\n                    id=\"visible\"\r\n                    checked={visibleToInvestors}\r\n                    onCheckedChange={(checked) => setVisibleToInvestors(checked as boolean)}\r\n                    disabled={uploading}\r\n                  />\r\n                  <label\r\n                    htmlFor=\"visible\"\r\n                    className=\"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70\"\r\n                  >\r\n                    Visible to investors\r\n                  </label>\r\n                </div>\r\n                <div className=\"flex items-center space-x-2\">\r\n                  <Checkbox\r\n                    id=\"featured\"\r\n                    checked={isFeatured}\r\n                    onCheckedChange={(checked) => setIsFeatured(checked as boolean)}\r\n                    disabled={uploading}\r\n                  />\r\n                  <label\r\n                    htmlFor=\"featured\"\r\n                    className=\"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70\"\r\n                  >\r\n                    Featured document\r\n                  </label>\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Progress */}\r\n            {uploading && (\r\n              <div className=\"space-y-2\">\r\n                <div className=\"flex justify-between text-sm\">\r\n                  <span>Uploading...</span>\r\n                  <span>{uploadProgress}%</span>\r\n                </div>\r\n                <Progress value={uploadProgress} />\r\n              </div>\r\n            )}\r\n\r\n            {/* Actions */}\r\n            <div className=\"flex justify-end gap-2\">\r\n              <Button variant=\"outline\" onClick={() => setOpen(false)} disabled={uploading}>\r\n                Cancel\r\n              </Button>\r\n              <Button onClick={handleUpload} disabled={uploading || (uploadMode === 'file' && files.length === 0)}>\r\n                {uploading && <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />}\r\n                {uploadMode === 'link' ? 'Add Link' : `Upload ${files.length > 0 ? `(${files.length})` : ''}`}\r\n              </Button>\r\n            </div>\r\n          </div>\r\n        </DialogContent>\r\n      </Dialog>\r\n    </>\r\n  )\r\n}\r\n\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 3726, "column": 0}, "map": {"version":3,"sources":["file:///Users/ghilesmoussaoui/Desktop/Versotech/versotech-portal/src/components/deals/data-room-document-editor.tsx"],"sourcesContent":["'use client'\n\nimport { useState, useEffect } from 'react'\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle\n} from '@/components/ui/dialog'\nimport { Button } from '@/components/ui/button'\nimport { Input } from '@/components/ui/input'\nimport { Label } from '@/components/ui/label'\nimport { Textarea } from '@/components/ui/textarea'\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select'\nimport { Checkbox } from '@/components/ui/checkbox'\nimport { Badge } from '@/components/ui/badge'\nimport { Loader2, X } from 'lucide-react'\nimport { toast } from 'sonner'\n\ninterface DocumentEditorProps {\n  dealId: string\n  documentId: string\n  open: boolean\n  onOpenChange: (open: boolean) => void\n  onSaved?: () => void\n  initialData?: {\n    file_name?: string\n    folder?: string\n    visible_to_investors?: boolean\n    tags?: string[]\n    document_notes?: string\n    document_expires_at?: string | null\n  }\n}\n\nconst FOLDERS = [\n  'Legal',\n  'KYC',\n  'Reports',\n  'Presentations',\n  'Financial Models',\n  'Misc'\n]\n\nexport function DataRoomDocumentEditor({\n  dealId,\n  documentId,\n  open,\n  onOpenChange,\n  onSaved,\n  initialData\n}: DocumentEditorProps) {\n  const [fileName, setFileName] = useState(initialData?.file_name || '')\n  const [folder, setFolder] = useState(initialData?.folder || 'Legal')\n  const [visibleToInvestors, setVisibleToInvestors] = useState(initialData?.visible_to_investors || false)\n  const [tags, setTags] = useState<string[]>(initialData?.tags || [])\n  const [tagInput, setTagInput] = useState('')\n  const [notes, setNotes] = useState(initialData?.document_notes || '')\n  const [expiresAt, setExpiresAt] = useState(\n    initialData?.document_expires_at \n      ? new Date(initialData.document_expires_at).toISOString().slice(0, 16)\n      : ''\n  )\n  const [saving, setSaving] = useState(false)\n\n  useEffect(() => {\n    if (initialData) {\n      setFileName(initialData.file_name || '')\n      setFolder(initialData.folder || 'Legal')\n      setVisibleToInvestors(initialData.visible_to_investors || false)\n      setTags(initialData.tags || [])\n      setNotes(initialData.document_notes || '')\n      setExpiresAt(\n        initialData.document_expires_at\n          ? new Date(initialData.document_expires_at).toISOString().slice(0, 16)\n          : ''\n      )\n    }\n  }, [initialData, open])\n\n  const addTag = () => {\n    const trimmed = tagInput.trim()\n    if (trimmed && !tags.includes(trimmed)) {\n      setTags([...tags, trimmed])\n      setTagInput('')\n    }\n  }\n\n  const removeTag = (tag: string) => {\n    setTags(tags.filter(t => t !== tag))\n  }\n\n  const handleSave = async () => {\n    setSaving(true)\n\n    try {\n      const response = await fetch(`/api/deals/${dealId}/documents/${documentId}`, {\n        method: 'PATCH',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          file_name: fileName,\n          folder,\n          visible_to_investors: visibleToInvestors,\n          tags,\n          document_notes: notes || null,\n          document_expires_at: expiresAt ? new Date(expiresAt).toISOString() : null\n        })\n      })\n\n      if (!response.ok) {\n        const error = await response.json()\n        throw new Error(error.error || 'Failed to update document')\n      }\n\n      toast.success('Document metadata updated successfully')\n      onOpenChange(false)\n\n      if (onSaved) {\n        onSaved()\n      }\n    } catch (error) {\n      console.error('Save error:', error)\n      toast.error(error instanceof Error ? error.message : 'Failed to save changes')\n    } finally {\n      setSaving(false)\n    }\n  }\n\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent className=\"sm:max-w-2xl max-h-[90vh] overflow-y-auto\">\n        <DialogHeader>\n          <DialogTitle>Edit Document Metadata</DialogTitle>\n          <DialogDescription>\n            Update document details, visibility, tags, and expiry settings.\n          </DialogDescription>\n        </DialogHeader>\n\n        <div className=\"space-y-4 py-4\">\n          {/* File Name */}\n          <div className=\"space-y-2\">\n            <Label htmlFor=\"fileName\">File Name</Label>\n            <Input\n              id=\"fileName\"\n              value={fileName}\n              onChange={e => setFileName(e.target.value)}\n              placeholder=\"document.pdf\"\n            />\n          </div>\n\n          {/* Folder */}\n          <div className=\"space-y-2\">\n            <Label>Folder</Label>\n            <Select value={folder} onValueChange={setFolder}>\n              <SelectTrigger>\n                <SelectValue />\n              </SelectTrigger>\n              <SelectContent>\n                {FOLDERS.map(f => (\n                  <SelectItem key={f} value={f}>\n                    {f}\n                  </SelectItem>\n                ))}\n              </SelectContent>\n            </Select>\n          </div>\n\n          {/* Visibility */}\n          <div className=\"flex items-center space-x-2\">\n            <Checkbox\n              id=\"visible\"\n              checked={visibleToInvestors}\n              onCheckedChange={(checked) => setVisibleToInvestors(checked as boolean)}\n            />\n            <label\n              htmlFor=\"visible\"\n              className=\"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70\"\n            >\n              Visible to investors\n            </label>\n          </div>\n\n          {/* Tags */}\n          <div className=\"space-y-2\">\n            <Label>Tags</Label>\n            <div className=\"flex gap-2\">\n              <Input\n                value={tagInput}\n                onChange={e => setTagInput(e.target.value)}\n                onKeyPress={e => e.key === 'Enter' && (e.preventDefault(), addTag())}\n                placeholder=\"Add tag and press Enter\"\n              />\n              <Button type=\"button\" onClick={addTag} variant=\"outline\">\n                Add\n              </Button>\n            </div>\n            {tags.length > 0 && (\n              <div className=\"flex flex-wrap gap-2\">\n                {tags.map(tag => (\n                  <Badge key={tag} variant=\"secondary\" className=\"gap-1\">\n                    {tag}\n                    <X\n                      className=\"h-3 w-3 cursor-pointer\"\n                      onClick={() => removeTag(tag)}\n                    />\n                  </Badge>\n                ))}\n              </div>\n            )}\n          </div>\n\n          {/* Expiry Date */}\n          <div className=\"space-y-2\">\n            <Label htmlFor=\"expiresAt\">Document Expiry (Optional)</Label>\n            <Input\n              id=\"expiresAt\"\n              type=\"datetime-local\"\n              value={expiresAt}\n              onChange={e => setExpiresAt(e.target.value)}\n            />\n            <p className=\"text-xs text-muted-foreground\">\n              Leave blank for no expiry. Expired documents will be hidden from investors.\n            </p>\n          </div>\n\n          {/* Notes */}\n          <div className=\"space-y-2\">\n            <Label htmlFor=\"notes\">Internal Notes</Label>\n            <Textarea\n              id=\"notes\"\n              value={notes}\n              onChange={e => setNotes(e.target.value)}\n              rows={3}\n              placeholder=\"Add internal notes about this document (not visible to investors)\"\n            />\n          </div>\n        </div>\n\n        <DialogFooter>\n          <Button variant=\"outline\" onClick={() => onOpenChange(false)} disabled={saving}>\n            Cancel\n          </Button>\n          <Button onClick={handleSave} disabled={saving}>\n            {saving && <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />}\n            Save Changes\n          </Button>\n        </DialogFooter>\n      </DialogContent>\n    </Dialog>\n  )\n}\n\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 4171, "column": 0}, "map": {"version":3,"sources":["file:///Users/ghilesmoussaoui/Desktop/Versotech/versotech-portal/src/components/deals/data-room-document-versions.tsx"],"sourcesContent":["'use client'\n\nimport { useState, useEffect, useCallback, useRef, ChangeEvent } from 'react'\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogHeader,\n  DialogTitle\n} from '@/components/ui/dialog'\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow\n} from '@/components/ui/table'\nimport { Button } from '@/components/ui/button'\nimport { Badge } from '@/components/ui/badge'\nimport { Download, FileText, Loader2, Upload } from 'lucide-react'\nimport { format } from 'date-fns'\nimport { toast } from 'sonner'\n\ninterface DocumentVersionsProps {\n  dealId: string\n  documentId: string\n  open: boolean\n  onOpenChange: (open: boolean) => void\n}\n\ninterface DocumentVersion {\n  id: string\n  file_name: string\n  version: number\n  created_at: string\n  created_by: string | null\n  file_size_bytes: number | null\n  replaced_by_id: string | null\n  file_key: string\n}\n\nexport function DataRoomDocumentVersions({\n  dealId,\n  documentId,\n  open,\n  onOpenChange\n}: DocumentVersionsProps) {\n  const [versions, setVersions] = useState<DocumentVersion[]>([])\n  const [loading, setLoading] = useState(false)\n  const [error, setError] = useState<string | null>(null)\n  const [uploading, setUploading] = useState(false)\n  const fileInputRef = useRef<HTMLInputElement>(null)\n\n  const handleUploadVersion = async (e: ChangeEvent<HTMLInputElement>) => {\n    const file = e.target.files?.[0]\n    if (!file) return\n\n    setUploading(true)\n    try {\n      const formData = new FormData()\n      formData.append('file', file)\n\n      const response = await fetch(`/api/deals/${dealId}/documents/${documentId}/versions`, {\n        method: 'POST',\n        body: formData\n      })\n\n      if (!response.ok) {\n        const data = await response.json()\n        throw new Error(data.error || 'Failed to upload new version')\n      }\n\n      toast.success('New version uploaded successfully')\n      await loadVersions()\n    } catch (err) {\n      console.error('Error uploading version:', err)\n      toast.error(err instanceof Error ? err.message : 'Failed to upload new version')\n    } finally {\n      setUploading(false)\n      // Reset file input\n      if (fileInputRef.current) {\n        fileInputRef.current.value = ''\n      }\n    }\n  }\n\n  const loadVersions = useCallback(async () => {\n    setLoading(true)\n    setError(null)\n\n    try {\n      const response = await fetch(`/api/deals/${dealId}/documents/${documentId}/versions`)\n      \n      if (!response.ok) {\n        throw new Error('Failed to load version history')\n      }\n\n      const data = await response.json()\n      setVersions(data.versions || [])\n    } catch (err) {\n      console.error('Error loading versions:', err)\n      setError(err instanceof Error ? err.message : 'Failed to load versions')\n    } finally {\n      setLoading(false)\n    }\n  }, [dealId, documentId])\n\n  useEffect(() => {\n    if (open && documentId) {\n      loadVersions()\n    }\n  }, [open, documentId, loadVersions])\n\n  const formatFileSize = (bytes: number | null) => {\n    if (!bytes) return '—'\n    if (bytes < 1024) return `${bytes} B`\n    if (bytes < 1024 * 1024) return `${(bytes / 1024).toFixed(1)} KB`\n    return `${(bytes / (1024 * 1024)).toFixed(1)} MB`\n  }\n\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent className=\"sm:max-w-3xl max-h-[80vh] overflow-y-auto\">\n        <DialogHeader>\n          <div className=\"flex items-center justify-between\">\n            <DialogTitle className=\"flex items-center gap-2\">\n              <FileText className=\"h-5 w-5\" />\n              Document Version History\n            </DialogTitle>\n            <div>\n              <Button\n                size=\"sm\"\n                onClick={() => fileInputRef.current?.click()}\n                disabled={uploading || loading}\n              >\n                {uploading ? (\n                  <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />\n                ) : (\n                  <Upload className=\"h-4 w-4 mr-2\" />\n                )}\n                {uploading ? 'Uploading...' : 'Upload New Version'}\n              </Button>\n              <input\n                type=\"file\"\n                ref={fileInputRef}\n                onChange={handleUploadVersion}\n                className=\"hidden\"\n                accept=\".pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx,.txt,.csv\"\n              />\n            </div>\n          </div>\n          <DialogDescription>\n            View all versions of this document. The latest version is shown to investors.\n          </DialogDescription>\n        </DialogHeader>\n\n        {loading && (\n          <div className=\"flex items-center justify-center py-8\">\n            <Loader2 className=\"h-8 w-8 animate-spin text-muted-foreground\" />\n          </div>\n        )}\n\n        {error && (\n          <div className=\"text-center py-8 text-destructive\">\n            {error}\n          </div>\n        )}\n\n        {!loading && !error && versions.length === 0 && (\n          <div className=\"text-center py-8 text-muted-foreground\">\n            No version history available yet.\n          </div>\n        )}\n\n        {!loading && !error && versions.length > 0 && (\n          <Table>\n            <TableHeader>\n              <TableRow>\n                <TableHead>Version</TableHead>\n                <TableHead>File Name</TableHead>\n                <TableHead>Size</TableHead>\n                <TableHead>Uploaded</TableHead>\n                <TableHead>Status</TableHead>\n                <TableHead className=\"text-right\">Actions</TableHead>\n              </TableRow>\n            </TableHeader>\n            <TableBody>\n              {versions.map(version => {\n                const isLatest = !version.replaced_by_id\n                return (\n                  <TableRow key={version.id}>\n                    <TableCell className=\"font-medium\">\n                      v{version.version}\n                    </TableCell>\n                    <TableCell className=\"font-mono text-sm\">\n                      {version.file_name}\n                    </TableCell>\n                    <TableCell className=\"text-sm text-muted-foreground\">\n                      {formatFileSize(version.file_size_bytes)}\n                    </TableCell>\n                    <TableCell className=\"text-sm\">\n                      {format(new Date(version.created_at), 'dd MMM yyyy HH:mm')}\n                    </TableCell>\n                    <TableCell>\n                      {isLatest ? (\n                        <Badge className=\"bg-emerald-500/20 text-emerald-200\">\n                          Current\n                        </Badge>\n                      ) : (\n                        <Badge variant=\"outline\" className=\"text-muted-foreground\">\n                          Replaced\n                        </Badge>\n                      )}\n                    </TableCell>\n                    <TableCell className=\"text-right\">\n                      <Button variant=\"outline\" size=\"sm\" className=\"gap-2\">\n                        <Download className=\"h-4 w-4\" />\n                        Download\n                      </Button>\n                    </TableCell>\n                  </TableRow>\n                )\n              })}\n            </TableBody>\n          </Table>\n        )}\n      </DialogContent>\n    </Dialog>\n  )\n}\n\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 4581, "column": 0}, "map": {"version":3,"sources":["file:///Users/ghilesmoussaoui/Desktop/Versotech/versotech-portal/src/components/deals/deal-documents-tab.tsx"],"sourcesContent":["'use client'\r\n\r\nimport { useState } from 'react'\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card'\r\nimport { Button } from '@/components/ui/button'\r\nimport { Badge } from '@/components/ui/badge'\r\nimport { FileText, Upload, Download, Trash2, Plus, Edit, History } from 'lucide-react'\r\nimport { DataRoomDocumentUpload } from './data-room-document-upload'\r\nimport { DataRoomDocumentEditor } from './data-room-document-editor'\r\nimport { DataRoomDocumentVersions } from './data-room-document-versions'\r\nimport { toast } from 'sonner'\r\n\r\ninterface DealDocumentsTabProps {\r\n  dealId: string\r\n  documents: any[]\r\n  onRefresh?: () => void\r\n}\r\n\r\nexport function DealDocumentsTab({ dealId, documents, onRefresh }: DealDocumentsTabProps) {\r\n  const [refreshKey, setRefreshKey] = useState(0)\r\n  const [editingDocument, setEditingDocument] = useState<any | null>(null)\r\n  const [versionHistoryDoc, setVersionHistoryDoc] = useState<string | null>(null)\r\n  const [deleting, setDeleting] = useState<string | null>(null)\r\n  const [downloading, setDownloading] = useState<string | null>(null)\r\n  \r\n  const docTypeColors: Record<string, string> = {\r\n    nda: 'bg-purple-500/20 text-purple-700 dark:text-purple-200',\r\n    term_sheet: 'bg-blue-500/20 text-blue-700 dark:text-blue-200',\r\n    subscription: 'bg-emerald-500/20 text-emerald-700 dark:text-emerald-200',\r\n    contract: 'bg-amber-500/20 text-amber-700 dark:text-amber-200',\r\n    report: 'bg-cyan-500/20 text-cyan-700 dark:text-cyan-200',\r\n    other: 'bg-muted text-muted-foreground'\r\n  }\r\n\r\n  const handleUploadComplete = () => {\r\n    setRefreshKey(prev => prev + 1)\r\n    // Trigger callback to refresh parent component\r\n    if (onRefresh) {\r\n      onRefresh()\r\n    }\r\n  }\r\n\r\n  const handleDownload = async (documentId: string) => {\r\n    setDownloading(documentId)\r\n\r\n    try {\r\n      const response = await fetch(`/api/deals/${dealId}/documents/${documentId}/download`)\r\n\r\n      if (!response.ok) {\r\n        throw new Error('Failed to generate download link')\r\n      }\r\n\r\n      const data = await response.json()\r\n\r\n      // Open the signed URL in a new tab\r\n      window.open(data.download_url, '_blank')\r\n\r\n      toast.success('Document download started')\r\n    } catch (error) {\r\n      console.error('Download error:', error)\r\n      toast.error('Failed to download document')\r\n    } finally {\r\n      setDownloading(null)\r\n    }\r\n  }\r\n\r\n  const handleDelete = async (documentId: string) => {\r\n    if (!confirm('Are you sure you want to delete this document? This action cannot be undone.')) {\r\n      return\r\n    }\r\n\r\n    setDeleting(documentId)\r\n\r\n    try {\r\n      const response = await fetch(`/api/deals/${dealId}/documents/${documentId}`, {\r\n        method: 'DELETE'\r\n      })\r\n\r\n      if (!response.ok) {\r\n        throw new Error('Failed to delete document')\r\n      }\r\n\r\n      toast.success('Document deleted successfully')\r\n      if (onRefresh) {\r\n        onRefresh()\r\n      }\r\n    } catch (error) {\r\n      console.error('Delete error:', error)\r\n      toast.error('Failed to delete document')\r\n    } finally {\r\n      setDeleting(null)\r\n    }\r\n  }\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      <Card className=\"border-border bg-muted/50\">\r\n        <CardHeader>\r\n          <div className=\"flex items-center justify-between\">\r\n            <div>\r\n              <CardTitle className=\"text-foreground flex items-center gap-2\">\r\n                <FileText className=\"h-5 w-5\" />\r\n                Deal Documents\r\n              </CardTitle>\r\n              <CardDescription>Documents scoped to this deal only</CardDescription>\r\n            </div>\r\n            <DataRoomDocumentUpload\r\n              dealId={dealId}\r\n              onUploadComplete={handleUploadComplete}\r\n              trigger={\r\n                <Button className=\"gap-2\">\r\n                  <Plus className=\"h-4 w-4\" />\r\n                  Upload Document\r\n                </Button>\r\n              }\r\n            />\r\n          </div>\r\n        </CardHeader>\r\n        <CardContent>\r\n          {documents.length === 0 ? (\r\n            <div className=\"text-center py-8 text-muted-foreground\">\r\n              No documents uploaded yet. Click \"Upload Document\" to add files.\r\n            </div>\r\n          ) : (\r\n            <div className=\"space-y-2\">\r\n              {documents.map((doc) => (\r\n                <div\r\n                  key={doc.id}\r\n                  className=\"flex items-center justify-between py-3 px-4 rounded-lg border border-border bg-muted/50 hover:bg-muted transition-colors\"\r\n                >\r\n                  <div className=\"flex items-center gap-3 flex-1\">\r\n                    <FileText className=\"h-5 w-5 text-muted-foreground\" />\r\n                    <div className=\"flex-1\">\r\n                      <div className=\"flex items-center gap-2\">\r\n                        <span className=\"font-medium text-foreground\">\r\n                          {doc.file_key.split('/').pop()}\r\n                        </span>\r\n                      </div>\r\n                      <p className=\"text-sm text-muted-foreground\">\r\n                        Uploaded {new Date(doc.created_at).toLocaleDateString()}\r\n                        {doc.created_by_profile && ` by ${doc.created_by_profile.display_name}`}\r\n                      </p>\r\n                    </div>\r\n                  </div>\r\n                  <div className=\"flex items-center gap-2\">\r\n                    <Button\r\n                      variant=\"outline\"\r\n                      size=\"sm\"\r\n                      className=\"gap-2\"\r\n                      onClick={() => setEditingDocument(doc)}\r\n                    >\r\n                      <Edit className=\"h-4 w-4\" />\r\n                      Edit\r\n                    </Button>\r\n                    <Button\r\n                      variant=\"outline\"\r\n                      size=\"sm\"\r\n                      className=\"gap-2\"\r\n                      onClick={() => setVersionHistoryDoc(doc.id)}\r\n                    >\r\n                      <History className=\"h-4 w-4\" />\r\n                      Versions\r\n                    </Button>\r\n                    <Button\r\n                      variant=\"outline\"\r\n                      size=\"sm\"\r\n                      className=\"gap-2\"\r\n                      onClick={() => handleDownload(doc.id)}\r\n                      disabled={downloading === doc.id}\r\n                    >\r\n                      <Download className=\"h-4 w-4\" />\r\n                      {downloading === doc.id ? 'Downloading...' : 'Download'}\r\n                    </Button>\r\n                    <Button\r\n                      variant=\"outline\"\r\n                      size=\"sm\"\r\n                      className=\"text-red-700 dark:text-red-200\"\r\n                      onClick={() => handleDelete(doc.id)}\r\n                      disabled={deleting === doc.id}\r\n                    >\r\n                      <Trash2 className=\"h-4 w-4\" />\r\n                    </Button>\r\n                  </div>\r\n                </div>\r\n              ))}\r\n            </div>\r\n          )}\r\n        </CardContent>\r\n      </Card>\r\n\r\n      {/* Document Editor Dialog */}\r\n      {editingDocument && (\r\n        <DataRoomDocumentEditor\r\n          dealId={dealId}\r\n          documentId={editingDocument.id}\r\n          open={!!editingDocument}\r\n          onOpenChange={(open) => !open && setEditingDocument(null)}\r\n          onSaved={() => {\r\n            setEditingDocument(null)\r\n            if (onRefresh) {\r\n              onRefresh()\r\n            }\r\n          }}\r\n          initialData={{\r\n            file_name: editingDocument.file_name,\r\n            folder: editingDocument.folder,\r\n            visible_to_investors: editingDocument.visible_to_investors,\r\n            tags: editingDocument.tags,\r\n            document_notes: editingDocument.document_notes,\r\n            document_expires_at: editingDocument.document_expires_at\r\n          }}\r\n        />\r\n      )}\r\n\r\n      {/* Version History Dialog */}\r\n      {versionHistoryDoc && (\r\n        <DataRoomDocumentVersions\r\n          dealId={dealId}\r\n          documentId={versionHistoryDoc}\r\n          open={!!versionHistoryDoc}\r\n          onOpenChange={(open) => !open && setVersionHistoryDoc(null)}\r\n        />\r\n      )}\r\n    </div>\r\n  )\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 4978, "column": 0}, "map": {"version":3,"sources":["file:///Users/ghilesmoussaoui/Desktop/Versotech/versotech-portal/src/components/deals/deal-activity-tab.tsx"],"sourcesContent":["'use client'\r\n\r\nimport { useState, useEffect } from 'react'\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card'\r\nimport { Badge } from '@/components/ui/badge'\r\nimport { Button } from '@/components/ui/button'\r\nimport { Skeleton } from '@/components/ui/skeleton'\r\nimport { ScrollArea } from '@/components/ui/scroll-area'\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select'\r\nimport {\r\n  Activity,\r\n  FileText,\r\n  Users,\r\n  Heart,\r\n  Lock,\r\n  CheckCircle,\r\n  Edit,\r\n  AlertCircle,\r\n  Clock,\r\n  Filter,\r\n  RefreshCw\r\n} from 'lucide-react'\r\nimport { formatDistanceToNow, format } from 'date-fns'\r\n\r\ninterface DealActivityEvent {\r\n  id: string\r\n  timestamp: string\r\n  type: string\r\n  category: 'conversion' | 'audit' | 'membership' | 'interest' | 'access' | 'subscription'\r\n  actor: {\r\n    name: string\r\n    email: string\r\n    role: string\r\n  } | null\r\n  description: string\r\n  details?: Record<string, any>\r\n}\r\n\r\ninterface DealActivityTabProps {\r\n  dealId: string\r\n}\r\n\r\nconst categoryIcons = {\r\n  conversion: RefreshCw,\r\n  audit: Edit,\r\n  membership: Users,\r\n  interest: Heart,\r\n  access: Lock,\r\n  subscription: FileText\r\n}\r\n\r\nconst categoryColors = {\r\n  conversion: 'text-purple-500',\r\n  audit: 'text-muted-foreground',\r\n  membership: 'text-blue-500',\r\n  interest: 'text-pink-500',\r\n  access: 'text-orange-500',\r\n  subscription: 'text-green-500'\r\n}\r\n\r\nconst categoryBgColors = {\r\n  conversion: 'bg-purple-500/10',\r\n  audit: 'bg-muted',\r\n  membership: 'bg-blue-500/10',\r\n  interest: 'bg-pink-500/10',\r\n  access: 'bg-orange-500/10',\r\n  subscription: 'bg-green-500/10'\r\n}\r\n\r\nconst categoryLabels = {\r\n  conversion: 'Conversion',\r\n  audit: 'Audit',\r\n  membership: 'Membership',\r\n  interest: 'Interest',\r\n  access: 'Access',\r\n  subscription: 'Subscription'\r\n}\r\n\r\nexport function DealActivityTab({ dealId }: DealActivityTabProps) {\r\n  const [activities, setActivities] = useState<DealActivityEvent[]>([])\r\n  const [loading, setLoading] = useState(true)\r\n  const [error, setError] = useState<string | null>(null)\r\n  const [filter, setFilter] = useState<string>('all')\r\n  const [hasMore, setHasMore] = useState(false)\r\n  const [offset, setOffset] = useState(0)\r\n  const limit = 50\r\n\r\n  const fetchActivities = async (loadMore = false) => {\r\n    try {\r\n      setLoading(true)\r\n      const currentOffset = loadMore ? offset : 0\r\n      const categoryParam = filter !== 'all' ? `&category=${filter}` : ''\r\n      const response = await fetch(\r\n        `/api/deals/${dealId}/activity?limit=${limit}&offset=${currentOffset}${categoryParam}`\r\n      )\r\n\r\n      if (!response.ok) {\r\n        throw new Error('Failed to fetch activity timeline')\r\n      }\r\n\r\n      const data = await response.json()\r\n\r\n      if (loadMore) {\r\n        setActivities(prev => [...prev, ...(data.events || [])])\r\n      } else {\r\n        setActivities(data.events || [])\r\n      }\r\n\r\n      setHasMore(data.hasMore || false)\r\n      setOffset(currentOffset + (data.events?.length || 0))\r\n      setError(null)\r\n    } catch (err) {\r\n      console.error('Failed to fetch activities:', err)\r\n      setError('Failed to load activity timeline')\r\n      setActivities([])\r\n    } finally {\r\n      setLoading(false)\r\n    }\r\n  }\r\n\r\n  useEffect(() => {\r\n    setOffset(0)\r\n    fetchActivities(false)\r\n  }, [dealId, filter])\r\n\r\n  const handleLoadMore = () => {\r\n    fetchActivities(true)\r\n  }\r\n\r\n  if (loading && activities.length === 0) {\r\n    return (\r\n      <Card className=\"border-border bg-muted/50\">\r\n        <CardHeader>\r\n          <Skeleton className=\"h-6 w-32\" />\r\n          <Skeleton className=\"h-4 w-48\" />\r\n        </CardHeader>\r\n        <CardContent>\r\n          <div className=\"space-y-4\">\r\n            {[1, 2, 3, 4, 5].map((i) => (\r\n              <div key={i} className=\"flex gap-4\">\r\n                <Skeleton className=\"h-10 w-10 rounded-full\" />\r\n                <div className=\"flex-1 space-y-2\">\r\n                  <Skeleton className=\"h-4 w-3/4\" />\r\n                  <Skeleton className=\"h-3 w-1/2\" />\r\n                </div>\r\n              </div>\r\n            ))}\r\n          </div>\r\n        </CardContent>\r\n      </Card>\r\n    )\r\n  }\r\n\r\n  if (error) {\r\n    return (\r\n      <Card className=\"border-border bg-muted/50\">\r\n        <CardContent className=\"pt-6\">\r\n          <div className=\"flex items-center gap-2 text-destructive\">\r\n            <AlertCircle className=\"h-4 w-4\" />\r\n            <p>{error}</p>\r\n          </div>\r\n        </CardContent>\r\n      </Card>\r\n    )\r\n  }\r\n\r\n  return (\r\n    <Card className=\"border-border bg-muted/50\">\r\n      <CardHeader>\r\n        <div className=\"flex items-center justify-between flex-wrap gap-4\">\r\n          <div>\r\n            <CardTitle className=\"text-foreground flex items-center gap-2\">\r\n              <Activity className=\"h-5 w-5\" />\r\n              Activity Log\r\n            </CardTitle>\r\n            <CardDescription>\r\n              Complete audit trail of all deal actions\r\n            </CardDescription>\r\n          </div>\r\n          <Select value={filter} onValueChange={setFilter}>\r\n            <SelectTrigger className=\"w-[180px]\">\r\n              <Filter className=\"h-4 w-4 mr-2\" />\r\n              <SelectValue />\r\n            </SelectTrigger>\r\n            <SelectContent>\r\n              <SelectItem value=\"all\">All Activities</SelectItem>\r\n              <SelectItem value=\"conversion\">Conversions</SelectItem>\r\n              <SelectItem value=\"audit\">Audit Trail</SelectItem>\r\n              <SelectItem value=\"membership\">Membership</SelectItem>\r\n              <SelectItem value=\"interest\">Interest</SelectItem>\r\n              <SelectItem value=\"access\">Access Control</SelectItem>\r\n              <SelectItem value=\"subscription\">Subscriptions</SelectItem>\r\n            </SelectContent>\r\n          </Select>\r\n        </div>\r\n      </CardHeader>\r\n      <CardContent>\r\n        <ScrollArea style={{ height: '600px' }} className=\"pr-4\">\r\n          {activities.length === 0 ? (\r\n            <div className=\"text-center py-12\">\r\n              <Clock className=\"h-12 w-12 mx-auto text-muted-foreground mb-4\" />\r\n              <p className=\"text-muted-foreground text-lg font-medium\">No activities found</p>\r\n              <p className=\"text-sm text-muted-foreground mt-2\">\r\n                {filter === 'all'\r\n                  ? 'There are no recorded activities for this deal in the last 90 days.'\r\n                  : `No ${categoryLabels[filter as keyof typeof categoryLabels]} activities found.`}\r\n              </p>\r\n            </div>\r\n          ) : (\r\n            <div className=\"space-y-4\">\r\n              {activities.map((activity, index) => {\r\n                const Icon = categoryIcons[activity.category]\r\n                const iconColor = categoryColors[activity.category]\r\n                const bgColor = categoryBgColors[activity.category]\r\n                const isLast = index === activities.length - 1 && !hasMore\r\n\r\n                return (\r\n                  <div key={activity.id} className=\"relative\">\r\n                    {/* Timeline line */}\r\n                    {!isLast && (\r\n                      <div className=\"absolute left-5 top-12 bottom-0 w-px bg-border\" />\r\n                    )}\r\n\r\n                    {/* Activity item */}\r\n                    <div className=\"flex gap-4\">\r\n                      {/* Icon */}\r\n                      <div\r\n                        className={`flex-shrink-0 w-10 h-10 rounded-full ${bgColor} flex items-center justify-center relative z-10`}\r\n                      >\r\n                        <Icon className={`h-5 w-5 ${iconColor}`} />\r\n                      </div>\r\n\r\n                      {/* Content */}\r\n                      <div className=\"flex-1 pb-8\">\r\n                        <div className=\"flex items-start justify-between gap-4\">\r\n                          <div className=\"flex-1\">\r\n                            <div className=\"flex items-center gap-2 mb-1 flex-wrap\">\r\n                              <p className=\"font-semibold text-sm text-foreground\">\r\n                                {activity.type}\r\n                              </p>\r\n                              <Badge variant=\"outline\" className=\"text-xs\">\r\n                                {categoryLabels[activity.category]}\r\n                              </Badge>\r\n                            </div>\r\n                            <p className=\"text-sm text-muted-foreground mb-2\">\r\n                              {activity.description}\r\n                            </p>\r\n\r\n                            {/* Details metadata */}\r\n                            {activity.details && Object.keys(activity.details).length > 0 && (\r\n                              <div className=\"flex flex-wrap gap-2 mb-2\">\r\n                                {Object.entries(activity.details)\r\n                                  .filter(([key]) => !['id', 'userId', 'dealId'].includes(key))\r\n                                  .map(([key, value]) => {\r\n                                    // Format the value nicely\r\n                                    let displayValue = String(value)\r\n                                    if (typeof value === 'boolean') {\r\n                                      displayValue = value ? 'Yes' : 'No'\r\n                                    } else if (value === null || value === undefined) {\r\n                                      return null\r\n                                    }\r\n\r\n                                    return (\r\n                                      <div\r\n                                        key={key}\r\n                                        className=\"text-xs bg-muted px-2 py-1 rounded\"\r\n                                      >\r\n                                        <span className=\"font-medium\">\r\n                                          {key.replace(/_/g, ' ')}:\r\n                                        </span>{' '}\r\n                                        <span>{displayValue}</span>\r\n                                      </div>\r\n                                    )\r\n                                  })}\r\n                              </div>\r\n                            )}\r\n\r\n                            {/* Footer */}\r\n                            <div className=\"flex items-center gap-2 text-xs text-muted-foreground\">\r\n                              {activity.actor && (\r\n                                <>\r\n                                  <span>\r\n                                    by {activity.actor.name}\r\n                                    {activity.actor.role && ` (${activity.actor.role})`}\r\n                                  </span>\r\n                                  <span>•</span>\r\n                                </>\r\n                              )}\r\n                              <span\r\n                                title={format(new Date(activity.timestamp), 'PPpp')}\r\n                              >\r\n                                {formatDistanceToNow(new Date(activity.timestamp), {\r\n                                  addSuffix: true\r\n                                })}\r\n                              </span>\r\n                            </div>\r\n                          </div>\r\n\r\n                          {/* Success/Error indicator */}\r\n                          {activity.details?.status === 'success' ||\r\n                          activity.details?.status === 'approved' ? (\r\n                            <CheckCircle className=\"h-4 w-4 text-green-600 flex-shrink-0\" />\r\n                          ) : null}\r\n                          {activity.details?.status === 'error' ||\r\n                          activity.details?.status === 'rejected' ? (\r\n                            <AlertCircle className=\"h-4 w-4 text-red-600 flex-shrink-0\" />\r\n                          ) : null}\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                )\r\n              })}\r\n\r\n              {/* Load More Button */}\r\n              {hasMore && (\r\n                <div className=\"flex justify-center pt-4\">\r\n                  <Button\r\n                    variant=\"outline\"\r\n                    onClick={handleLoadMore}\r\n                    disabled={loading}\r\n                  >\r\n                    {loading ? (\r\n                      <>\r\n                        <RefreshCw className=\"h-4 w-4 mr-2 animate-spin\" />\r\n                        Loading...\r\n                      </>\r\n                    ) : (\r\n                      'Load More'\r\n                    )}\r\n                  </Button>\r\n                </div>\r\n              )}\r\n            </div>\r\n          )}\r\n        </ScrollArea>\r\n      </CardContent>\r\n    </Card>\r\n  )\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 5681, "column": 0}, "map": {"version":3,"sources":["file:///Users/ghilesmoussaoui/Desktop/Versotech/versotech-portal/src/components/deals/deal-interest-tab.tsx"],"sourcesContent":["'use client'\n\nimport { useMemo } from 'react'\nimport {\n  Card,\n  CardContent,\n  CardDescription,\n  CardHeader,\n  CardTitle\n} from '@/components/ui/card'\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow\n} from '@/components/ui/table'\nimport { Badge } from '@/components/ui/badge'\nimport Link from 'next/link'\nimport { format } from 'date-fns'\n\ninterface DealInterestTabProps {\n  dealId: string\n  interests: Array<Record<string, any>>\n  subscriptions: Array<Record<string, any>>\n}\n\nconst interestStatusStyles: Record<string, string> = {\n  pending_review: 'bg-amber-500/20 text-amber-100',\n  approved: 'bg-emerald-500/20 text-emerald-100',\n  rejected: 'bg-rose-500/20 text-rose-100',\n  withdrawn: 'bg-muted text-muted-foreground',\n  signal: 'bg-purple-500/20 text-purple-100'\n}\n\nconst subscriptionStatusStyles: Record<string, string> = {\n  pending_review: 'bg-amber-500/20 text-amber-100',\n  approved: 'bg-emerald-500/20 text-emerald-100',\n  rejected: 'bg-rose-500/20 text-rose-100',\n  cancelled: 'bg-muted text-muted-foreground'\n}\n\nexport function DealInterestTab({ dealId, interests, subscriptions }: DealInterestTabProps) {\n  const groupedInterests = useMemo(() => {\n    // Separate post-close signals from regular interests\n    const signals = interests?.filter(item => item.is_post_close) ?? []\n    const pending = interests?.filter(item => !item.is_post_close && item.status === 'pending_review') ?? []\n    const approved = interests?.filter(item => !item.is_post_close && item.status === 'approved') ?? []\n    const other = interests?.filter(item => !item.is_post_close && !['pending_review', 'approved'].includes(item.status)) ?? []\n    return { signals, pending, approved, other }\n  }, [interests])\n\n  return (\n    <div className=\"space-y-6\">\n      <Card className=\"border-border bg-muted/50\">\n        <CardHeader className=\"flex flex-row items-start justify-between\">\n          <div>\n            <CardTitle className=\"text-foreground\">Interest Pipeline</CardTitle>\n            <CardDescription>\n              Track investor signals and align approvals with NDA and data-room workflows.\n            </CardDescription>\n          </div>\n          <Link\n            href={`/versotech_main/approvals?entity=deal_interest&deal=${dealId}`}\n            className=\"text-sm font-medium text-sky-300 hover:text-sky-200\"\n          >\n            View related approvals ➜\n          </Link>\n        </CardHeader>\n        <CardContent className=\"space-y-6\">\n          {groupedInterests.signals.length > 0 && (\n            <InterestTable title=\"Future Interest Signals (Closed Deal)\" interests={groupedInterests.signals} emptyLabel=\"\" />\n          )}\n          <InterestTable title=\"Pending Review\" interests={groupedInterests.pending} emptyLabel=\"No pending interests.\" />\n          <InterestTable title=\"Approved\" interests={groupedInterests.approved} emptyLabel=\"No approved interests yet.\" />\n          {groupedInterests.other.length > 0 && (\n            <InterestTable title=\"Completed\" interests={groupedInterests.other} emptyLabel=\"\" />\n          )}\n        </CardContent>\n      </Card>\n\n      <Card className=\"border-border bg-muted/50\">\n        <CardHeader className=\"flex flex-row items-start justify-between\">\n          <div>\n            <CardTitle className=\"text-foreground\">Subscription Submissions</CardTitle>\n            <CardDescription>\n              Monitor definitive commitments flowing in from the investor data room.\n            </CardDescription>\n          </div>\n          <Link\n            href={`/versotech_main/approvals?entity=deal_subscription&deal=${dealId}`}\n            className=\"text-sm font-medium text-sky-300 hover:text-sky-200\"\n          >\n            View related approvals ➜\n          </Link>\n        </CardHeader>\n        <CardContent>\n          <Table className=\"min-w-full\">\n            <TableHeader>\n              <TableRow>\n                <TableHead>Investor</TableHead>\n                <TableHead>Status</TableHead>\n                <TableHead>Submitted</TableHead>\n                <TableHead>Amount (derived)</TableHead>\n              </TableRow>\n            </TableHeader>\n            <TableBody>\n              {subscriptions?.length ? (\n                subscriptions.map(subscription => {\n                  const rawAmount = subscription.payload_json?.amount ??\n                    subscription.payload_json?.subscription_amount ??\n                    subscription.payload_json?.commitment_amount\n                  const numericAmount = typeof rawAmount === 'number' ? rawAmount : parseFloat(rawAmount ?? '')\n                  const formattedAmount = Number.isFinite(numericAmount)\n                    ? numericAmount.toLocaleString()\n                    : undefined\n                  return (\n                    <TableRow key={subscription.id}>\n                      <TableCell>{subscription.investors?.legal_name || 'Unknown investor'}</TableCell>\n                      <TableCell>\n                        <Badge className={subscriptionStatusStyles[subscription.status] ?? 'bg-muted'}>\n                          {subscription.status.replace('_', ' ').toUpperCase()}\n                        </Badge>\n                      </TableCell>\n                      <TableCell>\n                        {subscription.submitted_at\n                          ? format(new Date(subscription.submitted_at), 'dd MMM yyyy HH:mm')\n                          : '—'}\n                      </TableCell>\n                      <TableCell>{formattedAmount ?? '—'}</TableCell>\n                    </TableRow>\n                  )\n                })\n              ) : (\n                <TableRow>\n                  <TableCell colSpan={4} className=\"text-center text-muted-foreground py-6\">\n                    No subscription submissions yet.\n                  </TableCell>\n                </TableRow>\n              )}\n            </TableBody>\n          </Table>\n        </CardContent>\n      </Card>\n    </div>\n  )\n}\n\ninterface InterestTableProps {\n  title: string\n  interests: Array<Record<string, any>>\n  emptyLabel: string\n}\n\nfunction InterestTable({ title, interests, emptyLabel }: InterestTableProps) {\n  return (\n    <div className=\"space-y-2\">\n      <h4 className=\"text-sm font-semibold text-foreground\">{title}</h4>\n      <Table className=\"min-w-full\">\n        <TableHeader>\n          <TableRow>\n            <TableHead>Investor</TableHead>\n            <TableHead>Action</TableHead>\n            <TableHead>Status</TableHead>\n            <TableHead>Indicative Amount</TableHead>\n            <TableHead>Submitted</TableHead>\n          </TableRow>\n        </TableHeader>\n        <TableBody>\n          {interests.length ? (\n            interests.map(interest => {\n              // Determine display status for post-close interests\n              const displayStatus = interest.is_post_close ? 'signal' : interest.status\n              const statusLabel = interest.is_post_close\n                ? 'SIGNAL'\n                : interest.status.replace('_', ' ').toUpperCase()\n\n              return (\n                <TableRow key={interest.id}>\n                  <TableCell>{interest.investors?.legal_name || 'Unknown investor'}</TableCell>\n                  <TableCell>\n                    {interest.is_post_close ? (\n                      <Badge className=\"bg-purple-500/20 text-purple-100\">\n                        Notify Me About Similar\n                      </Badge>\n                    ) : (\n                      <Badge className=\"bg-blue-500/20 text-blue-100\">\n                        I'm Interested\n                      </Badge>\n                    )}\n                  </TableCell>\n                  <TableCell>\n                    <Badge className={interestStatusStyles[displayStatus] ?? 'bg-muted'}>\n                      {statusLabel}\n                    </Badge>\n                  </TableCell>\n                  <TableCell>\n                    {interest.indicative_amount\n                      ? `${interest.indicative_currency ?? ''} ${interest.indicative_amount.toLocaleString()}`\n                      : '—'}\n                  </TableCell>\n                  <TableCell>\n                    {interest.submitted_at\n                      ? format(new Date(interest.submitted_at), 'dd MMM yyyy HH:mm')\n                      : '—'}\n                  </TableCell>\n                </TableRow>\n              )\n            })\n          ) : (\n            <TableRow>\n              <TableCell colSpan={5} className=\"text-center text-muted-foreground py-6\">\n                {emptyLabel}\n              </TableCell>\n            </TableRow>\n          )}\n        </TableBody>\n      </Table>\n    </div>\n  )\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 6203, "column": 0}, "map": {"version":3,"sources":["file:///Users/ghilesmoussaoui/Desktop/Versotech/versotech-portal/src/components/deals/deal-subscriptions-tab.tsx"],"sourcesContent":["'use client'\r\n\r\nimport { useState, useEffect, useCallback } from 'react'\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card'\r\nimport { Button } from '@/components/ui/button'\r\nimport { Badge } from '@/components/ui/badge'\r\nimport { FileText, ExternalLink, Loader2 } from 'lucide-react'\r\nimport { toast } from 'sonner'\r\n\r\ninterface SubscriptionWithDocuments {\r\n  id: string\r\n  deal_id: string\r\n  investor_id: string\r\n  status: string\r\n  submitted_at: string\r\n  payload_json: {\r\n    amount?: number\r\n    subscription_amount?: number\r\n    currency?: string\r\n  }\r\n  investors: {\r\n    id: string\r\n    legal_name: string\r\n  }\r\n  pack_status?: 'no_pack' | 'draft' | 'final' | 'pending_signature' | 'signed'\r\n  pack_document_id?: string\r\n  document_count?: number\r\n  documents?: Array<{\r\n    id: string\r\n    name: string\r\n    type: string\r\n    status: string\r\n    file_key: string\r\n    mime_type: string\r\n    file_size_bytes: number\r\n    created_at: string\r\n    created_by: string\r\n  }>\r\n}\r\n\r\ninterface DealSubscriptionsTabProps {\r\n  dealId: string\r\n}\r\n\r\nexport function DealSubscriptionsTab({ dealId }: DealSubscriptionsTabProps) {\r\n  const [subscriptions, setSubscriptions] = useState<SubscriptionWithDocuments[]>([])\r\n  const [loading, setLoading] = useState(true)\r\n\r\n  const statusColors: Record<string, string> = {\r\n    pending_review: 'bg-yellow-100 dark:bg-yellow-500/20 text-yellow-700 dark:text-yellow-200',\r\n    approved: 'bg-emerald-100 dark:bg-emerald-500/20 text-emerald-700 dark:text-emerald-200',\r\n    rejected: 'bg-red-100 dark:bg-red-500/20 text-red-700 dark:text-red-200',\r\n    pending_signature: 'bg-blue-100 dark:bg-blue-500/20 text-blue-700 dark:text-blue-200',\r\n    committed: 'bg-green-100 dark:bg-green-500/20 text-green-700 dark:text-green-200'\r\n  }\r\n\r\n  const packStatusColors: Record<string, string> = {\r\n    no_pack: 'bg-muted text-muted-foreground',\r\n    draft: 'bg-purple-100 dark:bg-purple-500/20 text-purple-700 dark:text-purple-200',\r\n    final: 'bg-cyan-100 dark:bg-cyan-500/20 text-cyan-700 dark:text-cyan-200',\r\n    pending_signature: 'bg-amber-100 dark:bg-amber-500/20 text-amber-700 dark:text-amber-200',\r\n    signed: 'bg-emerald-100 dark:bg-emerald-500/20 text-emerald-700 dark:text-emerald-200'\r\n  }\r\n\r\n  const packStatusLabels: Record<string, string> = {\r\n    no_pack: 'No Pack',\r\n    draft: 'Draft Generated',\r\n    final: 'Final Uploaded',\r\n    pending_signature: 'Awaiting Signatures',\r\n    signed: 'Fully Executed'\r\n  }\r\n\r\n  const fetchSubscriptions = useCallback(async () => {\r\n    setLoading(true)\r\n    try {\r\n      const response = await fetch(`/api/deals/${dealId}/subscriptions`)\r\n      if (!response.ok) {\r\n        throw new Error('Failed to fetch subscriptions')\r\n      }\r\n\r\n      const data = await response.json()\r\n\r\n      // API now returns enriched data with pack_status, pack_document_id, and document_count\r\n      // No need for additional fetching - all data is included in single query\r\n      setSubscriptions(data.submissions || [])\r\n    } catch (error) {\r\n      console.error('Error fetching subscriptions:', error)\r\n      toast.error('Failed to load subscriptions')\r\n    } finally {\r\n      setLoading(false)\r\n    }\r\n  }, [dealId])\r\n\r\n  useEffect(() => {\r\n    fetchSubscriptions()\r\n  }, [dealId, fetchSubscriptions])\r\n\r\n  const formatAmount = (subscription: SubscriptionWithDocuments) => {\r\n    const amount = subscription.payload_json?.amount || subscription.payload_json?.subscription_amount\r\n    const currency = subscription.payload_json?.currency || 'USD'\r\n\r\n    if (!amount) return 'Not specified'\r\n\r\n    return new Intl.NumberFormat('en-US', {\r\n      style: 'currency',\r\n      currency: currency\r\n    }).format(amount)\r\n  }\r\n\r\n  const handleViewDetails = (subscription: SubscriptionWithDocuments) => {\r\n    // First try to open the formal subscription if it exists\r\n    if ((subscription as any).subscription_id) {\r\n      window.open(`/versotech_main/subscriptions/${(subscription as any).subscription_id}`, '_blank')\r\n    } else if (subscription.pack_document_id) {\r\n      // Otherwise, if there's a subscription pack, download it\r\n      window.open(`/api/documents/${subscription.pack_document_id}/download`, '_blank')\r\n    } else {\r\n      // No converted subscription and no pack yet\r\n      toast.info('This subscription has not been converted to a formal commitment yet, and no subscription pack has been generated.')\r\n    }\r\n  }\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"flex items-center justify-center py-12\">\r\n        <Loader2 className=\"h-8 w-8 animate-spin text-muted-foreground\" />\r\n      </div>\r\n    )\r\n  }\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      <Card className=\"border border-border bg-muted/50\">\r\n        <CardHeader>\r\n          <div className=\"flex items-center justify-between\">\r\n            <div>\r\n              <CardTitle className=\"text-foreground flex items-center gap-2\">\r\n                <FileText className=\"h-5 w-5\" />\r\n                Subscription Submissions\r\n              </CardTitle>\r\n              <CardDescription>Investor subscriptions and pack generation status</CardDescription>\r\n            </div>\r\n            <div className=\"text-sm text-muted-foreground\">\r\n              {subscriptions.length} {subscriptions.length === 1 ? 'submission' : 'submissions'}\r\n            </div>\r\n          </div>\r\n        </CardHeader>\r\n        <CardContent>\r\n          {subscriptions.length === 0 ? (\r\n            <div className=\"text-center py-8 text-muted-foreground\">\r\n              No subscription submissions yet for this deal.\r\n            </div>\r\n          ) : (\r\n            <div className=\"space-y-2\">\r\n              {subscriptions.map((subscription) => (\r\n                <div\r\n                  key={subscription.id}\r\n                  className=\"flex items-center justify-between py-4 px-4 rounded-lg border border-border bg-muted/50 hover:bg-muted transition-colors\"\r\n                >\r\n                  <div className=\"flex items-center gap-4 flex-1\">\r\n                    <FileText className=\"h-5 w-5 text-muted-foreground\" />\r\n                    <div className=\"flex-1\">\r\n                      <div className=\"flex items-center gap-2 mb-1\">\r\n                        <span className=\"font-medium text-foreground\">\r\n                          {subscription.investors.legal_name}\r\n                        </span>\r\n                        <Badge className={statusColors[subscription.status] || statusColors.pending_review}>\r\n                          {subscription.status.replace(/_/g, ' ').toUpperCase()}\r\n                        </Badge>\r\n                      </div>\r\n                      <div className=\"flex items-center gap-4 text-sm text-muted-foreground\">\r\n                        <span>Amount: {formatAmount(subscription)}</span>\r\n                        <span>•</span>\r\n                        <span>Submitted {new Date(subscription.submitted_at).toLocaleDateString()}</span>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                  <div className=\"flex items-center gap-3\">\r\n                    <div className=\"text-right mr-2\">\r\n                      <div className=\"text-xs text-muted-foreground mb-1\">Subscription Pack</div>\r\n                      <Badge className={packStatusColors[subscription.pack_status || 'no_pack']}>\r\n                        {packStatusLabels[subscription.pack_status || 'no_pack']}\r\n                      </Badge>\r\n                    </div>\r\n                    {((subscription as any).subscription_id || subscription.pack_document_id) && (\r\n                      <Button\r\n                        variant=\"outline\"\r\n                        size=\"sm\"\r\n                        className=\"gap-2\"\r\n                        onClick={() => handleViewDetails(subscription)}\r\n                      >\r\n                        <ExternalLink className=\"h-4 w-4\" />\r\n                        {(subscription as any).subscription_id ? 'View Subscription' : 'View Pack'}\r\n                      </Button>\r\n                    )}\r\n                  </div>\r\n                </div>\r\n              ))}\r\n            </div>\r\n          )}\r\n        </CardContent>\r\n      </Card>\r\n\r\n      <Card className=\"border border-border bg-muted/50\">\r\n        <CardHeader>\r\n          <CardTitle className=\"text-sm text-foreground\">Pack Status Legend</CardTitle>\r\n        </CardHeader>\r\n        <CardContent>\r\n          <div className=\"grid grid-cols-2 md:grid-cols-5 gap-3 text-sm\">\r\n            <div className=\"flex items-center gap-2\">\r\n              <Badge className={packStatusColors.no_pack}>No Pack</Badge>\r\n              <span className=\"text-muted-foreground\">No document generated</span>\r\n            </div>\r\n            <div className=\"flex items-center gap-2\">\r\n              <Badge className={packStatusColors.draft}>Draft</Badge>\r\n              <span className=\"text-muted-foreground\">System generated draft</span>\r\n            </div>\r\n            <div className=\"flex items-center gap-2\">\r\n              <Badge className={packStatusColors.final}>Final</Badge>\r\n              <span className=\"text-muted-foreground\">Staff uploaded final</span>\r\n            </div>\r\n            <div className=\"flex items-center gap-2\">\r\n              <Badge className={packStatusColors.pending_signature}>Awaiting</Badge>\r\n              <span className=\"text-muted-foreground\">Sent for signatures</span>\r\n            </div>\r\n            <div className=\"flex items-center gap-2\">\r\n              <Badge className={packStatusColors.signed}>Executed</Badge>\r\n              <span className=\"text-muted-foreground\">All parties signed</span>\r\n            </div>\r\n          </div>\r\n        </CardContent>\r\n      </Card>\r\n    </div>\r\n  )\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 6738, "column": 0}, "map": {"version":3,"sources":["file:///Users/ghilesmoussaoui/Desktop/Versotech/versotech-portal/src/components/deals/faq-form-dialog.tsx"],"sourcesContent":["'use client'\n\nimport { useState, useEffect } from 'react'\nimport { Dialog, DialogContent, DialogDescription, DialogFooter, DialogHeader, DialogTitle } from '@/components/ui/dialog'\nimport { Button } from '@/components/ui/button'\nimport { Input } from '@/components/ui/input'\nimport { Textarea } from '@/components/ui/textarea'\nimport { Label } from '@/components/ui/label'\nimport { toast } from 'sonner'\nimport { Loader2 } from 'lucide-react'\n\ninterface FAQ {\n  id: string\n  question: string\n  answer: string\n  display_order: number\n  created_at: string\n  updated_at: string\n}\n\ninterface FaqFormDialogProps {\n  open: boolean\n  onOpenChange: (open: boolean) => void\n  dealId: string\n  faq: FAQ | null\n  onSave: () => void\n}\n\nexport function FaqFormDialog({ open, onOpenChange, dealId, faq, onSave }: FaqFormDialogProps) {\n  const [question, setQuestion] = useState('')\n  const [answer, setAnswer] = useState('')\n  const [loading, setLoading] = useState(false)\n\n  useEffect(() => {\n    if (faq) {\n      setQuestion(faq.question)\n      setAnswer(faq.answer)\n    } else {\n      setQuestion('')\n      setAnswer('')\n    }\n  }, [faq, open])\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault()\n\n    if (!question.trim() || !answer.trim()) {\n      toast.error('Question and answer are required')\n      return\n    }\n\n    setLoading(true)\n\n    try {\n      const url = faq\n        ? `/api/deals/${dealId}/faqs/${faq.id}`\n        : `/api/deals/${dealId}/faqs`\n\n      const method = faq ? 'PATCH' : 'POST'\n\n      const res = await fetch(url, {\n        method,\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ question, answer }),\n      })\n\n      const data = await res.json()\n\n      if (!res.ok) {\n        throw new Error(data.error || 'Failed to save FAQ')\n      }\n\n      toast.success(faq ? 'FAQ updated successfully' : 'FAQ created successfully')\n\n      onSave()\n      onOpenChange(false)\n    } catch (error) {\n      console.error('Error saving FAQ:', error)\n      toast.error(error instanceof Error ? error.message : 'Failed to save FAQ')\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent className=\"sm:max-w-[600px]\">\n        <form onSubmit={handleSubmit}>\n          <DialogHeader>\n            <DialogTitle>{faq ? 'Edit FAQ' : 'Add New FAQ'}</DialogTitle>\n            <DialogDescription>\n              {faq ? 'Update the question and answer' : 'Create a new frequently asked question for this deal'}\n            </DialogDescription>\n          </DialogHeader>\n          <div className=\"grid gap-4 py-4\">\n            <div className=\"grid gap-2\">\n              <Label htmlFor=\"question\">Question</Label>\n              <Input\n                id=\"question\"\n                value={question}\n                onChange={(e) => setQuestion(e.target.value)}\n                placeholder=\"e.g., What is the minimum investment amount?\"\n                maxLength={500}\n                required\n              />\n              <p className=\"text-xs text-muted-foreground\">\n                {question.length}/500 characters\n              </p>\n            </div>\n            <div className=\"grid gap-2\">\n              <Label htmlFor=\"answer\">Answer</Label>\n              <Textarea\n                id=\"answer\"\n                value={answer}\n                onChange={(e) => setAnswer(e.target.value)}\n                placeholder=\"Provide a clear and concise answer...\"\n                rows={6}\n                maxLength={5000}\n                required\n              />\n              <p className=\"text-xs text-muted-foreground\">\n                {answer.length}/5000 characters\n              </p>\n            </div>\n          </div>\n          <DialogFooter>\n            <Button\n              type=\"button\"\n              variant=\"outline\"\n              onClick={() => onOpenChange(false)}\n              disabled={loading}\n            >\n              Cancel\n            </Button>\n            <Button type=\"submit\" disabled={loading}>\n              {loading && <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />}\n              {faq ? 'Update' : 'Create'} FAQ\n            </Button>\n          </DialogFooter>\n        </form>\n      </DialogContent>\n    </Dialog>\n  )\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 7001, "column": 0}, "map": {"version":3,"sources":["file:///Users/ghilesmoussaoui/Desktop/Versotech/versotech-portal/src/components/deals/faq-item.tsx"],"sourcesContent":["'use client'\n\nimport { Card, CardContent } from '@/components/ui/card'\nimport { Button } from '@/components/ui/button'\nimport { Edit, Trash2 } from 'lucide-react'\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n  AlertDialogTrigger,\n} from '@/components/ui/alert-dialog'\n\ninterface FAQ {\n  id: string\n  question: string\n  answer: string\n  display_order: number\n  created_at: string\n  updated_at: string\n}\n\ninterface FaqItemProps {\n  faq: FAQ\n  onEdit: () => void\n  onDelete: () => void\n}\n\nexport function FaqItem({ faq, onEdit, onDelete }: FaqItemProps) {\n  return (\n    <Card>\n      <CardContent className=\"pt-6\">\n        <div className=\"flex items-start justify-between gap-4\">\n          <div className=\"flex-1 space-y-2\">\n            <h4 className=\"font-semibold text-sm\">{faq.question}</h4>\n            <p className=\"text-sm text-muted-foreground whitespace-pre-wrap\">\n              {faq.answer}\n            </p>\n          </div>\n          <div className=\"flex items-center gap-2\">\n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              onClick={onEdit}\n            >\n              <Edit className=\"h-4 w-4\" />\n            </Button>\n            <AlertDialog>\n              <AlertDialogTrigger asChild>\n                <Button variant=\"ghost\" size=\"sm\">\n                  <Trash2 className=\"h-4 w-4 text-destructive\" />\n                </Button>\n              </AlertDialogTrigger>\n              <AlertDialogContent>\n                <AlertDialogHeader>\n                  <AlertDialogTitle>Delete FAQ?</AlertDialogTitle>\n                  <AlertDialogDescription>\n                    Are you sure you want to delete this FAQ? This action cannot be undone.\n                  </AlertDialogDescription>\n                </AlertDialogHeader>\n                <AlertDialogFooter>\n                  <AlertDialogCancel>Cancel</AlertDialogCancel>\n                  <AlertDialogAction onClick={onDelete} className=\"bg-destructive text-destructive-foreground hover:bg-destructive/90\">\n                    Delete\n                  </AlertDialogAction>\n                </AlertDialogFooter>\n              </AlertDialogContent>\n            </AlertDialog>\n          </div>\n        </div>\n      </CardContent>\n    </Card>\n  )\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AAAA;AACA;AALA;;;;;;AAgCO,SAAS,QAAQ,EAAE,GAAG,EAAE,MAAM,EAAE,QAAQ,EAAgB;IAC7D,qBACE,oNAAC,kKAAI;kBACH,cAAA,oNAAC,yKAAW;YAAC,WAAU;sBACrB,cAAA,oNAAC;gBAAI,WAAU;;kCACb,oNAAC;wBAAI,WAAU;;0CACb,oNAAC;gCAAG,WAAU;0CAAyB,IAAI,QAAQ;;;;;;0CACnD,oNAAC;gCAAE,WAAU;0CACV,IAAI,MAAM;;;;;;;;;;;;kCAGf,oNAAC;wBAAI,WAAU;;0CACb,oNAAC,sKAAM;gCACL,SAAQ;gCACR,MAAK;gCACL,SAAS;0CAET,cAAA,oNAAC,6OAAI;oCAAC,WAAU;;;;;;;;;;;0CAElB,oNAAC,oLAAW;;kDACV,oNAAC,2LAAkB;wCAAC,OAAO;kDACzB,cAAA,oNAAC,sKAAM;4CAAC,SAAQ;4CAAQ,MAAK;sDAC3B,cAAA,oNAAC,8OAAM;gDAAC,WAAU;;;;;;;;;;;;;;;;kDAGtB,oNAAC,2LAAkB;;0DACjB,oNAAC,0LAAiB;;kEAChB,oNAAC,yLAAgB;kEAAC;;;;;;kEAClB,oNAAC,+LAAsB;kEAAC;;;;;;;;;;;;0DAI1B,oNAAC,0LAAiB;;kEAChB,oNAAC,0LAAiB;kEAAC;;;;;;kEACnB,oNAAC,0LAAiB;wDAAC,SAAS;wDAAU,WAAU;kEAAqE;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAWvI;KA7CgB"}},
    {"offset": {"line": 7185, "column": 0}, "map": {"version":3,"sources":["file:///Users/ghilesmoussaoui/Desktop/Versotech/versotech-portal/src/components/deals/deal-faq-tab.tsx"],"sourcesContent":["'use client'\n\nimport { useState, useEffect, useCallback } from 'react'\nimport { Button } from '@/components/ui/button'\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card'\nimport { Plus, Loader2, HelpCircle } from 'lucide-react'\nimport { FaqFormDialog } from './faq-form-dialog'\nimport { FaqItem } from './faq-item'\nimport { toast } from 'sonner'\n\ninterface FAQ {\n  id: string\n  question: string\n  answer: string\n  display_order: number\n  created_at: string\n  updated_at: string\n}\n\nexport function DealFaqTab({ dealId }: { dealId: string }) {\n  const [faqs, setFaqs] = useState<FAQ[]>([])\n  const [loading, setLoading] = useState(true)\n  const [showDialog, setShowDialog] = useState(false)\n  const [editingFaq, setEditingFaq] = useState<FAQ | null>(null)\n\n  const fetchFaqs = useCallback(async () => {\n    try {\n      const res = await fetch(`/api/deals/${dealId}/faqs`)\n      const data = await res.json()\n      setFaqs(data.faqs || [])\n    } catch (error) {\n      console.error('Error fetching FAQs:', error)\n      toast.error('Failed to load FAQs')\n    } finally {\n      setLoading(false)\n    }\n  }, [dealId])\n\n  useEffect(() => {\n    fetchFaqs()\n  }, [fetchFaqs])\n\n  const handleDelete = async (faqId: string) => {\n    try {\n      const res = await fetch(`/api/deals/${dealId}/faqs/${faqId}`, {\n        method: 'DELETE',\n      })\n\n      if (!res.ok) {\n        const data = await res.json()\n        throw new Error(data.error || 'Failed to delete')\n      }\n\n      setFaqs(faqs.filter((f) => f.id !== faqId))\n      toast.success('FAQ deleted successfully')\n    } catch (error) {\n      console.error('Error deleting FAQ:', error)\n      toast.error(error instanceof Error ? error.message : 'Failed to delete FAQ')\n    }\n  }\n\n  const handleEdit = (faq: FAQ) => {\n    setEditingFaq(faq)\n    setShowDialog(true)\n  }\n\n  const handleSave = () => {\n    fetchFaqs()\n    setShowDialog(false)\n    setEditingFaq(null)\n  }\n\n  const handleAddNew = () => {\n    setEditingFaq(null)\n    setShowDialog(true)\n  }\n\n  if (loading) {\n    return (\n      <div className=\"flex items-center justify-center py-12\">\n        <Loader2 className=\"h-6 w-6 animate-spin text-muted-foreground\" />\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      <Card>\n        <CardHeader>\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <div className=\"flex items-center gap-2\">\n                <HelpCircle className=\"h-5 w-5 text-primary\" />\n                <CardTitle>Deal FAQs</CardTitle>\n              </div>\n              <CardDescription className=\"mt-2\">\n                Manage frequently asked questions for this deal. Investors with data room access can view these FAQs.\n              </CardDescription>\n            </div>\n            <Button onClick={handleAddNew}>\n              <Plus className=\"h-4 w-4 mr-2\" />\n              Add FAQ\n            </Button>\n          </div>\n        </CardHeader>\n        <CardContent>\n          {faqs.length === 0 ? (\n            <div className=\"text-center py-12 border-2 border-dashed rounded-lg\">\n              <HelpCircle className=\"h-12 w-12 mx-auto text-muted-foreground mb-4\" />\n              <p className=\"text-muted-foreground font-medium mb-2\">No FAQs yet</p>\n              <p className=\"text-sm text-muted-foreground mb-4\">\n                Add frequently asked questions to help investors understand this deal better.\n              </p>\n              <Button onClick={handleAddNew} variant=\"outline\">\n                <Plus className=\"h-4 w-4 mr-2\" />\n                Add Your First FAQ\n              </Button>\n            </div>\n          ) : (\n            <div className=\"space-y-4\">\n              {faqs.map((faq) => (\n                <FaqItem\n                  key={faq.id}\n                  faq={faq}\n                  onEdit={() => handleEdit(faq)}\n                  onDelete={() => handleDelete(faq.id)}\n                />\n              ))}\n            </div>\n          )}\n        </CardContent>\n      </Card>\n\n      <FaqFormDialog\n        open={showDialog}\n        onOpenChange={(open) => {\n          setShowDialog(open)\n          if (!open) setEditingFaq(null)\n        }}\n        dealId={dealId}\n        faq={editingFaq}\n        onSave={handleSave}\n      />\n    </div>\n  )\n}\n"],"names":[],"mappings":"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"}}]
}