{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/ghilesmoussaoui/Desktop/Versotech/versotech-portal/src/lib/session-manager.ts"],"sourcesContent":["'use client'\r\n\r\n/**\r\n * Simplified Session Manager\r\n * \r\n * Provides basic session management utilities without forcing re-authentication.\r\n * Supabase handles session persistence and expiration automatically.\r\n */\r\n\r\nconst AUTH_KEY_HINTS = ['supabase', 'sb-', 'auth', 'supabase.auth.token']\r\n\r\nconst removeAuthKeys = (storage: Storage) => {\r\n  const keysToRemove = new Set<string>()\r\n\r\n  AUTH_KEY_HINTS.forEach((hint) => {\r\n    Object.keys(storage)\r\n      .filter((key) => key.includes(hint))\r\n      .forEach((key) => keysToRemove.add(key))\r\n  })\r\n\r\n  keysToRemove.forEach((key) => storage.removeItem(key))\r\n}\r\n\r\nclass SessionManager {\r\n  private static instance: SessionManager\r\n  private isInitialized = false\r\n\r\n  private constructor() {}\r\n\r\n  static getInstance(): SessionManager {\r\n    if (!SessionManager.instance) {\r\n      SessionManager.instance = new SessionManager()\r\n    }\r\n\r\n    return SessionManager.instance\r\n  }\r\n\r\n  /**\r\n   * Initialize session manager\r\n   * Sets up storage event listeners to handle cross-tab logout\r\n   */\r\n  init(): void {\r\n    if (this.isInitialized || typeof window === 'undefined') {\r\n      return\r\n    }\r\n\r\n    try {\r\n      this.isInitialized = true\r\n\r\n      // Listen for storage changes in other tabs (cross-tab logout)\r\n      window.addEventListener('storage', this.handleStorageChange)\r\n\r\n      console.info('[auth-session] Session manager initialized')\r\n    } catch (error) {\r\n      console.error('[auth-session] Failed to initialize session manager:', error)\r\n      this.isInitialized = false\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Clear all auth-related cookies\r\n   * Cookies need to be cleared with exact path and domain to work properly\r\n   */\r\n  private clearAuthCookies(): void {\r\n    if (typeof document === 'undefined') {\r\n      return\r\n    }\r\n\r\n    // Get all cookies\r\n    const cookies = document.cookie.split(';')\r\n    const authCookieNames: string[] = []\r\n\r\n    // Find all auth-related cookies\r\n    cookies.forEach(cookie => {\r\n      const cookieName = cookie.split('=')[0].trim()\r\n      if (AUTH_KEY_HINTS.some(hint => cookieName.includes(hint))) {\r\n        authCookieNames.push(cookieName)\r\n      }\r\n    })\r\n\r\n    // Clear each auth cookie with multiple path/domain combinations\r\n    authCookieNames.forEach(name => {\r\n      // Try various path combinations\r\n      const paths = ['/', '/versoholdings', '/versotech', '/versotech_main']\n      const domains = [window.location.hostname, `.${window.location.hostname}`, '']\r\n\r\n      paths.forEach(path => {\r\n        domains.forEach(domain => {\r\n          const domainStr = domain ? `domain=${domain};` : ''\r\n          document.cookie = `${name}=; ${domainStr}path=${path}; expires=Thu, 01 Jan 1970 00:00:00 GMT; max-age=0`\r\n        })\r\n      })\r\n    })\r\n\r\n    console.info('[auth-session] Cleared auth cookies:', authCookieNames)\r\n  }\r\n\r\n  /**\r\n   * Clear all auth data - localStorage, sessionStorage, and cookies\r\n   * This is the most comprehensive cleanup and should be used before re-authentication\r\n   */\r\n  clearAllAuthData(): void {\r\n    if (typeof window === 'undefined') {\r\n      return\r\n    }\r\n\r\n    console.info('[auth-session] Clearing ALL auth data (storage + cookies)')\r\n\r\n    // Clear storage\r\n    removeAuthKeys(window.localStorage)\r\n    removeAuthKeys(window.sessionStorage)\r\n\r\n    // Clear cookies\r\n    this.clearAuthCookies()\r\n  }\r\n\r\n  /**\r\n   * Force sign out by clearing all auth-related storage\r\n   * Used during logout to ensure clean state\r\n   */\r\n  forceSignOut(): void {\r\n    if (typeof window === 'undefined') {\r\n      return\r\n    }\r\n\r\n    console.info('[auth-session] Force sign out - clearing all auth state')\r\n\r\n    // Clear all local auth data\r\n    this.clearAllAuthData()\r\n\r\n    // Call logout API to clear server-side session\r\n    void fetch('/api/auth/logout', {\r\n      method: 'POST',\r\n      credentials: 'include',\r\n    }).catch((error) => {\r\n      console.error('[auth-session] Failed to revoke server session', error)\r\n    })\r\n  }\r\n\r\n  /**\r\n   * Handle storage changes from other tabs\r\n   * If auth keys are removed in another tab, redirect to login\r\n   */\r\n  private handleStorageChange = (event: StorageEvent): void => {\r\n    if (event.key && AUTH_KEY_HINTS.some((hint) => event.key?.includes(hint)) && event.newValue === null) {\r\n      console.info('[auth-session] Auth state cleared in another tab, redirecting to login')\r\n      window.location.href = '/versotech_main/login?error=signed_out'\n    }\r\n  }\r\n\r\n  /**\r\n   * Mark session as authenticated\r\n   * This is called after successful login to update session state\r\n   */\r\n  markAuthenticated(): void {\r\n    if (typeof window === 'undefined') {\r\n      return\r\n    }\r\n\r\n    console.info('[auth-session] Session marked as authenticated')\r\n  }\r\n\r\n  /**\r\n   * Get debug information about current session state\r\n   * Useful for troubleshooting auth issues\r\n   */\r\n  getDebugInfo(): Record<string, unknown> {\r\n    if (typeof window === 'undefined') {\r\n      return { error: 'Not in browser' }\r\n    }\r\n\r\n    return {\r\n      localStorageKeys: Object.keys(localStorage).filter((key) =>\r\n        AUTH_KEY_HINTS.some((hint) => key.includes(hint))\r\n      ),\r\n      sessionStorageKeys: Object.keys(sessionStorage).filter((key) =>\r\n        AUTH_KEY_HINTS.some((hint) => key.includes(hint))\r\n      ),\r\n    }\r\n  }\r\n}\r\n\r\nexport const sessionManager = SessionManager.getInstance()\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 161, "column": 0}, "map": {"version":3,"sources":["file:///Users/ghilesmoussaoui/Desktop/Versotech/versotech-portal/src/app/auth-init.tsx"],"sourcesContent":["'use client'\n\nimport { useEffect, useState } from 'react'\nimport { sessionManager } from '@/lib/session-manager'\n\n/**\n * Authentication initializer component\n * Should be included in the root layout to initialize session management\n */\nexport function AuthInit() {\n  const [isClient, setIsClient] = useState(false)\n\n  useEffect(() => {\n    setIsClient(true)\n    \n    // Only initialize on client side\n    if (typeof window !== 'undefined') {\n      try {\n        // Initialize aggressive session management\n        sessionManager.init()\n\n        // Debug info\n        if (process.env.NODE_ENV === 'development') {\n          console.log('[auth-session] Debug info:', sessionManager.getDebugInfo())\n        }\n      } catch (error) {\n        console.error('[auth-session] Initialization error:', error)\n      }\n    }\n  }, [])\n\n  // Prevent hydration mismatch by not rendering anything until client-side\n  if (!isClient) {\n    return null\n  }\n\n  return null // This component renders nothing\n}\n"],"names":[],"mappings":";;;;AAsBY;AApBZ;AACA;;AAHA;;;AASO,SAAS;;IACd,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,gMAAQ,EAAC;IAEzC,IAAA,iMAAS;8BAAC;YACR,YAAY;YAEZ,iCAAiC;YACjC,wCAAmC;gBACjC,IAAI;oBACF,2CAA2C;oBAC3C,4KAAc,CAAC,IAAI;oBAEnB,aAAa;oBACb,wCAA4C;wBAC1C,QAAQ,GAAG,CAAC,8BAA8B,4KAAc,CAAC,YAAY;oBACvE;gBACF,EAAE,OAAO,OAAO;oBACd,QAAQ,KAAK,CAAC,wCAAwC;gBACxD;YACF;QACF;6BAAG,EAAE;IAEL,yEAAyE;IACzE,IAAI,CAAC,UAAU;QACb,OAAO;IACT;IAEA,OAAO,KAAK,iCAAiC;;AAC/C;GA5BgB;KAAA"}}]
}