{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/ghilesmoussaoui/Desktop/Versotech/versotech-portal/src/components/profile/profile-image-upload.tsx"],"sourcesContent":["'use client'\n\nimport { useState, useRef } from 'react'\nimport { Avatar, AvatarFallback, AvatarImage } from '@/components/ui/avatar'\nimport { Button } from '@/components/ui/button'\nimport { Camera, Trash2, Upload, Loader2 } from 'lucide-react'\nimport { toast } from 'sonner'\n\ninterface ProfileImageUploadProps {\n  currentAvatarUrl?: string | null\n  userName: string\n  onAvatarUpdate: (newAvatarUrl: string) => void\n  /** Compact mode shows a smaller avatar (64x64) with minimal UI for inline header usage */\n  compact?: boolean\n}\n\nexport function ProfileImageUpload({\n  currentAvatarUrl,\n  userName,\n  onAvatarUpdate,\n  compact = false\n}: ProfileImageUploadProps) {\n  const [isUploading, setIsUploading] = useState(false)\n  const [isDeleting, setIsDeleting] = useState(false)\n  const [previewUrl, setPreviewUrl] = useState<string | null>(null)\n  const fileInputRef = useRef<HTMLInputElement>(null)\n\n  const getInitials = (name: string | null | undefined) => {\n    if (!name) return 'U'\n    return name\n      .split(' ')\n      .map(part => part[0])\n      .filter(Boolean)\n      .join('')\n      .toUpperCase()\n      .slice(0, 2) || 'U'\n  }\n\n  const handleFileSelect = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const file = e.target.files?.[0]\n    if (!file) return\n\n    // Validate file type\n    const allowedTypes = ['image/jpeg', 'image/png', 'image/gif', 'image/webp']\n    if (!allowedTypes.includes(file.type)) {\n      toast.error('Invalid file type', {\n        description: 'Please select a JPEG, PNG, GIF, or WEBP image'\n      })\n      return\n    }\n\n    // Validate file size (2MB max)\n    const maxSize = 2 * 1024 * 1024 // 2MB\n    if (file.size > maxSize) {\n      toast.error('File too large', {\n        description: 'Maximum file size is 2MB'\n      })\n      return\n    }\n\n    // Create preview\n    const reader = new FileReader()\n    reader.onloadend = () => {\n      setPreviewUrl(reader.result as string)\n    }\n    reader.readAsDataURL(file)\n\n    // Upload file\n    handleUpload(file)\n  }\n\n  const handleUpload = async (file: File) => {\n    setIsUploading(true)\n\n    try {\n      const formData = new FormData()\n      formData.append('avatar', file)\n\n      const response = await fetch('/api/profiles/avatar', {\n        method: 'POST',\n        body: formData\n      })\n\n      const data = await response.json()\n\n      if (!response.ok) {\n        throw new Error(data.error || 'Failed to upload avatar')\n      }\n\n      toast.success('Avatar updated successfully')\n      onAvatarUpdate(data.avatar_url)\n      setPreviewUrl(null)\n    } catch (error: any) {\n      console.error('Error uploading avatar:', error)\n      toast.error('Failed to upload avatar', {\n        description: error.message\n      })\n      setPreviewUrl(null)\n    } finally {\n      setIsUploading(false)\n      if (fileInputRef.current) {\n        fileInputRef.current.value = ''\n      }\n    }\n  }\n\n  const handleDelete = async () => {\n    if (!currentAvatarUrl) return\n\n    setIsDeleting(true)\n\n    try {\n      const response = await fetch('/api/profiles/avatar', {\n        method: 'DELETE'\n      })\n\n      const data = await response.json()\n\n      if (!response.ok) {\n        throw new Error(data.error || 'Failed to delete avatar')\n      }\n\n      toast.success('Avatar removed successfully')\n      onAvatarUpdate('')\n      setPreviewUrl(null)\n    } catch (error: any) {\n      console.error('Error deleting avatar:', error)\n      toast.error('Failed to delete avatar', {\n        description: error.message\n      })\n    } finally {\n      setIsDeleting(false)\n    }\n  }\n\n  const displayUrl = previewUrl || currentAvatarUrl\n\n  // Compact mode: smaller avatar for inline header usage\n  if (compact) {\n    return (\n      <div className=\"relative\">\n        <Avatar className=\"h-16 w-16 border-2 border-background shadow-md\">\n          <AvatarImage src={displayUrl || undefined} alt={userName} />\n          <AvatarFallback className=\"text-lg\">\n            {getInitials(userName)}\n          </AvatarFallback>\n        </Avatar>\n\n        {isUploading && (\n          <div className=\"absolute inset-0 flex items-center justify-center bg-background/80 rounded-full\">\n            <Loader2 className=\"h-5 w-5 animate-spin text-primary\" />\n          </div>\n        )}\n\n        <button\n          type=\"button\"\n          onClick={() => fileInputRef.current?.click()}\n          disabled={isUploading || isDeleting}\n          className=\"absolute -bottom-1 -right-1 p-1.5 bg-blue-600 text-white rounded-full shadow-lg hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed border border-blue-700\"\n        >\n          <Camera className=\"h-3 w-3\" />\n        </button>\n\n        <input\n          ref={fileInputRef}\n          type=\"file\"\n          accept=\"image/jpeg,image/png,image/gif,image/webp\"\n          className=\"hidden\"\n          onChange={handleFileSelect}\n          disabled={isUploading || isDeleting}\n        />\n      </div>\n    )\n  }\n\n  // Full mode: large avatar with buttons and instructions\n  return (\n    <div className=\"flex flex-col items-center gap-4\">\n      <div className=\"relative\">\n        <Avatar className=\"h-32 w-32 border-4 border-background shadow-lg\">\n          <AvatarImage src={displayUrl || undefined} alt={userName} />\n          <AvatarFallback className=\"text-2xl\">\n            {getInitials(userName)}\n          </AvatarFallback>\n        </Avatar>\n\n        {isUploading && (\n          <div className=\"absolute inset-0 flex items-center justify-center bg-background/80 rounded-full\">\n            <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\n          </div>\n        )}\n\n        <button\n          type=\"button\"\n          onClick={() => fileInputRef.current?.click()}\n          disabled={isUploading || isDeleting}\n          className=\"absolute bottom-0 right-0 p-2 bg-blue-600 text-white rounded-full shadow-lg hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed border border-blue-700\"\n        >\n          <Camera className=\"h-4 w-4\" />\n        </button>\n      </div>\n\n      <input\n        ref={fileInputRef}\n        type=\"file\"\n        accept=\"image/jpeg,image/png,image/gif,image/webp\"\n        className=\"hidden\"\n        onChange={handleFileSelect}\n        disabled={isUploading || isDeleting}\n      />\n\n      <div className=\"flex gap-2\">\n        <Button\n          type=\"button\"\n          variant=\"outline\"\n          size=\"sm\"\n          onClick={() => fileInputRef.current?.click()}\n          disabled={isUploading || isDeleting}\n        >\n          {isUploading ? (\n            <>\n              <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n              Uploading...\n            </>\n          ) : (\n            <>\n              <Upload className=\"mr-2 h-4 w-4\" />\n              Change Photo\n            </>\n          )}\n        </Button>\n\n        {currentAvatarUrl && (\n          <Button\n            type=\"button\"\n            variant=\"outline\"\n            size=\"sm\"\n            onClick={handleDelete}\n            disabled={isUploading || isDeleting}\n            className=\"hover:bg-red-50 hover:text-red-600 hover:border-red-200\"\n          >\n            {isDeleting ? (\n              <>\n                <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n                Removing...\n              </>\n            ) : (\n              <>\n                <Trash2 className=\"mr-2 h-4 w-4\" />\n                Remove\n              </>\n            )}\n          </Button>\n        )}\n      </div>\n\n      <p className=\"text-xs text-gray-600 text-center max-w-xs\">\n        Recommended: Square image, at least 200×200px\n        <br />\n        Max size: 2MB • Formats: JPEG, PNG, GIF, WEBP\n      </p>\n    </div>\n  )\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 395, "column": 0}, "map": {"version":3,"sources":["file:///Users/ghilesmoussaoui/Desktop/Versotech/versotech-portal/src/components/profile/profile-form.tsx"],"sourcesContent":["'use client'\n\nimport { useState } from 'react'\nimport { Button } from '@/components/ui/button'\nimport { Input } from '@/components/ui/input'\nimport { Label } from '@/components/ui/label'\nimport { Textarea } from '@/components/ui/textarea'\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card'\nimport { Loader2, Save } from 'lucide-react'\nimport { toast } from 'sonner'\n\ninterface ProfileFormProps {\n  userId: string\n  initialData: {\n    display_name: string | null\n    email: string | null\n    title: string | null\n    phone: string | null\n    office_location: string | null\n    bio: string | null\n    role: string\n  }\n  onUpdate: (updatedData: any) => void\n  showStaffFields?: boolean\n}\n\nexport function ProfileForm({\n  userId,\n  initialData,\n  onUpdate,\n  showStaffFields = false\n}: ProfileFormProps) {\n  const [isSubmitting, setIsSubmitting] = useState(false)\n  const [formData, setFormData] = useState({\n    display_name: initialData.display_name || '',\n    title: initialData.title || '',\n    phone: initialData.phone || '',\n    office_location: initialData.office_location || '',\n    bio: initialData.bio || ''\n  })\n\n  const handleChange = (\n    e: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement>\n  ) => {\n    const { name, value } = e.target\n    setFormData(prev => ({\n      ...prev,\n      [name]: value\n    }))\n  }\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault()\n    setIsSubmitting(true)\n\n    try {\n      const response = await fetch(`/api/profiles/${userId}`, {\n        method: 'PUT',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify(formData)\n      })\n\n      const data = await response.json()\n\n      if (!response.ok) {\n        throw new Error(data.error || 'Failed to update profile')\n      }\n\n      toast.success('Profile updated successfully')\n      onUpdate(data.profile)\n    } catch (error: any) {\n      console.error('Error updating profile:', error)\n      toast.error('Failed to update profile', {\n        description: error.message\n      })\n    } finally {\n      setIsSubmitting(false)\n    }\n  }\n\n  const hasChanges = JSON.stringify(formData) !== JSON.stringify({\n    display_name: initialData.display_name || '',\n    title: initialData.title || '',\n    phone: initialData.phone || '',\n    office_location: initialData.office_location || '',\n    bio: initialData.bio || ''\n  })\n\n  return (\n    <Card>\n      <CardHeader>\n        <CardTitle>Profile Information</CardTitle>\n        <CardDescription>\n          Update your personal information and profile details\n        </CardDescription>\n      </CardHeader>\n      <CardContent>\n        <form onSubmit={handleSubmit} className=\"space-y-4\">\n          <div className=\"space-y-2\">\n            <Label htmlFor=\"display_name\">\n              Display Name <span className=\"text-destructive\">*</span>\n            </Label>\n            <Input\n              id=\"display_name\"\n              name=\"display_name\"\n              value={formData.display_name}\n              onChange={handleChange}\n              required\n              placeholder=\"Enter your display name\"\n            />\n            <p className=\"text-xs text-gray-600\">\n              This is how your name will appear throughout the portal\n            </p>\n          </div>\n\n          <div className=\"space-y-2\">\n            <Label htmlFor=\"email\">Email Address</Label>\n            <Input\n              id=\"email\"\n              type=\"email\"\n              value={initialData.email || ''}\n              disabled\n            />\n            <p className=\"text-xs text-gray-600\">\n              Email cannot be changed here. Contact support to update your email.\n            </p>\n          </div>\n\n          <div className=\"space-y-2\">\n            <Label htmlFor=\"title\">Job Title / Position</Label>\n            <Input\n              id=\"title\"\n              name=\"title\"\n              value={formData.title}\n              onChange={handleChange}\n              placeholder=\"e.g., Portfolio Manager, Investment Director\"\n            />\n          </div>\n\n          {showStaffFields && (\n            <>\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"phone\">Phone Number</Label>\n                <Input\n                  id=\"phone\"\n                  name=\"phone\"\n                  type=\"tel\"\n                  value={formData.phone}\n                  onChange={handleChange}\n                  placeholder=\"+1 (555) 123-4567\"\n                />\n              </div>\n\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"office_location\">Office Location</Label>\n                <Input\n                  id=\"office_location\"\n                  name=\"office_location\"\n                  value={formData.office_location}\n                  onChange={handleChange}\n                  placeholder=\"e.g., London Office, New York HQ\"\n                />\n              </div>\n\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"bio\">Bio / About</Label>\n                <Textarea\n                  id=\"bio\"\n                  name=\"bio\"\n                  value={formData.bio}\n                  onChange={handleChange}\n                  placeholder=\"Brief description about yourself, your expertise, and role...\"\n                  rows={4}\n                  className=\"resize-none\"\n                />\n                <p className=\"text-xs text-gray-600\">\n                  {formData.bio.length}/500 characters\n                </p>\n              </div>\n            </>\n          )}\n\n          <div className=\"pt-4 border-t\">\n            <Button\n              type=\"submit\"\n              disabled={isSubmitting || !hasChanges}\n              className=\"w-full sm:w-auto\"\n            >\n              {isSubmitting ? (\n                <>\n                  <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n                  Saving Changes...\n                </>\n              ) : (\n                <>\n                  <Save className=\"mr-2 h-4 w-4\" />\n                  Save Changes\n                </>\n              )}\n            </Button>\n\n            {hasChanges && !isSubmitting && (\n              <p className=\"text-xs text-gray-600 mt-2\">\n                You have unsaved changes\n              </p>\n            )}\n          </div>\n        </form>\n      </CardContent>\n    </Card>\n  )\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 789, "column": 0}, "map": {"version":3,"sources":["file:///Users/ghilesmoussaoui/Desktop/Versotech/versotech-portal/src/components/profile/password-change-form.tsx"],"sourcesContent":["'use client'\n\nimport { useState } from 'react'\nimport { Button } from '@/components/ui/button'\nimport { Input } from '@/components/ui/input'\nimport { Label } from '@/components/ui/label'\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card'\nimport { Loader2, Lock, Eye, EyeOff, Check, X } from 'lucide-react'\nimport { toast } from 'sonner'\n\nexport function PasswordChangeForm() {\n  const [isSubmitting, setIsSubmitting] = useState(false)\n  const [showCurrentPassword, setShowCurrentPassword] = useState(false)\n  const [showNewPassword, setShowNewPassword] = useState(false)\n  const [showConfirmPassword, setShowConfirmPassword] = useState(false)\n\n  const [formData, setFormData] = useState({\n    currentPassword: '',\n    newPassword: '',\n    confirmPassword: ''\n  })\n\n  const handleChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const { name, value } = e.target\n    setFormData(prev => ({\n      ...prev,\n      [name]: value\n    }))\n  }\n\n  const validatePassword = (password: string) => {\n    const checks = {\n      length: password.length >= 8,\n      uppercase: /[A-Z]/.test(password),\n      lowercase: /[a-z]/.test(password),\n      number: /[0-9]/.test(password),\n      special: /[!@#$%^&*(),.?\":{}|<>]/.test(password)\n    }\n    return checks\n  }\n\n  const passwordChecks = validatePassword(formData.newPassword)\n  const isPasswordValid = Object.values(passwordChecks).every(check => check)\n  const passwordsMatch = formData.newPassword === formData.confirmPassword && formData.confirmPassword !== ''\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault()\n\n    if (!isPasswordValid) {\n      toast.error('Password does not meet requirements')\n      return\n    }\n\n    if (!passwordsMatch) {\n      toast.error('Passwords do not match')\n      return\n    }\n\n    setIsSubmitting(true)\n\n    try {\n      const response = await fetch('/api/auth/password', {\n        method: 'PUT',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          currentPassword: formData.currentPassword,\n          newPassword: formData.newPassword\n        })\n      })\n\n      const data = await response.json()\n\n      if (!response.ok) {\n        throw new Error(data.error || 'Failed to update password')\n      }\n\n      toast.success('Password updated successfully')\n\n      // Reset form\n      setFormData({\n        currentPassword: '',\n        newPassword: '',\n        confirmPassword: ''\n      })\n    } catch (error: any) {\n      console.error('Error updating password:', error)\n      toast.error('Failed to update password', {\n        description: error.message\n      })\n    } finally {\n      setIsSubmitting(false)\n    }\n  }\n\n  const PasswordRequirement = ({ met, text }: { met: boolean; text: string }) => (\n    <div className=\"flex items-center gap-2 text-sm\">\n      {met ? (\n        <Check className=\"h-4 w-4 text-green-500\" />\n      ) : (\n        <X className=\"h-4 w-4 text-gray-400\" />\n      )}\n      <span className={met ? 'text-green-600' : 'text-gray-600'}>\n        {text}\n      </span>\n    </div>\n  )\n\n  return (\n    <Card>\n      <CardHeader>\n        <CardTitle>Change Password</CardTitle>\n        <CardDescription>\n          Update your password to keep your account secure\n        </CardDescription>\n      </CardHeader>\n      <CardContent>\n        <form onSubmit={handleSubmit} className=\"space-y-4\">\n          <div className=\"space-y-2\">\n            <Label htmlFor=\"currentPassword\">\n              Current Password <span className=\"text-destructive\">*</span>\n            </Label>\n            <div className=\"relative\">\n              <Input\n                id=\"currentPassword\"\n                name=\"currentPassword\"\n                type={showCurrentPassword ? 'text' : 'password'}\n                value={formData.currentPassword}\n                onChange={handleChange}\n                required\n                placeholder=\"Enter your current password\"\n              />\n              <button\n                type=\"button\"\n                onClick={() => setShowCurrentPassword(!showCurrentPassword)}\n                className=\"absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 hover:text-gray-700\"\n              >\n                {showCurrentPassword ? (\n                  <EyeOff className=\"h-4 w-4\" />\n                ) : (\n                  <Eye className=\"h-4 w-4\" />\n                )}\n              </button>\n            </div>\n          </div>\n\n          <div className=\"space-y-2\">\n            <Label htmlFor=\"newPassword\">\n              New Password <span className=\"text-destructive\">*</span>\n            </Label>\n            <div className=\"relative\">\n              <Input\n                id=\"newPassword\"\n                name=\"newPassword\"\n                type={showNewPassword ? 'text' : 'password'}\n                value={formData.newPassword}\n                onChange={handleChange}\n                required\n                placeholder=\"Enter your new password\"\n              />\n              <button\n                type=\"button\"\n                onClick={() => setShowNewPassword(!showNewPassword)}\n                className=\"absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 hover:text-gray-700\"\n              >\n                {showNewPassword ? (\n                  <EyeOff className=\"h-4 w-4\" />\n                ) : (\n                  <Eye className=\"h-4 w-4\" />\n                )}\n              </button>\n            </div>\n\n            {formData.newPassword && (\n              <div className=\"mt-3 space-y-1 p-3 bg-gray-50 rounded-md border border-gray-200\">\n                <p className=\"text-sm font-medium mb-2 text-gray-900\">Password Requirements:</p>\n                <PasswordRequirement met={passwordChecks.length} text=\"At least 8 characters\" />\n                <PasswordRequirement met={passwordChecks.uppercase} text=\"One uppercase letter\" />\n                <PasswordRequirement met={passwordChecks.lowercase} text=\"One lowercase letter\" />\n                <PasswordRequirement met={passwordChecks.number} text=\"One number\" />\n                <PasswordRequirement met={passwordChecks.special} text=\"One special character\" />\n              </div>\n            )}\n          </div>\n\n          <div className=\"space-y-2\">\n            <Label htmlFor=\"confirmPassword\">\n              Confirm New Password <span className=\"text-destructive\">*</span>\n            </Label>\n            <div className=\"relative\">\n              <Input\n                id=\"confirmPassword\"\n                name=\"confirmPassword\"\n                type={showConfirmPassword ? 'text' : 'password'}\n                value={formData.confirmPassword}\n                onChange={handleChange}\n                required\n                placeholder=\"Confirm your new password\"\n              />\n              <button\n                type=\"button\"\n                onClick={() => setShowConfirmPassword(!showConfirmPassword)}\n                className=\"absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 hover:text-gray-700\"\n              >\n                {showConfirmPassword ? (\n                  <EyeOff className=\"h-4 w-4\" />\n                ) : (\n                  <Eye className=\"h-4 w-4\" />\n                )}\n              </button>\n            </div>\n\n            {formData.confirmPassword && (\n              <div className=\"flex items-center gap-2 text-sm\">\n                {passwordsMatch ? (\n                  <>\n                    <Check className=\"h-4 w-4 text-green-500\" />\n                    <span className=\"text-green-600\">Passwords match</span>\n                  </>\n                ) : (\n                  <>\n                    <X className=\"h-4 w-4 text-destructive\" />\n                    <span className=\"text-destructive\">Passwords do not match</span>\n                  </>\n                )}\n              </div>\n            )}\n          </div>\n\n          <div className=\"pt-4 border-t\">\n            <Button\n              type=\"submit\"\n              disabled={\n                isSubmitting ||\n                !formData.currentPassword ||\n                !isPasswordValid ||\n                !passwordsMatch\n              }\n              className=\"w-full sm:w-auto\"\n            >\n              {isSubmitting ? (\n                <>\n                  <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n                  Updating Password...\n                </>\n              ) : (\n                <>\n                  <Lock className=\"mr-2 h-4 w-4\" />\n                  Update Password\n                </>\n              )}\n            </Button>\n          </div>\n        </form>\n      </CardContent>\n    </Card>\n  )\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1330, "column": 0}, "map": {"version":3,"sources":["file:///Users/ghilesmoussaoui/Desktop/Versotech/versotech-portal/src/components/profile/kyc-upload-dialog.tsx"],"sourcesContent":["'use client'\r\n\r\nimport { useState, useMemo, useEffect } from 'react'\r\nimport { toast } from 'sonner'\r\nimport {\r\n  Dialog,\r\n  DialogContent,\r\n  DialogDescription,\r\n  DialogFooter,\r\n  DialogHeader,\r\n  DialogTitle,\r\n} from '@/components/ui/dialog'\r\nimport { Button } from '@/components/ui/button'\r\nimport { Label } from '@/components/ui/label'\r\nimport { Input } from '@/components/ui/input'\r\nimport { Textarea } from '@/components/ui/textarea'\r\nimport {\r\n  Select,\r\n  SelectContent,\r\n  SelectItem,\r\n  SelectTrigger,\r\n  SelectValue,\r\n} from '@/components/ui/select'\r\nimport { Upload, Loader2, Info, Building2, User, AlertCircle } from 'lucide-react'\r\nimport { getEntityDocumentTypes, getMemberDocumentTypes, getIndividualDocumentTypes } from '@/constants/kyc-document-types'\r\nimport { Alert, AlertDescription } from '@/components/ui/alert'\r\n\r\ninterface Member {\r\n  id: string\r\n  full_name: string\r\n  role: string\r\n}\r\n\r\ninterface KYCUploadDialogProps {\r\n  open: boolean\r\n  onOpenChange: (open: boolean) => void\r\n  onUploadSuccess: () => void\r\n  entityId?: string | null\r\n  category?: 'individual' | 'entity' | 'both'\r\n  members?: Member[]\r\n  memberType?: 'investor' | 'counterparty'\r\n}\r\n\r\nexport function KYCUploadDialog({\r\n  open,\r\n  onOpenChange,\r\n  onUploadSuccess,\r\n  entityId = null,\r\n  category = 'both',\r\n  members = [],\r\n  memberType\r\n}: KYCUploadDialogProps) {\r\n  const [file, setFile] = useState<File | null>(null)\r\n  const [documentType, setDocumentType] = useState<string>('')\r\n  const [customLabel, setCustomLabel] = useState<string>('')\r\n  const [expiryDate, setExpiryDate] = useState<string>('')\r\n  const [notes, setNotes] = useState<string>('')\r\n  const [uploadTarget, setUploadTarget] = useState<string>('')\r\n  const [isUploading, setIsUploading] = useState(false)\r\n\r\n  const isEntityInvestor = category === 'entity'\r\n  const isForMember = uploadTarget && uploadTarget !== 'entity-level'\r\n  const hasMembers = members.length > 0\r\n\r\n  // Get document types based on selection\r\n  const availableDocumentTypes = useMemo(() => {\r\n    if (!isEntityInvestor) {\r\n      // Individual investor - simple personal docs\r\n      return getIndividualDocumentTypes()\r\n    }\r\n\r\n    if (isForMember) {\r\n      // Uploading for a specific member - personal ID docs\r\n      return getMemberDocumentTypes()\r\n    }\r\n\r\n    // Entity-level docs\r\n    return getEntityDocumentTypes()\r\n  }, [isEntityInvestor, isForMember])\r\n\r\n  // Reset document type when target changes\r\n  useEffect(() => {\r\n    setDocumentType('')\r\n  }, [uploadTarget])\r\n\r\n  // Reset form when dialog opens\r\n  useEffect(() => {\r\n    if (open) {\r\n      setFile(null)\r\n      setDocumentType('')\r\n      setCustomLabel('')\r\n      setExpiryDate('')\r\n      setNotes('')\r\n      setUploadTarget('')\r\n    }\r\n  }, [open])\r\n\r\n  const handleFileChange = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    const selectedFile = e.target.files?.[0]\r\n    if (selectedFile) {\r\n      if (selectedFile.size > 10 * 1024 * 1024) {\r\n        toast.error('File too large', { description: 'Maximum file size is 10MB' })\r\n        return\r\n      }\r\n\r\n      const allowedTypes = ['application/pdf', 'image/jpeg', 'image/jpg', 'image/png', 'image/heic', 'image/webp']\r\n      if (!allowedTypes.includes(selectedFile.type)) {\r\n        toast.error('Invalid file type', { description: 'Only PDF and image files are allowed' })\r\n        return\r\n      }\r\n\r\n      setFile(selectedFile)\r\n    }\r\n  }\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault()\r\n\r\n    if (!file) {\r\n      toast.error('Please select a file')\r\n      return\r\n    }\r\n\r\n    if (isEntityInvestor && !uploadTarget) {\r\n      toast.error('Please select who this document is for')\r\n      return\r\n    }\r\n\r\n    if (!documentType) {\r\n      toast.error('Please select a document type')\r\n      return\r\n    }\r\n\r\n    setIsUploading(true)\r\n\r\n    try {\r\n      const formData = new FormData()\r\n      formData.append('file', file)\r\n      formData.append('documentType', documentType === 'custom' ? customLabel.toLowerCase().replace(/\\s+/g, '_') : documentType)\r\n\r\n      if (documentType === 'custom' && customLabel) {\r\n        formData.append('customLabel', customLabel)\r\n      }\r\n\r\n      if (expiryDate) {\r\n        formData.append('expiryDate', expiryDate)\r\n      }\r\n\r\n      if (notes) {\r\n        formData.append('notes', notes)\r\n      }\r\n\r\n      if (entityId) {\r\n        formData.append('entityId', entityId)\r\n      }\r\n\r\n      // Add member ID if uploading for a specific member\r\n      if (isForMember && memberType) {\r\n        if (memberType === 'investor') {\r\n          formData.append('investorMemberId', uploadTarget)\r\n        } else if (memberType === 'counterparty') {\r\n          formData.append('counterpartyMemberId', uploadTarget)\r\n        }\r\n      }\r\n\r\n      const response = await fetch('/api/investors/me/documents/upload', {\r\n        method: 'POST',\r\n        body: formData\r\n      })\r\n\r\n      const data = await response.json()\r\n\r\n      if (!response.ok) {\r\n        throw new Error(data.error || 'Failed to upload document')\r\n      }\r\n\r\n      toast.success('Document uploaded successfully')\r\n      onOpenChange(false)\r\n      onUploadSuccess()\r\n\r\n    } catch (error: any) {\r\n      console.error('Upload error:', error)\r\n      toast.error('Upload failed', { description: error.message })\r\n    } finally {\r\n      setIsUploading(false)\r\n    }\r\n  }\r\n\r\n  return (\r\n    <Dialog open={open} onOpenChange={onOpenChange}>\r\n      <DialogContent className=\"sm:max-w-[500px]\">\r\n        <DialogHeader>\r\n          <DialogTitle>Upload KYC Document</DialogTitle>\r\n          <DialogDescription>\r\n            {isEntityInvestor\r\n              ? 'Upload entity documents or member ID documents'\r\n              : 'Upload your ID and proof of address'}\r\n          </DialogDescription>\r\n        </DialogHeader>\r\n\r\n        <form onSubmit={handleSubmit} className=\"space-y-4\">\r\n          {/* STEP 1: For entity investors - WHO is this document for? */}\r\n          {isEntityInvestor && (\r\n            <div className=\"space-y-2\">\r\n              <Label className=\"text-base font-semibold\">\r\n                Step 1: Who is this document for?\r\n              </Label>\r\n              <Select value={uploadTarget} onValueChange={setUploadTarget}>\r\n                <SelectTrigger className={!uploadTarget ? 'border-amber-400 bg-amber-50' : ''}>\r\n                  <SelectValue placeholder=\"Select...\" />\r\n                </SelectTrigger>\r\n                <SelectContent>\r\n                  {/* Entity option - always available */}\r\n                  <SelectItem value=\"entity-level\">\r\n                    <div className=\"flex items-center gap-2\">\r\n                      <Building2 className=\"h-4 w-4 text-blue-600\" />\r\n                      <span className=\"font-medium\">Entity (Company Documents)</span>\r\n                    </div>\r\n                  </SelectItem>\r\n\r\n                  {/* Member options - if members exist */}\r\n                  {hasMembers && members.map((member) => (\r\n                    <SelectItem key={member.id} value={member.id}>\r\n                      <div className=\"flex items-center gap-2\">\r\n                        <User className=\"h-4 w-4 text-green-600\" />\r\n                        <span>{member.full_name}</span>\r\n                        <span className=\"text-muted-foreground text-xs\">({member.role})</span>\r\n                      </div>\r\n                    </SelectItem>\r\n                  ))}\r\n                </SelectContent>\r\n              </Select>\r\n\r\n              {/* Helpful description */}\r\n              {uploadTarget === 'entity-level' && (\r\n                <p className=\"text-sm text-blue-600\">\r\n                  Entity docs: Incorporation Certificate, Memo & Articles, Registers, Bank Confirmation\r\n                </p>\r\n              )}\r\n              {isForMember && (\r\n                <p className=\"text-sm text-green-600\">\r\n                  Member docs: Passport/ID, Proof of Address\r\n                </p>\r\n              )}\r\n\r\n              {/* Alert if no members */}\r\n              {!hasMembers && (\r\n                <Alert className=\"border-amber-300 bg-amber-50\">\r\n                  <AlertCircle className=\"h-4 w-4 text-amber-600\" />\r\n                  <AlertDescription className=\"text-amber-800\">\r\n                    <strong>No members added yet.</strong> To upload ID documents for Directors/UBOs,\r\n                    first add them in the <span className=\"font-semibold\">Directors/UBOs tab</span>.\r\n                  </AlertDescription>\r\n                </Alert>\r\n              )}\r\n            </div>\r\n          )}\r\n\r\n          {/* STEP 2: Document Type */}\r\n          <div className=\"space-y-2\">\r\n            <Label className={isEntityInvestor ? \"text-base font-semibold\" : \"\"}>\r\n              {isEntityInvestor ? 'Step 2: Document Type' : 'Document Type'}\r\n            </Label>\r\n            <Select\r\n              value={documentType}\r\n              onValueChange={setDocumentType}\r\n              disabled={isEntityInvestor && !uploadTarget}\r\n            >\r\n              <SelectTrigger className={isEntityInvestor && !uploadTarget ? 'opacity-50' : ''}>\r\n                <SelectValue placeholder={isEntityInvestor && !uploadTarget ? 'First select who...' : 'Select document type...'} />\r\n              </SelectTrigger>\r\n              <SelectContent>\r\n                {availableDocumentTypes.map((type) => (\r\n                  <SelectItem key={type.value} value={type.value}>\r\n                    {type.label}\r\n                  </SelectItem>\r\n                ))}\r\n                <SelectItem value=\"custom\">Other (Custom)</SelectItem>\r\n              </SelectContent>\r\n            </Select>\r\n            {documentType && documentType !== 'custom' && (\r\n              <p className=\"text-xs text-muted-foreground\">\r\n                {availableDocumentTypes.find(t => t.value === documentType)?.description}\r\n              </p>\r\n            )}\r\n          </div>\r\n\r\n          {/* Custom label if \"Other\" selected */}\r\n          {documentType === 'custom' && (\r\n            <div className=\"space-y-2\">\r\n              <Label>Custom Document Name</Label>\r\n              <Input\r\n                value={customLabel}\r\n                onChange={(e) => setCustomLabel(e.target.value)}\r\n                placeholder=\"e.g., Trust Agreement\"\r\n                required\r\n              />\r\n            </div>\r\n          )}\r\n\r\n          {/* File Upload */}\r\n          <div className=\"space-y-2\">\r\n            <Label>File</Label>\r\n            <Input\r\n              type=\"file\"\r\n              accept=\".pdf,.jpg,.jpeg,.png,.heic,.webp\"\r\n              onChange={handleFileChange}\r\n              required\r\n            />\r\n            {file && (\r\n              <p className=\"text-xs text-muted-foreground\">\r\n                Selected: {file.name} ({(file.size / 1024 / 1024).toFixed(2)} MB)\r\n              </p>\r\n            )}\r\n            <p className=\"text-xs text-muted-foreground\">\r\n              Max 10MB. PDF, JPEG, PNG, HEIC, WEBP accepted.\r\n            </p>\r\n          </div>\r\n\r\n          {/* Expiry Date */}\r\n          <div className=\"space-y-2\">\r\n            <Label>Expiry Date (Optional)</Label>\r\n            <Input\r\n              type=\"date\"\r\n              value={expiryDate}\r\n              onChange={(e) => setExpiryDate(e.target.value)}\r\n            />\r\n          </div>\r\n\r\n          {/* Notes */}\r\n          <div className=\"space-y-2\">\r\n            <Label>Notes (Optional)</Label>\r\n            <Textarea\r\n              value={notes}\r\n              onChange={(e) => setNotes(e.target.value)}\r\n              placeholder=\"Any additional info...\"\r\n              rows={2}\r\n            />\r\n          </div>\r\n\r\n          <DialogFooter>\r\n            <Button type=\"button\" variant=\"outline\" onClick={() => onOpenChange(false)} disabled={isUploading}>\r\n              Cancel\r\n            </Button>\r\n            <Button\r\n              type=\"submit\"\r\n              disabled={isUploading || !file || !documentType || (isEntityInvestor && !uploadTarget) || (documentType === 'custom' && !customLabel.trim())}\r\n            >\r\n              {isUploading ? (\r\n                <>\r\n                  <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\r\n                  Uploading...\r\n                </>\r\n              ) : (\r\n                <>\r\n                  <Upload className=\"mr-2 h-4 w-4\" />\r\n                  Upload\r\n                </>\r\n              )}\r\n            </Button>\r\n          </DialogFooter>\r\n        </form>\r\n      </DialogContent>\r\n    </Dialog>\r\n  )\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1992, "column": 0}, "map": {"version":3,"sources":["file:///Users/ghilesmoussaoui/Desktop/Versotech/versotech-portal/src/components/profile/kyc-documents-tab.tsx"],"sourcesContent":["'use client'\r\n\r\nimport { useState, useEffect } from 'react'\r\nimport { Upload, CheckCircle, XCircle, Clock, Download, AlertCircle, Info, Loader2, FileText, User } from 'lucide-react'\r\nimport { Button } from '@/components/ui/button'\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card'\r\nimport { Badge } from '@/components/ui/badge'\r\nimport { Alert, AlertDescription } from '@/components/ui/alert'\r\nimport {\r\n  Table,\r\n  TableBody,\r\n  TableCell,\r\n  TableHead,\r\n  TableHeader,\r\n  TableRow,\r\n} from '@/components/ui/table'\r\nimport { toast } from 'sonner'\r\nimport { KYCUploadDialog } from './kyc-upload-dialog'\r\nimport { getDocumentTypeLabel } from '@/constants/kyc-document-types'\r\n\r\ninterface KYCSubmission {\r\n  id: string\r\n  document_type: string\r\n  custom_label?: string | null\r\n  status: string\r\n  submitted_at: string\r\n  created_at: string\r\n  expiry_date?: string | null\r\n  version: number\r\n  metadata?: any\r\n  rejection_reason?: string | null\r\n  document?: {\r\n    id: string\r\n    name: string\r\n    file_key: string\r\n    file_size_bytes: number\r\n    mime_type: string\r\n    created_at: string\r\n  }\r\n  reviewer?: {\r\n    display_name?: string\r\n    email?: string\r\n  } | null\r\n  investor_member?: {\r\n    id: string\r\n    full_name: string\r\n    role: string\r\n  } | null\r\n}\r\n\r\ninterface InvestorMember {\r\n  id: string\r\n  full_name: string\r\n  role: string\r\n}\r\n\r\nexport function KYCDocumentsTab() {\r\n  const [submissions, setSubmissions] = useState<KYCSubmission[]>([])\r\n  const [investorMembers, setInvestorMembers] = useState<InvestorMember[]>([])\r\n  const [isEntityInvestor, setIsEntityInvestor] = useState(false)\r\n  const [loading, setLoading] = useState(true)\r\n  const [uploadDialogOpen, setUploadDialogOpen] = useState(false)\r\n  const [downloadingId, setDownloadingId] = useState<string | null>(null)\r\n\r\n  useEffect(() => {\r\n    loadSubmissions()\r\n  }, [])\r\n\r\n  const loadSubmissions = async () => {\r\n    setLoading(true)\r\n    try {\r\n      const response = await fetch('/api/investors/me/kyc-submissions')\r\n      if (!response.ok) throw new Error('Failed to load KYC submissions')\r\n\r\n      const data = await response.json()\r\n      setSubmissions(data.submissions || [])\r\n      setInvestorMembers(data.investor_members || [])\r\n      setIsEntityInvestor(data.is_entity_investor || false)\r\n    } catch (error: any) {\r\n      console.error('Error loading KYC submissions:', error)\r\n      toast.error('Failed to load KYC documents', {\r\n        description: error.message\r\n      })\r\n    } finally {\r\n      setLoading(false)\r\n    }\r\n  }\r\n\r\n  const handleDownload = async (documentId: string, fileName: string) => {\r\n    setDownloadingId(documentId)\r\n    try {\r\n      const response = await fetch(`/api/documents/${documentId}/download`)\r\n\r\n      if (!response.ok) {\r\n        throw new Error('Failed to download document')\r\n      }\r\n\r\n      const blob = await response.blob()\r\n      const url = window.URL.createObjectURL(blob)\r\n      const a = document.createElement('a')\r\n      a.href = url\r\n      a.download = fileName\r\n      document.body.appendChild(a)\r\n      a.click()\r\n      window.URL.revokeObjectURL(url)\r\n      document.body.removeChild(a)\r\n\r\n      toast.success('Download started')\r\n    } catch (error: any) {\r\n      console.error('Download error:', error)\r\n      toast.error('Download failed', {\r\n        description: error.message\r\n      })\r\n    } finally {\r\n      setDownloadingId(null)\r\n    }\r\n  }\r\n\r\n  const getStatusBadge = (status: string) => {\r\n    switch (status) {\r\n      case 'approved':\r\n        return (\r\n          <Badge variant=\"default\" className=\"bg-emerald-500/20 text-emerald-700 border-emerald-500/30\">\r\n            <CheckCircle className=\"mr-1 h-3 w-3\" />\r\n            Approved\r\n          </Badge>\r\n        )\r\n      case 'pending':\r\n        return (\r\n          <Badge variant=\"secondary\" className=\"bg-amber-500/20 text-amber-700 border-amber-500/30\">\r\n            <Clock className=\"mr-1 h-3 w-3\" />\r\n            Pending Review\r\n          </Badge>\r\n        )\r\n      case 'draft':\r\n        return (\r\n          <Badge variant=\"outline\" className=\"bg-slate-500/10 text-slate-600 border-slate-500/30\">\r\n            <Clock className=\"mr-1 h-3 w-3\" />\r\n            Draft (Not Submitted)\r\n          </Badge>\r\n        )\r\n      case 'rejected':\r\n        return (\r\n          <Badge variant=\"destructive\" className=\"bg-rose-500/20 text-rose-700 border-rose-500/30\">\r\n            <XCircle className=\"mr-1 h-3 w-3\" />\r\n            Rejected\r\n          </Badge>\r\n        )\r\n      case 'expired':\r\n        return (\r\n          <Badge variant=\"outline\" className=\"bg-gray-500/20 text-gray-700 border-gray-500/30\">\r\n            <AlertCircle className=\"mr-1 h-3 w-3\" />\r\n            Expired\r\n          </Badge>\r\n        )\r\n      case 'under_review':\r\n        return (\r\n          <Badge variant=\"secondary\" className=\"bg-blue-500/20 text-blue-700 border-blue-500/30\">\r\n            <Clock className=\"mr-1 h-3 w-3\" />\r\n            Under Review\r\n          </Badge>\r\n        )\r\n      default:\r\n        return <Badge variant=\"outline\">{status}</Badge>\r\n    }\r\n  }\r\n\r\n  const formatDate = (dateString: string) => {\r\n    return new Date(dateString).toLocaleDateString('en-US', {\r\n      year: 'numeric',\r\n      month: 'short',\r\n      day: 'numeric'\r\n    })\r\n  }\r\n\r\n  const formatFileSize = (bytes: number) => {\r\n    if (bytes < 1024) return bytes + ' B'\r\n    if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB'\r\n    return (bytes / (1024 * 1024)).toFixed(1) + ' MB'\r\n  }\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"flex items-center justify-center py-12\">\r\n        <Loader2 className=\"h-8 w-8 animate-spin text-gray-400\" />\r\n      </div>\r\n    )\r\n  }\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      <Card>\r\n        <CardHeader>\r\n          <div className=\"flex items-center justify-between\">\r\n            <div>\r\n              <CardTitle>KYC Documents</CardTitle>\r\n              <CardDescription>\r\n                Upload your required KYC verification documents\r\n              </CardDescription>\r\n            </div>\r\n            <Button onClick={() => setUploadDialogOpen(true)}>\r\n              <Upload className=\"mr-2 h-4 w-4\" />\r\n              Upload Document\r\n            </Button>\r\n          </div>\r\n        </CardHeader>\r\n        <CardContent className=\"space-y-4\">\r\n          {/* Required Documents Breakdown */}\r\n          {isEntityInvestor ? (\r\n            <div className=\"grid gap-4 md:grid-cols-2\">\r\n              <div className=\"p-4 border rounded-lg bg-blue-50/50\">\r\n                <h4 className=\"font-medium text-sm text-blue-900 mb-2\">Entity Documents</h4>\r\n                <ul className=\"text-sm text-blue-800 space-y-1\">\r\n                  <li>• Incorporation Certificate</li>\r\n                  <li>• Memo & Articles</li>\r\n                  <li>• Register of Directors</li>\r\n                  <li>• Register of Members/Shareholders</li>\r\n                  <li>• Register of UBOs</li>\r\n                  <li>• Bank Confirmation Letter</li>\r\n                </ul>\r\n              </div>\r\n              <div className=\"p-4 border rounded-lg bg-green-50/50\">\r\n                <h4 className=\"font-medium text-sm text-green-900 mb-2\">For Each Director/UBO</h4>\r\n                <ul className=\"text-sm text-green-800 space-y-1\">\r\n                  <li>• Passport / ID</li>\r\n                  <li>• Proof of Address (less than 3 months)</li>\r\n                </ul>\r\n              </div>\r\n            </div>\r\n          ) : (\r\n            <div className=\"p-4 border rounded-lg bg-slate-50\">\r\n              <h4 className=\"font-medium text-sm text-slate-900 mb-2\">Required Documents</h4>\r\n              <ul className=\"text-sm text-slate-700 space-y-1\">\r\n                <li>• Passport / ID</li>\r\n                <li>• Proof of Address (utility bill or bank statement, less than 3 months)</li>\r\n              </ul>\r\n            </div>\r\n          )}\r\n\r\n          {submissions.length === 0 ? (\r\n            <div className=\"text-center py-8 border-2 border-dashed border-gray-300 rounded-lg\">\r\n              <FileText className=\"h-10 w-10 mx-auto text-gray-400 mb-3\" />\r\n              <p className=\"text-gray-600 mb-2\">No documents uploaded yet</p>\r\n              <Button onClick={() => setUploadDialogOpen(true)} variant=\"outline\" size=\"sm\">\r\n                <Upload className=\"mr-2 h-4 w-4\" />\r\n                Upload Document\r\n              </Button>\r\n            </div>\r\n          ) : (\r\n            <div className=\"border rounded-lg overflow-hidden\">\r\n              <Table>\r\n                <TableHeader>\r\n                  <TableRow>\r\n                    <TableHead>Document Type</TableHead>\r\n                    {isEntityInvestor && <TableHead>Member</TableHead>}\r\n                    <TableHead>Status</TableHead>\r\n                    <TableHead>Uploaded</TableHead>\r\n                    <TableHead>Expiry</TableHead>\r\n                    <TableHead>File</TableHead>\r\n                    <TableHead>Actions</TableHead>\r\n                  </TableRow>\r\n                </TableHeader>\r\n                <TableBody>\r\n                  {submissions.map((submission) => (\r\n                    <TableRow key={submission.id}>\r\n                      <TableCell>\r\n                        <div className=\"flex flex-col\">\r\n                          <span className=\"font-medium text-gray-900\">\r\n                            {getDocumentTypeLabel(submission.document_type, submission.custom_label)}\r\n                          </span>\r\n                          {submission.version > 1 && (\r\n                            <span className=\"text-xs text-gray-500\">\r\n                              Version {submission.version}\r\n                            </span>\r\n                          )}\r\n                        </div>\r\n                      </TableCell>\r\n                      {isEntityInvestor && (\r\n                        <TableCell>\r\n                          {submission.investor_member ? (\r\n                            <div className=\"flex items-center gap-1.5\">\r\n                              <User className=\"h-3.5 w-3.5 text-muted-foreground\" />\r\n                              <span className=\"text-sm\">{submission.investor_member.full_name}</span>\r\n                            </div>\r\n                          ) : (\r\n                            <span className=\"text-sm text-muted-foreground\">—</span>\r\n                          )}\r\n                        </TableCell>\r\n                      )}\r\n                      <TableCell>\r\n                        <div className=\"flex flex-col gap-2\">\r\n                          {getStatusBadge(submission.status)}\r\n                          {submission.status === 'rejected' && submission.rejection_reason && (\r\n                            <p className=\"text-xs text-rose-600 max-w-xs\">\r\n                              {submission.rejection_reason}\r\n                            </p>\r\n                          )}\r\n                        </div>\r\n                      </TableCell>\r\n                      <TableCell className=\"text-gray-600\">\r\n                        {formatDate(submission.created_at)}\r\n                      </TableCell>\r\n                      <TableCell className=\"text-gray-600\">\r\n                        {submission.expiry_date ? formatDate(submission.expiry_date) : '—'}\r\n                      </TableCell>\r\n                      <TableCell>\r\n                        {submission.document && (\r\n                          <div className=\"flex flex-col\">\r\n                            <span className=\"text-sm text-gray-900 truncate max-w-[200px]\">\r\n                              {submission.document.name}\r\n                            </span>\r\n                            <span className=\"text-xs text-gray-500\">\r\n                              {formatFileSize(submission.document.file_size_bytes)}\r\n                            </span>\r\n                          </div>\r\n                        )}\r\n                      </TableCell>\r\n                      <TableCell>\r\n                        {submission.document && (\r\n                          <Button\r\n                            variant=\"ghost\"\r\n                            size=\"sm\"\r\n                            onClick={() => handleDownload(submission.document!.id, submission.document!.name)}\r\n                            disabled={downloadingId === submission.document.id}\r\n                          >\r\n                            {downloadingId === submission.document.id ? (\r\n                              <Loader2 className=\"h-4 w-4 animate-spin\" />\r\n                            ) : (\r\n                              <Download className=\"h-4 w-4\" />\r\n                            )}\r\n                          </Button>\r\n                        )}\r\n                      </TableCell>\r\n                    </TableRow>\r\n                  ))}\r\n                </TableBody>\r\n              </Table>\r\n            </div>\r\n          )}\r\n\r\n        </CardContent>\r\n      </Card>\r\n\r\n      <KYCUploadDialog\r\n        open={uploadDialogOpen}\r\n        onOpenChange={setUploadDialogOpen}\r\n        onUploadSuccess={loadSubmissions}\r\n        category={isEntityInvestor ? 'entity' : 'individual'}\r\n        members={isEntityInvestor ? investorMembers : []}\r\n        memberType={isEntityInvestor ? 'investor' : undefined}\r\n      />\r\n    </div>\r\n  )\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2803, "column": 0}, "map": {"version":3,"sources":["file:///Users/ghilesmoussaoui/Desktop/Versotech/versotech-portal/src/components/profile/entity-form-dialog.tsx"],"sourcesContent":["'use client'\r\n\r\nimport { useState, useEffect } from 'react'\r\nimport { Building2, MapPin, User, FileText, Loader2 } from 'lucide-react'\r\nimport { Button } from '@/components/ui/button'\r\nimport {\r\n  Dialog,\r\n  DialogContent,\r\n  DialogHeader,\r\n  DialogTitle,\r\n} from '@/components/ui/dialog'\r\nimport { Input } from '@/components/ui/input'\r\nimport { Label } from '@/components/ui/label'\r\nimport { Textarea } from '@/components/ui/textarea'\r\nimport {\r\n  Select,\r\n  SelectContent,\r\n  SelectItem,\r\n  SelectTrigger,\r\n  SelectValue,\r\n} from '@/components/ui/select'\r\nimport { toast } from 'sonner'\r\n\r\ninterface CounterpartyEntity {\r\n  id: string\r\n  entity_type: string\r\n  legal_name: string\r\n  registration_number?: string\r\n  jurisdiction?: string\r\n  tax_id?: string\r\n  formation_date?: string\r\n  registered_address?: {\r\n    street?: string\r\n    city?: string\r\n    state?: string\r\n    postal_code?: string\r\n    country?: string\r\n  }\r\n  representative_name?: string\r\n  representative_title?: string\r\n  representative_email?: string\r\n  representative_phone?: string\r\n  notes?: string\r\n}\r\n\r\ninterface EntityFormDialogProps {\r\n  open: boolean\r\n  onClose: () => void\r\n  onSuccess: () => void\r\n  entity?: CounterpartyEntity | null\r\n}\r\n\r\nexport function EntityFormDialog({ open, onClose, onSuccess, entity }: EntityFormDialogProps) {\r\n  const [saving, setSaving] = useState(false)\r\n  const [formData, setFormData] = useState({\r\n    entity_type: '',\r\n    legal_name: '',\r\n    registration_number: '',\r\n    jurisdiction: '',\r\n    tax_id: '',\r\n    formation_date: '',\r\n    address_street: '',\r\n    address_city: '',\r\n    address_state: '',\r\n    address_postal_code: '',\r\n    address_country: '',\r\n    representative_name: '',\r\n    representative_title: '',\r\n    representative_email: '',\r\n    representative_phone: '',\r\n    notes: ''\r\n  })\r\n\r\n  useEffect(() => {\r\n    if (entity) {\r\n      setFormData({\r\n        entity_type: entity.entity_type || '',\r\n        legal_name: entity.legal_name || '',\r\n        registration_number: entity.registration_number || '',\r\n        jurisdiction: entity.jurisdiction || '',\r\n        tax_id: entity.tax_id || '',\r\n        formation_date: entity.formation_date || '',\r\n        address_street: entity.registered_address?.street || '',\r\n        address_city: entity.registered_address?.city || '',\r\n        address_state: entity.registered_address?.state || '',\r\n        address_postal_code: entity.registered_address?.postal_code || '',\r\n        address_country: entity.registered_address?.country || '',\r\n        representative_name: entity.representative_name || '',\r\n        representative_title: entity.representative_title || '',\r\n        representative_email: entity.representative_email || '',\r\n        representative_phone: entity.representative_phone || '',\r\n        notes: entity.notes || ''\r\n      })\r\n    } else {\r\n      setFormData({\r\n        entity_type: '',\r\n        legal_name: '',\r\n        registration_number: '',\r\n        jurisdiction: '',\r\n        tax_id: '',\r\n        formation_date: '',\r\n        address_street: '',\r\n        address_city: '',\r\n        address_state: '',\r\n        address_postal_code: '',\r\n        address_country: '',\r\n        representative_name: '',\r\n        representative_title: '',\r\n        representative_email: '',\r\n        representative_phone: '',\r\n        notes: ''\r\n      })\r\n    }\r\n  }, [entity, open])\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault()\r\n\r\n    if (!formData.entity_type || !formData.legal_name) {\r\n      toast.error('Please fill in all required fields')\r\n      return\r\n    }\r\n\r\n    setSaving(true)\r\n\r\n    try {\r\n      const payload = {\r\n        entity_type: formData.entity_type,\r\n        legal_name: formData.legal_name,\r\n        registration_number: formData.registration_number || null,\r\n        jurisdiction: formData.jurisdiction || null,\r\n        tax_id: formData.tax_id || null,\r\n        formation_date: formData.formation_date || null,\r\n        registered_address: {\r\n          street: formData.address_street || undefined,\r\n          city: formData.address_city || undefined,\r\n          state: formData.address_state || undefined,\r\n          postal_code: formData.address_postal_code || undefined,\r\n          country: formData.address_country || undefined\r\n        },\r\n        representative_name: formData.representative_name || null,\r\n        representative_title: formData.representative_title || null,\r\n        representative_email: formData.representative_email || null,\r\n        representative_phone: formData.representative_phone || null,\r\n        notes: formData.notes || null\r\n      }\r\n\r\n      const url = entity\r\n        ? `/api/investors/me/counterparty-entities/${entity.id}`\r\n        : '/api/investors/me/counterparty-entities'\r\n\r\n      const method = entity ? 'PATCH' : 'POST'\r\n\r\n      const response = await fetch(url, {\r\n        method,\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify(payload)\r\n      })\r\n\r\n      if (!response.ok) {\r\n        const error = await response.json()\r\n        throw new Error(error.error || 'Failed to save entity')\r\n      }\r\n\r\n      toast.success(entity ? 'Entity updated successfully' : 'Entity created successfully')\r\n      onSuccess()\r\n    } catch (error: any) {\r\n      console.error('Save error:', error)\r\n      toast.error(error.message || 'Failed to save entity')\r\n    } finally {\r\n      setSaving(false)\r\n    }\r\n  }\r\n\r\n  return (\r\n    <Dialog open={open} onOpenChange={onClose}>\r\n      <DialogContent className=\"max-w-3xl max-h-[90vh] overflow-hidden flex flex-col p-0\">\r\n        {/* Header */}\r\n        <DialogHeader className=\"px-8 pt-8 pb-6 border-b border-slate-100 bg-gradient-to-b from-slate-50/80 to-white\">\r\n          <div className=\"flex items-center gap-4\">\r\n            <div className=\"w-12 h-12 rounded-xl bg-emerald-500/10 flex items-center justify-center\">\r\n              <Building2 className=\"w-6 h-6 text-emerald-600\" />\r\n            </div>\r\n            <div>\r\n              <DialogTitle className=\"text-xl font-semibold text-slate-900\">\r\n                {entity ? 'Edit Entity' : 'Add New Entity'}\r\n              </DialogTitle>\r\n              <p className=\"text-sm text-slate-500 mt-1\">\r\n                {entity\r\n                  ? 'Update the details of this legal entity'\r\n                  : 'Add a legal entity that you invest through'}\r\n              </p>\r\n            </div>\r\n          </div>\r\n        </DialogHeader>\r\n\r\n        {/* Form Content */}\r\n        <form onSubmit={handleSubmit} className=\"flex-1 overflow-y-auto\">\r\n          <div className=\"px-8 py-8 space-y-10\">\r\n\r\n            {/* Section 1: Basic Information */}\r\n            <section className=\"space-y-5\">\r\n              <div className=\"flex items-center gap-3 pb-2\">\r\n                <div className=\"w-8 h-8 rounded-lg bg-slate-100 flex items-center justify-center\">\r\n                  <Building2 className=\"w-4 h-4 text-slate-600\" />\r\n                </div>\r\n                <h3 className=\"font-medium text-slate-900\">Entity Information</h3>\r\n              </div>\r\n\r\n              <div className=\"grid grid-cols-2 gap-5\">\r\n                <div className=\"space-y-2\">\r\n                  <Label htmlFor=\"entity_type\" className=\"text-sm font-medium text-slate-700\">\r\n                    Entity Type <span className=\"text-rose-500\">*</span>\r\n                  </Label>\r\n                  <Select\r\n                    value={formData.entity_type}\r\n                    onValueChange={(value) => setFormData({ ...formData, entity_type: value })}\r\n                  >\r\n                    <SelectTrigger className=\"h-11 bg-white border-slate-200 focus:border-emerald-500 focus:ring-emerald-500/20\">\r\n                      <SelectValue placeholder=\"Select entity type\" />\r\n                    </SelectTrigger>\r\n                    <SelectContent>\r\n                      <SelectItem value=\"trust\">Trust</SelectItem>\r\n                      <SelectItem value=\"llc\">LLC</SelectItem>\r\n                      <SelectItem value=\"partnership\">Partnership</SelectItem>\r\n                      <SelectItem value=\"family_office\">Family Office</SelectItem>\r\n                      <SelectItem value=\"law_firm\">Law Firm</SelectItem>\r\n                      <SelectItem value=\"investment_bank\">Investment Bank</SelectItem>\r\n                      <SelectItem value=\"fund\">Fund</SelectItem>\r\n                      <SelectItem value=\"corporation\">Corporation</SelectItem>\r\n                      <SelectItem value=\"other\">Other</SelectItem>\r\n                    </SelectContent>\r\n                  </Select>\r\n                </div>\r\n\r\n                <div className=\"space-y-2\">\r\n                  <Label htmlFor=\"legal_name\" className=\"text-sm font-medium text-slate-700\">\r\n                    Legal Name <span className=\"text-rose-500\">*</span>\r\n                  </Label>\r\n                  <Input\r\n                    id=\"legal_name\"\r\n                    value={formData.legal_name}\r\n                    onChange={(e) => setFormData({ ...formData, legal_name: e.target.value })}\r\n                    placeholder=\"Full legal name\"\r\n                    className=\"h-11 bg-white border-slate-200 focus:border-emerald-500 focus:ring-emerald-500/20\"\r\n                    required\r\n                  />\r\n                </div>\r\n              </div>\r\n\r\n              <div className=\"grid grid-cols-2 gap-5\">\r\n                <div className=\"space-y-2\">\r\n                  <Label htmlFor=\"registration_number\" className=\"text-sm font-medium text-slate-700\">\r\n                    Registration Number\r\n                  </Label>\r\n                  <Input\r\n                    id=\"registration_number\"\r\n                    value={formData.registration_number}\r\n                    onChange={(e) => setFormData({ ...formData, registration_number: e.target.value })}\r\n                    placeholder=\"Company registration number\"\r\n                    className=\"h-11 bg-white border-slate-200 focus:border-emerald-500 focus:ring-emerald-500/20\"\r\n                  />\r\n                </div>\r\n\r\n                <div className=\"space-y-2\">\r\n                  <Label htmlFor=\"tax_id\" className=\"text-sm font-medium text-slate-700\">\r\n                    Tax ID / EIN\r\n                  </Label>\r\n                  <Input\r\n                    id=\"tax_id\"\r\n                    value={formData.tax_id}\r\n                    onChange={(e) => setFormData({ ...formData, tax_id: e.target.value })}\r\n                    placeholder=\"Tax ID or EIN\"\r\n                    className=\"h-11 bg-white border-slate-200 focus:border-emerald-500 focus:ring-emerald-500/20\"\r\n                  />\r\n                </div>\r\n              </div>\r\n\r\n              <div className=\"grid grid-cols-2 gap-5\">\r\n                <div className=\"space-y-2\">\r\n                  <Label htmlFor=\"jurisdiction\" className=\"text-sm font-medium text-slate-700\">\r\n                    Jurisdiction\r\n                  </Label>\r\n                  <Input\r\n                    id=\"jurisdiction\"\r\n                    value={formData.jurisdiction}\r\n                    onChange={(e) => setFormData({ ...formData, jurisdiction: e.target.value })}\r\n                    placeholder=\"State or country of formation\"\r\n                    className=\"h-11 bg-white border-slate-200 focus:border-emerald-500 focus:ring-emerald-500/20\"\r\n                  />\r\n                </div>\r\n\r\n                <div className=\"space-y-2\">\r\n                  <Label htmlFor=\"formation_date\" className=\"text-sm font-medium text-slate-700\">\r\n                    Formation Date\r\n                  </Label>\r\n                  <Input\r\n                    id=\"formation_date\"\r\n                    type=\"date\"\r\n                    value={formData.formation_date}\r\n                    onChange={(e) => setFormData({ ...formData, formation_date: e.target.value })}\r\n                    className=\"h-11 bg-white border-slate-200 focus:border-emerald-500 focus:ring-emerald-500/20\"\r\n                  />\r\n                </div>\r\n              </div>\r\n            </section>\r\n\r\n            {/* Section 2: Registered Address */}\r\n            <section className=\"space-y-5\">\r\n              <div className=\"flex items-center gap-3 pb-2\">\r\n                <div className=\"w-8 h-8 rounded-lg bg-slate-100 flex items-center justify-center\">\r\n                  <MapPin className=\"w-4 h-4 text-slate-600\" />\r\n                </div>\r\n                <h3 className=\"font-medium text-slate-900\">Registered Address</h3>\r\n              </div>\r\n\r\n              <div className=\"space-y-5\">\r\n                <div className=\"space-y-2\">\r\n                  <Label htmlFor=\"address_street\" className=\"text-sm font-medium text-slate-700\">\r\n                    Street Address\r\n                  </Label>\r\n                  <Input\r\n                    id=\"address_street\"\r\n                    value={formData.address_street}\r\n                    onChange={(e) => setFormData({ ...formData, address_street: e.target.value })}\r\n                    placeholder=\"123 Main Street, Suite 100\"\r\n                    className=\"h-11 bg-white border-slate-200 focus:border-emerald-500 focus:ring-emerald-500/20\"\r\n                  />\r\n                </div>\r\n\r\n                <div className=\"grid grid-cols-2 gap-5\">\r\n                  <div className=\"space-y-2\">\r\n                    <Label htmlFor=\"address_city\" className=\"text-sm font-medium text-slate-700\">\r\n                      City\r\n                    </Label>\r\n                    <Input\r\n                      id=\"address_city\"\r\n                      value={formData.address_city}\r\n                      onChange={(e) => setFormData({ ...formData, address_city: e.target.value })}\r\n                      placeholder=\"City\"\r\n                      className=\"h-11 bg-white border-slate-200 focus:border-emerald-500 focus:ring-emerald-500/20\"\r\n                    />\r\n                  </div>\r\n\r\n                  <div className=\"space-y-2\">\r\n                    <Label htmlFor=\"address_state\" className=\"text-sm font-medium text-slate-700\">\r\n                      State / Province\r\n                    </Label>\r\n                    <Input\r\n                      id=\"address_state\"\r\n                      value={formData.address_state}\r\n                      onChange={(e) => setFormData({ ...formData, address_state: e.target.value })}\r\n                      placeholder=\"State or province\"\r\n                      className=\"h-11 bg-white border-slate-200 focus:border-emerald-500 focus:ring-emerald-500/20\"\r\n                    />\r\n                  </div>\r\n                </div>\r\n\r\n                <div className=\"grid grid-cols-2 gap-5\">\r\n                  <div className=\"space-y-2\">\r\n                    <Label htmlFor=\"address_postal_code\" className=\"text-sm font-medium text-slate-700\">\r\n                      Postal Code\r\n                    </Label>\r\n                    <Input\r\n                      id=\"address_postal_code\"\r\n                      value={formData.address_postal_code}\r\n                      onChange={(e) => setFormData({ ...formData, address_postal_code: e.target.value })}\r\n                      placeholder=\"Postal code\"\r\n                      className=\"h-11 bg-white border-slate-200 focus:border-emerald-500 focus:ring-emerald-500/20\"\r\n                    />\r\n                  </div>\r\n\r\n                  <div className=\"space-y-2\">\r\n                    <Label htmlFor=\"address_country\" className=\"text-sm font-medium text-slate-700\">\r\n                      Country\r\n                    </Label>\r\n                    <Input\r\n                      id=\"address_country\"\r\n                      value={formData.address_country}\r\n                      onChange={(e) => setFormData({ ...formData, address_country: e.target.value })}\r\n                      placeholder=\"Country\"\r\n                      className=\"h-11 bg-white border-slate-200 focus:border-emerald-500 focus:ring-emerald-500/20\"\r\n                    />\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </section>\r\n\r\n            {/* Section 3: Authorized Representative */}\r\n            <section className=\"space-y-5\">\r\n              <div className=\"flex items-center gap-3 pb-2\">\r\n                <div className=\"w-8 h-8 rounded-lg bg-slate-100 flex items-center justify-center\">\r\n                  <User className=\"w-4 h-4 text-slate-600\" />\r\n                </div>\r\n                <h3 className=\"font-medium text-slate-900\">Authorized Representative</h3>\r\n              </div>\r\n\r\n              <div className=\"grid grid-cols-2 gap-5\">\r\n                <div className=\"space-y-2\">\r\n                  <Label htmlFor=\"representative_name\" className=\"text-sm font-medium text-slate-700\">\r\n                    Full Name\r\n                  </Label>\r\n                  <Input\r\n                    id=\"representative_name\"\r\n                    value={formData.representative_name}\r\n                    onChange={(e) => setFormData({ ...formData, representative_name: e.target.value })}\r\n                    placeholder=\"Representative's full name\"\r\n                    className=\"h-11 bg-white border-slate-200 focus:border-emerald-500 focus:ring-emerald-500/20\"\r\n                  />\r\n                </div>\r\n\r\n                <div className=\"space-y-2\">\r\n                  <Label htmlFor=\"representative_title\" className=\"text-sm font-medium text-slate-700\">\r\n                    Title / Role\r\n                  </Label>\r\n                  <Input\r\n                    id=\"representative_title\"\r\n                    value={formData.representative_title}\r\n                    onChange={(e) => setFormData({ ...formData, representative_title: e.target.value })}\r\n                    placeholder=\"e.g., Managing Director\"\r\n                    className=\"h-11 bg-white border-slate-200 focus:border-emerald-500 focus:ring-emerald-500/20\"\r\n                  />\r\n                </div>\r\n              </div>\r\n\r\n              <div className=\"grid grid-cols-2 gap-5\">\r\n                <div className=\"space-y-2\">\r\n                  <Label htmlFor=\"representative_email\" className=\"text-sm font-medium text-slate-700\">\r\n                    Email\r\n                  </Label>\r\n                  <Input\r\n                    id=\"representative_email\"\r\n                    type=\"email\"\r\n                    value={formData.representative_email}\r\n                    onChange={(e) => setFormData({ ...formData, representative_email: e.target.value })}\r\n                    placeholder=\"email@example.com\"\r\n                    className=\"h-11 bg-white border-slate-200 focus:border-emerald-500 focus:ring-emerald-500/20\"\r\n                  />\r\n                </div>\r\n\r\n                <div className=\"space-y-2\">\r\n                  <Label htmlFor=\"representative_phone\" className=\"text-sm font-medium text-slate-700\">\r\n                    Phone\r\n                  </Label>\r\n                  <Input\r\n                    id=\"representative_phone\"\r\n                    value={formData.representative_phone}\r\n                    onChange={(e) => setFormData({ ...formData, representative_phone: e.target.value })}\r\n                    placeholder=\"+1 (555) 123-4567\"\r\n                    className=\"h-11 bg-white border-slate-200 focus:border-emerald-500 focus:ring-emerald-500/20\"\r\n                  />\r\n                </div>\r\n              </div>\r\n            </section>\r\n\r\n            {/* Section 4: Notes */}\r\n            <section className=\"space-y-5\">\r\n              <div className=\"flex items-center gap-3 pb-2\">\r\n                <div className=\"w-8 h-8 rounded-lg bg-slate-100 flex items-center justify-center\">\r\n                  <FileText className=\"w-4 h-4 text-slate-600\" />\r\n                </div>\r\n                <h3 className=\"font-medium text-slate-900\">Additional Notes</h3>\r\n              </div>\r\n\r\n              <div className=\"space-y-2\">\r\n                <Label htmlFor=\"notes\" className=\"text-sm font-medium text-slate-700\">\r\n                  Notes <span className=\"text-slate-400 font-normal\">(Optional)</span>\r\n                </Label>\r\n                <Textarea\r\n                  id=\"notes\"\r\n                  value={formData.notes}\r\n                  onChange={(e) => setFormData({ ...formData, notes: e.target.value })}\r\n                  placeholder=\"Any additional notes about this entity...\"\r\n                  rows={4}\r\n                  className=\"bg-white border-slate-200 focus:border-emerald-500 focus:ring-emerald-500/20 resize-none\"\r\n                />\r\n              </div>\r\n            </section>\r\n          </div>\r\n\r\n          {/* Footer */}\r\n          <div className=\"sticky bottom-0 px-8 py-5 border-t border-slate-100 bg-slate-50/80 backdrop-blur-sm flex items-center justify-end gap-3\">\r\n            <Button\r\n              type=\"button\"\r\n              variant=\"outline\"\r\n              onClick={onClose}\r\n              disabled={saving}\r\n              className=\"px-5 border-slate-200 hover:bg-white\"\r\n            >\r\n              Cancel\r\n            </Button>\r\n            <Button\r\n              type=\"submit\"\r\n              disabled={saving}\r\n              className=\"px-6 bg-emerald-600 hover:bg-emerald-700 text-white shadow-sm\"\r\n            >\r\n              {saving ? (\r\n                <>\r\n                  <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />\r\n                  Saving...\r\n                </>\r\n              ) : entity ? (\r\n                'Update Entity'\r\n              ) : (\r\n                'Create Entity'\r\n              )}\r\n            </Button>\r\n          </div>\r\n        </form>\r\n      </DialogContent>\r\n    </Dialog>\r\n  )\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 3964, "column": 0}, "map": {"version":3,"sources":["file:///Users/ghilesmoussaoui/Desktop/Versotech/versotech-portal/src/components/profile/entity-kyc-documents.tsx"],"sourcesContent":["'use client'\r\n\r\nimport { useState, useEffect, useCallback } from 'react'\r\nimport { toast } from 'sonner'\r\nimport { Button } from '@/components/ui/button'\r\nimport { Badge } from '@/components/ui/badge'\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card'\r\nimport {\r\n  Table,\r\n  TableBody,\r\n  TableCell,\r\n  TableHead,\r\n  TableHeader,\r\n  TableRow,\r\n} from '@/components/ui/table'\r\nimport { Alert, AlertDescription } from '@/components/ui/alert'\r\nimport { Upload, FileText, Download, Loader2, AlertCircle, CheckCircle2, Clock, Info, User } from 'lucide-react'\r\nimport { KYCUploadDialog } from './kyc-upload-dialog'\r\nimport { getDocumentTypeLabel } from '@/constants/kyc-document-types'\r\n\r\ninterface EntityKYCDocumentsProps {\r\n  entityId: string\r\n  entityName: string\r\n}\r\n\r\ninterface KYCSubmission {\r\n  id: string\r\n  document_type: string\r\n  custom_label?: string | null\r\n  status: string\r\n  created_at: string\r\n  expiry_date?: string | null\r\n  version: number\r\n  metadata?: any\r\n  document?: {\r\n    id: string\r\n    name: string\r\n    file_key: string\r\n    file_size_bytes: number\r\n    mime_type: string\r\n    created_at: string\r\n  }\r\n  reviewer?: {\r\n    display_name?: string\r\n    email?: string\r\n  } | null\r\n  counterparty_member?: {\r\n    id: string\r\n    full_name: string\r\n    role: string\r\n  } | null\r\n}\r\n\r\ninterface EntityMember {\r\n  id: string\r\n  full_name: string\r\n  role: string\r\n}\r\n\r\nexport function EntityKYCDocuments({ entityId, entityName }: EntityKYCDocumentsProps) {\r\n  const [submissions, setSubmissions] = useState<KYCSubmission[]>([])\r\n  const [entityMembers, setEntityMembers] = useState<EntityMember[]>([])\r\n  const [isLoading, setIsLoading] = useState(true)\r\n  const [isUploadDialogOpen, setIsUploadDialogOpen] = useState(false)\r\n  const [downloadingId, setDownloadingId] = useState<string | null>(null)\r\n\r\n  const fetchSubmissions = useCallback(async () => {\r\n    setIsLoading(true)\r\n    try {\r\n      const response = await fetch(`/api/investors/me/counterparty-entities/${entityId}/kyc-submissions`)\r\n\r\n      if (!response.ok) {\r\n        throw new Error('Failed to fetch KYC submissions')\r\n      }\r\n\r\n      const data = await response.json()\r\n      setSubmissions(data.submissions || [])\r\n      setEntityMembers(data.members || [])\r\n    } catch (error: any) {\r\n      console.error('Error fetching entity KYC submissions:', error)\r\n      toast.error('Failed to load KYC documents', {\r\n        description: error.message\r\n      })\r\n    } finally {\r\n      setIsLoading(false)\r\n    }\r\n  }, [entityId])\r\n\r\n  useEffect(() => {\r\n    fetchSubmissions()\r\n  }, [entityId, fetchSubmissions])\r\n\r\n  const handleDownload = async (documentId: string, fileName: string) => {\r\n    setDownloadingId(documentId)\r\n    try {\r\n      const response = await fetch(`/api/documents/${documentId}/download`)\r\n\r\n      if (!response.ok) {\r\n        throw new Error('Failed to download document')\r\n      }\r\n\r\n      const blob = await response.blob()\r\n      const url = window.URL.createObjectURL(blob)\r\n      const a = document.createElement('a')\r\n      a.href = url\r\n      a.download = fileName\r\n      document.body.appendChild(a)\r\n      a.click()\r\n      window.URL.revokeObjectURL(url)\r\n      document.body.removeChild(a)\r\n\r\n      toast.success('Download started')\r\n    } catch (error: any) {\r\n      console.error('Download error:', error)\r\n      toast.error('Download failed', {\r\n        description: error.message\r\n      })\r\n    } finally {\r\n      setDownloadingId(null)\r\n    }\r\n  }\r\n\r\n  const getStatusBadge = (status: string) => {\r\n    switch (status) {\r\n      case 'approved':\r\n        return (\r\n          <Badge variant=\"default\" className=\"bg-emerald-500/20 text-emerald-700 dark:text-emerald-300 border-emerald-500/30\">\r\n            <CheckCircle2 className=\"mr-1 h-3 w-3\" />\r\n            Approved\r\n          </Badge>\r\n        )\r\n      case 'pending':\r\n        return (\r\n          <Badge variant=\"secondary\" className=\"bg-amber-500/20 text-amber-700 dark:text-amber-300 border-amber-500/30\">\r\n            <Clock className=\"mr-1 h-3 w-3\" />\r\n            Pending Review\r\n          </Badge>\r\n        )\r\n      case 'rejected':\r\n        return (\r\n          <Badge variant=\"destructive\" className=\"bg-rose-500/20 text-rose-700 dark:text-rose-300 border-rose-500/30\">\r\n            <AlertCircle className=\"mr-1 h-3 w-3\" />\r\n            Rejected\r\n          </Badge>\r\n        )\r\n      case 'expired':\r\n        return (\r\n          <Badge variant=\"outline\" className=\"bg-gray-500/20 text-gray-600 dark:text-gray-300 border-gray-500/30\">\r\n            <AlertCircle className=\"mr-1 h-3 w-3\" />\r\n            Expired\r\n          </Badge>\r\n        )\r\n      default:\r\n        return <Badge variant=\"outline\">{status}</Badge>\r\n    }\r\n  }\r\n\r\n  const formatDate = (dateString: string) => {\r\n    return new Date(dateString).toLocaleDateString('en-US', {\r\n      year: 'numeric',\r\n      month: 'short',\r\n      day: 'numeric'\r\n    })\r\n  }\r\n\r\n  const formatFileSize = (bytes: number) => {\r\n    if (bytes < 1024) return bytes + ' B'\r\n    if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB'\r\n    return (bytes / (1024 * 1024)).toFixed(1) + ' MB'\r\n  }\r\n\r\n  return (\r\n    <div className=\"space-y-4\">\r\n      <div className=\"flex items-center justify-between\">\r\n        <div>\r\n          <h3 className=\"text-lg font-semibold text-foreground\">{entityName} - KYC Documents</h3>\r\n          <p className=\"text-sm text-muted-foreground\">\r\n            Upload and manage KYC documents for this entity\r\n          </p>\r\n        </div>\r\n        <Button onClick={() => setIsUploadDialogOpen(true)}>\r\n          <Upload className=\"mr-2 h-4 w-4\" />\r\n          Upload Document\r\n        </Button>\r\n      </div>\r\n\r\n      <Alert>\r\n        <Info className=\"h-4 w-4\" />\r\n        <AlertDescription className=\"text-sm\">\r\n          Required: NDA/NDNC, Incorporation Certificate, Memo &amp; Articles, Register of Members, Register of Directors, Bank Confirmation.\r\n          For each member/director: ID/Passport and Utility Bill (less than 3 months old).\r\n        </AlertDescription>\r\n      </Alert>\r\n\r\n      {isLoading ? (\r\n        <div className=\"flex items-center justify-center p-12\">\r\n          <Loader2 className=\"h-8 w-8 animate-spin text-muted-foreground\" />\r\n        </div>\r\n      ) : submissions.length === 0 ? (\r\n        <Card className=\"border-dashed border-border\">\r\n          <CardContent className=\"flex flex-col items-center justify-center p-12\">\r\n            <FileText className=\"h-12 w-12 text-muted-foreground mb-4\" />\r\n            <p className=\"text-muted-foreground mb-2\">No KYC documents uploaded yet</p>\r\n            <p className=\"text-sm text-muted-foreground mb-4\">\r\n              Upload entity documents and ID/Utility Bill for each member/director\r\n            </p>\r\n            <Button onClick={() => setIsUploadDialogOpen(true)}>\r\n              <Upload className=\"mr-2 h-4 w-4\" />\r\n              Upload First Document\r\n            </Button>\r\n          </CardContent>\r\n        </Card>\r\n      ) : (\r\n        <Card>\r\n          <CardContent className=\"p-0\">\r\n            <Table>\r\n              <TableHeader>\r\n                <TableRow>\r\n                  <TableHead>Document Type</TableHead>\r\n                  {entityMembers.length > 0 && <TableHead>Member</TableHead>}\r\n                  <TableHead>Status</TableHead>\r\n                  <TableHead>Uploaded</TableHead>\r\n                  <TableHead>Expiry</TableHead>\r\n                  <TableHead>File</TableHead>\r\n                  <TableHead>Actions</TableHead>\r\n                </TableRow>\r\n              </TableHeader>\r\n              <TableBody>\r\n                {submissions.map((submission) => (\r\n                  <TableRow key={submission.id}>\r\n                    <TableCell>\r\n                      <div className=\"flex flex-col\">\r\n                        <span className=\"font-medium text-foreground\">\r\n                          {getDocumentTypeLabel(submission.document_type, submission.custom_label)}\r\n                        </span>\r\n                        {submission.version > 1 && (\r\n                          <span className=\"text-xs text-muted-foreground\">\r\n                            Version {submission.version}\r\n                          </span>\r\n                        )}\r\n                      </div>\r\n                    </TableCell>\r\n                    {entityMembers.length > 0 && (\r\n                      <TableCell>\r\n                        {submission.counterparty_member ? (\r\n                          <div className=\"flex items-center gap-1.5\">\r\n                            <User className=\"h-3.5 w-3.5 text-muted-foreground\" />\r\n                            <span className=\"text-sm text-muted-foreground\">{submission.counterparty_member.full_name}</span>\r\n                          </div>\r\n                        ) : (\r\n                          <span className=\"text-sm text-muted-foreground\">—</span>\r\n                        )}\r\n                      </TableCell>\r\n                    )}\r\n                    <TableCell>{getStatusBadge(submission.status)}</TableCell>\r\n                    <TableCell className=\"text-muted-foreground\">\r\n                      {formatDate(submission.created_at)}\r\n                    </TableCell>\r\n                    <TableCell className=\"text-muted-foreground\">\r\n                      {submission.expiry_date ? formatDate(submission.expiry_date) : '—'}\r\n                    </TableCell>\r\n                    <TableCell>\r\n                      {submission.document && (\r\n                        <div className=\"flex flex-col\">\r\n                          <span className=\"text-sm text-muted-foreground truncate max-w-[200px]\">\r\n                            {submission.document.name}\r\n                          </span>\r\n                          <span className=\"text-xs text-muted-foreground\">\r\n                            {formatFileSize(submission.document.file_size_bytes)}\r\n                          </span>\r\n                        </div>\r\n                      )}\r\n                    </TableCell>\r\n                    <TableCell>\r\n                      {submission.document && (\r\n                        <Button\r\n                          variant=\"ghost\"\r\n                          size=\"sm\"\r\n                          onClick={() => handleDownload(submission.document!.id, submission.document!.name)}\r\n                          disabled={downloadingId === submission.document.id}\r\n                        >\r\n                          {downloadingId === submission.document.id ? (\r\n                            <Loader2 className=\"h-4 w-4 animate-spin\" />\r\n                          ) : (\r\n                            <Download className=\"h-4 w-4\" />\r\n                          )}\r\n                        </Button>\r\n                      )}\r\n                    </TableCell>\r\n                  </TableRow>\r\n                ))}\r\n              </TableBody>\r\n            </Table>\r\n          </CardContent>\r\n        </Card>\r\n      )}\r\n\r\n      <KYCUploadDialog\r\n        open={isUploadDialogOpen}\r\n        onOpenChange={setIsUploadDialogOpen}\r\n        onUploadSuccess={fetchSubmissions}\r\n        entityId={entityId}\r\n        category=\"entity\"\r\n        members={entityMembers}\r\n        memberType=\"counterparty\"\r\n      />\r\n    </div>\r\n  )\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 4595, "column": 0}, "map": {"version":3,"sources":["file:///Users/ghilesmoussaoui/Desktop/Versotech/versotech-portal/src/components/profile/entity-members-tab.tsx"],"sourcesContent":["'use client'\r\n\r\nimport { useState, useEffect } from 'react'\r\nimport { Users, Plus, Edit, Trash2, UserPlus, ShieldCheck, Clock } from 'lucide-react'\r\nimport { Button } from '@/components/ui/button'\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card'\r\nimport { Badge } from '@/components/ui/badge'\r\nimport {\r\n  Table,\r\n  TableBody,\r\n  TableCell,\r\n  TableHead,\r\n  TableHeader,\r\n  TableRow,\r\n} from '@/components/ui/table'\r\nimport {\r\n  Dialog,\r\n  DialogContent,\r\n  DialogDescription,\r\n  DialogFooter,\r\n  DialogHeader,\r\n  DialogTitle,\r\n} from '@/components/ui/dialog'\r\nimport { Input } from '@/components/ui/input'\r\nimport { Label } from '@/components/ui/label'\r\nimport {\r\n  Select,\r\n  SelectContent,\r\n  SelectItem,\r\n  SelectTrigger,\r\n  SelectValue,\r\n} from '@/components/ui/select'\r\nimport { toast } from 'sonner'\r\n\r\ninterface EntityMember {\r\n  id: string\r\n  counterparty_entity_id: string\r\n  full_name: string\r\n  role: string\r\n  role_title?: string\r\n  email?: string\r\n  phone?: string\r\n  nationality?: string\r\n  id_type?: string\r\n  id_number?: string\r\n  id_expiry_date?: string\r\n  ownership_percentage?: number\r\n  is_beneficial_owner: boolean\r\n  kyc_status: string\r\n  is_active: boolean\r\n  created_at: string\r\n}\r\n\r\ninterface EntityMembersTabProps {\r\n  entityId: string\r\n  entityName: string\r\n}\r\n\r\nconst ROLE_OPTIONS = [\r\n  { value: 'director', label: 'Director' },\r\n  { value: 'shareholder', label: 'Shareholder' },\r\n  { value: 'beneficial_owner', label: 'Beneficial Owner' },\r\n  { value: 'trustee', label: 'Trustee' },\r\n  { value: 'beneficiary', label: 'Beneficiary' },\r\n  { value: 'managing_member', label: 'Managing Member' },\r\n  { value: 'general_partner', label: 'General Partner' },\r\n  { value: 'limited_partner', label: 'Limited Partner' },\r\n  { value: 'authorized_signatory', label: 'Authorized Signatory' },\r\n  { value: 'other', label: 'Other' },\r\n]\r\n\r\nconst ID_TYPE_OPTIONS = [\r\n  { value: 'passport', label: 'Passport' },\r\n  { value: 'national_id', label: 'National ID' },\r\n  { value: 'drivers_license', label: \"Driver's License\" },\r\n  { value: 'other', label: 'Other' },\r\n]\r\n\r\nexport function EntityMembersTab({ entityId, entityName }: EntityMembersTabProps) {\r\n  const [members, setMembers] = useState<EntityMember[]>([])\r\n  const [loading, setLoading] = useState(true)\r\n  const [dialogOpen, setDialogOpen] = useState(false)\r\n  const [editingMember, setEditingMember] = useState<EntityMember | null>(null)\r\n  const [saving, setSaving] = useState(false)\r\n  const [deleting, setDeleting] = useState<string | null>(null)\r\n\r\n  const [formData, setFormData] = useState({\r\n    full_name: '',\r\n    role: '',\r\n    role_title: '',\r\n    email: '',\r\n    phone: '',\r\n    nationality: '',\r\n    id_type: '',\r\n    id_number: '',\r\n    id_expiry_date: '',\r\n    ownership_percentage: '',\r\n    is_beneficial_owner: false,\r\n  })\r\n\r\n  useEffect(() => {\r\n    loadMembers()\r\n  }, [entityId])\r\n\r\n  const loadMembers = async () => {\r\n    try {\r\n      const response = await fetch(`/api/investors/me/counterparty-entities/${entityId}/members`)\r\n      if (!response.ok) throw new Error('Failed to load members')\r\n\r\n      const data = await response.json()\r\n      setMembers(data.members || [])\r\n    } catch (error) {\r\n      console.error('Error loading members:', error)\r\n      toast.error('Failed to load members')\r\n    } finally {\r\n      setLoading(false)\r\n    }\r\n  }\r\n\r\n  const resetForm = () => {\r\n    setFormData({\r\n      full_name: '',\r\n      role: '',\r\n      role_title: '',\r\n      email: '',\r\n      phone: '',\r\n      nationality: '',\r\n      id_type: '',\r\n      id_number: '',\r\n      id_expiry_date: '',\r\n      ownership_percentage: '',\r\n      is_beneficial_owner: false,\r\n    })\r\n    setEditingMember(null)\r\n  }\r\n\r\n  const handleOpenDialog = (member?: EntityMember) => {\r\n    if (member) {\r\n      setEditingMember(member)\r\n      setFormData({\r\n        full_name: member.full_name || '',\r\n        role: member.role || '',\r\n        role_title: member.role_title || '',\r\n        email: member.email || '',\r\n        phone: member.phone || '',\r\n        nationality: member.nationality || '',\r\n        id_type: member.id_type || '',\r\n        id_number: member.id_number || '',\r\n        id_expiry_date: member.id_expiry_date || '',\r\n        ownership_percentage: member.ownership_percentage?.toString() || '',\r\n        is_beneficial_owner: member.is_beneficial_owner || false,\r\n      })\r\n    } else {\r\n      resetForm()\r\n    }\r\n    setDialogOpen(true)\r\n  }\r\n\r\n  const handleSave = async () => {\r\n    if (!formData.full_name || !formData.role) {\r\n      toast.error('Please fill in all required fields')\r\n      return\r\n    }\r\n\r\n    setSaving(true)\r\n\r\n    try {\r\n      const payload = {\r\n        full_name: formData.full_name,\r\n        role: formData.role,\r\n        role_title: formData.role_title || null,\r\n        email: formData.email || null,\r\n        phone: formData.phone || null,\r\n        nationality: formData.nationality || null,\r\n        id_type: formData.id_type || null,\r\n        id_number: formData.id_number || null,\r\n        id_expiry_date: formData.id_expiry_date || null,\r\n        ownership_percentage: formData.ownership_percentage ? parseFloat(formData.ownership_percentage) : null,\r\n        is_beneficial_owner: formData.is_beneficial_owner,\r\n      }\r\n\r\n      const url = editingMember\r\n        ? `/api/investors/me/counterparty-entities/${entityId}/members/${editingMember.id}`\r\n        : `/api/investors/me/counterparty-entities/${entityId}/members`\r\n\r\n      const response = await fetch(url, {\r\n        method: editingMember ? 'PATCH' : 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify(payload),\r\n      })\r\n\r\n      if (!response.ok) {\r\n        const error = await response.json()\r\n        throw new Error(error.error || 'Failed to save member')\r\n      }\r\n\r\n      toast.success(editingMember ? 'Member updated' : 'Member added')\r\n      setDialogOpen(false)\r\n      resetForm()\r\n      await loadMembers()\r\n    } catch (error: any) {\r\n      console.error('Save error:', error)\r\n      toast.error(error.message || 'Failed to save member')\r\n    } finally {\r\n      setSaving(false)\r\n    }\r\n  }\r\n\r\n  const handleDelete = async (memberId: string) => {\r\n    if (!confirm('Are you sure you want to remove this member?')) return\r\n\r\n    setDeleting(memberId)\r\n\r\n    try {\r\n      const response = await fetch(`/api/investors/me/counterparty-entities/${entityId}/members/${memberId}`, {\r\n        method: 'DELETE',\r\n      })\r\n\r\n      if (!response.ok) {\r\n        const error = await response.json()\r\n        throw new Error(error.error || 'Failed to remove member')\r\n      }\r\n\r\n      toast.success('Member removed')\r\n      await loadMembers()\r\n    } catch (error: any) {\r\n      console.error('Delete error:', error)\r\n      toast.error(error.message || 'Failed to remove member')\r\n    } finally {\r\n      setDeleting(null)\r\n    }\r\n  }\r\n\r\n  const getRoleBadge = (role: string) => {\r\n    const roleInfo = ROLE_OPTIONS.find(r => r.value === role)\r\n    return <Badge variant=\"outline\">{roleInfo?.label || role}</Badge>\r\n  }\r\n\r\n  const getKYCStatusBadge = (status: string) => {\r\n    switch (status) {\r\n      case 'approved':\r\n        return <Badge className=\"bg-green-500\"><ShieldCheck className=\"w-3 h-3 mr-1\" />Approved</Badge>\r\n      case 'pending':\r\n        return <Badge className=\"bg-yellow-500\"><Clock className=\"w-3 h-3 mr-1\" />Pending</Badge>\r\n      default:\r\n        return <Badge variant=\"outline\">Not Submitted</Badge>\r\n    }\r\n  }\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"flex items-center justify-center py-8\">\r\n        <div className=\"text-muted-foreground\">Loading members...</div>\r\n      </div>\r\n    )\r\n  }\r\n\r\n  return (\r\n    <div className=\"space-y-4\">\r\n      <div className=\"flex items-center justify-between\">\r\n        <div>\r\n          <h3 className=\"text-lg font-medium flex items-center gap-2\">\r\n            <Users className=\"h-5 w-5\" />\r\n            Entity Members\r\n          </h3>\r\n          <p className=\"text-sm text-muted-foreground\">\r\n            Directors, trustees, partners, and beneficial owners\r\n          </p>\r\n        </div>\r\n        <Button onClick={() => handleOpenDialog()} size=\"sm\">\r\n          <UserPlus className=\"w-4 h-4 mr-2\" />\r\n          Add Member\r\n        </Button>\r\n      </div>\r\n\r\n      {members.length === 0 ? (\r\n        <Card>\r\n          <CardContent className=\"py-8 text-center\">\r\n            <Users className=\"w-10 h-10 mx-auto text-muted-foreground mb-3\" />\r\n            <p className=\"text-muted-foreground text-sm mb-3\">\r\n              No members added yet\r\n            </p>\r\n            <Button onClick={() => handleOpenDialog()} variant=\"outline\" size=\"sm\">\r\n              <UserPlus className=\"w-4 h-4 mr-2\" />\r\n              Add First Member\r\n            </Button>\r\n          </CardContent>\r\n        </Card>\r\n      ) : (\r\n        <Table>\r\n          <TableHeader>\r\n            <TableRow>\r\n              <TableHead>Name</TableHead>\r\n              <TableHead>Role</TableHead>\r\n              <TableHead>Ownership</TableHead>\r\n              <TableHead>KYC</TableHead>\r\n              <TableHead className=\"text-right\">Actions</TableHead>\r\n            </TableRow>\r\n          </TableHeader>\r\n          <TableBody>\r\n            {members.map((member) => (\r\n              <TableRow key={member.id}>\r\n                <TableCell className=\"font-medium\">\r\n                  {member.full_name}\r\n                  {member.is_beneficial_owner && (\r\n                    <Badge variant=\"secondary\" className=\"ml-2 text-xs\">UBO</Badge>\r\n                  )}\r\n                </TableCell>\r\n                <TableCell>{getRoleBadge(member.role)}</TableCell>\r\n                <TableCell>\r\n                  {member.ownership_percentage ? `${member.ownership_percentage}%` : '—'}\r\n                </TableCell>\r\n                <TableCell>{getKYCStatusBadge(member.kyc_status)}</TableCell>\r\n                <TableCell className=\"text-right\">\r\n                  <div className=\"flex items-center justify-end gap-1\">\r\n                    <Button\r\n                      variant=\"ghost\"\r\n                      size=\"sm\"\r\n                      onClick={() => handleOpenDialog(member)}\r\n                    >\r\n                      <Edit className=\"w-4 h-4\" />\r\n                    </Button>\r\n                    <Button\r\n                      variant=\"ghost\"\r\n                      size=\"sm\"\r\n                      onClick={() => handleDelete(member.id)}\r\n                      disabled={deleting === member.id}\r\n                    >\r\n                      <Trash2 className=\"w-4 h-4\" />\r\n                    </Button>\r\n                  </div>\r\n                </TableCell>\r\n              </TableRow>\r\n            ))}\r\n          </TableBody>\r\n        </Table>\r\n      )}\r\n\r\n      {/* Add/Edit Member Dialog */}\r\n      <Dialog open={dialogOpen} onOpenChange={setDialogOpen}>\r\n        <DialogContent className=\"max-w-lg\">\r\n          <DialogHeader>\r\n            <DialogTitle>{editingMember ? 'Edit Member' : 'Add Member'}</DialogTitle>\r\n            <DialogDescription>\r\n              {editingMember ? 'Update member details' : `Add a member to ${entityName}`}\r\n            </DialogDescription>\r\n          </DialogHeader>\r\n\r\n          <div className=\"space-y-4\">\r\n            <div className=\"grid grid-cols-2 gap-4\">\r\n              <div className=\"space-y-2\">\r\n                <Label htmlFor=\"full_name\">\r\n                  Full Name <span className=\"text-red-500\">*</span>\r\n                </Label>\r\n                <Input\r\n                  id=\"full_name\"\r\n                  value={formData.full_name}\r\n                  onChange={(e) => setFormData({ ...formData, full_name: e.target.value })}\r\n                />\r\n              </div>\r\n\r\n              <div className=\"space-y-2\">\r\n                <Label htmlFor=\"role\">\r\n                  Role <span className=\"text-red-500\">*</span>\r\n                </Label>\r\n                <Select\r\n                  value={formData.role}\r\n                  onValueChange={(value) => setFormData({ ...formData, role: value })}\r\n                >\r\n                  <SelectTrigger>\r\n                    <SelectValue placeholder=\"Select role\" />\r\n                  </SelectTrigger>\r\n                  <SelectContent>\r\n                    {ROLE_OPTIONS.map((option) => (\r\n                      <SelectItem key={option.value} value={option.value}>\r\n                        {option.label}\r\n                      </SelectItem>\r\n                    ))}\r\n                  </SelectContent>\r\n                </Select>\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"grid grid-cols-2 gap-4\">\r\n              <div className=\"space-y-2\">\r\n                <Label htmlFor=\"email\">Email</Label>\r\n                <Input\r\n                  id=\"email\"\r\n                  type=\"email\"\r\n                  value={formData.email}\r\n                  onChange={(e) => setFormData({ ...formData, email: e.target.value })}\r\n                />\r\n              </div>\r\n\r\n              <div className=\"space-y-2\">\r\n                <Label htmlFor=\"phone\">Phone</Label>\r\n                <Input\r\n                  id=\"phone\"\r\n                  value={formData.phone}\r\n                  onChange={(e) => setFormData({ ...formData, phone: e.target.value })}\r\n                />\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"grid grid-cols-2 gap-4\">\r\n              <div className=\"space-y-2\">\r\n                <Label htmlFor=\"ownership_percentage\">Ownership %</Label>\r\n                <Input\r\n                  id=\"ownership_percentage\"\r\n                  type=\"number\"\r\n                  min=\"0\"\r\n                  max=\"100\"\r\n                  value={formData.ownership_percentage}\r\n                  onChange={(e) => setFormData({ ...formData, ownership_percentage: e.target.value })}\r\n                />\r\n              </div>\r\n\r\n              <div className=\"space-y-2 flex items-end\">\r\n                <label className=\"flex items-center gap-2 cursor-pointer\">\r\n                  <input\r\n                    type=\"checkbox\"\r\n                    checked={formData.is_beneficial_owner}\r\n                    onChange={(e) => setFormData({ ...formData, is_beneficial_owner: e.target.checked })}\r\n                    className=\"rounded\"\r\n                  />\r\n                  <span className=\"text-sm\">Beneficial Owner (UBO)</span>\r\n                </label>\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"grid grid-cols-3 gap-4\">\r\n              <div className=\"space-y-2\">\r\n                <Label htmlFor=\"id_type\">ID Type</Label>\r\n                <Select\r\n                  value={formData.id_type}\r\n                  onValueChange={(value) => setFormData({ ...formData, id_type: value })}\r\n                >\r\n                  <SelectTrigger>\r\n                    <SelectValue placeholder=\"Select\" />\r\n                  </SelectTrigger>\r\n                  <SelectContent>\r\n                    {ID_TYPE_OPTIONS.map((option) => (\r\n                      <SelectItem key={option.value} value={option.value}>\r\n                        {option.label}\r\n                      </SelectItem>\r\n                    ))}\r\n                  </SelectContent>\r\n                </Select>\r\n              </div>\r\n\r\n              <div className=\"space-y-2\">\r\n                <Label htmlFor=\"id_number\">ID Number</Label>\r\n                <Input\r\n                  id=\"id_number\"\r\n                  value={formData.id_number}\r\n                  onChange={(e) => setFormData({ ...formData, id_number: e.target.value })}\r\n                />\r\n              </div>\r\n\r\n              <div className=\"space-y-2\">\r\n                <Label htmlFor=\"id_expiry_date\">ID Expiry</Label>\r\n                <Input\r\n                  id=\"id_expiry_date\"\r\n                  type=\"date\"\r\n                  value={formData.id_expiry_date}\r\n                  onChange={(e) => setFormData({ ...formData, id_expiry_date: e.target.value })}\r\n                />\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          <DialogFooter>\r\n            <Button variant=\"outline\" onClick={() => setDialogOpen(false)} disabled={saving}>\r\n              Cancel\r\n            </Button>\r\n            <Button onClick={handleSave} disabled={saving}>\r\n              {saving ? 'Saving...' : editingMember ? 'Update' : 'Add Member'}\r\n            </Button>\r\n          </DialogFooter>\r\n        </DialogContent>\r\n      </Dialog>\r\n    </div>\r\n  )\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 5659, "column": 0}, "map": {"version":3,"sources":["file:///Users/ghilesmoussaoui/Desktop/Versotech/versotech-portal/src/components/profile/entity-detail-dialog.tsx"],"sourcesContent":["'use client'\r\n\r\nimport { useState } from 'react'\r\nimport {\r\n  Dialog,\r\n  DialogContent,\r\n  DialogDescription,\r\n  DialogHeader,\r\n  DialogTitle,\r\n} from '@/components/ui/dialog'\r\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs'\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card'\r\nimport { Badge } from '@/components/ui/badge'\r\nimport { EntityKYCDocuments } from './entity-kyc-documents'\r\nimport { EntityMembersTab } from './entity-members-tab'\r\nimport { EntityFormDialog } from './entity-form-dialog'\r\nimport {\r\n  Building2,\r\n  MapPin,\r\n  FileText,\r\n  User,\r\n  Users,\r\n  Calendar,\r\n  Hash,\r\n  Shield,\r\n  Mail,\r\n  Phone\r\n} from 'lucide-react'\r\n\r\ninterface CounterpartyEntity {\r\n  id: string\r\n  entity_type: string\r\n  legal_name: string\r\n  registration_number?: string\r\n  jurisdiction?: string\r\n  tax_id?: string\r\n  formation_date?: string\r\n  registered_address?: {\r\n    street?: string\r\n    city?: string\r\n    state?: string\r\n    postal_code?: string\r\n    country?: string\r\n  }\r\n  representative_name?: string\r\n  representative_title?: string\r\n  representative_email?: string\r\n  representative_phone?: string\r\n  notes?: string\r\n  kyc_status?: string\r\n  created_at?: string\r\n}\r\n\r\ninterface EntityDetailDialogProps {\r\n  open: boolean\r\n  onClose: () => void\r\n  entity: CounterpartyEntity | null\r\n  onUpdate: () => void\r\n}\r\n\r\nexport function EntityDetailDialog({ open, onClose, entity, onUpdate }: EntityDetailDialogProps) {\r\n  const [activeTab, setActiveTab] = useState('details')\r\n  const [editDialogOpen, setEditDialogOpen] = useState(false)\r\n\r\n  if (!entity) return null\r\n\r\n  const getEntityTypeLabel = (type: string) => {\r\n    const labels: Record<string, string> = {\r\n      trust: 'Trust',\r\n      llc: 'LLC',\r\n      partnership: 'Partnership',\r\n      family_office: 'Family Office',\r\n      law_firm: 'Law Firm',\r\n      investment_bank: 'Investment Bank',\r\n      fund: 'Fund',\r\n      corporation: 'Corporation',\r\n      other: 'Other'\r\n    }\r\n    return labels[type] || type\r\n  }\r\n\r\n  const getKYCStatusBadge = (status?: string) => {\r\n    if (!status) {\r\n      return (\r\n        <Badge variant=\"outline\" className=\"bg-gray-500/20 text-gray-300 border-gray-500/30\">\r\n          No KYC\r\n        </Badge>\r\n      )\r\n    }\r\n\r\n    switch (status) {\r\n      case 'approved':\r\n        return (\r\n          <Badge variant=\"default\" className=\"bg-emerald-500/20 text-emerald-300 border-emerald-500/30\">\r\n            Approved\r\n          </Badge>\r\n        )\r\n      case 'pending':\r\n        return (\r\n          <Badge variant=\"secondary\" className=\"bg-amber-500/20 text-amber-300 border-amber-500/30\">\r\n            Pending Review\r\n          </Badge>\r\n        )\r\n      case 'rejected':\r\n        return (\r\n          <Badge variant=\"destructive\" className=\"bg-rose-500/20 text-rose-300 border-rose-500/30\">\r\n            Rejected\r\n          </Badge>\r\n        )\r\n      default:\r\n        return <Badge variant=\"outline\">{status}</Badge>\r\n    }\r\n  }\r\n\r\n  const formatAddress = (address?: CounterpartyEntity['registered_address']) => {\r\n    if (!address) return '—'\r\n\r\n    const parts = [\r\n      address.street,\r\n      address.city,\r\n      address.state,\r\n      address.postal_code,\r\n      address.country\r\n    ].filter(Boolean)\r\n\r\n    return parts.length > 0 ? parts.join(', ') : '—'\r\n  }\r\n\r\n  const formatDate = (dateString?: string) => {\r\n    if (!dateString) return '—'\r\n    return new Date(dateString).toLocaleDateString('en-US', {\r\n      year: 'numeric',\r\n      month: 'long',\r\n      day: 'numeric'\r\n    })\r\n  }\r\n\r\n  const handleEditSuccess = () => {\r\n    setEditDialogOpen(false)\r\n    onUpdate()\r\n  }\r\n\r\n  return (\r\n    <>\r\n      <Dialog open={open} onOpenChange={onClose}>\r\n        <DialogContent className=\"max-w-4xl max-h-[90vh] overflow-hidden flex flex-col\">\r\n          <DialogHeader>\r\n            <div className=\"flex items-start justify-between\">\r\n              <div className=\"flex-1\">\r\n                <DialogTitle className=\"text-2xl\">{entity.legal_name}</DialogTitle>\r\n                <DialogDescription className=\"flex items-center gap-2 mt-1\">\r\n                  <Badge variant=\"outline\">{getEntityTypeLabel(entity.entity_type)}</Badge>\r\n                  {getKYCStatusBadge(entity.kyc_status)}\r\n                </DialogDescription>\r\n              </div>\r\n            </div>\r\n          </DialogHeader>\r\n\r\n          <Tabs value={activeTab} onValueChange={setActiveTab} className=\"flex-1 flex flex-col overflow-hidden\">\r\n            <TabsList className=\"grid w-full grid-cols-3\">\r\n              <TabsTrigger value=\"details\">Entity Details</TabsTrigger>\r\n              <TabsTrigger value=\"members\">Members</TabsTrigger>\r\n              <TabsTrigger value=\"kyc\">KYC Documents</TabsTrigger>\r\n            </TabsList>\r\n\r\n            <div className=\"flex-1 overflow-y-auto mt-4\">\r\n              <TabsContent value=\"details\" className=\"space-y-4 m-0\">\r\n                {/* Basic Information */}\r\n                <Card>\r\n                  <CardHeader>\r\n                    <CardTitle className=\"text-lg flex items-center gap-2\">\r\n                      <Building2 className=\"h-5 w-5\" />\r\n                      Basic Information\r\n                    </CardTitle>\r\n                  </CardHeader>\r\n                  <CardContent className=\"grid grid-cols-2 gap-4\">\r\n                    <div>\r\n                      <p className=\"text-sm text-muted-foreground mb-1\">Legal Name</p>\r\n                      <p className=\"font-medium\">{entity.legal_name}</p>\r\n                    </div>\r\n                    <div>\r\n                      <p className=\"text-sm text-muted-foreground mb-1\">Entity Type</p>\r\n                      <p className=\"font-medium\">{getEntityTypeLabel(entity.entity_type)}</p>\r\n                    </div>\r\n                    <div>\r\n                      <p className=\"text-sm text-muted-foreground mb-1 flex items-center gap-1\">\r\n                        <Hash className=\"h-3 w-3\" />\r\n                        Registration Number\r\n                      </p>\r\n                      <p className=\"font-medium\">{entity.registration_number || '—'}</p>\r\n                    </div>\r\n                    <div>\r\n                      <p className=\"text-sm text-muted-foreground mb-1 flex items-center gap-1\">\r\n                        <Shield className=\"h-3 w-3\" />\r\n                        Tax ID / EIN\r\n                      </p>\r\n                      <p className=\"font-medium\">{entity.tax_id || '—'}</p>\r\n                    </div>\r\n                    <div>\r\n                      <p className=\"text-sm text-muted-foreground mb-1 flex items-center gap-1\">\r\n                        <MapPin className=\"h-3 w-3\" />\r\n                        Jurisdiction\r\n                      </p>\r\n                      <p className=\"font-medium\">{entity.jurisdiction || '—'}</p>\r\n                    </div>\r\n                    <div>\r\n                      <p className=\"text-sm text-muted-foreground mb-1 flex items-center gap-1\">\r\n                        <Calendar className=\"h-3 w-3\" />\r\n                        Formation Date\r\n                      </p>\r\n                      <p className=\"font-medium\">{formatDate(entity.formation_date)}</p>\r\n                    </div>\r\n                  </CardContent>\r\n                </Card>\r\n\r\n                {/* Registered Address */}\r\n                <Card>\r\n                  <CardHeader>\r\n                    <CardTitle className=\"text-lg flex items-center gap-2\">\r\n                      <MapPin className=\"h-5 w-5\" />\r\n                      Registered Address\r\n                    </CardTitle>\r\n                  </CardHeader>\r\n                  <CardContent>\r\n                    <p className=\"font-medium\">{formatAddress(entity.registered_address)}</p>\r\n                  </CardContent>\r\n                </Card>\r\n\r\n                {/* Authorized Representative */}\r\n                <Card>\r\n                  <CardHeader>\r\n                    <CardTitle className=\"text-lg flex items-center gap-2\">\r\n                      <User className=\"h-5 w-5\" />\r\n                      Authorized Representative\r\n                    </CardTitle>\r\n                  </CardHeader>\r\n                  <CardContent className=\"grid grid-cols-2 gap-4\">\r\n                    <div>\r\n                      <p className=\"text-sm text-muted-foreground mb-1\">Name</p>\r\n                      <p className=\"font-medium\">{entity.representative_name || '—'}</p>\r\n                    </div>\r\n                    <div>\r\n                      <p className=\"text-sm text-muted-foreground mb-1\">Title</p>\r\n                      <p className=\"font-medium\">{entity.representative_title || '—'}</p>\r\n                    </div>\r\n                    <div>\r\n                      <p className=\"text-sm text-muted-foreground mb-1 flex items-center gap-1\">\r\n                        <Mail className=\"h-3 w-3\" />\r\n                        Email\r\n                      </p>\r\n                      <p className=\"font-medium\">{entity.representative_email || '—'}</p>\r\n                    </div>\r\n                    <div>\r\n                      <p className=\"text-sm text-muted-foreground mb-1 flex items-center gap-1\">\r\n                        <Phone className=\"h-3 w-3\" />\r\n                        Phone\r\n                      </p>\r\n                      <p className=\"font-medium\">{entity.representative_phone || '—'}</p>\r\n                    </div>\r\n                  </CardContent>\r\n                </Card>\r\n\r\n                {/* Notes */}\r\n                {entity.notes && (\r\n                  <Card>\r\n                    <CardHeader>\r\n                      <CardTitle className=\"text-lg flex items-center gap-2\">\r\n                        <FileText className=\"h-5 w-5\" />\r\n                        Notes\r\n                      </CardTitle>\r\n                    </CardHeader>\r\n                    <CardContent>\r\n                      <p className=\"text-sm whitespace-pre-wrap\">{entity.notes}</p>\r\n                    </CardContent>\r\n                  </Card>\r\n                )}\r\n              </TabsContent>\r\n\r\n              <TabsContent value=\"members\" className=\"m-0\">\r\n                <EntityMembersTab entityId={entity.id} entityName={entity.legal_name} />\r\n              </TabsContent>\r\n\r\n              <TabsContent value=\"kyc\" className=\"m-0\">\r\n                <EntityKYCDocuments entityId={entity.id} entityName={entity.legal_name} />\r\n              </TabsContent>\r\n            </div>\r\n          </Tabs>\r\n        </DialogContent>\r\n      </Dialog>\r\n\r\n      {/* Edit Dialog */}\r\n      <EntityFormDialog\r\n        open={editDialogOpen}\r\n        onClose={() => setEditDialogOpen(false)}\r\n        onSuccess={handleEditSuccess}\r\n        entity={entity}\r\n      />\r\n    </>\r\n  )\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 6439, "column": 0}, "map": {"version":3,"sources":["file:///Users/ghilesmoussaoui/Desktop/Versotech/versotech-portal/src/components/profile/counterparty-entities-tab.tsx"],"sourcesContent":["'use client'\r\n\r\nimport { useState, useEffect } from 'react'\r\nimport { Building2, Plus, Edit, Trash2, CheckCircle, XCircle, Clock, Users, Loader2, MapPin, Calendar, Hash, FileText, User } from 'lucide-react'\r\nimport { Button } from '@/components/ui/button'\r\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card'\r\nimport { Badge } from '@/components/ui/badge'\r\nimport { toast } from 'sonner'\r\nimport { EntityFormDialog } from './entity-form-dialog'\r\nimport { EntityDetailDialog } from './entity-detail-dialog'\r\n\r\ninterface CounterpartyEntity {\r\n  id: string\r\n  entity_type: string\r\n  legal_name: string\r\n  registration_number?: string\r\n  jurisdiction?: string\r\n  tax_id?: string\r\n  formation_date?: string\r\n  registered_address?: {\r\n    street?: string\r\n    city?: string\r\n    state?: string\r\n    postal_code?: string\r\n    country?: string\r\n  }\r\n  representative_name?: string\r\n  representative_title?: string\r\n  representative_email?: string\r\n  representative_phone?: string\r\n  kyc_status?: string\r\n  kyc_completed_at?: string\r\n  kyc_expiry_date?: string\r\n  notes?: string\r\n  is_active: boolean\r\n  created_at: string\r\n  updated_at: string\r\n}\r\n\r\nexport function CounterpartyEntitiesTab() {\r\n  const [entities, setEntities] = useState<CounterpartyEntity[]>([])\r\n  const [loading, setLoading] = useState(true)\r\n  const [formDialogOpen, setFormDialogOpen] = useState(false)\r\n  const [detailDialogOpen, setDetailDialogOpen] = useState(false)\r\n  const [selectedEntity, setSelectedEntity] = useState<CounterpartyEntity | null>(null)\r\n  const [deleting, setDeleting] = useState<string | null>(null)\r\n\r\n  useEffect(() => {\r\n    loadEntities()\r\n  }, [])\r\n\r\n  const loadEntities = async () => {\r\n    try {\r\n      const response = await fetch('/api/investors/me/counterparty-entities')\r\n      if (!response.ok) throw new Error('Failed to load entities')\r\n\r\n      const data = await response.json()\r\n      setEntities(data.entities || [])\r\n    } catch (error) {\r\n      console.error('Error loading entities:', error)\r\n      toast.error('Failed to load entities')\r\n    } finally {\r\n      setLoading(false)\r\n    }\r\n  }\r\n\r\n  const handleCreate = () => {\r\n    setSelectedEntity(null)\r\n    setFormDialogOpen(true)\r\n  }\r\n\r\n  const handleEdit = (entity: CounterpartyEntity) => {\r\n    setSelectedEntity(entity)\r\n    setFormDialogOpen(true)\r\n  }\r\n\r\n  const handleViewDetails = (entity: CounterpartyEntity) => {\r\n    setSelectedEntity(entity)\r\n    setDetailDialogOpen(true)\r\n  }\r\n\r\n  const handleDelete = async (entityId: string) => {\r\n    if (!confirm('Are you sure you want to delete this entity? This action cannot be undone.')) {\r\n      return\r\n    }\r\n\r\n    setDeleting(entityId)\r\n\r\n    try {\r\n      const response = await fetch(`/api/investors/me/counterparty-entities/${entityId}`, {\r\n        method: 'DELETE'\r\n      })\r\n\r\n      if (!response.ok) {\r\n        const error = await response.json()\r\n        throw new Error(error.error || 'Delete failed')\r\n      }\r\n\r\n      toast.success('Entity deleted successfully')\r\n      await loadEntities()\r\n    } catch (error: any) {\r\n      console.error('Delete error:', error)\r\n      toast.error(error.message || 'Failed to delete entity')\r\n    } finally {\r\n      setDeleting(null)\r\n    }\r\n  }\r\n\r\n  const handleFormSuccess = async () => {\r\n    setFormDialogOpen(false)\r\n    setSelectedEntity(null)\r\n    await loadEntities()\r\n  }\r\n\r\n  const getEntityTypeLabel = (type: string) => {\r\n    const typeLabels: Record<string, string> = {\r\n      trust: 'Trust',\r\n      llc: 'LLC',\r\n      partnership: 'Partnership',\r\n      family_office: 'Family Office',\r\n      law_firm: 'Law Firm',\r\n      investment_bank: 'Investment Bank',\r\n      fund: 'Fund',\r\n      corporation: 'Corporation',\r\n      other: 'Other'\r\n    }\r\n    return typeLabels[type] || type\r\n  }\r\n\r\n  const getKYCStatusBadge = (status?: string) => {\r\n    switch (status) {\r\n      case 'approved':\r\n        return (\r\n          <Badge className=\"bg-emerald-500/15 text-emerald-700 border-emerald-500/30 px-3 py-1\">\r\n            <CheckCircle className=\"w-3.5 h-3.5 mr-1.5\" />\r\n            Verified\r\n          </Badge>\r\n        )\r\n      case 'pending':\r\n        return (\r\n          <Badge className=\"bg-amber-500/15 text-amber-700 border-amber-500/30 px-3 py-1\">\r\n            <Clock className=\"w-3.5 h-3.5 mr-1.5\" />\r\n            Pending Review\r\n          </Badge>\r\n        )\r\n      case 'rejected':\r\n        return (\r\n          <Badge className=\"bg-rose-500/15 text-rose-700 border-rose-500/30 px-3 py-1\">\r\n            <XCircle className=\"w-3.5 h-3.5 mr-1.5\" />\r\n            Rejected\r\n          </Badge>\r\n        )\r\n      case 'expired':\r\n        return (\r\n          <Badge variant=\"outline\" className=\"text-orange-600 border-orange-400 px-3 py-1\">\r\n            Expired\r\n          </Badge>\r\n        )\r\n      default:\r\n        return (\r\n          <Badge variant=\"outline\" className=\"text-slate-500 border-slate-300 px-3 py-1\">\r\n            Not Submitted\r\n          </Badge>\r\n        )\r\n    }\r\n  }\r\n\r\n  const formatDate = (dateString?: string) => {\r\n    if (!dateString) return '—'\r\n    return new Date(dateString).toLocaleDateString('en-US', {\r\n      year: 'numeric',\r\n      month: 'short',\r\n      day: 'numeric'\r\n    })\r\n  }\r\n\r\n  const formatAddress = (address?: CounterpartyEntity['registered_address']) => {\r\n    if (!address) return null\r\n    const parts = [\r\n      address.street,\r\n      address.city,\r\n      address.state,\r\n      address.postal_code,\r\n      address.country\r\n    ].filter(Boolean)\r\n    return parts.length > 0 ? parts.join(', ') : null\r\n  }\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"flex items-center justify-center py-16\">\r\n        <Loader2 className=\"w-6 h-6 animate-spin text-slate-400\" />\r\n      </div>\r\n    )\r\n  }\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      {/* Header Section */}\r\n      <Card>\r\n        <CardHeader className=\"pb-4\">\r\n          <div className=\"flex items-start justify-between gap-4\">\r\n            <div className=\"space-y-1\">\r\n              <CardTitle className=\"text-xl\">Counterparty Entities</CardTitle>\r\n              <p className=\"text-sm text-muted-foreground\">\r\n                Manage legal entities you invest through (trusts, LLCs, partnerships, etc.)\r\n              </p>\r\n            </div>\r\n            <Button onClick={handleCreate} className=\"bg-emerald-600 hover:bg-emerald-700\">\r\n              <Plus className=\"w-4 h-4 mr-2\" />\r\n              Add Entity\r\n            </Button>\r\n          </div>\r\n        </CardHeader>\r\n      </Card>\r\n\r\n      {/* Entities List */}\r\n      {entities.length === 0 ? (\r\n        <Card>\r\n          <CardContent className=\"py-16\">\r\n            <div className=\"text-center\">\r\n              <Building2 className=\"w-12 h-12 mx-auto text-slate-400 mb-4\" />\r\n              <p className=\"text-slate-600 font-medium text-lg mb-2\">No entities added yet</p>\r\n              <p className=\"text-sm text-slate-500 mb-6 max-w-md mx-auto\">\r\n                Add a legal entity to invest through trusts, LLCs, or partnerships.\r\n              </p>\r\n              <Button onClick={handleCreate} variant=\"outline\" size=\"lg\">\r\n                <Plus className=\"w-4 h-4 mr-2\" />\r\n                Add Your First Entity\r\n              </Button>\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n      ) : (\r\n        <div className=\"space-y-6\">\r\n          {entities.map((entity) => (\r\n            <Card key={entity.id} className=\"overflow-hidden\">\r\n              {/* Card Header with Name, Type, and Actions */}\r\n              <CardHeader className=\"bg-slate-50/80 border-b pb-4\">\r\n                <div className=\"flex items-start justify-between gap-4\">\r\n                  <div className=\"flex items-start gap-4\">\r\n                    <div className=\"w-12 h-12 rounded-lg bg-slate-900 flex items-center justify-center flex-shrink-0\">\r\n                      <Building2 className=\"w-6 h-6 text-white\" />\r\n                    </div>\r\n                    <div className=\"space-y-1\">\r\n                      <h3 className=\"text-xl font-semibold text-slate-900\">\r\n                        {entity.legal_name}\r\n                      </h3>\r\n                      <div className=\"flex items-center gap-3\">\r\n                        <Badge variant=\"outline\" className=\"font-medium px-3 py-1\">\r\n                          {getEntityTypeLabel(entity.entity_type)}\r\n                        </Badge>\r\n                        {getKYCStatusBadge(entity.kyc_status)}\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                  <div className=\"flex items-center gap-2\">\r\n                    <Button\r\n                      variant=\"default\"\r\n                      size=\"sm\"\r\n                      onClick={() => handleViewDetails(entity)}\r\n                      className=\"h-9 bg-slate-900 hover:bg-slate-800\"\r\n                    >\r\n                      <Users className=\"w-4 h-4 mr-2\" />\r\n                      Members & KYC\r\n                    </Button>\r\n                    <Button\r\n                      variant=\"outline\"\r\n                      size=\"sm\"\r\n                      onClick={() => handleEdit(entity)}\r\n                      className=\"h-9\"\r\n                    >\r\n                      <Edit className=\"w-4 h-4 mr-2\" />\r\n                      Edit\r\n                    </Button>\r\n                    <Button\r\n                      variant=\"outline\"\r\n                      size=\"sm\"\r\n                      onClick={() => handleDelete(entity.id)}\r\n                      disabled={deleting === entity.id}\r\n                      className=\"h-9 hover:bg-rose-50 hover:text-rose-600 hover:border-rose-300\"\r\n                    >\r\n                      {deleting === entity.id ? (\r\n                        <Loader2 className=\"w-4 h-4 animate-spin\" />\r\n                      ) : (\r\n                        <Trash2 className=\"w-4 h-4\" />\r\n                      )}\r\n                    </Button>\r\n                  </div>\r\n                </div>\r\n              </CardHeader>\r\n\r\n              {/* Card Content with All Data */}\r\n              <CardContent className=\"pt-6 pb-6\">\r\n                <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-x-8 gap-y-6\">\r\n                  {/* Jurisdiction */}\r\n                  <div className=\"space-y-1.5\">\r\n                    <div className=\"flex items-center gap-2 text-sm font-medium text-slate-500\">\r\n                      <MapPin className=\"w-4 h-4\" />\r\n                      Jurisdiction\r\n                    </div>\r\n                    <p className=\"text-base text-slate-900 pl-6\">\r\n                      {entity.jurisdiction || <span className=\"text-slate-400\">Not specified</span>}\r\n                    </p>\r\n                  </div>\r\n\r\n                  {/* Registration Number */}\r\n                  <div className=\"space-y-1.5\">\r\n                    <div className=\"flex items-center gap-2 text-sm font-medium text-slate-500\">\r\n                      <Hash className=\"w-4 h-4\" />\r\n                      Registration Number\r\n                    </div>\r\n                    <p className=\"text-base text-slate-900 font-mono pl-6\">\r\n                      {entity.registration_number || <span className=\"text-slate-400 font-sans\">Not specified</span>}\r\n                    </p>\r\n                  </div>\r\n\r\n                  {/* Tax ID */}\r\n                  <div className=\"space-y-1.5\">\r\n                    <div className=\"flex items-center gap-2 text-sm font-medium text-slate-500\">\r\n                      <FileText className=\"w-4 h-4\" />\r\n                      Tax ID\r\n                    </div>\r\n                    <p className=\"text-base text-slate-900 font-mono pl-6\">\r\n                      {entity.tax_id || <span className=\"text-slate-400 font-sans\">Not specified</span>}\r\n                    </p>\r\n                  </div>\r\n\r\n                  {/* Formation Date */}\r\n                  <div className=\"space-y-1.5\">\r\n                    <div className=\"flex items-center gap-2 text-sm font-medium text-slate-500\">\r\n                      <Calendar className=\"w-4 h-4\" />\r\n                      Formation Date\r\n                    </div>\r\n                    <p className=\"text-base text-slate-900 pl-6\">\r\n                      {formatDate(entity.formation_date) !== '—' ? formatDate(entity.formation_date) : <span className=\"text-slate-400\">Not specified</span>}\r\n                    </p>\r\n                  </div>\r\n\r\n                  {/* Representative */}\r\n                  <div className=\"space-y-1.5\">\r\n                    <div className=\"flex items-center gap-2 text-sm font-medium text-slate-500\">\r\n                      <User className=\"w-4 h-4\" />\r\n                      Authorized Representative\r\n                    </div>\r\n                    <div className=\"pl-6\">\r\n                      {entity.representative_name ? (\r\n                        <div>\r\n                          <p className=\"text-base text-slate-900 font-medium\">\r\n                            {entity.representative_name}\r\n                          </p>\r\n                          {entity.representative_title && (\r\n                            <p className=\"text-sm text-slate-500\">\r\n                              {entity.representative_title}\r\n                            </p>\r\n                          )}\r\n                        </div>\r\n                      ) : (\r\n                        <p className=\"text-slate-400\">Not specified</p>\r\n                      )}\r\n                    </div>\r\n                  </div>\r\n\r\n                  {/* Address */}\r\n                  <div className=\"space-y-1.5\">\r\n                    <div className=\"flex items-center gap-2 text-sm font-medium text-slate-500\">\r\n                      <MapPin className=\"w-4 h-4\" />\r\n                      Registered Address\r\n                    </div>\r\n                    <p className=\"text-base text-slate-900 pl-6\">\r\n                      {formatAddress(entity.registered_address) || <span className=\"text-slate-400\">Not specified</span>}\r\n                    </p>\r\n                  </div>\r\n                </div>\r\n\r\n                {/* Notes Section - if present */}\r\n                {entity.notes && (\r\n                  <div className=\"mt-6 pt-6 border-t\">\r\n                    <div className=\"flex items-center gap-2 text-sm font-medium text-slate-500 mb-2\">\r\n                      <FileText className=\"w-4 h-4\" />\r\n                      Notes\r\n                    </div>\r\n                    <p className=\"text-base text-slate-700 pl-6 whitespace-pre-wrap\">\r\n                      {entity.notes}\r\n                    </p>\r\n                  </div>\r\n                )}\r\n              </CardContent>\r\n            </Card>\r\n          ))}\r\n        </div>\r\n      )}\r\n\r\n      <EntityFormDialog\r\n        open={formDialogOpen}\r\n        onClose={() => {\r\n          setFormDialogOpen(false)\r\n          setSelectedEntity(null)\r\n        }}\r\n        onSuccess={handleFormSuccess}\r\n        entity={selectedEntity}\r\n      />\r\n\r\n      <EntityDetailDialog\r\n        open={detailDialogOpen}\r\n        onClose={() => {\r\n          setDetailDialogOpen(false)\r\n          setSelectedEntity(null)\r\n        }}\r\n        entity={selectedEntity}\r\n        onUpdate={loadEntities}\r\n      />\r\n    </div>\r\n  )\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 7328, "column": 0}, "map": {"version":3,"sources":["file:///Users/ghilesmoussaoui/Desktop/Versotech/versotech-portal/src/components/profile/compliance-tab.tsx"],"sourcesContent":["'use client'\n\nimport { useState, useEffect } from 'react'\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card'\nimport { Badge } from '@/components/ui/badge'\nimport { Button } from '@/components/ui/button'\nimport { Skeleton } from '@/components/ui/skeleton'\nimport {\n  ShieldCheck,\n  ShieldAlert,\n  AlertTriangle,\n  CheckCircle2,\n  XCircle,\n  Clock,\n  RefreshCw,\n  FileText,\n  Calendar\n} from 'lucide-react'\nimport { format, differenceInDays, isPast, addDays } from 'date-fns'\nimport { cn } from '@/lib/utils'\n\ninterface ComplianceData {\n  aml_risk_rating: string | null\n  aml_last_reviewed_at: string | null\n  is_pep: boolean\n  is_sanctioned: boolean\n  is_professional_investor: boolean\n  is_qualified_purchaser: boolean\n  accreditation_expiry: string | null\n  kyc_status: string | null\n  kyc_expiry_date: string | null\n  kyc_completed_at: string | null\n}\n\nfunction getRiskRatingColor(rating: string | null): string {\n  switch (rating?.toLowerCase()) {\n    case 'low':\n      return 'bg-green-500/10 text-green-500 border-green-500/20'\n    case 'medium':\n      return 'bg-amber-500/10 text-amber-500 border-amber-500/20'\n    case 'high':\n      return 'bg-red-500/10 text-red-500 border-red-500/20'\n    default:\n      return 'bg-muted text-muted-foreground'\n  }\n}\n\nfunction getExpiryStatus(expiryDate: string | null): { status: 'expired' | 'expiring_soon' | 'valid' | 'not_set', daysLeft: number | null } {\n  if (!expiryDate) return { status: 'not_set', daysLeft: null }\n\n  const expiry = new Date(expiryDate)\n  const today = new Date()\n  const daysLeft = differenceInDays(expiry, today)\n\n  if (isPast(expiry)) {\n    return { status: 'expired', daysLeft }\n  } else if (daysLeft <= 30) {\n    return { status: 'expiring_soon', daysLeft }\n  }\n  return { status: 'valid', daysLeft }\n}\n\nfunction ExpiryBadge({ date, label }: { date: string | null, label: string }) {\n  const { status, daysLeft } = getExpiryStatus(date)\n\n  if (status === 'not_set') {\n    return (\n      <div className=\"flex items-center gap-2 text-muted-foreground\">\n        <Clock className=\"h-4 w-4\" />\n        <span className=\"text-sm\">Not set</span>\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"space-y-1\">\n      <div className=\"flex items-center gap-2\">\n        {status === 'expired' && (\n          <Badge variant=\"destructive\" className=\"gap-1\">\n            <XCircle className=\"h-3 w-3\" />\n            Expired\n          </Badge>\n        )}\n        {status === 'expiring_soon' && (\n          <Badge variant=\"outline\" className=\"gap-1 border-amber-500/50 text-amber-500 bg-amber-500/10\">\n            <AlertTriangle className=\"h-3 w-3\" />\n            Expires in {daysLeft} days\n          </Badge>\n        )}\n        {status === 'valid' && (\n          <Badge variant=\"outline\" className=\"gap-1 border-green-500/50 text-green-500 bg-green-500/10\">\n            <CheckCircle2 className=\"h-3 w-3\" />\n            Valid\n          </Badge>\n        )}\n      </div>\n      <p className=\"text-sm text-muted-foreground flex items-center gap-1\">\n        <Calendar className=\"h-3 w-3\" />\n        {format(new Date(date!), 'MMM dd, yyyy')}\n      </p>\n    </div>\n  )\n}\n\nexport function ComplianceTab() {\n  const [compliance, setCompliance] = useState<ComplianceData | null>(null)\n  const [loading, setLoading] = useState(true)\n  const [error, setError] = useState<string | null>(null)\n\n  useEffect(() => {\n    fetchComplianceData()\n  }, [])\n\n  const fetchComplianceData = async () => {\n    try {\n      setLoading(true)\n      const response = await fetch('/api/investors/me/compliance')\n      if (!response.ok) {\n        throw new Error('Failed to fetch compliance data')\n      }\n      const data = await response.json()\n      setCompliance(data)\n    } catch (err) {\n      setError(err instanceof Error ? err.message : 'Unknown error')\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  if (loading) {\n    return (\n      <div className=\"space-y-6\">\n        <Skeleton className=\"h-8 w-48\" />\n        <div className=\"grid gap-6 md:grid-cols-2\">\n          <Skeleton className=\"h-48\" />\n          <Skeleton className=\"h-48\" />\n          <Skeleton className=\"h-48\" />\n          <Skeleton className=\"h-48\" />\n        </div>\n      </div>\n    )\n  }\n\n  if (error) {\n    return (\n      <Card className=\"border-destructive/50 bg-destructive/5\">\n        <CardContent className=\"pt-6\">\n          <div className=\"flex items-center gap-3\">\n            <XCircle className=\"h-5 w-5 text-destructive\" />\n            <p className=\"text-sm text-destructive\">{error}</p>\n            <Button variant=\"ghost\" size=\"sm\" onClick={fetchComplianceData}>\n              <RefreshCw className=\"h-4 w-4 mr-2\" />\n              Retry\n            </Button>\n          </div>\n        </CardContent>\n      </Card>\n    )\n  }\n\n  if (!compliance) {\n    return null\n  }\n\n  const kycExpiry = getExpiryStatus(compliance.kyc_expiry_date)\n  const accreditationExpiry = getExpiryStatus(compliance.accreditation_expiry)\n  const hasComplianceIssues =\n    compliance.is_sanctioned ||\n    kycExpiry.status === 'expired' ||\n    accreditationExpiry.status === 'expired'\n\n  return (\n    <div className=\"space-y-6\">\n      <div>\n        <h2 className=\"text-2xl font-bold tracking-tight\">Compliance Status</h2>\n        <p className=\"text-muted-foreground\">\n          Your AML, PEP screening, and accreditation status.\n        </p>\n      </div>\n\n      {/* Compliance Alert Banner */}\n      {hasComplianceIssues && (\n        <Card className=\"border-destructive/50 bg-destructive/5\">\n          <CardContent className=\"pt-6\">\n            <div className=\"flex items-start gap-3\">\n              <ShieldAlert className=\"h-5 w-5 text-destructive mt-0.5\" />\n              <div>\n                <p className=\"font-medium text-destructive\">Compliance Action Required</p>\n                <p className=\"text-sm text-muted-foreground mt-1\">\n                  One or more compliance items need attention. Please contact your relationship manager.\n                </p>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n      )}\n\n      <div className=\"grid gap-6 md:grid-cols-2\">\n        {/* AML Status Card */}\n        <Card>\n          <CardHeader className=\"pb-3\">\n            <CardTitle className=\"text-lg flex items-center gap-2\">\n              <ShieldCheck className=\"h-5 w-5 text-primary\" />\n              AML Status\n            </CardTitle>\n            <CardDescription>Anti-Money Laundering risk assessment</CardDescription>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            <div className=\"flex items-center justify-between\">\n              <span className=\"text-sm font-medium\">Risk Rating</span>\n              <Badge\n                variant=\"outline\"\n                className={cn(\"capitalize\", getRiskRatingColor(compliance.aml_risk_rating))}\n              >\n                {compliance.aml_risk_rating || 'Not Assessed'}\n              </Badge>\n            </div>\n            <div className=\"flex items-center justify-between\">\n              <span className=\"text-sm font-medium\">Last Reviewed</span>\n              <span className=\"text-sm text-muted-foreground\">\n                {compliance.aml_last_reviewed_at\n                  ? format(new Date(compliance.aml_last_reviewed_at), 'MMM dd, yyyy')\n                  : 'Never'\n                }\n              </span>\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* PEP & Sanctions Card */}\n        <Card>\n          <CardHeader className=\"pb-3\">\n            <CardTitle className=\"text-lg flex items-center gap-2\">\n              <AlertTriangle className=\"h-5 w-5 text-amber-500\" />\n              PEP & Sanctions\n            </CardTitle>\n            <CardDescription>Politically Exposed Person and sanctions screening</CardDescription>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            <div className=\"flex items-center justify-between\">\n              <span className=\"text-sm font-medium\">PEP Status</span>\n              {compliance.is_pep ? (\n                <Badge variant=\"outline\" className=\"border-amber-500/50 text-amber-500 bg-amber-500/10\">\n                  <AlertTriangle className=\"h-3 w-3 mr-1\" />\n                  PEP Identified\n                </Badge>\n              ) : (\n                <Badge variant=\"outline\" className=\"border-green-500/50 text-green-500 bg-green-500/10\">\n                  <CheckCircle2 className=\"h-3 w-3 mr-1\" />\n                  Clear\n                </Badge>\n              )}\n            </div>\n            <div className=\"flex items-center justify-between\">\n              <span className=\"text-sm font-medium\">Sanctions Status</span>\n              {compliance.is_sanctioned ? (\n                <Badge variant=\"destructive\">\n                  <XCircle className=\"h-3 w-3 mr-1\" />\n                  Sanctions Match\n                </Badge>\n              ) : (\n                <Badge variant=\"outline\" className=\"border-green-500/50 text-green-500 bg-green-500/10\">\n                  <CheckCircle2 className=\"h-3 w-3 mr-1\" />\n                  Clear\n                </Badge>\n              )}\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* KYC Expiry Card */}\n        <Card>\n          <CardHeader className=\"pb-3\">\n            <CardTitle className=\"text-lg flex items-center gap-2\">\n              <FileText className=\"h-5 w-5 text-primary\" />\n              KYC Verification\n            </CardTitle>\n            <CardDescription>Know Your Customer verification status</CardDescription>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            <div className=\"flex items-center justify-between\">\n              <span className=\"text-sm font-medium\">Status</span>\n              <Badge\n                variant=\"outline\"\n                className={cn(\n                  compliance.kyc_status === 'approved' || compliance.kyc_status === 'verified'\n                    ? 'border-green-500/50 text-green-500 bg-green-500/10'\n                    : compliance.kyc_status === 'pending' || compliance.kyc_status === 'submitted'\n                    ? 'border-amber-500/50 text-amber-500 bg-amber-500/10'\n                    : 'border-muted text-muted-foreground'\n                )}\n              >\n                {compliance.kyc_status?.replace('_', ' ') || 'Not Started'}\n              </Badge>\n            </div>\n            <div>\n              <span className=\"text-sm font-medium block mb-2\">Expiry</span>\n              <ExpiryBadge date={compliance.kyc_expiry_date} label=\"KYC\" />\n            </div>\n            {compliance.kyc_completed_at && (\n              <div className=\"flex items-center justify-between text-sm\">\n                <span className=\"text-muted-foreground\">Completed</span>\n                <span className=\"text-muted-foreground\">\n                  {format(new Date(compliance.kyc_completed_at), 'MMM dd, yyyy')}\n                </span>\n              </div>\n            )}\n          </CardContent>\n        </Card>\n\n        {/* Accreditation Card */}\n        <Card>\n          <CardHeader className=\"pb-3\">\n            <CardTitle className=\"text-lg flex items-center gap-2\">\n              <CheckCircle2 className=\"h-5 w-5 text-primary\" />\n              Accreditation\n            </CardTitle>\n            <CardDescription>Investor accreditation and qualification status</CardDescription>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            <div className=\"flex items-center justify-between\">\n              <span className=\"text-sm font-medium\">Professional Investor</span>\n              {compliance.is_professional_investor ? (\n                <Badge variant=\"outline\" className=\"border-green-500/50 text-green-500 bg-green-500/10\">\n                  <CheckCircle2 className=\"h-3 w-3 mr-1\" />\n                  Yes\n                </Badge>\n              ) : (\n                <Badge variant=\"outline\" className=\"text-muted-foreground\">\n                  No\n                </Badge>\n              )}\n            </div>\n            <div className=\"flex items-center justify-between\">\n              <span className=\"text-sm font-medium\">Qualified Purchaser</span>\n              {compliance.is_qualified_purchaser ? (\n                <Badge variant=\"outline\" className=\"border-green-500/50 text-green-500 bg-green-500/10\">\n                  <CheckCircle2 className=\"h-3 w-3 mr-1\" />\n                  Yes\n                </Badge>\n              ) : (\n                <Badge variant=\"outline\" className=\"text-muted-foreground\">\n                  No\n                </Badge>\n              )}\n            </div>\n            <div>\n              <span className=\"text-sm font-medium block mb-2\">Accreditation Expiry</span>\n              <ExpiryBadge date={compliance.accreditation_expiry} label=\"Accreditation\" />\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Info Notice */}\n      <Card className=\"bg-muted/50\">\n        <CardContent className=\"pt-6\">\n          <p className=\"text-sm text-muted-foreground\">\n            Compliance status is managed by VERSO Holdings. If you believe any information is incorrect\n            or needs updating, please contact your relationship manager or email{' '}\n            <a href=\"mailto:compliance@versoholdings.com\" className=\"text-primary hover:underline\">\n              compliance@versoholdings.com\n            </a>\n          </p>\n        </CardContent>\n      </Card>\n    </div>\n  )\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAWA;AAAA;AAAA;AACA;;;AAnBA;;;;;;;;;AAkCA,SAAS,mBAAmB,MAAqB;IAC/C,OAAQ,QAAQ;QACd,KAAK;YACH,OAAO;QACT,KAAK;YACH,OAAO;QACT,KAAK;YACH,OAAO;QACT;YACE,OAAO;IACX;AACF;AAEA,SAAS,gBAAgB,UAAyB;IAChD,IAAI,CAAC,YAAY,OAAO;QAAE,QAAQ;QAAW,UAAU;IAAK;IAE5D,MAAM,SAAS,IAAI,KAAK;IACxB,MAAM,QAAQ,IAAI;IAClB,MAAM,WAAW,IAAA,6LAAgB,EAAC,QAAQ;IAE1C,IAAI,IAAA,yKAAM,EAAC,SAAS;QAClB,OAAO;YAAE,QAAQ;YAAW;QAAS;IACvC,OAAO,IAAI,YAAY,IAAI;QACzB,OAAO;YAAE,QAAQ;YAAiB;QAAS;IAC7C;IACA,OAAO;QAAE,QAAQ;QAAS;IAAS;AACrC;AAEA,SAAS,YAAY,EAAE,IAAI,EAAE,KAAK,EAA0C;IAC1E,MAAM,EAAE,MAAM,EAAE,QAAQ,EAAE,GAAG,gBAAgB;IAE7C,IAAI,WAAW,WAAW;QACxB,qBACE,oNAAC;YAAI,WAAU;;8BACb,oNAAC,uOAAK;oBAAC,WAAU;;;;;;8BACjB,oNAAC;oBAAK,WAAU;8BAAU;;;;;;;;;;;;IAGhC;IAEA,qBACE,oNAAC;QAAI,WAAU;;0BACb,oNAAC;gBAAI,WAAU;;oBACZ,WAAW,2BACV,oNAAC,oKAAK;wBAAC,SAAQ;wBAAc,WAAU;;0CACrC,oNAAC,iPAAO;gCAAC,WAAU;;;;;;4BAAY;;;;;;;oBAIlC,WAAW,iCACV,oNAAC,oKAAK;wBAAC,SAAQ;wBAAU,WAAU;;0CACjC,oNAAC,mQAAa;gCAAC,WAAU;;;;;;4BAAY;4BACzB;4BAAS;;;;;;;oBAGxB,WAAW,yBACV,oNAAC,oKAAK;wBAAC,SAAQ;wBAAU,WAAU;;0CACjC,oNAAC,+PAAY;gCAAC,WAAU;;;;;;4BAAY;;;;;;;;;;;;;0BAK1C,oNAAC;gBAAE,WAAU;;kCACX,oNAAC,gPAAQ;wBAAC,WAAU;;;;;;oBACnB,IAAA,yLAAM,EAAC,IAAI,KAAK,OAAQ;;;;;;;;;;;;;AAIjC;KAxCS;AA0CF,SAAS;;IACd,MAAM,CAAC,YAAY,cAAc,GAAG,IAAA,gMAAQ,EAAwB;IACpE,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,gMAAQ,EAAC;IACvC,MAAM,CAAC,OAAO,SAAS,GAAG,IAAA,gMAAQ,EAAgB;IAElD,IAAA,iMAAS;mCAAC;YACR;QACF;kCAAG,EAAE;IAEL,MAAM,sBAAsB;QAC1B,IAAI;YACF,WAAW;YACX,MAAM,WAAW,MAAM,MAAM;YAC7B,IAAI,CAAC,SAAS,EAAE,EAAE;gBAChB,MAAM,IAAI,MAAM;YAClB;YACA,MAAM,OAAO,MAAM,SAAS,IAAI;YAChC,cAAc;QAChB,EAAE,OAAO,KAAK;YACZ,SAAS,eAAe,QAAQ,IAAI,OAAO,GAAG;QAChD,SAAU;YACR,WAAW;QACb;IACF;IAEA,IAAI,SAAS;QACX,qBACE,oNAAC;YAAI,WAAU;;8BACb,oNAAC,0KAAQ;oBAAC,WAAU;;;;;;8BACpB,oNAAC;oBAAI,WAAU;;sCACb,oNAAC,0KAAQ;4BAAC,WAAU;;;;;;sCACpB,oNAAC,0KAAQ;4BAAC,WAAU;;;;;;sCACpB,oNAAC,0KAAQ;4BAAC,WAAU;;;;;;sCACpB,oNAAC,0KAAQ;4BAAC,WAAU;;;;;;;;;;;;;;;;;;IAI5B;IAEA,IAAI,OAAO;QACT,qBACE,oNAAC,kKAAI;YAAC,WAAU;sBACd,cAAA,oNAAC,yKAAW;gBAAC,WAAU;0BACrB,cAAA,oNAAC;oBAAI,WAAU;;sCACb,oNAAC,iPAAO;4BAAC,WAAU;;;;;;sCACnB,oNAAC;4BAAE,WAAU;sCAA4B;;;;;;sCACzC,oNAAC,sKAAM;4BAAC,SAAQ;4BAAQ,MAAK;4BAAK,SAAS;;8CACzC,oNAAC,uPAAS;oCAAC,WAAU;;;;;;gCAAiB;;;;;;;;;;;;;;;;;;;;;;;IAOlD;IAEA,IAAI,CAAC,YAAY;QACf,OAAO;IACT;IAEA,MAAM,YAAY,gBAAgB,WAAW,eAAe;IAC5D,MAAM,sBAAsB,gBAAgB,WAAW,oBAAoB;IAC3E,MAAM,sBACJ,WAAW,aAAa,IACxB,UAAU,MAAM,KAAK,aACrB,oBAAoB,MAAM,KAAK;IAEjC,qBACE,oNAAC;QAAI,WAAU;;0BACb,oNAAC;;kCACC,oNAAC;wBAAG,WAAU;kCAAoC;;;;;;kCAClD,oNAAC;wBAAE,WAAU;kCAAwB;;;;;;;;;;;;YAMtC,qCACC,oNAAC,kKAAI;gBAAC,WAAU;0BACd,cAAA,oNAAC,yKAAW;oBAAC,WAAU;8BACrB,cAAA,oNAAC;wBAAI,WAAU;;0CACb,oNAAC,6PAAW;gCAAC,WAAU;;;;;;0CACvB,oNAAC;;kDACC,oNAAC;wCAAE,WAAU;kDAA+B;;;;;;kDAC5C,oNAAC;wCAAE,WAAU;kDAAqC;;;;;;;;;;;;;;;;;;;;;;;;;;;;0BAS5D,oNAAC;gBAAI,WAAU;;kCAEb,oNAAC,kKAAI;;0CACH,oNAAC,wKAAU;gCAAC,WAAU;;kDACpB,oNAAC,uKAAS;wCAAC,WAAU;;0DACnB,oNAAC,6PAAW;gDAAC,WAAU;;;;;;4CAAyB;;;;;;;kDAGlD,oNAAC,6KAAe;kDAAC;;;;;;;;;;;;0CAEnB,oNAAC,yKAAW;gCAAC,WAAU;;kDACrB,oNAAC;wCAAI,WAAU;;0DACb,oNAAC;gDAAK,WAAU;0DAAsB;;;;;;0DACtC,oNAAC,oKAAK;gDACJ,SAAQ;gDACR,WAAW,IAAA,mJAAE,EAAC,cAAc,mBAAmB,WAAW,eAAe;0DAExE,WAAW,eAAe,IAAI;;;;;;;;;;;;kDAGnC,oNAAC;wCAAI,WAAU;;0DACb,oNAAC;gDAAK,WAAU;0DAAsB;;;;;;0DACtC,oNAAC;gDAAK,WAAU;0DACb,WAAW,oBAAoB,GAC5B,IAAA,yLAAM,EAAC,IAAI,KAAK,WAAW,oBAAoB,GAAG,kBAClD;;;;;;;;;;;;;;;;;;;;;;;;kCAQZ,oNAAC,kKAAI;;0CACH,oNAAC,wKAAU;gCAAC,WAAU;;kDACpB,oNAAC,uKAAS;wCAAC,WAAU;;0DACnB,oNAAC,mQAAa;gDAAC,WAAU;;;;;;4CAA2B;;;;;;;kDAGtD,oNAAC,6KAAe;kDAAC;;;;;;;;;;;;0CAEnB,oNAAC,yKAAW;gCAAC,WAAU;;kDACrB,oNAAC;wCAAI,WAAU;;0DACb,oNAAC;gDAAK,WAAU;0DAAsB;;;;;;4CACrC,WAAW,MAAM,iBAChB,oNAAC,oKAAK;gDAAC,SAAQ;gDAAU,WAAU;;kEACjC,oNAAC,mQAAa;wDAAC,WAAU;;;;;;oDAAiB;;;;;;qEAI5C,oNAAC,oKAAK;gDAAC,SAAQ;gDAAU,WAAU;;kEACjC,oNAAC,+PAAY;wDAAC,WAAU;;;;;;oDAAiB;;;;;;;;;;;;;kDAK/C,oNAAC;wCAAI,WAAU;;0DACb,oNAAC;gDAAK,WAAU;0DAAsB;;;;;;4CACrC,WAAW,aAAa,iBACvB,oNAAC,oKAAK;gDAAC,SAAQ;;kEACb,oNAAC,iPAAO;wDAAC,WAAU;;;;;;oDAAiB;;;;;;qEAItC,oNAAC,oKAAK;gDAAC,SAAQ;gDAAU,WAAU;;kEACjC,oNAAC,+PAAY;wDAAC,WAAU;;;;;;oDAAiB;;;;;;;;;;;;;;;;;;;;;;;;;kCASnD,oNAAC,kKAAI;;0CACH,oNAAC,wKAAU;gCAAC,WAAU;;kDACpB,oNAAC,uKAAS;wCAAC,WAAU;;0DACnB,oNAAC,oPAAQ;gDAAC,WAAU;;;;;;4CAAyB;;;;;;;kDAG/C,oNAAC,6KAAe;kDAAC;;;;;;;;;;;;0CAEnB,oNAAC,yKAAW;gCAAC,WAAU;;kDACrB,oNAAC;wCAAI,WAAU;;0DACb,oNAAC;gDAAK,WAAU;0DAAsB;;;;;;0DACtC,oNAAC,oKAAK;gDACJ,SAAQ;gDACR,WAAW,IAAA,mJAAE,EACX,WAAW,UAAU,KAAK,cAAc,WAAW,UAAU,KAAK,aAC9D,uDACA,WAAW,UAAU,KAAK,aAAa,WAAW,UAAU,KAAK,cACjE,uDACA;0DAGL,WAAW,UAAU,EAAE,QAAQ,KAAK,QAAQ;;;;;;;;;;;;kDAGjD,oNAAC;;0DACC,oNAAC;gDAAK,WAAU;0DAAiC;;;;;;0DACjD,oNAAC;gDAAY,MAAM,WAAW,eAAe;gDAAE,OAAM;;;;;;;;;;;;oCAEtD,WAAW,gBAAgB,kBAC1B,oNAAC;wCAAI,WAAU;;0DACb,oNAAC;gDAAK,WAAU;0DAAwB;;;;;;0DACxC,oNAAC;gDAAK,WAAU;0DACb,IAAA,yLAAM,EAAC,IAAI,KAAK,WAAW,gBAAgB,GAAG;;;;;;;;;;;;;;;;;;;;;;;;kCAQzD,oNAAC,kKAAI;;0CACH,oNAAC,wKAAU;gCAAC,WAAU;;kDACpB,oNAAC,uKAAS;wCAAC,WAAU;;0DACnB,oNAAC,+PAAY;gDAAC,WAAU;;;;;;4CAAyB;;;;;;;kDAGnD,oNAAC,6KAAe;kDAAC;;;;;;;;;;;;0CAEnB,oNAAC,yKAAW;gCAAC,WAAU;;kDACrB,oNAAC;wCAAI,WAAU;;0DACb,oNAAC;gDAAK,WAAU;0DAAsB;;;;;;4CACrC,WAAW,wBAAwB,iBAClC,oNAAC,oKAAK;gDAAC,SAAQ;gDAAU,WAAU;;kEACjC,oNAAC,+PAAY;wDAAC,WAAU;;;;;;oDAAiB;;;;;;qEAI3C,oNAAC,oKAAK;gDAAC,SAAQ;gDAAU,WAAU;0DAAwB;;;;;;;;;;;;kDAK/D,oNAAC;wCAAI,WAAU;;0DACb,oNAAC;gDAAK,WAAU;0DAAsB;;;;;;4CACrC,WAAW,sBAAsB,iBAChC,oNAAC,oKAAK;gDAAC,SAAQ;gDAAU,WAAU;;kEACjC,oNAAC,+PAAY;wDAAC,WAAU;;;;;;oDAAiB;;;;;;qEAI3C,oNAAC,oKAAK;gDAAC,SAAQ;gDAAU,WAAU;0DAAwB;;;;;;;;;;;;kDAK/D,oNAAC;;0DACC,oNAAC;gDAAK,WAAU;0DAAiC;;;;;;0DACjD,oNAAC;gDAAY,MAAM,WAAW,oBAAoB;gDAAE,OAAM;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;0BAOlE,oNAAC,kKAAI;gBAAC,WAAU;0BACd,cAAA,oNAAC,yKAAW;oBAAC,WAAU;8BACrB,cAAA,oNAAC;wBAAE,WAAU;;4BAAgC;4BAE0B;0CACrE,oNAAC;gCAAE,MAAK;gCAAsC,WAAU;0CAA+B;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAQnG;GAxQgB;MAAA"}},
    {"offset": {"line": 8346, "column": 0}, "map": {"version":3,"sources":["file:///Users/ghilesmoussaoui/Desktop/Versotech/versotech-portal/src/components/profile/generic-entity-members-tab.tsx"],"sourcesContent":["'use client'\n\n/**\n * Generic Entity Members Tab\n *\n * A reusable component for managing entity members (directors, UBOs, signatories)\n * across all persona types: investor, arranger, partner, introducer, lawyer, commercial_partner\n *\n * Uses MemberKYCEditDialog for comprehensive KYC field editing.\n */\n\nimport { useState, useEffect } from 'react'\nimport { Users, UserPlus, Edit, Trash2, ShieldCheck, Clock, AlertCircle } from 'lucide-react'\nimport { Button } from '@/components/ui/button'\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card'\nimport { Badge } from '@/components/ui/badge'\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from '@/components/ui/table'\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n} from '@/components/ui/alert-dialog'\nimport { toast } from 'sonner'\nimport { MemberKYCEditDialog } from '@/components/shared/member-kyc-edit-dialog'\n\n// Entity types that support members\nexport type EntityType = 'investor' | 'partner' | 'introducer' | 'lawyer' | 'arranger' | 'commercial_partner'\n\n// Member data structure\ninterface EntityMember {\n  id: string\n  full_name?: string\n  first_name?: string\n  middle_name?: string\n  last_name?: string\n  name_suffix?: string\n  role: string\n  role_title?: string\n  email?: string\n  phone_mobile?: string\n  phone_office?: string\n  date_of_birth?: string\n  country_of_birth?: string\n  nationality?: string\n  residential_street?: string\n  residential_line_2?: string\n  residential_city?: string\n  residential_state?: string\n  residential_postal_code?: string\n  residential_country?: string\n  is_us_citizen?: boolean\n  is_us_taxpayer?: boolean\n  us_taxpayer_id?: string\n  country_of_tax_residency?: string\n  tax_id_number?: string\n  id_type?: string\n  id_number?: string\n  id_issue_date?: string\n  id_expiry_date?: string\n  id_issuing_country?: string\n  ownership_percentage?: number\n  is_beneficial_owner?: boolean\n  is_signatory?: boolean\n  kyc_status?: string\n  is_active?: boolean\n  created_at?: string\n}\n\ninterface GenericEntityMembersTabProps {\n  entityType: EntityType\n  entityId: string\n  entityName?: string\n  /** Base API endpoint for members, e.g., '/api/investors/me/members' */\n  apiEndpoint: string\n  /** Whether the current user can manage members */\n  canManage?: boolean\n  /** Optional custom title */\n  title?: string\n  /** Optional custom description */\n  description?: string\n}\n\nconst ROLE_LABELS: Record<string, string> = {\n  director: 'Director',\n  shareholder: 'Shareholder',\n  beneficial_owner: 'Beneficial Owner',\n  authorized_signatory: 'Authorized Signatory',\n  officer: 'Officer',\n  partner: 'Partner',\n  ubo: 'UBO',\n  signatory: 'Signatory',\n  authorized_representative: 'Authorized Representative',\n  beneficiary: 'Beneficiary',\n  trustee: 'Trustee',\n  managing_member: 'Managing Member',\n  general_partner: 'General Partner',\n  limited_partner: 'Limited Partner',\n  other: 'Other',\n}\n\nexport function GenericEntityMembersTab({\n  entityType,\n  entityId,\n  entityName,\n  apiEndpoint,\n  canManage = true,\n  title = 'Entity Members',\n  description = 'Manage directors, shareholders, and beneficial owners',\n}: GenericEntityMembersTabProps) {\n  const [members, setMembers] = useState<EntityMember[]>([])\n  const [loading, setLoading] = useState(true)\n  const [error, setError] = useState<string | null>(null)\n\n  // Dialog states\n  const [editDialogOpen, setEditDialogOpen] = useState(false)\n  const [editingMember, setEditingMember] = useState<EntityMember | null>(null)\n  const [deleteDialogOpen, setDeleteDialogOpen] = useState(false)\n  const [deletingMemberId, setDeletingMemberId] = useState<string | null>(null)\n  const [isDeleting, setIsDeleting] = useState(false)\n\n  // Load members\n  useEffect(() => {\n    loadMembers()\n  }, [apiEndpoint])\n\n  const loadMembers = async () => {\n    setLoading(true)\n    setError(null)\n\n    try {\n      const response = await fetch(apiEndpoint)\n      if (!response.ok) {\n        const data = await response.json()\n        throw new Error(data.error || 'Failed to load members')\n      }\n\n      const data = await response.json()\n      setMembers(data.members || [])\n    } catch (err) {\n      console.error('Error loading members:', err)\n      setError(err instanceof Error ? err.message : 'Failed to load members')\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  const handleAddMember = () => {\n    setEditingMember(null)\n    setEditDialogOpen(true)\n  }\n\n  const handleEditMember = (member: EntityMember) => {\n    setEditingMember(member)\n    setEditDialogOpen(true)\n  }\n\n  const handleDeleteClick = (memberId: string) => {\n    setDeletingMemberId(memberId)\n    setDeleteDialogOpen(true)\n  }\n\n  const handleDeleteConfirm = async () => {\n    if (!deletingMemberId) return\n\n    setIsDeleting(true)\n    try {\n      const response = await fetch(`${apiEndpoint}/${deletingMemberId}`, {\n        method: 'DELETE',\n      })\n\n      if (!response.ok) {\n        const data = await response.json()\n        throw new Error(data.error || 'Failed to delete member')\n      }\n\n      toast.success('Member removed successfully')\n      setDeleteDialogOpen(false)\n      setDeletingMemberId(null)\n      await loadMembers()\n    } catch (err) {\n      console.error('Error deleting member:', err)\n      toast.error(err instanceof Error ? err.message : 'Failed to delete member')\n    } finally {\n      setIsDeleting(false)\n    }\n  }\n\n  const handleDialogSuccess = () => {\n    loadMembers()\n  }\n\n  const getDisplayName = (member: EntityMember) => {\n    if (member.full_name) return member.full_name\n    const parts = [member.first_name, member.middle_name, member.last_name, member.name_suffix].filter(Boolean)\n    return parts.length > 0 ? parts.join(' ') : 'Unknown'\n  }\n\n  const getRoleBadge = (role: string) => {\n    return <Badge variant=\"outline\">{ROLE_LABELS[role] || role}</Badge>\n  }\n\n  const getKYCStatusBadge = (status?: string) => {\n    switch (status) {\n      case 'approved':\n        return <Badge className=\"bg-green-500\"><ShieldCheck className=\"w-3 h-3 mr-1\" />Approved</Badge>\n      case 'pending':\n      case 'submitted':\n        return <Badge className=\"bg-yellow-500\"><Clock className=\"w-3 h-3 mr-1\" />Pending</Badge>\n      case 'rejected':\n        return <Badge className=\"bg-red-500\"><AlertCircle className=\"w-3 h-3 mr-1\" />Rejected</Badge>\n      default:\n        return <Badge variant=\"outline\">Not Submitted</Badge>\n    }\n  }\n\n  // Convert member data to form format for MemberKYCEditDialog\n  const getMemberInitialData = (member: EntityMember | null) => {\n    if (!member) return undefined\n\n    return {\n      role: member.role as any,\n      first_name: member.first_name || '',\n      middle_name: member.middle_name || '',\n      last_name: member.last_name || '',\n      name_suffix: member.name_suffix || '',\n      date_of_birth: member.date_of_birth || '',\n      country_of_birth: member.country_of_birth || '',\n      nationality: member.nationality || '',\n      email: member.email || '',\n      phone_mobile: member.phone_mobile || '',\n      phone_office: member.phone_office || '',\n      residential_street: member.residential_street || '',\n      residential_line_2: member.residential_line_2 || '',\n      residential_city: member.residential_city || '',\n      residential_state: member.residential_state || '',\n      residential_postal_code: member.residential_postal_code || '',\n      residential_country: member.residential_country || '',\n      is_us_citizen: member.is_us_citizen || false,\n      is_us_taxpayer: member.is_us_taxpayer || false,\n      us_taxpayer_id: member.us_taxpayer_id || '',\n      country_of_tax_residency: member.country_of_tax_residency || '',\n      tax_id_number: member.tax_id_number || '',\n      id_type: member.id_type || '',\n      id_number: member.id_number || '',\n      id_issue_date: member.id_issue_date || '',\n      id_expiry_date: member.id_expiry_date || '',\n      id_issuing_country: member.id_issuing_country || '',\n      ownership_percentage: member.ownership_percentage,\n    }\n  }\n\n  if (loading) {\n    return (\n      <Card>\n        <CardContent className=\"py-12 text-center\">\n          <div className=\"animate-pulse\">Loading members...</div>\n        </CardContent>\n      </Card>\n    )\n  }\n\n  if (error) {\n    return (\n      <Card>\n        <CardContent className=\"py-12 text-center\">\n          <AlertCircle className=\"w-12 h-12 mx-auto text-destructive mb-4\" />\n          <p className=\"text-destructive\">{error}</p>\n          <Button onClick={loadMembers} variant=\"outline\" className=\"mt-4\">\n            Retry\n          </Button>\n        </CardContent>\n      </Card>\n    )\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      <Card>\n        <CardHeader>\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <CardTitle className=\"flex items-center gap-2\">\n                <Users className=\"h-5 w-5\" />\n                {title}\n              </CardTitle>\n              <CardDescription>{description}</CardDescription>\n            </div>\n            {canManage && (\n              <Button onClick={handleAddMember}>\n                <UserPlus className=\"w-4 h-4 mr-2\" />\n                Add Member\n              </Button>\n            )}\n          </div>\n        </CardHeader>\n        <CardContent>\n          {members.length === 0 ? (\n            <div className=\"text-center py-12\">\n              <Users className=\"w-12 h-12 mx-auto text-muted-foreground mb-4\" />\n              <p className=\"text-muted-foreground mb-4\">\n                No members added yet. Add directors, shareholders, or beneficial owners.\n              </p>\n              {canManage && (\n                <Button onClick={handleAddMember} variant=\"outline\">\n                  <UserPlus className=\"w-4 h-4 mr-2\" />\n                  Add Your First Member\n                </Button>\n              )}\n            </div>\n          ) : (\n            <Table>\n              <TableHeader>\n                <TableRow>\n                  <TableHead>Name</TableHead>\n                  <TableHead>Role</TableHead>\n                  <TableHead>Email</TableHead>\n                  <TableHead>Ownership %</TableHead>\n                  <TableHead>KYC Status</TableHead>\n                  {canManage && <TableHead className=\"text-right\">Actions</TableHead>}\n                </TableRow>\n              </TableHeader>\n              <TableBody>\n                {members.map((member) => (\n                  <TableRow key={member.id}>\n                    <TableCell className=\"font-medium\">\n                      {getDisplayName(member)}\n                      {member.is_beneficial_owner && (\n                        <Badge variant=\"secondary\" className=\"ml-2 text-xs\">UBO</Badge>\n                      )}\n                      {member.is_signatory && (\n                        <Badge variant=\"secondary\" className=\"ml-2 text-xs\">Signatory</Badge>\n                      )}\n                    </TableCell>\n                    <TableCell>\n                      {getRoleBadge(member.role)}\n                      {member.role_title && (\n                        <span className=\"text-sm text-muted-foreground ml-2\">\n                          ({member.role_title})\n                        </span>\n                      )}\n                    </TableCell>\n                    <TableCell>{member.email || 'N/A'}</TableCell>\n                    <TableCell>\n                      {member.ownership_percentage != null ? `${member.ownership_percentage}%` : 'N/A'}\n                    </TableCell>\n                    <TableCell>{getKYCStatusBadge(member.kyc_status)}</TableCell>\n                    {canManage && (\n                      <TableCell className=\"text-right\">\n                        <div className=\"flex items-center justify-end gap-2\">\n                          <Button\n                            variant=\"outline\"\n                            size=\"sm\"\n                            onClick={() => handleEditMember(member)}\n                          >\n                            <Edit className=\"w-4 h-4\" />\n                          </Button>\n                          <Button\n                            variant=\"outline\"\n                            size=\"sm\"\n                            onClick={() => handleDeleteClick(member.id)}\n                          >\n                            <Trash2 className=\"w-4 h-4\" />\n                          </Button>\n                        </div>\n                      </TableCell>\n                    )}\n                  </TableRow>\n                ))}\n              </TableBody>\n            </Table>\n          )}\n        </CardContent>\n      </Card>\n\n      {/* Edit/Add Member Dialog - Uses MemberKYCEditDialog */}\n      <MemberKYCEditDialog\n        open={editDialogOpen}\n        onOpenChange={setEditDialogOpen}\n        entityType={entityType}\n        entityId={entityId}\n        memberId={editingMember?.id}\n        memberName={editingMember ? getDisplayName(editingMember) : undefined}\n        initialData={getMemberInitialData(editingMember)}\n        apiEndpoint={apiEndpoint}\n        onSuccess={handleDialogSuccess}\n        mode={editingMember ? 'edit' : 'create'}\n      />\n\n      {/* Delete Confirmation Dialog */}\n      <AlertDialog open={deleteDialogOpen} onOpenChange={setDeleteDialogOpen}>\n        <AlertDialogContent>\n          <AlertDialogHeader>\n            <AlertDialogTitle>Remove Member</AlertDialogTitle>\n            <AlertDialogDescription>\n              Are you sure you want to remove this member? This action can be undone by contacting support.\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter>\n            <AlertDialogCancel disabled={isDeleting}>Cancel</AlertDialogCancel>\n            <AlertDialogAction\n              onClick={handleDeleteConfirm}\n              disabled={isDeleting}\n              className=\"bg-destructive text-destructive-foreground hover:bg-destructive/90\"\n            >\n              {isDeleting ? 'Removing...' : 'Remove'}\n            </AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n    </div>\n  )\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 9080, "column": 0}, "map": {"version":3,"sources":["file:///Users/ghilesmoussaoui/Desktop/Versotech/versotech-portal/src/components/profile/signature-specimen-tab.tsx"],"sourcesContent":["'use client'\n\nimport { useState, useRef, useEffect } from 'react'\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card'\nimport { Button } from '@/components/ui/button'\nimport { Input } from '@/components/ui/input'\nimport { Label } from '@/components/ui/label'\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs'\nimport { Alert, AlertDescription } from '@/components/ui/alert'\nimport {\n  PenTool,\n  Upload,\n  Trash2,\n  Save,\n  RotateCcw,\n  CheckCircle2,\n  Loader2,\n  AlertCircle,\n  Image as ImageIcon,\n} from 'lucide-react'\nimport { toast } from 'sonner'\nimport { cn } from '@/lib/utils'\nimport SignatureCanvas from 'react-signature-canvas'\n\ntype EntityType = 'investor' | 'commercial_partner' | 'partner' | 'introducer' | 'lawyer'\n\ninterface SignatureSpecimenTabProps {\n  currentSignatureUrl?: string | null\n  onSignatureUpdate?: (url: string | null) => void\n  entityType?: EntityType\n  entityId?: string\n}\n\nfunction getSignatureApiEndpoints(entityType: EntityType = 'investor') {\n  switch (entityType) {\n    case 'commercial_partner':\n      return {\n        get: '/api/commercial-partners/me/signature',\n        post: '/api/commercial-partners/me/upload-signature',\n        delete: '/api/commercial-partners/me/signature',\n      }\n    case 'partner':\n      return {\n        get: '/api/partners/me/signature',\n        post: '/api/partners/me/upload-signature',\n        delete: '/api/partners/me/signature',\n      }\n    case 'introducer':\n      return {\n        get: '/api/introducers/me/signature',\n        post: '/api/introducers/me/upload-signature',\n        delete: '/api/introducers/me/signature',\n      }\n    case 'lawyer':\n      return {\n        get: '/api/lawyers/me/signature',\n        post: '/api/lawyers/me/upload-signature',\n        delete: '/api/lawyers/me/signature',\n      }\n    case 'investor':\n    default:\n      return {\n        get: '/api/signature-specimen',\n        post: '/api/signature-specimen',\n        delete: '/api/signature-specimen',\n      }\n  }\n}\n\nexport function SignatureSpecimenTab({\n  currentSignatureUrl,\n  onSignatureUpdate,\n  entityType = 'investor',\n}: SignatureSpecimenTabProps) {\n  const apiEndpoints = getSignatureApiEndpoints(entityType)\n  const sigCanvasRef = useRef<SignatureCanvas>(null)\n\n  const [hasDrawn, setHasDrawn] = useState(false)\n  const [signatureUrl, setSignatureUrl] = useState<string | null>(currentSignatureUrl || null)\n  const [isLoading, setIsLoading] = useState(false)\n  const [isSaving, setIsSaving] = useState(false)\n  const [uploadedFile, setUploadedFile] = useState<File | null>(null)\n  const [uploadPreview, setUploadPreview] = useState<string | null>(null)\n  const [activeTab, setActiveTab] = useState<'draw' | 'upload'>('draw')\n  const [error, setError] = useState<string | null>(null)\n\n  useEffect(() => {\n    loadExistingSignature()\n  }, [])\n\n  const loadExistingSignature = async () => {\n    setIsLoading(true)\n    try {\n      const response = await fetch(apiEndpoints.get)\n      if (response.ok) {\n        const data = await response.json()\n        if (data.signature_url) {\n          setSignatureUrl(data.signature_url)\n        }\n      }\n    } catch (err) {\n      console.error('Error loading signature:', err)\n    } finally {\n      setIsLoading(false)\n    }\n  }\n\n  const handleDrawEnd = () => {\n    if (sigCanvasRef.current && !sigCanvasRef.current.isEmpty()) {\n      setHasDrawn(true)\n      setError(null)\n    }\n  }\n\n  const clearCanvas = () => {\n    if (sigCanvasRef.current) {\n      sigCanvasRef.current.clear()\n      setHasDrawn(false)\n    }\n  }\n\n  const handleFileUpload = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const file = e.target.files?.[0]\n    if (!file) return\n\n    if (!['image/png', 'image/jpeg', 'image/webp'].includes(file.type)) {\n      setError('Please upload a PNG, JPEG, or WebP image')\n      return\n    }\n\n    if (file.size > 2 * 1024 * 1024) {\n      setError('File size must be less than 2MB')\n      return\n    }\n\n    setUploadedFile(file)\n    setError(null)\n\n    const reader = new FileReader()\n    reader.onload = (event) => {\n      setUploadPreview(event.target?.result as string)\n    }\n    reader.readAsDataURL(file)\n  }\n\n  const clearUpload = () => {\n    setUploadedFile(null)\n    setUploadPreview(null)\n  }\n\n  const saveSignature = async () => {\n    setIsSaving(true)\n    setError(null)\n\n    try {\n      let blob: Blob\n\n      if (activeTab === 'draw') {\n        if (!sigCanvasRef.current || sigCanvasRef.current.isEmpty()) {\n          setError('Please draw your signature first')\n          setIsSaving(false)\n          return\n        }\n\n        // Get trimmed canvas data URL (removes whitespace around signature)\n        const trimmedCanvas = sigCanvasRef.current.getTrimmedCanvas()\n        const dataUrl = trimmedCanvas.toDataURL('image/png')\n\n        // Convert data URL to blob\n        const response = await fetch(dataUrl)\n        blob = await response.blob()\n      } else {\n        if (!uploadedFile) {\n          setError('Please upload an image first')\n          setIsSaving(false)\n          return\n        }\n        blob = uploadedFile\n      }\n\n      const formData = new FormData()\n      formData.append('signature', blob, 'signature.png')\n\n      const apiResponse = await fetch(apiEndpoints.post, {\n        method: 'POST',\n        body: formData,\n      })\n\n      if (!apiResponse.ok) {\n        const errorData = await apiResponse.json()\n        throw new Error(errorData.error || 'Failed to save signature')\n      }\n\n      const data = await apiResponse.json()\n      setSignatureUrl(data.signature_url)\n      onSignatureUpdate?.(data.signature_url)\n\n      if (activeTab === 'draw') {\n        clearCanvas()\n      } else {\n        clearUpload()\n      }\n\n      toast.success('Signature saved successfully')\n    } catch (err) {\n      console.error('Error saving signature:', err)\n      setError(err instanceof Error ? err.message : 'Failed to save signature')\n      toast.error('Failed to save signature')\n    } finally {\n      setIsSaving(false)\n    }\n  }\n\n  const deleteSignature = async () => {\n    if (!signatureUrl) return\n\n    setIsSaving(true)\n    try {\n      const response = await fetch(apiEndpoints.delete, {\n        method: 'DELETE',\n      })\n\n      if (!response.ok) {\n        throw new Error('Failed to delete signature')\n      }\n\n      setSignatureUrl(null)\n      onSignatureUpdate?.(null)\n      toast.success('Signature removed')\n    } catch (err) {\n      console.error('Error deleting signature:', err)\n      toast.error('Failed to remove signature')\n    } finally {\n      setIsSaving(false)\n    }\n  }\n\n  if (isLoading) {\n    return (\n      <Card>\n        <CardContent className=\"py-12\">\n          <div className=\"flex items-center justify-center\">\n            <Loader2 className=\"h-8 w-8 animate-spin text-muted-foreground\" />\n          </div>\n        </CardContent>\n      </Card>\n    )\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      {signatureUrl && (\n        <Card>\n          <CardHeader>\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <CardTitle className=\"text-base flex items-center gap-2\">\n                  <CheckCircle2 className=\"h-5 w-5 text-green-600\" />\n                  Current Signature\n                </CardTitle>\n                <CardDescription>\n                  Your signature specimen on file\n                </CardDescription>\n              </div>\n              <Button\n                variant=\"outline\"\n                size=\"sm\"\n                onClick={deleteSignature}\n                disabled={isSaving}\n                className=\"text-red-600 hover:text-red-700 hover:bg-red-50 dark:text-red-400 dark:hover:text-red-300 dark:hover:bg-red-950/50\"\n              >\n                {isSaving ? (\n                  <Loader2 className=\"h-4 w-4 animate-spin mr-2\" />\n                ) : (\n                  <Trash2 className=\"h-4 w-4 mr-2\" />\n                )}\n                Remove\n              </Button>\n            </div>\n          </CardHeader>\n          <CardContent>\n            <div className=\"border rounded-lg p-4 bg-white flex items-center justify-center\">\n              <img\n                src={signatureUrl}\n                alt=\"Your signature\"\n                className=\"max-h-24 object-contain\"\n              />\n            </div>\n          </CardContent>\n        </Card>\n      )}\n\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"text-base\">\n            {signatureUrl ? 'Update Signature' : 'Add Signature'}\n          </CardTitle>\n          <CardDescription>\n            Draw your signature or upload an image. This will be used for document signing.\n          </CardDescription>\n        </CardHeader>\n        <CardContent className=\"space-y-4\">\n          {error && (\n            <Alert variant=\"destructive\">\n              <AlertCircle className=\"h-4 w-4\" />\n              <AlertDescription>{error}</AlertDescription>\n            </Alert>\n          )}\n\n          <Tabs value={activeTab} onValueChange={(v) => setActiveTab(v as 'draw' | 'upload')}>\n            <TabsList className=\"grid w-full grid-cols-2\">\n              <TabsTrigger value=\"draw\" className=\"gap-2\">\n                <PenTool className=\"h-4 w-4\" />\n                Draw\n              </TabsTrigger>\n              <TabsTrigger value=\"upload\" className=\"gap-2\">\n                <Upload className=\"h-4 w-4\" />\n                Upload\n              </TabsTrigger>\n            </TabsList>\n\n            <TabsContent value=\"draw\" className=\"mt-4 space-y-4\">\n              <div className=\"border-2 border-dashed rounded-lg bg-white overflow-hidden\">\n                <SignatureCanvas\n                  ref={sigCanvasRef}\n                  canvasProps={{\n                    className: 'w-full h-40 cursor-crosshair',\n                    style: { width: '100%', height: '160px' }\n                  }}\n                  penColor=\"black\"\n                  backgroundColor=\"white\"\n                  onEnd={handleDrawEnd}\n                />\n              </div>\n              <p className=\"text-xs text-muted-foreground text-center\">\n                Draw your signature using your mouse or touch screen\n              </p>\n              <div className=\"flex gap-2\">\n                <Button\n                  variant=\"outline\"\n                  onClick={clearCanvas}\n                  disabled={!hasDrawn}\n                  className=\"flex-1\"\n                >\n                  <RotateCcw className=\"h-4 w-4 mr-2\" />\n                  Clear\n                </Button>\n                <Button\n                  onClick={saveSignature}\n                  disabled={!hasDrawn || isSaving}\n                  className=\"flex-1\"\n                >\n                  {isSaving ? (\n                    <Loader2 className=\"h-4 w-4 animate-spin mr-2\" />\n                  ) : (\n                    <Save className=\"h-4 w-4 mr-2\" />\n                  )}\n                  Save Signature\n                </Button>\n              </div>\n            </TabsContent>\n\n            <TabsContent value=\"upload\" className=\"mt-4 space-y-4\">\n              {uploadPreview ? (\n                <div className=\"space-y-4\">\n                  <div className=\"border rounded-lg p-4 bg-white flex items-center justify-center\">\n                    <img\n                      src={uploadPreview}\n                      alt=\"Signature preview\"\n                      className=\"max-h-32 object-contain\"\n                    />\n                  </div>\n                  <div className=\"flex gap-2\">\n                    <Button\n                      variant=\"outline\"\n                      onClick={clearUpload}\n                      className=\"flex-1\"\n                    >\n                      <RotateCcw className=\"h-4 w-4 mr-2\" />\n                      Choose Different\n                    </Button>\n                    <Button\n                      onClick={saveSignature}\n                      disabled={isSaving}\n                      className=\"flex-1\"\n                    >\n                      {isSaving ? (\n                        <Loader2 className=\"h-4 w-4 animate-spin mr-2\" />\n                      ) : (\n                        <Save className=\"h-4 w-4 mr-2\" />\n                      )}\n                      Save Signature\n                    </Button>\n                  </div>\n                </div>\n              ) : (\n                <div>\n                  <Label\n                    htmlFor=\"signature-upload\"\n                    className={cn(\n                      \"flex flex-col items-center justify-center w-full h-40 border-2 border-dashed rounded-lg cursor-pointer\",\n                      \"bg-muted/50 hover:bg-muted transition-colors\"\n                    )}\n                  >\n                    <div className=\"flex flex-col items-center justify-center pt-5 pb-6\">\n                      <ImageIcon className=\"h-10 w-10 text-muted-foreground mb-3\" />\n                      <p className=\"mb-2 text-sm text-muted-foreground\">\n                        <span className=\"font-semibold\">Click to upload</span> or drag and drop\n                      </p>\n                      <p className=\"text-xs text-muted-foreground\">\n                        PNG, JPEG or WebP (max 2MB)\n                      </p>\n                    </div>\n                    <Input\n                      id=\"signature-upload\"\n                      type=\"file\"\n                      accept=\"image/png,image/jpeg,image/webp\"\n                      className=\"hidden\"\n                      onChange={handleFileUpload}\n                    />\n                  </Label>\n                </div>\n              )}\n            </TabsContent>\n          </Tabs>\n        </CardContent>\n      </Card>\n\n      <Card className=\"bg-blue-50/50 border-blue-200 dark:bg-blue-950/30 dark:border-blue-900\">\n        <CardContent className=\"py-4\">\n          <div className=\"flex gap-3\">\n            <PenTool className=\"h-5 w-5 text-blue-600 dark:text-blue-400 flex-shrink-0 mt-0.5\" />\n            <div className=\"text-sm\">\n              <p className=\"font-medium text-blue-900 dark:text-blue-100\">About Signature Specimens</p>\n              <p className=\"text-blue-700 dark:text-blue-300 mt-1\">\n                Your signature specimen will be used for digitally signing documents such as\n                subscription agreements, NDAs, and introducer agreements. Make sure your\n                signature is clear and consistent with your legal documents.\n              </p>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  )\n}\n"],"names":[],"mappings":"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"}}]
}