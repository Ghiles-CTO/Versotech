(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,949382,e=>{"use strict";var t=e.i(722679),a=e.i(340915),n=e.i(90613),s=e.i(129432),r=e.i(316264),l=e.i(191569),i=e.i(538892),d=e.i(237635),c=e.i(429760),o=e.i(553426),u=e.i(196767),m=e.i(645855),x=e.i(15098),h=e.i(750809),_=e.i(263229),g=e.i(401148),f=e.i(971743),j=e.i(10994),p=e.i(994659),b=e.i(619324),v=e.i(561866),y=e.i(832033),y=y,w=e.i(761722),N=e.i(275034),C=e.i(282141),T=e.i(501495),S=e.i(59178),D=e.i(352776),k=e.i(514133),F=e.i(816654),L=e.i(80465),P=e.i(994500);function H({open:e,onOpenChange:n,subscriptionId:s,dealName:d,investorName:c,commitment:o,fundedAmount:u,currency:m,mode:x,onSuccess:h,feeEventId:g=null,defaultAmount:f=null,defaultPaymentType:j,defaultRecipientId:p=null}){let[b,v]=(0,a.useState)(!1),[y,w]=(0,a.useState)(""),[N,C]=(0,a.useState)(""),[T,S]=(0,a.useState)(""),[H,A]=(0,a.useState)(""),[I,E]=(0,a.useState)(""),B=o-u;(0,a.useEffect)(()=>{e&&("payment"===x?(w(null!=f?String(f):""),A(j||""),E(p||"")):(w(""),A(""),E("")))},[e,x,f,j,p]);let R=async()=>{if(!s)return void P.toast.error("Invalid subscription reference");if(!y||0>=parseFloat(y))return void P.toast.error("Please enter a valid amount");v(!0);try{let e=await fetch(`/api/escrow/${s}/confirm-funding`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({amount:parseFloat(y),bank_reference:N||void 0,confirmation_notes:T||void 0})}),t=await e.json();if(!e.ok)throw Error(t.error||"Failed to confirm funding");P.toast.success(t.data.message),n(!1),h?.(),w(""),C(""),S("")}catch(e){console.error("Funding confirmation error:",e),P.toast.error(e instanceof Error?e.message:"Failed to confirm funding")}finally{v(!1)}},O=async()=>{if(!s)return void P.toast.error("Invalid subscription reference");if(!y||0>=parseFloat(y))return void P.toast.error("Please enter a valid amount");if(!H)return void P.toast.error("Please select a payment type");if("seller"!==H&&!I)return void P.toast.error("Please enter a recipient ID");v(!0);try{let e={payment_type:H,amount:parseFloat(y),bank_reference:N||void 0,confirmation_notes:T||void 0,fee_event_id:g||void 0};"seller"!==H&&(e.recipient_id=I);let t=await fetch(`/api/escrow/${s}/confirm-payment`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),a=await t.json();if(!t.ok)throw Error(a.error||"Failed to confirm payment");P.toast.success(a.data.message),n(!1),h?.(),w(""),C(""),S(""),A(""),E("")}catch(e){console.error("Payment confirmation error:",e),P.toast.error(e instanceof Error?e.message:"Failed to confirm payment")}finally{v(!1)}};return(0,t.jsx)(D.Dialog,{open:e,onOpenChange:n,children:(0,t.jsxs)(D.DialogContent,{className:"sm:max-w-[500px]",children:[(0,t.jsxs)(D.DialogHeader,{children:[(0,t.jsx)(D.DialogTitle,{children:"funding"===x?"Confirm Escrow Funding":"Confirm Fee Payment"}),(0,t.jsx)(D.DialogDescription,{children:"funding"===x?(0,t.jsxs)(t.Fragment,{children:["Confirm funding received for ",(0,t.jsx)("strong",{children:c}),"'s subscription in ",(0,t.jsx)("strong",{children:d}),"."]}):(0,t.jsxs)(t.Fragment,{children:["Confirm fee payment processed for ",(0,t.jsx)("strong",{children:d}),"."]})})]}),(0,t.jsxs)("div",{className:"space-y-4 py-4",children:["funding"===x&&(0,t.jsxs)("div",{className:"rounded-lg bg-muted p-3 text-sm",children:[(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{className:"text-muted-foreground",children:"Commitment:"}),(0,t.jsxs)("span",{className:"font-medium",children:[o.toLocaleString()," ",m]})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{className:"text-muted-foreground",children:"Already Funded:"}),(0,t.jsxs)("span",{className:"font-medium",children:[u.toLocaleString()," ",m]})]}),(0,t.jsxs)("div",{className:"flex justify-between border-t pt-2 mt-2",children:[(0,t.jsx)("span",{className:"text-muted-foreground",children:"Remaining:"}),(0,t.jsxs)("span",{className:"font-bold text-amber-600",children:[B.toLocaleString()," ",m]})]})]}),"payment"===x&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(k.Label,{htmlFor:"paymentType",children:"Payment Type"}),(0,t.jsxs)(i.Select,{value:H,onValueChange:A,children:[(0,t.jsx)(i.SelectTrigger,{children:(0,t.jsx)(i.SelectValue,{placeholder:"Select payment type"})}),(0,t.jsxs)(i.SelectContent,{children:[(0,t.jsx)(i.SelectItem,{value:"partner",children:"Partner Fee"}),(0,t.jsx)(i.SelectItem,{value:"introducer",children:"Introducer Fee"}),(0,t.jsx)(i.SelectItem,{value:"commercial_partner",children:"Commercial Partner Fee"}),(0,t.jsx)(i.SelectItem,{value:"seller",children:"Payment to Seller"})]})]})]}),"seller"!==H&&(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(k.Label,{htmlFor:"recipientId",children:"Recipient ID"}),(0,t.jsx)(l.Input,{id:"recipientId",placeholder:"Enter recipient entity ID",value:I,onChange:e=>E(e.target.value)})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)(k.Label,{htmlFor:"amount",children:["Amount Confirmed (",m,")"]}),(0,t.jsx)(l.Input,{id:"amount",type:"number",step:"0.01",min:"0",placeholder:"funding"===x?`e.g., ${B.toLocaleString()}`:"Enter amount",value:y,onChange:e=>w(e.target.value)})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(k.Label,{htmlFor:"bankReference",children:"Bank Reference (Optional)"}),(0,t.jsx)(l.Input,{id:"bankReference",placeholder:"Wire transfer reference",value:N,onChange:e=>C(e.target.value)})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(k.Label,{htmlFor:"notes",children:"Notes (Optional)"}),(0,t.jsx)(F.Textarea,{id:"notes",placeholder:"Any additional notes...",value:T,onChange:e=>S(e.target.value),rows:2})]})]}),(0,t.jsxs)(D.DialogFooter,{children:[(0,t.jsx)(r.Button,{variant:"outline",onClick:()=>n(!1),disabled:b,children:"Cancel"}),(0,t.jsx)(r.Button,{onClick:"funding"===x?R:O,disabled:b,children:b?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(_.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),"Confirming..."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(L.CheckCircle,{className:"mr-2 h-4 w-4"}),"Confirm ","funding"===x?"Funding":"Payment"]})})]})]})})}var A=e.i(83245);let I={pending:"bg-yellow-100 text-yellow-800 border-yellow-200",funded:"bg-green-100 text-green-800 border-green-200",partially_funded:"bg-blue-100 text-blue-800 border-blue-200",overdue:"bg-red-100 text-red-800 border-red-200",cancelled:"bg-gray-100 text-gray-800 border-gray-200"},E={accrued:"bg-blue-100 text-blue-800 border-blue-200",invoiced:"bg-amber-100 text-amber-800 border-amber-200",paid:"bg-emerald-100 text-emerald-800 border-emerald-200",waived:"bg-gray-100 text-gray-800 border-gray-200",cancelled:"bg-gray-100 text-gray-800 border-gray-200",disputed:"bg-red-100 text-red-800 border-red-200",voided:"bg-gray-100 text-gray-800 border-gray-200"},B=[{label:"All Status",value:"all"},{label:"Pending",value:"pending"},{label:"Partially Funded",value:"partially_funded"},{label:"Funded",value:"funded"},{label:"Overdue",value:"overdue"}];function R(){let[e,D]=(0,a.useState)(null),[k,F]=(0,a.useState)(null),[L,P]=(0,a.useState)([]),[R,O]=(0,a.useState)([]),[U,V]=(0,a.useState)([]),[z,$]=(0,a.useState)({totalDeals:0,pendingSettlements:0,totalPendingValue:0,overdueSettlements:0}),[q,M]=(0,a.useState)(!0),[J,K]=(0,a.useState)(null),[W,G]=(0,a.useState)(""),[Q,X]=(0,a.useState)("all"),[Y,Z]=(0,a.useState)("deals"),[ee,et]=(0,a.useState)(0),[ea,en]=(0,a.useState)(void 0),[es,er]=(0,a.useState)(!1),[el,ei]=(0,a.useState)("funding"),[ed,ec]=(0,a.useState)(null),[eo,eu]=(0,a.useState)(null),em=(0,a.useCallback)(()=>{et(e=>e+1)},[]);(0,a.useEffect)(()=>{async function e(e,t){let{data:a,error:s}=await e.from("deals").select("id").eq("arranger_entity_id",t),r=(a||[]).map(e=>e.id);if(0===r.length)return void await n(e,[]);let{data:l,error:i}=await e.from("deal_fee_structures").select(`
          id,
          deal_id,
          status,
          legal_counsel,
          wire_escrow_agent,
          wire_bank_name,
          wire_account_holder,
          wire_iban,
          wire_bic,
          escrow_fee_text,
          deal:deal_id (
            id,
            name,
            company_name,
            target_amount,
            currency,
            status
          )
        `).in("deal_id",r).eq("status","published").order("created_at",{ascending:!1});if(i)throw i;await n(e,l||[])}async function t(e,t,a){let{data:s,error:r}=await e.from("deal_lawyer_assignments").select("deal_id").eq("lawyer_id",t),l=(s||[]).map(e=>e.deal_id);if((!l.length||r)&&a?.length&&(l=a),0===l.length)return void await n(e,[]);let{data:i,error:d}=await e.from("deal_fee_structures").select(`
          id,
          deal_id,
          status,
          legal_counsel,
          wire_escrow_agent,
          wire_bank_name,
          wire_account_holder,
          wire_iban,
          wire_bic,
          escrow_fee_text,
          deal:deal_id (
            id,
            name,
            company_name,
            target_amount,
            currency,
            status
          )
        `).in("deal_id",l).eq("status","published").order("created_at",{ascending:!1});if(d)throw d;await n(e,i||[])}async function a(e){let{data:t,error:a}=await e.from("deal_fee_structures").select(`
          id,
          deal_id,
          status,
          legal_counsel,
          wire_escrow_agent,
          wire_bank_name,
          wire_account_holder,
          wire_iban,
          wire_bic,
          escrow_fee_text,
          deal:deal_id (
            id,
            name,
            company_name,
            target_amount,
            currency,
            status
          )
        `).not("wire_escrow_agent","is",null).eq("status","published").order("created_at",{ascending:!1}).limit(100);if(a)throw a;await n(e,t||[])}async function n(e,t){if(0===t.length){P([]),O([]),V([]),$({totalDeals:0,pendingSettlements:0,totalPendingValue:0,overdueSettlements:0});return}let a=t.map(e=>e.deal_id),{data:n,error:s}=await e.from("subscriptions").select(`
          id,
          deal_id,
          investor_id,
          introducer_id,
          proxy_commercial_partner_id,
          commitment,
          funded_amount,
          outstanding_amount,
          funding_due_at,
          status,
          funded_at,
          investor:investor_id (
            id,
            display_name,
            legal_name
          )
        `).in("deal_id",a).in("status",["committed","approved","funded","active","partially_funded"]).order("created_at",{ascending:!1});if(s)throw s;let r=t.map(e=>{let t=(n||[]).filter(t=>t.deal_id===e.deal_id),a=t.reduce((e,t)=>e+(Number(t.outstanding_amount)||0),0),s=t.reduce((e,t)=>e+(Number(t.funded_amount)||0),0);return{id:e.id,deal_id:e.deal_id,deal_name:e.deal?.name||"Unknown Deal",company_name:e.deal?.company_name,status:e.status,legal_counsel:e.legal_counsel,wire_escrow_agent:e.wire_escrow_agent,wire_bank_name:e.wire_bank_name,wire_account_holder:e.wire_account_holder,wire_iban:e.wire_iban,wire_bic:e.wire_bic,escrow_fee_text:e.escrow_fee_text,target_amount:Number(e.deal?.target_amount)||0,currency:e.deal?.currency||"USD",subscriptions_count:t.length,pending_funding:a,funded_amount:s}});P(r);let l=new Date,i=(n||[]).filter(e=>(Number(e.outstanding_amount)||0)>0).map(e=>{let a=e.funding_due_at?new Date(e.funding_due_at):null,n=a?Math.floor((l.getTime()-a.getTime())/864e5):0,s=t.find(t=>t.deal_id===e.deal_id),r=e.status;return r=n>0?"overdue":Number(e.funded_amount)>0?"partially_funded":"pending",{id:e.id,investor_name:e.investor?.display_name||"Unknown Investor",investor_entity:e.investor?.legal_name,deal_name:s?.deal?.name||"Unknown Deal",deal_id:e.deal_id,commitment_amount:Number(e.commitment)||0,funded_amount:Number(e.funded_amount)||0,outstanding_amount:Number(e.outstanding_amount)||0,currency:s?.deal?.currency||"USD",funding_due_at:e.funding_due_at,status:r,days_overdue:Math.max(0,n)}});O(i);let d=new Map;(n||[]).forEach(e=>{e?.id&&d.set(e.id,{introducer_id:e.introducer_id||null,proxy_commercial_partner_id:e.proxy_commercial_partner_id||null})});let c=i.filter(e=>e.days_overdue>0).length,o=i.reduce((e,t)=>e+t.outstanding_amount,0);$({totalDeals:r.length,pendingSettlements:i.length,totalPendingValue:o,overdueSettlements:c});let{data:u,error:m}=await e.from("fee_events").select(`
          id,
          deal_id,
          investor_id,
          fee_type,
          base_amount,
          computed_amount,
          currency,
          status,
          event_date,
          invoice_id,
          allocation_id,
          investors (
            display_name,
            legal_name
          ),
          invoices:invoice_id (
            invoice_number,
            status,
            due_date
          )
        `).in("deal_id",a).order("event_date",{ascending:!1});if(m)console.error("[EscrowPage] Failed to load fee events:",m),V([]);else{let e=new Map;t.forEach(t=>{t?.deal_id&&t?.deal?.name&&e.set(t.deal_id,t.deal.name)}),V((u||[]).map(t=>{let a,n=Array.isArray(t.investors)?t.investors[0]:t.investors,s=Array.isArray(t.invoices)?t.invoices[0]:t.invoices,r=t.allocation_id?d.get(t.allocation_id):null,l=null;return r?.introducer_id?(a="introducer",l=r.introducer_id):r?.proxy_commercial_partner_id&&(a="commercial_partner",l=r.proxy_commercial_partner_id),{id:t.id,deal_id:t.deal_id,deal_name:e.get(t.deal_id)||"Unknown Deal",investor_name:n?.display_name||n?.legal_name||"Unknown Investor",subscription_id:t.allocation_id||null,fee_type:t.fee_type||null,base_amount:t.base_amount??null,computed_amount:Number(t.computed_amount||0),currency:t.currency||"USD",status:t.status||"accrued",event_date:t.event_date,invoice_id:t.invoice_id||null,invoice_number:s?.invoice_number||null,invoice_status:s?.status||null,invoice_due_date:s?.due_date||null,default_payment_type:a,default_recipient_id:l}}))}}!async function(){try{M(!0);let n=(0,S.createClient)(),{data:{user:s}}=await n.auth.getUser();if(!s)return void K("Not authenticated");let{data:r,error:l}=await n.from("lawyer_users").select("lawyer_id").eq("user_id",s.id).maybeSingle();if(r){let{data:e,error:a}=await n.from("lawyers").select("id, firm_name, display_name, specializations, is_active, assigned_deals").eq("id",r.lawyer_id).single();if(!a&&e){D(e),await t(n,e.id,e.assigned_deals);return}}let{data:i,error:d}=await n.from("arranger_users").select("arranger_id").eq("user_id",s.id).maybeSingle();if(i){let{data:t,error:a}=await n.from("arranger_entities").select("id, legal_name, status").eq("id",i.arranger_id).single();if(!a&&t){F(t),await e(n,t.id);return}}let{data:c}=await n.from("partner_users").select("partner_id").eq("user_id",s.id).maybeSingle();if(c)return void K("Access restricted. Partners cannot access escrow information.");await a(n),K(null)}catch(e){console.error("[EscrowPage] Error:",e),K(e instanceof Error?e.message:"Failed to load escrow data")}finally{M(!1)}}()},[ee]);let ex=R.filter(e=>{let t="all"===Q||e.status===Q,a=!W||e.investor_name?.toLowerCase().includes(W.toLowerCase())||e.deal_name?.toLowerCase().includes(W.toLowerCase())||e.investor_entity?.toLowerCase().includes(W.toLowerCase()),n=!0;if(ea?.from&&e.funding_due_at){let t=new Date(e.funding_due_at);n=t>=ea.from,ea.to&&(n=n&&t<=ea.to)}return t&&a&&n}),eh=L.filter(e=>!W||e.deal_name?.toLowerCase().includes(W.toLowerCase())||e.company_name?.toLowerCase().includes(W.toLowerCase())||e.wire_escrow_agent?.toLowerCase().includes(W.toLowerCase())),e_=U.filter(e=>{let t=!W||e.deal_name.toLowerCase().includes(W.toLowerCase())||e.investor_name.toLowerCase().includes(W.toLowerCase()),a=!0;if(ea?.from&&e.event_date){let t=new Date(e.event_date);a=t>=ea.from,ea.to&&(a=a&&t<=ea.to)}return t&&a}),eg=(0,a.useCallback)(()=>{let e=new Blob([["Deal,Investor,Entity,Commitment,Funded,Outstanding,Status,Due Date",...ex.map(e=>[e.deal_name,e.investor_name,e.investor_entity||"",e.commitment_amount.toString(),e.funded_amount.toString(),e.outstanding_amount.toString(),e.status.replace("_"," "),e.funding_due_at||""]).map(e=>e.map(e=>`"${e.replace(/"/g,'""')}"`).join(","))].join("\n")],{type:"text/csv;charset=utf-8;"}),t=document.createElement("a"),a=URL.createObjectURL(e);t.setAttribute("href",a),t.setAttribute("download",`escrow-settlements-${new Date().toISOString().split("T")[0]}.csv`),t.style.visibility="hidden",document.body.appendChild(t),t.click(),document.body.removeChild(t),URL.revokeObjectURL(a)},[ex]);return q?(0,t.jsxs)("div",{className:"flex items-center justify-center py-16",children:[(0,t.jsx)(_.Loader2,{className:"h-8 w-8 animate-spin text-muted-foreground"}),(0,t.jsx)("span",{className:"ml-3 text-muted-foreground",children:"Loading escrow data..."})]}):J?(0,t.jsxs)("div",{className:"text-center py-16",children:[(0,t.jsx)(g.AlertCircle,{className:"h-12 w-12 text-destructive mx-auto mb-4"}),(0,t.jsx)("h3",{className:"text-lg font-medium text-foreground mb-2",children:"Error Loading Escrow Data"}),(0,t.jsx)("p",{className:"text-muted-foreground",children:J})]}):(0,t.jsxs)("div",{className:"p-6 space-y-6",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-2xl font-bold text-foreground",children:"Escrow Management"}),(0,t.jsx)("p",{className:"text-muted-foreground mt-1",children:e?`Manage escrow accounts and settlements for ${e.display_name}`:k?`View escrow status for deals managed by ${k.legal_name}`:"Monitor all escrow accounts and pending settlements"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[R.length>0&&(0,t.jsxs)(r.Button,{variant:"outline",size:"sm",onClick:eg,children:[(0,t.jsx)(w.Download,{className:"h-4 w-4 mr-2"}),"Export CSV"]}),e&&e.specializations&&e.specializations.length>0&&(0,t.jsx)("div",{className:"flex gap-1",children:e.specializations.slice(0,2).map((e,a)=>(0,t.jsx)(s.Badge,{variant:"outline",className:"capitalize",children:e},a))}),k&&(0,t.jsxs)(s.Badge,{variant:"secondary",className:"flex items-center gap-1",children:[(0,t.jsx)(f.Building2,{className:"h-3 w-3"}),"Arranger View"]})]})]}),k&&!e&&(0,t.jsxs)("div",{className:"flex items-start gap-3 rounded-lg border border-blue-200 bg-blue-50 p-4 dark:border-blue-800 dark:bg-blue-950/30",children:[(0,t.jsx)(N.Info,{className:"h-5 w-5 text-blue-600 dark:text-blue-400 mt-0.5 shrink-0"}),(0,t.jsxs)("div",{className:"text-sm",children:[(0,t.jsx)("p",{className:"font-medium text-blue-900 dark:text-blue-100",children:"View-Only Access"}),(0,t.jsx)("p",{className:"text-blue-700 dark:text-blue-300 mt-0.5",children:"As an arranger, you can monitor escrow status and view transaction details for deals you manage. Funding confirmations and fee payments are handled by assigned lawyers."})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,t.jsxs)(n.Card,{children:[(0,t.jsx)(n.CardHeader,{className:"pb-2",children:(0,t.jsxs)(n.CardTitle,{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[(0,t.jsx)(o.Lock,{className:"h-4 w-4"}),"Escrow Deals"]})}),(0,t.jsxs)(n.CardContent,{children:[(0,t.jsx)("div",{className:"text-2xl font-bold",children:z.totalDeals}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Active escrow accounts"})]})]}),(0,t.jsxs)(n.Card,{children:[(0,t.jsx)(n.CardHeader,{className:"pb-2",children:(0,t.jsxs)(n.CardTitle,{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[(0,t.jsx)(m.Clock,{className:"h-4 w-4"}),"Pending Settlements"]})}),(0,t.jsxs)(n.CardContent,{children:[(0,t.jsx)("div",{className:"text-2xl font-bold text-yellow-600",children:z.pendingSettlements}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Awaiting funding"})]})]}),(0,t.jsxs)(n.Card,{children:[(0,t.jsx)(n.CardHeader,{className:"pb-2",children:(0,t.jsxs)(n.CardTitle,{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[(0,t.jsx)(u.DollarSign,{className:"h-4 w-4"}),"Pending Value"]})}),(0,t.jsxs)(n.CardContent,{children:[(0,t.jsx)("div",{className:"text-2xl font-bold text-blue-600",children:(0,T.formatCurrency)(z.totalPendingValue,"USD")}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Total outstanding"})]})]}),(0,t.jsxs)(n.Card,{children:[(0,t.jsx)(n.CardHeader,{className:"pb-2",children:(0,t.jsxs)(n.CardTitle,{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[(0,t.jsx)(b.AlertTriangle,{className:"h-4 w-4"}),"Overdue"]})}),(0,t.jsxs)(n.CardContent,{children:[(0,t.jsx)("div",{className:"text-2xl font-bold text-red-600",children:z.overdueSettlements}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Past due date"})]})]})]}),(0,t.jsx)(n.Card,{children:(0,t.jsx)(n.CardContent,{className:"pt-6",children:(0,t.jsxs)("div",{className:"flex flex-col md:flex-row gap-4",children:[(0,t.jsx)("div",{className:"flex-1",children:(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(h.Search,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),(0,t.jsx)(l.Input,{placeholder:"Search deals, investors, or escrow agents...",value:W,onChange:e=>G(e.target.value),className:"pl-10"})]})}),"settlements"===Y&&(0,t.jsxs)(i.Select,{value:Q,onValueChange:X,children:[(0,t.jsx)(i.SelectTrigger,{className:"w-full md:w-48",children:(0,t.jsx)(i.SelectValue,{placeholder:"Filter by status"})}),(0,t.jsx)(i.SelectContent,{children:B.map(e=>(0,t.jsx)(i.SelectItem,{value:e.value,children:e.label},e.value))})]}),("settlements"===Y||"payments"===Y)&&(0,t.jsx)(A.DateRangePicker,{value:ea,onChange:en,className:"w-full md:w-auto"})]})})}),(0,t.jsxs)(c.Tabs,{value:Y,onValueChange:Z,className:"space-y-4",children:[(0,t.jsxs)(c.TabsList,{children:[(0,t.jsxs)(c.TabsTrigger,{value:"deals",className:"flex items-center gap-2",children:[(0,t.jsx)(j.Wallet,{className:"h-4 w-4"}),"Escrow Accounts (",L.length,")"]}),(0,t.jsxs)(c.TabsTrigger,{value:"settlements",className:"flex items-center gap-2",children:[(0,t.jsx)(y.default,{className:"h-4 w-4"}),"Pending Settlements (",R.length,")"]}),(0,t.jsxs)(c.TabsTrigger,{value:"payments",className:"flex items-center gap-2",children:[(0,t.jsx)(v.CreditCard,{className:"h-4 w-4"}),"Fee Payments (",U.length,")"]})]}),(0,t.jsx)(c.TabsContent,{value:"deals",children:(0,t.jsxs)(n.Card,{children:[(0,t.jsxs)(n.CardHeader,{children:[(0,t.jsx)(n.CardTitle,{children:"Escrow Accounts"}),(0,t.jsxs)(n.CardDescription,{children:[eh.length," deal",1!==eh.length?"s":""," with escrow accounts"]})]}),(0,t.jsx)(n.CardContent,{children:0===eh.length?(0,t.jsxs)("div",{className:"border border-dashed border-muted rounded-lg py-12 flex flex-col items-center justify-center text-center space-y-2",children:[(0,t.jsx)(o.Lock,{className:"h-10 w-10 text-muted-foreground"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:W?"No escrow accounts match your search":e?"No deals with you as legal counsel":k?"No deals managed by your arranger entity":"No deals with escrow accounts found"})]}):(0,t.jsx)("div",{className:"rounded-md border",children:(0,t.jsxs)(d.Table,{children:[(0,t.jsx)(d.TableHeader,{children:(0,t.jsxs)(d.TableRow,{children:[(0,t.jsx)(d.TableHead,{children:"Deal"}),(0,t.jsx)(d.TableHead,{children:"Escrow Agent"}),(0,t.jsx)(d.TableHead,{children:"Bank"}),(0,t.jsx)(d.TableHead,{children:"Subscriptions"}),(0,t.jsx)(d.TableHead,{children:"Funded / Pending"}),(0,t.jsx)(d.TableHead,{className:"text-right",children:"Actions"})]})}),(0,t.jsx)(d.TableBody,{children:eh.map(a=>(0,t.jsxs)(d.TableRow,{children:[(0,t.jsx)(d.TableCell,{children:(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("div",{className:"h-10 w-10 rounded-lg bg-muted flex items-center justify-center",children:(0,t.jsx)(f.Building2,{className:"h-5 w-5 text-muted-foreground"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"font-medium",children:a.deal_name}),a.company_name&&(0,t.jsx)("div",{className:"text-xs text-muted-foreground",children:a.company_name})]})]})}),(0,t.jsxs)(d.TableCell,{children:[(0,t.jsx)("div",{className:"font-medium",children:a.wire_escrow_agent||"—"}),a.escrow_fee_text&&(0,t.jsx)("div",{className:"text-xs text-muted-foreground",children:a.escrow_fee_text})]}),(0,t.jsx)(d.TableCell,{children:(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-sm",children:a.wire_bank_name||"—"}),a.wire_iban&&(0,t.jsxs)("div",{className:"text-xs text-muted-foreground font-mono",children:[a.wire_iban.slice(0,8),"..."]})]})}),(0,t.jsx)(d.TableCell,{children:(0,t.jsxs)(s.Badge,{variant:"secondary",children:[a.subscriptions_count," investor",1!==a.subscriptions_count?"s":""]})}),(0,t.jsx)(d.TableCell,{children:(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsxs)("div",{className:"text-sm font-medium text-green-600",children:[(0,T.formatCurrency)(a.funded_amount,a.currency)," funded"]}),a.pending_funding>0&&(0,t.jsxs)("div",{className:"text-xs text-yellow-600",children:[(0,T.formatCurrency)(a.pending_funding,a.currency)," pending"]})]})}),(0,t.jsx)(d.TableCell,{className:"text-right",children:(0,t.jsx)(r.Button,{variant:"ghost",size:"sm",asChild:!0,children:(0,t.jsx)("a",{href:e?`/versotech_main/lawyer-deal/${a.deal_id}`:`/versotech_main/opportunities/${a.deal_id}`,children:(0,t.jsx)(p.ArrowUpRight,{className:"h-4 w-4"})})})})]},a.id))})]})})})]})}),(0,t.jsx)(c.TabsContent,{value:"settlements",children:(0,t.jsxs)(n.Card,{children:[(0,t.jsxs)(n.CardHeader,{children:[(0,t.jsx)(n.CardTitle,{children:"Pending Settlements"}),(0,t.jsxs)(n.CardDescription,{children:[ex.length," settlement",1!==ex.length?"s":""," awaiting funding"]})]}),(0,t.jsx)(n.CardContent,{children:0===ex.length?(0,t.jsxs)("div",{className:"border border-dashed border-muted rounded-lg py-12 flex flex-col items-center justify-center text-center space-y-2",children:[(0,t.jsx)(x.CheckCircle2,{className:"h-10 w-10 text-muted-foreground"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:W||"all"!==Q?"No settlements match your filters":"No pending settlements"})]}):(0,t.jsx)("div",{className:"rounded-md border",children:(0,t.jsxs)(d.Table,{children:[(0,t.jsx)(d.TableHeader,{children:(0,t.jsxs)(d.TableRow,{children:[(0,t.jsx)(d.TableHead,{children:"Investor"}),(0,t.jsx)(d.TableHead,{children:"Deal"}),(0,t.jsx)(d.TableHead,{children:"Commitment"}),(0,t.jsx)(d.TableHead,{children:"Outstanding"}),(0,t.jsx)(d.TableHead,{children:"Due Date"}),(0,t.jsx)(d.TableHead,{children:"Status"}),(0,t.jsx)(d.TableHead,{className:"text-right",children:"Actions"})]})}),(0,t.jsx)(d.TableBody,{children:ex.map(a=>(0,t.jsxs)(d.TableRow,{children:[(0,t.jsx)(d.TableCell,{children:(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"font-medium",children:a.investor_name}),a.investor_entity&&(0,t.jsx)("div",{className:"text-xs text-muted-foreground",children:a.investor_entity})]})}),(0,t.jsx)(d.TableCell,{children:(0,t.jsx)("a",{href:e?`/versotech_main/lawyer-deal/${a.deal_id}`:`/versotech_main/opportunities/${a.deal_id}`,className:"text-primary hover:underline",children:a.deal_name})}),(0,t.jsxs)(d.TableCell,{children:[(0,t.jsx)("div",{className:"font-medium",children:(0,T.formatCurrency)(a.commitment_amount,a.currency)}),a.funded_amount>0&&(0,t.jsxs)("div",{className:"text-xs text-green-600",children:[(0,T.formatCurrency)(a.funded_amount,a.currency)," received"]})]}),(0,t.jsx)(d.TableCell,{children:(0,t.jsx)("div",{className:"font-medium text-yellow-600",children:(0,T.formatCurrency)(a.outstanding_amount,a.currency)})}),(0,t.jsx)(d.TableCell,{children:a.funding_due_at?(0,t.jsxs)("div",{className:(0,C.cn)("text-sm",a.days_overdue>0&&"text-red-600 font-medium"),children:[(0,T.formatDate)(a.funding_due_at),a.days_overdue>0&&(0,t.jsxs)("div",{className:"text-xs",children:[a.days_overdue," day",1!==a.days_overdue?"s":""," overdue"]})]}):(0,t.jsx)("span",{className:"text-muted-foreground text-xs",children:"Not set"})}),(0,t.jsx)(d.TableCell,{children:(0,t.jsx)(s.Badge,{variant:"outline",className:(0,C.cn)("capitalize",I[a.status]||I.pending),children:a.status.replace("_"," ")})}),(0,t.jsx)(d.TableCell,{className:"text-right",children:"funded"!==a.status&&e&&(0,t.jsxs)(r.Button,{variant:"outline",size:"sm",onClick:()=>{ei("funding"),ec(a),eu(null),er(!0)},children:[(0,t.jsx)(x.CheckCircle2,{className:"h-4 w-4 mr-1"}),"Confirm Funding"]})})]},a.id))})]})})})]})}),(0,t.jsx)(c.TabsContent,{value:"payments",children:(0,t.jsxs)(n.Card,{children:[(0,t.jsxs)(n.CardHeader,{children:[(0,t.jsx)(n.CardTitle,{children:"Fee Payments"}),(0,t.jsxs)(n.CardDescription,{children:[e_.length," fee event",1!==e_.length?"s":""," for assigned deals"]})]}),(0,t.jsx)(n.CardContent,{children:0===e_.length?(0,t.jsxs)("div",{className:"border border-dashed border-muted rounded-lg py-12 flex flex-col items-center justify-center text-center space-y-2",children:[(0,t.jsx)(v.CreditCard,{className:"h-10 w-10 text-muted-foreground"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:W?"No fee events match your filters":"No fee events to display"})]}):(0,t.jsx)("div",{className:"rounded-md border",children:(0,t.jsxs)(d.Table,{children:[(0,t.jsx)(d.TableHeader,{children:(0,t.jsxs)(d.TableRow,{children:[(0,t.jsx)(d.TableHead,{children:"Deal"}),(0,t.jsx)(d.TableHead,{children:"Investor"}),(0,t.jsx)(d.TableHead,{children:"Fee Type"}),(0,t.jsx)(d.TableHead,{children:"Amount"}),(0,t.jsx)(d.TableHead,{children:"Invoice"}),(0,t.jsx)(d.TableHead,{children:"Due Date"}),(0,t.jsx)(d.TableHead,{children:"Status"}),(0,t.jsx)(d.TableHead,{className:"text-right",children:"Actions"})]})}),(0,t.jsx)(d.TableBody,{children:e_.map(a=>(0,t.jsxs)(d.TableRow,{children:[(0,t.jsx)(d.TableCell,{children:(0,t.jsx)("div",{className:"font-medium",children:a.deal_name})}),(0,t.jsx)(d.TableCell,{children:(0,t.jsx)("div",{className:"font-medium",children:a.investor_name})}),(0,t.jsx)(d.TableCell,{className:"capitalize",children:(a.fee_type||"fee").replace("_"," ")}),(0,t.jsxs)(d.TableCell,{children:[(0,t.jsx)("div",{className:"font-medium",children:(0,T.formatCurrency)(a.computed_amount,a.currency)}),null!=a.base_amount&&(0,t.jsxs)("div",{className:"text-xs text-muted-foreground",children:["Base: ",(0,T.formatCurrency)(a.base_amount,a.currency)]})]}),(0,t.jsx)(d.TableCell,{children:a.invoice_number?(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-sm font-medium",children:a.invoice_number}),a.invoice_status&&(0,t.jsx)("div",{className:"text-xs text-muted-foreground capitalize",children:a.invoice_status.replace("_"," ")})]}):(0,t.jsx)("span",{className:"text-xs text-muted-foreground",children:"Not issued"})}),(0,t.jsx)(d.TableCell,{children:a.invoice_due_date?(0,t.jsx)("div",{className:"text-sm",children:(0,T.formatDate)(a.invoice_due_date)}):(0,t.jsx)("span",{className:"text-xs text-muted-foreground",children:"Not set"})}),(0,t.jsx)(d.TableCell,{children:(0,t.jsx)(s.Badge,{variant:"outline",className:(0,C.cn)("capitalize",E[a.status]||"bg-gray-100 text-gray-800 border-gray-200"),children:a.status.replace("_"," ")})}),(0,t.jsxs)(d.TableCell,{className:"text-right",children:[["accrued","invoiced"].includes(a.status)&&a.subscription_id&&e&&(0,t.jsxs)(r.Button,{variant:"outline",size:"sm",onClick:()=>{ei("payment"),eu(a),ec(null),er(!0)},children:[(0,t.jsx)(x.CheckCircle2,{className:"h-4 w-4 mr-1"}),"Confirm Payment"]}),["accrued","invoiced"].includes(a.status)&&!a.subscription_id&&e&&(0,t.jsx)("span",{className:"text-xs text-muted-foreground",children:"No subscription"})]})]},a.id))})]})})})]})})]}),(ed||eo)&&(0,t.jsx)(H,{open:es,onOpenChange:er,mode:el,subscriptionId:ed?.id||eo?.subscription_id||"",investorName:ed?.investor_name||eo?.investor_name||"Recipient",dealName:ed?.deal_name||eo?.deal_name||"Deal",commitment:ed?.commitment_amount||0,fundedAmount:ed?.funded_amount||0,currency:ed?.currency||eo?.currency||"USD",feeEventId:eo?.id||null,defaultAmount:eo?.computed_amount||null,defaultPaymentType:eo?.default_payment_type,defaultRecipientId:eo?.default_recipient_id||null,onSuccess:em})]})}e.s(["default",()=>R],949382)}]);