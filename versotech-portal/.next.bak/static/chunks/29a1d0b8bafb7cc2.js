(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,675771,e=>{"use strict";var t=e.i(722679),r=e.i(340915),s=e.i(396064),a=e.i(738932),l=e.i(262823),o=e.i(456992),n=e.i(396132),i=e.i(413934),d=e.i(316264),c=e.i(510166),h=e.i(197098),m=e.i(959768),u=e.i(282141);function x({currentFolder:e,onNavigate:s,className:a}){let l=r.default.useMemo(()=>{if(!e)return[];let t=e.path.split("/").filter(Boolean),r=[],s="";return t.forEach((a,l)=>{s+=`/${a}`,r.push({id:l===t.length-1?e.id:null,name:a,path:s})}),r},[e]),o=l.length>3?[...l.slice(0,1),{id:"...",name:"...",path:"..."},...l.slice(-2)]:l;return(0,t.jsxs)("nav",{className:(0,u.cn)("flex items-center gap-2 px-6 py-3.5","bg-black/40 border-b border-white/10","transition-colors duration-200",a),"aria-label":"Folder navigation breadcrumbs",children:[(0,t.jsx)("button",{onClick:()=>s(null),className:(0,u.cn)("inline-flex items-center justify-center","w-8 h-8 rounded-md","transition-all duration-150",e?"text-gray-400 hover:bg-white/10 hover:text-white":"bg-blue-500/20 text-blue-400 border border-blue-400/30","focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2"),"aria-label":"Navigate to root","aria-current":e?void 0:"page",children:(0,t.jsx)(i.Home,{className:"w-4 h-4",strokeWidth:2})}),o.map((e,a)=>{let l=a===o.length-1,n="..."===e.id;return(0,t.jsxs)(r.Fragment,{children:[(0,t.jsx)(h.ChevronRight,{className:"w-4 h-4 text-gray-600 flex-shrink-0",strokeWidth:2,"aria-hidden":"true"}),n?(0,t.jsx)("span",{className:"text-sm text-gray-500 px-2 select-none",children:e.name}):l?(0,t.jsxs)("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-white/5 border border-white/10 rounded-md",children:[(0,t.jsx)(m.Folder,{className:"w-3.5 h-3.5 text-blue-400 flex-shrink-0",strokeWidth:2}),(0,t.jsx)("span",{className:"text-sm font-medium text-white truncate max-w-[200px]",children:e.name})]}):(0,t.jsx)("button",{onClick:()=>{s(e.id)},className:(0,u.cn)("text-sm text-gray-400 px-3 py-1.5 rounded-md","hover:text-white hover:bg-white/10","focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2","transition-all duration-150","truncate max-w-[160px]"),title:e.name,children:e.name})]},e.id||a)}),e&&(0,t.jsxs)("div",{className:"ml-auto hidden lg:flex items-center gap-2 text-xs text-gray-400 font-mono",children:[(0,t.jsx)("span",{className:"opacity-60",children:"Path:"}),(0,t.jsx)("span",{className:"px-2 py-1 bg-white/5 rounded border border-white/10 text-gray-300",children:e.path})]})]})}var f=e.i(49664),p=e.i(750809),g=e.i(410587);let j=(0,g.default)("grid-3x3",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"M15 3v18",key:"14nvp0"}]]);var b=e.i(110686),w=e.i(185419),v=e.i(64927),N=e.i(551544),y=e.i(554369);let C={vehicle_root:{bg:"bg-navy-50",border:"border-navy-200",icon:"text-navy-700",hoverBg:"group-hover:bg-navy-100",hoverBorder:"group-hover:border-navy-300"},category:{bg:"bg-slate-50",border:"border-slate-200",icon:"text-slate-600",hoverBg:"group-hover:bg-slate-100",hoverBorder:"group-hover:border-slate-300"},custom:{bg:"bg-slate-50",border:"border-slate-200",icon:"text-slate-500",hoverBg:"group-hover:bg-slate-100",hoverBorder:"group-hover:border-slate-300"}};function k({folder:e,onNavigate:s,onRename:l,onDelete:o,onCreateSubfolder:n,className:i,variant:d="default"}){let[x,p]=r.default.useState(!1),[g,j]=r.default.useState(!1),b=C[e.folder_type]||C.custom,w=t=>{("Enter"===t.key||" "===t.key)&&(t.preventDefault(),s(e.id))};return"compact"===d?(0,t.jsxs)("button",{onClick:()=>s(e.id),onKeyDown:w,className:(0,u.cn)("group flex items-center gap-3 w-full","px-4 py-3 rounded-md","hover:bg-white/10 transition-colors duration-150","focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-1",i),children:[(0,t.jsx)(m.Folder,{className:"w-5 h-5 text-blue-400 flex-shrink-0",strokeWidth:2}),(0,t.jsx)("span",{className:"text-sm font-medium text-white flex-1 text-left break-words line-clamp-1",children:e.name}),(0,t.jsx)(h.ChevronRight,{className:"w-4 h-4 text-gray-400 opacity-0 group-hover:opacity-100 transition-opacity flex-shrink-0"})]}):(0,t.jsxs)("div",{className:(0,u.cn)("group relative","bg-white/5 border border-white/10 rounded-lg","hover:bg-white/10 hover:border-white/20","transition-all duration-200","cursor-pointer",i),onMouseEnter:()=>p(!0),onMouseLeave:()=>p(!1),onClick:()=>s(e.id),onKeyDown:w,role:"button",tabIndex:0,"aria-label":`Navigate to folder ${e.name}`,children:[(0,t.jsx)("div",{className:"p-5",children:(0,t.jsxs)("div",{className:"flex items-start gap-4",children:[(0,t.jsx)("div",{className:(0,u.cn)("w-14 h-14 rounded-lg border flex items-center justify-center","flex-shrink-0 transition-all duration-200",b.bg,b.border,b.hoverBg,b.hoverBorder),children:x?(0,t.jsx)(f.FolderOpen,{className:(0,u.cn)("w-6 h-6",b.icon),strokeWidth:2}):(0,t.jsx)(m.Folder,{className:(0,u.cn)("w-6 h-6",b.icon),strokeWidth:2})}),(0,t.jsxs)("div",{className:"flex-1 min-w-0 overflow-hidden",children:[(0,t.jsx)("h3",{className:"font-semibold text-white text-sm leading-tight mb-2 break-words line-clamp-2",children:e.name}),(0,t.jsxs)("div",{className:"flex items-center gap-3 text-sm text-gray-400",children:[void 0!==e.subfolder_count&&(0,t.jsxs)("span",{className:"inline-flex items-center gap-1.5",children:[(0,t.jsx)(m.Folder,{className:"w-3.5 h-3.5",strokeWidth:2}),(0,t.jsx)("span",{children:e.subfolder_count})]}),void 0!==e.document_count&&(0,t.jsxs)("span",{className:"inline-flex items-center gap-1.5",children:[(0,t.jsx)("span",{className:"w-3.5 h-3.5 inline-flex items-center justify-center",children:(0,t.jsx)("svg",{viewBox:"0 0 16 16",fill:"none",className:"w-3.5 h-3.5 text-gray-400",strokeWidth:2,children:(0,t.jsx)("path",{d:"M9 1H3a1 1 0 00-1 1v12a1 1 0 001 1h10a1 1 0 001-1V6M9 1l5 5M9 1v5h5",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"})})}),(0,t.jsx)("span",{children:e.document_count})]})]}),"vehicle_root"===e.folder_type&&(0,t.jsx)("div",{className:"mt-2",children:(0,t.jsx)("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-blue-500/20 text-blue-200 border border-blue-400/30",children:"Vehicle Root"})})]}),(l||o||n)&&(0,t.jsxs)(c.DropdownMenu,{open:g,onOpenChange:j,children:[(0,t.jsxs)(c.DropdownMenuTrigger,{className:(0,u.cn)("opacity-0 group-hover:opacity-100 transition-opacity duration-150","p-1 rounded hover:bg-white/10","focus:outline-none focus:ring-2 focus:ring-blue-500",g&&"opacity-100"),onClick:e=>{e.stopPropagation()},children:[(0,t.jsx)(v.MoreVertical,{className:"w-4 h-4 text-gray-400",strokeWidth:2}),(0,t.jsx)("span",{className:"sr-only",children:"Folder actions"})]}),(0,t.jsxs)(c.DropdownMenuContent,{align:"end",className:"w-48 bg-zinc-900 border-white/10",children:[n&&(0,t.jsxs)(c.DropdownMenuItem,{onClick:t=>{t.stopPropagation(),n(e.id)},className:"text-gray-200 focus:bg-white/10 focus:text-white",children:[(0,t.jsx)(a.FolderPlus,{className:"w-4 h-4 mr-2 text-blue-400",strokeWidth:2}),(0,t.jsx)("span",{children:"New Subfolder"})]}),l&&(0,t.jsxs)(c.DropdownMenuItem,{onClick:t=>{t.stopPropagation(),l(e.id)},className:"text-gray-200 focus:bg-white/10 focus:text-white",children:[(0,t.jsx)(N.Edit,{className:"w-4 h-4 mr-2 text-gray-400",strokeWidth:2}),(0,t.jsx)("span",{children:"Rename"})]}),o&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(c.DropdownMenuSeparator,{className:"bg-white/10"}),(0,t.jsxs)(c.DropdownMenuItem,{onClick:t=>{t.stopPropagation(),o(e.id)},className:"text-red-400 focus:text-red-300 focus:bg-red-500/20",children:[(0,t.jsx)(y.Trash2,{className:"w-4 h-4 mr-2",strokeWidth:2}),(0,t.jsx)("span",{children:"Delete"})]})]})]})]})]})}),(0,t.jsx)("div",{className:(0,u.cn)("absolute bottom-0 left-0 right-0 h-0.5 bg-blue-500","transform scale-x-0 group-hover:scale-x-100","transition-transform duration-200 origin-left","rounded-b-lg")})]})}function S({className:e}){return(0,t.jsx)("div",{className:(0,u.cn)("bg-white/5 border border-white/10 rounded-lg p-4","animate-pulse",e),children:(0,t.jsxs)("div",{className:"flex items-start gap-3",children:[(0,t.jsx)("div",{className:"w-11 h-11 rounded-lg bg-white/10 flex-shrink-0"}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsx)("div",{className:"h-4 bg-white/10 rounded w-3/4 mb-2"}),(0,t.jsx)("div",{className:"h-3 bg-white/10 rounded w-1/2"})]})]})})}var F=e.i(337028),_=e.i(191569),D=e.i(538892);function M({currentFolderId:e,currentFolder:r,subfolders:s,documents:a,isLoading:l=!1,viewMode:o="grid",sortBy:n="name",onNavigateToFolder:i,onDocumentClick:d,onUploadClick:c,onCreateFolderClick:h,onRenameFolder:m,onDeleteFolder:x,onCreateSubfolder:f,onRenameDocument:g,onDeleteDocument:v,onViewModeChange:N,onSortChange:y,onSearchChange:C,searchQuery:M="",className:T}){let E=!l&&0===s.length&&0===a.length;return s.length>0||a.length,(0,t.jsxs)("div",{className:(0,u.cn)("flex flex-col h-full bg-[#0a0a0a]",T),children:[(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4 px-6 py-4 bg-black/40 border-b border-white/10",children:[(0,t.jsxs)("div",{className:"relative w-full sm:w-auto sm:min-w-[300px]",children:[(0,t.jsx)(p.Search,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400",strokeWidth:2}),(0,t.jsx)(_.Input,{type:"text",placeholder:"Search folders and documents...",value:M,onChange:e=>C?.(e.target.value),className:"pl-10 h-9 text-sm bg-white/5 border-white/10 text-white placeholder:text-gray-500 focus:border-blue-500 focus:ring-blue-500"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2 w-full sm:w-auto",children:[(0,t.jsxs)(D.Select,{value:n,onValueChange:e=>y?.(e),children:[(0,t.jsxs)(D.SelectTrigger,{className:"w-[140px] h-9 text-sm bg-white/5 border-white/10 text-white",children:[(0,t.jsx)(w.ArrowUpDown,{className:"w-3.5 h-3.5 mr-2 text-gray-400",strokeWidth:2}),(0,t.jsx)(D.SelectValue,{})]}),(0,t.jsxs)(D.SelectContent,{className:"bg-zinc-900 border-white/10 text-white",children:[(0,t.jsx)(D.SelectItem,{value:"name",className:"text-white focus:bg-white/10 focus:text-white",children:"Name"}),(0,t.jsx)(D.SelectItem,{value:"date",className:"text-white focus:bg-white/10 focus:text-white",children:"Date Modified"}),(0,t.jsx)(D.SelectItem,{value:"type",className:"text-white focus:bg-white/10 focus:text-white",children:"Type"})]})]}),N&&(0,t.jsxs)("div",{className:"flex items-center border border-white/10 rounded-md overflow-hidden",children:[(0,t.jsx)("button",{onClick:()=>N("grid"),className:(0,u.cn)("p-1.5 transition-colors","grid"===o?"bg-blue-500/20 text-blue-400":"text-gray-400 hover:bg-white/10"),"aria-label":"Grid view",children:(0,t.jsx)(j,{className:"w-4 h-4",strokeWidth:2})}),(0,t.jsx)("div",{className:"w-px h-6 bg-white/10"}),(0,t.jsx)("button",{onClick:()=>N("list"),className:(0,u.cn)("p-1.5 transition-colors","list"===o?"bg-blue-500/20 text-blue-400":"text-gray-400 hover:bg-white/10"),"aria-label":"List view",children:(0,t.jsx)(b.List,{className:"w-4 h-4",strokeWidth:2})})]})]})]}),(0,t.jsxs)("div",{className:"flex-1 overflow-auto",children:[l&&(0,t.jsx)("div",{className:"p-6",children:(0,t.jsx)("div",{className:(0,u.cn)("grid gap-4","grid"===o?"grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4":"grid-cols-1"),children:Array.from({length:8}).map((e,r)=>(0,t.jsx)(S,{},r))})}),E&&!l&&(0,t.jsx)(L,{onUploadClick:c,onCreateFolderClick:h}),!E&&!l&&(0,t.jsxs)("div",{className:"p-6 space-y-8",children:[s.length>0&&(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"flex items-center gap-3 mb-4",children:[(0,t.jsx)("h2",{className:"text-sm font-semibold text-gray-400 uppercase tracking-wider",children:"Folders"}),(0,t.jsx)("div",{className:"flex-1 h-px bg-white/10"}),(0,t.jsx)("span",{className:"text-xs text-gray-500",children:s.length})]}),(0,t.jsx)("div",{className:(0,u.cn)("grid gap-4","grid"===o?"grid-cols-1 md:grid-cols-2 xl:grid-cols-4":"grid-cols-1 max-w-4xl"),children:s.map(e=>(0,t.jsx)(k,{folder:e,onNavigate:i,onRename:m,onDelete:x,onCreateSubfolder:f,variant:"list"===o?"compact":"default"},e.id))})]}),a.length>0&&(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"flex items-center gap-3 mb-4",children:[(0,t.jsx)("h2",{className:"text-sm font-semibold text-gray-400 uppercase tracking-wider",children:"Documents"}),(0,t.jsx)("div",{className:"flex-1 h-px bg-white/10"}),(0,t.jsx)("span",{className:"text-xs text-gray-500",children:a.length})]}),(0,t.jsx)("div",{className:(0,u.cn)("grid gap-4","grid"===o?"grid-cols-1 md:grid-cols-2 xl:grid-cols-4":"grid-cols-1 max-w-4xl"),children:a.map(e=>(0,t.jsx)(F.DocumentCard,{document:e,onPreview:()=>d(e.id),onRename:g,onDelete:v,variant:"list"===o?"compact":"default"},e.id))})]})]})]})]})}function L({onUploadClick:e,onCreateFolderClick:r}){return(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center py-16 px-4",children:[(0,t.jsx)("div",{className:"w-20 h-20 rounded-full bg-white/5 flex items-center justify-center mb-6 border border-white/10",children:(0,t.jsx)(f.FolderOpen,{className:"w-10 h-10 text-gray-400",strokeWidth:1.5})}),(0,t.jsx)("h3",{className:"text-lg font-semibold text-white mb-2",children:"This folder is empty"}),(0,t.jsx)("p",{className:"text-sm text-gray-400 mb-8 text-center max-w-md leading-relaxed",children:"Get started by uploading documents or creating subfolders to organize your files."}),(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row gap-3",children:[(0,t.jsxs)(d.Button,{onClick:e,size:"default",className:"min-w-[160px] bg-blue-600 hover:bg-blue-700 text-white",children:[(0,t.jsx)(s.Upload,{className:"w-4 h-4 mr-2",strokeWidth:2}),"Upload Documents"]}),(0,t.jsxs)(d.Button,{onClick:r,variant:"outline",size:"default",className:"min-w-[160px] border-white/20 text-white hover:bg-white/10",children:[(0,t.jsx)(a.FolderPlus,{className:"w-4 h-4 mr-2",strokeWidth:2}),"New Folder"]})]})]})}var T=e.i(230112),E=e.i(432598),B=e.i(150327),I=e.i(907434);function O({open:e,onOpenChange:s,folders:a,currentFolderId:l,onNavigate:o}){let[n,i]=(0,r.useState)(new Set),[d,c]=(0,r.useState)(""),h=(0,r.useMemo)(()=>{var e;let t;return e=a,t=new Map,e.forEach(e=>{t.has(e.parent_folder_id)||t.set(e.parent_folder_id,[]),t.get(e.parent_folder_id).push({folder:e,children:[]})}),function e(r){return(t.get(r)||[]).map(t=>({...t,children:e(t.folder.id)}))}(null)},[a]),x=(0,r.useMemo)(()=>d.trim()?function e(t,r){return t.map(t=>{let s=t.folder.name.toLowerCase().includes(r),a=t.folder.path.toLowerCase().includes(r),l=e(t.children,r);return s||a||l.length>0?{...t,children:l}:null}).filter(e=>null!==e)}(h,d.toLowerCase()):h,[h,d]),f=e=>{let t=new Set(n);t.has(e)?t.delete(e):t.add(e),i(t)},g=e=>{o(e),s(!1)};return r.default.useEffect(()=>{if(l&&a.length>0){let e=a.find(e=>e.id===l);if(e){let t=function(e,t){let r=[],s=e;for(;s?.parent_folder_id;)r.push(s.parent_folder_id),s=t.find(e=>e.id===s.parent_folder_id);return r}(e,a);i(e=>new Set([...e,...t]))}}},[l,a]),(0,t.jsx)(B.Sheet,{open:e,onOpenChange:s,children:(0,t.jsxs)(B.SheetContent,{side:"left",className:"w-[400px] sm:w-[500px] p-0 bg-background border-border",children:[(0,t.jsxs)(B.SheetHeader,{className:"px-6 py-4 border-b border-border",children:[(0,t.jsx)(B.SheetTitle,{className:"text-foreground",children:"Browse All Folders"}),(0,t.jsx)(B.SheetDescription,{className:"text-muted-foreground",children:"Quick access to any folder in the hierarchy"})]}),(0,t.jsx)("div",{className:"px-6 py-4 border-b border-border bg-muted/50",children:(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(p.Search,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-muted-foreground",strokeWidth:2}),(0,t.jsx)(_.Input,{type:"text",placeholder:"Search folders...",value:d,onChange:e=>c(e.target.value),className:"pl-10 pr-10 h-9 text-sm"}),d&&(0,t.jsx)("button",{onClick:()=>c(""),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-muted-foreground hover:text-foreground transition-colors",children:(0,t.jsx)(E.X,{className:"w-4 h-4",strokeWidth:2})})]})}),(0,t.jsx)(I.ScrollArea,{className:"flex-1 h-[calc(100vh-180px)]",children:(0,t.jsxs)("div",{className:"px-4 py-4",children:[(0,t.jsxs)("button",{onClick:()=>g(null),className:(0,u.cn)("flex items-center gap-2 w-full px-3 py-2 rounded-md text-sm font-medium transition-colors",null===l?"bg-primary/20 text-primary border border-primary":"text-muted-foreground hover:bg-muted border border-transparent"),children:[(0,t.jsx)(m.Folder,{className:"w-4 h-4 flex-shrink-0",strokeWidth:2}),(0,t.jsx)("span",{children:"All Documents (Root)"})]}),(0,t.jsx)("div",{className:"mt-2 space-y-0.5",children:x.map(e=>(0,t.jsx)(U,{node:e,level:0,currentFolderId:l,expandedFolders:n,onToggle:f,onNavigate:g},e.folder.id))}),0===x.length&&(0,t.jsx)("div",{className:"text-center py-8 text-sm text-muted-foreground",children:d?"No folders match your search":"No folders found"})]})}),(0,t.jsx)("div",{className:"px-6 py-3 border-t border-border bg-muted/50",children:(0,t.jsxs)("p",{className:"text-xs text-muted-foreground",children:[(0,t.jsx)("kbd",{className:"px-1.5 py-0.5 bg-muted border border-border rounded text-xs font-mono text-foreground",children:"Cmd+K"})," ","to open this drawer"]})})]})})}function U({node:e,level:r,currentFolderId:s,expandedFolders:a,onToggle:l,onNavigate:o}){let n=a.has(e.folder.id),i=e.children.length>0,d=s===e.folder.id,c=C[e.folder.folder_type]||C.custom;return(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:(0,u.cn)("flex items-center gap-1 rounded-md transition-colors",d?"bg-primary/20 border border-primary":"hover:bg-muted border border-transparent"),style:{paddingLeft:`${16*r+8}px`},children:[i?(0,t.jsx)("button",{onClick:()=>l(e.folder.id),className:"p-1 hover:bg-accent rounded transition-colors","aria-label":n?"Collapse folder":"Expand folder",children:n?(0,t.jsx)(T.ChevronDown,{className:"w-3.5 h-3.5 text-muted-foreground",strokeWidth:2}):(0,t.jsx)(h.ChevronRight,{className:"w-3.5 h-3.5 text-muted-foreground",strokeWidth:2})}):(0,t.jsx)("div",{className:"w-5"}),(0,t.jsxs)("button",{onClick:()=>o(e.folder.id),className:"flex items-center gap-2 flex-1 py-2 pr-3 text-left text-sm focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-1 rounded",children:[n?(0,t.jsx)(f.FolderOpen,{className:(0,u.cn)("w-4 h-4 flex-shrink-0",c===C.vehicle_root?"text-blue-500":c===C.category?"text-green-500":"text-muted-foreground"),strokeWidth:2}):(0,t.jsx)(m.Folder,{className:(0,u.cn)("w-4 h-4 flex-shrink-0",c===C.vehicle_root?"text-blue-500":c===C.category?"text-green-500":"text-muted-foreground"),strokeWidth:2}),(0,t.jsx)("span",{className:(0,u.cn)("truncate font-medium",d?"text-foreground":"text-muted-foreground"),children:e.folder.name}),void 0!==e.folder.subfolder_count&&e.folder.subfolder_count>0&&(0,t.jsxs)("span",{className:"text-xs text-muted-foreground",children:["(",e.folder.subfolder_count,")"]})]})]}),n&&i&&(0,t.jsx)("div",{className:"mt-0.5",children:e.children.map(e=>(0,t.jsx)(U,{node:e,level:r+1,currentFolderId:s,expandedFolders:a,onToggle:l,onNavigate:o},e.folder.id))})]})}function R({currentFolder:e,className:a}){return(0,t.jsx)("div",{className:(0,u.cn)("px-6 py-2.5 border-b","bg-navy-50 border-navy-100","transition-colors duration-200",a),children:(0,t.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,t.jsx)(s.Upload,{className:"w-4 h-4 text-navy-600 flex-shrink-0",strokeWidth:2}),(0,t.jsx)("span",{className:"text-slate-700 font-medium",children:"Upload destination:"}),e?(0,t.jsx)("div",{className:"flex items-center gap-1.5",children:e.path.split("/").filter(Boolean).map((e,s,a)=>(0,t.jsxs)(r.default.Fragment,{children:[s>0&&(0,t.jsx)(h.ChevronRight,{className:"w-3.5 h-3.5 text-navy-400 flex-shrink-0",strokeWidth:2}),(0,t.jsx)("span",{className:(0,u.cn)("font-medium",s===a.length-1?"text-navy-900":"text-navy-700"),children:e})]},s))}):(0,t.jsx)("span",{className:"font-medium text-navy-900",children:"Root / All Documents"}),(0,t.jsx)(m.Folder,{className:"w-4 h-4 text-navy-600 ml-1 flex-shrink-0",strokeWidth:2})]})})}var W=e.i(838668),P=e.i(119311),$=e.i(401148),A=e.i(263229),z=e.i(15098),V=e.i(352776),H=e.i(514133),K=e.i(816654),J=e.i(994500);function X({open:e,onOpenChange:a,folderId:l,vehicleId:o,currentFolder:n,onSuccess:i}){let[c,h]=(0,r.useState)([]),[x,f]=(0,r.useState)("Other"),[p,g]=(0,r.useState)(""),[j,b]=(0,r.useState)(""),[w,v]=(0,r.useState)(!1),[N,y]=(0,r.useState)(l||null),[C,k]=(0,r.useState)([]),[S,F]=(0,r.useState)(!1);(0,r.useEffect)(()=>{e&&(async()=>{F(!0);try{let e=await fetch("/api/staff/documents/folders");if(e.ok){let t=await e.json();k(t.folders||[])}}catch(e){console.error("Error fetching folders:",e)}finally{F(!1)}})()},[e]),(0,r.useEffect)(()=>{y(l||null)},[l]);let M=(0,r.useCallback)(e=>{let t=e.map((e,t)=>({...e,id:`${Date.now()}-${t}`,progress:0,status:"pending"}));h(e=>[...e,...t])},[]),{getRootProps:L,getInputProps:T,isDragActive:B}=(0,W.useDropzone)({onDrop:M,accept:{"application/pdf":[".pdf"],"application/vnd.openxmlformats-officedocument.wordprocessingml.document":[".docx"],"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":[".xlsx"],"text/plain":[".txt"],"image/jpeg":[".jpg",".jpeg"],"image/png":[".png"]},maxSize:0x3200000,disabled:w}),I=async()=>{if(0===c.length)return void J.toast.error("Please select at least one file");v(!0);let e=0,t=c.length;try{for(let t of c){let r=new FormData;r.append("file",t),r.append("type",x),r.append("tags",p),r.append("description",j),N&&r.append("folder_id",N),o&&r.append("vehicle_id",o),h(e=>e.map(e=>e.id===t.id?{...e,status:"uploading"}:e));try{if(!(await fetch("/api/documents/upload",{method:"POST",body:r})).ok)throw Error("Upload failed");h(e=>e.map(e=>e.id===t.id?{...e,status:"success",progress:100}:e))}catch(r){h(e=>e.map(e=>e.id===t.id?{...e,status:"error",error:"Upload failed"}:e)),e++,console.error(`Error uploading ${t.name}:`,r)}}0===e?(J.toast.success(`Successfully uploaded ${t} file(s)`),i?.(),O()):J.toast.error(`${e} file(s) failed to upload`)}catch(e){console.error("Upload error:",e),J.toast.error("Failed to upload files")}finally{v(!1)}},O=()=>{w||(h([]),f("Other"),g(""),b(""),a(!1))};return(0,t.jsx)(V.Dialog,{open:e,onOpenChange:O,children:(0,t.jsxs)(V.DialogContent,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[(0,t.jsx)(V.DialogHeader,{children:(0,t.jsx)(V.DialogTitle,{children:"Upload Documents"})}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{...L(),className:(0,u.cn)("border-2 border-dashed rounded-lg p-8 text-center cursor-pointer transition-colors",B?"border-blue-500 bg-blue-50":"border-gray-300 hover:border-gray-400",w&&"opacity-50 cursor-not-allowed"),children:[(0,t.jsx)("input",{...T()}),(0,t.jsx)(s.Upload,{className:"h-12 w-12 mx-auto mb-4 text-gray-400"}),B?(0,t.jsx)("p",{className:"text-sm text-gray-600",children:"Drop files here..."}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("p",{className:"text-sm text-gray-600 mb-1",children:"Drag & drop files here, or click to select"}),(0,t.jsx)("p",{className:"text-xs text-gray-500",children:"Supported: PDF, DOCX, XLSX, TXT, JPG, PNG (max 50MB each)"})]})]}),c.length>0&&(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)(H.Label,{children:["Selected Files (",c.length,")"]}),(0,t.jsx)("div",{className:"border rounded-lg divide-y max-h-48 overflow-y-auto",children:c.map(e=>(0,t.jsxs)("div",{className:"flex items-center gap-3 p-3",children:[(0,t.jsx)(P.FileText,{className:"h-5 w-5 text-gray-400 flex-shrink-0"}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsx)("p",{className:"text-sm font-medium truncate",children:e.name}),(0,t.jsx)("p",{className:"text-xs text-gray-500",children:(e=>{if(0===e)return"0 Bytes";let t=Math.floor(Math.log(e)/Math.log(1024));return Math.round(e/Math.pow(1024,t)*100)/100+" "+["Bytes","KB","MB","GB"][t]})(e.size)})]}),"uploading"===e.status&&(0,t.jsx)(A.Loader2,{className:"h-4 w-4 animate-spin text-blue-500"}),"success"===e.status&&(0,t.jsx)(z.CheckCircle2,{className:"h-4 w-4 text-green-500"}),"error"===e.status&&(0,t.jsx)($.AlertCircle,{className:"h-4 w-4 text-red-500"}),"pending"===e.status&&!w&&(0,t.jsx)(d.Button,{variant:"ghost",size:"sm",onClick:()=>{var t;return t=e.id,void h(c.filter(e=>e.id!==t))},className:"h-6 w-6 p-0",children:(0,t.jsx)(E.X,{className:"h-4 w-4"})})]},e.id))})]}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(H.Label,{htmlFor:"document-type",children:"Document Type"}),(0,t.jsxs)(D.Select,{value:x,onValueChange:f,disabled:w,children:[(0,t.jsx)(D.SelectTrigger,{id:"document-type",children:(0,t.jsx)(D.SelectValue,{})}),(0,t.jsxs)(D.SelectContent,{children:[(0,t.jsx)(D.SelectItem,{value:"Agreement",children:"Agreement"}),(0,t.jsx)(D.SelectItem,{value:"Subscription",children:"Subscription"}),(0,t.jsx)(D.SelectItem,{value:"KYC",children:"KYC"}),(0,t.jsx)(D.SelectItem,{value:"Statement",children:"Statement"}),(0,t.jsx)(D.SelectItem,{value:"NDA",children:"NDA"}),(0,t.jsx)(D.SelectItem,{value:"Report",children:"Report"}),(0,t.jsx)(D.SelectItem,{value:"Tax",children:"Tax"}),(0,t.jsx)(D.SelectItem,{value:"Legal",children:"Legal"}),(0,t.jsx)(D.SelectItem,{value:"Other",children:"Other"})]})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(H.Label,{htmlFor:"folder",children:"Destination Folder"}),(0,t.jsxs)(D.Select,{value:N||"root",onValueChange:e=>y("root"===e?null:e),disabled:w||S,children:[(0,t.jsx)(D.SelectTrigger,{id:"folder",children:(0,t.jsx)(D.SelectValue,{children:S?(0,t.jsxs)("span",{className:"flex items-center gap-2",children:[(0,t.jsx)(A.Loader2,{className:"h-4 w-4 animate-spin"}),"Loading folders..."]}):N?(0,t.jsxs)("span",{className:"flex items-center gap-2",children:[(0,t.jsx)(m.Folder,{className:"h-4 w-4"}),C.find(e=>e.id===N)?.path||"Unknown folder"]}):(0,t.jsxs)("span",{className:"flex items-center gap-2",children:[(0,t.jsx)(m.Folder,{className:"h-4 w-4"}),"Root / No Folder"]})})}),(0,t.jsxs)(D.SelectContent,{className:"max-h-[300px]",children:[(0,t.jsx)(D.SelectItem,{value:"root",children:(0,t.jsxs)("span",{className:"flex items-center gap-2",children:[(0,t.jsx)(m.Folder,{className:"h-4 w-4"}),"Root / No Folder"]})}),C.map(e=>{let r=(e.path.match(/\//g)||[]).length-1;return(0,t.jsx)(D.SelectItem,{value:e.id,children:(0,t.jsxs)("span",{className:"flex items-center gap-2",style:{paddingLeft:`${16*r}px`},children:[(0,t.jsx)(m.Folder,{className:"h-4 w-4 flex-shrink-0"}),(0,t.jsx)("span",{className:"truncate",children:e.path})]})},e.id)})]})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(H.Label,{htmlFor:"tags",children:"Tags (comma-separated)"}),(0,t.jsx)(_.Input,{id:"tags",placeholder:"quarterly, 2024, financial",value:p,onChange:e=>g(e.target.value),disabled:w})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(H.Label,{htmlFor:"description",children:"Description (optional)"}),(0,t.jsx)(K.Textarea,{id:"description",placeholder:"Add a description for these documents...",value:j,onChange:e=>b(e.target.value),disabled:w,rows:3})]})]})]}),(0,t.jsxs)(V.DialogFooter,{children:[(0,t.jsx)(d.Button,{variant:"outline",onClick:O,disabled:w,children:"Cancel"}),(0,t.jsx)(d.Button,{onClick:I,disabled:0===c.length||w,children:w?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(A.Loader2,{className:"h-4 w-4 mr-2 animate-spin"}),"Uploading..."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(s.Upload,{className:"h-4 w-4 mr-2"}),"Upload ",c.length," File",1!==c.length?"s":""]})})]})]})})}let G=(0,g.default)("folder-tree",[["path",{d:"M20 10a1 1 0 0 0 1-1V6a1 1 0 0 0-1-1h-2.5a1 1 0 0 1-.8-.4l-.9-1.2A1 1 0 0 0 15 3h-2a1 1 0 0 0-1 1v5a1 1 0 0 0 1 1Z",key:"hod4my"}],["path",{d:"M20 21a1 1 0 0 0 1-1v-3a1 1 0 0 0-1-1h-2.9a1 1 0 0 1-.88-.55l-.42-.85a1 1 0 0 0-.92-.6H13a1 1 0 0 0-1 1v5a1 1 0 0 0 1 1Z",key:"w4yl2u"}],["path",{d:"M3 5a2 2 0 0 0 2 2h3",key:"f2jnh7"}],["path",{d:"M3 3v13a2 2 0 0 0 2 2h3",key:"k8epm1"}]]);function q({open:e,onOpenChange:s,documentId:a,documentName:l,currentFolderId:o,onSuccess:n}){let[i,c]=(0,r.useState)([]),[h,m]=(0,r.useState)(""),[u,x]=(0,r.useState)(!1),[f,p]=(0,r.useState)(!1);(0,r.useEffect)(()=>{e&&g()},[e]);let g=async()=>{try{x(!0);let e=await fetch("/api/staff/documents/folders");if(e.ok){let t=await e.json();c(t.folders||[])}else J.toast.error("Failed to load folders")}catch(e){console.error("Error loading folders:",e),J.toast.error("Failed to load folders")}finally{x(!1)}},j=async()=>{if(a)try{p(!0);let e="__root__"===h?null:h||null,t=await fetch(`/api/staff/documents/${a}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({folder_id:e})});if(t.ok)J.toast.success("Document moved successfully"),n?.(),s(!1);else{let e=await t.json();J.toast.error(e.error||"Failed to move document")}}catch(e){console.error("Error moving document:",e),J.toast.error("Failed to move document")}finally{p(!1)}},b=i.filter(e=>e.id!==o);return(0,t.jsx)(V.Dialog,{open:e,onOpenChange:s,children:(0,t.jsxs)(V.DialogContent,{children:[(0,t.jsx)(V.DialogHeader,{children:(0,t.jsxs)(V.DialogTitle,{children:["Move Document - ",l]})}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(H.Label,{children:"Select Destination Folder"}),u?(0,t.jsx)("div",{className:"text-center py-4",children:(0,t.jsx)(A.Loader2,{className:"h-6 w-6 animate-spin mx-auto text-blue-500"})}):(0,t.jsxs)(D.Select,{value:h,onValueChange:m,children:[(0,t.jsx)(D.SelectTrigger,{children:(0,t.jsx)(D.SelectValue,{placeholder:"Select a folder..."})}),(0,t.jsxs)(D.SelectContent,{className:"max-h-80",children:[(0,t.jsx)(D.SelectItem,{value:"__root__",children:"Root (No Folder)"}),b.map(e=>(0,t.jsx)(D.SelectItem,{value:e.id,children:e.path},e.id))]})]})]}),o&&(0,t.jsxs)("p",{className:"text-sm text-gray-500",children:["Current: ",i.find(e=>e.id===o)?.path||"Root"]})]}),(0,t.jsxs)(V.DialogFooter,{children:[(0,t.jsx)(d.Button,{variant:"outline",onClick:()=>s(!1),children:"Cancel"}),(0,t.jsx)(d.Button,{onClick:j,disabled:!h||f,children:f?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(A.Loader2,{className:"h-4 w-4 mr-2 animate-spin"}),"Moving..."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(G,{className:"h-4 w-4 mr-2"}),"Move"]})})]})]})})}function Q({open:e,onOpenChange:s,parentFolderId:l,onSuccess:o}){let[n,i]=(0,r.useState)(""),[c,h]=(0,r.useState)(!1),m=async()=>{if(!n.trim())return void J.toast.error("Please enter a folder name");try{h(!0);let e={name:n.trim(),folder_type:"custom",...l&&{parent_folder_id:l}},t=await fetch("/api/staff/documents/folders",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),r=await t.text();if(t.ok)J.toast.success("Folder created successfully"),i(""),o?.(),s(!1);else{let e={};try{e=JSON.parse(r)}catch(t){e={error:r||"Unknown error"}}console.error("[CreateFolder] Error response:",e);let t=e.details?`${e.error}: ${JSON.stringify(e.details)}`:e.error||"Failed to create folder";J.toast.error(t)}}catch(e){console.error("Error creating folder:",e),J.toast.error("Failed to create folder")}finally{h(!1)}},u=()=>{c||(i(""),s(!1))};return(0,t.jsx)(V.Dialog,{open:e,onOpenChange:u,children:(0,t.jsxs)(V.DialogContent,{children:[(0,t.jsx)(V.DialogHeader,{children:(0,t.jsx)(V.DialogTitle,{children:l?"Create Subfolder":"Create Folder"})}),(0,t.jsx)("div",{className:"space-y-4",children:(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(H.Label,{htmlFor:"folder-name",children:"Folder Name"}),(0,t.jsx)(_.Input,{id:"folder-name",placeholder:"Enter folder name...",value:n,onChange:e=>i(e.target.value),onKeyDown:e=>{"Enter"!==e.key||c||m()},disabled:c,autoFocus:!0})]})}),(0,t.jsxs)(V.DialogFooter,{children:[(0,t.jsx)(d.Button,{variant:"outline",onClick:u,disabled:c,children:"Cancel"}),(0,t.jsx)(d.Button,{onClick:m,disabled:!n.trim()||c,children:c?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(A.Loader2,{className:"h-4 w-4 mr-2 animate-spin"}),"Creating..."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(a.FolderPlus,{className:"h-4 w-4 mr-2"}),"Create Folder"]})})]})]})})}function Y({open:e,onOpenChange:s,folderId:a,currentName:l,onSuccess:o}){let[n,i]=(0,r.useState)(l),[c,h]=(0,r.useState)(!1),m=async e=>{if(e.preventDefault(),!a||!n.trim())return void J.toast.error("Folder name is required");if(n.trim()===l){J.toast.info("Name unchanged"),s(!1);return}h(!0);try{let e=await fetch(`/api/staff/documents/folders/${a}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:n.trim()})});if(e.ok)J.toast.success("Folder renamed successfully"),o(),s(!1),i("");else{let t=await e.json().catch(()=>({error:"Unknown error"})),r=t.details||t.error||"Unknown error";J.toast.error(`Failed to rename folder: ${r}`)}}catch(e){console.error("Error renaming folder:",e),J.toast.error("Failed to rename folder")}finally{h(!1)}};return(0,t.jsx)(V.Dialog,{open:e,onOpenChange:e=>{e&&i(l),s(e)},children:(0,t.jsx)(V.DialogContent,{className:"bg-zinc-900 border-white/10 text-white",children:(0,t.jsxs)("form",{onSubmit:m,children:[(0,t.jsxs)(V.DialogHeader,{children:[(0,t.jsx)(V.DialogTitle,{className:"text-white",children:"Rename Folder"}),(0,t.jsx)(V.DialogDescription,{className:"text-gray-400",children:"Enter a new name for this folder"})]}),(0,t.jsxs)("div",{className:"py-4",children:[(0,t.jsx)(H.Label,{htmlFor:"folder-name",className:"text-white",children:"Folder Name"}),(0,t.jsx)(_.Input,{id:"folder-name",value:n,onChange:e=>i(e.target.value),placeholder:"Enter folder name",className:"mt-2 bg-white/5 border-white/10 text-white placeholder:text-gray-500",disabled:c,autoFocus:!0})]}),(0,t.jsxs)(V.DialogFooter,{children:[(0,t.jsx)(d.Button,{type:"button",variant:"outline",onClick:()=>s(!1),disabled:c,className:"border-white/20 text-white hover:bg-white/10",children:"Cancel"}),(0,t.jsx)(d.Button,{type:"submit",disabled:c||!n.trim(),className:"bg-blue-600 hover:bg-blue-700 text-white",children:c?"Renaming...":"Rename"})]})]})})})}function Z({open:e,onOpenChange:s,documentId:a,currentName:l,onSuccess:o}){let[n,i]=(0,r.useState)(l),[c,h]=(0,r.useState)(!1),m=async e=>{if(e.preventDefault(),!a||!n.trim())return void J.toast.error("Document name is required");if(n.trim()===l){J.toast.info("Name unchanged"),s(!1);return}h(!0);try{let e=await fetch(`/api/staff/documents/${a}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:n.trim()})});if(e.ok)J.toast.success("Document renamed successfully"),o(),s(!1),i("");else{let t=await e.json().catch(()=>({error:"Unknown error"})),r=t.details||t.error||"Unknown error";J.toast.error(`Failed to rename document: ${r}`)}}catch(e){console.error("Error renaming document:",e),J.toast.error("Failed to rename document")}finally{h(!1)}};return(0,t.jsx)(V.Dialog,{open:e,onOpenChange:e=>{e&&i(l),s(e)},children:(0,t.jsx)(V.DialogContent,{className:"bg-zinc-900 border-white/10 text-white",children:(0,t.jsxs)("form",{onSubmit:m,children:[(0,t.jsxs)(V.DialogHeader,{children:[(0,t.jsx)(V.DialogTitle,{className:"text-white",children:"Rename Document"}),(0,t.jsx)(V.DialogDescription,{className:"text-gray-400",children:"Enter a new name for this document"})]}),(0,t.jsxs)("div",{className:"py-4",children:[(0,t.jsx)(H.Label,{htmlFor:"document-name",className:"text-white",children:"Document Name"}),(0,t.jsx)(_.Input,{id:"document-name",value:n,onChange:e=>i(e.target.value),placeholder:"Enter document name",className:"mt-2 bg-white/5 border-white/10 text-white placeholder:text-gray-500",disabled:c,autoFocus:!0})]}),(0,t.jsxs)(V.DialogFooter,{children:[(0,t.jsx)(d.Button,{type:"button",variant:"outline",onClick:()=>s(!1),disabled:c,className:"border-white/20 text-white hover:bg-white/10",children:"Cancel"}),(0,t.jsx)(d.Button,{type:"submit",disabled:c||!n.trim(),className:"bg-blue-600 hover:bg-blue-700 text-white",children:c?"Renaming...":"Rename"})]})]})})})}var ee=e.i(663216),et=e.i(619962);function er({initialVehicles:e,userProfile:g}){let[j,b]=(0,r.useState)(null),[w,v]=(0,r.useState)(null),[N,y]=(0,r.useState)([]),[C,k]=(0,r.useState)(!1),[S,F]=(0,r.useState)([]),[D,L]=(0,r.useState)([]),[B,U]=(0,r.useState)(!0),[W,P]=(0,r.useState)(!1),[$,A]=(0,r.useState)(!1),[z,V]=(0,r.useState)(null),[H,K]=(0,r.useState)(!1),[G,er]=(0,r.useState)(null),[es,ea]=(0,r.useState)(""),[el,eo]=(0,r.useState)(null),[en,ei]=(0,r.useState)(!1),[ed,ec]=(0,r.useState)(null),[eh,em]=(0,r.useState)(""),[eu,ex]=(0,r.useState)(!1),[ef,ep]=(0,r.useState)(null),[eg,ej]=(0,r.useState)(""),[eb,ew]=(0,r.useState)(""),[ev,eN]=(0,r.useState)("all"),[ey,eC]=(0,r.useState)("grid"),[ek,eS]=(0,r.useState)("name"),[eF,e_]=(0,r.useState)(""),[eD,eM]=(0,r.useState)(new Set),{isOpen:eL,document:eT,previewUrl:eE,isLoading:eB,error:eI,openPreview:eO,closePreview:eU,downloadDocument:eR}=(0,ee.useDocumentViewer)(),eW=e=>{null!==j&&j!==e&&y(e=>[...e,j]),b(e),v(S.find(t=>t.id===e)||null)},eP=(0,r.useMemo)(()=>{let e=S.filter(e=>e.parent_folder_id===(j||null));if(eb){let t=eb.toLowerCase();e=e.filter(e=>{let r=e.name.toLowerCase().includes(t),s=e.path.toLowerCase().includes(t);return r||s})}return e},[S,j,eb]),e$=(0,r.useMemo)(()=>{let e=D;if(eb){let t=eb.toLowerCase();e=e.filter(e=>{let r=e.name.toLowerCase().includes(t),s=e.vehicle?.name.toLowerCase().includes(t)||!1,a=e.folder?.name.toLowerCase().includes(t)||!1,l=e.folder?.path.toLowerCase().includes(t)||!1,o=e.type.toLowerCase().includes(t),n=e.created_by_profile?.display_name.toLowerCase().includes(t)||!1;return r||s||a||l||o||n})}return[...e].sort((e,t)=>"name"===ek?e.name.localeCompare(t.name):"date"===ek?new Date(t.created_at).getTime()-new Date(e.created_at).getTime():"type"===ek?e.type.localeCompare(t.type):0)},[D,eb,ek]),eA=(0,r.useCallback)(e=>{let t=new Map;return e.forEach(e=>{t.has(e.parent_folder_id)||t.set(e.parent_folder_id,[]),t.get(e.parent_folder_id).push({folder:e,children:[]})}),function e(r){return(t.get(r)||[]).map(t=>({...t,children:e(t.folder.id)}))}(null)},[]),ez=(0,r.useMemo)(()=>eA(S),[S,eA]),eV=(0,r.useCallback)((e,t)=>e.map(e=>{let r=e.folder.name.toLowerCase().includes(t),s=e.folder.path.toLowerCase().includes(t),a=eV(e.children,t);return r||s||a.length>0?{...e,children:a}:null}).filter(e=>null!==e),[]),eH=(0,r.useMemo)(()=>eF.trim()?eV(ez,eF.toLowerCase()):ez,[ez,eF,eV]);(0,r.useEffect)(()=>{if(j&&S.length>0){let e=S.find(e=>e.id===j);if(e){let t=(e=>{let t=[],r=e;for(;r?.parent_folder_id;)t.push(r.parent_folder_id),r=S.find(e=>e.id===r.parent_folder_id);return t})(e);eM(e=>new Set([...e,...t]))}}},[j,S]);let eK=(0,r.useCallback)(async()=>{try{let e=await fetch("/api/staff/documents/folders?tree=true");if(e.ok){let t=(await e.json()).folders||[],r=e=>{let t=[];return e.forEach(e=>{t.push({id:e.id,name:e.name,path:e.path,parent_folder_id:e.parent_folder_id,folder_type:e.folder_type,vehicle_id:e.vehicle_id,created_by:e.created_by,created_at:e.created_at,updated_at:e.updated_at,subfolder_count:e.children?.length||0,document_count:e.document_count||0}),e.children&&e.children.length>0&&t.push(...r(e.children))}),t};F(r(t))}else{let t=await e.json().catch(()=>({error:"Unknown error"})),r=t.details||t.error||"Unknown error";J.toast.error(`Failed to load folders: ${r}`)}}catch(e){console.error("Error loading folders:",e),J.toast.error("Failed to load folders")}},[]),eJ=(0,r.useCallback)(e=>{let t=[e],r=e=>{S.filter(t=>t.parent_folder_id===e).forEach(e=>{t.push(e.id),r(e.id)})};return r(e),t},[S]),eX=(0,r.useCallback)(async()=>{try{U(!0);let e=new URLSearchParams;!eb&&j&&(eJ(j).forEach(t=>e.append("folder_ids",t)),e.append("include_subfolders","true")),eb&&e.append("search",eb),"all"!==ev&&e.append("status",ev);let t=await fetch(`/api/staff/documents?${e.toString()}`);if(t.ok){let e=await t.json();L(e.documents||[])}else{let e=await t.json().catch(()=>({error:"Unknown error"})),r=e.details||e.error||"Unknown error";J.toast.error(`Failed to load documents: ${r}`)}}catch(e){console.error("Error loading documents:",e),J.toast.error("Failed to load documents")}finally{U(!1)}},[j,eb,ev,eJ]);(0,r.useEffect)(()=>{eK()},[eK]),(0,r.useEffect)(()=>{eX()},[eX]);let eG=(e=null)=>{V(e||j),A(!0)},eq=async t=>{try{let r=e.find(e=>e.id===t);(await fetch("/api/staff/documents/init-vehicle-folders",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({vehicle_id:t})})).ok?(J.toast.success(`Default folders created for ${r?.name||"vehicle"}`),eK()):J.toast.error("Failed to create vehicle folders")}catch(e){console.error("Error initializing folders:",e),J.toast.error("Failed to create vehicle folders")}},eQ=async e=>{if(confirm("Are you sure you want to delete this document?"))try{(await fetch(`/api/staff/documents/${e}`,{method:"DELETE"})).ok?(J.toast.success("Document deleted successfully"),eX()):J.toast.error("Failed to delete document")}catch(e){console.error("Error deleting document:",e),J.toast.error("Failed to delete document")}},eY=async e=>{let t=e.name||"";if(["docx","doc","xlsx","xls","pptx","ppt","odt","ods","odp"].includes(t.split(".").pop()?.toLowerCase()||"")){J.toast.info("Office documents cannot be previewed. Use Download to view."),eZ(e.id);return}await eO({id:e.id,file_name:e.name,name:e.name,file_size_bytes:e.file_size_bytes,type:e.type,mime_type:e.mime_type})},eZ=async e=>{try{let t=await fetch(`/api/documents/${e}/download`);if(t.ok){let e=await t.json(),r=e.url||e.download_url;r?(window.open(r,"_blank"),J.toast.success("Download started")):J.toast.error("No download URL in response")}else J.toast.error("Failed to generate download link")}catch(e){console.error("Error downloading document:",e),J.toast.error("Failed to download document")}},e0=async e=>{let t=S.find(t=>t.id===e);if(t&&confirm(`Are you sure you want to delete "${t.name}"? This will also delete all documents and subfolders within it.`))try{let t=await fetch(`/api/staff/documents/folders/${e}`,{method:"DELETE"});if(t.ok)J.toast.success("Folder deleted successfully"),eK(),eX();else{let e=await t.json().catch(()=>({error:"Unknown error"})),r=e.details||e.error||"Unknown error";J.toast.error(`Failed to delete folder: ${r}`)}}catch(e){console.error("Error deleting folder:",e),J.toast.error("Failed to delete folder")}},e1=e.filter(e=>!S.some(t=>t.vehicle_id===e.id&&"vehicle_root"===t.folder_type)),e2=(e,r=0)=>{let s=eD.has(e.folder.id),a=e.children.length>0,l=j===e.folder.id;return(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:(0,u.cn)("flex items-center gap-1 rounded-md transition-colors",l?"bg-primary/20 border border-primary":"hover:bg-muted border border-transparent"),style:{paddingLeft:`${16*r+8}px`},children:[a?(0,t.jsx)("button",{onClick:()=>{var t;return t=e.folder.id,void eM(e=>{let r=new Set(e);return r.has(t)?r.delete(t):r.add(t),r})},className:"p-1 hover:bg-accent rounded transition-colors","aria-label":s?"Collapse folder":"Expand folder",children:s?(0,t.jsx)(T.ChevronDown,{className:"w-3.5 h-3.5 text-muted-foreground"}):(0,t.jsx)(h.ChevronRight,{className:"w-3.5 h-3.5 text-muted-foreground"})}):(0,t.jsx)("div",{className:"w-5"}),(0,t.jsxs)("button",{onClick:()=>eW(e.folder.id),className:"flex items-center gap-2 flex-1 py-2 pr-3 text-left text-sm focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-1 rounded",children:[s?(0,t.jsx)(f.FolderOpen,{className:(0,u.cn)("w-4 h-4 flex-shrink-0","vehicle_root"===e.folder.folder_type?"text-blue-500":"category"===e.folder.folder_type?"text-green-500":"text-muted-foreground")}):(0,t.jsx)(m.Folder,{className:(0,u.cn)("w-4 h-4 flex-shrink-0","vehicle_root"===e.folder.folder_type?"text-blue-500":"category"===e.folder.folder_type?"text-green-500":"text-muted-foreground")}),(0,t.jsx)("span",{className:(0,u.cn)("truncate font-medium",l?"text-foreground":"text-muted-foreground"),children:e.folder.name}),void 0!==e.folder.document_count&&e.folder.document_count>0&&(0,t.jsxs)("span",{className:"text-xs text-muted-foreground ml-auto",children:["(",e.folder.document_count,")"]})]})]}),s&&a&&(0,t.jsx)("div",{className:"mt-0.5",children:e.children.map(e=>e2(e,r+1))})]},e.folder.id)};return(0,t.jsxs)("div",{className:"flex flex-col h-full bg-background",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between px-6 py-4 bg-muted/50 border-b border-border",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsxs)(d.Button,{variant:"outline",size:"icon",className:"lg:hidden",onClick:()=>k(!0),children:[(0,t.jsx)(o.Menu,{className:"h-5 w-5"}),(0,t.jsx)("span",{className:"sr-only",children:"Open folder tree"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-2xl font-bold text-foreground",children:"Document Management"}),(0,t.jsx)("p",{className:"text-muted-foreground mt-1 hidden sm:block",children:"Manage documents with hierarchical folder structure"})]})]}),(0,t.jsx)("div",{className:"flex gap-2",children:(0,t.jsxs)(d.Button,{variant:"outline",onClick:()=>eX(),children:[(0,t.jsx)(l.RefreshCw,{className:"h-4 w-4 mr-2"}),(0,t.jsx)("span",{className:"hidden sm:inline",children:"Refresh"})]})})]}),(0,t.jsxs)("div",{className:"flex-1 grid grid-cols-1 lg:grid-cols-[280px_1fr] overflow-hidden",children:[(0,t.jsxs)("aside",{className:"hidden lg:flex flex-col border-r border-border bg-muted/30",children:[(0,t.jsx)("div",{className:"px-4 py-3 border-b border-border",children:(0,t.jsx)("h2",{className:"text-sm font-semibold text-foreground",children:"Folders"})}),(0,t.jsx)("div",{className:"px-3 py-3 border-b border-border",children:(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(p.Search,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-muted-foreground"}),(0,t.jsx)(_.Input,{type:"text",placeholder:"Search folders...",value:eF,onChange:e=>e_(e.target.value),className:"pl-10 pr-10 h-9 text-sm"}),eF&&(0,t.jsx)("button",{onClick:()=>e_(""),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-muted-foreground hover:text-foreground transition-colors",children:(0,t.jsx)(E.X,{className:"w-4 h-4"})})]})}),(0,t.jsx)(I.ScrollArea,{className:"flex-1",children:(0,t.jsxs)("div",{className:"px-2 py-2",children:[(0,t.jsxs)("button",{onClick:()=>eW(null),className:(0,u.cn)("flex items-center gap-2 w-full px-3 py-2 rounded-md text-sm font-medium transition-colors",null===j?"bg-primary/20 text-primary border border-primary":"text-muted-foreground hover:bg-muted border border-transparent"),children:[(0,t.jsx)(i.Home,{className:"w-4 h-4 flex-shrink-0"}),(0,t.jsx)("span",{children:"All Documents"})]}),(0,t.jsx)("div",{className:"mt-2 space-y-0.5",children:eH.map(e=>e2(e,0))}),0===eH.length&&(0,t.jsx)("div",{className:"text-center py-8 text-sm text-muted-foreground",children:eF?"No folders match your search":"No folders found"})]})}),e1.length>0&&(0,t.jsx)("div",{className:"p-3 border-t border-border",children:(0,t.jsxs)(c.DropdownMenu,{children:[(0,t.jsx)(c.DropdownMenuTrigger,{asChild:!0,children:(0,t.jsxs)(d.Button,{variant:"outline",size:"sm",className:"w-full border-amber-500/50 bg-amber-500/10 text-amber-600 dark:text-amber-400 hover:bg-amber-500/20",children:[(0,t.jsx)(a.FolderPlus,{className:"h-4 w-4 mr-2"}),"Init Folders (",e1.length,")"]})}),(0,t.jsx)(c.DropdownMenuContent,{children:e1.map(e=>(0,t.jsxs)(c.DropdownMenuItem,{onClick:()=>eq(e.id),children:[e.name," (",e.type,")"]},e.id))})]})})]}),(0,t.jsxs)("main",{className:"flex flex-col overflow-hidden",children:[w&&(0,t.jsx)(x,{currentFolder:w,onNavigate:eW}),w&&(0,t.jsx)(R,{currentFolder:w}),(0,t.jsxs)("div",{className:"flex items-center justify-between px-6 py-4 border-b border-border bg-muted/50",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[N.length>0&&(0,t.jsxs)(d.Button,{variant:"ghost",onClick:()=>{if(0===N.length)return;let e=N[N.length-1];y(e=>e.slice(0,-1)),b(e),v(S.find(t=>t.id===e)||null)},children:[(0,t.jsx)(n.ArrowLeft,{className:"w-4 h-4 mr-2"}),"Back"]}),e1.length>0&&(0,t.jsx)("div",{className:"lg:hidden",children:(0,t.jsxs)(c.DropdownMenu,{children:[(0,t.jsx)(c.DropdownMenuTrigger,{asChild:!0,children:(0,t.jsxs)(d.Button,{variant:"outline",size:"sm",className:"border-amber-500/50 bg-amber-500/10 text-amber-600 dark:text-amber-400 hover:bg-amber-500/20",children:[(0,t.jsx)(a.FolderPlus,{className:"h-4 w-4 mr-2"}),"Init (",e1.length,")"]})}),(0,t.jsx)(c.DropdownMenuContent,{children:e1.map(e=>(0,t.jsxs)(c.DropdownMenuItem,{onClick:()=>eq(e.id),children:[e.name," (",e.type,")"]},e.id))})]})})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsxs)(d.Button,{onClick:()=>P(!0),children:[(0,t.jsx)(s.Upload,{className:"w-4 h-4 mr-2"}),(0,t.jsx)("span",{className:"hidden sm:inline",children:"Upload"})]}),(0,t.jsxs)(d.Button,{variant:"outline",onClick:()=>eG(),children:[(0,t.jsx)(a.FolderPlus,{className:"w-4 h-4 mr-2"}),(0,t.jsx)("span",{className:"hidden sm:inline",children:"New Folder"})]})]})]}),(0,t.jsx)("div",{className:"flex-1 overflow-hidden",children:(0,t.jsx)(M,{currentFolderId:j,currentFolder:w,subfolders:eP,documents:e$,isLoading:B,viewMode:ey,sortBy:ek,searchQuery:eb,onNavigateToFolder:eW,onDocumentClick:e=>{let t=D.find(t=>t.id===e);t&&eY(t)},onUploadClick:()=>P(!0),onCreateFolderClick:()=>eG(),onRenameFolder:e=>{let t=S.find(t=>t.id===e);t&&(ec(e),em(t.name),ei(!0))},onDeleteFolder:e0,onCreateSubfolder:eG,onRenameDocument:e=>{let t=D.find(t=>t.id===e);t&&(ep(e),ej(t.name),ex(!0))},onDeleteDocument:eQ,onViewModeChange:eC,onSortChange:eS,onSearchChange:ew})})]})]}),(0,t.jsx)(O,{open:C,onOpenChange:k,folders:S,currentFolderId:j,onNavigate:eW}),(0,t.jsx)(X,{open:W,onOpenChange:P,folderId:j,currentFolder:w,vehicleId:w?.vehicle_id||void 0,onSuccess:()=>eX()}),(0,t.jsx)(q,{open:H,onOpenChange:K,documentId:G,documentName:es,currentFolderId:el,onSuccess:()=>eX()}),(0,t.jsx)(Q,{open:$,onOpenChange:A,parentFolderId:z,onSuccess:()=>eK()}),(0,t.jsx)(Y,{open:en,onOpenChange:ei,folderId:ed,currentName:eh,onSuccess:()=>eK()}),(0,t.jsx)(Z,{open:eu,onOpenChange:ex,documentId:ef,currentName:eg,onSuccess:()=>eX()}),(0,t.jsx)(et.DocumentViewerFullscreen,{isOpen:eL,document:eT,previewUrl:eE,isLoading:eB,error:eI,onClose:eU,onDownload:eR})]})}e.s(["StaffDocumentsClient",()=>er],675771)}]);