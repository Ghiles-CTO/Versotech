(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,496383,e=>{"use strict";let t=(0,e.i(410587).default)("eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);e.s(["Eye",()=>t],496383)},761722,e=>{"use strict";let t=(0,e.i(410587).default)("download",[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]]);e.s(["Download",()=>t],761722)},237635,e=>{"use strict";var t=e.i(722679),a=e.i(282141);function s({className:e,...s}){return(0,t.jsx)("div",{"data-slot":"table-container",className:"relative w-full overflow-x-auto",children:(0,t.jsx)("table",{"data-slot":"table",className:(0,a.cn)("w-full caption-bottom text-sm",e),...s})})}function r({className:e,...s}){return(0,t.jsx)("thead",{"data-slot":"table-header",className:(0,a.cn)("[&_tr]:border-b",e),...s})}function l({className:e,...s}){return(0,t.jsx)("tbody",{"data-slot":"table-body",className:(0,a.cn)("[&_tr:last-child]:border-0",e),...s})}function n({className:e,...s}){return(0,t.jsx)("tr",{"data-slot":"table-row",className:(0,a.cn)("hover:bg-muted/50 data-[state=selected]:bg-muted border-b transition-colors",e),...s})}function i({className:e,...s}){return(0,t.jsx)("th",{"data-slot":"table-head",className:(0,a.cn)("text-foreground h-11 md:h-10 px-2 text-left align-middle font-medium text-xs sm:text-sm [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",e),...s})}function d({className:e,...s}){return(0,t.jsx)("td",{"data-slot":"table-cell",className:(0,a.cn)("p-2 align-middle text-xs sm:text-sm [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",e),...s})}e.s(["Table",()=>s,"TableBody",()=>l,"TableCell",()=>d,"TableHead",()=>i,"TableHeader",()=>r,"TableRow",()=>n])},90613,e=>{"use strict";var t=e.i(722679),a=e.i(282141);function s({className:e,...s}){return(0,t.jsx)("div",{"data-slot":"card",className:(0,a.cn)("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",e),...s})}function r({className:e,...s}){return(0,t.jsx)("div",{"data-slot":"card-header",className:(0,a.cn)("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-1.5 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",e),...s})}function l({className:e,...s}){return(0,t.jsx)("div",{"data-slot":"card-title",className:(0,a.cn)("leading-none font-semibold",e),...s})}function n({className:e,...s}){return(0,t.jsx)("div",{"data-slot":"card-description",className:(0,a.cn)("text-muted-foreground text-sm",e),...s})}function i({className:e,...s}){return(0,t.jsx)("div",{"data-slot":"card-content",className:(0,a.cn)("px-6",e),...s})}function d({className:e,...s}){return(0,t.jsx)("div",{"data-slot":"card-footer",className:(0,a.cn)("flex items-center px-6 [.border-t]:pt-6",e),...s})}e.s(["Card",()=>s,"CardContent",()=>i,"CardDescription",()=>n,"CardFooter",()=>d,"CardHeader",()=>r,"CardTitle",()=>l])},15098,e=>{"use strict";let t=(0,e.i(410587).default)("circle-check",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);e.s(["CheckCircle2",()=>t],15098)},196767,e=>{"use strict";let t=(0,e.i(410587).default)("dollar-sign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]);e.s(["DollarSign",()=>t],196767)},501495,e=>{"use strict";e.s(["formatBps",0,e=>null==e?"—":`${e} bps`,"formatCurrency",0,(e,t="USD")=>e?new Intl.NumberFormat("en-US",{style:"currency",currency:t,maximumFractionDigits:0}).format(e):"$0","formatDate",0,e=>{if(!e)return"—";let t="string"==typeof e?new Date(e):e;return Number.isNaN(t?.getTime?.())?"—":t.toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})}])},937368,e=>{"use strict";var t=e.i(722679),a=e.i(340915),s=e.i(47264),r=e.i(362208),l="Progress",[n,i]=(0,s.createContextScope)(l),[d,o]=n(l),c=a.forwardRef((e,a)=>{var s,l;let{__scopeProgress:n,value:i=null,max:o,getValueLabel:c=x,...m}=e;(o||0===o)&&!f(o)&&console.error((s=`${o}`,`Invalid prop \`max\` of value \`${s}\` supplied to \`Progress\`. Only numbers greater than 0 are valid max values. Defaulting to \`100\`.`));let u=f(o)?o:100;null===i||g(i,u)||console.error((l=`${i}`,`Invalid prop \`value\` of value \`${l}\` supplied to \`Progress\`. The \`value\` prop must be:
  - a positive number
  - less than the value passed to \`max\` (or 100 if no \`max\` prop is set)
  - \`null\` or \`undefined\` if the progress is indeterminate.

Defaulting to \`null\`.`));let w=g(i,u)?i:null,b=p(w)?c(w,u):void 0;return(0,t.jsx)(d,{scope:n,value:w,max:u,children:(0,t.jsx)(r.Primitive.div,{"aria-valuemax":u,"aria-valuemin":0,"aria-valuenow":p(w)?w:void 0,"aria-valuetext":b,role:"progressbar","data-state":h(w,u),"data-value":w??void 0,"data-max":u,...m,ref:a})})});c.displayName=l;var m="ProgressIndicator",u=a.forwardRef((e,a)=>{let{__scopeProgress:s,...l}=e,n=o(m,s);return(0,t.jsx)(r.Primitive.div,{"data-state":h(n.value,n.max),"data-value":n.value??void 0,"data-max":n.max,...l,ref:a})});function x(e,t){return`${Math.round(e/t*100)}%`}function h(e,t){return null==e?"indeterminate":e===t?"complete":"loading"}function p(e){return"number"==typeof e}function f(e){return p(e)&&!isNaN(e)&&e>0}function g(e,t){return p(e)&&!isNaN(e)&&e<=t&&e>=0}u.displayName=m;var w=e.i(282141);let b=a.forwardRef(({className:e,value:a,...s},r)=>(0,t.jsx)(c,{ref:r,className:(0,w.cn)("relative h-4 w-full overflow-hidden rounded-full bg-secondary",e),...s,children:(0,t.jsx)(u,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:`translateX(-${100-(a||0)}%)`}})}));b.displayName=c.displayName,e.s(["Progress",()=>b],937368)},663216,e=>{"use strict";var t=e.i(340915),a=e.i(994500),s=e.i(722318),r=e.i(676967);let l=["application/pdf","image/png","image/jpeg","image/jpg","image/gif","image/webp","text/plain"],n=["pdf","png","jpeg","jpg","gif","webp","txt","text"];function i(){let[e,i]=(0,t.useState)(!1),[d,o]=(0,t.useState)(null),[c,m]=(0,t.useState)(null),[u,x]=(0,t.useState)(!1),[h,p]=(0,t.useState)(null),f=(0,t.useCallback)(async(e,t)=>{p(null),m(null);let d=(e=>{let t;if(e.file_size_bytes&&!(e.file_size_bytes<=0xa00000))return"File is too large for preview (maximum 10MB). Please download to view.";let a=e.file_name||e.name||"",s=!!a&&!!(t=a.split(".").pop()?.toLowerCase())&&n.includes(t),r=e.mime_type||"",i=!!r&&l.includes(r);return["docx","doc","xlsx","xls","pptx","ppt","odt","ods","odp"].includes(a.split(".").pop()?.toLowerCase()||"")||r&&(r.includes("officedocument")||r.includes("msword")||r.includes("ms-excel")||r.includes("ms-powerpoint")||r.includes("opendocument"))?"Office documents cannot be previewed. Please download to view.":s||i?null:"Preview not supported for this file type. Please download to view."})(e);if(d)return void a.toast.error(d);o(e),i(!0),x(!0);try{let a=t?await s.DocumentService.getDealDocumentPreviewUrl(t,e.id):await s.DocumentService.getPreviewUrl(e.id);m(a.download_url),x(!1)}catch(t){console.error("Failed to load document preview:",t);let e=t instanceof r.DocumentError?s.DocumentService.getErrorMessage(t):"Failed to load document preview. Please try downloading instead.";p(e),x(!1),a.toast.error(e)}},[]),g=(0,t.useCallback)(()=>{i(!1),setTimeout(()=>{o(null),m(null),p(null),x(!1)},300)},[]),w=(0,t.useCallback)(async()=>{if(d)try{if(c)return void window.open(c,"_blank");let e=await s.DocumentService.getDownloadUrl(d.id);window.open(e.download_url,"_blank")}catch(t){console.error("Failed to download document:",t);let e=t instanceof r.DocumentError?s.DocumentService.getErrorMessage(t):"Failed to download document";a.toast.error(e)}},[d,c]);return{isOpen:e,document:d,previewUrl:c,isLoading:u,error:h,openPreview:f,closePreview:g,downloadDocument:w}}e.s(["useDocumentViewer",()=>i],663216)},619962,e=>{"use strict";var t=e.i(722679),a=e.i(340915),s=e.i(400557),r=e.i(432598),l=e.i(761722),n=e.i(263229),i=e.i(401148),d=e.i(119311),o=e.i(316264),c=e.i(282141);function m({isOpen:e,document:m,previewUrl:u,isLoading:x,error:h,onClose:p,onDownload:f}){let[g,w]=(0,a.useState)(!1),[b,j]=(0,a.useState)(!1);(0,a.useEffect)(()=>(j(!0),()=>j(!1)),[]);let v=(0,a.useMemo)(()=>{var e;return u?(e=m?.file_name||m?.name,e?.toLowerCase().endsWith(".pdf")||u?.toLowerCase().includes(".pdf")||u?.includes("deal-documents")&&u?.includes(".pdf")||0)?u.includes("#")?u:`${u}#navpanes=0&view=FitH&pagemode=none`:u:null},[u,m]);if((0,a.useEffect)(()=>{let t=e=>{"Escape"===e.key&&p(),e.ctrlKey&&"d"===e.key&&(e.preventDefault(),f())};if(e&&1)return window.addEventListener("keydown",t),window.document?.body&&(window.document.body.style.overflow="hidden"),()=>{window.removeEventListener("keydown",t),window.document?.body&&(window.document.body.style.overflow="")}},[e,p,f]),(0,a.useEffect)(()=>{w(!1)},[u]),!e||!b)return null;let N=(0,t.jsxs)("div",{className:"fixed inset-0 z-[9999] bg-black/95 overflow-hidden",children:[(0,t.jsxs)("div",{className:"h-16 bg-white border-b shadow-md flex items-center justify-between px-6",children:[(0,t.jsxs)("div",{className:"flex items-center gap-4 flex-1 min-w-0",children:[(0,t.jsx)(d.FileText,{className:"h-5 w-5 text-gray-500 flex-shrink-0"}),(0,t.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,t.jsx)("h2",{className:"text-lg font-semibold text-gray-900 truncate",children:m?.file_name||m?.name||"Document Preview"}),(0,t.jsxs)("div",{className:"flex items-center gap-3 text-sm text-gray-500",children:[m?.type&&(0,t.jsx)("span",{className:"capitalize",children:m.type}),m?.file_size_bytes&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("span",{children:"•"}),(0,t.jsx)("span",{children:(0,c.formatFileSize)(m.file_size_bytes)})]})]})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2 flex-shrink-0",children:[(0,t.jsxs)(o.Button,{variant:"outline",size:"sm",onClick:f,className:"gap-2",children:[(0,t.jsx)(l.Download,{className:"h-4 w-4"}),"Download"]}),(0,t.jsxs)(o.Button,{variant:"ghost",size:"sm",onClick:p,className:"gap-2",children:[(0,t.jsx)(r.X,{className:"h-4 w-4"}),"Close"]})]})]}),(0,t.jsxs)("div",{className:"h-[calc(100vh-4rem)] bg-gray-900",children:[(x||h||g)&&(0,t.jsxs)("div",{className:"w-full h-full flex items-center justify-center",children:[x&&(0,t.jsxs)("div",{className:"flex flex-col items-center gap-4 text-white",children:[(0,t.jsx)(n.Loader2,{className:"h-12 w-12 animate-spin"}),(0,t.jsx)("p",{className:"text-lg",children:"Loading document..."})]}),h&&!x&&(0,t.jsxs)("div",{className:"flex flex-col items-center gap-4 text-white max-w-md mx-auto px-4",children:[(0,t.jsx)(i.AlertCircle,{className:"h-16 w-16 text-red-400"}),(0,t.jsx)("h3",{className:"text-xl font-semibold",children:"Failed to Load Preview"}),(0,t.jsx)("p",{className:"text-gray-300 text-center",children:h}),(0,t.jsxs)(o.Button,{onClick:f,variant:"secondary",className:"gap-2 mt-4",children:[(0,t.jsx)(l.Download,{className:"h-4 w-4"}),"Download Instead"]})]}),g&&!x&&!h&&(0,t.jsxs)("div",{className:"flex flex-col items-center gap-4 text-white max-w-md mx-auto px-4",children:[(0,t.jsx)(i.AlertCircle,{className:"h-16 w-16 text-red-400"}),(0,t.jsx)("h3",{className:"text-xl font-semibold",children:"Preview Unavailable"}),(0,t.jsx)("p",{className:"text-gray-300 text-center",children:"This document cannot be previewed in your browser."}),(0,t.jsxs)(o.Button,{onClick:f,variant:"secondary",className:"gap-2 mt-4",children:[(0,t.jsx)(l.Download,{className:"h-4 w-4"}),"Download to View"]})]})]}),v&&!x&&!h&&!g&&(0,t.jsx)("iframe",{src:v,className:"w-full h-full border-0",title:"Document Preview",onError:()=>{console.error("iframe failed to load preview"),w(!0)}})]}),!x&&!h&&(0,t.jsxs)("div",{className:"absolute bottom-4 left-1/2 -translate-x-1/2 text-white/60 text-sm bg-black/50 px-4 py-2 rounded-full",children:["Press ",(0,t.jsx)("kbd",{className:"px-2 py-1 bg-white/10 rounded mx-1",children:"ESC"})," to close or ",(0,t.jsx)("kbd",{className:"px-2 py-1 bg-white/10 rounded mx-1",children:"Ctrl+D"})," to download"]})]}),y=window.document.body;return y?(0,s.createPortal)(N,y):null}e.s(["DocumentViewerFullscreen",()=>m])},722318,676967,e=>{"use strict";class t extends Error{statusCode;originalError;constructor(e,t,a){super(e),this.statusCode=t,this.originalError=a,this.name="DocumentError"}}e.s(["DocumentError",()=>t],676967);class a{static isValidStorageUrl(e){return!!e&&!!e.startsWith("https://")&&(e.includes("supabase.co/storage")||e.includes("supabase.com/storage")||e.startsWith("blob:"))}static async parseResponse(e){let a;try{a=await e.json()}catch(a){throw new t("Invalid response from server",e.status,a)}if(!e.ok)throw new t(a.error||a.message||"Failed to load document",e.status,a);let s=a.url||a.download_url;if(!s)throw new t("No download URL in response",500,a);if(!this.isValidStorageUrl(s))throw new t("Invalid download URL format",500,a);return a.url=s,a.download_url=s,a}static async getPreviewUrl(e){try{let t=await fetch(`/api/documents/${e}/download?mode=preview`,{method:"GET",headers:{"Content-Type":"application/json"}});return await this.parseResponse(t)}catch(e){if(e instanceof t)throw e;throw new t("Network error while loading preview",0,e)}}static async getDownloadUrl(e){try{let t=await fetch(`/api/documents/${e}/download?mode=download`,{method:"GET",headers:{"Content-Type":"application/json"}});return await this.parseResponse(t)}catch(e){if(e instanceof t)throw e;throw new t("Network error while loading download",0,e)}}static async getDealDocumentPreviewUrl(e,a){try{let t=await fetch(`/api/deals/${e}/documents/${a}/download?mode=preview`,{method:"GET",headers:{"Content-Type":"application/json"}});return await this.parseResponse(t)}catch(e){if(e instanceof t)throw e;throw new t("Network error while loading deal document preview",0,e)}}static async getDealDocumentDownloadUrl(e,a){try{let t=await fetch(`/api/deals/${e}/documents/${a}/download?mode=download`,{method:"GET",headers:{"Content-Type":"application/json"}});return await this.parseResponse(t)}catch(e){if(e instanceof t)throw e;throw new t("Network error while loading deal document download",0,e)}}static getErrorMessage(e){switch(e.statusCode){case 401:return"You do not have permission to view this document.";case 403:return"Access to this document is forbidden.";case 404:return"Document not found or has been deleted.";case 413:return"File is too large to process.";case 500:return"Server error while loading document. Please try again.";case 0:return"Network error. Please check your connection and try again.";default:return e.message||"Failed to load document preview."}}}e.s(["DocumentService",()=>a],722318)},398739,e=>{"use strict";let t=(0,e.i(410587).default)("arrow-up",[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]]);e.s(["ArrowUp",()=>t],398739)},185419,e=>{"use strict";let t=(0,e.i(410587).default)("arrow-up-down",[["path",{d:"m21 16-4 4-4-4",key:"f6ql7i"}],["path",{d:"M17 20V4",key:"1ejh1v"}],["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}]]);e.s(["ArrowUpDown",()=>t],185419)},478416,e=>{"use strict";let t=(0,e.i(410587).default)("arrow-down",[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]]);e.s(["ArrowDown",()=>t],478416)},625610,e=>{"use strict";var t=e.i(722679),a=e.i(340915),s=e.i(90613),r=e.i(129432),l=e.i(316264),n=e.i(191569),i=e.i(538892),d=e.i(237635),o=e.i(15098),c=e.i(645855),m=e.i(196767),u=e.i(761722),x=e.i(119311),h=e.i(750809),p=e.i(263229),f=e.i(501259),g=e.i(691974),w=e.i(432598),b=e.i(84065),j=e.i(496383),v=e.i(758171),N=e.i(197098),y=e.i(185419),C=e.i(398739),_=e.i(478416),k=e.i(937368),D=e.i(282141),S=e.i(501495),T=e.i(994500),F=e.i(663216),P=e.i(619962);let E={committed:"bg-blue-100 text-blue-800 border-blue-200 dark:bg-blue-900/30 dark:text-blue-300 dark:border-blue-800",partially_funded:"bg-amber-100 text-amber-800 border-amber-200 dark:bg-amber-900/30 dark:text-amber-300 dark:border-amber-800",funded:"bg-emerald-100 text-emerald-800 border-emerald-200 dark:bg-emerald-900/30 dark:text-emerald-300 dark:border-emerald-800",active:"bg-green-100 text-green-800 border-green-200 dark:bg-green-900/30 dark:text-green-300 dark:border-green-800"},U={committed:"Signed",partially_funded:"Partially Funded",funded:"Fully Funded",active:"Active"},M=[{label:"All Statuses",value:"all"},{label:"Signed (Awaiting Funding)",value:"committed"},{label:"Partially Funded",value:"partially_funded"},{label:"Fully Funded",value:"funded"},{label:"Active",value:"active"}];function L({entityInfo:e,subscriptions:L}){let[z,A]=(0,a.useState)(""),[$,H]=(0,a.useState)("all"),[B,R]=(0,a.useState)(null),[I,V]=(0,a.useState)("all"),[O,q]=(0,a.useState)("all"),[G,K]=(0,a.useState)({startDate:"",endDate:""}),[W,X]=(0,a.useState)(1),[Y,J]=(0,a.useState)("signed_at"),[Q,Z]=(0,a.useState)("desc"),{isOpen:ee,document:et,previewUrl:ea,isLoading:es,error:er,openPreview:el,closePreview:en,downloadDocument:ei}=(0,F.useDocumentViewer)(),ed=(0,a.useMemo)(()=>{let e=new Map,t=new Map;return L.forEach(a=>{a.investor_id&&a.investor_name&&e.set(a.investor_id,a.investor_name),a.deal_id&&a.deal_name&&t.set(a.deal_id,a.deal_name)}),{investors:Array.from(e.entries()).map(([e,t])=>({id:e,name:t})).sort((e,t)=>e.name.localeCompare(t.name)),deals:Array.from(t.entries()).map(([e,t])=>({id:e,name:t})).sort((e,t)=>e.name.localeCompare(t.name))}},[L]),eo=(0,a.useMemo)(()=>{let e=L.filter(e=>"committed"===e.status).length,t=L.filter(e=>"partially_funded"===e.status).length,a=L.filter(e=>"funded"===e.status||"active"===e.status).length,s=L.reduce((e,t)=>e+t.commitment,0),r=L.reduce((e,t)=>e+t.funded_amount,0);return{total:L.length,committed:e,partiallyFunded:t,fullyFunded:a,totalCommitment:s,totalFunded:r}},[L]),ec=(0,a.useMemo)(()=>[...L.filter(e=>{let t="all"===$||e.status===$,a=!z||e.deal_name.toLowerCase().includes(z.toLowerCase())||e.investor_name.toLowerCase().includes(z.toLowerCase()),s="all"===I||e.investor_id===I,r="all"===O||e.deal_id===O,l=!0;if(e.signed_at){let t=e.signed_at.split("T")[0];G.startDate&&(l=l&&t>=G.startDate),G.endDate&&(l=l&&t<=G.endDate)}return t&&a&&s&&r&&l})].sort((e,t)=>{let a=0;switch(Y){case"deal_name":a=e.deal_name.localeCompare(t.deal_name);break;case"investor_name":a=e.investor_name.localeCompare(t.investor_name);break;case"commitment":a=e.commitment-t.commitment;break;case"funded_amount":a=e.funded_amount-t.funded_amount;break;case"status":a=e.status.localeCompare(t.status);break;case"signed_at":a=(e.signed_at?new Date(e.signed_at).getTime():0)-(t.signed_at?new Date(t.signed_at).getTime():0);break;case"subscription_number":a=(e.subscription_number||0)-(t.subscription_number||0)}return"asc"===Q?a:-a}),[z,$,I,O,G,L,Y,Q]),em=(0,a.useMemo)(()=>{let e=ec.filter(e=>"committed"===e.status).length,t=ec.filter(e=>"partially_funded"===e.status).length,a=ec.filter(e=>"funded"===e.status||"active"===e.status).length;return{total:ec.length,committed:e,partiallyFunded:t,fullyFunded:a}},[ec]),eu=Math.ceil(ec.length/10),ex=(W-1)*10,eh=Math.min(ex+10,ec.length),ep=ec.slice(ex,eh),ef="all"!==I||"all"!==O||G.startDate||G.endDate||z||"all"!==$,eg=(e,t)=>{e(t),X(1)},ew=()=>{A(""),H("all"),V("all"),q("all"),K({startDate:"",endDate:""}),X(1)},eb=e=>{Y===e?Z(e=>"asc"===e?"desc":"asc"):(J(e),Z(["commitment","funded_amount","signed_at"].includes(e)?"desc":"asc")),X(1)},ej=({column:e})=>Y!==e?(0,t.jsx)(y.ArrowUpDown,{className:"ml-1 h-4 w-4 text-muted-foreground/50"}):"asc"===Q?(0,t.jsx)(C.ArrowUp,{className:"ml-1 h-4 w-4"}):(0,t.jsx)(_.ArrowDown,{className:"ml-1 h-4 w-4"}),ev=async e=>{if(!e.document_file_key||!e.document_id)return void T.toast.error("No signed document available for download");R(e.id);try{let t=await fetch(`/api/documents/${e.document_id}/download`),a=await t.json();if(!t.ok)throw Error(a.error||"Failed to get download link");let s=await fetch(a.url);if(!s.ok)throw Error("Failed to download document file");let r=await s.blob(),l=window.URL.createObjectURL(r),n=document.createElement("a");n.href=l,n.download=e.document_file_name||a.fileName||`subscription-pack-${e.id}.pdf`,document.body.appendChild(n),n.click(),window.URL.revokeObjectURL(l),document.body.removeChild(n),T.toast.success("Document downloaded successfully")}catch(e){console.error("Download error:",e),T.toast.error(e instanceof Error?e.message:"Failed to download document")}finally{R(null)}};return(0,t.jsxs)("div",{className:"p-6 space-y-6",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-2xl font-bold text-foreground",children:"Signed Subscription Packs"}),(0,t.jsx)("p",{className:"text-muted-foreground mt-1",children:e?.entity_type==="arranger"?`Subscription packs for mandates managed by ${e?.display_name||"your entity"}`:e?`Subscription packs for deals assigned to ${e?.display_name||e?.firm_name||"your firm"}`:"View signed subscription packs for your deals"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[e?.entity_type&&(0,t.jsx)(r.Badge,{variant:"outline",className:"capitalize",children:e.entity_type}),e?.entity_type==="lawyer"&&e?.specializations?.length?e.specializations.slice(0,2).map((e,a)=>(0,t.jsx)(r.Badge,{variant:"outline",className:"capitalize",children:e},a)):null]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,t.jsxs)(s.Card,{children:[(0,t.jsx)(s.CardHeader,{className:"pb-2",children:(0,t.jsxs)(s.CardTitle,{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[(0,t.jsx)(x.FileText,{className:"h-4 w-4"}),"Total Signed"]})}),(0,t.jsxs)(s.CardContent,{children:[(0,t.jsx)("div",{className:"text-2xl font-bold",children:ef?(0,t.jsxs)("span",{children:[em.total," ",(0,t.jsxs)("span",{className:"text-base font-normal text-muted-foreground",children:["/ ",eo.total]})]}):eo.total}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:ef?"Matching filters":"Subscription packs signed"})]})]}),(0,t.jsxs)(s.Card,{children:[(0,t.jsx)(s.CardHeader,{className:"pb-2",children:(0,t.jsxs)(s.CardTitle,{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[(0,t.jsx)(c.Clock,{className:"h-4 w-4"}),"Awaiting Funding"]})}),(0,t.jsxs)(s.CardContent,{children:[(0,t.jsx)("div",{className:"text-2xl font-bold text-blue-600",children:ef?(0,t.jsxs)("span",{children:[em.committed," ",(0,t.jsxs)("span",{className:"text-base font-normal text-muted-foreground",children:["/ ",eo.committed]})]}):eo.committed}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Signed, pending escrow"})]})]}),(0,t.jsxs)(s.Card,{children:[(0,t.jsx)(s.CardHeader,{className:"pb-2",children:(0,t.jsxs)(s.CardTitle,{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[(0,t.jsx)(m.DollarSign,{className:"h-4 w-4"}),"Partially Funded"]})}),(0,t.jsxs)(s.CardContent,{children:[(0,t.jsx)("div",{className:"text-2xl font-bold text-amber-600",children:ef?(0,t.jsxs)("span",{children:[em.partiallyFunded," ",(0,t.jsxs)("span",{className:"text-base font-normal text-muted-foreground",children:["/ ",eo.partiallyFunded]})]}):eo.partiallyFunded}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Partial escrow received"})]})]}),(0,t.jsxs)(s.Card,{children:[(0,t.jsx)(s.CardHeader,{className:"pb-2",children:(0,t.jsxs)(s.CardTitle,{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[(0,t.jsx)(o.CheckCircle2,{className:"h-4 w-4"}),"Fully Funded"]})}),(0,t.jsxs)(s.CardContent,{children:[(0,t.jsx)("div",{className:"text-2xl font-bold text-emerald-600",children:ef?(0,t.jsxs)("span",{children:[em.fullyFunded," ",(0,t.jsxs)("span",{className:"text-base font-normal text-muted-foreground",children:["/ ",eo.fullyFunded]})]}):eo.fullyFunded}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Complete funding received"})]})]})]}),(0,t.jsx)(s.Card,{children:(0,t.jsxs)(s.CardContent,{className:"pt-6",children:[(0,t.jsxs)("div",{className:"flex flex-col md:flex-row gap-4 mb-4",children:[(0,t.jsx)("div",{className:"flex-1",children:(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(h.Search,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),(0,t.jsx)(n.Input,{placeholder:"Search by deal or investor name...",value:z,onChange:e=>eg(A,e.target.value),className:"pl-10"})]})}),(0,t.jsxs)(i.Select,{value:$,onValueChange:e=>eg(H,e),children:[(0,t.jsx)(i.SelectTrigger,{className:"w-full md:w-56",children:(0,t.jsx)(i.SelectValue,{placeholder:"Filter by status"})}),(0,t.jsx)(i.SelectContent,{children:M.map(e=>(0,t.jsx)(i.SelectItem,{value:e.value,children:e.label},e.value))})]})]}),(0,t.jsxs)("div",{className:"flex flex-col lg:flex-row gap-4 items-end",children:[(0,t.jsxs)("div",{className:"w-full lg:w-48",children:[(0,t.jsx)("label",{className:"text-xs text-muted-foreground mb-1.5 block",children:"Investor"}),(0,t.jsxs)(i.Select,{value:I,onValueChange:e=>eg(V,e),children:[(0,t.jsxs)(i.SelectTrigger,{children:[(0,t.jsx)(f.Users,{className:"h-4 w-4 mr-2 text-muted-foreground"}),(0,t.jsx)(i.SelectValue,{placeholder:"All Investors"})]}),(0,t.jsxs)(i.SelectContent,{children:[(0,t.jsx)(i.SelectItem,{value:"all",children:"All Investors"}),ed.investors.map(e=>(0,t.jsx)(i.SelectItem,{value:e.id,children:e.name},e.id))]})]})]}),(0,t.jsxs)("div",{className:"w-full lg:w-48",children:[(0,t.jsx)("label",{className:"text-xs text-muted-foreground mb-1.5 block",children:"Opportunity"}),(0,t.jsxs)(i.Select,{value:O,onValueChange:e=>eg(q,e),children:[(0,t.jsxs)(i.SelectTrigger,{children:[(0,t.jsx)(g.Briefcase,{className:"h-4 w-4 mr-2 text-muted-foreground"}),(0,t.jsx)(i.SelectValue,{placeholder:"All Opportunities"})]}),(0,t.jsxs)(i.SelectContent,{children:[(0,t.jsx)(i.SelectItem,{value:"all",children:"All Opportunities"}),ed.deals.map(e=>(0,t.jsx)(i.SelectItem,{value:e.id,children:e.name},e.id))]})]})]}),(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row items-end gap-2",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("label",{className:"text-xs text-muted-foreground mb-1.5 block flex items-center gap-1",children:[(0,t.jsx)(b.Calendar,{className:"h-3 w-3"}),"From Date"]}),(0,t.jsx)(n.Input,{type:"date",value:G.startDate,onChange:e=>{K(t=>({...t,startDate:e.target.value})),X(1)},className:"w-36"})]}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("label",{className:"text-xs text-muted-foreground mb-1.5 block flex items-center gap-1",children:[(0,t.jsx)(b.Calendar,{className:"h-3 w-3"}),"To Date"]}),(0,t.jsx)(n.Input,{type:"date",value:G.endDate,onChange:e=>{K(t=>({...t,endDate:e.target.value})),X(1)},className:"w-36"})]})]}),ef&&(0,t.jsxs)(l.Button,{variant:"ghost",size:"sm",onClick:ew,className:"h-10 px-3",children:[(0,t.jsx)(w.X,{className:"h-4 w-4 mr-1"}),"Clear All"]})]})]})}),(0,t.jsxs)(s.Card,{children:[(0,t.jsxs)(s.CardHeader,{children:[(0,t.jsx)(s.CardTitle,{children:"Signed Subscriptions"}),(0,t.jsxs)(s.CardDescription,{children:[0===ec.length?"No subscriptions found":eu>1?`Showing ${ex+1}-${eh} of ${ec.length} subscriptions`:`${ec.length} subscription${1!==ec.length?"s":""}`,ef&&ec.length>0&&` (filtered from ${L.length} total)`]})]}),(0,t.jsx)(s.CardContent,{children:0===ec.length?(0,t.jsxs)("div",{className:"border border-dashed border-muted rounded-lg py-12 flex flex-col items-center justify-center text-center space-y-2",children:[(0,t.jsx)(x.FileText,{className:"h-10 w-10 text-muted-foreground"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:ef?"No subscriptions match your filters":"No signed subscription packs yet"}),ef&&(0,t.jsx)(l.Button,{variant:"link",size:"sm",onClick:ew,children:"Clear filters to see all subscriptions"})]}):(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)("div",{className:"rounded-md border",children:(0,t.jsxs)(d.Table,{children:[(0,t.jsx)(d.TableHeader,{children:(0,t.jsxs)(d.TableRow,{children:[(0,t.jsx)(d.TableHead,{className:"cursor-pointer hover:bg-muted/50 select-none",onClick:()=>eb("deal_name"),children:(0,t.jsxs)("div",{className:"flex items-center",children:["Deal",(0,t.jsx)(ej,{column:"deal_name"})]})}),(0,t.jsx)(d.TableHead,{className:"cursor-pointer hover:bg-muted/50 select-none",onClick:()=>eb("investor_name"),children:(0,t.jsxs)("div",{className:"flex items-center",children:["Investor",(0,t.jsx)(ej,{column:"investor_name"})]})}),(0,t.jsx)(d.TableHead,{className:"cursor-pointer hover:bg-muted/50 select-none",onClick:()=>eb("commitment"),children:(0,t.jsxs)("div",{className:"flex items-center",children:["Commitment",(0,t.jsx)(ej,{column:"commitment"})]})}),(0,t.jsx)(d.TableHead,{className:"text-center",children:"Shares"}),(0,t.jsx)(d.TableHead,{className:"cursor-pointer hover:bg-muted/50 select-none min-w-[140px]",onClick:()=>eb("funded_amount"),children:(0,t.jsxs)("div",{className:"flex items-center",children:["Funded",(0,t.jsx)(ej,{column:"funded_amount"})]})}),(0,t.jsx)(d.TableHead,{className:"cursor-pointer hover:bg-muted/50 select-none",onClick:()=>eb("status"),children:(0,t.jsxs)("div",{className:"flex items-center",children:["Status",(0,t.jsx)(ej,{column:"status"})]})}),(0,t.jsx)(d.TableHead,{className:"cursor-pointer hover:bg-muted/50 select-none",onClick:()=>eb("subscription_number"),children:(0,t.jsxs)("div",{className:"flex items-center",children:["#",(0,t.jsx)(ej,{column:"subscription_number"})]})}),(0,t.jsx)(d.TableHead,{className:"cursor-pointer hover:bg-muted/50 select-none",onClick:()=>eb("signed_at"),children:(0,t.jsxs)("div",{className:"flex items-center",children:["Signed Date",(0,t.jsx)(ej,{column:"signed_at"})]})}),(0,t.jsx)(d.TableHead,{className:"text-right",children:"Actions"})]})}),(0,t.jsx)(d.TableBody,{children:ep.map(e=>{let a=e.commitment>0?Math.round(e.funded_amount/e.commitment*100):0;return(0,t.jsxs)(d.TableRow,{children:[(0,t.jsx)(d.TableCell,{children:(0,t.jsx)("div",{className:"font-medium",children:e.deal_name})}),(0,t.jsx)(d.TableCell,{children:(0,t.jsx)("div",{className:"font-medium",children:e.investor_name})}),(0,t.jsx)(d.TableCell,{children:(0,t.jsx)("div",{className:"font-medium",children:(0,S.formatCurrency)(e.commitment,e.currency)})}),(0,t.jsx)(d.TableCell,{className:"text-center",children:e.num_shares?(0,t.jsxs)("div",{className:"space-y-0.5",children:[(0,t.jsx)("div",{className:"font-medium text-sm",children:Number(e.num_shares).toLocaleString()}),e.price_per_share&&(0,t.jsxs)("div",{className:"text-xs text-muted-foreground",children:["@ ",(0,S.formatCurrency)(Number(e.price_per_share),e.currency)]})]}):(0,t.jsx)("span",{className:"text-muted-foreground text-xs",children:"—"})}),(0,t.jsx)(d.TableCell,{children:(0,t.jsxs)("div",{className:"space-y-1.5",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,t.jsx)("span",{className:"font-medium",children:(0,S.formatCurrency)(e.funded_amount,e.currency)}),(0,t.jsxs)("span",{className:"text-xs text-muted-foreground",children:[a,"%"]})]}),(0,t.jsx)(k.Progress,{value:a,className:"h-1.5"})]})}),(0,t.jsx)(d.TableCell,{children:(0,t.jsx)(r.Badge,{variant:"outline",className:(0,D.cn)("capitalize",E[e.status]||"bg-gray-100 text-gray-800 border-gray-200 dark:bg-gray-800 dark:text-gray-300 dark:border-gray-700"),children:U[e.status]||e.status.replace("_"," ")})}),(0,t.jsx)(d.TableCell,{children:e.subscription_number?(0,t.jsx)("span",{className:"text-sm font-mono",children:e.subscription_number}):(0,t.jsx)("span",{className:"text-muted-foreground text-xs",children:"—"})}),(0,t.jsx)(d.TableCell,{children:(0,t.jsxs)("div",{className:"space-y-1",children:[e.signed_at?(0,t.jsx)("div",{className:"text-sm",children:(0,S.formatDate)(e.signed_at)}):(0,t.jsx)("span",{className:"text-muted-foreground text-xs",children:"Unknown"}),e.funding_due_at&&"active"!==e.status&&(0,t.jsxs)("div",{className:(0,D.cn)("text-xs flex items-center gap-1",new Date(e.funding_due_at)<new Date?"text-red-600 dark:text-red-400":new Date(e.funding_due_at)<new Date(Date.now()+6048e5)?"text-amber-600 dark:text-amber-400":"text-muted-foreground"),children:[(0,t.jsx)(c.Clock,{className:"h-3 w-3"}),"Due: ",(0,S.formatDate)(e.funding_due_at)]})]})}),(0,t.jsx)(d.TableCell,{className:"text-right",children:e.document_file_key?(0,t.jsxs)("div",{className:"flex items-center justify-end gap-2",children:[(0,t.jsx)(l.Button,{variant:"ghost",size:"sm",onClick:()=>(e=>{if(!e.document_id)return void T.toast.error("No document available for preview");let t=e.document_file_name||"";if(["docx","doc","xlsx","xls","pptx","ppt","odt","ods","odp"].includes(t.split(".").pop()?.toLowerCase()||"")){T.toast.info("Office documents cannot be previewed. Downloading instead..."),ev(e);return}el({id:e.document_id,file_name:e.document_file_name,name:e.document_file_name,mime_type:e.document_mime_type,file_size_bytes:e.document_file_size,type:e.document_type})})(e),title:"Preview document",children:(0,t.jsx)(j.Eye,{className:"h-4 w-4"})}),(0,t.jsx)(l.Button,{variant:"outline",size:"sm",onClick:()=>ev(e),disabled:B===e.id,title:"Download PDF",children:B===e.id?(0,t.jsx)(p.Loader2,{className:"h-4 w-4 animate-spin"}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(u.Download,{className:"h-4 w-4 mr-1"}),"PDF"]})})]}):(0,t.jsx)("span",{className:"text-xs text-muted-foreground",children:"No document"})})]},e.id)})})]})}),eu>1&&(0,t.jsxs)("div",{className:"flex items-center justify-between pt-2 border-t",children:[(0,t.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Showing ",ex+1,"-",eh," of ",ec.length," subscriptions"]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsxs)(l.Button,{variant:"outline",size:"sm",onClick:()=>X(e=>Math.max(1,e-1)),disabled:1===W,children:[(0,t.jsx)(v.ChevronLeft,{className:"h-4 w-4"}),"Previous"]}),(0,t.jsx)("div",{className:"flex items-center gap-1",children:Array.from({length:Math.min(5,eu)},(e,a)=>{let s;return s=eu<=5||W<=3?a+1:W>=eu-2?eu-4+a:W-2+a,(0,t.jsx)(l.Button,{variant:W===s?"default":"outline",size:"sm",onClick:()=>X(s),className:"w-8 h-8 p-0",children:s},s)})}),(0,t.jsxs)(l.Button,{variant:"outline",size:"sm",onClick:()=>X(e=>Math.min(eu,e+1)),disabled:W===eu,children:["Next",(0,t.jsx)(N.ChevronRight,{className:"h-4 w-4"})]})]})]})]})})]}),(0,t.jsx)(P.DocumentViewerFullscreen,{isOpen:ee,document:et,previewUrl:ea,isLoading:es,error:er,onClose:en,onDownload:ei})]})}e.s(["SubscriptionPacksClient",()=>L])}]);