(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,410587,e=>{"use strict";var t=e.i(340915);let a=e=>{let t=e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,a)=>a?a.toUpperCase():t.toLowerCase());return t.charAt(0).toUpperCase()+t.slice(1)},r=(...e)=>e.filter((e,t,a)=>!!e&&""!==e.trim()&&a.indexOf(e)===t).join(" ").trim();var s={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let o=(0,t.forwardRef)(({color:e="currentColor",size:a=24,strokeWidth:o=2,absoluteStrokeWidth:l,className:i="",children:c,iconNode:n,...u},d)=>(0,t.createElement)("svg",{ref:d,...s,width:a,height:a,stroke:e,strokeWidth:l?24*Number(o)/Number(a):o,className:r("lucide",i),...!c&&!(e=>{for(let t in e)if(t.startsWith("aria-")||"role"===t||"title"===t)return!0})(u)&&{"aria-hidden":"true"},...u},[...n.map(([e,a])=>(0,t.createElement)(e,a)),...Array.isArray(c)?c:[c]])),l=(e,s)=>{let l=(0,t.forwardRef)(({className:l,...i},c)=>(0,t.createElement)(o,{ref:c,iconNode:s,className:r(`lucide-${a(e).replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()}`,`lucide-${e}`,l),...i}));return l.displayName=a(e),l};e.s(["default",()=>l],410587)},263229,e=>{"use strict";let t=(0,e.i(410587).default)("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);e.s(["Loader2",()=>t],263229)},603274,(e,t,a)=>{t.exports=e.r(750645)},788379,e=>{"use strict";var t="undefined"!=typeof self?self:"undefined"!=typeof window?window:e.g;let a=t.fetch,r=t.fetch.bind(t),s=t.Headers,o=t.Request,l=t.Response;e.s(["Headers",0,s,"Request",0,o,"Response",0,l,"default",0,r,"fetch",0,a])},80465,e=>{"use strict";let t=(0,e.i(410587).default)("circle-check-big",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);e.s(["CheckCircle",()=>t],80465)},745083,e=>{"use strict";let t=(0,e.i(410587).default)("circle-x",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);e.s(["XCircle",()=>t],745083)},809831,e=>{"use strict";var t=e.i(722679),a=e.i(340915),r=e.i(603274);e.i(244614);var s=e.i(593508),o=e.i(263229),l=e.i(80465),i=e.i(745083),c=e.i(59178);let n="",u=!1;function d(){return(0,s.createBrowserClient)("https://ipguxdssecfexudnvtia.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlwZ3V4ZHNzZWNmZXh1ZG52dGlhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTgzNjE4MzcsImV4cCI6MjA3MzkzNzgzN30.AGxM_YW9hfxuu7xDpi_4xhOoRhYM7iGTS1vJ0z2FByE",{auth:{persistSession:!0,detectSessionInUrl:!0,autoRefreshToken:!0,flowType:"implicit"}})}async function h(e,t){try{(0,c.resetClient)();let a=(0,c.createClient)(),{error:r}=await a.auth.setSession({access_token:e,refresh_token:t});if(r)return console.error("[auth-callback] Failed to sync session to main client:",r),!1;return console.log("[auth-callback] Session synced to main app client successfully"),!0}catch(e){return console.error("[auth-callback] Error syncing session:",e),!1}}function m(){let e=(0,r.useRouter)(),s=(0,r.useSearchParams)(),[c,m]=(0,a.useState)("loading"),[f,g]=(0,a.useState)("Verifying your email..."),p=(0,a.useRef)(!1),b=(0,a.useRef)(null),w=s.get("portal")??"investor",y=s.get("error"),k=s.get("error_description"),x=s.get("code"),_=s.get("type"),v="recovery"===_,E=u||v,C=(0,a.useCallback)(async e=>{if(p.current)return;if(p.current=!0,console.log("[auth-callback] User authenticated:",e.email),console.log("[auth-callback] User metadata:",e.user_metadata),console.log("[auth-callback] IS_RECOVERY_FLOW_DETECTED (module):",u),console.log("[auth-callback] isRecoveryFromParams:",v),console.log("[auth-callback] Final isRecovery:",E),E){console.log("[auth-callback] Recovery flow CONFIRMED, redirecting to reset-password..."),m("success"),g("Redirecting to reset your password..."),setTimeout(()=>{window.location.href="/versotech_main/reset-password?from=recovery"},1e3);return}let t=b.current||d();try{let a=null,{data:r}=await t.from("profiles").select("role, display_name, password_set").eq("id",e.id).maybeSingle();if(!(a=r)){console.log("[auth-callback] Profile not found, creating it...");let r=e.user_metadata?.display_name||e.user_metadata?.full_name||e.email?.split("@")[0]||"User",s=await fetch("/api/auth/create-profile",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:e.id,email:e.email,displayName:r})});if(!s.ok){let e=await s.json().catch(()=>({}));console.error("[auth-callback] Profile creation failed:",e),m("error"),g("Failed to create profile. Please contact support.");return}let{data:o}=await t.from("profiles").select("role, display_name, password_set").eq("id",e.id).single();a=o||{role:"investor",display_name:r,password_set:!1}}if(console.log("[auth-callback] Profile ready:",a),["staff_admin","staff_ops","staff_rm","ceo"].includes(a.role),!1===a.password_set){console.log("[auth-callback] Password not set, redirecting to set-password page..."),m("success"),g("Please set your password to continue..."),setTimeout(()=>{window.location.href="/versotech_main/set-password"},1500);return}let s="/versotech_main/dashboard";console.log("[auth-callback] Redirecting to unified portal:",s,"for role:",a.role),m("success"),g("Email verified! Redirecting to portal..."),setTimeout(()=>{window.location.href=s},1500)}catch(e){console.error("[auth-callback] Unexpected error:",e),m("error"),g("An unexpected error occurred. Please try again.")}},[E,v]);return(0,a.useEffect)(()=>{if(console.log("[auth-callback:effect] Module-level IS_RECOVERY_FLOW_DETECTED:",u),console.log("[auth-callback:effect] Module-level CAPTURED_HASH:",n?n.substring(0,50)+"...":"empty"),console.log("[auth-callback:effect] Component-level isRecovery:",E),y){console.error("[auth-callback] Error in URL:",y,k),m("error"),g(k||"Authentication failed. Please try again."),setTimeout(()=>{e.push("/versotech_main/login?error=auth_failed")},2e3);return}let t=d();b.current=t,console.log("[auth-callback] Created implicit flow client"),console.log("[auth-callback] Current URL hash:",window.location.hash?"Present (tokens in hash)":"Empty"),console.log("[auth-callback] Code param:",x?"Present (PKCE flow)":"Empty");let{data:{subscription:a}}=t.auth.onAuthStateChange(async(e,t)=>{console.log("[auth-callback] Auth state changed:",e,t?.user?.email,"isRecovery:",E),"SIGNED_IN"===e&&t?.user||"TOKEN_REFRESHED"===e&&t?.user?(t.access_token&&t.refresh_token&&await h(t.access_token,t.refresh_token),C(t.user)):"INITIAL_SESSION"===e&&t?.user&&(console.log("[auth-callback] Initial session detected"),t.access_token&&t.refresh_token&&await h(t.access_token,t.refresh_token),C(t.user))});return setTimeout(async()=>{let{data:{user:a}}=await t.auth.getUser();if(a){console.log("[auth-callback] Found existing session, isRecovery:",E),C(a);return}if(x){console.log("[auth-callback] Exchanging code for session...");let{data:a,error:r}=await t.auth.exchangeCodeForSession(x);if(r){console.error("[auth-callback] Exchange failed:",r),m("error"),g(`Verification error: ${r.message}`),setTimeout(()=>{e.push("/versotech_main/login?error=auth_failed")},3e3);return}if(a?.user)return void C(a.user)}let r=n||window.location.hash;if(r&&r.includes("access_token")){console.log("[auth-callback] Hash fragment detected, manually extracting tokens from:",r.substring(0,50)+"...");let e=new URLSearchParams(r.substring(1)),a=e.get("access_token"),s=e.get("refresh_token");if(console.log("[auth-callback] Tokens extracted:",{hasAccessToken:!!a,hasRefreshToken:!!s,type:e.get("type")}),a&&s){let{data:e,error:r}=await t.auth.setSession({access_token:a,refresh_token:s});if(r)console.error("[auth-callback] Failed to set session on implicit client:",r);else if(e?.user){console.log("[auth-callback] Session set on implicit client for:",e.user.email),await h(a,s)||console.warn("[auth-callback] Session sync to main client failed, navigation may fail"),C(e.user);return}}await new Promise(e=>setTimeout(e,500));let{data:{user:o}}=await t.auth.getUser();if(o){console.log("[auth-callback] User found after hash processing"),C(o);return}}console.log("[auth-callback] Waiting for auth state change..."),setTimeout(()=>{p.current||(console.error("[auth-callback] Timeout - no authenticated user found"),console.error("[auth-callback] Hash was:",window.location.hash?"Present":"Empty"),console.error("[auth-callback] CAPTURED_HASH was:",n?"Present":"Empty"),m("error"),g("Verification failed. The link may have expired or already been used."),setTimeout(()=>{e.push("/versotech_main/login?error=auth_failed")},3e3))},5e3)},200),()=>{a.unsubscribe()}},[y,k,x,_,w,e,C,E]),(0,t.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-slate-50 flex items-center justify-center p-4",children:(0,t.jsxs)("div",{className:"bg-white p-8 rounded-lg shadow-lg max-w-md w-full text-center",children:["loading"===c&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(o.Loader2,{className:"w-16 h-16 mx-auto mb-4 text-blue-600 animate-spin"}),(0,t.jsx)("h1",{className:"text-xl font-bold text-gray-900 mb-2",children:"Verifying Your Email"}),(0,t.jsx)("p",{className:"text-gray-600",children:f})]}),"success"===c&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(l.CheckCircle,{className:"w-16 h-16 mx-auto mb-4 text-green-600"}),(0,t.jsx)("h1",{className:"text-xl font-bold text-gray-900 mb-2",children:"Email Verified!"}),(0,t.jsx)("p",{className:"text-gray-600",children:f})]}),"error"===c&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(i.XCircle,{className:"w-16 h-16 mx-auto mb-4 text-red-600"}),(0,t.jsx)("h1",{className:"text-xl font-bold text-gray-900 mb-2",children:"Verification Failed"}),(0,t.jsx)("p",{className:"text-gray-600 mb-4",children:f}),(0,t.jsx)("button",{onClick:()=>e.push("/"),className:"bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg",children:"Return to Home"})]})]})})}function f(){return(0,t.jsx)(a.Suspense,{fallback:(0,t.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-slate-50 flex items-center justify-center p-4",children:(0,t.jsxs)("div",{className:"bg-white p-8 rounded-lg shadow-lg max-w-md w-full text-center",children:[(0,t.jsx)(o.Loader2,{className:"w-16 h-16 mx-auto mb-4 text-blue-600 animate-spin"}),(0,t.jsx)("h1",{className:"text-xl font-bold text-gray-900 mb-2",children:"Loading..."}),(0,t.jsx)("p",{className:"text-gray-600",children:"Please wait while we verify your email."})]})}),children:(0,t.jsx)(m,{})})}(n=window.location.hash||"").includes("type=recovery")&&(u=!0,console.log("[auth-callback:module] RECOVERY FLOW DETECTED at module load! Hash:",n.substring(0,50)+"...")),e.s(["default",()=>f])},68929,e=>{e.v(e=>Promise.resolve().then(()=>e(788379)))}]);