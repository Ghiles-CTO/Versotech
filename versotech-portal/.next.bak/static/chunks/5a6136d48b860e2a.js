(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,81484,e=>{"use strict";var a=e.i(722679),t=e.i(340915),s=e.i(90613),r=e.i(129432),n=e.i(316264),l=e.i(191569),i=e.i(312692),d=e.i(237635),c=e.i(429760),o=e.i(196767),m=e.i(645855),u=e.i(15098),x=e.i(750809),h=e.i(263229),p=e.i(401148),j=e.i(119311),g=e.i(932735),y=e.i(572826),f=e.i(971743);let _=(0,e.i(410587).default)("arrow-down-left",[["path",{d:"M17 7 7 17",key:"15tmo1"}],["path",{d:"M17 17H7V7",key:"1org7z"}]]);var b=e.i(994659),N=e.i(501259),C=e.i(691974),v=e.i(540318),w=e.i(773510),T=e.i(561866),S=e.i(496383),D=e.i(745083),k=e.i(10994),P=e.i(282141),q=e.i(501495),H=e.i(59178),B=e.i(595103),U=e.i(352776),R=e.i(514133),L=e.i(816654),F=e.i(538892),I=e.i(201495);let E={partner:"Partner",introducer:"Introducer","commercial-partner":"Commercial Partner"};function O({open:e,onOpenChange:s,commission:r,commissionType:l,onSuccess:i}){let[d,c]=(0,t.useState)(!1),[o,m]=(0,t.useState)(null),[u,x]=(0,t.useState)(""),[j,g]=(0,t.useState)(""),[y,f]=(0,t.useState)([]),[_,b]=(0,t.useState)(!1);(0,t.useEffect)(()=>{(async()=>{if(!e||!r?.deal_id)return f([]);b(!0);try{let e=(0,H.createClient)(),{data:a,error:t}=await e.from("deal_lawyer_assignments").select("lawyer_id").eq("deal_id",r.deal_id);if(t||!a?.length)return void f([]);let s=a.map(e=>e.lawyer_id),{data:n,error:l}=await e.from("lawyers").select("id, firm_name, display_name").in("id",s);if(l){console.error("[RequestPaymentDialog] Error fetching lawyers:",l),f([]);return}f(n||[])}catch(e){console.error("[RequestPaymentDialog] Unexpected error:",e),f([])}finally{b(!1)}})()},[e,r?.deal_id]),(0,t.useEffect)(()=>{e||(x(""),g(""),m(null))},[e]);let N=async()=>{if(r){c(!0),m(null);try{let e=`/api/arrangers/me/${l}-commissions/${r.id}/request-payment`,a={};u.trim()&&(a.notes=u.trim()),j&&"none"!==j&&(a.lawyer_id=j);let t=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!t.ok){let e=await t.json();throw Error(e.error||"Failed to request payment")}await t.json(),i(),s(!1)}catch(e){console.error("[RequestPaymentDialog] Error:",e),m(e instanceof Error?e.message:"Failed to request payment")}finally{c(!1)}}};if(!r)return null;let C=E[l],v=(0,q.formatCurrency)(r.accrual_amount,r.currency||"USD");return(0,a.jsx)(U.Dialog,{open:e,onOpenChange:s,children:(0,a.jsxs)(U.DialogContent,{className:"max-w-md",children:[(0,a.jsxs)(U.DialogHeader,{children:[(0,a.jsxs)(U.DialogTitle,{className:"flex items-center gap-2",children:[(0,a.jsx)(T.CreditCard,{className:"h-5 w-5"}),"Request Payment"]}),(0,a.jsx)(U.DialogDescription,{children:"Send a payment request to lawyers and CEO for approval."})]}),(0,a.jsxs)("div",{className:"py-4 space-y-4",children:[o&&(0,a.jsxs)("div",{className:"bg-destructive/10 border border-destructive/30 text-destructive text-sm p-3 rounded flex items-start gap-2",children:[(0,a.jsx)(p.AlertCircle,{className:"h-4 w-4 mt-0.5 flex-shrink-0"}),(0,a.jsx)("span",{children:o})]}),(0,a.jsxs)("div",{className:"bg-muted/50 p-4 rounded-lg space-y-2",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsxs)("span",{className:"text-muted-foreground",children:[C,":"]}),(0,a.jsx)("span",{className:"font-medium",children:r.entity_name||"Unknown"})]}),r.deal&&(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:"Deal:"}),(0,a.jsx)("span",{className:"font-medium",children:r.deal.name})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:"Amount:"}),(0,a.jsx)("span",{className:"font-medium text-green-600",children:v})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)(R.Label,{htmlFor:"lawyer",className:"flex items-center gap-2",children:[(0,a.jsx)(I.Scale,{className:"h-4 w-4"}),"Priority Lawyer (Optional)"]}),_?(0,a.jsxs)("div",{className:"flex items-center gap-2 text-sm text-muted-foreground py-2",children:[(0,a.jsx)(h.Loader2,{className:"h-4 w-4 animate-spin"}),"Loading lawyers..."]}):y.length>0?(0,a.jsxs)(F.Select,{value:j,onValueChange:g,children:[(0,a.jsx)(F.SelectTrigger,{id:"lawyer",children:(0,a.jsx)(F.SelectValue,{placeholder:"Select a lawyer (optional)"})}),(0,a.jsxs)(F.SelectContent,{children:[(0,a.jsx)(F.SelectItem,{value:"none",children:"No specific lawyer"}),y.map(e=>(0,a.jsx)(F.SelectItem,{value:e.id,children:e.display_name||e.firm_name},e.id))]})]}):(0,a.jsx)("p",{className:"text-sm text-muted-foreground py-2",children:r.deal_id?"No lawyers assigned to this deal":"No deal associated - CEO will be notified"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(R.Label,{htmlFor:"notes",children:"Notes (Optional)"}),(0,a.jsx)(L.Textarea,{id:"notes",placeholder:"Add any payment instructions or notes...",value:u,onChange:e=>x(e.target.value),rows:3})]}),(0,a.jsxs)("div",{className:"bg-blue-50 dark:bg-blue-950/30 border border-blue-200 dark:border-blue-800 p-3 rounded-lg text-sm",children:[(0,a.jsx)("p",{className:"text-blue-800 dark:text-blue-200",children:(0,a.jsx)("strong",{children:"Who will be notified:"})}),(0,a.jsxs)("ul",{className:"mt-1 text-blue-700 dark:text-blue-300 list-disc list-inside space-y-0.5",children:[y.length>0&&(0,a.jsxs)("li",{children:["Lawyers assigned to this deal (",y.length,")"]}),(0,a.jsx)("li",{children:"CEO / Staff administrators"}),j&&"none"!==j&&(0,a.jsx)("li",{children:"Priority notification to selected lawyer"})]})]})]}),(0,a.jsxs)(U.DialogFooter,{children:[(0,a.jsx)(n.Button,{variant:"outline",onClick:()=>s(!1),disabled:d,children:"Cancel"}),(0,a.jsx)(n.Button,{onClick:N,disabled:d,children:d?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(h.Loader2,{className:"h-4 w-4 mr-2 animate-spin"}),"Sending..."]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(T.CreditCard,{className:"h-4 w-4 mr-2"}),"Request Payment"]})})]})]})})}var A=e.i(531570);let z={accrued:"bg-blue-100 text-blue-800 border-blue-200",invoice_requested:"bg-amber-100 text-amber-800 border-amber-200",invoiced:"bg-purple-100 text-purple-800 border-purple-200",pending:"bg-yellow-100 text-yellow-800 border-yellow-200",paid:"bg-green-100 text-green-800 border-green-200",sent:"bg-purple-100 text-purple-800 border-purple-200",overdue:"bg-red-100 text-red-800 border-red-200",cancelled:"bg-gray-100 text-gray-800 border-gray-200"},M={accrued:"Accrued",invoice_requested:"Invoice Requested",invoiced:"Invoiced",paid:"Paid",cancelled:"Cancelled"},V={partner:(0,a.jsx)(C.Briefcase,{className:"h-3 w-3"}),introducer:(0,a.jsx)(v.Handshake,{className:"h-3 w-3"}),"commercial-partner":(0,a.jsx)(f.Building2,{className:"h-3 w-3"})};function $(){let[e,w]=(0,t.useState)(null),[T,S]=(0,t.useState)([]),[D,U]=(0,t.useState)([]),[R,L]=(0,t.useState)({pendingFees:0,pendingTotal:0,invoicedCount:0,invoicedTotal:0,paidCount:0,paidTotal:0}),[F,I]=(0,t.useState)([]),[E,$]=(0,t.useState)({total_accrued:0,total_invoice_requested:0,total_invoiced:0,total_paid:0,total_owed:0,count:0,by_type:{partner:{count:0,total:0},introducer:{count:0,total:0},commercial_partner:{count:0,total:0}}}),[K,W]=(0,t.useState)(!0),[X,G]=(0,t.useState)(null),[Q,Y]=(0,t.useState)(""),[Z,ee]=(0,t.useState)(new Set),[ea,et]=(0,t.useState)(!1),[es,er]=(0,t.useState)("inbound"),[en,el]=(0,t.useState)("pending"),[ei,ed]=(0,t.useState)("all"),[ec,eo]=(0,t.useState)(!1),[em,eu]=(0,t.useState)(!1),[ex,eh]=(0,t.useState)(!1),[ep,ej]=(0,t.useState)(null),eg=(0,t.useCallback)(async()=>{try{W(!0);let e=(0,H.createClient)(),{data:{user:a}}=await e.auth.getUser();if(!a)return void G("Not authenticated");let{data:t,error:s}=await e.from("arranger_users").select("arranger_id").eq("user_id",a.id).maybeSingle();if(s||!t)return void G("Only arrangers can access this page");let{data:r,error:n}=await e.from("arranger_entities").select("id, legal_name").eq("id",t.arranger_id).single();if(n)throw n;w(r);let[l,i]=await Promise.all([ey(e,t.arranger_id),ef(t.arranger_id)]);S(l.feeEvents),U(l.paymentRequests),L(l.summary),I(i.commissions),$(i.summary),G(null)}catch(e){console.error("[PaymentRequestsPage] Error:",e),G(e instanceof Error?e.message:"Failed to load data")}finally{W(!1)}},[]);async function ey(e,a){let{data:t,error:s}=await e.from("fee_events").select(`
        id,
        deal_id,
        investor_id,
        fee_type,
        computed_amount,
        currency,
        status,
        event_date,
        invoice_id,
        deal:deal_id (id, name),
        investor:investor_id (id, display_name, legal_name)
      `).eq("payee_arranger_id",a).order("event_date",{ascending:!1});if(s)throw s;let r=(t||[]).map(e=>({id:e.id,deal_id:e.deal_id,deal_name:e.deal?.name||"Unknown Deal",investor_name:e.investor?.display_name||e.investor?.legal_name||"Unknown",fee_type:e.fee_type||"fee",computed_amount:Number(e.computed_amount)||0,currency:e.currency||"USD",status:e.status||"accrued",event_date:e.event_date,invoice_id:e.invoice_id})),n=[],l=await fetch("/api/arrangers/me/payment-requests");if(l.ok){let{payment_requests:e}=await l.json();n=(e||[]).map(e=>({id:e.id,invoice_number:e.invoice_number,deal_name:e.deal?.name||"Multiple",investor_name:e.investor?.display_name||e.investor?.legal_name||"Multiple",total:Number(e.total)||0,paid_amount:Number(e.paid_amount)||0,status:e.status,due_date:e.due_date,created_at:e.created_at}))}let i=r.filter(e=>"accrued"===e.status),d=r.filter(e=>"invoiced"===e.status),c=r.filter(e=>"paid"===e.status);return{feeEvents:r,paymentRequests:n,summary:{pendingFees:i.length,pendingTotal:i.reduce((e,a)=>e+a.computed_amount,0),invoicedCount:d.length,invoicedTotal:d.reduce((e,a)=>e+a.computed_amount,0),paidCount:c.length,paidTotal:c.reduce((e,a)=>e+a.computed_amount,0)}}}async function ef(e){let[a,t,s]=await Promise.all([fetch("/api/arrangers/me/partner-commissions"),fetch("/api/arrangers/me/introducer-commissions"),fetch("/api/arrangers/me/commercial-partner-commissions")]),[r,n,l]=await Promise.all([a.ok?a.json():{data:[]},t.ok?t.json():{data:[]},s.ok?s.json():{data:[]}]),i=[];for(let e of r.data||[])i.push({id:e.id,type:"partner",entity_id:e.partner_id||e.partner?.id,entity_name:e.partner?.name||e.partner?.legal_name||"Unknown Partner",entity_type_label:"Partner",deal_id:e.deal_id||e.deal?.id||null,deal_name:e.deal?.name||null,accrual_amount:Number(e.accrual_amount)||0,currency:e.currency||"USD",status:e.status||"accrued",invoice_id:e.invoice_id||null,created_at:e.created_at,payment_due_date:e.payment_due_date||null});for(let e of n.data||[])i.push({id:e.id,type:"introducer",entity_id:e.introducer_id||e.introducer?.id,entity_name:e.introducer?.name||e.introducer?.legal_name||"Unknown Introducer",entity_type_label:"Introducer",deal_id:e.deal_id||e.deal?.id||null,deal_name:e.deal?.name||null,accrual_amount:Number(e.accrual_amount)||0,currency:e.currency||"USD",status:e.status||"accrued",invoice_id:e.invoice_id||null,created_at:e.created_at,payment_due_date:e.payment_due_date||null});for(let e of l.data||[])i.push({id:e.id,type:"commercial-partner",entity_id:e.commercial_partner_id||e.commercial_partner?.id,entity_name:e.commercial_partner?.name||e.commercial_partner?.legal_name||"Unknown Commercial Partner",entity_type_label:"Commercial Partner",deal_id:e.deal_id||e.deal?.id||null,deal_name:e.deal?.name||null,accrual_amount:Number(e.accrual_amount)||0,currency:e.currency||"USD",status:e.status||"accrued",invoice_id:e.invoice_id||null,created_at:e.created_at,payment_due_date:e.payment_due_date||null});i.sort((e,a)=>new Date(a.created_at).getTime()-new Date(e.created_at).getTime());let d=i.filter(e=>"cancelled"!==e.status),c=d.filter(e=>"accrued"===e.status),o=d.filter(e=>"invoice_requested"===e.status),m=d.filter(e=>"invoiced"===e.status),u=d.filter(e=>"paid"===e.status),x=d.filter(e=>"partner"===e.type),h=d.filter(e=>"introducer"===e.type),p=d.filter(e=>"commercial-partner"===e.type);return{commissions:i,summary:{total_accrued:c.reduce((e,a)=>e+a.accrual_amount,0),total_invoice_requested:o.reduce((e,a)=>e+a.accrual_amount,0),total_invoiced:m.reduce((e,a)=>e+a.accrual_amount,0),total_paid:u.reduce((e,a)=>e+a.accrual_amount,0),total_owed:[...c,...o,...m].reduce((e,a)=>e+a.accrual_amount,0),count:d.length,by_type:{partner:{count:x.length,total:x.reduce((e,a)=>e+a.accrual_amount,0)},introducer:{count:h.length,total:h.reduce((e,a)=>e+a.accrual_amount,0)},commercial_partner:{count:p.length,total:p.reduce((e,a)=>e+a.accrual_amount,0)}}}}}(0,t.useEffect)(()=>{eg()},[eg]);let e_=async()=>{if(0!==Z.size){et(!0);try{let e=await fetch("/api/arrangers/me/payment-requests",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({fee_event_ids:Array.from(Z)})});if(!e.ok){let a=await e.json();throw Error(a.error||"Failed to create payment request")}window.location.reload()}catch(e){G(e instanceof Error?e.message:"Failed to submit payment request")}finally{et(!1)}}},eb=e=>{ej(e),eo(!0)},eN=e=>{ej(e),eu(!0)},eC=e=>{ej(e),eh(!0)},ev=()=>{eg()},ew=T.filter(e=>"accrued"===e.status).filter(e=>!Q||e.deal_name.toLowerCase().includes(Q.toLowerCase())||e.investor_name.toLowerCase().includes(Q.toLowerCase())),eT=D.filter(e=>!Q||e.invoice_number.toLowerCase().includes(Q.toLowerCase())||e.deal_name.toLowerCase().includes(Q.toLowerCase())),eS=F.filter(e=>"cancelled"!==e.status).filter(e=>"all"===ei||e.type===ei).filter(e=>{if(!Q)return!0;let a=Q.toLowerCase();return e.entity_name.toLowerCase().includes(a)||e.deal_name?.toLowerCase().includes(a)||e.entity_type_label.toLowerCase().includes(a)}),eD=T.filter(e=>Z.has(e.id)).reduce((e,a)=>e+a.computed_amount,0);return K?(0,a.jsxs)("div",{className:"flex items-center justify-center py-16",children:[(0,a.jsx)(h.Loader2,{className:"h-8 w-8 animate-spin text-muted-foreground"}),(0,a.jsx)("span",{className:"ml-3 text-muted-foreground",children:"Loading payment data..."})]}):X?(0,a.jsxs)("div",{className:"text-center py-16",children:[(0,a.jsx)(p.AlertCircle,{className:"h-12 w-12 text-destructive mx-auto mb-4"}),(0,a.jsx)("h3",{className:"text-lg font-medium text-foreground mb-2",children:"Error"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:X})]}):(0,a.jsxs)("div",{className:"p-6 space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-foreground",children:"Payment Management"}),(0,a.jsx)("p",{className:"text-muted-foreground mt-1",children:e?`Manage fees for ${e.legal_name}`:"Manage your fee collections and payments"})]}),e&&(0,a.jsxs)(r.Badge,{variant:"secondary",className:"flex items-center gap-1",children:[(0,a.jsx)(f.Building2,{className:"h-3 w-3"}),"Arranger"]})]}),(0,a.jsxs)(c.Tabs,{value:es,onValueChange:e=>er(e),className:"space-y-4",children:[(0,a.jsxs)(c.TabsList,{className:"grid w-full max-w-md grid-cols-2",children:[(0,a.jsxs)(c.TabsTrigger,{value:"inbound",className:"flex items-center gap-2",children:[(0,a.jsx)(_,{className:"h-4 w-4"}),"Fees Owed To Me",(0,a.jsx)(r.Badge,{variant:"secondary",className:"ml-1 text-xs",children:(0,q.formatCurrency)(R.pendingTotal+R.invoicedTotal,"USD")})]}),(0,a.jsxs)(c.TabsTrigger,{value:"outbound",className:"flex items-center gap-2",children:[(0,a.jsx)(b.ArrowUpRight,{className:"h-4 w-4"}),"Fees I Owe",(0,a.jsx)(r.Badge,{variant:"secondary",className:"ml-1 text-xs",children:(0,q.formatCurrency)(E.total_owed,"USD")})]})]}),(0,a.jsxs)(c.TabsContent,{value:"inbound",className:"space-y-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,a.jsxs)(s.Card,{children:[(0,a.jsx)(s.CardHeader,{className:"pb-2",children:(0,a.jsxs)(s.CardTitle,{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[(0,a.jsx)(m.Clock,{className:"h-4 w-4"}),"Pending Fees"]})}),(0,a.jsxs)(s.CardContent,{children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-blue-600",children:(0,q.formatCurrency)(R.pendingTotal,"USD")}),(0,a.jsxs)("p",{className:"text-xs text-muted-foreground mt-1",children:[R.pendingFees," event",1!==R.pendingFees?"s":""," awaiting invoice"]})]})]}),(0,a.jsxs)(s.Card,{children:[(0,a.jsx)(s.CardHeader,{className:"pb-2",children:(0,a.jsxs)(s.CardTitle,{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[(0,a.jsx)(j.FileText,{className:"h-4 w-4"}),"Invoiced"]})}),(0,a.jsxs)(s.CardContent,{children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-amber-600",children:(0,q.formatCurrency)(R.invoicedTotal,"USD")}),(0,a.jsxs)("p",{className:"text-xs text-muted-foreground mt-1",children:[R.invoicedCount," event",1!==R.invoicedCount?"s":""," awaiting payment"]})]})]}),(0,a.jsxs)(s.Card,{children:[(0,a.jsx)(s.CardHeader,{className:"pb-2",children:(0,a.jsxs)(s.CardTitle,{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[(0,a.jsx)(u.CheckCircle2,{className:"h-4 w-4"}),"Paid"]})}),(0,a.jsxs)(s.CardContent,{children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-green-600",children:(0,q.formatCurrency)(R.paidTotal,"USD")}),(0,a.jsxs)("p",{className:"text-xs text-muted-foreground mt-1",children:[R.paidCount," event",1!==R.paidCount?"s":""," collected"]})]})]})]}),(0,a.jsx)(s.Card,{children:(0,a.jsx)(s.CardContent,{className:"pt-6",children:(0,a.jsx)("div",{className:"flex flex-col md:flex-row gap-4",children:(0,a.jsx)("div",{className:"flex-1",children:(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(x.Search,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),(0,a.jsx)(l.Input,{placeholder:"Search by deal or investor...",value:Q,onChange:e=>Y(e.target.value),className:"pl-10"})]})})})})}),(0,a.jsxs)(c.Tabs,{value:en,onValueChange:el,className:"space-y-4",children:[(0,a.jsxs)(c.TabsList,{children:[(0,a.jsxs)(c.TabsTrigger,{value:"pending",className:"flex items-center gap-2",children:[(0,a.jsx)(m.Clock,{className:"h-4 w-4"}),"Pending Fees (",R.pendingFees,")"]}),(0,a.jsxs)(c.TabsTrigger,{value:"requests",className:"flex items-center gap-2",children:[(0,a.jsx)(y.Receipt,{className:"h-4 w-4"}),"Payment Requests (",D.length,")"]})]}),(0,a.jsx)(c.TabsContent,{value:"pending",children:(0,a.jsxs)(s.Card,{children:[(0,a.jsx)(s.CardHeader,{children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(s.CardTitle,{children:"Pending Fee Events"}),(0,a.jsx)(s.CardDescription,{children:"Select fee events to create a payment request"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[Z.size>0&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("span",{className:"text-sm text-muted-foreground",children:[Z.size," selected (",(0,q.formatCurrency)(eD,"USD"),")"]}),(0,a.jsx)(n.Button,{variant:"ghost",size:"sm",onClick:()=>{ee(new Set)},children:"Clear"})]}),(0,a.jsx)(n.Button,{variant:"outline",size:"sm",onClick:()=>{ee(new Set(T.filter(e=>"accrued"===e.status).map(e=>e.id)))},children:"Select All"}),(0,a.jsxs)(n.Button,{size:"sm",onClick:e_,disabled:0===Z.size||ea,children:[ea?(0,a.jsx)(h.Loader2,{className:"h-4 w-4 animate-spin mr-1"}):(0,a.jsx)(g.Send,{className:"h-4 w-4 mr-1"}),"Request Payment"]})]})]})}),(0,a.jsx)(s.CardContent,{children:0===ew.length?(0,a.jsxs)("div",{className:"border border-dashed border-muted rounded-lg py-12 flex flex-col items-center justify-center text-center space-y-2",children:[(0,a.jsx)(o.DollarSign,{className:"h-10 w-10 text-muted-foreground"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:Q?"No pending fees match your search":"No pending fee events to invoice"})]}):(0,a.jsx)("div",{className:"rounded-md border",children:(0,a.jsxs)(d.Table,{children:[(0,a.jsx)(d.TableHeader,{children:(0,a.jsxs)(d.TableRow,{children:[(0,a.jsx)(d.TableHead,{className:"w-12"}),(0,a.jsx)(d.TableHead,{children:"Deal"}),(0,a.jsx)(d.TableHead,{children:"Investor"}),(0,a.jsx)(d.TableHead,{children:"Fee Type"}),(0,a.jsx)(d.TableHead,{children:"Amount"}),(0,a.jsx)(d.TableHead,{children:"Date"}),(0,a.jsx)(d.TableHead,{children:"Status"})]})}),(0,a.jsx)(d.TableBody,{children:ew.map(e=>(0,a.jsxs)(d.TableRow,{children:[(0,a.jsx)(d.TableCell,{children:(0,a.jsx)(i.Checkbox,{checked:Z.has(e.id),onCheckedChange:()=>{var a;let t;return a=e.id,void((t=new Set(Z)).has(a)?t.delete(a):t.add(a),ee(t))}})}),(0,a.jsx)(d.TableCell,{className:"font-medium",children:e.deal_name}),(0,a.jsx)(d.TableCell,{children:e.investor_name}),(0,a.jsx)(d.TableCell,{className:"capitalize",children:e.fee_type.replace("_"," ")}),(0,a.jsx)(d.TableCell,{className:"font-medium",children:(0,q.formatCurrency)(e.computed_amount,e.currency)}),(0,a.jsx)(d.TableCell,{children:(0,q.formatDate)(e.event_date)}),(0,a.jsx)(d.TableCell,{children:(0,a.jsx)(r.Badge,{variant:"outline",className:(0,P.cn)("capitalize",z[e.status]),children:e.status})})]},e.id))})]})})})]})}),(0,a.jsx)(c.TabsContent,{value:"requests",children:(0,a.jsxs)(s.Card,{children:[(0,a.jsxs)(s.CardHeader,{children:[(0,a.jsx)(s.CardTitle,{children:"Payment Requests"}),(0,a.jsxs)(s.CardDescription,{children:[eT.length," payment request",1!==eT.length?"s":""," submitted"]})]}),(0,a.jsx)(s.CardContent,{children:0===eT.length?(0,a.jsxs)("div",{className:"border border-dashed border-muted rounded-lg py-12 flex flex-col items-center justify-center text-center space-y-2",children:[(0,a.jsx)(y.Receipt,{className:"h-10 w-10 text-muted-foreground"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:Q?"No payment requests match your search":"No payment requests submitted yet"})]}):(0,a.jsx)("div",{className:"rounded-md border",children:(0,a.jsxs)(d.Table,{children:[(0,a.jsx)(d.TableHeader,{children:(0,a.jsxs)(d.TableRow,{children:[(0,a.jsx)(d.TableHead,{children:"Invoice #"}),(0,a.jsx)(d.TableHead,{children:"Deal"}),(0,a.jsx)(d.TableHead,{children:"Amount"}),(0,a.jsx)(d.TableHead,{children:"Paid"}),(0,a.jsx)(d.TableHead,{children:"Due Date"}),(0,a.jsx)(d.TableHead,{children:"Status"}),(0,a.jsx)(d.TableHead,{children:"Created"})]})}),(0,a.jsx)(d.TableBody,{children:eT.map(e=>(0,a.jsxs)(d.TableRow,{children:[(0,a.jsx)(d.TableCell,{className:"font-mono text-sm",children:e.invoice_number}),(0,a.jsx)(d.TableCell,{className:"font-medium",children:e.deal_name}),(0,a.jsx)(d.TableCell,{className:"font-medium",children:(0,q.formatCurrency)(e.total,"USD")}),(0,a.jsx)(d.TableCell,{children:e.paid_amount>0?(0,a.jsx)("span",{className:"text-green-600",children:(0,q.formatCurrency)(e.paid_amount,"USD")}):(0,a.jsx)("span",{className:"text-muted-foreground",children:"—"})}),(0,a.jsx)(d.TableCell,{children:(0,q.formatDate)(e.due_date)}),(0,a.jsx)(d.TableCell,{children:(0,a.jsx)(r.Badge,{variant:"outline",className:(0,P.cn)("capitalize",z[e.status]),children:e.status})}),(0,a.jsx)(d.TableCell,{children:(0,q.formatDate)(e.created_at)})]},e.id))})]})})})]})})]})]}),(0,a.jsxs)(c.TabsContent,{value:"outbound",className:"space-y-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,a.jsxs)(s.Card,{className:"bg-gradient-to-br from-orange-50 to-amber-50 dark:from-orange-950/30 dark:to-amber-950/30 border-orange-200 dark:border-orange-800",children:[(0,a.jsx)(s.CardHeader,{className:"pb-2",children:(0,a.jsxs)(s.CardTitle,{className:"text-sm font-medium text-orange-700 dark:text-orange-300 flex items-center gap-2",children:[(0,a.jsx)(k.Wallet,{className:"h-4 w-4"}),"Total Owed"]})}),(0,a.jsxs)(s.CardContent,{children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-orange-600 dark:text-orange-400",children:(0,q.formatCurrency)(E.total_owed,"USD")}),(0,a.jsx)("p",{className:"text-xs text-orange-600/70 dark:text-orange-400/70 mt-1",children:"To partners, introducers & CPs"})]})]}),(0,a.jsxs)(s.Card,{children:[(0,a.jsx)(s.CardHeader,{className:"pb-2",children:(0,a.jsxs)(s.CardTitle,{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[(0,a.jsx)(C.Briefcase,{className:"h-4 w-4"}),"Partners"]})}),(0,a.jsxs)(s.CardContent,{children:[(0,a.jsx)("div",{className:"text-xl font-bold text-foreground",children:(0,q.formatCurrency)(E.by_type.partner.total,"USD")}),(0,a.jsxs)("p",{className:"text-xs text-muted-foreground mt-1",children:[E.by_type.partner.count," commission",1!==E.by_type.partner.count?"s":""]})]})]}),(0,a.jsxs)(s.Card,{children:[(0,a.jsx)(s.CardHeader,{className:"pb-2",children:(0,a.jsxs)(s.CardTitle,{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[(0,a.jsx)(v.Handshake,{className:"h-4 w-4"}),"Introducers"]})}),(0,a.jsxs)(s.CardContent,{children:[(0,a.jsx)("div",{className:"text-xl font-bold text-foreground",children:(0,q.formatCurrency)(E.by_type.introducer.total,"USD")}),(0,a.jsxs)("p",{className:"text-xs text-muted-foreground mt-1",children:[E.by_type.introducer.count," commission",1!==E.by_type.introducer.count?"s":""]})]})]}),(0,a.jsxs)(s.Card,{children:[(0,a.jsx)(s.CardHeader,{className:"pb-2",children:(0,a.jsxs)(s.CardTitle,{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[(0,a.jsx)(f.Building2,{className:"h-4 w-4"}),"Commercial Partners"]})}),(0,a.jsxs)(s.CardContent,{children:[(0,a.jsx)("div",{className:"text-xl font-bold text-foreground",children:(0,q.formatCurrency)(E.by_type.commercial_partner.total,"USD")}),(0,a.jsxs)("p",{className:"text-xs text-muted-foreground mt-1",children:[E.by_type.commercial_partner.count," commission",1!==E.by_type.commercial_partner.count?"s":""]})]})]})]}),(0,a.jsx)(s.Card,{children:(0,a.jsx)(s.CardContent,{className:"pt-6",children:(0,a.jsxs)("div",{className:"flex flex-col md:flex-row gap-4 items-start md:items-center",children:[(0,a.jsx)("div",{className:"flex-1",children:(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(x.Search,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),(0,a.jsx)(l.Input,{placeholder:"Search by entity, deal, or type...",value:Q,onChange:e=>Y(e.target.value),className:"pl-10"})]})}),(0,a.jsx)(c.Tabs,{value:ei,onValueChange:e=>ed(e),children:(0,a.jsxs)(c.TabsList,{children:[(0,a.jsxs)(c.TabsTrigger,{value:"all",className:"text-xs",children:["All (",E.count,")"]}),(0,a.jsxs)(c.TabsTrigger,{value:"partner",className:"text-xs",children:[(0,a.jsx)(C.Briefcase,{className:"h-3 w-3 mr-1"}),"Partners (",E.by_type.partner.count,")"]}),(0,a.jsxs)(c.TabsTrigger,{value:"introducer",className:"text-xs",children:[(0,a.jsx)(v.Handshake,{className:"h-3 w-3 mr-1"}),"Introducers (",E.by_type.introducer.count,")"]}),(0,a.jsxs)(c.TabsTrigger,{value:"commercial-partner",className:"text-xs",children:[(0,a.jsx)(f.Building2,{className:"h-3 w-3 mr-1"}),"CPs (",E.by_type.commercial_partner.count,")"]})]})})]})})}),(0,a.jsxs)(s.Card,{children:[(0,a.jsxs)(s.CardHeader,{children:[(0,a.jsxs)(s.CardTitle,{className:"flex items-center gap-2",children:[(0,a.jsx)(b.ArrowUpRight,{className:"h-5 w-5 text-orange-500"}),"Commissions To Pay"]}),(0,a.jsxs)(s.CardDescription,{children:[eS.length," commission",1!==eS.length?"s":""," to process"]})]}),(0,a.jsx)(s.CardContent,{children:0===eS.length?(0,a.jsxs)("div",{className:"border border-dashed border-muted rounded-lg py-12 flex flex-col items-center justify-center text-center space-y-2",children:[(0,a.jsx)(N.Users,{className:"h-10 w-10 text-muted-foreground"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:Q?"No commissions match your search":"No commissions to pay"})]}):(0,a.jsx)("div",{className:"rounded-md border",children:(0,a.jsxs)(d.Table,{children:[(0,a.jsx)(d.TableHeader,{children:(0,a.jsxs)(d.TableRow,{children:[(0,a.jsx)(d.TableHead,{className:"w-[120px]",children:"Type"}),(0,a.jsx)(d.TableHead,{children:"Entity"}),(0,a.jsx)(d.TableHead,{children:"Deal"}),(0,a.jsx)(d.TableHead,{className:"text-right",children:"Amount"}),(0,a.jsx)(d.TableHead,{children:"Status"}),(0,a.jsx)(d.TableHead,{children:"Due Date"}),(0,a.jsx)(d.TableHead,{className:"text-right",children:"Actions"})]})}),(0,a.jsx)(d.TableBody,{children:eS.map(e=>(0,a.jsxs)(d.TableRow,{children:[(0,a.jsx)(d.TableCell,{children:(0,a.jsxs)(r.Badge,{variant:"outline",className:"flex items-center gap-1 w-fit",children:[V[e.type],(0,a.jsx)("span",{className:"text-xs",children:e.entity_type_label})]})}),(0,a.jsx)(d.TableCell,{className:"font-medium",children:e.entity_name}),(0,a.jsx)(d.TableCell,{className:"text-muted-foreground",children:e.deal_name||"—"}),(0,a.jsx)(d.TableCell,{className:"text-right font-medium",children:(0,q.formatCurrency)(e.accrual_amount,e.currency)}),(0,a.jsx)(d.TableCell,{children:(0,a.jsx)(r.Badge,{variant:"outline",className:(0,P.cn)(z[e.status]),children:M[e.status]||e.status})}),(0,a.jsx)(d.TableCell,{children:e.payment_due_date?(0,q.formatDate)(e.payment_due_date):(0,a.jsx)("span",{className:"text-muted-foreground",children:"—"})}),(0,a.jsx)(d.TableCell,{className:"text-right",children:(0,a.jsx)(J,{commission:e,onRequestInvoice:eb,onRequestPayment:eN,onViewInvoice:eC})})]},`${e.type}-${e.id}`))})]})})})]})]})]}),(0,a.jsx)(B.RequestInvoiceDialog,{open:ec,onOpenChange:eo,commission:ep?{id:ep.id,accrual_amount:ep.accrual_amount,currency:ep.currency,entity_name:ep.entity_name,deal:ep.deal_name?{name:ep.deal_name}:void 0}:null,commissionType:ep?.type||"partner",onSuccess:ev}),(0,a.jsx)(O,{open:em,onOpenChange:eu,commission:ep?{id:ep.id,accrual_amount:ep.accrual_amount,currency:ep.currency,entity_name:ep.entity_name,deal_id:ep.deal_id||void 0,deal:ep.deal_name?{id:ep.deal_id||"",name:ep.deal_name}:void 0}:null,commissionType:ep?.type||"partner",onSuccess:ev}),(0,a.jsx)(A.ViewInvoiceDialog,{open:ex,onOpenChange:eh,commission:ep?{id:ep.id,accrual_amount:ep.accrual_amount,currency:ep.currency,entity_name:ep.entity_name,invoice_id:ep.invoice_id,deal:ep.deal_name?{name:ep.deal_name}:void 0}:null,commissionType:ep?.type||"partner"})]})}function J({commission:e,onRequestInvoice:t,onRequestPayment:s,onViewInvoice:l}){switch(e.status){case"accrued":return(0,a.jsxs)(n.Button,{size:"sm",variant:"outline",onClick:()=>t(e),className:"gap-1",children:[(0,a.jsx)(w.Mail,{className:"h-3.5 w-3.5"}),"Request Invoice"]});case"invoice_requested":return(0,a.jsxs)(r.Badge,{variant:"outline",className:"bg-amber-50 text-amber-700 border-amber-200",children:[(0,a.jsx)(m.Clock,{className:"h-3 w-3 mr-1"}),"Awaiting Invoice"]});case"invoiced":return(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[e.invoice_id&&(0,a.jsxs)(n.Button,{size:"sm",variant:"ghost",onClick:()=>l(e),className:"gap-1",children:[(0,a.jsx)(S.Eye,{className:"h-3.5 w-3.5"}),"View"]}),(0,a.jsxs)(n.Button,{size:"sm",onClick:()=>s(e),className:"gap-1",children:[(0,a.jsx)(T.CreditCard,{className:"h-3.5 w-3.5"}),"Request Payment"]})]});case"paid":return(0,a.jsxs)(r.Badge,{variant:"outline",className:"bg-green-50 text-green-700 border-green-200",children:[(0,a.jsx)(u.CheckCircle2,{className:"h-3 w-3 mr-1"}),"Paid"]});case"cancelled":return(0,a.jsxs)(r.Badge,{variant:"outline",className:"bg-gray-50 text-gray-500 border-gray-200",children:[(0,a.jsx)(D.XCircle,{className:"h-3 w-3 mr-1"}),"Cancelled"]});default:return null}}e.s(["default",()=>$],81484)}]);