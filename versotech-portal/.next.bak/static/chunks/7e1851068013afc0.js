(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,377381,e=>{"use strict";var t=e.i(722679),s=e.i(691646),a=e.i(996220);function r({dashboardData:e,realtimeMetrics:r}){return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsx)(a.RealtimeStaffDashboard,{initialData:r}),(0,t.jsx)(s.EnhancedStaffDashboard,{initialData:e})]})}e.s(["CEODashboard",()=>r])},690310,e=>{"use strict";var t=e.i(722679),s=e.i(340915),a=e.i(550418),r=e.i(560044),i=e.i(59178),n=e.i(90613),l=e.i(129432),d=e.i(820417),c=e.i(337684),o=e.i(55431),m=e.i(658088),x=e.i(641179),h=e.i(316264),g=e.i(661521),u=e.i(56213),p=e.i(282141),f=e.i(994659),j=e.i(971743),y=e.i(985385),b=e.i(119311),N=e.i(654588),v=e.i(871561),w=e.i(417439),_=e.i(416200),C=e.i(704477);function $(){let{theme:e}=(0,r.useTheme)();return(0,t.jsxs)("div",{className:"space-y-8 animate-pulse",children:[(0,t.jsx)("div",{className:(0,p.cn)("rounded-3xl border p-8","staff-dark"===e?"border-white/10 bg-white/5":"border-slate-200/80 bg-white"),children:(0,t.jsxs)("div",{className:"grid gap-6 md:gap-8 md:grid-cols-[1.9fr,1fr]",children:[(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsx)(u.Skeleton,{className:"h-16 w-16 rounded-full"}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(u.Skeleton,{className:"h-4 w-24"}),(0,t.jsx)(u.Skeleton,{className:"h-8 w-48"}),(0,t.jsx)(u.Skeleton,{className:"h-4 w-64"})]})]}),(0,t.jsx)("div",{className:"grid gap-3 md:gap-4 grid-cols-1 sm:grid-cols-2 md:grid-cols-3",children:[1,2,3].map(e=>(0,t.jsx)(u.Skeleton,{className:"h-24 rounded-2xl"},e))})]}),(0,t.jsx)(u.Skeleton,{className:"h-48 rounded-2xl"})]})}),(0,t.jsx)("div",{className:"grid gap-6 md:grid-cols-3",children:[1,2,3].map(e=>(0,t.jsx)(u.Skeleton,{className:"h-64 rounded-2xl"},e))})]})}function S({vehicles:e}){let{theme:s}=(0,r.useTheme)(),a="staff-dark"===s,i=e.slice(0,4);return(0,t.jsxs)(n.Card,{className:(0,p.cn)("h-full overflow-hidden rounded-2xl border shadow-sm",a?"border-white/10 bg-card":"border-slate-200/80"),children:[(0,t.jsxs)(n.CardHeader,{className:"space-y-1.5 border-b p-6",children:[(0,t.jsx)(n.CardTitle,{className:(0,p.cn)("text-base font-semibold",a?"text-white":"text-slate-900"),children:"Portfolio snapshot"}),(0,t.jsx)(n.CardDescription,{className:(0,p.cn)("text-sm",a?"text-gray-400":"text-slate-600"),children:"At-a-glance view of the vehicles you're currently allocated to."})]}),(0,t.jsx)(n.CardContent,{className:"space-y-4 p-6",children:0===i.length?(0,t.jsx)("div",{className:(0,p.cn)("rounded-xl border border-dashed p-6 text-center text-sm",a?"border-white/10 bg-white/5 text-gray-400":"border-slate-200/80 bg-slate-50/80 text-slate-500"),children:"No active holdings yet. Allocations will appear here once your onboarding is complete."}):(0,t.jsx)("div",{className:"space-y-3",children:i.map(e=>{let s,r;return(0,t.jsxs)(d.default,{href:`/versotech_main/opportunities?vehicle=${e.id}`,className:(0,p.cn)("flex items-center justify-between gap-4 rounded-xl border p-4 transition-all hover:border-primary/40 hover:bg-primary/5",a?"border-white/10 bg-white/5":"border-slate-200/80 bg-white/90"),children:[(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsx)("p",{className:(0,p.cn)("text-sm font-semibold",a?"text-white":"text-slate-900"),children:e.name}),(0,t.jsx)("p",{className:(0,p.cn)("text-xs",a?"text-gray-400":"text-slate-500"),children:(s=e.type?e.type.replace(/_/g," "):"Vehicle",r=e.domicile||e.currency||"Global",`${s} • ${r}`)})]}),(0,t.jsx)(f.ArrowUpRight,{className:"h-4 w-4 text-primary"})]},e.id)})})}),(0,t.jsxs)(n.CardFooter,{className:"flex flex-wrap items-center justify-between gap-3 border-t p-6",children:[(0,t.jsxs)(l.Badge,{variant:"outline",className:(0,p.cn)("rounded-full",a?"border-white/10 bg-white/5 text-gray-300":"border-slate-200/80 bg-slate-50 text-slate-600"),children:[e.length," vehicle",1===e.length?"":"s"," tracked"]}),(0,t.jsx)(d.default,{href:"/versotech_main/opportunities",children:(0,t.jsxs)(h.Button,{variant:"outline",size:"sm",children:["Open holdings workspace",(0,t.jsx)(f.ArrowUpRight,{className:"ml-2 h-4 w-4"})]})})]})]})}function A(){let{theme:e}=(0,r.useTheme)(),s="staff-dark"===e;return(0,t.jsxs)(n.Card,{className:(0,p.cn)("h-full overflow-hidden rounded-2xl border shadow-sm",s?"border-white/10 bg-card":"border-slate-200/80"),children:[(0,t.jsxs)(n.CardHeader,{className:"space-y-1.5 border-b p-6",children:[(0,t.jsx)(n.CardTitle,{className:(0,p.cn)("text-base font-semibold",s?"text-white":"text-slate-900"),children:"VERSO concierge"}),(0,t.jsx)(n.CardDescription,{className:(0,p.cn)("text-sm",s?"text-gray-400":"text-slate-600"),children:"Direct access to deal rooms, bespoke reporting, and support."})]}),(0,t.jsxs)(n.CardContent,{className:"space-y-3 p-6",children:[(0,t.jsx)(d.default,{href:"/versotech_main/opportunities",children:(0,t.jsxs)(h.Button,{className:(0,p.cn)("w-full justify-start rounded-xl border hover:border-primary/40 hover:bg-primary/5",s?"border-white/10 bg-white/5 text-gray-200":"border-slate-200/80 bg-white/80 text-slate-700"),variant:"outline",children:[(0,t.jsx)(N.Layers,{className:"mr-2 h-4 w-4"}),"Concluder™ Deal Room"]})}),(0,t.jsx)(d.default,{href:"/versotech_main/opportunities",children:(0,t.jsxs)(h.Button,{className:(0,p.cn)("w-full justify-start rounded-xl border hover:border-primary/40 hover:bg-primary/5",s?"border-white/10 bg-white/5 text-gray-200":"border-slate-200/80 bg-white/80 text-slate-700"),variant:"outline",children:[(0,t.jsx)(_.Target,{className:"mr-2 h-4 w-4"}),"Off-market opportunities"]})}),(0,t.jsx)(d.default,{href:"/versotech_main/documents",children:(0,t.jsxs)(h.Button,{className:(0,p.cn)("w-full justify-start rounded-xl border hover:border-primary/40 hover:bg-primary/5",s?"border-white/10 bg-white/5 text-gray-200":"border-slate-200/80 bg-white/80 text-slate-700"),variant:"outline",children:[(0,t.jsx)(b.FileText,{className:"mr-2 h-4 w-4"}),"Request position statement"]})}),(0,t.jsx)(d.default,{href:"/versotech_main/inbox",children:(0,t.jsxs)(h.Button,{className:(0,p.cn)("w-full justify-start rounded-xl border hover:border-primary/40 hover:bg-primary/5",s?"border-white/10 bg-white/5 text-gray-200":"border-slate-200/80 bg-white/80 text-slate-700"),variant:"outline",children:[(0,t.jsx)(w.MessageSquare,{className:"mr-2 h-4 w-4"}),"Custom analytics request"]})})]})]})}function k(){let{theme:e}=(0,r.useTheme)(),s="staff-dark"===e,a=[{id:"fund",title:"VERSO FUND",description:"BVI professional mutual fund access",icon:(0,t.jsx)(j.Building2,{className:"h-6 w-6"})},{id:"real-estate",title:"REAL Empire",description:"Institutional real estate securitisation",icon:(0,t.jsx)(_.Target,{className:"h-6 w-6"})},{id:"lux",title:"Luxembourg Platforms",description:"European investment infrastructure",icon:(0,t.jsx)(v.MapPin,{className:"h-6 w-6"})}];return(0,t.jsx)("section",{className:(0,p.cn)("rounded-3xl border px-8 py-10 shadow-sm",s?"border-white/10 bg-card":"border-slate-200/80 bg-white"),children:(0,t.jsxs)("div",{className:"mx-auto flex max-w-4xl flex-col gap-8",children:[(0,t.jsxs)("div",{className:"flex flex-col items-center gap-6 text-center sm:flex-row sm:items-start sm:text-left",children:[(0,t.jsx)("div",{className:(0,p.cn)("flex h-16 w-16 items-center justify-center rounded-2xl shadow-sm",s?"bg-white/10 text-white":"bg-slate-900 text-white"),children:(0,t.jsx)(j.Building2,{className:"h-7 w-7"})}),(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsx)("p",{className:(0,p.cn)("text-[11px] font-semibold uppercase tracking-wider",s?"text-gray-400":"text-slate-500"),children:"Investor onboarding"}),(0,t.jsx)("h2",{className:(0,p.cn)("text-3xl font-semibold",s?"text-white":"text-slate-900"),children:"Welcome to VERSO Holdings"}),(0,t.jsx)("p",{className:(0,p.cn)("text-sm",s?"text-gray-400":"text-slate-600"),children:"Complete your onboarding steps to unlock performance analytics, live deal access, and bespoke reporting matched to your mandate."})]})]}),(0,t.jsx)("div",{className:"grid gap-4 sm:grid-cols-3",children:a.map(e=>(0,t.jsxs)(n.Card,{className:(0,p.cn)("rounded-2xl border p-6 text-left shadow-sm",s?"border-white/10 bg-white/5":"border-slate-200/80 bg-slate-50/60"),children:[(0,t.jsx)("div",{className:(0,p.cn)("flex h-12 w-12 items-center justify-center rounded-xl shadow-sm",s?"bg-white/10 text-white":"bg-white text-slate-900"),children:e.icon}),(0,t.jsx)("h3",{className:(0,p.cn)("mt-4 text-sm font-semibold",s?"text-white":"text-slate-900"),children:e.title}),(0,t.jsx)("p",{className:(0,p.cn)("mt-1 text-xs",s?"text-gray-400":"text-slate-600"),children:e.description})]},e.id))}),(0,t.jsxs)("div",{className:"flex flex-col items-center gap-3 sm:flex-row sm:justify-end",children:[(0,t.jsx)(d.default,{href:"/versotech_main/tasks",className:"w-full sm:w-auto",children:(0,t.jsx)(h.Button,{size:"lg",className:"w-full sm:w-auto",children:"Complete onboarding"})}),(0,t.jsx)(d.default,{href:"/versotech_main/inbox",className:"w-full sm:w-auto",children:(0,t.jsx)(h.Button,{variant:"outline",size:"lg",className:"w-full sm:w-auto",children:"Contact VERSO team"})})]})]})})}function D({investorId:e,userId:a,persona:n}){let{theme:u}=(0,r.useTheme)(),b="staff-dark"===u,[N,w]=(0,s.useState)(null),[D,T]=(0,s.useState)(!0),[E,B]=(0,s.useState)(null),[I,P]=(0,s.useState)(!1);(0,s.useEffect)(()=>{N?.profile&&!N.profile.hasSeenIntroVideo&&P(!0)},[N?.profile]);let R=async()=>{try{if(!(await fetch("/api/profiles/intro-video-seen",{method:"POST",headers:{"Content-Type":"application/json"}})).ok)throw Error("Failed to mark video as seen");N?.profile&&w({...N,profile:{...N.profile,hasSeenIntroVideo:!0}})}finally{P(!1)}};if((0,s.useEffect)(()=>{async function t(){T(!0),B(null);try{let t=(0,i.createClient)(),s=[e],[r,n,l,d,c,o]=await Promise.all([t.from("profiles").select("display_name, avatar_url, has_seen_intro_video").eq("id",a).single(),t.from("vehicles").select(`
              id,
              name,
              type,
              domicile,
              currency,
              subscriptions!inner(investor_id, status)
            `).in("subscriptions.investor_id",s).eq("subscriptions.status","active"),t.from("deals").select(`
              id,
              name,
              status,
              deal_type,
              currency,
              offer_unit_price,
              open_at,
              close_at,
              company_name,
              company_logo_url,
              sector,
              location,
              vehicles ( id, name, type ),
              deal_memberships!inner ( user_id ),
              deal_fee_structures ( id, price_per_share_text, allocation_up_to, minimum_ticket, status, effective_at )
            `).eq("deal_memberships.user_id",a).eq("status","open").order("close_at",{ascending:!0,nullsFirst:!1}).limit(3),t.from("tasks").select("id, title, status, priority, due_at, category",{count:"exact"}).not("status","eq","completed").not("status","eq","waived").or(`owner_user_id.eq.${a},owner_investor_id.in.(${s.join(",")})`).order("due_at",{ascending:!0,nullsFirst:!1}).limit(12),t.from("deal_activity_events").select(`
              id,
              event_type,
              payload,
              occurred_at,
              deal_id,
              deals:deal_id(name)
            `).in("investor_id",s).order("occurred_at",{ascending:!1}).limit(10),t.from("positions").select("id").in("investor_id",s).limit(1)]),m={im_interested:{title:"Expressed Interest",activity_type:"deal"},nda_completed:{title:"NDA Signed",activity_type:"document"},data_room_submit:{title:"Allocation Submitted",activity_type:"allocation"},subscription_completed:{title:"Subscription Completed",activity_type:"deal"},data_room_granted:{title:"Data Room Access",activity_type:"document"},closed_deal_interest:{title:"Interest Registered",activity_type:"deal"}},x=(c.data??[]).map(e=>{let t=m[e.event_type]||{title:e.event_type,activity_type:"deal"},s=e.deals?.name||"Deal",a=e.payload?.commitment||e.payload?.indicative_amount;return{id:e.id,title:t.title,description:a?`${s} - $${a.toLocaleString()}`:s,activity_type:t.activity_type,created_at:e.occurred_at,importance:"normal",read_status:null}}),h={high:0,medium:1,low:2},g=(d.data??[]).sort((e,t)=>{let s=h[e.priority]??99,a=h[t.priority]??99;return s!==a?s-a:e.due_at||t.due_at?e.due_at?t.due_at?new Date(e.due_at).getTime()-new Date(t.due_at).getTime():-1:1:0}),u=(l.data??[]).map(e=>{let t=(e.deal_fee_structures??[]).filter(e=>"published"===e.status).sort((e,t)=>{let s=e.effective_at?new Date(e.effective_at).getTime():0;return(t.effective_at?new Date(t.effective_at).getTime():0)-s})[0]??null;return{...e,fee_structure:t?{id:t.id,price_per_share_text:t.price_per_share_text,allocation_up_to:t.allocation_up_to,minimum_ticket:t.minimum_ticket}:null,deal_fee_structures:void 0}});w({profile:r.data?{displayName:r.data.display_name,avatarUrl:r.data.avatar_url,hasSeenIntroVideo:r.data.has_seen_intro_video??!0}:null,vehicles:n.data??[],featuredDeals:u,tasks:g,tasksTotal:d.count??g.length,recentActivity:x,hasPortfolioData:(o.data?.length??0)>0||(n.data?.length??0)>0})}catch(e){console.error("[InvestorDashboard] Error fetching data:",e),B("Failed to load dashboard data")}finally{T(!1)}}e&&a&&t()},[e,a]),D)return(0,t.jsx)($,{});if(E||!N)return(0,t.jsxs)("div",{className:"p-8 text-center",children:[(0,t.jsx)("p",{className:"text-red-500",children:E||"Unable to load dashboard"}),(0,t.jsx)(h.Button,{variant:"outline",className:"mt-4",onClick:()=>window.location.reload(),children:"Retry"})]});let F=n?.entity_name||N.profile?.displayName||"Investor",H=(F||"Investor").split(" ")[0]||"Investor",z=[{label:"Open opportunities",value:N.featuredDeals.length,helper:"Available deals"},{label:"Outstanding tasks",value:N.tasksTotal,helper:N.tasksTotal?"Pending actions":"All caught up"},{label:"Active holdings",value:N.vehicles.length,helper:"Investment vehicles"}];return(0,t.jsxs)("div",{className:"space-y-12 px-0 pb-16 pt-2",children:[(0,t.jsx)(x.VideoIntroModal,{open:I,videoUrl:"https://ipguxdssecfexudnvtia.supabase.co/storage/v1/object/public/public-assets/videos/intro-video.mp4",onComplete:R}),(0,t.jsx)("section",{className:(0,p.cn)("rounded-3xl border p-4 sm:p-6 md:p-8 shadow-sm",b?"border-white/10 bg-card":"border-slate-200/80 bg-white"),children:(0,t.jsxs)("div",{className:"grid gap-6 md:gap-8 md:grid-cols-[1.9fr,1fr]",children:[(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsx)("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsx)("div",{className:(0,p.cn)("flex h-16 w-16 items-center justify-center rounded-full border shadow-sm overflow-hidden",b?"bg-gradient-to-br from-white/10 to-white/5 border-white/10":"bg-gradient-to-br from-slate-100 to-slate-200 border-slate-200"),children:N.profile?.avatarUrl?(0,t.jsx)(c.default,{src:N.profile.avatarUrl,alt:F,width:64,height:64,className:"object-cover w-full h-full",priority:!0}):n.entity_logo_url?(0,t.jsx)(c.default,{src:n.entity_logo_url,alt:F,width:64,height:64,className:"object-cover w-full h-full",priority:!0}):(0,t.jsx)(C.User,{className:(0,p.cn)("h-8 w-8",b?"text-gray-400":"text-slate-400")})}),(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsx)("p",{className:(0,p.cn)("text-[11px] font-semibold uppercase tracking-wide",b?"text-gray-400":"text-slate-500"),children:"Investor portal"}),(0,t.jsxs)("h1",{className:(0,p.cn)("text-3xl font-semibold",b?"text-white":"text-slate-900"),children:["Welcome, ",H]}),(0,t.jsx)("p",{className:(0,p.cn)("text-sm",b?"text-gray-400":"text-slate-600"),children:"VERSO Holdings • Merchant Banking Group • Since 1958"})]})]})}),(0,t.jsx)("div",{className:"grid gap-3 md:gap-4 grid-cols-1 sm:grid-cols-2 md:grid-cols-3",children:z.map(e=>(0,t.jsxs)("div",{className:(0,p.cn)("rounded-2xl border p-4 shadow-sm",b?"border-white/10 bg-white/5":"border-slate-200/80 bg-slate-50/70"),children:[(0,t.jsx)("p",{className:(0,p.cn)("text-[11px] font-semibold uppercase tracking-wide",b?"text-gray-400":"text-slate-500"),children:e.label}),(0,t.jsx)("p",{className:(0,p.cn)("mt-2 text-2xl font-semibold",b?"text-white":"text-slate-900"),children:e.value}),(0,t.jsx)("p",{className:(0,p.cn)("mt-1 text-xs",b?"text-gray-400":"text-slate-600"),children:e.helper})]},e.label))}),(0,t.jsxs)("div",{className:(0,p.cn)("flex flex-wrap items-center gap-2 text-xs font-medium",b?"text-gray-400":"text-slate-600"),children:[(0,t.jsxs)(l.Badge,{variant:"outline",className:(0,p.cn)("rounded-full",b?"border-white/10 bg-white/5 text-gray-300":"border-slate-200/80 bg-slate-50 text-slate-600"),children:[(0,t.jsx)(v.MapPin,{className:"mr-1 h-3 w-3"})," Luxembourg HQ"]}),(0,t.jsxs)(l.Badge,{variant:"outline",className:(0,p.cn)("rounded-full",b?"border-white/10 bg-white/5 text-gray-300":"border-slate-200/80 bg-slate-50 text-slate-600"),children:[(0,t.jsx)(j.Building2,{className:"mr-1 h-3 w-3"})," BVI Professional Fund"]}),(0,t.jsxs)(l.Badge,{variant:"outline",className:(0,p.cn)("rounded-full",b?"border-white/10 bg-white/5 text-gray-300":"border-slate-200/80 bg-slate-50 text-slate-600"),children:[(0,t.jsx)(_.Target,{className:"mr-1 h-3 w-3"})," PE • VC • Real Estate"]})]}),(0,t.jsxs)("div",{className:"flex flex-col gap-3 pt-2 sm:flex-row",children:[(0,t.jsx)(d.default,{href:"/versotech_main/opportunities",className:"w-full sm:w-auto",children:(0,t.jsxs)(h.Button,{size:"sm",className:"w-full sm:w-auto",children:["View holdings",(0,t.jsx)(f.ArrowUpRight,{className:"ml-2 h-4 w-4"})]})}),(0,t.jsx)(d.default,{href:"/versotech_main/tasks",className:"w-full sm:w-auto",children:(0,t.jsxs)(h.Button,{size:"sm",variant:"outline",className:"w-full sm:w-auto",children:["Calendar & deadlines",(0,t.jsx)(y.CalendarClock,{className:"ml-2 h-4 w-4"})]})})]})]}),(0,t.jsxs)("div",{className:(0,p.cn)("rounded-2xl border p-6 shadow-sm",b?"border-white/10 bg-white/5":"border-slate-200/80 bg-slate-50/70"),children:[(0,t.jsx)("p",{className:(0,p.cn)("text-[11px] font-semibold uppercase tracking-wide",b?"text-gray-400":"text-slate-500"),children:"Portal snapshot"}),(0,t.jsx)("p",{className:(0,p.cn)("mt-3 text-2xl font-semibold",b?"text-white":"text-slate-900"),children:new Date().toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}),(0,t.jsx)(g.Separator,{className:"my-4"}),(0,t.jsx)("p",{className:(0,p.cn)("text-sm",b?"text-gray-400":"text-slate-600"),children:"Your investment dashboard with key metrics and upcoming deadlines."}),(0,t.jsxs)(d.default,{href:"/versotech_main/tasks",className:"mt-4 inline-flex items-center gap-2 text-xs font-semibold text-primary hover:underline",children:["Review action centre",(0,t.jsx)(f.ArrowUpRight,{className:"h-3 w-3"})]})]})]})}),(0,t.jsx)(m.FeaturedDealsSection,{deals:N.featuredDeals}),(0,t.jsx)(o.InvestorActionCenter,{tasks:N.tasks,tasksTotal:N.tasksTotal,recentActivity:N.recentActivity}),N.hasPortfolioData?(0,t.jsxs)("div",{className:"grid gap-4 lg:grid-cols-2",children:[(0,t.jsx)(S,{vehicles:N.vehicles}),(0,t.jsx)(A,{})]}):(0,t.jsx)(k,{}),N.hasPortfolioData&&(0,t.jsx)(A,{})]})}var T=e.i(83245),E=e.i(335994),B=e.i(501259),I=e.i(196767),P=e.i(711819),R=e.i(733179),F=e.i(868428),H=e.i(645855),z=e.i(15098),U=e.i(619324),V=e.i(30100),M=e.i(263229),O=e.i(896816),q=e.i(235717),Y=e.i(10994),L=e.i(432598),G=e.i(501495),W=e.i(137533);function K({introducerId:e,userId:a,persona:c}){let{theme:o}=(0,r.useTheme)(),m="staff-dark"===o,[x,g]=(0,s.useState)(!0),[u,p]=(0,s.useState)(null),[f,j]=(0,s.useState)(null),[y,b]=(0,s.useState)(null),[N,v]=(0,s.useState)(null),[w,C]=(0,s.useState)([]),[$,S]=(0,s.useState)(void 0);if((0,s.useEffect)(()=>{!async function(){try{let t=(0,i.createClient)(),{data:s}=await t.from("introductions").select("id, status, prospect_email, introduced_at, deal:deal_id(id, name)").eq("introducer_id",e).order("introduced_at",{ascending:!1}),a=s||[],r=a.filter(e=>{if(!$?.from)return!0;if(!e.introduced_at)return!1;let t=new Date(e.introduced_at),s=new Date($.from);if(s.setHours(0,0,0,0),t<s)return!1;if($.to){let e=new Date($.to);if(e.setHours(23,59,59,999),t>e)return!1}return!0}),{data:n}=await t.from("introducer_commissions").select("id, accrual_amount, status, created_at, introduction_id").eq("introducer_id",e),l=(n||[]).filter(e=>{if(!$?.from)return!0;if(!e.created_at)return!1;let t=new Date(e.created_at),s=new Date($.from);if(s.setHours(0,0,0,0),t<s)return!1;if($.to){let e=new Date($.to);if(e.setHours(23,59,59,999),t>e)return!1}return!0}),d=new Set(l.filter(e=>e.introduction_id).map(e=>e.introduction_id)),c=r.map(e=>{var t,s;let a;return{...e,journey_stage:(t=e.status,s=d.has(e.id),a=function(e){switch(e){case"allocated":return"signed";case"joined":return"approved";case"lost":case"inactive":return"passed";default:return"interested"}}(t),"allocated"===t&&s?"funded":a)}}),o=c.filter(e=>"interested"===e.journey_stage).length,m=c.filter(e=>"approved"===e.journey_stage).length,x=c.filter(e=>"signed"===e.journey_stage).length,h=c.filter(e=>"funded"===e.journey_stage).length,g=c.filter(e=>"passed"===e.journey_stage).length,u=l.filter(e=>"paid"===e.status).reduce((e,t)=>e+(t.accrual_amount||0),0),f=l.filter(e=>["accrued","invoice_requested","invoice_submitted","invoiced"].includes(e.status)).reduce((e,t)=>e+(t.accrual_amount||0),0);p({totalIntroductions:r.length,interestedIntroductions:o,approvedIntroductions:m,signedIntroductions:x,fundedIntroductions:h,passedIntroductions:g,totalCommissionEarned:u,pendingCommission:f,conversionRate:r.length>0?h/r.length*100:0});let y=new Date,N=new Date(y.getFullYear(),y.getMonth(),1),w=new Date(y.getFullYear(),y.getMonth()-1,1),_=r.filter(e=>e.introduced_at&&new Date(e.introduced_at)>=N).length,S=a.filter(e=>e.introduced_at&&new Date(e.introduced_at)>=w&&new Date(e.introduced_at)<N).length,A=S>0?Math.round((_-S)/S*100):100*(_>0),k=h>0?Math.round(u/h):0;j({thisMonthIntroductions:_,lastMonthIntroductions:S,introductionGrowth:A,avgCommissionPerIntro:k});let D=c.slice(0,5).map(e=>({id:e.id,prospect_email:e.prospect_email,status:e.journey_stage,introduced_at:e.introduced_at,deal:Array.isArray(e.deal)?e.deal[0]||null:e.deal}));C(D);let{data:T}=await t.from("introducer_agreements").select("id, status, default_commission_bps, effective_date, expiry_date, signed_date").eq("introducer_id",e).order("created_at",{ascending:!1});if(T){let e=T.find(e=>"active"===e.status),t=T.find(e=>["pending_approval","pending_ceo_signature","pending_introducer_signature"].includes(e.status));b(e||null),v(t||null)}}catch(e){console.error("Error fetching introducer data:",e)}finally{g(!1)}}()},[e,$]),x)return(0,t.jsxs)("div",{className:"p-8 text-center flex flex-col items-center gap-3",children:[(0,t.jsx)(M.Loader2,{className:"h-8 w-8 animate-spin text-gray-400"}),(0,t.jsx)("p",{className:"text-gray-500",children:"Loading dashboard..."})]});let A={interested:"bg-blue-500/20 text-blue-400",approved:"bg-purple-500/20 text-purple-400",signed:"bg-amber-500/20 text-amber-400",funded:"bg-green-500/20 text-green-400",passed:"bg-gray-500/20 text-gray-400"};return(0,t.jsxs)("div",{className:"p-6 space-y-6",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:`text-2xl font-bold ${m?"text-white":"text-gray-900"}`,children:"Introducer Dashboard"}),(0,t.jsx)("p",{className:`mt-1 ${m?"text-gray-400":"text-gray-600"}`,children:c.entity_name})]}),c.logo_url&&(0,t.jsx)("img",{src:c.logo_url,alt:c.entity_name,className:"h-12 w-auto object-contain"})]}),N&&(0,t.jsx)(n.Card,{className:`border-amber-500/30 ${m?"bg-amber-500/10":"bg-amber-50"}`,children:(0,t.jsx)(n.CardContent,{className:"py-4",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("div",{className:"p-2 rounded-full bg-amber-500/20",children:(0,t.jsx)(O.PenLine,{className:"h-5 w-5 text-amber-500"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:`font-medium ${m?"text-white":"text-gray-900"}`,children:"pending_approval"===N.status?"Agreement Awaiting Your Approval":"pending_ceo_signature"===N.status||"approved"===N.status?"Agreement Awaiting CEO Signature":"Agreement Awaiting Your Signature"}),(0,t.jsx)("p",{className:`text-sm ${m?"text-gray-400":"text-gray-600"}`,children:"pending_approval"===N.status?"Please review and approve your fee agreement":"pending_ceo_signature"===N.status||"approved"===N.status?"You have approved. Awaiting CEO signature.":"CEO has signed. Please countersign to activate."})]})]}),(0,t.jsx)(h.Button,{asChild:!0,children:(0,t.jsxs)(d.default,{href:`/versotech_main/introducer-agreements/${N.id}`,children:["pending_approval"===N.status?"Review":"pending_ceo_signature"===N.status||"approved"===N.status?"View":"Sign Now",(0,t.jsx)(V.ArrowRight,{className:"h-4 w-4 ml-2"})]})})]})})}),!y&&!N&&(0,t.jsx)(n.Card,{className:`border-red-500/30 ${m?"bg-red-500/10":"bg-red-50"}`,children:(0,t.jsx)(n.CardContent,{className:"py-4",children:(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("div",{className:"p-2 rounded-full bg-red-500/20",children:(0,t.jsx)(U.AlertTriangle,{className:"h-5 w-5 text-red-500"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:`font-medium ${m?"text-white":"text-gray-900"}`,children:"No Active Agreement"}),(0,t.jsx)("p",{className:`text-sm ${m?"text-gray-400":"text-gray-600"}`,children:"You need an active fee agreement to make introductions. Contact your relationship manager."})]})]})})}),(0,t.jsx)(n.Card,{className:m?"bg-white/5 border-white/10":"",children:(0,t.jsxs)(n.CardContent,{className:"py-4",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("p",{className:`text-sm font-medium ${m?"text-gray-400":"text-gray-700"}`,children:"Filter by Date Range:"}),(0,t.jsx)(T.DateRangePicker,{value:$,onChange:S,variant:m?"dark":"default"})]}),$?.from&&(0,t.jsxs)(h.Button,{variant:"ghost",size:"sm",onClick:()=>S(void 0),className:m?"text-gray-400 hover:text-white":"",children:[(0,t.jsx)(L.X,{className:"h-4 w-4 mr-1"}),"Clear Filter"]})]}),$?.from&&(0,t.jsx)("p",{className:"text-xs mt-2 text-gray-500",children:$.to?`Showing data from ${(0,W.format)($.from,"MMM dd, yyyy")} to ${(0,W.format)($.to,"MMM dd, yyyy")}`:`Showing data from ${(0,W.format)($.from,"MMM dd, yyyy")} onwards`}),!$?.from&&(0,t.jsx)("p",{className:"text-xs mt-2 text-gray-500",children:"Showing all-time data"})]})}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,t.jsxs)(n.Card,{className:m?"bg-white/5 border-white/10":"",children:[(0,t.jsxs)(n.CardHeader,{className:"flex flex-row items-center justify-between pb-2",children:[(0,t.jsx)(n.CardTitle,{className:`text-sm font-medium ${m?"text-gray-400":"text-gray-500"}`,children:"Total Introductions"}),(0,t.jsx)(B.Users,{className:`h-4 w-4 ${m?"text-gray-500":"text-gray-400"}`})]}),(0,t.jsxs)(n.CardContent,{children:[(0,t.jsx)("div",{className:`text-2xl font-bold ${m?"text-white":"text-gray-900"}`,children:u?.totalIntroductions||0}),(0,t.jsxs)("p",{className:"text-xs text-gray-500",children:[u?.interestedIntroductions||0," interested"]})]})]}),(0,t.jsxs)(n.Card,{className:m?"bg-white/5 border-white/10":"",children:[(0,t.jsxs)(n.CardHeader,{className:"flex flex-row items-center justify-between pb-2",children:[(0,t.jsx)(n.CardTitle,{className:`text-sm font-medium ${m?"text-gray-400":"text-gray-500"}`,children:"Conversion Rate"}),(0,t.jsx)(R.TrendingUp,{className:`h-4 w-4 ${m?"text-gray-500":"text-gray-400"}`})]}),(0,t.jsxs)(n.CardContent,{children:[(0,t.jsxs)("div",{className:`text-2xl font-bold ${m?"text-white":"text-gray-900"}`,children:[u?.conversionRate.toFixed(1)||0,"%"]}),(0,t.jsxs)("p",{className:"text-xs text-gray-500",children:[u?.fundedIntroductions||0," funded"]})]})]}),(0,t.jsxs)(n.Card,{className:m?"bg-white/5 border-white/10":"",children:[(0,t.jsxs)(n.CardHeader,{className:"flex flex-row items-center justify-between pb-2",children:[(0,t.jsx)(n.CardTitle,{className:`text-sm font-medium ${m?"text-gray-400":"text-gray-500"}`,children:"Commission Earned"}),(0,t.jsx)(I.DollarSign,{className:`h-4 w-4 ${m?"text-gray-500":"text-gray-400"}`})]}),(0,t.jsxs)(n.CardContent,{children:[(0,t.jsx)("div",{className:"text-2xl font-bold text-green-500",children:(0,G.formatCurrency)(u?.totalCommissionEarned||0)}),(0,t.jsx)("p",{className:"text-xs text-gray-500",children:"Total paid to date"})]})]}),(0,t.jsxs)(n.Card,{className:m?"bg-white/5 border-white/10":"",children:[(0,t.jsxs)(n.CardHeader,{className:"flex flex-row items-center justify-between pb-2",children:[(0,t.jsx)(n.CardTitle,{className:`text-sm font-medium ${m?"text-gray-400":"text-gray-500"}`,children:"Pending Commission"}),(0,t.jsx)(H.Clock,{className:`h-4 w-4 ${m?"text-gray-500":"text-gray-400"}`})]}),(0,t.jsxs)(n.CardContent,{children:[(0,t.jsx)("div",{className:"text-2xl font-bold text-amber-500",children:(0,G.formatCurrency)(u?.pendingCommission||0)}),(0,t.jsx)("p",{className:"text-xs text-gray-500",children:"Accrued or awaiting approval"})]})]})]}),f&&(0,t.jsxs)(n.Card,{className:m?"bg-white/5 border-white/10":"",children:[(0,t.jsxs)(n.CardHeader,{children:[(0,t.jsxs)(n.CardTitle,{className:`flex items-center gap-2 ${m?"text-white":""}`,children:[(0,t.jsx)(q.BarChart3,{className:"h-5 w-5"}),"Performance Analytics"]}),(0,t.jsx)(n.CardDescription,{children:"Your introduction performance trends"})]}),(0,t.jsx)(n.CardContent,{children:(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,t.jsxs)("div",{className:`p-4 rounded-lg border ${m?"bg-white/5 border-white/10":"bg-muted/30"}`,children:[(0,t.jsxs)("div",{className:`flex items-center gap-2 text-sm mb-1 ${m?"text-gray-400":"text-muted-foreground"}`,children:[f.introductionGrowth>=0?(0,t.jsx)(R.TrendingUp,{className:"h-4 w-4 text-green-500"}):(0,t.jsx)(F.TrendingDown,{className:"h-4 w-4 text-red-500"}),"This Month"]}),(0,t.jsx)("div",{className:`text-2xl font-bold ${m?"text-white":"text-gray-900"}`,children:f.thisMonthIntroductions}),(0,t.jsxs)("p",{className:`text-xs mt-1 ${m?"text-gray-500":"text-muted-foreground"}`,children:[(0,t.jsxs)("span",{className:f.introductionGrowth>=0?"text-green-500":"text-red-500",children:[f.introductionGrowth>=0?"+":"",f.introductionGrowth,"%"]})," ","vs last month (",f.lastMonthIntroductions,")"]})]}),(0,t.jsxs)("div",{className:`p-4 rounded-lg border ${m?"bg-white/5 border-white/10":"bg-muted/30"}`,children:[(0,t.jsxs)("div",{className:`flex items-center gap-2 text-sm mb-1 ${m?"text-gray-400":"text-muted-foreground"}`,children:[(0,t.jsx)(_.Target,{className:"h-4 w-4"}),"Conversion Rate"]}),(0,t.jsxs)("div",{className:`text-2xl font-bold ${m?"text-white":"text-gray-900"}`,children:[u?.conversionRate.toFixed(1)||0,"%"]}),(0,t.jsxs)("p",{className:`text-xs mt-1 ${m?"text-gray-500":"text-muted-foreground"}`,children:[u?.fundedIntroductions||0," of ",u?.totalIntroductions||0," funded"]})]}),(0,t.jsxs)("div",{className:`p-4 rounded-lg border ${m?"bg-white/5 border-white/10":"bg-muted/30"}`,children:[(0,t.jsxs)("div",{className:`flex items-center gap-2 text-sm mb-1 ${m?"text-gray-400":"text-muted-foreground"}`,children:[(0,t.jsx)(Y.Wallet,{className:"h-4 w-4"}),"Avg Commission"]}),(0,t.jsx)("div",{className:`text-2xl font-bold ${m?"text-white":"text-gray-900"}`,children:(0,G.formatCurrency)(f.avgCommissionPerIntro)}),(0,t.jsx)("p",{className:`text-xs mt-1 ${m?"text-gray-500":"text-muted-foreground"}`,children:"Per successful introduction"})]})]})})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,t.jsxs)(n.Card,{className:m?"bg-white/5 border-white/10":"",children:[(0,t.jsxs)(n.CardHeader,{className:"flex flex-row items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(n.CardTitle,{className:m?"text-white":"",children:"Recent Introductions"}),(0,t.jsx)(n.CardDescription,{children:"Your latest referrals"})]}),(0,t.jsx)(h.Button,{variant:"ghost",size:"sm",asChild:!0,children:(0,t.jsxs)(d.default,{href:"/versotech_main/introductions",children:["View All",(0,t.jsx)(V.ArrowRight,{className:"h-4 w-4 ml-1"})]})})]}),(0,t.jsx)(n.CardContent,{children:0===w.length?(0,t.jsxs)("div",{className:"text-center py-8",children:[(0,t.jsx)(E.UserPlus,{className:`h-10 w-10 mx-auto mb-3 ${m?"text-gray-600":"text-gray-400"}`}),(0,t.jsx)("p",{className:`text-sm ${m?"text-gray-400":"text-gray-500"}`,children:"No introductions yet"})]}):(0,t.jsx)("div",{className:"space-y-3",children:w.map(e=>(0,t.jsxs)("div",{className:`flex items-center justify-between p-3 rounded-lg ${m?"bg-white/5":"bg-gray-50"}`,children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:`font-medium ${m?"text-white":"text-gray-900"}`,children:e.prospect_email}),(0,t.jsx)("p",{className:`text-sm ${m?"text-gray-400":"text-gray-500"}`,children:e.deal?.name||"Unknown Deal"})]}),(0,t.jsx)(l.Badge,{className:A[e.status]||"bg-gray-500/20 text-gray-400",children:e.status})]},e.id))})})]}),(0,t.jsxs)(n.Card,{className:m?"bg-white/5 border-white/10":"",children:[(0,t.jsxs)(n.CardHeader,{children:[(0,t.jsx)(n.CardTitle,{className:m?"text-white":"",children:"Fee Agreement"}),(0,t.jsx)(n.CardDescription,{children:"Your current commission terms"})]}),(0,t.jsx)(n.CardContent,{children:y?(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(z.CheckCircle2,{className:"h-5 w-5 text-green-500"}),(0,t.jsx)("span",{className:`font-medium ${m?"text-white":"text-gray-900"}`,children:"Active Agreement"})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:`text-sm ${m?"text-gray-400":"text-gray-500"}`,children:"Commission Rate"}),(0,t.jsx)("p",{className:`text-lg font-semibold ${m?"text-white":"text-gray-900"}`,children:y.default_commission_bps?`${(y.default_commission_bps/100).toFixed(2)}%`:"N/A"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:`text-sm ${m?"text-gray-400":"text-gray-500"}`,children:"Effective Since"}),(0,t.jsx)("p",{className:`text-lg font-semibold ${m?"text-white":"text-gray-900"}`,children:y.effective_date?(0,G.formatDate)(y.effective_date):"N/A"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:`text-sm ${m?"text-gray-400":"text-gray-500"}`,children:"Expires"}),(0,t.jsx)("p",{className:`text-lg font-semibold ${m?"text-white":"text-gray-900"}`,children:y.expiry_date?(0,G.formatDate)(y.expiry_date):"No Expiry"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:`text-sm ${m?"text-gray-400":"text-gray-500"}`,children:"Signed"}),(0,t.jsx)("p",{className:`text-lg font-semibold ${m?"text-white":"text-gray-900"}`,children:y.signed_date?(0,G.formatDate)(y.signed_date):"N/A"})]})]}),(0,t.jsx)(h.Button,{variant:"outline",size:"sm",asChild:!0,className:"w-full",children:(0,t.jsxs)(d.default,{href:`/versotech_main/introducer-agreements/${y.id}`,children:[(0,t.jsx)(P.FileSignature,{className:"h-4 w-4 mr-2"}),"View Agreement"]})})]}):(0,t.jsxs)("div",{className:"text-center py-8",children:[(0,t.jsx)(P.FileSignature,{className:`h-10 w-10 mx-auto mb-3 ${m?"text-gray-600":"text-gray-400"}`}),(0,t.jsx)("p",{className:`text-sm ${m?"text-gray-400":"text-gray-500"}`,children:"No active agreement"}),(0,t.jsx)("p",{className:`text-xs ${m?"text-gray-500":"text-gray-400"} mt-1`,children:"Contact your relationship manager to set up an agreement"})]})})]})]})]})}var Q=e.i(691974),X=e.i(496383),J=e.i(941844),Z=e.i(734213),ee=e.i(745083),et=e.i(994500);let es={subscription:"Subscription Fee",management:"Management Fee",performance:"Performance Fee",flat:"Flat Fee"},ea=["subscription","management","performance"],er={draft:"Draft",sent:"Pending Approval",pending_signature:"Pending Signature",accepted:"Accepted",rejected:"Rejected"},ei={accepted:"bg-green-500/20 text-green-400 border-green-500/30",rejected:"bg-red-500/20 text-red-400 border-red-500/30",sent:"bg-amber-500/20 text-amber-400 border-amber-500/30",pending_signature:"bg-amber-500/20 text-amber-400 border-amber-500/30",draft:"bg-slate-500/20 text-slate-300 border-slate-500/30"};function en(e){if(!e)return"—";if(null!==e.rate_bps&&void 0!==e.rate_bps){let t=Number(e.rate_bps);if(!Number.isNaN(t))return`${t/100}%`}if(null!==e.flat_amount&&void 0!==e.flat_amount){let t=Number(e.flat_amount);if(!Number.isNaN(t))return(0,G.formatCurrency)(t)}return"—"}function el(){let[e,a]=(0,s.useState)(!0),[r,i]=(0,s.useState)(null),[d,c]=(0,s.useState)([]),[o,m]=(0,s.useState)(null);(0,s.useEffect)(()=>{!async function(){try{a(!0),i(null);let e=await fetch("/api/partners/me/fee-models"),t=await e.json();if(!e.ok)throw Error(t.error||"Failed to load fee models");c(t.fee_models||[])}catch(e){console.error("Error fetching fee models:",e),i(e instanceof Error?e.message:"Failed to load fee models")}finally{a(!1)}}()},[]);let x=async(e,t)=>{let s="reject"===t?prompt("Please provide a rejection reason:"):null;if("reject"!==t||s){m(e);try{var a;let r=await fetch(`/api/fee-plans/${e}/${t}`,{method:"POST",headers:{"Content-Type":"application/json"},body:"reject"===t?JSON.stringify({reason:s}):void 0}),i=await r.json();if(!r.ok)throw Error(i.error||`Failed to ${t} fee model`);a="accept"===t?"accepted":"rejected",c(t=>t.map(t=>t.id===e?{...t,status:a}:t)),et.toast.success("accept"===t?"Fee model approved":"Fee model rejected")}catch(e){console.error(`Error during ${t}:`,e),et.toast.error(e instanceof Error?e.message:`Failed to ${t} fee model`)}finally{m(null)}}};return(0,t.jsxs)(n.Card,{children:[(0,t.jsxs)(n.CardHeader,{children:[(0,t.jsxs)(n.CardTitle,{className:"flex items-center gap-2",children:[(0,t.jsx)(P.FileSignature,{className:"h-5 w-5"}),"Fee Models"]}),(0,t.jsx)(n.CardDescription,{children:"Read-only fee structures that apply to you"})]}),(0,t.jsx)(n.CardContent,{children:e?(0,t.jsxs)("div",{className:"flex items-center justify-center py-8 text-muted-foreground",children:[(0,t.jsx)(M.Loader2,{className:"h-5 w-5 animate-spin mr-2"}),"Loading fee models..."]}):r?(0,t.jsx)("div",{className:"text-sm text-red-500",children:r}):0===d.length?(0,t.jsxs)("div",{className:"text-center py-8 text-muted-foreground",children:[(0,t.jsx)("p",{children:"No fee models assigned"}),(0,t.jsx)("p",{className:"text-sm mt-1",children:"Contact your relationship manager for fee structure details"})]}):(0,t.jsx)("div",{className:"space-y-4",children:d.map(e=>{let s=(e.fee_components||[]).filter(e=>!ea.includes(e.kind)),a=e.status||"draft",r=er[a]||a,i=ei[a]||ei.draft;return(0,t.jsxs)("div",{className:"rounded-lg border p-4",children:[(0,t.jsxs)("div",{className:"flex items-start justify-between gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-medium",children:e.name}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:e.deal?.name?`Deal: ${e.deal.name}`:e.description||"General fee model"})]}),(0,t.jsxs)("div",{className:"flex flex-col items-end gap-2",children:[(0,t.jsx)(l.Badge,{variant:e.is_active?"default":"secondary",children:e.is_active?"Active":"Inactive"}),(0,t.jsx)(l.Badge,{variant:"outline",className:i,children:r})]})]}),(0,t.jsx)("div",{className:"mt-4 grid gap-3 sm:grid-cols-3",children:ea.map(s=>(0,t.jsxs)("div",{className:"rounded-md border px-3 py-2",children:[(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:es[s]}),(0,t.jsx)("p",{className:"text-sm font-medium",children:en(e.fee_components.find(e=>e.kind===s))})]},s))}),s.length>0&&(0,t.jsx)("div",{className:"mt-3 flex flex-wrap gap-2 text-xs text-muted-foreground",children:s.map(e=>(0,t.jsxs)(l.Badge,{variant:"outline",children:[es[e.kind]||e.kind,":"," ",en(e)]},e.id))}),"sent"===a&&(0,t.jsxs)("div",{className:"mt-4 flex flex-wrap gap-2",children:[(0,t.jsx)(h.Button,{size:"sm",onClick:()=>x(e.id,"accept"),disabled:o===e.id,className:"bg-emerald-600 hover:bg-emerald-700",children:o===e.id?(0,t.jsx)(M.Loader2,{className:"h-4 w-4 animate-spin"}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(z.CheckCircle2,{className:"h-4 w-4 mr-2"}),"Approve"]})}),(0,t.jsx)(h.Button,{size:"sm",variant:"destructive",onClick:()=>x(e.id,"reject"),disabled:o===e.id,children:o===e.id?(0,t.jsx)(M.Loader2,{className:"h-4 w-4 animate-spin"}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(ee.XCircle,{className:"h-4 w-4 mr-2"}),"Reject"]})})]})]},e.id)})})})]})}function ed({partnerId:e,userId:a,persona:r}){let[i,c]=(0,s.useState)(!0),[o,m]=(0,s.useState)(null),[x,g]=(0,s.useState)(null),[u,p]=(0,s.useState)(null),[f,j]=(0,s.useState)([]);if((0,s.useEffect)(()=>{async function t(){try{c(!0),m(null);let e=await fetch("/api/partners/me/dashboard"),t=await e.json();if(!e.ok)throw Error(t.error||"Failed to load partner dashboard");g(t.metrics),p(t.performance||null),j(t.recent_referrals||[])}catch(e){console.error("Error fetching partner dashboard data:",e),m(e instanceof Error?e.message:"Failed to load partner dashboard")}finally{c(!1)}}e&&a&&t()},[e,a]),i)return(0,t.jsx)("div",{className:"flex items-center justify-center min-h-[400px]",children:(0,t.jsx)(M.Loader2,{className:"h-8 w-8 animate-spin text-primary"})});if(o)return(0,t.jsx)("div",{className:"p-6",children:(0,t.jsx)(n.Card,{children:(0,t.jsxs)(n.CardHeader,{children:[(0,t.jsx)(n.CardTitle,{children:"Partner Dashboard"}),(0,t.jsx)(n.CardDescription,{children:o})]})})});let y=x?.commitmentCurrency||"USD",b=x?.pendingCommissionCurrency||"USD";return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("h1",{className:"text-2xl font-bold",children:["Welcome back, ",r.entity_name]}),(0,t.jsx)("p",{className:"text-muted-foreground",children:"Partner Dashboard - Track your referrals and investment opportunities"})]}),(0,t.jsx)(d.default,{href:"/versotech_main/opportunities",children:(0,t.jsxs)(h.Button,{children:[(0,t.jsx)(R.TrendingUp,{className:"mr-2 h-4 w-4"}),"View Opportunities"]})})]}),(0,t.jsxs)("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[(0,t.jsx)(d.default,{href:"/versotech_main/opportunities",className:"block",children:(0,t.jsxs)(n.Card,{className:"h-full hover:border-foreground/20 transition-colors",children:[(0,t.jsxs)(n.CardHeader,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,t.jsx)(n.CardTitle,{className:"text-sm font-medium",children:"Deals Available"}),(0,t.jsx)(Q.Briefcase,{className:"h-4 w-4 text-muted-foreground"})]}),(0,t.jsxs)(n.CardContent,{children:[(0,t.jsx)("div",{className:"text-2xl font-bold",children:x?.investableDeals||0}),(0,t.jsxs)("p",{className:"text-xs text-muted-foreground",children:[x?.trackedDeals||0," tracking"]})]})]})}),(0,t.jsx)(d.default,{href:"/versotech_main/partner-transactions",className:"block",children:(0,t.jsxs)(n.Card,{className:"h-full hover:border-foreground/20 transition-colors",children:[(0,t.jsxs)(n.CardHeader,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,t.jsx)(n.CardTitle,{className:"text-sm font-medium",children:"Referred Investors"}),(0,t.jsx)(B.Users,{className:"h-4 w-4 text-muted-foreground"})]}),(0,t.jsxs)(n.CardContent,{children:[(0,t.jsx)("div",{className:"text-2xl font-bold",children:x?.totalReferredInvestors||0}),(0,t.jsxs)("p",{className:"text-xs text-muted-foreground",children:[x?.subscribedInvestors||0," subscribed, ",x?.pipelineInvestors||0," in pipeline"]})]})]})}),(0,t.jsxs)(n.Card,{children:[(0,t.jsxs)(n.CardHeader,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,t.jsx)(n.CardTitle,{className:"text-sm font-medium",children:"Total Referred Amount"}),(0,t.jsx)(I.DollarSign,{className:"h-4 w-4 text-muted-foreground"})]}),(0,t.jsxs)(n.CardContent,{children:[(0,t.jsx)("div",{className:"text-2xl font-bold",children:(0,G.formatCurrency)(x?.totalCommitment||0,y)}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:"Committed by referred investors"})]})]}),(0,t.jsx)(d.default,{href:"/versotech_main/partner-transactions",className:"block",children:(0,t.jsxs)(n.Card,{className:"h-full hover:border-foreground/20 transition-colors",children:[(0,t.jsxs)(n.CardHeader,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,t.jsx)(n.CardTitle,{className:"text-sm font-medium",children:"Pending Commissions"}),(0,t.jsx)(Z.Activity,{className:"h-4 w-4 text-muted-foreground"})]}),(0,t.jsxs)(n.CardContent,{children:[(0,t.jsx)("div",{className:"text-2xl font-bold",children:(0,G.formatCurrency)(x?.pendingCommissions||0,b)}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:"Accrued and invoiced fees"})]})]})})]}),u&&(0,t.jsxs)(n.Card,{children:[(0,t.jsxs)(n.CardHeader,{children:[(0,t.jsxs)(n.CardTitle,{className:"flex items-center gap-2",children:[(0,t.jsx)(q.BarChart3,{className:"h-5 w-5"}),"Performance Analytics"]}),(0,t.jsx)(n.CardDescription,{children:"Your referral performance metrics"})]}),(0,t.jsx)(n.CardContent,{children:(0,t.jsxs)("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[(0,t.jsxs)("div",{className:"p-4 rounded-lg border bg-muted/30",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 text-sm text-muted-foreground mb-1",children:[(0,t.jsx)(_.Target,{className:"h-4 w-4"}),"Conversion Rate"]}),(0,t.jsxs)("div",{className:"text-2xl font-bold",children:[u.conversionRate,"%"]}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Referrals that subscribed"})]}),(0,t.jsxs)("div",{className:"p-4 rounded-lg border bg-muted/30",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 text-sm text-muted-foreground mb-1",children:[u.referralGrowth>=0?(0,t.jsx)(R.TrendingUp,{className:"h-4 w-4 text-green-500"}):(0,t.jsx)(F.TrendingDown,{className:"h-4 w-4 text-red-500"}),"This Month"]}),(0,t.jsx)("div",{className:"text-2xl font-bold",children:u.thisMonthReferrals}),(0,t.jsxs)("p",{className:"text-xs text-muted-foreground mt-1",children:[(0,t.jsxs)("span",{className:u.referralGrowth>=0?"text-green-500":"text-red-500",children:[u.referralGrowth>=0?"+":"",u.referralGrowth,"%"]})," ","vs last month (",u.lastMonthReferrals,")"]})]}),(0,t.jsxs)("div",{className:"p-4 rounded-lg border bg-muted/30",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 text-sm text-muted-foreground mb-1",children:[(0,t.jsx)(I.DollarSign,{className:"h-4 w-4"}),"Avg Commitment"]}),(0,t.jsx)("div",{className:"text-2xl font-bold",children:(0,G.formatCurrency)(u.avgCommitmentPerInvestor,u.avgCommitmentCurrency)}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Per subscribed investor"})]}),(0,t.jsxs)("div",{className:"p-4 rounded-lg border bg-muted/30",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 text-sm text-muted-foreground mb-1",children:[(0,t.jsx)(Y.Wallet,{className:"h-4 w-4"}),"Paid Commissions"]}),(0,t.jsx)("div",{className:"text-2xl font-bold text-green-500",children:(0,G.formatCurrency)(u.paidCommissions,b)}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Total received"})]})]})})]}),(0,t.jsxs)("div",{className:"grid gap-6 lg:grid-cols-2",children:[(0,t.jsxs)(n.Card,{children:[(0,t.jsxs)(n.CardHeader,{children:[(0,t.jsxs)(n.CardTitle,{className:"flex items-center gap-2",children:[(0,t.jsx)(J.HandCoins,{className:"h-5 w-5"}),"Recent Referrals"]}),(0,t.jsx)(n.CardDescription,{children:"Investors you have referred to deals"})]}),(0,t.jsx)(n.CardContent,{children:0===f.length?(0,t.jsxs)("div",{className:"text-center py-8 text-muted-foreground",children:[(0,t.jsx)(B.Users,{className:"h-12 w-12 mx-auto mb-4 opacity-20"}),(0,t.jsx)("p",{children:"No referrals yet"}),(0,t.jsx)("p",{className:"text-sm mt-1",children:"Share deals with investors to start tracking"})]}):(0,t.jsxs)("div",{className:"space-y-4",children:[f.map((e,s)=>{let a=e.subscription?.status,r="committed"===a||"active"===a,i="pending"===a,n=!a&&e.interest_confirmed_at;return(0,t.jsxs)("div",{className:"flex items-center justify-between p-3 rounded-lg border",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("div",{className:`p-2 rounded-full ${r?"bg-green-100 text-green-600":i?"bg-yellow-100 text-yellow-600":n?"bg-blue-100 text-blue-600":"bg-gray-100 text-gray-600"}`,children:r?(0,t.jsx)(z.CheckCircle2,{className:"h-4 w-4"}):i?(0,t.jsx)(H.Clock,{className:"h-4 w-4"}):(0,t.jsx)(X.Eye,{className:"h-4 w-4"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-medium",children:e.investor_name||"Unknown Investor"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:e.deal_name||"Unknown Deal"})]})]}),(0,t.jsxs)("div",{className:"text-right",children:[e.subscription?.commitment?(0,t.jsx)("p",{className:"font-medium",children:(0,G.formatCurrency)(e.subscription.commitment,y)}):null,(0,t.jsx)(l.Badge,{variant:r?"default":i||n?"secondary":"outline",children:r?"Committed":i?"Pending":n?"Interested":"Dispatched"})]})]},`${e.deal_id}-${e.investor_id||s}`)}),(0,t.jsx)(d.default,{href:"/versotech_main/partner-transactions",children:(0,t.jsxs)(h.Button,{variant:"outline",className:"w-full",children:["View All Transactions",(0,t.jsx)(V.ArrowRight,{className:"ml-2 h-4 w-4"})]})})]})})]}),(0,t.jsx)(el,{})]}),(0,t.jsxs)(n.Card,{children:[(0,t.jsx)(n.CardHeader,{children:(0,t.jsx)(n.CardTitle,{children:"Quick Actions"})}),(0,t.jsx)(n.CardContent,{children:(0,t.jsxs)("div",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-4",children:[(0,t.jsx)(d.default,{href:"/versotech_main/opportunities",children:(0,t.jsxs)(h.Button,{variant:"outline",className:"w-full justify-start",children:[(0,t.jsx)(R.TrendingUp,{className:"mr-2 h-4 w-4"}),"Browse Opportunities"]})}),(0,t.jsx)(d.default,{href:"/versotech_main/partner-transactions",children:(0,t.jsxs)(h.Button,{variant:"outline",className:"w-full justify-start",children:[(0,t.jsx)(B.Users,{className:"mr-2 h-4 w-4"}),"View Transactions"]})}),(0,t.jsx)(d.default,{href:"/versotech_main/shared-transactions",children:(0,t.jsxs)(h.Button,{variant:"outline",className:"w-full justify-start",children:[(0,t.jsx)(J.HandCoins,{className:"mr-2 h-4 w-4"}),"Shared Deals"]})}),(0,t.jsx)(d.default,{href:"/versotech_main/messages",children:(0,t.jsxs)(h.Button,{variant:"outline",className:"w-full justify-start",children:[(0,t.jsx)(Z.Activity,{className:"mr-2 h-4 w-4"}),"Messages"]})})]})})]})]})}var ec=e.i(401148);function eo({lawyerId:e,userId:a,persona:c}){let{theme:o}=(0,r.useTheme)(),m="staff-dark"===o,[x,g]=(0,s.useState)(!0),[u,p]=(0,s.useState)(null),[f,j]=(0,s.useState)(null),[y,N]=(0,s.useState)(null),[v,w]=(0,s.useState)([]),[_,C]=(0,s.useState)([]);if((0,s.useEffect)(()=>{!async function(){try{let t=(0,i.createClient)(),{data:s}=await t.from("lawyers").select("id, firm_name, display_name, specializations, is_active, assigned_deals").eq("id",e).maybeSingle();s&&N({firm_name:s.firm_name||"",display_name:s.display_name||"",specializations:s.specializations,is_active:s.is_active??!0});let{data:a}=await t.from("vehicles").select("id, name").eq("lawyer_id",e),r=(a||[]).map(e=>e.id),n=[],l=[];if(r.length>0){let{data:e}=await t.from("deals").select("id, name, status, target_amount, currency, vehicle_id").in("vehicle_id",r).order("created_at",{ascending:!1}).limit(10);n=(e||[]).map(e=>({id:e.id,name:e.name,status:e.status,target_amount:e.target_amount,currency:e.currency||"USD"})),l=(e||[]).map(e=>e.id)}if(!l.length&&s?.assigned_deals?.length&&(l=s.assigned_deals),C(n),l.length>0){let{data:e}=await t.from("subscriptions").select(`
              id,
              deal_id,
              investor_id,
              status,
              commitment,
              funded_amount,
              currency,
              committed_at,
              deals (id, name),
              investors (id, display_name, legal_name)
            `).in("deal_id",l).in("status",["committed","partially_funded","funded","active"]).order("committed_at",{ascending:!1}),s=e||[],{data:a}=await t.from("fee_events").select("id, status").in("deal_id",l).in("status",["accrued","invoiced"]),r=(a||[]).length,i=s.filter(e=>"committed"===e.status),n=s.filter(e=>"partially_funded"===e.status),d=s.filter(e=>"funded"===e.status||"active"===e.status),c=new Map,o=new Map;s.forEach(e=>{let t=e.currency||"USD";c.set(t,(c.get(t)||0)+(e.commitment||0)),o.set(t,(o.get(t)||0)+(e.funded_amount||0))});let m=(e,t)=>"USD"===e.currency?-1:"USD"===t.currency?1:e.currency.localeCompare(t.currency),x=Array.from(c.entries()).map(([e,t])=>({currency:e,amount:t})).filter(e=>e.amount>0).sort(m),h=Array.from(o.entries()).map(([e,t])=>({currency:e,amount:t})).filter(e=>e.amount>0).sort(m);j({assignedDeals:l.length,pendingEscrowConfirmations:i.length+n.length,pendingPaymentConfirmations:r,signedSubscriptions:s.length,fullyFundedSubscriptions:d.length,commitmentsByCurrency:x,fundedByCurrency:h});let g=s.slice(0,5).map(e=>{let t=Array.isArray(e.deals)?e.deals[0]:e.deals,s=Array.isArray(e.investors)?e.investors[0]:e.investors;return{id:e.id,deal_name:t?.name||"Unknown Deal",investor_name:s?.display_name||s?.legal_name||"Unknown Investor",commitment:e.commitment||0,funded_amount:e.funded_amount||0,currency:e.currency||"USD",status:e.status,committed_at:e.committed_at}});w(g)}else j({assignedDeals:0,pendingEscrowConfirmations:0,pendingPaymentConfirmations:0,signedSubscriptions:0,fullyFundedSubscriptions:0,commitmentsByCurrency:[],fundedByCurrency:[]})}catch(e){console.error("Error fetching lawyer data:",e),p(e instanceof Error?e.message:"Failed to load dashboard data")}finally{g(!1)}}()},[e,a]),x)return(0,t.jsxs)("div",{className:"p-8 text-center flex flex-col items-center gap-3",children:[(0,t.jsx)(M.Loader2,{className:"h-8 w-8 animate-spin text-gray-400"}),(0,t.jsx)("p",{className:"text-gray-500",children:"Loading dashboard..."})]});if(u)return(0,t.jsxs)("div",{className:"p-8 text-center flex flex-col items-center gap-3",children:[(0,t.jsx)(ec.AlertCircle,{className:"h-12 w-12 text-destructive"}),(0,t.jsx)("h3",{className:"text-lg font-medium",children:"Error Loading Dashboard"}),(0,t.jsx)("p",{className:"text-muted-foreground",children:u}),(0,t.jsx)(h.Button,{variant:"outline",onClick:()=>window.location.reload(),children:"Try Again"})]});let $={committed:"bg-blue-500/20 text-blue-400",partially_funded:"bg-amber-500/20 text-amber-400",funded:"bg-emerald-500/20 text-emerald-400",active:"bg-green-500/20 text-green-400"},S={committed:"Awaiting Funding",partially_funded:"Partial",funded:"Fully Funded",active:"Active"},A={open:"bg-green-500/20 text-green-400",draft:"bg-gray-500/20 text-gray-400",allocation_pending:"bg-yellow-500/20 text-yellow-400",fully_subscribed:"bg-blue-500/20 text-blue-400",closed:"bg-purple-500/20 text-purple-400",cancelled:"bg-red-500/20 text-red-400"};return(0,t.jsxs)("div",{className:"p-6 space-y-6",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:`text-2xl font-bold ${m?"text-white":"text-gray-900"}`,children:"Lawyer Dashboard"}),(0,t.jsxs)("p",{className:`mt-1 ${m?"text-gray-400":"text-gray-600"}`,children:[y?.display_name||c.entity_name,y?.firm_name&&` - ${y.firm_name}`]})]}),y?.specializations?.length?(0,t.jsx)("div",{className:"flex gap-2",children:y.specializations.slice(0,3).map((e,s)=>(0,t.jsx)(l.Badge,{variant:"outline",className:"capitalize",children:e},s))}):null]}),y&&!y.is_active&&(0,t.jsx)(n.Card,{className:`border-amber-500/30 ${m?"bg-amber-500/10":"bg-amber-50"}`,children:(0,t.jsx)(n.CardContent,{className:"py-4",children:(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("div",{className:"p-2 rounded-full bg-amber-500/20",children:(0,t.jsx)(ec.AlertCircle,{className:"h-5 w-5 text-amber-500"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:`font-medium ${m?"text-white":"text-gray-900"}`,children:"Account Inactive"}),(0,t.jsx)("p",{className:`text-sm ${m?"text-gray-400":"text-gray-600"}`,children:"Your lawyer account is currently inactive. Contact the VERSO team for assistance."})]})]})})}),f&&f.pendingEscrowConfirmations>0&&(0,t.jsx)(n.Card,{className:`border-blue-500/30 ${m?"bg-blue-500/10":"bg-blue-50"}`,children:(0,t.jsx)(n.CardContent,{className:"py-4",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("div",{className:"p-2 rounded-full bg-blue-500/20",children:(0,t.jsx)(I.DollarSign,{className:"h-5 w-5 text-blue-500"})}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("p",{className:`font-medium ${m?"text-white":"text-gray-900"}`,children:[f.pendingEscrowConfirmations," Pending Escrow Confirmation",1!==f.pendingEscrowConfirmations?"s":""]}),(0,t.jsx)("p",{className:`text-sm ${m?"text-gray-400":"text-gray-600"}`,children:"Signed subscriptions awaiting funding confirmation"})]})]}),(0,t.jsx)(h.Button,{asChild:!0,children:(0,t.jsxs)(d.default,{href:"/versotech_main/escrow",children:["Confirm Funding",(0,t.jsx)(V.ArrowRight,{className:"h-4 w-4 ml-2"})]})})]})})}),f&&f.pendingPaymentConfirmations>0&&(0,t.jsx)(n.Card,{className:`border-purple-500/30 ${m?"bg-purple-500/10":"bg-purple-50"}`,children:(0,t.jsx)(n.CardContent,{className:"py-4",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("div",{className:"p-2 rounded-full bg-purple-500/20",children:(0,t.jsx)(I.DollarSign,{className:"h-5 w-5 text-purple-500"})}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("p",{className:`font-medium ${m?"text-white":"text-gray-900"}`,children:[f.pendingPaymentConfirmations," Pending Fee Payment",1!==f.pendingPaymentConfirmations?"s":""]}),(0,t.jsx)("p",{className:`text-sm ${m?"text-gray-400":"text-gray-600"}`,children:"Fee payments awaiting confirmation"})]})]}),(0,t.jsx)(h.Button,{asChild:!0,variant:"outline",children:(0,t.jsxs)(d.default,{href:"/versotech_main/lawyer-reconciliation",children:["View Fees",(0,t.jsx)(V.ArrowRight,{className:"h-4 w-4 ml-2"})]})})]})})}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,t.jsxs)(n.Card,{className:m?"bg-white/5 border-white/10":"",children:[(0,t.jsxs)(n.CardHeader,{className:"flex flex-row items-center justify-between pb-2",children:[(0,t.jsx)(n.CardTitle,{className:`text-sm font-medium ${m?"text-gray-400":"text-gray-500"}`,children:"Assigned Deals"}),(0,t.jsx)(Q.Briefcase,{className:`h-4 w-4 ${m?"text-gray-500":"text-gray-400"}`})]}),(0,t.jsxs)(n.CardContent,{children:[(0,t.jsx)("div",{className:`text-2xl font-bold ${m?"text-white":"text-gray-900"}`,children:f?.assignedDeals||0}),(0,t.jsx)("p",{className:"text-xs text-gray-500",children:"Deals under your counsel"})]})]}),(0,t.jsxs)(n.Card,{className:m?"bg-white/5 border-white/10":"",children:[(0,t.jsxs)(n.CardHeader,{className:"flex flex-row items-center justify-between pb-2",children:[(0,t.jsx)(n.CardTitle,{className:`text-sm font-medium ${m?"text-gray-400":"text-gray-500"}`,children:"Signed Subscriptions"}),(0,t.jsx)(b.FileText,{className:`h-4 w-4 ${m?"text-gray-500":"text-gray-400"}`})]}),(0,t.jsxs)(n.CardContent,{children:[(0,t.jsx)("div",{className:`text-2xl font-bold ${m?"text-white":"text-gray-900"}`,children:f?.signedSubscriptions||0}),(0,t.jsxs)("p",{className:"text-xs text-gray-500",children:[f?.fullyFundedSubscriptions||0," fully funded"]})]})]}),(0,t.jsxs)(n.Card,{className:m?"bg-white/5 border-white/10":"",children:[(0,t.jsxs)(n.CardHeader,{className:"flex flex-row items-center justify-between pb-2",children:[(0,t.jsx)(n.CardTitle,{className:`text-sm font-medium ${m?"text-gray-400":"text-gray-500"}`,children:"Total Committed"}),(0,t.jsx)(I.DollarSign,{className:`h-4 w-4 ${m?"text-gray-500":"text-gray-400"}`})]}),(0,t.jsxs)(n.CardContent,{children:[f?.commitmentsByCurrency&&f.commitmentsByCurrency.length>0?(0,t.jsx)("div",{className:"space-y-1",children:f.commitmentsByCurrency.map((e,s)=>(0,t.jsx)("div",{className:`${0===s?"text-2xl font-bold":"text-sm font-medium"} text-blue-500`,children:(0,G.formatCurrency)(e.amount,e.currency)},e.currency))}):(0,t.jsx)("div",{className:"text-2xl font-bold text-blue-500",children:(0,G.formatCurrency)(0)}),(0,t.jsx)("p",{className:"text-xs mt-1 text-gray-500",children:"Across all subscriptions"})]})]}),(0,t.jsxs)(n.Card,{className:m?"bg-white/5 border-white/10":"",children:[(0,t.jsxs)(n.CardHeader,{className:"flex flex-row items-center justify-between pb-2",children:[(0,t.jsx)(n.CardTitle,{className:`text-sm font-medium ${m?"text-gray-400":"text-gray-500"}`,children:"Total Funded"}),(0,t.jsx)(z.CheckCircle2,{className:`h-4 w-4 ${m?"text-gray-500":"text-gray-400"}`})]}),(0,t.jsxs)(n.CardContent,{children:[f?.fundedByCurrency&&f.fundedByCurrency.length>0?(0,t.jsx)("div",{className:"space-y-1",children:f.fundedByCurrency.map((e,s)=>(0,t.jsx)("div",{className:`${0===s?"text-2xl font-bold":"text-sm font-medium"} text-green-500`,children:(0,G.formatCurrency)(e.amount,e.currency)},e.currency))}):(0,t.jsx)("div",{className:"text-2xl font-bold text-green-500",children:(0,G.formatCurrency)(0)}),(0,t.jsx)("p",{className:"text-xs mt-1 text-gray-500",children:"Escrow confirmed"})]})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,t.jsxs)(n.Card,{className:m?"bg-white/5 border-white/10":"",children:[(0,t.jsxs)(n.CardHeader,{className:"flex flex-row items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(n.CardTitle,{className:m?"text-white":"",children:"Recent Subscriptions"}),(0,t.jsx)(n.CardDescription,{children:"Recently signed subscription packs"})]}),(0,t.jsx)(h.Button,{variant:"ghost",size:"sm",asChild:!0,children:(0,t.jsxs)(d.default,{href:"/versotech_main/subscription-packs",children:["View All",(0,t.jsx)(V.ArrowRight,{className:"h-4 w-4 ml-1"})]})})]}),(0,t.jsx)(n.CardContent,{children:0===v.length?(0,t.jsxs)("div",{className:"text-center py-8",children:[(0,t.jsx)(b.FileText,{className:`h-10 w-10 mx-auto mb-3 ${m?"text-gray-600":"text-gray-400"}`}),(0,t.jsx)("p",{className:`text-sm ${m?"text-gray-400":"text-gray-500"}`,children:"No signed subscriptions yet"})]}):(0,t.jsx)("div",{className:"space-y-3",children:v.map(e=>(0,t.jsxs)("div",{className:`flex items-center justify-between p-3 rounded-lg ${m?"bg-white/5":"bg-gray-50"}`,children:[(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsx)("p",{className:`font-medium truncate ${m?"text-white":"text-gray-900"}`,children:e.investor_name}),(0,t.jsx)("p",{className:`text-sm truncate ${m?"text-gray-400":"text-gray-500"}`,children:e.deal_name}),(0,t.jsxs)("p",{className:`text-xs ${m?"text-gray-500":"text-gray-400"}`,children:[(0,G.formatCurrency)(e.commitment,e.currency)," committed"]})]}),(0,t.jsx)(l.Badge,{className:$[e.status]||"bg-gray-500/20 text-gray-400",children:S[e.status]||e.status})]},e.id))})})]}),(0,t.jsxs)(n.Card,{className:m?"bg-white/5 border-white/10":"",children:[(0,t.jsxs)(n.CardHeader,{className:"flex flex-row items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(n.CardTitle,{className:m?"text-white":"",children:"Assigned Deals"}),(0,t.jsx)(n.CardDescription,{children:"Deals under your legal counsel"})]}),(0,t.jsx)(h.Button,{variant:"ghost",size:"sm",asChild:!0,children:(0,t.jsxs)(d.default,{href:"/versotech_main/assigned-deals",children:["View All",(0,t.jsx)(V.ArrowRight,{className:"h-4 w-4 ml-1"})]})})]}),(0,t.jsx)(n.CardContent,{children:0===_.length?(0,t.jsxs)("div",{className:"text-center py-8",children:[(0,t.jsx)(Q.Briefcase,{className:`h-10 w-10 mx-auto mb-3 ${m?"text-gray-600":"text-gray-400"}`}),(0,t.jsx)("p",{className:`text-sm ${m?"text-gray-400":"text-gray-500"}`,children:"No deals assigned yet"}),(0,t.jsx)("p",{className:`text-xs ${m?"text-gray-500":"text-gray-400"} mt-1`,children:"Contact the VERSO team to be assigned to deals"})]}):(0,t.jsx)("div",{className:"space-y-3",children:_.map(e=>(0,t.jsxs)(d.default,{href:`/versotech_main/opportunities/${e.id}`,className:`flex items-center justify-between p-3 rounded-lg transition-colors ${m?"bg-white/5 hover:bg-white/10":"bg-gray-50 hover:bg-gray-100"}`,children:[(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsx)("p",{className:`font-medium truncate ${m?"text-white":"text-gray-900"}`,children:e.name}),(0,t.jsx)("p",{className:`text-sm ${m?"text-gray-400":"text-gray-500"}`,children:e.target_amount?`${(0,G.formatCurrency)(e.target_amount,e.currency)} target`:"No target set"})]}),(0,t.jsx)(l.Badge,{className:A[e.status]||"bg-gray-500/20 text-gray-400",children:e.status})]},e.id))})})]})]}),(0,t.jsxs)(n.Card,{className:m?"bg-white/5 border-white/10":"",children:[(0,t.jsxs)(n.CardHeader,{children:[(0,t.jsx)(n.CardTitle,{className:m?"text-white":"",children:"Quick Actions"}),(0,t.jsx)(n.CardDescription,{children:"Common tasks and workflows"})]}),(0,t.jsx)(n.CardContent,{children:(0,t.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:[(0,t.jsx)(h.Button,{variant:"outline",asChild:!0,className:"h-auto py-4 flex-col gap-2",children:(0,t.jsxs)(d.default,{href:"/versotech_main/subscription-packs",children:[(0,t.jsx)(b.FileText,{className:"h-5 w-5"}),(0,t.jsx)("span",{children:"View Signed Packs"})]})}),(0,t.jsx)(h.Button,{variant:"outline",asChild:!0,className:"h-auto py-4 flex-col gap-2",children:(0,t.jsxs)(d.default,{href:"/versotech_main/escrow",children:[(0,t.jsx)(I.DollarSign,{className:"h-5 w-5"}),(0,t.jsx)("span",{children:"Confirm Escrow"})]})}),(0,t.jsx)(h.Button,{variant:"outline",asChild:!0,className:"h-auto py-4 flex-col gap-2",children:(0,t.jsxs)(d.default,{href:"/versotech_main/assigned-deals",children:[(0,t.jsx)(Q.Briefcase,{className:"h-5 w-5"}),(0,t.jsx)("span",{children:"View Deals"})]})})]})})]})]})}var em=e.i(201495),ex=e.i(572826),eh=e.i(80289),eg=e.i(937368),eu=e.i(818798),ep=e.i(932735),ef=e.i(117925);function ej({arrangerId:e,compact:a=!1}){let{theme:i}=(0,r.useTheme)(),l="staff-dark"===i,[c,o]=(0,s.useState)(null),[m,x]=(0,s.useState)(!0),[g,u]=(0,s.useState)(null);if((0,s.useEffect)(()=>{!async function(){try{let e=await fetch("/api/arrangers/me/onboarding-status");if(!e.ok)throw Error("Failed to fetch onboarding status");let t=await e.json();o(t)}catch(e){console.error("Error fetching onboarding status:",e),u("Failed to load onboarding status")}finally{x(!1)}}()},[e]),m)return(0,t.jsx)(n.Card,{className:(0,p.cn)(l?"bg-white/5 border-white/10":""),children:(0,t.jsx)(n.CardContent,{className:"py-6 flex items-center justify-center",children:(0,t.jsx)(M.Loader2,{className:"h-5 w-5 animate-spin text-gray-400"})})});if(g||!c||c.onboarding.is_complete&&a)return null;let{onboarding:f}=c,j=[{id:"profile",label:"Complete Profile",description:"Fill in your company details",icon:C.User,complete:f.steps.profile.complete,href:"/versotech_main/arranger-profile?tab=entity",progress:f.steps.profile.progress},{id:"documents",label:"Upload Documents",description:"Required KYC documents",icon:b.FileText,complete:f.steps.documents.complete,href:"/versotech_main/arranger-profile?tab=documents",progress:f.steps.documents.progress},{id:"signature",label:"Signature Specimen",description:"Add your signature",icon:eu.PenTool,complete:f.steps.signature.complete,href:"/versotech_main/arranger-profile?tab=signature"},{id:"submitted",label:"Submit for Review",description:"Send for VERSO approval",icon:ep.Send,complete:f.steps.submitted.complete,href:"/versotech_main/arranger-profile?tab=documents"},{id:"approved",label:"KYC Approved",description:"Ready to operate",icon:ef.ShieldCheck,complete:f.steps.approved.complete}];return a?(0,t.jsx)(n.Card,{className:(0,p.cn)("border-indigo-500/30",l?"bg-indigo-500/10":"bg-indigo-50"),children:(0,t.jsx)(n.CardContent,{className:"py-4",children:(0,t.jsxs)("div",{className:"flex items-center justify-between gap-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-4 flex-1",children:[(0,t.jsx)("div",{className:"p-2 rounded-full bg-indigo-500/20",children:(0,t.jsx)(ef.ShieldCheck,{className:"h-5 w-5 text-indigo-500"})}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsx)("p",{className:(0,p.cn)("font-medium",l?"text-white":"text-gray-900"),children:"Complete Your Onboarding"}),(0,t.jsxs)("div",{className:"flex items-center gap-3 mt-1",children:[(0,t.jsx)(eg.Progress,{value:f.progress_percent,className:"h-2 flex-1 max-w-[200px]"}),(0,t.jsxs)("span",{className:(0,p.cn)("text-sm",l?"text-gray-400":"text-gray-600"),children:[f.progress_percent,"%"]})]})]})]}),f.next_action&&(0,t.jsx)(h.Button,{asChild:!0,size:"sm",children:(0,t.jsxs)(d.default,{href:f.next_action.href,children:[f.next_action.label,(0,t.jsx)(V.ArrowRight,{className:"h-4 w-4 ml-2"})]})})]})})}):(0,t.jsxs)(n.Card,{className:(0,p.cn)(l?"bg-white/5 border-white/10":""),children:[(0,t.jsxs)(n.CardHeader,{children:[(0,t.jsx)(n.CardTitle,{className:(0,p.cn)(l?"text-white":"text-gray-900"),children:"Onboarding Checklist"}),(0,t.jsx)(n.CardDescription,{className:(0,p.cn)(l?"text-gray-400":"text-gray-500"),children:"Complete these steps to activate your arranger account"})]}),(0,t.jsxs)(n.CardContent,{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,t.jsx)("span",{className:(0,p.cn)(l?"text-gray-400":"text-gray-600"),children:"Progress"}),(0,t.jsxs)("span",{className:(0,p.cn)("font-medium",l?"text-white":"text-gray-900"),children:[f.completed_steps," of ",f.total_steps," steps"]})]}),(0,t.jsx)(eg.Progress,{value:f.progress_percent,className:"h-2"})]}),(0,t.jsx)("div",{className:"space-y-3 pt-2",children:j.map((e,s)=>{let a=e.icon,r=f.next_action?.step===e.id||f.next_action?.step==="submit"&&"submitted"===e.id||f.next_action?.step==="pending"&&"submitted"===e.id;return(0,t.jsxs)("div",{className:(0,p.cn)("flex items-center gap-3 p-3 rounded-lg transition-colors",e.complete?l?"bg-green-500/10":"bg-green-50":r?l?"bg-indigo-500/10 border border-indigo-500/30":"bg-indigo-50 border border-indigo-200":l?"bg-white/5":"bg-gray-50"),children:[(0,t.jsx)("div",{className:(0,p.cn)("flex-shrink-0 p-2 rounded-full",e.complete?"bg-green-500/20 text-green-500":r?"bg-indigo-500/20 text-indigo-500":l?"bg-gray-700 text-gray-500":"bg-gray-200 text-gray-400"),children:e.complete?(0,t.jsx)(z.CheckCircle2,{className:"h-4 w-4"}):f.next_action?.step==="pending"&&"submitted"===e.id?(0,t.jsx)(H.Clock,{className:"h-4 w-4"}):(0,t.jsx)(a,{className:"h-4 w-4"})}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsxs)("p",{className:(0,p.cn)("font-medium text-sm",e.complete?l?"text-green-400":"text-green-700":l?"text-white":"text-gray-900"),children:[e.label,e.progress&&!e.complete&&(0,t.jsxs)("span",{className:(0,p.cn)("ml-2 text-xs font-normal",l?"text-gray-400":"text-gray-500"),children:["(",e.progress,")"]})]}),(0,t.jsx)("p",{className:(0,p.cn)("text-xs","text-gray-500"),children:f.next_action?.step==="pending"&&"submitted"===e.id?"Awaiting VERSO team review":e.description})]}),!e.complete&&e.href&&"approved"!==e.id&&(0,t.jsx)(h.Button,{asChild:!0,variant:r?"default":"ghost",size:"sm",className:"flex-shrink-0",children:(0,t.jsx)(d.default,{href:e.href,children:r?"Start":"View"})})]},e.id)})})]})]})}function ey({arrangerId:e,userId:a,persona:c}){let{theme:o}=(0,r.useTheme)(),m="staff-dark"===o,[x,g]=(0,s.useState)(!0),[u,p]=(0,s.useState)(null),[f,y]=(0,s.useState)(null),[b,N]=(0,s.useState)([]),[v,w]=(0,s.useState)([]),[_,C]=(0,s.useState)(null),[$,S]=(0,s.useState)(null),[A,k]=(0,s.useState)(null);if((0,s.useEffect)(()=>{!async function(){try{let t=(0,i.createClient)(),{data:s}=await t.from("arranger_entities").select("id, legal_name, status, kyc_status").eq("id",e).maybeSingle();s&&y({legal_name:s.legal_name,status:s.status,kyc_status:s.kyc_status});let{data:a}=await t.from("vehicles").select("id, name, lawyer_id").eq("arranger_entity_id",e),r=(a||[]).map(e=>e.id),n=[];if(r.length>0){let{data:e}=await t.from("deals").select("id, name, status, target_amount, currency, created_at, vehicle_id").in("vehicle_id",r).order("created_at",{ascending:!1});n=e||[]}let l=n||[],d=l.filter(e=>"open"===e.status||"allocation_pending"===e.status),c=l.filter(e=>"draft"===e.status);N(l.slice(0,5).map(e=>({id:e.id,name:e.name,status:e.status,target_amount:e.target_amount,currency:e.currency||"USD",created_at:e.created_at})));let o=l.map(e=>e.id),m=0;if(o.length>0){let{data:e}=await t.from("subscriptions").select("commitment").in("deal_id",o).in("status",["committed","active","signed","funded"]);m=(e||[]).reduce((e,t)=>e+(t.commitment||0),0)}let x=0,h=0,g=0,u=new Set((a||[]).filter(e=>e.lawyer_id).map(e=>e.lawyer_id)).size;if(o.length>0){let{data:e}=await t.from("subscriptions").select("id, investor_id, introducer_id, proxy_commercial_partner_id").in("deal_id",o);h=new Set((e||[]).filter(e=>e.introducer_id).map(e=>e.introducer_id)).size;let{data:s}=await t.from("deal_memberships").select("referred_by_entity_id").in("deal_id",o).eq("referred_by_entity_type","partner").not("referred_by_entity_id","is",null);x=new Set((s||[]).map(e=>e.referred_by_entity_id)).size,g=new Set((e||[]).filter(e=>e.proxy_commercial_partner_id).map(e=>e.proxy_commercial_partner_id)).size}let{data:f}=await t.from("introducer_agreements").select(`
            id,
            status,
            created_at,
            introducers (id, display_name, legal_name)
          `).eq("arranger_id",e).in("status",["sent","pending_approval","approved","pending_ceo_signature","pending_introducer_signature"]).order("created_at",{ascending:!1}).limit(5),{data:j}=await t.from("placement_agreements").select(`
            id,
            status,
            created_at,
            commercial_partners (id, display_name, legal_name)
          `).eq("arranger_id",e).in("status",["sent","pending_approval","approved","pending_ceo_signature","pending_cp_signature"]).order("created_at",{ascending:!1}).limit(5),b=[];if((f||[]).forEach(e=>{let t=Array.isArray(e.introducers)?e.introducers[0]:e.introducers;b.push({id:e.id,entity_name:t?.display_name||t?.legal_name||"Unknown",entity_type:"introducer",status:e.status,created_at:e.created_at})}),(j||[]).forEach(e=>{let t=Array.isArray(e.commercial_partners)?e.commercial_partners[0]:e.commercial_partners;b.push({id:e.id,entity_name:t?.display_name||t?.legal_name||"Unknown",entity_type:"commercial_partner",status:e.status,created_at:e.created_at})}),b.sort((e,t)=>new Date(t.created_at).getTime()-new Date(e.created_at).getTime()),w(b.slice(0,5)),o.length>0){let{data:e}=await t.from("subscriptions").select("commitment, funded_amount, outstanding_amount, status, investor_id").in("deal_id",o).in("status",["committed","partially_funded","funded","active","signed"]),s=(e||[]).reduce((e,t)=>e+(t.commitment||0),0),a=(e||[]).reduce((e,t)=>e+(t.funded_amount||0),0),r=(e||[]).reduce((e,t)=>e+(t.outstanding_amount||0),0),i=(e||[]).filter(e=>(e.funded_amount||0)<(e.commitment||0)).length;C({totalExpected:s,totalFunded:a,totalOutstanding:r,fundingRate:s>0?a/s*100:0,pendingInvestors:i});let{data:n}=await t.from("documents").select(`
              id,
              subscription_id,
              status,
              ready_for_signature,
              signature_requests(id, signer_role, status)
            `).not("subscription_id","is",null).in("status",["published","pending_signature"]),{data:l}=await t.from("subscriptions").select("id").in("deal_id",o),d=new Set((l||[]).map(e=>e.id)),c=(n||[]).filter(e=>d.has(e.subscription_id)),m=0,x=0,h=0;c.forEach(e=>{if("pending_signature"!==e.status)return;let t=e.signature_requests||[],s=t.some(e=>"investor"===e.signer_role&&"pending"===e.status),a=t.some(e=>"arranger"===e.signer_role&&"pending"===e.status),r=t.some(e=>"admin"===e.signer_role&&"pending"===e.status);s&&m++,a&&x++,r&&h++});let g=new Date;g.setDate(1),g.setHours(0,0,0,0);let{count:u}=await t.from("subscriptions").select("id",{count:"exact",head:!0}).in("deal_id",o).not("signed_at","is",null).gte("signed_at",g.toISOString());S({awaitingInvestorSignature:m,awaitingArrangerSignature:x,awaitingCEOSignature:h,signedThisMonth:u||0,totalPending:m+x+h})}else C({totalExpected:0,totalFunded:0,totalOutstanding:0,fundingRate:0,pendingInvestors:0}),S({awaitingInvestorSignature:0,awaitingArrangerSignature:0,awaitingCEOSignature:0,signedThisMonth:0,totalPending:0});let{data:v}=await t.from("fee_events").select("computed_amount, status").eq("payee_arranger_id",e),_=(v||[]).filter(e=>"voided"!==e.status&&"cancelled"!==e.status),$=_.filter(e=>"accrued"===e.status).reduce((e,t)=>e+(t.computed_amount||0),0),A=_.filter(e=>"invoiced"===e.status).reduce((e,t)=>e+(t.computed_amount||0),0),D=_.filter(e=>"paid"===e.status).reduce((e,t)=>e+(t.computed_amount||0),0);k({totalAccrued:$,totalInvoiced:A,totalPaid:D,feePipeline:$+A}),p({totalMandates:l.length,activeMandates:d.length,pendingMandates:c.length,totalPartners:x||0,totalIntroducers:h||0,totalCommercialPartners:g||0,totalLawyers:u,pendingAgreements:b.length,totalCommitmentValue:m})}catch(e){console.error("Error fetching arranger data:",e)}finally{g(!1)}}()},[e]),x)return(0,t.jsxs)("div",{className:"p-8 text-center flex flex-col items-center gap-3",children:[(0,t.jsx)(M.Loader2,{className:"h-8 w-8 animate-spin text-gray-400"}),(0,t.jsx)("p",{className:"text-gray-500",children:"Loading dashboard..."})]});let D={draft:"bg-gray-500/20 text-gray-400",open:"bg-green-500/20 text-green-400",allocation_pending:"bg-amber-500/20 text-amber-400",closed:"bg-purple-500/20 text-purple-400",cancelled:"bg-red-500/20 text-red-400"},T={sent:"bg-blue-500/20 text-blue-400",pending_approval:"bg-amber-500/20 text-amber-400",approved:"bg-green-500/20 text-green-400",pending_ceo_signature:"bg-purple-500/20 text-purple-400",pending_introducer_signature:"bg-indigo-500/20 text-indigo-400",pending_cp_signature:"bg-indigo-500/20 text-indigo-400"},R={sent:"Sent",pending_approval:"Pending Approval",approved:"Approved",pending_ceo_signature:"Awaiting CEO Signature",pending_introducer_signature:"Awaiting Signature",pending_cp_signature:"Awaiting Signature"};return(0,t.jsxs)("div",{className:"p-6 space-y-6",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:`text-2xl font-bold ${m?"text-white":"text-gray-900"}`,children:"Arranger Dashboard"}),(0,t.jsx)("p",{className:`mt-1 ${m?"text-gray-400":"text-gray-600"}`,children:f?.legal_name||c.entity_name})]}),f?.kyc_status&&(0,t.jsxs)(l.Badge,{variant:"outline",className:"approved"===f.kyc_status?"border-green-500/50 text-green-500":"pending"===f.kyc_status?"border-amber-500/50 text-amber-500":"border-gray-500/50 text-gray-500",children:["KYC: ",f.kyc_status]})]}),f&&"active"!==f.status&&(0,t.jsx)(n.Card,{className:`border-amber-500/30 ${m?"bg-amber-500/10":"bg-amber-50"}`,children:(0,t.jsx)(n.CardContent,{className:"py-4",children:(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("div",{className:"p-2 rounded-full bg-amber-500/20",children:(0,t.jsx)(ec.AlertCircle,{className:"h-5 w-5 text-amber-500"})}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("p",{className:`font-medium ${m?"text-white":"text-gray-900"}`,children:["Account ","pending"===f.status?"Pending Approval":"Inactive"]}),(0,t.jsx)("p",{className:`text-sm ${m?"text-gray-400":"text-gray-600"}`,children:"pending"===f.status?"Your arranger account is pending approval. Contact the VERSO team for status updates.":"Your arranger account is currently inactive. Contact the VERSO team for assistance."})]})]})})}),u&&u.pendingAgreements>0&&(0,t.jsx)(n.Card,{className:`border-blue-500/30 ${m?"bg-blue-500/10":"bg-blue-50"}`,children:(0,t.jsx)(n.CardContent,{className:"py-4",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("div",{className:"p-2 rounded-full bg-blue-500/20",children:(0,t.jsx)(P.FileSignature,{className:"h-5 w-5 text-blue-500"})}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("p",{className:`font-medium ${m?"text-white":"text-gray-900"}`,children:[u.pendingAgreements," Pending Agreement",1!==u.pendingAgreements?"s":""]}),(0,t.jsx)("p",{className:`text-sm ${m?"text-gray-400":"text-gray-600"}`,children:"Agreements awaiting approval or signature"})]})]}),(0,t.jsx)(h.Button,{asChild:!0,children:(0,t.jsxs)(d.default,{href:"/versotech_main/versosign",children:["View in VERSOSign",(0,t.jsx)(V.ArrowRight,{className:"h-4 w-4 ml-2"})]})})]})})}),f?.kyc_status!=="approved"&&(0,t.jsx)(ej,{arrangerId:e,compact:!0}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,t.jsxs)(n.Card,{className:m?"bg-white/5 border-white/10":"",children:[(0,t.jsxs)(n.CardHeader,{className:"flex flex-row items-center justify-between pb-2",children:[(0,t.jsx)(n.CardTitle,{className:`text-sm font-medium ${m?"text-gray-400":"text-gray-500"}`,children:"Total Mandates"}),(0,t.jsx)(Q.Briefcase,{className:`h-4 w-4 ${m?"text-gray-500":"text-gray-400"}`})]}),(0,t.jsxs)(n.CardContent,{children:[(0,t.jsx)("div",{className:`text-2xl font-bold ${m?"text-white":"text-gray-900"}`,children:u?.totalMandates||0}),(0,t.jsxs)("p",{className:"text-xs text-gray-500",children:[u?.activeMandates||0," active, ",u?.pendingMandates||0," pending"]})]})]}),(0,t.jsxs)(n.Card,{className:m?"bg-white/5 border-white/10":"",children:[(0,t.jsxs)(n.CardHeader,{className:"flex flex-row items-center justify-between pb-2",children:[(0,t.jsx)(n.CardTitle,{className:`text-sm font-medium ${m?"text-gray-400":"text-gray-500"}`,children:"Active Network"}),(0,t.jsx)(B.Users,{className:`h-4 w-4 ${m?"text-gray-500":"text-gray-400"}`})]}),(0,t.jsxs)(n.CardContent,{children:[(0,t.jsx)("div",{className:`text-2xl font-bold ${m?"text-white":"text-gray-900"}`,children:(u?.totalPartners||0)+(u?.totalIntroducers||0)+(u?.totalCommercialPartners||0)}),(0,t.jsx)("p",{className:"text-xs text-gray-500",children:"On your mandates"})]})]}),(0,t.jsxs)(n.Card,{className:m?"bg-white/5 border-white/10":"",children:[(0,t.jsxs)(n.CardHeader,{className:"flex flex-row items-center justify-between pb-2",children:[(0,t.jsx)(n.CardTitle,{className:`text-sm font-medium ${m?"text-gray-400":"text-gray-500"}`,children:"Total Commitment"}),(0,t.jsx)(I.DollarSign,{className:`h-4 w-4 ${m?"text-gray-500":"text-gray-400"}`})]}),(0,t.jsxs)(n.CardContent,{children:[(0,t.jsx)("div",{className:"text-2xl font-bold text-green-500",children:(0,G.formatCurrency)(u?.totalCommitmentValue||0)}),(0,t.jsx)("p",{className:"text-xs text-gray-500",children:"Across all mandates"})]})]}),(0,t.jsxs)(n.Card,{className:m?"bg-white/5 border-white/10":"",children:[(0,t.jsxs)(n.CardHeader,{className:"flex flex-row items-center justify-between pb-2",children:[(0,t.jsx)(n.CardTitle,{className:`text-sm font-medium ${m?"text-gray-400":"text-gray-500"}`,children:"Assigned Lawyers"}),(0,t.jsx)(em.Scale,{className:`h-4 w-4 ${m?"text-gray-500":"text-gray-400"}`})]}),(0,t.jsxs)(n.CardContent,{children:[(0,t.jsx)("div",{className:`text-2xl font-bold ${m?"text-white":"text-gray-900"}`,children:u?.totalLawyers||0}),(0,t.jsx)("p",{className:"text-xs text-gray-500",children:"On your mandates"})]})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,t.jsxs)(n.Card,{className:m?"bg-white/5 border-white/10":"",children:[(0,t.jsxs)(n.CardHeader,{className:"flex flex-row items-center justify-between pb-2",children:[(0,t.jsx)(n.CardTitle,{className:`text-sm font-medium ${m?"text-gray-400":"text-gray-500"}`,children:"Escrow Funding Status"}),(0,t.jsx)(Y.Wallet,{className:`h-4 w-4 ${m?"text-gray-500":"text-gray-400"}`})]}),(0,t.jsxs)(n.CardContent,{children:[(0,t.jsxs)("div",{className:`text-2xl font-bold ${(_?.fundingRate||0)>=75?"text-green-500":"text-amber-500"}`,children:[(_?.fundingRate||0).toFixed(0),"% Funded"]}),(0,t.jsxs)("p",{className:"text-xs text-gray-500",children:[(0,G.formatCurrency)(_?.totalFunded||0)," of ",(0,G.formatCurrency)(_?.totalExpected||0)]}),(0,t.jsx)("div",{className:`mt-2 h-2 ${m?"bg-gray-700":"bg-gray-200"} rounded-full overflow-hidden`,children:(0,t.jsx)("div",{className:"h-full bg-green-500 transition-all duration-300",style:{width:`${Math.min(_?.fundingRate||0,100)}%`}})}),(_?.pendingInvestors||0)>0&&(0,t.jsxs)("p",{className:"text-xs text-amber-400 mt-2",children:[_?.pendingInvestors," investor(s) pending funding"]}),(0,t.jsxs)("div",{className:"mt-3 pt-3 border-t border-gray-700/50 flex justify-between text-xs",children:[(0,t.jsx)("span",{className:m?"text-gray-400":"text-gray-500",children:"Outstanding:"}),(0,t.jsx)("span",{className:"text-amber-400 font-medium",children:(0,G.formatCurrency)(_?.totalOutstanding||0)})]})]})]}),(0,t.jsxs)(n.Card,{className:m?"bg-white/5 border-white/10":"",children:[(0,t.jsxs)(n.CardHeader,{className:"flex flex-row items-center justify-between pb-2",children:[(0,t.jsx)(n.CardTitle,{className:`text-sm font-medium ${m?"text-gray-400":"text-gray-500"}`,children:"Fee Pipeline"}),(0,t.jsx)(ex.Receipt,{className:`h-4 w-4 ${m?"text-gray-500":"text-gray-400"}`})]}),(0,t.jsxs)(n.CardContent,{children:[(0,t.jsx)("div",{className:"text-2xl font-bold text-green-500",children:(0,G.formatCurrency)(A?.feePipeline||0)}),(0,t.jsx)("p",{className:"text-xs text-gray-500",children:"Pending collection"}),(0,t.jsxs)("div",{className:"mt-3 space-y-2 text-xs",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsx)("span",{className:m?"text-gray-400":"text-gray-500",children:"Accrued:"}),(0,t.jsx)("span",{className:"text-amber-400 font-medium",children:(0,G.formatCurrency)(A?.totalAccrued||0)})]}),(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsx)("span",{className:m?"text-gray-400":"text-gray-500",children:"Invoiced:"}),(0,t.jsx)("span",{className:"text-blue-400 font-medium",children:(0,G.formatCurrency)(A?.totalInvoiced||0)})]}),(0,t.jsxs)("div",{className:"flex justify-between items-center pt-2 border-t border-gray-700/50",children:[(0,t.jsx)("span",{className:m?"text-gray-400":"text-gray-500",children:"Total Paid:"}),(0,t.jsx)("span",{className:"text-green-400 font-medium",children:(0,G.formatCurrency)(A?.totalPaid||0)})]})]})]})]})]}),(0,t.jsxs)(n.Card,{className:m?"bg-white/5 border-white/10":"",children:[(0,t.jsxs)(n.CardHeader,{children:[(0,t.jsx)(n.CardTitle,{className:m?"text-white":"",children:"Subscription Pack Pipeline"}),(0,t.jsx)(n.CardDescription,{children:"Document signing status across your mandates"})]}),(0,t.jsxs)(n.CardContent,{children:[(0,t.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[(0,t.jsxs)("div",{className:`text-center p-4 rounded-lg ${m?"bg-amber-500/10":"bg-amber-50"}`,children:[(0,t.jsx)("p",{className:"text-2xl font-bold text-amber-500",children:$?.awaitingInvestorSignature||0}),(0,t.jsx)("p",{className:`text-xs ${m?"text-gray-400":"text-gray-500"}`,children:"Awaiting Investor"})]}),(0,t.jsxs)("div",{className:`text-center p-4 rounded-lg ${m?"bg-purple-500/10":"bg-purple-50"}`,children:[(0,t.jsx)("p",{className:"text-2xl font-bold text-purple-500",children:$?.awaitingArrangerSignature||0}),(0,t.jsx)("p",{className:`text-xs ${m?"text-gray-400":"text-gray-500"}`,children:"Awaiting Your Signature"})]}),(0,t.jsxs)("div",{className:`text-center p-4 rounded-lg ${m?"bg-blue-500/10":"bg-blue-50"}`,children:[(0,t.jsx)("p",{className:"text-2xl font-bold text-blue-500",children:$?.awaitingCEOSignature||0}),(0,t.jsx)("p",{className:`text-xs ${m?"text-gray-400":"text-gray-500"}`,children:"Awaiting CEO"})]}),(0,t.jsxs)("div",{className:`text-center p-4 rounded-lg ${m?"bg-green-500/10":"bg-green-50"}`,children:[(0,t.jsx)("p",{className:"text-2xl font-bold text-green-500",children:$?.signedThisMonth||0}),(0,t.jsx)("p",{className:`text-xs ${m?"text-gray-400":"text-gray-500"}`,children:"Signed This Month"})]})]}),($?.awaitingArrangerSignature||0)>0&&(0,t.jsxs)(eh.Alert,{className:`mt-4 border-purple-500/30 ${m?"bg-purple-500/10":"bg-purple-50"}`,children:[(0,t.jsx)(P.FileSignature,{className:"h-4 w-4 text-purple-500"}),(0,t.jsxs)(eh.AlertDescription,{className:`flex items-center justify-between ${m?"text-gray-300":"text-gray-700"}`,children:[(0,t.jsxs)("span",{children:["You have ",$?.awaitingArrangerSignature," document(s) awaiting your signature."]}),(0,t.jsx)(h.Button,{variant:"link",asChild:!0,className:"p-0 h-auto text-purple-500",children:(0,t.jsx)(d.default,{href:"/versotech_main/versosign",children:"Sign Now →"})})]})]})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,t.jsx)(n.Card,{className:m?"bg-white/5 border-white/10":"",children:(0,t.jsx)(n.CardContent,{className:"pt-6",children:(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsx)("div",{className:"p-3 rounded-full bg-pink-500/20",children:(0,t.jsx)(B.Users,{className:"h-6 w-6 text-pink-500"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:`text-2xl font-bold ${m?"text-white":"text-gray-900"}`,children:u?.totalPartners||0}),(0,t.jsx)("p",{className:`text-sm ${m?"text-gray-400":"text-gray-500"}`,children:"Partners"})]})]})})}),(0,t.jsx)(n.Card,{className:m?"bg-white/5 border-white/10":"",children:(0,t.jsx)(n.CardContent,{className:"pt-6",children:(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsx)("div",{className:"p-3 rounded-full bg-orange-500/20",children:(0,t.jsx)(E.UserPlus,{className:"h-6 w-6 text-orange-500"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:`text-2xl font-bold ${m?"text-white":"text-gray-900"}`,children:u?.totalIntroducers||0}),(0,t.jsx)("p",{className:`text-sm ${m?"text-gray-400":"text-gray-500"}`,children:"Introducers"})]})]})})}),(0,t.jsx)(n.Card,{className:m?"bg-white/5 border-white/10":"",children:(0,t.jsx)(n.CardContent,{className:"pt-6",children:(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsx)("div",{className:"p-3 rounded-full bg-cyan-500/20",children:(0,t.jsx)(j.Building2,{className:"h-6 w-6 text-cyan-500"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:`text-2xl font-bold ${m?"text-white":"text-gray-900"}`,children:u?.totalCommercialPartners||0}),(0,t.jsx)("p",{className:`text-sm ${m?"text-gray-400":"text-gray-500"}`,children:"Commercial Partners"})]})]})})})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,t.jsxs)(n.Card,{className:m?"bg-white/5 border-white/10":"",children:[(0,t.jsxs)(n.CardHeader,{className:"flex flex-row items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(n.CardTitle,{className:m?"text-white":"",children:"Recent Mandates"}),(0,t.jsx)(n.CardDescription,{children:"Your managed deals"})]}),(0,t.jsx)(h.Button,{variant:"ghost",size:"sm",asChild:!0,children:(0,t.jsxs)(d.default,{href:"/versotech_main/my-mandates",children:["View All",(0,t.jsx)(V.ArrowRight,{className:"h-4 w-4 ml-1"})]})})]}),(0,t.jsx)(n.CardContent,{children:0===b.length?(0,t.jsxs)("div",{className:"text-center py-8",children:[(0,t.jsx)(Q.Briefcase,{className:`h-10 w-10 mx-auto mb-3 ${m?"text-gray-600":"text-gray-400"}`}),(0,t.jsx)("p",{className:`text-sm ${m?"text-gray-400":"text-gray-500"}`,children:"No mandates assigned yet"}),(0,t.jsx)("p",{className:`text-xs ${m?"text-gray-500":"text-gray-400"} mt-1`,children:"Contact the VERSO team to be assigned mandates"})]}):(0,t.jsx)("div",{className:"space-y-3",children:b.map(e=>(0,t.jsxs)(d.default,{href:"/versotech_main/my-mandates",className:`flex items-center justify-between p-3 rounded-lg transition-colors ${m?"bg-white/5 hover:bg-white/10":"bg-gray-50 hover:bg-gray-100"}`,children:[(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsx)("p",{className:`font-medium truncate ${m?"text-white":"text-gray-900"}`,children:e.name}),(0,t.jsx)("p",{className:`text-sm ${m?"text-gray-400":"text-gray-500"}`,children:e.target_amount?`${(0,G.formatCurrency)(e.target_amount,e.currency)} target`:"No target set"})]}),(0,t.jsx)(l.Badge,{className:D[e.status]||"bg-gray-500/20 text-gray-400",children:e.status})]},e.id))})})]}),(0,t.jsxs)(n.Card,{className:m?"bg-white/5 border-white/10":"",children:[(0,t.jsxs)(n.CardHeader,{className:"flex flex-row items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(n.CardTitle,{className:m?"text-white":"",children:"Pending Agreements"}),(0,t.jsx)(n.CardDescription,{children:"Agreements awaiting action"})]}),(0,t.jsx)(h.Button,{variant:"ghost",size:"sm",asChild:!0,children:(0,t.jsxs)(d.default,{href:"/versotech_main/versosign",children:["View All",(0,t.jsx)(V.ArrowRight,{className:"h-4 w-4 ml-1"})]})})]}),(0,t.jsx)(n.CardContent,{children:0===v.length?(0,t.jsxs)("div",{className:"text-center py-8",children:[(0,t.jsx)(P.FileSignature,{className:`h-10 w-10 mx-auto mb-3 ${m?"text-gray-600":"text-gray-400"}`}),(0,t.jsx)("p",{className:`text-sm ${m?"text-gray-400":"text-gray-500"}`,children:"No pending agreements"}),(0,t.jsx)("p",{className:`text-xs ${m?"text-gray-500":"text-gray-400"} mt-1`,children:"All agreements are up to date"})]}):(0,t.jsx)("div",{className:"space-y-3",children:v.map(e=>(0,t.jsxs)("div",{className:`flex items-center justify-between p-3 rounded-lg ${m?"bg-white/5":"bg-gray-50"}`,children:[(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsx)("p",{className:`font-medium truncate ${m?"text-white":"text-gray-900"}`,children:e.entity_name}),(0,t.jsx)("p",{className:`text-sm ${m?"text-gray-400":"text-gray-500"}`,children:"introducer"===e.entity_type?"Introducer Agreement":"Placement Agreement"})]}),(0,t.jsx)(l.Badge,{className:T[e.status]||"bg-gray-500/20 text-gray-400",children:R[e.status]||e.status})]},e.id))})})]})]}),(0,t.jsxs)(n.Card,{className:m?"bg-white/5 border-white/10":"",children:[(0,t.jsxs)(n.CardHeader,{children:[(0,t.jsx)(n.CardTitle,{className:m?"text-white":"",children:"Quick Actions"}),(0,t.jsx)(n.CardDescription,{children:"Common tasks and workflows"})]}),(0,t.jsx)(n.CardContent,{children:(0,t.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[(0,t.jsx)(h.Button,{variant:"outline",asChild:!0,className:"h-auto py-4 flex-col gap-2",children:(0,t.jsxs)(d.default,{href:"/versotech_main/my-mandates",children:[(0,t.jsx)(Q.Briefcase,{className:"h-5 w-5"}),(0,t.jsx)("span",{children:"View Mandates"})]})}),(0,t.jsx)(h.Button,{variant:"outline",asChild:!0,className:"h-auto py-4 flex-col gap-2",children:(0,t.jsxs)(d.default,{href:"/versotech_main/my-partners",children:[(0,t.jsx)(B.Users,{className:"h-5 w-5"}),(0,t.jsx)("span",{children:"My Partners"})]})}),(0,t.jsx)(h.Button,{variant:"outline",asChild:!0,className:"h-auto py-4 flex-col gap-2",children:(0,t.jsxs)(d.default,{href:"/versotech_main/my-introducers",children:[(0,t.jsx)(E.UserPlus,{className:"h-5 w-5"}),(0,t.jsx)("span",{children:"My Introducers"})]})}),(0,t.jsx)(h.Button,{variant:"outline",asChild:!0,className:"h-auto py-4 flex-col gap-2",children:(0,t.jsxs)(d.default,{href:"/versotech_main/versosign",children:[(0,t.jsx)(P.FileSignature,{className:"h-5 w-5"}),(0,t.jsx)("span",{children:"VERSOSign"})]})})]})})]})]})}function eb({commercialPartnerId:e,userId:a,persona:c}){let{theme:o}=(0,r.useTheme)(),m="staff-dark"===o,[x,g]=(0,s.useState)(!0),[u,p]=(0,s.useState)(null),[f,y]=(0,s.useState)(null),[N,v]=(0,s.useState)([]),[w,_]=(0,s.useState)([]),[C,$]=(0,s.useState)(!1);if((0,s.useEffect)(()=>{!async function(){try{let t=(0,i.createClient)(),{data:s}=await t.from("commercial_partners").select("id, name, legal_name, status, kyc_status, cp_type").eq("id",e).maybeSingle();s&&y({name:s.name,legal_name:s.legal_name,status:s.status,kyc_status:s.kyc_status,cp_type:s.cp_type});let{data:r}=await t.from("commercial_partner_users").select("can_execute_for_clients").eq("commercial_partner_id",e).eq("user_id",a).maybeSingle();$(r?.can_execute_for_clients||!1);let{data:n,count:l}=await t.from("commercial_partner_clients").select("id, is_active, client_investor_id",{count:"exact"}).eq("commercial_partner_id",e),d=(n||[]).filter(e=>e.is_active).length,c=(n||[]).filter(e=>e.client_investor_id).map(e=>e.client_investor_id),{data:o}=await t.from("investor_users").select("investor_id").eq("user_id",a),m=(o||[]).map(e=>e.investor_id),{data:x}=await t.from("deal_memberships").select("deal_id, role").eq("user_id",a).in("role",["commercial_partner_investor","commercial_partner_proxy"]),h=(x||[]).length,g=(x||[]).map(e=>e.deal_id),u=0;if(g.length>0){let{count:e}=await t.from("deals").select("id",{count:"exact",head:!0}).in("id",g).in("status",["open","allocation_pending","active"]);u=e||0}let f=0,j=0,b=0,N=0,w=[];if(m.length>0){let{data:e}=await t.from("subscriptions").select(`
              id, commitment, status, created_at,
              deals (id, name),
              investors (id, legal_name)
            `).in("investor_id",m).order("created_at",{ascending:!1}).limit(10);(e||[]).forEach(e=>{["committed","active","signed","funded"].includes(e.status)&&(f+=e.commitment||0),b++,"pending"===e.status&&N++,w.push({id:e.id,deal_name:e.deals?.name||"Unknown Deal",investor_name:"My Investment",commitment:e.commitment||0,status:e.status,created_at:e.created_at,is_proxy:!1})})}if(c.length>0){let{data:e}=await t.from("subscriptions").select(`
              id, commitment, status, created_at,
              deals (id, name),
              investors (id, legal_name)
            `).in("investor_id",c).order("created_at",{ascending:!1}).limit(10);(e||[]).forEach(e=>{["committed","active","signed","funded"].includes(e.status)&&(j+=e.commitment||0),b++,"pending"===e.status&&N++,w.push({id:e.id,deal_name:e.deals?.name||"Unknown Deal",investor_name:e.investors?.legal_name||"Client",commitment:e.commitment||0,status:e.status,created_at:e.created_at,is_proxy:!0})})}w.sort((e,t)=>new Date(t.created_at).getTime()-new Date(e.created_at).getTime()),v(w.slice(0,5));let{data:C}=await t.from("placement_agreements").select("id, agreement_type, status, default_commission_bps, created_at").eq("commercial_partner_id",e).order("created_at",{ascending:!1});_(C||[]);let S=(C||[]).filter(e=>["sent","pending_approval","approved","pending_ceo_signature","pending_cp_signature"].includes(e.status)).length,A=(C||[]).filter(e=>"active"===e.status).length,k=0,D=0,T=0,{data:E}=await t.from("commercial_partner_commissions").select("status, accrual_amount").eq("commercial_partner_id",e);E&&E.length>0&&E.forEach(e=>{let t=parseFloat(e.accrual_amount)||0;switch(e.status){case"paid":k+=t;break;case"accrued":D+=t;break;case"invoice_requested":case"invoiced":T+=t}}),p({totalClients:l||0,activeClients:d,dispatchedDeals:h,activeOpportunities:u,totalSubscriptions:b,pendingSubscriptions:N,ownInvestmentValue:f,clientInvestmentValue:j,pendingAgreements:S,activeAgreements:A,commissionPaid:k,commissionAccrued:D,commissionPending:T})}catch(e){console.error("Error fetching commercial partner data:",e)}finally{g(!1)}}()},[e,a]),x)return(0,t.jsxs)("div",{className:"p-8 text-center flex flex-col items-center gap-3",children:[(0,t.jsx)(M.Loader2,{className:"h-8 w-8 animate-spin text-gray-400"}),(0,t.jsx)("p",{className:"text-gray-500",children:"Loading dashboard..."})]});let S={pending:"bg-amber-500/20 text-amber-400",committed:"bg-blue-500/20 text-blue-400",active:"bg-green-500/20 text-green-400",signed:"bg-purple-500/20 text-purple-400",funded:"bg-emerald-500/20 text-emerald-400",cancelled:"bg-red-500/20 text-red-400",rejected:"bg-red-500/20 text-red-400"},A={draft:"bg-gray-500/20 text-gray-400",sent:"bg-blue-500/20 text-blue-400",pending_approval:"bg-amber-500/20 text-amber-400",approved:"bg-green-500/20 text-green-400",pending_ceo_signature:"bg-purple-500/20 text-purple-400",pending_cp_signature:"bg-indigo-500/20 text-indigo-400",active:"bg-emerald-500/20 text-emerald-400",expired:"bg-red-500/20 text-red-400",terminated:"bg-red-500/20 text-red-400"},k={draft:"Draft",sent:"Sent",pending_approval:"Pending Approval",approved:"Approved",pending_ceo_signature:"Awaiting CEO Signature",pending_cp_signature:"Your Signature Required",active:"Active",expired:"Expired",terminated:"Terminated"};return(0,t.jsxs)("div",{className:"p-6 space-y-6",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:`text-2xl font-bold ${m?"text-white":"text-gray-900"}`,children:"Commercial Partner Dashboard"}),(0,t.jsx)("p",{className:`mt-1 ${m?"text-gray-400":"text-gray-600"}`,children:f?.legal_name||f?.name||c.entity_name})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[f?.cp_type&&(0,t.jsx)(l.Badge,{variant:"outline",className:m?"border-gray-600":"",children:f.cp_type.replace(/_/g," ").toUpperCase()}),f?.kyc_status&&(0,t.jsxs)(l.Badge,{variant:"outline",className:"approved"===f.kyc_status?"border-green-500/50 text-green-500":"pending"===f.kyc_status?"border-amber-500/50 text-amber-500":"border-gray-500/50 text-gray-500",children:["KYC: ",f.kyc_status]})]})]}),f&&"active"!==f.status&&(0,t.jsx)(n.Card,{className:`border-amber-500/30 ${m?"bg-amber-500/10":"bg-amber-50"}`,children:(0,t.jsx)(n.CardContent,{className:"py-4",children:(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("div",{className:"p-2 rounded-full bg-amber-500/20",children:(0,t.jsx)(ec.AlertCircle,{className:"h-5 w-5 text-amber-500"})}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("p",{className:`font-medium ${m?"text-white":"text-gray-900"}`,children:["Account ","pending"===f.status?"Pending Approval":"Inactive"]}),(0,t.jsx)("p",{className:`text-sm ${m?"text-gray-400":"text-gray-600"}`,children:"pending"===f.status?"Your commercial partner account is pending approval. Contact the VERSO team for status updates.":"Your commercial partner account is currently inactive. Contact the VERSO team for assistance."})]})]})})}),u&&u.pendingAgreements>0&&(0,t.jsx)(n.Card,{className:`border-orange-500/30 ${m?"bg-orange-500/10":"bg-orange-50"}`,children:(0,t.jsx)(n.CardContent,{className:"py-4",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("div",{className:"p-2 rounded-full bg-orange-500/20",children:(0,t.jsx)(P.FileSignature,{className:"h-5 w-5 text-orange-500"})}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("p",{className:`font-medium ${m?"text-white":"text-gray-900"}`,children:[u.pendingAgreements," Pending Agreement",1!==u.pendingAgreements?"s":""]}),(0,t.jsx)("p",{className:`text-sm ${m?"text-gray-400":"text-gray-600"}`,children:"Agreements awaiting approval or signature"})]})]}),(0,t.jsx)(h.Button,{asChild:!0,children:(0,t.jsxs)(d.default,{href:"/versotech_main/placement-agreements",children:["View Agreements",(0,t.jsx)(V.ArrowRight,{className:"h-4 w-4 ml-2"})]})})]})})}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,t.jsxs)(n.Card,{className:m?"bg-white/5 border-white/10":"",children:[(0,t.jsxs)(n.CardHeader,{className:"flex flex-row items-center justify-between pb-2",children:[(0,t.jsx)(n.CardTitle,{className:`text-sm font-medium ${m?"text-gray-400":"text-gray-500"}`,children:"Clients Managed"}),(0,t.jsx)(B.Users,{className:`h-4 w-4 ${m?"text-gray-500":"text-gray-400"}`})]}),(0,t.jsxs)(n.CardContent,{children:[(0,t.jsx)("div",{className:`text-2xl font-bold ${m?"text-white":"text-gray-900"}`,children:u?.totalClients||0}),(0,t.jsxs)("p",{className:"text-xs text-gray-500",children:[u?.activeClients||0," active clients"]})]})]}),(0,t.jsxs)(n.Card,{className:m?"bg-white/5 border-white/10":"",children:[(0,t.jsxs)(n.CardHeader,{className:"flex flex-row items-center justify-between pb-2",children:[(0,t.jsx)(n.CardTitle,{className:`text-sm font-medium ${m?"text-gray-400":"text-gray-500"}`,children:"Active Opportunities"}),(0,t.jsx)(R.TrendingUp,{className:`h-4 w-4 ${m?"text-gray-500":"text-gray-400"}`})]}),(0,t.jsxs)(n.CardContent,{children:[(0,t.jsx)("div",{className:`text-2xl font-bold ${m?"text-white":"text-gray-900"}`,children:u?.activeOpportunities||0}),(0,t.jsxs)("p",{className:"text-xs text-gray-500",children:[u?.dispatchedDeals||0," total dispatched"]})]})]}),(0,t.jsxs)(n.Card,{className:m?"bg-white/5 border-white/10":"",children:[(0,t.jsxs)(n.CardHeader,{className:"flex flex-row items-center justify-between pb-2",children:[(0,t.jsx)(n.CardTitle,{className:`text-sm font-medium ${m?"text-gray-400":"text-gray-500"}`,children:"Client Investments"}),(0,t.jsx)(I.DollarSign,{className:`h-4 w-4 ${m?"text-gray-500":"text-gray-400"}`})]}),(0,t.jsxs)(n.CardContent,{children:[(0,t.jsx)("div",{className:"text-2xl font-bold text-green-500",children:(0,G.formatCurrency)(u?.clientInvestmentValue||0)}),(0,t.jsx)("p",{className:"text-xs text-gray-500",children:"Via proxy subscriptions"})]})]}),(0,t.jsxs)(n.Card,{className:m?"bg-white/5 border-white/10":"",children:[(0,t.jsxs)(n.CardHeader,{className:"flex flex-row items-center justify-between pb-2",children:[(0,t.jsx)(n.CardTitle,{className:`text-sm font-medium ${m?"text-gray-400":"text-gray-500"}`,children:"Own Investments"}),(0,t.jsx)(Q.Briefcase,{className:`h-4 w-4 ${m?"text-gray-500":"text-gray-400"}`})]}),(0,t.jsxs)(n.CardContent,{children:[(0,t.jsx)("div",{className:`text-2xl font-bold ${m?"text-white":"text-gray-900"}`,children:(0,G.formatCurrency)(u?.ownInvestmentValue||0)}),(0,t.jsx)("p",{className:"text-xs text-gray-500",children:"Direct investments"})]})]})]}),(u?.commissionPaid||0)+(u?.commissionAccrued||0)+(u?.commissionPending||0)>0&&(0,t.jsxs)(n.Card,{className:m?"bg-white/5 border-white/10":"",children:[(0,t.jsx)(n.CardHeader,{children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(n.CardTitle,{className:m?"text-white":"",children:"Commission Earnings"}),(0,t.jsx)(n.CardDescription,{children:"Your commission totals across all deals"})]}),(0,t.jsx)("div",{className:"p-2 rounded-full bg-purple-500/20",children:(0,t.jsx)(I.DollarSign,{className:"h-5 w-5 text-purple-500"})})]})}),(0,t.jsx)(n.CardContent,{children:(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,t.jsxs)("div",{className:`p-4 rounded-lg ${m?"bg-white/5":"bg-green-50"}`,children:[(0,t.jsx)("p",{className:`text-xs font-medium ${m?"text-gray-400":"text-gray-500"} mb-1`,children:"Paid"}),(0,t.jsx)("p",{className:"text-xl font-bold text-green-500",children:(0,G.formatCurrency)(u?.commissionPaid||0)})]}),(0,t.jsxs)("div",{className:`p-4 rounded-lg ${m?"bg-white/5":"bg-blue-50"}`,children:[(0,t.jsx)("p",{className:`text-xs font-medium ${m?"text-gray-400":"text-gray-500"} mb-1`,children:"Accrued"}),(0,t.jsx)("p",{className:"text-xl font-bold text-blue-500",children:(0,G.formatCurrency)(u?.commissionAccrued||0)})]}),(0,t.jsxs)("div",{className:`p-4 rounded-lg ${m?"bg-white/5":"bg-amber-50"}`,children:[(0,t.jsx)("p",{className:`text-xs font-medium ${m?"text-gray-400":"text-gray-500"} mb-1`,children:"Pending"}),(0,t.jsx)("p",{className:"text-xl font-bold text-amber-500",children:(0,G.formatCurrency)(u?.commissionPending||0)})]})]})})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,t.jsx)(n.Card,{className:m?"bg-white/5 border-white/10":"",children:(0,t.jsx)(n.CardContent,{className:"pt-6",children:(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsx)("div",{className:"p-3 rounded-full bg-blue-500/20",children:(0,t.jsx)(b.FileText,{className:"h-6 w-6 text-blue-500"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:`text-2xl font-bold ${m?"text-white":"text-gray-900"}`,children:u?.totalSubscriptions||0}),(0,t.jsxs)("p",{className:`text-sm ${m?"text-gray-400":"text-gray-500"}`,children:["Total Subscriptions (",u?.pendingSubscriptions||0," pending)"]})]})]})})}),(0,t.jsx)(n.Card,{className:m?"bg-white/5 border-white/10":"",children:(0,t.jsx)(n.CardContent,{className:"pt-6",children:(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsx)("div",{className:"p-3 rounded-full bg-emerald-500/20",children:(0,t.jsx)(z.CheckCircle2,{className:"h-6 w-6 text-emerald-500"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:`text-2xl font-bold ${m?"text-white":"text-gray-900"}`,children:u?.activeAgreements||0}),(0,t.jsx)("p",{className:`text-sm ${m?"text-gray-400":"text-gray-500"}`,children:"Active Placement Agreements"})]})]})})})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,t.jsxs)(n.Card,{className:m?"bg-white/5 border-white/10":"",children:[(0,t.jsxs)(n.CardHeader,{className:"flex flex-row items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(n.CardTitle,{className:m?"text-white":"",children:"Recent Transactions"}),(0,t.jsx)(n.CardDescription,{children:"Latest subscription activity"})]}),(0,t.jsx)(h.Button,{variant:"ghost",size:"sm",asChild:!0,children:(0,t.jsxs)(d.default,{href:"/versotech_main/client-transactions",children:["View All",(0,t.jsx)(V.ArrowRight,{className:"h-4 w-4 ml-1"})]})})]}),(0,t.jsx)(n.CardContent,{children:0===N.length?(0,t.jsxs)("div",{className:"text-center py-8",children:[(0,t.jsx)(b.FileText,{className:`h-10 w-10 mx-auto mb-3 ${m?"text-gray-600":"text-gray-400"}`}),(0,t.jsx)("p",{className:`text-sm ${m?"text-gray-400":"text-gray-500"}`,children:"No subscriptions yet"}),(0,t.jsx)("p",{className:`text-xs ${m?"text-gray-500":"text-gray-400"} mt-1`,children:"Browse opportunities to start investing"})]}):(0,t.jsx)("div",{className:"space-y-3",children:N.map(e=>(0,t.jsxs)("div",{className:`flex items-center justify-between p-3 rounded-lg ${m?"bg-white/5":"bg-gray-50"}`,children:[(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("p",{className:`font-medium truncate ${m?"text-white":"text-gray-900"}`,children:e.deal_name}),e.is_proxy&&(0,t.jsx)(l.Badge,{variant:"outline",className:"text-xs",children:"Proxy"})]}),(0,t.jsxs)("p",{className:`text-sm ${m?"text-gray-400":"text-gray-500"}`,children:[e.investor_name," • ",(0,G.formatCurrency)(e.commitment)]})]}),(0,t.jsx)(l.Badge,{className:S[e.status]||"bg-gray-500/20 text-gray-400",children:e.status})]},e.id))})})]}),(0,t.jsxs)(n.Card,{className:m?"bg-white/5 border-white/10":"",children:[(0,t.jsxs)(n.CardHeader,{className:"flex flex-row items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(n.CardTitle,{className:m?"text-white":"",children:"Placement Agreements"}),(0,t.jsx)(n.CardDescription,{children:"Your commission agreements"})]}),(0,t.jsx)(h.Button,{variant:"ghost",size:"sm",asChild:!0,children:(0,t.jsxs)(d.default,{href:"/versotech_main/placement-agreements",children:["View All",(0,t.jsx)(V.ArrowRight,{className:"h-4 w-4 ml-1"})]})})]}),(0,t.jsx)(n.CardContent,{children:0===w.length?(0,t.jsxs)("div",{className:"text-center py-8",children:[(0,t.jsx)(P.FileSignature,{className:`h-10 w-10 mx-auto mb-3 ${m?"text-gray-600":"text-gray-400"}`}),(0,t.jsx)("p",{className:`text-sm ${m?"text-gray-400":"text-gray-500"}`,children:"No placement agreements"}),(0,t.jsx)("p",{className:`text-xs ${m?"text-gray-500":"text-gray-400"} mt-1`,children:"Agreements will appear here once created"})]}):(0,t.jsx)("div",{className:"space-y-3",children:w.slice(0,5).map(e=>(0,t.jsxs)(d.default,{href:`/versotech_main/placement-agreements/${e.id}`,className:`flex items-center justify-between p-3 rounded-lg transition-colors ${m?"bg-white/5 hover:bg-white/10":"bg-gray-50 hover:bg-gray-100"}`,children:[(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsxs)("p",{className:`font-medium ${m?"text-white":"text-gray-900"}`,children:[e.agreement_type.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase())," Agreement"]}),(0,t.jsxs)("p",{className:`text-sm ${m?"text-gray-400":"text-gray-500"}`,children:["Commission: ",(e.default_commission_bps/100).toFixed(2),"%"]})]}),(0,t.jsx)(l.Badge,{className:A[e.status]||"bg-gray-500/20 text-gray-400",children:k[e.status]||e.status})]},e.id))})})]})]}),(0,t.jsxs)(n.Card,{className:m?"bg-white/5 border-white/10":"",children:[(0,t.jsxs)(n.CardHeader,{children:[(0,t.jsx)(n.CardTitle,{className:m?"text-white":"",children:"Quick Actions"}),(0,t.jsx)(n.CardDescription,{children:"Common tasks and workflows"})]}),(0,t.jsx)(n.CardContent,{children:(0,t.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[(0,t.jsx)(h.Button,{variant:"outline",asChild:!0,className:"h-auto py-4 flex-col gap-2",children:(0,t.jsxs)(d.default,{href:"/versotech_main/opportunities",children:[(0,t.jsx)(R.TrendingUp,{className:"h-5 w-5"}),(0,t.jsx)("span",{children:"View Opportunities"})]})}),C&&(0,t.jsx)(h.Button,{variant:"outline",asChild:!0,className:"h-auto py-4 flex-col gap-2",children:(0,t.jsxs)(d.default,{href:"/versotech_main/client-transactions",children:[(0,t.jsx)(B.Users,{className:"h-5 w-5"}),(0,t.jsx)("span",{children:"Client Transactions"})]})}),(0,t.jsx)(h.Button,{variant:"outline",asChild:!0,className:"h-auto py-4 flex-col gap-2",children:(0,t.jsxs)(d.default,{href:"/versotech_main/portfolio",children:[(0,t.jsx)(Q.Briefcase,{className:"h-5 w-5"}),(0,t.jsx)("span",{children:"My Portfolio"})]})}),(0,t.jsx)(h.Button,{variant:"outline",asChild:!0,className:"h-auto py-4 flex-col gap-2",children:(0,t.jsxs)(d.default,{href:"/versotech_main/placement-agreements",children:[(0,t.jsx)(P.FileSignature,{className:"h-5 w-5"}),(0,t.jsx)("span",{children:"Agreements"})]})})]})})]}),(0,t.jsx)(n.Card,{className:`${m?"bg-cyan-500/10 border-cyan-500/20":"bg-cyan-50 border-cyan-200"}`,children:(0,t.jsx)(n.CardContent,{className:"py-4",children:(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("div",{className:"h-10 w-10 rounded-full bg-cyan-500 flex items-center justify-center",children:(0,t.jsx)(j.Building2,{className:"h-5 w-5 text-white"})}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("div",{className:`font-medium ${m?"text-white":"text-gray-900"}`,children:"Commercial Partner Capabilities"}),(0,t.jsx)("div",{className:`text-sm ${m?"text-gray-400":"text-gray-600"}`,children:C?(0,t.jsxs)(t.Fragment,{children:["You can invest directly ",(0,t.jsx)("strong",{children:"(MODE 1)"})," and execute on behalf of clients ",(0,t.jsx)("strong",{children:"(MODE 2)"}),"."]}):(0,t.jsxs)(t.Fragment,{children:["You can invest directly ",(0,t.jsx)("strong",{children:"(MODE 1)"}),". Contact admin to enable client execution."]})})]})]})})})]})}var eN=e.i(263674);let ev=(0,e.i(410587).default)("arrow-left-right",[["path",{d:"M8 3 4 7l4 4",key:"9rb6wj"}],["path",{d:"M4 7h16",key:"6tx8e3"}],["path",{d:"m16 21 4-4-4-4",key:"siv7j2"}],["path",{d:"M20 17H4",key:"h6l3hr"}]]),ew={staff:j.Building2,investor:C.User,arranger:Q.Briefcase,introducer:E.UserPlus,partner:B.Users,commercial_partner:j.Building2,lawyer:em.Scale},e_={staff:"bg-blue-500",investor:"bg-green-500",arranger:"bg-purple-500",introducer:"bg-orange-500",partner:"bg-pink-500",commercial_partner:"bg-cyan-500",lawyer:"bg-indigo-500"};async function eC(e){try{let t=(0,i.createClient)(),{data:s}=await t.from("investor_users").select("investor_id").eq("user_id",e).limit(1);if(!s||0===s.length){let{data:s}=await t.from("subscriptions").select("id").or(`investor_id.in.(select investor_id from investor_users where user_id=${e})`).limit(1);return{hasInvestments:!1,investorId:null,investmentCount:0}}let a=s[0].investor_id,{data:r,count:n}=await t.from("subscriptions").select("id",{count:"exact",head:!0}).eq("investor_id",a).in("status",["active","signed","funded","pending"]);return{hasInvestments:(n||0)>0,investorId:a,investmentCount:n||0}}catch(e){return console.error("Error checking investments:",e),{hasInvestments:!1,investorId:null,investmentCount:0}}}function e$(){let{activePersona:e,personas:d,isCEO:c}=(0,a.usePersona)(),{theme:o}=(0,r.useTheme)(),[m,x]=(0,s.useState)(null),[h,g]=(0,s.useState)(!0),[u,p]=(0,s.useState)(null),[f,y]=(0,s.useState)("partner");(0,s.useEffect)(()=>{!async function(){let e=(0,i.createClient)(),{data:{user:t}}=await e.auth.getUser();x(t?.id??null),g(!1)}()},[]),(0,s.useEffect)(()=>{!async function(){m&&e&&("partner"===e.persona_type||"introducer"===e.persona_type)&&p(await eC(m))}()},[m,e]);let N="staff-dark"===o;if(h||!e)return(0,t.jsxs)("div",{className:"p-8 text-center flex flex-col items-center gap-3",children:[(0,t.jsx)(M.Loader2,{className:"h-8 w-8 animate-spin text-gray-400"}),(0,t.jsx)("p",{className:"text-gray-500",children:"Loading dashboard..."})]});if("investor"===e.persona_type&&m)return(0,t.jsx)(D,{investorId:e.entity_id,userId:m,persona:e});if("introducer"===e.persona_type&&m)return u?.hasInvestments&&u.investorId?(0,t.jsxs)("div",{className:"space-y-5",children:[(0,t.jsxs)("div",{className:`
            relative overflow-hidden rounded-xl
            ${N?"bg-zinc-900/80 border border-zinc-800":"bg-gradient-to-br from-slate-50 via-white to-stone-50 border border-slate-200/80 shadow-sm"}
          `,children:[(0,t.jsx)("div",{className:"absolute inset-0 opacity-[0.015] pointer-events-none",style:{backgroundImage:`url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23${N?"ffffff":"000000"}' fill-opacity='1'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E")`}}),(0,t.jsx)("div",{className:"relative px-5 py-4",children:(0,t.jsxs)("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsx)("div",{className:`
                    h-11 w-11 rounded-xl flex items-center justify-center
                    ${N?"bg-zinc-800 ring-1 ring-zinc-700":"bg-white ring-1 ring-slate-200 shadow-sm"}
                  `,children:(0,t.jsx)(ev,{className:`h-5 w-5 ${N?"text-zinc-400":"text-slate-500"}`})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:`text-sm font-semibold tracking-tight ${N?"text-zinc-100":"text-slate-800"}`,children:"Dual Role Access"}),(0,t.jsxs)("p",{className:`text-[13px] ${N?"text-zinc-500":"text-slate-500"}`,children:["Introducer · ",u.investmentCount," investment",1!==u.investmentCount?"s":""]})]})]}),(0,t.jsxs)("div",{className:`
                  inline-flex p-1 rounded-lg
                  ${N?"bg-zinc-800/80 ring-1 ring-zinc-700/50":"bg-slate-100/80 ring-1 ring-slate-200/50"}
                `,children:[(0,t.jsxs)("button",{onClick:()=>y("partner"),className:`
                      relative px-4 py-2 rounded-md text-sm font-medium transition-all duration-200
                      flex items-center gap-2
                      ${"partner"===f?N?"bg-zinc-700 text-white shadow-sm ring-1 ring-zinc-600":"bg-white text-slate-900 shadow-sm ring-1 ring-slate-200":N?"text-zinc-400 hover:text-zinc-200":"text-slate-500 hover:text-slate-700"}
                    `,children:[(0,t.jsx)(E.UserPlus,{className:"h-4 w-4"}),(0,t.jsx)("span",{children:"Referrals"})]}),(0,t.jsxs)("button",{onClick:()=>y("investor"),className:`
                      relative px-4 py-2 rounded-md text-sm font-medium transition-all duration-200
                      flex items-center gap-2
                      ${"investor"===f?N?"bg-zinc-700 text-white shadow-sm ring-1 ring-zinc-600":"bg-white text-slate-900 shadow-sm ring-1 ring-slate-200":N?"text-zinc-400 hover:text-zinc-200":"text-slate-500 hover:text-slate-700"}
                    `,children:[(0,t.jsx)(Y.Wallet,{className:"h-4 w-4"}),(0,t.jsx)("span",{children:"Portfolio"})]})]})]})})]}),"partner"===f?(0,t.jsx)(K,{introducerId:e.entity_id,userId:m,persona:e}):(0,t.jsx)(D,{investorId:u.investorId,userId:m,persona:{...e,persona_type:"investor",entity_id:u.investorId,entity_name:"My Investments"}})]}):(0,t.jsx)(K,{introducerId:e.entity_id,userId:m,persona:e});if("partner"===e.persona_type&&m)return u?.hasInvestments&&u.investorId?(0,t.jsxs)("div",{className:"space-y-5",children:[(0,t.jsxs)("div",{className:`
            relative overflow-hidden rounded-xl
            ${N?"bg-zinc-900/80 border border-zinc-800":"bg-gradient-to-br from-slate-50 via-white to-stone-50 border border-slate-200/80 shadow-sm"}
          `,children:[(0,t.jsx)("div",{className:"absolute inset-0 opacity-[0.015] pointer-events-none",style:{backgroundImage:`url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23${N?"ffffff":"000000"}' fill-opacity='1'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E")`}}),(0,t.jsx)("div",{className:"relative px-5 py-4",children:(0,t.jsxs)("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsx)("div",{className:`
                    h-11 w-11 rounded-xl flex items-center justify-center
                    ${N?"bg-zinc-800 ring-1 ring-zinc-700":"bg-white ring-1 ring-slate-200 shadow-sm"}
                  `,children:(0,t.jsx)(ev,{className:`h-5 w-5 ${N?"text-zinc-400":"text-slate-500"}`})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:`text-sm font-semibold tracking-tight ${N?"text-zinc-100":"text-slate-800"}`,children:"Dual Role Access"}),(0,t.jsxs)("p",{className:`text-[13px] ${N?"text-zinc-500":"text-slate-500"}`,children:["Partner · ",u.investmentCount," investment",1!==u.investmentCount?"s":""]})]})]}),(0,t.jsxs)("div",{className:`
                  inline-flex p-1 rounded-lg
                  ${N?"bg-zinc-800/80 ring-1 ring-zinc-700/50":"bg-slate-100/80 ring-1 ring-slate-200/50"}
                `,children:[(0,t.jsxs)("button",{onClick:()=>y("partner"),className:`
                      relative px-4 py-2 rounded-md text-sm font-medium transition-all duration-200
                      flex items-center gap-2
                      ${"partner"===f?N?"bg-zinc-700 text-white shadow-sm ring-1 ring-zinc-600":"bg-white text-slate-900 shadow-sm ring-1 ring-slate-200":N?"text-zinc-400 hover:text-zinc-200":"text-slate-500 hover:text-slate-700"}
                    `,children:[(0,t.jsx)(B.Users,{className:"h-4 w-4"}),(0,t.jsx)("span",{children:"Referrals"})]}),(0,t.jsxs)("button",{onClick:()=>y("investor"),className:`
                      relative px-4 py-2 rounded-md text-sm font-medium transition-all duration-200
                      flex items-center gap-2
                      ${"investor"===f?N?"bg-zinc-700 text-white shadow-sm ring-1 ring-zinc-600":"bg-white text-slate-900 shadow-sm ring-1 ring-slate-200":N?"text-zinc-400 hover:text-zinc-200":"text-slate-500 hover:text-slate-700"}
                    `,children:[(0,t.jsx)(Y.Wallet,{className:"h-4 w-4"}),(0,t.jsx)("span",{children:"Portfolio"})]})]})]})})]}),"partner"===f?(0,t.jsx)(ed,{partnerId:e.entity_id,userId:m,persona:e}):(0,t.jsx)(D,{investorId:u.investorId,userId:m,persona:{...e,persona_type:"investor",entity_id:u.investorId,entity_name:"My Investments"}})]}):(0,t.jsx)(ed,{partnerId:e.entity_id,userId:m,persona:e});if("lawyer"===e.persona_type&&m)return(0,t.jsx)(eo,{lawyerId:e.entity_id,userId:m,persona:e});if("arranger"===e.persona_type&&m)return(0,t.jsx)(ey,{arrangerId:e.entity_id,userId:m,persona:e});if("commercial_partner"===e.persona_type&&m)return(0,t.jsx)(eb,{commercialPartnerId:e.entity_id,userId:m,persona:e});let v=ew[e.persona_type]||C.User;return(0,t.jsxs)("div",{className:"p-6 space-y-6",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:`text-2xl font-bold ${N?"text-white":"text-gray-900"}`,children:"Welcome to VERSO"}),(0,t.jsx)("p",{className:`mt-1 ${N?"text-gray-400":"text-gray-600"}`,children:"Unified Platform Dashboard"})]}),(0,t.jsxs)("div",{className:`flex items-center gap-3 px-4 py-2 rounded-lg ${N?"bg-white/5 border border-white/10":"bg-gray-50 border border-gray-100"}`,children:[(0,t.jsx)("div",{className:`h-10 w-10 rounded-full ${e_[e.persona_type]} flex items-center justify-center`,children:(0,t.jsx)(v,{className:"h-5 w-5 text-white"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:`font-medium ${N?"text-white":"text-gray-900"}`,children:e.entity_name}),(0,t.jsx)("div",{className:`text-sm ${N?"text-gray-400":"text-gray-500"}`,children:"staff"===e.persona_type?"staff_admin"===e.role_in_entity||"ceo"===e.role_in_entity?"CEO":e.role_in_entity?.toUpperCase():e.persona_type.replace("_"," ").toUpperCase()})]})]})]}),(0,t.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:d.map(s=>{let a=ew[s.persona_type]||C.User,r=e?.entity_id===s.entity_id;return(0,t.jsxs)(n.Card,{className:`${N?"bg-white/5 border-white/10":"bg-white border-gray-200"} ${r?"ring-2 ring-blue-500":""}`,children:[(0,t.jsxs)(n.CardHeader,{className:"flex flex-row items-center gap-4 pb-2",children:[(0,t.jsx)("div",{className:`h-12 w-12 rounded-full ${e_[s.persona_type]} flex items-center justify-center`,children:(0,t.jsx)(a,{className:"h-6 w-6 text-white"})}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)(n.CardTitle,{className:`text-lg ${N?"text-white":"text-gray-900"}`,children:s.entity_name}),(0,t.jsx)(n.CardDescription,{className:N?"text-gray-400":"text-gray-500",children:"staff"===s.persona_type?"staff_admin"===s.role_in_entity||"ceo"===s.role_in_entity?"CEO":s.role_in_entity:s.persona_type.replace("_"," ")})]}),r&&(0,t.jsx)(l.Badge,{variant:"secondary",className:"bg-blue-500/20 text-blue-400",children:"Active"})]}),(0,t.jsx)(n.CardContent,{children:(0,t.jsxs)("div",{className:"flex gap-2 flex-wrap",children:[s.can_sign&&(0,t.jsx)(l.Badge,{variant:"outline",className:N?"border-white/20 text-gray-300":"",children:"Can Sign"}),s.can_execute_for_clients&&(0,t.jsx)(l.Badge,{variant:"outline",className:N?"border-white/20 text-gray-300":"",children:"Can Execute"}),s.is_primary&&(0,t.jsx)(l.Badge,{variant:"outline",className:N?"border-white/20 text-gray-300":"",children:"Primary"})]})})]},s.entity_id)})}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,t.jsxs)(n.Card,{className:N?"bg-white/5 border-white/10":"bg-white border-gray-200",children:[(0,t.jsxs)(n.CardHeader,{className:"flex flex-row items-center justify-between pb-2",children:[(0,t.jsx)(n.CardTitle,{className:`text-sm font-medium ${N?"text-gray-400":"text-gray-500"}`,children:"Pending Tasks"}),(0,t.jsx)(eN.CheckSquare,{className:`h-4 w-4 ${N?"text-gray-500":"text-gray-400"}`})]}),(0,t.jsxs)(n.CardContent,{children:[(0,t.jsx)("div",{className:`text-2xl font-bold ${N?"text-white":"text-gray-900"}`,children:"0"}),(0,t.jsx)("p",{className:"text-xs text-gray-500",children:"No pending tasks"})]})]}),(0,t.jsxs)(n.Card,{className:N?"bg-white/5 border-white/10":"bg-white border-gray-200",children:[(0,t.jsxs)(n.CardHeader,{className:"flex flex-row items-center justify-between pb-2",children:[(0,t.jsx)(n.CardTitle,{className:`text-sm font-medium ${N?"text-gray-400":"text-gray-500"}`,children:"Active Deals"}),(0,t.jsx)(R.TrendingUp,{className:`h-4 w-4 ${N?"text-gray-500":"text-gray-400"}`})]}),(0,t.jsxs)(n.CardContent,{children:[(0,t.jsx)("div",{className:`text-2xl font-bold ${N?"text-white":"text-gray-900"}`,children:"-"}),(0,t.jsx)("p",{className:"text-xs text-gray-500",children:"Data loading..."})]})]}),(0,t.jsxs)(n.Card,{className:N?"bg-white/5 border-white/10":"bg-white border-gray-200",children:[(0,t.jsxs)(n.CardHeader,{className:"flex flex-row items-center justify-between pb-2",children:[(0,t.jsx)(n.CardTitle,{className:`text-sm font-medium ${N?"text-gray-400":"text-gray-500"}`,children:"Documents"}),(0,t.jsx)(b.FileText,{className:`h-4 w-4 ${N?"text-gray-500":"text-gray-400"}`})]}),(0,t.jsxs)(n.CardContent,{children:[(0,t.jsx)("div",{className:`text-2xl font-bold ${N?"text-white":"text-gray-900"}`,children:"-"}),(0,t.jsx)("p",{className:"text-xs text-gray-500",children:"Data loading..."})]})]})]}),c&&(0,t.jsx)(n.Card,{className:`${N?"bg-blue-500/10 border-blue-500/20":"bg-blue-50 border-blue-200"}`,children:(0,t.jsx)(n.CardContent,{className:"py-4",children:(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("div",{className:"h-10 w-10 rounded-full bg-blue-500 flex items-center justify-center",children:(0,t.jsx)(j.Building2,{className:"h-5 w-5 text-white"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:`font-medium ${N?"text-white":"text-gray-900"}`,children:"CEO Access Enabled"}),(0,t.jsx)("div",{className:`text-sm ${N?"text-gray-400":"text-gray-600"}`,children:"You have access to KYC Review, Fees, Audit, and Admin sections."})]})]})})})]})}e.s(["PersonaDashboard",()=>e$],690310)}]);