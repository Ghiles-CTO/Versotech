(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,15098,e=>{"use strict";let s=(0,e.i(410587).default)("circle-check",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);e.s(["CheckCircle2",()=>s],15098)},429760,e=>{"use strict";var s=e.i(722679),a=e.i(340915),t=e.i(679472),i=e.i(47264),n=e.i(478985),r=e.i(873358),l=e.i(362208),o=e.i(599205),c=e.i(68977),d=e.i(798827),u="Tabs",[f,m]=(0,i.createContextScope)(u,[n.createRovingFocusGroupScope]),p=(0,n.createRovingFocusGroupScope)(),[b,g]=f(u),v=a.forwardRef((e,a)=>{let{__scopeTabs:t,value:i,onValueChange:n,defaultValue:r,orientation:f="horizontal",dir:m,activationMode:p="automatic",...g}=e,v=(0,o.useDirection)(m),[h,x]=(0,c.useControllableState)({prop:i,onChange:n,defaultProp:r??"",caller:u});return(0,s.jsx)(b,{scope:t,baseId:(0,d.useId)(),value:h,onValueChange:x,orientation:f,dir:v,activationMode:p,children:(0,s.jsx)(l.Primitive.div,{dir:v,"data-orientation":f,...g,ref:a})})});v.displayName=u;var h="TabsList",x=a.forwardRef((e,a)=>{let{__scopeTabs:t,loop:i=!0,...r}=e,o=g(h,t),c=p(t);return(0,s.jsx)(n.Root,{asChild:!0,...c,orientation:o.orientation,dir:o.dir,loop:i,children:(0,s.jsx)(l.Primitive.div,{role:"tablist","aria-orientation":o.orientation,...r,ref:a})})});x.displayName=h;var j="TabsTrigger",y=a.forwardRef((e,a)=>{let{__scopeTabs:i,value:r,disabled:o=!1,...c}=e,d=g(j,i),u=p(i),f=_(d.baseId,r),m=k(d.baseId,r),b=r===d.value;return(0,s.jsx)(n.Item,{asChild:!0,...u,focusable:!o,active:b,children:(0,s.jsx)(l.Primitive.button,{type:"button",role:"tab","aria-selected":b,"aria-controls":m,"data-state":b?"active":"inactive","data-disabled":o?"":void 0,disabled:o,id:f,...c,ref:a,onMouseDown:(0,t.composeEventHandlers)(e.onMouseDown,e=>{o||0!==e.button||!1!==e.ctrlKey?e.preventDefault():d.onValueChange(r)}),onKeyDown:(0,t.composeEventHandlers)(e.onKeyDown,e=>{[" ","Enter"].includes(e.key)&&d.onValueChange(r)}),onFocus:(0,t.composeEventHandlers)(e.onFocus,()=>{let e="manual"!==d.activationMode;b||o||!e||d.onValueChange(r)})})})});y.displayName=j;var N="TabsContent",w=a.forwardRef((e,t)=>{let{__scopeTabs:i,value:n,forceMount:o,children:c,...d}=e,u=g(N,i),f=_(u.baseId,n),m=k(u.baseId,n),p=n===u.value,b=a.useRef(p);return a.useEffect(()=>{let e=requestAnimationFrame(()=>b.current=!1);return()=>cancelAnimationFrame(e)},[]),(0,s.jsx)(r.Presence,{present:o||p,children:({present:a})=>(0,s.jsx)(l.Primitive.div,{"data-state":p?"active":"inactive","data-orientation":u.orientation,role:"tabpanel","aria-labelledby":f,hidden:!a,id:m,tabIndex:0,...d,ref:t,style:{...e.style,animationDuration:b.current?"0s":void 0},children:a&&c})})});function _(e,s){return`${e}-trigger-${s}`}function k(e,s){return`${e}-content-${s}`}w.displayName=N;var C=e.i(282141);let T=a.forwardRef(({id:e,...t},i)=>{let n=a.useId();return(0,s.jsx)(v,{ref:i,id:e??n,...t})});T.displayName="Tabs";let q=a.forwardRef(({className:e,...a},t)=>(0,s.jsx)(x,{ref:t,className:(0,C.cn)("inline-flex h-11 md:h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",e),...a}));q.displayName=x.displayName;let R=a.forwardRef(({className:e,...a},t)=>(0,s.jsx)(y,{ref:t,className:(0,C.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-2 md:py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",e),...a}));R.displayName=y.displayName;let S=a.forwardRef(({className:e,...a},t)=>(0,s.jsx)(w,{ref:t,className:(0,C.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",e),...a}));S.displayName=w.displayName,e.s(["Tabs",()=>T,"TabsContent",()=>S,"TabsList",()=>q,"TabsTrigger",()=>R],429760)},348759,e=>{"use strict";let s=(0,e.i(410587).default)("inbox",[["polyline",{points:"22 12 16 12 14 15 10 15 8 12 2 12",key:"o97t9d"}],["path",{d:"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z",key:"oot6mr"}]]);e.s(["Inbox",()=>s],348759)},723426,e=>{"use strict";var s=e.i(722679),a=e.i(340915),t=e.i(603274),i=e.i(429760),n=e.i(129432),r=e.i(263229),l=e.i(417439),o=e.i(15098),c=e.i(348759),d=e.i(59178),u=e.i(791660),f=e.i(550418);let m=(0,u.default)(()=>e.A(918360),{loadableGenerated:{modules:[412366]},loading:()=>(0,s.jsx)(g,{label:"messages"}),ssr:!1}),p=(0,u.default)(()=>e.A(901293),{loadableGenerated:{modules:[842650]},loading:()=>(0,s.jsx)(g,{label:"approvals"}),ssr:!1}),b=(0,u.default)(()=>e.A(49475),{loadableGenerated:{modules:[879149]},loading:()=>(0,s.jsx)(g,{label:"requests"}),ssr:!1});function g({label:e}){return(0,s.jsxs)("div",{className:"flex items-center justify-center py-16",children:[(0,s.jsx)(r.Loader2,{className:"h-8 w-8 animate-spin text-muted-foreground"}),(0,s.jsxs)("span",{className:"ml-3 text-muted-foreground",children:["Loading ",e,"..."]})]})}let v=[{value:"messages",label:"Messages",icon:l.MessageSquare},{value:"approvals",label:"Approvals",icon:o.CheckCircle2},{value:"requests",label:"Requests",icon:c.Inbox}];function h(){let e=(0,t.useSearchParams)(),r=(0,t.useRouter)(),{activePersona:l,isLoading:o}=(0,f.usePersona)(),c=(0,a.useMemo)(()=>{var e,s;return e=l?.persona_type,s=l?.role_in_entity,"ceo"===e?v.filter(e=>"requests"!==e.value):"staff"===e?"ceo"===s||"staff_admin"===s?v.filter(e=>"requests"!==e.value):v:v.filter(e=>"messages"===e.value)},[l?.persona_type,l?.role_in_entity]),u=e.get("tab"),h=c.some(e=>e.value===u)?u:"messages",[x,j]=(0,a.useState)(h),[y,N]=(0,a.useState)({messages:0,approvals:0,requests:0});(0,a.useEffect)(()=>{!async function(){try{let e=(0,d.createClient)(),{data:{user:s}}=await e.auth.getUser();if(!s)return;let{count:a}=await e.from("conversation_participants").select("*",{count:"exact",head:!0}).eq("user_id",s.id).is("last_read_at",null),{count:t}=await e.from("approvals").select("*",{count:"exact",head:!0}).eq("status","pending").or(`assigned_to.eq.${s.id},assigned_to.is.null`),{count:i}=await e.from("request_tickets").select("*",{count:"exact",head:!0}).in("status",["open","assigned","in_progress","awaiting_info"]).or(`assigned_to.eq.${s.id},assigned_to.is.null`);N({messages:a||0,approvals:t||0,requests:i||0})}catch(e){console.error("[Inbox] Error fetching counts:",e)}}()},[]);let w=l?.persona_type==="staff"||l?.persona_type==="ceo",_=l?.role_in_entity==="ceo"||l?.role_in_entity==="staff_admin",k=w&&!_,C=w?_?"Messages and approvals for your review":"Messages, approvals, and requests in one place":"Your conversations and notifications",T=1===c.length?"grid-cols-1":2===c.length?"grid-cols-2":"grid-cols-3";return(0,s.jsxs)("div",{className:"p-6 space-y-6",children:[(0,s.jsx)("div",{className:"flex items-center justify-between",children:(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-2xl font-bold text-foreground",children:"Inbox"}),(0,s.jsx)("p",{className:"text-muted-foreground mt-1",children:C})]})}),(0,s.jsxs)(i.Tabs,{value:x,onValueChange:s=>{j(s);let a=new URLSearchParams(e.toString());a.set("tab",s),r.push(`/versotech_main/inbox?${a.toString()}`,{scroll:!1})},className:"w-full",children:[c.length>1&&(0,s.jsx)(i.TabsList,{className:`grid w-full ${T} lg:w-auto lg:inline-grid`,children:c.map(({value:e,label:a,icon:t})=>(0,s.jsxs)(i.TabsTrigger,{value:e,className:"gap-2",children:[(0,s.jsx)(t,{className:"h-4 w-4"}),(0,s.jsx)("span",{children:a}),y[e]>0&&(0,s.jsx)(n.Badge,{variant:"secondary",className:"ml-1 h-5 px-1.5 text-xs",children:y[e]})]},e))}),(0,s.jsx)(i.TabsContent,{value:"messages",className:1===c.length?"mt-0":"mt-6",children:(0,s.jsx)(a.Suspense,{fallback:(0,s.jsx)(g,{label:"messages"}),children:(0,s.jsx)(m,{})})}),w&&(0,s.jsx)(i.TabsContent,{value:"approvals",className:"mt-6",children:(0,s.jsx)(a.Suspense,{fallback:(0,s.jsx)(g,{label:"approvals"}),children:(0,s.jsx)(p,{})})}),k&&(0,s.jsx)(i.TabsContent,{value:"requests",className:"mt-6",children:(0,s.jsx)(a.Suspense,{fallback:(0,s.jsx)(g,{label:"requests"}),children:(0,s.jsx)(b,{})})})]})]})}function x(){return(0,s.jsx)(a.Suspense,{fallback:(0,s.jsx)(g,{label:"inbox"}),children:(0,s.jsx)(h,{})})}e.s(["default",()=>x])},918360,e=>{e.v(s=>Promise.all(["static/chunks/147bf235cd861998.js","static/chunks/687f57e66bcce9db.js"].map(s=>e.l(s))).then(()=>s(412366)))},901293,e=>{e.v(s=>Promise.all(["static/chunks/d09f36607936387a.js","static/chunks/b3379b06ecf06d3b.js","static/chunks/52cb67f2b1db4a97.js"].map(s=>e.l(s))).then(()=>s(842650)))},49475,e=>{e.v(s=>Promise.all(["static/chunks/c0c6349ef6481dff.js","static/chunks/ecaddff0e9ca9082.js"].map(s=>e.l(s))).then(()=>s(879149)))}]);