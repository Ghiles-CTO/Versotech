(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,788379,e=>{"use strict";var t="undefined"!=typeof self?self:"undefined"!=typeof window?window:e.g;let r=t.fetch,a=t.fetch.bind(t),n=t.Headers,s=t.Request,l=t.Response;e.s(["Headers",0,n,"Request",0,s,"Response",0,l,"default",0,a,"fetch",0,r])},262823,e=>{"use strict";let t=(0,e.i(410587).default)("refresh-cw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);e.s(["RefreshCw",()=>t],262823)},932735,e=>{"use strict";let t=(0,e.i(410587).default)("send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]);e.s(["Send",()=>t],932735)},907434,e=>{"use strict";var t=e.i(722679),r=e.i(340915),a=e.i(362208),n=e.i(873358),s=e.i(47264),l=e.i(886978),i=e.i(171094),o=e.i(599205),d=e.i(990290),c=e.i(843189),u=e.i(679472),m="ScrollArea",[h,p]=(0,s.createContextScope)(m),[f,g]=h(m),v=r.forwardRef((e,n)=>{let{__scopeScrollArea:s,type:i="hover",dir:d,scrollHideDelay:c=600,...u}=e,[m,h]=r.useState(null),[p,g]=r.useState(null),[v,x]=r.useState(null),[w,b]=r.useState(null),[y,j]=r.useState(null),[C,N]=r.useState(0),[S,A]=r.useState(0),[T,D]=r.useState(!1),[R,E]=r.useState(!1),k=(0,l.useComposedRefs)(n,e=>h(e)),_=(0,o.useDirection)(d);return(0,t.jsx)(f,{scope:s,type:i,dir:_,scrollHideDelay:c,scrollArea:m,viewport:p,onViewportChange:g,content:v,onContentChange:x,scrollbarX:w,onScrollbarXChange:b,scrollbarXEnabled:T,onScrollbarXEnabledChange:D,scrollbarY:y,onScrollbarYChange:j,scrollbarYEnabled:R,onScrollbarYEnabledChange:E,onCornerWidthChange:N,onCornerHeightChange:A,children:(0,t.jsx)(a.Primitive.div,{dir:_,...u,ref:k,style:{position:"relative","--radix-scroll-area-corner-width":C+"px","--radix-scroll-area-corner-height":S+"px",...e.style}})})});v.displayName=m;var x="ScrollAreaViewport",w=r.forwardRef((e,n)=>{let{__scopeScrollArea:s,children:i,nonce:o,...d}=e,c=g(x,s),u=r.useRef(null),m=(0,l.useComposedRefs)(n,u,c.onViewportChange);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("style",{dangerouslySetInnerHTML:{__html:"[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}"},nonce:o}),(0,t.jsx)(a.Primitive.div,{"data-radix-scroll-area-viewport":"",...d,ref:m,style:{overflowX:c.scrollbarXEnabled?"scroll":"hidden",overflowY:c.scrollbarYEnabled?"scroll":"hidden",...e.style},children:(0,t.jsx)("div",{ref:c.onContentChange,style:{minWidth:"100%",display:"table"},children:i})})]})});w.displayName=x;var b="ScrollAreaScrollbar",y=r.forwardRef((e,a)=>{let{forceMount:n,...s}=e,l=g(b,e.__scopeScrollArea),{onScrollbarXEnabledChange:i,onScrollbarYEnabledChange:o}=l,d="horizontal"===e.orientation;return r.useEffect(()=>(d?i(!0):o(!0),()=>{d?i(!1):o(!1)}),[d,i,o]),"hover"===l.type?(0,t.jsx)(j,{...s,ref:a,forceMount:n}):"scroll"===l.type?(0,t.jsx)(C,{...s,ref:a,forceMount:n}):"auto"===l.type?(0,t.jsx)(N,{...s,ref:a,forceMount:n}):"always"===l.type?(0,t.jsx)(S,{...s,ref:a}):null});y.displayName=b;var j=r.forwardRef((e,a)=>{let{forceMount:s,...l}=e,i=g(b,e.__scopeScrollArea),[o,d]=r.useState(!1);return r.useEffect(()=>{let e=i.scrollArea,t=0;if(e){let r=()=>{window.clearTimeout(t),d(!0)},a=()=>{t=window.setTimeout(()=>d(!1),i.scrollHideDelay)};return e.addEventListener("pointerenter",r),e.addEventListener("pointerleave",a),()=>{window.clearTimeout(t),e.removeEventListener("pointerenter",r),e.removeEventListener("pointerleave",a)}}},[i.scrollArea,i.scrollHideDelay]),(0,t.jsx)(n.Presence,{present:s||o,children:(0,t.jsx)(N,{"data-state":o?"visible":"hidden",...l,ref:a})})}),C=r.forwardRef((e,a)=>{var s;let{forceMount:l,...i}=e,o=g(b,e.__scopeScrollArea),d="horizontal"===e.orientation,c=$(()=>h("SCROLL_END"),100),[m,h]=(s={hidden:{SCROLL:"scrolling"},scrolling:{SCROLL_END:"idle",POINTER_ENTER:"interacting"},interacting:{SCROLL:"interacting",POINTER_LEAVE:"idle"},idle:{HIDE:"hidden",SCROLL:"scrolling",POINTER_ENTER:"interacting"}},r.useReducer((e,t)=>s[e][t]??e,"hidden"));return r.useEffect(()=>{if("idle"===m){let e=window.setTimeout(()=>h("HIDE"),o.scrollHideDelay);return()=>window.clearTimeout(e)}},[m,o.scrollHideDelay,h]),r.useEffect(()=>{let e=o.viewport,t=d?"scrollLeft":"scrollTop";if(e){let r=e[t],a=()=>{let a=e[t];r!==a&&(h("SCROLL"),c()),r=a};return e.addEventListener("scroll",a),()=>e.removeEventListener("scroll",a)}},[o.viewport,d,h,c]),(0,t.jsx)(n.Presence,{present:l||"hidden"!==m,children:(0,t.jsx)(S,{"data-state":"hidden"===m?"hidden":"visible",...i,ref:a,onPointerEnter:(0,u.composeEventHandlers)(e.onPointerEnter,()=>h("POINTER_ENTER")),onPointerLeave:(0,u.composeEventHandlers)(e.onPointerLeave,()=>h("POINTER_LEAVE"))})})}),N=r.forwardRef((e,a)=>{let s=g(b,e.__scopeScrollArea),{forceMount:l,...i}=e,[o,d]=r.useState(!1),c="horizontal"===e.orientation,u=$(()=>{if(s.viewport){let e=s.viewport.offsetWidth<s.viewport.scrollWidth,t=s.viewport.offsetHeight<s.viewport.scrollHeight;d(c?e:t)}},10);return B(s.viewport,u),B(s.content,u),(0,t.jsx)(n.Presence,{present:l||o,children:(0,t.jsx)(S,{"data-state":o?"visible":"hidden",...i,ref:a})})}),S=r.forwardRef((e,a)=>{let{orientation:n="vertical",...s}=e,l=g(b,e.__scopeScrollArea),i=r.useRef(null),o=r.useRef(0),[d,c]=r.useState({content:0,viewport:0,scrollbar:{size:0,paddingStart:0,paddingEnd:0}}),u=F(d.viewport,d.content),m={...s,sizes:d,onSizesChange:c,hasThumb:!!(u>0&&u<1),onThumbChange:e=>i.current=e,onThumbPointerUp:()=>o.current=0,onThumbPointerDown:e=>o.current=e};function h(e,t){return function(e,t,r,a="ltr"){let n=z(r),s=t||n/2,l=r.scrollbar.paddingStart+s,i=r.scrollbar.size-r.scrollbar.paddingEnd-(n-s),o=r.content-r.viewport;return V([l,i],"ltr"===a?[0,o]:[-1*o,0])(e)}(e,o.current,d,t)}return"horizontal"===n?(0,t.jsx)(A,{...m,ref:a,onThumbPositionChange:()=>{if(l.viewport&&i.current){let e=H(l.viewport.scrollLeft,d,l.dir);i.current.style.transform=`translate3d(${e}px, 0, 0)`}},onWheelScroll:e=>{l.viewport&&(l.viewport.scrollLeft=e)},onDragScroll:e=>{l.viewport&&(l.viewport.scrollLeft=h(e,l.dir))}}):"vertical"===n?(0,t.jsx)(T,{...m,ref:a,onThumbPositionChange:()=>{if(l.viewport&&i.current){let e=H(l.viewport.scrollTop,d);i.current.style.transform=`translate3d(0, ${e}px, 0)`}},onWheelScroll:e=>{l.viewport&&(l.viewport.scrollTop=e)},onDragScroll:e=>{l.viewport&&(l.viewport.scrollTop=h(e))}}):null}),A=r.forwardRef((e,a)=>{let{sizes:n,onSizesChange:s,...i}=e,o=g(b,e.__scopeScrollArea),[d,c]=r.useState(),u=r.useRef(null),m=(0,l.useComposedRefs)(a,u,o.onScrollbarXChange);return r.useEffect(()=>{u.current&&c(getComputedStyle(u.current))},[u]),(0,t.jsx)(E,{"data-orientation":"horizontal",...i,ref:m,sizes:n,style:{bottom:0,left:"rtl"===o.dir?"var(--radix-scroll-area-corner-width)":0,right:"ltr"===o.dir?"var(--radix-scroll-area-corner-width)":0,"--radix-scroll-area-thumb-width":z(n)+"px",...e.style},onThumbPointerDown:t=>e.onThumbPointerDown(t.x),onDragScroll:t=>e.onDragScroll(t.x),onWheelScroll:(t,r)=>{if(o.viewport){var a,n;let s=o.viewport.scrollLeft+t.deltaX;e.onWheelScroll(s),a=s,n=r,a>0&&a<n&&t.preventDefault()}},onResize:()=>{u.current&&o.viewport&&d&&s({content:o.viewport.scrollWidth,viewport:o.viewport.offsetWidth,scrollbar:{size:u.current.clientWidth,paddingStart:U(d.paddingLeft),paddingEnd:U(d.paddingRight)}})}})}),T=r.forwardRef((e,a)=>{let{sizes:n,onSizesChange:s,...i}=e,o=g(b,e.__scopeScrollArea),[d,c]=r.useState(),u=r.useRef(null),m=(0,l.useComposedRefs)(a,u,o.onScrollbarYChange);return r.useEffect(()=>{u.current&&c(getComputedStyle(u.current))},[u]),(0,t.jsx)(E,{"data-orientation":"vertical",...i,ref:m,sizes:n,style:{top:0,right:"ltr"===o.dir?0:void 0,left:"rtl"===o.dir?0:void 0,bottom:"var(--radix-scroll-area-corner-height)","--radix-scroll-area-thumb-height":z(n)+"px",...e.style},onThumbPointerDown:t=>e.onThumbPointerDown(t.y),onDragScroll:t=>e.onDragScroll(t.y),onWheelScroll:(t,r)=>{if(o.viewport){var a,n;let s=o.viewport.scrollTop+t.deltaY;e.onWheelScroll(s),a=s,n=r,a>0&&a<n&&t.preventDefault()}},onResize:()=>{u.current&&o.viewport&&d&&s({content:o.viewport.scrollHeight,viewport:o.viewport.offsetHeight,scrollbar:{size:u.current.clientHeight,paddingStart:U(d.paddingTop),paddingEnd:U(d.paddingBottom)}})}})}),[D,R]=h(b),E=r.forwardRef((e,n)=>{let{__scopeScrollArea:s,sizes:o,hasThumb:d,onThumbChange:c,onThumbPointerUp:m,onThumbPointerDown:h,onThumbPositionChange:p,onDragScroll:f,onWheelScroll:v,onResize:x,...w}=e,y=g(b,s),[j,C]=r.useState(null),N=(0,l.useComposedRefs)(n,e=>C(e)),S=r.useRef(null),A=r.useRef(""),T=y.viewport,R=o.content-o.viewport,E=(0,i.useCallbackRef)(v),k=(0,i.useCallbackRef)(p),_=$(x,10);function M(e){S.current&&f({x:e.clientX-S.current.left,y:e.clientY-S.current.top})}return r.useEffect(()=>{let e=e=>{let t=e.target;j?.contains(t)&&E(e,R)};return document.addEventListener("wheel",e,{passive:!1}),()=>document.removeEventListener("wheel",e,{passive:!1})},[T,j,R,E]),r.useEffect(k,[o,k]),B(j,_),B(y.content,_),(0,t.jsx)(D,{scope:s,scrollbar:j,hasThumb:d,onThumbChange:(0,i.useCallbackRef)(c),onThumbPointerUp:(0,i.useCallbackRef)(m),onThumbPositionChange:k,onThumbPointerDown:(0,i.useCallbackRef)(h),children:(0,t.jsx)(a.Primitive.div,{...w,ref:N,style:{position:"absolute",...w.style},onPointerDown:(0,u.composeEventHandlers)(e.onPointerDown,e=>{0===e.button&&(e.target.setPointerCapture(e.pointerId),S.current=j.getBoundingClientRect(),A.current=document.body.style.webkitUserSelect,document.body.style.webkitUserSelect="none",y.viewport&&(y.viewport.style.scrollBehavior="auto"),M(e))}),onPointerMove:(0,u.composeEventHandlers)(e.onPointerMove,M),onPointerUp:(0,u.composeEventHandlers)(e.onPointerUp,e=>{let t=e.target;t.hasPointerCapture(e.pointerId)&&t.releasePointerCapture(e.pointerId),document.body.style.webkitUserSelect=A.current,y.viewport&&(y.viewport.style.scrollBehavior=""),S.current=null})})})}),k="ScrollAreaThumb",_=r.forwardRef((e,r)=>{let{forceMount:a,...s}=e,l=R(k,e.__scopeScrollArea);return(0,t.jsx)(n.Presence,{present:a||l.hasThumb,children:(0,t.jsx)(M,{ref:r,...s})})}),M=r.forwardRef((e,n)=>{let{__scopeScrollArea:s,style:i,...o}=e,d=g(k,s),c=R(k,s),{onThumbPositionChange:m}=c,h=(0,l.useComposedRefs)(n,e=>c.onThumbChange(e)),p=r.useRef(void 0),f=$(()=>{p.current&&(p.current(),p.current=void 0)},100);return r.useEffect(()=>{let e=d.viewport;if(e){let t=()=>{f(),p.current||(p.current=O(e,m),m())};return m(),e.addEventListener("scroll",t),()=>e.removeEventListener("scroll",t)}},[d.viewport,f,m]),(0,t.jsx)(a.Primitive.div,{"data-state":c.hasThumb?"visible":"hidden",...o,ref:h,style:{width:"var(--radix-scroll-area-thumb-width)",height:"var(--radix-scroll-area-thumb-height)",...i},onPointerDownCapture:(0,u.composeEventHandlers)(e.onPointerDownCapture,e=>{let t=e.target.getBoundingClientRect(),r=e.clientX-t.left,a=e.clientY-t.top;c.onThumbPointerDown({x:r,y:a})}),onPointerUp:(0,u.composeEventHandlers)(e.onPointerUp,c.onThumbPointerUp)})});_.displayName=k;var L="ScrollAreaCorner",P=r.forwardRef((e,r)=>{let a=g(L,e.__scopeScrollArea),n=!!(a.scrollbarX&&a.scrollbarY);return"scroll"!==a.type&&n?(0,t.jsx)(I,{...e,ref:r}):null});P.displayName=L;var I=r.forwardRef((e,n)=>{let{__scopeScrollArea:s,...l}=e,i=g(L,s),[o,d]=r.useState(0),[c,u]=r.useState(0),m=!!(o&&c);return B(i.scrollbarX,()=>{let e=i.scrollbarX?.offsetHeight||0;i.onCornerHeightChange(e),u(e)}),B(i.scrollbarY,()=>{let e=i.scrollbarY?.offsetWidth||0;i.onCornerWidthChange(e),d(e)}),m?(0,t.jsx)(a.Primitive.div,{...l,ref:n,style:{width:o,height:c,position:"absolute",right:"ltr"===i.dir?0:void 0,left:"rtl"===i.dir?0:void 0,bottom:0,...e.style}}):null});function U(e){return e?parseInt(e,10):0}function F(e,t){let r=e/t;return isNaN(r)?0:r}function z(e){let t=F(e.viewport,e.content),r=e.scrollbar.paddingStart+e.scrollbar.paddingEnd;return Math.max((e.scrollbar.size-r)*t,18)}function H(e,t,r="ltr"){let a=z(t),n=t.scrollbar.paddingStart+t.scrollbar.paddingEnd,s=t.scrollbar.size-n,l=t.content-t.viewport,i=(0,c.clamp)(e,"ltr"===r?[0,l]:[-1*l,0]);return V([0,l],[0,s-a])(i)}function V(e,t){return r=>{if(e[0]===e[1]||t[0]===t[1])return t[0];let a=(t[1]-t[0])/(e[1]-e[0]);return t[0]+a*(r-e[0])}}var O=(e,t=()=>{})=>{let r={left:e.scrollLeft,top:e.scrollTop},a=0;return!function n(){let s={left:e.scrollLeft,top:e.scrollTop},l=r.left!==s.left,i=r.top!==s.top;(l||i)&&t(),r=s,a=window.requestAnimationFrame(n)}(),()=>window.cancelAnimationFrame(a)};function $(e,t){let a=(0,i.useCallbackRef)(e),n=r.useRef(0);return r.useEffect(()=>()=>window.clearTimeout(n.current),[]),r.useCallback(()=>{window.clearTimeout(n.current),n.current=window.setTimeout(a,t)},[a,t])}function B(e,t){let r=(0,i.useCallbackRef)(t);(0,d.useLayoutEffect)(()=>{let t=0;if(e){let a=new ResizeObserver(()=>{cancelAnimationFrame(t),t=window.requestAnimationFrame(r)});return a.observe(e),()=>{window.cancelAnimationFrame(t),a.unobserve(e)}}},[e,r])}var Y=e.i(282141);let W=r.forwardRef(({className:e,children:r,...a},n)=>(0,t.jsxs)(v,{ref:n,className:(0,Y.cn)("relative overflow-hidden",e),...a,children:[(0,t.jsx)(w,{className:"h-full w-full rounded-[inherit]",children:r}),(0,t.jsx)(X,{}),(0,t.jsx)(P,{})]}));W.displayName=v.displayName;let X=r.forwardRef(({className:e,orientation:r="vertical",...a},n)=>(0,t.jsx)(y,{ref:n,orientation:r,className:(0,Y.cn)("flex touch-none select-none transition-colors","vertical"===r&&"h-full w-2.5 border-l border-l-transparent p-[1px]","horizontal"===r&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",e),...a,children:(0,t.jsx)(_,{className:"relative flex-1 rounded-full bg-border"})}));X.displayName=y.displayName,e.s(["ScrollArea",()=>W],907434)},64927,e=>{"use strict";let t=(0,e.i(410587).default)("ellipsis-vertical",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]]);e.s(["MoreVertical",()=>t],64927)},564153,e=>{"use strict";let t=(0,e.i(410587).default)("check-check",[["path",{d:"M18 6 7 17l-5-5",key:"116fxf"}],["path",{d:"m22 10-7.5 7.5L13 16",key:"ke71qq"}]]);e.s(["CheckCheck",()=>t],564153)},804306,501328,135771,607730,715898,e=>{"use strict";var t=e.i(59178);async function r(e){let t=new URLSearchParams;e.visibility&&t.set("visibility",e.visibility),e.type&&t.set("type",e.type),e.unreadOnly&&t.set("unread","true"),e.search&&t.set("search",e.search),e.dealId&&t.set("dealId",e.dealId),"number"==typeof e.limit&&t.set("limit",String(e.limit)),"number"==typeof e.offset&&t.set("offset",String(e.offset)),!1===e.includeMessages&&t.set("includeMessages","false");let r=await fetch(`/api/conversations?${t.toString()}`,{cache:"no-store"});if(!r.ok){let e=await r.json().catch(()=>null);throw Error(e?.error||"Failed to load conversations")}let a=await r.json();return{conversations:a.conversations,total:a.pagination.total,limit:a.pagination.limit,offset:a.pagination.offset,hasMore:a.pagination.has_more}}function a(e){let t=Array.isArray(e?.conversation_participants)?e.conversation_participants.map(e=>{let t=e?.profiles||{};return{id:t.id||e.user_id,displayName:t.display_name||t.email||null,email:t.email||null,role:t.role||null,avatarUrl:t.avatar_url??null,participantRole:e?.participant_role??"member",joinedAt:e?.joined_at,lastReadAt:e?.last_read_at??null,lastNotifiedAt:e?.last_notified_at??null,isMuted:e?.is_muted??!1,isPinned:e?.is_pinned??!1}}):[],r=Array.isArray(e?.messages)?e.messages[0]:null,a=r?i(r):null;return{id:e.id,subject:e.subject??null,preview:e.preview??null,type:e.type??"dm",visibility:e.visibility??"internal",ownerTeam:e.owner_team??null,dealId:e.deal_id??null,createdBy:e.created_by??null,createdAt:e.created_at,updatedAt:e.updated_at,lastMessageAt:e.last_message_at??null,lastMessageId:e.last_message_id??null,archivedAt:e.archived_at??null,metadata:e.metadata??{},participants:t,unreadCount:e.unreadCount??0,latestMessage:a,participantCount:t.length}}async function n(e,t={}){let r=new URLSearchParams;"number"==typeof t.limit&&r.set("limit",String(t.limit)),"number"==typeof t.offset&&r.set("offset",String(t.offset));let a=await fetch(`/api/conversations/${e}/messages?${r.toString()}`);if(!a.ok){let e=await a.json().catch(()=>null);throw Error(e?.error||"Failed to fetch messages")}return(await a.json()).messages}async function s(e){await fetch(`/api/conversations/${e}/read`,{method:"POST"})}function l(e,r){let a=(0,t.createClient)(),n=a.channel(`conversation-${e}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"messages",filter:`conversation_id=eq.${e}`},e=>{"INSERT"===e.eventType&&r.onMessage?.(i(e.new)),r.onUpdate?.()}).on("postgres_changes",{event:"*",schema:"public",table:"conversation_participants",filter:`conversation_id=eq.${e}`},e=>{r.onUpdate?.()}).subscribe();return()=>{a.removeChannel(n)}}function i(e){let t=e.sender;return{id:e.id,conversationId:e.conversation_id,senderId:e.sender_id,body:e.body??null,messageType:e.message_type??"text",fileKey:e.file_key??null,replyToMessageId:e.reply_to_message_id??null,metadata:e.metadata??{},createdAt:e.created_at,editedAt:e.edited_at??null,deletedAt:e.deleted_at??null,sender:t?{id:t.id??null,displayName:t.displayName??t.display_name??null,email:t.email??null,role:t.role??null,avatarUrl:t.avatarUrl??t.avatar_url??null}:null,readBy:Array.isArray(e.read_by)?e.read_by:[]}}function o(e,t){return e.filter(e=>{if("all"!==t.type&&e.type!==t.type||"all"!==t.visibility&&e.visibility!==t.visibility||t.dealId&&e.dealId!==t.dealId||t.unreadOnly&&(!e.unreadCount||0===e.unreadCount))return!1;if(t.search){let r=t.search.toLowerCase(),a=[];if(e.subject&&a.push(e.subject),e.preview&&a.push(e.preview),e.ownerTeam&&a.push(e.ownerTeam),e.participants.forEach(e=>{e.displayName&&a.push(e.displayName),e.email&&a.push(e.email)}),!a.some(e=>e.toLowerCase().includes(r)))return!1}return!0})}function d(e){return[...e].sort((e,t)=>{let r=e.lastMessageAt?new Date(e.lastMessageAt).getTime():new Date(e.createdAt).getTime();return(t.lastMessageAt?new Date(t.lastMessageAt).getTime():new Date(t.createdAt).getTime())-r})}function c(e){let t=new Date,r=new Date(e),a=Math.floor((t.getTime()-r.getTime())/1e3);if(a<60)return"Just now";if(a<3600){let e=Math.floor(a/60);return`${e}m ago`}if(a<86400){let e=Math.floor(a/3600);return`${e}h ago`}let n=new Date(t);if(n.setDate(n.getDate()-1),r.toDateString()===n.toDateString())return`Yesterday at ${r.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})}`;if(a<604800){let e=Math.floor(a/86400);return`${e}d ago`}return r.toLocaleDateString("en-US",{month:"short",day:"numeric",year:r.getFullYear()!==t.getFullYear()?"numeric":void 0})}function u(e){return new Date(e).toLocaleString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"numeric",minute:"2-digit",hour12:!0})}function m(e,t=5){if(0===e.length)return[];let r=[];for(let a=0;a<e.length;a++){let n=e[a],s=a>0?e[a-1]:null,l=a<e.length-1?e[a+1]:null,i=s&&s.senderId===n.senderId&&!s.deletedAt&&!n.deletedAt&&new Date(n.createdAt).getTime()-new Date(s.createdAt).getTime()<60*t*1e3,o=l&&l.senderId===n.senderId&&!l.deletedAt&&!n.deletedAt&&new Date(l.createdAt).getTime()-new Date(n.createdAt).getTime()<60*t*1e3;r.push({...n,isGroupStart:!i,isGroupEnd:!o,showAvatar:!i,showTimestamp:!o})}return r}function h(e){if(!e)return"?";let t=e.trim().split(" ");return t.length>=2?`${t[0][0]}${t[1][0]}`.toUpperCase():e.substring(0,2).toUpperCase()}function p(e,t){return e.length<=t?e:e.substring(0,t).trim()+"…"}function f(e){let t=new Date(e),r=new Date,a=new Date(r);a.setDate(a.getDate()-1);let n=new Date(t.getFullYear(),t.getMonth(),t.getDate()),s=new Date(r.getFullYear(),r.getMonth(),r.getDate()),l=new Date(a.getFullYear(),a.getMonth(),a.getDate());return n.getTime()===s.getTime()?"Today":n.getTime()===l.getTime()?"Yesterday":7>Math.floor((s.getTime()-n.getTime())/864e5)?t.toLocaleDateString("en-US",{weekday:"long"}):t.toLocaleDateString("en-US",{month:"long",day:"numeric",year:t.getFullYear()!==r.getFullYear()?"numeric":void 0})}function g(e,t){if(!t)return!0;let r=new Date(e.createdAt),a=new Date(t.createdAt);return r.toDateString()!==a.toDateString()}e.s(["fetchConversationMessages",()=>n,"fetchConversationsClient",()=>r,"markConversationRead",()=>s,"normalizeConversation",()=>a,"subscribeToConversationUpdates",()=>l],501328),e.s(["applyConversationFilters",()=>o,"sortConversations",()=>d],135771),e.s(["formatFullTimestamp",()=>u,"formatRelativeTime",()=>c,"getDateDivider",()=>f,"getInitials",()=>h,"groupMessages",()=>m,"shouldShowDateDivider",()=>g,"truncateText",()=>p],607730),e.s([],804306);var v=e.i(722679),x=e.i(340915),w=e.i(74434),b=e.i(316264),y=e.i(282141),j=e.i(564153),C=e.i(310556),N=e.i(554369),S=e.i(415814);function A({message:e,senderName:t,senderEmail:r,senderAvatarUrl:a,isSelf:n,isGroupStart:s,isGroupEnd:l,showAvatar:i,showTimestamp:o,onDelete:d}){return e.deletedAt?(0,v.jsx)("div",{className:(0,y.cn)("flex items-center gap-2 py-1",n?"justify-end":"justify-start"),children:(0,v.jsx)("span",{className:"text-xs italic text-muted-foreground",children:"Message deleted"})}):(0,v.jsxs)(S.motion.div,{initial:{opacity:0,y:10,scale:.98},animate:{opacity:1,y:0,scale:1},transition:{duration:.25,ease:[.25,.1,.25,1]},className:(0,y.cn)("flex gap-2 group",n?"flex-row-reverse":"flex-row",!s&&"mt-0.5",s&&"mt-5"),children:[(0,v.jsx)("div",{className:(0,y.cn)("flex-shrink-0 self-end",!i&&"w-9"),children:i?(0,v.jsxs)(w.Avatar,{className:"h-9 w-9 border-2 border-background shadow-sm transition-transform duration-200 group-hover:scale-110",children:[a&&(0,v.jsx)(w.AvatarImage,{src:a,alt:t}),(0,v.jsx)(w.AvatarFallback,{className:"text-xs bg-muted text-foreground font-medium",children:h(t)})]}):null}),(0,v.jsxs)("div",{className:(0,y.cn)("flex flex-col gap-1 max-w-[75%] md:max-w-[65%] relative",n&&"items-end"),children:[n&&d&&!e.deletedAt&&(0,v.jsx)(b.Button,{variant:"ghost",size:"icon",className:"absolute -left-10 top-1 h-7 w-7 opacity-0 group-hover:opacity-100 transition-opacity text-muted-foreground hover:text-red-500",onClick:()=>d(e.id),children:(0,v.jsx)(N.Trash2,{className:"h-4 w-4"})}),s&&!n&&(0,v.jsx)("span",{className:"text-xs font-semibold text-foreground/80 px-2 mb-0.5",children:t}),(0,v.jsx)("div",{className:(0,y.cn)("relative px-3.5 py-2.5 rounded-lg text-[14px] leading-relaxed","transition-all duration-200 ease-out",n?"bg-primary text-primary-foreground shadow-md shadow-primary/20":"bg-card text-foreground border border-border shadow-sm","rounded-tl-2xl rounded-tr-2xl",n?"rounded-bl-2xl rounded-br-md":"rounded-bl-md rounded-br-2xl",s&&(n?"rounded-br-2xl":"rounded-bl-2xl"),"group-hover:shadow-xl group-hover:-translate-y-0.5",n?"group-hover:shadow-primary/30":"group-hover:shadow-lg","max-w-full"),title:u(e.createdAt),children:(0,v.jsxs)("div",{className:"flex flex-col",children:[(0,v.jsx)("p",{className:"whitespace-pre-wrap break-words",children:e.body}),(0,v.jsxs)("div",{className:(0,y.cn)("flex items-center gap-1 mt-1 justify-end select-none",n?"text-primary-foreground/60":"text-muted-foreground/70"),children:[e.editedAt&&(0,v.jsx)("span",{className:"text-[9px] italic mr-1",children:"Edited"}),(0,v.jsx)("span",{className:"text-[9px] font-medium",children:new Date(e.createdAt).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})}),n&&(0,v.jsx)("span",{className:"ml-0.5",children:e.readBy&&e.readBy.length>0?(0,v.jsx)(j.CheckCheck,{className:"h-3.5 w-3.5"}):(0,v.jsx)(C.Check,{className:"h-3.5 w-3.5"})})]})]})})]})]})}function T({isSent:e=!1}){return(0,v.jsxs)("div",{className:(0,y.cn)("flex gap-3 animate-pulse",e?"justify-end":"justify-start"),children:[!e&&(0,v.jsx)("div",{className:"h-8 w-8 rounded-full bg-muted/60 shrink-0"}),(0,v.jsxs)("div",{className:(0,y.cn)("flex flex-col gap-2 max-w-[70%]",e?"items-end":"items-start"),children:[!e&&(0,v.jsx)("div",{className:"h-3 w-24 bg-muted/60 rounded"}),(0,v.jsx)("div",{className:(0,y.cn)("rounded-2xl bg-muted/60",e?"rounded-br-md":"rounded-bl-md","h-20 w-full min-w-[200px]")}),(0,v.jsx)("div",{className:"h-2 w-16 bg-muted/40 rounded"})]}),e&&(0,v.jsx)("div",{className:"h-8 w-8 rounded-full bg-muted/60 shrink-0"})]})}function D({isSent:e,count:t=3}){return(0,v.jsx)("div",{className:"space-y-4 p-4",children:Array.from({length:t}).map((t,r)=>(0,v.jsx)(T,{isSent:void 0!==e?e:r%2==0},r))})}let R=x.forwardRef(({className:e,onChange:t,...r},a)=>{let n=x.useRef(null),s=x.useCallback(()=>{let e=n.current;e&&(e.style.height="auto",e.style.height=`${e.scrollHeight}px`)},[]);x.useEffect(()=>{s()},[r.value,s]);let l=x.useCallback(e=>{n.current=e,"function"==typeof a?a(e):a&&(a.current=e)},[a]);return(0,v.jsx)("textarea",{ref:l,className:(0,y.cn)("flex min-h-[44px] max-h-[200px] w-full rounded-md border border-input","bg-background px-3 py-2 text-sm ring-offset-background","placeholder:text-muted-foreground","focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2","disabled:cursor-not-allowed disabled:opacity-50","resize-none overflow-y-auto","transition-all duration-200 ease-out",e),onChange:e=>{s(),t?.(e)},...r})});R.displayName="AutoExpandTextarea";var E=e.i(907434),k=e.i(129432),_=e.i(932735),M=e.i(410587);let L=(0,M.default)("paperclip",[["path",{d:"m16 6-8.414 8.586a2 2 0 0 0 2.829 2.829l8.414-8.586a4 4 0 1 0-5.657-5.657l-8.379 8.551a6 6 0 1 0 8.485 8.485l8.379-8.551",key:"1miecu"}]]);var P=e.i(64927),I=e.i(501259);let U=(0,M.default)("smile",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 14s1.5 2 4 2 4-2 4-2",key:"1y1vjs"}],["line",{x1:"9",x2:"9.01",y1:"9",y2:"9",key:"yxxnd0"}],["line",{x1:"15",x2:"15.01",y1:"9",y2:"9",key:"1p4y9e"}]]);var F=e.i(417439),z=e.i(510166),H=e.i(908925);function V({conversation:e,currentUserId:t,onRead:r,onError:a,onDelete:i}){let[o,d]=(0,x.useState)([]),[c,u]=(0,x.useState)(!0),[p,j]=(0,x.useState)(""),[C,S]=(0,x.useState)(!1),[T,M]=(0,x.useState)(!1),[V,O]=(0,x.useState)(null);(0,x.useRef)(null);let $=(0,x.useRef)(null);console.log("[ConversationView] Rendering with",o.length,"messages for conversation:",e.id);let B=async()=>{try{if(!(await fetch(`/api/conversations/${e.id}`,{method:"DELETE"})).ok)throw Error("Failed to delete conversation");i?.(e.id),M(!1)}catch(e){a?.(e.message||"Failed to delete conversation")}},Y=async t=>{try{if(!(await fetch(`/api/conversations/${e.id}/messages/${t}`,{method:"DELETE"})).ok)throw Error("Failed to delete message");d(e=>e.filter(e=>e.id!==t)),O(null)}catch(e){a?.(e.message||"Failed to delete message")}},W=(0,x.useMemo)(()=>{let r=new Map;return e.participants.forEach(e=>{e.id&&r.set(e.id,{name:e.displayName||e.email||"Unknown User",email:e.email})}),t&&!r.has(t)&&r.set(t,{name:"You",email:null}),r},[e.participants,t]),X=(0,x.useMemo)(()=>m(o),[o]);(0,x.useEffect)(()=>{console.log("[ConversationView] Auto-scroll triggered, messages:",o.length),o.length>0&&$.current&&(console.log("[ConversationView] Scrolling to bottom"),$.current.scrollIntoView({behavior:"smooth"}))},[o]),(0,x.useEffect)(()=>{let t=!0;return u(!0),d([]),n(e.id,{limit:200}).then(a=>{t&&(d(a),r?.(),s(e.id).catch(console.error))}).catch(e=>{console.error("Load messages error",e)}).finally(()=>{t&&u(!1)}),()=>{t=!1}},[e.id,r]);let q=async()=>{if(p.trim()){console.log("[ConversationView] Sending message:",p),S(!0);try{let t=await fetch(`/api/conversations/${e.id}/messages`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({body:p})});if(!t.ok){let e=await t.json().catch(()=>null);throw Error(e?.error||"Failed to send message")}let r=await t.json();console.log("[ConversationView] Message sent, adding optimistically:",r.message),r.message&&d(e=>e.some(e=>e.id===r.message.id)?e:[...e,r.message]),j("")}catch(e){console.error("[ConversationView] Send error:",e),a?.(e.message||"Failed to send message")}finally{S(!1)}}};return(0,x.useEffect)(()=>{console.log("[ConversationView] Setting up realtime for conversation:",e.id);let t=l(e.id,{onMessage:t=>{console.log("[ConversationView] Received new message from realtime:",t),d(e=>{if(console.log("[ConversationView] Current messages before add:",e.length),e.some(e=>e.id===t.id))return console.log("[ConversationView] Message already exists, skipping"),e;console.log("[ConversationView] Adding realtime message to list");let r=[...e,t];return console.log("[ConversationView] Messages after add:",r.length),r}),s(e.id).catch(console.error)}});return()=>{console.log("[ConversationView] Cleaning up realtime for conversation:",e.id),t()}},[e.id]),(0,v.jsxs)("div",{className:"flex-1 flex flex-col min-h-0",children:[(0,v.jsx)("header",{className:"relative z-10 border-b border-border bg-card px-6 py-4",children:(0,v.jsxs)("div",{className:"flex items-center justify-between",children:[(0,v.jsxs)("div",{className:"flex items-center gap-3",children:[(0,v.jsxs)("div",{className:"flex -space-x-2",children:[e.participants.slice(0,3).map((e,t)=>(0,v.jsxs)(w.Avatar,{className:"h-9 w-9 border-2 border-background",children:[e.avatarUrl&&(0,v.jsx)(w.AvatarImage,{src:e.avatarUrl,alt:e.displayName||e.email||"User"}),(0,v.jsx)(w.AvatarFallback,{className:"text-xs bg-muted text-foreground",children:h(e.displayName||e.email)})]},e.id)),e.participants.length>3&&(0,v.jsx)(w.Avatar,{className:"h-9 w-9 border-2 border-background",children:(0,v.jsxs)(w.AvatarFallback,{className:"text-xs bg-muted text-foreground",children:["+",e.participants.length-3]})})]}),(0,v.jsxs)("div",{className:"flex-1",children:[(0,v.jsx)("h3",{className:"text-base font-semibold text-foreground",children:e.subject||"Untitled Conversation"}),(0,v.jsxs)("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[(0,v.jsx)(I.Users,{className:"h-3 w-3"}),(0,v.jsxs)("span",{children:[e.participants.length," participant",1!==e.participants.length?"s":""]})]})]})]}),(0,v.jsxs)("div",{className:"flex items-center gap-2",children:[(0,v.jsx)(k.Badge,{variant:"outline",className:"capitalize border-border text-foreground",children:e.type.replace("_"," ")}),(0,v.jsxs)(z.DropdownMenu,{children:[(0,v.jsx)(z.DropdownMenuTrigger,{asChild:!0,children:(0,v.jsx)(b.Button,{variant:"ghost",size:"icon",className:"h-8 w-8",children:(0,v.jsx)(P.MoreVertical,{className:"h-4 w-4"})})}),(0,v.jsxs)(z.DropdownMenuContent,{align:"end",className:"w-48",children:[(0,v.jsx)(z.DropdownMenuItem,{className:"cursor-pointer",children:"View Details"}),(0,v.jsx)(z.DropdownMenuItem,{className:"cursor-pointer",children:"Mute Notifications"}),(0,v.jsx)(z.DropdownMenuSeparator,{}),(0,v.jsxs)(z.DropdownMenuItem,{className:"cursor-pointer text-red-600 focus:text-red-600",onClick:()=>M(!0),children:[(0,v.jsx)(N.Trash2,{className:"h-4 w-4 mr-2"}),"Delete Conversation"]})]})]})]})]})}),(0,v.jsx)(E.ScrollArea,{className:"flex-1 min-h-0 bg-muted/20",children:(0,v.jsxs)("div",{className:"px-4 py-6 md:px-8",children:[c?(0,v.jsx)(D,{count:3}):0===o.length?(0,v.jsxs)("div",{className:"flex flex-col items-center justify-center h-full min-h-[400px] text-center px-4",children:[(0,v.jsxs)("div",{className:"relative mb-6",children:[(0,v.jsx)("div",{className:"rounded-full bg-gradient-to-br from-primary/10 to-primary/5 p-8 backdrop-blur-sm border border-primary/10",children:(0,v.jsx)(F.MessageSquare,{className:"h-12 w-12 text-primary/60"})}),(0,v.jsx)("div",{className:"absolute -top-1 -right-1 h-4 w-4 rounded-full bg-primary/20 animate-ping"})]}),(0,v.jsx)("h3",{className:"text-xl font-semibold text-foreground mb-2",children:"Start the Conversation"}),(0,v.jsxs)("p",{className:"text-sm text-muted-foreground max-w-md leading-relaxed",children:["No messages yet. Break the ice and send the first message to"," ",(0,v.jsx)("span",{className:"font-medium text-foreground",children:e.participants.filter(e=>e.id!==t)[0]?.displayName||"your team"}),"."]})]}):(0,v.jsx)("div",{className:"space-y-0",children:X.map((e,r)=>{let a=e.senderId===t,n=e.sender?.displayName?{name:e.sender.displayName,email:e.sender.email}:W.get(e.senderId||""),s=n?.name||"Unknown User",l=g(e,r>0?X[r-1]:void 0);return(0,v.jsxs)("div",{children:[l&&(0,v.jsx)("div",{className:"flex items-center justify-center my-6",children:(0,v.jsx)("div",{className:"px-3 py-1 rounded-full bg-muted/50 backdrop-blur-sm",children:(0,v.jsx)("span",{className:"text-xs font-medium text-muted-foreground",children:f(e.createdAt)})})}),(0,v.jsx)(A,{message:e,senderName:s,senderEmail:n?.email,senderAvatarUrl:e.sender?.avatarUrl??null,isSelf:a,isGroupStart:e.isGroupStart,isGroupEnd:e.isGroupEnd,showAvatar:e.showAvatar,showTimestamp:e.showTimestamp,onDelete:O})]},e.id)})}),(0,v.jsx)("div",{ref:$})]})}),(0,v.jsxs)("div",{className:"relative z-10 border-t border-border bg-card px-6 py-4",children:[(0,v.jsxs)("div",{className:"flex items-end gap-2",children:[(0,v.jsxs)("div",{className:"flex items-center gap-1 shrink-0",children:[(0,v.jsx)(b.Button,{variant:"ghost",size:"icon",className:"h-9 w-9 text-muted-foreground hover:text-foreground",disabled:C,title:"Add emoji",children:(0,v.jsx)(U,{className:"h-5 w-5"})}),(0,v.jsx)(b.Button,{variant:"ghost",size:"icon",className:"h-9 w-9 text-muted-foreground hover:text-foreground",disabled:C,title:"Attach file",children:(0,v.jsx)(L,{className:"h-5 w-5"})})]}),(0,v.jsx)("div",{className:"flex-1 relative",children:(0,v.jsx)(R,{value:p,onChange:e=>j(e.target.value),onKeyDown:e=>{"Enter"===e.key&&(e.ctrlKey||e.metaKey)&&(e.preventDefault(),q())},placeholder:"Type a message…",disabled:C,className:(0,y.cn)("min-h-[44px] max-h-[200px]","bg-background text-foreground","border-border focus-within:border-primary","placeholder:text-muted-foreground","transition-all duration-200","px-4 py-3")})}),(0,v.jsx)(b.Button,{onClick:q,disabled:C||!p.trim(),size:"icon",className:(0,y.cn)("h-11 w-11 shrink-0 rounded-full shadow-lg","transition-all duration-200 ease-out",p.trim()?"scale-100 opacity-100 hover:scale-105 hover:shadow-xl active:scale-95":"scale-90 opacity-50 cursor-not-allowed"),children:C?(0,v.jsx)("div",{className:"h-4 w-4 border-2 border-primary-foreground/30 border-t-primary-foreground rounded-full animate-spin"}):(0,v.jsx)(_.Send,{className:"h-4 w-4"})})]}),p.trim()&&!C&&(0,v.jsxs)("p",{className:"text-[10px] text-muted-foreground mt-2 px-1",children:["Press ",(0,v.jsx)("kbd",{className:"px-1 py-0.5 rounded bg-muted text-foreground text-[10px]",children:"Ctrl"})," + ",(0,v.jsx)("kbd",{className:"px-1 py-0.5 rounded bg-muted text-foreground text-[10px]",children:"Enter"})," to send"]})]}),(0,v.jsx)(H.AlertDialog,{open:T,onOpenChange:M,children:(0,v.jsxs)(H.AlertDialogContent,{children:[(0,v.jsxs)(H.AlertDialogHeader,{children:[(0,v.jsx)(H.AlertDialogTitle,{children:"Delete Conversation?"}),(0,v.jsx)(H.AlertDialogDescription,{children:"This will permanently delete this conversation and all its messages. This action cannot be undone."})]}),(0,v.jsxs)(H.AlertDialogFooter,{children:[(0,v.jsx)(H.AlertDialogCancel,{children:"Cancel"}),(0,v.jsx)(H.AlertDialogAction,{onClick:B,className:"bg-red-600 hover:bg-red-700",children:"Delete"})]})]})}),(0,v.jsx)(H.AlertDialog,{open:!!V,onOpenChange:e=>!e&&O(null),children:(0,v.jsxs)(H.AlertDialogContent,{children:[(0,v.jsxs)(H.AlertDialogHeader,{children:[(0,v.jsx)(H.AlertDialogTitle,{children:"Delete Message?"}),(0,v.jsx)(H.AlertDialogDescription,{children:"This will permanently delete this message. This action cannot be undone."})]}),(0,v.jsxs)(H.AlertDialogFooter,{children:[(0,v.jsx)(H.AlertDialogCancel,{children:"Cancel"}),(0,v.jsx)(H.AlertDialogAction,{onClick:()=>V&&Y(V),className:"bg-red-600 hover:bg-red-700",children:"Delete"})]})]})})]})}e.s(["ConversationView",()=>V],715898)},752690,e=>{"use strict";var t=e.i(722679),r=e.i(340915);e.i(804306);var a=e.i(501328),n=e.i(282141),s=e.i(316264),l=e.i(129432),i=e.i(191569),o=e.i(74434),d=e.i(262823),c=e.i(135771),u=e.i(607730);function m({conversations:e,filters:a,onFiltersChange:m,onRefresh:h,onSelectConversation:p,activeConversationId:f,isLoading:g}){let[v,x]=(0,r.useState)(a.search||""),w=(0,r.useMemo)(()=>{let t={...a,search:v||void 0},r=(0,c.applyConversationFilters)(e,t);return(0,c.sortConversations)(r)},[e,a,v]),b=e.reduce((e,t)=>e+(t.unreadCount||0),0);return(0,t.jsxs)("aside",{className:"w-full sm:w-[320px] border-r bg-card flex flex-col",children:[(0,t.jsxs)("div",{className:"p-4 border-b space-y-3",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"text-lg font-semibold",children:"Team Contacts"}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:"Message your Verso relationship team"})]}),(0,t.jsx)(s.Button,{variant:"outline",size:"icon",onClick:h,disabled:g,children:(0,t.jsx)(d.RefreshCw,{className:(0,n.cn)("h-4 w-4",g&&"animate-spin")})})]}),(0,t.jsx)(i.Input,{value:v,onChange:e=>x(e.target.value),placeholder:"Search conversations"}),(0,t.jsxs)(s.Button,{variant:a.unreadOnly?"default":"outline",size:"sm",onClick:()=>m({...a,unreadOnly:!a.unreadOnly}),children:["Unread ",a.unreadOnly?"":`(${b})`]})]}),(0,t.jsx)("div",{className:"flex-1 overflow-y-auto bg-background",children:0===w.length?(0,t.jsx)("div",{className:"flex flex-col items-center justify-center h-full text-muted-foreground text-sm",children:g?"Loading conversations…":"No conversations yet."}):(0,t.jsx)("ul",{className:"p-2 space-y-1",children:w.map(e=>{let r=e.id===f,a=e.participants.find(e=>(e.role||"").startsWith("staff_")||"ceo"===e.role),s=a?.displayName||a?.email||e.subject||"Verso Team",i=e.participants.length>2?` +${e.participants.length-2}`:"",d=e.lastMessageAt||e.createdAt;return(0,t.jsx)("li",{children:(0,t.jsx)("button",{className:(0,n.cn)("w-full text-left px-3 py-3 rounded-lg group","transition-all duration-200 ease-out","hover:bg-muted/70 hover:shadow-md hover:scale-[1.02]","focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2","active:scale-[0.98]",r?"bg-muted shadow-sm scale-[1.01]":"bg-transparent"),onClick:()=>p(e.id),children:(0,t.jsxs)("div",{className:"flex items-start gap-3",children:[(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsxs)(o.Avatar,{className:"h-11 w-11 transition-transform duration-200 group-hover:scale-110",children:[a?.avatarUrl&&(0,t.jsx)(o.AvatarImage,{src:a.avatarUrl,alt:s}),(0,t.jsx)(o.AvatarFallback,{className:"bg-primary/10 text-primary text-sm font-medium",children:(0,u.getInitials)(s)})]}),e.unreadCount>0&&(0,t.jsx)("div",{className:"absolute -top-1 -right-1 h-5 w-5 rounded-full bg-primary flex items-center justify-center shadow-lg animate-pulse",children:(0,t.jsx)("span",{className:"text-[10px] font-bold text-primary-foreground",children:e.unreadCount>9?"9+":e.unreadCount})})]}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsxs)("div",{className:"flex items-baseline justify-between gap-2 mb-1",children:[(0,t.jsxs)("span",{className:(0,n.cn)("font-semibold truncate text-sm",(e.unreadCount,"text-foreground")),children:[s,i&&(0,t.jsx)("span",{className:"font-normal text-muted-foreground",children:i})]}),(0,t.jsx)("span",{className:"text-[10px] text-muted-foreground shrink-0",suppressHydrationWarning:!0,children:(0,u.formatRelativeTime)(d)})]}),(0,t.jsx)("p",{className:(0,n.cn)("text-xs truncate",e.unreadCount>0?"text-foreground/80 font-medium":"text-muted-foreground"),children:(0,u.truncateText)(e.preview||e.latestMessage?.body||"Start the conversation",60)}),a?.role&&(0,t.jsx)("div",{className:"flex items-center gap-2 mt-1.5",children:(0,t.jsx)(l.Badge,{variant:"outline",className:"text-[10px] capitalize px-1.5 py-0",children:a.role.replace("staff_","")})})]})]})})},e.id)})})})]})}var h=e.i(715898),p=e.i(59178),f=e.i(994500);let g={visibility:"investor",type:"all"};function v({currentUserId:e,initialConversations:n}){let[s,l]=(0,r.useState)(n),[i,o]=(0,r.useState)(n[0]?.id||null),[d,c]=(0,r.useState)(g),[u,v]=(0,r.useState)(!1),x=(0,r.useRef)(i);x.current=i;let w=(0,r.useMemo)(()=>s.find(e=>e.id===i)||null,[s,i]),b=(0,r.useCallback)(async(e,t=!1)=>{t||v(!0);try{let t=e||d,{conversations:r}=await (0,a.fetchConversationsClient)({...t,includeMessages:!0,limit:50});l(r),r.length>0&&!i&&o(r[0].id)}catch(e){f.toast.error(e.message||"Failed to load conversations")}finally{t||v(!1)}},[d,i]),y=(0,r.useCallback)(e=>{o(e),l(t=>t.map(t=>t.id===e?{...t,unreadCount:0}:t)),(0,a.markConversationRead)(e).catch(console.error)},[]);return(0,r.useEffect)(()=>{b(d)},[d,b]),(0,r.useEffect)(()=>{console.log("[Investor Messages] Setting up realtime subscription");let e=(0,p.createClient)(),t=e.channel("investor_conversations_all").on("postgres_changes",{event:"INSERT",schema:"public",table:"conversations"},()=>{console.log("[Realtime] New conversation created, refreshing list"),(0,a.fetchConversationsClient)({...d,includeMessages:!0,limit:50}).then(({conversations:e})=>{l(e)}).catch(console.error)}).on("postgres_changes",{event:"INSERT",schema:"public",table:"messages"},e=>{let t=e.new?.conversation_id;t&&t!==x.current&&(console.log("[Realtime] New message in background conversation, refreshing list"),(0,a.fetchConversationsClient)({...d,includeMessages:!0,limit:50}).then(({conversations:e})=>{l(e)}).catch(console.error))}).subscribe(e=>{console.log("[Realtime] Subscription status:",e)});return()=>{console.log("[Investor Messages] Cleaning up realtime subscription"),e.removeChannel(t)}},[d]),(0,t.jsxs)("div",{className:"flex h-[calc(100vh-4rem)] overflow-hidden",children:[(0,t.jsx)(m,{conversations:s,filters:d,onFiltersChange:c,onRefresh:()=>void b(d),onSelectConversation:y,activeConversationId:i,isLoading:u}),(0,t.jsx)("div",{className:"flex-1 flex flex-col",children:w?(0,t.jsx)(h.ConversationView,{conversation:w,currentUserId:e,onRead:()=>(0,a.markConversationRead)(w.id),onError:e=>f.toast.error(e),onDelete:e=>{l(t=>t.filter(t=>t.id!==e)),o(null),f.toast.success("Conversation deleted")}},w.id):(0,t.jsx)("div",{className:"flex items-center justify-center h-full text-muted-foreground",children:"Select a conversation to view messages."})})]})}e.s(["InvestorMessagingClient",()=>v],752690)},68929,e=>{e.v(e=>Promise.resolve().then(()=>e(788379)))}]);