(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,398472,e=>{"use strict";let a=(0,e.i(410587).default)("external-link",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]);e.s(["ExternalLink",()=>a],398472)},90613,e=>{"use strict";var a=e.i(722679),t=e.i(282141);function s({className:e,...s}){return(0,a.jsx)("div",{"data-slot":"card",className:(0,t.cn)("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",e),...s})}function l({className:e,...s}){return(0,a.jsx)("div",{"data-slot":"card-header",className:(0,t.cn)("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-1.5 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",e),...s})}function r({className:e,...s}){return(0,a.jsx)("div",{"data-slot":"card-title",className:(0,t.cn)("leading-none font-semibold",e),...s})}function d({className:e,...s}){return(0,a.jsx)("div",{"data-slot":"card-description",className:(0,t.cn)("text-muted-foreground text-sm",e),...s})}function n({className:e,...s}){return(0,a.jsx)("div",{"data-slot":"card-content",className:(0,t.cn)("px-6",e),...s})}function i({className:e,...s}){return(0,a.jsx)("div",{"data-slot":"card-footer",className:(0,t.cn)("flex items-center px-6 [.border-t]:pt-6",e),...s})}e.s(["Card",()=>s,"CardContent",()=>n,"CardDescription",()=>d,"CardFooter",()=>i,"CardHeader",()=>l,"CardTitle",()=>r])},15098,e=>{"use strict";let a=(0,e.i(410587).default)("circle-check",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);e.s(["CheckCircle2",()=>a],15098)},237635,e=>{"use strict";var a=e.i(722679),t=e.i(282141);function s({className:e,...s}){return(0,a.jsx)("div",{"data-slot":"table-container",className:"relative w-full overflow-x-auto",children:(0,a.jsx)("table",{"data-slot":"table",className:(0,t.cn)("w-full caption-bottom text-sm",e),...s})})}function l({className:e,...s}){return(0,a.jsx)("thead",{"data-slot":"table-header",className:(0,t.cn)("[&_tr]:border-b",e),...s})}function r({className:e,...s}){return(0,a.jsx)("tbody",{"data-slot":"table-body",className:(0,t.cn)("[&_tr:last-child]:border-0",e),...s})}function d({className:e,...s}){return(0,a.jsx)("tr",{"data-slot":"table-row",className:(0,t.cn)("hover:bg-muted/50 data-[state=selected]:bg-muted border-b transition-colors",e),...s})}function n({className:e,...s}){return(0,a.jsx)("th",{"data-slot":"table-head",className:(0,t.cn)("text-foreground h-11 md:h-10 px-2 text-left align-middle font-medium text-xs sm:text-sm [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",e),...s})}function i({className:e,...s}){return(0,a.jsx)("td",{"data-slot":"table-cell",className:(0,t.cn)("p-2 align-middle text-xs sm:text-sm [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",e),...s})}e.s(["Table",()=>s,"TableBody",()=>r,"TableCell",()=>i,"TableHead",()=>n,"TableHeader",()=>l,"TableRow",()=>d])},501495,e=>{"use strict";e.s(["formatBps",0,e=>null==e?"—":`${e} bps`,"formatCurrency",0,(e,a="USD")=>e?new Intl.NumberFormat("en-US",{style:"currency",currency:a,maximumFractionDigits:0}).format(e):"$0","formatDate",0,e=>{if(!e)return"—";let a="string"==typeof e?new Date(e):e;return Number.isNaN(a?.getTime?.())?"—":a.toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})}])},177737,e=>{"use strict";var a=e.i(722679),t=e.i(340915),s=e.i(90613),l=e.i(129432),r=e.i(316264),d=e.i(191569),n=e.i(538892),i=e.i(237635),c=e.i(691974),o=e.i(119311),m=e.i(645855),u=e.i(15098),x=e.i(750809),h=e.i(263229),g=e.i(401148),f=e.i(398472),p=e.i(971743),b=e.i(201495),j=e.i(758171),y=e.i(197098),_=e.i(282141),N=e.i(501495),v=e.i(59178),w=e.i(820417);let C={open:"bg-green-100 text-green-800 border-green-200 dark:bg-green-900/30 dark:text-green-300 dark:border-green-800",draft:"bg-gray-100 text-gray-800 border-gray-200 dark:bg-gray-800 dark:text-gray-300 dark:border-gray-700",closed:"bg-blue-100 text-blue-800 border-blue-200 dark:bg-blue-900/30 dark:text-blue-300 dark:border-blue-800",cancelled:"bg-red-100 text-red-800 border-red-200 dark:bg-red-900/30 dark:text-red-300 dark:border-red-800",allocation_pending:"bg-yellow-100 text-yellow-800 border-yellow-200 dark:bg-yellow-900/30 dark:text-yellow-300 dark:border-yellow-800",fully_subscribed:"bg-purple-100 text-purple-800 border-purple-200 dark:bg-purple-900/30 dark:text-purple-300 dark:border-purple-800"},k=[{label:"All Status",value:"all"},{label:"Open",value:"open"},{label:"Draft",value:"draft"},{label:"Closed",value:"closed"},{label:"Fully Subscribed",value:"fully_subscribed"}];function T(){let[e,T]=(0,t.useState)(null),[D,S]=(0,t.useState)([]),[H,A]=(0,t.useState)({totalAssigned:0,activeDeals:0,closedDeals:0,pendingReview:0}),[B,U]=(0,t.useState)(!0),[z,L]=(0,t.useState)(null),[R,q]=(0,t.useState)(""),[E,F]=(0,t.useState)("all"),[M,P]=(0,t.useState)(1);(0,t.useEffect)(()=>{async function e(e){let{data:a,error:t}=await e.from("deals").select(`
          id,
          name,
          company_name,
          company_logo_url,
          deal_type,
          status,
          currency,
          target_amount,
          close_at,
          created_at
        `).order("created_at",{ascending:!1}).limit(50);if(t)throw t;let s=(a||[]).map(e=>({id:e.id,name:e.name||"Untitled Deal",company_name:e.company_name,company_logo_url:e.company_logo_url,deal_type:e.deal_type||"unknown",status:e.status||"draft",currency:e.currency||"USD",target_amount:Number(e.target_amount)||0,close_at:e.close_at,created_at:e.created_at}));S(s);let l=s.filter(e=>"open"===e.status||"allocation_pending"===e.status).length,r=s.filter(e=>"closed"===e.status||"fully_subscribed"===e.status).length;A({totalAssigned:s.length,activeDeals:l,closedDeals:r,pendingReview:0})}!async function(){try{U(!0);let a=(0,v.createClient)(),{data:{user:t}}=await a.auth.getUser();if(!t)return void L("Not authenticated");let{data:s,error:l}=await a.from("lawyer_users").select("lawyer_id").eq("user_id",t.id).single();if(l||!s)return void await e(a);let{data:r,error:d}=await a.from("lawyers").select("id, firm_name, display_name, specializations, is_active").eq("id",s.lawyer_id).single();if(d)throw d;T(r);let{data:n,error:i}=await a.from("vehicles").select("id, name").eq("lawyer_id",s.lawyer_id);i&&console.error("Error fetching lawyer vehicles:",i);let c=(n||[]).map(e=>e.id),o=[];if(c.length>0){let{data:e,error:t}=await a.from("deals").select(`
              id,
              name,
              company_name,
              company_logo_url,
              deal_type,
              status,
              currency,
              target_amount,
              close_at,
              created_at,
              vehicle_id
            `).in("vehicle_id",c).order("created_at",{ascending:!1});t&&console.error("Error fetching deals:",t),o=(e||[]).map(e=>({id:e.id,name:e.name||"Untitled Deal",company_name:e.company_name,company_logo_url:e.company_logo_url,deal_type:e.deal_type||"unknown",status:e.status||"draft",currency:e.currency||"USD",target_amount:Number(e.target_amount)||0,close_at:e.close_at,created_at:e.created_at}))}else{let{data:e}=await a.from("lawyers").select("assigned_deals").eq("id",s.lawyer_id).single();if(e?.assigned_deals&&e.assigned_deals.length>0){let{data:t}=await a.from("deals").select(`
                id, name, company_name, company_logo_url, deal_type,
                status, currency, target_amount, close_at, created_at
              `).in("id",e.assigned_deals).order("created_at",{ascending:!1});o=(t||[]).map(e=>({id:e.id,name:e.name||"Untitled Deal",company_name:e.company_name,company_logo_url:e.company_logo_url,deal_type:e.deal_type||"unknown",status:e.status||"draft",currency:e.currency||"USD",target_amount:Number(e.target_amount)||0,close_at:e.close_at,created_at:e.created_at}))}}S(o);let m=o.filter(e=>"open"===e.status||"allocation_pending"===e.status).length,u=o.filter(e=>"closed"===e.status||"fully_subscribed"===e.status).length;A({totalAssigned:o.length,activeDeals:m,closedDeals:u,pendingReview:0}),L(null)}catch(e){console.error("[AssignedDealsPage] Error:",e),L(e instanceof Error?e.message:"Failed to load assigned deals")}finally{U(!1)}}()},[]);let V=D.filter(e=>{let a="all"===E||e.status===E,t=!R||e.name?.toLowerCase().includes(R.toLowerCase())||e.company_name?.toLowerCase().includes(R.toLowerCase());return a&&t}),$=Math.ceil(V.length/10),I=(M-1)*10,O=V.slice(I,I+10);return((0,t.useEffect)(()=>{P(1)},[R,E]),B)?(0,a.jsxs)("div",{className:"flex items-center justify-center py-16",children:[(0,a.jsx)(h.Loader2,{className:"h-8 w-8 animate-spin text-muted-foreground"}),(0,a.jsx)("span",{className:"ml-3 text-muted-foreground",children:"Loading assigned deals..."})]}):z?(0,a.jsxs)("div",{className:"text-center py-16",children:[(0,a.jsx)(g.AlertCircle,{className:"h-12 w-12 text-destructive mx-auto mb-4"}),(0,a.jsx)("h3",{className:"text-lg font-medium text-foreground mb-2",children:"Error Loading Deals"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:z})]}):(0,a.jsxs)("div",{className:"p-6 space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-foreground",children:"Assigned Deals"}),(0,a.jsx)("p",{className:"text-muted-foreground mt-1",children:e?`Manage deal documentation and escrow as ${e.display_name}`:"View all deals requiring legal review"})]}),e&&e.specializations&&e.specializations.length>0&&(0,a.jsx)("div",{className:"flex gap-1",children:e.specializations.slice(0,2).map((e,t)=>(0,a.jsx)(l.Badge,{variant:"outline",className:"capitalize",children:e},t))})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,a.jsxs)(s.Card,{children:[(0,a.jsx)(s.CardHeader,{className:"pb-2",children:(0,a.jsxs)(s.CardTitle,{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[(0,a.jsx)(c.Briefcase,{className:"h-4 w-4"}),"Total Assigned"]})}),(0,a.jsxs)(s.CardContent,{children:[(0,a.jsx)("div",{className:"text-2xl font-bold",children:H.totalAssigned}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Deals requiring attention"})]})]}),(0,a.jsxs)(s.Card,{children:[(0,a.jsx)(s.CardHeader,{className:"pb-2",children:(0,a.jsxs)(s.CardTitle,{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[(0,a.jsx)(b.Scale,{className:"h-4 w-4"}),"Active Deals"]})}),(0,a.jsxs)(s.CardContent,{children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-green-600",children:H.activeDeals}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Currently in progress"})]})]}),(0,a.jsxs)(s.Card,{children:[(0,a.jsx)(s.CardHeader,{className:"pb-2",children:(0,a.jsxs)(s.CardTitle,{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[(0,a.jsx)(u.CheckCircle2,{className:"h-4 w-4"}),"Completed"]})}),(0,a.jsxs)(s.CardContent,{children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-blue-600",children:H.closedDeals}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Successfully closed"})]})]}),(0,a.jsxs)(s.Card,{children:[(0,a.jsx)(s.CardHeader,{className:"pb-2",children:(0,a.jsxs)(s.CardTitle,{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[(0,a.jsx)(m.Clock,{className:"h-4 w-4"}),"Pending Review"]})}),(0,a.jsxs)(s.CardContent,{children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-orange-500",children:H.pendingReview}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Awaiting your review"})]})]})]}),(0,a.jsx)(s.Card,{children:(0,a.jsx)(s.CardContent,{className:"pt-6",children:(0,a.jsxs)("div",{className:"flex flex-col md:flex-row gap-4",children:[(0,a.jsx)("div",{className:"flex-1",children:(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(x.Search,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),(0,a.jsx)(d.Input,{placeholder:"Search by deal name or company...",value:R,onChange:e=>q(e.target.value),className:"pl-10"})]})}),(0,a.jsxs)(n.Select,{value:E,onValueChange:F,children:[(0,a.jsx)(n.SelectTrigger,{className:"w-full md:w-48",children:(0,a.jsx)(n.SelectValue,{placeholder:"Filter by status"})}),(0,a.jsx)(n.SelectContent,{children:k.map(e=>(0,a.jsx)(n.SelectItem,{value:e.value,children:e.label},e.value))})]})]})})}),(0,a.jsxs)(s.Card,{children:[(0,a.jsxs)(s.CardHeader,{children:[(0,a.jsx)(s.CardTitle,{children:"Deals"}),(0,a.jsxs)(s.CardDescription,{children:[V.length," deal",1!==V.length?"s":""," found"]})]}),(0,a.jsx)(s.CardContent,{children:0===V.length?(0,a.jsxs)("div",{className:"border border-dashed border-muted rounded-lg py-12 flex flex-col items-center justify-center text-center space-y-2",children:[(0,a.jsx)(o.FileText,{className:"h-10 w-10 text-muted-foreground"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:R||"all"!==E?"No deals match your filters":e?"No deals assigned to you yet":"No deals requiring legal review"}),e&&0===D.length&&(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"You will be notified when deals are assigned for your review"})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"rounded-md border",children:(0,a.jsxs)(i.Table,{children:[(0,a.jsx)(i.TableHeader,{children:(0,a.jsxs)(i.TableRow,{children:[(0,a.jsx)(i.TableHead,{children:"Deal"}),(0,a.jsx)(i.TableHead,{children:"Type"}),(0,a.jsx)(i.TableHead,{children:"Status"}),(0,a.jsx)(i.TableHead,{children:"Value"}),(0,a.jsx)(i.TableHead,{children:"Close Date"}),(0,a.jsx)(i.TableHead,{className:"text-right",children:"Actions"})]})}),(0,a.jsx)(i.TableBody,{children:O.map(e=>(0,a.jsxs)(i.TableRow,{children:[(0,a.jsx)(i.TableCell,{children:(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[e.company_logo_url?(0,a.jsx)("img",{src:e.company_logo_url,alt:e.company_name||"",className:"h-10 w-10 rounded-lg object-cover"}):(0,a.jsx)("div",{className:"h-10 w-10 rounded-lg bg-muted flex items-center justify-center",children:(0,a.jsx)(p.Building2,{className:"h-5 w-5 text-muted-foreground"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-medium",children:e.name}),e.company_name&&(0,a.jsx)("div",{className:"text-xs text-muted-foreground",children:e.company_name})]})]})}),(0,a.jsx)(i.TableCell,{children:(0,a.jsx)(l.Badge,{variant:"secondary",className:"capitalize",children:e.deal_type.replace("_"," ")})}),(0,a.jsx)(i.TableCell,{children:(0,a.jsx)(l.Badge,{variant:"outline",className:(0,_.cn)("capitalize",C[e.status]||C.draft),children:e.status.replace("_"," ")})}),(0,a.jsx)(i.TableCell,{children:(0,a.jsx)("div",{className:"font-medium",children:(0,N.formatCurrency)(e.target_amount,e.currency)})}),(0,a.jsx)(i.TableCell,{children:e.close_at?(0,a.jsx)("div",{className:"text-sm",children:(0,N.formatDate)(e.close_at)}):(0,a.jsx)("span",{className:"text-muted-foreground text-xs",children:"Not set"})}),(0,a.jsx)(i.TableCell,{className:"text-right",children:(0,a.jsx)(r.Button,{variant:"ghost",size:"sm",asChild:!0,children:(0,a.jsx)(w.default,{href:`/versotech_main/lawyer-deal/${e.id}`,children:(0,a.jsx)(f.ExternalLink,{className:"h-4 w-4"})})})})]},e.id))})]})}),$>1&&(0,a.jsxs)("div",{className:"flex items-center justify-between pt-4 border-t",children:[(0,a.jsxs)("div",{className:"text-sm text-muted-foreground",children:["Showing ",I+1,"-",Math.min(I+10,V.length)," of ",V.length," deals"]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)(r.Button,{variant:"outline",size:"sm",onClick:()=>P(e=>Math.max(1,e-1)),disabled:1===M,children:[(0,a.jsx)(j.ChevronLeft,{className:"h-4 w-4"}),"Previous"]}),(0,a.jsxs)("div",{className:"flex items-center gap-1 text-sm",children:[(0,a.jsx)("span",{children:"Page"}),(0,a.jsx)("span",{className:"font-medium",children:M}),(0,a.jsx)("span",{children:"of"}),(0,a.jsx)("span",{className:"font-medium",children:$})]}),(0,a.jsxs)(r.Button,{variant:"outline",size:"sm",onClick:()=>P(e=>Math.min($,e+1)),disabled:M===$,children:["Next",(0,a.jsx)(y.ChevronRight,{className:"h-4 w-4"})]})]})]})]})})]})]})}e.s(["default",()=>T])}]);