(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,355319,e=>{"use strict";var s=e.i(722679),t=e.i(340915),a=e.i(90613),r=e.i(129432),n=e.i(316264),i=e.i(191569),l=e.i(538892),d=e.i(237635),c=e.i(335994),o=e.i(971743),m=e.i(15098),u=e.i(750809),x=e.i(263229),h=e.i(401148),j=e.i(398472),g=e.i(773510),f=e.i(540318),p=e.i(360209),v=e.i(119311),_=e.i(818798),N=e.i(645855),y=e.i(831833),C=e.i(10994),b=e.i(561866),w=e.i(733179),S=e.i(820417),T=e.i(282141),D=e.i(501495),I=e.i(59178),F=e.i(304091),k=e.i(150327),q=e.i(429760),P=e.i(661521),B=e.i(501259),R=e.i(80465),E=e.i(745083),O=e.i(496383),L=e.i(582834),A=e.i(352776),U=e.i(514133),H=e.i(816654),z=e.i(168474);let V=[{value:"invested_amount",label:"Invested Amount"},{value:"spread",label:"Spread"},{value:"management_fee",label:"Management Fee"},{value:"performance_fee",label:"Performance Fee"}];function $({open:e,onOpenChange:a,introducerId:r,introducerName:d,deals:c,feePlans:o,onSuccess:m}){let[u,h]=(0,t.useState)(!1),[j,g]=(0,t.useState)(null),[f,p]=(0,t.useState)(""),[v,_]=(0,t.useState)(""),[N,y]=(0,t.useState)("invested_amount"),[C,b]=(0,t.useState)(""),[w,S]=(0,t.useState)(""),[T,I]=(0,t.useState)(""),[F,k]=(0,t.useState)("USD"),[q,P]=(0,t.useState)(""),[B,R]=(0,t.useState)("");(0,t.useEffect)(()=>{e&&(p(""),_(""),y("invested_amount"),b(""),S(""),I(""),k("USD"),P(""),R(""),g(null))},[e]),(0,t.useEffect)(()=>{if(C&&w){let e=parseFloat(C)/1e4,s=parseFloat(w);isNaN(e)||isNaN(s)||I((s*e).toFixed(2))}},[C,w]),(0,t.useEffect)(()=>{if(f){let e=c.find(e=>e.id===f);e?.currency&&k(e.currency)}},[f,c]),(0,t.useEffect)(()=>{if(v){let e=o.find(e=>e.id===v);if(e?.components&&e.components.length>0){let s=e.components.find(e=>e.rate_bps);s?.rate_bps&&b(s.rate_bps.toString())}}},[v,o]);let E=async()=>{if(!C||0>=parseFloat(C))return void g("Rate is required and must be greater than 0");if(!T||0>=parseFloat(T))return void g("Commission amount is required and must be greater than 0");h(!0),g(null);try{let e={introducer_id:r,deal_id:f||void 0,fee_plan_id:v||void 0,basis_type:N,rate_bps:parseInt(C,10),base_amount:w?parseFloat(w):void 0,accrual_amount:parseFloat(T),currency:F,payment_due_date:q||void 0,notes:B||void 0},s=await fetch("/api/arrangers/me/introducer-commissions",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!s.ok){let e=await s.json();throw Error(e.error||"Failed to record commission")}m(),a(!1)}catch(e){console.error("[RecordCommissionDialog] Error:",e),g(e instanceof Error?e.message:"Failed to record commission")}finally{h(!1)}},O=C?(parseFloat(C)/100).toFixed(2):"0.00";return(0,s.jsx)(A.Dialog,{open:e,onOpenChange:a,children:(0,s.jsxs)(A.DialogContent,{className:"max-w-lg",children:[(0,s.jsxs)(A.DialogHeader,{children:[(0,s.jsx)(A.DialogTitle,{children:"Record Commission"}),(0,s.jsxs)(A.DialogDescription,{children:["Record a commission owed to ",d]})]}),(0,s.jsxs)("div",{className:"space-y-4 py-4",children:[j&&(0,s.jsx)("div",{className:"bg-destructive/10 border border-destructive/30 text-destructive text-sm p-3 rounded",children:j}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(U.Label,{children:"Deal (Optional)"}),(0,s.jsxs)(l.Select,{value:f,onValueChange:p,children:[(0,s.jsx)(l.SelectTrigger,{children:(0,s.jsx)(l.SelectValue,{placeholder:"Select deal..."})}),(0,s.jsxs)(l.SelectContent,{children:[(0,s.jsx)(l.SelectItem,{value:"",children:"No specific deal"}),c.map(e=>(0,s.jsxs)(l.SelectItem,{value:e.id,children:[e.name," ",e.company_name&&`(${e.company_name})`]},e.id))]})]})]}),o.length>0&&(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(U.Label,{children:"Fee Plan (Optional)"}),(0,s.jsxs)(l.Select,{value:v,onValueChange:_,children:[(0,s.jsx)(l.SelectTrigger,{children:(0,s.jsx)(l.SelectValue,{placeholder:"Select fee plan..."})}),(0,s.jsxs)(l.SelectContent,{children:[(0,s.jsx)(l.SelectItem,{value:"",children:"No fee plan"}),o.map(e=>(0,s.jsx)(l.SelectItem,{value:e.id,children:e.name},e.id))]})]})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(U.Label,{children:"Commission Basis"}),(0,s.jsxs)(l.Select,{value:N,onValueChange:y,children:[(0,s.jsx)(l.SelectTrigger,{children:(0,s.jsx)(l.SelectValue,{})}),(0,s.jsx)(l.SelectContent,{children:V.map(e=>(0,s.jsx)(l.SelectItem,{value:e.value,children:e.label},e.value))})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(U.Label,{children:"Rate (basis points) *"}),(0,s.jsx)(i.Input,{type:"number",value:C,onChange:e=>b(e.target.value),placeholder:"e.g., 100 = 1%"}),C&&(0,s.jsxs)("p",{className:"text-xs text-muted-foreground",children:["= ",O,"%"]})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)(U.Label,{children:["Base Amount (",F,")"]}),(0,s.jsx)(i.Input,{type:"number",value:w,onChange:e=>S(e.target.value),placeholder:"e.g., 100000"})]})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)(U.Label,{className:"flex items-center gap-2",children:["Commission Amount (",F,") *",C&&w&&(0,s.jsxs)("span",{className:"text-xs text-muted-foreground flex items-center gap-1",children:[(0,s.jsx)(z.Calculator,{className:"h-3 w-3"}),"Auto-calculated"]})]}),(0,s.jsx)(i.Input,{type:"number",value:T,onChange:e=>I(e.target.value),placeholder:"Commission amount"}),T&&(0,s.jsx)("p",{className:"text-sm font-medium text-primary",children:(0,D.formatCurrency)(parseFloat(T),F)})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(U.Label,{children:"Payment Due Date (Optional)"}),(0,s.jsx)(i.Input,{type:"date",value:q,onChange:e=>P(e.target.value)})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(U.Label,{children:"Notes (Optional)"}),(0,s.jsx)(H.Textarea,{value:B,onChange:e=>R(e.target.value),placeholder:"Any additional notes...",rows:2})]})]}),(0,s.jsxs)(A.DialogFooter,{children:[(0,s.jsx)(n.Button,{variant:"outline",onClick:()=>a(!1),disabled:u,children:"Cancel"}),(0,s.jsx)(n.Button,{onClick:E,disabled:u,children:u?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(x.Loader2,{className:"h-4 w-4 mr-2 animate-spin"}),"Recording..."]}):"Record Commission"})]})]})})}function M({open:e,onOpenChange:a,commission:r,onSuccess:i}){let[l,d]=(0,t.useState)(!1),[c,o]=(0,t.useState)(null),m=async()=>{if(r){d(!0),o(null);try{let e=await fetch(`/api/arrangers/me/introducer-commissions/${r.id}/request-invoice`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({})});if(!e.ok){let s=await e.json();throw Error(s.error||"Failed to request invoice")}i(),a(!1)}catch(e){console.error("[RequestInvoiceDialog] Error:",e),o(e instanceof Error?e.message:"Failed to request invoice")}finally{d(!1)}}};if(!r)return null;let u=(0,D.formatCurrency)(r.accrual_amount,r.currency||"USD");return(0,s.jsx)(A.Dialog,{open:e,onOpenChange:a,children:(0,s.jsxs)(A.DialogContent,{className:"max-w-md",children:[(0,s.jsxs)(A.DialogHeader,{children:[(0,s.jsxs)(A.DialogTitle,{className:"flex items-center gap-2",children:[(0,s.jsx)(v.FileText,{className:"h-5 w-5"}),"Request Invoice"]}),(0,s.jsx)(A.DialogDescription,{children:"Send an invoice request notification to the introducer."})]}),(0,s.jsxs)("div",{className:"py-4 space-y-4",children:[c&&(0,s.jsx)("div",{className:"bg-destructive/10 border border-destructive/30 text-destructive text-sm p-3 rounded",children:c}),(0,s.jsxs)("div",{className:"bg-muted/50 p-4 rounded-lg space-y-2",children:[(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{className:"text-muted-foreground",children:"Introducer:"}),(0,s.jsx)("span",{className:"font-medium",children:r.introducer?.legal_name||"Unknown"})]}),r.deal&&(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{className:"text-muted-foreground",children:"Deal:"}),(0,s.jsx)("span",{className:"font-medium",children:r.deal.name})]}),(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{className:"text-muted-foreground",children:"Amount:"}),(0,s.jsx)("span",{className:"font-medium text-primary",children:u})]})]}),(0,s.jsxs)("div",{className:"flex items-start gap-2 text-sm text-muted-foreground",children:[(0,s.jsx)(g.Mail,{className:"h-4 w-4 mt-0.5 flex-shrink-0"}),(0,s.jsx)("p",{children:'The introducer will receive a notification asking them to submit their invoice for this commission. The commission status will be updated to "Invoice Requested".'})]})]}),(0,s.jsxs)(A.DialogFooter,{children:[(0,s.jsx)(n.Button,{variant:"outline",onClick:()=>a(!1),disabled:l,children:"Cancel"}),(0,s.jsx)(n.Button,{onClick:m,disabled:l,children:l?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(x.Loader2,{className:"h-4 w-4 mr-2 animate-spin"}),"Sending..."]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(g.Mail,{className:"h-4 w-4 mr-2"}),"Request Invoice"]})})]})]})})}function J({open:e,onOpenChange:a,commission:r,lawyers:i=[],onSuccess:d}){let[c,o]=(0,t.useState)(!1),[m,u]=(0,t.useState)(null),[h,j]=(0,t.useState)(""),[g,f]=(0,t.useState)("");(0,t.useEffect)(()=>{e&&(j(""),f(""),u(null))},[e]);let p=async()=>{if(r){o(!0),u(null);try{let e={};h&&(e.lawyer_id=h),g&&(e.notes=g);let s=await fetch(`/api/arrangers/me/introducer-commissions/${r.id}/request-payment`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!s.ok){let e=await s.json();throw Error(e.error||"Failed to request payment")}d(),a(!1)}catch(e){console.error("[RequestPaymentDialog] Error:",e),u(e instanceof Error?e.message:"Failed to request payment")}finally{o(!1)}}};if(!r)return null;let v=(0,D.formatCurrency)(r.accrual_amount,r.currency||"USD");return(0,s.jsx)(A.Dialog,{open:e,onOpenChange:a,children:(0,s.jsxs)(A.DialogContent,{className:"max-w-md",children:[(0,s.jsxs)(A.DialogHeader,{children:[(0,s.jsxs)(A.DialogTitle,{className:"flex items-center gap-2",children:[(0,s.jsx)(b.CreditCard,{className:"h-5 w-5"}),"Request Payment"]}),(0,s.jsx)(A.DialogDescription,{children:"Request payment approval from the legal team or CEO."})]}),(0,s.jsxs)("div",{className:"py-4 space-y-4",children:[m&&(0,s.jsx)("div",{className:"bg-destructive/10 border border-destructive/30 text-destructive text-sm p-3 rounded",children:m}),(0,s.jsxs)("div",{className:"bg-muted/50 p-4 rounded-lg space-y-2",children:[(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{className:"text-muted-foreground",children:"Introducer:"}),(0,s.jsx)("span",{className:"font-medium",children:r.introducer?.legal_name||"Unknown"})]}),r.deal&&(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{className:"text-muted-foreground",children:"Deal:"}),(0,s.jsx)("span",{className:"font-medium",children:r.deal.name})]}),(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{className:"text-muted-foreground",children:"Amount:"}),(0,s.jsx)("span",{className:"font-medium text-primary",children:v})]})]}),i.length>0&&(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(U.Label,{children:"Priority Lawyer (Optional)"}),(0,s.jsxs)(l.Select,{value:h,onValueChange:j,children:[(0,s.jsx)(l.SelectTrigger,{children:(0,s.jsx)(l.SelectValue,{placeholder:"Select lawyer..."})}),(0,s.jsxs)(l.SelectContent,{children:[(0,s.jsx)(l.SelectItem,{value:"",children:"Send to all assigned"}),i.map(e=>(0,s.jsx)(l.SelectItem,{value:e.id,children:e.legal_name},e.id))]})]}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground",children:"Optionally select a specific lawyer to prioritize for this payment request."})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(U.Label,{children:"Notes (Optional)"}),(0,s.jsx)(H.Textarea,{value:g,onChange:e=>f(e.target.value),placeholder:"Any payment instructions or notes...",rows:2})]}),(0,s.jsxs)("div",{className:"flex items-start gap-2 text-sm text-muted-foreground",children:[(0,s.jsx)(B.Users,{className:"h-4 w-4 mt-0.5 flex-shrink-0"}),(0,s.jsx)("p",{children:"This will notify the assigned lawyers and CEO/admin staff to process the payment to the introducer. Make sure the invoice has been received before requesting payment."})]})]}),(0,s.jsxs)(A.DialogFooter,{children:[(0,s.jsx)(n.Button,{variant:"outline",onClick:()=>a(!1),disabled:c,children:"Cancel"}),(0,s.jsx)(n.Button,{onClick:p,disabled:c,children:c?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(x.Loader2,{className:"h-4 w-4 mr-2 animate-spin"}),"Sending..."]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(b.CreditCard,{className:"h-4 w-4 mr-2"}),"Request Payment"]})})]})]})})}var K=e.i(671613);let W={active:"bg-green-100 text-green-800 border-green-200",pending:"bg-yellow-100 text-yellow-800 border-yellow-200",inactive:"bg-gray-100 text-gray-800 border-gray-200",suspended:"bg-red-100 text-red-800 border-red-200"},X={accrued:{icon:N.Clock,color:"text-blue-600"},invoice_requested:{icon:v.FileText,color:"text-yellow-600"},invoice_submitted:{icon:v.FileText,color:"text-indigo-600"},invoiced:{icon:v.FileText,color:"text-orange-600"},paid:{icon:R.CheckCircle,color:"text-green-600"},cancelled:{icon:E.XCircle,color:"text-red-600"},rejected:{icon:E.XCircle,color:"text-red-600"}};function Y({introducerId:e,open:i,onOpenChange:l}){let[d,c]=(0,t.useState)(null),[m,u]=(0,t.useState)(!1),[f,p]=(0,t.useState)(null),[_,C]=(0,t.useState)([]),[I,F]=(0,t.useState)(!1),[R,E]=(0,t.useState)(!1),[A,U]=(0,t.useState)(!1),[H,z]=(0,t.useState)(!1),[V,Y]=(0,t.useState)(null),[G,Q]=(0,t.useState)(!1),[Z,ee]=(0,t.useState)(null),es=async()=>{if(e){u(!0),p(null);try{let s=await fetch(`/api/arrangers/me/introducers/${e}`);if(!s.ok){let e=await s.json();throw Error(e.error||"Failed to load introducer details")}let t=await s.json();c(t.data)}catch(e){console.error("[IntroducerDetailDrawer] Error:",e),p(e instanceof Error?e.message:"Failed to load introducer details")}finally{u(!1)}}},et=async()=>{if(e){F(!0);try{let s=await fetch(`/api/arrangers/me/introducer-commissions?introducer_id=${e}&limit=20`);if(s.ok){let e=await s.json();C(e.data||[])}}catch(e){console.error("[IntroducerDetailDrawer] Error fetching commissions:",e)}finally{F(!1)}}};(0,t.useEffect)(()=>{if(!i||!e){c(null),p(null),C([]);return}es(),et()},[i,e]);let ea=()=>{es(),et()};return(0,s.jsx)(k.Sheet,{open:i,onOpenChange:l,children:(0,s.jsxs)(k.SheetContent,{className:"w-full sm:max-w-xl overflow-y-auto",children:[m&&(0,s.jsxs)("div",{className:"flex items-center justify-center py-16",children:[(0,s.jsx)(x.Loader2,{className:"h-8 w-8 animate-spin text-muted-foreground"}),(0,s.jsx)("span",{className:"ml-3 text-muted-foreground",children:"Loading introducer details..."})]}),f&&(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center py-16 text-center",children:[(0,s.jsx)(h.AlertCircle,{className:"h-12 w-12 text-destructive mb-4"}),(0,s.jsx)("p",{className:"text-muted-foreground",children:f}),(0,s.jsx)(n.Button,{variant:"outline",className:"mt-4",onClick:()=>l(!1),children:"Close"})]}),d&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(k.SheetHeader,{className:"pb-4",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[d.introducer.logo_url?(0,s.jsx)("img",{src:d.introducer.logo_url,alt:d.introducer.legal_name,className:"h-12 w-12 rounded-lg object-cover"}):(0,s.jsx)("div",{className:"h-12 w-12 rounded-lg bg-muted flex items-center justify-center",children:(0,s.jsx)(o.Building2,{className:"h-6 w-6 text-muted-foreground"})}),(0,s.jsxs)("div",{children:[(0,s.jsx)(k.SheetTitle,{children:d.introducer.legal_name}),(0,s.jsx)(k.SheetDescription,{children:d.introducer.contact_name&&(0,s.jsx)("span",{children:d.introducer.contact_name})})]})]}),(0,s.jsxs)("div",{className:"flex gap-2 mt-3",children:[(0,s.jsx)(r.Badge,{variant:"outline",className:(0,T.cn)("capitalize",W[d.introducer.status]||W.active),children:d.introducer.status}),d.introducer.default_commission_bps&&(0,s.jsxs)(r.Badge,{variant:"secondary",className:"text-xs",children:[(d.introducer.default_commission_bps/100).toFixed(2),"% default rate"]})]})]}),(0,s.jsx)(P.Separator,{className:"my-4"}),(0,s.jsxs)("div",{className:"grid grid-cols-3 gap-3 mb-6",children:[(0,s.jsxs)(a.Card,{className:"p-3",children:[(0,s.jsx)("div",{className:"text-2xl font-bold text-primary",children:d.stats.total_deals}),(0,s.jsx)("div",{className:"text-xs text-muted-foreground",children:"Deals"})]}),(0,s.jsxs)(a.Card,{className:"p-3",children:[(0,s.jsx)("div",{className:"text-2xl font-bold text-blue-600",children:d.stats.total_referrals}),(0,s.jsx)("div",{className:"text-xs text-muted-foreground",children:"Referrals"})]}),(0,s.jsxs)(a.Card,{className:"p-3",children:[(0,s.jsx)("div",{className:"text-2xl font-bold text-purple-600",children:d.stats.active_fee_plans}),(0,s.jsx)("div",{className:"text-xs text-muted-foreground",children:"Fee Plans"})]})]}),(0,s.jsxs)(q.Tabs,{defaultValue:"overview",className:"w-full",children:[(0,s.jsxs)(q.TabsList,{className:"grid w-full grid-cols-4",children:[(0,s.jsx)(q.TabsTrigger,{value:"overview",children:"Overview"}),(0,s.jsx)(q.TabsTrigger,{value:"fees",children:"Fee Plans"}),(0,s.jsx)(q.TabsTrigger,{value:"commissions",children:"Commissions"}),(0,s.jsx)(q.TabsTrigger,{value:"referrals",children:"Referrals"})]}),(0,s.jsxs)(q.TabsContent,{value:"overview",className:"mt-4 space-y-4",children:[(0,s.jsxs)(a.Card,{children:[(0,s.jsx)(a.CardHeader,{className:"pb-2",children:(0,s.jsx)(a.CardTitle,{className:"text-sm",children:"Contact Information"})}),(0,s.jsxs)(a.CardContent,{className:"space-y-2 text-sm",children:[d.introducer.contact_name&&(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(B.Users,{className:"h-4 w-4 text-muted-foreground"}),(0,s.jsx)("span",{children:d.introducer.contact_name})]}),d.introducer.email&&(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(g.Mail,{className:"h-4 w-4 text-muted-foreground"}),(0,s.jsx)("a",{href:`mailto:${d.introducer.email}`,className:"text-primary hover:underline",children:d.introducer.email})]})]})]}),(0,s.jsxs)(a.Card,{children:[(0,s.jsx)(a.CardHeader,{className:"pb-2",children:(0,s.jsx)(a.CardTitle,{className:"text-sm",children:"Commission Terms"})}),(0,s.jsxs)(a.CardContent,{className:"space-y-2 text-sm",children:[d.introducer.default_commission_bps?(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{className:"text-muted-foreground",children:"Default Rate:"}),(0,s.jsxs)("span",{className:"font-medium",children:[(d.introducer.default_commission_bps/100).toFixed(2),"%"]})]}):(0,s.jsx)("p",{className:"text-muted-foreground",children:"No default rate set"}),d.introducer.commission_cap_amount&&(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{className:"text-muted-foreground",children:"Commission Cap:"}),(0,s.jsx)("span",{className:"font-medium",children:(0,D.formatCurrency)(d.introducer.commission_cap_amount,"USD")})]}),d.introducer.payment_terms&&(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{className:"text-muted-foreground",children:"Payment Terms:"}),(0,s.jsx)("span",{className:"font-medium",children:d.introducer.payment_terms})]}),d.introducer.agreement_expiry_date&&(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{className:"text-muted-foreground",children:"Agreement Expiry:"}),(0,s.jsx)("span",{className:"font-medium",children:(0,D.formatDate)(d.introducer.agreement_expiry_date)})]})]})]}),d.deals.length>0&&(0,s.jsxs)(a.Card,{children:[(0,s.jsx)(a.CardHeader,{className:"pb-2",children:(0,s.jsx)(a.CardTitle,{className:"text-sm",children:"Deals Involved"})}),(0,s.jsx)(a.CardContent,{children:(0,s.jsx)("div",{className:"space-y-2",children:d.deals.map(e=>(0,s.jsxs)("div",{className:"flex items-center justify-between p-2 rounded-md bg-muted/50",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"font-medium text-sm",children:e.name}),e.company_name&&(0,s.jsx)("div",{className:"text-xs text-muted-foreground",children:e.company_name})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(r.Badge,{variant:"outline",className:"text-xs capitalize",children:e.status}),(0,s.jsx)(S.default,{href:`/versotech_main/opportunities/${e.id}`,children:(0,s.jsx)(n.Button,{variant:"ghost",size:"sm",children:(0,s.jsx)(j.ExternalLink,{className:"h-3.5 w-3.5"})})})]})]},e.id))})})]})]}),(0,s.jsx)(q.TabsContent,{value:"fees",className:"mt-4 space-y-4",children:0===d.fee_plans.length?(0,s.jsx)(a.Card,{children:(0,s.jsxs)(a.CardContent,{className:"py-8 text-center",children:[(0,s.jsx)(v.FileText,{className:"h-10 w-10 text-muted-foreground mx-auto mb-3"}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"No fee plans assigned to this introducer"}),(0,s.jsx)(S.default,{href:"/versotech_main/fee-plans",children:(0,s.jsx)(n.Button,{variant:"outline",size:"sm",className:"mt-3",children:"Create Fee Plan"})})]})}):d.fee_plans.map(e=>(0,s.jsxs)(a.Card,{children:[(0,s.jsxs)(a.CardHeader,{className:"pb-2",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)(a.CardTitle,{className:"text-sm",children:e.name}),(0,s.jsx)(r.Badge,{variant:e.is_active?"default":"secondary",children:e.is_active?"Active":"Inactive"})]}),e.description&&(0,s.jsx)(a.CardDescription,{className:"text-xs",children:e.description})]}),(0,s.jsxs)(a.CardContent,{children:[e.components&&e.components.length>0?(0,s.jsx)("div",{className:"flex flex-wrap gap-2",children:e.components.map((e,t)=>(0,s.jsxs)(r.Badge,{variant:"outline",className:"text-xs",children:[e.kind,": ",e.rate_bps?`${(e.rate_bps/100).toFixed(2)}%`:e.flat_amount?`$${e.flat_amount}`:"N/A"]},t))}):(0,s.jsx)("p",{className:"text-xs text-muted-foreground",children:"No fee components defined"}),e.effective_from&&(0,s.jsxs)("p",{className:"text-xs text-muted-foreground mt-2",children:["Effective from ",(0,D.formatDate)(e.effective_from),e.effective_until&&` to ${(0,D.formatDate)(e.effective_until)}`]})]})]},e.id))}),(0,s.jsxs)(q.TabsContent,{value:"commissions",className:"mt-4 space-y-4",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("h3",{className:"text-sm font-medium",children:"Commission Summary"}),(0,s.jsxs)(n.Button,{size:"sm",onClick:()=>E(!0),children:[(0,s.jsx)(y.Plus,{className:"h-4 w-4 mr-1"}),"Record Commission"]})]}),(0,s.jsx)(L.CommissionSummary,{summary:d.commission_summary}),I?(0,s.jsx)("div",{className:"flex items-center justify-center py-4",children:(0,s.jsx)(x.Loader2,{className:"h-4 w-4 animate-spin"})}):_.length>0?(0,s.jsxs)(a.Card,{children:[(0,s.jsx)(a.CardHeader,{className:"pb-2",children:(0,s.jsx)(a.CardTitle,{className:"text-sm",children:"Recent Commissions"})}),(0,s.jsx)(a.CardContent,{className:"space-y-2",children:_.slice(0,10).map(e=>{let t=X[e.status]?.icon||N.Clock,a=X[e.status]?.color||"text-gray-600";return(0,s.jsxs)("div",{className:"flex items-center justify-between p-2 rounded-md bg-muted/50",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(t,{className:(0,T.cn)("h-4 w-4",a)}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"font-medium text-sm",children:(0,D.formatCurrency)(e.accrual_amount,e.currency)}),(0,s.jsxs)("div",{className:"text-xs text-muted-foreground",children:[e.deal?.name||"No deal"," • ",(0,D.formatDate)(e.created_at)]})]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(r.Badge,{variant:"outline",className:"text-xs capitalize",children:e.status.replace("_"," ")}),"accrued"===e.status&&(0,s.jsxs)(n.Button,{size:"sm",variant:"outline",onClick:()=>{Y(e),U(!0)},children:[(0,s.jsx)(v.FileText,{className:"h-3.5 w-3.5 mr-1"}),"Request Invoice"]}),"invoiced"===e.status&&(0,s.jsxs)(n.Button,{size:"sm",variant:"outline",onClick:()=>{Y(e),z(!0)},children:[(0,s.jsx)(b.CreditCard,{className:"h-3.5 w-3.5 mr-1"}),"Request Payment"]}),("invoiced"===e.status||"paid"===e.status)&&e.invoice_id&&(0,s.jsxs)(n.Button,{size:"sm",variant:"ghost",onClick:()=>{e.invoice_id&&(ee({id:e.invoice_id,name:`Invoice - ${e.deal?.name||"Commission"}`,mimeType:"application/pdf"}),Q(!0))},className:"text-blue-600",children:[(0,s.jsx)(O.Eye,{className:"h-3.5 w-3.5 mr-1"}),"View Invoice"]})]})]},e.id)})})]}):null,(0,s.jsx)("div",{className:"flex justify-end",children:(0,s.jsx)(S.default,{href:"/versotech_main/introducer-reconciliation",children:(0,s.jsxs)(n.Button,{variant:"outline",size:"sm",children:[(0,s.jsx)(w.TrendingUp,{className:"h-4 w-4 mr-2"}),"View Reconciliation"]})})})]}),(0,s.jsx)(q.TabsContent,{value:"referrals",className:"mt-4 space-y-4",children:0===d.recent_referrals.length?(0,s.jsx)(a.Card,{children:(0,s.jsxs)(a.CardContent,{className:"py-8 text-center",children:[(0,s.jsx)(B.Users,{className:"h-10 w-10 text-muted-foreground mx-auto mb-3"}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"No referrals yet"})]})}):(0,s.jsxs)(a.Card,{children:[(0,s.jsxs)(a.CardHeader,{className:"pb-2",children:[(0,s.jsx)(a.CardTitle,{className:"text-sm",children:"Recent Referrals"}),(0,s.jsx)(a.CardDescription,{className:"text-xs",children:"Investors introduced to your deals"})]}),(0,s.jsx)(a.CardContent,{children:(0,s.jsx)("div",{className:"space-y-3",children:d.recent_referrals.map(e=>(0,s.jsxs)("div",{className:"flex items-center justify-between p-2 rounded-md bg-muted/50",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"font-medium text-sm",children:e.investor?.name||"Unknown Investor"}),(0,s.jsxs)("div",{className:"text-xs text-muted-foreground",children:[e.deal?.name||"Unknown Deal",e.deal?.company_name&&` • ${e.deal.company_name}`]})]}),(0,s.jsx)("div",{className:"text-xs text-muted-foreground",children:(0,D.formatDate)(e.created_at)})]},e.id))})})]})})]}),(0,s.jsx)($,{open:R,onOpenChange:E,introducerId:d.introducer.id,introducerName:d.introducer.legal_name,deals:d.deals,feePlans:d.fee_plans,onSuccess:ea}),(0,s.jsx)(M,{open:A,onOpenChange:U,commission:V,onSuccess:ea}),(0,s.jsx)(J,{open:H,onOpenChange:z,commission:V,onSuccess:ea}),Z&&(0,s.jsx)(K.DocumentViewer,{documentId:Z.id,documentName:Z.name,mimeType:Z.mimeType,open:G,onClose:()=>{Q(!1),ee(null)}})]})]})})}let G={active:"bg-green-100 text-green-800 border-green-200",pending:"bg-yellow-100 text-yellow-800 border-yellow-200",inactive:"bg-gray-100 text-gray-800 border-gray-200",suspended:"bg-red-100 text-red-800 border-red-200"},Q=[{label:"All Status",value:"all"},{label:"Active",value:"active"},{label:"Pending",value:"pending"},{label:"Inactive",value:"inactive"}];function Z(){let[e,k]=(0,t.useState)(null),[q,P]=(0,t.useState)([]),[B,R]=(0,t.useState)([]),[E,O]=(0,t.useState)([]),[A,U]=(0,t.useState)({totalIntroducers:0,activeIntroducers:0,totalReferrals:0,totalFeesOwed:0,totalFeesPaid:0,totalCommissions:0}),[H,z]=(0,t.useState)(!0),[V,$]=(0,t.useState)(null),[M,J]=(0,t.useState)(""),[K,W]=(0,t.useState)("all"),[X,Z]=(0,t.useState)("all"),[ee,es]=(0,t.useState)(!1),[et,ea]=(0,t.useState)(null),[er,en]=(0,t.useState)(!1),[ei,el]=(0,t.useState)(null),ed=async()=>{try{z(!0);let e=(0,I.createClient)(),{data:{user:s}}=await e.auth.getUser();if(!s)return void $("Not authenticated");let{data:t,error:a}=await e.from("arranger_users").select("arranger_id").eq("user_id",s.id).single();if(a||!t)return void await ec(e);let{data:r,error:n}=await e.from("arranger_entities").select("id, legal_name, status").eq("id",t.arranger_id).single();if(n)throw n;k(r);let{data:i}=await e.from("introducer_agreements").select(`
          id,
          agreement_type,
          status,
          created_at,
          arranger_signature_request_id,
          introducer:introducer_id (id, legal_name)
        `).eq("arranger_id",t.arranger_id).in("status",["approved","pending_arranger_signature"]).order("created_at",{ascending:!1}),l=[];for(let s of i||[]){let t=Array.isArray(s.introducer)?s.introducer[0]:s.introducer,a=null;if(s.arranger_signature_request_id){let{data:t}=await e.from("signature_requests").select("signing_token, status, token_expires_at").eq("id",s.arranger_signature_request_id).eq("status","pending").single();t&&new Date(t.token_expires_at)>new Date&&(a=`/versotech_main/versosign/sign/${t.signing_token}`)}l.push({id:s.id,introducer_name:t?.legal_name||"Unknown Introducer",introducer_id:t?.id||"",agreement_type:s.agreement_type,created_at:s.created_at,status:s.status,signing_url:a})}O(l);let{data:d,error:c}=await e.from("deals").select("id, name").eq("arranger_entity_id",t.arranger_id);if(c)throw c;if(R(d||[]),!d||0===d.length){P([]),U({totalIntroducers:0,activeIntroducers:0,totalReferrals:0,totalFeesOwed:0,totalFeesPaid:0,totalCommissions:0});return}let o=d.map(e=>e.id),{data:m,error:u}=await e.from("deal_memberships").select("referred_by_entity_id, investor_id, deal_id").in("deal_id",o).eq("referred_by_entity_type","introducer").not("referred_by_entity_id","is",null);if(u)throw u;let x=[...new Set((m||[]).map(e=>e.referred_by_entity_id))];if(0===x.length){P([]),U({totalIntroducers:0,activeIntroducers:0,totalReferrals:0,totalFeesOwed:0,totalFeesPaid:0,totalCommissions:0});return}let{data:h,error:j}=await e.from("introducers").select("*").in("id",x).order("legal_name");if(j)throw j;let{data:g}=await e.from("fee_plans").select("id, name, is_active, introducer_id").eq("created_by_arranger_id",t.arranger_id).in("introducer_id",x),f=new Map;(g||[]).forEach(e=>{let s=f.get(e.introducer_id)||[];s.push({id:e.id,name:e.name,is_active:e.is_active}),f.set(e.introducer_id,s)});let{data:p}=await e.from("introducer_commissions").select("introducer_id, status, accrual_amount, currency").eq("arranger_id",t.arranger_id).in("introducer_id",x),v=new Map;x.forEach(e=>{v.set(e,{accrued:0,invoice_requested:0,invoice_submitted:0,invoiced:0,paid:0,cancelled:0,total_owed:0,currency:"USD"})}),(p||[]).forEach(e=>{let s=v.get(e.introducer_id);if(s){let t=Number(e.accrual_amount)||0;"accrued"===e.status?s.accrued+=t:"invoice_requested"===e.status?s.invoice_requested+=t:"invoice_submitted"===e.status?s.invoice_submitted=(s.invoice_submitted||0)+t:"invoiced"===e.status?s.invoiced+=t:"paid"===e.status?s.paid+=t:"cancelled"===e.status&&(s.cancelled+=t),e.currency&&(s.currency=e.currency)}}),v.forEach(e=>{e.total_owed=e.accrued+e.invoice_requested+(e.invoice_submitted||0)+e.invoiced});let _=[...new Set((m||[]).filter(e=>e.investor_id).map(e=>e.investor_id))],{data:N}=await e.from("subscriptions").select("investor_id, commitment").in("investor_id",_),y=new Map;(N||[]).forEach(e=>{let s=y.get(e.investor_id)||0;y.set(e.investor_id,s+(Number(e.commitment)||0))});let C=(h||[]).map(e=>{let s=(m||[]).filter(s=>s.referred_by_entity_id===e.id),t=[...new Set(s.map(e=>e.deal_id).filter(Boolean))],a=s.reduce((e,s)=>s.investor_id?e+(y.get(s.investor_id)||0):e,0),r=v.get(e.id)||{accrued:0,invoice_requested:0,invoice_submitted:0,invoiced:0,paid:0,cancelled:0,total_owed:0,currency:"USD"};return{id:e.id,legal_name:e.legal_name||"Unknown Introducer",contact_name:e.contact_name,email:e.email,status:e.status||"active",default_commission_bps:e.default_commission_bps,commission_cap_amount:e.commission_cap_amount?Number(e.commission_cap_amount):null,agreement_expiry_date:e.agreement_expiry_date,logo_url:e.logo_url,deals_count:t.length,referrals_count:s.length,total_referral_value:a,fee_plans:f.get(e.id)||[],commission_summary:r}});P(C);let b=0,w=0;C.forEach(e=>{b+=e.commission_summary.total_owed,w+=e.commission_summary.paid}),U({totalIntroducers:C.length,activeIntroducers:C.filter(e=>"active"===e.status).length,totalReferrals:C.reduce((e,s)=>e+s.referrals_count,0),totalFeesOwed:b,totalFeesPaid:w,totalCommissions:b+w}),$(null)}catch(e){console.error("[MyIntroducersPage] Error:",e),$(e instanceof Error?e.message:"Failed to load introducers")}finally{z(!1)}};async function ec(e){let{data:s,error:t}=await e.from("introducers").select("*").order("legal_name").limit(100);if(t)throw t;let a=(s||[]).map(e=>({id:e.id,legal_name:e.legal_name||"Unknown Introducer",contact_name:e.contact_name,email:e.email,status:e.status||"active",default_commission_bps:e.default_commission_bps,commission_cap_amount:e.commission_cap_amount?Number(e.commission_cap_amount):null,agreement_expiry_date:e.agreement_expiry_date,logo_url:e.logo_url,deals_count:0,referrals_count:0,total_referral_value:0,fee_plans:[],commission_summary:{accrued:0,invoice_requested:0,invoiced:0,paid:0,cancelled:0,total_owed:0,currency:"USD"}}));P(a),U({totalIntroducers:a.length,activeIntroducers:a.filter(e=>"active"===e.status).length,totalReferrals:0,totalFeesOwed:0,totalFeesPaid:0,totalCommissions:0})}(0,t.useEffect)(()=>{ed()},[]);let eo=q.filter(e=>{let s="all"===K||e.status===K,t=!M||e.legal_name?.toLowerCase().includes(M.toLowerCase())||e.contact_name?.toLowerCase().includes(M.toLowerCase())||e.email?.toLowerCase().includes(M.toLowerCase());return s&&t&&!0}),em=new Date,eu=new Date(em.getTime()+2592e6),ex=e=>{el(e),en(!0)};return H?(0,s.jsxs)("div",{className:"flex items-center justify-center py-16",children:[(0,s.jsx)(x.Loader2,{className:"h-8 w-8 animate-spin text-muted-foreground"}),(0,s.jsx)("span",{className:"ml-3 text-muted-foreground",children:"Loading introducers..."})]}):V?(0,s.jsxs)("div",{className:"text-center py-16",children:[(0,s.jsx)(h.AlertCircle,{className:"h-12 w-12 text-destructive mx-auto mb-4"}),(0,s.jsx)("h3",{className:"text-lg font-medium text-foreground mb-2",children:"Error Loading Introducers"}),(0,s.jsx)("p",{className:"text-muted-foreground",children:V})]}):(0,s.jsxs)("div",{className:"p-6 space-y-6",children:[(0,s.jsx)("div",{className:"flex items-center justify-between",children:(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-2xl font-bold text-foreground",children:"My Introducers"}),(0,s.jsx)("p",{className:"text-muted-foreground mt-1",children:e?`Introducers working with ${e.legal_name}`:"View all registered introducers"})]})}),E.length>0&&(0,s.jsxs)(a.Card,{className:"border-amber-500/30 bg-amber-500/5",children:[(0,s.jsxs)(a.CardHeader,{className:"pb-3",children:[(0,s.jsxs)(a.CardTitle,{className:"text-lg flex items-center gap-2",children:[(0,s.jsx)(N.Clock,{className:"h-5 w-5 text-amber-500"}),"Agreements Awaiting Your Signature (",E.length,")"]}),(0,s.jsx)(a.CardDescription,{children:"Review and sign these introducer agreements to activate them"})]}),(0,s.jsx)(a.CardContent,{children:(0,s.jsx)("div",{className:"space-y-3",children:E.map(e=>(0,s.jsxs)("div",{className:"flex items-center justify-between p-3 rounded-lg border border-amber-500/20 bg-background",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("div",{className:"h-10 w-10 rounded-lg bg-amber-500/10 flex items-center justify-center",children:(0,s.jsx)(v.FileText,{className:"h-5 w-5 text-amber-500"})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"font-medium",children:e.introducer_name}),(0,s.jsxs)("div",{className:"text-sm text-muted-foreground capitalize",children:[e.agreement_type.replace(/_/g," ")," • Created ",(0,D.formatDate)(e.created_at)]})]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[e.signing_url?(0,s.jsx)(n.Button,{asChild:!0,size:"sm",className:"bg-amber-500 hover:bg-amber-600",children:(0,s.jsxs)(S.default,{href:e.signing_url,children:[(0,s.jsx)(_.PenTool,{className:"h-4 w-4 mr-1"}),"Sign Now"]})}):(0,s.jsxs)(n.Button,{size:"sm",onClick:async()=>{try{let s=await fetch(`/api/introducer-agreements/${e.id}/sign`,{method:"POST"});if(s.ok){let e=await s.json();e.signing_url&&(window.location.href=e.signing_url)}}catch(e){console.error("Failed to initiate signing:",e)}},className:"bg-amber-500 hover:bg-amber-600",children:[(0,s.jsx)(_.PenTool,{className:"h-4 w-4 mr-1"}),"Initiate Signing"]}),(0,s.jsx)(n.Button,{variant:"outline",size:"sm",asChild:!0,children:(0,s.jsx)(S.default,{href:`/versotech_main/introducer-agreements/${e.id}`,children:"View"})})]})]},e.id))})})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-6 gap-4",children:[(0,s.jsxs)(a.Card,{children:[(0,s.jsx)(a.CardHeader,{className:"pb-2",children:(0,s.jsxs)(a.CardTitle,{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[(0,s.jsx)(c.UserPlus,{className:"h-4 w-4"}),"Total Introducers"]})}),(0,s.jsxs)(a.CardContent,{children:[(0,s.jsx)("div",{className:"text-2xl font-bold",children:A.totalIntroducers}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"In your network"})]})]}),(0,s.jsxs)(a.Card,{children:[(0,s.jsx)(a.CardHeader,{className:"pb-2",children:(0,s.jsxs)(a.CardTitle,{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[(0,s.jsx)(m.CheckCircle2,{className:"h-4 w-4"}),"Active"]})}),(0,s.jsxs)(a.CardContent,{children:[(0,s.jsx)("div",{className:"text-2xl font-bold text-green-600",children:A.activeIntroducers}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"With valid agreements"})]})]}),(0,s.jsxs)(a.Card,{children:[(0,s.jsx)(a.CardHeader,{className:"pb-2",children:(0,s.jsxs)(a.CardTitle,{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[(0,s.jsx)(f.Handshake,{className:"h-4 w-4"}),"Referrals"]})}),(0,s.jsxs)(a.CardContent,{children:[(0,s.jsx)("div",{className:"text-2xl font-bold text-blue-600",children:A.totalReferrals}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Investors introduced"})]})]}),(0,s.jsxs)(a.Card,{children:[(0,s.jsx)(a.CardHeader,{className:"pb-2",children:(0,s.jsxs)(a.CardTitle,{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[(0,s.jsx)(w.TrendingUp,{className:"h-4 w-4"}),"Total Commissions"]})}),(0,s.jsxs)(a.CardContent,{children:[(0,s.jsx)("div",{className:"text-2xl font-bold text-purple-600",children:(0,D.formatCurrency)(A.totalCommissions,"USD")}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"All time"})]})]}),(0,s.jsxs)(a.Card,{children:[(0,s.jsx)(a.CardHeader,{className:"pb-2",children:(0,s.jsxs)(a.CardTitle,{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[(0,s.jsx)(C.Wallet,{className:"h-4 w-4"}),"Fees Owed"]})}),(0,s.jsxs)(a.CardContent,{children:[(0,s.jsx)("div",{className:"text-2xl font-bold text-orange-600",children:(0,D.formatCurrency)(A.totalFeesOwed,"USD")}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Pending payment"})]})]}),(0,s.jsxs)(a.Card,{children:[(0,s.jsx)(a.CardHeader,{className:"pb-2",children:(0,s.jsxs)(a.CardTitle,{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[(0,s.jsx)(b.CreditCard,{className:"h-4 w-4"}),"Fees Paid"]})}),(0,s.jsxs)(a.CardContent,{children:[(0,s.jsx)("div",{className:"text-2xl font-bold text-green-600",children:(0,D.formatCurrency)(A.totalFeesPaid,"USD")}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Completed"})]})]})]}),(0,s.jsx)(a.Card,{children:(0,s.jsx)(a.CardContent,{className:"pt-6",children:(0,s.jsxs)("div",{className:"flex flex-col md:flex-row gap-4",children:[(0,s.jsxs)("div",{className:"flex-1 relative",children:[(0,s.jsx)(u.Search,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),(0,s.jsx)(i.Input,{placeholder:"Search introducers...",value:M,onChange:e=>J(e.target.value),className:"pl-10"})]}),(0,s.jsxs)(l.Select,{value:K,onValueChange:W,children:[(0,s.jsx)(l.SelectTrigger,{className:"w-full md:w-48",children:(0,s.jsx)(l.SelectValue,{placeholder:"Filter by status"})}),(0,s.jsx)(l.SelectContent,{children:Q.map(e=>(0,s.jsx)(l.SelectItem,{value:e.value,children:e.label},e.value))})]}),B.length>0&&(0,s.jsxs)(l.Select,{value:X,onValueChange:Z,children:[(0,s.jsx)(l.SelectTrigger,{className:"w-full md:w-48",children:(0,s.jsx)(l.SelectValue,{placeholder:"Filter by deal"})}),(0,s.jsxs)(l.SelectContent,{children:[(0,s.jsx)(l.SelectItem,{value:"all",children:"All Deals"}),B.map(e=>(0,s.jsx)(l.SelectItem,{value:e.id,children:e.name},e.id))]})]})]})})}),(0,s.jsxs)(a.Card,{children:[(0,s.jsxs)(a.CardHeader,{children:[(0,s.jsx)(a.CardTitle,{children:"Introducers"}),(0,s.jsxs)(a.CardDescription,{children:[eo.length," introducer",1!==eo.length?"s":""," found"]})]}),(0,s.jsx)(a.CardContent,{children:0===eo.length?(0,s.jsxs)("div",{className:"border border-dashed border-muted rounded-lg py-12 flex flex-col items-center justify-center text-center space-y-2",children:[(0,s.jsx)(c.UserPlus,{className:"h-10 w-10 text-muted-foreground"}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:M||"all"!==K?"No introducers match your filters":"No introducers in your network yet"})]}):(0,s.jsx)("div",{className:"rounded-md border",children:(0,s.jsxs)(d.Table,{children:[(0,s.jsx)(d.TableHeader,{children:(0,s.jsxs)(d.TableRow,{children:[(0,s.jsx)(d.TableHead,{children:"Introducer"}),(0,s.jsx)(d.TableHead,{children:"Rate / Fee Plans"}),(0,s.jsx)(d.TableHead,{children:"Referrals"}),(0,s.jsx)(d.TableHead,{children:"Commission Status"}),(0,s.jsx)(d.TableHead,{children:"Agreement"}),(0,s.jsx)(d.TableHead,{children:"Status"}),(0,s.jsx)(d.TableHead,{className:"text-right",children:"Actions"})]})}),(0,s.jsx)(d.TableBody,{children:eo.map(t=>{let a=t.agreement_expiry_date&&new Date(t.agreement_expiry_date)<=eu&&new Date(t.agreement_expiry_date)>em,i=t.agreement_expiry_date&&new Date(t.agreement_expiry_date)<=em;return(0,s.jsxs)(d.TableRow,{className:"cursor-pointer hover:bg-muted/50",onClick:()=>ex(t.id),children:[(0,s.jsx)(d.TableCell,{children:(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[t.logo_url?(0,s.jsx)("img",{src:t.logo_url,alt:t.legal_name,className:"h-10 w-10 rounded-lg object-cover"}):(0,s.jsx)("div",{className:"h-10 w-10 rounded-lg bg-muted flex items-center justify-center",children:(0,s.jsx)(o.Building2,{className:"h-5 w-5 text-muted-foreground"})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"font-medium",children:t.legal_name}),t.email&&(0,s.jsxs)("div",{className:"text-xs text-muted-foreground flex items-center gap-1",children:[(0,s.jsx)(g.Mail,{className:"h-3 w-3"}),t.email]})]})]})}),(0,s.jsx)(d.TableCell,{onClick:e=>e.stopPropagation(),children:(0,s.jsxs)("div",{className:"space-y-1",children:[t.default_commission_bps?(0,s.jsxs)("div",{className:"font-medium flex items-center gap-1",children:[(0,s.jsx)(p.Percent,{className:"h-3 w-3"}),(t.default_commission_bps/100).toFixed(2),"%"]}):(0,s.jsx)("span",{className:"text-muted-foreground text-xs",children:"No default rate"}),t.fee_plans.length>0&&(0,s.jsxs)("div",{className:"flex flex-wrap gap-1",children:[t.fee_plans.slice(0,2).map(e=>(0,s.jsx)(r.Badge,{variant:e.is_active?"default":"secondary",className:"text-xs",children:e.name},e.id)),t.fee_plans.length>2&&(0,s.jsxs)(r.Badge,{variant:"outline",className:"text-xs",children:["+",t.fee_plans.length-2]})]})]})}),(0,s.jsx)(d.TableCell,{children:(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"font-medium",children:[t.referrals_count," referrals"]}),(0,s.jsxs)("div",{className:"text-xs text-muted-foreground",children:[t.deals_count," deal",1!==t.deals_count?"s":""]})]})}),(0,s.jsx)(d.TableCell,{onClick:e=>e.stopPropagation(),children:(0,s.jsx)(L.CommissionSummary,{summary:t.commission_summary,variant:"inline"})}),(0,s.jsx)(d.TableCell,{children:t.agreement_expiry_date?(0,s.jsxs)("div",{className:(0,T.cn)("text-sm",i&&"text-red-600",a&&"text-yellow-600"),children:[(0,s.jsxs)("div",{className:"flex items-center gap-1",children:[(0,s.jsx)(v.FileText,{className:"h-3 w-3"}),(0,D.formatDate)(t.agreement_expiry_date)]}),i&&(0,s.jsx)(r.Badge,{variant:"destructive",className:"text-xs mt-1",children:"Expired"}),a&&(0,s.jsx)(r.Badge,{variant:"outline",className:"text-xs mt-1 bg-yellow-100",children:"Expiring Soon"})]}):(0,s.jsx)("span",{className:"text-muted-foreground text-xs",children:"No agreement"})}),(0,s.jsx)(d.TableCell,{children:(0,s.jsx)(r.Badge,{variant:"outline",className:(0,T.cn)("capitalize",G[t.status]||G.active),children:t.status})}),(0,s.jsx)(d.TableCell,{className:"text-right",onClick:e=>e.stopPropagation(),children:(0,s.jsxs)("div",{className:"flex items-center justify-end gap-1",children:[e&&(0,s.jsxs)(n.Button,{variant:"outline",size:"sm",onClick:e=>{e.stopPropagation(),ea(t),es(!0)},children:[(0,s.jsx)(y.Plus,{className:"h-4 w-4 mr-1"}),"Agreement"]}),(0,s.jsx)(n.Button,{variant:"ghost",size:"sm",onClick:e=>{e.stopPropagation(),ex(t.id)},children:(0,s.jsx)(j.ExternalLink,{className:"h-4 w-4"})})]})})]},t.id)})})]})})})]}),et&&(0,s.jsx)(F.CreateAgreementDialog,{open:ee,onOpenChange:e=>{es(e),e||ea(null)},introducerId:et.id,introducerName:et.legal_name,defaultCommissionBps:et.default_commission_bps||100}),(0,s.jsx)(Y,{introducerId:ei,open:er,onOpenChange:en})]})}e.s(["default",()=>Z],355319)}]);