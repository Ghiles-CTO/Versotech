(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,603274,(e,t,r)=>{t.exports=e.r(750645)},262823,e=>{"use strict";let t=(0,e.i(410587).default)("refresh-cw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);e.s(["RefreshCw",()=>t],262823)},80465,e=>{"use strict";let t=(0,e.i(410587).default)("circle-check-big",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);e.s(["CheckCircle",()=>t],80465)},401148,e=>{"use strict";let t=(0,e.i(410587).default)("circle-alert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);e.s(["AlertCircle",()=>t],401148)},263229,e=>{"use strict";let t=(0,e.i(410587).default)("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);e.s(["Loader2",()=>t],263229)},410587,e=>{"use strict";var t=e.i(340915);let r=e=>{let t=e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,r)=>r?r.toUpperCase():t.toLowerCase());return t.charAt(0).toUpperCase()+t.slice(1)},i=(...e)=>e.filter((e,t,r)=>!!e&&""!==e.trim()&&r.indexOf(e)===t).join(" ").trim();var n={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let s=(0,t.forwardRef)(({color:e="currentColor",size:r=24,strokeWidth:s=2,absoluteStrokeWidth:a,className:o="",children:l,iconNode:d,...c},u)=>(0,t.createElement)("svg",{ref:u,...n,width:r,height:r,stroke:e,strokeWidth:a?24*Number(s)/Number(r):s,className:i("lucide",o),...!l&&!(e=>{for(let t in e)if(t.startsWith("aria-")||"role"===t||"title"===t)return!0})(c)&&{"aria-hidden":"true"},...c},[...d.map(([e,r])=>(0,t.createElement)(e,r)),...Array.isArray(l)?l:[l]])),a=(e,n)=>{let a=(0,t.forwardRef)(({className:a,...o},l)=>(0,t.createElement)(s,{ref:l,iconNode:n,className:i(`lucide-${r(e).replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()}`,`lucide-${e}`,a),...o}));return a.displayName=r(e),a};e.s(["default",()=>a],410587)},886978,e=>{"use strict";var t=e.i(340915);function r(e,t){if("function"==typeof e)return e(t);null!=e&&(e.current=t)}function i(...e){return t=>{let i=!1,n=e.map(e=>{let n=r(e,t);return i||"function"!=typeof n||(i=!0),n});if(i)return()=>{for(let t=0;t<n.length;t++){let i=n[t];"function"==typeof i?i():r(e[t],null)}}}}function n(...e){return t.useCallback(i(...e),e)}e.s(["composeRefs",()=>i,"useComposedRefs",()=>n])},179232,e=>{"use strict";let t,r,i;var n=e.i(340915),s=e.i(886978),a=e.i(722679),o=Symbol.for("react.lazy"),l=n[" use ".trim().toString()];function d(e){var t;return null!=e&&"object"==typeof e&&"$$typeof"in e&&e.$$typeof===o&&"_payload"in e&&"object"==typeof(t=e._payload)&&null!==t&&"then"in t}var c=((i=n.forwardRef((e,t)=>{let{children:r,...i}=e;if(d(r)&&"function"==typeof l&&(r=l(r._payload)),n.isValidElement(r)){var a;let e,o,l=(a=r,(o=(e=Object.getOwnPropertyDescriptor(a.props,"ref")?.get)&&"isReactWarning"in e&&e.isReactWarning)?a.ref:(o=(e=Object.getOwnPropertyDescriptor(a,"ref")?.get)&&"isReactWarning"in e&&e.isReactWarning)?a.props.ref:a.props.ref||a.ref),d=function(e,t){let r={...t};for(let i in t){let n=e[i],s=t[i];/^on[A-Z]/.test(i)?n&&s?r[i]=(...e)=>{let t=s(...e);return n(...e),t}:n&&(r[i]=n):"style"===i?r[i]={...n,...s}:"className"===i&&(r[i]=[n,s].filter(Boolean).join(" "))}return{...e,...r}}(i,r.props);return r.type!==n.Fragment&&(d.ref=t?(0,s.composeRefs)(t,l):l),n.cloneElement(r,d)}return n.Children.count(r)>1?n.Children.only(null):null})).displayName="Slot.SlotClone",t=i,(r=n.forwardRef((e,r)=>{let{children:i,...s}=e;d(i)&&"function"==typeof l&&(i=l(i._payload));let o=n.Children.toArray(i),c=o.find(m);if(c){let e=c.props.children,i=o.map(t=>t!==c?t:n.Children.count(e)>1?n.Children.only(null):n.isValidElement(e)?e.props.children:null);return(0,a.jsx)(t,{...s,ref:r,children:n.isValidElement(e)?n.cloneElement(e,void 0,i):null})}return(0,a.jsx)(t,{...s,ref:r,children:i})})).displayName="Slot.Slot",r),u=Symbol("radix.slottable");function m(e){return n.isValidElement(e)&&"function"==typeof e.type&&"__radixId"in e.type&&e.type.__radixId===u}e.s(["Slot",()=>c])},414846,e=>{"use strict";var t=e.i(863920);let r=e=>"boolean"==typeof e?`${e}`:0===e?"0":e,i=t.clsx;e.s(["cva",0,(e,t)=>n=>{var s;if((null==t?void 0:t.variants)==null)return i(e,null==n?void 0:n.class,null==n?void 0:n.className);let{variants:a,defaultVariants:o}=t,l=Object.keys(a).map(e=>{let t=null==n?void 0:n[e],i=null==o?void 0:o[e];if(null===t)return null;let s=r(t)||r(i);return a[e][s]}),d=n&&Object.entries(n).reduce((e,t)=>{let[r,i]=t;return void 0===i||(e[r]=i),e},{});return i(e,l,null==t||null==(s=t.compoundVariants)?void 0:s.reduce((e,t)=>{let{class:r,className:i,...n}=t;return Object.entries(n).every(e=>{let[t,r]=e;return Array.isArray(r)?r.includes({...o,...d}[t]):({...o,...d})[t]===r})?[...e,r,i]:e},[]),null==n?void 0:n.class,null==n?void 0:n.className)}])},316264,e=>{"use strict";var t=e.i(722679),r=e.i(179232),i=e.i(414846),n=e.i(282141);let s=(0,i.cva)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-gradient-to-r from-blue-600 to-blue-700 text-white hover:from-blue-700 hover:to-blue-800 hover:shadow-lg hover:scale-[1.02] transition-all duration-200 shadow-md",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border border-input bg-background text-foreground shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"text-foreground hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-11 md:h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-10 md:h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-12 md:h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-11 md:size-9"}},defaultVariants:{variant:"default",size:"default"}});function a({className:e,variant:i,size:a,asChild:o=!1,...l}){let d=o?r.Slot:"button";return(0,t.jsx)(d,{"data-slot":"button",className:(0,n.cn)(s({variant:i,size:a,className:e})),...l})}e.s(["Button",()=>a,"buttonVariants",()=>s])},90613,e=>{"use strict";var t=e.i(722679),r=e.i(282141);function i({className:e,...i}){return(0,t.jsx)("div",{"data-slot":"card",className:(0,r.cn)("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",e),...i})}function n({className:e,...i}){return(0,t.jsx)("div",{"data-slot":"card-header",className:(0,r.cn)("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-1.5 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",e),...i})}function s({className:e,...i}){return(0,t.jsx)("div",{"data-slot":"card-title",className:(0,r.cn)("leading-none font-semibold",e),...i})}function a({className:e,...i}){return(0,t.jsx)("div",{"data-slot":"card-description",className:(0,r.cn)("text-muted-foreground text-sm",e),...i})}function o({className:e,...i}){return(0,t.jsx)("div",{"data-slot":"card-content",className:(0,r.cn)("px-6",e),...i})}function l({className:e,...i}){return(0,t.jsx)("div",{"data-slot":"card-footer",className:(0,r.cn)("flex items-center px-6 [.border-t]:pt-6",e),...i})}e.s(["Card",()=>i,"CardContent",()=>o,"CardDescription",()=>a,"CardFooter",()=>l,"CardHeader",()=>n,"CardTitle",()=>s])},191569,e=>{"use strict";var t=e.i(722679),r=e.i(282141);function i({className:e,type:i,...n}){return(0,t.jsx)("input",{type:i,"data-slot":"input",className:(0,r.cn)("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground bg-background border-input h-11 md:h-9 w-full min-w-0 rounded-md border px-3 py-1 text-base text-foreground shadow-sm transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-blue-500 focus-visible:ring-blue-500/20 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",e),...n})}e.s(["Input",()=>i])},773510,e=>{"use strict";let t=(0,e.i(410587).default)("mail",[["path",{d:"m22 7-8.991 5.727a2 2 0 0 1-2.009 0L2 7",key:"132q7q"}],["rect",{x:"2",y:"4",width:"20",height:"16",rx:"2",key:"izxlao"}]]);e.s(["Mail",()=>t],773510)},111471,e=>{"use strict";var t=e.i(722679),r=e.i(340915),i=e.i(603274),n=e.i(316264),s=e.i(90613),a=e.i(191569),o=e.i(263229),l=e.i(773510),d=e.i(80465),c=e.i(401148),u=e.i(262823);function m(){let e=(0,i.useParams)(),m=(0,i.useRouter)(),f=e.token,[p,g]=(0,r.useState)({loading:!0,sendingOtp:!1,verifying:!1,error:null,success:!1,otpSent:!1,maskedEmail:null,expiresIn:600,waitSeconds:0,attemptsRemaining:3}),[x,h]=(0,r.useState)(""),v=(0,r.useCallback)(async()=>{try{let e=await fetch(`/api/signature/${f}`);if(!e.ok){let t=await e.json();g(e=>({...e,loading:!1,error:t.error||"Invalid signature link"}));return}let t=await e.json();if(!t.verification_required||t.verification_completed_at)return void m.replace(`/sign/${f}`);g(e=>({...e,loading:!1,maskedEmail:function(e){let[t,r]=e.split("@");if(!r)return"***";let i=Math.min(2,t.length);return`${t.substring(0,i)}***@${r}`}(t.signer_email)}))}catch(e){console.error("Error checking verification:",e),g(e=>({...e,loading:!1,error:"Failed to load verification page"}))}},[f,m]);(0,r.useEffect)(()=>{f?v():g(e=>({...e,loading:!1,error:"Invalid signature token"}))},[f,v]),(0,r.useEffect)(()=>{if(p.waitSeconds>0){let e=setTimeout(()=>{g(e=>({...e,waitSeconds:e.waitSeconds-1}))},1e3);return()=>clearTimeout(e)}},[p.waitSeconds]);let y=async()=>{g(e=>({...e,sendingOtp:!0,error:null}));try{let e=await fetch(`/api/signature/${f}/verify/send-otp`,{method:"POST"}),t=await e.json();if(!e.ok){if(429===e.status&&t.wait_seconds)return void g(e=>({...e,sendingOtp:!1,waitSeconds:t.wait_seconds,error:t.error}));g(e=>({...e,sendingOtp:!1,error:t.error||"Failed to send verification code"}));return}if(t.already_verified)return void m.replace(`/sign/${f}`);g(e=>({...e,sendingOtp:!1,otpSent:!0,maskedEmail:t.email_sent_to,expiresIn:t.expires_in_seconds||600,error:null}))}catch(e){console.error("Error sending OTP:",e),g(e=>({...e,sendingOtp:!1,error:"Failed to send verification code"}))}},b=async()=>{if(6!==x.length)return void g(e=>({...e,error:"Please enter the 6-digit code"}));g(e=>({...e,verifying:!0,error:null}));try{let e=await fetch(`/api/signature/${f}/verify/validate`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({otp:x})}),t=await e.json();if(!e.ok){g(e=>({...e,verifying:!1,error:t.error||"Verification failed",attemptsRemaining:t.attempts_remaining??e.attemptsRemaining})),(t.attempts_exceeded||t.expired)&&(g(e=>({...e,otpSent:!1,attemptsRemaining:3})),h(""));return}(t.already_verified||t.success)&&(g(e=>({...e,verifying:!1,success:!0})),setTimeout(()=>{m.replace(`/sign/${f}`)},1500))}catch(e){console.error("Error validating OTP:",e),g(e=>({...e,verifying:!1,error:"Verification failed. Please try again."}))}};return p.loading?(0,t.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-muted/50 to-background",children:(0,t.jsxs)("div",{className:"flex flex-col items-center gap-4",children:[(0,t.jsx)(o.Loader2,{className:"h-8 w-8 animate-spin text-muted-foreground"}),(0,t.jsx)("p",{className:"text-muted-foreground",children:"Loading verification..."})]})}):p.error&&!p.otpSent?(0,t.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-muted/50 to-background p-4",children:(0,t.jsxs)(s.Card,{className:"max-w-md w-full p-8 text-center",children:[(0,t.jsx)(c.AlertCircle,{className:"h-12 w-12 text-red-500 mx-auto mb-4"}),(0,t.jsx)("div",{className:"text-red-600 dark:text-red-400 text-xl font-semibold mb-4",children:p.error}),(0,t.jsx)("p",{className:"text-muted-foreground",children:"This verification link may be invalid or expired."})]})}):p.success?(0,t.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-muted/50 to-background p-4",children:(0,t.jsxs)(s.Card,{className:"max-w-md w-full p-8 text-center",children:[(0,t.jsx)(d.CheckCircle,{className:"h-16 w-16 text-green-500 mx-auto mb-4"}),(0,t.jsx)("h2",{className:"text-2xl font-bold text-foreground mb-2",children:"Email Verified"}),(0,t.jsx)("p",{className:"text-muted-foreground mb-4",children:"Redirecting you to the signature page..."}),(0,t.jsx)(o.Loader2,{className:"h-6 w-6 animate-spin text-muted-foreground mx-auto"})]})}):(0,t.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-muted/50 to-background p-4",children:(0,t.jsxs)("div",{className:"max-w-md mx-auto py-8",children:[(0,t.jsxs)(s.Card,{className:"p-8",children:[(0,t.jsxs)("div",{className:"text-center mb-8",children:[(0,t.jsx)(l.Mail,{className:"h-12 w-12 text-blue-500 mx-auto mb-4"}),(0,t.jsx)("h1",{className:"text-2xl font-bold text-foreground mb-2",children:"Verify Your Email"}),(0,t.jsx)("p",{className:"text-muted-foreground",children:"For security, please verify your email address before signing."})]}),p.otpSent?(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("p",{className:"text-sm text-muted-foreground mb-2",children:"Enter the 6-digit code sent to:"}),(0,t.jsx)("p",{className:"font-medium text-foreground",children:p.maskedEmail})]}),(0,t.jsx)("div",{children:(0,t.jsx)(a.Input,{type:"text",inputMode:"numeric",pattern:"[0-9]*",maxLength:6,value:x,onChange:e=>{h(e.target.value.replace(/\D/g,"").slice(0,6)),p.error&&g(e=>({...e,error:null}))},onKeyDown:e=>{"Enter"===e.key&&6===x.length&&b()},placeholder:"000000",className:"text-center text-2xl tracking-[0.5em] font-mono h-14",autoFocus:!0})}),p.error&&(0,t.jsx)("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg text-red-700 text-sm text-center",children:p.error}),(0,t.jsx)(n.Button,{className:"w-full",onClick:b,disabled:p.verifying||6!==x.length,children:p.verifying?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(o.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),"Verifying..."]}):"Verify Code"}),(0,t.jsx)("div",{className:"flex justify-center",children:(0,t.jsxs)(n.Button,{variant:"ghost",size:"sm",onClick:y,disabled:p.sendingOtp||p.waitSeconds>0,className:"text-muted-foreground",children:[(0,t.jsx)(u.RefreshCw,{className:"mr-2 h-4 w-4"}),p.waitSeconds>0?`Resend in ${p.waitSeconds}s`:"Resend Code"]})}),(0,t.jsxs)("p",{className:"text-xs text-center text-muted-foreground",children:["Code expires in ",Math.floor(p.expiresIn/60)," minutes"]})]}):(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)("p",{className:"text-center text-sm text-muted-foreground",children:"We'll send a 6-digit verification code to:"}),(0,t.jsx)("p",{className:"text-center font-medium text-foreground",children:p.maskedEmail||"***@***.***"}),(0,t.jsx)(n.Button,{className:"w-full",onClick:y,disabled:p.sendingOtp||p.waitSeconds>0,children:p.sendingOtp?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(o.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),"Sending..."]}):p.waitSeconds>0?`Wait ${p.waitSeconds}s`:"Send Verification Code"})]})]}),(0,t.jsx)("div",{className:"mt-6 text-center text-xs text-muted-foreground",children:(0,t.jsx)("p",{children:"This verification ensures only you can sign this document. If you did not request this, please ignore this page."})})]})})}e.s(["default",()=>m])}]);