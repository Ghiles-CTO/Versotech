(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,899318,907596,501025,287020,494335,e=>{"use strict";var s=e.i(722679),t=e.i(340915),a=e.i(603274),r=e.i(90613),n=e.i(196767),l=e.i(119311),i=e.i(401148),c=e.i(733179),d=e.i(501259),o=e.i(35334),m=e.i(540318),x=e.i(691974),h=e.i(398472),u=e.i(30100),p=e.i(316264);function j(e,s="USD"){return new Intl.NumberFormat("en-US",{style:"currency",currency:s,minimumFractionDigits:2,maximumFractionDigits:2}).format(e)}function f(e){return`${(e/1e4*100).toFixed(2)}%`}function g(){let e=(0,a.useRouter)(),[f,g]=(0,t.useState)(null),[b,N]=(0,t.useState)(null),[y,v]=(0,t.useState)(!0),[w,_]=(0,t.useState)(!0);(0,t.useEffect)(()=>{C()},[]);let C=async()=>{try{let[e,s]=await Promise.all([fetch("/api/staff/fees/dashboard"),fetch("/api/staff/fees/projected")]),[t,a]=await Promise.all([e.json(),s.json()]);g(t.data),N(a.data)}catch(e){console.error("Error fetching overview data:",e)}finally{v(!1),_(!1)}};return y?(0,s.jsx)("div",{className:"text-white",children:"Loading..."}):f?(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[(0,s.jsxs)(r.Card,{children:[(0,s.jsxs)(r.CardHeader,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,s.jsx)(r.CardTitle,{className:"text-sm font-medium",children:"Total Fees (YTD)"}),(0,s.jsx)(n.DollarSign,{className:"h-4 w-4 text-muted-foreground"})]}),(0,s.jsxs)(r.CardContent,{children:[(0,s.jsx)("div",{className:"text-2xl font-bold text-white",children:j(f.total_fees_ytd)}),(0,s.jsxs)("p",{className:"text-xs text-gray-400",children:["MTD: ",j(f.total_fees_mtd)]})]})]}),(0,s.jsxs)(r.Card,{className:"cursor-pointer hover:bg-accent/50 transition-colors",onClick:()=>e.push("/versotech_main/reconciliation"),children:[(0,s.jsxs)(r.CardHeader,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,s.jsx)(r.CardTitle,{className:"text-sm font-medium",children:"Outstanding Invoices"}),(0,s.jsx)(l.FileText,{className:"h-4 w-4 text-muted-foreground"})]}),(0,s.jsxs)(r.CardContent,{children:[(0,s.jsx)("div",{className:"text-2xl font-bold text-white",children:j(f.outstanding_invoices_amount)}),(0,s.jsxs)("div",{className:"flex items-center justify-between mt-1",children:[(0,s.jsxs)("p",{className:"text-xs text-gray-400",children:[f.outstanding_invoices_count," invoices"]}),(0,s.jsxs)("span",{className:"text-xs text-blue-400 flex items-center gap-1",children:["View Invoices ",(0,s.jsx)(u.ArrowRight,{className:"h-3 w-3"})]})]})]})]}),(0,s.jsxs)(r.Card,{children:[(0,s.jsxs)(r.CardHeader,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,s.jsx)(r.CardTitle,{className:"text-sm font-medium",children:"Overdue"}),(0,s.jsx)(i.AlertCircle,{className:"h-4 w-4 text-destructive"})]}),(0,s.jsxs)(r.CardContent,{children:[(0,s.jsx)("div",{className:"text-2xl font-bold text-destructive",children:j(f.overdue_invoices_amount)}),(0,s.jsxs)("p",{className:"text-xs text-gray-400",children:[f.overdue_invoices_count," overdue invoices"]})]})]}),(0,s.jsxs)(r.Card,{children:[(0,s.jsxs)(r.CardHeader,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,s.jsx)(r.CardTitle,{className:"text-sm font-medium",children:"Upcoming Fees (30d)"}),(0,s.jsx)(c.TrendingUp,{className:"h-4 w-4 text-muted-foreground"})]}),(0,s.jsxs)(r.CardContent,{children:[(0,s.jsx)("div",{className:"text-2xl font-bold text-white",children:j(f.upcoming_fees_30days)}),(0,s.jsxs)("p",{className:"text-xs text-gray-400",children:[f.upcoming_fees_count," scheduled fees"]})]})]})]}),f.commission_summary&&(0,s.jsxs)(r.Card,{children:[(0,s.jsxs)(r.CardHeader,{className:"flex flex-row items-start justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)(r.CardTitle,{className:"text-white flex items-center gap-2",children:[(0,s.jsx)(d.Users,{className:"h-5 w-5"}),"Commissions"]}),(0,s.jsx)("p",{className:"text-sm text-gray-400 mt-1",children:"Commission expenses across all entity types (Introducers, Partners, Commercial Partners)"})]}),(0,s.jsxs)(p.Button,{variant:"outline",size:"sm",onClick:()=>e.push("/versotech_main/arranger-reconciliation"),className:"border-gray-600 hover:bg-gray-800",children:["View Reconciliation",(0,s.jsx)(u.ArrowRight,{className:"ml-2 h-4 w-4"})]})]}),(0,s.jsx)(r.CardContent,{children:(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"grid gap-4 md:grid-cols-3",children:[(0,s.jsxs)("div",{className:"p-4 bg-red-900/20 rounded border border-red-700",children:[(0,s.jsx)("p",{className:"text-xs text-red-300 mb-1",children:"Total Commissions Owed"}),(0,s.jsx)("p",{className:"text-2xl font-bold text-white",children:j(f.commission_summary.total_owed)}),(0,s.jsx)("p",{className:"text-xs text-gray-400 mt-1",children:"Accrued + Invoiced"})]}),(0,s.jsxs)("div",{className:"p-4 bg-green-900/20 rounded border border-green-700",children:[(0,s.jsx)("p",{className:"text-xs text-green-300 mb-1",children:"Total Paid YTD"}),(0,s.jsx)("p",{className:"text-2xl font-bold text-white",children:j(f.commission_summary.total_paid_ytd)}),(0,s.jsx)("p",{className:"text-xs text-gray-400 mt-1",children:"Commissions paid this year"})]}),(0,s.jsxs)("div",{className:"p-4 bg-amber-900/20 rounded border border-amber-700",children:[(0,s.jsx)("p",{className:"text-xs text-amber-300 mb-1",children:"Pending Invoice"}),(0,s.jsx)("p",{className:"text-2xl font-bold text-white",children:j(f.commission_summary.total_accrued)}),(0,s.jsx)("p",{className:"text-xs text-gray-400 mt-1",children:"Accrued, awaiting invoice"})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h4",{className:"text-sm font-semibold mb-3 text-gray-300",children:"Breakdown by Entity Type"}),(0,s.jsxs)("div",{className:"grid gap-3 md:grid-cols-3",children:[(0,s.jsxs)("button",{onClick:()=>e.push("/versotech_main/arranger-reconciliation?tab=introducers"),className:"p-3 bg-gray-900 rounded border border-gray-700 flex items-start gap-3 hover:bg-gray-800 hover:border-blue-600 transition-colors cursor-pointer text-left",children:[(0,s.jsx)(o.UserCheck,{className:"h-5 w-5 text-blue-400 mt-0.5"}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("p",{className:"text-sm font-medium text-white",children:"Introducers"}),(0,s.jsx)(h.ExternalLink,{className:"h-3.5 w-3.5 text-gray-500"})]}),(0,s.jsxs)("div",{className:"mt-2 space-y-1 text-sm",children:[(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{className:"text-gray-400",children:"Owed:"}),(0,s.jsx)("span",{className:"text-white font-medium",children:j(f.commission_summary.by_entity_type.introducer.owed)})]}),(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{className:"text-gray-400",children:"Paid YTD:"}),(0,s.jsx)("span",{className:"text-green-400 font-medium",children:j(f.commission_summary.by_entity_type.introducer.paid)})]})]})]})]}),(0,s.jsxs)("button",{onClick:()=>e.push("/versotech_main/arranger-reconciliation?tab=partners"),className:"p-3 bg-gray-900 rounded border border-gray-700 flex items-start gap-3 hover:bg-gray-800 hover:border-green-600 transition-colors cursor-pointer text-left",children:[(0,s.jsx)(m.Handshake,{className:"h-5 w-5 text-green-400 mt-0.5"}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("p",{className:"text-sm font-medium text-white",children:"Partners"}),(0,s.jsx)(h.ExternalLink,{className:"h-3.5 w-3.5 text-gray-500"})]}),(0,s.jsxs)("div",{className:"mt-2 space-y-1 text-sm",children:[(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{className:"text-gray-400",children:"Owed:"}),(0,s.jsx)("span",{className:"text-white font-medium",children:j(f.commission_summary.by_entity_type.partner.owed)})]}),(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{className:"text-gray-400",children:"Paid YTD:"}),(0,s.jsx)("span",{className:"text-green-400 font-medium",children:j(f.commission_summary.by_entity_type.partner.paid)})]})]})]})]}),(0,s.jsxs)("button",{onClick:()=>e.push("/versotech_main/arranger-reconciliation?tab=commercialPartners"),className:"p-3 bg-gray-900 rounded border border-gray-700 flex items-start gap-3 hover:bg-gray-800 hover:border-purple-600 transition-colors cursor-pointer text-left",children:[(0,s.jsx)(x.Briefcase,{className:"h-5 w-5 text-purple-400 mt-0.5"}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("p",{className:"text-sm font-medium text-white",children:"Commercial Partners"}),(0,s.jsx)(h.ExternalLink,{className:"h-3.5 w-3.5 text-gray-500"})]}),(0,s.jsxs)("div",{className:"mt-2 space-y-1 text-sm",children:[(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{className:"text-gray-400",children:"Owed:"}),(0,s.jsx)("span",{className:"text-white font-medium",children:j(f.commission_summary.by_entity_type.commercial_partner.owed)})]}),(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{className:"text-gray-400",children:"Paid YTD:"}),(0,s.jsx)("span",{className:"text-green-400 font-medium",children:j(f.commission_summary.by_entity_type.commercial_partner.paid)})]})]})]})]})]})]})]})})]}),(0,s.jsxs)(r.Card,{children:[(0,s.jsxs)(r.CardHeader,{children:[(0,s.jsx)(r.CardTitle,{className:"text-white",children:"Complete Fee Analysis"}),(0,s.jsx)("p",{className:"text-sm text-gray-400",children:"All subscription fees broken down by type, vehicle, and status"})]}),(0,s.jsx)(r.CardContent,{children:w?(0,s.jsx)("p",{className:"text-sm text-gray-400",children:"Loading..."}):b?(0,s.jsxs)("div",{className:"space-y-8",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h4",{className:"text-lg font-semibold mb-4 text-white",children:"Total Fees by Type"}),(0,s.jsxs)("div",{className:"grid gap-4 md:grid-cols-3 lg:grid-cols-7",children:[(0,s.jsxs)("div",{className:"p-4 bg-blue-900/20 rounded border border-blue-700",children:[(0,s.jsx)("p",{className:"text-xs text-blue-300 mb-1",children:"Subscription Fees"}),(0,s.jsx)("p",{className:"text-xl font-bold text-white",children:j(b.totals.subscription_fees)})]}),(0,s.jsxs)("div",{className:"p-4 bg-green-900/20 rounded border border-green-700",children:[(0,s.jsx)("p",{className:"text-xs text-green-300 mb-1",children:"Spread Fees"}),(0,s.jsx)("p",{className:"text-xl font-bold text-white",children:j(b.totals.spread_fees)})]}),(0,s.jsxs)("div",{className:"p-4 bg-purple-900/20 rounded border border-purple-700",children:[(0,s.jsx)("p",{className:"text-xs text-purple-300 mb-1",children:"BD Fees"}),(0,s.jsx)("p",{className:"text-xl font-bold text-white",children:j(b.totals.bd_fees)})]}),(0,s.jsxs)("div",{className:"p-4 bg-orange-900/20 rounded border border-orange-700",children:[(0,s.jsx)("p",{className:"text-xs text-orange-300 mb-1",children:"FINRA Fees"}),(0,s.jsx)("p",{className:"text-xl font-bold text-white",children:j(b.totals.finra_fees)})]}),(0,s.jsxs)("div",{className:"p-4 bg-pink-900/20 rounded border border-pink-700",children:[(0,s.jsx)("p",{className:"text-xs text-pink-300 mb-1",children:"Performance Fees"}),(0,s.jsx)("p",{className:"text-xl font-bold text-white",children:j(b.totals.performance_fees)})]}),(0,s.jsxs)("div",{className:"p-4 bg-cyan-900/20 rounded border border-cyan-700",children:[(0,s.jsx)("p",{className:"text-xs text-cyan-300 mb-1",children:"Management Fees"}),(0,s.jsx)("p",{className:"text-xl font-bold text-white",children:j(b.totals.management_fees)}),(0,s.jsx)("p",{className:"text-xs text-gray-400 mt-1",children:"(Annual)"})]}),(0,s.jsxs)("div",{className:"p-4 bg-gray-800 rounded border border-gray-600",children:[(0,s.jsx)("p",{className:"text-xs text-gray-300 mb-1 font-semibold",children:"TOTAL ALL FEES"}),(0,s.jsx)("p",{className:"text-xl font-bold text-white",children:j(b.totals.total_fees)})]})]}),(0,s.jsx)("div",{className:"mt-4",children:(0,s.jsxs)("div",{className:`p-4 rounded border ${b.totals.unrealized_gains>=0?"bg-emerald-900/20 border-emerald-700":"bg-red-900/20 border-red-700"}`,children:[(0,s.jsx)("p",{className:`text-xs mb-1 ${b.totals.unrealized_gains>=0?"text-emerald-300":"text-red-300"}`,children:"Unrealized Gains/Losses (Cost vs Price per Share)"}),(0,s.jsx)("p",{className:`text-2xl font-bold ${b.totals.unrealized_gains>=0?"text-emerald-400":"text-red-400"}`,children:j(b.totals.unrealized_gains)}),(0,s.jsx)("p",{className:"text-xs text-gray-400 mt-1",children:"(Price per Share - Cost per Share) × Number of Shares"})]})}),(0,s.jsxs)("div",{className:"grid gap-4 md:grid-cols-3 mt-4",children:[(0,s.jsxs)("div",{className:"p-3 bg-gray-900 rounded border border-gray-700",children:[(0,s.jsx)("p",{className:"text-xs text-gray-400",children:"Total Committed Capital"}),(0,s.jsx)("p",{className:"text-lg font-bold text-white",children:j(b.totals.committed_capital)})]}),(0,s.jsxs)("div",{className:"p-3 bg-gray-900 rounded border border-gray-700",children:[(0,s.jsx)("p",{className:"text-xs text-gray-400",children:"Total Current NAV"}),(0,s.jsx)("p",{className:"text-lg font-bold text-white",children:j(b.totals.current_nav)})]}),(0,s.jsxs)("div",{className:"p-3 bg-gray-900 rounded border border-gray-700",children:[(0,s.jsx)("p",{className:"text-xs text-gray-400",children:"Total Subscriptions"}),(0,s.jsx)("p",{className:"text-lg font-bold text-white",children:b.totals.total_subscriptions})]})]})]}),b.by_status.length>0&&(0,s.jsxs)("div",{children:[(0,s.jsx)("h4",{className:"text-lg font-semibold mb-4 text-white",children:"Fees by Subscription Status"}),(0,s.jsx)("div",{className:"grid gap-3 md:grid-cols-2 lg:grid-cols-4",children:b.by_status.map((e,t)=>(0,s.jsxs)("div",{className:"p-4 bg-gray-900 rounded border border-gray-700",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,s.jsx)("span",{className:"text-sm font-bold text-white uppercase",children:e.status}),(0,s.jsxs)("span",{className:"text-xs text-gray-400",children:[e.subscription_count," subs"]})]}),(0,s.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{className:"text-gray-400",children:"Subscription:"}),(0,s.jsx)("span",{className:"text-white font-medium",children:j(e.subscription_fees)})]}),(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{className:"text-gray-400",children:"Spread:"}),(0,s.jsx)("span",{className:"text-white font-medium",children:j(e.spread_fees)})]}),(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{className:"text-gray-400",children:"BD:"}),(0,s.jsx)("span",{className:"text-white font-medium",children:j(e.bd_fees)})]}),(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{className:"text-gray-400",children:"FINRA:"}),(0,s.jsx)("span",{className:"text-white font-medium",children:j(e.finra_fees)})]}),(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{className:"text-gray-400",children:"Performance:"}),(0,s.jsx)("span",{className:"text-white font-medium",children:j(e.performance_fees)})]}),(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{className:"text-cyan-400",children:"Management:"}),(0,s.jsx)("span",{className:"text-white font-medium",children:j(e.management_fees)})]}),(0,s.jsxs)("div",{className:"flex justify-between pt-2 border-t border-gray-700",children:[(0,s.jsx)("span",{className:"text-white font-semibold",children:"Total Fees:"}),(0,s.jsx)("span",{className:"text-white font-bold",children:j(e.total_fees)})]}),(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{className:e.unrealized_gains>=0?"text-emerald-400":"text-red-400",children:"Unrealized Gain:"}),(0,s.jsx)("span",{className:`font-semibold ${e.unrealized_gains>=0?"text-emerald-400":"text-red-400"}`,children:j(e.unrealized_gains)})]})]})]},t))})]}),b.by_vehicle.length>0&&(0,s.jsxs)("div",{children:[(0,s.jsx)("h4",{className:"text-lg font-semibold mb-4 text-white",children:"Fees by Vehicle"}),(0,s.jsx)("div",{className:"space-y-4",children:b.by_vehicle.map((e,t)=>(0,s.jsxs)("div",{className:"p-5 bg-gray-900 rounded border border-gray-700",children:[(0,s.jsxs)("div",{className:"flex items-start justify-between mb-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h5",{className:"text-xl font-bold text-white mb-1",children:e.vehicle_name}),(0,s.jsxs)("p",{className:"text-sm text-gray-400",children:[e.subscription_count," subscription",1!==e.subscription_count?"s":""," • Capital: ",j(e.committed_capital)," • NAV: ",j(e.current_nav)]})]}),(0,s.jsxs)("div",{className:"text-right",children:[(0,s.jsx)("p",{className:"text-2xl font-bold text-white",children:j(e.fees.total_fees)}),(0,s.jsx)("p",{className:"text-xs text-gray-400",children:"total fees"})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-6 gap-3 mb-4",children:[(0,s.jsxs)("div",{className:"p-2 bg-blue-900/10 rounded",children:[(0,s.jsx)("p",{className:"text-xs text-blue-300",children:"Subscription"}),(0,s.jsx)("p",{className:"text-sm font-bold text-white",children:j(e.fees.subscription_fees)})]}),(0,s.jsxs)("div",{className:"p-2 bg-green-900/10 rounded",children:[(0,s.jsx)("p",{className:"text-xs text-green-300",children:"Spread"}),(0,s.jsx)("p",{className:"text-sm font-bold text-white",children:j(e.fees.spread_fees)})]}),(0,s.jsxs)("div",{className:"p-2 bg-purple-900/10 rounded",children:[(0,s.jsx)("p",{className:"text-xs text-purple-300",children:"BD"}),(0,s.jsx)("p",{className:"text-sm font-bold text-white",children:j(e.fees.bd_fees)})]}),(0,s.jsxs)("div",{className:"p-2 bg-orange-900/10 rounded",children:[(0,s.jsx)("p",{className:"text-xs text-orange-300",children:"FINRA"}),(0,s.jsx)("p",{className:"text-sm font-bold text-white",children:j(e.fees.finra_fees)})]}),(0,s.jsxs)("div",{className:"p-2 bg-pink-900/10 rounded",children:[(0,s.jsx)("p",{className:"text-xs text-pink-300",children:"Performance"}),(0,s.jsx)("p",{className:"text-sm font-bold text-white",children:j(e.fees.performance_fees)})]}),(0,s.jsxs)("div",{className:"p-2 bg-cyan-900/10 rounded",children:[(0,s.jsx)("p",{className:"text-xs text-cyan-300",children:"Management"}),(0,s.jsx)("p",{className:"text-sm font-bold text-white",children:j(e.fees.management_fees)})]})]}),(0,s.jsx)("div",{className:`p-3 rounded mb-4 ${e.fees.unrealized_gains>=0?"bg-emerald-900/10 border border-emerald-700":"bg-red-900/10 border border-red-700"}`,children:(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsx)("span",{className:`text-sm ${e.fees.unrealized_gains>=0?"text-emerald-300":"text-red-300"}`,children:"Unrealized Gains/Losses"}),(0,s.jsx)("span",{className:`text-lg font-bold ${e.fees.unrealized_gains>=0?"text-emerald-400":"text-red-400"}`,children:j(e.fees.unrealized_gains)})]})}),e.by_status.length>0&&(0,s.jsxs)("div",{className:"pt-4 border-t border-gray-800",children:[(0,s.jsx)("p",{className:"text-xs text-gray-500 mb-3 font-semibold",children:"Status Breakdown:"}),(0,s.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-3",children:e.by_status.map((e,t)=>(0,s.jsxs)("div",{className:"p-3 bg-gray-800 rounded text-sm",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,s.jsx)("span",{className:"text-white font-semibold capitalize",children:e.status}),(0,s.jsx)("span",{className:"text-gray-400 text-xs",children:e.subscription_count})]}),(0,s.jsxs)("div",{className:"space-y-1 text-xs",children:[(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{className:"text-gray-400",children:"Sub:"}),(0,s.jsx)("span",{className:"text-white",children:j(e.subscription_fees)})]}),(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{className:"text-cyan-400",children:"Mgmt:"}),(0,s.jsx)("span",{className:"text-white",children:j(e.management_fees)})]}),(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{className:"text-gray-400",children:"Total Fees:"}),(0,s.jsx)("span",{className:"text-white font-semibold",children:j(e.total_fees)})]}),(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{className:e.unrealized_gains>=0?"text-emerald-400":"text-red-400",children:"Unrealized:"}),(0,s.jsx)("span",{className:`font-semibold ${e.unrealized_gains>=0?"text-emerald-400":"text-red-400"}`,children:j(e.unrealized_gains)})]})]})]},t))})]})]},t))})]})]}):(0,s.jsx)("p",{className:"text-sm text-gray-400",children:"No data available"})})]})]}):(0,s.jsx)("div",{className:"text-white",children:"Failed to load dashboard data"})}e.s(["default",()=>g],899318);var b=e.i(538892),N=e.i(129432),y=e.i(237635),v=e.i(908925),w=e.i(831833),_=e.i(551544),C=e.i(176835),S=e.i(971743),k=e.i(554369),T=e.i(758768),D=e.i(619324),I=e.i(230112),P=e.i(197098),F=e.i(80465),E=e.i(645855),B=e.i(745083),A=e.i(932735),$=e.i(711819),L=e.i(263229),U=e.i(496383),O=e.i(761722),z=e.i(994500),M=e.i(799359),R=e.i(669019),G=e.i(786560);let H={subscription:"subscription_fee_percent",management:"management_fee_percent",performance:"carried_interest_percent",carried_interest:"carried_interest_percent"};function V(e,s){if(!s||!e.rate_bps)return{isValid:!0};let t=H[e.kind];if(!t)return{isValid:!0};let a=s[t];return null==a?{isValid:!0}:e.rate_bps/100>a?{isValid:!1,message:`Exceeds term sheet limit (${a}%)`,termSheetLimit:a}:{isValid:!0,termSheetLimit:a}}function q(e){switch(e||"draft"){case"accepted":return(0,s.jsxs)(N.Badge,{className:"bg-green-500/20 text-green-400 border-green-500/30",children:[(0,s.jsx)(F.CheckCircle,{className:"h-3 w-3 mr-1"}),"Accepted"]});case"sent":return(0,s.jsxs)(N.Badge,{className:"bg-blue-500/20 text-blue-400 border-blue-500/30",children:[(0,s.jsx)(A.Send,{className:"h-3 w-3 mr-1"}),"Sent"]});case"pending_signature":return(0,s.jsxs)(N.Badge,{className:"bg-amber-500/20 text-amber-400 border-amber-500/30",children:[(0,s.jsx)(E.Clock,{className:"h-3 w-3 mr-1"}),"Pending Signature"]});case"rejected":return(0,s.jsxs)(N.Badge,{className:"bg-red-500/20 text-red-400 border-red-500/30",children:[(0,s.jsx)(B.XCircle,{className:"h-3 w-3 mr-1"}),"Rejected"]});default:return(0,s.jsx)(N.Badge,{variant:"outline",className:"border-gray-500/30 text-gray-400",children:"Draft"})}}let Y={introducers:{label:"Introducers",icon:d.Users,iconColor:"text-blue-400"},partners:{label:"Partners",icon:x.Briefcase,iconColor:"text-purple-400"},commercial_partners:{label:"Commercial Partners",icon:S.Building2,iconColor:"text-green-400"}};function J({}){let e=(0,a.useRouter)(),n=(0,a.useSearchParams)(),[i,c]=(0,t.useState)([]),[d,o]=(0,t.useState)(!0),m=n.get("deal_id")||void 0,[x,h]=(0,t.useState)([]),[u,j]=(0,t.useState)(!0),[g,F]=(0,t.useState)("table"),[E,B]=(0,t.useState)(!1),[A,H]=(0,t.useState)(null),[J,K]=(0,t.useState)(!1),[W,X]=(0,t.useState)(null),[Q,Z]=(0,t.useState)(!1),[ee,es]=(0,t.useState)(null),[et,ea]=(0,t.useState)({introducers:!0,partners:!0,commercial_partners:!0}),[er,en]=(0,t.useState)(null),[el,ei]=(0,t.useState)(null),ec=(0,t.useCallback)(async()=>{try{let e=await fetch("/api/deals"),s=await e.json();c(s.deals||[])}catch(e){console.error("Error fetching deals:",e)}finally{o(!1)}},[]),ed=s=>{let t=new URLSearchParams(n.toString());"none"===s?t.delete("deal_id"):t.set("deal_id",s),e.push(`/versotech_main/fees?${t.toString()}`)};(0,t.useEffect)(()=>{ec()},[ec]),(0,t.useEffect)(()=>{eo()},[m]);let eo=async()=>{j(!0);try{let e=m?`/api/staff/fees/plans?include_components=true&deal_id=${m}`:"/api/staff/fees/plans?include_components=true",[s,t]=await Promise.all([fetch(e),fetch("/api/deals")]),[a,r]=await Promise.all([s.json(),t.json()]),n=a.data||[],l=r.deals||[],i=new Map(l.map(e=>[e.id,e]));m&&(n=n.filter(e=>e.deal_id===m));let c=n.map(e=>({...e,deal:e.deal_id?i.get(e.deal_id):void 0}));h(c)}catch(e){console.error("Error fetching fee plans:",e)}finally{j(!1)}},em=e=>{es(e),Z(!0)},ex=async()=>{if(ee)try{let e=await fetch(`/api/staff/fees/plans/${ee.id}/duplicate`,{method:"POST"});if(e.ok){let{data:s}=await e.json();await eo(),Z(!1),es(null),s&&(H(s),B(!0))}}catch(e){console.error("Error duplicating plan:",e)}},eh=()=>{H(null),B(!0)},eu=e=>{H(e),B(!0)},ep=()=>{B(!1),H(null)},ej=e=>{X(e),K(!0)},ef=async()=>{if(W)try{(await fetch(`/api/staff/fees/plans/${W.id}`,{method:"DELETE"})).ok&&(eo(),K(!1),X(null))}catch(e){console.error("Error deleting plan:",e)}},eg=e=>!!e.introducer&&!!e.generated_agreement_id||!!e.partner&&!!e.generated_placement_agreement_id,eb=e=>!!e.introducer&&!e.generated_agreement_id||!!e.partner&&!e.generated_placement_agreement_id,eN=e=>e.introducer?"Generate Introducer Agreement":e.partner?"Generate Placement Agreement":"",ey=async e=>{if(e.introducer){en(e.id);try{let s=await fetch(`/api/staff/fees/plans/${e.id}/generate-agreement`,{method:"POST"});if(!s.ok){let e=await s.json();z.toast.error(`Failed to generate agreement: ${e.error||"Unknown error"}`);return}z.toast.success("Introducer Agreement generated successfully!"),eo()}catch(e){console.error("Error generating introducer agreement:",e),z.toast.error("Failed to generate agreement")}finally{en(null)}}},ev=async e=>{if(e.partner){en(e.id);try{let s=await fetch(`/api/staff/fees/plans/${e.id}/generate-placement-agreement`,{method:"POST"});if(!s.ok){let e=await s.json();z.toast.error(`Failed to generate placement agreement: ${e.error||"Unknown error"}`);return}z.toast.success("Placement Agreement generated successfully!"),eo()}catch(e){console.error("Error generating placement agreement:",e),z.toast.error("Failed to generate placement agreement")}finally{en(null)}}},ew=async e=>{e.introducer?await ey(e):e.partner&&await ev(e)},e_=e=>e.introducer_agreement?.pdf_url?{pdfUrl:e.introducer_agreement.pdf_url,referenceNumber:e.introducer_agreement.reference_number}:e.placement_agreement?.pdf_url?{pdfUrl:e.placement_agreement.pdf_url,referenceNumber:e.placement_agreement.reference_number}:{pdfUrl:null,referenceNumber:null},eC=async(e,s)=>{ei(e);try{let t=await fetch(`/api/storage/download?path=${encodeURIComponent(e)}&bucket=deal-documents`);if(!t.ok)throw Error("Failed to download file");let a=await t.blob(),r=window.URL.createObjectURL(a),n=document.createElement("a");n.href=r,n.download=e.split("/").pop()||`${s||"agreement"}.pdf`,document.body.appendChild(n),n.click(),document.body.removeChild(n),window.URL.revokeObjectURL(r),z.toast.success("PDF downloaded successfully")}catch(e){console.error("Error downloading PDF:",e),z.toast.error("Failed to download PDF")}finally{ei(null)}},eS=async e=>{try{let s=await fetch(`/api/storage/download?path=${encodeURIComponent(e)}&bucket=deal-documents`);if(!s.ok)throw Error("Failed to load file");let t=await s.blob(),a=window.URL.createObjectURL(t);window.open(a,"_blank")}catch(e){console.error("Error previewing PDF:",e),z.toast.error("Failed to preview PDF")}},ek=function(e){let s={introducers:[],partners:[],commercial_partners:[]};for(let t of e)t.introducer?s.introducers.push(t):t.partner?s.partners.push(t):t.commercial_partner&&s.commercial_partners.push(t);return s}(x);if(u)return(0,s.jsx)("div",{className:"text-white",children:"Loading fee plans..."});let eT=i.find(e=>e.id===m),eD=()=>(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(S.Building2,{className:"h-5 w-5 text-muted-foreground"}),(0,s.jsx)("span",{className:"text-sm font-medium",children:"Deal:"})]}),(0,s.jsxs)(b.Select,{value:m||"none",onValueChange:ed,disabled:d,children:[(0,s.jsx)(b.SelectTrigger,{className:"w-[350px]",children:d?(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(L.Loader2,{className:"h-4 w-4 animate-spin"}),(0,s.jsx)("span",{children:"Loading deals..."})]}):(0,s.jsx)(b.SelectValue,{placeholder:"Select a deal to view fee plans"})}),(0,s.jsxs)(b.SelectContent,{children:[(0,s.jsx)(b.SelectItem,{value:"none",children:(0,s.jsx)("span",{className:"text-muted-foreground",children:"Select a deal to view fee plans"})}),i.map(e=>(0,s.jsx)(b.SelectItem,{value:e.id,children:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("span",{children:e.name}),(0,s.jsxs)("span",{className:"text-xs text-muted-foreground capitalize",children:["(",e.status,")"]})]})},e.id))]})]}),eT&&(0,s.jsxs)("span",{className:"text-sm text-muted-foreground",children:["Viewing fee plans for: ",(0,s.jsx)("strong",{children:eT.name})]})]});return m?(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"text-2xl font-bold text-white",children:"Fee Plans"}),(0,s.jsx)("p",{className:"text-gray-400",children:"Manage fee structure templates for this deal"})]}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)(p.Button,{variant:"outline",onClick:()=>F("table"===g?"cards":"table"),children:"table"===g?"Card View":"Table View"}),(0,s.jsxs)(p.Button,{onClick:eh,children:[(0,s.jsx)(w.Plus,{className:"mr-2 h-4 w-4"}),"Create Fee Plan"]})]})]}),(0,s.jsx)(eD,{}),(0,s.jsx)(r.Card,{className:"bg-blue-500/10 border-blue-500/30",children:(0,s.jsx)(r.CardContent,{className:"pt-6",children:(0,s.jsxs)("p",{className:"text-sm text-gray-300 leading-relaxed",children:[(0,s.jsx)("strong",{className:"text-blue-400",children:"How Fee Plans Work:"})," Fee plans are commercial agreements with introducers/partners. Each fee plan must be linked to a ",(0,s.jsx)("strong",{children:"published term sheet"})," and an ",(0,s.jsx)("strong",{children:"entity"})," (introducer, partner, or commercial partner). Fee values cannot exceed the limits set in the term sheet. When an entity accepts a fee plan, investors can be dispatched through them."]})})}),0===x.length?(0,s.jsx)(r.Card,{children:(0,s.jsxs)(r.CardContent,{className:"py-10 text-center",children:[(0,s.jsx)("p",{className:"text-gray-400 mb-4",children:"No fee plans created yet"}),(0,s.jsxs)(p.Button,{onClick:eh,children:[(0,s.jsx)(w.Plus,{className:"mr-2 h-4 w-4"}),"Create Your First Fee Plan"]})]})}):(0,s.jsx)("div",{className:"space-y-4",children:Object.entries(Y).map(([e,t])=>{let a=t.icon,n=ek[e],i=et[e];return(0,s.jsx)(M.Collapsible,{open:i,onOpenChange:()=>{ea(s=>({...s,[e]:!s[e]}))},children:(0,s.jsxs)(r.Card,{children:[(0,s.jsx)(M.CollapsibleTrigger,{asChild:!0,children:(0,s.jsx)(r.CardHeader,{className:"cursor-pointer hover:bg-white/5 transition-colors",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)(a,{className:`h-5 w-5 ${t.iconColor}`}),(0,s.jsxs)(r.CardTitle,{className:"text-lg",children:[t.label," (",n.length,")"]})]}),i?(0,s.jsx)(I.ChevronDown,{className:"h-5 w-5 text-muted-foreground"}):(0,s.jsx)(P.ChevronRight,{className:"h-5 w-5 text-muted-foreground"})]})})}),(0,s.jsx)(M.CollapsibleContent,{children:(0,s.jsx)(r.CardContent,{className:"pt-0",children:0===n.length?(0,s.jsx)("div",{className:"py-6 text-center text-muted-foreground",children:"No fee plans"}):"table"===g?(0,s.jsxs)(y.Table,{children:[(0,s.jsx)(y.TableHeader,{children:(0,s.jsxs)(y.TableRow,{children:[(0,s.jsx)(y.TableHead,{children:"Plan Name"}),(0,s.jsx)(y.TableHead,{children:"Entity"}),(0,s.jsx)(y.TableHead,{children:"Term Sheet"}),(0,s.jsx)(y.TableHead,{children:"Fee Components"}),(0,s.jsx)(y.TableHead,{children:"Status"}),(0,s.jsx)(y.TableHead,{className:"text-right",children:"Actions"})]})}),(0,s.jsx)(y.TableBody,{children:n.map(e=>(0,s.jsxs)(y.TableRow,{children:[(0,s.jsx)(y.TableCell,{children:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(l.FileText,{className:"h-4 w-4 text-muted-foreground"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"font-medium",children:e.name}),e.description&&(0,s.jsx)("div",{className:"text-sm text-muted-foreground",children:e.description})]})]})}),(0,s.jsx)(y.TableCell,{children:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(a,{className:`h-4 w-4 ${t.iconColor}`}),(0,s.jsx)("span",{children:e.introducer?.legal_name||e.partner?.name||e.commercial_partner?.name})]})}),(0,s.jsx)(y.TableCell,{children:e.term_sheet?(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(T.FileCheck,{className:"h-3 w-3 text-muted-foreground"}),(0,s.jsxs)("span",{className:"text-sm text-muted-foreground",children:["v",e.term_sheet.version]})]}):(0,s.jsx)("span",{className:"text-sm text-muted-foreground",children:"No term sheet"})}),(0,s.jsx)(y.TableCell,{children:(0,s.jsx)(R.TooltipProvider,{children:(0,s.jsx)("div",{className:"flex flex-wrap gap-1",children:e.components?.map(t=>{let a=V(t,e.term_sheet);return(0,s.jsxs)(R.Tooltip,{children:[(0,s.jsx)(R.TooltipTrigger,{asChild:!0,children:(0,s.jsxs)(N.Badge,{variant:"outline",className:`text-xs ${!a.isValid?"border-red-500/50 bg-red-500/10":""}`,children:[!a.isValid&&(0,s.jsx)(D.AlertTriangle,{className:"h-3 w-3 mr-1 text-red-400"}),t.kind,":"," ",t.rate_bps?f(t.rate_bps):t.flat_amount?`$${t.flat_amount}`:"N/A"]})}),!a.isValid&&(0,s.jsx)(R.TooltipContent,{className:"bg-red-900 border-red-700",children:(0,s.jsx)("p",{className:"text-red-200",children:a.message})})]},t.id)})})})}),(0,s.jsx)(y.TableCell,{children:(0,s.jsx)("div",{className:"flex flex-wrap gap-1",children:q(e.status)})}),(0,s.jsx)(y.TableCell,{className:"text-right",children:(0,s.jsxs)("div",{className:"flex gap-1 justify-end items-center",children:[eb(e)&&(0,s.jsx)(p.Button,{variant:"ghost",size:"sm",onClick:()=>ew(e),disabled:er===e.id,className:"text-green-400 hover:text-green-300",title:eN(e),children:er===e.id?(0,s.jsx)(L.Loader2,{className:"h-4 w-4 animate-spin"}):(0,s.jsx)($.FileSignature,{className:"h-4 w-4"})}),eg(e)&&(0,s.jsx)(N.Badge,{className:"bg-green-500/20 text-green-400 border-green-500/30 text-xs",children:"Agreement"}),(()=>{let{pdfUrl:t,referenceNumber:a}=e_(e);return t?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(p.Button,{variant:"ghost",size:"sm",onClick:()=>eS(t),className:"text-blue-400 hover:text-blue-300",title:"Preview PDF",children:(0,s.jsx)(U.Eye,{className:"h-4 w-4"})}),(0,s.jsx)(p.Button,{variant:"ghost",size:"sm",onClick:()=>eC(t,a),disabled:el===t,className:"text-green-400 hover:text-green-300",title:"Download PDF",children:el===t?(0,s.jsx)(L.Loader2,{className:"h-4 w-4 animate-spin"}):(0,s.jsx)(O.Download,{className:"h-4 w-4"})})]}):null})(),(0,s.jsx)(p.Button,{variant:"ghost",size:"sm",onClick:()=>eu(e),children:(0,s.jsx)(_.Edit,{className:"h-4 w-4"})}),(0,s.jsx)(p.Button,{variant:"ghost",size:"sm",onClick:()=>em(e),children:(0,s.jsx)(C.Copy,{className:"h-4 w-4"})}),(0,s.jsx)(p.Button,{variant:"ghost",size:"sm",onClick:()=>ej(e),children:(0,s.jsx)(k.Trash2,{className:"h-4 w-4 text-red-500"})})]})})]},e.id))})]}):(0,s.jsx)("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:n.map(e=>(0,s.jsxs)(r.Card,{className:"bg-white/5 border-white/10",children:[(0,s.jsx)(r.CardHeader,{className:"pb-2",children:(0,s.jsxs)("div",{className:"flex items-start justify-between",children:[(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,s.jsx)(r.CardTitle,{className:"text-lg",children:e.name}),q(e.status)]}),(0,s.jsxs)("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[(0,s.jsx)(a,{className:`h-4 w-4 ${t.iconColor}`}),(0,s.jsx)("span",{children:e.introducer?.legal_name||e.partner?.name||e.commercial_partner?.name})]})]}),(0,s.jsxs)("div",{className:"flex gap-1 items-center",children:[eb(e)&&(0,s.jsx)(p.Button,{variant:"ghost",size:"icon",onClick:()=>ew(e),disabled:er===e.id,className:"text-green-400 hover:text-green-300",title:eN(e),children:er===e.id?(0,s.jsx)(L.Loader2,{className:"h-4 w-4 animate-spin"}):(0,s.jsx)($.FileSignature,{className:"h-4 w-4"})}),eg(e)&&(0,s.jsx)(N.Badge,{className:"bg-green-500/20 text-green-400 border-green-500/30 text-xs",children:"Agreement"}),(0,s.jsx)(p.Button,{variant:"ghost",size:"icon",onClick:()=>eu(e),children:(0,s.jsx)(_.Edit,{className:"h-4 w-4"})}),(0,s.jsx)(p.Button,{variant:"ghost",size:"icon",onClick:()=>em(e),children:(0,s.jsx)(C.Copy,{className:"h-4 w-4"})}),(0,s.jsx)(p.Button,{variant:"ghost",size:"icon",onClick:()=>ej(e),children:(0,s.jsx)(k.Trash2,{className:"h-4 w-4 text-red-500"})})]})]})}),(0,s.jsxs)(r.CardContent,{children:[e.description&&(0,s.jsx)("p",{className:"text-sm text-muted-foreground mb-3",children:e.description}),(0,s.jsx)(R.TooltipProvider,{children:(0,s.jsx)("div",{className:"space-y-2",children:e.components?.map(t=>{let a=V(t,e.term_sheet);return(0,s.jsxs)("div",{className:`text-sm flex justify-between items-center ${!a.isValid?"text-red-400":""}`,children:[(0,s.jsxs)("span",{className:"capitalize flex items-center gap-1",children:[!a.isValid&&(0,s.jsxs)(R.Tooltip,{children:[(0,s.jsx)(R.TooltipTrigger,{children:(0,s.jsx)(D.AlertTriangle,{className:"h-3 w-3 text-red-400"})}),(0,s.jsx)(R.TooltipContent,{className:"bg-red-900 border-red-700",children:(0,s.jsx)("p",{className:"text-red-200",children:a.message})})]}),t.kind]}),(0,s.jsx)("span",{className:"font-medium",children:t.rate_bps?f(t.rate_bps):t.flat_amount?`$${t.flat_amount}`:"N/A"})]},t.id)})})}),(()=>{let{pdfUrl:t,referenceNumber:a}=e_(e);return t?(0,s.jsx)("div",{className:"mt-4 pt-4 border-t border-white/10",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("div",{className:"p-2 rounded-lg bg-green-500/10",children:(0,s.jsx)(l.FileText,{className:"h-5 w-5 text-green-400"})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm font-medium text-foreground",children:e.introducer?"Introducer Agreement":"Placement Agreement"}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground",children:a||"Document ready"})]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsxs)(p.Button,{variant:"outline",size:"sm",onClick:()=>eS(t),className:"text-blue-400 border-blue-400/30 hover:bg-blue-400/10",children:[(0,s.jsx)(U.Eye,{className:"h-4 w-4 mr-1"}),"Preview"]}),(0,s.jsxs)(p.Button,{variant:"outline",size:"sm",onClick:()=>eC(t,a),disabled:el===t,className:"text-green-400 border-green-400/30 hover:bg-green-400/10",children:[el===t?(0,s.jsx)(L.Loader2,{className:"h-4 w-4 mr-1 animate-spin"}):(0,s.jsx)(O.Download,{className:"h-4 w-4 mr-1"}),"Download"]})]})]})}):null})()]})]},e.id))})})})]})},e)})}),(0,s.jsx)(G.default,{open:E,onClose:ep,onSuccess:()=>{eo(),ep()},feePlan:A}),(0,s.jsx)(v.AlertDialog,{open:Q,onOpenChange:Z,children:(0,s.jsxs)(v.AlertDialogContent,{children:[(0,s.jsxs)(v.AlertDialogHeader,{children:[(0,s.jsx)(v.AlertDialogTitle,{children:"Duplicate Fee Plan?"}),(0,s.jsx)(v.AlertDialogDescription,{asChild:!0,children:(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsxs)("div",{children:["Create a copy of ",(0,s.jsx)("strong",{children:ee?.name})," with all fee components."]}),(0,s.jsx)("div",{children:"This is useful for:"}),(0,s.jsxs)("ul",{className:"list-disc list-inside space-y-1 ml-2",children:[(0,s.jsx)("li",{children:"Creating a similar plan for a new deal"}),(0,s.jsx)("li",{children:"Testing modifications without affecting the original"}),(0,s.jsx)("li",{children:"Creating variations for special investor terms"})]}),(0,s.jsx)("div",{className:"text-muted-foreground",children:"After duplication, you'll be able to immediately edit the new plan."})]})})]}),(0,s.jsxs)(v.AlertDialogFooter,{children:[(0,s.jsx)(v.AlertDialogCancel,{children:"Cancel"}),(0,s.jsx)(v.AlertDialogAction,{onClick:ex,children:"Duplicate & Edit"})]})]})}),(0,s.jsx)(v.AlertDialog,{open:J,onOpenChange:K,children:(0,s.jsxs)(v.AlertDialogContent,{children:[(0,s.jsxs)(v.AlertDialogHeader,{children:[(0,s.jsx)(v.AlertDialogTitle,{children:"Delete Fee Plan?"}),(0,s.jsx)(v.AlertDialogDescription,{asChild:!0,children:(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsxs)("div",{children:["Are you sure you want to delete ",(0,s.jsx)("strong",{children:W?.name}),"?"]}),W&&W.subscription_count&&W.subscription_count>0?(0,s.jsxs)("div",{className:"text-yellow-500",children:["⚠️ This fee plan is used by ",W.subscription_count," subscription",1!==W.subscription_count?"s":"",". Deleting it won't affect those subscriptions, but you won't be able to apply this plan to new deals."]}):(0,s.jsx)("div",{children:"This fee plan is not currently used by any subscriptions."}),W?.is_default&&(0,s.jsxs)("div",{className:"text-red-500",children:["⚠️ This is the default fee plan for ",W?.deal?.name||"this deal",". You may want to set another plan as default before deleting this one."]})]})})]}),(0,s.jsxs)(v.AlertDialogFooter,{children:[(0,s.jsx)(v.AlertDialogCancel,{children:"Cancel"}),(0,s.jsx)(v.AlertDialogAction,{onClick:ef,className:"bg-red-500 hover:bg-red-600",children:"Delete"})]})]})})]}):(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsx)("div",{className:"flex items-center justify-between",children:(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"text-2xl font-bold text-white",children:"Fee Plans"}),(0,s.jsx)("p",{className:"text-gray-400",children:"Manage fee structure templates for a specific deal"})]})}),(0,s.jsx)(eD,{}),(0,s.jsx)(r.Card,{children:(0,s.jsxs)(r.CardContent,{className:"py-10 text-center",children:[(0,s.jsx)(S.Building2,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),(0,s.jsx)("h3",{className:"text-lg font-medium text-foreground mb-2",children:"Select a deal to view fee plans"}),(0,s.jsx)("p",{className:"text-muted-foreground",children:"Use the deal selector above to choose a deal and view its associated fee plans."})]})})]})}e.s(["default",()=>J],907596);var K=e.i(262823),W=e.i(335631),X=e.i(352776),Q=e.i(191569),Z=e.i(514133),ee=e.i(816654),es=e.i(312692);function et({open:e,onClose:a,onSuccess:r,preselectedInvestorId:n}){let[l,i]=(0,t.useState)(!1),[c,d]=(0,t.useState)(!1),[o,m]=(0,t.useState)(!1),[x,h]=(0,t.useState)(""),[u,f]=(0,t.useState)(""),[g,y]=(0,t.useState)(""),[v,_]=(0,t.useState)(""),[C,S]=(0,t.useState)(""),[T,D]=(0,t.useState)(new Set),[I,P]=(0,t.useState)([]),[F,E]=(0,t.useState)([]),[B,A]=(0,t.useState)([]),[$,U]=(0,t.useState)([]);(0,t.useEffect)(()=>{e&&n&&(console.log("[GenerateInvoiceModal] Preselected investor ID:",n,"Type:",typeof n),/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(n)?(console.log("[GenerateInvoiceModal] Valid UUID, setting investorId"),h(n)):(console.error("[GenerateInvoiceModal] Invalid investor ID format:",n),alert(`Invalid investor ID format: ${n}`)))},[e,n]);let O=(0,t.useCallback)(async()=>{try{console.log("[GenerateInvoiceModal] Fetching investors...");let e=await fetch("/api/investors?limit=1000"),s=await e.json();console.log("[GenerateInvoiceModal] Investors fetched:",s.data?.length||0),A(s.data||[])}catch(e){console.error("Error fetching investors:",e)}},[]);(0,t.useEffect)(()=>{e&&O()},[e,O]);let z=(0,t.useCallback)(async()=>{if(x){m(!0);try{console.log("[GenerateInvoiceModal] Fetching ALL subscriptions for investor:",x);let e=await fetch(`/api/subscriptions?investor_id=${x}`),s=(await e.json()).data||[];console.log("[GenerateInvoiceModal] All subscriptions fetched:",s.length);let t=await fetch(`/api/staff/fees/events?status=accrued&investor_id=${x}&limit=500`),a=await t.json();if(!t.ok){console.error("[GenerateInvoiceModal] Fee events API error:",a),U([]),m(!1);return}let r=a.data||[];console.log("[GenerateInvoiceModal] Fee events fetched:",r.length),console.log("[GenerateInvoiceModal] Sample fee event:",r[0]);let n=[...new Set(r.map(e=>e.allocation_id).filter(Boolean))];console.log("[GenerateInvoiceModal] Subscription IDs with fee events:",n);let l=s.filter(e=>n.includes(e.id));console.log("[GenerateInvoiceModal] Subscriptions that have fees:",l.length),console.log("[GenerateInvoiceModal] Subscription details:",l),U(l),1===l.length&&(console.log("[GenerateInvoiceModal] Auto-selecting single subscription:",l[0].id),f(l[0].id))}catch(e){console.error("Error fetching subscriptions:",e),U([])}finally{m(!1)}}},[x]),M=(0,t.useCallback)(async()=>{if(!x||!u)return void console.log("[GenerateInvoiceModal] Missing investor or subscription ID, skipping fetch");console.log("[GenerateInvoiceModal] Starting fetchFeeEvents with investorId:",x,"subscriptionId:",u),d(!0);try{let e=new URLSearchParams({status:"accrued",investor_id:x,allocation_id:u,limit:"100",offset:"0"});console.log("[GenerateInvoiceModal] Fetching fee events for investor:",x,"subscription:",u),console.log("[GenerateInvoiceModal] URL params:",e.toString());let s=await fetch(`/api/staff/fees/events?${e}`),t=await s.json();if(console.log("[GenerateInvoiceModal] Fee events response:",t),!s.ok||t.error){console.error("[GenerateInvoiceModal] API error:",t.error||s.statusText),console.error("[GenerateInvoiceModal] Validation details:",JSON.stringify(t.details,null,2));let e=`Failed to load fee events: ${t.error||s.statusText}`;t.details&&Array.isArray(t.details)&&(e+="\n\nValidation errors:",t.details.forEach(s=>{e+=`
- Field: ${s.path?.join(".")}, Error: ${s.message}`})),alert(e),E([]);return}E(t.data||[]),console.log("[GenerateInvoiceModal] Set fee events count:",t.data?.length||0)}catch(e){console.error("Error fetching fee events:",e),alert(`Error loading fee events: ${e instanceof Error?e.message:"Unknown error"}`),E([])}finally{d(!1)}},[x,u]);(0,t.useEffect)(()=>{x?z():(U([]),f(""))},[x,z]),(0,t.useEffect)(()=>{x&&u?M():x&&!u&&E([])},[x,u,M]);let R=(e,s,t)=>{let a=[...I];a[e]={...a[e],[s]:t},P(a)},G=async()=>{if(console.log("[GenerateInvoiceModal] handleSubmit called"),console.log("[GenerateInvoiceModal] Current state:",{investorId:x,selectedEventIds:Array.from(T),dueDate:v,notes:C,customLineItems:I}),!x||!u||0===T.size||!v)return void alert("Please select an investor, subscription, at least one fee event, and a due date");i(!0);try{let e=v?new Date(v+"T23:59:59").toISOString():"",s={investor_id:x,deal_id:g||void 0,fee_event_ids:Array.from(T),due_date:e,notes:C||void 0,custom_line_items:I.length>0?I:void 0};console.log("[GenerateInvoiceModal] Request body created:",s),console.log("[GenerateInvoiceModal] Sending request to /api/staff/fees/invoices/generate-simple");let t=await fetch("/api/staff/fees/invoices/generate-simple",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!t.ok){let e=await t.json();throw console.error("[GenerateInvoiceModal] Invoice generation failed:",e),console.error("[GenerateInvoiceModal] Request body was:",{investor_id:x,deal_id:g||void 0,fee_event_ids:Array.from(T),due_date:v,notes:C,custom_line_items:I.length>0?I:void 0}),Error(e.error||e.details?JSON.stringify(e.details,null,2):"Failed to generate invoice")}r(),H()}catch(e){console.error("Error generating invoice:",e),alert(e instanceof Error?e.message:"Failed to generate invoice")}finally{i(!1)}},H=()=>{h(""),f(""),y(""),_(""),S(""),D(new Set),P([]),E([]),U([]),a()},V=F.filter(e=>T.has(e.id)).reduce((e,s)=>e+Number(s.computed_amount),0)+I.reduce((e,s)=>e+s.amount*s.quantity,0);return(0,s.jsx)(X.Dialog,{open:e,onOpenChange:H,children:(0,s.jsxs)(X.DialogContent,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[(0,s.jsx)(X.DialogHeader,{children:(0,s.jsx)(X.DialogTitle,{children:"Generate Invoice"})}),(0,s.jsxs)("div",{className:"space-y-6",children:[n?(0,s.jsxs)("div",{children:[(0,s.jsx)(Z.Label,{className:"text-white",children:"Investor"}),(0,s.jsxs)("div",{className:"flex items-center gap-2 p-2 border border-white/20 rounded-md bg-black/20",children:[(0,s.jsx)("span",{className:"text-sm font-medium text-white",children:B.find(e=>e.id===x)?.legal_name||B.find(e=>e.id===x)?.display_name||F[0]?.investor?.legal_name||F[0]?.investor?.display_name||"Loading..."}),(0,s.jsx)(N.Badge,{variant:"outline",className:"ml-auto text-white border-white/20",children:"Pre-selected"})]})]}):(0,s.jsxs)("div",{children:[(0,s.jsx)(Z.Label,{htmlFor:"investor",className:"text-white",children:"Investor *"}),(0,s.jsxs)(b.Select,{value:x,onValueChange:h,children:[(0,s.jsx)(b.SelectTrigger,{id:"investor",children:(0,s.jsx)(b.SelectValue,{placeholder:"Select investor"})}),(0,s.jsx)(b.SelectContent,{children:B.map(e=>(0,s.jsx)(b.SelectItem,{value:e.id,children:e.legal_name||e.display_name},e.id))})]})]}),x&&(0,s.jsxs)("div",{children:[(0,s.jsx)(Z.Label,{htmlFor:"subscription",className:"text-white",children:"Subscription *"}),o?(0,s.jsxs)("div",{className:"flex items-center justify-center p-2 border border-white/20 rounded-md",children:[(0,s.jsx)(L.Loader2,{className:"h-4 w-4 animate-spin mr-2"}),(0,s.jsx)("span",{className:"text-sm text-muted-foreground",children:"Loading subscriptions..."})]}):0===$.length?(0,s.jsxs)("div",{className:"p-2 border border-red-500/30 rounded-md bg-red-500/10",children:[(0,s.jsx)("p",{className:"text-sm text-red-300 font-medium",children:"No subscriptions with accrued fees found"}),(0,s.jsx)("p",{className:"text-xs text-red-400 mt-1",children:"This investor has no uninvoiced fee events. Fee events may not have been calculated yet, or all fees have already been invoiced."})]}):(0,s.jsxs)(b.Select,{value:u,onValueChange:f,children:[(0,s.jsx)(b.SelectTrigger,{id:"subscription",children:(0,s.jsx)(b.SelectValue,{placeholder:"Select subscription"})}),(0,s.jsx)(b.SelectContent,{children:$.map(e=>(0,s.jsxs)(b.SelectItem,{value:e.id,children:[e.subscription_number," - ",e.vehicle?.name||"Unknown Vehicle","(",j(e.commitment),")"]},e.id))})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(Z.Label,{htmlFor:"due_date",className:"text-white",children:"Due Date *"}),(0,s.jsx)(Q.Input,{id:"due_date",type:"date",value:v,onChange:e=>_(e.target.value)})]}),x&&u&&(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,s.jsx)(Z.Label,{className:"text-white",children:"Fee Events to Invoice *"}),F.length>0&&(0,s.jsx)(p.Button,{type:"button",variant:"outline",size:"sm",onClick:()=>{T.size===F.length?D(new Set):D(new Set(F.map(e=>e.id)))},children:T.size===F.length?"Deselect All":"Select All"})]}),c?(0,s.jsx)("div",{className:"py-4 text-center text-sm text-muted-foreground",children:"Loading fee events..."}):0===F.length?(0,s.jsx)("div",{className:"py-4 text-center text-sm text-muted-foreground",children:"No accrued fee events found for this investor"}):(0,s.jsx)("div",{className:"mt-2 space-y-2 border border-border rounded-lg p-4 max-h-60 overflow-y-auto",children:F.map(e=>(0,s.jsx)("div",{className:"flex items-center justify-between p-2 hover:bg-accent/10 rounded",children:(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)(es.Checkbox,{checked:T.has(e.id),onCheckedChange:()=>{var s;let t;return s=e.id,void((t=new Set(T)).has(s)?t.delete(s):t.add(s),D(t))}}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"font-medium text-white",children:[(0,s.jsx)(N.Badge,{variant:"outline",className:"mr-2 text-white border-white/20",children:"flat"===e.fee_type?"Investment":e.fee_type.replace("_"," ")}),(0,s.jsx)("span",{className:"text-white",children:j(e.computed_amount)})]}),(0,s.jsxs)("div",{className:"text-sm text-gray-400",children:[new Date(e.event_date).toLocaleDateString(),e.deal&&` • ${e.deal.name}`]})]})]})},e.id))})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,s.jsx)(Z.Label,{className:"text-white",children:"Custom Line Items (Optional)"}),(0,s.jsxs)(p.Button,{type:"button",variant:"outline",size:"sm",onClick:()=>{P([...I,{description:"",amount:0,quantity:1}])},children:[(0,s.jsx)(w.Plus,{className:"mr-2 h-4 w-4"}),"Add Line Item"]})]}),I.map((e,t)=>(0,s.jsxs)("div",{className:"flex gap-2 mb-2",children:[(0,s.jsx)(Q.Input,{placeholder:"Description",value:e.description,onChange:e=>R(t,"description",e.target.value),className:"flex-1"}),(0,s.jsx)(Q.Input,{type:"number",placeholder:"Qty",value:e.quantity,onChange:e=>R(t,"quantity",parseFloat(e.target.value)),className:"w-20"}),(0,s.jsx)(Q.Input,{type:"number",placeholder:"Amount",value:e.amount,onChange:e=>R(t,"amount",parseFloat(e.target.value)),className:"w-32"}),(0,s.jsx)(p.Button,{type:"button",variant:"ghost",size:"icon",onClick:()=>{P(I.filter((e,s)=>s!==t))},children:(0,s.jsx)(k.Trash2,{className:"h-4 w-4"})})]},t))]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(Z.Label,{htmlFor:"notes",className:"text-white",children:"Notes (Optional)"}),(0,s.jsx)(ee.Textarea,{id:"notes",value:C,onChange:e=>S(e.target.value),placeholder:"Add any additional notes for the invoice",rows:3})]}),T.size>0&&(0,s.jsxs)("div",{className:"bg-accent p-4 rounded-lg",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between text-lg font-bold",children:[(0,s.jsx)("span",{children:"Total Amount:"}),(0,s.jsx)("span",{children:j(V)})]}),(0,s.jsxs)("div",{className:"text-sm text-muted-foreground mt-1",children:[T.size," fee event(s)",I.length>0&&` + ${I.length} custom item(s)`]})]}),(0,s.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,s.jsx)(p.Button,{variant:"outline",onClick:H,disabled:l,children:"Cancel"}),(0,s.jsxs)(p.Button,{onClick:G,disabled:l||0===T.size,children:[l&&(0,s.jsx)(L.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),"Generate Invoice"]})]})]})]})})}var ea=e.i(429760);let er={draft:"secondary",sent:"default",paid:"default",partially_paid:"default",overdue:"destructive",cancelled:"secondary",disputed:"destructive"};function en(){let[e,a]=(0,t.useState)([]),[i,c]=(0,t.useState)([]),[d,o]=(0,t.useState)(!0),[m,x]=(0,t.useState)("all"),[h,u]=(0,t.useState)(!1),[f,g]=(0,t.useState)(void 0),[b,y]=(0,t.useState)(!1),v=(0,t.useCallback)(async()=>{try{let e="all"===m?"/api/staff/fees/invoices?limit=100&offset=0":`/api/staff/fees/invoices?status=${m}&limit=100&offset=0`,s=await fetch(e),t=await s.json();a(t.data||[])}catch(e){console.error("Error fetching invoices:",e)}},[m]),_=(0,t.useCallback)(async()=>{try{let e=await fetch("/api/staff/fees/events?status=accrued&limit=100&offset=0"),s=await e.json();console.log("[InvoicesTab] Fee events fetched:",s.data?.length||0,"events"),s.data?.length>0&&(console.log("[InvoicesTab] First fee event:",s.data[0]),console.log("[InvoicesTab] First investor data:",s.data[0]?.investor)),c(s.data||[])}catch(e){console.error("Error fetching fee events:",e)}},[]),C=(0,t.useCallback)(async()=>{o(!0),await Promise.all([v(),_()]),o(!1)},[v,_]);(0,t.useEffect)(()=>{C()},[C]);let S=async e=>{try{let s=await fetch(`/api/staff/fees/invoices/${e}/send`,{method:"POST"}),t=await s.json();s.ok?(alert(t.message||"Invoice sent successfully"),v()):(console.error("Error sending invoice:",t),alert(t.error+(t.details?`

${t.details}`:"")))}catch(e){console.error("Error sending invoice:",e),alert("Failed to send invoice. Please try again.")}},k=async(e,s)=>{try{(await fetch(`/api/staff/fees/invoices/${e}/mark-paid`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({paid_amount:s})})).ok&&v()}catch(e){console.error("Error marking invoice as paid:",e)}},T=async()=>{if(confirm("This will calculate fee events for all existing committed subscriptions that don't have fee events yet. Continue?")){y(!0);try{let e=await fetch("/api/staff/fees/events/backfill",{method:"POST"}),s=await e.json();e.ok?(alert(`Backfill complete!

Processed: ${s.results.processed}
Skipped: ${s.results.skipped}
Failed: ${s.results.failed}
Total Fee Events Created: ${s.results.created_events}`),C()):alert(`Backfill failed: ${s.error}`)}catch(e){console.error("Error running backfill:",e),alert("Failed to run backfill")}finally{y(!1)}}};if(d)return(0,s.jsx)("div",{children:"Loading..."});let I=i.reduce((e,s)=>{let t=s.investor?.id||"unknown";e[t]||(e[t]={investor:s.investor,subscriptions:{},total:0});let a=s.allocation_id||"no-subscription",r=s.subscription?`${s.subscription.subscription_number} - ${s.subscription.vehicle?.name||"Unknown Vehicle"}`:"Direct Fee";return e[t].subscriptions[a]||(e[t].subscriptions[a]={subscription:s.subscription,name:r,events:[],total:0}),e[t].subscriptions[a].events.push(s),e[t].subscriptions[a].total+=Number(s.computed_amount),e[t].total+=Number(s.computed_amount),e},{}),P=i.reduce((e,s)=>e+Number(s.computed_amount),0);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"text-2xl font-bold",children:"Fee Billing"}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:"Manage recurring fee billing and invoices. For initial investment fees, see Subscriptions."})]}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsxs)(p.Button,{variant:"outline",onClick:T,disabled:b,children:[b?(0,s.jsx)(L.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}):(0,s.jsx)(K.RefreshCw,{className:"mr-2 h-4 w-4"}),"Backfill Fee Events"]}),(0,s.jsxs)(p.Button,{onClick:()=>u(!0),children:[(0,s.jsx)(w.Plus,{className:"mr-2 h-4 w-4"}),"Generate Invoice"]})]})]}),(0,s.jsxs)(ea.Tabs,{defaultValue:"uninvoiced",className:"w-full",id:"invoices-tab-tabs",children:[(0,s.jsxs)(ea.TabsList,{children:[(0,s.jsxs)(ea.TabsTrigger,{value:"uninvoiced",children:["Uninvoiced Fees",i.length>0&&(0,s.jsx)(N.Badge,{variant:"secondary",className:"ml-2",children:i.length})]}),(0,s.jsx)(ea.TabsTrigger,{value:"invoices",children:"Invoices"})]}),(0,s.jsx)(ea.TabsContent,{value:"uninvoiced",className:"space-y-4",children:0===i.length?(0,s.jsx)(r.Card,{children:(0,s.jsxs)(r.CardContent,{className:"py-10 text-center",children:[(0,s.jsx)(l.FileText,{className:"mx-auto h-12 w-12 text-muted-foreground/50 mb-4"}),(0,s.jsx)("p",{className:"text-muted-foreground",children:"No uninvoiced fee events"}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:"Fee events are automatically created when subscriptions are committed"})]})}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(r.Card,{children:(0,s.jsx)(r.CardContent,{className:"py-4",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"Total Uninvoiced"}),(0,s.jsx)("p",{className:"text-2xl font-bold",children:j(P)})]}),(0,s.jsxs)("div",{className:"text-right",children:[(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"Fee Events"}),(0,s.jsx)("p",{className:"text-2xl font-bold",children:i.length})]}),(0,s.jsxs)("div",{className:"text-right",children:[(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"Investors"}),(0,s.jsx)("p",{className:"text-2xl font-bold",children:Object.keys(I).length})]})]})})}),Object.values(I).map(({investor:e,subscriptions:t,total:a})=>(0,s.jsxs)(r.Card,{children:[(0,s.jsx)(r.CardHeader,{children:(0,s.jsxs)("div",{className:"flex items-start justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(r.CardTitle,{className:"text-lg",children:e?.legal_name||e?.display_name||"Unknown Investor"}),(0,s.jsxs)("p",{className:"text-sm text-muted-foreground mt-1",children:[Object.keys(t).length," subscription(s) • ",j(a)]})]}),(0,s.jsxs)(p.Button,{size:"sm",onClick:()=>{console.log("[InvoicesTab] Invoice button clicked for investor:",e),console.log("[InvoicesTab] Investor ID:",e?.id,"Type:",typeof e?.id),e?.id&&"unknown"!==e.id?(console.log("[InvoicesTab] Setting selectedInvestorId to:",e.id),g(e.id),u(!0)):alert("Cannot generate invoice: Investor information is missing")},disabled:!e?.id||"unknown"===e.id,children:[(0,s.jsx)(w.Plus,{className:"mr-2 h-4 w-4"}),"Invoice All"]})]})}),(0,s.jsx)(r.CardContent,{children:(0,s.jsx)("div",{className:"space-y-4",children:Object.values(t).map(e=>(0,s.jsxs)("div",{className:"border-l-2 border-primary/20 pl-4",children:[(0,s.jsxs)("div",{className:"mb-2",children:[(0,s.jsx)("p",{className:"font-medium text-sm",children:e.name}),(0,s.jsxs)("p",{className:"text-xs text-muted-foreground",children:[e.events.length," fee(s) • ",j(e.total)]})]}),(0,s.jsx)("div",{className:"space-y-2",children:e.events.map(e=>(0,s.jsx)("div",{className:"flex items-center justify-between p-2 bg-accent/50 rounded",children:(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"font-medium text-sm",children:[(0,s.jsx)(N.Badge,{variant:"outline",className:"mr-2 text-xs",children:"flat"===e.fee_type?"Investment":e.fee_type.replace("_"," ")}),j(e.computed_amount)]}),(0,s.jsx)("div",{className:"text-xs text-muted-foreground",children:new Date(e.event_date).toLocaleDateString()})]})},e.id))})]},e.name))})})]},e?.id||"unknown"))]})}),(0,s.jsxs)(ea.TabsContent,{value:"invoices",className:"space-y-4",children:[(0,s.jsx)("div",{className:"flex gap-2",children:["all","draft","sent","paid","overdue"].map(e=>(0,s.jsx)(p.Button,{variant:m===e?"default":"outline",size:"sm",onClick:()=>x(e),children:e.charAt(0).toUpperCase()+e.slice(1)},e))}),0===e.length?(0,s.jsx)(r.Card,{children:(0,s.jsxs)(r.CardContent,{className:"py-10 text-center",children:[(0,s.jsx)(l.FileText,{className:"mx-auto h-12 w-12 text-muted-foreground/50 mb-4"}),(0,s.jsx)("p",{className:"text-muted-foreground",children:"No invoices found"})]})}):(0,s.jsx)("div",{className:"space-y-4",children:e.map(e=>(0,s.jsxs)(r.Card,{children:[(0,s.jsx)(r.CardHeader,{children:(0,s.jsxs)("div",{className:"flex items-start justify-between",children:[(0,s.jsxs)("div",{className:"flex items-start gap-2",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(r.CardTitle,{className:"text-lg",children:e.invoice_number}),(0,s.jsxs)("p",{className:"text-sm text-muted-foreground mt-1",children:[e.investor?.display_name||"Unknown Investor",e.deal&&` • ${e.deal.name}`]})]}),e.has_discrepancy&&(0,s.jsxs)(W.Popover,{children:[(0,s.jsx)(W.PopoverTrigger,{asChild:!0,children:(0,s.jsxs)("button",{className:"flex items-center gap-1 px-2 py-1 text-xs font-medium text-amber-600 bg-amber-100 dark:bg-amber-900/30 dark:text-amber-400 rounded-md hover:bg-amber-200 dark:hover:bg-amber-900/50 transition-colors cursor-pointer",children:[(0,s.jsx)(D.AlertTriangle,{className:"h-3.5 w-3.5"}),(0,s.jsx)("span",{children:"Discrepancy"})]})}),(0,s.jsx)(W.PopoverContent,{className:"w-80",side:"bottom",align:"start",children:(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 text-amber-600 dark:text-amber-400",children:[(0,s.jsx)(D.AlertTriangle,{className:"h-4 w-4"}),(0,s.jsx)("h4",{className:"font-medium",children:"Invoice Discrepancy Detected"})]}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"The invoice total does not match the sum of linked fee events."}),(0,s.jsxs)("div",{className:"space-y-2 p-3 bg-muted/50 rounded-md",children:[(0,s.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,s.jsx)("span",{className:"text-muted-foreground",children:"Invoice Total:"}),(0,s.jsx)("span",{className:"font-medium",children:j(e.total)})]}),(0,s.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,s.jsx)("span",{className:"text-muted-foreground",children:"Expected Total:"}),(0,s.jsx)("span",{className:"font-medium",children:j(e.total-(e.discrepancy_amount||0))})]}),(0,s.jsx)("div",{className:"border-t border-border pt-2 mt-2",children:(0,s.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,s.jsx)("span",{className:"text-amber-600 dark:text-amber-400 font-medium",children:"Discrepancy:"}),(0,s.jsxs)("span",{className:"text-amber-600 dark:text-amber-400 font-medium",children:[(e.discrepancy_amount||0)>0?"+":"",j(e.discrepancy_amount||0)]})]})})]}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground",children:"Please review the invoice line items and linked fee events to resolve this discrepancy."})]})})]})]}),(0,s.jsx)(N.Badge,{variant:er[e.status],children:e.status.replace("_"," ")})]})}),(0,s.jsx)(r.CardContent,{children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("div",{className:"text-2xl font-bold",children:j(e.total)}),(0,s.jsxs)("div",{className:"text-sm text-muted-foreground",children:["Due: ",new Date(e.due_date).toLocaleDateString(),e.balance_due&&e.balance_due>0&&(0,s.jsxs)("span",{className:"ml-2",children:["• Balance: ",j(e.balance_due)]})]})]}),(0,s.jsxs)("div",{className:"flex gap-2",children:["draft"===e.status&&(0,s.jsxs)(p.Button,{size:"sm",onClick:()=>S(e.id),children:[(0,s.jsx)(A.Send,{className:"mr-2 h-4 w-4"}),"Send"]}),["sent","partially_paid","overdue"].includes(e.status)&&(0,s.jsxs)(p.Button,{size:"sm",onClick:()=>k(e.id,e.balance_due||e.total),children:[(0,s.jsx)(n.DollarSign,{className:"mr-2 h-4 w-4"}),"Mark Paid"]})]})]})})]},e.id))})]})]})]}),(0,s.jsx)(et,{open:h,onClose:()=>{u(!1),g(void 0)},onSuccess:()=>C(),preselectedInvestorId:f})]})}e.s(["default",()=>en],501025);var el=e.i(84065),ei=e.i(432598),ec=e.i(382021),ed=e.i(913127),eo=e.i(93502),em=e.i(83245);function ex(){let e=(0,a.useRouter)(),l=(0,a.useSearchParams)(),[i,c]=(0,t.useState)(null),[h,u]=(0,t.useState)(!0),[f,g]=(0,t.useState)(60),[b,y]=(0,t.useState)([]),[v,w]=(0,t.useState)(!0),[_,C]=(0,t.useState)(!0),[k,T]=(0,t.useState)([]),[D,F]=(0,t.useState)(!0),[B,A]=(0,t.useState)(!0),[$,L]=(0,t.useState)([]),[U,O]=(0,t.useState)(!0),[z,R]=(0,t.useState)(!0),[G,H]=(0,t.useState)([]),[V,q]=(0,t.useState)(!0),[Y,J]=(0,t.useState)(!0),[K,X]=(0,t.useState)([]),[Q,Z]=(0,t.useState)([]),[ee,et]=(0,t.useState)(()=>{let e=l.get("deal_ids");return e?e.split(","):[]}),[ea,er]=(0,t.useState)(()=>{let e=l.get("entity_ids");return e?e.split(","):[]}),[en,ex]=(0,t.useState)(()=>{let e=l.get("date_from"),s=l.get("date_to");if(e||s)return{from:e?new Date(e):void 0,to:s?new Date(s):void 0}}),[eh,eu]=(0,t.useState)(!1),[ep,ej]=(0,t.useState)(!1),ef=ee.length>0||ea.length>0||en?.from||en?.to;(0,t.useEffect)(()=>{let s=new URLSearchParams(l.toString());ee.length>0?s.set("deal_ids",ee.join(",")):s.delete("deal_ids"),ea.length>0?s.set("entity_ids",ea.join(",")):s.delete("entity_ids"),en?.from?s.set("date_from",en.from.toISOString().split("T")[0]):s.delete("date_from"),en?.to?s.set("date_to",en.to.toISOString().split("T")[0]):s.delete("date_to");let t=s.toString()?`?${s.toString()}`:window.location.pathname;e.push(t,{scroll:!1})},[ee,ea,en,e,l]);let eg=(0,t.useCallback)(async()=>{try{let e=await fetch("/api/deals"),s=await e.json();X(s.deals||[])}catch(e){console.error("Error fetching deals:",e)}},[]),eb=(0,t.useCallback)(async()=>{try{let e=await fetch("/api/staff/fees/commissions"),s=((await e.json()).by_entity||[]).map(e=>({id:e.entity.id,name:e.entity.name,type:e.entity_type}));try{let e=await fetch("/api/staff/introducers"),t=((await e.json()).data||[]).map(e=>({id:e.id,name:e.legal_name||e.name||"Unknown",type:"introducer"})),a=new Set(s.map(e=>e.id));for(let e of t)a.has(e.id)||s.push(e)}catch{}s.sort((e,s)=>e.name.localeCompare(s.name)),Z(s)}catch(e){console.error("Error fetching entities:",e)}},[]),eN=(0,t.useCallback)(()=>{et([]),er([]),ex(void 0)},[]),ey=e=>{et(s=>s.includes(e)?s.filter(s=>s!==e):[...s,e])},ev=e=>{er(s=>s.includes(e)?s.filter(s=>s!==e):[...s,e])},ew=(0,t.useMemo)(()=>ee.map(e=>K.find(s=>s.id===e)?.name).filter(Boolean).join(", "),[ee,K]),e_=(0,t.useMemo)(()=>ea.map(e=>Q.find(s=>s.id===e)?.name).filter(Boolean).join(", "),[ea,Q]);(0,t.useEffect)(()=>{eg(),eb()},[eg,eb]);let eC=(0,t.useCallback)(async()=>{u(!0);try{let e=await fetch(`/api/staff/fees/schedules?days=${f}`),s=await e.json();c(s)}catch(e){console.error("Error fetching schedules:",e)}finally{u(!1)}},[f]),eS=(0,t.useCallback)(async()=>{w(!0);try{let e=new URLSearchParams;e.set("status","accrued"),e.set("limit","200"),en?.from?e.set("period_from",en.from.toISOString().split("T")[0]):e.set("period_from",new Date().toISOString().split("T")[0]),en?.to&&e.set("period_to",en.to.toISOString().split("T")[0]);let s=await fetch(`/api/staff/fees/events?${e.toString()}`),t=(await s.json()).data||[];ee.length>0&&(t=t.filter(e=>e.deal?.id&&ee.includes(e.deal.id))),y(t)}catch(e){console.error("Error fetching investor fees:",e),y([])}finally{w(!1)}},[ee,en]),ek=(0,t.useCallback)(async()=>{F(!0);try{let e=new URLSearchParams;e.set("entity_type","introducer"),e.set("status","accrued");let s=await fetch(`/api/staff/fees/commissions?${e.toString()}`),t=((await s.json()).data||[]).filter(e=>"introducer"===e.entity_type);ee.length>0&&(t=t.filter(e=>e.deal_id&&ee.includes(e.deal_id))),ea.length>0&&(t=t.filter(e=>ea.includes(e.entity_id))),en?.from&&(t=t.filter(e=>new Date(e.created_at)>=en.from)),en?.to&&(t=t.filter(e=>new Date(e.created_at)<=en.to)),T(t)}catch(e){console.error("Error fetching introducer commissions:",e),T([])}finally{F(!1)}},[ee,ea,en]),eT=(0,t.useCallback)(async()=>{O(!0);try{let e=new URLSearchParams;e.set("entity_type","partner"),e.set("status","accrued");let s=await fetch(`/api/staff/fees/commissions?${e.toString()}`),t=((await s.json()).data||[]).filter(e=>"partner"===e.entity_type);ee.length>0&&(t=t.filter(e=>e.deal_id&&ee.includes(e.deal_id))),ea.length>0&&(t=t.filter(e=>ea.includes(e.entity_id))),en?.from&&(t=t.filter(e=>new Date(e.created_at)>=en.from)),en?.to&&(t=t.filter(e=>new Date(e.created_at)<=en.to)),L(t)}catch(e){console.error("Error fetching partner commissions:",e),L([])}finally{O(!1)}},[ee,ea,en]),eD=(0,t.useCallback)(async()=>{q(!0);try{let e=new URLSearchParams;e.set("entity_type","commercial_partner"),e.set("status","accrued");let s=await fetch(`/api/staff/fees/commissions?${e.toString()}`),t=((await s.json()).data||[]).filter(e=>"commercial_partner"===e.entity_type);ee.length>0&&(t=t.filter(e=>e.deal_id&&ee.includes(e.deal_id))),ea.length>0&&(t=t.filter(e=>ea.includes(e.entity_id))),en?.from&&(t=t.filter(e=>new Date(e.created_at)>=en.from)),en?.to&&(t=t.filter(e=>new Date(e.created_at)<=en.to)),H(t)}catch(e){console.error("Error fetching commercial partner commissions:",e),H([])}finally{q(!1)}},[ee,ea,en]);(0,t.useEffect)(()=>{eC()},[f,eC]),(0,t.useEffect)(()=>{eS()},[eS]),(0,t.useEffect)(()=>{ek()},[ek]),(0,t.useEffect)(()=>{eT()},[eT]),(0,t.useEffect)(()=>{eD()},[eD]);let eI=(0,t.useMemo)(()=>{let e={};for(let s of b){let t=s.deal?.id||"unknown",a=s.deal?.name||"Unknown Deal",r=s.investor?.id||"unknown",n=s.investor?.legal_name||s.investor?.display_name||"Unknown Investor";e[t]||(e[t]={deal:{id:t,name:a},byInvestor:{},total:0}),e[t].byInvestor[r]||(e[t].byInvestor[r]={investor:{id:r,name:n},fees:[],total:0}),e[t].byInvestor[r].fees.push(s),e[t].byInvestor[r].total+=s.computed_amount,e[t].total+=s.computed_amount}return Object.values(e).forEach(e=>{Object.values(e.byInvestor).forEach(e=>{e.fees.sort((e,s)=>{let t=e.period_start_date||e.event_date,a=s.period_start_date||s.event_date;return new Date(t).getTime()-new Date(a).getTime()})})}),e},[b]),eP=(0,t.useMemo)(()=>b.reduce((e,s)=>e+s.computed_amount,0),[b]),eF=(0,t.useMemo)(()=>{let e={};for(let s of k){let t=s.entity_id||"unknown",a=s.entity_name||"Unknown Introducer",r=s.deal_id||"unknown",n=s.deal_name||"Unknown Deal";e[t]||(e[t]={introducer:{id:t,name:a},byDeal:{},total:0}),e[t].byDeal[r]||(e[t].byDeal[r]={deal:{id:r,name:n},commissions:[],total:0}),e[t].byDeal[r].commissions.push(s),e[t].byDeal[r].total+=Number(s.accrual_amount),e[t].total+=Number(s.accrual_amount)}return Object.values(e).forEach(e=>{Object.values(e.byDeal).forEach(e=>{e.commissions.sort((e,s)=>new Date(s.created_at).getTime()-new Date(e.created_at).getTime())})}),e},[k]),eE=(0,t.useMemo)(()=>k.reduce((e,s)=>e+Number(s.accrual_amount),0),[k]),eB=(0,t.useMemo)(()=>{let e={};for(let s of $){let t=s.entity_id||"unknown",a=s.entity_name||"Unknown Partner",r=s.deal_id||"unknown",n=s.deal_name||"Unknown Deal";e[t]||(e[t]={partner:{id:t,name:a},byDeal:{},total:0}),e[t].byDeal[r]||(e[t].byDeal[r]={deal:{id:r,name:n},commissions:[],total:0}),e[t].byDeal[r].commissions.push(s),e[t].byDeal[r].total+=Number(s.accrual_amount),e[t].total+=Number(s.accrual_amount)}return Object.values(e).forEach(e=>{Object.values(e.byDeal).forEach(e=>{e.commissions.sort((e,s)=>new Date(s.created_at).getTime()-new Date(e.created_at).getTime())})}),e},[$]),eA=(0,t.useMemo)(()=>$.reduce((e,s)=>e+Number(s.accrual_amount),0),[$]),e$=(0,t.useMemo)(()=>{let e={};for(let s of G){let t=s.entity_id||"unknown",a=s.entity_name||"Unknown Commercial Partner",r=s.deal_id||"unknown",n=s.deal_name||"Unknown Deal";e[t]||(e[t]={commercialPartner:{id:t,name:a},byDeal:{},total:0}),e[t].byDeal[r]||(e[t].byDeal[r]={deal:{id:r,name:n},commissions:[],total:0}),e[t].byDeal[r].commissions.push(s),e[t].byDeal[r].total+=Number(s.accrual_amount),e[t].total+=Number(s.accrual_amount)}return Object.values(e).forEach(e=>{Object.values(e.byDeal).forEach(e=>{e.commissions.sort((e,s)=>new Date(s.created_at).getTime()-new Date(e.created_at).getTime())})}),e},[G]),eL=(0,t.useMemo)(()=>G.reduce((e,s)=>e+Number(s.accrual_amount),0),[G]);if(h)return(0,s.jsx)("div",{className:"text-white",children:"Loading fee schedules..."});if(!i)return(0,s.jsx)("div",{className:"text-white",children:"Failed to load fee schedules"});let eU={management:"bg-blue-500/20 text-blue-400 border-blue-500/30",subscription:"bg-purple-500/20 text-purple-400 border-purple-500/30",performance:"bg-green-500/20 text-green-400 border-green-500/30"};return(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"text-2xl font-bold text-white",children:"Fee Schedule"}),(0,s.jsxs)("p",{className:"text-gray-400",children:["Upcoming recurring fees for the next ",f," days"]})]}),(0,s.jsxs)("div",{className:"grid gap-4 md:grid-cols-3",children:[(0,s.jsxs)(r.Card,{children:[(0,s.jsxs)(r.CardHeader,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,s.jsx)(r.CardTitle,{className:"text-sm font-medium",children:"Total Scheduled"}),(0,s.jsx)(el.Calendar,{className:"h-4 w-4 text-muted-foreground"})]}),(0,s.jsxs)(r.CardContent,{children:[(0,s.jsx)("div",{className:"text-2xl font-bold text-white",children:i.summary.total_scheduled}),(0,s.jsx)("p",{className:"text-xs text-gray-400",children:"Recurring fees due"})]})]}),(0,s.jsxs)(r.Card,{children:[(0,s.jsxs)(r.CardHeader,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,s.jsx)(r.CardTitle,{className:"text-sm font-medium",children:"Expected Revenue"}),(0,s.jsx)(n.DollarSign,{className:"h-4 w-4 text-muted-foreground"})]}),(0,s.jsxs)(r.CardContent,{children:[(0,s.jsx)("div",{className:"text-2xl font-bold text-white",children:j(i.summary.total_amount)}),(0,s.jsx)("p",{className:"text-xs text-gray-400",children:"Total amount scheduled"})]})]}),(0,s.jsxs)(r.Card,{children:[(0,s.jsxs)(r.CardHeader,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,s.jsx)(r.CardTitle,{className:"text-sm font-medium",children:"Date Range"}),(0,s.jsx)(E.Clock,{className:"h-4 w-4 text-muted-foreground"})]}),(0,s.jsxs)(r.CardContent,{children:[(0,s.jsxs)("div",{className:"text-sm font-medium text-white",children:[new Date(i.summary.date_range.from).toLocaleDateString("en-US",{month:"short",day:"numeric"})," - ",new Date(i.summary.date_range.to).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})]}),(0,s.jsx)("p",{className:"text-xs text-gray-400",children:"Forecast period"})]})]})]}),(0,s.jsx)("div",{className:"flex gap-2",children:[30,60,90,180].map(e=>(0,s.jsxs)(p.Button,{variant:f===e?"default":"outline",size:"sm",onClick:()=>g(e),children:[e," days"]},e))}),(0,s.jsxs)(r.Card,{children:[(0,s.jsx)(r.CardHeader,{className:"pb-3",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(ec.Filter,{className:"h-4 w-4 text-gray-400"}),(0,s.jsx)(r.CardTitle,{className:"text-sm",children:"Filters"}),ef&&(0,s.jsxs)(N.Badge,{variant:"secondary",className:"text-xs",children:[ee.length+ea.length+ +!!en," active"]})]}),ef&&(0,s.jsxs)(p.Button,{variant:"ghost",size:"sm",onClick:eN,className:"h-7 text-xs",children:[(0,s.jsx)(ei.X,{className:"h-3 w-3 mr-1"}),"Clear all"]})]})}),(0,s.jsx)(r.CardContent,{className:"pt-0",children:(0,s.jsxs)("div",{className:"flex flex-wrap gap-3",children:[(0,s.jsxs)(W.Popover,{open:eh,onOpenChange:eu,children:[(0,s.jsx)(W.PopoverTrigger,{asChild:!0,children:(0,s.jsxs)(p.Button,{variant:"outline",role:"combobox","aria-expanded":eh,className:"min-w-[200px] justify-between text-left font-normal",children:[(0,s.jsx)("span",{className:"truncate",children:ee.length>0?1===ee.length?ew:`${ee.length} deals selected`:"Select deals..."}),(0,s.jsx)(ed.ChevronsUpDown,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),(0,s.jsx)(W.PopoverContent,{className:"w-[300px] p-0",align:"start",children:(0,s.jsxs)(eo.Command,{children:[(0,s.jsx)(eo.CommandInput,{placeholder:"Search deals..."}),(0,s.jsxs)(eo.CommandList,{children:[(0,s.jsx)(eo.CommandEmpty,{children:"No deals found."}),(0,s.jsx)(eo.CommandGroup,{heading:"Deals",children:K.map(e=>(0,s.jsx)(eo.CommandItem,{value:e.name,onSelect:()=>ey(e.id),children:(0,s.jsxs)("div",{className:"flex items-center gap-2 w-full",children:[(0,s.jsx)(es.Checkbox,{checked:ee.includes(e.id),onCheckedChange:()=>ey(e.id),className:"h-4 w-4"}),(0,s.jsx)("span",{className:"truncate",children:e.name})]})},e.id))})]})]})})]}),(0,s.jsxs)(W.Popover,{open:ep,onOpenChange:ej,children:[(0,s.jsx)(W.PopoverTrigger,{asChild:!0,children:(0,s.jsxs)(p.Button,{variant:"outline",role:"combobox","aria-expanded":ep,className:"min-w-[200px] justify-between text-left font-normal",children:[(0,s.jsx)("span",{className:"truncate",children:ea.length>0?1===ea.length?e_:`${ea.length} entities selected`:"Select entities..."}),(0,s.jsx)(ed.ChevronsUpDown,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),(0,s.jsx)(W.PopoverContent,{className:"w-[300px] p-0",align:"start",children:(0,s.jsxs)(eo.Command,{children:[(0,s.jsx)(eo.CommandInput,{placeholder:"Search entities..."}),(0,s.jsxs)(eo.CommandList,{children:[(0,s.jsx)(eo.CommandEmpty,{children:"No entities found."}),["introducer","partner","commercial_partner"].map(e=>{let t=Q.filter(s=>s.type===e);return 0===t.length?null:(0,s.jsx)(eo.CommandGroup,{heading:{introducer:"Introducers",partner:"Partners",commercial_partner:"Commercial Partners"}[e],children:t.map(e=>(0,s.jsx)(eo.CommandItem,{value:`${e.type}-${e.name}`,onSelect:()=>ev(e.id),children:(0,s.jsxs)("div",{className:"flex items-center gap-2 w-full",children:[(0,s.jsx)(es.Checkbox,{checked:ea.includes(e.id),onCheckedChange:()=>ev(e.id),className:"h-4 w-4"}),"introducer"===e.type&&(0,s.jsx)(o.UserCheck,{className:"h-3.5 w-3.5 text-blue-400 shrink-0"}),"partner"===e.type&&(0,s.jsx)(m.Handshake,{className:"h-3.5 w-3.5 text-green-400 shrink-0"}),"commercial_partner"===e.type&&(0,s.jsx)(x.Briefcase,{className:"h-3.5 w-3.5 text-purple-400 shrink-0"}),(0,s.jsx)("span",{className:"truncate",children:e.name})]})},e.id))},e)})]})]})})]}),(0,s.jsx)(em.DateRangePicker,{value:en,onChange:ex,variant:"dark"})]})})]}),(0,s.jsx)(M.Collapsible,{open:_,onOpenChange:C,children:(0,s.jsxs)(r.Card,{children:[(0,s.jsx)(r.CardHeader,{className:"pb-3",children:(0,s.jsx)(M.CollapsibleTrigger,{asChild:!0,children:(0,s.jsxs)("button",{className:"flex w-full items-center justify-between text-left",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)(d.Users,{className:"h-5 w-5 text-blue-400"}),(0,s.jsxs)("div",{children:[(0,s.jsx)(r.CardTitle,{className:"text-lg",children:"Investor Fees"}),(0,s.jsx)("p",{className:"text-sm text-gray-400 mt-0.5",children:"Accrued fees pending collection"})]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[(0,s.jsxs)("div",{className:"text-right",children:[(0,s.jsxs)("div",{className:"text-sm font-medium text-white",children:[b.length," fee",1!==b.length?"s":""]}),(0,s.jsx)("div",{className:"text-sm text-gray-400",children:j(eP)})]}),_?(0,s.jsx)(I.ChevronDown,{className:"h-5 w-5 text-gray-400"}):(0,s.jsx)(P.ChevronRight,{className:"h-5 w-5 text-gray-400"})]})]})})}),(0,s.jsx)(M.CollapsibleContent,{children:(0,s.jsx)(r.CardContent,{className:"pt-0",children:v?(0,s.jsx)("p",{className:"text-gray-400 py-4",children:"Loading investor fees..."}):0===b.length?(0,s.jsx)("p",{className:"text-gray-400 py-4",children:"No accrued investor fees with future periods"}):(0,s.jsx)("div",{className:"space-y-6",children:Object.entries(eI).map(([e,t])=>(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 border-b border-gray-700 pb-2",children:[(0,s.jsx)(S.Building2,{className:"h-4 w-4 text-purple-400"}),(0,s.jsx)("h4",{className:"font-semibold text-white",children:t.deal.name}),(0,s.jsx)("span",{className:"text-sm text-gray-400 ml-auto",children:j(t.total)})]}),Object.entries(t.byInvestor).map(([e,t])=>(0,s.jsxs)("div",{className:"ml-6 space-y-2",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(d.Users,{className:"h-3.5 w-3.5 text-gray-500"}),(0,s.jsx)("h5",{className:"font-medium text-gray-200",children:t.investor.name}),(0,s.jsx)("span",{className:"text-sm text-gray-400 ml-auto",children:j(t.total)})]}),(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsxs)("table",{className:"w-full text-sm",children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{className:"border-b border-gray-700",children:[(0,s.jsx)("th",{className:"text-left py-2 px-2 text-gray-400 font-medium",children:"Fee Type"}),(0,s.jsx)("th",{className:"text-right py-2 px-2 text-gray-400 font-medium",children:"Amount"}),(0,s.jsx)("th",{className:"text-left py-2 px-2 text-gray-400 font-medium",children:"Period Start"}),(0,s.jsx)("th",{className:"text-left py-2 px-2 text-gray-400 font-medium",children:"Period End"})]})}),(0,s.jsx)("tbody",{children:t.fees.map(e=>(0,s.jsxs)("tr",{className:"border-b border-gray-800",children:[(0,s.jsx)("td",{className:"py-2 px-2",children:(0,s.jsx)(N.Badge,{className:eU[e.fee_type]||"bg-gray-500/20 text-gray-400 border-gray-500/30",children:e.fee_type})}),(0,s.jsx)("td",{className:"py-2 px-2 text-right text-white font-medium",children:j(e.computed_amount)}),(0,s.jsx)("td",{className:"py-2 px-2 text-gray-300",children:e.period_start_date?new Date(e.period_start_date).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}):"-"}),(0,s.jsx)("td",{className:"py-2 px-2 text-gray-300",children:e.period_end_date?new Date(e.period_end_date).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}):"-"})]},e.id))})]})})]},e))]},e))})})})]})}),(0,s.jsx)(M.Collapsible,{open:B,onOpenChange:A,children:(0,s.jsxs)(r.Card,{children:[(0,s.jsx)(r.CardHeader,{className:"pb-3",children:(0,s.jsx)(M.CollapsibleTrigger,{asChild:!0,children:(0,s.jsxs)("button",{className:"flex w-full items-center justify-between text-left",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)(o.UserCheck,{className:"h-5 w-5 text-blue-400"}),(0,s.jsxs)("div",{children:[(0,s.jsx)(r.CardTitle,{className:"text-lg",children:"Introducer Commissions"}),(0,s.jsx)("p",{className:"text-sm text-gray-400 mt-0.5",children:"Pending commission payments to introducers"})]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[(0,s.jsxs)("div",{className:"text-right",children:[(0,s.jsxs)("div",{className:"text-sm font-medium text-white",children:[k.length," commission",1!==k.length?"s":""]}),(0,s.jsx)("div",{className:"text-sm text-gray-400",children:j(eE)})]}),B?(0,s.jsx)(I.ChevronDown,{className:"h-5 w-5 text-gray-400"}):(0,s.jsx)(P.ChevronRight,{className:"h-5 w-5 text-gray-400"})]})]})})}),(0,s.jsx)(M.CollapsibleContent,{children:(0,s.jsx)(r.CardContent,{className:"pt-0",children:D?(0,s.jsx)("p",{className:"text-gray-400 py-4",children:"Loading introducer commissions..."}):0===k.length?(0,s.jsx)("p",{className:"text-gray-400 py-4",children:"No pending introducer commissions"}):(0,s.jsx)("div",{className:"space-y-6",children:Object.entries(eF).map(([e,t])=>(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 border-b border-gray-700 pb-2",children:[(0,s.jsx)(o.UserCheck,{className:"h-4 w-4 text-blue-400"}),(0,s.jsx)("h4",{className:"font-semibold text-white",children:t.introducer.name}),(0,s.jsx)("span",{className:"text-sm text-gray-400 ml-auto",children:j(t.total)})]}),Object.entries(t.byDeal).map(([e,t])=>(0,s.jsxs)("div",{className:"ml-6 space-y-2",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(S.Building2,{className:"h-3.5 w-3.5 text-purple-400"}),(0,s.jsx)("h5",{className:"font-medium text-gray-200",children:t.deal.name}),(0,s.jsx)("span",{className:"text-sm text-gray-400 ml-auto",children:j(t.total)})]}),(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsxs)("table",{className:"w-full text-sm",children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{className:"border-b border-gray-700",children:[(0,s.jsx)("th",{className:"text-left py-2 px-2 text-gray-400 font-medium",children:"Investor"}),(0,s.jsx)("th",{className:"text-right py-2 px-2 text-gray-400 font-medium",children:"Amount"}),(0,s.jsx)("th",{className:"text-left py-2 px-2 text-gray-400 font-medium",children:"Status"}),(0,s.jsx)("th",{className:"text-left py-2 px-2 text-gray-400 font-medium",children:"Created Date"})]})}),(0,s.jsx)("tbody",{children:t.commissions.map(e=>(0,s.jsxs)("tr",{className:"border-b border-gray-800",children:[(0,s.jsx)("td",{className:"py-2 px-2 text-gray-300",children:e.investor_name||"-"}),(0,s.jsx)("td",{className:"py-2 px-2 text-right text-white font-medium",children:j(Number(e.accrual_amount))}),(0,s.jsx)("td",{className:"py-2 px-2",children:(0,s.jsx)(N.Badge,{className:"bg-amber-500/20 text-amber-400 border-amber-500/30",children:e.status})}),(0,s.jsx)("td",{className:"py-2 px-2 text-gray-300",children:new Date(e.created_at).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})})]},e.id))})]})})]},e))]},e))})})})]})}),(0,s.jsx)(M.Collapsible,{open:z,onOpenChange:R,children:(0,s.jsxs)(r.Card,{children:[(0,s.jsx)(r.CardHeader,{className:"pb-3",children:(0,s.jsx)(M.CollapsibleTrigger,{asChild:!0,children:(0,s.jsxs)("button",{className:"flex w-full items-center justify-between text-left",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)(m.Handshake,{className:"h-5 w-5 text-green-400"}),(0,s.jsxs)("div",{children:[(0,s.jsx)(r.CardTitle,{className:"text-lg",children:"Partner Commissions"}),(0,s.jsx)("p",{className:"text-sm text-gray-400 mt-0.5",children:"Pending commission payments to partners"})]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[(0,s.jsxs)("div",{className:"text-right",children:[(0,s.jsxs)("div",{className:"text-sm font-medium text-white",children:[$.length," commission",1!==$.length?"s":""]}),(0,s.jsx)("div",{className:"text-sm text-gray-400",children:j(eA)})]}),z?(0,s.jsx)(I.ChevronDown,{className:"h-5 w-5 text-gray-400"}):(0,s.jsx)(P.ChevronRight,{className:"h-5 w-5 text-gray-400"})]})]})})}),(0,s.jsx)(M.CollapsibleContent,{children:(0,s.jsx)(r.CardContent,{className:"pt-0",children:U?(0,s.jsx)("p",{className:"text-gray-400 py-4",children:"Loading partner commissions..."}):0===$.length?(0,s.jsx)("p",{className:"text-gray-400 py-4",children:"No pending partner commissions"}):(0,s.jsx)("div",{className:"space-y-6",children:Object.entries(eB).map(([e,t])=>(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 border-b border-gray-700 pb-2",children:[(0,s.jsx)(m.Handshake,{className:"h-4 w-4 text-green-400"}),(0,s.jsx)("h4",{className:"font-semibold text-white",children:t.partner.name}),(0,s.jsx)("span",{className:"text-sm text-gray-400 ml-auto",children:j(t.total)})]}),Object.entries(t.byDeal).map(([e,t])=>(0,s.jsxs)("div",{className:"ml-6 space-y-2",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(S.Building2,{className:"h-3.5 w-3.5 text-purple-400"}),(0,s.jsx)("h5",{className:"font-medium text-gray-200",children:t.deal.name}),(0,s.jsx)("span",{className:"text-sm text-gray-400 ml-auto",children:j(t.total)})]}),(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsxs)("table",{className:"w-full text-sm",children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{className:"border-b border-gray-700",children:[(0,s.jsx)("th",{className:"text-left py-2 px-2 text-gray-400 font-medium",children:"Investor"}),(0,s.jsx)("th",{className:"text-right py-2 px-2 text-gray-400 font-medium",children:"Amount"}),(0,s.jsx)("th",{className:"text-left py-2 px-2 text-gray-400 font-medium",children:"Status"}),(0,s.jsx)("th",{className:"text-left py-2 px-2 text-gray-400 font-medium",children:"Created Date"})]})}),(0,s.jsx)("tbody",{children:t.commissions.map(e=>(0,s.jsxs)("tr",{className:"border-b border-gray-800",children:[(0,s.jsx)("td",{className:"py-2 px-2 text-gray-300",children:e.investor_name||"-"}),(0,s.jsx)("td",{className:"py-2 px-2 text-right text-white font-medium",children:j(Number(e.accrual_amount))}),(0,s.jsx)("td",{className:"py-2 px-2",children:(0,s.jsx)(N.Badge,{className:"bg-amber-500/20 text-amber-400 border-amber-500/30",children:e.status})}),(0,s.jsx)("td",{className:"py-2 px-2 text-gray-300",children:new Date(e.created_at).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})})]},e.id))})]})})]},e))]},e))})})})]})}),(0,s.jsx)(M.Collapsible,{open:Y,onOpenChange:J,children:(0,s.jsxs)(r.Card,{children:[(0,s.jsx)(r.CardHeader,{className:"pb-3",children:(0,s.jsx)(M.CollapsibleTrigger,{asChild:!0,children:(0,s.jsxs)("button",{className:"flex w-full items-center justify-between text-left",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)(x.Briefcase,{className:"h-5 w-5 text-purple-400"}),(0,s.jsxs)("div",{children:[(0,s.jsx)(r.CardTitle,{className:"text-lg",children:"Commercial Partner Commissions"}),(0,s.jsx)("p",{className:"text-sm text-gray-400 mt-0.5",children:"Pending commission payments to commercial partners"})]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[(0,s.jsxs)("div",{className:"text-right",children:[(0,s.jsxs)("div",{className:"text-sm font-medium text-white",children:[G.length," commission",1!==G.length?"s":""]}),(0,s.jsx)("div",{className:"text-sm text-gray-400",children:j(eL)})]}),Y?(0,s.jsx)(I.ChevronDown,{className:"h-5 w-5 text-gray-400"}):(0,s.jsx)(P.ChevronRight,{className:"h-5 w-5 text-gray-400"})]})]})})}),(0,s.jsx)(M.CollapsibleContent,{children:(0,s.jsx)(r.CardContent,{className:"pt-0",children:V?(0,s.jsx)("p",{className:"text-gray-400 py-4",children:"Loading commercial partner commissions..."}):0===G.length?(0,s.jsx)("p",{className:"text-gray-400 py-4",children:"No pending commercial partner commissions"}):(0,s.jsx)("div",{className:"space-y-6",children:Object.entries(e$).map(([e,t])=>(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 border-b border-gray-700 pb-2",children:[(0,s.jsx)(x.Briefcase,{className:"h-4 w-4 text-purple-400"}),(0,s.jsx)("h4",{className:"font-semibold text-white",children:t.commercialPartner.name}),(0,s.jsx)("span",{className:"text-sm text-gray-400 ml-auto",children:j(t.total)})]}),Object.entries(t.byDeal).map(([e,t])=>(0,s.jsxs)("div",{className:"ml-6 space-y-2",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(S.Building2,{className:"h-3.5 w-3.5 text-purple-400"}),(0,s.jsx)("h5",{className:"font-medium text-gray-200",children:t.deal.name}),(0,s.jsx)("span",{className:"text-sm text-gray-400 ml-auto",children:j(t.total)})]}),(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsxs)("table",{className:"w-full text-sm",children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{className:"border-b border-gray-700",children:[(0,s.jsx)("th",{className:"text-left py-2 px-2 text-gray-400 font-medium",children:"Investor"}),(0,s.jsx)("th",{className:"text-right py-2 px-2 text-gray-400 font-medium",children:"Amount"}),(0,s.jsx)("th",{className:"text-left py-2 px-2 text-gray-400 font-medium",children:"Status"}),(0,s.jsx)("th",{className:"text-left py-2 px-2 text-gray-400 font-medium",children:"Created Date"})]})}),(0,s.jsx)("tbody",{children:t.commissions.map(e=>(0,s.jsxs)("tr",{className:"border-b border-gray-800",children:[(0,s.jsx)("td",{className:"py-2 px-2 text-gray-300",children:e.investor_name||"-"}),(0,s.jsx)("td",{className:"py-2 px-2 text-right text-white font-medium",children:j(Number(e.accrual_amount))}),(0,s.jsx)("td",{className:"py-2 px-2",children:(0,s.jsx)(N.Badge,{className:"bg-amber-500/20 text-amber-400 border-amber-500/30",children:e.status})}),(0,s.jsx)("td",{className:"py-2 px-2 text-gray-300",children:new Date(e.created_at).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})})]},e.id))})]})})]},e))]},e))})})})]})}),(0,s.jsx)("div",{children:(0,s.jsx)("h3",{className:"text-lg font-semibold text-white mb-4",children:"Scheduled Recurring Fees"})}),0===Object.keys(i.by_month).length?(0,s.jsx)(r.Card,{children:(0,s.jsx)(r.CardContent,{className:"py-10 text-center",children:(0,s.jsxs)("p",{className:"text-gray-400",children:["No upcoming fees scheduled for the next ",f," days"]})})}):(0,s.jsx)("div",{className:"space-y-6",children:Object.entries(i.by_month).map(([e,t])=>(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold text-white",children:e}),(0,s.jsxs)("div",{className:"text-sm text-gray-400",children:[t.fees.length," fee",1!==t.fees.length?"s":""," • ",j(t.total)]})]}),(0,s.jsx)("div",{className:"space-y-3",children:t.fees.map(e=>(0,s.jsx)(r.Card,{children:(0,s.jsx)(r.CardContent,{className:"py-4",children:(0,s.jsxs)("div",{className:"flex items-start justify-between",children:[(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,s.jsx)(N.Badge,{className:eU[e.fee_type]||"bg-gray-500/20 text-gray-400 border-gray-500/30",children:e.fee_name}),(0,s.jsx)(N.Badge,{variant:"outline",className:"text-xs",children:e.frequency})]}),(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("p",{className:"font-medium text-white",children:e.investor.legal_name||e.investor.display_name}),(0,s.jsx)("p",{className:"text-sm text-gray-400",children:e.vehicle.name}),(0,s.jsxs)("p",{className:"text-sm text-gray-400",children:["Subscription: ",e.subscription_number]}),(0,s.jsxs)("p",{className:"text-xs text-gray-500",children:["Due: ",new Date(e.next_due_date).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric",year:"numeric"})]})]})]}),(0,s.jsxs)("div",{className:"text-right ml-4",children:[(0,s.jsx)("div",{className:"text-xl font-bold text-white",children:j(e.amount)}),(0,s.jsx)(N.Badge,{variant:"secondary",className:"mt-2",children:e.status})]})]})})},e.id))})]},e))})]})}e.s(["default",()=>ex],287020);var eh=e.i(820417);let eu={accrued:"secondary",invoice_requested:"outline",invoice_submitted:"default",invoiced:"default",paid:"default",rejected:"destructive",cancelled:"secondary"},ep={accrued:E.Clock,invoice_requested:A.Send,invoice_submitted:l.FileText,invoiced:l.FileText,paid:F.CheckCircle,rejected:i.AlertCircle,cancelled:i.AlertCircle},ej={introducer:{label:"Introducer",icon:d.Users,linkPath:"/versotech_main/introducers",color:"text-blue-400"},partner:{label:"Partner",icon:x.Briefcase,linkPath:"/versotech_main/partners",color:"text-purple-400"},commercial_partner:{label:"Commercial Partner",icon:S.Building2,linkPath:"/versotech_main/commercial-partners",color:"text-orange-400"}};function ef(){let[e,a]=(0,t.useState)(null),[l,c]=(0,t.useState)(!0),[d,o]=(0,t.useState)("all"),[m,x]=(0,t.useState)("all"),[u,f]=(0,t.useState)(null),g=(0,t.useCallback)(async()=>{c(!0);try{let e=new URLSearchParams;"all"!==d&&e.set("status",d),"all"!==m&&e.set("entity_type",m);let s=e.toString()?`/api/staff/fees/commissions?${e.toString()}`:"/api/staff/fees/commissions",t=await fetch(s),r=await t.json();a(r)}catch(e){console.error("Error fetching commissions:",e)}finally{c(!1)}},[d,m]);(0,t.useEffect)(()=>{g()},[d,m,g]);let b=async(e,s)=>{f(e);try{let t=await fetch(`/api/staff/fees/commissions/${e}/mark-invoiced`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({entity_type:s})});if(t.ok)g();else{let e=await t.json();alert(`Failed to mark as invoiced: ${e.error}`)}}catch(e){console.error("Error marking as invoiced:",e),alert("Failed to mark as invoiced")}finally{f(null)}},y=async(e,s)=>{let t=prompt("Enter payment reference (optional):");f(e);try{let a=await fetch(`/api/staff/fees/commissions/${e}/mark-paid`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({payment_reference:t,entity_type:s})});if(a.ok)g();else{let e=await a.json();alert(`Failed to mark as paid: ${e.error}`)}}catch(e){console.error("Error marking as paid:",e),alert("Failed to mark as paid")}finally{f(null)}};return l?(0,s.jsx)("div",{className:"text-white",children:"Loading commissions..."}):e?(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"text-2xl font-bold text-white",children:"Entity Commissions"}),(0,s.jsx)("p",{className:"text-gray-400",children:"Track and manage commission payments to introducers, partners, and commercial partners"})]}),(0,s.jsxs)("div",{className:"grid gap-4 md:grid-cols-4",children:[(0,s.jsxs)(r.Card,{children:[(0,s.jsxs)(r.CardHeader,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,s.jsx)(r.CardTitle,{className:"text-sm font-medium",children:"Total Owed"}),(0,s.jsx)(n.DollarSign,{className:"h-4 w-4 text-muted-foreground"})]}),(0,s.jsxs)(r.CardContent,{children:[(0,s.jsx)("div",{className:"text-2xl font-bold text-white",children:j(e.summary.total_owed)}),(0,s.jsx)("p",{className:"text-xs text-gray-400",children:"Accrued + Invoiced"})]})]}),(0,s.jsxs)(r.Card,{children:[(0,s.jsxs)(r.CardHeader,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,s.jsx)(r.CardTitle,{className:"text-sm font-medium",children:"Accrued"}),(0,s.jsx)(E.Clock,{className:"h-4 w-4 text-blue-400"})]}),(0,s.jsxs)(r.CardContent,{children:[(0,s.jsx)("div",{className:"text-2xl font-bold text-white",children:j(e.summary.total_accrued)}),(0,s.jsx)("p",{className:"text-xs text-gray-400",children:"Not yet invoiced"})]})]}),(0,s.jsxs)(r.Card,{children:[(0,s.jsxs)(r.CardHeader,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,s.jsx)(r.CardTitle,{className:"text-sm font-medium",children:"Paid (YTD)"}),(0,s.jsx)(F.CheckCircle,{className:"h-4 w-4 text-green-400"})]}),(0,s.jsxs)(r.CardContent,{children:[(0,s.jsx)("div",{className:"text-2xl font-bold text-white",children:j(e.summary.total_paid)}),(0,s.jsx)("p",{className:"text-xs text-gray-400",children:"Settled commissions"})]})]}),(0,s.jsxs)(r.Card,{children:[(0,s.jsxs)(r.CardHeader,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,s.jsx)(r.CardTitle,{className:"text-sm font-medium",children:"Overdue"}),(0,s.jsx)(i.AlertCircle,{className:"h-4 w-4 text-destructive"})]}),(0,s.jsxs)(r.CardContent,{children:[(0,s.jsx)("div",{className:"text-2xl font-bold text-destructive",children:j(e.summary.total_overdue)}),(0,s.jsx)("p",{className:"text-xs text-gray-400",children:"Past due date"})]})]})]}),(0,s.jsxs)("div",{className:"flex flex-wrap gap-4",children:[(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)("span",{className:"text-sm text-gray-400 self-center mr-1",children:"Status:"}),["all","accrued","invoice_requested","invoice_submitted","invoiced","paid","rejected","cancelled"].map(e=>(0,s.jsx)(p.Button,{variant:d===e?"default":"outline",size:"sm",onClick:()=>o(e),children:"invoice_requested"===e?"Invoice Requested":"invoice_submitted"===e?"Invoice Submitted":e.charAt(0).toUpperCase()+e.slice(1)},e))]}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)("span",{className:"text-sm text-gray-400 self-center mr-1",children:"Entity:"}),(0,s.jsx)(p.Button,{variant:"all"===m?"default":"outline",size:"sm",onClick:()=>x("all"),children:"All"}),Object.keys(ej).map(e=>{let t=ej[e],a=t.icon;return(0,s.jsxs)(p.Button,{variant:m===e?"default":"outline",size:"sm",onClick:()=>x(e),className:"flex items-center gap-1",children:[(0,s.jsx)(a,{className:`h-3 w-3 ${m===e?"":t.color}`}),t.label]},e)})]})]}),0===e.by_entity.length?(0,s.jsx)(r.Card,{children:(0,s.jsx)(r.CardContent,{className:"py-10 text-center",children:(0,s.jsx)("p",{className:"text-gray-400",children:"No commissions found"})})}):(0,s.jsx)("div",{className:"space-y-4",children:e.by_entity.map(e=>{let t=ej[e.entity_type]||ej.introducer,a=t.icon;return(0,s.jsxs)(r.Card,{children:[(0,s.jsx)(r.CardHeader,{children:(0,s.jsxs)("div",{className:"flex items-start justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)(r.CardTitle,{className:"text-lg text-white flex items-center gap-2",children:[(0,s.jsx)(a,{className:`h-5 w-5 ${t.color}`}),e.entity.name,(0,s.jsx)(N.Badge,{variant:"outline",className:`text-xs ${t.color}`,children:t.label}),(0,s.jsx)(eh.default,{href:`${t.linkPath}/${e.entity.id}`,children:(0,s.jsx)(p.Button,{variant:"ghost",size:"sm",className:"h-6 px-2",children:(0,s.jsx)(h.ExternalLink,{className:"h-3 w-3"})})})]}),(e.entity.contact_name||e.entity.email)&&(0,s.jsx)("p",{className:"text-sm text-gray-400 mt-1",children:e.entity.contact_name&&e.entity.email?`${e.entity.contact_name} • ${e.entity.email}`:e.entity.contact_name||e.entity.email})]}),(0,s.jsxs)("div",{className:"text-right",children:[(0,s.jsx)("p",{className:"text-2xl font-bold text-white",children:j(e.totals.total)}),(0,s.jsxs)("p",{className:"text-xs text-gray-400",children:[e.commissions.length," commission",1!==e.commissions.length?"s":""]})]})]})}),(0,s.jsx)(r.CardContent,{children:(0,s.jsx)("div",{className:"space-y-3",children:e.commissions.map(e=>{let t=ep[e.status],a="paid"!==e.status&&!!e.payment_due_date&&new Date(e.payment_due_date)<new Date;return(0,s.jsx)("div",{className:`p-4 rounded border ${a?"bg-red-900/20 border-red-700":"bg-gray-900 border-gray-700"}`,children:(0,s.jsxs)("div",{className:"flex items-start justify-between",children:[(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,s.jsxs)(N.Badge,{variant:eu[e.status],children:[(0,s.jsx)(t,{className:"h-3 w-3 mr-1"}),"invoice_requested"===e.status?"Invoice Requested":"invoice_submitted"===e.status?"Invoice Submitted":e.status]}),a&&(0,s.jsxs)(N.Badge,{variant:"destructive",children:[(0,s.jsx)(i.AlertCircle,{className:"h-3 w-3 mr-1"}),"Overdue"]})]}),(0,s.jsx)("p",{className:"font-medium text-white",children:e.deal_name||"Direct commission"}),e.investor_name&&(0,s.jsxs)("p",{className:"text-sm text-gray-300",children:["Investor: ",e.investor_name]}),e.fee_plan_name&&(0,s.jsxs)("p",{className:"text-sm text-gray-400",children:["Fee Plan: ",e.fee_plan_name]}),(0,s.jsxs)("p",{className:"text-sm text-gray-400 mt-1",children:[(e.rate_bps/100).toFixed(2),"% of ",j(e.base_amount),e.payment_due_date&&(0,s.jsxs)("span",{className:"ml-2",children:["• Due: ",new Date(e.payment_due_date).toLocaleDateString()]})]}),e.notes&&(0,s.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:e.notes}),e.payment_reference&&(0,s.jsxs)("p",{className:"text-xs text-green-400 mt-1",children:["Payment ref: ",e.payment_reference]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2 ml-4",children:[(0,s.jsx)("div",{className:"text-right mr-4",children:(0,s.jsx)("p",{className:"text-xl font-bold text-white",children:j(e.accrual_amount)})}),(0,s.jsxs)("div",{className:"flex flex-col gap-2",children:["invoice_submitted"===e.status&&(0,s.jsx)(p.Button,{size:"sm",onClick:()=>b(e.id,e.entity_type),disabled:u===e.id,children:u===e.id?"Processing...":"Mark Invoiced"}),"invoiced"===e.status&&(0,s.jsx)(p.Button,{size:"sm",variant:"default",onClick:()=>y(e.id,e.entity_type),disabled:u===e.id,children:u===e.id?"Processing...":"Mark Paid"}),"paid"===e.status&&e.paid_at&&(0,s.jsxs)("p",{className:"text-xs text-green-400",children:["Paid ",new Date(e.paid_at).toLocaleDateString()]})]})]})]})},e.id)})})})]},`${e.entity_type}:${e.entity.id}`)})})]}):(0,s.jsx)("div",{className:"text-white",children:"Failed to load commissions data"})}e.s(["default",()=>ef],494335)}]);