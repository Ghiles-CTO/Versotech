(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,667498,e=>{"use strict";var s=e.i(722679),a=e.i(340915),t=e.i(90613),i=e.i(129432),r=e.i(316264),n=e.i(191569),l=e.i(816654),d=e.i(514133),c=e.i(429760),o=e.i(971743),m=e.i(773510),x=e.i(957114),u=e.i(871561),h=e.i(119311),p=e.i(981218),g=e.i(15098),f=e.i(645855),j=e.i(619324),y=e.i(691974),_=e.i(551544),b=e.i(263229),v=e.i(818798),N=e.i(553426),w=e.i(723628),C=e.i(695459),T=e.i(432598),D=e.i(857261),k=e.i(501259),E=e.i(762074),S=e.i(501495),B=e.i(282141),P=e.i(994500),F=e.i(337684),z=e.i(921294),L=e.i(835034),K=e.i(939322),U=e.i(738684),Y=e.i(396064),O=e.i(761722),M=e.i(554369),A=e.i(378710),R=e.i(401148),I=e.i(704477);let $=[{label:"Certificate of Incorporation",value:"certificate_of_incorporation"},{label:"FCA Authorization Letter / SEC Form ADV",value:"regulatory_license"},{label:"Professional Indemnity Insurance",value:"insurance_certificate"},{label:"AML/CTF Policy Document",value:"aml_policy"},{label:"Latest Financial Statements",value:"financial_statements"},{label:"Beneficial Ownership Declaration",value:"beneficial_ownership"},{label:"Proof of Registered Address",value:"proof_of_address"}],V=[{label:"ID / Passport",value:"passport_id"},{label:"Proof of Address (Utility Bill)",value:"utility_bill"}];function H({arrangerId:e,arrangerName:l,kycStatus:d}){let[c,o]=(0,a.useState)([]),[m,x]=(0,a.useState)([]),[u,f]=(0,a.useState)(!0),[j,y]=(0,a.useState)(null),[_,v]=(0,a.useState)(null),[N,w]=(0,a.useState)(!1),[C,T]=(0,a.useState)(d),[D,k]=(0,a.useState)("entity-level"),E=(0,a.useRef)({}),S=(0,a.useCallback)(async()=>{if(e){f(!0);try{let e=await fetch("/api/arrangers/me/documents");if(!e.ok)throw Error("Failed to fetch documents");let s=await e.json();o(s.documents||[]),x(s.members||[])}catch(e){console.error("Error fetching documents:",e),P.toast.error("Failed to load documents")}finally{f(!1)}}},[e]);(0,a.useEffect)(()=>{S()},[S]);let F=async(s,a,t)=>{if(e){if(s.size>0x3200000)return void P.toast.error("File size exceeds 50MB limit");if(!["application/pdf","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/msword","image/jpeg","image/png","image/webp","text/plain"].includes(s.type))return void P.toast.error("Invalid file type. Please upload PDF, DOC, DOCX, JPG, PNG, or TXT files");y(t?`${a}_${t}`:a);try{let e=new FormData;e.append("file",s),e.append("type",a),e.append("name",s.name.replace(/\.[^/.]+$/,"")),t&&"entity-level"!==t&&e.append("arranger_user_id",t);let i=await fetch("/api/arrangers/me/documents",{method:"POST",body:e});if(!i.ok){let e=await i.json();throw Error(e.error||"Upload failed")}let r=[...$,...V].find(e=>e.value===a)?.label||a;P.toast.success(`${r} uploaded successfully`),await S()}catch(e){console.error("Upload error:",e),P.toast.error(e.message||"Failed to upload document")}finally{y(null);let e=t?`${a}_${t}`:a;E.current[e]&&(E.current[e].value="")}}},z=async e=>{if(confirm(`Delete "${e.name}"? This action cannot be undone.`)){v(e.id);try{let s=await fetch(`/api/arrangers/me/documents/${e.id}`,{method:"DELETE"});if(!s.ok){let e=await s.json();throw Error(e.error||"Delete failed")}P.toast.success("Document deleted successfully"),await S()}catch(e){console.error("Delete error:",e),P.toast.error(e.message||"Failed to delete document")}finally{v(null)}}},L=async e=>{try{let s=await fetch(`/api/documents/${e.id}/download`);if(!s.ok)throw Error("Download failed");let a=await s.blob(),t=window.URL.createObjectURL(a),i=document.createElement("a");i.href=t,i.download=e.file_name||e.name,document.body.appendChild(i),i.click(),window.URL.revokeObjectURL(t),document.body.removeChild(i),P.toast.success("Document downloaded")}catch(e){console.error("Download error:",e),P.toast.error("Failed to download document")}},K=e=>e?e<1024?`${e} B`:e<1048576?`${(e/1024).toFixed(1)} KB`:`${(e/1048576).toFixed(1)} MB`:"Unknown size",U=e=>new Date(e).toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"numeric"}),H=c.filter(e=>$.some(s=>s.value===e.type)).length,G=Math.round(H/$.length*100),X=async()=>{w(!0);try{let e=await fetch("/api/arrangers/me/kyc-submission",{method:"POST",headers:{"Content-Type":"application/json"}}),s=await e.json();if(!e.ok)return void(s.details?.missing?P.toast.error(`Missing documents: ${s.details.missing.join(", ")}`):P.toast.error(s.error||"Failed to submit KYC"));T("pending"),P.toast.success("KYC documents submitted for review!")}catch(e){console.error("KYC submission error:",e),P.toast.error("Failed to submit KYC")}finally{w(!1)}},q=100===G&&"approved"!==C&&"pending"!==C;return(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)(t.Card,{children:[(0,s.jsx)(t.CardHeader,{className:"pb-3",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("div",{className:(0,B.cn)("h-10 w-10 rounded-full flex items-center justify-center",100===G?"bg-green-100":"bg-blue-100"),children:(0,s.jsx)(p.Shield,{className:(0,B.cn)("h-5 w-5",100===G?"text-green-600":"text-blue-600")})}),(0,s.jsxs)("div",{children:[(0,s.jsx)(t.CardTitle,{children:"KYC Documents"}),(0,s.jsx)(t.CardDescription,{children:l?`Compliance documents for ${l}`:"Upload required compliance documents"})]})]}),(0,s.jsxs)("div",{className:"text-right",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsxs)("span",{className:"text-2xl font-bold text-foreground",children:[H,"/",$.length]}),C&&(0,s.jsxs)(i.Badge,{variant:"outline",className:(0,B.cn)("capitalize",(e=>{switch(e){case"approved":return"bg-green-100 text-green-800 border-green-200";case"pending":case"pending_review":return"bg-yellow-100 text-yellow-800 border-yellow-200";case"rejected":return"bg-red-100 text-red-800 border-red-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}})(C)),children:["KYC: ",C.replace("_"," ")]})]}),(0,s.jsxs)("div",{className:"text-sm text-muted-foreground mt-1",children:[G,"% complete"]})]})]})}),(0,s.jsxs)(t.CardContent,{children:[(0,s.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2.5",children:(0,s.jsx)("div",{className:(0,B.cn)("h-2.5 rounded-full transition-all duration-500",100===G?"bg-green-500":G>=50?"bg-yellow-500":"bg-blue-500"),style:{width:`${G}%`}})}),G<100&&(0,s.jsx)("p",{className:"text-xs text-muted-foreground mt-2",children:"Upload all required documents to complete KYC verification"}),100===G&&(0,s.jsx)("div",{className:"mt-4 pt-4 border-t",children:"pending"===C?(0,s.jsxs)("div",{className:"flex items-center gap-2 text-yellow-700 bg-yellow-50 px-4 py-3 rounded-lg",children:[(0,s.jsx)(b.Loader2,{className:"h-4 w-4 animate-spin"}),(0,s.jsx)("span",{className:"text-sm font-medium",children:"KYC documents are being reviewed..."})]}):"approved"===C?(0,s.jsxs)("div",{className:"flex items-center gap-2 text-green-700 bg-green-50 px-4 py-3 rounded-lg",children:[(0,s.jsx)(g.CheckCircle2,{className:"h-4 w-4"}),(0,s.jsx)("span",{className:"text-sm font-medium",children:"KYC verification complete"})]}):(0,s.jsx)(r.Button,{onClick:X,disabled:N||!q,className:"w-full",children:N?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(b.Loader2,{className:"h-4 w-4 mr-2 animate-spin"}),"Submitting..."]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(p.Shield,{className:"h-4 w-4 mr-2"}),"Submit for Approval"]})})})]})]}),(0,s.jsxs)(t.Card,{children:[(0,s.jsxs)(t.CardHeader,{children:[(0,s.jsx)(t.CardTitle,{className:"text-base",children:"Required Documents"}),(0,s.jsx)(t.CardDescription,{children:"These documents are required for regulatory compliance and KYC verification"})]}),(0,s.jsx)(t.CardContent,{children:u?(0,s.jsx)("div",{className:"flex items-center justify-center py-8",children:(0,s.jsx)(b.Loader2,{className:"h-6 w-6 animate-spin text-muted-foreground"})}):(0,s.jsx)("div",{className:"space-y-3",children:$.map(e=>{let a=c.find(s=>s.type===e.value),t=j===e.value,i=_===a?.id;return(0,s.jsxs)("div",{className:(0,B.cn)("flex items-center justify-between gap-4 py-3 px-4 rounded-lg border transition-colors",a?"border-green-200 bg-green-50/50":"border-gray-200 hover:bg-gray-50"),children:[(0,s.jsxs)("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[a?(0,s.jsx)(g.CheckCircle2,{className:"h-5 w-5 text-green-600 flex-shrink-0"}):(0,s.jsx)(A.Circle,{className:"h-5 w-5 text-muted-foreground flex-shrink-0"}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsx)("p",{className:"text-sm font-medium text-foreground truncate",children:e.label}),a&&(0,s.jsxs)("p",{className:"text-xs text-muted-foreground truncate",children:[a.file_name," • ",K(a.file_size_bytes)," • ",U(a.created_at)]})]})]}),(0,s.jsx)("div",{className:"flex items-center gap-2 flex-shrink-0",children:a?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(r.Button,{variant:"ghost",size:"sm",onClick:()=>L(a),className:"h-8 w-8 p-0",title:"Download",children:(0,s.jsx)(O.Download,{className:"h-4 w-4"})}),(0,s.jsx)(r.Button,{variant:"ghost",size:"sm",onClick:()=>z(a),disabled:i,className:"h-8 w-8 p-0 text-red-600 hover:text-red-700 hover:bg-red-50",title:"Delete",children:i?(0,s.jsx)(b.Loader2,{className:"h-4 w-4 animate-spin"}):(0,s.jsx)(M.Trash2,{className:"h-4 w-4"})})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.Input,{ref:s=>{E.current[e.value]=s},type:"file",className:"hidden",accept:".pdf,.doc,.docx,.jpg,.jpeg,.png,.webp,.txt",onChange:s=>{let a=s.target.files?.[0];a&&F(a,e.value)},disabled:t}),(0,s.jsxs)(r.Button,{variant:"outline",size:"sm",onClick:()=>E.current[e.value]?.click(),disabled:t,children:[t?(0,s.jsx)(b.Loader2,{className:"h-4 w-4 mr-2 animate-spin"}):(0,s.jsx)(Y.Upload,{className:"h-4 w-4 mr-2"}),"Upload"]})]})})]},e.value)})})})]}),m.length>0&&(0,s.jsxs)(t.Card,{children:[(0,s.jsxs)(t.CardHeader,{children:[(0,s.jsxs)(t.CardTitle,{className:"text-base flex items-center gap-2",children:[(0,s.jsx)(I.User,{className:"h-5 w-5"}),"Member KYC Documents"]}),(0,s.jsx)(t.CardDescription,{children:"Upload ID and Proof of Address for each member/director. Required for full KYC compliance."})]}),(0,s.jsx)(t.CardContent,{className:"space-y-6",children:m.map(e=>{let a=c.filter(s=>s.arranger_user_id===e.id);return(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 pb-2 border-b",children:[(0,s.jsx)(I.User,{className:"h-4 w-4 text-muted-foreground"}),(0,s.jsx)("span",{className:"font-medium text-sm",children:e.full_name}),(0,s.jsx)(i.Badge,{variant:"outline",className:"capitalize text-xs",children:e.role}),e.is_primary&&(0,s.jsx)(i.Badge,{variant:"secondary",className:"text-xs",children:"Primary"})]}),V.map(t=>{let i=a.find(e=>e.type===t.value),l=`${t.value}_${e.id}`,d=j===l,c=_===i?.id;return(0,s.jsxs)("div",{className:(0,B.cn)("flex items-center justify-between gap-4 py-2 px-3 rounded-lg border transition-colors ml-6",i?"border-green-200 bg-green-50/50":"border-gray-200 hover:bg-gray-50"),children:[(0,s.jsxs)("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[i?(0,s.jsx)(g.CheckCircle2,{className:"h-4 w-4 text-green-600 flex-shrink-0"}):(0,s.jsx)(A.Circle,{className:"h-4 w-4 text-muted-foreground flex-shrink-0"}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsx)("p",{className:"text-sm font-medium text-foreground truncate",children:t.label}),i&&(0,s.jsxs)("p",{className:"text-xs text-muted-foreground truncate",children:[i.file_name," • ",K(i.file_size_bytes)," • ",U(i.created_at)]})]})]}),(0,s.jsx)("div",{className:"flex items-center gap-2 flex-shrink-0",children:i?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(r.Button,{variant:"ghost",size:"sm",onClick:()=>L(i),className:"h-7 w-7 p-0",title:"Download",children:(0,s.jsx)(O.Download,{className:"h-3.5 w-3.5"})}),(0,s.jsx)(r.Button,{variant:"ghost",size:"sm",onClick:()=>z(i),disabled:c,className:"h-7 w-7 p-0 text-red-600 hover:text-red-700 hover:bg-red-50",title:"Delete",children:c?(0,s.jsx)(b.Loader2,{className:"h-3.5 w-3.5 animate-spin"}):(0,s.jsx)(M.Trash2,{className:"h-3.5 w-3.5"})})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.Input,{ref:e=>{E.current[l]=e},type:"file",className:"hidden",accept:".pdf,.doc,.docx,.jpg,.jpeg,.png,.webp",onChange:s=>{let a=s.target.files?.[0];a&&F(a,t.value,e.id)},disabled:d}),(0,s.jsxs)(r.Button,{variant:"outline",size:"sm",onClick:()=>E.current[l]?.click(),disabled:d,className:"h-7 text-xs",children:[d?(0,s.jsx)(b.Loader2,{className:"h-3.5 w-3.5 mr-1 animate-spin"}):(0,s.jsx)(Y.Upload,{className:"h-3.5 w-3.5 mr-1"}),"Upload"]})]})})]},l)})]},e.id)})})]}),c.filter(e=>!$.some(s=>s.value===e.type)&&!V.some(s=>s.value===e.type)).length>0&&(0,s.jsxs)(t.Card,{children:[(0,s.jsxs)(t.CardHeader,{children:[(0,s.jsx)(t.CardTitle,{className:"text-base",children:"Additional Documents"}),(0,s.jsx)(t.CardDescription,{children:"Other documents uploaded for compliance"})]}),(0,s.jsx)(t.CardContent,{children:(0,s.jsx)("div",{className:"space-y-2",children:c.filter(e=>!$.some(s=>s.value===e.type)).map(e=>(0,s.jsxs)("div",{className:"flex items-center justify-between gap-4 py-2 px-3 rounded-lg border hover:bg-gray-50 transition-colors",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[(0,s.jsx)(h.FileText,{className:"h-5 w-5 text-muted-foreground flex-shrink-0"}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsx)("p",{className:"text-sm font-medium text-foreground truncate",children:e.name}),(0,s.jsxs)("p",{className:"text-xs text-muted-foreground truncate",children:[e.type," • ",K(e.file_size_bytes)," • ",U(e.created_at)]})]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2 flex-shrink-0",children:[(0,s.jsx)(r.Button,{variant:"ghost",size:"sm",onClick:()=>L(e),className:"h-8 w-8 p-0",children:(0,s.jsx)(O.Download,{className:"h-4 w-4"})}),(0,s.jsx)(r.Button,{variant:"ghost",size:"sm",onClick:()=>z(e),disabled:_===e.id,className:"h-8 w-8 p-0 text-red-600 hover:text-red-700 hover:bg-red-50",children:_===e.id?(0,s.jsx)(b.Loader2,{className:"h-4 w-4 animate-spin"}):(0,s.jsx)(M.Trash2,{className:"h-4 w-4"})})]})]},e.id))})})]}),(0,s.jsx)(t.Card,{className:"bg-blue-50/50 border-blue-200",children:(0,s.jsx)(t.CardContent,{className:"py-4",children:(0,s.jsxs)("div",{className:"flex gap-3",children:[(0,s.jsx)(R.AlertCircle,{className:"h-5 w-5 text-blue-600 flex-shrink-0 mt-0.5"}),(0,s.jsxs)("div",{className:"text-sm space-y-1",children:[(0,s.jsx)("p",{className:"font-medium text-blue-900",children:"Document Requirements"}),(0,s.jsxs)("ul",{className:"text-blue-700 space-y-0.5",children:[(0,s.jsx)("li",{children:"• Supported formats: PDF, DOC, DOCX, JPG, PNG, TXT"}),(0,s.jsx)("li",{children:"• Maximum file size: 50MB per file"}),(0,s.jsx)("li",{children:"• Documents must be current and valid"}),(0,s.jsx)("li",{children:"• VERSO staff will review your documents for KYC approval"})]})]})]})})})]})}var G=e.i(695891),X=e.i(666123),q=e.i(437800);e.i(227041);var J=e.i(465914),W=e.i(152370),Q=e.i(1694);let Z={approved:"bg-green-100 text-green-800 border-green-200",pending:"bg-yellow-100 text-yellow-800 border-yellow-200",pending_review:"bg-yellow-100 text-yellow-800 border-yellow-200",rejected:"bg-red-100 text-red-800 border-red-200",expired:"bg-red-100 text-red-800 border-red-200",not_started:"bg-gray-100 text-gray-800 border-gray-200"},ee={active:"bg-green-100 text-green-800 border-green-200",inactive:"bg-gray-100 text-gray-800 border-gray-200",suspended:"bg-red-100 text-red-800 border-red-200"};function es({label:e,value:a,field:t,isEditing:i,editValue:r,onChange:c,type:o="text",multiline:m=!1,icon:x,className:u}){return i?(0,s.jsxs)("div",{className:(0,B.cn)("space-y-1.5",u),children:[(0,s.jsx)(d.Label,{htmlFor:t,className:"text-sm font-medium text-muted-foreground",children:e}),m?(0,s.jsx)(l.Textarea,{id:t,value:r,onChange:e=>c(t,e.target.value),placeholder:`Enter ${e.toLowerCase()}`,rows:3,className:"mt-1"}):(0,s.jsx)(n.Input,{id:t,type:o,value:r,onChange:e=>c(t,e.target.value),placeholder:`Enter ${e.toLowerCase()}`,className:"mt-1"})]}):(0,s.jsxs)("div",{className:(0,B.cn)("flex items-start gap-3",u),children:[x&&(0,s.jsx)(x,{className:"h-5 w-5 text-muted-foreground mt-0.5 flex-shrink-0"}),(0,s.jsxs)("div",{className:"min-w-0",children:[(0,s.jsx)("label",{className:"text-sm font-medium text-muted-foreground",children:e}),(0,s.jsx)("p",{className:(0,B.cn)("text-foreground mt-1","date"===o||t.includes("number")||t.includes("id")?"font-mono":"",m&&"whitespace-pre-line"),children:a||(0,s.jsx)("span",{className:"text-muted-foreground italic",children:"Not set"})})]})]})}function ea({userEmail:e,profile:n,arrangerInfo:l,arrangerUserInfo:d,dealCount:Y}){let[O,M]=(0,a.useState)(l),[A,R]=(0,a.useState)(!1),[I,$]=(0,a.useState)(!1),[V,ea]=(0,a.useState)(!1),[et,ei]=(0,a.useState)(!1),[er,en]=(0,a.useState)(!1),[el,ed]=(0,a.useState)(!1),[ec,eo]=(0,a.useState)(!1),em=(0,a.useRef)(null),[ex,eu]=(0,a.useState)({legal_name:O?.legal_name||"",registration_number:O?.registration_number||"",tax_id:O?.tax_id||""}),[eh,ep]=(0,a.useState)({regulator:O?.regulator||"",license_number:O?.license_number||"",license_type:O?.license_type||"",license_expiry_date:O?.license_expiry_date||""}),[eg,ef]=(0,a.useState)({email:O?.email||"",phone:O?.phone||"",address:O?.address||""});if(!O)return(0,s.jsx)("div",{className:"p-6",children:(0,s.jsxs)("div",{className:"text-center py-16",children:[(0,s.jsx)(o.Building2,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),(0,s.jsx)("h3",{className:"text-lg font-medium text-foreground mb-2",children:"Arranger Profile Not Found"}),(0,s.jsx)("p",{className:"text-muted-foreground",children:"Unable to load your arranger profile. Please contact support."})]})});let ej=()=>{if(!O.license_expiry_date)return!1;let e=new Date(O.license_expiry_date),s=new Date;return s.setDate(s.getDate()+30),e<=s&&e>new Date},ey=()=>!!O.license_expiry_date&&new Date(O.license_expiry_date)<new Date,e_=async()=>{ei(!0);try{let e=await fetch("/api/arrangers/me/profile",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(ex)});if(!e.ok){let s=await e.json();throw Error(s.error||"Failed to save")}M(e=>e?{...e,...ex}:null),R(!1),P.toast.success("Entity details updated successfully")}catch(e){console.error("Error saving entity:",e),P.toast.error(e.message||"Failed to save entity details")}finally{ei(!1)}},eb=async()=>{ei(!0);try{let e=await fetch("/api/arrangers/me/profile",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(eh)});if(!e.ok){let s=await e.json();throw Error(s.error||"Failed to save")}M(e=>e?{...e,...eh}:null),$(!1),P.toast.success("Regulatory information updated successfully")}catch(e){console.error("Error saving regulatory:",e),P.toast.error(e.message||"Failed to save regulatory information")}finally{ei(!1)}},ev=async()=>{ei(!0);try{let e=await fetch("/api/arrangers/me/profile",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(eg)});if(!e.ok){let s=await e.json();throw Error(s.error||"Failed to save")}M(e=>e?{...e,...eg}:null),ea(!1),P.toast.success("Contact information updated successfully")}catch(e){console.error("Error saving contact:",e),P.toast.error(e.message||"Failed to save contact information")}finally{ei(!1)}},eN=async e=>{let s=e.target.files?.[0];if(s){if(!["image/png","image/jpeg","image/webp"].includes(s.type))return void P.toast.error("Please upload a PNG, JPEG, or WebP image");if(s.size>2097152)return void P.toast.error("File size must be less than 2MB");en(!0);try{let e=new FormData;e.append("logo",s);let a=await fetch("/api/arrangers/me/logo",{method:"POST",body:e});if(!a.ok){let e=await a.json();throw Error(e.error||"Failed to upload logo")}let t=await a.json();M(e=>e?{...e,logo_url:t.logo_url}:null),P.toast.success("Logo uploaded successfully")}catch(e){console.error("Error uploading logo:",e),P.toast.error(e.message||"Failed to upload logo")}finally{en(!1),em.current&&(em.current.value="")}}};return(0,s.jsxs)("div",{className:"p-6 space-y-6 max-w-6xl mx-auto",children:[(0,s.jsxs)("div",{className:"flex items-start justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[(0,s.jsxs)("div",{className:"relative h-16 w-16 rounded-xl bg-primary/10 flex items-center justify-center cursor-pointer group overflow-hidden",onClick:()=>em.current?.click(),children:[O.logo_url?(0,s.jsx)(F.default,{src:O.logo_url,alt:O.legal_name,fill:!0,className:"object-cover"}):(0,s.jsx)(o.Building2,{className:"h-8 w-8 text-primary"}),(0,s.jsx)("div",{className:"absolute inset-0 bg-black/50 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity",children:er?(0,s.jsx)(b.Loader2,{className:"h-5 w-5 text-white animate-spin"}):(0,s.jsx)(D.Camera,{className:"h-5 w-5 text-white"})}),(0,s.jsx)("input",{ref:em,type:"file",accept:"image/png,image/jpeg,image/webp",className:"hidden",onChange:eN,disabled:er})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-2xl font-bold text-foreground",children:O.legal_name}),(0,s.jsxs)("p",{className:"text-muted-foreground",children:[n?.full_name||e," - ",d.role||"Member"]})]})]}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)(i.Badge,{variant:"outline",className:(0,B.cn)("capitalize",ee[O.status]||ee.inactive),children:O.status}),(0,s.jsxs)(i.Badge,{variant:"outline",className:(0,B.cn)("capitalize",Z[O.kyc_status]||Z.not_started),children:["KYC: ",O.kyc_status?.replace("_"," ")]})]})]}),ej()&&(0,s.jsx)(t.Card,{className:"border-amber-500/30 bg-amber-50/50",children:(0,s.jsx)(t.CardContent,{className:"py-4",children:(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)(j.AlertTriangle,{className:"h-5 w-5 text-amber-600"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"font-medium text-foreground",children:"License Expiring Soon"}),(0,s.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Your license expires on ",(0,S.formatDate)(O.license_expiry_date),". Please renew before expiry."]})]})]})})}),ey()&&(0,s.jsx)(t.Card,{className:"border-red-500/30 bg-red-50/50",children:(0,s.jsx)(t.CardContent,{className:"py-4",children:(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)(j.AlertTriangle,{className:"h-5 w-5 text-red-600"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"font-medium text-foreground",children:"License Expired"}),(0,s.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Your license expired on ",(0,S.formatDate)(O.license_expiry_date),". Please contact VERSO to renew."]})]})]})})}),"pending"===O.kyc_status&&(0,s.jsx)(t.Card,{className:"border-blue-500/30 bg-blue-50/50",children:(0,s.jsx)(t.CardContent,{className:"py-4",children:(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)(f.Clock,{className:"h-5 w-5 text-blue-600"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"font-medium text-foreground",children:"KYC Verification Pending"}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"Your KYC documents are being reviewed. This usually takes 1-2 business days."})]})]})})}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,s.jsxs)(t.Card,{children:[(0,s.jsx)(t.CardHeader,{className:"pb-2",children:(0,s.jsxs)(t.CardTitle,{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[(0,s.jsx)(y.Briefcase,{className:"h-4 w-4"}),"Mandates"]})}),(0,s.jsxs)(t.CardContent,{children:[(0,s.jsx)("div",{className:"text-2xl font-bold",children:Y}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Deals managed"})]})]}),(0,s.jsxs)(t.Card,{children:[(0,s.jsx)(t.CardHeader,{className:"pb-2",children:(0,s.jsxs)(t.CardTitle,{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[(0,s.jsx)(p.Shield,{className:"h-4 w-4"}),"KYC Status"]})}),(0,s.jsxs)(t.CardContent,{children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:["approved"===O.kyc_status?(0,s.jsx)(g.CheckCircle2,{className:"h-5 w-5 text-green-600"}):"pending"===O.kyc_status?(0,s.jsx)(f.Clock,{className:"h-5 w-5 text-yellow-600"}):(0,s.jsx)(j.AlertTriangle,{className:"h-5 w-5 text-red-600"}),(0,s.jsx)("span",{className:"text-lg font-semibold capitalize",children:O.kyc_status?.replace("_"," ")})]}),O.kyc_approved_at&&(0,s.jsxs)("p",{className:"text-xs text-muted-foreground mt-1",children:["Approved ",(0,S.formatDate)(O.kyc_approved_at)]})]})]}),(0,s.jsxs)(t.Card,{children:[(0,s.jsx)(t.CardHeader,{className:"pb-2",children:(0,s.jsxs)(t.CardTitle,{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[(0,s.jsx)(h.FileText,{className:"h-4 w-4"}),"License"]})}),(0,s.jsxs)(t.CardContent,{children:[(0,s.jsx)("div",{className:"text-lg font-semibold",children:O.license_type||"Not specified"}),O.license_expiry_date&&(0,s.jsxs)("p",{className:(0,B.cn)("text-xs mt-1",ey()?"text-red-600 font-medium":ej()?"text-amber-600 font-medium":"text-muted-foreground"),children:["Expires ",(0,S.formatDate)(O.license_expiry_date)]})]})]})]}),(0,s.jsxs)(c.Tabs,{defaultValue:"details",className:"space-y-4",id:"arranger-profile-tabs",children:[(0,s.jsxs)(c.TabsList,{className:"grid w-full grid-cols-5 md:grid-cols-9 h-auto p-1 gap-1",children:[(0,s.jsxs)(c.TabsTrigger,{value:"details",className:"flex items-center gap-2 text-xs sm:text-sm",children:[(0,s.jsx)(o.Building2,{className:"h-4 w-4"}),(0,s.jsx)("span",{className:"hidden sm:inline",children:"Entity"})]}),(0,s.jsxs)(c.TabsTrigger,{value:"members",className:"flex items-center gap-2 text-xs sm:text-sm",children:[(0,s.jsx)(k.Users,{className:"h-4 w-4"}),(0,s.jsx)("span",{className:"hidden sm:inline",children:"Members"})]}),(0,s.jsxs)(c.TabsTrigger,{value:"entity-members",className:"flex items-center gap-2 text-xs sm:text-sm",children:[(0,s.jsx)(k.Users,{className:"h-4 w-4"}),(0,s.jsx)("span",{className:"hidden sm:inline",children:"Directors/UBOs"})]}),(0,s.jsxs)(c.TabsTrigger,{value:"regulatory",className:"flex items-center gap-2 text-xs sm:text-sm",children:[(0,s.jsx)(h.FileText,{className:"h-4 w-4"}),(0,s.jsx)("span",{className:"hidden sm:inline",children:"Regulatory"})]}),(0,s.jsxs)(c.TabsTrigger,{value:"contact",className:"flex items-center gap-2 text-xs sm:text-sm",children:[(0,s.jsx)(m.Mail,{className:"h-4 w-4"}),(0,s.jsx)("span",{className:"hidden sm:inline",children:"Contact"})]}),(0,s.jsxs)(c.TabsTrigger,{value:"documents",className:"flex items-center gap-2 text-xs sm:text-sm",children:[(0,s.jsx)(p.Shield,{className:"h-4 w-4"}),(0,s.jsx)("span",{className:"hidden sm:inline",children:"KYC"})]}),(0,s.jsxs)(c.TabsTrigger,{value:"signature",className:"flex items-center gap-2 text-xs sm:text-sm",children:[(0,s.jsx)(v.PenTool,{className:"h-4 w-4"}),(0,s.jsx)("span",{className:"hidden sm:inline",children:"Signature"})]}),(0,s.jsxs)(c.TabsTrigger,{value:"security",className:"flex items-center gap-2 text-xs sm:text-sm",children:[(0,s.jsx)(N.Lock,{className:"h-4 w-4"}),(0,s.jsx)("span",{className:"hidden sm:inline",children:"Security"})]}),(0,s.jsxs)(c.TabsTrigger,{value:"preferences",className:"flex items-center gap-2 text-xs sm:text-sm",children:[(0,s.jsx)(w.Settings,{className:"h-4 w-4"}),(0,s.jsx)("span",{className:"hidden sm:inline",children:"Preferences"})]}),(0,s.jsxs)(c.TabsTrigger,{value:"privacy",className:"flex items-center gap-2 text-xs sm:text-sm",children:[(0,s.jsx)(p.Shield,{className:"h-4 w-4"}),(0,s.jsx)("span",{className:"hidden sm:inline",children:"Privacy"})]}),(0,s.jsxs)(c.TabsTrigger,{value:"notices",className:"flex items-center gap-2 text-xs sm:text-sm",children:[(0,s.jsx)(E.Bell,{className:"h-4 w-4"}),(0,s.jsx)("span",{className:"hidden sm:inline",children:"Notices"})]})]}),(0,s.jsxs)(c.TabsContent,{value:"details",children:[(0,s.jsxs)(t.Card,{children:[(0,s.jsx)(t.CardHeader,{children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(t.CardTitle,{children:"Entity Details"}),(0,s.jsx)(t.CardDescription,{children:"Legal and registration information"})]}),A?(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsxs)(r.Button,{variant:"outline",size:"sm",onClick:()=>{eu({legal_name:O.legal_name||"",registration_number:O.registration_number||"",tax_id:O.tax_id||""}),R(!1)},disabled:et,children:[(0,s.jsx)(T.X,{className:"h-4 w-4 mr-2"}),"Cancel"]}),(0,s.jsxs)(r.Button,{size:"sm",onClick:e_,disabled:et,children:[et?(0,s.jsx)(b.Loader2,{className:"h-4 w-4 mr-2 animate-spin"}):(0,s.jsx)(C.Save,{className:"h-4 w-4 mr-2"}),"Save"]})]}):(0,s.jsxs)(r.Button,{variant:"outline",size:"sm",onClick:()=>R(!0),children:[(0,s.jsx)(_.Edit,{className:"h-4 w-4 mr-2"}),"Edit"]})]})}),(0,s.jsx)(t.CardContent,{className:"space-y-4",children:(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,s.jsx)(es,{label:"Legal Name",value:O.legal_name,field:"legal_name",isEditing:A,editValue:ex.legal_name,onChange:(e,s)=>eu(e=>({...e,legal_name:s}))}),(0,s.jsx)(es,{label:"Registration Number",value:O.registration_number,field:"registration_number",isEditing:A,editValue:ex.registration_number,onChange:(e,s)=>eu(e=>({...e,registration_number:s}))}),(0,s.jsx)(es,{label:"Tax ID",value:O.tax_id,field:"tax_id",isEditing:A,editValue:ex.tax_id,onChange:(e,s)=>eu(e=>({...e,tax_id:s}))}),O.created_at&&!A&&(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-sm font-medium text-muted-foreground",children:"Member Since"}),(0,s.jsx)("p",{className:"text-foreground mt-1",children:(0,S.formatDate)(O.created_at)})]})]})})]}),"individual"===O.type&&(0,s.jsx)(Q.IndividualKycDisplay,{data:{first_name:O.first_name,middle_name:O.middle_name,last_name:O.last_name,name_suffix:O.name_suffix,date_of_birth:O.date_of_birth,country_of_birth:O.country_of_birth,nationality:O.nationality,email:O.email,phone_mobile:O.phone_mobile,phone_office:O.phone_office,residential_street:O.residential_street,residential_line_2:O.residential_line_2,residential_city:O.residential_city,residential_state:O.residential_state,residential_postal_code:O.residential_postal_code,residential_country:O.residential_country,is_us_citizen:O.is_us_citizen,is_us_taxpayer:O.is_us_taxpayer,us_taxpayer_id:O.us_taxpayer_id,country_of_tax_residency:O.country_of_tax_residency,id_type:O.id_type,id_number:O.id_number,id_issue_date:O.id_issue_date,id_expiry_date:O.id_expiry_date,id_issuing_country:O.id_issuing_country},onEdit:()=>ed(!0),title:"Personal KYC Information",className:"mt-6"})]}),(0,s.jsx)(c.TabsContent,{value:"members",children:(0,s.jsx)(G.MembersManagementTab,{entityType:"arranger",entityId:O.id,entityName:O.legal_name,showSignatoryOption:!0})}),(0,s.jsx)(c.TabsContent,{value:"entity-members",children:(0,s.jsx)(X.GenericEntityMembersTab,{entityType:"arranger",entityId:O.id,entityName:O.legal_name,apiEndpoint:"/api/arrangers/me/members",canManage:"admin"===d.role,title:"Directors, UBOs & Signatories",description:"Manage directors, beneficial owners (>25% ownership), and authorized signatories with full KYC information."})}),(0,s.jsx)(c.TabsContent,{value:"regulatory",children:(0,s.jsxs)(t.Card,{children:[(0,s.jsx)(t.CardHeader,{children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(t.CardTitle,{children:"Regulatory Information"}),(0,s.jsx)(t.CardDescription,{children:"Licensing and compliance details"})]}),I?(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsxs)(r.Button,{variant:"outline",size:"sm",onClick:()=>{ep({regulator:O.regulator||"",license_number:O.license_number||"",license_type:O.license_type||"",license_expiry_date:O.license_expiry_date||""}),$(!1)},disabled:et,children:[(0,s.jsx)(T.X,{className:"h-4 w-4 mr-2"}),"Cancel"]}),(0,s.jsxs)(r.Button,{size:"sm",onClick:eb,disabled:et,children:[et?(0,s.jsx)(b.Loader2,{className:"h-4 w-4 mr-2 animate-spin"}):(0,s.jsx)(C.Save,{className:"h-4 w-4 mr-2"}),"Save"]})]}):(0,s.jsxs)(r.Button,{variant:"outline",size:"sm",onClick:()=>$(!0),children:[(0,s.jsx)(_.Edit,{className:"h-4 w-4 mr-2"}),"Edit"]})]})}),(0,s.jsxs)(t.CardContent,{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,s.jsx)(es,{label:"Regulator",value:O.regulator,field:"regulator",isEditing:I,editValue:eh.regulator,onChange:(e,s)=>ep(e=>({...e,regulator:s}))}),(0,s.jsx)(es,{label:"License Number",value:O.license_number,field:"license_number",isEditing:I,editValue:eh.license_number,onChange:(e,s)=>ep(e=>({...e,license_number:s}))}),(0,s.jsx)(es,{label:"License Type",value:O.license_type,field:"license_type",isEditing:I,editValue:eh.license_type,onChange:(e,s)=>ep(e=>({...e,license_type:s}))}),(0,s.jsx)(es,{label:"License Expiry",value:O.license_expiry_date?(0,S.formatDate)(O.license_expiry_date):null,field:"license_expiry_date",isEditing:I,editValue:eh.license_expiry_date,onChange:(e,s)=>ep(e=>({...e,license_expiry_date:s})),type:"date"})]}),(0,s.jsxs)("div",{className:"border-t pt-4 mt-4",children:[(0,s.jsx)("h4",{className:"font-medium text-foreground mb-3",children:"KYC Verification (Read-only)"}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-sm font-medium text-muted-foreground",children:"Status"}),(0,s.jsx)("div",{className:"flex items-center gap-2 mt-1",children:(0,s.jsx)(i.Badge,{variant:"outline",className:(0,B.cn)("capitalize",Z[O.kyc_status]||Z.not_started),children:O.kyc_status?.replace("_"," ")})})]}),O.kyc_approved_at&&(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-sm font-medium text-muted-foreground",children:"Approved Date"}),(0,s.jsx)("p",{className:"text-foreground mt-1",children:(0,S.formatDate)(O.kyc_approved_at)})]}),O.kyc_expires_at&&(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-sm font-medium text-muted-foreground",children:"KYC Expiry"}),(0,s.jsx)("p",{className:(0,B.cn)("mt-1",(()=>{if(!O.kyc_expires_at)return!1;let e=new Date(O.kyc_expires_at),s=new Date;return s.setDate(s.getDate()+30),e<=s&&e>new Date})()?"text-amber-600 font-medium":"text-foreground"),children:(0,S.formatDate)(O.kyc_expires_at)})]})]})]})]})]})}),(0,s.jsx)(c.TabsContent,{value:"contact",children:(0,s.jsxs)(t.Card,{children:[(0,s.jsx)(t.CardHeader,{children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(t.CardTitle,{children:"Contact Information"}),(0,s.jsx)(t.CardDescription,{children:"How to reach the arranger entity"})]}),V?(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsxs)(r.Button,{variant:"outline",size:"sm",onClick:()=>{ef({email:O.email||"",phone:O.phone||"",address:O.address||""}),ea(!1)},disabled:et,children:[(0,s.jsx)(T.X,{className:"h-4 w-4 mr-2"}),"Cancel"]}),(0,s.jsxs)(r.Button,{size:"sm",onClick:ev,disabled:et,children:[et?(0,s.jsx)(b.Loader2,{className:"h-4 w-4 mr-2 animate-spin"}):(0,s.jsx)(C.Save,{className:"h-4 w-4 mr-2"}),"Save"]})]}):(0,s.jsxs)(r.Button,{variant:"outline",size:"sm",onClick:()=>ea(!0),children:[(0,s.jsx)(_.Edit,{className:"h-4 w-4 mr-2"}),"Edit"]})]})}),(0,s.jsxs)(t.CardContent,{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,s.jsx)(es,{label:"Email",value:O.email,field:"email",isEditing:V,editValue:eg.email,onChange:(e,s)=>ef(e=>({...e,email:s})),type:"email",icon:V?void 0:m.Mail}),(0,s.jsx)(es,{label:"Phone",value:O.phone,field:"phone",isEditing:V,editValue:eg.phone,onChange:(e,s)=>ef(e=>({...e,phone:s})),type:"tel",icon:V?void 0:x.Phone}),(0,s.jsx)(es,{label:"Address",value:O.address,field:"address",isEditing:V,editValue:eg.address,onChange:(e,s)=>ef(e=>({...e,address:s})),multiline:!0,icon:V?void 0:u.MapPin,className:"md:col-span-2"})]}),!O.email&&!O.phone&&!O.address&&!V&&(0,s.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:"No contact information on file. Click Edit to add."})]})]})}),(0,s.jsx)(c.TabsContent,{value:"documents",children:(0,s.jsx)(H,{arrangerId:O.id,arrangerName:O.legal_name,kycStatus:O.kyc_status})}),(0,s.jsx)(c.TabsContent,{value:"signature",children:(0,s.jsx)(z.SignatureSpecimenTab,{})}),(0,s.jsx)(c.TabsContent,{value:"security",children:(0,s.jsxs)(t.Card,{children:[(0,s.jsxs)(t.CardHeader,{children:[(0,s.jsx)(t.CardTitle,{children:"Security Settings"}),(0,s.jsx)(t.CardDescription,{children:"Manage your account security and password"})]}),(0,s.jsx)(t.CardContent,{children:(0,s.jsx)(L.PasswordChangeForm,{})})]})}),(0,s.jsx)(c.TabsContent,{value:"preferences",children:(0,s.jsx)(K.PreferencesEditor,{variant:"arranger"})}),(0,s.jsx)(c.TabsContent,{value:"privacy",children:(0,s.jsx)(U.GDPRControls,{variant:"light"})}),(0,s.jsx)(c.TabsContent,{value:"notices",children:(0,s.jsx)(q.NoticeContactsTab,{apiEndpoint:"/api/arrangers/me/notice-contacts"})})]}),"individual"===O.type&&(0,s.jsx)(J.EntityKYCEditDialog,{open:el,onOpenChange:ed,entityType:"arranger",entityId:O.id,entityName:O.legal_name,initialData:{first_name:O.first_name??void 0,middle_name:O.middle_name??void 0,last_name:O.last_name??void 0,name_suffix:O.name_suffix??void 0,date_of_birth:O.date_of_birth??void 0,nationality:O.nationality??void 0,country_of_birth:O.country_of_birth??void 0,phone_mobile:O.phone_mobile??void 0,phone_office:O.phone_office??void 0,is_us_citizen:!0===O.is_us_citizen,is_us_taxpayer:!0===O.is_us_taxpayer,us_taxpayer_id:O.us_taxpayer_id??void 0,country_of_tax_residency:O.country_of_tax_residency??void 0,id_type:O.id_type??void 0,id_number:O.id_number??void 0,id_issue_date:O.id_issue_date??void 0,id_expiry_date:O.id_expiry_date??void 0,id_issuing_country:O.id_issuing_country??void 0,residential_street:O.residential_street??void 0,residential_city:O.residential_city??void 0,residential_state:O.residential_state??void 0,residential_postal_code:O.residential_postal_code??void 0,residential_country:O.residential_country??void 0},apiEndpoint:"/api/arrangers/me/profile",onSuccess:()=>window.location.reload()}),"individual"!==O.type&&(0,s.jsx)(W.EntityAddressEditDialog,{open:ec,onOpenChange:eo,entityType:"arranger",entityName:O.legal_name,initialData:{address_line_1:O.address??"",email:O.email??"",phone:O.phone??"",phone_mobile:O.phone_mobile??"",phone_office:O.phone_office??""},apiEndpoint:"/api/arrangers/me/profile",onSuccess:()=>window.location.reload()})]})}e.s(["ArrangerProfileClient",()=>ea],667498)}]);