(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,939322,e=>{"use strict";var a=e.i(722679),s=e.i(340915),t=e.i(316264),r=e.i(514133),i=e.i(45778),l=e.i(90613),n=e.i(816654),c=e.i(312692),d=e.i(908925),o=e.i(263229),m=e.i(695459),h=e.i(762074),x=e.i(117925),u=e.i(773510),j=e.i(957114),p=e.i(417439),g=e.i(761722),b=e.i(554369),f=e.i(981218),y=e.i(264651),N=e.i(953989),w=e.i(994500);function v({onUpdate:e,variant:v="investor"}){let C=(0,N.useTourOptional)(),_="staff"===v,T="arranger"===v,[S,k]=(0,s.useState)(!_&&!T),[D,A]=(0,s.useState)(!1),[E,P]=(0,s.useState)(!1),[B,M]=(0,s.useState)(!1),[F,L]=(0,s.useState)(""),[R,H]=(0,s.useState)(!1),[I,U]=(0,s.useState)(!1),[q,O]=(0,s.useState)({notification_settings:{email_notifications:!0,deal_updates:!0,message_notifications:!0}}),z=(0,s.useCallback)(async()=>{k(!0);try{let e=await fetch("/api/dashboard-preferences"),a=await e.json();e.ok&&a.preferences&&O({notification_settings:a.preferences.notification_settings||q.notification_settings})}catch(e){console.error("Error loading preferences:",e),w.toast.error("Failed to load preferences")}finally{k(!1)}},[]),$=(0,s.useCallback)(async()=>{try{let e=await fetch("/api/gdpr/deletion-request"),a=await e.json();e.ok&&a.has_pending&&U(!0)}catch(e){console.error("Error checking pending deletion:",e)}},[]);(0,s.useEffect)(()=>{_||T?k(!1):(z(),$())},[_,T,z,$]);let Y=async()=>{P(!0);try{let e=await fetch("/api/gdpr/export",{method:"POST"});if(!e.ok)throw Error("Export failed");let a=await e.blob(),s=window.URL.createObjectURL(a),t=document.createElement("a");t.href=s,t.download=`verso-data-export-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(t),t.click(),window.URL.revokeObjectURL(s),t.remove(),w.toast.success("Your data has been exported successfully")}catch(e){console.error("Export error:",e),w.toast.error("Failed to export your data. Please try again.")}finally{P(!1)}},G=async()=>{if(!F||F.length<10)return void w.toast.error("Please provide a reason (at least 10 characters)");if(!R)return void w.toast.error("Please confirm you understand the consequences");M(!0);try{let e=await fetch("/api/gdpr/deletion-request",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({reason:F,confirm_understood:R})}),a=await e.json();if(!e.ok)throw Error(a.error||"Failed to submit request");w.toast.success("Your deletion request has been submitted and will be reviewed within 30 days."),U(!0),L(""),H(!1)}catch(e){console.error("Deletion request error:",e),w.toast.error(e.message||"Failed to submit deletion request")}finally{M(!1)}},J=(e,a)=>{O(s=>({...s,notification_settings:{...s.notification_settings,[e]:a}}))},V=async a=>{a.preventDefault(),A(!0);try{let a=await fetch("/api/dashboard-preferences",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(q)}),s=await a.json();if(!a.ok)throw Error(s.error||"Failed to update preferences");w.toast.success("Preferences updated successfully"),e?.()}catch(e){console.error("Error updating preferences:",e),w.toast.error("Failed to update preferences",{description:e.message})}finally{A(!1)}};if(T){let e=[{label:"Mandate Updates",description:"Notifications about new mandates, status changes, and investor activity on your deals.",icon:u.Mail,configurable:!0},{label:"Subscription Packs",description:"Alerts when subscription packs require your signature or have status updates.",icon:p.MessageSquare,configurable:!0},{label:"Payment Requests",description:"Notifications about fee events, invoice submissions, and payment confirmations.",icon:h.Bell,configurable:!0},{label:"Compliance Alerts",description:"License expiry reminders, KYC renewal notices, and regulatory updates.",icon:x.ShieldCheck,configurable:!1}];return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)(l.Card,{children:[(0,a.jsxs)(l.CardHeader,{children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(h.Bell,{className:"h-5 w-5 text-primary"}),(0,a.jsx)(l.CardTitle,{children:"Notification Preferences"})]}),(0,a.jsx)(l.CardDescription,{children:"Manage how you receive updates about your mandates and business activities"})]}),(0,a.jsx)(l.CardContent,{className:"space-y-4",children:e.map(e=>(0,a.jsxs)("div",{className:"flex items-start justify-between gap-4 rounded-lg border p-4",children:[(0,a.jsxs)("div",{className:"flex items-start gap-3",children:[(0,a.jsx)(e.icon,{className:"mt-1 h-4 w-4 text-muted-foreground"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-semibold",children:e.label}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:e.description})]})]}),e.configurable?(0,a.jsx)(i.Switch,{defaultChecked:!0}):(0,a.jsx)("span",{className:"text-xs text-emerald-600 font-medium bg-emerald-50 px-2 py-1 rounded",children:"Always on"})]},e.label))})]}),(0,a.jsx)(l.Card,{className:"border-blue-200 bg-blue-50/50",children:(0,a.jsx)(l.CardContent,{className:"py-4",children:(0,a.jsxs)("div",{className:"flex gap-3",children:[(0,a.jsx)(x.ShieldCheck,{className:"h-5 w-5 text-blue-600 flex-shrink-0 mt-0.5"}),(0,a.jsxs)("div",{className:"text-sm",children:[(0,a.jsx)("p",{className:"font-medium text-blue-900",children:"Compliance Notifications"}),(0,a.jsx)("p",{className:"text-blue-700 mt-1",children:"Some notifications cannot be disabled as they are required for regulatory compliance. These include license expiry warnings and mandatory KYC renewal reminders."})]})]})})}),C&&(0,a.jsxs)(l.Card,{children:[(0,a.jsxs)(l.CardHeader,{children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(y.PlayCircle,{className:"h-5 w-5 text-primary"}),(0,a.jsx)(l.CardTitle,{children:"Platform Tour"})]}),(0,a.jsx)(l.CardDescription,{children:"Take a guided tour of the platform features"})]}),(0,a.jsx)(l.CardContent,{children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"space-y-0.5",children:[(0,a.jsx)(r.Label,{children:"Restart Platform Tour"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Walk through the platform features again with an interactive guide"})]}),(0,a.jsxs)(t.Button,{type:"button",variant:"outline",onClick:()=>C.startTour(),children:[(0,a.jsx)(y.PlayCircle,{className:"mr-2 h-4 w-4"}),"Start Tour"]})]})})]})]})}if(_){let e=[{label:"Email Alerts",description:"Critical incidents, investor escalations, and compliance reminders are always routed to your inbox.",icon:u.Mail},{label:"In-App Notifications",description:"Task reminders, approvals, and operational updates show up in the notification center automatically.",icon:p.MessageSquare},{label:"SMS Escalations",description:"After-hours or high-priority issues trigger backup SMS alerts for the on-call operations lead.",icon:j.Phone}];return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)(l.Card,{className:"bg-white/5 border-white/10",children:[(0,a.jsxs)(l.CardHeader,{children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(x.ShieldCheck,{className:"h-5 w-5 text-primary"}),(0,a.jsx)(l.CardTitle,{className:"text-white",children:"Notifications are centrally managed"})]}),(0,a.jsx)(l.CardDescription,{className:"text-white/70",children:"Staff alerts follow an operations-wide policy so nothing critical can be turned off accidentally."})]}),(0,a.jsx)(l.CardContent,{className:"space-y-4",children:e.map(e=>(0,a.jsxs)("div",{className:"flex items-start gap-3 rounded-lg border border-white/10 bg-white/5 p-4",children:[(0,a.jsx)(e.icon,{className:"mt-1 h-4 w-4 text-primary"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-semibold text-white",children:e.label}),(0,a.jsx)("p",{className:"text-sm text-white/70",children:e.description}),(0,a.jsx)("p",{className:"text-xs text-emerald-300/90 mt-1",children:"Status: Always on"})]})]},e.label))})]}),(0,a.jsxs)(l.Card,{className:"bg-white/5 border-white/10",children:[(0,a.jsxs)(l.CardHeader,{children:[(0,a.jsx)(l.CardTitle,{className:"text-white",children:"Need to adjust routing?"}),(0,a.jsx)(l.CardDescription,{className:"text-white/70",children:"Changes go through the Platform team so audit trails stay intact."})]}),(0,a.jsxs)(l.CardContent,{className:"space-y-4",children:[(0,a.jsx)("p",{className:"text-sm text-white/70",children:"Share the context (investor, deal, urgency) and the team will update the notification matrix or escalate to engineering."}),(0,a.jsx)(t.Button,{asChild:!0,className:"bg-white/10 text-white border border-white/20 hover:bg-white/20",children:(0,a.jsx)("a",{href:"mailto:admin@versotech.com?subject=Notification%20routing%20update",children:"Contact Platform Team"})})]})]}),C&&(0,a.jsxs)(l.Card,{className:"bg-white/5 border-white/10",children:[(0,a.jsxs)(l.CardHeader,{children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(y.PlayCircle,{className:"h-5 w-5 text-primary"}),(0,a.jsx)(l.CardTitle,{className:"text-white",children:"Platform Tour"})]}),(0,a.jsx)(l.CardDescription,{className:"text-white/70",children:"Take a guided tour of the platform features"})]}),(0,a.jsx)(l.CardContent,{children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"space-y-0.5",children:[(0,a.jsx)(r.Label,{className:"text-white",children:"Restart Platform Tour"}),(0,a.jsx)("p",{className:"text-sm text-white/70",children:"Walk through the platform features again with an interactive guide"})]}),(0,a.jsxs)(t.Button,{type:"button",variant:"outline",className:"border-white/20 text-white hover:bg-white/10",onClick:()=>C.startTour(),children:[(0,a.jsx)(y.PlayCircle,{className:"mr-2 h-4 w-4"}),"Start Tour"]})]})})]}),(0,a.jsxs)(l.Card,{className:"bg-white/5 border-amber-500/30",children:[(0,a.jsxs)(l.CardHeader,{children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(f.Shield,{className:"h-5 w-5 text-amber-400"}),(0,a.jsx)(l.CardTitle,{className:"text-white",children:"Data & Privacy"})]}),(0,a.jsx)(l.CardDescription,{className:"text-white/70",children:"Manage your personal data in accordance with GDPR regulations"})]}),(0,a.jsxs)(l.CardContent,{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"space-y-0.5",children:[(0,a.jsx)(r.Label,{className:"text-white",children:"Export Your Data"}),(0,a.jsx)("p",{className:"text-sm text-white/70",children:"Download a copy of all your personal data stored in our system"})]}),(0,a.jsx)(t.Button,{type:"button",variant:"outline",className:"border-white/20 text-white hover:bg-white/10",onClick:Y,disabled:E,children:E?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(o.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),"Exporting..."]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(g.Download,{className:"mr-2 h-4 w-4"}),"Export My Data"]})})]}),(0,a.jsx)("div",{className:"border-t border-white/10 pt-6",children:(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-0.5",children:[(0,a.jsx)(r.Label,{className:"text-red-400",children:"Request Account Deletion"}),(0,a.jsx)("p",{className:"text-sm text-white/70",children:"Request permanent deletion of your account and all associated data. This action is irreversible and will be reviewed by our team."})]}),I?(0,a.jsx)("div",{className:"rounded-lg border border-amber-500/30 bg-amber-500/10 p-4",children:(0,a.jsx)("p",{className:"text-sm text-amber-300",children:"You have a pending deletion request. Our team will review it within 30 days."})}):(0,a.jsxs)(d.AlertDialog,{children:[(0,a.jsx)(d.AlertDialogTrigger,{asChild:!0,children:(0,a.jsxs)(t.Button,{type:"button",variant:"destructive",className:"w-full sm:w-auto",children:[(0,a.jsx)(b.Trash2,{className:"mr-2 h-4 w-4"}),"Request Account Deletion"]})}),(0,a.jsxs)(d.AlertDialogContent,{children:[(0,a.jsxs)(d.AlertDialogHeader,{children:[(0,a.jsx)(d.AlertDialogTitle,{children:"Request Account Deletion"}),(0,a.jsx)(d.AlertDialogDescription,{asChild:!0,children:(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("p",{children:"This will submit a request to permanently delete your account and all associated data. This action cannot be undone."}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(r.Label,{htmlFor:"staff-deletion-reason",children:"Please tell us why you want to delete your account:"}),(0,a.jsx)(n.Textarea,{id:"staff-deletion-reason",placeholder:"Enter your reason (minimum 10 characters)",value:F,onChange:e=>L(e.target.value),className:"min-h-[100px]"})]}),(0,a.jsxs)("div",{className:"flex items-start space-x-2",children:[(0,a.jsx)(c.Checkbox,{id:"staff-deletion-confirm",checked:R,onCheckedChange:e=>H(!0===e)}),(0,a.jsx)("label",{htmlFor:"staff-deletion-confirm",className:"text-sm text-muted-foreground leading-tight",children:"I understand that this will permanently delete my account, all my data, and I will lose access to the platform."})]})]})})]}),(0,a.jsxs)(d.AlertDialogFooter,{children:[(0,a.jsx)(d.AlertDialogCancel,{children:"Cancel"}),(0,a.jsx)(d.AlertDialogAction,{onClick:G,disabled:B||!F||F.length<10||!R,className:"bg-red-600 hover:bg-red-700",children:B?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(o.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),"Submitting..."]}):"Submit Deletion Request"})]})]})]})]})})]})]})]})}return S?(0,a.jsx)("div",{className:"flex items-center justify-center p-8",children:(0,a.jsx)(o.Loader2,{className:"h-8 w-8 animate-spin text-muted-foreground"})}):(0,a.jsxs)("form",{onSubmit:V,className:"space-y-6",children:[(0,a.jsxs)(l.Card,{children:[(0,a.jsxs)(l.CardHeader,{children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(h.Bell,{className:"h-5 w-5"}),(0,a.jsx)(l.CardTitle,{children:"Notification Preferences"})]}),(0,a.jsx)(l.CardDescription,{children:"Manage how you receive notifications and updates"})]}),(0,a.jsxs)(l.CardContent,{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"space-y-0.5",children:[(0,a.jsx)(r.Label,{htmlFor:"email_notifications",children:"Email Notifications"}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Receive notifications via email"})]}),(0,a.jsx)(i.Switch,{id:"email_notifications",checked:q.notification_settings.email_notifications,onCheckedChange:e=>J("email_notifications",e)})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"space-y-0.5",children:[(0,a.jsx)(r.Label,{htmlFor:"deal_updates",children:"Deal Updates"}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Get notified about deal status changes"})]}),(0,a.jsx)(i.Switch,{id:"deal_updates",checked:q.notification_settings.deal_updates,onCheckedChange:e=>J("deal_updates",e)})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"space-y-0.5",children:[(0,a.jsx)(r.Label,{htmlFor:"message_notifications",children:"Message Notifications"}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Get notified about new messages"})]}),(0,a.jsx)(i.Switch,{id:"message_notifications",checked:q.notification_settings.message_notifications,onCheckedChange:e=>J("message_notifications",e)})]})]})]}),C&&(0,a.jsxs)(l.Card,{children:[(0,a.jsxs)(l.CardHeader,{children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(y.PlayCircle,{className:"h-5 w-5"}),(0,a.jsx)(l.CardTitle,{children:"Platform Tour"})]}),(0,a.jsx)(l.CardDescription,{children:"Take a guided tour of the platform features"})]}),(0,a.jsx)(l.CardContent,{children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"space-y-0.5",children:[(0,a.jsx)(r.Label,{children:"Restart Platform Tour"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Walk through the platform features again with an interactive guide"})]}),(0,a.jsxs)(t.Button,{type:"button",variant:"outline",onClick:()=>C.startTour(),children:[(0,a.jsx)(y.PlayCircle,{className:"mr-2 h-4 w-4"}),"Start Tour"]})]})})]}),(0,a.jsx)("div",{className:"flex justify-end",children:(0,a.jsx)(t.Button,{type:"submit",disabled:D,className:"w-full sm:w-auto",children:D?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(o.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),"Saving Preferences..."]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(m.Save,{className:"mr-2 h-4 w-4"}),"Save Preferences"]})})}),(0,a.jsxs)(l.Card,{className:"border-amber-200",children:[(0,a.jsxs)(l.CardHeader,{children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(f.Shield,{className:"h-5 w-5 text-amber-600"}),(0,a.jsx)(l.CardTitle,{children:"Data & Privacy"})]}),(0,a.jsx)(l.CardDescription,{children:"Manage your personal data in accordance with GDPR regulations"})]}),(0,a.jsxs)(l.CardContent,{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"space-y-0.5",children:[(0,a.jsx)(r.Label,{children:"Export Your Data"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Download a copy of all your personal data stored in our system"})]}),(0,a.jsx)(t.Button,{type:"button",variant:"outline",onClick:Y,disabled:E,children:E?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(o.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),"Exporting..."]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(g.Download,{className:"mr-2 h-4 w-4"}),"Export My Data"]})})]}),(0,a.jsx)("div",{className:"border-t pt-6",children:(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-0.5",children:[(0,a.jsx)(r.Label,{className:"text-destructive",children:"Request Account Deletion"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Request permanent deletion of your account and all associated data. This action is irreversible and will be reviewed by our team."})]}),I?(0,a.jsx)("div",{className:"rounded-lg border border-amber-300 bg-amber-50 p-4",children:(0,a.jsx)("p",{className:"text-sm text-amber-800",children:"You have a pending deletion request. Our team will review it within 30 days."})}):(0,a.jsxs)(d.AlertDialog,{children:[(0,a.jsx)(d.AlertDialogTrigger,{asChild:!0,children:(0,a.jsxs)(t.Button,{type:"button",variant:"destructive",className:"w-full sm:w-auto",children:[(0,a.jsx)(b.Trash2,{className:"mr-2 h-4 w-4"}),"Request Account Deletion"]})}),(0,a.jsxs)(d.AlertDialogContent,{children:[(0,a.jsxs)(d.AlertDialogHeader,{children:[(0,a.jsx)(d.AlertDialogTitle,{children:"Request Account Deletion"}),(0,a.jsx)(d.AlertDialogDescription,{asChild:!0,children:(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("p",{children:"This will submit a request to permanently delete your account and all associated data. This action cannot be undone."}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(r.Label,{htmlFor:"deletion-reason",children:"Please tell us why you want to delete your account:"}),(0,a.jsx)(n.Textarea,{id:"deletion-reason",placeholder:"Enter your reason (minimum 10 characters)",value:F,onChange:e=>L(e.target.value),className:"min-h-[100px]"})]}),(0,a.jsxs)("div",{className:"flex items-start space-x-2",children:[(0,a.jsx)(c.Checkbox,{id:"deletion-confirm",checked:R,onCheckedChange:e=>H(!0===e)}),(0,a.jsx)("label",{htmlFor:"deletion-confirm",className:"text-sm text-muted-foreground leading-tight",children:"I understand that this will permanently delete my account, all my data, and I will lose access to all investments and documents."})]})]})})]}),(0,a.jsxs)(d.AlertDialogFooter,{children:[(0,a.jsx)(d.AlertDialogCancel,{children:"Cancel"}),(0,a.jsx)(d.AlertDialogAction,{onClick:G,disabled:B||!F||F.length<10||!R,className:"bg-destructive hover:bg-destructive/90",children:B?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(o.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),"Submitting..."]}):"Submit Deletion Request"})]})]})]})]})})]})]})]})}e.s(["PreferencesEditor",()=>v])},695891,e=>{"use strict";var a=e.i(722679),s=e.i(340915),t=e.i(501259),r=e.i(335994),i=e.i(773510),l=e.i(645855),n=e.i(15098),c=e.i(745083),d=e.i(554369),o=e.i(176835),m=e.i(818798),h=e.i(981218),x=e.i(849110),u=e.i(263229),j=e.i(932735),p=e.i(401148),g=e.i(551544),b=e.i(316264),f=e.i(90613),y=e.i(129432),N=e.i(237635),w=e.i(352776),v=e.i(191569),C=e.i(514133),_=e.i(538892),T=e.i(510166),S=e.i(312692),k=e.i(994500),D=e.i(429760);let A=[{value:"admin",label:"Administrator"},{value:"member",label:"Member"},{value:"viewer",label:"Viewer"}];function E({entityType:e,entityId:E,entityName:P,initialMembers:B=[],currentUserRole:M="member",isCurrentUserPrimary:F=!1,canManageMembers:L=!1,showSignatoryOption:R=!0,onMembersChange:H}){let[I,U]=(0,s.useState)(B),[q,O]=(0,s.useState)([]),[z,$]=(0,s.useState)(!0),[Y,G]=(0,s.useState)(!1),[J,V]=(0,s.useState)(!1),[K,W]=(0,s.useState)(null),[X,Q]=(0,s.useState)({role:M,is_primary:F,can_manage:L}),[Z,ee]=(0,s.useState)(""),[ea,es]=(0,s.useState)("member"),[et,er]=(0,s.useState)(!1),[ei,el]=(0,s.useState)(!1),[en,ec]=(0,s.useState)(null),[ed,eo]=(0,s.useState)("member"),[em,eh]=(0,s.useState)(!1),[ex,eu]=(0,s.useState)(!1),[ej,ep]=(0,s.useState)(!1);(0,s.useEffect)(()=>{eg(),eb()},[e,E]);let eg=async()=>{try{let a=await fetch(`/api/members?entity_type=${e}&entity_id=${E}`);if(a.ok){let e=await a.json();U(e.members||[]),e.current_user&&Q(e.current_user)}}catch(e){console.error("Error fetching members:",e)}},eb=async()=>{try{let a=await fetch(`/api/members/invite?entity_type=${e}&entity_id=${E}`);if(a.ok){let e=await a.json();O(e.invitations||[])}}catch(e){console.error("Error fetching invitations:",e)}finally{$(!1)}},ef=async()=>{if(en){ep(!0);try{let a=await fetch(`/api/members/${en.user_id}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({entity_type:e,entity_id:E,role:ed,can_sign:em,is_primary:ex})}),s=await a.json();if(!a.ok)return void k.toast.error(s.error||"Failed to update member");k.toast.success("Member updated successfully"),el(!1),ec(null),eg()}catch(e){console.error("Error updating member:",e),k.toast.error("Failed to update member")}finally{ep(!1)}}},ey=async a=>{if(confirm("Are you sure you want to remove this member?"))try{let s=await fetch(`/api/members/${a}?entity_type=${e}&entity_id=${E}`,{method:"DELETE"}),t=await s.json();if(!s.ok)return void k.toast.error(t.error||"Failed to remove member");k.toast.success("Member removed successfully"),eg()}catch(e){console.error("Error removing member:",e),k.toast.error("Failed to remove member")}},eN=async()=>{if(!Z)return void k.toast.error("Please enter an email address");V(!0);try{let a=await fetch("/api/members/invite",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({entity_type:e,entity_id:E,email:Z,role:ea,is_signatory:et})}),s=await a.json();if(!a.ok)return void k.toast.error(s.error||"Failed to send invitation");s.requires_approval?k.toast.success(`Invitation request created for ${Z}. Awaiting CEO approval.`,{description:"The invitation email will be sent after approval.",duration:5e3}):k.toast.success(`Invitation sent to ${Z}`),G(!1),ee(""),es("member"),er(!1),eb(),s.invitation?.accept_url&&(await navigator.clipboard.writeText(s.invitation.accept_url),k.toast.info("Invitation link copied to clipboard"))}catch(e){k.toast.error("Failed to send invitation")}finally{V(!1)}},ew=async e=>{W(e);try{let a=await fetch(`/api/members/invite?id=${e}`,{method:"DELETE"});if(!a.ok){let e=await a.json();k.toast.error(e.error||"Failed to cancel invitation");return}k.toast.success("Invitation cancelled"),eb()}catch(e){k.toast.error("Failed to cancel invitation")}finally{W(null)}},ev=async e=>{let a=`${window.location.origin}/invitation/accept?token=${e}`;await navigator.clipboard.writeText(a),k.toast.success("Invitation link copied!")},eC=e=>new Date(e).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}),e_=q.filter(e=>["pending","pending_approval"].includes(e.status)),eT=q.filter(e=>!["pending","pending_approval"].includes(e.status));return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("h3",{className:"text-lg font-semibold flex items-center gap-2",children:[(0,a.jsx)(t.Users,{className:"h-5 w-5"}),"Team Members"]}),(0,a.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Manage who has access to ",P]})]}),X.can_manage&&(0,a.jsxs)(b.Button,{onClick:()=>G(!0),children:[(0,a.jsx)(r.UserPlus,{className:"h-4 w-4 mr-2"}),"Invite Member"]})]}),(0,a.jsxs)(D.Tabs,{defaultValue:"members",className:"w-full",id:"members-management-tabs",children:[(0,a.jsxs)(D.TabsList,{children:[(0,a.jsxs)(D.TabsTrigger,{value:"members",className:"flex items-center gap-2",children:[(0,a.jsx)(t.Users,{className:"h-4 w-4"}),"Members (",I.length,")"]}),(0,a.jsxs)(D.TabsTrigger,{value:"invitations",className:"flex items-center gap-2",children:[(0,a.jsx)(i.Mail,{className:"h-4 w-4"}),"Invitations (",e_.length,")"]})]}),(0,a.jsx)(D.TabsContent,{value:"members",className:"mt-4",children:(0,a.jsx)(f.Card,{children:(0,a.jsx)(f.CardContent,{className:"p-0",children:0===I.length?(0,a.jsxs)("div",{className:"py-12 text-center",children:[(0,a.jsx)(t.Users,{className:"h-10 w-10 mx-auto text-muted-foreground mb-3"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"No members yet"}),X.can_manage&&(0,a.jsxs)(b.Button,{variant:"outline",size:"sm",className:"mt-4",onClick:()=>G(!0),children:[(0,a.jsx)(r.UserPlus,{className:"h-4 w-4 mr-2"}),"Invite First Member"]})]}):(0,a.jsxs)(N.Table,{children:[(0,a.jsx)(N.TableHeader,{children:(0,a.jsxs)(N.TableRow,{children:[(0,a.jsx)(N.TableHead,{children:"Member"}),(0,a.jsx)(N.TableHead,{children:"Role"}),(0,a.jsx)(N.TableHead,{children:"Status"}),(0,a.jsx)(N.TableHead,{children:"Joined"}),X.can_manage&&(0,a.jsx)(N.TableHead,{className:"w-10"})]})}),(0,a.jsx)(N.TableBody,{children:I.map(e=>(0,a.jsxs)(N.TableRow,{children:[(0,a.jsx)(N.TableCell,{children:(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-8 h-8 rounded-full bg-muted flex items-center justify-center",children:e.profile?.avatar_url?(0,a.jsx)("img",{src:e.profile.avatar_url,alt:"",className:"w-8 h-8 rounded-full object-cover"}):(0,a.jsx)("span",{className:"text-sm font-medium",children:(e.profile?.display_name||e.profile?.email||"?")[0].toUpperCase()})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-medium",children:e.profile?.display_name||"Unknown User"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:e.profile?.email})]})]})}),(0,a.jsx)(N.TableCell,{children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(y.Badge,{variant:"outline",className:"capitalize",children:e.role}),e.is_primary&&(0,a.jsxs)(y.Badge,{variant:"secondary",children:[(0,a.jsx)(h.Shield,{className:"w-3 h-3 mr-1"}),"Primary"]}),e.can_sign&&(0,a.jsxs)(y.Badge,{variant:"outline",className:"bg-blue-500/10 text-blue-600 border-blue-500/30",children:[(0,a.jsx)(m.PenTool,{className:"w-3 h-3 mr-1"}),"Signatory"]})]})}),(0,a.jsx)(N.TableCell,{children:e.can_sign&&!e.signature_specimen_url?(0,a.jsxs)(y.Badge,{variant:"outline",className:"bg-yellow-500/10 text-yellow-600 border-yellow-500/30",children:[(0,a.jsx)(p.AlertCircle,{className:"w-3 h-3 mr-1"}),"Needs Signature"]}):(0,a.jsxs)(y.Badge,{variant:"outline",className:"bg-green-500/10 text-green-600 border-green-500/30",children:[(0,a.jsx)(n.CheckCircle2,{className:"w-3 h-3 mr-1"}),"Active"]})}),(0,a.jsx)(N.TableCell,{className:"text-muted-foreground",children:eC(e.created_at)}),X.can_manage&&(0,a.jsx)(N.TableCell,{children:(0,a.jsxs)(T.DropdownMenu,{children:[(0,a.jsx)(T.DropdownMenuTrigger,{asChild:!0,children:(0,a.jsx)(b.Button,{variant:"ghost",size:"sm",children:(0,a.jsx)(x.MoreHorizontal,{className:"h-4 w-4"})})}),(0,a.jsxs)(T.DropdownMenuContent,{align:"end",children:[(0,a.jsxs)(T.DropdownMenuItem,{onClick:()=>{ec(e),eo(e.role),eh(e.can_sign||!1),eu(e.is_primary),el(!0)},children:[(0,a.jsx)(g.Edit,{className:"h-4 w-4 mr-2"}),"Edit Member"]}),!e.is_primary&&(0,a.jsxs)(T.DropdownMenuItem,{className:"text-destructive",onClick:()=>ey(e.user_id),children:[(0,a.jsx)(d.Trash2,{className:"h-4 w-4 mr-2"}),"Remove Member"]})]})]})})]},e.id))})]})})})}),(0,a.jsxs)(D.TabsContent,{value:"invitations",className:"mt-4 space-y-4",children:[(0,a.jsxs)(f.Card,{children:[(0,a.jsxs)(f.CardHeader,{children:[(0,a.jsx)(f.CardTitle,{className:"text-base",children:"Pending Invitations"}),(0,a.jsx)(f.CardDescription,{children:"Invitations waiting to be accepted"})]}),(0,a.jsx)(f.CardContent,{className:"p-0",children:z?(0,a.jsx)("div",{className:"py-8 text-center",children:(0,a.jsx)(u.Loader2,{className:"h-6 w-6 animate-spin mx-auto text-muted-foreground"})}):0===e_.length?(0,a.jsxs)("div",{className:"py-8 text-center text-muted-foreground",children:[(0,a.jsx)(i.Mail,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),(0,a.jsx)("p",{children:"No pending invitations"})]}):(0,a.jsxs)(N.Table,{children:[(0,a.jsx)(N.TableHeader,{children:(0,a.jsxs)(N.TableRow,{children:[(0,a.jsx)(N.TableHead,{children:"Email"}),(0,a.jsx)(N.TableHead,{children:"Role"}),(0,a.jsx)(N.TableHead,{children:"Invited By"}),(0,a.jsx)(N.TableHead,{children:"Expires"}),(0,a.jsx)(N.TableHead,{className:"w-10"})]})}),(0,a.jsx)(N.TableBody,{children:e_.map(e=>(0,a.jsxs)(N.TableRow,{children:[(0,a.jsx)(N.TableCell,{children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(i.Mail,{className:"h-4 w-4 text-muted-foreground"}),(0,a.jsx)("span",{children:e.email}),e.is_signatory&&(0,a.jsxs)(y.Badge,{variant:"outline",className:"bg-blue-500/10 text-blue-600 border-blue-500/30",children:[(0,a.jsx)(m.PenTool,{className:"w-3 h-3 mr-1"}),"Signatory"]})]})}),(0,a.jsx)(N.TableCell,{children:(0,a.jsx)(y.Badge,{variant:"outline",className:"capitalize",children:e.role})}),(0,a.jsx)(N.TableCell,{className:"text-muted-foreground",children:e.invited_by_name}),(0,a.jsx)(N.TableCell,{className:"text-muted-foreground",children:eC(e.expires_at)}),(0,a.jsx)(N.TableCell,{children:(0,a.jsxs)(T.DropdownMenu,{children:[(0,a.jsx)(T.DropdownMenuTrigger,{asChild:!0,children:(0,a.jsx)(b.Button,{variant:"ghost",size:"sm",children:(0,a.jsx)(x.MoreHorizontal,{className:"h-4 w-4"})})}),(0,a.jsxs)(T.DropdownMenuContent,{align:"end",children:[e.invitation_token&&(0,a.jsxs)(T.DropdownMenuItem,{onClick:()=>ev(e.invitation_token),children:[(0,a.jsx)(o.Copy,{className:"h-4 w-4 mr-2"}),"Copy Link"]}),X.can_manage&&(0,a.jsxs)(T.DropdownMenuItem,{className:"text-destructive",onClick:()=>ew(e.id),disabled:K===e.id,children:[K===e.id?(0,a.jsx)(u.Loader2,{className:"h-4 w-4 mr-2 animate-spin"}):(0,a.jsx)(c.XCircle,{className:"h-4 w-4 mr-2"}),"Cancel Invitation"]})]})]})})]},e.id))})]})})]}),eT.length>0&&(0,a.jsxs)(f.Card,{children:[(0,a.jsx)(f.CardHeader,{children:(0,a.jsx)(f.CardTitle,{className:"text-base",children:"Invitation History"})}),(0,a.jsx)(f.CardContent,{className:"p-0",children:(0,a.jsxs)(N.Table,{children:[(0,a.jsx)(N.TableHeader,{children:(0,a.jsxs)(N.TableRow,{children:[(0,a.jsx)(N.TableHead,{children:"Email"}),(0,a.jsx)(N.TableHead,{children:"Status"}),(0,a.jsx)(N.TableHead,{children:"Date"})]})}),(0,a.jsx)(N.TableBody,{children:eT.slice(0,10).map(e=>(0,a.jsxs)(N.TableRow,{children:[(0,a.jsx)(N.TableCell,{children:e.email}),(0,a.jsx)(N.TableCell,{children:(e=>{switch(e){case"pending":return(0,a.jsxs)(y.Badge,{variant:"outline",className:"bg-yellow-500/10 text-yellow-600 border-yellow-500/30",children:[(0,a.jsx)(l.Clock,{className:"w-3 h-3 mr-1"}),"Pending"]});case"pending_approval":return(0,a.jsxs)(y.Badge,{variant:"outline",className:"bg-orange-500/10 text-orange-600 border-orange-500/30",children:[(0,a.jsx)(l.Clock,{className:"w-3 h-3 mr-1"}),"Awaiting CEO Approval"]});case"accepted":return(0,a.jsxs)(y.Badge,{variant:"outline",className:"bg-green-500/10 text-green-600 border-green-500/30",children:[(0,a.jsx)(n.CheckCircle2,{className:"w-3 h-3 mr-1"}),"Accepted"]});case"expired":return(0,a.jsxs)(y.Badge,{variant:"outline",className:"bg-gray-500/10 text-gray-600 border-gray-500/30",children:[(0,a.jsx)(l.Clock,{className:"w-3 h-3 mr-1"}),"Expired"]});case"cancelled":return(0,a.jsxs)(y.Badge,{variant:"outline",className:"bg-red-500/10 text-red-600 border-red-500/30",children:[(0,a.jsx)(c.XCircle,{className:"w-3 h-3 mr-1"}),"Cancelled"]});default:return(0,a.jsx)(y.Badge,{variant:"outline",children:e})}})(e.status)}),(0,a.jsx)(N.TableCell,{className:"text-muted-foreground",children:eC(e.accepted_at||e.created_at)})]},e.id))})]})})]})]})]}),(0,a.jsx)(w.Dialog,{open:Y,onOpenChange:G,children:(0,a.jsxs)(w.DialogContent,{children:[(0,a.jsxs)(w.DialogHeader,{children:[(0,a.jsx)(w.DialogTitle,{children:"Invite Team Member"}),(0,a.jsxs)(w.DialogDescription,{children:["Send an invitation to join ",P]})]}),(0,a.jsxs)("div",{className:"space-y-4 py-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(C.Label,{htmlFor:"email",children:"Email Address"}),(0,a.jsx)(v.Input,{id:"email",type:"email",placeholder:"colleague@example.com",value:Z,onChange:e=>ee(e.target.value)})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(C.Label,{htmlFor:"role",children:"Role"}),(0,a.jsxs)(_.Select,{value:ea,onValueChange:es,children:[(0,a.jsx)(_.SelectTrigger,{children:(0,a.jsx)(_.SelectValue,{placeholder:"Select role"})}),(0,a.jsx)(_.SelectContent,{children:A.map(e=>(0,a.jsx)(_.SelectItem,{value:e.value,children:e.label},e.value))})]})]}),R&&(0,a.jsxs)("div",{className:"flex items-center space-x-2 pt-2",children:[(0,a.jsx)(S.Checkbox,{id:"signatory",checked:et,onCheckedChange:e=>er(!0===e)}),(0,a.jsxs)(C.Label,{htmlFor:"signatory",className:"flex items-center gap-2 cursor-pointer",children:[(0,a.jsx)(m.PenTool,{className:"h-4 w-4"}),"Authorized Signatory",(0,a.jsx)("span",{className:"text-xs text-muted-foreground",children:"(can sign documents)"})]})]})]}),(0,a.jsxs)(w.DialogFooter,{children:[(0,a.jsx)(b.Button,{variant:"outline",onClick:()=>G(!1),disabled:J,children:"Cancel"}),(0,a.jsx)(b.Button,{onClick:eN,disabled:J||!Z,children:J?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(u.Loader2,{className:"h-4 w-4 mr-2 animate-spin"}),"Sending..."]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(j.Send,{className:"h-4 w-4 mr-2"}),"Send Invitation"]})})]})]})}),(0,a.jsx)(w.Dialog,{open:ei,onOpenChange:el,children:(0,a.jsxs)(w.DialogContent,{children:[(0,a.jsxs)(w.DialogHeader,{children:[(0,a.jsx)(w.DialogTitle,{children:"Edit Team Member"}),(0,a.jsxs)(w.DialogDescription,{children:["Update ",en?.profile?.display_name||en?.profile?.email||"member"," settings"]})]}),(0,a.jsxs)("div",{className:"space-y-4 py-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(C.Label,{children:"Role"}),(0,a.jsxs)(_.Select,{value:ed,onValueChange:eo,children:[(0,a.jsx)(_.SelectTrigger,{children:(0,a.jsx)(_.SelectValue,{placeholder:"Select role"})}),(0,a.jsx)(_.SelectContent,{children:A.map(e=>(0,a.jsx)(_.SelectItem,{value:e.value,children:e.label},e.value))})]})]}),R&&(0,a.jsxs)("div",{className:"flex items-center space-x-2 pt-2",children:[(0,a.jsx)(S.Checkbox,{id:"edit-signatory",checked:em,onCheckedChange:e=>eh(!0===e)}),(0,a.jsxs)(C.Label,{htmlFor:"edit-signatory",className:"flex items-center gap-2 cursor-pointer",children:[(0,a.jsx)(m.PenTool,{className:"h-4 w-4"}),"Authorized Signatory",(0,a.jsx)("span",{className:"text-xs text-muted-foreground",children:"(can sign documents)"})]})]}),X.is_primary&&!en?.is_primary&&(0,a.jsxs)("div",{className:"flex items-center space-x-2 pt-2",children:[(0,a.jsx)(S.Checkbox,{id:"edit-primary",checked:ex,onCheckedChange:e=>eu(!0===e)}),(0,a.jsxs)(C.Label,{htmlFor:"edit-primary",className:"flex items-center gap-2 cursor-pointer",children:[(0,a.jsx)(h.Shield,{className:"h-4 w-4"}),"Make Primary Contact",(0,a.jsx)("span",{className:"text-xs text-muted-foreground",children:"(transfers primary status)"})]})]}),en?.is_primary&&(0,a.jsxs)("div",{className:"text-sm text-muted-foreground bg-muted/50 p-3 rounded-lg",children:[(0,a.jsx)(h.Shield,{className:"h-4 w-4 inline mr-2"}),"This member is the primary contact. To change primary status, select another member and make them primary."]})]}),(0,a.jsxs)(w.DialogFooter,{children:[(0,a.jsx)(b.Button,{variant:"outline",onClick:()=>el(!1),disabled:ej,children:"Cancel"}),(0,a.jsx)(b.Button,{onClick:ef,disabled:ej,children:ej?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(u.Loader2,{className:"h-4 w-4 mr-2 animate-spin"}),"Saving..."]}):"Save Changes"})]})]})})]})}e.s(["MembersManagementTab",()=>E])},921294,e=>{"use strict";var a=e.i(722679),s=e.i(340915),t=e.i(90613),r=e.i(316264),i=e.i(191569),l=e.i(514133),n=e.i(429760),c=e.i(80289),d=e.i(818798),o=e.i(396064),m=e.i(554369),h=e.i(695459),x=e.i(780),u=e.i(15098),j=e.i(263229),p=e.i(401148);let g=(0,e.i(410587).default)("image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);var b=e.i(994500),f=e.i(282141),y=e.i(594422);function N({currentSignatureUrl:e,onSignatureUpdate:N,entityType:w="investor"}){let v=function(e="investor"){switch(e){case"commercial_partner":return{get:"/api/commercial-partners/me/signature",post:"/api/commercial-partners/me/upload-signature",delete:"/api/commercial-partners/me/signature"};case"partner":return{get:"/api/partners/me/signature",post:"/api/partners/me/upload-signature",delete:"/api/partners/me/signature"};case"introducer":return{get:"/api/introducers/me/signature",post:"/api/introducers/me/upload-signature",delete:"/api/introducers/me/signature"};case"lawyer":return{get:"/api/lawyers/me/signature",post:"/api/lawyers/me/upload-signature",delete:"/api/lawyers/me/signature"};default:return{get:"/api/signature-specimen",post:"/api/signature-specimen",delete:"/api/signature-specimen"}}}(w),C=(0,s.useRef)(null),[_,T]=(0,s.useState)(!1),[S,k]=(0,s.useState)(e||null),[D,A]=(0,s.useState)(!1),[E,P]=(0,s.useState)(!1),[B,M]=(0,s.useState)(null),[F,L]=(0,s.useState)(null),[R,H]=(0,s.useState)("draw"),[I,U]=(0,s.useState)(null);(0,s.useEffect)(()=>{q()},[]);let q=async()=>{A(!0);try{let e=await fetch(v.get);if(e.ok){let a=await e.json();a.signature_url&&k(a.signature_url)}}catch(e){console.error("Error loading signature:",e)}finally{A(!1)}},O=()=>{C.current&&(C.current.clear(),T(!1))},z=()=>{M(null),L(null)},$=async()=>{P(!0),U(null);try{let e;if("draw"===R){if(!C.current||C.current.isEmpty()){U("Please draw your signature first"),P(!1);return}let a=C.current.getTrimmedCanvas().toDataURL("image/png"),s=await fetch(a);e=await s.blob()}else{if(!B){U("Please upload an image first"),P(!1);return}e=B}let a=new FormData;a.append("signature",e,"signature.png");let s=await fetch(v.post,{method:"POST",body:a});if(!s.ok){let e=await s.json();throw Error(e.error||"Failed to save signature")}let t=await s.json();k(t.signature_url),N?.(t.signature_url),"draw"===R?O():z(),b.toast.success("Signature saved successfully")}catch(e){console.error("Error saving signature:",e),U(e instanceof Error?e.message:"Failed to save signature"),b.toast.error("Failed to save signature")}finally{P(!1)}},Y=async()=>{if(S){P(!0);try{if(!(await fetch(v.delete,{method:"DELETE"})).ok)throw Error("Failed to delete signature");k(null),N?.(null),b.toast.success("Signature removed")}catch(e){console.error("Error deleting signature:",e),b.toast.error("Failed to remove signature")}finally{P(!1)}}};return D?(0,a.jsx)(t.Card,{children:(0,a.jsx)(t.CardContent,{className:"py-12",children:(0,a.jsx)("div",{className:"flex items-center justify-center",children:(0,a.jsx)(j.Loader2,{className:"h-8 w-8 animate-spin text-muted-foreground"})})})}):(0,a.jsxs)("div",{className:"space-y-6",children:[S&&(0,a.jsxs)(t.Card,{children:[(0,a.jsx)(t.CardHeader,{children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)(t.CardTitle,{className:"text-base flex items-center gap-2",children:[(0,a.jsx)(u.CheckCircle2,{className:"h-5 w-5 text-green-600"}),"Current Signature"]}),(0,a.jsx)(t.CardDescription,{children:"Your signature specimen on file"})]}),(0,a.jsxs)(r.Button,{variant:"outline",size:"sm",onClick:Y,disabled:E,className:"text-red-600 hover:text-red-700 hover:bg-red-50 dark:text-red-400 dark:hover:text-red-300 dark:hover:bg-red-950/50",children:[E?(0,a.jsx)(j.Loader2,{className:"h-4 w-4 animate-spin mr-2"}):(0,a.jsx)(m.Trash2,{className:"h-4 w-4 mr-2"}),"Remove"]})]})}),(0,a.jsx)(t.CardContent,{children:(0,a.jsx)("div",{className:"border rounded-lg p-4 bg-white flex items-center justify-center",children:(0,a.jsx)("img",{src:S,alt:"Your signature",className:"max-h-24 object-contain"})})})]}),(0,a.jsxs)(t.Card,{children:[(0,a.jsxs)(t.CardHeader,{children:[(0,a.jsx)(t.CardTitle,{className:"text-base",children:S?"Update Signature":"Add Signature"}),(0,a.jsx)(t.CardDescription,{children:"Draw your signature or upload an image. This will be used for document signing."})]}),(0,a.jsxs)(t.CardContent,{className:"space-y-4",children:[I&&(0,a.jsxs)(c.Alert,{variant:"destructive",children:[(0,a.jsx)(p.AlertCircle,{className:"h-4 w-4"}),(0,a.jsx)(c.AlertDescription,{children:I})]}),(0,a.jsxs)(n.Tabs,{value:R,onValueChange:e=>H(e),children:[(0,a.jsxs)(n.TabsList,{className:"grid w-full grid-cols-2",children:[(0,a.jsxs)(n.TabsTrigger,{value:"draw",className:"gap-2",children:[(0,a.jsx)(d.PenTool,{className:"h-4 w-4"}),"Draw"]}),(0,a.jsxs)(n.TabsTrigger,{value:"upload",className:"gap-2",children:[(0,a.jsx)(o.Upload,{className:"h-4 w-4"}),"Upload"]})]}),(0,a.jsxs)(n.TabsContent,{value:"draw",className:"mt-4 space-y-4",children:[(0,a.jsx)("div",{className:"border-2 border-dashed rounded-lg bg-white overflow-hidden",children:(0,a.jsx)(y.default,{ref:C,canvasProps:{className:"w-full h-40 cursor-crosshair",style:{width:"100%",height:"160px"}},penColor:"black",backgroundColor:"white",onEnd:()=>{C.current&&!C.current.isEmpty()&&(T(!0),U(null))}})}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground text-center",children:"Draw your signature using your mouse or touch screen"}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsxs)(r.Button,{variant:"outline",onClick:O,disabled:!_,className:"flex-1",children:[(0,a.jsx)(x.RotateCcw,{className:"h-4 w-4 mr-2"}),"Clear"]}),(0,a.jsxs)(r.Button,{onClick:$,disabled:!_||E,className:"flex-1",children:[E?(0,a.jsx)(j.Loader2,{className:"h-4 w-4 animate-spin mr-2"}):(0,a.jsx)(h.Save,{className:"h-4 w-4 mr-2"}),"Save Signature"]})]})]}),(0,a.jsx)(n.TabsContent,{value:"upload",className:"mt-4 space-y-4",children:F?(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("div",{className:"border rounded-lg p-4 bg-white flex items-center justify-center",children:(0,a.jsx)("img",{src:F,alt:"Signature preview",className:"max-h-32 object-contain"})}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsxs)(r.Button,{variant:"outline",onClick:z,className:"flex-1",children:[(0,a.jsx)(x.RotateCcw,{className:"h-4 w-4 mr-2"}),"Choose Different"]}),(0,a.jsxs)(r.Button,{onClick:$,disabled:E,className:"flex-1",children:[E?(0,a.jsx)(j.Loader2,{className:"h-4 w-4 animate-spin mr-2"}):(0,a.jsx)(h.Save,{className:"h-4 w-4 mr-2"}),"Save Signature"]})]})]}):(0,a.jsx)("div",{children:(0,a.jsxs)(l.Label,{htmlFor:"signature-upload",className:(0,f.cn)("flex flex-col items-center justify-center w-full h-40 border-2 border-dashed rounded-lg cursor-pointer","bg-muted/50 hover:bg-muted transition-colors"),children:[(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center pt-5 pb-6",children:[(0,a.jsx)(g,{className:"h-10 w-10 text-muted-foreground mb-3"}),(0,a.jsxs)("p",{className:"mb-2 text-sm text-muted-foreground",children:[(0,a.jsx)("span",{className:"font-semibold",children:"Click to upload"})," or drag and drop"]}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"PNG, JPEG or WebP (max 2MB)"})]}),(0,a.jsx)(i.Input,{id:"signature-upload",type:"file",accept:"image/png,image/jpeg,image/webp",className:"hidden",onChange:e=>{let a=e.target.files?.[0];if(!a)return;if(!["image/png","image/jpeg","image/webp"].includes(a.type))return void U("Please upload a PNG, JPEG, or WebP image");if(a.size>2097152)return void U("File size must be less than 2MB");M(a),U(null);let s=new FileReader;s.onload=e=>{L(e.target?.result)},s.readAsDataURL(a)}})]})})})]})]})]}),(0,a.jsx)(t.Card,{className:"bg-blue-50/50 border-blue-200 dark:bg-blue-950/30 dark:border-blue-900",children:(0,a.jsx)(t.CardContent,{className:"py-4",children:(0,a.jsxs)("div",{className:"flex gap-3",children:[(0,a.jsx)(d.PenTool,{className:"h-5 w-5 text-blue-600 dark:text-blue-400 flex-shrink-0 mt-0.5"}),(0,a.jsxs)("div",{className:"text-sm",children:[(0,a.jsx)("p",{className:"font-medium text-blue-900 dark:text-blue-100",children:"About Signature Specimens"}),(0,a.jsx)("p",{className:"text-blue-700 dark:text-blue-300 mt-1",children:"Your signature specimen will be used for digitally signing documents such as subscription agreements, NDAs, and introducer agreements. Make sure your signature is clear and consistent with your legal documents."})]})]})})})]})}e.s(["SignatureSpecimenTab",()=>N],921294)},666123,e=>{"use strict";var a=e.i(722679),s=e.i(340915),t=e.i(501259),r=e.i(335994),i=e.i(551544),l=e.i(554369),n=e.i(117925),c=e.i(645855),d=e.i(401148),o=e.i(316264),m=e.i(90613),h=e.i(129432),x=e.i(237635),u=e.i(908925),j=e.i(994500),p=e.i(129263);let g={director:"Director",shareholder:"Shareholder",beneficial_owner:"Beneficial Owner",authorized_signatory:"Authorized Signatory",officer:"Officer",partner:"Partner",ubo:"UBO",signatory:"Signatory",authorized_representative:"Authorized Representative",beneficiary:"Beneficiary",trustee:"Trustee",managing_member:"Managing Member",general_partner:"General Partner",limited_partner:"Limited Partner",other:"Other"};function b({entityType:e,entityId:b,entityName:f,apiEndpoint:y,canManage:N=!0,title:w="Entity Members",description:v="Manage directors, shareholders, and beneficial owners"}){let[C,_]=(0,s.useState)([]),[T,S]=(0,s.useState)(!0),[k,D]=(0,s.useState)(null),[A,E]=(0,s.useState)(!1),[P,B]=(0,s.useState)(null),[M,F]=(0,s.useState)(!1),[L,R]=(0,s.useState)(null),[H,I]=(0,s.useState)(!1);(0,s.useEffect)(()=>{U()},[y]);let U=async()=>{S(!0),D(null);try{let e=await fetch(y);if(!e.ok){let a=await e.json();throw Error(a.error||"Failed to load members")}let a=await e.json();_(a.members||[])}catch(e){console.error("Error loading members:",e),D(e instanceof Error?e.message:"Failed to load members")}finally{S(!1)}},q=()=>{B(null),E(!0)},O=async()=>{if(L){I(!0);try{let e=await fetch(`${y}/${L}`,{method:"DELETE"});if(!e.ok){let a=await e.json();throw Error(a.error||"Failed to delete member")}j.toast.success("Member removed successfully"),F(!1),R(null),await U()}catch(e){console.error("Error deleting member:",e),j.toast.error(e instanceof Error?e.message:"Failed to delete member")}finally{I(!1)}}},z=e=>{if(e.full_name)return e.full_name;let a=[e.first_name,e.middle_name,e.last_name,e.name_suffix].filter(Boolean);return a.length>0?a.join(" "):"Unknown"};return T?(0,a.jsx)(m.Card,{children:(0,a.jsx)(m.CardContent,{className:"py-12 text-center",children:(0,a.jsx)("div",{className:"animate-pulse",children:"Loading members..."})})}):k?(0,a.jsx)(m.Card,{children:(0,a.jsxs)(m.CardContent,{className:"py-12 text-center",children:[(0,a.jsx)(d.AlertCircle,{className:"w-12 h-12 mx-auto text-destructive mb-4"}),(0,a.jsx)("p",{className:"text-destructive",children:k}),(0,a.jsx)(o.Button,{onClick:U,variant:"outline",className:"mt-4",children:"Retry"})]})}):(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)(m.Card,{children:[(0,a.jsx)(m.CardHeader,{children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)(m.CardTitle,{className:"flex items-center gap-2",children:[(0,a.jsx)(t.Users,{className:"h-5 w-5"}),w]}),(0,a.jsx)(m.CardDescription,{children:v})]}),N&&(0,a.jsxs)(o.Button,{onClick:q,children:[(0,a.jsx)(r.UserPlus,{className:"w-4 h-4 mr-2"}),"Add Member"]})]})}),(0,a.jsx)(m.CardContent,{children:0===C.length?(0,a.jsxs)("div",{className:"text-center py-12",children:[(0,a.jsx)(t.Users,{className:"w-12 h-12 mx-auto text-muted-foreground mb-4"}),(0,a.jsx)("p",{className:"text-muted-foreground mb-4",children:"No members added yet. Add directors, shareholders, or beneficial owners."}),N&&(0,a.jsxs)(o.Button,{onClick:q,variant:"outline",children:[(0,a.jsx)(r.UserPlus,{className:"w-4 h-4 mr-2"}),"Add Your First Member"]})]}):(0,a.jsxs)(x.Table,{children:[(0,a.jsx)(x.TableHeader,{children:(0,a.jsxs)(x.TableRow,{children:[(0,a.jsx)(x.TableHead,{children:"Name"}),(0,a.jsx)(x.TableHead,{children:"Role"}),(0,a.jsx)(x.TableHead,{children:"Email"}),(0,a.jsx)(x.TableHead,{children:"Ownership %"}),(0,a.jsx)(x.TableHead,{children:"KYC Status"}),N&&(0,a.jsx)(x.TableHead,{className:"text-right",children:"Actions"})]})}),(0,a.jsx)(x.TableBody,{children:C.map(e=>{let s;return(0,a.jsxs)(x.TableRow,{children:[(0,a.jsxs)(x.TableCell,{className:"font-medium",children:[z(e),e.is_beneficial_owner&&(0,a.jsx)(h.Badge,{variant:"secondary",className:"ml-2 text-xs",children:"UBO"}),e.is_signatory&&(0,a.jsx)(h.Badge,{variant:"secondary",className:"ml-2 text-xs",children:"Signatory"})]}),(0,a.jsxs)(x.TableCell,{children:[(s=e.role,(0,a.jsx)(h.Badge,{variant:"outline",children:g[s]||s})),e.role_title&&(0,a.jsxs)("span",{className:"text-sm text-muted-foreground ml-2",children:["(",e.role_title,")"]})]}),(0,a.jsx)(x.TableCell,{children:e.email||"N/A"}),(0,a.jsx)(x.TableCell,{children:null!=e.ownership_percentage?`${e.ownership_percentage}%`:"N/A"}),(0,a.jsx)(x.TableCell,{children:(e=>{switch(e){case"approved":return(0,a.jsxs)(h.Badge,{className:"bg-green-500",children:[(0,a.jsx)(n.ShieldCheck,{className:"w-3 h-3 mr-1"}),"Approved"]});case"pending":case"submitted":return(0,a.jsxs)(h.Badge,{className:"bg-yellow-500",children:[(0,a.jsx)(c.Clock,{className:"w-3 h-3 mr-1"}),"Pending"]});case"rejected":return(0,a.jsxs)(h.Badge,{className:"bg-red-500",children:[(0,a.jsx)(d.AlertCircle,{className:"w-3 h-3 mr-1"}),"Rejected"]});default:return(0,a.jsx)(h.Badge,{variant:"outline",children:"Not Submitted"})}})(e.kyc_status)}),N&&(0,a.jsx)(x.TableCell,{className:"text-right",children:(0,a.jsxs)("div",{className:"flex items-center justify-end gap-2",children:[(0,a.jsx)(o.Button,{variant:"outline",size:"sm",onClick:()=>{B(e),E(!0)},children:(0,a.jsx)(i.Edit,{className:"w-4 h-4"})}),(0,a.jsx)(o.Button,{variant:"outline",size:"sm",onClick:()=>{R(e.id),F(!0)},children:(0,a.jsx)(l.Trash2,{className:"w-4 h-4"})})]})})]},e.id)})})]})})]}),(0,a.jsx)(p.MemberKYCEditDialog,{open:A,onOpenChange:E,entityType:e,entityId:b,memberId:P?.id,memberName:P?z(P):void 0,initialData:(e=>{if(e)return{role:e.role,first_name:e.first_name||"",middle_name:e.middle_name||"",last_name:e.last_name||"",name_suffix:e.name_suffix||"",date_of_birth:e.date_of_birth||"",country_of_birth:e.country_of_birth||"",nationality:e.nationality||"",email:e.email||"",phone_mobile:e.phone_mobile||"",phone_office:e.phone_office||"",residential_street:e.residential_street||"",residential_line_2:e.residential_line_2||"",residential_city:e.residential_city||"",residential_state:e.residential_state||"",residential_postal_code:e.residential_postal_code||"",residential_country:e.residential_country||"",is_us_citizen:e.is_us_citizen||!1,is_us_taxpayer:e.is_us_taxpayer||!1,us_taxpayer_id:e.us_taxpayer_id||"",country_of_tax_residency:e.country_of_tax_residency||"",tax_id_number:e.tax_id_number||"",id_type:e.id_type||"",id_number:e.id_number||"",id_issue_date:e.id_issue_date||"",id_expiry_date:e.id_expiry_date||"",id_issuing_country:e.id_issuing_country||"",ownership_percentage:e.ownership_percentage}})(P),apiEndpoint:y,onSuccess:()=>{U()},mode:P?"edit":"create"}),(0,a.jsx)(u.AlertDialog,{open:M,onOpenChange:F,children:(0,a.jsxs)(u.AlertDialogContent,{children:[(0,a.jsxs)(u.AlertDialogHeader,{children:[(0,a.jsx)(u.AlertDialogTitle,{children:"Remove Member"}),(0,a.jsx)(u.AlertDialogDescription,{children:"Are you sure you want to remove this member? This action can be undone by contacting support."})]}),(0,a.jsxs)(u.AlertDialogFooter,{children:[(0,a.jsx)(u.AlertDialogCancel,{disabled:H,children:"Cancel"}),(0,a.jsx)(u.AlertDialogAction,{onClick:O,disabled:H,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:H?"Removing...":"Remove"})]})]})})]})}e.s(["GenericEntityMembersTab",()=>b])}]);