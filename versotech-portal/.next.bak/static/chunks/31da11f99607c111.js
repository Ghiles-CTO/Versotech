(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,90613,e=>{"use strict";var t=e.i(722679),a=e.i(282141);function r({className:e,...r}){return(0,t.jsx)("div",{"data-slot":"card",className:(0,a.cn)("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",e),...r})}function s({className:e,...r}){return(0,t.jsx)("div",{"data-slot":"card-header",className:(0,a.cn)("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-1.5 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",e),...r})}function l({className:e,...r}){return(0,t.jsx)("div",{"data-slot":"card-title",className:(0,a.cn)("leading-none font-semibold",e),...r})}function n({className:e,...r}){return(0,t.jsx)("div",{"data-slot":"card-description",className:(0,a.cn)("text-muted-foreground text-sm",e),...r})}function i({className:e,...r}){return(0,t.jsx)("div",{"data-slot":"card-content",className:(0,a.cn)("px-6",e),...r})}function o({className:e,...r}){return(0,t.jsx)("div",{"data-slot":"card-footer",className:(0,a.cn)("flex items-center px-6 [.border-t]:pt-6",e),...r})}e.s(["Card",()=>r,"CardContent",()=>i,"CardDescription",()=>n,"CardFooter",()=>o,"CardHeader",()=>s,"CardTitle",()=>l])},816654,e=>{"use strict";var t=e.i(722679),a=e.i(340915),r=e.i(282141);let s=a.forwardRef(({className:e,...a},s)=>(0,t.jsx)("textarea",{className:(0,r.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:border-ring disabled:cursor-not-allowed disabled:opacity-50",e),ref:s,...a}));s.displayName="Textarea",e.s(["Textarea",()=>s])},396064,e=>{"use strict";let t=(0,e.i(410587).default)("upload",[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]]);e.s(["Upload",()=>t],396064)},299407,e=>{"use strict";var t=e.i(722679),a=e.i(340915),r=e.i(603274),s=e.i(90613),l=e.i(316264),n=e.i(191569),i=e.i(514133),o=e.i(816654),c=e.i(538892),d=e.i(396132),m=e.i(30100),u=e.i(263229),h=e.i(396064),x=e.i(820417),p=e.i(337684);function g({entities:e,arrangerEntities:g=[],basePath:j="/versotech/staff"}){let v=(0,r.useRouter)(),[y,f]=(0,a.useState)(1),[N,_]=(0,a.useState)(!1),[b,S]=(0,a.useState)(null),[C,w]=(0,a.useState)({name:"",company_name:"",deal_type:"equity_secondary",stock_type:"common",vehicle_id:"",arranger_entity_id:"",sector:"",stage:"",location:"",currency:"USD",target_amount:"",open_at:"",close_at:"",description:"",investment_thesis:""}),[I,F]=(0,a.useState)(!1),[T,k]=(0,a.useState)(null),[D,L]=(0,a.useState)(""),[E,B]=(0,a.useState)("none"),$=(0,a.useMemo)(()=>e.find(e=>e.id===C.vehicle_id),[e,C.vehicle_id]),A=$?.logo_url??"";(0,a.useEffect)(()=>{if(!$){"entity"===E&&B(D?"manual":"none");return}A?"manual"!==E&&(D!==A&&L(A),"entity"!==E&&B("entity"),k(null)):"entity"===E&&(L(""),B("none"))},[$,A,E,D]);let O=(e,t)=>{w(a=>({...a,[e]:t}))},P=async()=>{_(!0),S(null);try{let e={name:C.name.trim(),company_name:C.company_name.trim()||null,deal_type:C.deal_type,stock_type:C.stock_type||null,vehicle_id:C.vehicle_id||null,arranger_entity_id:C.arranger_entity_id||null,sector:C.sector.trim()||null,stage:C.stage.trim()||null,location:C.location.trim()||null,currency:C.currency,target_amount:C.target_amount?parseFloat(C.target_amount):null,open_at:C.open_at||null,close_at:C.close_at||null,description:C.description.trim()||null,investment_thesis:C.investment_thesis.trim()||null,company_logo_url:D||void 0};console.log("[CreateDealForm] Submitting payload:",e);let t=await fetch("/api/deals",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok){console.error("[CreateDealForm] Response not OK:",t.status,t.statusText);let e={};try{e=await t.json(),console.error("[CreateDealForm] Error response:",e)}catch(e){throw console.error("[CreateDealForm] Failed to parse error response:",e),Error(`Server error: ${t.status} ${t.statusText}`)}if(e.details&&Array.isArray(e.details)){let t=e.details.map(e=>`${e.path.join(".")}: ${e.message}`).join(", ");throw Error(`Validation failed: ${t}`)}throw Error(e.error||e.details||`Failed to create deal (${t.status})`)}let{deal:a}=await t.json();v.push(`${j}/deals/${a.id}`)}catch(e){S(e.message),_(!1)}};return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-3xl font-bold text-foreground",children:"Create New Deal"}),(0,t.jsx)("p",{className:"text-muted-foreground mt-1",children:"Set up a new investment opportunity"})]}),(0,t.jsx)(x.default,{href:`${j}/deals`,children:(0,t.jsxs)(l.Button,{variant:"ghost",className:"gap-2",children:[(0,t.jsx)(d.ArrowLeft,{className:"h-4 w-4"}),"Back to Deals"]})})]}),(0,t.jsx)("div",{className:"flex items-center justify-center gap-4",children:[1,2,3].map(e=>(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("div",{className:`w-10 h-10 rounded-full flex items-center justify-center font-medium transition-colors ${e===y?"bg-emerald-500 text-white":e<y?"bg-emerald-500/50 text-white":"bg-muted text-muted-foreground"}`,children:e}),(0,t.jsx)("span",{className:`text-sm ${e===y?"text-foreground font-medium":"text-muted-foreground"}`,children:1===e?"Basic Info":2===e?"Pipeline":"Timeline & Details"}),e<3&&(0,t.jsx)(m.ArrowRight,{className:"h-4 w-4 text-muted-foreground ml-2"})]},e))}),(0,t.jsxs)(s.Card,{className:"border-border bg-muted/50",children:[(0,t.jsxs)(s.CardHeader,{children:[(0,t.jsx)(s.CardTitle,{className:"text-foreground",children:1===y?"Basic Information":2===y?"Pipeline & Currency":"Timeline & Description"}),(0,t.jsx)(s.CardDescription,{children:1===y?"Enter the core details about this investment opportunity":2===y?"Set the target amount and currency. Investment limits (min/max) are defined in the termsheet.":"Set dates and provide context about the deal"})]}),(0,t.jsxs)(s.CardContent,{className:"space-y-6",children:[1===y&&(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(i.Label,{htmlFor:"name",className:"text-foreground",children:"Deal Name *"}),(0,t.jsx)(n.Input,{id:"name",placeholder:"e.g., Concluder Secondary Q1 2025",value:C.name,onChange:e=>O("name",e.target.value),required:!0})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(i.Label,{htmlFor:"company_name",className:"text-foreground",children:"Company Name"}),(0,t.jsx)(n.Input,{id:"company_name",placeholder:"e.g., Concluder Inc.",value:C.company_name,onChange:e=>O("company_name",e.target.value)})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(i.Label,{htmlFor:"deal_type",className:"text-foreground",children:"Deal Type *"}),(0,t.jsxs)(c.Select,{value:C.deal_type,onValueChange:e=>O("deal_type",e),children:[(0,t.jsx)(c.SelectTrigger,{children:(0,t.jsx)(c.SelectValue,{})}),(0,t.jsxs)(c.SelectContent,{children:[(0,t.jsx)(c.SelectItem,{value:"equity_secondary",children:"Secondary Equity"}),(0,t.jsx)(c.SelectItem,{value:"equity_primary",children:"Primary Equity"}),(0,t.jsx)(c.SelectItem,{value:"credit_trade_finance",children:"Credit & Trade Finance"}),(0,t.jsx)(c.SelectItem,{value:"other",children:"Other"})]})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(i.Label,{htmlFor:"stock_type",className:"text-foreground",children:"Stock Type *"}),(0,t.jsxs)(c.Select,{value:C.stock_type,onValueChange:e=>O("stock_type",e),children:[(0,t.jsx)(c.SelectTrigger,{children:(0,t.jsx)(c.SelectValue,{})}),(0,t.jsxs)(c.SelectContent,{children:[(0,t.jsx)(c.SelectItem,{value:"common",children:"Common/Ordinary Shares"}),(0,t.jsx)(c.SelectItem,{value:"preferred",children:"Preferred Shares"}),(0,t.jsx)(c.SelectItem,{value:"convertible",children:"Convertible Notes"}),(0,t.jsx)(c.SelectItem,{value:"warrant",children:"Warrants"}),(0,t.jsx)(c.SelectItem,{value:"bond",children:"Bonds"}),(0,t.jsx)(c.SelectItem,{value:"note",children:"Notes"}),(0,t.jsx)(c.SelectItem,{value:"other",children:"Other"})]})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("div",{className:"flex items-center justify-between",children:(0,t.jsx)(i.Label,{htmlFor:"vehicle_id",className:"text-foreground",children:"Entity (Optional)"})}),(0,t.jsxs)(c.Select,{value:C.vehicle_id||"none",onValueChange:t=>{let a="none"===t?"":t;if(O("vehicle_id",a),a){let t=e.find(e=>e.id===a);t?.arranger_entity_id&&!C.arranger_entity_id&&O("arranger_entity_id",t.arranger_entity_id)}},children:[(0,t.jsx)(c.SelectTrigger,{children:(0,t.jsx)(c.SelectValue,{placeholder:"Select entity or skip"})}),(0,t.jsxs)(c.SelectContent,{children:[(0,t.jsx)(c.SelectItem,{value:"none",children:"No entity - Direct deal"}),e.map(e=>(0,t.jsxs)(c.SelectItem,{value:e.id,children:[e.name," (",e.type,")"]},e.id))]})]}),(0,t.jsxs)("p",{className:"text-xs text-muted-foreground",children:['Choose an entity for pooled investments, or "No entity" for direct ownership deals. Manage entities from'," ",(0,t.jsx)(x.default,{href:`${j}/entities`,className:"text-emerald-300 hover:text-emerald-200 underline",children:"Entities"})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(i.Label,{htmlFor:"arranger_entity_id",className:"text-foreground",children:"Arranger (Optional)"}),(0,t.jsxs)(c.Select,{value:C.arranger_entity_id||"none",onValueChange:e=>O("arranger_entity_id","none"===e?"":e),children:[(0,t.jsx)(c.SelectTrigger,{children:(0,t.jsx)(c.SelectValue,{placeholder:"Select arranger or skip"})}),(0,t.jsxs)(c.SelectContent,{children:[(0,t.jsx)(c.SelectItem,{value:"none",children:"No Arranger"}),g.map(e=>(0,t.jsx)(c.SelectItem,{value:e.id,children:e.company_name||e.legal_name},e.id))]})]}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:"Assign an arranger to manage this deal (mandate)"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(i.Label,{htmlFor:"sector",className:"text-foreground",children:"Sector"}),(0,t.jsx)(n.Input,{id:"sector",placeholder:"e.g., SaaS, FinTech",value:C.sector,onChange:e=>O("sector",e.target.value)})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(i.Label,{htmlFor:"stage",className:"text-foreground",children:"Stage"}),(0,t.jsx)(n.Input,{id:"stage",placeholder:"e.g., Series B, Growth",value:C.stage,onChange:e=>O("stage",e.target.value)})]}),(0,t.jsxs)("div",{className:"space-y-2 md:col-span-2",children:[(0,t.jsx)(i.Label,{htmlFor:"location",className:"text-foreground",children:"Location"}),(0,t.jsx)(n.Input,{id:"location",placeholder:"e.g., San Francisco, USA",value:C.location,onChange:e=>O("location",e.target.value)})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(i.Label,{className:"text-foreground",children:"Company Logo"}),(0,t.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[D?(0,t.jsx)(p.default,{src:D,alt:`${($?.name??C.name)||"Deal"} logo`,width:56,height:56,className:"rounded-lg object-contain bg-white border border-gray-200 p-2"}):(0,t.jsx)("div",{className:"h-14 w-14 rounded-lg bg-muted border border-border flex items-center justify-center text-muted-foreground",children:"56×56"}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("label",{className:"inline-flex items-center gap-2 px-3 py-2 border rounded-md cursor-pointer text-sm",onClick:()=>{"entity"===E&&(B("manual"),L(""))},children:[(0,t.jsx)(h.Upload,{className:"h-4 w-4"}),(0,t.jsx)("span",{children:"entity"===E?"Replace Logo":"Upload Logo"}),(0,t.jsx)("input",{type:"file",accept:"image/*",className:"hidden",onChange:async e=>{let t=e.target.files?.[0];if(t){k(null),F(!0);try{let e=new FormData;e.append("file",t),e.append("deal_id","new");let a=await fetch("/api/deals/logo-upload",{method:"POST",body:e}),r=await a.json().catch(()=>({}));if(!a.ok||!r?.url)throw Error(r?.error||"Failed to upload logo");L(r.url),B("manual")}catch(e){k(e instanceof Error?e.message:"Failed to upload logo")}finally{F(!1),e.target.value=""}}}})]}),$?.logo_url&&"manual"===E&&(0,t.jsxs)(l.Button,{type:"button",variant:"ghost",size:"sm",className:"px-0 text-xs text-emerald-300 hover:text-emerald-200",onClick:()=>{L($.logo_url??""),B("entity"),k(null)},children:["Use ",$.name," logo"]}),I&&(0,t.jsx)("span",{className:"text-xs text-muted-foreground",children:"Uploading…"})]})]}),T&&(0,t.jsx)("p",{className:"text-xs text-rose-500",children:T}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:"entity"===E&&$?.name?`Prefilled from ${$.name}. Replace if you need a different logo.`:"Optional branding shown to investors."})]})]})]}),2===y&&(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(i.Label,{htmlFor:"currency",className:"text-foreground",children:"Currency *"}),(0,t.jsxs)(c.Select,{value:C.currency,onValueChange:e=>O("currency",e),children:[(0,t.jsx)(c.SelectTrigger,{children:(0,t.jsx)(c.SelectValue,{})}),(0,t.jsxs)(c.SelectContent,{children:[(0,t.jsx)(c.SelectItem,{value:"USD",children:"USD"}),(0,t.jsx)(c.SelectItem,{value:"EUR",children:"EUR"}),(0,t.jsx)(c.SelectItem,{value:"GBP",children:"GBP"})]})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(i.Label,{htmlFor:"target_amount",className:"text-foreground",children:"Target Amount"}),(0,t.jsx)(n.Input,{id:"target_amount",type:"number",step:"1",placeholder:"5000000",value:C.target_amount,onChange:e=>O("target_amount",e.target.value)}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:"Total amount you aim to raise for this deal"})]})]}),(0,t.jsx)("div",{className:"p-4 rounded-lg bg-amber-500/10 border border-amber-500/20",children:(0,t.jsxs)("p",{className:"text-sm text-amber-700 dark:text-amber-200",children:[(0,t.jsx)("strong",{children:"Note:"})," Investment terms (price per share, minimum/maximum investment) are set in the Term Sheet after creating this deal. The termsheet is the source of truth for investor-facing financial details."]})})]}),3===y&&(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(i.Label,{htmlFor:"open_at",className:"text-foreground",children:"Open Date"}),(0,t.jsx)(n.Input,{id:"open_at",type:"datetime-local",value:C.open_at,onChange:e=>O("open_at",e.target.value)})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(i.Label,{htmlFor:"close_at",className:"text-foreground",children:"Close Date"}),(0,t.jsx)(n.Input,{id:"close_at",type:"datetime-local",value:C.close_at,onChange:e=>O("close_at",e.target.value)})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(i.Label,{htmlFor:"description",className:"text-foreground",children:"Description"}),(0,t.jsx)(o.Textarea,{id:"description",placeholder:"Provide a brief overview of this investment opportunity...",rows:4,value:C.description,onChange:e=>O("description",e.target.value)})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(i.Label,{htmlFor:"investment_thesis",className:"text-foreground",children:"Investment Thesis"}),(0,t.jsx)(o.Textarea,{id:"investment_thesis",placeholder:"Explain why this is an attractive investment...",rows:6,value:C.investment_thesis,onChange:e=>O("investment_thesis",e.target.value)})]})]}),b&&(0,t.jsx)("div",{className:"p-4 rounded-lg bg-red-500/20 border border-red-400/30 text-red-700 dark:text-red-200",children:b}),(0,t.jsxs)("div",{className:"flex items-center justify-between pt-4 border-t border-border",children:[(0,t.jsxs)(l.Button,{variant:"outline",onClick:()=>f(e=>Math.max(1,e-1)),disabled:1===y||N,children:[(0,t.jsx)(d.ArrowLeft,{className:"h-4 w-4 mr-2"}),"Previous"]}),y<3?(0,t.jsxs)(l.Button,{onClick:()=>f(e=>Math.min(3,e+1)),disabled:!C.name,children:["Next",(0,t.jsx)(m.ArrowRight,{className:"h-4 w-4 ml-2"})]}):(0,t.jsx)(l.Button,{onClick:P,disabled:N||!C.name,children:N?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(u.Loader2,{className:"h-4 w-4 mr-2 animate-spin"}),"Creating..."]}):"Create Deal"})]})]})]})]})}e.s(["CreateDealForm",()=>g])}]);