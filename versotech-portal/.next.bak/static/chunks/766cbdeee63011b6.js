(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,284516,e=>{"use strict";var a=e.i(722679),t=e.i(340915),s=e.i(90613),r=e.i(129432),l=e.i(316264),n=e.i(191569),i=e.i(538892),c=e.i(237635),d=e.i(501259),o=e.i(971743),m=e.i(15098),x=e.i(750809),u=e.i(263229),h=e.i(401148),p=e.i(416469),j=e.i(773510),f=e.i(540318),g=e.i(119311),v=e.i(196767),N=e.i(197098),_=e.i(733179),y=e.i(282141),C=e.i(501495),b=e.i(59178),w=e.i(820417),S=e.i(150327),T=e.i(429760),P=e.i(661521),F=e.i(957114),D=e.i(398472);e.i(209586);var R=e.i(52571),k=e.i(352776),B=e.i(514133),L=e.i(816654),H=e.i(168474);let I=[{value:"invested_amount",label:"Invested Amount"},{value:"spread",label:"Spread"},{value:"management_fee",label:"Management Fee"},{value:"performance_fee",label:"Performance Fee"}];function E({open:e,onOpenChange:s,partnerId:r,partnerName:c,deals:d,feePlans:o,onSuccess:m}){let[x,h]=(0,t.useState)(!1),[p,j]=(0,t.useState)(null),[f,g]=(0,t.useState)(""),[v,N]=(0,t.useState)(""),[_,y]=(0,t.useState)("invested_amount"),[b,w]=(0,t.useState)(""),[S,T]=(0,t.useState)(""),[P,F]=(0,t.useState)(""),[D,R]=(0,t.useState)("USD"),[E,U]=(0,t.useState)(""),[V,O]=(0,t.useState)("");(0,t.useEffect)(()=>{e&&(g(""),N(""),y("invested_amount"),w(""),T(""),F(""),R("USD"),U(""),O(""),j(null))},[e]),(0,t.useEffect)(()=>{if(b&&S){let e=parseFloat(b)/1e4,a=parseFloat(S);isNaN(e)||isNaN(a)||F((a*e).toFixed(2))}},[b,S]),(0,t.useEffect)(()=>{if(f){let e=d.find(e=>e.id===f);e?.currency&&R(e.currency)}},[f,d]),(0,t.useEffect)(()=>{if(v){let e=o.find(e=>e.id===v);if(e?.components&&e.components.length>0){let a=e.components.find(e=>e.rate_bps);a?.rate_bps&&w(a.rate_bps.toString())}}},[v,o]);let A=async()=>{if(!b||0>=parseFloat(b))return void j("Rate is required and must be greater than 0");if(!P||0>=parseFloat(P))return void j("Commission amount is required and must be greater than 0");h(!0),j(null);try{let e={partner_id:r,deal_id:f||void 0,fee_plan_id:v||void 0,basis_type:_,rate_bps:parseInt(b,10),base_amount:S?parseFloat(S):void 0,accrual_amount:parseFloat(P),currency:D,payment_due_date:E||void 0,notes:V||void 0},a=await fetch("/api/arrangers/me/partner-commissions",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!a.ok){let e=await a.json();throw Error(e.error||"Failed to record commission")}m(),s(!1)}catch(e){console.error("[RecordCommissionDialog] Error:",e),j(e instanceof Error?e.message:"Failed to record commission")}finally{h(!1)}},q=b?(parseFloat(b)/100).toFixed(2):"0.00";return(0,a.jsx)(k.Dialog,{open:e,onOpenChange:s,children:(0,a.jsxs)(k.DialogContent,{className:"max-w-lg",children:[(0,a.jsxs)(k.DialogHeader,{children:[(0,a.jsx)(k.DialogTitle,{children:"Record Commission"}),(0,a.jsxs)(k.DialogDescription,{children:["Record a commission owed to ",c]})]}),(0,a.jsxs)("div",{className:"space-y-4 py-4",children:[p&&(0,a.jsx)("div",{className:"bg-destructive/10 border border-destructive/30 text-destructive text-sm p-3 rounded",children:p}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(B.Label,{children:"Deal (Optional)"}),(0,a.jsxs)(i.Select,{value:f,onValueChange:g,children:[(0,a.jsx)(i.SelectTrigger,{children:(0,a.jsx)(i.SelectValue,{placeholder:"Select deal..."})}),(0,a.jsxs)(i.SelectContent,{children:[(0,a.jsx)(i.SelectItem,{value:"",children:"No specific deal"}),d.map(e=>(0,a.jsxs)(i.SelectItem,{value:e.id,children:[e.name," ",e.company_name&&`(${e.company_name})`]},e.id))]})]})]}),o.length>0&&(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(B.Label,{children:"Fee Plan (Optional)"}),(0,a.jsxs)(i.Select,{value:v,onValueChange:N,children:[(0,a.jsx)(i.SelectTrigger,{children:(0,a.jsx)(i.SelectValue,{placeholder:"Select fee plan..."})}),(0,a.jsxs)(i.SelectContent,{children:[(0,a.jsx)(i.SelectItem,{value:"",children:"No fee plan"}),o.map(e=>(0,a.jsx)(i.SelectItem,{value:e.id,children:e.name},e.id))]})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(B.Label,{children:"Commission Basis"}),(0,a.jsxs)(i.Select,{value:_,onValueChange:y,children:[(0,a.jsx)(i.SelectTrigger,{children:(0,a.jsx)(i.SelectValue,{})}),(0,a.jsx)(i.SelectContent,{children:I.map(e=>(0,a.jsx)(i.SelectItem,{value:e.value,children:e.label},e.value))})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(B.Label,{children:"Rate (basis points) *"}),(0,a.jsx)(n.Input,{type:"number",value:b,onChange:e=>w(e.target.value),placeholder:"e.g., 100 = 1%"}),b&&(0,a.jsxs)("p",{className:"text-xs text-muted-foreground",children:["= ",q,"%"]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)(B.Label,{children:["Base Amount (",D,")"]}),(0,a.jsx)(n.Input,{type:"number",value:S,onChange:e=>T(e.target.value),placeholder:"e.g., 100000"})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)(B.Label,{className:"flex items-center gap-2",children:["Commission Amount (",D,") *",b&&S&&(0,a.jsxs)("span",{className:"text-xs text-muted-foreground flex items-center gap-1",children:[(0,a.jsx)(H.Calculator,{className:"h-3 w-3"}),"Auto-calculated"]})]}),(0,a.jsx)(n.Input,{type:"number",value:P,onChange:e=>F(e.target.value),placeholder:"Commission amount"}),P&&(0,a.jsx)("p",{className:"text-sm font-medium text-primary",children:(0,C.formatCurrency)(parseFloat(P),D)})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(B.Label,{children:"Payment Due Date (Optional)"}),(0,a.jsx)(n.Input,{type:"date",value:E,onChange:e=>U(e.target.value)})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(B.Label,{children:"Notes (Optional)"}),(0,a.jsx)(L.Textarea,{value:V,onChange:e=>O(e.target.value),placeholder:"Any additional notes...",rows:2})]})]}),(0,a.jsxs)(k.DialogFooter,{children:[(0,a.jsx)(l.Button,{variant:"outline",onClick:()=>s(!1),disabled:x,children:"Cancel"}),(0,a.jsx)(l.Button,{onClick:A,disabled:x,children:x?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(u.Loader2,{className:"h-4 w-4 mr-2 animate-spin"}),"Recording..."]}):"Record Commission"})]})]})})}var U=e.i(831833);let V={active:"bg-green-100 text-green-800 border-green-200",pending:"bg-yellow-100 text-yellow-800 border-yellow-200",inactive:"bg-gray-100 text-gray-800 border-gray-200",suspended:"bg-red-100 text-red-800 border-red-200"},O={approved:"bg-green-100 text-green-800",pending:"bg-yellow-100 text-yellow-800",expired:"bg-red-100 text-red-800",not_started:"bg-gray-100 text-gray-800"};function A({partnerId:e,open:n,onOpenChange:i}){let[c,m]=(0,t.useState)(null),[x,f]=(0,t.useState)(!1),[v,N]=(0,t.useState)(null),[b,k]=(0,t.useState)(!1),B=async()=>{if(e){f(!0),N(null);try{let a=await fetch(`/api/arrangers/me/partners/${e}`);if(!a.ok){let e=await a.json();throw Error(e.error||"Failed to load partner details")}let t=await a.json();m(t.data)}catch(e){console.error("[PartnerDetailDrawer] Error:",e),N(e instanceof Error?e.message:"Failed to load partner details")}finally{f(!1)}}};return(0,t.useEffect)(()=>{if(!n||!e){m(null),N(null);return}B()},[n,e]),(0,a.jsx)(S.Sheet,{open:n,onOpenChange:i,children:(0,a.jsxs)(S.SheetContent,{className:"w-full sm:max-w-xl overflow-y-auto",children:[x&&(0,a.jsxs)("div",{className:"flex items-center justify-center py-16",children:[(0,a.jsx)(u.Loader2,{className:"h-8 w-8 animate-spin text-muted-foreground"}),(0,a.jsx)("span",{className:"ml-3 text-muted-foreground",children:"Loading partner details..."})]}),v&&(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center py-16 text-center",children:[(0,a.jsx)(h.AlertCircle,{className:"h-12 w-12 text-destructive mb-4"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:v}),(0,a.jsx)(l.Button,{variant:"outline",className:"mt-4",onClick:()=>i(!1),children:"Close"})]}),c&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(S.SheetHeader,{className:"pb-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[c.partner.logo_url?(0,a.jsx)("img",{src:c.partner.logo_url,alt:c.partner.name,className:"h-12 w-12 rounded-lg object-cover"}):(0,a.jsx)("div",{className:"h-12 w-12 rounded-lg bg-muted flex items-center justify-center",children:(0,a.jsx)(o.Building2,{className:"h-6 w-6 text-muted-foreground"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)(S.SheetTitle,{children:c.partner.name}),(0,a.jsxs)(S.SheetDescription,{children:[c.partner.partner_type&&(0,a.jsx)("span",{className:"capitalize",children:c.partner.partner_type.replace("_"," ")}),c.partner.country&&` • ${c.partner.country}`]})]})]}),(0,a.jsxs)("div",{className:"flex gap-2 mt-3",children:[(0,a.jsx)(r.Badge,{variant:"outline",className:(0,y.cn)("capitalize",V[c.partner.status]||V.active),children:c.partner.status}),c.partner.kyc_status&&(0,a.jsxs)(r.Badge,{variant:"secondary",className:(0,y.cn)("text-xs",O[c.partner.kyc_status]||""),children:["KYC: ",c.partner.kyc_status.replace("_"," ")]})]})]}),(0,a.jsx)(P.Separator,{className:"my-4"}),(0,a.jsxs)("div",{className:"grid grid-cols-3 gap-3 mb-6",children:[(0,a.jsxs)(s.Card,{className:"p-3",children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-primary",children:c.stats.total_deals}),(0,a.jsx)("div",{className:"text-xs text-muted-foreground",children:"Deals"})]}),(0,a.jsxs)(s.Card,{className:"p-3",children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-blue-600",children:c.stats.total_referrals}),(0,a.jsx)("div",{className:"text-xs text-muted-foreground",children:"Referrals"})]}),(0,a.jsxs)(s.Card,{className:"p-3",children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-purple-600",children:c.stats.active_fee_plans}),(0,a.jsx)("div",{className:"text-xs text-muted-foreground",children:"Fee Plans"})]})]}),(0,a.jsxs)(T.Tabs,{defaultValue:"overview",className:"w-full",children:[(0,a.jsxs)(T.TabsList,{className:"grid w-full grid-cols-4",children:[(0,a.jsx)(T.TabsTrigger,{value:"overview",children:"Overview"}),(0,a.jsx)(T.TabsTrigger,{value:"fees",children:"Fee Plans"}),(0,a.jsx)(T.TabsTrigger,{value:"commissions",children:"Commissions"}),(0,a.jsx)(T.TabsTrigger,{value:"activity",children:"Activity"})]}),(0,a.jsxs)(T.TabsContent,{value:"overview",className:"mt-4 space-y-4",children:[(0,a.jsxs)(s.Card,{children:[(0,a.jsx)(s.CardHeader,{className:"pb-2",children:(0,a.jsx)(s.CardTitle,{className:"text-sm",children:"Contact Information"})}),(0,a.jsxs)(s.CardContent,{className:"space-y-2 text-sm",children:[c.partner.contact_name&&(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(d.Users,{className:"h-4 w-4 text-muted-foreground"}),(0,a.jsx)("span",{children:c.partner.contact_name})]}),c.partner.contact_email&&(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(j.Mail,{className:"h-4 w-4 text-muted-foreground"}),(0,a.jsx)("a",{href:`mailto:${c.partner.contact_email}`,className:"text-primary hover:underline",children:c.partner.contact_email})]}),c.partner.contact_phone&&(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(F.Phone,{className:"h-4 w-4 text-muted-foreground"}),(0,a.jsx)("span",{children:c.partner.contact_phone})]}),c.partner.country&&(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(p.Globe,{className:"h-4 w-4 text-muted-foreground"}),(0,a.jsx)("span",{children:c.partner.country})]})]})]}),c.deals.length>0&&(0,a.jsxs)(s.Card,{children:[(0,a.jsx)(s.CardHeader,{className:"pb-2",children:(0,a.jsx)(s.CardTitle,{className:"text-sm",children:"Deals Involved"})}),(0,a.jsx)(s.CardContent,{children:(0,a.jsx)("div",{className:"space-y-2",children:c.deals.map(e=>(0,a.jsxs)("div",{className:"flex items-center justify-between p-2 rounded-md bg-muted/50",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-medium text-sm",children:e.name}),e.company_name&&(0,a.jsx)("div",{className:"text-xs text-muted-foreground",children:e.company_name})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(r.Badge,{variant:"outline",className:"text-xs capitalize",children:e.status}),(0,a.jsx)(w.default,{href:`/versotech_main/opportunities/${e.id}`,children:(0,a.jsx)(l.Button,{variant:"ghost",size:"sm",children:(0,a.jsx)(D.ExternalLink,{className:"h-3.5 w-3.5"})})})]})]},e.id))})})]})]}),(0,a.jsx)(T.TabsContent,{value:"fees",className:"mt-4 space-y-4",children:0===c.fee_plans.length?(0,a.jsx)(s.Card,{children:(0,a.jsxs)(s.CardContent,{className:"py-8 text-center",children:[(0,a.jsx)(g.FileText,{className:"h-10 w-10 text-muted-foreground mx-auto mb-3"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"No fee plans assigned to this partner"}),(0,a.jsx)(w.default,{href:"/versotech_main/fee-plans",children:(0,a.jsx)(l.Button,{variant:"outline",size:"sm",className:"mt-3",children:"Create Fee Plan"})})]})}):c.fee_plans.map(e=>(0,a.jsxs)(s.Card,{children:[(0,a.jsxs)(s.CardHeader,{className:"pb-2",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)(s.CardTitle,{className:"text-sm",children:e.name}),(0,a.jsx)(r.Badge,{variant:e.is_active?"default":"secondary",children:e.is_active?"Active":"Inactive"})]}),e.description&&(0,a.jsx)(s.CardDescription,{className:"text-xs",children:e.description})]}),(0,a.jsxs)(s.CardContent,{children:[e.components&&e.components.length>0?(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:e.components.map((e,t)=>(0,a.jsxs)(r.Badge,{variant:"outline",className:"text-xs",children:[e.kind,": ",e.rate_bps?`${(e.rate_bps/100).toFixed(2)}%`:e.flat_amount?`$${e.flat_amount}`:"N/A"]},t))}):(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"No fee components defined"}),e.effective_from&&(0,a.jsxs)("p",{className:"text-xs text-muted-foreground mt-2",children:["Effective from ",(0,C.formatDate)(e.effective_from),e.effective_until&&` to ${(0,C.formatDate)(e.effective_until)}`]})]})]},e.id))}),(0,a.jsxs)(T.TabsContent,{value:"commissions",className:"mt-4 space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("h3",{className:"text-sm font-medium",children:"Commission Summary"}),(0,a.jsxs)(l.Button,{size:"sm",onClick:()=>k(!0),children:[(0,a.jsx)(U.Plus,{className:"h-4 w-4 mr-1"}),"Record Commission"]})]}),(0,a.jsx)(R.PartnerCommissionSummary,{summary:c.commission_summary}),(0,a.jsx)("div",{className:"flex justify-end",children:(0,a.jsx)(w.default,{href:"/versotech_main/lawyer-reconciliation",children:(0,a.jsxs)(l.Button,{variant:"outline",size:"sm",children:[(0,a.jsx)(_.TrendingUp,{className:"h-4 w-4 mr-2"}),"View Reconciliation"]})})})]}),(0,a.jsx)(T.TabsContent,{value:"activity",className:"mt-4 space-y-4",children:0===c.recent_referrals.length?(0,a.jsx)(s.Card,{children:(0,a.jsxs)(s.CardContent,{className:"py-8 text-center",children:[(0,a.jsx)(g.FileText,{className:"h-10 w-10 text-muted-foreground mx-auto mb-3"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"No activity yet"})]})}):(0,a.jsxs)(s.Card,{children:[(0,a.jsxs)(s.CardHeader,{className:"pb-2",children:[(0,a.jsx)(s.CardTitle,{className:"text-sm",children:"Recent Activity"}),(0,a.jsx)(s.CardDescription,{className:"text-xs",children:"Fee plan assignments to deals"})]}),(0,a.jsx)(s.CardContent,{children:(0,a.jsx)("div",{className:"space-y-3",children:c.recent_referrals.map(e=>(0,a.jsx)("div",{className:"flex items-center justify-between p-2 rounded-md bg-muted/50",children:(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"font-medium text-sm",children:["Assigned to ",e.deal?.name||"Unknown Deal"]}),(0,a.jsxs)("div",{className:"text-xs text-muted-foreground",children:[e.deal?.company_name&&`${e.deal.company_name} • `,e.created_at&&(0,C.formatDate)(e.created_at)]})]})},e.id))})})]})})]}),(0,a.jsx)(E,{open:b,onOpenChange:k,partnerId:c.partner.id,partnerName:c.partner.name,deals:c.deals,feePlans:c.fee_plans,onSuccess:B})]})]})})}let q={active:"bg-green-100 text-green-800 border-green-200",pending:"bg-yellow-100 text-yellow-800 border-yellow-200",inactive:"bg-gray-100 text-gray-800 border-gray-200",suspended:"bg-red-100 text-red-800 border-red-200"},z={approved:"bg-green-100 text-green-800",pending:"bg-yellow-100 text-yellow-800",expired:"bg-red-100 text-red-800",not_started:"bg-gray-100 text-gray-800"},$=[{label:"All Status",value:"all"},{label:"Active",value:"active"},{label:"Pending",value:"pending"},{label:"Inactive",value:"inactive"}];function M(){let[e,S]=(0,t.useState)(null),[T,P]=(0,t.useState)(null),[F,D]=(0,t.useState)([]),[k,B]=(0,t.useState)([]),[L,H]=(0,t.useState)({totalPartners:0,activePartners:0,totalReferrals:0,totalReferralValue:0,totalOwed:0,totalPaid:0}),[I,E]=(0,t.useState)(!0),[U,V]=(0,t.useState)(null),[O,M]=(0,t.useState)(""),[K,G]=(0,t.useState)("all"),[Y,J]=(0,t.useState)("all"),[Q,W]=(0,t.useState)(null),[X,Z]=(0,t.useState)(!1);(0,t.useEffect)(()=>{async function e(e){let{data:a,error:t}=await e.from("partners").select("*").order("name").limit(100);if(t)throw t;let s={accrued:0,invoice_requested:0,invoiced:0,paid:0,cancelled:0,total_owed:0,currency:"USD"},r=(a||[]).map(e=>({id:e.id,name:e.name||e.legal_name||"Unknown Partner",legal_name:e.legal_name,partner_type:e.partner_type,status:e.status||"active",contact_name:e.contact_name,contact_email:e.contact_email,contact_phone:e.contact_phone,country:e.country,logo_url:e.logo_url,kyc_status:e.kyc_status,deals_count:0,referrals_count:0,total_referral_value:0,last_activity:null,fee_plans:[],commission_summary:s}));D(r),H({totalPartners:r.length,activePartners:r.filter(e=>"active"===e.status).length,totalReferrals:0,totalReferralValue:0,totalOwed:0,totalPaid:0})}!async function(){try{E(!0);let a=(0,b.createClient)(),{data:{user:t}}=await a.auth.getUser();if(!t)return void V("Not authenticated");let{data:s,error:r}=await a.from("arranger_users").select("arranger_id").eq("user_id",t.id).single();if(r||!s)return void await e(a);P(s.arranger_id);let{data:l,error:n}=await a.from("arranger_entities").select("id, legal_name, status").eq("id",s.arranger_id).single();if(n)throw n;S(l);let{data:i,error:c}=await a.from("deals").select("id, name, company_name").eq("arranger_entity_id",s.arranger_id).order("name");if(c)throw c;if(B(i||[]),!i||0===i.length){D([]),H({totalPartners:0,activePartners:0,totalReferrals:0,totalReferralValue:0,totalOwed:0,totalPaid:0});return}let d=i.map(e=>e.id),{data:o,error:m}=await a.from("fee_plans").select(`
            id,
            name,
            is_active,
            partner_id,
            deal_id,
            created_at,
            deal:deals(id, name, currency, created_at)
          `).in("deal_id",d).not("partner_id","is",null);if(m)throw m;let x=[...new Set((o||[]).map(e=>e.partner_id).filter(Boolean))];if(0===x.length){D([]),H({totalPartners:0,activePartners:0,totalReferrals:0,totalReferralValue:0,totalOwed:0,totalPaid:0});return}let{data:u,error:h}=await a.from("partners").select("*").in("id",x).order("name");if(h)throw h;let p=new Map,j=new Map;(o||[]).forEach(e=>{if(!e.partner_id)return;let a=p.get(e.partner_id)||[];a.push({id:e.id,name:e.name,is_active:e.is_active}),p.set(e.partner_id,a);let t=j.get(e.partner_id)||new Set;e.deal_id&&t.add(e.deal_id),j.set(e.partner_id,t)});let{data:f}=await a.from("partner_commissions").select("partner_id, status, accrual_amount, currency").in("partner_id",x).eq("arranger_id",s.arranger_id),g=new Map;x.forEach(e=>{g.set(e,{accrued:0,invoice_requested:0,invoice_submitted:0,invoiced:0,paid:0,cancelled:0,total_owed:0,currency:"USD"})}),(f||[]).forEach(e=>{let a=g.get(e.partner_id);if(!a)return;let t=Number(e.accrual_amount)||0;"accrued"===e.status?a.accrued+=t:"invoice_requested"===e.status?a.invoice_requested+=t:"invoice_submitted"===e.status?a.invoice_submitted=(a.invoice_submitted||0)+t:"invoiced"===e.status?a.invoiced+=t:"paid"===e.status?a.paid+=t:"cancelled"===e.status&&(a.cancelled+=t),["accrued","invoice_requested","invoice_submitted","invoiced"].includes(e.status)&&(a.total_owed+=t),e.currency&&(a.currency=e.currency)});let v=(u||[]).map(e=>{let a=p.get(e.id)||[],t=j.get(e.id)||new Set;return{id:e.id,name:e.name||e.legal_name||"Unknown Partner",legal_name:e.legal_name,partner_type:e.partner_type,status:e.status||"active",contact_name:e.contact_name,contact_email:e.contact_email,contact_phone:e.contact_phone,country:e.country,logo_url:e.logo_url,kyc_status:e.kyc_status,deals_count:t.size,referrals_count:0,total_referral_value:0,last_activity:null,fee_plans:a,commission_summary:g.get(e.id)||{accrued:0,invoice_requested:0,invoice_submitted:0,invoiced:0,paid:0,cancelled:0,total_owed:0,currency:"USD"}}});D(v);let N=v.filter(e=>"active"===e.status).length,_=v.reduce((e,a)=>e+a.referrals_count,0),y=v.reduce((e,a)=>e+a.total_referral_value,0),C=v.reduce((e,a)=>e+a.commission_summary.total_owed,0),w=v.reduce((e,a)=>e+a.commission_summary.paid,0);H({totalPartners:v.length,activePartners:N,totalReferrals:_,totalReferralValue:y,totalOwed:C,totalPaid:w}),V(null)}catch(e){console.error("[MyPartnersPage] Error:",e),V(e instanceof Error?e.message:"Failed to load partners")}finally{E(!1)}}()},[]);let ee=F.filter(e=>{let a="all"===K||e.status===K,t=!O||e.name?.toLowerCase().includes(O.toLowerCase())||e.legal_name?.toLowerCase().includes(O.toLowerCase())||e.contact_name?.toLowerCase().includes(O.toLowerCase())||e.country?.toLowerCase().includes(O.toLowerCase()),s="all"===Y;return a&&t&&s});return I?(0,a.jsxs)("div",{className:"flex items-center justify-center py-16",children:[(0,a.jsx)(u.Loader2,{className:"h-8 w-8 animate-spin text-muted-foreground"}),(0,a.jsx)("span",{className:"ml-3 text-muted-foreground",children:"Loading partners..."})]}):U?(0,a.jsxs)("div",{className:"text-center py-16",children:[(0,a.jsx)(h.AlertCircle,{className:"h-12 w-12 text-destructive mx-auto mb-4"}),(0,a.jsx)("h3",{className:"text-lg font-medium text-foreground mb-2",children:"Error Loading Partners"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:U})]}):(0,a.jsxs)("div",{className:"p-6 space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-foreground",children:"My Partners"}),(0,a.jsx)("p",{className:"text-muted-foreground mt-1",children:e?`Partners working with ${e.legal_name}`:"View all distribution partners"})]}),(0,a.jsx)(w.default,{href:"/versotech_main/fee-plans",children:(0,a.jsxs)(l.Button,{variant:"outline",size:"sm",children:[(0,a.jsx)(g.FileText,{className:"h-4 w-4 mr-2"}),"Fee Plans"]})})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-6 gap-4",children:[(0,a.jsxs)(s.Card,{children:[(0,a.jsx)(s.CardHeader,{className:"pb-2",children:(0,a.jsxs)(s.CardTitle,{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[(0,a.jsx)(d.Users,{className:"h-4 w-4"}),"Total Partners"]})}),(0,a.jsxs)(s.CardContent,{children:[(0,a.jsx)("div",{className:"text-2xl font-bold",children:L.totalPartners}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"In your network"})]})]}),(0,a.jsxs)(s.Card,{children:[(0,a.jsx)(s.CardHeader,{className:"pb-2",children:(0,a.jsxs)(s.CardTitle,{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[(0,a.jsx)(m.CheckCircle2,{className:"h-4 w-4"}),"Active Partners"]})}),(0,a.jsxs)(s.CardContent,{children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-green-600",children:L.activePartners}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Currently active"})]})]}),(0,a.jsxs)(s.Card,{children:[(0,a.jsx)(s.CardHeader,{className:"pb-2",children:(0,a.jsxs)(s.CardTitle,{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[(0,a.jsx)(f.Handshake,{className:"h-4 w-4"}),"Total Referrals"]})}),(0,a.jsxs)(s.CardContent,{children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-blue-600",children:L.totalReferrals}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Investors referred"})]})]}),(0,a.jsxs)(s.Card,{children:[(0,a.jsx)(s.CardHeader,{className:"pb-2",children:(0,a.jsxs)(s.CardTitle,{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[(0,a.jsx)(_.TrendingUp,{className:"h-4 w-4"}),"Referral Value"]})}),(0,a.jsxs)(s.CardContent,{children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-purple-600",children:(0,C.formatCurrency)(L.totalReferralValue,"USD")}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Total commitments"})]})]}),(0,a.jsxs)(s.Card,{children:[(0,a.jsx)(s.CardHeader,{className:"pb-2",children:(0,a.jsxs)(s.CardTitle,{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[(0,a.jsx)(v.DollarSign,{className:"h-4 w-4"}),"Fees Owed"]})}),(0,a.jsxs)(s.CardContent,{children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-yellow-600",children:(0,C.formatCurrency)(L.totalOwed,"USD")}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Pending payment"})]})]}),(0,a.jsxs)(s.Card,{children:[(0,a.jsx)(s.CardHeader,{className:"pb-2",children:(0,a.jsxs)(s.CardTitle,{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[(0,a.jsx)(m.CheckCircle2,{className:"h-4 w-4"}),"Fees Paid"]})}),(0,a.jsxs)(s.CardContent,{children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-green-600",children:(0,C.formatCurrency)(L.totalPaid,"USD")}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Total paid out"})]})]})]}),(0,a.jsx)(s.Card,{children:(0,a.jsx)(s.CardContent,{className:"pt-6",children:(0,a.jsxs)("div",{className:"flex flex-col md:flex-row gap-4",children:[(0,a.jsx)("div",{className:"flex-1",children:(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(x.Search,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),(0,a.jsx)(n.Input,{placeholder:"Search partners...",value:O,onChange:e=>M(e.target.value),className:"pl-10"})]})}),(0,a.jsxs)(i.Select,{value:K,onValueChange:G,children:[(0,a.jsx)(i.SelectTrigger,{className:"w-full md:w-48",children:(0,a.jsx)(i.SelectValue,{placeholder:"Filter by status"})}),(0,a.jsx)(i.SelectContent,{children:$.map(e=>(0,a.jsx)(i.SelectItem,{value:e.value,children:e.label},e.value))})]}),k.length>0&&(0,a.jsxs)(i.Select,{value:Y,onValueChange:J,children:[(0,a.jsx)(i.SelectTrigger,{className:"w-full md:w-56",children:(0,a.jsx)(i.SelectValue,{placeholder:"Filter by deal"})}),(0,a.jsxs)(i.SelectContent,{children:[(0,a.jsx)(i.SelectItem,{value:"all",children:"All Deals"}),k.map(e=>(0,a.jsx)(i.SelectItem,{value:e.id,children:e.name},e.id))]})]})]})})}),(0,a.jsxs)(s.Card,{children:[(0,a.jsxs)(s.CardHeader,{children:[(0,a.jsx)(s.CardTitle,{children:"Partners"}),(0,a.jsxs)(s.CardDescription,{children:[ee.length," partner",1!==ee.length?"s":""," found",e&&" • Click a row to view details"]})]}),(0,a.jsx)(s.CardContent,{children:0===ee.length?(0,a.jsxs)("div",{className:"border border-dashed border-muted rounded-lg py-12 flex flex-col items-center justify-center text-center space-y-2",children:[(0,a.jsx)(d.Users,{className:"h-10 w-10 text-muted-foreground"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:O||"all"!==K?"No partners match your filters":"No partners in your network yet"})]}):(0,a.jsx)("div",{className:"rounded-md border",children:(0,a.jsxs)(c.Table,{children:[(0,a.jsx)(c.TableHeader,{children:(0,a.jsxs)(c.TableRow,{children:[(0,a.jsx)(c.TableHead,{children:"Partner"}),(0,a.jsx)(c.TableHead,{children:"Type"}),(0,a.jsx)(c.TableHead,{children:"Contact"}),(0,a.jsx)(c.TableHead,{children:"Fee Plans"}),(0,a.jsx)(c.TableHead,{children:"Referrals"}),(0,a.jsx)(c.TableHead,{children:"Payments"}),(0,a.jsx)(c.TableHead,{children:"Status"}),(0,a.jsx)(c.TableHead,{className:"w-10"})]})}),(0,a.jsx)(c.TableBody,{children:ee.map(t=>(0,a.jsxs)(c.TableRow,{className:(0,y.cn)(e&&"cursor-pointer hover:bg-muted/50 transition-colors"),onClick:()=>e&&void(W(t.id),Z(!0)),children:[(0,a.jsx)(c.TableCell,{children:(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[t.logo_url?(0,a.jsx)("img",{src:t.logo_url,alt:t.name,className:"h-10 w-10 rounded-lg object-cover"}):(0,a.jsx)("div",{className:"h-10 w-10 rounded-lg bg-muted flex items-center justify-center",children:(0,a.jsx)(o.Building2,{className:"h-5 w-5 text-muted-foreground"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-medium",children:t.name}),t.country&&(0,a.jsxs)("div",{className:"text-xs text-muted-foreground flex items-center gap-1",children:[(0,a.jsx)(p.Globe,{className:"h-3 w-3"}),t.country]})]})]})}),(0,a.jsx)(c.TableCell,{children:t.partner_type?(0,a.jsx)(r.Badge,{variant:"secondary",className:"capitalize",children:t.partner_type.replace("_"," ")}):(0,a.jsx)("span",{className:"text-muted-foreground text-xs",children:"—"})}),(0,a.jsx)(c.TableCell,{children:(0,a.jsxs)("div",{className:"space-y-1",children:[t.contact_name&&(0,a.jsx)("div",{className:"text-sm",children:t.contact_name}),t.contact_email&&(0,a.jsxs)("div",{className:"text-xs text-muted-foreground flex items-center gap-1",children:[(0,a.jsx)(j.Mail,{className:"h-3 w-3"}),t.contact_email]})]})}),(0,a.jsx)(c.TableCell,{children:t.fee_plans.length>0?(0,a.jsxs)("div",{className:"flex flex-wrap gap-1",children:[t.fee_plans.slice(0,2).map(e=>(0,a.jsx)(r.Badge,{variant:e.is_active?"default":"secondary",className:"text-xs",children:e.name},e.id)),t.fee_plans.length>2&&(0,a.jsxs)(r.Badge,{variant:"outline",className:"text-xs",children:["+",t.fee_plans.length-2]})]}):(0,a.jsx)("span",{className:"text-muted-foreground text-xs",children:"No fee plans"})}),(0,a.jsx)(c.TableCell,{children:(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"font-medium",children:[t.referrals_count," referrals"]}),t.total_referral_value>0&&(0,a.jsx)("div",{className:"text-xs text-muted-foreground",children:(0,C.formatCurrency)(t.total_referral_value,"USD")})]})}),(0,a.jsx)(c.TableCell,{children:(0,a.jsx)(R.PartnerCommissionSummary,{summary:t.commission_summary,variant:"inline"})}),(0,a.jsx)(c.TableCell,{children:(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)(r.Badge,{variant:"outline",className:(0,y.cn)("capitalize",q[t.status]||q.active),children:t.status}),t.kyc_status&&(0,a.jsx)("div",{children:(0,a.jsxs)(r.Badge,{variant:"secondary",className:(0,y.cn)("text-xs",z[t.kyc_status]||""),children:["KYC: ",t.kyc_status.replace("_"," ")]})})]})}),(0,a.jsx)(c.TableCell,{children:e&&(0,a.jsx)(N.ChevronRight,{className:"h-4 w-4 text-muted-foreground"})})]},t.id))})]})})})]}),(0,a.jsx)(A,{partnerId:Q,open:X,onOpenChange:Z})]})}e.s(["default",()=>M],284516)}]);