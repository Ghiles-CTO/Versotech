(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,471051,e=>{"use strict";var t=e.i(722679),a=e.i(340915),s=e.i(603274),r=e.i(90613),l=e.i(316264),n=e.i(191569),i=e.i(429760),d=e.i(262823),c=e.i(750809),o=e.i(80465),m=e.i(401148),h=e.i(645855),x=e.i(734213),u=e.i(119311),g=e.i(733179),j=e.i(937368),f=e.i(615595),v=e.i(729416),b=e.i(237635),p=e.i(538892),N=e.i(758171),C=e.i(197098),w=e.i(946738),y=e.i(16479);function S({columns:e,data:s,pageSize:r=25}){let[n,i]=a.useState([{id:"value_date",desc:!0}]),[d,c]=a.useState([]),[o,m]=a.useState({}),[h,x]=a.useState({pageIndex:0,pageSize:r}),u=(0,f.useReactTable)({data:s,columns:e,pageCount:Math.ceil(s.length/h.pageSize),onSortingChange:i,onColumnFiltersChange:c,getCoreRowModel:(0,v.getCoreRowModel)(),getSortedRowModel:(0,v.getSortedRowModel)(),getFilteredRowModel:(0,v.getFilteredRowModel)(),getPaginationRowModel:(0,v.getPaginationRowModel)(),onColumnVisibilityChange:m,onPaginationChange:x,state:{sorting:n,columnFilters:d,columnVisibility:o,pagination:h}}),g=u.getRowModel().rows,j=u.getFilteredRowModel().rows.length,S=u.getPageCount(),_=h.pageIndex+1;return(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between px-4 py-3 bg-muted/50 border-b border-border",children:[(0,t.jsxs)("div",{className:"text-sm text-muted-foreground",children:["Showing ",(0,t.jsx)("span",{className:"font-medium text-foreground",children:h.pageIndex*h.pageSize+1})," to"," ",(0,t.jsx)("span",{className:"font-medium text-foreground",children:Math.min((h.pageIndex+1)*h.pageSize,j)})," of"," ",(0,t.jsx)("span",{className:"font-medium text-foreground",children:j})," transactions"]}),(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsxs)(p.Select,{value:`${h.pageSize}`,onValueChange:e=>{x(t=>({...t,pageSize:Number(e),pageIndex:0}))},children:[(0,t.jsx)(p.SelectTrigger,{className:"h-8 w-[100px]",children:(0,t.jsx)(p.SelectValue,{placeholder:`${h.pageSize}`})}),(0,t.jsxs)(p.SelectContent,{children:[(0,t.jsx)(p.SelectItem,{value:"10",children:"10 rows"}),(0,t.jsx)(p.SelectItem,{value:"25",children:"25 rows"}),(0,t.jsx)(p.SelectItem,{value:"50",children:"50 rows"}),(0,t.jsx)(p.SelectItem,{value:"100",children:"100 rows"})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(l.Button,{variant:"ghost",size:"icon",className:"h-8 w-8 disabled:opacity-30",onClick:()=>u.setPageIndex(0),disabled:!u.getCanPreviousPage(),children:(0,t.jsx)(w.ChevronsLeft,{className:"h-4 w-4 text-muted-foreground"})}),(0,t.jsx)(l.Button,{variant:"ghost",size:"icon",className:"h-8 w-8 disabled:opacity-30",onClick:()=>u.previousPage(),disabled:!u.getCanPreviousPage(),children:(0,t.jsx)(N.ChevronLeft,{className:"h-4 w-4 text-muted-foreground"})}),(0,t.jsx)("div",{className:"flex items-center gap-1 px-3",children:(0,t.jsxs)("span",{className:"text-sm text-muted-foreground",children:["Page ",(0,t.jsx)("span",{className:"font-medium text-foreground",children:_})," of ",(0,t.jsx)("span",{className:"font-medium text-foreground",children:S})]})}),(0,t.jsx)(l.Button,{variant:"ghost",size:"icon",className:"h-8 w-8 disabled:opacity-30",onClick:()=>u.nextPage(),disabled:!u.getCanNextPage(),children:(0,t.jsx)(C.ChevronRight,{className:"h-4 w-4 text-muted-foreground"})}),(0,t.jsx)(l.Button,{variant:"ghost",size:"icon",className:"h-8 w-8 disabled:opacity-30",onClick:()=>u.setPageIndex(S-1),disabled:!u.getCanNextPage(),children:(0,t.jsx)(y.ChevronsRight,{className:"h-4 w-4 text-muted-foreground"})})]})]})]}),(0,t.jsx)("div",{className:"border border-border rounded-lg overflow-hidden bg-card",children:(0,t.jsxs)(b.Table,{children:[(0,t.jsx)(b.TableHeader,{children:u.getHeaderGroups().map(e=>(0,t.jsx)(b.TableRow,{className:"border-b border-border bg-muted/50 hover:bg-muted/50",children:e.headers.map(e=>(0,t.jsx)(b.TableHead,{className:"text-foreground font-semibold",children:e.isPlaceholder?null:(0,f.flexRender)(e.column.columnDef.header,e.getContext())},e.id))},e.id))}),(0,t.jsx)(b.TableBody,{children:g.length?g.map(e=>(0,t.jsx)(b.TableRow,{"data-state":e.getIsSelected()&&"selected",className:"border-b border-border/50 hover:bg-muted/30 transition-colors",children:e.getVisibleCells().map(e=>(0,t.jsx)(b.TableCell,{className:"py-4",children:(0,f.flexRender)(e.column.columnDef.cell,e.getContext())},e.id))},e.id)):(0,t.jsx)(b.TableRow,{children:(0,t.jsx)(b.TableCell,{colSpan:e.length,className:"h-24 text-center text-muted-foreground",children:"No transactions found."})})})]})}),(0,t.jsxs)("div",{className:"flex items-center justify-between px-4 py-3 bg-muted/50 border-t border-border",children:[(0,t.jsxs)("div",{className:"text-sm text-muted-foreground",children:["Page ",_," of ",S]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(l.Button,{variant:"outline",size:"sm",onClick:()=>u.setPageIndex(0),disabled:!u.getCanPreviousPage(),children:"First"}),(0,t.jsx)(l.Button,{variant:"outline",size:"sm",onClick:()=>u.previousPage(),disabled:!u.getCanPreviousPage(),children:"Previous"}),(0,t.jsx)(l.Button,{variant:"outline",size:"sm",onClick:()=>u.nextPage(),disabled:!u.getCanNextPage(),children:"Next"}),(0,t.jsx)(l.Button,{variant:"outline",size:"sm",onClick:()=>u.setPageIndex(S-1),disabled:!u.getCanNextPage(),children:"Last"})]})]})]})}var _=e.i(129432),k=e.i(185419),T=e.i(496383),P=e.i(15098),B=e.i(682950),R=e.i(501259),M=e.i(820417);let I=e=>null==e?null:(0,t.jsxs)(_.Badge,{className:e>=80?"bg-emerald-900/30 text-emerald-300 border-emerald-700":e>=60?"bg-amber-900/30 text-amber-300 border-amber-700":"bg-rose-900/30 text-rose-300 border-rose-700",children:[e,"% match"]}),D=(e,t)=>new Intl.NumberFormat("en-US",{style:"currency",currency:t||"USD",minimumFractionDigits:2,maximumFractionDigits:2}).format(e),F=e=>e?e.invoice_number?e.invoice_number:`Invoice ${e.id.slice(0,8)}`:"Invoice",A=e=>{let a=e.invoices,s=F(a),r=a?.investor?.legal_name,l=a?.deal?.name;return(0,t.jsxs)("div",{className:"space-y-0.5",children:[(0,t.jsxs)("div",{className:"text-sm font-medium text-foreground flex items-center gap-2",children:[(0,t.jsx)(u.FileText,{className:"h-3.5 w-3.5"})," ",s,(0,t.jsx)(_.Badge,{variant:"outline",className:"border-white/10 text-xs capitalize",children:e.match_type.replace("_"," ")})]}),(0,t.jsxs)("div",{className:"text-xs text-muted-foreground flex items-center gap-1",children:[(0,t.jsx)("span",{children:D(e.matched_amount,a?.currency||"USD")}),e.match_reason&&(0,t.jsxs)("span",{className:"text-muted-foreground/70",children:["• ",e.match_reason]})]}),(r||l)&&(0,t.jsxs)("div",{className:"text-xs text-muted-foreground flex items-center gap-2",children:[(0,t.jsx)(R.Users,{className:"h-3 w-3"}),(0,t.jsx)("span",{children:[r,l].filter(Boolean).join(" • ")})]})]},e.id)},U=[{id:"value_date",accessorKey:"value_date",header:({column:e})=>(0,t.jsxs)(l.Button,{variant:"ghost",onClick:()=>e.toggleSorting("asc"===e.getIsSorted()),className:"hover:bg-white/5 -ml-4",children:["Date",(0,t.jsx)(k.ArrowUpDown,{className:"ml-2 h-4 w-4"})]}),cell:({row:e})=>(0,t.jsx)("div",{className:"font-medium text-foreground",children:new Date(e.original.value_date).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})})},{id:"counterparty",accessorKey:"counterparty",header:({column:e})=>(0,t.jsxs)(l.Button,{variant:"ghost",onClick:()=>e.toggleSorting("asc"===e.getIsSorted()),className:"hover:bg-white/5 -ml-4",children:["Counterparty",(0,t.jsx)(k.ArrowUpDown,{className:"ml-2 h-4 w-4"})]}),cell:({row:e})=>{let a=e.original,s=a.matches?.[0],r=s?.invoices,l=r?.investor?.legal_name;return(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsx)("div",{className:"font-medium text-foreground",children:a.counterparty}),l&&(0,t.jsxs)("div",{className:"text-xs text-emerald-300",children:["→ ",l]}),!l&&(a.suggestions?.length||0)>0&&(0,t.jsxs)("div",{className:"text-xs text-amber-400",children:[a.suggestions?.length," suggestion",(a.suggestions?.length||0)>1?"s":""]}),a.memo&&(0,t.jsx)("div",{className:"text-xs text-muted-foreground truncate max-w-xs",children:a.memo})]})}},{id:"amount",accessorKey:"amount",header:({column:e})=>(0,t.jsxs)(l.Button,{variant:"ghost",onClick:()=>e.toggleSorting("asc"===e.getIsSorted()),className:"hover:bg-white/5 -ml-4",children:["Amount",(0,t.jsx)(k.ArrowUpDown,{className:"ml-2 h-4 w-4"})]}),cell:({row:e})=>{let a=e.original,s=a.amount<0;return(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsx)("div",{className:`font-semibold ${s?"text-rose-400":"text-foreground"}`,children:D(a.amount,a.currency)}),"number"==typeof a.matched_amount_total&&a.matched_amount_total>0&&(0,t.jsxs)("div",{className:"text-xs text-emerald-300",children:["Matched ",D(a.matched_amount_total,a.currency)]}),"number"==typeof a.remaining_amount&&a.remaining_amount>0&&(0,t.jsxs)("div",{className:"text-xs text-amber-400",children:["Remaining ",D(a.remaining_amount,a.currency)]})]})}},{id:"matched_to",header:"Matched To",cell:({row:e})=>{let a=e.original;return a.matches&&a.matches.length>0?(0,t.jsxs)("div",{className:"space-y-2",children:[a.matches.slice(0,2).map(A),a.matches.length>2&&(0,t.jsxs)("div",{className:"text-xs text-muted-foreground",children:["+",a.matches.length-2," more matches"]})]}):(e=>{let a=e.suggestions||[];if(!a.length)return(0,t.jsx)("span",{className:"text-muted-foreground text-sm",children:"—"});let s=a[0],r=s.invoices,l=F(r),n=r?.investor?.legal_name;return(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsxs)("div",{className:"text-sm font-medium text-amber-300",children:[l,a.length>1&&(0,t.jsxs)("span",{className:"text-xs text-muted-foreground ml-2",children:["+",a.length-1," more"]})]}),(0,t.jsx)("div",{className:"text-xs text-muted-foreground",children:n||"Potential match"}),I(s.confidence)]})})(a)}},{id:"status",accessorKey:"status",header:({column:e})=>(0,t.jsxs)(l.Button,{variant:"ghost",onClick:()=>e.toggleSorting("asc"===e.getIsSorted()),className:"hover:bg-white/5 -ml-4",children:["Status",(0,t.jsx)(k.ArrowUpDown,{className:"ml-2 h-4 w-4"})]}),cell:({row:e})=>{var a;let s,r,l,n=e.original;return(0,t.jsxs)("div",{className:"space-y-1.5",children:[(a=n.status,l=(r=(s={matched:{color:"bg-emerald-900/30 text-emerald-300 border-emerald-700",icon:P.CheckCircle2,label:"Matched"},partially_matched:{color:"bg-amber-900/30 text-amber-300 border-amber-700",icon:m.AlertCircle,label:"Partial"},unmatched:{color:"bg-slate-800/50 text-slate-300 border-slate-700",icon:B.HelpCircle,label:"Unmatched"}})[a]||s.unmatched).icon,(0,t.jsxs)(_.Badge,{className:`${r.color} gap-1.5`,children:[(0,t.jsx)(l,{className:"h-3 w-3"}),r.label]})),n.match_confidence&&I(n.match_confidence),n.match_notes&&(0,t.jsx)("div",{className:"text-xs text-muted-foreground line-clamp-2",children:n.match_notes})]})}},{id:"reference",header:"Reference",cell:({row:e})=>{let a=e.original;return(0,t.jsxs)("div",{className:"space-y-1",children:[a.bank_reference&&(0,t.jsx)("div",{className:"text-xs font-mono text-muted-foreground",children:a.bank_reference}),a.account_ref&&(0,t.jsx)("div",{className:"text-xs text-muted-foreground",children:a.account_ref})]})}},{id:"actions",header:"Actions",cell:({row:e})=>{let a=e.original;return(0,t.jsx)(M.default,{href:`/versotech_main/reconciliation/${a.id}`,children:(0,t.jsxs)(l.Button,{variant:"ghost",size:"sm",className:"hover:bg-white/5",children:[(0,t.jsx)(T.Eye,{className:"h-4 w-4 mr-2"}),"View"]})})}}];function z({columns:e,data:s}){let[r,l]=a.useState([{id:"created_at",desc:!0}]),n=(0,f.useReactTable)({data:s,columns:e,state:{sorting:r},onSortingChange:l,getCoreRowModel:(0,v.getCoreRowModel)(),getSortedRowModel:(0,v.getSortedRowModel)()});return(0,t.jsx)("div",{className:"rounded-md border border-white/10",children:(0,t.jsxs)(b.Table,{children:[(0,t.jsx)(b.TableHeader,{children:n.getHeaderGroups().map(e=>(0,t.jsx)(b.TableRow,{className:"border-white/10 hover:bg-white/5",children:e.headers.map(e=>(0,t.jsx)(b.TableHead,{className:"text-muted-foreground",children:e.isPlaceholder?null:(0,f.flexRender)(e.column.columnDef.header,e.getContext())},e.id))},e.id))}),(0,t.jsx)(b.TableBody,{children:n.getRowModel().rows?.length?n.getRowModel().rows.map(e=>(0,t.jsx)(b.TableRow,{"data-state":e.getIsSelected()&&"selected",className:"border-white/10 hover:bg-white/5",children:e.getVisibleCells().map(e=>(0,t.jsx)(b.TableCell,{children:(0,f.flexRender)(e.column.columnDef.cell,e.getContext())},e.id))},e.id)):(0,t.jsx)(b.TableRow,{children:(0,t.jsx)(b.TableCell,{colSpan:e.length,className:"h-24 text-center text-muted-foreground",children:"No invoices found."})})})]})})}let H=(e,t)=>new Intl.NumberFormat("en-US",{style:"currency",currency:t||"USD",minimumFractionDigits:2,maximumFractionDigits:2}).format(e),$=e=>new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}),L=[{id:"invoice_number",accessorKey:"invoice_number",header:({column:e})=>(0,t.jsxs)(l.Button,{variant:"ghost",onClick:()=>e.toggleSorting("asc"===e.getIsSorted()),className:"hover:bg-white/5 -ml-4",children:["Invoice #",(0,t.jsx)(k.ArrowUpDown,{className:"ml-2 h-4 w-4"})]}),cell:({row:e})=>{let a=e.original,s=a.invoice_number||`INV-${a.id.slice(0,8)}`;return(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsxs)("div",{className:"font-medium text-foreground flex items-center gap-2",children:[(0,t.jsx)(u.FileText,{className:"h-3.5 w-3.5"}),s]}),a.deal?.name&&(0,t.jsx)("div",{className:"text-xs text-muted-foreground",children:a.deal.name})]})}},{id:"investor",header:"Investor",cell:({row:e})=>{let a=e.original.investor;return(0,t.jsx)("div",{className:"font-medium text-foreground",children:a?.legal_name||"—"})}},{id:"created_at",accessorKey:"created_at",header:({column:e})=>(0,t.jsxs)(l.Button,{variant:"ghost",onClick:()=>e.toggleSorting("asc"===e.getIsSorted()),className:"hover:bg-white/5 -ml-4",children:["Created",(0,t.jsx)(k.ArrowUpDown,{className:"ml-2 h-4 w-4"})]}),cell:({row:e})=>(0,t.jsx)("div",{className:"text-sm text-muted-foreground",children:$(e.original.created_at)})},{id:"total",accessorKey:"total",header:({column:e})=>(0,t.jsxs)(l.Button,{variant:"ghost",onClick:()=>e.toggleSorting("asc"===e.getIsSorted()),className:"hover:bg-white/5 -ml-4",children:["Total",(0,t.jsx)(k.ArrowUpDown,{className:"ml-2 h-4 w-4"})]}),cell:({row:e})=>{let a=e.original;return(0,t.jsx)("div",{className:"font-semibold text-foreground",children:H(a.total,a.currency)})}},{id:"paid_amount",accessorKey:"paid_amount",header:({column:e})=>(0,t.jsxs)(l.Button,{variant:"ghost",onClick:()=>e.toggleSorting("asc"===e.getIsSorted()),className:"hover:bg-white/5 -ml-4",children:["Paid",(0,t.jsx)(k.ArrowUpDown,{className:"ml-2 h-4 w-4"})]}),cell:({row:e})=>{let a=e.original,s=a.total>0?a.paid_amount/a.total*100:0;return(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsx)("div",{className:`text-sm font-medium ${a.paid_amount>0?"text-emerald-300":"text-muted-foreground"}`,children:H(a.paid_amount,a.currency)}),s>0&&(0,t.jsxs)("div",{className:"text-xs text-muted-foreground",children:[s.toFixed(0),"% paid"]})]})}},{id:"balance_due",accessorKey:"balance_due",header:({column:e})=>(0,t.jsxs)(l.Button,{variant:"ghost",onClick:()=>e.toggleSorting("asc"===e.getIsSorted()),className:"hover:bg-white/5 -ml-4",children:["Balance Due",(0,t.jsx)(k.ArrowUpDown,{className:"ml-2 h-4 w-4"})]}),cell:({row:e})=>{let a=e.original;return(0,t.jsx)("div",{className:`font-medium ${a.balance_due>0?"text-amber-300":"text-muted-foreground"}`,children:H(a.balance_due,a.currency)})}},{id:"status",accessorKey:"status",header:"Status",cell:({row:e})=>{var a;let s,r,l,n=e.original;return(0,t.jsxs)("div",{className:"space-y-1.5",children:[(a=n.status,l=(r=(s={paid:{color:"bg-emerald-900/30 text-emerald-300 border-emerald-700",icon:P.CheckCircle2,label:"Paid"},partially_paid:{color:"bg-amber-900/30 text-amber-300 border-amber-700",icon:h.Clock,label:"Partial"},sent:{color:"bg-blue-900/30 text-blue-300 border-blue-700",icon:u.FileText,label:"Sent"},overdue:{color:"bg-rose-900/30 text-rose-300 border-rose-700",icon:m.AlertCircle,label:"Overdue"},draft:{color:"bg-slate-800/50 text-slate-300 border-slate-700",icon:h.Clock,label:"Draft"}})[a]||s.draft).icon,(0,t.jsxs)(_.Badge,{className:`${r.color} gap-1.5`,children:[(0,t.jsx)(l,{className:"h-3 w-3"}),r.label]})),n.paid_at&&(0,t.jsxs)("div",{className:"text-xs text-muted-foreground",children:["Paid ",$(n.paid_at)]})]})}},{id:"match_status",header:"Match Status",cell:({row:e})=>{let a=e.original;return(0,t.jsxs)("div",{className:"space-y-1",children:[(e=>{if(!e)return null;let a={matched:{color:"bg-emerald-900/30 text-emerald-300 border-emerald-700",label:"Matched"},partially_matched:{color:"bg-amber-900/30 text-amber-300 border-amber-700",label:"Partial Match"},unmatched:{color:"bg-slate-800/50 text-slate-300 border-slate-700",label:"Unmatched"}},s=a[e]||a.unmatched;return(0,t.jsx)(_.Badge,{className:s.color,children:s.label})})(a.match_status),(a.match_count||0)>0&&(0,t.jsxs)("div",{className:"text-xs text-muted-foreground",children:[a.match_count," match",1===a.match_count?"":"es"]})]})}}];var K=e.i(352776),V=e.i(514133);e.i(816654);var E=e.i(396064),O=e.i(994500);function G(){let[e,r]=(0,a.useState)(!1),[i,d]=(0,a.useState)(null),[c,o]=(0,a.useState)(!1),m=(0,s.useRouter)(),h=async()=>{if(!i)return void O.toast.error("Please select a file");o(!0);try{let e=new FormData;e.append("file",i);let t=await fetch("/api/staff/reconciliation/upload",{method:"POST",body:e}),a=await t.json();if(!t.ok)throw Error(a.error||"Failed to upload CSV");O.toast.success(a.message||`Imported ${a.imported} transactions`),r(!1),d(null),m.refresh()}catch(e){O.toast.error(e.message||"Failed to upload CSV")}finally{o(!1)}};return(0,t.jsxs)(K.Dialog,{open:e,onOpenChange:r,children:[(0,t.jsx)(K.DialogTrigger,{asChild:!0,children:(0,t.jsxs)(l.Button,{variant:"outline",children:[(0,t.jsx)(E.Upload,{className:"h-4 w-4 mr-2"}),"Import Bank Data"]})}),(0,t.jsxs)(K.DialogContent,{children:[(0,t.jsx)(K.DialogHeader,{children:(0,t.jsx)(K.DialogTitle,{children:"Import Bank Transactions"})}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(V.Label,{htmlFor:"file",children:"CSV File"}),(0,t.jsx)(n.Input,{id:"file",type:"file",accept:".csv",onChange:e=>d(e.target.files?.[0]||null)}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Expected columns: date, amount, counterparty (plus optional: currency, memo, reference)"})]}),(0,t.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,t.jsx)(l.Button,{variant:"outline",onClick:()=>r(!1),disabled:c,children:"Cancel"}),(0,t.jsx)(l.Button,{onClick:h,disabled:!i||c,children:c?"Uploading...":"Import"})]})]})]})]})}function q(){let[e,r]=(0,a.useState)(!1),n=(0,s.useRouter)(),i=async()=>{r(!0);try{let e=await fetch("/api/staff/reconciliation/auto-match",{method:"POST"}),t=await e.json();if(!e.ok)throw Error(t.error||"Failed to run auto-match");O.toast.success(t.message||`Found ${t.matches} suggested matches`),n.refresh()}catch(e){O.toast.error(e.message||"Failed to run auto-match")}finally{r(!1)}};return(0,t.jsxs)(l.Button,{onClick:i,disabled:e,children:[(0,t.jsx)(d.RefreshCw,{className:`h-4 w-4 mr-2 ${e?"animate-spin":""}`}),"Run Auto-Match"]})}function J(){(0,s.useRouter)();let[e,f]=(0,a.useState)("transactions"),[v,b]=(0,a.useState)([]),[p,N]=(0,a.useState)(null),[C,w]=(0,a.useState)([]),[y,_]=(0,a.useState)(null),[k,T]=(0,a.useState)(!0),[P,B]=(0,a.useState)(!1),[R,M]=(0,a.useState)(""),[I,D]=(0,a.useState)("");(0,a.useEffect)(()=>{F(),A()},[]);let F=async()=>{try{T(!0);let e=await fetch("/api/staff/reconciliation");if(!e.ok)throw Error("Failed to load transactions");let t=await e.json();b(t.transactions||[]),N(t.stats||{})}catch(e){console.error("Load error:",e),O.toast.error("Failed to load reconciliation data")}finally{T(!1)}},A=async()=>{try{let e=await fetch("/api/staff/reconciliation/invoices");if(!e.ok)throw Error("Failed to load invoices");let t=await e.json();w(t.invoices||[]),_(t.stats||{})}catch(e){console.error("Invoice load error:",e),O.toast.error("Failed to load invoices")}},H=async()=>{B(!0);try{await Promise.all([fetch("/api/staff/reconciliation").then(async e=>{if(!e.ok)throw Error("Failed to refresh transactions");let t=await e.json();b(t.transactions||[]),N(t.stats||{})}),fetch("/api/staff/reconciliation/invoices").then(async e=>{if(!e.ok)throw Error("Failed to refresh invoices");let t=await e.json();w(t.invoices||[]),_(t.stats||{})})]),O.toast.success("Data refreshed")}catch(e){O.toast.error("Failed to refresh data")}finally{B(!1)}},$=(0,a.useMemo)(()=>{if(!v||0===v.length)return[];let e=v;if(R){let t=R.toLowerCase();e=e.filter(e=>{let a=(e.matches||[]).flatMap(e=>{let t=e.invoices;return[t?.invoice_number,t?.investor?.legal_name,t?.deal?.name]}),s=(e.suggestions||[]).flatMap(e=>{let t=e.invoices;return[t?.invoice_number,t?.investor?.legal_name,t?.deal?.name]});return[e.counterparty,e.memo,e.bank_reference,e.account_ref,...a,...s].filter(Boolean).join(" ").toLowerCase().includes(t)})}return I&&(e=e.filter(e=>e.status===I)),e},[v,R,I]),K=(0,a.useMemo)(()=>{if(!C||0===C.length)return[];let e=C;if(R){let t=R.toLowerCase();e=e.filter(e=>[e.invoice_number,e.investor?.legal_name,e.deal?.name].filter(Boolean).join(" ").toLowerCase().includes(t))}return I&&(["paid","partially_paid","sent","overdue","draft"].includes(I)?e=e.filter(e=>e.status===I):["matched","partially_matched","unmatched"].includes(I)&&(e=e.filter(e=>e.match_status===I))),e},[C,R,I]),V=(0,a.useMemo)(()=>{let e=$.length,t=$.filter(e=>"matched"===e.status).length,a=$.filter(e=>"partially_matched"===e.status).length,s=$.filter(e=>"unmatched"===e.status).length,r=$.reduce((e,t)=>e+(Number(t.amount)||0),0),l=$.reduce((e,t)=>e+(Number(t.matched_amount_total)||0),0),n=$.filter(e=>"unmatched"===e.status).reduce((e,t)=>e+(Number(t.amount)||0),0),i=e>0?Math.round(t/e*100):0;return{total:e,matched:t,partiallyMatched:a,unmatched:s,totalAmount:r,matchedAmount:l,unmatchedAmount:n,outstandingAmount:r-l,matchPercentage:i}},[$]),E=e=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(e);if(k)return(0,t.jsx)("div",{className:"flex items-center justify-center h-96",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)(d.RefreshCw,{className:"h-8 w-8 animate-spin text-muted-foreground mx-auto mb-2"}),(0,t.jsx)("div",{className:"text-sm text-muted-foreground",children:"Loading reconciliation data..."})]})});let J=p?.total>0?Math.round(p.matched/p.total*100):0,Q=v.filter(e=>"partially_matched"===e.status).reduce((e,t)=>e+("number"==typeof t.remaining_amount?t.remaining_amount:Math.max((t.amount||0)-(t.matched_amount_total||0),0)),0);return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-2xl font-bold text-foreground",children:"Bank Reconciliation"}),(0,t.jsx)("p",{className:"text-muted-foreground mt-1",children:"Import bank transactions and match payments to fee invoices"})]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsxs)(l.Button,{variant:"outline",onClick:H,disabled:P,children:[(0,t.jsx)(d.RefreshCw,{className:`h-4 w-4 mr-2 ${P?"animate-spin":""}`}),"Refresh"]}),(0,t.jsx)(G,{}),(0,t.jsx)(q,{})]})]}),(0,t.jsxs)(r.Card,{children:[(0,t.jsx)(r.CardHeader,{className:"pb-3",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)(r.CardTitle,{className:"flex items-center gap-2",children:[(0,t.jsx)(g.TrendingUp,{className:"h-5 w-5 text-muted-foreground"}),"Reconciliation Summary"]}),(0,t.jsxs)(r.CardDescription,{className:"mt-1",children:["Overall reconciliation status",(R||I)&&(0,t.jsx)("span",{className:"text-amber-400 ml-2",children:"(filtered view)"})]})]}),(0,t.jsxs)("div",{className:"text-right",children:[(0,t.jsxs)("div",{className:"text-3xl font-bold text-emerald-400",children:[V.matchPercentage,"%"]}),(0,t.jsx)("div",{className:"text-sm text-muted-foreground",children:"Match Rate"})]})]})}),(0,t.jsxs)(r.CardContent,{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,t.jsx)("span",{className:"text-muted-foreground",children:"Matching Progress"}),(0,t.jsxs)("span",{className:"text-foreground font-medium",children:[V.matched," of ",V.total," transactions"]})]}),(0,t.jsx)(j.Progress,{value:V.matchPercentage,className:"h-3"})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 pt-2",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3 p-3 rounded-lg bg-muted/50 border border-border",children:[(0,t.jsx)("div",{className:"p-2 rounded-lg bg-amber-500/10",children:(0,t.jsx)(h.Clock,{className:"h-5 w-5 text-amber-500 dark:text-amber-400"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-sm text-muted-foreground",children:"Total Outstanding"}),(0,t.jsx)("div",{className:"text-lg font-bold text-amber-600 dark:text-amber-200",children:E(V.outstandingAmount)}),(0,t.jsxs)("div",{className:"text-xs text-muted-foreground",children:[V.unmatched+V.partiallyMatched," transactions"]})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-3 p-3 rounded-lg bg-muted/50 border border-border",children:[(0,t.jsx)("div",{className:"p-2 rounded-lg bg-emerald-500/10",children:(0,t.jsx)(o.CheckCircle,{className:"h-5 w-5 text-emerald-500 dark:text-emerald-400"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-sm text-muted-foreground",children:"Total Matched"}),(0,t.jsx)("div",{className:"text-lg font-bold text-emerald-600 dark:text-emerald-200",children:E(V.matchedAmount)}),(0,t.jsxs)("div",{className:"text-xs text-muted-foreground",children:[V.matched," transactions"]})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-3 p-3 rounded-lg bg-muted/50 border border-border",children:[(0,t.jsx)("div",{className:"p-2 rounded-lg bg-rose-500/10",children:(0,t.jsx)(m.AlertCircle,{className:"h-5 w-5 text-rose-500 dark:text-rose-400"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-sm text-muted-foreground",children:"Total Unmatched"}),(0,t.jsx)("div",{className:"text-lg font-bold text-rose-600 dark:text-rose-200",children:E(V.unmatchedAmount)}),(0,t.jsxs)("div",{className:"text-xs text-muted-foreground",children:[V.unmatched," transactions"]})]})]})]})]})]}),(0,t.jsxs)(i.Tabs,{value:e,onValueChange:e=>f(e),children:[(0,t.jsxs)(i.TabsList,{className:"grid w-full max-w-md grid-cols-2",children:[(0,t.jsxs)(i.TabsTrigger,{value:"transactions",className:"flex items-center gap-2",children:[(0,t.jsx)(x.Activity,{className:"h-4 w-4"}),"Transactions (",v.length,")"]}),(0,t.jsxs)(i.TabsTrigger,{value:"invoices",className:"flex items-center gap-2",children:[(0,t.jsx)(u.FileText,{className:"h-4 w-4"}),"Fee Invoices (",C.length,")"]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4 mt-6",children:[(0,t.jsxs)(r.Card,{className:"bg-muted/50 border border-border",children:[(0,t.jsx)(r.CardHeader,{className:"pb-3",children:(0,t.jsxs)(r.CardTitle,{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[(0,t.jsx)(x.Activity,{className:"h-4 w-4"}),"Match Rate"]})}),(0,t.jsxs)(r.CardContent,{children:[(0,t.jsxs)("div",{className:"text-2xl font-bold text-emerald-600 dark:text-emerald-200",children:[J,"%"]}),(0,t.jsxs)("div",{className:"text-sm text-muted-foreground mt-1",children:[p?.matched||0," of ",p?.total||0]})]})]}),(0,t.jsxs)(r.Card,{children:[(0,t.jsx)(r.CardHeader,{className:"pb-3",children:(0,t.jsxs)(r.CardTitle,{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[(0,t.jsx)(o.CheckCircle,{className:"h-4 w-4"}),"Matched"]})}),(0,t.jsxs)(r.CardContent,{children:[(0,t.jsx)("div",{className:"text-2xl font-bold text-emerald-600 dark:text-emerald-200",children:p?.matched||0}),(0,t.jsx)("div",{className:"text-sm text-muted-foreground mt-1",children:E(p?.matchedAmount||0)})]})]}),(0,t.jsxs)(r.Card,{children:[(0,t.jsx)(r.CardHeader,{className:"pb-3",children:(0,t.jsxs)(r.CardTitle,{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[(0,t.jsx)(m.AlertCircle,{className:"h-4 w-4"}),"Partial"]})}),(0,t.jsxs)(r.CardContent,{children:[(0,t.jsx)("div",{className:"text-2xl font-bold text-amber-600 dark:text-amber-200",children:p?.partiallyMatched||p?.partially_matched||0}),(0,t.jsx)("div",{className:"text-sm text-muted-foreground mt-1",children:E(Q||0)})]})]}),(0,t.jsxs)(r.Card,{children:[(0,t.jsx)(r.CardHeader,{className:"pb-3",children:(0,t.jsxs)(r.CardTitle,{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[(0,t.jsx)(h.Clock,{className:"h-4 w-4"}),"Unmatched"]})}),(0,t.jsxs)(r.CardContent,{children:[(0,t.jsx)("div",{className:"text-2xl font-bold text-rose-600 dark:text-rose-200",children:p?.unmatched||0}),(0,t.jsx)("div",{className:"text-sm text-muted-foreground mt-1",children:E(p?.unmatchedAmount||0)})]})]}),(0,t.jsxs)(r.Card,{children:[(0,t.jsx)(r.CardHeader,{className:"pb-3",children:(0,t.jsxs)(r.CardTitle,{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[(0,t.jsx)(c.Search,{className:"h-4 w-4"}),"Suggested Matches"]})}),(0,t.jsxs)(r.CardContent,{children:[(0,t.jsx)("div",{className:"text-2xl font-bold text-blue-600 dark:text-blue-200",children:p?.suggestedMatchesCount||0}),(0,t.jsx)("div",{className:"text-sm text-muted-foreground mt-1",children:"Ready for review"})]})]})]}),(0,t.jsx)(i.TabsContent,{value:"transactions",className:"space-y-4",children:(0,t.jsxs)(r.Card,{children:[(0,t.jsx)(r.CardHeader,{children:(0,t.jsx)("div",{className:"flex items-center justify-between",children:(0,t.jsxs)("div",{children:[(0,t.jsx)(r.CardTitle,{children:"All Transactions"}),(0,t.jsxs)(r.CardDescription,{children:[$.length," transaction",1!==$.length?"s":"",$.length!==v.length&&` (filtered from ${v.length})`]})]})})}),(0,t.jsxs)(r.CardContent,{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex gap-3",children:[(0,t.jsxs)("div",{className:"flex-1 relative",children:[(0,t.jsx)(c.Search,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),(0,t.jsx)(n.Input,{placeholder:"Search by counterparty, invoice, investor, reference...",value:R,onChange:e=>M(e.target.value),className:"pl-10"})]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(l.Button,{variant:""===I?"default":"outline",size:"sm",onClick:()=>D(""),children:"All"}),(0,t.jsx)(l.Button,{variant:"unmatched"===I?"default":"outline",size:"sm",onClick:()=>D("unmatched"),children:"Unmatched"}),(0,t.jsx)(l.Button,{variant:"partially_matched"===I?"default":"outline",size:"sm",onClick:()=>D("partially_matched"),children:"Partial"}),(0,t.jsx)(l.Button,{variant:"matched"===I?"default":"outline",size:"sm",onClick:()=>D("matched"),children:"Matched"})]})]}),(0,t.jsx)(S,{columns:U,data:$,pageSize:25})]})]})}),(0,t.jsx)(i.TabsContent,{value:"invoices",className:"space-y-4",children:(0,t.jsxs)(r.Card,{children:[(0,t.jsx)(r.CardHeader,{children:(0,t.jsx)("div",{className:"flex items-center justify-between",children:(0,t.jsxs)("div",{children:[(0,t.jsx)(r.CardTitle,{children:"All Fee Invoices"}),(0,t.jsxs)(r.CardDescription,{children:[K.length," invoice",1!==K.length?"s":"",K.length!==C.length&&` (filtered from ${C.length})`]})]})})}),(0,t.jsxs)(r.CardContent,{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex gap-3",children:[(0,t.jsxs)("div",{className:"flex-1 relative",children:[(0,t.jsx)(c.Search,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),(0,t.jsx)(n.Input,{placeholder:"Search by invoice number, investor, deal...",value:R,onChange:e=>M(e.target.value),className:"pl-10"})]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(l.Button,{variant:""===I?"default":"outline",size:"sm",onClick:()=>D(""),children:"All"}),(0,t.jsx)(l.Button,{variant:"sent"===I?"default":"outline",size:"sm",onClick:()=>D("sent"),children:"Sent"}),(0,t.jsx)(l.Button,{variant:"partially_paid"===I?"default":"outline",size:"sm",onClick:()=>D("partially_paid"),children:"Partial"}),(0,t.jsx)(l.Button,{variant:"paid"===I?"default":"outline",size:"sm",onClick:()=>D("paid"),children:"Paid"}),(0,t.jsx)(l.Button,{variant:"matched"===I?"default":"outline",size:"sm",onClick:()=>D("matched"),children:"Matched"}),(0,t.jsx)(l.Button,{variant:"unmatched"===I?"default":"outline",size:"sm",onClick:()=>D("unmatched"),children:"Unmatched"})]})]}),(0,t.jsx)(z,{columns:L,data:K})]})]})})]})]})}e.s(["ReconciliationPageClient",()=>J],471051)}]);