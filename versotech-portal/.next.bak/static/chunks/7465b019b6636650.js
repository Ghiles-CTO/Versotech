(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,167795,e=>{"use strict";var t=e.i(722679),s=e.i(340915),a=e.i(337684),r=e.i(820417),l=e.i(396132),i=e.i(971743),n=e.i(985385),o=e.i(761722),d=e.i(119311),c=e.i(831833),m=e.i(501259),u=e.i(429747),h=e.i(734213),x=e.i(691974),g=e.i(117925),p=e.i(551544),f=e.i(49664),b=e.i(619324),j=e.i(15098),v=e.i(401148),N=e.i(275034),w=e.i(263229),y=e.i(398472),_=e.i(554369),C=e.i(496383),F=e.i(733179),S=e.i(90613),D=e.i(429760),k=e.i(316264),T=e.i(129432),I=e.i(538892),L=e.i(352776),E=e.i(191569),z=e.i(514133),A=e.i(396064),$=e.i(603274);function B({dealId:e,entityId:a,triggerLabel:r,onUploaded:l,defaultFolderId:i=null,folderOptions:n=[]}){let o=(0,$.useRouter)(),[c,m]=(0,s.useState)(!1),[u,h]=(0,s.useState)(!1),[x,g]=(0,s.useState)(null),[p,f]=(0,s.useState)(null),[b,j]=(0,s.useState)("contract"),[v,y]=(0,s.useState)(""),[_,C]=(0,s.useState)(""),[F,S]=(0,s.useState)("file"),[T,B]=(0,s.useState)(""),[V,U]=(0,s.useState)("external"),[P,O]=(0,s.useState)(i),R=!!(e||a),M="file"===F;(0,s.useEffect)(()=>{c||(S("file"),f(null),B(""),U("external"),g(null),O(i??null))},[c,i]);let q=async()=>{if(!R)return void g("Document scope is not configured");h(!0),g(null);try{if("file"===F){if(!p){g("Please select a file"),h(!1);return}let t=new FormData;t.append("file",p),t.append("type",b),v.trim()&&t.append("name",v.trim()),_.trim()&&t.append("description",_.trim()),e&&t.append("deal_id",e),a&&(t.append("entity_id",a),t.append("vehicle_id",a)),P&&t.append("folder_id",P);let s=await fetch("/api/documents/upload",{method:"POST",body:t});if(!s.ok){let e=await s.json();throw Error(e.error||"Failed to upload document")}}else{if(!T.trim()){g("Please provide a valid external link"),h(!1);return}let t={name:v.trim()||null,type:b||null,description:_.trim()||null,external_url:T.trim(),link_type:V};e&&(t.deal_id=e),a&&(t.entity_id=a,t.vehicle_id=a),P&&(t.folder_id=P);let s=await fetch("/api/documents/link",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!s.ok){let e=await s.json();throw Error(e.error||"Failed to save link")}}f(null),y(""),C(""),B(""),U("external"),S("file"),m(!1),O(i??null),o.refresh(),l?.()}catch(e){g(e.message)}finally{h(!1)}};return(0,t.jsxs)(L.Dialog,{open:c,onOpenChange:m,children:[(0,t.jsx)(L.DialogTrigger,{asChild:!0,children:(0,t.jsxs)(k.Button,{className:"gap-2",children:[(0,t.jsx)(A.Upload,{className:"h-4 w-4"}),r||"Upload Document"]})}),(0,t.jsxs)(L.DialogContent,{className:"bg-background border-border max-w-2xl",children:[(0,t.jsxs)(L.DialogHeader,{children:[(0,t.jsxs)(L.DialogTitle,{className:"flex items-center gap-2 text-foreground",children:[(0,t.jsx)(A.Upload,{className:"h-5 w-5 text-emerald-500 dark:text-emerald-400"}),"Upload Document"]}),(0,t.jsxs)(L.DialogDescription,{className:"text-muted-foreground",children:["Add a document scoped to this ",e?"deal":"entity"]})]}),n.length>0&&(0,t.jsxs)("div",{className:"mt-4 space-y-2",children:[(0,t.jsx)(z.Label,{htmlFor:"doc-folder-select",className:"text-sm font-medium text-foreground",children:"Folder"}),(0,t.jsxs)(I.Select,{value:P??"none",onValueChange:e=>O("none"===e?null:e),children:[(0,t.jsx)(I.SelectTrigger,{id:"doc-folder-select",className:"bg-background border-input text-foreground",children:(0,t.jsx)(I.SelectValue,{placeholder:"Select folder"})}),(0,t.jsxs)(I.SelectContent,{className:"bg-popover border-border",children:[(0,t.jsx)(I.SelectItem,{value:"none",className:"text-foreground",children:"Unfiled"}),n.map(e=>(0,t.jsx)(I.SelectItem,{value:e.id,className:"text-foreground",children:e.path??e.name},e.id))]})]})]}),(0,t.jsxs)(D.Tabs,{value:F,onValueChange:e=>S(e),children:[(0,t.jsxs)(D.TabsList,{className:"grid grid-cols-2 bg-muted/50 border border-border",children:[(0,t.jsxs)(D.TabsTrigger,{value:"file",className:"data-[state=active]:bg-emerald-500/20 data-[state=active]:text-emerald-800 dark:data-[state=active]:text-emerald-100 text-foreground",children:[(0,t.jsx)(A.Upload,{className:"h-4 w-4 mr-2"}),"Upload File"]}),(0,t.jsxs)(D.TabsTrigger,{value:"link",className:"data-[state=active]:bg-emerald-500/20 data-[state=active]:text-emerald-800 dark:data-[state=active]:text-emerald-100 text-foreground",children:[(0,t.jsx)(d.FileText,{className:"h-4 w-4 mr-2"}),"Link Document"]})]}),(0,t.jsxs)(D.TabsContent,{value:"file",className:"mt-4 space-y-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(z.Label,{htmlFor:"doc_type_file",className:"text-sm font-medium text-foreground",children:"Document Type *"}),(0,t.jsxs)(I.Select,{value:b,onValueChange:j,children:[(0,t.jsx)(I.SelectTrigger,{id:"doc_type_file",className:"bg-background border-input text-foreground",children:(0,t.jsx)(I.SelectValue,{})}),(0,t.jsxs)(I.SelectContent,{className:"bg-popover border-border",children:[(0,t.jsx)(I.SelectItem,{value:"nda",className:"text-foreground",children:"NDA"}),(0,t.jsx)(I.SelectItem,{value:"term_sheet",className:"text-foreground",children:"Term Sheet"}),(0,t.jsx)(I.SelectItem,{value:"subscription",className:"text-foreground",children:"Subscription Agreement"}),(0,t.jsx)(I.SelectItem,{value:"contract",className:"text-foreground",children:"Contract"}),(0,t.jsx)(I.SelectItem,{value:"report",className:"text-foreground",children:"Report"}),(0,t.jsx)(I.SelectItem,{value:"other",className:"text-foreground",children:"Other"})]})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(z.Label,{htmlFor:"doc_name_file",className:"text-sm font-medium text-foreground",children:"Title"}),(0,t.jsx)(E.Input,{id:"doc_name_file",placeholder:"e.g., Board Resolution - Jan 2025",value:v,onChange:e=>y(e.target.value),className:"bg-background border-input text-foreground placeholder:text-muted-foreground focus:border-emerald-400/50 focus:ring-emerald-400/20"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(z.Label,{htmlFor:"doc_description_file",className:"text-sm font-medium text-foreground",children:"Description"}),(0,t.jsx)(E.Input,{id:"doc_description_file",placeholder:"Optional summary or context",value:_,onChange:e=>C(e.target.value),className:"bg-background border-input text-foreground placeholder:text-muted-foreground focus:border-emerald-400/50 focus:ring-emerald-400/20"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(z.Label,{htmlFor:"file-input",className:"text-sm font-medium text-foreground",children:"File *"}),(0,t.jsx)(E.Input,{id:"file-input",type:"file",onChange:e=>f(e.target.files?.[0]||null),accept:".pdf,.doc,.docx,.xls,.xlsx",className:"bg-background border-input text-foreground file:text-foreground"}),p&&(0,t.jsxs)("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[(0,t.jsx)(d.FileText,{className:"h-4 w-4"}),(0,t.jsx)("span",{className:"text-foreground",children:p.name}),(0,t.jsxs)("span",{className:"text-xs",children:["(",(p.size/1024).toFixed(1)," KB)"]})]})]})]}),(0,t.jsxs)(D.TabsContent,{value:"link",className:"mt-4 space-y-4",children:[(0,t.jsxs)("div",{className:"rounded-lg border border-border bg-muted/50 p-4 space-y-3",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 pb-2 border-b border-border",children:[(0,t.jsx)("div",{className:"h-8 w-8 rounded-full bg-emerald-500/20 flex items-center justify-center",children:(0,t.jsx)(d.FileText,{className:"h-4 w-4 text-emerald-600 dark:text-emerald-400"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"text-sm font-semibold text-foreground",children:"Link External Document"}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:"Connect to documents stored in Google Drive or other platforms"})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(z.Label,{htmlFor:"link-type",className:"text-sm font-medium text-foreground",children:"Link Source *"}),(0,t.jsxs)(I.Select,{value:V,onValueChange:U,children:[(0,t.jsx)(I.SelectTrigger,{id:"link-type",className:"bg-background border-input text-foreground",children:(0,t.jsx)(I.SelectValue,{})}),(0,t.jsxs)(I.SelectContent,{className:"bg-popover border-border",children:[(0,t.jsx)(I.SelectItem,{value:"google_drive",className:"text-foreground",children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("div",{className:"h-4 w-4 rounded bg-blue-500/20 flex items-center justify-center",children:(0,t.jsx)("span",{className:"text-xs",children:"G"})}),"Google Drive"]})}),(0,t.jsx)(I.SelectItem,{value:"sharepoint",className:"text-foreground",children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("div",{className:"h-4 w-4 rounded bg-blue-500/20 flex items-center justify-center",children:(0,t.jsx)("span",{className:"text-xs",children:"S"})}),"SharePoint"]})}),(0,t.jsx)(I.SelectItem,{value:"dropbox",className:"text-foreground",children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("div",{className:"h-4 w-4 rounded bg-blue-500/20 flex items-center justify-center",children:(0,t.jsx)("span",{className:"text-xs",children:"D"})}),"Dropbox"]})}),(0,t.jsx)(I.SelectItem,{value:"external",className:"text-foreground",children:"External URL"}),(0,t.jsx)(I.SelectItem,{value:"other",className:"text-foreground",children:"Other"})]})]}),"google_drive"===V&&(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:"Make sure the Google Drive link has proper sharing permissions"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)(z.Label,{htmlFor:"link-url",className:"text-sm font-medium text-foreground",children:["google_drive"===V?"Google Drive Share Link":"External URL"," *"]}),(0,t.jsx)(E.Input,{id:"link-url",type:"url",placeholder:"google_drive"===V?"https://drive.google.com/file/d/...":"https://example.com/document.pdf",value:T,onChange:e=>B(e.target.value),className:"bg-background border-input text-foreground placeholder:text-muted-foreground focus:border-emerald-400/50 focus:ring-emerald-400/20"}),"google_drive"===V&&T&&(0,t.jsxs)("div",{className:"flex items-start gap-2 p-2 rounded-md bg-blue-500/10 border border-blue-400/20",children:[(0,t.jsx)(N.Info,{className:"h-4 w-4 text-blue-600 dark:text-blue-400 mt-0.5 shrink-0"}),(0,t.jsxs)("div",{className:"text-xs text-blue-800 dark:text-blue-200",children:[(0,t.jsx)("p",{className:"font-medium",children:"Google Drive Link Detected"}),(0,t.jsx)("p",{className:"mt-0.5 opacity-80",children:"Verify the link is accessible to intended users"})]})]})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(z.Label,{htmlFor:"doc_type_link",className:"text-sm font-medium text-foreground",children:"Document Type *"}),(0,t.jsxs)(I.Select,{value:b,onValueChange:j,children:[(0,t.jsx)(I.SelectTrigger,{id:"doc_type_link",className:"bg-background border-input text-foreground",children:(0,t.jsx)(I.SelectValue,{})}),(0,t.jsxs)(I.SelectContent,{className:"bg-popover border-border",children:[(0,t.jsx)(I.SelectItem,{value:"nda",className:"text-foreground",children:"NDA"}),(0,t.jsx)(I.SelectItem,{value:"term_sheet",className:"text-foreground",children:"Term Sheet"}),(0,t.jsx)(I.SelectItem,{value:"subscription",className:"text-foreground",children:"Subscription Agreement"}),(0,t.jsx)(I.SelectItem,{value:"contract",className:"text-foreground",children:"Contract"}),(0,t.jsx)(I.SelectItem,{value:"report",className:"text-foreground",children:"Report"}),(0,t.jsx)(I.SelectItem,{value:"other",className:"text-foreground",children:"Other"})]})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(z.Label,{htmlFor:"doc_name_link",className:"text-sm font-medium text-foreground",children:"Title"}),(0,t.jsx)(E.Input,{id:"doc_name_link",placeholder:"e.g., Investor Presentation August 2025",value:v,onChange:e=>y(e.target.value),className:"bg-background border-input text-foreground placeholder:text-muted-foreground focus:border-emerald-400/50 focus:ring-emerald-400/20"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(z.Label,{htmlFor:"doc_description_link",className:"text-sm font-medium text-foreground",children:"Description"}),(0,t.jsx)(E.Input,{id:"doc_description_link",placeholder:"Optional summary or context",value:_,onChange:e=>C(e.target.value),className:"bg-background border-input text-foreground placeholder:text-muted-foreground focus:border-emerald-400/50 focus:ring-emerald-400/20"})]})]})]}),x&&(0,t.jsx)("div",{className:"p-3 rounded-lg bg-red-100 dark:bg-red-500/20 border border-red-300 dark:border-red-400/30 text-red-700 dark:text-red-200 text-sm",children:x}),(0,t.jsxs)("div",{className:"flex justify-end gap-2 pt-4",children:[(0,t.jsx)(k.Button,{variant:"outline",onClick:()=>m(!1),disabled:u,children:"Cancel"}),(0,t.jsx)(k.Button,{onClick:q,disabled:u||M&&!p||!M&&!T.trim(),className:"bg-emerald-600 hover:bg-emerald-700 text-white",children:u?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(w.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),M?"Uploading...":"Saving..."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(A.Upload,{className:"mr-2 h-4 w-4"}),M?"Upload":"Save Link"]})})]})]})]})}var V=e.i(816654),U=e.i(586145),P=e.i(750809),O=e.i(704477),R=e.i(907434),M=e.i(795988),q=e.i(476817),H=e.i(341695);H.z.object({full_name:H.z.string().min(1,"Full name is required").max(200,"Name must be less than 200 characters"),email:H.z.string().email("Must be a valid email address").max(255,"Email must be less than 255 characters").nullable().or(H.z.literal("")).transform(e=>""===e?null:e),phone:H.z.string().max(50,"Phone must be less than 50 characters").nullable().or(H.z.literal("")).transform(e=>""===e?null:e),nationality:H.z.string().max(100,"Nationality must be less than 100 characters").nullable().or(H.z.literal("")).transform(e=>""===e?null:e),id_number:H.z.string().max(100,"ID number must be less than 100 characters").nullable().or(H.z.literal("")).transform(e=>""===e?null:e),notes:H.z.string().max(5e3,"Notes must be less than 5000 characters").nullable().or(H.z.literal("")).transform(e=>""===e?null:e)});let J=H.z.object({role:H.z.string().min(1,"Role is required").max(100,"Role must be less than 100 characters"),effective_from:H.z.string().min(1,"Effective from date is required").refine(e=>!isNaN(new Date(e).getTime()),"Must be a valid date"),effective_to:H.z.string().nullable().refine(e=>!e||!isNaN(new Date(e).getTime()),"Must be a valid date").or(H.z.literal("")).transform(e=>""===e?null:e),notes:H.z.string().max(5e3,"Notes must be less than 5000 characters").nullable().or(H.z.literal("")).transform(e=>""===e?null:e)}).refine(e=>!e.effective_to||!e.effective_from||new Date(e.effective_from)<=new Date(e.effective_to),{message:"End date must be after start date",path:["effective_to"]}),G=H.z.object({full_name:H.z.string().min(1,"Full name is required").max(200,"Name must be less than 200 characters"),email:H.z.string().email("Must be a valid email address").max(255,"Email must be less than 255 characters").nullable().or(H.z.literal("")).transform(e=>""===e?null:e),phone:H.z.string().max(50,"Phone must be less than 50 characters").nullable().or(H.z.literal("")).transform(e=>""===e?null:e),nationality:H.z.string().max(100,"Nationality must be less than 100 characters").nullable().or(H.z.literal("")).transform(e=>""===e?null:e),id_number:H.z.string().max(100,"ID number must be less than 100 characters").nullable().or(H.z.literal("")).transform(e=>""===e?null:e),director_notes:H.z.string().max(5e3,"Notes must be less than 5000 characters").nullable().or(H.z.literal("")).transform(e=>""===e?null:e),role:H.z.string().min(1,"Role is required").max(100,"Role must be less than 100 characters"),effective_from:H.z.string().min(1,"Effective from date is required").refine(e=>!isNaN(new Date(e).getTime()),"Must be a valid date"),effective_to:H.z.string().nullable().refine(e=>!e||!isNaN(new Date(e).getTime()),"Must be a valid date").or(H.z.literal("")).transform(e=>""===e?null:e),assignment_notes:H.z.string().max(5e3,"Notes must be less than 5000 characters").nullable().or(H.z.literal("")).transform(e=>""===e?null:e)}).refine(e=>!e.effective_to||!e.effective_from||new Date(e.effective_from)<=new Date(e.effective_to),{message:"End date must be after start date",path:["effective_to"]}),K=H.z.object({role:H.z.string().min(1,"Role is required").max(100,"Role must be less than 100 characters"),effective_from:H.z.string().min(1,"Effective from date is required").refine(e=>!isNaN(new Date(e).getTime()),"Must be a valid date"),effective_to:H.z.string().nullable().refine(e=>!e||!isNaN(new Date(e).getTime()),"Must be a valid date").or(H.z.literal("")).transform(e=>""===e?null:e),notes:H.z.string().max(5e3,"Notes must be less than 5000 characters").nullable().or(H.z.literal("")).transform(e=>""===e?null:e)}).refine(e=>!e.effective_to||!e.effective_from||new Date(e.effective_from)<=new Date(e.effective_to),{message:"End date must be after start date",path:["effective_to"]});var W=e.i(994500);function Y({entityId:e,open:a,onClose:r,onSuccess:l,mode:i,existingDirector:n}){let[o,d]=(0,s.useState)("select"),[m,u]=(0,s.useState)(!1),[h,x]=(0,s.useState)(""),[g,f]=(0,s.useState)([]),[b,j]=(0,s.useState)(null),v=function({entityId:e,directorId:t,defaultValues:s,onSuccess:a}){let r=(0,M.useForm)({resolver:(0,q.zodResolver)(K),defaultValues:s||{role:"",effective_from:new Date().toISOString().split("T")[0],effective_to:null,notes:null}}),l=async s=>{try{let r=await fetch(`/api/entities/${e}/directors/${t}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({role:s.role,effective_from:s.effective_from,effective_to:s.effective_to,notes:s.notes})});if(!r.ok){let e=await r.json();throw Error(e.error||"Failed to update director")}let l=await r.json();W.toast.success("Director updated successfully"),a?.(l)}catch(e){throw console.error("Failed to update director:",e),W.toast.error(e instanceof Error?e.message:"Failed to update director"),e}};return{form:r,onSubmit:r.handleSubmit(l),isSubmitting:r.formState.isSubmitting,errors:r.formState.errors}}({entityId:e,directorId:n?.id||"",defaultValues:n?{role:n.role||"Director",effective_from:n.effective_from||new Date().toISOString().split("T")[0],effective_to:n.effective_to||null,notes:n.notes||null}:void 0,onSuccess:()=>{l(),C()}}),N=function({entityId:e,directorData:t,defaultValues:s,onSuccess:a}){let r=(0,M.useForm)({resolver:(0,q.zodResolver)(J),defaultValues:s||{role:"Director",effective_from:new Date().toISOString().split("T")[0],effective_to:null,notes:null}}),l=async s=>{try{let r=await fetch("/api/entity-directors",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({vehicle_id:e,full_name:t.full_name,email:t.email,role:s.role,effective_from:s.effective_from,effective_to:s.effective_to,notes:s.notes})});if(!r.ok){let e=await r.json();throw Error(e.error||"Failed to assign director")}let l=await r.json();W.toast.success("Director assigned successfully"),a?.(l)}catch(e){throw console.error("Failed to assign director:",e),W.toast.error(e instanceof Error?e.message:"Failed to assign director"),e}};return{form:r,onSubmit:r.handleSubmit(l),isSubmitting:r.formState.isSubmitting,errors:r.formState.errors}}({entityId:e,directorData:b||{full_name:"",email:null},defaultValues:{role:"Director",effective_from:new Date().toISOString().split("T")[0],effective_to:null,notes:null},onSuccess:()=>{l(),C()}}),y=function({entityId:e,defaultValues:t,onSuccess:s}){let a=(0,M.useForm)({resolver:(0,q.zodResolver)(G),defaultValues:t||{full_name:"",email:null,phone:null,nationality:null,id_number:null,director_notes:null,role:"Director",effective_from:new Date().toISOString().split("T")[0],effective_to:null,assignment_notes:null}}),r=async t=>{try{let a=await fetch("/api/director-registry",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({full_name:t.full_name,email:t.email,phone:t.phone,nationality:t.nationality,id_number:t.id_number,notes:t.director_notes})});if(!a.ok){let e=await a.json();throw Error(e.error||"Failed to register director")}let r=await fetch("/api/entity-directors",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({vehicle_id:e,full_name:t.full_name,email:t.email,role:t.role,effective_from:t.effective_from,effective_to:t.effective_to,notes:t.assignment_notes})});if(!r.ok){let e=await r.json();throw Error(e.error||"Failed to assign director")}let l=await r.json();W.toast.success("Director registered and assigned successfully"),s?.(l)}catch(e){throw console.error("Failed to create and assign director:",e),W.toast.error(e instanceof Error?e.message:"Failed to create and assign director"),e}};return{form:a,onSubmit:a.handleSubmit(r),isSubmitting:a.formState.isSubmitting,errors:a.formState.errors}}({entityId:e,defaultValues:{full_name:"",email:null,phone:null,nationality:null,id_number:null,director_notes:null,role:"Director",effective_from:new Date().toISOString().split("T")[0],effective_to:null,assignment_notes:null},onSuccess:()=>{l(),C()}}),_=(0,s.useCallback)(async()=>{u(!0);try{let e=h?`/api/director-registry?search=${encodeURIComponent(h)}`:"/api/director-registry",t=await fetch(e);if(!t.ok)throw Error("Failed to fetch directors");let s=await t.json();f(s.directors||[])}catch(e){console.error("Failed to fetch directors:",e),W.toast.error("Failed to load directors")}finally{u(!1)}},[h]);(0,s.useEffect)(()=>{a&&"create"===i&&"select"===o&&_()},[a,i,o,h,_]);let C=()=>{d("select"),j(null),x(""),N.form.reset(),y.form.reset(),v.form.reset(),r()};return"edit"===i&&n?(0,t.jsx)(L.Dialog,{open:a,onOpenChange:C,children:(0,t.jsxs)(L.DialogContent,{className:"sm:max-w-[600px] bg-zinc-950 border-white/10",children:[(0,t.jsxs)(L.DialogHeader,{children:[(0,t.jsxs)(L.DialogTitle,{className:"text-white flex items-center gap-2",children:[(0,t.jsx)(p.Edit,{className:"h-5 w-5 text-emerald-400"}),"Edit Director Assignment"]}),(0,t.jsxs)(L.DialogDescription,{className:"text-gray-400",children:["Update assignment details for ",n.full_name]})]}),(0,t.jsx)(U.Form,{...v.form,children:(0,t.jsxs)("form",{onSubmit:v.onSubmit,className:"space-y-4 py-4",children:[(0,t.jsx)(U.FormField,{control:v.form.control,name:"role",render:({field:e})=>(0,t.jsxs)(U.FormItem,{children:[(0,t.jsx)(U.FormLabel,{className:"text-white",children:"Role *"}),(0,t.jsx)(U.FormControl,{children:(0,t.jsx)(E.Input,{placeholder:"e.g., Director, Chairman",className:"bg-white/5 border-white/10 text-white",...e})}),(0,t.jsx)(U.FormMessage,{})]})}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsx)(U.FormField,{control:v.form.control,name:"effective_from",render:({field:e})=>(0,t.jsxs)(U.FormItem,{children:[(0,t.jsx)(U.FormLabel,{className:"text-white",children:"Effective From *"}),(0,t.jsx)(U.FormControl,{children:(0,t.jsx)(E.Input,{type:"date",className:"bg-white/5 border-white/10 text-white",...e})}),(0,t.jsx)(U.FormMessage,{})]})}),(0,t.jsx)(U.FormField,{control:v.form.control,name:"effective_to",render:({field:e})=>(0,t.jsxs)(U.FormItem,{children:[(0,t.jsx)(U.FormLabel,{className:"text-white",children:"Effective To"}),(0,t.jsx)(U.FormControl,{children:(0,t.jsx)(E.Input,{type:"date",className:"bg-white/5 border-white/10 text-white",...e,value:e.value||""})}),(0,t.jsx)(U.FormDescription,{className:"text-xs text-gray-400",children:"Leave empty if still active"}),(0,t.jsx)(U.FormMessage,{})]})})]}),(0,t.jsx)(U.FormField,{control:v.form.control,name:"notes",render:({field:e})=>(0,t.jsxs)(U.FormItem,{children:[(0,t.jsx)(U.FormLabel,{className:"text-white",children:"Notes"}),(0,t.jsx)(U.FormControl,{children:(0,t.jsx)(V.Textarea,{placeholder:"Additional notes about this assignment...",rows:3,className:"bg-white/5 border-white/10 text-white",...e,value:e.value||""})}),(0,t.jsx)(U.FormMessage,{})]})}),(0,t.jsxs)(L.DialogFooter,{className:"border-t border-white/10 pt-4",children:[(0,t.jsx)(k.Button,{type:"button",variant:"outline",onClick:C,disabled:v.isSubmitting,className:"border-white/10 text-white hover:bg-white/10 bg-white/5",children:"Cancel"}),(0,t.jsx)(k.Button,{type:"submit",disabled:v.isSubmitting,className:"bg-emerald-600 hover:bg-emerald-700 text-white",children:v.isSubmitting?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(w.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),"Saving..."]}):"Save Changes"})]})]})})]})}):(0,t.jsx)(L.Dialog,{open:a,onOpenChange:C,children:(0,t.jsxs)(L.DialogContent,{className:"sm:max-w-[700px] bg-zinc-950 border-white/10 max-h-[90vh] overflow-y-auto",children:[(0,t.jsxs)(L.DialogHeader,{children:[(0,t.jsxs)(L.DialogTitle,{className:"text-white flex items-center gap-2",children:[(0,t.jsx)(O.User,{className:"h-5 w-5 text-emerald-400"}),"select"===o?"Add Director from Registry":"Register New Director"]}),(0,t.jsx)(L.DialogDescription,{className:"text-gray-400",children:"select"===o?"Select an existing director or register a new one":"Add a new director to the registry and assign to this entity"})]}),"select"===o?(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(z.Label,{className:"text-sm font-medium text-white",children:"Search Directors"}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(P.Search,{className:"absolute left-3 top-3 h-4 w-4 text-gray-500"}),(0,t.jsx)(E.Input,{placeholder:"Search directors by name or email...",value:h,onChange:e=>x(e.target.value),className:"pl-9 bg-white/5 border-white/10 text-white placeholder:text-gray-500 focus:border-emerald-400/50 focus:ring-emerald-400/20"})]}),(0,t.jsx)("p",{className:"text-xs text-gray-400",children:"Start typing to filter the director registry"})]}),(0,t.jsx)(R.ScrollArea,{className:"h-[300px] rounded border border-white/10 bg-white/5",children:(0,t.jsx)("div",{className:"p-2 space-y-2",children:m?(0,t.jsxs)("div",{className:"text-center py-8 text-gray-400",children:[(0,t.jsx)(w.Loader2,{className:"h-6 w-6 animate-spin mx-auto mb-2 text-emerald-400"}),(0,t.jsx)("p",{children:"Searching..."})]}):0===g.length?(0,t.jsxs)("div",{className:"text-center py-8 text-gray-400",children:[(0,t.jsx)("div",{className:"h-12 w-12 rounded-full bg-white/5 flex items-center justify-center mx-auto mb-2",children:(0,t.jsx)(O.User,{className:"h-6 w-6"})}),(0,t.jsx)("p",{className:"text-white",children:"No directors found"}),(0,t.jsx)(k.Button,{variant:"link",size:"sm",onClick:()=>d("create"),className:"mt-2 text-emerald-400 hover:text-emerald-300",children:"Register new director"})]}):g.map(e=>(0,t.jsxs)(S.Card,{className:`p-3 cursor-pointer transition-all ${b?.id===e.id?"border-emerald-500 bg-emerald-500/10":"border-white/10 bg-white/5 hover:bg-white/10"}`,onClick:()=>{j(e)},children:[(0,t.jsx)("div",{className:"font-medium text-white",children:e.full_name}),e.email&&(0,t.jsx)("div",{className:"text-sm text-gray-400",children:e.email}),e.nationality&&(0,t.jsx)("div",{className:"text-xs text-gray-400 mt-1",children:e.nationality})]},e.id))})}),b&&(0,t.jsx)(U.Form,{...N.form,children:(0,t.jsxs)("form",{onSubmit:N.onSubmit,className:"border-t border-white/10 pt-4 space-y-3",children:[(0,t.jsx)("h4",{className:"font-medium text-sm text-white",children:"Assignment Details"}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,t.jsx)(U.FormField,{control:N.form.control,name:"role",render:({field:e})=>(0,t.jsxs)(U.FormItem,{children:[(0,t.jsx)(U.FormLabel,{className:"text-white",children:"Role *"}),(0,t.jsx)(U.FormControl,{children:(0,t.jsx)(E.Input,{placeholder:"e.g., Director, Chairman",className:"bg-white/5 border-white/10 text-white",...e})}),(0,t.jsx)(U.FormMessage,{})]})}),(0,t.jsx)(U.FormField,{control:N.form.control,name:"effective_from",render:({field:e})=>(0,t.jsxs)(U.FormItem,{children:[(0,t.jsx)(U.FormLabel,{className:"text-white",children:"Effective From *"}),(0,t.jsx)(U.FormControl,{children:(0,t.jsx)(E.Input,{type:"date",className:"bg-white/5 border-white/10 text-white",...e})}),(0,t.jsx)(U.FormMessage,{})]})})]}),(0,t.jsx)(U.FormField,{control:N.form.control,name:"notes",render:({field:e})=>(0,t.jsxs)(U.FormItem,{children:[(0,t.jsx)(U.FormLabel,{className:"text-white",children:"Notes"}),(0,t.jsx)(U.FormControl,{children:(0,t.jsx)(V.Textarea,{placeholder:"Any additional notes...",rows:2,className:"bg-white/5 border-white/10 text-white",...e,value:e.value||""})}),(0,t.jsx)(U.FormMessage,{})]})})]})}),(0,t.jsxs)(k.Button,{variant:"outline",onClick:()=>d("create"),className:"w-full gap-2 border-emerald-500/30 text-emerald-400 hover:bg-emerald-500/10 bg-emerald-500/5",disabled:N.isSubmitting,children:[(0,t.jsx)(c.Plus,{className:"h-4 w-4"}),"Register New Director"]}),(0,t.jsxs)(L.DialogFooter,{className:"border-t border-white/10 pt-4",children:[(0,t.jsx)(k.Button,{type:"button",variant:"outline",onClick:C,disabled:N.isSubmitting,className:"border-white/10 text-white hover:bg-white/10 bg-white/5",children:"Cancel"}),(0,t.jsx)(k.Button,{onClick:N.onSubmit,disabled:N.isSubmitting||!b,className:"bg-emerald-600 hover:bg-emerald-700 text-white",children:N.isSubmitting?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(w.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),"Assigning..."]}):"Assign Director"})]})]}):(0,t.jsx)(U.Form,{...y.form,children:(0,t.jsxs)("form",{onSubmit:y.onSubmit,className:"space-y-4",children:[(0,t.jsxs)("div",{className:"rounded-lg border border-white/10 bg-white/5 p-4 space-y-3",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 pb-2 border-b border-white/10",children:[(0,t.jsx)("div",{className:"h-8 w-8 rounded-full bg-emerald-500/20 flex items-center justify-center",children:(0,t.jsx)(O.User,{className:"h-4 w-4 text-emerald-400"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"text-sm font-semibold text-white",children:"Director Information"}),(0,t.jsx)("p",{className:"text-xs text-gray-400",children:"Enter the director's personal details"})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,t.jsx)("div",{className:"col-span-2",children:(0,t.jsx)(U.FormField,{control:y.form.control,name:"full_name",render:({field:e})=>(0,t.jsxs)(U.FormItem,{children:[(0,t.jsx)(U.FormLabel,{className:"text-white",children:"Full Name *"}),(0,t.jsx)(U.FormControl,{children:(0,t.jsx)(E.Input,{placeholder:"John Smith",className:"bg-white/5 border-white/10 text-white",...e})}),(0,t.jsx)(U.FormMessage,{})]})})}),(0,t.jsx)(U.FormField,{control:y.form.control,name:"email",render:({field:e})=>(0,t.jsxs)(U.FormItem,{children:[(0,t.jsx)(U.FormLabel,{className:"text-white",children:"Email"}),(0,t.jsx)(U.FormControl,{children:(0,t.jsx)(E.Input,{type:"email",placeholder:"john@example.com",className:"bg-white/5 border-white/10 text-white",...e,value:e.value||""})}),(0,t.jsx)(U.FormMessage,{})]})}),(0,t.jsx)(U.FormField,{control:y.form.control,name:"phone",render:({field:e})=>(0,t.jsxs)(U.FormItem,{children:[(0,t.jsx)(U.FormLabel,{className:"text-white",children:"Phone"}),(0,t.jsx)(U.FormControl,{children:(0,t.jsx)(E.Input,{placeholder:"+1 234 567 8900",className:"bg-white/5 border-white/10 text-white",...e,value:e.value||""})}),(0,t.jsx)(U.FormMessage,{})]})}),(0,t.jsx)(U.FormField,{control:y.form.control,name:"nationality",render:({field:e})=>(0,t.jsxs)(U.FormItem,{children:[(0,t.jsx)(U.FormLabel,{className:"text-white",children:"Nationality"}),(0,t.jsx)(U.FormControl,{children:(0,t.jsx)(E.Input,{placeholder:"e.g., British, American",className:"bg-white/5 border-white/10 text-white",...e,value:e.value||""})}),(0,t.jsx)(U.FormMessage,{})]})}),(0,t.jsx)(U.FormField,{control:y.form.control,name:"id_number",render:({field:e})=>(0,t.jsxs)(U.FormItem,{children:[(0,t.jsx)(U.FormLabel,{className:"text-white",children:"ID/Passport Number"}),(0,t.jsx)(U.FormControl,{children:(0,t.jsx)(E.Input,{placeholder:"AB123456",className:"bg-white/5 border-white/10 text-white",...e,value:e.value||""})}),(0,t.jsx)(U.FormMessage,{})]})}),(0,t.jsx)("div",{className:"col-span-2",children:(0,t.jsx)(U.FormField,{control:y.form.control,name:"director_notes",render:({field:e})=>(0,t.jsxs)(U.FormItem,{children:[(0,t.jsx)(U.FormLabel,{className:"text-white",children:"Notes"}),(0,t.jsx)(U.FormControl,{children:(0,t.jsx)(V.Textarea,{placeholder:"Additional information...",rows:2,className:"bg-white/5 border-white/10 text-white",...e,value:e.value||""})}),(0,t.jsx)(U.FormMessage,{})]})})})]})]}),(0,t.jsxs)("div",{className:"border-t border-white/10 pt-4 space-y-3",children:[(0,t.jsx)("h4",{className:"font-medium text-sm text-white",children:"Entity Assignment"}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,t.jsx)(U.FormField,{control:y.form.control,name:"role",render:({field:e})=>(0,t.jsxs)(U.FormItem,{children:[(0,t.jsx)(U.FormLabel,{className:"text-white",children:"Role *"}),(0,t.jsx)(U.FormControl,{children:(0,t.jsx)(E.Input,{placeholder:"e.g., Director, Chairman",className:"bg-white/5 border-white/10 text-white",...e})}),(0,t.jsx)(U.FormMessage,{})]})}),(0,t.jsx)(U.FormField,{control:y.form.control,name:"effective_from",render:({field:e})=>(0,t.jsxs)(U.FormItem,{children:[(0,t.jsx)(U.FormLabel,{className:"text-white",children:"Effective From *"}),(0,t.jsx)(U.FormControl,{children:(0,t.jsx)(E.Input,{type:"date",className:"bg-white/5 border-white/10 text-white",...e})}),(0,t.jsx)(U.FormMessage,{})]})})]}),(0,t.jsx)(U.FormField,{control:y.form.control,name:"assignment_notes",render:({field:e})=>(0,t.jsxs)(U.FormItem,{children:[(0,t.jsx)(U.FormLabel,{className:"text-white",children:"Assignment Notes"}),(0,t.jsx)(U.FormControl,{children:(0,t.jsx)(V.Textarea,{placeholder:"Notes about this assignment...",rows:2,className:"bg-white/5 border-white/10 text-white",...e,value:e.value||""})}),(0,t.jsx)(U.FormMessage,{})]})})]}),(0,t.jsx)(k.Button,{type:"button",variant:"outline",onClick:()=>d("select"),className:"w-full border-white/10 text-white hover:bg-white/10 bg-white/5",disabled:y.isSubmitting,children:"Back to Selection"}),(0,t.jsxs)(L.DialogFooter,{className:"border-t border-white/10 pt-4",children:[(0,t.jsx)(k.Button,{type:"button",variant:"outline",onClick:C,disabled:y.isSubmitting,className:"border-white/10 text-white hover:bg-white/10 bg-white/5",children:"Cancel"}),(0,t.jsx)(k.Button,{type:"submit",disabled:y.isSubmitting,className:"bg-emerald-600 hover:bg-emerald-700 text-white",children:y.isSubmitting?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(w.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),"Creating..."]}):"Register & Assign"})]})]})})]})})}let Q=["lawyer","accountant","auditor","administrator","strategic_partner","shareholder","other"],X=H.z.object({role:H.z.enum(Q),company_name:H.z.string().min(1,"Company/Firm name is required").max(200,"Company name must be less than 200 characters"),contact_person:H.z.string().max(200,"Contact person name must be less than 200 characters").nullable().or(H.z.literal("")).transform(e=>""===e?null:e),email:H.z.string().email("Must be a valid email address").max(255,"Email must be less than 255 characters").nullable().or(H.z.literal("")).transform(e=>""===e?null:e),phone:H.z.string().max(50,"Phone must be less than 50 characters").nullable().or(H.z.literal("")).transform(e=>""===e?null:e),effective_from:H.z.string().min(1,"Effective from date is required").refine(e=>!isNaN(new Date(e).getTime()),"Must be a valid date"),effective_to:H.z.string().nullable().refine(e=>!e||!isNaN(new Date(e).getTime()),"Must be a valid date").or(H.z.literal("")).transform(e=>""===e?null:e),notes:H.z.string().max(5e3,"Notes must be less than 5000 characters").nullable().or(H.z.literal("")).transform(e=>""===e?null:e)}).refine(e=>!e.effective_to||!e.effective_from||new Date(e.effective_from)<=new Date(e.effective_to),{message:"End date must be after start date",path:["effective_to"]}),Z=H.z.object({role:H.z.enum(Q),company_name:H.z.string().min(1,"Company/Firm name is required").max(200,"Company name must be less than 200 characters"),contact_person:H.z.string().max(200,"Contact person name must be less than 200 characters").nullable().or(H.z.literal("")).transform(e=>""===e?null:e),email:H.z.string().email("Must be a valid email address").max(255,"Email must be less than 255 characters").nullable().or(H.z.literal("")).transform(e=>""===e?null:e),phone:H.z.string().max(50,"Phone must be less than 50 characters").nullable().or(H.z.literal("")).transform(e=>""===e?null:e),effective_from:H.z.string().min(1,"Effective from date is required").refine(e=>!isNaN(new Date(e).getTime()),"Must be a valid date"),effective_to:H.z.string().nullable().refine(e=>!e||!isNaN(new Date(e).getTime()),"Must be a valid date").or(H.z.literal("")).transform(e=>""===e?null:e),notes:H.z.string().max(5e3,"Notes must be less than 5000 characters").nullable().or(H.z.literal("")).transform(e=>""===e?null:e)}).refine(e=>!e.effective_to||!e.effective_from||new Date(e.effective_from)<=new Date(e.effective_to),{message:"End date must be after start date",path:["effective_to"]});function ee({entityId:e,open:s,onClose:a,onSuccess:r,mode:l,existingStakeholder:i}){let n=function({entityId:e,defaultValues:t,onSuccess:s}){let a=(0,M.useForm)({resolver:(0,q.zodResolver)(X),defaultValues:t||{role:"lawyer",company_name:"",contact_person:null,email:null,phone:null,effective_from:new Date().toISOString().split("T")[0],effective_to:null,notes:null}}),r=async t=>{try{let a=await fetch(`/api/entities/${e}/stakeholders`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!a.ok){let e=await a.json();throw Error(e.error||"Failed to add stakeholder")}let r=await a.json();W.toast.success("Stakeholder added successfully"),s?.(r)}catch(e){throw console.error("Failed to add stakeholder:",e),W.toast.error(e instanceof Error?e.message:"Failed to add stakeholder"),e}};return{form:a,onSubmit:a.handleSubmit(r),isSubmitting:a.formState.isSubmitting,errors:a.formState.errors}}({entityId:e,defaultValues:{role:"lawyer",company_name:"",contact_person:null,email:null,phone:null,effective_from:new Date().toISOString().split("T")[0],effective_to:null,notes:null},onSuccess:()=>{r(),h()}}),o=function({entityId:e,stakeholderId:t,defaultValues:s,onSuccess:a}){let r=(0,M.useForm)({resolver:(0,q.zodResolver)(Z),defaultValues:s||{role:"lawyer",company_name:"",contact_person:null,email:null,phone:null,effective_from:new Date().toISOString().split("T")[0],effective_to:null,notes:null}}),l=async s=>{try{let r=await fetch(`/api/entities/${e}/stakeholders/${t}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!r.ok){let e=await r.json();throw Error(e.error||"Failed to update stakeholder")}let l=await r.json();W.toast.success("Stakeholder updated successfully"),a?.(l)}catch(e){throw console.error("Failed to update stakeholder:",e),W.toast.error(e instanceof Error?e.message:"Failed to update stakeholder"),e}};return{form:r,onSubmit:r.handleSubmit(l),isSubmitting:r.formState.isSubmitting,errors:r.formState.errors}}({entityId:e,stakeholderId:i?.id||"",defaultValues:i?{role:i.role,company_name:i.company_name||"",contact_person:i.contact_person||null,email:i.email||null,phone:i.phone||null,effective_from:i.effective_from||new Date().toISOString().split("T")[0],effective_to:i.effective_to||null,notes:i.notes||null}:void 0,onSuccess:()=>{r(),h()}}),d="edit"===l?o.form:n.form,c="edit"===l?o.onSubmit:n.onSubmit,u="edit"===l?o.isSubmitting:n.isSubmitting,h=()=>{n.form.reset(),o.form.reset(),a()};return(0,t.jsx)(L.Dialog,{open:s,onOpenChange:h,children:(0,t.jsxs)(L.DialogContent,{className:"sm:max-w-[600px] max-h-[90vh] overflow-y-auto bg-zinc-950 border-white/10",children:[(0,t.jsxs)(L.DialogHeader,{children:[(0,t.jsx)(L.DialogTitle,{className:"text-white flex items-center gap-2",children:"edit"===l?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(p.Edit,{className:"h-5 w-5 text-emerald-400"}),"Edit Stakeholder"]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(m.Users,{className:"h-5 w-5 text-emerald-400"}),"Add Stakeholder"]})}),(0,t.jsx)(L.DialogDescription,{className:"text-gray-400",children:"edit"===l?"Update stakeholder information and assignment details":"Add lawyers, accountants, auditors, administrators, or strategic partners to this entity"})]}),(0,t.jsx)(U.Form,{...d,children:(0,t.jsxs)("form",{onSubmit:c,className:"space-y-4 py-4",children:[(0,t.jsx)(U.FormField,{control:d.control,name:"role",render:({field:e})=>(0,t.jsxs)(U.FormItem,{children:[(0,t.jsx)(U.FormLabel,{className:"text-white",children:"Stakeholder Role *"}),(0,t.jsxs)(I.Select,{onValueChange:e.onChange,defaultValue:e.value,children:[(0,t.jsx)(U.FormControl,{children:(0,t.jsx)(I.SelectTrigger,{className:"bg-white/5 border-white/10 text-white",children:(0,t.jsx)(I.SelectValue,{})})}),(0,t.jsx)(I.SelectContent,{className:"bg-zinc-950 border-white/10",children:Q.map(e=>(0,t.jsx)(I.SelectItem,{value:e,className:"text-white",children:{lawyer:"Lawyer / Legal Counsel",accountant:"Accountant",auditor:"Auditor",administrator:"Administrator",strategic_partner:"Strategic Partner",shareholder:"Shareholder",other:"Other"}[e]||e},e))})]}),(0,t.jsx)(U.FormMessage,{})]})}),(0,t.jsx)(U.FormField,{control:d.control,name:"company_name",render:({field:e})=>(0,t.jsxs)(U.FormItem,{children:[(0,t.jsx)(U.FormLabel,{className:"text-white",children:"Company / Firm Name *"}),(0,t.jsx)(U.FormControl,{children:(0,t.jsx)(E.Input,{placeholder:"e.g., Arendt & Medernach, KPMG Luxembourg",className:"bg-white/5 border-white/10 text-white",...e})}),(0,t.jsx)(U.FormMessage,{})]})}),(0,t.jsx)(U.FormField,{control:d.control,name:"contact_person",render:({field:e})=>(0,t.jsxs)(U.FormItem,{children:[(0,t.jsx)(U.FormLabel,{className:"text-white",children:"Contact Person"}),(0,t.jsx)(U.FormControl,{children:(0,t.jsx)(E.Input,{placeholder:"Primary contact name",className:"bg-white/5 border-white/10 text-white",...e,value:e.value||""})}),(0,t.jsx)(U.FormMessage,{})]})}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsx)(U.FormField,{control:d.control,name:"email",render:({field:e})=>(0,t.jsxs)(U.FormItem,{children:[(0,t.jsx)(U.FormLabel,{className:"text-white",children:"Email"}),(0,t.jsx)(U.FormControl,{children:(0,t.jsx)(E.Input,{type:"email",placeholder:"contact@firm.com",className:"bg-white/5 border-white/10 text-white",...e,value:e.value||""})}),(0,t.jsx)(U.FormMessage,{})]})}),(0,t.jsx)(U.FormField,{control:d.control,name:"phone",render:({field:e})=>(0,t.jsxs)(U.FormItem,{children:[(0,t.jsx)(U.FormLabel,{className:"text-white",children:"Phone"}),(0,t.jsx)(U.FormControl,{children:(0,t.jsx)(E.Input,{type:"tel",placeholder:"+352 123 456",className:"bg-white/5 border-white/10 text-white",...e,value:e.value||""})}),(0,t.jsx)(U.FormMessage,{})]})})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsx)(U.FormField,{control:d.control,name:"effective_from",render:({field:e})=>(0,t.jsxs)(U.FormItem,{children:[(0,t.jsx)(U.FormLabel,{className:"text-white",children:"Effective From *"}),(0,t.jsx)(U.FormControl,{children:(0,t.jsx)(E.Input,{type:"date",className:"bg-white/5 border-white/10 text-white",...e})}),(0,t.jsx)(U.FormMessage,{})]})}),(0,t.jsx)(U.FormField,{control:d.control,name:"effective_to",render:({field:e})=>(0,t.jsxs)(U.FormItem,{children:[(0,t.jsx)(U.FormLabel,{className:"text-white",children:"Effective To"}),(0,t.jsx)(U.FormControl,{children:(0,t.jsx)(E.Input,{type:"date",className:"bg-white/5 border-white/10 text-white",...e,value:e.value||""})}),(0,t.jsx)(U.FormDescription,{className:"text-xs text-gray-400",children:"Leave empty if currently active"}),(0,t.jsx)(U.FormMessage,{})]})})]}),(0,t.jsx)(U.FormField,{control:d.control,name:"notes",render:({field:e})=>(0,t.jsxs)(U.FormItem,{children:[(0,t.jsx)(U.FormLabel,{className:"text-white",children:"Additional Notes"}),(0,t.jsx)(U.FormControl,{children:(0,t.jsx)(V.Textarea,{placeholder:"Add any relevant information about this stakeholder...",rows:3,className:"bg-white/5 border-white/10 text-white",...e,value:e.value||""})}),(0,t.jsx)(U.FormMessage,{})]})}),(0,t.jsxs)(L.DialogFooter,{className:"border-t border-white/10 pt-4",children:[(0,t.jsx)(k.Button,{type:"button",variant:"outline",onClick:h,disabled:u,className:"border-white/10 text-white hover:bg-white/10 bg-white/5",children:"Cancel"}),(0,t.jsx)(k.Button,{type:"submit",disabled:u,className:"bg-emerald-600 hover:bg-emerald-700 text-white",children:u?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(w.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),"edit"===l?"Saving...":"Adding..."]}):"edit"===l?"Save Changes":"Add Stakeholder"})]})]})})]})})}var et=e.i(663216),es=e.i(619962),ea=e.i(45778);let er=H.z.object({name:H.z.string().min(1,"Entity name is required").max(200,"Name must be less than 200 characters"),entity_code:H.z.string().min(1,"Entity code is required").max(50,"Entity code must be less than 50 characters").nullable(),platform:H.z.string().max(100,"Platform must be less than 100 characters").nullable(),investment_name:H.z.string().max(200,"Investment name must be less than 200 characters").nullable(),former_entity:H.z.string().max(200,"Former entity name must be less than 200 characters").nullable(),status:H.z.enum(["LIVE","CLOSED","TBD"]),type:H.z.enum(["fund","spv","securitization","note","venture_capital","private_equity","real_estate","other"]),domicile:H.z.string().max(100,"Domicile must be less than 100 characters").nullable(),currency:H.z.string().length(3,"Currency must be exactly 3 letters").transform(e=>e.toUpperCase()),formation_date:H.z.string().nullable(),legal_jurisdiction:H.z.string().max(100,"Legal jurisdiction must be less than 100 characters").nullable(),registration_number:H.z.string().max(100,"Registration number must be less than 100 characters").nullable(),reporting_type:H.z.enum(["Not Required","Company Only","Online only","Company + Online"]).nullable(),requires_reporting:H.z.boolean().nullable(),notes:H.z.string().max(5e3,"Notes must be less than 5000 characters").nullable(),logo_url:H.z.string().url("Logo URL must be a valid URL").nullable().or(H.z.literal("")).transform(e=>""===e?null:e),website_url:H.z.string().url("Website URL must be a valid URL").nullable().or(H.z.literal("")).transform(e=>""===e?null:e)});var el=e.i(908925);function ei(){let[e,a]=(0,s.useState)(!1),[r,l]=(0,s.useState)(null),[i,n]=(0,s.useState)(null),o=(0,s.useCallback)((e,t)=>{l(e),n(()=>t),a(!0)},[]),d=(0,s.useCallback)(()=>{i?.(),a(!1)},[i]),c=(0,s.useCallback)(()=>{a(!1)},[]);return{confirm:o,ConfirmationDialog:(0,s.useCallback)(()=>r?(0,t.jsx)(el.AlertDialog,{open:e,onOpenChange:a,children:(0,t.jsxs)(el.AlertDialogContent,{className:"bg-zinc-950 border-white/10",children:[(0,t.jsxs)(el.AlertDialogHeader,{children:[(0,t.jsx)(el.AlertDialogTitle,{className:"text-white",children:r.title}),(0,t.jsx)(el.AlertDialogDescription,{className:"text-gray-400",children:r.description})]}),(0,t.jsxs)(el.AlertDialogFooter,{children:[(0,t.jsx)(el.AlertDialogCancel,{onClick:c,className:"bg-gray-700 text-white border-gray-600 hover:bg-gray-600",children:r.cancelText||"Cancel"}),(0,t.jsx)(el.AlertDialogAction,{onClick:d,className:"destructive"===r.variant?"bg-red-600 hover:bg-red-700 text-white":"bg-emerald-600 hover:bg-emerald-700 text-white",children:r.confirmText||"Confirm"})]})]})}):null,[r,e,d,c])}}let en=[{value:"LIVE",label:"Live"},{value:"TBD",label:"TBD"},{value:"CLOSED",label:"Closed"}],eo=[{value:"fund",label:"Fund"},{value:"spv",label:"SPV"},{value:"securitization",label:"Securitization"},{value:"note",label:"Note"},{value:"venture_capital",label:"Venture Capital"},{value:"private_equity",label:"Private Equity"},{value:"real_estate",label:"Real Estate"},{value:"other",label:"Other"}],ed=[{value:"Not Required",label:"Not Required"},{value:"Company Only",label:"Company Only"},{value:"Online only",label:"Online Only"},{value:"Company + Online",label:"Company + Online"}],ec=["USD","EUR","GBP","CHF","JPY","AUD","CAD"];function em({entity:e,open:r,onClose:l,onSuccess:i}){let[n,o]=(0,s.useState)(e.logo_url||""),[d,c]=(0,s.useState)(!1),[m,u]=(0,s.useState)(null),{confirm:h,ConfirmationDialog:x}=ei(),[g,f]=(0,s.useState)({arrangers:[],lawyers:[]}),[b,j]=(0,s.useState)(!1),[N,y]=(0,s.useState)(e.arranger_entity_id||""),[C,F]=(0,s.useState)(e.lawyer_id||""),[S,D]=(0,s.useState)(e.address||""),T=(0,s.useCallback)(async()=>{j(!0);try{let e=await fetch("/api/vehicles/dropdown-options");if(e.ok){let t=await e.json();f(t)}}catch(e){console.error("Failed to fetch dropdown options:",e)}finally{j(!1)}},[]),{form:B,onSubmit:P,isSubmitting:O}=function({entityId:e,defaultValues:t,onSuccess:s,mode:a="edit"}){let r=(0,$.useRouter)(),l=(0,M.useForm)({resolver:(0,q.zodResolver)(er),defaultValues:t||{name:"",entity_code:"",platform:"",investment_name:"",former_entity:"",status:"LIVE",type:"fund",domicile:"",currency:"USD",formation_date:null,legal_jurisdiction:"",registration_number:"",reporting_type:"Not Required",requires_reporting:!1,notes:"",logo_url:null,website_url:null}}),i=async t=>{try{let l="edit"===a&&e?`/api/entities/${e}`:"/api/vehicles",i=await fetch(l,{method:"edit"===a?"PATCH":"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!i.ok){let e=await i.json();throw Error(e.error||`Failed to ${a} entity`)}let n=await i.json();W.toast.success("edit"===a?"Entity updated successfully":"Entity created successfully"),s?.(n),"create"===a&&n.vehicle?.id&&r.push(`/versotech_main/entities/${n.vehicle.id}`)}catch(e){throw console.error(`Failed to ${a} entity:`,e),W.toast.error(e instanceof Error?e.message:`Failed to ${a} entity`),e}};return{form:l,onSubmit:l.handleSubmit(i),isSubmitting:l.formState.isSubmitting,errors:l.formState.errors}}({entityId:e.id,mode:"edit",defaultValues:{name:e.name||"",entity_code:e.entity_code||"",platform:e.platform||"",investment_name:e.investment_name||"",former_entity:e.former_entity||"",status:e.status||"LIVE",type:e.type||"fund",domicile:e.domicile||"",currency:e.currency||"USD",formation_date:e.formation_date?e.formation_date.slice(0,10):null,legal_jurisdiction:e.legal_jurisdiction||"",registration_number:e.registration_number||"",reporting_type:e.reporting_type||"Not Required",requires_reporting:e.requires_reporting??!1,notes:e.notes||"",logo_url:e.logo_url||null,website_url:e.website_url||""},onSuccess:e=>{i(e.entity),l()}});(0,s.useEffect)(()=>{r&&T()},[r,T]),(0,s.useEffect)(()=>{r&&(o(e.logo_url||""),u(null),y(e.arranger_entity_id||""),F(e.lawyer_id||""),D(e.address||""),B.reset({name:e.name||"",entity_code:e.entity_code||"",platform:e.platform||"",investment_name:e.investment_name||"",former_entity:e.former_entity||"",status:e.status||"LIVE",type:e.type||"fund",domicile:e.domicile||"",currency:e.currency||"USD",formation_date:e.formation_date?e.formation_date.slice(0,10):null,legal_jurisdiction:e.legal_jurisdiction||"",registration_number:e.registration_number||"",reporting_type:e.reporting_type||"Not Required",requires_reporting:e.requires_reporting??!1,notes:e.notes||"",logo_url:e.logo_url||null,website_url:e.website_url||""}))},[e,r,B]);let R=async t=>{u(null),c(!0);try{let s=new FormData;s.append("file",t),s.append("vehicle_id",e.id);let a=await fetch("/api/entities/logo-upload",{method:"POST",body:s}),r=await a.json().catch(()=>({}));if(!a.ok)throw Error(r.error||"Failed to upload logo");o(r.url),B.setValue("logo_url",r.url),W.toast.success("Logo uploaded successfully")}catch(t){let e=t instanceof Error?t.message:"Failed to upload logo";u(e),W.toast.error(e)}finally{c(!1)}},H=async()=>{if(await B.trigger())try{let t=await fetch(`/api/entities/${e.id}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({...B.getValues(),logo_url:n||null,address:S||null,arranger_entity_id:N||null,lawyer_id:C||null})});if(!t.ok){let e=await t.json().catch(()=>({}));throw Error(e.error||"Failed to update vehicle")}let s=await t.json();W.toast.success("Vehicle updated successfully"),i(s.entity),l()}catch(e){W.toast.error(e instanceof Error?e.message:"Failed to update vehicle")}};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(L.Dialog,{open:r,onOpenChange:l,children:(0,t.jsxs)(L.DialogContent,{className:"bg-background border-border max-w-4xl max-h-[90vh] overflow-y-auto",children:[(0,t.jsxs)(L.DialogHeader,{children:[(0,t.jsxs)(L.DialogTitle,{className:"flex items-center gap-2 text-foreground",children:[(0,t.jsx)(p.Edit,{className:"h-5 w-5 text-emerald-400"}),"Edit Vehicle"]}),(0,t.jsx)(L.DialogDescription,{className:"text-muted-foreground",children:"Update vehicle information and metadata"})]}),(0,t.jsx)(U.Form,{...B,children:(0,t.jsxs)("form",{onSubmit:e=>{e.preventDefault(),h({title:"Confirm Changes",description:"Are you sure you want to save these changes to the vehicle?",confirmText:"Save Changes",variant:"default"},()=>{H()})},className:"space-y-6",children:[(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)("h3",{className:"text-sm font-semibold text-emerald-400 uppercase tracking-wide",children:"Basic Information"}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsx)(U.FormField,{control:B.control,name:"name",render:({field:e})=>(0,t.jsxs)(U.FormItem,{className:"col-span-2",children:[(0,t.jsx)(U.FormLabel,{className:"text-foreground",children:"Vehicle Name *"}),(0,t.jsx)(U.FormControl,{children:(0,t.jsx)(E.Input,{...e,className:"bg-background border-input text-foreground",placeholder:"Enter vehicle name"})}),(0,t.jsx)(U.FormMessage,{})]})}),(0,t.jsx)(U.FormField,{control:B.control,name:"entity_code",render:({field:e})=>(0,t.jsxs)(U.FormItem,{children:[(0,t.jsx)(U.FormLabel,{className:"text-foreground",children:"Vehicle Code"}),(0,t.jsx)(U.FormControl,{children:(0,t.jsx)(E.Input,{...e,value:e.value||"",className:"bg-background border-input text-foreground font-mono",placeholder:"e.g., VEH001"})}),(0,t.jsx)(U.FormDescription,{className:"text-xs text-muted-foreground",children:"Unique identifier for this vehicle"}),(0,t.jsx)(U.FormMessage,{})]})}),(0,t.jsx)(U.FormField,{control:B.control,name:"platform",render:({field:e})=>(0,t.jsxs)(U.FormItem,{children:[(0,t.jsx)(U.FormLabel,{className:"text-foreground",children:"Platform"}),(0,t.jsx)(U.FormControl,{children:(0,t.jsx)(E.Input,{...e,value:e.value||"",className:"bg-background border-input text-foreground",placeholder:"e.g., Fund Admin Platform"})}),(0,t.jsx)(U.FormMessage,{})]})}),(0,t.jsx)(U.FormField,{control:B.control,name:"type",render:({field:e})=>(0,t.jsxs)(U.FormItem,{children:[(0,t.jsx)(U.FormLabel,{className:"text-foreground",children:"Vehicle Type *"}),(0,t.jsxs)(I.Select,{onValueChange:e.onChange,value:e.value,children:[(0,t.jsx)(U.FormControl,{children:(0,t.jsx)(I.SelectTrigger,{className:"bg-background border-input text-foreground",children:(0,t.jsx)(I.SelectValue,{})})}),(0,t.jsx)(I.SelectContent,{className:"bg-popover border-border",children:eo.map(e=>(0,t.jsx)(I.SelectItem,{value:e.value,className:"text-foreground",children:e.label},e.value))})]}),(0,t.jsx)(U.FormMessage,{})]})}),(0,t.jsx)(U.FormField,{control:B.control,name:"status",render:({field:e})=>(0,t.jsxs)(U.FormItem,{children:[(0,t.jsx)(U.FormLabel,{className:"text-foreground",children:"Status *"}),(0,t.jsxs)(I.Select,{onValueChange:e.onChange,value:e.value,children:[(0,t.jsx)(U.FormControl,{children:(0,t.jsx)(I.SelectTrigger,{className:"bg-background border-input text-foreground",children:(0,t.jsx)(I.SelectValue,{})})}),(0,t.jsx)(I.SelectContent,{className:"bg-popover border-border",children:en.map(e=>(0,t.jsx)(I.SelectItem,{value:e.value,className:"text-foreground",children:e.label},e.value))})]}),(0,t.jsx)(U.FormMessage,{})]})})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsx)(U.FormField,{control:B.control,name:"investment_name",render:({field:e})=>(0,t.jsxs)(U.FormItem,{children:[(0,t.jsx)(U.FormLabel,{className:"text-foreground",children:"Investment Name"}),(0,t.jsx)(U.FormControl,{children:(0,t.jsx)(E.Input,{...e,value:e.value||"",className:"bg-background border-input text-foreground",placeholder:"Investment vehicle name"})}),(0,t.jsx)(U.FormMessage,{})]})}),(0,t.jsx)(U.FormField,{control:B.control,name:"former_entity",render:({field:e})=>(0,t.jsxs)(U.FormItem,{children:[(0,t.jsx)(U.FormLabel,{className:"text-foreground",children:"Former Vehicle Name"}),(0,t.jsx)(U.FormControl,{children:(0,t.jsx)(E.Input,{...e,value:e.value||"",className:"bg-background border-input text-foreground",placeholder:"Previous name if renamed"})}),(0,t.jsx)(U.FormMessage,{})]})})]})]}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)("h3",{className:"text-sm font-semibold text-emerald-400 uppercase tracking-wide",children:"Service Providers"}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(z.Label,{className:"text-foreground",children:"Arranger"}),(0,t.jsxs)(I.Select,{value:N,onValueChange:e=>y("none"===e?"":e),disabled:b,children:[(0,t.jsx)(I.SelectTrigger,{className:"bg-background border-input text-foreground",children:(0,t.jsx)(I.SelectValue,{placeholder:b?"Loading...":"Select arranger"})}),(0,t.jsxs)(I.SelectContent,{children:[(0,t.jsx)(I.SelectItem,{value:"none",children:"None"}),g.arrangers.map(e=>(0,t.jsx)(I.SelectItem,{value:e.id,children:e.name},e.id))]})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(z.Label,{className:"text-foreground",children:"Legal Counsel"}),(0,t.jsxs)(I.Select,{value:C,onValueChange:e=>F("none"===e?"":e),disabled:b,children:[(0,t.jsx)(I.SelectTrigger,{className:"bg-background border-input text-foreground",children:(0,t.jsx)(I.SelectValue,{placeholder:b?"Loading...":"Select legal counsel"})}),(0,t.jsxs)(I.SelectContent,{children:[(0,t.jsx)(I.SelectItem,{value:"none",children:"None"}),g.lawyers.map(e=>(0,t.jsxs)(I.SelectItem,{value:e.id,children:[e.name," ",e.firm_name&&e.name!==e.firm_name?`(${e.firm_name})`:""]},e.id))]})]})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(z.Label,{className:"text-foreground",children:"Address"}),(0,t.jsx)(V.Textarea,{value:S,onChange:e=>D(e.target.value),className:"bg-background border-input text-foreground",placeholder:"Registered address of the vehicle",rows:2})]})]}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)("h3",{className:"text-sm font-semibold text-emerald-400 uppercase tracking-wide",children:"Legal & Compliance"}),(0,t.jsxs)("div",{className:"grid grid-cols-3 gap-4",children:[(0,t.jsx)(U.FormField,{control:B.control,name:"domicile",render:({field:e})=>(0,t.jsxs)(U.FormItem,{children:[(0,t.jsx)(U.FormLabel,{className:"text-foreground",children:"Domicile"}),(0,t.jsx)(U.FormControl,{children:(0,t.jsx)(E.Input,{...e,value:e.value||"",className:"bg-background border-input text-foreground",placeholder:"e.g., Cayman Islands"})}),(0,t.jsx)(U.FormMessage,{})]})}),(0,t.jsx)(U.FormField,{control:B.control,name:"legal_jurisdiction",render:({field:e})=>(0,t.jsxs)(U.FormItem,{children:[(0,t.jsx)(U.FormLabel,{className:"text-foreground",children:"Legal Jurisdiction"}),(0,t.jsx)(U.FormControl,{children:(0,t.jsx)(E.Input,{...e,value:e.value||"",className:"bg-background border-input text-foreground",placeholder:"e.g., Delaware"})}),(0,t.jsx)(U.FormMessage,{})]})}),(0,t.jsx)(U.FormField,{control:B.control,name:"registration_number",render:({field:e})=>(0,t.jsxs)(U.FormItem,{children:[(0,t.jsx)(U.FormLabel,{className:"text-foreground",children:"Registration Number"}),(0,t.jsx)(U.FormControl,{children:(0,t.jsx)(E.Input,{...e,value:e.value||"",className:"bg-background border-input text-foreground font-mono",placeholder:"Registration ID"})}),(0,t.jsx)(U.FormMessage,{})]})})]}),(0,t.jsxs)("div",{className:"grid grid-cols-3 gap-4",children:[(0,t.jsx)(U.FormField,{control:B.control,name:"currency",render:({field:e})=>(0,t.jsxs)(U.FormItem,{children:[(0,t.jsx)(U.FormLabel,{className:"text-foreground",children:"Currency *"}),(0,t.jsxs)(I.Select,{onValueChange:e.onChange,value:e.value,children:[(0,t.jsx)(U.FormControl,{children:(0,t.jsx)(I.SelectTrigger,{className:"bg-background border-input text-foreground",children:(0,t.jsx)(I.SelectValue,{})})}),(0,t.jsx)(I.SelectContent,{className:"bg-popover border-border",children:ec.map(e=>(0,t.jsx)(I.SelectItem,{value:e,className:"text-foreground",children:e},e))})]}),(0,t.jsx)(U.FormMessage,{})]})}),(0,t.jsx)(U.FormField,{control:B.control,name:"formation_date",render:({field:e})=>(0,t.jsxs)(U.FormItem,{className:"col-span-2",children:[(0,t.jsx)(U.FormLabel,{className:"text-foreground",children:"Formation Date"}),(0,t.jsx)(U.FormControl,{children:(0,t.jsx)(E.Input,{type:"date",...e,value:e.value||"",className:"bg-background border-input text-foreground"})}),(0,t.jsx)(U.FormMessage,{})]})})]})]}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)("h3",{className:"text-sm font-semibold text-emerald-400 uppercase tracking-wide",children:"Reporting"}),(0,t.jsx)(U.FormField,{control:B.control,name:"requires_reporting",render:({field:e})=>(0,t.jsxs)(U.FormItem,{className:"flex flex-row items-center justify-between rounded-lg border border-border bg-muted/30 p-4",children:[(0,t.jsxs)("div",{className:"space-y-0.5",children:[(0,t.jsx)(U.FormLabel,{className:"text-foreground",children:"Requires Reporting"}),(0,t.jsx)(U.FormDescription,{className:"text-xs text-muted-foreground",children:"Enable if this vehicle has reporting obligations"})]}),(0,t.jsx)(U.FormControl,{children:(0,t.jsx)(ea.Switch,{checked:e.value||!1,onCheckedChange:e.onChange})})]})}),B.watch("requires_reporting")&&(0,t.jsx)(U.FormField,{control:B.control,name:"reporting_type",render:({field:e})=>(0,t.jsxs)(U.FormItem,{children:[(0,t.jsx)(U.FormLabel,{className:"text-foreground",children:"Reporting Type"}),(0,t.jsxs)(I.Select,{onValueChange:e.onChange,value:e.value||"Not Required",children:[(0,t.jsx)(U.FormControl,{children:(0,t.jsx)(I.SelectTrigger,{className:"bg-background border-input text-foreground",children:(0,t.jsx)(I.SelectValue,{})})}),(0,t.jsx)(I.SelectContent,{className:"bg-popover border-border",children:ed.map(e=>(0,t.jsx)(I.SelectItem,{value:e.value,className:"text-foreground",children:e.label},e.value))})]}),(0,t.jsx)(U.FormMessage,{})]})})]}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)("h3",{className:"text-sm font-semibold text-emerald-400 uppercase tracking-wide",children:"Branding"}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(z.Label,{className:"text-foreground mb-2 block",children:"Vehicle Logo"}),n?(0,t.jsxs)("div",{className:"flex items-start gap-4",children:[(0,t.jsx)(a.default,{src:n,alt:"Vehicle logo",width:96,height:96,className:"w-24 h-24 object-contain bg-muted rounded border border-border"}),(0,t.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,t.jsxs)(k.Button,{type:"button",variant:"outline",size:"sm",onClick:()=>{h({title:"Remove Logo",description:"Are you sure you want to remove this logo?",confirmText:"Remove",variant:"destructive"},()=>{o(""),B.setValue("logo_url",null),W.toast.success("Logo removed")})},className:"text-red-400 hover:text-red-200 border-red-400/40 hover:bg-red-500/10",disabled:d,children:[(0,t.jsx)(_.Trash2,{className:"h-4 w-4 mr-2"}),"Remove Logo"]}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:"Click to remove current logo"})]})]}):(0,t.jsxs)("div",{children:[(0,t.jsx)("input",{type:"file",accept:"image/*",onChange:e=>{let t=e.target.files?.[0];t&&R(t)},className:"hidden",id:"logo-upload",disabled:d}),(0,t.jsx)("label",{htmlFor:"logo-upload",children:(0,t.jsx)(k.Button,{type:"button",variant:"outline",size:"sm",disabled:d,className:"cursor-pointer border-border text-foreground hover:bg-muted bg-background",onClick:e=>{e.preventDefault(),document.getElementById("logo-upload")?.click()},children:d?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(w.Loader2,{className:"h-4 w-4 mr-2 animate-spin"}),"Uploading..."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(A.Upload,{className:"h-4 w-4 mr-2"}),"Upload Logo"]})})}),m&&(0,t.jsxs)("p",{className:"text-xs text-red-400 mt-2 flex items-center gap-1",children:[(0,t.jsx)(v.AlertCircle,{className:"h-3 w-3"}),m]})]})]}),(0,t.jsx)(U.FormField,{control:B.control,name:"website_url",render:({field:e})=>(0,t.jsxs)(U.FormItem,{children:[(0,t.jsx)(U.FormLabel,{className:"text-foreground",children:"Website URL"}),(0,t.jsx)(U.FormControl,{children:(0,t.jsx)(E.Input,{...e,value:e.value||"",type:"url",className:"bg-background border-input text-foreground",placeholder:"https://example.com"})}),(0,t.jsx)(U.FormMessage,{})]})})]})]}),(0,t.jsx)(U.FormField,{control:B.control,name:"notes",render:({field:e})=>(0,t.jsxs)(U.FormItem,{children:[(0,t.jsx)(U.FormLabel,{className:"text-foreground",children:"Internal Notes"}),(0,t.jsx)(U.FormControl,{children:(0,t.jsx)(V.Textarea,{...e,value:e.value||"",className:"bg-background border-input text-foreground",placeholder:"Add any internal notes or comments about this vehicle...",rows:4})}),(0,t.jsx)(U.FormDescription,{className:"text-xs text-muted-foreground",children:"These notes are for internal use only and not visible to investors"}),(0,t.jsx)(U.FormMessage,{})]})}),(0,t.jsxs)(L.DialogFooter,{children:[(0,t.jsx)(k.Button,{type:"button",variant:"outline",onClick:l,className:"bg-muted text-foreground border-border hover:bg-muted/80",disabled:O,children:"Cancel"}),(0,t.jsx)(k.Button,{type:"submit",className:"bg-primary hover:bg-primary/90 text-primary-foreground",disabled:O||d,children:O?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(w.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),"Saving..."]}):"Save Changes"})]})]})})]})}),(0,t.jsx)(x,{})]})}function eu({open:e,onClose:a,entityId:r,entityName:l}){let i=(0,$.useRouter)(),[n,o]=(0,s.useState)(""),[d,c]=(0,s.useState)(!1),[m,u]=(0,s.useState)(null),[h,x]=(0,s.useState)(!1),g=async e=>{if(e){x(!0);try{let e=await fetch(`/api/entities/${r}`,{method:"DELETE"});if(409===e.status){let t=await e.json();u(t.dependencies)}else if(e.ok)u({directors:0,stakeholders:0,investors:0,documents:0,folders:0,deals:0,subscriptions:0,valuations:0});else{let t=await e.json().catch(()=>({}));W.toast.error(t.error||"Failed to check dependencies"),a()}}catch(e){console.error("Failed to check dependencies:",e),W.toast.error("Failed to check dependencies"),a()}finally{x(!1)}}else o(""),u(null),a()},p=async()=>{if(n!==l)return void W.toast.error("Confirmation text does not match");c(!0);try{let e=await fetch(`/api/entities/${r}`,{method:"DELETE"});if(!e.ok){let t=await e.json().catch(()=>({}));if(409===e.status)W.toast.error("Cannot delete entity with dependencies. Please remove all dependencies first.");else throw Error(t.error||"Failed to delete entity");return}W.toast.success(`Entity "${l}" deleted successfully`),i.push("/versotech_main/entities"),i.refresh()}catch(e){console.error("Failed to delete entity:",e),W.toast.error(e instanceof Error?e.message:"Failed to delete entity")}finally{c(!1),a()}},f=m&&Object.values(m).some(e=>e>0),v=!f&&n===l;return(0,t.jsx)(el.AlertDialog,{open:e,onOpenChange:g,children:(0,t.jsxs)(el.AlertDialogContent,{className:"bg-zinc-950 border-red-500/20 text-white max-w-2xl",children:[(0,t.jsxs)(el.AlertDialogHeader,{children:[(0,t.jsxs)(el.AlertDialogTitle,{className:"flex items-center gap-2 text-red-400",children:[(0,t.jsx)(b.AlertTriangle,{className:"h-5 w-5"}),"Delete Entity: ",l]}),(0,t.jsx)(el.AlertDialogDescription,{className:"text-gray-400",children:"This action cannot be undone. This will permanently delete the entity and all associated data from the system."})]}),h?(0,t.jsxs)("div",{className:"flex items-center justify-center py-8",children:[(0,t.jsx)(w.Loader2,{className:"h-8 w-8 animate-spin text-emerald-400"}),(0,t.jsx)("span",{className:"ml-3 text-gray-400",children:"Checking dependencies..."})]}):m?(0,t.jsxs)("div",{className:"space-y-4",children:[f?(0,t.jsx)("div",{className:"rounded-lg border border-red-500/30 bg-red-500/10 p-4",children:(0,t.jsxs)("div",{className:"flex items-start gap-3",children:[(0,t.jsx)(b.AlertTriangle,{className:"h-5 w-5 text-red-400 shrink-0 mt-0.5"}),(0,t.jsxs)("div",{className:"space-y-2 flex-1",children:[(0,t.jsx)("p",{className:"font-semibold text-red-300",children:"Cannot Delete: Entity Has Dependencies"}),(0,t.jsx)("p",{className:"text-sm text-gray-300",children:"This entity has the following linked data that must be removed first:"}),(0,t.jsxs)("ul",{className:"space-y-1 text-sm",children:[m.directors>0&&(0,t.jsxs)("li",{className:"text-gray-300",children:[" ",m.directors," Director",1!==m.directors?"s":""]}),m.stakeholders>0&&(0,t.jsxs)("li",{className:"text-gray-300",children:[" ",m.stakeholders," Stakeholder",1!==m.stakeholders?"s":""]}),m.investors>0&&(0,t.jsxs)("li",{className:"text-gray-300",children:[" ",m.investors," Investor Relationship",1!==m.investors?"s":""]}),m.subscriptions>0&&(0,t.jsxs)("li",{className:"text-gray-300",children:[" ",m.subscriptions," Subscription",1!==m.subscriptions?"s":""]}),m.documents>0&&(0,t.jsxs)("li",{className:"text-gray-300",children:[" ",m.documents," Document",1!==m.documents?"s":""]}),m.folders>0&&(0,t.jsxs)("li",{className:"text-gray-300",children:[" ",m.folders," Folder",1!==m.folders?"s":""]}),m.deals>0&&(0,t.jsxs)("li",{className:"text-gray-300",children:[" ",m.deals," Deal",1!==m.deals?"s":""]}),m.valuations>0&&(0,t.jsxs)("li",{className:"text-gray-300",children:[" ",m.valuations," Valuation",1!==m.valuations?"s":""]})]}),(0,t.jsx)("p",{className:"text-sm text-gray-400 mt-3",children:"Please remove all dependencies before deleting this entity."})]})]})}):(0,t.jsx)("div",{className:"rounded-lg border border-emerald-500/30 bg-emerald-500/10 p-4",children:(0,t.jsxs)("div",{className:"flex items-start gap-3",children:[(0,t.jsx)(j.CheckCircle2,{className:"h-5 w-5 text-emerald-400 shrink-0 mt-0.5"}),(0,t.jsxs)("div",{className:"space-y-2 flex-1",children:[(0,t.jsx)("p",{className:"font-semibold text-emerald-300",children:"No Dependencies Found"}),(0,t.jsx)("p",{className:"text-sm text-gray-300",children:"This entity has no linked data and can be safely deleted."})]})]})}),!f&&(0,t.jsxs)("div",{className:"space-y-3 pt-2",children:[(0,t.jsxs)(z.Label,{htmlFor:"confirmation",className:"text-white",children:["Type ",(0,t.jsx)("span",{className:"font-mono text-emerald-400",children:l})," to confirm deletion:"]}),(0,t.jsx)(E.Input,{id:"confirmation",value:n,onChange:e=>o(e.target.value),placeholder:l,className:"bg-white/5 border-white/10 text-white placeholder:text-gray-500",autoComplete:"off"})]})]}):null,(0,t.jsxs)(el.AlertDialogFooter,{children:[(0,t.jsx)(el.AlertDialogCancel,{onClick:a,disabled:d,className:"bg-white/10 border-white/10 text-white hover:bg-white/20",children:"Cancel"}),!f&&(0,t.jsx)(el.AlertDialogAction,{onClick:p,disabled:!v||d,className:"bg-red-600 hover:bg-red-700 text-white",children:d?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(w.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),"Deleting..."]}):"Delete Entity"})]})]})})}function eh({open:e,onClose:a,document:r,onSuccess:l}){let[i,n]=(0,s.useState)(r.name||""),[o,c]=(0,s.useState)(r.description||""),[m,u]=(0,s.useState)(!1);(0,s.useEffect)(()=>{n(r.name||""),c(r.description||"")},[r]);let h=async e=>{if(e.preventDefault(),!i.trim())return void W.toast.error("Document name is required");u(!0);try{let e=await fetch(`/api/staff/documents/${r.id}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:i.trim(),description:o.trim()||null})});if(!e.ok){let t=await e.json().catch(()=>({}));throw Error(t.error||"Failed to update document")}W.toast.success("Document updated successfully"),l(),a()}catch(e){console.error("Failed to update document:",e),W.toast.error(e instanceof Error?e.message:"Failed to update document")}finally{u(!1)}},x=()=>{m||(n(r.name||""),c(r.description||""),a())};return(0,t.jsx)(L.Dialog,{open:e,onOpenChange:x,children:(0,t.jsxs)(L.DialogContent,{className:"sm:max-w-[500px] bg-zinc-950 border-white/10",children:[(0,t.jsxs)(L.DialogHeader,{children:[(0,t.jsxs)(L.DialogTitle,{className:"text-white flex items-center gap-2",children:[(0,t.jsx)(d.FileText,{className:"h-5 w-5 text-emerald-400"}),"Edit Document"]}),(0,t.jsx)(L.DialogDescription,{className:"text-gray-400",children:"Update document name and description"})]}),(0,t.jsxs)("form",{onSubmit:h,className:"space-y-4 py-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(z.Label,{htmlFor:"name",className:"text-white",children:"Document Name *"}),(0,t.jsx)(E.Input,{id:"name",value:i,onChange:e=>n(e.target.value),placeholder:"Enter document name",className:"bg-white/5 border-white/10 text-white",disabled:m,required:!0})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(z.Label,{htmlFor:"description",className:"text-white",children:"Description"}),(0,t.jsx)(V.Textarea,{id:"description",value:o,onChange:e=>c(e.target.value),placeholder:"Add document description (optional)",rows:3,className:"bg-white/5 border-white/10 text-white",disabled:m})]}),r.file_key&&(0,t.jsxs)("div",{className:"text-xs text-gray-400 pt-2 border-t border-white/10",children:["File: ",r.file_key.split("/").pop()]}),(0,t.jsxs)(L.DialogFooter,{className:"border-t border-white/10 pt-4",children:[(0,t.jsx)(k.Button,{type:"button",variant:"outline",onClick:x,disabled:m,className:"border-white/10 text-white hover:bg-white/10",children:"Cancel"}),(0,t.jsx)(k.Button,{type:"submit",disabled:m||!i.trim(),className:"bg-emerald-600 hover:bg-emerald-700 text-white",children:m?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(w.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),"Saving..."]}):"Save Changes"})]})]})]})})}var ex=e.i(312692);let eg=[{value:"pending",label:"Pending"},{value:"committed",label:"Committed"},{value:"active",label:"Active"},{value:"closed",label:"Closed"},{value:"cancelled",label:"Cancelled"}],ep=[{value:"individual",label:"Individual"},{value:"institutional",label:"Institutional"},{value:"entity",label:"Entity"},{value:"family_office",label:"Family Office"},{value:"fund",label:"Fund"}];function ef({entityId:e,open:a,onClose:r,onSuccess:l}){let[i,n]=(0,s.useState)("existing"),[o,m]=(0,s.useState)(!1),[u,h]=(0,s.useState)(!1),[x,g]=(0,s.useState)(""),[p,f]=(0,s.useState)([]),[b,j]=(0,s.useState)(""),[v,N]=(0,s.useState)(""),[y,_]=(0,s.useState)("pending"),[C,F]=(0,s.useState)(""),[S,A]=(0,s.useState)(!0),[$,B]=(0,s.useState)(""),[U,O]=(0,s.useState)("USD"),[M,q]=(0,s.useState)("pending"),[H,J]=(0,s.useState)(""),[G,K]=(0,s.useState)(""),[Y,Q]=(0,s.useState)(""),[X,Z]=(0,s.useState)(""),[ee,et]=(0,s.useState)({legal_name:"",display_name:"",type:"institutional",email:"",phone:"",country:"",country_of_incorporation:"",tax_residency:""});(0,s.useEffect)(()=>{if(!a){n("existing"),g(""),j(""),N(""),_("pending"),F(""),A(!0),B(""),O("USD"),q("pending"),J(""),K(""),Q(""),Z(""),et({legal_name:"",display_name:"",type:"institutional",email:"",phone:"",country:"",country_of_incorporation:"",tax_residency:""});return}h(!0),fetch("/api/staff/investors").then(e=>e.json()).then(e=>{f(e.investors||[])}).catch(e=>{console.error("Failed to load investors:",e)}).finally(()=>h(!1))},[a]),(0,s.useEffect)(()=>{if(!a)return;let e=new AbortController,t=setTimeout(()=>{h(!0),fetch(x.trim()?`/api/staff/investors?search=${encodeURIComponent(x.trim())}`:"/api/staff/investors",{signal:e.signal}).then(e=>e.json()).then(e=>f(e.investors||[])).catch(e=>{"AbortError"!==e.name&&console.error("Investor search failed:",e)}).finally(()=>h(!1))},300);return()=>{e.abort(),clearTimeout(t)}},[x,a]);let es=(0,s.useMemo)(()=>p.find(e=>e.id===b),[p,b]),ea=(0,s.useCallback)(async()=>{if(("existing"!==i||b)&&("new"!==i||ee.legal_name.trim())){m(!0);try{let t={relationship_role:v.trim()||null,allocation_status:y,notes:C.trim()||null,send_invite:S},s={};if($){let e=Number($);Number.isNaN(e)||(s.commitment=e)}if(Y){let e=Number(Y);Number.isNaN(e)||(s.units=e)}(Object.keys(s).length>0||H||G||X||"pending"!==M||"USD"!==U)&&(s.currency=U.toUpperCase(),s.status=M,s.effective_date=H||null,s.funding_due_at=G||null,s.acknowledgement_notes=X.trim()||null,t.subscription=s),"existing"===i?t.investor_id=b:t.investor={legal_name:ee.legal_name.trim(),display_name:ee.display_name.trim()||null,type:ee.type,email:ee.email.trim()||null,phone:ee.phone.trim()||null,country:ee.country.trim()||null,country_of_incorporation:ee.country_of_incorporation.trim()||null,tax_residency:ee.tax_residency.trim()||null};let a=await fetch(`/api/entities/${e}/investors`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!a.ok){let e=await a.json().catch(()=>({}));throw Error(e.error||"Failed to link investor")}let n=await a.json();l(n.investor),r()}catch(e){throw console.error("Failed to link investor:",e),e}finally{m(!1)}}},[i,b,ee,v,y,C,S,$,Y,U,M,H,G,X,e,r,l]),er=async()=>{try{await ea()}catch(e){e instanceof Error?W.toast.error(e.message):W.toast.error("Failed to link investor. Please try again.")}};return(0,t.jsx)(L.Dialog,{open:a,onOpenChange:r,children:(0,t.jsxs)(L.DialogContent,{className:"max-w-4xl h-[90vh] bg-zinc-950 border-white/10 flex flex-col gap-0 p-0 overflow-hidden",children:[(0,t.jsxs)(L.DialogHeader,{className:"px-6 pt-6 pb-4 shrink-0 border-b border-white/10",children:[(0,t.jsxs)(L.DialogTitle,{className:"text-white flex items-center gap-2",children:[(0,t.jsx)(c.Plus,{className:"h-5 w-5 text-emerald-400"}),"Allocate Investor to Entity"]}),(0,t.jsx)(L.DialogDescription,{className:"text-gray-400",children:"Link an existing investor or create a new profile and capture their subscription details."})]}),(0,t.jsx)("div",{className:"flex-1 overflow-y-auto px-6",children:(0,t.jsxs)("div",{className:"space-y-6 py-6",children:[(0,t.jsxs)(D.Tabs,{value:i,onValueChange:e=>n(e),children:[(0,t.jsxs)(D.TabsList,{className:"grid grid-cols-2 bg-white/5 border border-white/10 w-full",children:[(0,t.jsx)(D.TabsTrigger,{value:"existing",className:"data-[state=active]:bg-emerald-500/20 data-[state=active]:text-emerald-100 text-white",children:"Select Existing Investor"}),(0,t.jsx)(D.TabsTrigger,{value:"new",className:"data-[state=active]:bg-emerald-500/20 data-[state=active]:text-emerald-100 text-white",children:"Create New Investor"})]}),(0,t.jsxs)(D.TabsContent,{value:"existing",className:"mt-4 space-y-3",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(z.Label,{htmlFor:"investor-search",className:"text-sm font-medium text-white",children:"Search Investors"}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(P.Search,{className:"absolute left-3 top-3 h-4 w-4 text-gray-500"}),(0,t.jsx)(E.Input,{id:"investor-search",className:"pl-9 bg-white/5 border-white/10 text-white placeholder:text-gray-500 focus:border-emerald-400/50 focus:ring-emerald-400/20",placeholder:"Search by name, email, or type",value:x,onChange:e=>g(e.target.value)})]}),(0,t.jsx)("p",{className:"text-xs text-gray-400",children:"Start typing to filter the investor list"})]}),(0,t.jsx)(R.ScrollArea,{className:"h-[240px] rounded-md border border-white/10 bg-white/5",children:(0,t.jsxs)("div",{className:"divide-y divide-white/5",children:[u&&(0,t.jsxs)("div",{className:"flex items-center justify-center py-8 text-sm text-gray-400",children:[(0,t.jsx)(w.Loader2,{className:"mr-2 h-5 w-5 animate-spin text-emerald-400"}),(0,t.jsx)("span",{children:"Loading investors..."})]}),!u&&0===p.length&&(0,t.jsx)("div",{className:"py-8 text-center text-sm text-gray-400",children:(0,t.jsxs)("div",{className:"flex flex-col items-center gap-2",children:[(0,t.jsx)("div",{className:"h-12 w-12 rounded-full bg-white/5 flex items-center justify-center",children:(0,t.jsx)(P.Search,{className:"h-6 w-6"})}),(0,t.jsx)("p",{className:"text-white",children:"No investors found."}),(0,t.jsx)("p",{className:"text-xs",children:"Try adjusting your search or create a new investor."})]})}),p.map(e=>(0,t.jsx)("button",{type:"button",onClick:()=>j(e.id),className:`w-full px-4 py-3 text-left transition-all ${b===e.id?"bg-emerald-500/10 border-l-2 border-emerald-400":"hover:bg-white/10 border-l-2 border-transparent"}`,children:(0,t.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("p",{className:"font-medium text-white",children:e.legal_name}),(0,t.jsxs)("p",{className:"text-xs text-gray-400 capitalize",children:[e.type?e.type.replace(/_/g," "):"Type unknown",e.email?`  ${e.email}`:""]})]}),b===e.id&&(0,t.jsx)(T.Badge,{variant:"outline",className:"text-xs bg-emerald-500/20 border-emerald-400/40 text-emerald-100",children:"Selected"})]})},e.id))]})}),es&&(0,t.jsx)("div",{className:"rounded-md border border-emerald-400/40 bg-emerald-500/10 p-4 text-sm",children:(0,t.jsxs)("div",{className:"flex items-start gap-3",children:[(0,t.jsx)("div",{className:"h-10 w-10 rounded-full bg-emerald-500/20 flex items-center justify-center shrink-0",children:(0,t.jsx)("span",{className:"text-emerald-200 font-semibold text-lg",children:es.legal_name.charAt(0)})}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("p",{className:"font-semibold text-emerald-100",children:es.legal_name}),es.email&&(0,t.jsx)("p",{className:"text-emerald-200 text-xs",children:es.email}),es.type&&(0,t.jsx)("p",{className:"capitalize text-emerald-300 text-xs mt-1",children:es.type.replace(/_/g," ")})]})]})})]}),(0,t.jsx)(D.TabsContent,{value:"new",className:"mt-4 space-y-4",children:(0,t.jsxs)("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[(0,t.jsxs)("div",{className:"space-y-2 md:col-span-2",children:[(0,t.jsx)(z.Label,{htmlFor:"new-legal-name",className:"text-sm font-medium text-white",children:"Legal Name *"}),(0,t.jsx)(E.Input,{id:"new-legal-name",value:ee.legal_name,onChange:e=>et(t=>({...t,legal_name:e.target.value})),placeholder:"Investor legal name",className:"bg-white/5 border-white/10 text-white placeholder:text-gray-500 focus:border-emerald-400/50 focus:ring-emerald-400/20",required:!0})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(z.Label,{htmlFor:"new-display-name",className:"text-sm font-medium text-white",children:"Display Name"}),(0,t.jsx)(E.Input,{id:"new-display-name",value:ee.display_name,onChange:e=>et(t=>({...t,display_name:e.target.value})),placeholder:"Optional short label",className:"bg-white/5 border-white/10 text-white placeholder:text-gray-500 focus:border-emerald-400/50 focus:ring-emerald-400/20"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(z.Label,{htmlFor:"new-type",className:"text-sm font-medium text-white",children:"Investor Type"}),(0,t.jsxs)(I.Select,{value:ee.type,onValueChange:e=>et(t=>({...t,type:e})),children:[(0,t.jsx)(I.SelectTrigger,{id:"new-type",className:"bg-white/5 border-white/10 text-white",children:(0,t.jsx)(I.SelectValue,{})}),(0,t.jsx)(I.SelectContent,{className:"bg-zinc-950 border-white/10",children:ep.map(e=>(0,t.jsx)(I.SelectItem,{value:e.value,className:"text-white",children:e.label},e.value))})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(z.Label,{htmlFor:"new-email",className:"text-sm font-medium text-white",children:"Email"}),(0,t.jsx)(E.Input,{id:"new-email",type:"email",value:ee.email,onChange:e=>et(t=>({...t,email:e.target.value})),placeholder:"investor@email.com",className:"bg-white/5 border-white/10 text-white placeholder:text-gray-500 focus:border-emerald-400/50 focus:ring-emerald-400/20"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(z.Label,{htmlFor:"new-phone",className:"text-sm font-medium text-white",children:"Phone"}),(0,t.jsx)(E.Input,{id:"new-phone",value:ee.phone,onChange:e=>et(t=>({...t,phone:e.target.value})),placeholder:"+1 (555) 123-4567",className:"bg-white/5 border-white/10 text-white placeholder:text-gray-500 focus:border-emerald-400/50 focus:ring-emerald-400/20"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(z.Label,{htmlFor:"new-country",className:"text-sm font-medium text-white",children:"Country"}),(0,t.jsx)(E.Input,{id:"new-country",value:ee.country,onChange:e=>et(t=>({...t,country:e.target.value})),placeholder:"Country of residence",className:"bg-white/5 border-white/10 text-white placeholder:text-gray-500 focus:border-emerald-400/50 focus:ring-emerald-400/20"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(z.Label,{htmlFor:"new-incorporation",className:"text-sm font-medium text-white",children:"Country of Incorporation"}),(0,t.jsx)(E.Input,{id:"new-incorporation",value:ee.country_of_incorporation,onChange:e=>et(t=>({...t,country_of_incorporation:e.target.value})),placeholder:"Jurisdiction",className:"bg-white/5 border-white/10 text-white placeholder:text-gray-500 focus:border-emerald-400/50 focus:ring-emerald-400/20"})]}),(0,t.jsxs)("div",{className:"space-y-2 md:col-span-2",children:[(0,t.jsx)(z.Label,{htmlFor:"new-tax-residency",className:"text-sm font-medium text-white",children:"Tax Residency"}),(0,t.jsx)(E.Input,{id:"new-tax-residency",value:ee.tax_residency,onChange:e=>et(t=>({...t,tax_residency:e.target.value})),placeholder:"Tax residency",className:"bg-white/5 border-white/10 text-white placeholder:text-gray-500 focus:border-emerald-400/50 focus:ring-emerald-400/20"})]})]})})]}),(0,t.jsxs)("div",{className:"rounded-lg border border-white/10 bg-white/5 p-5 space-y-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 pb-2 border-b border-white/10",children:[(0,t.jsx)("div",{className:"h-8 w-8 rounded-full bg-emerald-500/20 flex items-center justify-center",children:(0,t.jsx)(d.FileText,{className:"h-4 w-4 text-emerald-400"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"text-sm font-semibold text-white",children:"Allocation Details"}),(0,t.jsx)("p",{className:"text-xs text-gray-400",children:"Define the investor's role and subscription terms"})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(z.Label,{htmlFor:"relationship_role",className:"text-sm font-medium text-white",children:"Relationship Role"}),(0,t.jsx)(E.Input,{id:"relationship_role",value:v,onChange:e=>N(e.target.value),placeholder:"e.g., Lead LP, Co-investor, Cornerstone",className:"bg-white/5 border-white/10 text-white placeholder:text-gray-500 focus:border-emerald-400/50 focus:ring-emerald-400/20"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(z.Label,{htmlFor:"allocation_status",className:"text-sm font-medium text-white",children:"Allocation Status"}),(0,t.jsxs)(I.Select,{value:y,onValueChange:e=>_(e),children:[(0,t.jsx)(I.SelectTrigger,{id:"allocation_status",className:"bg-white/5 border-white/10 text-white",children:(0,t.jsx)(I.SelectValue,{})}),(0,t.jsx)(I.SelectContent,{className:"bg-zinc-950 border-white/10",children:eg.map(e=>(0,t.jsx)(I.SelectItem,{value:e.value,className:"text-white",children:e.label},e.value))})]})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-3",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(z.Label,{htmlFor:"commitment",className:"text-sm font-medium text-white",children:"Commitment Amount"}),(0,t.jsx)(E.Input,{id:"commitment",value:$,onChange:e=>B(e.target.value),placeholder:"e.g., 2500000",inputMode:"numeric",className:"bg-white/5 border-white/10 text-white placeholder:text-gray-500 focus:border-emerald-400/50 focus:ring-emerald-400/20"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(z.Label,{htmlFor:"currency",className:"text-sm font-medium text-white",children:"Currency"}),(0,t.jsx)(E.Input,{id:"currency",value:U,maxLength:3,onChange:e=>O(e.target.value.toUpperCase()),className:"bg-white/5 border-white/10 text-white placeholder:text-gray-500 focus:border-emerald-400/50 focus:ring-emerald-400/20"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(z.Label,{htmlFor:"subscription_status",className:"text-sm font-medium text-white",children:"Subscription Status"}),(0,t.jsxs)(I.Select,{value:M,onValueChange:e=>q(e),children:[(0,t.jsx)(I.SelectTrigger,{id:"subscription_status",className:"bg-white/5 border-white/10 text-white",children:(0,t.jsx)(I.SelectValue,{})}),(0,t.jsx)(I.SelectContent,{className:"bg-zinc-950 border-white/10",children:eg.map(e=>(0,t.jsx)(I.SelectItem,{value:e.value,className:"text-white",children:e.label},e.value))})]})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-3",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(z.Label,{htmlFor:"effective_date",className:"text-sm font-medium text-white",children:"Effective Date"}),(0,t.jsx)(E.Input,{id:"effective_date",type:"date",value:H,onChange:e=>J(e.target.value),className:"bg-white/5 border-white/10 text-white placeholder:text-gray-500 focus:border-emerald-400/50 focus:ring-emerald-400/20"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(z.Label,{htmlFor:"funding_due_at",className:"text-sm font-medium text-white",children:"Funding Due Date"}),(0,t.jsx)(E.Input,{id:"funding_due_at",type:"date",value:G,onChange:e=>K(e.target.value),className:"bg-white/5 border-white/10 text-white placeholder:text-gray-500 focus:border-emerald-400/50 focus:ring-emerald-400/20"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(z.Label,{htmlFor:"units",className:"text-sm font-medium text-white",children:"Units"}),(0,t.jsx)(E.Input,{id:"units",value:Y,onChange:e=>Q(e.target.value),placeholder:"e.g., 1000",inputMode:"numeric",className:"bg-white/5 border-white/10 text-white placeholder:text-gray-500 focus:border-emerald-400/50 focus:ring-emerald-400/20"})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(z.Label,{htmlFor:"ack-notes",className:"text-sm font-medium text-white",children:"Acknowledgement Notes"}),(0,t.jsx)(V.Textarea,{id:"ack-notes",value:X,onChange:e=>Z(e.target.value),placeholder:"Internal notes about subscription acknowledgement or pending actions",rows:2,className:"bg-white/5 border-white/10 text-white placeholder:text-gray-500 focus:border-emerald-400/50 focus:ring-emerald-400/20"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(z.Label,{htmlFor:"investor-notes",className:"text-sm font-medium text-white",children:"Internal Notes"}),(0,t.jsx)(V.Textarea,{id:"investor-notes",value:C,onChange:e=>F(e.target.value),placeholder:"Add any context for the team (not shared with investors)",rows:3,className:"bg-white/5 border-white/10 text-white placeholder:text-gray-500 focus:border-emerald-400/50 focus:ring-emerald-400/20"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2 rounded-md border border-white/10 bg-white/5 p-3",children:[(0,t.jsx)(ex.Checkbox,{id:"send-invite",checked:S,onCheckedChange:e=>A(!!e),className:"border-white/20 data-[state=checked]:bg-emerald-500 data-[state=checked]:border-emerald-500"}),(0,t.jsx)(z.Label,{htmlFor:"send-invite",className:"text-sm text-white cursor-pointer",children:"Send investor portal invitation (if not already invited)"})]})]})]})}),(0,t.jsxs)(L.DialogFooter,{className:"px-6 py-4 shrink-0 flex flex-col gap-2 sm:flex-row sm:justify-end border-t border-white/10 bg-zinc-950",children:[(0,t.jsx)(k.Button,{variant:"outline",onClick:r,disabled:o,className:"border-white/20 text-white hover:bg-white/10 bg-transparent",children:"Cancel"}),(0,t.jsx)(k.Button,{onClick:er,disabled:o||"existing"===i&&!b||"new"===i&&!ee.legal_name.trim(),className:"bg-emerald-500 hover:bg-emerald-600 text-emerald-950 font-semibold",children:o?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(w.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),"Linking..."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(c.Plus,{className:"mr-2 h-4 w-4"}),"Link Investor"]})})]})]})})}let eb=[{value:"critical",label:"Critical"},{value:"warning",label:"Warning"},{value:"info",label:"Info"},{value:"success",label:"Success"}],ej=[{value:"compliance",label:"Compliance"},{value:"documentation",label:"Documentation"},{value:"reporting",label:"Reporting"},{value:"tasks",label:"Operational Task"},{value:"other",label:"Other"}];function ev({entityId:e,open:a,onClose:r,onSuccess:l}){let[i,n]=(0,s.useState)(!1),[o,d]=(0,s.useState)(""),[m,u]=(0,s.useState)("warning"),[h,x]=(0,s.useState)("documentation"),[g,p]=(0,s.useState)(""),[f,b]=(0,s.useState)(""),j=()=>{d(""),u("warning"),x("documentation"),p(""),b("")},v=()=>{i||(j(),r())},N=async()=>{if(!o.trim())return void W.toast.error("A title is required for the flag.");n(!0);try{let t=await fetch(`/api/entities/${e}/flags`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:o.trim(),flag_type:h,severity:m,description:f.trim()||null,due_date:g||null})});if(!t.ok){let e=await t.json().catch(()=>({}));throw Error(e.error||"Failed to create flag")}let s=await t.json();W.toast.success("Flag created for this entity."),l(s.flag),j(),r()}catch(e){console.error("Failed to create flag:",e),W.toast.error(e instanceof Error?e.message:"Unable to create flag.")}finally{n(!1)}};return(0,t.jsx)(L.Dialog,{open:a,onOpenChange:v,children:(0,t.jsxs)(L.DialogContent,{className:"max-w-lg bg-zinc-950 border-white/10 text-white",children:[(0,t.jsxs)(L.DialogHeader,{children:[(0,t.jsx)(L.DialogTitle,{className:"text-white",children:"Raise Entity Flag"}),(0,t.jsx)(L.DialogDescription,{className:"text-gray-400",children:"Highlight a compliance issue, missing documentation, or follow-up item for this vehicle."})]}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(z.Label,{htmlFor:"flag-title",className:"text-white",children:"Title *"}),(0,t.jsx)(E.Input,{id:"flag-title",value:o,onChange:e=>d(e.target.value),placeholder:"e.g., KYC documents outstanding",className:"bg-white/5 border-white/10 text-white placeholder:text-gray-500",autoFocus:!0})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(z.Label,{htmlFor:"flag-severity",className:"text-white",children:"Severity"}),(0,t.jsxs)(I.Select,{value:m,onValueChange:u,children:[(0,t.jsx)(I.SelectTrigger,{id:"flag-severity",className:"bg-white/5 border-white/10 text-white",children:(0,t.jsx)(I.SelectValue,{})}),(0,t.jsx)(I.SelectContent,{className:"bg-zinc-950 border-white/10",children:eb.map(e=>(0,t.jsx)(I.SelectItem,{value:e.value,className:"text-white",children:e.label},e.value))})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(z.Label,{htmlFor:"flag-type",className:"text-white",children:"Category"}),(0,t.jsxs)(I.Select,{value:h,onValueChange:x,children:[(0,t.jsx)(I.SelectTrigger,{id:"flag-type",className:"bg-white/5 border-white/10 text-white",children:(0,t.jsx)(I.SelectValue,{})}),(0,t.jsx)(I.SelectContent,{className:"bg-zinc-950 border-white/10",children:ej.map(e=>(0,t.jsx)(I.SelectItem,{value:e.value,className:"text-white",children:e.label},e.value))})]})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(z.Label,{htmlFor:"flag-due-date",className:"text-white",children:"Due Date"}),(0,t.jsx)(E.Input,{id:"flag-due-date",type:"date",value:g,onChange:e=>p(e.target.value),className:"bg-white/5 border-white/10 text-white"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(z.Label,{htmlFor:"flag-description",className:"text-white",children:"Details"}),(0,t.jsx)(V.Textarea,{id:"flag-description",rows:4,value:f,onChange:e=>b(e.target.value),placeholder:"Optional context or remediation steps.",className:"bg-white/5 border-white/10 text-white placeholder:text-gray-500"})]})]}),(0,t.jsxs)(L.DialogFooter,{className:"gap-2 sm:gap-0",children:[(0,t.jsx)(k.Button,{variant:"outline",onClick:v,disabled:i,className:"border-white/10 text-white hover:bg-white/10",children:"Cancel"}),(0,t.jsx)(k.Button,{onClick:N,disabled:i,className:"bg-emerald-500 hover:bg-emerald-600 text-emerald-950 font-semibold",children:i?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(w.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),"Saving..."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(c.Plus,{className:"mr-2 h-4 w-4"}),"Create Flag"]})})]})]})})}var eN=e.i(230112),ew=e.i(197098),ey=e.i(799359),e_=e.i(937368);let eC={metadata:N.Info,stakeholders:m.Users,directors:O.User,documents:d.FileText,deals:x.Briefcase,investors:g.ShieldCheck},eF={metadata:"Metadata Completeness",stakeholders:"Stakeholder Coverage",directors:"Director Status",documents:"Document Requirements",deals:"Deal Activity",investors:"Investor Status"};function eS(e){switch(e){case"pass":return(0,t.jsx)(j.CheckCircle2,{className:"h-4 w-4 text-emerald-400"});case"warning":return(0,t.jsx)(b.AlertTriangle,{className:"h-4 w-4 text-amber-400"});case"fail":return(0,t.jsx)(v.AlertCircle,{className:"h-4 w-4 text-red-400"})}}function eD(e){switch(e){case"pass":return"text-emerald-400";case"warning":return"text-amber-400";case"fail":return"text-red-400"}}function ek(e){switch(e){case"pass":return"bg-emerald-500/20 border-emerald-400/40 text-emerald-100";case"warning":return"bg-amber-500/20 border-amber-400/40 text-amber-100";case"fail":return"bg-red-500/20 border-red-400/40 text-red-100"}}function eT({check:e,onAction:s}){return(0,t.jsxs)("div",{className:"flex items-start gap-3 p-3 rounded-lg border border-white/10 bg-white/5 hover:bg-white/10 transition-colors",children:[(0,t.jsx)("div",{className:"pt-0.5",children:eS(e.status)}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsxs)("div",{className:"flex items-start justify-between gap-2",children:[(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("p",{className:"text-sm font-medium text-foreground",children:e.title}),(0,t.jsx)("p",{className:`text-xs mt-0.5 ${"pass"===e.status?"text-muted-foreground":eD(e.status)}`,children:e.message}),e.details&&(0,t.jsx)("p",{className:"text-xs text-muted-foreground mt-1 italic",children:e.details})]}),(0,t.jsx)(T.Badge,{className:ek(e.status),variant:"outline",children:e.status})]}),e.actionable&&s&&"pass"!==e.status&&(0,t.jsx)(k.Button,{size:"sm",variant:"outline",className:"mt-2 h-7 text-xs",onClick:()=>s(e.actionable.action),children:e.actionable.label})]})]})}function eI({entity:e,directors:a,stakeholders:r,documents:l,folders:i,deals:n,investors:o,onAction:d}){let c=(0,s.useMemo)(()=>{var t,s,d,c,m,u,h;let x,g,p,f,b,j,v,N,w,y;return N=(h=[...(s=(t={entity:e,directors:a,stakeholders:r,documents:l,folders:i,deals:n,investors:o}).entity,(x=[]).push({id:"metadata_name",category:"metadata",title:"Legal Name",status:"pass",message:"Entity has a valid legal name"}),s.entity_code?x.push({id:"metadata_code",category:"metadata",title:"Entity Code",status:"pass",message:`Entity code: ${s.entity_code}`}):x.push({id:"metadata_code",category:"metadata",title:"Entity Code",status:"warning",message:"Entity code is not set",actionable:{label:"Add entity code",action:"edit_metadata"}}),s.status&&"TBD"!==s.status?x.push({id:"metadata_status",category:"metadata",title:"Entity Status",status:"pass",message:`Status: ${s.status}`}):x.push({id:"metadata_status",category:"metadata",title:"Entity Status",status:"warning",message:"Entity status needs clarification",details:"TBD"===s.status?"Status is marked as To Be Determined":"No status set",actionable:{label:"Update status",action:"edit_metadata"}}),s.domicile?x.push({id:"metadata_domicile",category:"metadata",title:"Domicile",status:"pass",message:`Domicile: ${s.domicile}`}):x.push({id:"metadata_domicile",category:"metadata",title:"Domicile",status:"fail",message:"Domicile is required but not set",actionable:{label:"Set domicile",action:"edit_metadata"}}),s.legal_jurisdiction?x.push({id:"metadata_jurisdiction",category:"metadata",title:"Legal Jurisdiction",status:"pass",message:`Jurisdiction: ${s.legal_jurisdiction}`}):x.push({id:"metadata_jurisdiction",category:"metadata",title:"Legal Jurisdiction",status:"warning",message:"Legal jurisdiction not specified",actionable:{label:"Add jurisdiction",action:"edit_metadata"}}),s.formation_date?x.push({id:"metadata_formation",category:"metadata",title:"Formation Date",status:"pass",message:`Formed: ${new Date(s.formation_date).toLocaleDateString()}`}):x.push({id:"metadata_formation",category:"metadata",title:"Formation Date",status:"warning",message:"Formation date not recorded",actionable:{label:"Add formation date",action:"edit_metadata"}}),s.registration_number?x.push({id:"metadata_registration",category:"metadata",title:"Registration Number",status:"pass",message:`Registration: ${s.registration_number}`}):x.push({id:"metadata_registration",category:"metadata",title:"Registration Number",status:"warning",message:"Registration number not recorded",details:"Important for legal documentation and filings",actionable:{label:"Add registration number",action:"edit_metadata"}}),x),...(d=t.stakeholders,g=[],p=d.filter(e=>!e.effective_to),[{role:"lawyer",title:"Legal Counsel",severity:"fail"},{role:"accountant",title:"Accountant",severity:"fail"},{role:"auditor",title:"Auditor",severity:"warning"},{role:"administrator",title:"Administrator",severity:"warning"}].forEach(({role:e,title:t,severity:s})=>{if(p.some(t=>t.role===e)){let s=p.filter(t=>t.role===e).length;g.push({id:`stakeholder_${e}`,category:"stakeholders",title:`${t} Coverage`,status:"pass",message:`${s} active ${t.toLowerCase()}${s>1?"s":""} assigned`})}else g.push({id:`stakeholder_${e}`,category:"stakeholders",title:`${t} Coverage`,status:s,message:`No active ${t.toLowerCase()} assigned`,details:"fail"===s?"This is a critical requirement for entity governance":void 0,actionable:{label:`Add ${t.toLowerCase()}`,action:"add_stakeholder"}})}),0===p.length?g.push({id:"stakeholder_count",category:"stakeholders",title:"Total Stakeholders",status:"fail",message:"No stakeholders assigned to this entity",actionable:{label:"Add stakeholders",action:"add_stakeholder"}}):g.push({id:"stakeholder_count",category:"stakeholders",title:"Total Stakeholders",status:"pass",message:`${p.length} active stakeholder${p.length>1?"s":""}`}),g),...(c=t.directors,f=[],0===(b=c.filter(e=>!e.effective_to)).length?f.push({id:"director_count",category:"directors",title:"Active Directors",status:"fail",message:"Entity has no active directors",details:"At least one director is required for legal compliance",actionable:{label:"Add director",action:"add_director"}}):1===b.length?f.push({id:"director_count",category:"directors",title:"Active Directors",status:"warning",message:"Only one active director",details:"Consider adding additional directors for governance best practices"}):f.push({id:"director_count",category:"directors",title:"Active Directors",status:"pass",message:`${b.length} active directors`}),(j=c.filter(e=>!!e.effective_from&&!!e.effective_to&&new Date(e.effective_to)<new Date(e.effective_from))).length>0?f.push({id:"director_dates",category:"directors",title:"Director Date Validity",status:"fail",message:`${j.length} director(s) have invalid date ranges`,details:"Effective end date is before start date"}):f.push({id:"director_dates",category:"directors",title:"Director Date Validity",status:"pass",message:"All director date ranges are valid"}),f),...(m=t.documents,u=t.folders,v=[],[{type:"kyc",title:"KYC Documents",severity:"fail"},{type:"legal",title:"Legal Documents",severity:"fail"},{type:"formation",title:"Formation Documents",severity:"warning"},{type:"regulatory",title:"Regulatory Filings",severity:"warning"}].forEach(({type:e,title:t,severity:s})=>{let a=u.find(t=>t.folder_type===e);if(!a)return void v.push({id:`documents_${e}`,category:"documents",title:t,status:s,message:`No ${e} folder exists`,actionable:{label:`Create ${e} folder`,action:"create_folder"}});let r=m.filter(e=>e.folder_id===a.id);0===r.length?v.push({id:`documents_${e}`,category:"documents",title:t,status:s,message:`No ${e} documents uploaded`,details:`${t} folder exists but is empty`,actionable:{label:"Upload documents",action:"upload_document"}}):v.push({id:`documents_${e}`,category:"documents",title:t,status:"pass",message:`${r.length} ${e} document${r.length>1?"s":""}`})}),0===m.length?v.push({id:"documents_total",category:"documents",title:"Total Documents",status:"fail",message:"No documents uploaded for this entity",actionable:{label:"Upload document",action:"upload_document"}}):v.push({id:"documents_total",category:"documents",title:"Total Documents",status:"pass",message:`${m.length} document${m.length>1?"s":""} uploaded`}),v),...function(e){let t=[];if(0===e.length)t.push({id:"deal_count",category:"deals",title:"Deal Activity",status:"warning",message:"No deals linked to this entity",details:"Entity may not be actively used for investments"});else{let s=e.filter(e=>"active"===e.status);0===s.length?t.push({id:"deal_active",category:"deals",title:"Active Deals",status:"warning",message:"No active deals",details:`${e.length} total deal${e.length>1?"s":""}, but none are active`}):t.push({id:"deal_active",category:"deals",title:"Active Deals",status:"pass",message:`${s.length} active deal${s.length>1?"s":""}`}),t.push({id:"deal_count",category:"deals",title:"Total Deals",status:"pass",message:`${e.length} deal${e.length>1?"s":""} linked`})}return t}(t.deals),...function(e){let t=[];if(0===e.length)t.push({id:"investor_count",category:"investors",title:"Investor Coverage",status:"warning",message:"No investors linked to this entity",actionable:{label:"Link investor",action:"link_investor"}});else{let s=e.filter(e=>"active"===e.allocation_status||"committed"===e.allocation_status);0===s.length?t.push({id:"investor_active",category:"investors",title:"Active Investors",status:"warning",message:"No active investor allocations",details:`${e.length} investor${e.length>1?"s":""} linked but none are active/committed`}):t.push({id:"investor_active",category:"investors",title:"Active Investors",status:"pass",message:`${s.length} active/committed investor${s.length>1?"s":""}`}),t.push({id:"investor_count",category:"investors",title:"Total Investors",status:"pass",message:`${e.length} investor${e.length>1?"s":""} linked`})}return t}(t.investors)]).filter(e=>"pass"===e.status).length,w=h.filter(e=>"warning"===e.status).length,y=h.filter(e=>"fail"===e.status).length,{overallScore:Math.round(N/h.length*100),overallStatus:y>0?"fail":w>3||w>0?"warning":"pass",checks:h,passCount:N,warningCount:w,failCount:y}},[e,a,r,l,i,n,o]),m=(0,s.useMemo)(()=>{let e={};return c.checks.forEach(t=>{e[t.category]||(e[t.category]=[]),e[t.category].push(t)}),e},[c.checks]),[u,x]=(0,s.useState)(new Set(["metadata"]));return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)(S.Card,{className:"border border-white/10 bg-gradient-to-br from-white/5 to-white/10",children:[(0,t.jsx)(S.CardHeader,{children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("div",{className:"h-12 w-12 rounded-full bg-emerald-500/20 flex items-center justify-center",children:(0,t.jsx)(h.Activity,{className:"h-6 w-6 text-emerald-400"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)(S.CardTitle,{className:"text-2xl",children:"Entity Health Score"}),(0,t.jsx)(S.CardDescription,{children:"Real-time monitoring of entity compliance and completeness"})]})]}),(0,t.jsxs)("div",{className:"text-right",children:[(0,t.jsxs)("div",{className:`text-4xl font-bold ${eD(c.overallStatus)}`,children:[c.overallScore,"%"]}),(0,t.jsxs)(T.Badge,{className:ek(c.overallStatus),children:["pass"===c.overallStatus&&"Healthy","warning"===c.overallStatus&&"Needs Attention","fail"===c.overallStatus&&"Critical Issues"]})]})]})}),(0,t.jsx)(S.CardContent,{children:(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsx)(e_.Progress,{value:c.overallScore,className:"h-3"}),(0,t.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,t.jsx)(j.CheckCircle2,{className:"h-4 w-4 text-emerald-400"}),(0,t.jsx)("span",{className:"text-foreground font-medium",children:c.passCount}),(0,t.jsx)("span",{className:"text-muted-foreground",children:"Passed"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,t.jsx)(b.AlertTriangle,{className:"h-4 w-4 text-amber-400"}),(0,t.jsx)("span",{className:"text-foreground font-medium",children:c.warningCount}),(0,t.jsx)("span",{className:"text-muted-foreground",children:"Warnings"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,t.jsx)(v.AlertCircle,{className:"h-4 w-4 text-red-400"}),(0,t.jsx)("span",{className:"text-foreground font-medium",children:c.failCount}),(0,t.jsx)("span",{className:"text-muted-foreground",children:"Failed"})]})]}),(0,t.jsxs)("span",{className:"text-muted-foreground",children:[c.checks.length," total checks"]})]})]})})]}),(0,t.jsx)("div",{className:"space-y-3",children:Object.entries(m).map(([e,s])=>{let a=eC[e]||N.Info,r=u.has(e);s.filter(e=>"pass"===e.status).length;let l=s.filter(e=>"warning"===e.status).length,i=s.filter(e=>"fail"===e.status).length,n="pass";return i>0?n="fail":l>0&&(n="warning"),(0,t.jsx)(ey.Collapsible,{open:r,onOpenChange:()=>{x(t=>{let s=new Set(t);return s.has(e)?s.delete(e):s.add(e),s})},children:(0,t.jsxs)(S.Card,{className:"border border-white/10 bg-white/5",children:[(0,t.jsx)(ey.CollapsibleTrigger,{asChild:!0,children:(0,t.jsx)(S.CardHeader,{className:"cursor-pointer hover:bg-white/5 transition-colors",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[r?(0,t.jsx)(eN.ChevronDown,{className:"h-5 w-5 text-muted-foreground"}):(0,t.jsx)(ew.ChevronRight,{className:"h-5 w-5 text-muted-foreground"}),(0,t.jsx)("div",{className:`h-10 w-10 rounded-full flex items-center justify-center ${"pass"===n?"bg-emerald-500/20":"warning"===n?"bg-amber-500/20":"bg-red-500/20"}`,children:(0,t.jsx)(a,{className:`h-5 w-5 ${"pass"===n?"text-emerald-400":"warning"===n?"text-amber-400":"text-red-400"}`})}),(0,t.jsxs)("div",{children:[(0,t.jsx)(S.CardTitle,{className:"text-base",children:eF[e]}),(0,t.jsxs)("div",{className:"flex items-center gap-2 mt-1",children:[(0,t.jsxs)("span",{className:"text-xs text-muted-foreground",children:[s.length," check",s.length>1?"s":""]}),i>0&&(0,t.jsxs)(T.Badge,{className:"bg-red-500/20 border-red-400/40 text-red-100 text-xs h-5",children:[i," failed"]}),l>0&&0===i&&(0,t.jsxs)(T.Badge,{className:"bg-amber-500/20 border-amber-400/40 text-amber-100 text-xs h-5",children:[l," warning",l>1?"s":""]})]})]})]}),(0,t.jsx)("div",{className:"text-right",children:eS(n)})]})})}),(0,t.jsx)(ey.CollapsibleContent,{children:(0,t.jsxs)(S.CardContent,{className:"space-y-2 pt-0",children:[(0,t.jsx)("div",{className:"h-px bg-white/10 mb-3"}),s.map(e=>(0,t.jsx)(eT,{check:e,onAction:d},e.id))]})})]})},e)})}),"pass"!==c.overallStatus&&(0,t.jsxs)(S.Card,{className:"border border-emerald-400/40 bg-emerald-500/10",children:[(0,t.jsxs)(S.CardHeader,{children:[(0,t.jsxs)(S.CardTitle,{className:"text-emerald-100 flex items-center gap-2",children:[(0,t.jsx)(h.Activity,{className:"h-5 w-5"}),"Recommended Actions"]}),(0,t.jsx)(S.CardDescription,{className:"text-emerald-200/80",children:"Take these actions to improve your entity health score"})]}),(0,t.jsx)(S.CardContent,{className:"space-y-2",children:c.checks.filter(e=>"pass"!==e.status&&e.actionable).slice(0,5).map(e=>(0,t.jsxs)("div",{className:"flex items-center justify-between p-3 rounded-lg border border-emerald-400/20 bg-emerald-500/5",children:[(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("p",{className:"text-sm font-medium text-emerald-100",children:e.title}),(0,t.jsx)("p",{className:"text-xs text-emerald-200/70",children:e.message})]}),e.actionable&&d&&(0,t.jsx)(k.Button,{size:"sm",variant:"outline",className:"ml-3 border-emerald-400/40 text-emerald-100 hover:bg-emerald-500/20",onClick:()=>d(e.actionable.action),children:e.actionable.label})]},e.id))})]})]})}var eL=e.i(959768),eE=e.i(738932),ez=e.i(703281),eA=e.i(64927),e$=e.i(510166);let eB=e=>("entity"===e.folder_type||"vehicle_root"===e.folder_type)&&!e.parent_folder_id;function eV({entityId:e,folders:a,documents:r=[],selectedFolderId:l,onFolderSelect:i,onFoldersChange:n}){let[o,d]=(0,s.useState)(new Set),[c,m]=(0,s.useState)(!1),[u,h]=(0,s.useState)(!1),[x,g]=(0,s.useState)(!1),[p,b]=(0,s.useState)(null),[j,v]=(0,s.useState)(null),[N,w]=(0,s.useState)(null),[y,C]=(0,s.useState)(""),[F,S]=(0,s.useState)(!1),D=(0,s.useMemo)(()=>{let e=new Map;r.forEach(t=>{t.folder_id&&e.set(t.folder_id,(e.get(t.folder_id)||0)+1)});let t=a.find(e=>eB(e)),s=a.filter(e=>!t||e.id!==t.id),l=new Map,i=[];s.forEach(t=>{l.set(t.id,{...t,children:[],documentCount:e.get(t.id)||0,isExpanded:o.has(t.id)})}),s.forEach(e=>{let s=l.get(e.id);t&&e.parent_folder_id===t.id?i.push(s):e.parent_folder_id&&l.has(e.parent_folder_id)?l.get(e.parent_folder_id).children.push(s):e.parent_folder_id||i.push(s)});let n=e=>{e.sort((e,t)=>e.name.localeCompare(t.name)),e.forEach(e=>n(e.children))};return n(i),i},[a,r,o]),I=async()=>{if(!y.trim())return void W.toast.error("Folder name is required");let t=a.find(e=>eB(e)),s=p||t?.id||null;S(!0);try{let t=await fetch(`/api/entities/${e}/folders`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:y.trim(),parent_folder_id:s,folder_type:"custom"})});if(!t.ok){let e=await t.json();throw Error(e.error||"Failed to create folder")}W.toast.success("Folder created successfully"),C(""),b(null),m(!1),n()}catch(e){console.error("Failed to create folder:",e),W.toast.error(e instanceof Error?e.message:"Failed to create folder")}finally{S(!1)}},A=async()=>{if(!j||!y.trim())return void W.toast.error("Folder name is required");S(!0);try{let t=await fetch(`/api/entities/${e}/folders/${j.id}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:y.trim()})});if(!t.ok){let e=await t.json();throw Error(e.error||"Failed to rename folder")}W.toast.success("Folder renamed successfully"),C(""),v(null),h(!1),n()}catch(e){console.error("Failed to rename folder:",e),W.toast.error(e instanceof Error?e.message:"Failed to rename folder")}finally{S(!1)}},$=async()=>{if(N){S(!0);try{let t=await fetch(`/api/entities/${e}/folders/${N.id}`,{method:"DELETE"});if(!t.ok){let e=await t.json();throw Error(e.error||"Failed to delete folder")}W.toast.success("Folder deleted successfully"),w(null),g(!1),l===N.id&&i(null),n()}catch(e){console.error("Failed to delete folder:",e),W.toast.error(e instanceof Error?e.message:"Failed to delete folder")}finally{S(!1)}}},B=(e=null)=>{b(e),C(""),m(!0)},V=(e,s=0)=>{let a=l===e.id,r=e.children.length>0,n="vehicle_root"===e.folder_type||"category"===e.folder_type;return(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:`flex items-center justify-between gap-2 px-2 py-1.5 rounded-md cursor-pointer transition-colors ${a?"bg-emerald-500/20 border-l-2 border-emerald-400":"hover:bg-white/5 border-l-2 border-transparent"}`,style:{paddingLeft:`${16*s+8}px`},children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 flex-1 min-w-0",onClick:()=>i(e.id),children:[r&&(0,t.jsx)("button",{onClick:t=>{var s;t.stopPropagation(),s=e.id,d(e=>{let t=new Set(e);return t.has(s)?t.delete(s):t.add(s),t})},className:"p-0.5 hover:bg-white/10 rounded",children:e.isExpanded?(0,t.jsx)(eN.ChevronDown,{className:"h-4 w-4 text-muted-foreground"}):(0,t.jsx)(ew.ChevronRight,{className:"h-4 w-4 text-muted-foreground"})}),!r&&(0,t.jsx)("div",{className:"w-5"}),e.isExpanded||a?(0,t.jsx)(f.FolderOpen,{className:"h-4 w-4 text-emerald-400 shrink-0"}):(0,t.jsx)(eL.Folder,{className:"h-4 w-4 text-emerald-400 shrink-0"}),(0,t.jsx)("span",{className:`text-sm truncate ${a?"text-foreground font-medium":"text-muted-foreground"}`,children:e.name}),e.documentCount>0&&(0,t.jsx)(T.Badge,{variant:"outline",className:"text-xs h-5 bg-white/5 border-white/10",children:e.documentCount})]}),!n&&(0,t.jsxs)(e$.DropdownMenu,{children:[(0,t.jsx)(e$.DropdownMenuTrigger,{asChild:!0,onClick:e=>e.stopPropagation(),children:(0,t.jsx)(k.Button,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0 opacity-0 group-hover:opacity-100 hover:bg-white/10",children:(0,t.jsx)(eA.MoreVertical,{className:"h-3 w-3"})})}),(0,t.jsxs)(e$.DropdownMenuContent,{align:"end",className:"bg-zinc-950 border-white/10",children:[(0,t.jsxs)(e$.DropdownMenuItem,{onClick:()=>B(e.id),className:"gap-2",children:[(0,t.jsx)(eE.FolderPlus,{className:"h-4 w-4"}),"New Subfolder"]}),(0,t.jsxs)(e$.DropdownMenuItem,{onClick:()=>{v(e),C(e.name),h(!0)},className:"gap-2",children:[(0,t.jsx)(ez.Edit2,{className:"h-4 w-4"}),"Rename"]}),(0,t.jsxs)(e$.DropdownMenuItem,{onClick:()=>{w(e),g(!0)},className:"gap-2 text-red-400 focus:text-red-300",children:[(0,t.jsx)(_.Trash2,{className:"h-4 w-4"}),"Delete"]})]})]})]}),e.isExpanded&&e.children.map(e=>V(e,s+1))]},e.id)};return(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("h3",{className:"text-sm font-medium text-foreground",children:"Folders"}),(0,t.jsxs)(k.Button,{size:"sm",variant:"outline",className:"h-7 gap-1 text-xs",onClick:()=>B(null),children:[(0,t.jsx)(eE.FolderPlus,{className:"h-3 w-3"}),"New Folder"]})]}),(0,t.jsx)("div",{className:"border border-white/10 rounded-lg bg-white/5 p-2 space-y-0.5 max-h-[400px] overflow-y-auto",children:0===D.length?(0,t.jsxs)("div",{className:"py-8 text-center text-sm text-muted-foreground",children:[(0,t.jsx)(eL.Folder,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),(0,t.jsx)("p",{children:"No folders yet"}),(0,t.jsx)("p",{className:"text-xs mt-1",children:"Create your first folder to organize documents"})]}):D.map(e=>V(e))}),(0,t.jsx)(L.Dialog,{open:c,onOpenChange:m,children:(0,t.jsxs)(L.DialogContent,{className:"bg-zinc-950 border-white/10 text-white",children:[(0,t.jsxs)(L.DialogHeader,{children:[(0,t.jsxs)(L.DialogTitle,{className:"flex items-center gap-2 text-white",children:[(0,t.jsx)(eE.FolderPlus,{className:"h-5 w-5 text-emerald-400"}),"Create New Folder"]}),(0,t.jsx)(L.DialogDescription,{className:"text-gray-400",children:p?`Creating subfolder in "${a.find(e=>e.id===p)?.name}"`:"Creating folder at root level"})]}),(0,t.jsx)("div",{className:"space-y-4 py-4",children:(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(z.Label,{htmlFor:"folder-name",className:"text-white",children:"Folder Name *"}),(0,t.jsx)(E.Input,{id:"folder-name",value:y,onChange:e=>C(e.target.value),placeholder:"e.g., Q4 2024 Reports",className:"bg-white/5 border-white/10 text-white placeholder:text-gray-500",autoFocus:!0,onKeyDown:e=>{"Enter"===e.key&&y.trim()&&I()}})]})}),(0,t.jsxs)(L.DialogFooter,{children:[(0,t.jsx)(k.Button,{variant:"outline",onClick:()=>m(!1),disabled:F,className:"bg-gray-700 text-white border-gray-600 hover:bg-gray-600",children:"Cancel"}),(0,t.jsx)(k.Button,{onClick:I,disabled:F||!y.trim(),className:"bg-emerald-600 hover:bg-emerald-700 text-white",children:"Create Folder"})]})]})}),(0,t.jsx)(L.Dialog,{open:u,onOpenChange:h,children:(0,t.jsxs)(L.DialogContent,{className:"bg-zinc-950 border-white/10 text-white",children:[(0,t.jsxs)(L.DialogHeader,{children:[(0,t.jsxs)(L.DialogTitle,{className:"flex items-center gap-2 text-white",children:[(0,t.jsx)(ez.Edit2,{className:"h-5 w-5 text-emerald-400"}),"Rename Folder"]}),(0,t.jsxs)(L.DialogDescription,{className:"text-gray-400",children:['Renaming "',j?.name,'"']})]}),(0,t.jsx)("div",{className:"space-y-4 py-4",children:(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(z.Label,{htmlFor:"rename-folder",className:"text-white",children:"New Name *"}),(0,t.jsx)(E.Input,{id:"rename-folder",value:y,onChange:e=>C(e.target.value),placeholder:"Enter new folder name",className:"bg-white/5 border-white/10 text-white placeholder:text-gray-500",autoFocus:!0,onKeyDown:e=>{"Enter"===e.key&&y.trim()&&A()}})]})}),(0,t.jsxs)(L.DialogFooter,{children:[(0,t.jsx)(k.Button,{variant:"outline",onClick:()=>h(!1),disabled:F,className:"bg-gray-700 text-white border-gray-600 hover:bg-gray-600",children:"Cancel"}),(0,t.jsx)(k.Button,{onClick:A,disabled:F||!y.trim(),className:"bg-emerald-600 hover:bg-emerald-700 text-white",children:"Rename"})]})]})}),(0,t.jsx)(L.Dialog,{open:x,onOpenChange:g,children:(0,t.jsxs)(L.DialogContent,{className:"bg-zinc-950 border-white/10 text-white",children:[(0,t.jsxs)(L.DialogHeader,{children:[(0,t.jsxs)(L.DialogTitle,{className:"flex items-center gap-2 text-red-400",children:[(0,t.jsx)(_.Trash2,{className:"h-5 w-5"}),"Delete Folder"]}),(0,t.jsxs)(L.DialogDescription,{className:"text-gray-400",children:['Are you sure you want to delete "',N?.name,'"? This action cannot be undone.']})]}),(0,t.jsx)("div",{className:"py-4 text-sm text-gray-400",children:N&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("p",{className:"mb-2 text-white",children:"The folder must be empty before deletion:"}),(0,t.jsxs)("ul",{className:"list-disc list-inside space-y-1",children:[(0,t.jsx)("li",{children:"Move all documents to another folder"}),(0,t.jsx)("li",{children:"Delete all subfolders first"})]})]})}),(0,t.jsxs)(L.DialogFooter,{children:[(0,t.jsx)(k.Button,{variant:"outline",onClick:()=>g(!1),disabled:F,className:"bg-gray-700 text-white border-gray-600 hover:bg-gray-600",children:"Cancel"}),(0,t.jsx)(k.Button,{variant:"destructive",onClick:$,disabled:F,className:"bg-red-500 hover:bg-red-600 text-white",children:"Delete Folder"})]})]})})]})}let eU=H.z.object({commitment:H.z.number().nonnegative("Commitment must be positive"),currency:H.z.string().length(3,"Currency must be 3 letters").transform(e=>e.toUpperCase()),status:H.z.enum(["pending","committed","partially_funded","funded","active","closed","cancelled"]),effective_date:H.z.string().optional().nullable(),funding_due_at:H.z.string().optional().nullable(),committed_at:H.z.string().optional().nullable(),contract_date:H.z.string().optional().nullable(),price_per_share:H.z.number().nonnegative("Price per share must be positive").optional().nullable(),cost_per_share:H.z.number().nonnegative("Cost per share must be positive").optional().nullable(),num_shares:H.z.number().nonnegative("Number of shares must be positive").optional().nullable(),units:H.z.number().nonnegative("Units must be positive").optional().nullable(),spread_per_share:H.z.number().optional().nullable(),spread_fee_amount:H.z.number().nonnegative("Spread fee must be positive").optional().nullable(),subscription_fee_percent:H.z.number().min(0,"Subscription fee percent must be positive").max(100,"Subscription fee percent cannot exceed 100%").optional().nullable(),subscription_fee_amount:H.z.number().nonnegative("Subscription fee must be positive").optional().nullable(),bd_fee_percent:H.z.number().min(0,"BD fee percent must be positive").max(100,"BD fee percent cannot exceed 100%").optional().nullable(),bd_fee_amount:H.z.number().nonnegative("BD fee must be positive").optional().nullable(),finra_fee_amount:H.z.number().nonnegative("FINRA fee must be positive").optional().nullable(),performance_fee_tier1_percent:H.z.number().min(0,"Performance fee tier 1 percent must be positive").max(100,"Performance fee tier 1 percent cannot exceed 100%").optional().nullable(),performance_fee_tier1_threshold:H.z.number().nonnegative("Performance fee tier 1 threshold must be positive").optional().nullable(),performance_fee_tier2_percent:H.z.number().min(0,"Performance fee tier 2 percent must be positive").max(100,"Performance fee tier 2 percent cannot exceed 100%").optional().nullable(),performance_fee_tier2_threshold:H.z.number().nonnegative("Performance fee tier 2 threshold must be positive").optional().nullable(),funded_amount:H.z.number().nonnegative("Funded amount must be positive").optional().nullable(),outstanding_amount:H.z.number().nonnegative("Outstanding amount must be positive").optional().nullable(),capital_calls_total:H.z.number().nonnegative("Capital calls total must be positive").optional().nullable(),distributions_total:H.z.number().nonnegative("Distributions total must be positive").optional().nullable(),current_nav:H.z.number().optional().nullable(),signed_doc_id:H.z.string().uuid("Signed document ID must be a valid UUID").optional().nullable(),acknowledgement_notes:H.z.string().optional().nullable(),opportunity_name:H.z.string().optional().nullable(),sourcing_contract_ref:H.z.string().optional().nullable(),introducer_id:H.z.string().uuid("Introducer ID must be a valid UUID").optional().nullable(),introduction_id:H.z.string().uuid("Introduction ID must be a valid UUID").optional().nullable()}).refine(e=>!e.effective_date||!e.funding_due_at||new Date(e.effective_date)<=new Date(e.funding_due_at),{message:"Funding due date must be after effective date",path:["funding_due_at"]}).refine(e=>!e.contract_date||new Date(e.contract_date)<=new Date,{message:"Contract date cannot be in the future",path:["contract_date"]}).refine(e=>{if(null!=e.price_per_share&&null!=e.cost_per_share&&null!=e.spread_per_share){let t=e.price_per_share-e.cost_per_share;return .01>=Math.abs(e.spread_per_share-t)}return!0},{message:"Spread per share must equal price per share minus cost per share",path:["spread_per_share"]}).refine(e=>{if(null!=e.subscription_fee_percent&&null!=e.subscription_fee_amount&&e.commitment){let t=e.commitment*e.subscription_fee_percent/100;return .01>=Math.abs(e.subscription_fee_amount-t)}return!0},{message:"Subscription fee amount must match subscription fee percentage",path:["subscription_fee_amount"]}).refine(e=>{if(null!=e.bd_fee_percent&&null!=e.bd_fee_amount&&e.commitment){let t=e.commitment*e.bd_fee_percent/100;return .01>=Math.abs(e.bd_fee_amount-t)}return!0},{message:"BD fee amount must match BD fee percentage",path:["bd_fee_amount"]}).refine(e=>{if(null!=e.spread_per_share&&null!=e.num_shares&&null!=e.spread_fee_amount){let t=e.spread_per_share*e.num_shares;return .01>=Math.abs(e.spread_fee_amount-t)}return!0},{message:"Spread fee amount must equal spread per share times number of shares",path:["spread_fee_amount"]}).refine(e=>null==e.performance_fee_tier1_threshold||null==e.performance_fee_tier2_threshold||e.performance_fee_tier2_threshold>=e.performance_fee_tier1_threshold,{message:"Performance fee tier 2 threshold must be greater than or equal to tier 1 threshold",path:["performance_fee_tier2_threshold"]}).refine(e=>null==e.funded_amount||!e.commitment||e.funded_amount<=e.commitment,{message:"Funded amount cannot exceed commitment",path:["funded_amount"]}).refine(e=>{if(null!=e.funded_amount&&null!=e.outstanding_amount&&e.commitment){let t=e.commitment-e.funded_amount;return .01>=Math.abs(e.outstanding_amount-t)}return!0},{message:"Outstanding amount must equal commitment minus funded amount",path:["outstanding_amount"]});function eP({open:e,onClose:s,entityId:a,investorId:r,defaultValues:l,onSuccess:i}){let{form:n,onSubmit:o,isSubmitting:d}=function({entityId:e,investorId:t,defaultValues:s,onSuccess:a}){let r=(0,M.useForm)({resolver:(0,q.zodResolver)(eU),defaultValues:s||{commitment:0,currency:"USD",status:"pending"}}),l=async s=>{try{let r=await fetch(`/api/entities/${e}/investors/${t}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({allocation_status:s.status,subscription:s})});if(!r.ok){let e=await r.json();throw Error(e.error||"Failed to update subscription")}let l=await r.json();W.toast.success("Subscription updated successfully"),a?.(l)}catch(e){throw console.error("Failed to update subscription:",e),W.toast.error(e instanceof Error?e.message:"Failed to update subscription"),e}};return{form:r,onSubmit:r.handleSubmit(l),isSubmitting:r.formState.isSubmitting}}({entityId:a,investorId:r,defaultValues:l,onSuccess:e=>{i?.(e.investor),s()}});return(0,t.jsx)(L.Dialog,{open:e,onOpenChange:s,children:(0,t.jsxs)(L.DialogContent,{className:"bg-zinc-950 border-white/10 text-white max-w-2xl",children:[(0,t.jsxs)(L.DialogHeader,{children:[(0,t.jsxs)(L.DialogTitle,{className:"flex items-center gap-2 text-white",children:[(0,t.jsx)(p.Edit,{className:"h-5 w-5 text-emerald-400"}),"Edit Subscription"]}),(0,t.jsx)(L.DialogDescription,{className:"text-gray-400",children:"Update subscription details for this investor's commitment to the vehicle"})]}),(0,t.jsx)(U.Form,{...n,children:(0,t.jsxs)("form",{onSubmit:o,className:"space-y-4 py-4",children:[(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsx)(U.FormField,{control:n.control,name:"commitment",render:({field:e})=>(0,t.jsxs)(U.FormItem,{children:[(0,t.jsx)(U.FormLabel,{className:"text-white",children:"Commitment Amount *"}),(0,t.jsx)(U.FormControl,{children:(0,t.jsx)(E.Input,{type:"number",step:"0.01",placeholder:"0.00",className:"bg-white/5 border-white/10 text-white",...e,onChange:t=>e.onChange(parseFloat(t.target.value)||0)})}),(0,t.jsx)(U.FormMessage,{})]})}),(0,t.jsx)(U.FormField,{control:n.control,name:"currency",render:({field:e})=>(0,t.jsxs)(U.FormItem,{children:[(0,t.jsx)(U.FormLabel,{className:"text-white",children:"Currency *"}),(0,t.jsx)(U.FormControl,{children:(0,t.jsx)(E.Input,{maxLength:3,placeholder:"USD",className:"bg-white/5 border-white/10 text-white uppercase",...e})}),(0,t.jsx)(U.FormMessage,{})]})})]}),(0,t.jsx)(U.FormField,{control:n.control,name:"status",render:({field:e})=>(0,t.jsxs)(U.FormItem,{children:[(0,t.jsx)(U.FormLabel,{className:"text-white",children:"Status *"}),(0,t.jsxs)(I.Select,{onValueChange:e.onChange,defaultValue:e.value,children:[(0,t.jsx)(U.FormControl,{children:(0,t.jsx)(I.SelectTrigger,{className:"bg-white/5 border-white/10 text-white",children:(0,t.jsx)(I.SelectValue,{})})}),(0,t.jsxs)(I.SelectContent,{className:"bg-zinc-950 border-white/10",children:[(0,t.jsx)(I.SelectItem,{value:"pending",className:"text-white",children:"Pending"}),(0,t.jsx)(I.SelectItem,{value:"committed",className:"text-white",children:"Committed"}),(0,t.jsx)(I.SelectItem,{value:"active",className:"text-white",children:"Active"}),(0,t.jsx)(I.SelectItem,{value:"closed",className:"text-white",children:"Closed"}),(0,t.jsx)(I.SelectItem,{value:"cancelled",className:"text-white",children:"Cancelled"})]})]}),(0,t.jsx)(U.FormMessage,{})]})}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsx)(U.FormField,{control:n.control,name:"effective_date",render:({field:e})=>(0,t.jsxs)(U.FormItem,{children:[(0,t.jsx)(U.FormLabel,{className:"text-white",children:"Effective Date"}),(0,t.jsx)(U.FormControl,{children:(0,t.jsx)(E.Input,{type:"date",className:"bg-white/5 border-white/10 text-white",...e,value:e.value||""})}),(0,t.jsx)(U.FormMessage,{})]})}),(0,t.jsx)(U.FormField,{control:n.control,name:"funding_due_at",render:({field:e})=>(0,t.jsxs)(U.FormItem,{children:[(0,t.jsx)(U.FormLabel,{className:"text-white",children:"Funding Due Date"}),(0,t.jsx)(U.FormControl,{children:(0,t.jsx)(E.Input,{type:"date",className:"bg-white/5 border-white/10 text-white",...e,value:e.value||""})}),(0,t.jsx)(U.FormDescription,{className:"text-xs text-gray-400",children:"Must be after effective date"}),(0,t.jsx)(U.FormMessage,{})]})})]}),(0,t.jsx)(U.FormField,{control:n.control,name:"units",render:({field:e})=>(0,t.jsxs)(U.FormItem,{children:[(0,t.jsx)(U.FormLabel,{className:"text-white",children:"Units"}),(0,t.jsx)(U.FormControl,{children:(0,t.jsx)(E.Input,{type:"number",step:"0.01",placeholder:"Number of units",className:"bg-white/5 border-white/10 text-white",...e,value:e.value||"",onChange:t=>e.onChange(parseFloat(t.target.value)||null)})}),(0,t.jsx)(U.FormMessage,{})]})}),(0,t.jsx)(U.FormField,{control:n.control,name:"acknowledgement_notes",render:({field:e})=>(0,t.jsxs)(U.FormItem,{children:[(0,t.jsx)(U.FormLabel,{className:"text-white",children:"Acknowledgement Notes"}),(0,t.jsx)(U.FormControl,{children:(0,t.jsx)(V.Textarea,{placeholder:"Internal notes about this subscription",className:"bg-white/5 border-white/10 text-white",rows:3,...e,value:e.value||""})}),(0,t.jsx)(U.FormMessage,{})]})}),(0,t.jsxs)(L.DialogFooter,{children:[(0,t.jsx)(k.Button,{type:"button",variant:"outline",onClick:s,className:"bg-gray-700 text-white border-gray-600 hover:bg-gray-600",disabled:d,children:"Cancel"}),(0,t.jsx)(k.Button,{type:"submit",className:"bg-emerald-600 hover:bg-emerald-700 text-white",disabled:d,children:d?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(w.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),"Saving..."]}):"Save Changes"})]})]})})]})})}function eO({vehicleId:e,open:a,onClose:r,onSuccess:l}){let[i,n]=(0,s.useState)(!1),[o,d]=(0,s.useState)(null),[c,m]=(0,s.useState)({nav_total:"",nav_per_unit:"",as_of_date:new Date().toISOString().split("T")[0]}),u=async t=>{t.preventDefault(),n(!0),d(null);try{let t=await fetch(`/api/staff/vehicles/${e}/valuations`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({nav_total:parseFloat(c.nav_total),nav_per_unit:parseFloat(c.nav_per_unit),as_of_date:c.as_of_date})});if(!t.ok){let e=await t.json().catch(()=>({}));throw Error(e.error||"Failed to add valuation")}m({nav_total:"",nav_per_unit:"",as_of_date:new Date().toISOString().split("T")[0]}),l(),r()}catch(e){d(e.message)}finally{n(!1)}};return(0,t.jsx)(L.Dialog,{open:a,onOpenChange:r,children:(0,t.jsx)(L.DialogContent,{className:"sm:max-w-[500px]",children:(0,t.jsxs)("form",{onSubmit:u,children:[(0,t.jsxs)(L.DialogHeader,{children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(F.TrendingUp,{className:"h-5 w-5 text-emerald-500"}),(0,t.jsx)(L.DialogTitle,{children:"Add Valuation"})]}),(0,t.jsx)(L.DialogDescription,{children:"Add a new NAV valuation for this vehicle"})]}),(0,t.jsxs)("div",{className:"space-y-4 py-4",children:[o&&(0,t.jsx)("div",{className:"rounded-md bg-red-500/10 border border-red-500/20 p-3 text-sm text-red-400",children:o}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(z.Label,{htmlFor:"as_of_date",children:"Valuation Date *"}),(0,t.jsx)(E.Input,{id:"as_of_date",type:"date",value:c.as_of_date,onChange:e=>m({...c,as_of_date:e.target.value}),required:!0,className:"bg-background border-border"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(z.Label,{htmlFor:"nav_total",children:"Total NAV *"}),(0,t.jsx)(E.Input,{id:"nav_total",type:"number",step:"0.01",placeholder:"1000000.00",value:c.nav_total,onChange:e=>m({...c,nav_total:e.target.value}),required:!0,className:"bg-background border-border"}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:"Total Net Asset Value"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(z.Label,{htmlFor:"nav_per_unit",children:"NAV Per Unit *"}),(0,t.jsx)(E.Input,{id:"nav_per_unit",type:"number",step:"0.0001",placeholder:"100.00",value:c.nav_per_unit,onChange:e=>m({...c,nav_per_unit:e.target.value}),required:!0,className:"bg-background border-border"}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:"NAV per individual unit/share"})]})]}),(0,t.jsxs)(L.DialogFooter,{children:[(0,t.jsx)(k.Button,{type:"button",variant:"outline",onClick:r,disabled:i,children:"Cancel"}),(0,t.jsxs)(k.Button,{type:"submit",disabled:i,children:[i&&(0,t.jsx)(w.Loader2,{className:"h-4 w-4 mr-2 animate-spin"}),"Add Valuation"]})]})]})})})}function eR({vehicleId:e,valuation:a,open:r,onClose:l,onSuccess:i}){let[n,o]=(0,s.useState)(!1),[d,c]=(0,s.useState)(null),[m,u]=(0,s.useState)({nav_total:"",nav_per_unit:"",as_of_date:""});(0,s.useEffect)(()=>{a&&(u({nav_total:null!=a.nav_total?String(a.nav_total):"",nav_per_unit:null!=a.nav_per_unit?String(a.nav_per_unit):"",as_of_date:a.as_of_date}),c(null))},[a]);let h=async t=>{if(t.preventDefault(),a){o(!0),c(null);try{let t=await fetch(`/api/staff/vehicles/${e}/valuations/${a.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({nav_total:parseFloat(m.nav_total),nav_per_unit:parseFloat(m.nav_per_unit),as_of_date:m.as_of_date})});if(!t.ok){let e=await t.json().catch(()=>({}));throw Error(e.error||"Failed to update valuation")}i(),l()}catch(e){c(e.message)}finally{o(!1)}}};return(0,t.jsx)(L.Dialog,{open:r,onOpenChange:l,children:(0,t.jsx)(L.DialogContent,{className:"sm:max-w-[500px] bg-zinc-950 border-white/10",children:(0,t.jsxs)("form",{onSubmit:h,children:[(0,t.jsxs)(L.DialogHeader,{children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(F.TrendingUp,{className:"h-5 w-5 text-emerald-500"}),(0,t.jsx)(L.DialogTitle,{children:"Edit Valuation"})]}),(0,t.jsx)(L.DialogDescription,{children:"Update the NAV valuation for this vehicle"})]}),(0,t.jsxs)("div",{className:"space-y-4 py-4",children:[d&&(0,t.jsx)("div",{className:"rounded-md bg-red-500/10 border border-red-500/20 p-3 text-sm text-red-400",children:d}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(z.Label,{htmlFor:"as_of_date",children:"Valuation Date *"}),(0,t.jsx)(E.Input,{id:"as_of_date",type:"date",value:m.as_of_date,onChange:e=>u({...m,as_of_date:e.target.value}),required:!0,className:"bg-zinc-900 border-white/10"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(z.Label,{htmlFor:"nav_total",children:"Total NAV *"}),(0,t.jsx)(E.Input,{id:"nav_total",type:"number",step:"0.01",placeholder:"1000000.00",value:m.nav_total,onChange:e=>u({...m,nav_total:e.target.value}),required:!0,className:"bg-zinc-900 border-white/10"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(z.Label,{htmlFor:"nav_per_unit",children:"NAV Per Unit *"}),(0,t.jsx)(E.Input,{id:"nav_per_unit",type:"number",step:"0.0001",placeholder:"100.00",value:m.nav_per_unit,onChange:e=>u({...m,nav_per_unit:e.target.value}),required:!0,className:"bg-zinc-900 border-white/10"})]})]}),(0,t.jsxs)(L.DialogFooter,{children:[(0,t.jsx)(k.Button,{type:"button",variant:"outline",onClick:l,disabled:n,children:"Cancel"}),(0,t.jsxs)(k.Button,{type:"submit",disabled:n||!a,children:[n&&(0,t.jsx)(w.Loader2,{className:"h-4 w-4 mr-2 animate-spin"}),"Save Changes"]})]})]})})})}function eM({vehicleId:e,onImported:a}){let[r,l]=(0,s.useState)(!1),[i,n]=(0,s.useState)(null),[o,d]=(0,s.useState)(!1),c=(0,$.useRouter)(),m=async()=>{if(!i)return void W.toast.error("Please select a CSV file");d(!0);try{let t=new FormData;t.append("file",i);let s=await fetch(`/api/staff/vehicles/${e}/valuations/import`,{method:"POST",body:t}),r=await s.json();if(!s.ok)throw Error(r.error||"Failed to import valuations");W.toast.success(r.message||`Imported ${r.imported} valuation(s)`),l(!1),n(null),a?.(),c.refresh()}catch(e){W.toast.error(e.message||"Failed to import valuations")}finally{d(!1)}};return(0,t.jsxs)(L.Dialog,{open:r,onOpenChange:l,children:[(0,t.jsx)(L.DialogTrigger,{asChild:!0,children:(0,t.jsxs)(k.Button,{variant:"outline",size:"sm",children:[(0,t.jsx)(A.Upload,{className:"h-4 w-4 mr-2"}),"Import CSV"]})}),(0,t.jsxs)(L.DialogContent,{className:"bg-zinc-950 border-white/10",children:[(0,t.jsx)(L.DialogHeader,{children:(0,t.jsx)(L.DialogTitle,{className:"text-white",children:"Import Valuations"})}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(z.Label,{htmlFor:"valuation-file",children:"CSV File"}),(0,t.jsx)(E.Input,{id:"valuation-file",type:"file",accept:".csv",onChange:e=>n(e.target.files?.[0]||null),className:"bg-zinc-900 border-white/10"}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Expected columns: as_of_date, nav_total, nav_per_unit (header names flexible)"})]}),(0,t.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,t.jsx)(k.Button,{variant:"outline",onClick:()=>l(!1),disabled:o,children:"Cancel"}),(0,t.jsx)(k.Button,{onClick:m,disabled:!i||o,children:o?"Importing...":"Import"})]})]})]})]})}function eq({vehicleId:e,position:a,open:r,onClose:l,onSuccess:i}){let[n,o]=(0,s.useState)(!1),[d,c]=(0,s.useState)(null),[m,u]=(0,s.useState)({investor_id:"",units:"",cost_basis:"",last_nav:"",as_of_date:""});(0,s.useEffect)(()=>{a?(u({investor_id:a.investor_id,units:null!=a.units?String(a.units):"",cost_basis:null!=a.cost_basis?String(a.cost_basis):"",last_nav:null!=a.last_nav?String(a.last_nav):"",as_of_date:a.as_of_date||""}),c(null)):u({investor_id:"",units:"",cost_basis:"",last_nav:"",as_of_date:""})},[a]);let h=async t=>{t.preventDefault(),o(!0),c(null);try{let t={investor_id:m.investor_id,units:parseFloat(m.units)};m.cost_basis&&(t.cost_basis=parseFloat(m.cost_basis)),m.last_nav&&(t.last_nav=parseFloat(m.last_nav)),m.as_of_date&&(t.as_of_date=m.as_of_date);let s=a?`/api/staff/vehicles/${e}/positions/${a.id}`:`/api/staff/vehicles/${e}/positions`,r=await fetch(s,{method:a?"PUT":"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),n=await r.json().catch(()=>({}));if(!r.ok)throw Error(n.error||"Failed to save position");i(),l()}catch(e){c(e.message)}finally{o(!1)}};return(0,t.jsx)(L.Dialog,{open:r,onOpenChange:l,children:(0,t.jsx)(L.DialogContent,{className:"sm:max-w-[520px] bg-zinc-950 border-white/10",children:(0,t.jsxs)("form",{onSubmit:h,children:[(0,t.jsxs)(L.DialogHeader,{children:[(0,t.jsx)(L.DialogTitle,{className:"text-white",children:a?"Edit Position":"Add Position"}),(0,t.jsx)(L.DialogDescription,{children:"Manual position entry or correction for this vehicle"})]}),(0,t.jsxs)("div",{className:"space-y-4 py-4",children:[d&&(0,t.jsx)("div",{className:"rounded-md bg-red-500/10 border border-red-500/20 p-3 text-sm text-red-400",children:d}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(z.Label,{htmlFor:"investor_id",children:"Investor ID *"}),(0,t.jsx)(E.Input,{id:"investor_id",value:m.investor_id,onChange:e=>u({...m,investor_id:e.target.value}),required:!0,disabled:!!a,className:"bg-zinc-900 border-white/10"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(z.Label,{htmlFor:"units",children:"Units / Shares *"}),(0,t.jsx)(E.Input,{id:"units",type:"number",step:"0.0001",value:m.units,onChange:e=>u({...m,units:e.target.value}),required:!0,className:"bg-zinc-900 border-white/10"})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(z.Label,{htmlFor:"cost_basis",children:"Cost Basis"}),(0,t.jsx)(E.Input,{id:"cost_basis",type:"number",step:"0.01",value:m.cost_basis,onChange:e=>u({...m,cost_basis:e.target.value}),className:"bg-zinc-900 border-white/10"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(z.Label,{htmlFor:"last_nav",children:"Last NAV"}),(0,t.jsx)(E.Input,{id:"last_nav",type:"number",step:"0.0001",value:m.last_nav,onChange:e=>u({...m,last_nav:e.target.value}),className:"bg-zinc-900 border-white/10"})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(z.Label,{htmlFor:"as_of_date",children:"As of Date"}),(0,t.jsx)(E.Input,{id:"as_of_date",type:"date",value:m.as_of_date,onChange:e=>u({...m,as_of_date:e.target.value}),className:"bg-zinc-900 border-white/10"})]})]}),(0,t.jsxs)(L.DialogFooter,{children:[(0,t.jsx)(k.Button,{type:"button",variant:"outline",onClick:l,disabled:n,children:"Cancel"}),(0,t.jsxs)(k.Button,{type:"submit",disabled:n,children:[n&&(0,t.jsx)(w.Loader2,{className:"h-4 w-4 mr-2 animate-spin"}),a?"Save Changes":"Add Position"]})]})]})})})}function eH({vehicleId:e,onImported:a}){let[r,l]=(0,s.useState)(!1),[i,n]=(0,s.useState)(null),[o,d]=(0,s.useState)(!1),c=(0,$.useRouter)(),m=async()=>{if(!i)return void W.toast.error("Please select a CSV file");d(!0);try{let t=new FormData;t.append("file",i);let s=await fetch(`/api/staff/vehicles/${e}/positions/import`,{method:"POST",body:t}),r=await s.json();if(!s.ok)throw Error(r.error||"Failed to import positions");W.toast.success(r.message||`Imported ${r.imported} position(s)`),l(!1),n(null),a?.(),c.refresh()}catch(e){W.toast.error(e.message||"Failed to import positions")}finally{d(!1)}};return(0,t.jsxs)(L.Dialog,{open:r,onOpenChange:l,children:[(0,t.jsx)(L.DialogTrigger,{asChild:!0,children:(0,t.jsxs)(k.Button,{variant:"outline",size:"sm",children:[(0,t.jsx)(A.Upload,{className:"h-4 w-4 mr-2"}),"Import CSV"]})}),(0,t.jsxs)(L.DialogContent,{className:"bg-zinc-950 border-white/10",children:[(0,t.jsx)(L.DialogHeader,{children:(0,t.jsx)(L.DialogTitle,{className:"text-white",children:"Import Positions"})}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(z.Label,{htmlFor:"positions-file",children:"CSV File"}),(0,t.jsx)(E.Input,{id:"positions-file",type:"file",accept:".csv",onChange:e=>n(e.target.files?.[0]||null),className:"bg-zinc-900 border-white/10"}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Expected columns: investor_id, units, cost_basis, last_nav, as_of_date"})]}),(0,t.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,t.jsx)(k.Button,{variant:"outline",onClick:()=>l(!1),disabled:o,children:"Cancel"}),(0,t.jsx)(k.Button,{onClick:m,disabled:!i||o,children:o?"Importing...":"Import"})]})]})]})]})}let eJ={fund:"Fund",spv:"SPV",securitization:"Securitization",note:"Note",venture_capital:"Venture Capital",private_equity:"Private Equity",real_estate:"Real Estate",other:"Other"},eG=(e,t)=>{if(null==e)return null;let s=(t||"USD").toUpperCase();try{return new Intl.NumberFormat("en-US",{style:"currency",currency:s,maximumFractionDigits:0}).format(e)}catch{return`${s} ${e.toLocaleString()}`}},eK=e=>{if(null==e||""===e)return"";let t="number"==typeof e?e:Number(e);if(!Number.isNaN(t)&&t>0){let e=new Date(new Date(1899,11,30).getTime()+24*t*36e5);if(!Number.isNaN(e.getTime()))return e.toLocaleDateString()}if("string"==typeof e){let t=new Date(e);if(!Number.isNaN(t.getTime()))return t.toLocaleDateString()}return String(e)},eW=({notes:e})=>{try{let s=JSON.parse(e),a=Array.isArray(s?.line_items)?s.line_items:[];if(a.length>0)return(0,t.jsxs)("div",{className:"mt-2 space-y-2 rounded-md border border-emerald-400/30 bg-emerald-500/5 p-3 text-xs text-emerald-50",children:[(0,t.jsxs)("div",{className:"flex flex-wrap items-center gap-2 text-emerald-200",children:[(0,t.jsx)("span",{className:"font-semibold uppercase tracking-wide",children:s?.source?String(s.source):"Legacy workbook import"}),s?.run_id&&(0,t.jsxs)("span",{children:["Run ID ",s.run_id]})]}),(0,t.jsx)("div",{className:"space-y-2",children:a.map((e,a)=>{let r=String(e.sheet??"Sheet"),l=null!=e.row?String(e.row):"?",i=e.amount_converted??e.amount_original??void 0,n="number"==typeof i?i:null!=i?Number(i):void 0,o=e.currency_converted??e.currency_original??s?.currency??"USD",d=e.comments?String(e.comments):null,c=eK(e.order_date),m=eK(e.settlement_date),u=null==n||Number.isNaN(n)?null:eG(n,String(o))??n.toLocaleString();return(0,t.jsxs)("div",{className:"rounded border border-emerald-500/20 bg-emerald-500/10 p-2",children:[(0,t.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[(0,t.jsxs)("span",{className:"font-semibold uppercase tracking-wide text-emerald-200",children:[r," #",l]}),u&&(0,t.jsx)("span",{children:u})]}),(0,t.jsxs)("div",{className:"mt-1 flex flex-wrap gap-4 text-emerald-100",children:[""!==c&&(0,t.jsxs)("span",{children:["Order: ",c]}),""!==m&&(0,t.jsxs)("span",{children:["Settlement: ",m]})]}),d&&(0,t.jsx)("p",{className:"mt-1 italic text-emerald-200",children:d})]},`${r}-${l}-${a}`)})})]})}catch(e){}return(0,t.jsx)("p",{className:"mt-2 whitespace-pre-wrap break-words text-emerald-50",children:e})},eY=[{key:"shareholders",label:"Shareholders",roles:["shareholder"]},{key:"legal",label:"Legal & Counsel",roles:["lawyer"]},{key:"accounting",label:"Accounting",roles:["accountant"]},{key:"auditors",label:"Auditors",roles:["auditor"]},{key:"administrators",label:"Administrators",roles:["administrator"]},{key:"strategic",label:"Strategic Partners",roles:["strategic_partner"]},{key:"other",label:"Other Stakeholders",roles:["other"]}],eQ=e=>{if(!e)return null;try{return new URL(e).hostname.replace(/^www\./,"")}catch{return e.replace(/^https?:\/\//,"")}},eX=[{value:"pending",label:"Pending"},{value:"committed",label:"Committed"},{value:"active",label:"Active"},{value:"closed",label:"Closed"},{value:"cancelled",label:"Cancelled"}];function eZ({entity:e,directors:L,stakeholders:E,folders:A,flags:$,deals:V,events:U,investors:P,valuations:O,positions:M}){let[q,H]=(0,s.useState)("overview"),[J,G]=(0,s.useState)(e),[K,Q]=(0,s.useState)(L),[X,Z]=(0,s.useState)(E),[ea,er]=(0,s.useState)(A),[el,en]=(0,s.useState)($),[eo,ed]=(0,s.useState)([]),[ec,ex]=(0,s.useState)(!0),[eg,ep]=(0,s.useState)(null),[eb,ej]=(0,s.useState)(null),[eN,ew]=(0,s.useState)(U),[ey,e_]=(0,s.useState)(!1),[eC,eF]=(0,s.useState)(!1),[eS,eD]=(0,s.useState)("create"),[ek,eT]=(0,s.useState)(null),[eL,eE]=(0,s.useState)(!1),[ez,eA]=(0,s.useState)("create"),[e$,eB]=(0,s.useState)(null),[eU,eK]=(0,s.useState)(!1),[eZ,e0]=(0,s.useState)(!1),[e1,e4]=(0,s.useState)(P),[e2,e5]=(0,s.useState)(O),[e3,e6]=(0,s.useState)(null),[e9,e7]=(0,s.useState)(M),[e8,te]=(0,s.useState)(!1),[tt,ts]=(0,s.useState)(null),[ta,tr]=(0,s.useState)(!1),[tl,ti]=(0,s.useState)(null),[tn,to]=(0,s.useState)(null),[td,tc]=(0,s.useState)(!1),[tm,tu]=(0,s.useState)(!1),[th,tx]=(0,s.useState)(null),[tg,tp]=(0,s.useState)(!1),[tf,tb]=(0,s.useState)(!1),tj=(0,et.useDocumentViewer)(),[tv,tN]=(0,s.useState)(null),[tw,ty]=(0,s.useState)(!1),[t_,tC]=(0,s.useState)(null),[tF,tS]=(0,s.useState)(!1),[tD,tk]=(0,s.useState)(!1),[tT,tI]=(0,s.useState)(null),[tL,tE]=(0,s.useState)(null),tz=(0,s.useRef)(null),tA=(0,s.useRef)(null),t$=(0,s.useRef)(""),tB=(0,s.useRef)(null),tV=(0,s.useRef)(null),tU=(0,s.useRef)(null),tP=(0,s.useRef)(null),{confirm:tO,ConfirmationDialog:tR}=ei(),tM=(0,s.useCallback)(async()=>{try{let e=await fetch(`/api/entities/${J.id}/folders`);if(!e.ok)throw Error("Failed to fetch folders");let t=await e.json();er(t.folders||[])}catch(e){console.error("Failed to fetch folders:",e),W.toast.error("Failed to refresh folders")}},[J.id]),tq=(0,s.useCallback)(async()=>{ex(!0),ep(null);try{let e=await fetch(`/api/documents?entity_id=${J.id}`);if(!e.ok){let t=await e.json().catch(()=>({}));throw Error(t.error||"Failed to load documents")}let t=await e.json();ed(t.documents||[])}catch(e){ep(e.message)}finally{ex(!1)}},[J.id]),tH=(0,s.useCallback)(async()=>{try{let e=await fetch(`/api/entities/${J.id}`);if(e.ok){let t=await e.json();G(t.entity),Q(t.directors||[]),Z(t.stakeholders||[]),er(t.folders||[]),en(t.flags||[]),e4(t.investors||[]),ew(t.entity_events||[])}}catch(e){console.error("Failed to refresh entity data:",e)}},[J.id]);(0,s.useEffect)(()=>{tq()},[tq]),(0,s.useEffect)(()=>{eb&&ea.some(e=>e.id===eb)||(ea.length>0?ej(ea[0].id):ej(null))},[ea,eb]),(0,s.useMemo)(()=>K.filter(e=>!e.effective_to),[K]),(0,s.useMemo)(()=>K.filter(e=>e.effective_to),[K]);let tJ=(0,s.useMemo)(()=>{let e={};return eY.forEach(t=>{e[t.key]=[]}),X.forEach(t=>{let s=eY.find(e=>e.roles.includes(t.role))??eY.find(e=>"other"===e.key),a=s?.key??"other";e[a]||(e[a]=[]),e[a].push(t)}),e},[X]),tG=(0,s.useMemo)(()=>{let e=new Map;return ea.forEach(t=>e.set(t.id,t)),e},[ea]),tK=(0,s.useMemo)(()=>eb?eo.filter(e=>e.folder_id===eb):eo,[eo,eb]),tW=eb?tG.get(eb)??null:null;(0,s.useMemo)(()=>{let e={open:0,in_progress:1,closed:2};return[...el].sort((t,s)=>{let a=(e[t.status]??3)-(e[s.status]??3);return 0!==a?a:new Date(s.created_at).getTime()-new Date(t.created_at).getTime()})},[el]);let tY=(0,s.useCallback)(async()=>{tc(!0);try{let e=await fetch(`/api/entities/${J.id}/investors`);if(!e.ok){let t=await e.json().catch(()=>({}));throw Error(t.error||"Failed to load investors")}let t=await e.json();e4(t.investors||[])}catch(e){console.error("Failed to refresh investors:",e),W.toast.error("Unable to reload entity investors.")}finally{tc(!1)}},[J.id]),tQ=(0,s.useCallback)(async()=>{tp(!0);try{let e=await fetch(`/api/entities/${J.id}/flags`);if(!e.ok){let t=await e.json().catch(()=>({}));throw Error(t.error||"Failed to load flags")}let t=await e.json();en(t.flags||[])}catch(e){console.error("Failed to refresh flags:",e),W.toast.error("Unable to reload entity flags.")}finally{tp(!1)}},[J.id]),tX=(0,s.useCallback)(async()=>{try{let e=await fetch(`/api/staff/vehicles/${J.id}/valuations`);if(!e.ok)throw Error("Failed to load valuations");let t=await e.json();e5(t.valuations||[])}catch(e){console.error("Failed to refresh valuations:",e),W.toast.error("Unable to reload valuations.")}},[J.id]),tZ=(0,s.useCallback)(async()=>{try{let e=await fetch(`/api/staff/vehicles/${J.id}/positions`);if(!e.ok)throw Error("Failed to load positions");let t=await e.json();e7(t.positions||[])}catch(e){console.error("Failed to refresh positions:",e),W.toast.error("Unable to reload positions.")}},[J.id]),t0=(0,s.useCallback)(e=>{tO({title:"Delete valuation?",description:`This will permanently remove the valuation dated ${new Date(e.as_of_date).toLocaleDateString()}.`,confirmText:"Delete",cancelText:"Cancel",variant:"destructive"},async()=>{try{let t=await fetch(`/api/staff/vehicles/${J.id}/valuations/${e.id}`,{method:"DELETE"});if(!t.ok){let e=await t.json().catch(()=>({}));throw Error(e.error||"Failed to delete valuation")}W.toast.success("Valuation deleted."),await tX()}catch(e){console.error("Failed to delete valuation:",e),W.toast.error(e.message||"Unable to delete valuation.")}})},[tO,J.id,tX]),t1=(0,s.useCallback)(e=>{tO({title:"Delete position?",description:"This will permanently remove this position record.",confirmText:"Delete",cancelText:"Cancel",variant:"destructive"},async()=>{try{let t=await fetch(`/api/staff/vehicles/${J.id}/positions/${e.id}`,{method:"DELETE"});if(!t.ok){let e=await t.json().catch(()=>({}));throw Error(e.error||"Failed to delete position")}W.toast.success("Position deleted."),await tZ()}catch(e){console.error("Failed to delete position:",e),W.toast.error(e.message||"Unable to delete position.")}})},[tO,J.id,tZ]),t4=(0,s.useCallback)(e=>{e4(t=>[e,...t]),W.toast.success("Investor linked to entity.")},[]),t2=(0,s.useCallback)(async(e,t,s)=>{ti(e);try{let a={allocation_status:t};s&&(a.subscription={status:t});let r=await fetch(`/api/entities/${J.id}/investors/${e}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!r.ok){let e=await r.json().catch(()=>({}));throw Error(e.error||"Failed to update investor")}let l=await r.json();e4(t=>t.map(t=>t.id===e?l.investor:t)),W.toast.success("Investor allocation updated.")}catch(e){console.error("Failed to update investor status:",e),W.toast.error("Unable to update investor allocation.")}finally{ti(null)}},[J.id]);(0,s.useEffect)(()=>{t_?.subscription&&(t$.current=t_.subscription.status||"pending")},[t_]),(0,s.useCallback)(async()=>{if(t_){tk(!0);try{let e={},t={};tz.current?.value&&(t.commitment=parseFloat(tz.current.value)),tA.current?.value&&(t.currency=tA.current.value.toUpperCase()),t$.current&&(t.status=t$.current,e.allocation_status=t$.current),tB.current?.value&&(t.effective_date=tB.current.value),tV.current?.value&&(t.funding_due_at=tV.current.value),tU.current?.value&&(t.units=parseFloat(tU.current.value)),tP.current?.value!==void 0&&(t.acknowledgement_notes=tP.current.value),e.subscription=t;let s=await fetch(`/api/entities/${J.id}/investors/${t_.investorId}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!s.ok){let e=await s.json().catch(()=>({}));throw Error(e.error||"Failed to update subscription")}let a=await s.json();e4(e=>e.map(e=>e.id===t_.investorId?a.investor:e)),W.toast.success("Subscription updated successfully!"),tS(!1),tC(null)}catch(e){console.error("Failed to update subscription:",e),W.toast.error("Unable to update subscription.")}finally{tk(!1)}}},[t_,J.id]);let t5=(0,s.useCallback)(async(e,t)=>{tO({title:"Remove Investor",description:`Are you sure you want to unlink ${t} from this entity? This action cannot be undone. The entity-investor link data will be permanently deleted.`,confirmText:"Remove Investor",cancelText:"Keep Investor",variant:"destructive"},async()=>{to(e);try{let t=await fetch(`/api/entities/${J.id}/investors/${e}`,{method:"DELETE"});if(!t.ok){let e=await t.json().catch(()=>({}));throw Error(e.error||"Failed to remove investor")}e4(t=>t.filter(t=>t.id!==e)),W.toast.success("Investor unlinked from entity.")}catch(e){console.error("Failed to remove investor:",e),W.toast.error("Unable to remove investor from entity.")}finally{to(null)}})},[J.id,tO]),t3=(0,s.useCallback)(async e=>{try{let t=await fetch(`/api/documents/${e}/download`);if(!t.ok)throw Error("Failed to get download URL");let s=await t.json();s.download_url&&window.open(s.download_url,"_blank")}catch(e){console.error("Failed to download document:",e),W.toast.error("Failed to download document")}},[]),t6=(0,s.useCallback)(e=>{tN(e),ty(!0)},[]),t9=(0,s.useCallback)(async(e,t)=>{tO({title:"Delete Document",description:`Are you sure you want to delete "${t}"? This action cannot be undone and will permanently remove the document and all its versions.`,confirmText:"Delete Document",variant:"destructive"},async()=>{try{let t=await fetch(`/api/staff/documents/${e}`,{method:"DELETE"});if(!t.ok){let e=await t.json().catch(()=>({}));throw Error(e.error||"Failed to delete document")}ed(t=>t.filter(t=>t.id!==e)),W.toast.success("Document deleted successfully"),await tq()}catch(e){console.error("Failed to delete document:",e),W.toast.error(e instanceof Error?e.message:"Failed to delete document")}})},[tO,tq]),t7=(0,s.useCallback)(e=>{en(t=>[e,...t]),W.toast.success("Flag created for this entity.")},[]),t8=(0,s.useCallback)(async(e,t,s)=>{tx(e);try{let a=await fetch(`/api/entities/${J.id}/flags/${e}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!a.ok){let e=await a.json().catch(()=>({}));throw Error(e.error||"Failed to update flag")}let r=await a.json();en(t=>t.map(t=>t.id===e?r.flag:t)),s&&W.toast.success(s)}catch(e){console.error("Failed to update flag:",e),W.toast.error(e instanceof Error?e.message:"Unable to update flag.")}finally{tx(null)}},[J.id]);(0,s.useCallback)(async e=>{await t8(e,{status:"closed"},"Flag marked as resolved.")},[t8]),(0,s.useCallback)(async e=>{await t8(e,{status:"open",resolution_notes:null,resolved_at:null},"Flag reopened.")},[t8]),(0,s.useCallback)(async e=>{await t8(e,{status:"in_progress"},"Flag marked in progress.")},[t8]),(0,s.useCallback)(async(e,t)=>{tO({title:"Delete Flag",description:`Are you sure you want to delete the flag "${t}"? This action cannot be undone.`,confirmText:"Delete Flag",variant:"destructive"},async()=>{try{let t=await fetch(`/api/entities/${J.id}/flags/${e}`,{method:"DELETE"});if(!t.ok){let e=await t.json().catch(()=>({}));throw Error(e.error||"Failed to remove flag")}en(t=>t.filter(t=>t.id!==e)),W.toast.success("Flag removed from entity.")}catch(e){console.error("Failed to delete flag:",e),W.toast.error(e instanceof Error?e.message:"Unable to delete flag.")}})},[J.id,tO]);let se=(0,s.useCallback)(e=>{eT(e),eD("edit"),eF(!0)},[]),st=(0,s.useCallback)(async(e,t)=>{tO({title:"Delete Director",description:`Are you sure you want to remove ${t} from this entity? This action cannot be undone.`,confirmText:"Delete Director",variant:"destructive"},async()=>{try{let t=await fetch(`/api/entities/${J.id}/directors/${e}`,{method:"DELETE"});if(!t.ok){let e=await t.json().catch(()=>({}));throw Error(e.error||"Failed to delete director")}Q(t=>t.filter(t=>t.id!==e)),W.toast.success("Director removed successfully"),await tH()}catch(e){console.error("Failed to delete director:",e),W.toast.error(e instanceof Error?e.message:"Failed to delete director")}})},[J.id,tO,tH]),ss=(0,s.useCallback)(e=>{eB(e),eA("edit"),eE(!0)},[]),sa=(0,s.useCallback)(async(e,t)=>{tO({title:"Delete Stakeholder",description:`Are you sure you want to remove ${t} from this entity? This action cannot be undone.`,confirmText:"Delete Stakeholder",variant:"destructive"},async()=>{try{let t=await fetch(`/api/entities/${J.id}/stakeholders/${e}`,{method:"DELETE"});if(!t.ok){let e=await t.json().catch(()=>({}));throw Error(e.error||"Failed to delete stakeholder")}Z(t=>t.filter(t=>t.id!==e)),W.toast.success("Stakeholder removed successfully"),await tH()}catch(e){console.error("Failed to delete stakeholder:",e),W.toast.error(e instanceof Error?e.message:"Failed to delete stakeholder")}})},[J.id,tO,tH]),sr=(0,s.useMemo)(()=>[{label:"Vehicle Code",value:J.entity_code||"",icon:u.ClipboardList},{label:"Platform",value:J.platform||"",icon:i.Building2},{label:"Formation Date",value:J.formation_date?new Date(J.formation_date).toLocaleDateString():"",icon:n.CalendarClock},{label:"Active Stakeholders",value:X.filter(e=>!e.effective_to).length.toString(),icon:m.Users}],[J,X]),sl=J.logo_url||"",[si,sn]=(0,s.useState)(!1);return(0,s.useEffect)(()=>{sn(!1)},[J.id,J.logo_url]),(0,t.jsxs)("div",{className:"p-6 space-y-6",children:[(0,t.jsxs)("div",{className:"flex flex-col md:flex-row md:items-start md:justify-between gap-6",children:[(0,t.jsxs)("div",{className:"space-y-4 max-w-3xl",children:[(0,t.jsx)(r.default,{href:"/versotech_main/entities",className:"inline-flex",children:(0,t.jsxs)(k.Button,{variant:"ghost",size:"sm",className:"gap-2 text-foreground hover:text-emerald-200 hover:bg-white/10",children:[(0,t.jsx)(l.ArrowLeft,{className:"h-4 w-4"}),"Back to Vehicles"]})}),(0,t.jsxs)("div",{className:"flex items-center gap-3 flex-wrap",children:[J.entity_code&&(0,t.jsx)(T.Badge,{variant:"outline",className:"font-mono text-lg px-3 py-1 border-emerald-400/40 text-emerald-100",children:J.entity_code}),(0,t.jsx)("h1",{className:"text-3xl font-bold text-foreground",children:J.name}),(0,t.jsx)(T.Badge,{className:"bg-white/10 border-white/15 text-foreground",children:eJ[J.type]||J.type}),J.status&&(0,t.jsx)(T.Badge,{className:"LIVE"===J.status?"bg-emerald-500/20 border-emerald-400/40 text-emerald-100":"CLOSED"===J.status?"bg-red-500/20 border-red-400/40 text-red-100":"bg-amber-500/20 border-amber-400/40 text-amber-100",children:J.status}),(0,t.jsx)(T.Badge,{variant:"outline",className:"border-emerald-400/40 text-emerald-100",children:J.currency})]}),(0,t.jsxs)("div",{className:"text-muted-foreground space-y-1",children:[J.investment_name&&(0,t.jsxs)("p",{className:"font-medium text-foreground text-lg",children:["Investment: ",J.investment_name]}),J.platform&&(0,t.jsxs)("p",{children:["Platform: ",J.platform]}),J.former_entity&&(0,t.jsxs)("p",{children:["Formerly: ",J.former_entity]}),(0,t.jsx)("p",{children:J.domicile||"Domicile unknown"}),(0,t.jsxs)("p",{className:"text-sm",children:["Created ",new Date(J.created_at).toLocaleString(),J.updated_at&&`  Updated ${new Date(J.updated_at).toLocaleString()}`]})]})]}),(0,t.jsxs)("div",{className:"flex flex-col items-center md:items-end gap-4 shrink-0",children:[(0,t.jsxs)("div",{className:"rounded-2xl border border-white/10 bg-white/[0.06] p-5 w-[220px] flex flex-col items-center gap-3 text-sm",children:[(0,t.jsx)("div",{className:"h-24 w-24 rounded-xl border border-white/10 bg-black/60 flex items-center justify-center overflow-hidden",children:sl&&!si?(0,t.jsx)(a.default,{src:sl,alt:`${J.name} logo`,width:96,height:96,className:"h-full w-full object-contain p-2",unoptimized:!0,onError:()=>{console.error("Failed to load logo:",sl),sn(!0)}}):(0,t.jsx)(i.Building2,{className:"h-10 w-10 text-muted-foreground"})}),(0,t.jsxs)("div",{className:"text-center space-y-1",children:[(0,t.jsx)("p",{className:"text-xs text-muted-foreground uppercase tracking-wide",children:"Branding"}),(0,t.jsx)("p",{className:"text-sm font-medium text-foreground",children:sl&&!si?"Logo uploaded":si?"Logo failed to load":"No logo set"}),eQ(J.website_url)&&(0,t.jsx)("a",{href:J.website_url||"#",target:"_blank",rel:"noopener noreferrer",className:"text-xs text-emerald-300 hover:text-emerald-200 transition-colors",children:eQ(J.website_url)})]})]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsxs)(k.Button,{onClick:()=>eK(!0),className:"gap-2 rounded-full bg-emerald-500 text-emerald-950 px-5 shadow-[0_12px_30px_rgba(16,185,129,0.35)] transition-colors hover:bg-emerald-400",children:[(0,t.jsx)(p.Edit,{className:"h-4 w-4"}),"Edit Metadata"]}),(0,t.jsxs)(k.Button,{onClick:()=>e0(!0),variant:"outline",className:"gap-2 rounded-full border-red-500/50 text-red-400 hover:bg-red-500/10 hover:text-red-300",children:[(0,t.jsx)(_.Trash2,{className:"h-4 w-4"}),"Delete Entity"]})]})]})]}),el.length>0&&(0,t.jsxs)(S.Card,{className:"border-amber-400/40 bg-amber-500/10",children:[(0,t.jsxs)(S.CardHeader,{className:"pb-3 flex flex-row items-center justify-between space-y-0",children:[(0,t.jsxs)(S.CardTitle,{className:"text-amber-100 flex items-center gap-2",children:[(0,t.jsx)(b.AlertTriangle,{className:"h-5 w-5"}),"Action Required (",el.length,")"]}),(0,t.jsxs)(k.Button,{size:"sm",variant:"outline",onClick:()=>tu(!0),className:"gap-2 border-amber-400/40 text-amber-100 hover:bg-amber-500/20",children:[(0,t.jsx)(c.Plus,{className:"h-4 w-4"}),"Add Flag"]})]}),(0,t.jsx)(S.CardContent,{children:(0,t.jsxs)("div",{className:"space-y-2",children:[el.slice(0,3).map(e=>(0,t.jsxs)("div",{className:"flex items-start gap-3 rounded-lg border border-white/10 bg-white/5 p-3",children:[(e=>{switch(e){case"critical":return(0,t.jsx)(b.AlertTriangle,{className:"h-4 w-4 text-red-400"});case"warning":return(0,t.jsx)(v.AlertCircle,{className:"h-4 w-4 text-amber-400"});case"info":return(0,t.jsx)(N.Info,{className:"h-4 w-4 text-blue-400"});case"success":return(0,t.jsx)(j.CheckCircle2,{className:"h-4 w-4 text-emerald-400"});default:return(0,t.jsx)(v.AlertCircle,{className:"h-4 w-4"})}})(e.severity),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("p",{className:"font-medium text-foreground",children:e.title}),e.description&&(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:e.description})]}),(0,t.jsx)(T.Badge,{className:(e=>{switch(e){case"critical":return"bg-red-500/20 border-red-400/40 text-red-100";case"warning":return"bg-amber-500/20 border-amber-400/40 text-amber-100";case"info":return"bg-blue-500/20 border-blue-400/40 text-blue-100";case"success":return"bg-emerald-500/20 border-emerald-400/40 text-emerald-100";default:return"bg-white/10 border-white/10 text-foreground"}})(e.severity),children:e.severity})]},e.id)),el.length>3&&(0,t.jsxs)(k.Button,{variant:"ghost",size:"sm",onClick:()=>H("flags"),children:["View all ",el.length," flags"]})]})})]}),(0,t.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:sr.map(e=>(0,t.jsxs)(S.Card,{className:"border border-white/10 bg-white/5",children:[(0,t.jsxs)(S.CardHeader,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,t.jsx)(S.CardTitle,{className:"text-sm font-medium text-muted-foreground",children:e.label}),(0,t.jsx)(e.icon,{className:"h-4 w-4 text-muted-foreground"})]}),(0,t.jsx)(S.CardContent,{children:(0,t.jsx)("div",{className:"text-lg font-semibold text-foreground",children:e.value})})]},e.label))}),(0,t.jsxs)(D.Tabs,{value:q,onValueChange:H,className:"space-y-4",children:[(0,t.jsxs)(D.TabsList,{className:"bg-white/5 border border-white/10",children:[(0,t.jsxs)(D.TabsTrigger,{value:"overview",className:"gap-2",children:[(0,t.jsx)(i.Building2,{className:"h-4 w-4"}),"Overview"]}),(0,t.jsxs)(D.TabsTrigger,{value:"investors",className:"gap-2",children:[(0,t.jsx)(g.ShieldCheck,{className:"h-4 w-4"}),"Subscriptions (",e1.length,")"]}),(0,t.jsxs)(D.TabsTrigger,{value:"documents",className:"gap-2",children:[(0,t.jsx)(f.FolderOpen,{className:"h-4 w-4"}),"Documents & Folders"]}),(0,t.jsxs)(D.TabsTrigger,{value:"stakeholders",className:"gap-2",children:[(0,t.jsx)(m.Users,{className:"h-4 w-4"}),"Stakeholders (",X.length,")"]}),(0,t.jsxs)(D.TabsTrigger,{value:"directors",className:"gap-2",children:[(0,t.jsx)(m.Users,{className:"h-4 w-4"}),"Directors (",K.length,")"]}),(0,t.jsxs)(D.TabsTrigger,{value:"deals",className:"gap-2",children:[(0,t.jsx)(x.Briefcase,{className:"h-4 w-4"}),"Deals (",V.length,")"]}),(0,t.jsxs)(D.TabsTrigger,{value:"health",className:"gap-2",children:[(0,t.jsx)(h.Activity,{className:"h-4 w-4"}),"Health"]}),(0,t.jsxs)(D.TabsTrigger,{value:"activity",className:"gap-2",children:[(0,t.jsx)(h.Activity,{className:"h-4 w-4"}),"Activity Log"]}),(0,t.jsxs)(D.TabsTrigger,{value:"valuations",className:"gap-2",children:[(0,t.jsx)(F.TrendingUp,{className:"h-4 w-4"}),"Valuations (",e2.length,")"]}),(0,t.jsxs)(D.TabsTrigger,{value:"positions",className:"gap-2",children:[(0,t.jsx)(u.ClipboardList,{className:"h-4 w-4"}),"Positions (",e9.length,")"]})]}),(0,t.jsxs)(D.TabsContent,{value:"overview",className:"space-y-4",children:[(0,t.jsxs)(S.Card,{className:"border border-white/10 bg-white/5",children:[(0,t.jsxs)(S.CardHeader,{children:[(0,t.jsx)(S.CardTitle,{children:"Vehicle Details"}),(0,t.jsx)(S.CardDescription,{children:"Complete information about this vehicle"})]}),(0,t.jsxs)(S.CardContent,{className:"grid grid-cols-1 md:grid-cols-2 gap-6 text-sm",children:[J.entity_code&&(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-muted-foreground",children:"Vehicle Code"}),(0,t.jsx)("p",{className:"text-foreground font-medium font-mono text-lg",children:J.entity_code})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-muted-foreground",children:"Legal Name"}),(0,t.jsx)("p",{className:"text-foreground font-medium",children:J.name})]}),J.investment_name&&(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-muted-foreground",children:"Investment Name"}),(0,t.jsx)("p",{className:"text-foreground font-medium",children:J.investment_name})]}),J.platform&&(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-muted-foreground",children:"Platform"}),(0,t.jsx)("p",{className:"text-foreground font-medium",children:J.platform})]}),J.former_entity&&(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-muted-foreground",children:"Former Entity"}),(0,t.jsx)("p",{className:"text-foreground font-medium",children:J.former_entity})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-muted-foreground",children:"Type"}),(0,t.jsx)("p",{className:"text-foreground font-medium",children:eJ[J.type]||J.type})]}),J.status&&(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-muted-foreground",children:"Status"}),(0,t.jsx)(T.Badge,{className:"LIVE"===J.status?"bg-emerald-500/20 border-emerald-400/40 text-emerald-100":"CLOSED"===J.status?"bg-red-500/20 border-red-400/40 text-red-100":"bg-amber-500/20 border-amber-400/40 text-amber-100",children:J.status})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-muted-foreground",children:"Domicile"}),(0,t.jsx)("p",{className:"text-foreground font-medium",children:J.domicile||""})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-muted-foreground",children:"Jurisdiction"}),(0,t.jsx)("p",{className:"text-foreground font-medium",children:J.legal_jurisdiction||""})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-muted-foreground",children:"Registration Number"}),(0,t.jsx)("p",{className:"text-foreground font-medium",children:J.registration_number||""})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-muted-foreground",children:"Currency"}),(0,t.jsx)("p",{className:"text-foreground font-medium",children:J.currency})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-muted-foreground",children:"Formation Date"}),(0,t.jsx)("p",{className:"text-foreground font-medium",children:J.formation_date?new Date(J.formation_date).toLocaleDateString():""})]}),J.reporting_type&&(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-muted-foreground",children:"Reporting Type"}),(0,t.jsx)("p",{className:"text-foreground font-medium",children:J.reporting_type})]}),null!==J.requires_reporting&&(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-muted-foreground",children:"Requires Reporting"}),(0,t.jsx)(T.Badge,{variant:"outline",children:J.requires_reporting?"Yes":"No"})]}),J.address&&(0,t.jsxs)("div",{className:"md:col-span-2",children:[(0,t.jsx)("p",{className:"text-muted-foreground",children:"Address"}),(0,t.jsx)("p",{className:"text-foreground whitespace-pre-wrap",children:J.address})]})]})]}),(0,t.jsxs)(S.Card,{className:"border border-white/10 bg-white/5",children:[(0,t.jsxs)(S.CardHeader,{children:[(0,t.jsx)(S.CardTitle,{className:"text-lg",children:"Service Providers"}),(0,t.jsx)(S.CardDescription,{children:"Arranger and legal counsel assignments for this vehicle"})]}),(0,t.jsxs)(S.CardContent,{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-muted-foreground",children:"Arranger"}),J.arranger_entity?(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-foreground font-medium",children:J.arranger_entity.legal_name}),J.arranger_entity.email&&(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:J.arranger_entity.email})]}):(0,t.jsx)("p",{className:"text-foreground",children:""})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-muted-foreground",children:"Legal Counsel"}),J.lawyer?(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-foreground font-medium",children:J.lawyer.display_name||J.lawyer.firm_name}),J.lawyer.firm_name&&J.lawyer.display_name&&J.lawyer.firm_name!==J.lawyer.display_name&&(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:J.lawyer.firm_name}),J.lawyer.primary_contact_email&&(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:J.lawyer.primary_contact_email})]}):(0,t.jsx)("p",{className:"text-foreground",children:""})]})]})]}),(0,t.jsxs)(S.Card,{className:"border border-white/10 bg-white/5",children:[(0,t.jsx)(S.CardHeader,{children:(0,t.jsx)(S.CardTitle,{className:"text-lg",children:"Notes"})}),(0,t.jsx)(S.CardContent,{children:(0,t.jsx)("p",{className:"text-foreground whitespace-pre-wrap leading-relaxed",children:J.notes?.trim()||"No notes recorded yet."})})]})]}),(0,t.jsx)(D.TabsContent,{value:"investors",className:"space-y-4",children:(0,t.jsxs)(S.Card,{className:"border border-white/10 bg-white/5",children:[(0,t.jsxs)(S.CardHeader,{className:"flex flex-row items-center justify-between gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(S.CardTitle,{children:"Subscriptions & Allocations"}),(0,t.jsx)(S.CardDescription,{children:"Manage allocations, commitments, and onboarding for this vehicle."})]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsxs)(k.Button,{variant:"outline",size:"sm",onClick:tY,disabled:td,children:[td&&(0,t.jsx)(w.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),"Refresh"]}),(0,t.jsxs)(k.Button,{size:"sm",className:"gap-2",onClick:()=>tr(!0),children:[(0,t.jsx)(c.Plus,{className:"h-4 w-4"}),"Link Investor"]})]})]}),(0,t.jsx)(S.CardContent,{className:"space-y-3",children:0===e1.length?(0,t.jsx)("div",{className:"text-sm text-muted-foreground",children:"No investors linked yet. Use Link Investor to allocate commitments to this vehicle."}):(0,t.jsx)("div",{className:"space-y-3",children:e1.map(e=>{let s=e.allocation_status||"pending",a=e.investor,r=e.subscriptions??[],l=e.subscription,i=r.length>0,n=e.holdings??[],o=n.length>0,d=e.total_commitment??(i?r.reduce((e,t)=>e+(t.commitment??0),0):null),c=e.total_holdings_amount??(o?n.reduce((e,t)=>e+(t.subscribed_amount??0),0):null);return(0,t.jsx)("div",{className:"rounded-lg border border-white/10 bg-white/5 p-3 transition-colors hover:bg-white/10",children:(0,t.jsxs)("div",{className:"flex flex-col gap-3 md:flex-row md:items-start md:justify-between",children:[(0,t.jsxs)("div",{className:"flex-1 space-y-2.5",children:[(0,t.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,t.jsx)("p",{className:"text-base font-semibold text-foreground",children:a?.legal_name||"Unknown Investor"}),a?.type&&(0,t.jsx)(T.Badge,{variant:"outline",className:"bg-white/10 text-xs capitalize",children:a.type.replace(/_/g," ")}),(0,t.jsx)(T.Badge,{className:(e=>{switch(e){case"active":case"committed":return"bg-emerald-500/20 border-emerald-400/40 text-emerald-100";case"closed":return"bg-blue-500/20 border-blue-400/40 text-blue-100";case"cancelled":return"bg-red-500/20 border-red-400/40 text-red-100";default:return"bg-amber-500/20 border-amber-400/40 text-amber-100"}})(s),children:s.replace(/_/g," ").toUpperCase()})]}),(0,t.jsxs)("div",{className:"text-xs text-muted-foreground flex flex-wrap gap-x-4 gap-y-1",children:[e.relationship_role&&(0,t.jsxs)("span",{children:[(0,t.jsx)("span",{className:"font-medium text-foreground",children:"Role:"})," ",e.relationship_role]}),a?.email&&(0,t.jsx)("span",{children:a.email}),(0,t.jsxs)("span",{children:["Linked ",new Date(e.created_at).toLocaleDateString()]})]}),i&&(0,t.jsxs)("div",{className:"rounded-md border border-emerald-400/30 bg-emerald-500/5 p-2.5",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,t.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,t.jsxs)("h4",{className:"text-xs font-semibold text-emerald-100 uppercase",children:["Subscription",r.length>1?"s":""]}),r.length>1&&(0,t.jsx)(T.Badge,{variant:"outline",className:"border-emerald-400/40 bg-emerald-500/10 text-emerald-100 text-xs h-4 px-1.5",children:r.length})]}),(0,t.jsxs)(k.Button,{variant:"ghost",size:"sm",className:"h-6 px-1.5 text-xs text-emerald-200 hover:text-emerald-100 hover:bg-emerald-500/20",onClick:()=>{tI(e.id),tE(l),tS(!0)},children:[(0,t.jsx)(p.Edit,{className:"h-3 w-3 mr-1"}),"Edit"]})]}),null!=d&&(0,t.jsx)("div",{className:"text-base font-bold text-emerald-100 mb-2",children:eG(d,l?.currency)}),(0,t.jsx)("div",{className:"space-y-2",children:r.map(e=>{let s=eG(e.commitment,e.currency),a=e.commitment&&e.commitment>0&&e.funded_amount?e.funded_amount/e.commitment*100:0,r=e.subscription_fee_amount||e.bd_fee_amount||e.spread_fee_amount||e.finra_fee_amount,l=[e.subscription_fee_amount,e.bd_fee_amount,e.spread_fee_amount,e.finra_fee_amount].reduce((e,t)=>e+(t||0),0),i=e.funded_amount&&e.funded_amount>0&&e.current_nav?e.current_nav/e.funded_amount:null;return(0,t.jsxs)("div",{className:"text-xs border-b border-emerald-400/10 pb-2 last:border-0",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-1.5",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{className:"font-medium text-emerald-100",children:s||"Pending"}),e.opportunity_name&&(0,t.jsxs)("span",{className:"text-emerald-300 italic text-[10px]",children:["(",e.opportunity_name,")"]})]}),(0,t.jsx)(T.Badge,{className:"bg-emerald-500/20 text-emerald-100 text-xs h-4 px-1.5 uppercase",children:e.status?.replace(/_/g," ")||"Pending"})]}),(e.committed_at||e.created_at)&&(0,t.jsxs)("div",{className:"flex gap-3 text-emerald-200 mb-1",children:[e.committed_at&&(0,t.jsxs)("span",{children:[(0,t.jsx)("span",{className:"text-emerald-300",children:"Committed:"})," ",new Date(e.committed_at).toLocaleDateString()]}),e.created_at&&(0,t.jsxs)("span",{children:[(0,t.jsx)("span",{className:"text-emerald-300",children:"Created:"})," ",new Date(e.created_at).toLocaleDateString()]})]}),(e.num_shares||e.price_per_share)&&(0,t.jsxs)("div",{className:"flex gap-3 text-emerald-200 mb-1",children:[e.num_shares&&(0,t.jsxs)("span",{children:[(0,t.jsx)("span",{className:"text-emerald-300",children:"Shares:"})," ",e.num_shares.toLocaleString()]}),e.price_per_share&&(0,t.jsxs)("span",{children:[(0,t.jsx)("span",{className:"text-emerald-300",children:"Price:"})," ",eG(e.price_per_share,e.currency)]}),e.spread_per_share&&e.spread_per_share>0&&(0,t.jsxs)("span",{className:"text-green-300",children:[(0,t.jsx)("span",{className:"text-emerald-300",children:"Spread:"})," ",eG(e.spread_per_share,e.currency)]})]}),(0,t.jsxs)("div",{className:"flex gap-3 text-emerald-200",children:[null!=e.funded_amount&&(0,t.jsxs)("span",{children:[(0,t.jsx)("span",{className:"text-emerald-300",children:"Funded:"})," ",eG(e.funded_amount,e.currency)," (",a.toFixed(0),"%)"]}),r&&(0,t.jsxs)("span",{children:[(0,t.jsx)("span",{className:"text-emerald-300",children:"Fees:"})," ",eG(l,e.currency)]}),null!=i&&(0,t.jsxs)("span",{className:i>=1?"text-green-300":"text-red-300",children:[(0,t.jsx)("span",{className:"text-emerald-300",children:"MOIC:"})," ",i.toFixed(2),"x"]})]}),e.acknowledgement_notes&&(0,t.jsx)(eW,{notes:e.acknowledgement_notes})]},e.id)})})]}),o&&(0,t.jsxs)("div",{className:"rounded-md border border-blue-400/30 bg-blue-500/5 p-2.5",children:[(0,t.jsxs)("div",{className:"flex items-center gap-1.5 mb-2",children:[(0,t.jsx)("h4",{className:"text-xs font-semibold text-blue-100 uppercase",children:"Holdings"}),(0,t.jsx)(T.Badge,{variant:"outline",className:"border-blue-400/40 bg-blue-500/10 text-blue-100 text-xs h-4 px-1.5",children:n.length})]}),null!=c&&(0,t.jsx)("div",{className:"text-base font-bold text-blue-100 mb-2",children:eG(c,n[0]?.currency??l?.currency)}),(0,t.jsx)("div",{className:"space-y-1.5",children:n.map(e=>{let s=eG(e.subscribed_amount,e.currency);return(0,t.jsxs)("div",{className:"text-xs",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"font-medium text-blue-100",children:e.deal_name||"Deal Allocation"}),(0,t.jsx)("div",{className:"font-semibold text-blue-100",children:s||"Pending"})]}),(0,t.jsx)(T.Badge,{className:"bg-blue-500/20 text-blue-100 text-xs h-4 px-1.5 uppercase",children:e.status?.replace(/_/g," ")||"Pending"})]}),(0,t.jsxs)("div",{className:"flex gap-3 text-blue-200",children:[(0,t.jsxs)("span",{children:[(0,t.jsx)("span",{className:"text-blue-300",children:"Eff:"})," ",e.effective_date?new Date(e.effective_date).toLocaleDateString():""]}),(0,t.jsxs)("span",{children:[(0,t.jsx)("span",{className:"text-blue-300",children:"Due:"})," ",e.funding_due_at?new Date(e.funding_due_at).toLocaleDateString():""]})]})]},e.id)})})]}),e.notes&&(0,t.jsx)("div",{className:"text-sm text-muted-foreground whitespace-pre-wrap border-l-2 border-white/10 pl-3 py-1",children:e.notes})]}),(0,t.jsxs)("div",{className:"flex flex-col items-end gap-2 min-w-[160px]",children:[(0,t.jsxs)("div",{className:"space-y-1.5 text-right w-full",children:[(0,t.jsx)(z.Label,{className:"text-xs uppercase text-muted-foreground",children:"Status"}),(0,t.jsxs)(I.Select,{value:s,onValueChange:t=>t2(e.id,t,i),disabled:tl===e.id,children:[(0,t.jsx)(I.SelectTrigger,{className:"w-full h-8 text-xs",children:(0,t.jsx)(I.SelectValue,{})}),(0,t.jsx)(I.SelectContent,{children:eX.map(e=>(0,t.jsx)(I.SelectItem,{value:e.value,children:e.label},e.value))})]})]}),"entity_link"===e.source||"hybrid"===e.source?(0,t.jsxs)(k.Button,{variant:"ghost",size:"sm",className:"text-red-400 hover:text-red-200 text-xs",onClick:()=>t5(e.id,a?.legal_name||"this investor"),disabled:tn===e.id,children:[tn===e.id?(0,t.jsx)(w.Loader2,{className:"mr-1 h-3 w-3 animate-spin"}):null,"Remove"]}):(0,t.jsx)("div",{className:"text-xs text-gray-500 italic",children:"Auto-discovered"})]})]})},e.id)})})})]})}),(0,t.jsxs)(D.TabsContent,{value:"documents",className:"space-y-4",children:[(0,t.jsxs)(S.Card,{className:"border border-white/10 bg-white/5",children:[(0,t.jsx)(S.CardHeader,{children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(S.CardTitle,{children:"Document Folders"}),(0,t.jsx)(S.CardDescription,{children:"Create, organize, and manage document folders with Google Drive-like structure"})]}),(0,t.jsx)(B,{entityId:J.id,triggerLabel:"Upload Document",onUploaded:tq,defaultFolderId:eb,folderOptions:ea.filter(e=>!(("entity"===e.folder_type||"vehicle_root"===e.folder_type)&&!e.parent_folder_id)).map(e=>({id:e.id,name:e.name,path:e.path}))})]})}),(0,t.jsx)(S.CardContent,{children:(0,t.jsx)(eV,{entityId:J.id,folders:ea,documents:eo,onFoldersChange:tM,onFolderSelect:ej,selectedFolderId:eb})})]}),(0,t.jsxs)(S.Card,{className:"border border-white/10 bg-white/5",children:[(0,t.jsxs)(S.CardHeader,{children:[(0,t.jsxs)(S.CardTitle,{children:[tW?`${tW.name} Documents`:"All Documents"," (",tK.length,")"]}),(0,t.jsx)(S.CardDescription,{children:tW?`Showing files stored under ${tW.path}`:"Complete list of all documents across all folders"})]}),(0,t.jsx)(S.CardContent,{children:ec?(0,t.jsx)("div",{className:"text-gray-400 text-sm",children:"Loading documents"}):eg?(0,t.jsx)("div",{className:"text-red-200 text-sm",children:eg}):0===tK.length?(0,t.jsx)("div",{className:"text-gray-400 text-sm",children:'No documents uploaded yet. Use the "Upload Document" button above to add documents.'}):(0,t.jsx)("div",{className:"space-y-3",children:tK.map(e=>{let s=!!e.external_url,a=s?e.external_url:`/api/documents/${e.id}/download`,l=s?"Linked":"Uploaded",i=e.folder_id?tG.get(e.folder_id):null;return(0,t.jsxs)("div",{className:"flex items-center justify-between rounded-lg border border-white/10 bg-white/5 px-4 py-3 hover:bg-white/10 transition-colors",children:[(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,t.jsx)(d.FileText,{className:"h-4 w-4 text-gray-400"}),(0,t.jsx)("span",{className:"font-medium text-white",children:e.name||e.file_key?.split("/").pop()||"Untitled document"}),e.type&&(0,t.jsx)(T.Badge,{className:"bg-white/10 border border-white/10 text-white capitalize",children:e.type.replace("_"," ")}),s&&(0,t.jsx)(T.Badge,{variant:"outline",className:"text-xs bg-emerald-500/10 border-emerald-400/30 text-emerald-100",children:"External Link"})]}),(0,t.jsxs)("p",{className:"text-xs text-gray-400",children:[l," ",new Date(e.created_at).toLocaleString(),e.created_by&&`  ${e.created_by}`]}),i&&(0,t.jsxs)("p",{className:"text-xs text-gray-400",children:["Folder: ",i.path," (",i.folder_type.replace("_"," "),")"]}),e.description&&(0,t.jsx)("p",{className:"text-sm text-gray-400 max-w-2xl",children:e.description}),s&&(0,t.jsx)("p",{className:"text-xs text-emerald-200 break-all",children:e.external_url})]}),(0,t.jsx)("div",{className:"flex items-center gap-2",children:s?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(k.Button,{variant:"outline",size:"sm",className:"gap-2",asChild:!0,children:(0,t.jsxs)(r.default,{href:a,target:"_blank",rel:"noopener noreferrer",children:[(0,t.jsx)(y.ExternalLink,{className:"h-4 w-4"}),"Visit"]})}),(0,t.jsx)(k.Button,{variant:"ghost",size:"sm",className:"h-8 px-2 text-white hover:text-emerald-100 hover:bg-white/10",onClick:()=>t6(e),children:(0,t.jsx)(p.Edit,{className:"h-4 w-4"})}),(0,t.jsx)(k.Button,{variant:"ghost",size:"sm",className:"h-8 px-2 text-white hover:text-red-400 hover:bg-red-500/10",onClick:()=>t9(e.id,e.name||"Untitled document"),children:(0,t.jsx)(_.Trash2,{className:"h-4 w-4"})})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(k.Button,{variant:"outline",size:"sm",className:"gap-2",onClick:()=>tj.openPreview({id:e.id,file_name:e.name||e.file_name||"document",mime_type:e.type||void 0,type:e.type||void 0,file_size_bytes:void 0}),children:[(0,t.jsx)(C.Eye,{className:"h-4 w-4"}),"Preview"]}),(0,t.jsxs)(k.Button,{variant:"outline",size:"sm",className:"gap-2",onClick:()=>t3(e.id),children:[(0,t.jsx)(o.Download,{className:"h-4 w-4"}),"Download"]}),(0,t.jsx)(k.Button,{variant:"ghost",size:"sm",className:"h-8 px-2 text-white hover:text-emerald-100 hover:bg-white/10",onClick:()=>t6(e),children:(0,t.jsx)(p.Edit,{className:"h-4 w-4"})}),(0,t.jsx)(k.Button,{variant:"ghost",size:"sm",className:"h-8 px-2 text-white hover:text-red-400 hover:bg-red-500/10",onClick:()=>t9(e.id,e.name||"Untitled document"),children:(0,t.jsx)(_.Trash2,{className:"h-4 w-4"})})]})})]},e.id)})})})]})]}),(0,t.jsx)(D.TabsContent,{value:"stakeholders",className:"space-y-4",children:(0,t.jsxs)(S.Card,{className:"border border-white/10 bg-white/5",children:[(0,t.jsxs)(S.CardHeader,{className:"flex flex-row items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(S.CardTitle,{children:"Stakeholders"}),(0,t.jsx)(S.CardDescription,{children:"Lawyers, accountants, auditors, administrators, and strategic partners"})]}),(0,t.jsxs)(k.Button,{size:"sm",className:"gap-2",onClick:()=>{eA("create"),eB(null),eE(!0)},children:[(0,t.jsx)(c.Plus,{className:"h-4 w-4"}),"Add Stakeholder"]})]}),(0,t.jsx)(S.CardContent,{children:0===X.length?(0,t.jsx)("div",{className:"text-gray-400 text-sm",children:"No stakeholders recorded yet."}):(0,t.jsx)("div",{className:"space-y-4",children:eY.map(e=>{let s=tJ[e.key]??[];return(0,t.jsxs)("div",{className:"rounded-lg border border-white/10 bg-white/5 p-4",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm font-semibold text-white",children:e.label}),(0,t.jsx)("p",{className:"text-xs text-gray-400",children:0===s.length?"No relationships recorded yet.":`Tracking ${s.length} relationship${1===s.length?"":"s"}.`})]}),(0,t.jsx)(T.Badge,{className:"bg-white/10 border border-white/10 text-white",children:s.length})]}),s.length>0&&(0,t.jsx)("div",{className:"space-y-3",children:s.map(e=>(0,t.jsxs)("div",{className:"rounded-md border border-white/10 bg-black/20 px-4 py-3",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("p",{className:"font-medium text-white",children:e.company_name||e.contact_person||"Unnamed"}),(0,t.jsxs)("p",{className:"text-xs text-gray-400",children:[e.contact_person&&`Contact: ${e.contact_person}`,e.email&&`  ${e.email}`,e.phone&&`  ${e.phone}`]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(T.Badge,{className:"bg-white/10 border border-white/10 text-white",children:e.effective_to?"Former":"Active"}),(0,t.jsx)(k.Button,{variant:"ghost",size:"sm",className:"h-8 px-2 text-white hover:text-emerald-100 hover:bg-white/10",onClick:()=>ss(e),children:(0,t.jsx)(p.Edit,{className:"h-4 w-4"})}),(0,t.jsx)(k.Button,{variant:"ghost",size:"sm",className:"h-8 px-2 text-white hover:text-red-400 hover:bg-red-500/10",onClick:()=>sa(e.id,e.company_name||e.contact_person||"stakeholder"),children:(0,t.jsx)(_.Trash2,{className:"h-4 w-4"})})]})]}),(0,t.jsxs)("p",{className:"text-xs text-gray-400 mt-1",children:["Effective ",e.effective_from?new Date(e.effective_from).toLocaleDateString():"unknown",e.effective_to&&`  Ended ${new Date(e.effective_to).toLocaleDateString()}`]}),e.notes&&(0,t.jsx)("p",{className:"text-sm text-gray-400 mt-2",children:e.notes})]},e.id))})]},e.key)})})})]})}),(0,t.jsx)(D.TabsContent,{value:"directors",className:"space-y-4",children:(0,t.jsxs)(S.Card,{className:"border border-white/10 bg-white/5",children:[(0,t.jsxs)(S.CardHeader,{className:"flex flex-row items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(S.CardTitle,{children:"Directors & Officers"}),(0,t.jsx)(S.CardDescription,{children:"Maintain the current roster and historical appointments"})]}),(0,t.jsxs)(k.Button,{size:"sm",className:"gap-2",onClick:()=>{eD("create"),eT(null),eF(!0)},children:[(0,t.jsx)(c.Plus,{className:"h-4 w-4"}),"Add Director"]})]}),(0,t.jsx)(S.CardContent,{children:0===K.length?(0,t.jsx)("div",{className:"text-gray-400 text-sm",children:"No directors recorded yet."}):(0,t.jsx)("div",{className:"space-y-3",children:K.map(e=>(0,t.jsxs)("div",{className:"rounded-lg border border-white/10 bg-white/5 px-4 py-3",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("p",{className:"font-medium text-white",children:e.full_name}),(0,t.jsxs)("p",{className:"text-xs text-gray-400",children:[e.role||"Role not specified",e.email&&`  ${e.email}`]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(T.Badge,{className:"bg-white/10 border border-white/10 text-white",children:e.effective_to?"Former":"Active"}),(0,t.jsx)(k.Button,{variant:"ghost",size:"sm",className:"h-8 px-2 text-white hover:text-emerald-100 hover:bg-white/10",onClick:()=>se(e),children:(0,t.jsx)(p.Edit,{className:"h-4 w-4"})}),(0,t.jsx)(k.Button,{variant:"ghost",size:"sm",className:"h-8 px-2 text-white hover:text-red-400 hover:bg-red-500/10",onClick:()=>st(e.id,e.full_name),children:(0,t.jsx)(_.Trash2,{className:"h-4 w-4"})})]})]}),(0,t.jsxs)("div",{className:"text-xs text-gray-400 mt-2",children:["Effective"," ",e.effective_from?new Date(e.effective_from).toLocaleDateString():"unknown",e.effective_to&&`  Ended ${new Date(e.effective_to).toLocaleDateString()}`]}),e.notes&&(0,t.jsx)("p",{className:"text-sm text-gray-400 mt-2",children:e.notes})]},e.id))})})]})}),(0,t.jsx)(D.TabsContent,{value:"deals",className:"space-y-4",children:(0,t.jsxs)(S.Card,{className:"border border-white/10 bg-white/5",children:[(0,t.jsxs)(S.CardHeader,{children:[(0,t.jsxs)(S.CardTitle,{children:["Deals Linked to ",J.name]}),(0,t.jsx)(S.CardDescription,{children:"Click on any deal to view details and manage investment opportunities"})]}),(0,t.jsx)(S.CardContent,{children:0===V.length?(0,t.jsxs)("div",{className:"text-gray-400 text-sm py-8 text-center",children:[(0,t.jsx)(x.Briefcase,{className:"h-12 w-12 mx-auto mb-2 opacity-50"}),(0,t.jsx)("p",{className:"text-white",children:"No deals linked to this entity yet."})]}):(0,t.jsx)("div",{className:"space-y-3",children:V.map(e=>(0,t.jsxs)(r.default,{href:`/versotech_main/deals/${e.id}`,className:"flex items-center justify-between rounded-lg border border-white/10 bg-white/5 px-4 py-3 transition-all hover:bg-white/10 hover:border-emerald-400/30 cursor-pointer group",children:[(0,t.jsxs)("div",{className:"flex items-start gap-3 flex-1",children:[(0,t.jsx)("div",{className:"h-10 w-10 rounded-full bg-emerald-500/10 flex items-center justify-center shrink-0 group-hover:bg-emerald-500/20 transition-colors",children:(0,t.jsx)(x.Briefcase,{className:"h-5 w-5 text-emerald-400"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-medium text-white group-hover:text-emerald-100 transition-colors",children:e.name}),(0,t.jsxs)("p",{className:"text-xs text-gray-400 capitalize",children:[e.deal_type.replace("_"," "),"  ",e.currency||""]}),(0,t.jsxs)("p",{className:"text-xs text-gray-400 mt-1",children:["Created ",new Date(e.created_at).toLocaleDateString()]})]})]}),(0,t.jsx)(T.Badge,{className:"active"===e.status?"bg-emerald-500/20 border-emerald-400/40 text-emerald-100":"closed"===e.status?"bg-blue-500/20 border-blue-400/40 text-blue-100":"bg-amber-500/20 border-amber-400/40 text-amber-100",children:e.status}),(0,t.jsx)(y.ExternalLink,{className:"h-4 w-4 text-muted-foreground group-hover:text-emerald-400 transition-colors ml-2"})]},e.id))})})]})}),(0,t.jsxs)(D.TabsContent,{value:"health",className:"space-y-4",children:[(0,t.jsx)(eI,{entity:J,directors:K,stakeholders:X,documents:eo,folders:ea,deals:V,investors:e1,onAction:e=>{switch(e){case"edit_metadata":eK(!0);break;case"add_stakeholder":eE(!0);break;case"add_director":eF(!0);break;case"link_investor":tr(!0);break;case"create_flag":tu(!0);break;case"upload_document":case"create_folder":H("documents");break;default:console.log("Action not implemented:",e)}}}),(0,t.jsx)("div",{className:"flex justify-end",children:(0,t.jsxs)(k.Button,{onClick:()=>tu(!0),className:"gap-2 bg-emerald-600 hover:bg-emerald-700 text-white",children:[(0,t.jsx)(c.Plus,{className:"h-4 w-4"}),"Create Health Flag"]})})]}),(0,t.jsx)(D.TabsContent,{value:"activity",className:"space-y-4",children:(0,t.jsxs)(S.Card,{className:"border border-white/10 bg-white/5",children:[(0,t.jsxs)(S.CardHeader,{className:"flex flex-row items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(S.CardTitle,{children:"Change Log"}),(0,t.jsx)(S.CardDescription,{children:"Automatic and manual updates recorded against this entity"})]}),(0,t.jsx)(k.Button,{variant:"outline",size:"sm",onClick:tH,disabled:ey,children:"Refresh"})]}),(0,t.jsx)(S.CardContent,{children:0===eN.length?(0,t.jsx)("div",{className:"text-muted-foreground text-sm",children:"No change events recorded yet."}):(0,t.jsx)(R.ScrollArea,{className:"max-h-[24rem] pr-4",children:(0,t.jsx)("div",{className:"space-y-4",children:eN.map(e=>(0,t.jsxs)("div",{className:"border-l-2 border-emerald-400/40 pl-4",children:[(0,t.jsx)("p",{className:"text-sm font-medium text-foreground",children:e.event_type.replace(/_/g," ")}),(0,t.jsxs)("p",{className:"text-xs text-muted-foreground",children:[new Date(e.created_at).toLocaleString(),e.changed_by_profile?.display_name&&`  ${e.changed_by_profile.display_name}`]}),e.description&&(0,t.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:e.description})]},e.id))})})})]})}),(0,t.jsx)(D.TabsContent,{value:"valuations",className:"space-y-4",children:(0,t.jsxs)(S.Card,{className:"border border-white/10 bg-white/5",children:[(0,t.jsxs)(S.CardHeader,{className:"flex flex-row items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(S.CardTitle,{children:"NAV History"}),(0,t.jsx)(S.CardDescription,{children:"Net Asset Value (NAV) entries for this vehicle over time"})]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(eM,{vehicleId:J.id,onImported:tX}),(0,t.jsxs)(k.Button,{variant:"outline",size:"sm",onClick:()=>tb(!0),children:[(0,t.jsx)(c.Plus,{className:"h-4 w-4 mr-2"}),"Add Valuation"]})]})]}),(0,t.jsx)(S.CardContent,{children:0===e2.length?(0,t.jsxs)("div",{className:"text-center py-8",children:[(0,t.jsx)(F.TrendingUp,{className:"h-12 w-12 mx-auto text-muted-foreground mb-3"}),(0,t.jsx)("p",{className:"text-muted-foreground text-sm",children:"No valuations recorded yet. Add the first valuation to track NAV over time."})]}):(0,t.jsx)("div",{className:"overflow-x-auto",children:(0,t.jsxs)("table",{className:"w-full",children:[(0,t.jsx)("thead",{children:(0,t.jsxs)("tr",{className:"border-b border-white/10",children:[(0,t.jsx)("th",{className:"text-left py-3 px-4 text-sm font-medium text-muted-foreground",children:"As of Date"}),(0,t.jsx)("th",{className:"text-right py-3 px-4 text-sm font-medium text-muted-foreground",children:"Total NAV"}),(0,t.jsx)("th",{className:"text-right py-3 px-4 text-sm font-medium text-muted-foreground",children:"NAV per Unit"}),(0,t.jsx)("th",{className:"text-right py-3 px-4 text-sm font-medium text-muted-foreground",children:"Actions"})]})}),(0,t.jsx)("tbody",{children:e2.map(e=>(0,t.jsxs)("tr",{className:"border-b border-white/5 hover:bg-white/5",children:[(0,t.jsx)("td",{className:"py-3 px-4 text-sm",children:new Date(e.as_of_date).toLocaleDateString()}),(0,t.jsx)("td",{className:"py-3 px-4 text-sm text-right font-mono",children:e.nav_total?`$${e.nav_total.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`:"-"}),(0,t.jsx)("td",{className:"py-3 px-4 text-sm text-right font-mono",children:e.nav_per_unit?`$${e.nav_per_unit.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:6})}`:"-"}),(0,t.jsx)("td",{className:"py-3 px-4 text-right",children:(0,t.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,t.jsx)(k.Button,{variant:"ghost",size:"sm",onClick:()=>e6(e),children:(0,t.jsx)(p.Edit,{className:"h-4 w-4"})}),(0,t.jsx)(k.Button,{variant:"ghost",size:"sm",onClick:()=>t0(e),children:(0,t.jsx)(_.Trash2,{className:"h-4 w-4"})})]})})]},e.id))})]})})})]})}),(0,t.jsx)(D.TabsContent,{value:"positions",className:"space-y-4",children:(0,t.jsxs)(S.Card,{className:"border border-white/10 bg-white/5",children:[(0,t.jsxs)(S.CardHeader,{className:"flex flex-row items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(S.CardTitle,{children:"Investor Positions"}),(0,t.jsx)(S.CardDescription,{children:"Unit balances and cost basis per investor for this vehicle"})]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(eH,{vehicleId:J.id,onImported:tZ}),(0,t.jsxs)(k.Button,{variant:"outline",size:"sm",onClick:()=>{ts(null),te(!0)},children:[(0,t.jsx)(c.Plus,{className:"h-4 w-4 mr-2"}),"Add Position"]})]})]}),(0,t.jsx)(S.CardContent,{children:0===e9.length?(0,t.jsxs)("div",{className:"text-center py-8",children:[(0,t.jsx)(u.ClipboardList,{className:"h-12 w-12 mx-auto text-muted-foreground mb-3"}),(0,t.jsx)("p",{className:"text-muted-foreground text-sm",children:"No position records yet. Import a CSV or add one manually."})]}):(0,t.jsx)("div",{className:"overflow-x-auto",children:(0,t.jsxs)("table",{className:"w-full",children:[(0,t.jsx)("thead",{children:(0,t.jsxs)("tr",{className:"border-b border-white/10",children:[(0,t.jsx)("th",{className:"text-left py-3 px-4 text-sm font-medium text-muted-foreground",children:"Investor"}),(0,t.jsx)("th",{className:"text-right py-3 px-4 text-sm font-medium text-muted-foreground",children:"Units"}),(0,t.jsx)("th",{className:"text-right py-3 px-4 text-sm font-medium text-muted-foreground",children:"Cost Basis"}),(0,t.jsx)("th",{className:"text-right py-3 px-4 text-sm font-medium text-muted-foreground",children:"Last NAV"}),(0,t.jsx)("th",{className:"text-left py-3 px-4 text-sm font-medium text-muted-foreground",children:"As of Date"}),(0,t.jsx)("th",{className:"text-right py-3 px-4 text-sm font-medium text-muted-foreground",children:"Actions"})]})}),(0,t.jsx)("tbody",{children:e9.map(e=>{let s=e.investor?.display_name||e.investor?.legal_name||e.investor?.email||e.investor_id;return(0,t.jsxs)("tr",{className:"border-b border-white/5 hover:bg-white/5",children:[(0,t.jsx)("td",{className:"py-3 px-4 text-sm",children:(0,t.jsxs)("div",{className:"flex flex-col",children:[(0,t.jsx)("span",{className:"text-foreground",children:s}),e.investor?.email&&(0,t.jsx)("span",{className:"text-xs text-muted-foreground",children:e.investor.email})]})}),(0,t.jsx)("td",{className:"py-3 px-4 text-sm text-right font-mono",children:null!=e.units?e.units.toLocaleString("en-US",{minimumFractionDigits:0,maximumFractionDigits:6}):"-"}),(0,t.jsx)("td",{className:"py-3 px-4 text-sm text-right font-mono",children:null!=e.cost_basis?`$${e.cost_basis.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`:"-"}),(0,t.jsx)("td",{className:"py-3 px-4 text-sm text-right font-mono",children:null!=e.last_nav?`$${e.last_nav.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:6})}`:"-"}),(0,t.jsx)("td",{className:"py-3 px-4 text-sm",children:e.as_of_date?new Date(e.as_of_date).toLocaleDateString():"-"}),(0,t.jsx)("td",{className:"py-3 px-4 text-right",children:(0,t.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,t.jsx)(k.Button,{variant:"ghost",size:"sm",onClick:()=>{ts(e),te(!0)},children:(0,t.jsx)(p.Edit,{className:"h-4 w-4"})}),(0,t.jsx)(k.Button,{variant:"ghost",size:"sm",onClick:()=>t1(e),children:(0,t.jsx)(_.Trash2,{className:"h-4 w-4"})})]})})]},e.id)})})]})})})]})})]}),(0,t.jsx)(Y,{entityId:J.id,open:eC,onClose:()=>{eF(!1),eD("create"),eT(null)},onSuccess:tH,mode:eS,existingDirector:ek||void 0}),(0,t.jsx)(ee,{entityId:J.id,open:eL,onClose:()=>{eE(!1),eA("create"),eB(null)},onSuccess:tH,mode:ez,existingStakeholder:e$||void 0}),(0,t.jsx)(ev,{entityId:J.id,open:tm,onClose:()=>tu(!1),onSuccess:e=>{t7(e),tQ()}}),(0,t.jsx)(ef,{entityId:J.id,open:ta,onClose:()=>tr(!1),onSuccess:t4}),(0,t.jsx)(eO,{vehicleId:J.id,open:tf,onClose:()=>tb(!1),onSuccess:()=>{tX(),W.toast.success("Valuation added successfully")}}),(0,t.jsx)(eR,{vehicleId:J.id,valuation:e3,open:!!e3,onClose:()=>e6(null),onSuccess:()=>{tX(),W.toast.success("Valuation updated successfully")}}),(0,t.jsx)(eq,{vehicleId:J.id,position:tt,open:e8,onClose:()=>{te(!1),ts(null)},onSuccess:()=>{tZ(),W.toast.success(tt?"Position updated successfully":"Position added successfully")}}),(0,t.jsx)(em,{entity:J,open:eU,onClose:()=>eK(!1),onSuccess:e=>{G(e),eK(!1)}}),(0,t.jsx)(es.DocumentViewerFullscreen,{isOpen:tj.isOpen,document:tj.document,previewUrl:tj.previewUrl,isLoading:tj.isLoading,error:tj.error,onClose:tj.closePreview,onDownload:tj.downloadDocument}),tT&&(0,t.jsx)(eP,{open:tF,onClose:()=>{tS(!1),tI(null),tE(null)},entityId:J.id,investorId:tT,defaultValues:tL,onSuccess:e=>{e4(t=>t.map(t=>t.id===tT?e:t)),tS(!1),tI(null),tE(null)}}),(0,t.jsx)(eu,{open:eZ,onClose:()=>e0(!1),entityId:J.id,entityName:J.name}),tv&&(0,t.jsx)(eh,{open:tw,onClose:()=>{ty(!1),tN(null)},document:tv,onSuccess:()=>{tq(),ty(!1),tN(null)}}),(0,t.jsx)(tR,{})]})}e.s(["EntityDetailEnhanced",()=>eZ],167795)}]);