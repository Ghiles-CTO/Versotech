(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,489464,e=>{"use strict";var a=e.i(722679),t=e.i(340915),s=e.i(603274),r=e.i(129432),l=e.i(429760),n=e.i(971743),i=e.i(501259),d=e.i(335994),c=e.i(595870),o=e.i(528679),m=e.i(90613),x=e.i(316264),u=e.i(191569),h=e.i(538892),j=e.i(237635),g=e.i(196767),p=e.i(119311),b=e.i(750809),v=e.i(15098),f=e.i(733179),N=e.i(401148),_=e.i(561866),y=e.i(263229),C=e.i(384581),T=e.i(282141),w=e.i(501495),S=e.i(59178);let H={committed:"bg-blue-100 text-blue-800 border-blue-200",partially_funded:"bg-amber-100 text-amber-800 border-amber-200",funded:"bg-emerald-100 text-emerald-800 border-emerald-200",active:"bg-green-100 text-green-800 border-green-200"},k={committed:"Awaiting Funding",partially_funded:"Partial",funded:"Fully Funded",active:"Active"},D={accrued:"bg-blue-100 text-blue-800 border-blue-200 dark:bg-blue-900/30 dark:text-blue-300 dark:border-blue-700",invoiced:"bg-amber-100 text-amber-800 border-amber-200 dark:bg-amber-900/30 dark:text-amber-300 dark:border-amber-700",paid:"bg-emerald-100 text-emerald-800 border-emerald-200 dark:bg-emerald-900/30 dark:text-emerald-300 dark:border-emerald-700",waived:"bg-gray-100 text-gray-800 border-gray-200 dark:bg-gray-800/50 dark:text-gray-300 dark:border-gray-700",cancelled:"bg-gray-100 text-gray-800 border-gray-200 dark:bg-gray-800/50 dark:text-gray-300 dark:border-gray-700",disputed:"bg-red-100 text-red-800 border-red-200 dark:bg-red-900/30 dark:text-red-300 dark:border-red-700"},F={mgmt:"Management Fee",perf:"Performance Fee",carry:"Carried Interest",upfront:"Upfront Fee",placement:"Placement Fee",transaction:"Transaction Fee",admin:"Admin Fee"};function I({deals:e}){let[s,i]=(0,t.useState)(!0),[d,c]=(0,t.useState)(null),[o,I]=(0,t.useState)([]),[R,L]=(0,t.useState)([]),[B,P]=(0,t.useState)(""),[A,E]=(0,t.useState)("all"),[U,$]=(0,t.useState)("subscriptions");(0,t.useEffect)(()=>{!async function(){if(0===e.length)return i(!1);try{i(!0),c(null);let a=(0,S.createClient)(),t=e.map(e=>e.id),{data:s,error:r}=await a.from("subscriptions").select(`
            id,
            deal_id,
            investor_id,
            status,
            commitment,
            currency,
            funded_amount,
            outstanding_amount,
            committed_at,
            funded_at,
            investors (id, legal_name, display_name)
          `).in("deal_id",t).in("status",["committed","partially_funded","funded","active"]).order("committed_at",{ascending:!1});if(r)throw r;let{data:l,error:n}=await a.from("fee_events").select(`
            id,
            deal_id,
            investor_id,
            fee_type,
            rate_bps,
            base_amount,
            computed_amount,
            currency,
            status,
            processed_at,
            event_date,
            created_at,
            invoice_id,
            investors (id, legal_name, display_name),
            invoices:invoice_id (invoice_number, status)
          `).in("deal_id",t).order("created_at",{ascending:!1});if(n)throw n;let d=(s||[]).map(a=>{let t=Array.isArray(a.investors)?a.investors[0]:a.investors,s=e.find(e=>e.id===a.deal_id);return{id:a.id,deal_id:a.deal_id,deal_name:s?.name||"Unknown Deal",investor_id:a.investor_id,investor_name:t?.display_name||t?.legal_name||"Unknown Investor",status:a.status,commitment:a.commitment||0,currency:a.currency||"USD",funded_amount:a.funded_amount||0,outstanding_amount:a.outstanding_amount||0,committed_at:a.committed_at,funded_at:a.funded_at}}),o=(l||[]).map(a=>{let t=Array.isArray(a.investors)?a.investors[0]:a.investors,s=Array.isArray(a.invoices)?a.invoices[0]:a.invoices,r=e.find(e=>e.id===a.deal_id);return{id:a.id,deal_id:a.deal_id,deal_name:r?.name||"Unknown Deal",investor_id:a.investor_id,investor_name:t?.display_name||t?.legal_name||"Unknown Investor",fee_type:a.fee_type,rate_bps:a.rate_bps,base_amount:a.base_amount,computed_amount:a.computed_amount,currency:a.currency||"USD",status:a.status,processed_at:a.processed_at,event_date:a.event_date,created_at:a.created_at,invoice_number:s?.invoice_number||null,invoice_status:s?.status||null}});I(d),L(o)}catch(e){console.error("[OverviewTab] Error fetching data:",e),c(e instanceof Error?e.message:"Failed to load data")}finally{i(!1)}}()},[e]);let M=(0,t.useMemo)(()=>{let a=o.reduce((e,a)=>e+a.commitment,0),t=o.reduce((e,a)=>e+a.funded_amount,0),s=o.reduce((e,a)=>e+a.outstanding_amount,0),r=o.filter(e=>"committed"===e.status).length,l=o.filter(e=>"partially_funded"===e.status).length,n=o.filter(e=>"funded"===e.status||"active"===e.status).length,i=R.reduce((e,a)=>e+(a.computed_amount||0),0),d=R.filter(e=>"paid"===e.status),c=d.reduce((e,a)=>e+(a.computed_amount||0),0),m=R.filter(e=>"accrued"===e.status||"invoiced"===e.status),x=m.reduce((e,a)=>e+(a.computed_amount||0),0);return{totalDeals:e.length,totalSubscriptions:o.length,totalCommitment:a,totalFunded:t,totalOutstanding:s,awaitingFunding:r,partiallyFunded:l,fullyFunded:n,totalFeeEvents:R.length,totalFeesAccrued:i,totalFeesPaid:c,totalFeesPending:x,feesPaidCount:d.length,feesPendingCount:m.length}},[e,o,R]),z=(0,t.useMemo)(()=>o.filter(e=>{let a="all"===A||e.deal_id===A,t=!B||e.investor_name.toLowerCase().includes(B.toLowerCase())||e.deal_name.toLowerCase().includes(B.toLowerCase());return a&&t}),[o,A,B]),V=(0,t.useMemo)(()=>R.filter(e=>{let a="all"===A||e.deal_id===A,t=!B||e.investor_name.toLowerCase().includes(B.toLowerCase())||e.deal_name.toLowerCase().includes(B.toLowerCase());return a&&t}),[R,A,B]),q=(0,t.useMemo)(()=>e.map(e=>{let a=o.filter(a=>a.deal_id===e.id),t=R.filter(a=>a.deal_id===e.id),s=a.reduce((e,a)=>e+a.commitment,0),r=a.reduce((e,a)=>e+a.funded_amount,0),l=t.reduce((e,a)=>e+(a.computed_amount||0),0),n=t.filter(e=>"paid"===e.status).reduce((e,a)=>e+(a.computed_amount||0),0);return{...e,subscription_count:a.length,total_commitment:s,total_funded:r,funding_percentage:s>0?Math.round(r/s*100):0,total_fees:l,paid_fees:n,fee_count:t.length}}),[e,o,R]);return s?(0,a.jsxs)("div",{className:"flex items-center justify-center py-16",children:[(0,a.jsx)(y.Loader2,{className:"h-8 w-8 animate-spin text-muted-foreground"}),(0,a.jsx)("span",{className:"ml-3 text-muted-foreground",children:"Loading overview data..."})]}):d?(0,a.jsx)(m.Card,{className:"border-destructive",children:(0,a.jsx)(m.CardContent,{className:"py-8",children:(0,a.jsxs)("div",{className:"flex flex-col items-center gap-4",children:[(0,a.jsx)(N.AlertCircle,{className:"h-12 w-12 text-destructive"}),(0,a.jsx)("p",{className:"text-destructive",children:d}),(0,a.jsxs)(x.Button,{variant:"outline",onClick:()=>window.location.reload(),children:[(0,a.jsx)(C.RefreshCcw,{className:"h-4 w-4 mr-2"}),"Retry"]})]})})}):(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,a.jsxs)(m.Card,{children:[(0,a.jsx)(m.CardHeader,{className:"pb-2",children:(0,a.jsxs)(m.CardTitle,{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[(0,a.jsx)(n.Building2,{className:"h-4 w-4"}),"Managed Deals"]})}),(0,a.jsxs)(m.CardContent,{children:[(0,a.jsx)("div",{className:"text-2xl font-bold",children:M.totalDeals}),(0,a.jsxs)("p",{className:"text-xs text-muted-foreground mt-1",children:[M.totalSubscriptions," subscriptions"]})]})]}),(0,a.jsxs)(m.Card,{children:[(0,a.jsx)(m.CardHeader,{className:"pb-2",children:(0,a.jsxs)(m.CardTitle,{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[(0,a.jsx)(g.DollarSign,{className:"h-4 w-4"}),"Total Commitment"]})}),(0,a.jsxs)(m.CardContent,{children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-primary",children:(0,w.formatCurrency)(M.totalCommitment,"USD")}),(0,a.jsxs)("p",{className:"text-xs text-muted-foreground mt-1",children:[(0,w.formatCurrency)(M.totalFunded,"USD")," funded"]})]})]}),(0,a.jsxs)(m.Card,{children:[(0,a.jsx)(m.CardHeader,{className:"pb-2",children:(0,a.jsxs)(m.CardTitle,{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[(0,a.jsx)(v.CheckCircle2,{className:"h-4 w-4"}),"Funding Status"]})}),(0,a.jsxs)(m.CardContent,{children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-emerald-600",children:M.fullyFunded}),(0,a.jsxs)("p",{className:"text-xs text-muted-foreground mt-1",children:[M.awaitingFunding," awaiting • ",M.partiallyFunded," partial • ",M.fullyFunded," fully funded"]})]})]}),(0,a.jsxs)(m.Card,{children:[(0,a.jsx)(m.CardHeader,{className:"pb-2",children:(0,a.jsxs)(m.CardTitle,{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[(0,a.jsx)(_.CreditCard,{className:"h-4 w-4"}),"Fee Events"]})}),(0,a.jsxs)(m.CardContent,{children:[(0,a.jsx)("div",{className:"text-2xl font-bold",children:M.totalFeeEvents}),(0,a.jsxs)("p",{className:"text-xs text-muted-foreground mt-1",children:[(0,w.formatCurrency)(M.totalFeesPaid,"USD")," paid"]})]})]})]}),(0,a.jsx)(m.Card,{children:(0,a.jsx)(m.CardContent,{className:"pt-4",children:(0,a.jsxs)("div",{className:"flex flex-col md:flex-row gap-4",children:[(0,a.jsxs)("div",{className:"relative flex-1",children:[(0,a.jsx)(b.Search,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),(0,a.jsx)(u.Input,{placeholder:"Search investors or deals...",value:B,onChange:e=>P(e.target.value),className:"pl-10"})]}),(0,a.jsxs)(h.Select,{value:A,onValueChange:E,children:[(0,a.jsx)(h.SelectTrigger,{className:"w-full md:w-[250px]",children:(0,a.jsx)(h.SelectValue,{placeholder:"All Deals"})}),(0,a.jsxs)(h.SelectContent,{children:[(0,a.jsx)(h.SelectItem,{value:"all",children:"All Deals"}),e.map(e=>(0,a.jsx)(h.SelectItem,{value:e.id,children:e.name},e.id))]})]})]})})}),(0,a.jsxs)(l.Tabs,{value:U,onValueChange:$,children:[(0,a.jsxs)(l.TabsList,{children:[(0,a.jsxs)(l.TabsTrigger,{value:"subscriptions",className:"flex items-center gap-2",children:[(0,a.jsx)(p.FileText,{className:"h-4 w-4"}),"Subscriptions (",z.length,")"]}),(0,a.jsxs)(l.TabsTrigger,{value:"fees",className:"flex items-center gap-2",children:[(0,a.jsx)(g.DollarSign,{className:"h-4 w-4"}),"Fee Events (",V.length,")"]}),(0,a.jsxs)(l.TabsTrigger,{value:"summary",className:"flex items-center gap-2",children:[(0,a.jsx)(f.TrendingUp,{className:"h-4 w-4"}),"Deal Summary"]})]}),(0,a.jsx)(l.TabsContent,{value:"subscriptions",children:(0,a.jsxs)(m.Card,{children:[(0,a.jsxs)(m.CardHeader,{className:"pb-4",children:[(0,a.jsx)(m.CardTitle,{className:"text-lg",children:"Subscriptions"}),(0,a.jsxs)(m.CardDescription,{children:[z.length," active subscriptions"]})]}),(0,a.jsx)(m.CardContent,{children:(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)(j.Table,{children:[(0,a.jsx)(j.TableHeader,{children:(0,a.jsxs)(j.TableRow,{children:[(0,a.jsx)(j.TableHead,{children:"Investor"}),(0,a.jsx)(j.TableHead,{children:"Deal"}),(0,a.jsx)(j.TableHead,{className:"text-right",children:"Commitment"}),(0,a.jsx)(j.TableHead,{className:"text-right",children:"Funded"}),(0,a.jsx)(j.TableHead,{className:"text-right",children:"Outstanding"}),(0,a.jsx)(j.TableHead,{children:"Status"}),(0,a.jsx)(j.TableHead,{children:"Funded Date"})]})}),(0,a.jsx)(j.TableBody,{children:0===z.length?(0,a.jsx)(j.TableRow,{children:(0,a.jsx)(j.TableCell,{colSpan:7,className:"text-center py-8 text-muted-foreground",children:"No subscriptions found"})}):z.map(e=>(0,a.jsxs)(j.TableRow,{children:[(0,a.jsx)(j.TableCell,{className:"font-medium",children:e.investor_name}),(0,a.jsx)(j.TableCell,{children:e.deal_name}),(0,a.jsx)(j.TableCell,{className:"text-right",children:(0,w.formatCurrency)(e.commitment,e.currency)}),(0,a.jsx)(j.TableCell,{className:"text-right",children:(0,w.formatCurrency)(e.funded_amount,e.currency)}),(0,a.jsx)(j.TableCell,{className:"text-right",children:(0,w.formatCurrency)(e.outstanding_amount,e.currency)}),(0,a.jsx)(j.TableCell,{children:(0,a.jsx)(r.Badge,{variant:"outline",className:(0,T.cn)("text-xs",H[e.status]),children:k[e.status]||e.status})}),(0,a.jsx)(j.TableCell,{children:e.funded_at?(0,a.jsx)("span",{className:"text-sm",children:(0,w.formatDate)(e.funded_at)}):(0,a.jsx)("span",{className:"text-muted-foreground text-xs",children:"Pending"})})]},e.id))})]})})})]})}),(0,a.jsx)(l.TabsContent,{value:"fees",children:(0,a.jsxs)(m.Card,{children:[(0,a.jsxs)(m.CardHeader,{className:"pb-4",children:[(0,a.jsx)(m.CardTitle,{className:"text-lg",children:"Fee Events"}),(0,a.jsxs)(m.CardDescription,{children:[V.length," fee events"]})]}),(0,a.jsx)(m.CardContent,{children:(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)(j.Table,{children:[(0,a.jsx)(j.TableHeader,{children:(0,a.jsxs)(j.TableRow,{children:[(0,a.jsx)(j.TableHead,{children:"Deal"}),(0,a.jsx)(j.TableHead,{children:"Investor"}),(0,a.jsx)(j.TableHead,{children:"Fee Type"}),(0,a.jsx)(j.TableHead,{className:"text-right",children:"Amount"}),(0,a.jsx)(j.TableHead,{children:"Invoice"}),(0,a.jsx)(j.TableHead,{children:"Status"}),(0,a.jsx)(j.TableHead,{children:"Event Date"})]})}),(0,a.jsx)(j.TableBody,{children:0===V.length?(0,a.jsx)(j.TableRow,{children:(0,a.jsx)(j.TableCell,{colSpan:7,className:"text-center py-8 text-muted-foreground",children:"No fee events found"})}):V.map(e=>(0,a.jsxs)(j.TableRow,{children:[(0,a.jsx)(j.TableCell,{className:"font-medium",children:e.deal_name}),(0,a.jsx)(j.TableCell,{children:e.investor_name}),(0,a.jsx)(j.TableCell,{children:(0,a.jsx)(r.Badge,{variant:"outline",children:F[e.fee_type||""]||e.fee_type||"Unknown"})}),(0,a.jsx)(j.TableCell,{className:"text-right font-medium",children:(0,w.formatCurrency)(e.computed_amount||0,e.currency)}),(0,a.jsx)(j.TableCell,{children:e.invoice_number?(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-sm font-medium",children:e.invoice_number}),e.invoice_status&&(0,a.jsx)("div",{className:"text-xs text-muted-foreground capitalize",children:e.invoice_status.replace("_"," ")})]}):(0,a.jsx)("span",{className:"text-muted-foreground text-xs",children:"Not issued"})}),(0,a.jsx)(j.TableCell,{children:(0,a.jsx)(r.Badge,{variant:"outline",className:(0,T.cn)("text-xs capitalize",D[e.status]),children:e.status})}),(0,a.jsx)(j.TableCell,{children:e.event_date?(0,a.jsx)("span",{className:"text-sm",children:(0,w.formatDate)(e.event_date)}):(0,a.jsx)("span",{className:"text-muted-foreground text-xs",children:"-"})})]},e.id))})]})})})]})}),(0,a.jsx)(l.TabsContent,{value:"summary",children:(0,a.jsxs)(m.Card,{children:[(0,a.jsxs)(m.CardHeader,{className:"pb-4",children:[(0,a.jsx)(m.CardTitle,{className:"text-lg",children:"Deal Summary"}),(0,a.jsx)(m.CardDescription,{children:"Aggregated metrics by deal"})]}),(0,a.jsx)(m.CardContent,{children:(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)(j.Table,{children:[(0,a.jsx)(j.TableHeader,{children:(0,a.jsxs)(j.TableRow,{children:[(0,a.jsx)(j.TableHead,{children:"Deal"}),(0,a.jsx)(j.TableHead,{children:"Company"}),(0,a.jsx)(j.TableHead,{className:"text-right",children:"Subscriptions"}),(0,a.jsx)(j.TableHead,{className:"text-right",children:"Commitment"}),(0,a.jsx)(j.TableHead,{className:"text-right",children:"Funded"}),(0,a.jsx)(j.TableHead,{className:"text-right",children:"Funding %"}),(0,a.jsx)(j.TableHead,{className:"text-right",children:"Total Fees"})]})}),(0,a.jsx)(j.TableBody,{children:0===q.length?(0,a.jsx)(j.TableRow,{children:(0,a.jsx)(j.TableCell,{colSpan:7,className:"text-center py-8 text-muted-foreground",children:"No deals found"})}):q.map(e=>(0,a.jsxs)(j.TableRow,{children:[(0,a.jsx)(j.TableCell,{className:"font-medium",children:e.name}),(0,a.jsx)(j.TableCell,{children:e.company_name||"-"}),(0,a.jsx)(j.TableCell,{className:"text-right",children:e.subscription_count}),(0,a.jsx)(j.TableCell,{className:"text-right",children:(0,w.formatCurrency)(e.total_commitment,e.currency)}),(0,a.jsx)(j.TableCell,{className:"text-right",children:(0,w.formatCurrency)(e.total_funded,e.currency)}),(0,a.jsx)(j.TableCell,{className:"text-right",children:(0,a.jsxs)(r.Badge,{variant:"outline",className:(0,T.cn)("text-xs",e.funding_percentage>=100?"bg-emerald-100 text-emerald-800":e.funding_percentage>=50?"bg-amber-100 text-amber-800":"bg-gray-100 text-gray-800"),children:[e.funding_percentage,"%"]})}),(0,a.jsx)(j.TableCell,{className:"text-right",children:(0,w.formatCurrency)(e.total_fees,e.currency)})]},e.id))})]})})})]})})]})]})}var R=e.i(514133),L=e.i(761722),B=e.i(382021),P=e.i(758171),A=e.i(197098),E=e.i(773510),U=e.i(80465),$=e.i(595103),M=e.i(994500);let z={introducer:"introducer",partner:"partner",commercial_partner:"commercial-partner"},V={accrued:"bg-blue-100 text-blue-800",invoice_requested:"bg-yellow-100 text-yellow-800",invoice_submitted:"bg-indigo-100 text-indigo-800",invoiced:"bg-orange-100 text-orange-800",paid:"bg-green-100 text-green-800",cancelled:"bg-red-100 text-red-800",rejected:"bg-red-100 text-red-800"},q="__all__";function O({type:e,entities:s,deals:l,apiEndpoint:n,entityLabel:i,entityPlural:d}){let[c,o]=(0,t.useState)(!1),[g,p]=(0,t.useState)(!1),[b,v]=(0,t.useState)(null),[f,_]=(0,t.useState)([]),[S,H]=(0,t.useState)(null),[k,D]=(0,t.useState)(0),[F,I]=(0,t.useState)(""),[O,K]=(0,t.useState)(""),[J,G]=(0,t.useState)(""),[Q,W]=(0,t.useState)(""),[X,Y]=(0,t.useState)(""),[Z,ee]=(0,t.useState)(1),ea=Math.ceil(k/50),et=[F,O,J,Q,X].filter(Boolean).length,[es,er]=(0,t.useState)(!1),[el,en]=(0,t.useState)(null),[ei,ed]=(0,t.useState)(null),ec=(0,t.useCallback)(async(a=!1)=>{o(!0),v(null),a&&ee(1);try{let t=new URLSearchParams;F&&t.append("from_date",F),O&&t.append("to_date",O),J&&t.append("introducer"===e?"introducer_id":"partner"===e?"partner_id":"commercial_partner_id",J),Q&&t.append("deal_id",Q),X&&t.append("status",X),t.append("limit",String(50)),t.append("offset",String((a?0:Z-1)*50));let s=await fetch(`${n}?${t.toString()}`);if(!s.ok){let e=await s.json();throw Error(e.error||"Failed to fetch report")}let r=await s.json(),l=(r.data||[]).map(a=>({...a,entity_id:a[`${e}_id`]||a.entity_id,entity_name:a[`${e}_name`]||a.entity_name||a.introducer_name||a.partner_name||a.commercial_partner_name,entity_email:a[`${e}_email`]||a.entity_email||a.introducer_email||a.partner_email||a.commercial_partner_email}));_(l),H(r.summary||null),D(r.pagination?.total||r.data?.length||0)}catch(a){console.error(`[CommissionTab:${e}] Error:`,a),v(a instanceof Error?a.message:"Failed to fetch report")}finally{o(!1)}},[n,e,F,O,J,Q,X,Z]),eo=async()=>{p(!0);try{let a=new URLSearchParams;F&&a.append("from_date",F),O&&a.append("to_date",O),J&&a.append("introducer"===e?"introducer_id":"partner"===e?"partner_id":"commercial_partner_id",J),Q&&a.append("deal_id",Q),X&&a.append("status",X),a.append("format","csv");let t=document.createElement("a");t.href=`${n}?${a.toString()}`,t.download=`${e}_reconciliation_${new Date().toISOString().split("T")[0]}.csv`,document.body.appendChild(t),t.click(),document.body.removeChild(t)}finally{setTimeout(()=>p(!1),1e3)}},em=()=>{I(""),K(""),G(""),W(""),Y(""),ee(1)},ex=async a=>{if(!ei){ed(a.id);try{let t=await fetch(`/api/staff/fees/commissions/${a.id}/mark-paid`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({entity_type:e})});if(!t.ok){let e=await t.json();throw Error(e.error||"Failed to mark commission as paid")}M.toast.success("Commission marked as paid"),ec(!1)}catch(e){console.error("[CommissionTab] Error marking paid:",e),M.toast.error(e instanceof Error?e.message:"Failed to mark commission as paid")}finally{ed(null)}}},eu=!F||!O||new Date(F)<=new Date(O);return(0,t.useEffect)(()=>{ec(!0)},[]),(0,t.useEffect)(()=>{Z>1&&ec(!1)},[Z]),(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)(m.Card,{children:[(0,a.jsx)(m.CardHeader,{className:"pb-4",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)(m.CardTitle,{className:"text-lg flex items-center gap-2",children:[(0,a.jsx)(B.Filter,{className:"h-5 w-5"}),"Filters"]}),et>0&&(0,a.jsxs)(r.Badge,{variant:"secondary",className:"text-xs",children:[et," active"]})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(x.Button,{variant:"outline",size:"sm",onClick:em,disabled:0===et,children:"Clear"}),(0,a.jsxs)(x.Button,{size:"sm",onClick:()=>ec(!0),disabled:c||!eu,children:[c?(0,a.jsx)(y.Loader2,{className:"h-4 w-4 animate-spin"}):(0,a.jsx)(C.RefreshCcw,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"ml-2",children:"Apply"})]})]})]})}),(0,a.jsx)(m.CardContent,{children:(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(R.Label,{children:"From Date"}),(0,a.jsx)(u.Input,{type:"date",value:F,onChange:e=>I(e.target.value),max:O||void 0})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(R.Label,{children:"To Date"}),(0,a.jsx)(u.Input,{type:"date",value:O,onChange:e=>K(e.target.value),min:F||void 0}),!eu&&(0,a.jsx)("p",{className:"text-xs text-destructive",children:"End date must be after start date"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(R.Label,{children:i}),(0,a.jsxs)(h.Select,{value:J||q,onValueChange:e=>G(e===q?"":e),children:[(0,a.jsx)(h.SelectTrigger,{children:(0,a.jsx)(h.SelectValue,{placeholder:`All ${d.toLowerCase()}`})}),(0,a.jsxs)(h.SelectContent,{children:[(0,a.jsxs)(h.SelectItem,{value:q,children:["All ",d.toLowerCase()]}),s.map(e=>(0,a.jsx)(h.SelectItem,{value:e.id,children:e.name},e.id))]})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(R.Label,{children:"Deal"}),(0,a.jsxs)(h.Select,{value:Q||q,onValueChange:e=>W(e===q?"":e),children:[(0,a.jsx)(h.SelectTrigger,{children:(0,a.jsx)(h.SelectValue,{placeholder:"All deals"})}),(0,a.jsxs)(h.SelectContent,{children:[(0,a.jsx)(h.SelectItem,{value:q,children:"All deals"}),l.map(e=>(0,a.jsx)(h.SelectItem,{value:e.id,children:e.name},e.id))]})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(R.Label,{children:"Status"}),(0,a.jsxs)(h.Select,{value:X||q,onValueChange:e=>Y(e===q?"":e),children:[(0,a.jsx)(h.SelectTrigger,{children:(0,a.jsx)(h.SelectValue,{placeholder:"All statuses"})}),(0,a.jsxs)(h.SelectContent,{children:[(0,a.jsx)(h.SelectItem,{value:q,children:"All statuses"}),(0,a.jsx)(h.SelectItem,{value:"accrued",children:"Accrued"}),(0,a.jsx)(h.SelectItem,{value:"invoice_requested",children:"Invoice Requested"}),(0,a.jsx)(h.SelectItem,{value:"invoice_submitted",children:"Invoice Submitted"}),(0,a.jsx)(h.SelectItem,{value:"invoiced",children:"Invoiced"}),(0,a.jsx)(h.SelectItem,{value:"paid",children:"Paid"}),(0,a.jsx)(h.SelectItem,{value:"cancelled",children:"Cancelled"}),(0,a.jsx)(h.SelectItem,{value:"rejected",children:"Rejected"})]})]})]})]})})]}),S&&(0,a.jsxs)(m.Card,{children:[(0,a.jsx)(m.CardHeader,{className:"pb-4",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)(m.CardTitle,{className:"text-lg",children:"Summary"}),(0,a.jsxs)(x.Button,{variant:"outline",size:"sm",onClick:eo,disabled:g||0===f.length,children:[g?(0,a.jsx)(y.Loader2,{className:"h-4 w-4 mr-2 animate-spin"}):(0,a.jsx)(L.Download,{className:"h-4 w-4 mr-2"}),"Export CSV"]})]})}),(0,a.jsx)(m.CardContent,{children:(0,a.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-9 gap-4",children:[(0,a.jsxs)("div",{className:"text-center p-3 rounded-lg bg-muted/50",children:[(0,a.jsx)("div",{className:"text-2xl font-bold",children:S.total_count}),(0,a.jsx)("div",{className:"text-xs text-muted-foreground",children:"Total Records"})]}),(0,a.jsxs)("div",{className:"text-center p-3 rounded-lg bg-muted/50",children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-primary",children:(0,w.formatCurrency)(S.total_amount,S.currency)}),(0,a.jsx)("div",{className:"text-xs text-muted-foreground",children:"Total Amount"})]}),(0,a.jsxs)("div",{className:"text-center p-3 rounded-lg bg-blue-50",children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-blue-600",children:(0,w.formatCurrency)(S.by_status.accrued.amount,S.currency)}),(0,a.jsxs)("div",{className:"text-xs text-muted-foreground",children:["Accrued (",S.by_status.accrued.count,")"]})]}),(0,a.jsxs)("div",{className:"text-center p-3 rounded-lg bg-yellow-50",children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-yellow-600",children:(0,w.formatCurrency)(S.by_status.invoice_requested.amount,S.currency)}),(0,a.jsxs)("div",{className:"text-xs text-muted-foreground",children:["Invoice Req. (",S.by_status.invoice_requested.count,")"]})]}),(0,a.jsxs)("div",{className:"text-center p-3 rounded-lg bg-indigo-50",children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-indigo-600",children:(0,w.formatCurrency)(S.by_status.invoice_submitted.amount,S.currency)}),(0,a.jsxs)("div",{className:"text-xs text-muted-foreground",children:["Invoice Submitted (",S.by_status.invoice_submitted.count,")"]})]}),(0,a.jsxs)("div",{className:"text-center p-3 rounded-lg bg-orange-50",children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-orange-600",children:(0,w.formatCurrency)(S.by_status.invoiced.amount,S.currency)}),(0,a.jsxs)("div",{className:"text-xs text-muted-foreground",children:["Invoiced (",S.by_status.invoiced.count,")"]})]}),(0,a.jsxs)("div",{className:"text-center p-3 rounded-lg bg-green-50",children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-green-600",children:(0,w.formatCurrency)(S.by_status.paid.amount,S.currency)}),(0,a.jsxs)("div",{className:"text-xs text-muted-foreground",children:["Paid (",S.by_status.paid.count,")"]})]}),(0,a.jsxs)("div",{className:"text-center p-3 rounded-lg bg-red-50",children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-red-600",children:(0,w.formatCurrency)(S.by_status.cancelled.amount,S.currency)}),(0,a.jsxs)("div",{className:"text-xs text-muted-foreground",children:["Cancelled (",S.by_status.cancelled.count,")"]})]}),(0,a.jsxs)("div",{className:"text-center p-3 rounded-lg bg-rose-50",children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-rose-600",children:(0,w.formatCurrency)(S.by_status.rejected.amount,S.currency)}),(0,a.jsxs)("div",{className:"text-xs text-muted-foreground",children:["Rejected (",S.by_status.rejected.count,")"]})]})]})})]}),b&&(0,a.jsx)(m.Card,{className:"border-destructive",children:(0,a.jsx)(m.CardContent,{className:"py-6",children:(0,a.jsxs)("div",{className:"flex flex-col items-center gap-4",children:[(0,a.jsx)(N.AlertCircle,{className:"h-12 w-12 text-destructive"}),(0,a.jsx)("p",{className:"text-destructive text-sm",children:b}),(0,a.jsxs)(x.Button,{variant:"outline",onClick:()=>ec(!0),children:[(0,a.jsx)(C.RefreshCcw,{className:"h-4 w-4 mr-2"}),"Retry"]})]})})}),(0,a.jsxs)(m.Card,{children:[(0,a.jsx)(m.CardHeader,{className:"pb-4",children:(0,a.jsx)("div",{className:"flex items-center justify-between",children:(0,a.jsxs)("div",{children:[(0,a.jsx)(m.CardTitle,{className:"text-lg",children:"Commission Details"}),(0,a.jsxs)(m.CardDescription,{children:[f.length," of ",k," records",ea>1&&` (Page ${Z} of ${ea})`]})]})})}),(0,a.jsx)(m.CardContent,{children:c?(0,a.jsx)("div",{className:"flex items-center justify-center py-8",children:(0,a.jsx)(y.Loader2,{className:"h-8 w-8 animate-spin text-muted-foreground"})}):0===f.length?(0,a.jsxs)("div",{className:"text-center py-8",children:[(0,a.jsx)("div",{className:"text-muted-foreground mb-2",children:et>0?"No commissions match your filters. Try adjusting or clearing filters.":`No ${d.toLowerCase()} commissions found yet.`}),et>0&&(0,a.jsx)(x.Button,{variant:"outline",size:"sm",onClick:em,children:"Clear Filters"})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)(j.Table,{children:[(0,a.jsx)(j.TableHeader,{children:(0,a.jsxs)(j.TableRow,{children:[(0,a.jsx)(j.TableHead,{children:"Status"}),(0,a.jsx)(j.TableHead,{children:i}),(0,a.jsx)(j.TableHead,{children:"Deal"}),(0,a.jsx)(j.TableHead,{children:"Investor"}),(0,a.jsx)(j.TableHead,{children:"Basis"}),(0,a.jsx)(j.TableHead,{className:"text-right",children:"Rate (%)"}),(0,a.jsx)(j.TableHead,{className:"text-right",children:"Amount"}),(0,a.jsx)(j.TableHead,{children:"Due Date"}),(0,a.jsx)(j.TableHead,{children:"Paid At"}),(0,a.jsx)(j.TableHead,{children:"Created"}),(0,a.jsx)(j.TableHead,{className:"text-right",children:"Actions"})]})}),(0,a.jsx)(j.TableBody,{children:f.map(e=>(0,a.jsxs)(j.TableRow,{children:[(0,a.jsx)(j.TableCell,{children:(0,a.jsx)(r.Badge,{variant:"secondary",className:(0,T.cn)("text-xs capitalize",V[e.status]),children:e.status.replace("_"," ")})}),(0,a.jsx)(j.TableCell,{children:(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-medium text-sm",children:e.entity_name}),e.entity_email&&(0,a.jsx)("div",{className:"text-xs text-muted-foreground",children:e.entity_email})]})}),(0,a.jsx)(j.TableCell,{children:(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-medium text-sm",children:e.deal_name||"-"}),e.deal_company&&(0,a.jsx)("div",{className:"text-xs text-muted-foreground",children:e.deal_company})]})}),(0,a.jsx)(j.TableCell,{className:"text-sm",children:e.investor_name||"-"}),(0,a.jsx)(j.TableCell,{className:"capitalize text-sm",children:e.basis_type?.replace("_"," ")||"-"}),(0,a.jsxs)(j.TableCell,{className:"text-right text-sm",children:[(e.rate_bps/100).toFixed(2),"%"]}),(0,a.jsx)(j.TableCell,{className:"text-right font-medium",children:(0,w.formatCurrency)(e.accrual_amount,e.currency)}),(0,a.jsx)(j.TableCell,{className:"text-sm",children:e.payment_due_date?(0,w.formatDate)(e.payment_due_date):"-"}),(0,a.jsx)(j.TableCell,{className:"text-sm",children:e.paid_at?(0,w.formatDate)(e.paid_at):"-"}),(0,a.jsx)(j.TableCell,{className:"text-sm text-muted-foreground",children:(0,w.formatDate)(e.created_at)}),(0,a.jsx)(j.TableCell,{className:"text-right",children:(0,a.jsxs)("div",{className:"flex items-center justify-end gap-1",children:["accrued"===e.status&&(0,a.jsx)(x.Button,{variant:"ghost",size:"sm",onClick:()=>{en(e),er(!0)},title:"Request Invoice",className:"h-8 w-8 p-0 text-blue-500 hover:text-blue-600 hover:bg-blue-50",children:(0,a.jsx)(E.Mail,{className:"h-4 w-4"})}),"invoiced"===e.status&&(0,a.jsx)(x.Button,{variant:"ghost",size:"sm",onClick:()=>ex(e),disabled:ei===e.id,title:"Mark as Paid",className:"h-8 w-8 p-0 text-green-500 hover:text-green-600 hover:bg-green-50",children:ei===e.id?(0,a.jsx)(y.Loader2,{className:"h-4 w-4 animate-spin"}):(0,a.jsx)(U.CheckCircle,{className:"h-4 w-4"})})]})})]},e.id))})]})}),ea>1&&(0,a.jsxs)("div",{className:"flex items-center justify-between mt-4 pt-4 border-t",children:[(0,a.jsxs)("div",{className:"text-sm text-muted-foreground",children:["Showing ",(Z-1)*50+1," to ",Math.min(50*Z,k)," of ",k]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)(x.Button,{variant:"outline",size:"sm",onClick:()=>ee(e=>Math.max(1,e-1)),disabled:1===Z||c,children:[(0,a.jsx)(P.ChevronLeft,{className:"h-4 w-4"}),"Previous"]}),(0,a.jsxs)("div",{className:"flex items-center gap-1 px-2",children:[(0,a.jsx)("span",{className:"text-sm font-medium",children:Z}),(0,a.jsxs)("span",{className:"text-sm text-muted-foreground",children:["of ",ea]})]}),(0,a.jsxs)(x.Button,{variant:"outline",size:"sm",onClick:()=>ee(e=>Math.min(ea,e+1)),disabled:Z===ea||c,children:["Next",(0,a.jsx)(A.ChevronRight,{className:"h-4 w-4"})]})]})]})]})})]}),(0,a.jsx)($.RequestInvoiceDialog,{open:es,onOpenChange:er,commission:el?{id:el.id,accrual_amount:el.accrual_amount,currency:el.currency,entity_name:el.entity_name,deal:el.deal_name?{name:el.deal_name}:void 0}:null,commissionType:z[e],onSuccess:()=>{M.toast.success("Invoice request sent"),ec(!1)}})]})}function K({arrangerInfo:e,deals:m,introducers:x,partners:u,commercialPartners:h,tabCounts:j,initialTab:g}){let p=(0,s.useRouter)(),b=(0,s.useSearchParams)(),[v,f]=(0,t.useState)(g);return(0,a.jsxs)("div",{className:"p-6 space-y-6",children:[(0,a.jsxs)("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("h1",{className:"text-2xl font-bold text-foreground flex items-center gap-2",children:[(0,a.jsx)(c.FileSpreadsheet,{className:"h-6 w-6"}),"Reconciliation"]}),(0,a.jsx)("p",{className:"text-muted-foreground mt-1",children:"View and manage commissions across all your partner relationships"})]}),e&&(0,a.jsx)("div",{className:"flex items-center gap-2",children:(0,a.jsx)(r.Badge,{variant:e.is_active?"default":"secondary",children:e.name})})]}),(0,a.jsxs)(l.Tabs,{value:v,onValueChange:e=>{f(e);let a=new URLSearchParams(b.toString());a.set("tab",e),p.push(`?${a.toString()}`,{scroll:!1})},className:"space-y-6",children:[(0,a.jsxs)(l.TabsList,{className:"grid grid-cols-2 md:grid-cols-4 w-full md:w-auto",children:[(0,a.jsxs)(l.TabsTrigger,{value:"overview",className:"flex items-center gap-2",children:[(0,a.jsx)(o.LayoutDashboard,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"hidden sm:inline",children:"Overview"}),j.overview>0&&(0,a.jsx)(r.Badge,{variant:"secondary",className:"ml-1 h-5 px-1.5 text-xs",children:j.overview})]}),(0,a.jsxs)(l.TabsTrigger,{value:"introducers",className:"flex items-center gap-2",children:[(0,a.jsx)(d.UserPlus,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"hidden sm:inline",children:"Introducers"}),j.introducers>0&&(0,a.jsx)(r.Badge,{variant:"secondary",className:"ml-1 h-5 px-1.5 text-xs",children:j.introducers})]}),(0,a.jsxs)(l.TabsTrigger,{value:"partners",className:"flex items-center gap-2",children:[(0,a.jsx)(i.Users,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"hidden sm:inline",children:"Partners"}),j.partners>0&&(0,a.jsx)(r.Badge,{variant:"secondary",className:"ml-1 h-5 px-1.5 text-xs",children:j.partners})]}),(0,a.jsxs)(l.TabsTrigger,{value:"commercial-partners",className:"flex items-center gap-2",children:[(0,a.jsx)(n.Building2,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"hidden sm:inline",children:"Commercial"}),j.commercialPartners>0&&(0,a.jsx)(r.Badge,{variant:"secondary",className:"ml-1 h-5 px-1.5 text-xs",children:j.commercialPartners})]})]}),(0,a.jsx)(l.TabsContent,{value:"overview",className:"space-y-6",children:(0,a.jsx)(I,{deals:m})}),(0,a.jsx)(l.TabsContent,{value:"introducers",className:"space-y-6",children:(0,a.jsx)(O,{type:"introducer",entities:x.map(e=>({id:e.id,name:e.legal_name})),deals:m,apiEndpoint:"/api/arrangers/me/reports/introducer-reconciliation",entityLabel:"Introducer",entityPlural:"Introducers"})}),(0,a.jsx)(l.TabsContent,{value:"partners",className:"space-y-6",children:(0,a.jsx)(O,{type:"partner",entities:u.map(e=>({id:e.id,name:e.name||e.legal_name})),deals:m,apiEndpoint:"/api/arrangers/me/reports/partner-reconciliation",entityLabel:"Partner",entityPlural:"Partners"})}),(0,a.jsx)(l.TabsContent,{value:"commercial-partners",className:"space-y-6",children:(0,a.jsx)(O,{type:"commercial_partner",entities:h.map(e=>({id:e.id,name:e.name||e.legal_name})),deals:m,apiEndpoint:"/api/arrangers/me/reports/commercial-partner-reconciliation",entityLabel:"Commercial Partner",entityPlural:"Commercial Partners"})})]})]})}e.s(["UnifiedReconciliationClient",()=>K],489464)}]);