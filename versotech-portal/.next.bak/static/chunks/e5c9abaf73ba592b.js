(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,99874,e=>{"use strict";var t=e.i(722679),s=e.i(340915),a=e.i(90613),r=e.i(316264),l=e.i(129432),n=e.i(429760),i=e.i(352776),d=e.i(191569),c=e.i(514133),o=e.i(816654),m=e.i(538892),x=e.i(244994),u=e.i(119311),h=e.i(941844),p=e.i(396132),g=e.i(551544),j=e.i(263229),f=e.i(820417),b=e.i(603274),v=e.i(122208),_=e.i(733179),N=e.i(196767),y=e.i(971743);function w({deal:e,memberships:s=[],subscriptionsForJourney:r=[]}){let n=e.target_amount?Math.round(e.raised_amount/e.target_amount*100):0,i=new Map(r.map(e=>[e.investor_id,e])),d=s.map(e=>({...e,subscription:e.investor_id?i.get(e.investor_id):null})),c={total:d.length,dispatched:d.filter(e=>e.dispatched_at).length,viewed:d.filter(e=>e.viewed_at).length,interested:d.filter(e=>e.interest_confirmed_at).length,ndaSigned:d.filter(e=>e.nda_signed_at).length,dataRoom:d.filter(e=>e.data_room_granted_at).length,packGen:d.filter(e=>e.subscription?.pack_generated_at).length,packSent:d.filter(e=>e.subscription?.pack_sent_at).length,signed:d.filter(e=>e.subscription?.signed_at).length,funded:d.filter(e=>e.subscription?.funded_at).length},o=[{label:"Dispatched",count:c.dispatched},{label:"Viewed",count:c.viewed},{label:"Interested",count:c.interested},{label:"NDA",count:c.ndaSigned},{label:"Data Room",count:c.dataRoom},{label:"Pack Gen",count:c.packGen},{label:"Pack Sent",count:c.packSent},{label:"Signed",count:c.signed},{label:"Funded",count:c.funded}];return(0,t.jsxs)("div",{className:"space-y-6",children:[s.length>0&&(0,t.jsxs)(a.Card,{className:"border border-border bg-muted/30 overflow-hidden",children:[(0,t.jsx)(a.CardHeader,{className:"pb-2 pt-4 px-6",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)(a.CardTitle,{className:"text-sm font-medium text-muted-foreground tracking-wide uppercase",children:"Investor Pipeline"}),(0,t.jsxs)("span",{className:"text-xs text-muted-foreground",children:[c.total," total"]})]})}),(0,t.jsxs)(a.CardContent,{className:"px-6 pb-5",children:[(0,t.jsxs)("div",{className:"relative pt-2",children:[(0,t.jsx)("div",{className:"absolute top-[26px] left-5 right-5 h-[2px] bg-gradient-to-r from-emerald-500/20 via-emerald-500/10 to-transparent"}),(0,t.jsx)("div",{className:"relative flex items-start justify-between",children:o.map((e,s)=>{let a=e.count>0,r="Funded"===e.label,l=(e=>{if(0===e)return c.total>0?Math.round(o[0].count/c.total*100):0;let t=o[e-1].count;return 0===t?0:Math.round(o[e].count/t*100)})(s);return(0,t.jsxs)("div",{className:"flex flex-col items-center group",style:{flex:"1 1 0"},children:[(0,t.jsx)("div",{className:`
                          relative z-10 w-11 h-11 rounded-full flex items-center justify-center
                          text-sm font-semibold transition-all duration-300 cursor-default
                          ${a?r?"bg-emerald-500/25 text-emerald-300 ring-2 ring-emerald-500/40 shadow-[0_0_20px_rgba(16,185,129,0.15)]":"bg-emerald-500/15 text-emerald-400 ring-1 ring-emerald-500/25":"bg-muted text-muted-foreground/60"}
                          group-hover:scale-110 group-hover:ring-emerald-400/40
                        `,children:e.count}),(0,t.jsx)("span",{className:`
                        text-[10px] mt-2 text-center leading-tight transition-colors
                        ${a?"text-foreground/70":"text-muted-foreground/50"}
                        group-hover:text-foreground
                      `,children:e.label}),s>0&&(0,t.jsxs)("span",{className:`
                          text-[9px] mt-0.5 transition-opacity
                          ${e.count>0?"text-emerald-400/60":"text-muted-foreground/30"}
                        `,children:[l,"%"]})]},e.label)})})]}),(0,t.jsxs)("div",{className:"flex items-center justify-center gap-8 mt-6 pt-4 border-t border-border",children:[(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"text-lg font-semibold text-foreground",children:c.funded}),(0,t.jsx)("div",{className:"text-[10px] text-muted-foreground uppercase tracking-wider",children:"Funded"})]}),(0,t.jsx)("div",{className:"w-px h-8 bg-muted"}),(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsxs)("div",{className:"text-lg font-semibold text-foreground",children:[c.total>0?Math.round(c.funded/c.total*100):0,"%"]}),(0,t.jsx)("div",{className:"text-[10px] text-muted-foreground uppercase tracking-wider",children:"Conversion"})]}),(0,t.jsx)("div",{className:"w-px h-8 bg-muted"}),(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"text-lg font-semibold text-foreground",children:c.signed}),(0,t.jsx)("div",{className:"text-[10px] text-muted-foreground uppercase tracking-wider",children:"Signed"})]})]})]})]}),(0,t.jsxs)(a.Card,{className:"border border-border bg-muted/50",children:[(0,t.jsxs)(a.CardHeader,{children:[(0,t.jsx)(a.CardTitle,{className:"text-foreground",children:"Deal Information"}),(0,t.jsx)(a.CardDescription,{children:"Core details and structure"})]}),(0,t.jsx)(a.CardContent,{className:"space-y-4",children:(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-sm font-medium text-muted-foreground",children:"Deal Name"}),(0,t.jsx)("p",{className:"text-lg text-foreground mt-1",children:e.name})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-sm font-medium text-muted-foreground",children:"Company"}),(0,t.jsx)("p",{className:"text-lg text-foreground mt-1",children:e.company_name||"—"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-sm font-medium text-muted-foreground",children:"Vehicle"}),(0,t.jsx)("div",{className:"flex items-center gap-2 mt-1",children:e.vehicles?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(y.Building2,{className:"h-4 w-4 text-muted-foreground"}),(0,t.jsx)("span",{className:"text-foreground",children:e.vehicles.name}),(0,t.jsx)(l.Badge,{variant:"outline",className:"border-border",children:e.vehicles.type})]}):(0,t.jsx)("span",{className:"text-muted-foreground",children:"No vehicle assigned"})})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-sm font-medium text-muted-foreground",children:"Arranger"}),(0,t.jsx)("div",{className:"flex items-center gap-2 mt-1",children:e.arranger_entities?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(y.Building2,{className:"h-4 w-4 text-amber-500"}),(0,t.jsx)("span",{className:"text-foreground",children:e.arranger_entities.company_name||e.arranger_entities.legal_name}),(0,t.jsx)(l.Badge,{variant:"outline",className:"border-amber-500/30 text-amber-400 bg-amber-500/10",children:"Mandate"})]}):(0,t.jsx)("span",{className:"text-muted-foreground",children:"No arranger assigned"})})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-sm font-medium text-muted-foreground",children:"Sector / Stage"}),(0,t.jsxs)("p",{className:"text-foreground mt-1",children:[e.sector||"—"," ",e.stage&&`• ${e.stage}`]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-sm font-medium text-muted-foreground",children:"Location"}),(0,t.jsx)("p",{className:"text-foreground mt-1",children:e.location||"—"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-sm font-medium text-muted-foreground",children:"Currency"}),(0,t.jsx)("p",{className:"text-foreground mt-1",children:e.currency})]})]})})]}),(0,t.jsxs)(a.Card,{className:"border border-border bg-muted/50",children:[(0,t.jsxs)(a.CardHeader,{children:[(0,t.jsxs)(a.CardTitle,{className:"text-foreground flex items-center gap-2",children:[(0,t.jsx)(N.DollarSign,{className:"h-5 w-5"}),"Fundraising Progress"]}),(0,t.jsx)(a.CardDescription,{children:"Target and raised amounts. Investment terms (price, min/max) are defined in the Term Sheet."})]}),(0,t.jsxs)(a.CardContent,{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-sm font-medium text-muted-foreground",children:"Target Amount"}),(0,t.jsxs)("p",{className:"text-2xl font-bold text-foreground mt-1",children:[e.currency," ",e.target_amount?.toLocaleString()||"—"]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-sm font-medium text-muted-foreground",children:"Raised Amount"}),(0,t.jsxs)("p",{className:"text-2xl font-bold text-emerald-400 mt-1",children:[e.currency," ",e.raised_amount?.toLocaleString()||0]})]})]}),e.target_amount>0&&(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,t.jsx)("span",{className:"text-muted-foreground",children:"Progress"}),(0,t.jsxs)("span",{className:"font-medium text-foreground",children:[n,"% of target"]})]}),(0,t.jsx)("div",{className:"h-2 bg-muted rounded-full overflow-hidden",children:(0,t.jsx)("div",{className:"h-full bg-emerald-500 transition-all duration-300",style:{width:`${Math.min(n,100)}%`}})})]})]})]}),(0,t.jsxs)(a.Card,{className:"border border-border bg-muted/50",children:[(0,t.jsxs)(a.CardHeader,{children:[(0,t.jsxs)(a.CardTitle,{className:"text-foreground flex items-center gap-2",children:[(0,t.jsx)(v.CalendarDays,{className:"h-5 w-5"}),"Timeline"]}),(0,t.jsx)(a.CardDescription,{children:"Important dates and deadlines"})]}),(0,t.jsx)(a.CardContent,{children:(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-sm font-medium text-muted-foreground",children:"Open Date"}),(0,t.jsx)("p",{className:"text-foreground mt-1",children:e.open_at?new Date(e.open_at).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}):"—"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-sm font-medium text-muted-foreground",children:"Close Date"}),(0,t.jsx)("p",{className:"text-foreground mt-1",children:e.close_at?new Date(e.close_at).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}):"—"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-sm font-medium text-muted-foreground",children:"Created"}),(0,t.jsx)("p",{className:"text-foreground mt-1",children:new Date(e.created_at).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})})]}),e.close_at&&new Date(e.close_at)>new Date&&(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-sm font-medium text-muted-foreground",children:"Days Remaining"}),(0,t.jsx)("p",{className:"text-2xl font-bold text-emerald-200 mt-1",children:Math.ceil((new Date(e.close_at).getTime()-new Date().getTime())/864e5)})]})]})})]}),(e.description||e.investment_thesis)&&(0,t.jsxs)(a.Card,{className:"border border-border bg-muted/50",children:[(0,t.jsx)(a.CardHeader,{children:(0,t.jsxs)(a.CardTitle,{className:"text-foreground flex items-center gap-2",children:[(0,t.jsx)(_.TrendingUp,{className:"h-5 w-5"}),"Deal Overview"]})}),(0,t.jsxs)(a.CardContent,{className:"space-y-4",children:[e.description&&(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-sm font-medium text-muted-foreground",children:"Description"}),(0,t.jsx)("p",{className:"text-foreground mt-2 whitespace-pre-wrap",children:e.description})]}),e.investment_thesis&&(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-sm font-medium text-muted-foreground",children:"Investment Thesis"}),(0,t.jsx)("p",{className:"text-foreground mt-2 whitespace-pre-wrap",children:e.investment_thesis})]})]})]})]})}var C=e.i(831833);function S({dealId:e,onSuccess:a}){let l=(0,b.useRouter)(),[n,x]=(0,s.useState)(!1),[u,h]=(0,s.useState)(!1),[p,g]=(0,s.useState)(null),[f,v]=(0,s.useState)({source_type:"company",counterparty_name:"",units_total:"",unit_cost:"",currency:"USD",acquired_at:"",lockup_until:"",notes:""}),_=(e,t)=>{v(s=>({...s,[e]:t}))},N=async()=>{if(!f.units_total||!f.unit_cost)return void g("Units and cost are required");h(!0),g(null);try{let t=await fetch(`/api/deals/${e}/inventory`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({source_type:f.source_type,counterparty_name:f.counterparty_name,units_total:parseFloat(f.units_total),unit_cost:parseFloat(f.unit_cost),currency:f.currency,acquired_at:f.acquired_at||null,lockup_until:f.lockup_until||null,notes:f.notes||null})});if(!t.ok){let e=await t.json();throw Error(e.error||"Failed to add share lot")}v({source_type:"company",counterparty_name:"",units_total:"",unit_cost:"",currency:"USD",acquired_at:"",lockup_until:"",notes:""}),x(!1),a&&a(),l.refresh()}catch(e){g(e.message)}finally{h(!1)}};return(0,t.jsxs)(i.Dialog,{open:n,onOpenChange:x,children:[(0,t.jsx)(i.DialogTrigger,{asChild:!0,children:(0,t.jsxs)(r.Button,{className:"gap-2",children:[(0,t.jsx)(C.Plus,{className:"h-4 w-4"}),"Add Share Lot"]})}),(0,t.jsxs)(i.DialogContent,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[(0,t.jsxs)(i.DialogHeader,{children:[(0,t.jsx)(i.DialogTitle,{children:"Add Share Lot"}),(0,t.jsx)(i.DialogDescription,{children:"Add inventory to this deal from a share source"})]}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c.Label,{htmlFor:"source_type",children:"Source Type *"}),(0,t.jsxs)(m.Select,{value:f.source_type,onValueChange:e=>_("source_type",e),children:[(0,t.jsx)(m.SelectTrigger,{children:(0,t.jsx)(m.SelectValue,{})}),(0,t.jsxs)(m.SelectContent,{children:[(0,t.jsx)(m.SelectItem,{value:"company",children:"Company"}),(0,t.jsx)(m.SelectItem,{value:"fund",children:"Fund"}),(0,t.jsx)(m.SelectItem,{value:"colleague",children:"Colleague"}),(0,t.jsx)(m.SelectItem,{value:"other",children:"Other"})]})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c.Label,{htmlFor:"counterparty_name",children:"Counterparty Name"}),(0,t.jsx)(d.Input,{id:"counterparty_name",placeholder:"e.g., Former Employee",value:f.counterparty_name,onChange:e=>_("counterparty_name",e.target.value)})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c.Label,{htmlFor:"units_total",children:"Total Units *"}),(0,t.jsx)(d.Input,{id:"units_total",type:"number",step:"0.00000001",placeholder:"50000",value:f.units_total,onChange:e=>_("units_total",e.target.value),required:!0})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c.Label,{htmlFor:"unit_cost",children:"Unit Cost *"}),(0,t.jsx)(d.Input,{id:"unit_cost",type:"number",step:"0.000001",placeholder:"120.00",value:f.unit_cost,onChange:e=>_("unit_cost",e.target.value),required:!0})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-3 gap-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c.Label,{htmlFor:"currency",children:"Currency"}),(0,t.jsxs)(m.Select,{value:f.currency,onValueChange:e=>_("currency",e),children:[(0,t.jsx)(m.SelectTrigger,{children:(0,t.jsx)(m.SelectValue,{})}),(0,t.jsxs)(m.SelectContent,{children:[(0,t.jsx)(m.SelectItem,{value:"USD",children:"USD"}),(0,t.jsx)(m.SelectItem,{value:"EUR",children:"EUR"}),(0,t.jsx)(m.SelectItem,{value:"GBP",children:"GBP"})]})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c.Label,{htmlFor:"acquired_at",children:"Acquired Date"}),(0,t.jsx)(d.Input,{id:"acquired_at",type:"date",value:f.acquired_at,onChange:e=>_("acquired_at",e.target.value)})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c.Label,{htmlFor:"lockup_until",children:"Lockup Until"}),(0,t.jsx)(d.Input,{id:"lockup_until",type:"date",value:f.lockup_until,onChange:e=>_("lockup_until",e.target.value)})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c.Label,{htmlFor:"notes",children:"Notes"}),(0,t.jsx)(o.Textarea,{id:"notes",placeholder:"Additional information about this share lot...",rows:3,value:f.notes,onChange:e=>_("notes",e.target.value)})]}),p&&(0,t.jsx)("div",{className:"p-3 rounded-lg bg-red-500/20 border border-red-400/30 text-red-200 text-sm",children:p}),(0,t.jsxs)("div",{className:"flex justify-end gap-2 pt-4",children:[(0,t.jsx)(r.Button,{variant:"outline",onClick:()=>x(!1),disabled:u,children:"Cancel"}),(0,t.jsx)(r.Button,{onClick:N,disabled:u,children:u?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(j.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),"Adding..."]}):"Add Share Lot"})]})]})]})]})}function k({dealId:e,shareLots:s,inventorySummary:n,onRefresh:i}){return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,t.jsxs)(a.Card,{className:"border-border bg-muted/50",children:[(0,t.jsx)(a.CardHeader,{className:"pb-2",children:(0,t.jsx)(a.CardTitle,{className:"text-sm font-medium text-muted-foreground",children:"Total Units"})}),(0,t.jsx)(a.CardContent,{children:(0,t.jsx)("p",{className:"text-2xl font-bold text-foreground",children:n.total_units.toLocaleString()})})]}),(0,t.jsxs)(a.Card,{className:"border-border bg-muted/50",children:[(0,t.jsx)(a.CardHeader,{className:"pb-2",children:(0,t.jsx)(a.CardTitle,{className:"text-sm font-medium text-muted-foreground",children:"Available"})}),(0,t.jsx)(a.CardContent,{children:(0,t.jsx)("p",{className:"text-2xl font-bold text-emerald-200",children:n.available_units.toLocaleString()})})]}),(0,t.jsxs)(a.Card,{className:"border-border bg-muted/50",children:[(0,t.jsx)(a.CardHeader,{className:"pb-2",children:(0,t.jsx)(a.CardTitle,{className:"text-sm font-medium text-muted-foreground",children:"Reserved"})}),(0,t.jsx)(a.CardContent,{children:(0,t.jsx)("p",{className:"text-2xl font-bold text-amber-200",children:n.reserved_units.toLocaleString()})})]}),(0,t.jsxs)(a.Card,{className:"border-border bg-muted/50",children:[(0,t.jsx)(a.CardHeader,{className:"pb-2",children:(0,t.jsx)(a.CardTitle,{className:"text-sm font-medium text-muted-foreground",children:"Allocated"})}),(0,t.jsx)(a.CardContent,{children:(0,t.jsx)("p",{className:"text-2xl font-bold text-sky-200",children:n.allocated_units.toLocaleString()})})]})]}),(0,t.jsxs)(a.Card,{className:"border-border bg-muted/50",children:[(0,t.jsx)(a.CardHeader,{children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)(a.CardTitle,{className:"text-foreground flex items-center gap-2",children:[(0,t.jsx)(x.Package,{className:"h-5 w-5"}),"Share Lots"]}),(0,t.jsx)(a.CardDescription,{children:"Inventory sources and allocation tracking"})]}),(0,t.jsx)(S,{dealId:e,onSuccess:i})]})}),(0,t.jsx)(a.CardContent,{children:s&&0!==s.length?(0,t.jsx)("div",{className:"space-y-3",children:s.map(e=>(0,t.jsx)("div",{className:"border border-border rounded-lg p-4 bg-muted/50 hover:bg-muted transition-colors",children:(0,t.jsxs)("div",{className:"flex items-start justify-between",children:[(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{className:"font-medium text-foreground",children:e.share_sources?.counterparty_name||"Unknown Source"}),(0,t.jsx)(l.Badge,{variant:"outline",className:"border-border text-xs",children:e.share_sources?.kind}),(0,t.jsx)(l.Badge,{className:"available"===e.status?"bg-emerald-500/20 text-emerald-200":"exhausted"===e.status?"bg-red-500/20 text-red-200":"bg-amber-500/20 text-amber-200",children:e.status})]}),(0,t.jsxs)("div",{className:"flex items-center gap-4 text-sm text-muted-foreground",children:[(0,t.jsxs)("span",{children:["Total: ",e.units_total.toLocaleString()," units"]}),(0,t.jsxs)("span",{children:["Remaining: ",e.units_remaining.toLocaleString()," units"]}),(0,t.jsxs)("span",{children:["Cost: ",e.currency," ",e.unit_cost.toFixed(2),"/unit"]}),e.acquired_at&&(0,t.jsxs)("span",{children:["Acquired: ",new Date(e.acquired_at).toLocaleDateString()]})]})]}),(0,t.jsx)(r.Button,{variant:"outline",size:"sm",children:"Edit"})]})},e.id))}):(0,t.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:'No share lots added yet. Click "Add Share Lot" to begin.'})})]})]})}var T=e.i(137533),F=e.i(237635),D=e.i(932735),I=e.i(496383),L=e.i(711819),A=e.i(49664),P=e.i(773510),E=e.i(15098),$=e.i(10994),B=e.i(501259),M=e.i(554369),H=e.i(849110),U=e.i(691974),R=e.i(335994),O=e.i(886086),V=e.i(510166),q=e.i(401148),z=e.i(282141);let G={partner_investor:"partner",introducer_investor:"introducer",commercial_partner_investor:"commercial_partner"},Q=[{value:"investor",label:"Investor",icon:O.UserCircle,description:"Individual or entity investing in this deal",color:"bg-emerald-500/20 text-emerald-300 border-emerald-500/30"},{value:"partner",label:"Partner",icon:y.Building2,description:"Distribution or syndicate partner",color:"bg-purple-500/20 text-purple-300 border-purple-500/30"},{value:"introducer",label:"Introducer",icon:B.Users,description:"Individual or entity introducing investors",color:"bg-orange-500/20 text-orange-300 border-orange-500/30"},{value:"commercial_partner",label:"Commercial Partner",icon:U.Briefcase,description:"Wealth manager, placement agent, etc.",color:"bg-cyan-500/20 text-cyan-300 border-cyan-500/30"}],J=[{value:"investor",label:"Investor"},{value:"co_investor",label:"Co-Investor"},{value:"partner_investor",label:"Partner Investor"},{value:"introducer_investor",label:"Introducer Investor"},{value:"commercial_partner_investor",label:"Commercial Partner Investor"}],K=[{value:"subscription",label:"Subscription Fee"},{value:"management",label:"Management Fee"},{value:"performance",label:"Performance Fee"},{value:"spread_markup",label:"Spread Markup"},{value:"flat",label:"Flat Fee"}];function W({dealId:e,onParticipantAdded:a}){let l=(0,b.useRouter)(),[n,o]=(0,s.useState)(!1),[x,u]=(0,s.useState)(!1),[h,p]=(0,s.useState)(null),[g,f]=(0,s.useState)(null),[v,_]=(0,s.useState)([]),[N,y]=(0,s.useState)([]),[w,S]=(0,s.useState)([]),[k,T]=(0,s.useState)([]),[F,D]=(0,s.useState)(!1),[I,L]=(0,s.useState)(""),[A,P]=(0,s.useState)(null),[E,$]=(0,s.useState)("investor"),[H,U]=(0,s.useState)(""),[R,O]=(0,s.useState)(null),[V,W]=(0,s.useState)(null),[X,Y]=(0,s.useState)(!1),[Z,ee]=(0,s.useState)(""),[et,es]=(0,s.useState)([]),[ea,er]=(0,s.useState)(""),[el,en]=(0,s.useState)(!1),[ei,ed]=(0,s.useState)(""),[ec,eo]=(0,s.useState)([{kind:"subscription",rate_bps:200}]),[em,ex]=(0,s.useState)([]),[eu,eh]=(0,s.useState)(!1),[ep,eg]=(0,s.useState)(""),[ej,ef]=(0,s.useState)(null),[eb,ev]=(0,s.useState)([]),[e_,eN]=(0,s.useState)(!1),[ey,ew]=(0,s.useState)(""),eC=!!G[E],eS=G[E],ek=(0,s.useCallback)(()=>"partner"===eS?N:"introducer"===eS?w:"commercial_partner"===eS?k:[],[eS,N,w,k]),eT=(0,s.useCallback)(async()=>{D(!0);try{let[e,t,s,a]=await Promise.all([fetch("/api/investors?has_users=true"),fetch("/api/admin/partners?status=active"),fetch("/api/admin/introducers?status=active"),fetch("/api/admin/commercial-partners?status=active")]);if(e.ok){let t=await e.json();_(t.investors||t.data||[])}if(t.ok){let e=await t.json();y(e.partners||e.data||[])}if(s.ok){let e=await s.json();S(e.introducers||e.data||[])}if(a.ok){let e=await a.json();T(e.partners||e.commercial_partners||e.data||[])}}catch(e){console.error("Failed to load entities:",e)}finally{D(!1)}},[]),eF=(0,s.useCallback)(async()=>{en(!0);try{let t=await fetch(`/api/deals/${e}/fee-structures?status=published`);if(t.ok){let e=await t.json();es(e.term_sheets||[])}}catch(e){console.error("Term sheets fetch failed:",e)}finally{en(!1)}},[e]),eD=(0,s.useCallback)(async()=>{if(R&&eS){Y(!0),W(null),ee("");try{let t=`/api/deals/${e}/dispatch/fee-plans?entity_id=${R.id}&entity_type=${eS}`;ea&&(t+=`&term_sheet_id=${ea}`);let s=await fetch(t);if(s.ok){let e=await s.json();W(e),1===e.accepted_plans.length&&ee(e.accepted_plans[0].id)}}catch(e){console.error("Fee plans fetch failed:",e)}finally{Y(!1)}}},[e,R,eS,ea]),eI=(0,s.useCallback)(async t=>{eh(!0),ex([]),eg(""),ef(null),ev([]),ew("");try{let s=await fetch(`/api/deals/${e}/active-agreements?introducer_id=${t}`);if(s.ok){let e=await s.json();ex(e.agreements||[])}}catch(e){console.error("Active agreements fetch failed:",e)}finally{eh(!1)}},[e]),eL=(0,s.useCallback)(async t=>{eN(!0),ev([]),ew("");try{let s=await fetch(`/api/deals/${e}/linkable-investors?term_sheet_id=${t}`);if(s.ok){let e=await s.json();ev(e.investors||[])}}catch(e){console.error("Linkable investors fetch failed:",e)}finally{eN(!1)}},[e]);(0,s.useEffect)(()=>{n||(f(null),L(""),P(null),$("investor"),ed(""),eo([{kind:"subscription",rate_bps:200}]),p(null),U(""),O(null),W(null),ee(""),es([]),er(""),ex([]),eg(""),ef(null),ev([]),ew(""))},[n]),(0,s.useEffect)(()=>{n&&eT()},[n,eT]),(0,s.useEffect)(()=>{L(""),P(null),$("investor"),U(""),O(null),W(null),ee(""),ed(""),ex([]),eg(""),ef(null),ev([]),ew("")},[g]),(0,s.useEffect)(()=>{U(""),O(null),W(null),ee("")},[E]),(0,s.useEffect)(()=>{"investor"===g&&n?eF():(es([]),er(""))},[g,n,eF]),(0,s.useEffect)(()=>{"introducer"===g&&A?.id?eI(A.id):"introducer"===g&&(ex([]),eg(""),ef(null),ev([]),ew(""))},[g,A?.id,eI]),(0,s.useEffect)(()=>{if(!ep){ef(null),ev([]),ew("");return}let e=em.find(e=>e.id===ep);ef(e||null),e?.term_sheet_id&&eL(e.term_sheet_id)},[ep,em,eL]),(0,s.useEffect)(()=>{R&&eS&&ea?eD():(W(null),ee(""))},[R,eS,ea,eD]),(0,s.useEffect)(()=>{if(!I)return void P(null);let e=[];"investor"===g?e=v:"partner"===g?e=N:"introducer"===g?e=w:"commercial_partner"===g&&(e=k);let t=e.find(e=>e.id===I);if(P(t||null),t&&"investor"!==g){let e=t.name||t.legal_name||"Unknown";ed(`${e} Fee Plan`)}},[I,g,v,N,w,k]),(0,s.useEffect)(()=>{H?O(ek().find(e=>e.id===H)||null):O(null)},[H,ek]);let eA=(e,t,s)=>{let a=[...ec];a[e]={...a[e],[t]:s},"rate_bps"===t&&delete a[e].flat_amount,"flat_amount"===t&&delete a[e].rate_bps,eo(a)},eP=async()=>{if(!g)return void p("Please select a participant type");if("investor"===g){if(!A)return void p("Please select an investor");if(!ea)return void p("Please select a term sheet for this investor");if(eC){if(!R){let e=eS?.replace("_"," ")||"entity";p(`Please select a ${e} for this investor role`);return}if(!V?.can_dispatch)return void p(V?.message||"No accepted fee plan available for this entity");if(!Z)return void p("Please select a fee plan")}}else if("introducer"===g){if(!ej)return void p("Please select an active introducer agreement");if(!ey)return void p("Please select an investor to link to this introducer")}else{if(!A)return void p(`Please select a ${g.replace("_"," ")}`);if(!ei.trim())return void p("Please enter a fee plan name")}u(!0),p(null);try{if("investor"===g){let t={investor_id:A.id,role:E,send_notification:!0,term_sheet_id:ea};eC&&R&&Z&&(t.referred_by_entity_id=R.id,t.referred_by_entity_type=eS,t.assigned_fee_plan_id=Z);let s=await fetch(`/api/deals/${e}/members`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!s.ok){let e=await s.json();throw Error(e.message||e.error||"Failed to add investor")}}else if("introducer"===g){let t=eb.find(e=>e.user_id===ey);if(!t||!ej)throw Error("Invalid selection");let s=await fetch(`/api/deals/${e}/members/${t.user_id}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({referred_by_entity_id:ej.introducer_id,referred_by_entity_type:"introducer",assigned_fee_plan_id:ej.fee_plan_id,role:"introducer_investor"})});if(!s.ok){let e=await s.json();throw Error(e.error||"Failed to link investor to introducer")}}else{let t=await fetch(`/api/deals/${e}/partners`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({entity_type:g,entity_id:A.id,fee_plan_name:ei.trim(),fee_components:ec.filter(e=>void 0!==e.rate_bps&&null!==e.rate_bps||void 0!==e.flat_amount&&null!==e.flat_amount)})});if(!t.ok){let e=await t.json();throw Error(e.error||`Failed to add ${g.replace("_"," ")}`)}}o(!1),a?.(),l.refresh()}catch(e){p(e.message)}finally{u(!1)}},eE=e=>e.legal_name||e.name||"Unknown",e$=Q.find(e=>e.value===g),eB=()=>"investor"===g?v:"partner"===g?N:"introducer"===g?w:"commercial_partner"===g?k:[];return(0,t.jsxs)(i.Dialog,{open:n,onOpenChange:o,children:[(0,t.jsx)(i.DialogTrigger,{asChild:!0,children:(0,t.jsxs)(r.Button,{className:"gap-2",children:[(0,t.jsx)(C.Plus,{className:"h-4 w-4"}),"Add Participant"]})}),(0,t.jsxs)(i.DialogContent,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[(0,t.jsxs)(i.DialogHeader,{children:[(0,t.jsx)(i.DialogTitle,{children:"Add Deal Participant"}),(0,t.jsx)(i.DialogDescription,{children:"Add an investor, partner, introducer, or commercial partner to this deal"})]}),(0,t.jsxs)("div",{className:"space-y-6 py-4",children:[(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsx)(c.Label,{children:"Participant Type"}),(0,t.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:Q.map(e=>{let s=e.icon,a=g===e.value;return(0,t.jsx)("button",{type:"button",onClick:()=>f(e.value),className:(0,z.cn)("p-4 rounded-lg border text-left transition-all",a?e.color+" border-2":"border-border hover:border-primary hover:bg-muted"),children:(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)(s,{className:"h-5 w-5"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"font-medium",children:e.label}),(0,t.jsx)("div",{className:"text-xs text-muted-foreground",children:e.description})]})]})},e.value)})})]}),g&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)(c.Label,{children:["Select ",e$?.label]}),F?(0,t.jsxs)("div",{className:"flex items-center gap-2 py-3",children:[(0,t.jsx)(j.Loader2,{className:"h-4 w-4 animate-spin text-muted-foreground"}),(0,t.jsxs)("span",{className:"text-sm text-muted-foreground",children:["Loading ",e$?.label.toLowerCase(),"s..."]})]}):0===eB().length?(0,t.jsx)("div",{className:"p-3 rounded-lg border border-amber-500/30 bg-amber-500/5 text-amber-300 text-sm",children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(q.AlertCircle,{className:"h-4 w-4"}),(0,t.jsxs)("span",{children:["No ",e$?.label.toLowerCase(),"s available."]})]})}):(0,t.jsxs)(m.Select,{value:I,onValueChange:L,children:[(0,t.jsx)(m.SelectTrigger,{className:(0,z.cn)(A&&e$?.color),children:(0,t.jsx)(m.SelectValue,{placeholder:`Select a ${e$?.label.toLowerCase()}`})}),(0,t.jsx)(m.SelectContent,{children:eB().map(e=>(0,t.jsx)(m.SelectItem,{value:e.id,children:(0,t.jsxs)("div",{className:"flex flex-col",children:[(0,t.jsx)("span",{children:eE(e)}),e.contact_email&&(0,t.jsx)("span",{className:"text-xs text-muted-foreground",children:e.contact_email})]})},e.id))})]})]}),"investor"===g&&A&&(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c.Label,{children:"Role"}),(0,t.jsxs)(m.Select,{value:E,onValueChange:$,children:[(0,t.jsx)(m.SelectTrigger,{children:(0,t.jsx)(m.SelectValue,{})}),(0,t.jsx)(m.SelectContent,{children:J.map(e=>(0,t.jsx)(m.SelectItem,{value:e.value,children:e.label},e.value))})]})]}),"investor"===g&&A&&(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c.Label,{children:"Term Sheet (Investor Class) *"}),el?(0,t.jsxs)("div",{className:"flex items-center gap-2 py-3",children:[(0,t.jsx)(j.Loader2,{className:"h-4 w-4 animate-spin text-muted-foreground"}),(0,t.jsx)("span",{className:"text-sm text-muted-foreground",children:"Loading term sheets..."})]}):0===et.length?(0,t.jsx)("div",{className:"p-3 rounded-lg border border-amber-500/30 bg-amber-500/5 text-amber-300 text-sm",children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(q.AlertCircle,{className:"h-4 w-4"}),(0,t.jsx)("span",{children:"No published term sheets available. Please publish a term sheet first."})]})}):(0,t.jsxs)(m.Select,{value:ea,onValueChange:er,children:[(0,t.jsx)(m.SelectTrigger,{children:(0,t.jsx)(m.SelectValue,{placeholder:"Select term sheet"})}),(0,t.jsx)(m.SelectContent,{children:et.map(e=>(0,t.jsxs)(m.SelectItem,{value:e.id,children:["v",e.version," — ",e.subscription_fee_percent??0,"% sub / ",e.management_fee_percent??0,"% mgmt / ",e.carried_interest_percent??0,"% carry"]},e.id))})]})]}),"investor"===g&&A&&eC&&(0,t.jsxs)("div",{className:"space-y-3 p-4 rounded-lg border border-amber-500/30 bg-amber-500/5",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(q.AlertCircle,{className:"h-4 w-4 text-amber-400"}),(0,t.jsxs)(c.Label,{className:"text-amber-300",children:["Referring ",eS?.replace("_"," ")," Required"]})]}),(0,t.jsxs)(m.Select,{value:H,onValueChange:U,children:[(0,t.jsx)(m.SelectTrigger,{children:(0,t.jsx)(m.SelectValue,{placeholder:`Select ${eS?.replace("_"," ")}`})}),(0,t.jsx)(m.SelectContent,{children:ek().map(e=>(0,t.jsx)(m.SelectItem,{value:e.id,children:eE(e)},e.id))})]}),R&&!ea&&(0,t.jsx)("div",{className:"p-3 rounded-lg bg-blue-500/10 border border-blue-500/30",children:(0,t.jsxs)("div",{className:"flex items-start gap-2",children:[(0,t.jsx)(q.AlertCircle,{className:"h-4 w-4 text-blue-400 mt-0.5"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm text-blue-300 font-medium",children:"Term Sheet Required"}),(0,t.jsx)("p",{className:"text-xs text-blue-300/80 mt-1",children:"Please select a term sheet above first. Fee plans are linked to specific term sheets."})]})]})}),R&&ea&&X&&(0,t.jsxs)("div",{className:"flex items-center gap-2 py-3",children:[(0,t.jsx)(j.Loader2,{className:"h-4 w-4 animate-spin text-muted-foreground"}),(0,t.jsx)("span",{className:"text-sm text-muted-foreground",children:"Loading fee plans..."})]}),R&&ea&&!X&&V&&!V.can_dispatch&&(0,t.jsx)("div",{className:"p-3 rounded-lg bg-destructive/10 border border-destructive/30",children:(0,t.jsxs)("div",{className:"flex items-start gap-2",children:[(0,t.jsx)(q.AlertCircle,{className:"h-4 w-4 text-destructive mt-0.5"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm text-destructive font-medium",children:"Cannot Dispatch"}),(0,t.jsx)("p",{className:"text-xs text-destructive/80 mt-1",children:V.message||"No accepted fee plan available for this term sheet"})]})]})}),R&&ea&&!X&&V&&V.can_dispatch&&(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c.Label,{children:"Fee Plan"}),(0,t.jsxs)(m.Select,{value:Z,onValueChange:ee,children:[(0,t.jsx)(m.SelectTrigger,{children:(0,t.jsx)(m.SelectValue,{placeholder:"Select fee plan"})}),(0,t.jsx)(m.SelectContent,{children:V.accepted_plans.map(e=>(0,t.jsx)(m.SelectItem,{value:e.id,children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{children:e.name}),e.is_default&&(0,t.jsx)("span",{className:"text-xs bg-primary/20 text-primary px-1.5 py-0.5 rounded",children:"Default"})]})},e.id))})]}),Z&&(0,t.jsx)("div",{className:"p-2 rounded bg-muted/30 text-xs space-y-1",children:V.accepted_plans.find(e=>e.id===Z)?.fee_components.map((e,s)=>(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{className:"text-muted-foreground capitalize",children:e.kind.replace("_"," ")}),(0,t.jsx)("span",{children:void 0!==e.rate_bps?`${(e.rate_bps/100).toFixed(2)}%`:void 0!==e.flat_amount?`$${e.flat_amount.toLocaleString()}`:"-"})]},s))})]})]}),"investor"!==g&&"introducer"!==g&&A&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c.Label,{children:"Fee Plan Name"}),(0,t.jsx)(d.Input,{value:ei,onChange:e=>ed(e.target.value),placeholder:"e.g., Standard Partner Fee"})]}),(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)(c.Label,{children:"Fee Components"}),(0,t.jsxs)(r.Button,{type:"button",variant:"ghost",size:"sm",onClick:()=>{eo([...ec,{kind:"subscription",rate_bps:100}])},className:"gap-1 text-xs",children:[(0,t.jsx)(C.Plus,{className:"h-3 w-3"}),"Add"]})]}),(0,t.jsx)("div",{className:"space-y-2",children:ec.map((e,s)=>(0,t.jsxs)("div",{className:"flex items-center gap-2 p-3 rounded-md bg-muted/50",children:[(0,t.jsxs)(m.Select,{value:e.kind,onValueChange:e=>eA(s,"kind",e),children:[(0,t.jsx)(m.SelectTrigger,{className:"w-36",children:(0,t.jsx)(m.SelectValue,{})}),(0,t.jsx)(m.SelectContent,{children:K.map(e=>(0,t.jsx)(m.SelectItem,{value:e.value,children:e.label},e.value))})]}),(0,t.jsx)(d.Input,{type:"number",step:"0.01",placeholder:"Rate %",value:void 0!==e.rate_bps&&null!==e.rate_bps?e.rate_bps/100:"",onChange:e=>eA(s,"rate_bps",e.target.value?100*parseFloat(e.target.value):void 0),className:"w-20"}),(0,t.jsx)("span",{className:"text-xs text-muted-foreground",children:"or"}),(0,t.jsx)(d.Input,{type:"number",step:"0.01",placeholder:"Flat $",value:void 0!==e.flat_amount&&null!==e.flat_amount?e.flat_amount:"",onChange:e=>eA(s,"flat_amount",e.target.value?parseFloat(e.target.value):void 0),className:"w-20"}),ec.length>1&&(0,t.jsx)(r.Button,{type:"button",variant:"ghost",size:"icon",onClick:()=>{eo(ec.filter((e,t)=>t!==s))},className:"h-8 w-8 text-destructive",children:(0,t.jsx)(M.Trash2,{className:"h-4 w-4"})})]},s))})]})]})]}),"introducer"===g&&A&&(0,t.jsxs)("div",{className:"space-y-4 p-4 rounded-lg border border-orange-500/30 bg-orange-500/5",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(B.Users,{className:"h-5 w-5 text-orange-400"}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("h4",{className:"font-medium text-orange-300",children:["Link Investor to ",eE(A)]}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:"Select an active agreement, then choose an investor to link"})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c.Label,{children:"Select Agreement (Term Sheet)"}),eu?(0,t.jsxs)("div",{className:"flex items-center gap-2 py-3",children:[(0,t.jsx)(j.Loader2,{className:"h-4 w-4 animate-spin text-muted-foreground"}),(0,t.jsx)("span",{className:"text-sm text-muted-foreground",children:"Loading agreements..."})]}):0===em.length?(0,t.jsx)("div",{className:"p-3 rounded-lg border border-amber-500/30 bg-amber-500/5 text-amber-300 text-sm",children:(0,t.jsxs)("div",{className:"flex items-start gap-2",children:[(0,t.jsx)(q.AlertCircle,{className:"h-4 w-4 mt-0.5"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-medium",children:"No active agreements for this introducer"}),(0,t.jsxs)("p",{className:"text-xs text-amber-300/80 mt-1",children:[eE(A)," has no signed agreements on this deal. Create and sign an introducer agreement in the Introducers tab first."]})]})]})}):(0,t.jsxs)(m.Select,{value:ep,onValueChange:eg,children:[(0,t.jsx)(m.SelectTrigger,{className:(0,z.cn)(ej&&"border-orange-500/50"),children:(0,t.jsx)(m.SelectValue,{placeholder:"Select an agreement"})}),(0,t.jsx)(m.SelectContent,{children:em.map(e=>(0,t.jsx)(m.SelectItem,{value:e.id,children:(0,t.jsxs)("div",{className:"flex flex-col",children:[(0,t.jsx)("span",{className:"font-medium",children:e.fee_plan_name}),(0,t.jsxs)("span",{className:"text-xs text-muted-foreground",children:["Term Sheet v",e.term_sheet_version," ",e.reference_number?`• ${e.reference_number}`:""]})]})},e.id))})]})]}),ej&&(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c.Label,{children:"Select Investor to Link"}),e_?(0,t.jsxs)("div",{className:"flex items-center gap-2 py-3",children:[(0,t.jsx)(j.Loader2,{className:"h-4 w-4 animate-spin text-muted-foreground"}),(0,t.jsx)("span",{className:"text-sm text-muted-foreground",children:"Loading eligible investors..."})]}):0===eb.length?(0,t.jsx)("div",{className:"p-3 rounded-lg border border-blue-500/30 bg-blue-500/5 text-blue-300 text-sm",children:(0,t.jsxs)("div",{className:"flex items-start gap-2",children:[(0,t.jsx)(q.AlertCircle,{className:"h-4 w-4 mt-0.5"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-medium",children:"No eligible investors"}),(0,t.jsxs)("p",{className:"text-xs text-blue-300/80 mt-1",children:["No investors on Term Sheet v",ej.term_sheet_version," are available to link. They may already be linked to an introducer, or you need to add investors to this term sheet first."]})]})]})}):(0,t.jsxs)(m.Select,{value:ey,onValueChange:ew,children:[(0,t.jsx)(m.SelectTrigger,{className:(0,z.cn)(ey&&"border-orange-500/50"),children:(0,t.jsx)(m.SelectValue,{placeholder:"Select an investor"})}),(0,t.jsx)(m.SelectContent,{children:eb.map(e=>(0,t.jsx)(m.SelectItem,{value:e.user_id,children:(0,t.jsxs)("div",{className:"flex flex-col",children:[(0,t.jsx)("span",{children:e.display_name}),e.email&&(0,t.jsx)("span",{className:"text-xs text-muted-foreground",children:e.email})]})},e.user_id))})]})]}),ej&&ey&&(0,t.jsx)("div",{className:"p-3 rounded-lg bg-emerald-500/10 border border-emerald-500/30",children:(0,t.jsxs)("div",{className:"flex items-start gap-2",children:[(0,t.jsx)("div",{className:"text-emerald-400 mt-0.5",children:"✓"}),(0,t.jsxs)("div",{className:"text-sm",children:[(0,t.jsx)("p",{className:"text-emerald-300 font-medium",children:"Ready to link"}),(0,t.jsxs)("p",{className:"text-emerald-300/80 text-xs mt-1",children:["This investor will be linked to ",(0,t.jsx)("strong",{children:eE(A)})," using the ",(0,t.jsx)("strong",{children:ej.fee_plan_name})," fee plan (Term Sheet v",ej.term_sheet_version,")."]})]})]})})]}),h&&(0,t.jsx)("div",{className:"p-3 rounded-lg bg-destructive/10 text-destructive text-sm",children:h}),(0,t.jsxs)("div",{className:"flex justify-end gap-2 pt-4",children:[(0,t.jsx)(r.Button,{variant:"outline",onClick:()=>o(!1),disabled:x,children:"Cancel"}),(0,t.jsx)(r.Button,{onClick:eP,disabled:x||!(()=>{if(!g)return!1;if("investor"===g)return!!A&&!!ea&&(!eC||!!R&&!!V?.can_dispatch&&!!Z)&&!0;return"introducer"===g?!!(ej&&ey):!!(A&&ei.trim())})(),children:x?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(j.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),"introducer"===g?"Linking...":"Adding..."]}):"introducer"===g?"Link Investor to Introducer":`Add ${e$?.label||"Participant"}`})]})]})]})]})}let X=[{key:"dispatched",label:"Dispatched",icon:D.Send,field:"dispatched_at"},{key:"viewed",label:"Viewed",icon:I.Eye,field:"viewed_at"},{key:"interest",label:"Interest",icon:_.TrendingUp,field:"interest_confirmed_at"},{key:"nda",label:"NDA",icon:L.FileSignature,field:"nda_signed_at"},{key:"data_room",label:"Data Room",icon:A.FolderOpen,field:"data_room_granted_at"},{key:"pack_gen",label:"Pack Gen",icon:u.FileText,field:"pack_generated_at",fromSubscription:!0},{key:"pack_sent",label:"Pack Sent",icon:P.Mail,field:"pack_sent_at",fromSubscription:!0},{key:"signed",label:"Signed",icon:E.CheckCircle2,field:"signed_at",fromSubscription:!0},{key:"funded",label:"Funded",icon:$.Wallet,field:"funded_at",fromSubscription:!0}];function Y(e){let t=e.subscription||null;for(let s=X.length-1;s>=0;s--){let a=X[s],r=null,l="fromSubscription"in a&&a.fromSubscription;if(l&&t?r=t[a.field]:l||(r=e[a.field]),r)return{stage:a.label,index:s}}return{stage:"Invited",index:-1}}function Z({member:e}){let{index:s}=Y(e),a=e.subscription||null;return(0,t.jsx)("div",{className:"flex items-center gap-1",children:X.map((r,l)=>{let n=null,i="fromSubscription"in r&&r.fromSubscription;i&&a?n=a[r.field]:i||(n=e[r.field]);let d=!!n;return(0,t.jsx)("div",{className:`w-6 h-6 rounded-full flex items-center justify-center text-xs transition-colors ${d?"bg-green-500/30 text-green-400 border border-green-500/50":l===s?"bg-yellow-500/30 text-yellow-400 border border-yellow-500/50":"bg-muted text-muted-foreground"}`,title:`${r.label}${n?` - ${(0,T.format)(new Date(n),"MMM d, yyyy")}`:""}`,children:(0,t.jsx)(r.icon,{className:"h-3 w-3"})},r.key)})})}function ee({dealId:e,members:n,subscriptions:i=[]}){let d=(0,b.useRouter)(),[c,o]=(0,s.useState)(n),[x,u]=(0,s.useState)([]),[h,p]=(0,s.useState)(!0),[g,f]=(0,s.useState)(null),[v,N]=(0,s.useState)(null),[w,C]=(0,s.useState)("all"),S=new Map(i.map(e=>[e.investor_id,e])),k=c.filter(e=>!["lawyer","arranger"].includes(e.role)).map(e=>({...e,subscription:e.investor_id?S.get(e.investor_id):null})),T=k.reduce((e,t)=>{let s=t.assigned_fee_plan;return s&&!e.find(e=>e.id===s.id)&&e.push({id:s.id,name:s.name}),e},[]),D="all"===w?k:"none"===w?k.filter(e=>!e.assigned_fee_plan):k.filter(e=>e.assigned_fee_plan?.id===w);(0,s.useEffect)(()=>{o(n)},[n]);let L=async()=>{p(!0),f(null);try{let t=await fetch(`/api/deals/${e}/partners`);if(!t.ok){let e=await t.json().catch(()=>({}));throw Error(e.error||"Failed to load partner assignments")}let s=await t.json();u(s.data||[])}catch(e){console.error("Failed to fetch partner assignments:",e),f(e instanceof Error?e.message:"Failed to load partner assignments")}finally{p(!1)}};(0,s.useEffect)(()=>{L()},[e]);let A=async t=>{if(confirm("Are you sure you want to remove this partner from this deal?")){N(t);try{let s=await fetch(`/api/deals/${e}/partners?fee_plan_id=${t}`,{method:"DELETE"});if(s.ok)await L(),d.refresh();else{let e=await s.json();alert(e.error||"Failed to remove partner")}}catch(e){console.error("Failed to remove partner:",e),alert("Failed to remove partner")}finally{N(null)}}},E={subscription:"Subscription Fee",management:"Management Fee",performance:"Performance Fee",spread_markup:"Spread Markup",flat:"Flat Fee",other:"Other"},$={draft:"bg-slate-100 dark:bg-slate-500/20 text-slate-700 dark:text-slate-300",sent:"bg-blue-100 dark:bg-blue-500/20 text-blue-700 dark:text-blue-300",pending_signature:"bg-amber-100 dark:bg-amber-500/20 text-amber-700 dark:text-amber-300",accepted:"bg-emerald-100 dark:bg-emerald-500/20 text-emerald-700 dark:text-emerald-300",rejected:"bg-red-100 dark:bg-red-500/20 text-red-700 dark:text-red-300"},q=async()=>{try{let t=await fetch(`/api/deals/${e}/members`);if(t.ok){let e=await t.json();o(e.members||[])}}catch(e){console.error("Failed to refresh members:",e)}},z=async t=>{if(confirm("Are you sure you want to remove this member from the deal?"))try{let s=await fetch(`/api/deals/${e}/members/${t}`,{method:"DELETE"});if(s.ok)await q();else{let e=await s.json();alert(`Failed to remove member: ${e.error||"Unknown error"}`)}}catch(e){console.error("Failed to remove member:",e),alert("Failed to remove member. Please try again.")}},G={investor:"bg-emerald-100 dark:bg-emerald-500/20 text-emerald-700 dark:text-emerald-200",co_investor:"bg-blue-100 dark:bg-blue-500/20 text-blue-700 dark:text-blue-200",partner_investor:"bg-purple-100 dark:bg-purple-500/20 text-purple-700 dark:text-purple-200",introducer_investor:"bg-orange-100 dark:bg-orange-500/20 text-orange-700 dark:text-orange-200",commercial_partner_investor:"bg-teal-100 dark:bg-teal-500/20 text-teal-700 dark:text-teal-200",advisor:"bg-purple-100 dark:bg-purple-500/20 text-purple-700 dark:text-purple-200",banker:"bg-cyan-100 dark:bg-cyan-500/20 text-cyan-700 dark:text-cyan-200",introducer:"bg-pink-100 dark:bg-pink-500/20 text-pink-700 dark:text-pink-200",verso_staff:"bg-muted text-muted-foreground",viewer:"bg-muted text-muted-foreground"},Q={total:k.length,dispatched:k.filter(e=>e.dispatched_at).length,viewed:k.filter(e=>e.viewed_at).length,interested:k.filter(e=>e.interest_confirmed_at).length,ndaSigned:k.filter(e=>e.nda_signed_at).length,dataRoom:k.filter(e=>e.data_room_granted_at).length,packGen:k.filter(e=>e.subscription?.pack_generated_at).length,packSent:k.filter(e=>e.subscription?.pack_sent_at).length,signed:k.filter(e=>e.subscription?.signed_at).length,funded:k.filter(e=>e.subscription?.funded_at).length};return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)(a.Card,{className:"border border-border bg-muted/50",children:[(0,t.jsx)(a.CardHeader,{className:"pb-3",children:(0,t.jsxs)(a.CardTitle,{className:"text-sm font-medium flex items-center gap-2",children:[(0,t.jsx)(_.TrendingUp,{className:"h-4 w-4"}),"Investor Journey Funnel"]})}),(0,t.jsx)(a.CardContent,{children:(0,t.jsx)("div",{className:"flex items-center gap-2 overflow-x-auto pb-2",children:[{label:"Dispatched",count:Q.dispatched},{label:"Viewed",count:Q.viewed},{label:"Interested",count:Q.interested},{label:"NDA",count:Q.ndaSigned},{label:"Data Room",count:Q.dataRoom},{label:"Pack Gen",count:Q.packGen},{label:"Pack Sent",count:Q.packSent},{label:"Signed",count:Q.signed},{label:"Funded",count:Q.funded}].map((e,s)=>(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsxs)("div",{className:"text-center min-w-[70px]",children:[(0,t.jsx)("div",{className:"text-xl font-bold",children:e.count}),(0,t.jsx)("div",{className:"text-xs text-muted-foreground",children:e.label})]}),s<8&&(0,t.jsx)("div",{className:"mx-1 text-muted-foreground",children:"→"})]},e.label))})})]}),(0,t.jsxs)(a.Card,{className:"border border-border bg-muted/50",children:[(0,t.jsx)(a.CardHeader,{children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)(a.CardTitle,{className:"text-foreground flex items-center gap-2",children:[(0,t.jsx)(B.Users,{className:"h-5 w-5"}),"Deal Participants (",k.length+x.length,")"]}),(0,t.jsx)(a.CardDescription,{children:"Investors, partners, introducers, and other participants in this deal"})]}),(0,t.jsx)("div",{className:"flex items-center gap-2",children:(0,t.jsx)(W,{dealId:e,onParticipantAdded:()=>{q(),L()}})})]})}),(0,t.jsxs)(a.CardContent,{className:"space-y-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,t.jsxs)("h3",{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[(0,t.jsx)(O.UserCircle,{className:"h-4 w-4"}),"Investors (",D.length,"all"!==w?` of ${k.length}`:"",")"]}),T.length>0&&(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{className:"text-xs text-muted-foreground",children:"Filter by Fee Plan:"}),(0,t.jsxs)(m.Select,{value:w,onValueChange:C,children:[(0,t.jsx)(m.SelectTrigger,{className:"w-[200px] h-8 text-sm",children:(0,t.jsx)(m.SelectValue,{placeholder:"All Fee Plans"})}),(0,t.jsxs)(m.SelectContent,{children:[(0,t.jsx)(m.SelectItem,{value:"all",children:"All Fee Plans"}),(0,t.jsx)(m.SelectItem,{value:"none",children:"No Fee Plan (Direct)"}),T.map(e=>(0,t.jsx)(m.SelectItem,{value:e.id,children:e.name},e.id))]})]})]})]}),0===D.length?(0,t.jsx)("div",{className:"text-center py-6 text-muted-foreground border border-dashed border-border rounded-lg",children:"all"!==w?"No investors match the selected fee plan filter.":'No investors added yet. Click "Add Participant" to invite investors.'}):(0,t.jsxs)(F.Table,{children:[(0,t.jsx)(F.TableHeader,{children:(0,t.jsxs)(F.TableRow,{children:[(0,t.jsx)(F.TableHead,{children:"Member"}),(0,t.jsx)(F.TableHead,{children:"Role"}),(0,t.jsx)(F.TableHead,{children:"Referred By"}),(0,t.jsx)(F.TableHead,{children:"Fee Plan"}),(0,t.jsx)(F.TableHead,{children:"Journey Progress"}),(0,t.jsx)(F.TableHead,{children:"Current Stage"}),(0,t.jsx)(F.TableHead,{className:"text-right",children:"Actions"})]})}),(0,t.jsx)(F.TableBody,{children:D.map(e=>{let s,a=Array.isArray(e.profiles)?e.profiles[0]:e.profiles,n=Array.isArray(e.investors)?e.investors[0]:e.investors,{stage:i}=Y(e),d=(s=e.assigned_fee_plan)?s.introducer?{type:"Introducer",name:s.introducer.company_name||s.introducer.name,icon:B.Users}:s.partner?{type:"Partner",name:s.partner.company_name||s.partner.name,icon:y.Building2}:s.commercial_partner?{type:"Commercial Partner",name:s.commercial_partner.company_name||s.commercial_partner.name,icon:U.Briefcase}:null:null,c=e.assigned_fee_plan;return(0,t.jsxs)(F.TableRow,{children:[(0,t.jsx)(F.TableCell,{children:(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"font-medium",children:n?.legal_name||a?.display_name||"Unknown"}),(0,t.jsx)("div",{className:"text-sm text-muted-foreground",children:a?.email}),n?.kyc_status&&(0,t.jsxs)(l.Badge,{variant:"outline",className:`text-xs mt-1 ${"approved"===n.kyc_status?"bg-green-500/20 text-green-400":"pending"===n.kyc_status?"bg-yellow-500/20 text-yellow-400":""}`,children:["KYC: ",n.kyc_status]})]})}),(0,t.jsx)(F.TableCell,{children:(0,t.jsx)(l.Badge,{className:G[e.role]||"bg-muted text-foreground",children:e.role?.replace(/_/g," ")})}),(0,t.jsx)(F.TableCell,{children:d?(0,t.jsxs)("div",{className:"flex items-center gap-1.5 text-sm",children:[(0,t.jsx)(d.icon,{className:"h-3.5 w-3.5 text-muted-foreground"}),(0,t.jsx)("span",{className:"text-muted-foreground",children:d.name})]}):(0,t.jsx)("span",{className:"text-xs text-muted-foreground/60",children:"Direct"})}),(0,t.jsx)(F.TableCell,{children:c?(0,t.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,t.jsx)("span",{className:"text-sm",children:c.name}),(0,t.jsx)(l.Badge,{className:`text-[10px] w-fit ${$[c.status]||"bg-muted text-muted-foreground"}`,children:c.status})]}):(0,t.jsx)("span",{className:"text-xs text-muted-foreground/60",children:"—"})}),(0,t.jsx)(F.TableCell,{children:(0,t.jsx)(Z,{member:e})}),(0,t.jsx)(F.TableCell,{children:(0,t.jsx)(l.Badge,{variant:"outline",children:i})}),(0,t.jsx)(F.TableCell,{className:"text-right",children:(0,t.jsxs)(V.DropdownMenu,{children:[(0,t.jsx)(V.DropdownMenuTrigger,{asChild:!0,children:(0,t.jsx)(r.Button,{variant:"ghost",size:"icon",className:"h-8 w-8",children:(0,t.jsx)(H.MoreHorizontal,{className:"h-4 w-4"})})}),(0,t.jsxs)(V.DropdownMenuContent,{align:"end",children:[(0,t.jsx)(V.DropdownMenuLabel,{children:"Actions"}),(0,t.jsx)(V.DropdownMenuSeparator,{}),n&&(0,t.jsx)(V.DropdownMenuItem,{asChild:!0,children:(0,t.jsxs)("a",{href:`/versotech_main/investors/${n.id}`,children:[(0,t.jsx)(I.Eye,{className:"mr-2 h-4 w-4"}),"View Investor"]})}),a?.email&&(0,t.jsxs)(V.DropdownMenuItem,{onClick:()=>window.location.href=`mailto:${a.email}`,children:[(0,t.jsx)(P.Mail,{className:"mr-2 h-4 w-4"}),"Send Email"]}),(0,t.jsx)(V.DropdownMenuSeparator,{}),(0,t.jsxs)(V.DropdownMenuItem,{className:"text-red-400",onClick:()=>z(e.user_id),children:[(0,t.jsx)(M.Trash2,{className:"mr-2 h-4 w-4"}),"Remove Member"]})]})]})})]},e.user_id)})})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("h3",{className:"text-sm font-medium text-muted-foreground mb-3 flex items-center gap-2",children:[(0,t.jsx)(R.UserPlus,{className:"h-4 w-4"}),"Partners & Intermediaries (",x.length,")"]}),h?(0,t.jsx)("div",{className:"flex items-center justify-center py-6",children:(0,t.jsx)(j.Loader2,{className:"h-5 w-5 animate-spin text-muted-foreground"})}):g?(0,t.jsxs)("div",{className:"text-center py-6 text-red-400 border border-dashed border-red-500/20 rounded-lg bg-red-500/5",children:[g,(0,t.jsx)(r.Button,{variant:"ghost",size:"sm",onClick:L,className:"ml-2 text-red-400 hover:text-red-300",children:"Retry"})]}):0===x.length?(0,t.jsx)("div",{className:"text-center py-6 text-muted-foreground border border-dashed border-border rounded-lg",children:'No partners assigned yet. Click "Add Participant" to add partners, introducers, or commercial partners.'}):(0,t.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:x.map(e=>(0,t.jsx)("div",{className:"p-3 rounded-lg border border-border bg-muted/50",children:(0,t.jsxs)("div",{className:"flex items-start justify-between",children:[(0,t.jsxs)("div",{className:"flex items-start gap-3",children:[(0,t.jsx)("div",{className:"p-2 rounded-lg bg-primary/10",children:(e=>{switch(e){case"partner":default:return(0,t.jsx)(y.Building2,{className:"h-4 w-4"});case"introducer":return(0,t.jsx)(B.Users,{className:"h-4 w-4"});case"commercial_partner":return(0,t.jsx)(U.Briefcase,{className:"h-4 w-4"})}})(e.entity_type)}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"font-medium text-sm",children:e.entity_name}),(0,t.jsx)("div",{className:"flex items-center gap-2 mt-1",children:(0,t.jsx)(l.Badge,{variant:"outline",className:"text-xs",children:(e=>{switch(e){case"partner":return"Partner";case"introducer":return"Introducer";case"commercial_partner":return"Commercial Partner";default:return e}})(e.entity_type)})}),(0,t.jsx)("div",{className:"text-xs text-muted-foreground mt-1",children:e.fee_components.length>0?e.fee_components.map(e=>(0,t.jsxs)("span",{className:"mr-2",children:[E[e.kind]||e.kind,": ",null!==e.rate_bps&&void 0!==e.rate_bps?`${e.rate_bps/100}%`:null!==e.flat_amount&&void 0!==e.flat_amount?`$${e.flat_amount}`:"—"]},e.id)):(0,t.jsx)("span",{className:"italic",children:"No fees defined"})})]})]}),(0,t.jsx)(r.Button,{variant:"ghost",size:"icon",onClick:()=>A(e.fee_plan_id),disabled:v===e.fee_plan_id,className:"text-destructive hover:text-destructive h-7 w-7",children:v===e.fee_plan_id?(0,t.jsx)(j.Loader2,{className:"h-3 w-3 animate-spin"}):(0,t.jsx)(M.Trash2,{className:"h-3 w-3"})})]})},e.fee_plan_id))})]})]})]})]})}var et=e.i(80465),es=e.i(645855),ea=e.i(745083),er=e.i(761722),el=e.i(994500),en=e.i(786560);function ei({dealId:e,feePlans:n}){let i=(0,b.useRouter)(),[d,c]=(0,s.useState)(!1),[o,m]=(0,s.useState)(null),[x,h]=(0,s.useState)(null),[p,f]=(0,s.useState)(null),v=async(e,t)=>{f(e);try{let s=await fetch(`/api/storage/download?path=${encodeURIComponent(e)}&bucket=deal-documents`);if(!s.ok)throw Error("Failed to download file");let a=await s.blob(),r=window.URL.createObjectURL(a),l=document.createElement("a");l.href=r,l.download=e.split("/").pop()||`${t||"agreement"}.pdf`,document.body.appendChild(l),l.click(),document.body.removeChild(l),window.URL.revokeObjectURL(r),el.toast.success("PDF downloaded successfully")}catch(e){console.error("Error downloading PDF:",e),el.toast.error("Failed to download PDF")}finally{f(null)}},_=async e=>{try{let t=await fetch(`/api/storage/download?path=${encodeURIComponent(e)}&bucket=deal-documents`);if(!t.ok)throw Error("Failed to load file");let s=await t.blob(),a=window.URL.createObjectURL(s);window.open(a,"_blank")}catch(e){console.error("Error previewing PDF:",e),el.toast.error("Failed to preview PDF")}},w={subscription:"Subscription Fee",management:"Management Fee",performance:"Performance Fee",spread_markup:"Spread Markup",flat:"Flat Fee",other:"Other"},S=e=>{m({...e,components:e.fee_components||[]}),c(!0)},k=async e=>{if(e.introducer_id){h(e.id);try{let t=await fetch(`/api/staff/fees/plans/${e.id}/generate-agreement`,{method:"POST"});if(!t.ok){let e=await t.json();alert(`Failed to generate agreement: ${e.error||"Unknown error"}`);return}alert("Introducer Agreement generated successfully!"),i.refresh()}catch(e){console.error("Error generating introducer agreement:",e),alert("Failed to generate agreement")}finally{h(null)}}},T=async e=>{if(e.partner_id){h(e.id);try{let t=await fetch(`/api/staff/fees/plans/${e.id}/generate-placement-agreement`,{method:"POST"});if(!t.ok){let e=await t.json();alert(`Failed to generate placement agreement: ${e.error||"Unknown error"}`);return}alert("Placement Agreement generated successfully!"),i.refresh()}catch(e){console.error("Error generating placement agreement:",e),alert("Failed to generate placement agreement")}finally{h(null)}}},F=async e=>{e.introducer_id?await k(e):e.partner_id&&await T(e)};return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)(a.Card,{className:"border border-border bg-muted/50",children:[(0,t.jsx)(a.CardHeader,{children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)(a.CardTitle,{className:"text-foreground flex items-center gap-2",children:[(0,t.jsx)(N.DollarSign,{className:"h-5 w-5"}),"Fee Plans"]}),(0,t.jsx)(a.CardDescription,{children:"Configure fee structures for investors"})]}),(0,t.jsxs)(r.Button,{onClick:()=>{m(null),c(!0)},className:"gap-2",children:[(0,t.jsx)(C.Plus,{className:"h-4 w-4"}),"Create Fee Plan"]})]})}),(0,t.jsx)(a.CardContent,{children:n&&0!==n.length?(0,t.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:n.map(e=>{let s=e.introducer_id?{type:"Introducer",icon:(0,t.jsx)(B.Users,{className:"h-4 w-4 text-blue-400"}),name:e.introducer?.legal_name||e.introducer?.name||e.introducer?.company_name||"Unknown"}:e.partner_id?{type:"Partner",icon:(0,t.jsx)(y.Building2,{className:"h-4 w-4 text-green-400"}),name:e.partner?.name||e.partner?.legal_name||e.partner?.company_name||"Unknown"}:e.commercial_partner_id?{type:"Commercial Partner",icon:(0,t.jsx)(U.Briefcase,{className:"h-4 w-4 text-purple-400"}),name:e.commercial_partner?.name||e.commercial_partner?.legal_name||e.commercial_partner?.company_name||"Unknown"}:null;return(0,t.jsxs)(a.Card,{className:"border border-border bg-muted/50",children:[(0,t.jsxs)(a.CardHeader,{children:[(0,t.jsxs)("div",{className:"flex items-start justify-between",children:[(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,t.jsx)(a.CardTitle,{className:"text-lg text-foreground",children:e.name}),(e=>{switch(e.status||"draft"){case"accepted":return(0,t.jsxs)(l.Badge,{className:"bg-green-100 dark:bg-green-500/20 text-green-700 dark:text-green-400 border-green-300 dark:border-green-500/30",children:[(0,t.jsx)(et.CheckCircle,{className:"h-3 w-3 mr-1"}),"Accepted"]});case"sent":case"pending_signature":return(0,t.jsxs)(l.Badge,{className:"bg-amber-100 dark:bg-amber-500/20 text-amber-700 dark:text-amber-400 border-amber-300 dark:border-amber-500/30",children:[(0,t.jsx)(es.Clock,{className:"h-3 w-3 mr-1"}),"Pending"]});case"rejected":return(0,t.jsxs)(l.Badge,{className:"bg-red-100 dark:bg-red-500/20 text-red-700 dark:text-red-400 border-red-300 dark:border-red-500/30",children:[(0,t.jsx)(ea.XCircle,{className:"h-3 w-3 mr-1"}),"Rejected"]});default:return(0,t.jsx)(l.Badge,{variant:"outline",className:"border-border text-muted-foreground",children:"Draft"})}})(e)]}),e.description&&(0,t.jsx)(a.CardDescription,{className:"mt-1",children:e.description})]}),(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(!!e.introducer_id&&!e.generated_agreement_id||!!e.partner_id&&!e.generated_placement_agreement_id)&&(0,t.jsx)(r.Button,{variant:"ghost",size:"sm",onClick:()=>F(e),disabled:x===e.id,className:"text-green-400 hover:text-green-300",title:e.introducer_id?"Generate Introducer Agreement (DOC 3)":e.partner_id?"Generate Placement Agreement":"",children:x===e.id?(0,t.jsx)(j.Loader2,{className:"h-4 w-4 animate-spin"}):(0,t.jsx)(L.FileSignature,{className:"h-4 w-4"})}),(!!e.introducer_id&&!!e.generated_agreement_id||!!e.partner_id&&!!e.generated_placement_agreement_id)&&(0,t.jsx)(l.Badge,{className:"bg-green-500/20 text-green-400 border-green-500/30 text-xs",children:"Agreement Generated"}),(0,t.jsx)(r.Button,{variant:"ghost",size:"sm",onClick:()=>S(e),className:"text-blue-400 hover:text-blue-300",children:(0,t.jsx)(g.Edit,{className:"h-4 w-4"})})]})]}),(0,t.jsxs)("div",{className:"mt-3 space-y-2",children:[e.term_sheet_id&&e.term_sheet&&(0,t.jsxs)("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[(0,t.jsx)(u.FileText,{className:"h-4 w-4 text-muted-foreground"}),(0,t.jsxs)("span",{children:["Term Sheet v",e.term_sheet.version,e.term_sheet.term_sheet_date&&(0,t.jsxs)("span",{className:"text-muted-foreground ml-1",children:["(",new Date(e.term_sheet.term_sheet_date).toLocaleDateString(),")"]})]})]}),!e.term_sheet_id&&(0,t.jsxs)("div",{className:"flex items-center gap-2 text-sm text-amber-400",children:[(0,t.jsx)(u.FileText,{className:"h-4 w-4"}),(0,t.jsx)("span",{children:"No term sheet linked"})]}),s&&(0,t.jsxs)("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[s.icon,(0,t.jsxs)("span",{children:[s.type,": ",s.name]})]}),!s&&(0,t.jsxs)("div",{className:"flex items-center gap-2 text-sm text-amber-400",children:[(0,t.jsx)(B.Users,{className:"h-4 w-4"}),(0,t.jsx)("span",{children:"No entity linked"})]}),e.accepted_at&&(0,t.jsxs)("div",{className:"flex items-center gap-2 text-sm text-green-400",children:[(0,t.jsx)(et.CheckCircle,{className:"h-4 w-4"}),(0,t.jsxs)("span",{children:["Accepted ",new Date(e.accepted_at).toLocaleDateString()]})]})]})]}),(0,t.jsxs)(a.CardContent,{className:"space-y-3",children:[e.fee_components&&e.fee_components.length>0?(0,t.jsx)("div",{className:"space-y-2",children:e.fee_components.map(e=>(0,t.jsxs)("div",{className:"flex items-center justify-between py-2 px-3 rounded bg-muted/50",children:[(0,t.jsx)("span",{className:"text-sm text-foreground",children:w[e.kind]}),(0,t.jsx)(l.Badge,{variant:"outline",className:"border-border text-muted-foreground",children:e.rate_bps?`${e.rate_bps/100}%`:e.flat_amount?`$${e.flat_amount}`:"—"})]},e.id))}):(0,t.jsxs)("div",{className:"text-center py-4",children:[(0,t.jsx)("p",{className:"text-sm text-muted-foreground mb-2",children:"No components added yet"}),(0,t.jsx)(r.Button,{variant:"outline",size:"sm",onClick:()=>S(e),className:"text-xs",children:"Add Components"})]}),(()=>{let{pdfUrl:s,referenceNumber:a}=e.introducer_agreement?.pdf_url?{pdfUrl:e.introducer_agreement.pdf_url,referenceNumber:e.introducer_agreement.reference_number}:e.placement_agreement?.pdf_url?{pdfUrl:e.placement_agreement.pdf_url,referenceNumber:e.placement_agreement.reference_number}:{pdfUrl:null,referenceNumber:null};return s?(0,t.jsx)("div",{className:"mt-4 pt-4 border-t border-border",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("div",{className:"p-2 rounded-lg bg-green-500/10",children:(0,t.jsx)(u.FileText,{className:"h-5 w-5 text-green-400"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm font-medium text-foreground",children:e.introducer_id?"Introducer Agreement":"Placement Agreement"}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:a||"Document ready"})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsxs)(r.Button,{variant:"outline",size:"sm",onClick:()=>_(s),className:"text-blue-400 border-blue-400/30 hover:bg-blue-400/10",children:[(0,t.jsx)(I.Eye,{className:"h-4 w-4 mr-1"}),"Preview"]}),(0,t.jsxs)(r.Button,{variant:"outline",size:"sm",onClick:()=>v(s,a),disabled:p===s,className:"text-green-400 border-green-400/30 hover:bg-green-400/10",children:[p===s?(0,t.jsx)(j.Loader2,{className:"h-4 w-4 mr-1 animate-spin"}):(0,t.jsx)(er.Download,{className:"h-4 w-4 mr-1"}),"Download"]})]})]})}):null})()]})]},e.id)})}):(0,t.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:'No fee plans created yet. Click "Create Fee Plan" to begin.'})})]}),(0,t.jsx)(en.default,{open:d,onClose:()=>{c(!1),m(null)},onSuccess:()=>{c(!1),m(null),i.refresh()},feePlan:o,dealId:e})]})}var ed=e.i(264653),ec=e.i(838668),eo=e.i(312692),em=e.i(937368),ex=e.i(396064),eu=e.i(557176),eh=e.i(432598);let ep=["Term Sheets","Data Room","Subscription Documents","Legal Documents","Financial Reports","Due Diligence"];function eg({dealId:e,onUploadComplete:a,trigger:l}){let n=(0,b.useRouter)(),[o,x]=(0,s.useState)(!1),[u,h]=(0,s.useState)([]),[p,g]=(0,s.useState)([]),[f,v]=(0,s.useState)(null),[_,N]=(0,s.useState)("Data Room"),[y,w]=(0,s.useState)(!1),[C,S]=(0,s.useState)(!1),[k,T]=(0,s.useState)(!1),[F,D]=(0,s.useState)(0),[I,L]=(0,s.useState)("file"),[P,E]=(0,s.useState)(""),[$,B]=(0,s.useState)(""),[M,H]=(0,s.useState)(!1),U=(0,s.useCallback)(async()=>{H(!0);try{let t=await fetch(`/api/deals/${e}/folders`);if(t.ok){let e=await t.json();g(e.folders||[]);let s=e.folders?.find(e=>"Data Room"===e.name||e.path?.includes("/Data Room"));s?(v(s.id),N("Data Room")):e.folders?.length>0&&(v(e.folders[0].id),N(e.folders[0].name))}else console.warn("Could not fetch deal folders, using defaults")}catch(e){console.error("Error fetching deal folders:",e)}finally{H(!1)}},[e]);(0,s.useEffect)(()=>{o&&e&&U()},[o,e,U]);let R=(0,s.useCallback)(e=>{h(t=>[...t,...e])},[]),{getRootProps:O,getInputProps:V,isDragActive:q}=(0,ec.useDropzone)({onDrop:R,multiple:!0}),z=async()=>{if("file"===I&&0===u.length)return void el.toast.error("Please select files to upload");if("link"===I){if(!P.trim())return void el.toast.error("Please enter a link");if(!$.trim())return void el.toast.error("Please enter a document name")}T(!0),D(0);try{if("link"===I){let t=await fetch(`/api/deals/${e}/documents/link`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({external_link:P,file_name:$,folder:_,folder_id:f,visible_to_investors:y,is_featured:C})});if(t.ok)el.toast.success("Link added successfully");else{let e=await t.json();el.toast.error(`Failed to add link: ${e.error}`)}D(100)}else{let t=0;for(let s=0;s<u.length;s++){let a=u[s],r=new FormData;r.append("file",a),r.append("folder",_),f&&r.append("folder_id",f),r.append("visible_to_investors",y.toString()),r.append("is_featured",C.toString());let l=await fetch(`/api/deals/${e}/documents/upload`,{method:"POST",body:r});if(!l.ok){let e=await l.json();el.toast.error(`Failed to upload ${a.name}: ${e.error}`);continue}t++,D(Math.round((s+1)/u.length*100))}el.toast.success(`Successfully uploaded ${t} of ${u.length} files`)}h([]),N("Legal"),w(!1),S(!1),E(""),B(""),x(!1),a?.(),n.refresh()}catch(e){console.error("Upload error:",e),el.toast.error("Failed to upload documents")}finally{T(!1),D(0)}};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{onClick:()=>x(!0),children:l}),(0,t.jsx)(i.Dialog,{open:o,onOpenChange:x,children:(0,t.jsxs)(i.DialogContent,{className:"sm:max-w-2xl",children:[(0,t.jsxs)(i.DialogHeader,{children:[(0,t.jsx)(i.DialogTitle,{children:"Add Documents"}),(0,t.jsx)(i.DialogDescription,{children:"Upload files or add links to external documents (Google Drive, Dropbox, etc.)"})]}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex gap-2 border-b",children:[(0,t.jsx)(r.Button,{variant:"file"===I?"default":"ghost",onClick:()=>L("file"),className:"flex-1",children:"Upload Files"}),(0,t.jsx)(r.Button,{variant:"link"===I?"default":"ghost",onClick:()=>L("link"),className:"flex-1",children:"Add Link"})]}),"file"===I?(0,t.jsx)(t.Fragment,{children:(0,t.jsxs)("div",{...O(),className:`border-2 border-dashed rounded-lg p-8 text-center cursor-pointer transition-colors ${q?"border-blue-500 bg-blue-500/10":"border-border hover:border-muted-foreground"}`,children:[(0,t.jsx)("input",{...V()}),(0,t.jsx)(ex.Upload,{className:"h-12 w-12 mx-auto mb-4 text-muted-foreground"}),q?(0,t.jsx)("p",{className:"text-blue-600 dark:text-blue-400 font-medium",children:"Drop files here..."}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("p",{className:"text-foreground font-medium mb-1",children:"Drag and drop files here, or click to browse"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Supports all document types (PDF, DOCX, XLSX, JSON, etc.)"})]})]})}):(0,t.jsx)(t.Fragment,{children:(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c.Label,{htmlFor:"linkUrl",children:"Document Link"}),(0,t.jsx)(d.Input,{id:"linkUrl",type:"url",value:P,onChange:e=>E(e.target.value),placeholder:"https://drive.google.com/file/d/..."}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:"Paste a Google Drive, Dropbox, or any public link"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c.Label,{htmlFor:"linkName",children:"Document Name"}),(0,t.jsx)(d.Input,{id:"linkName",value:$,onChange:e=>B(e.target.value),placeholder:"Q4 2024 Report"})]})]})}),"file"===I&&u.length>0&&(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)(c.Label,{children:["Selected Files (",u.length,")"]}),(0,t.jsx)("div",{className:"max-h-48 overflow-y-auto space-y-2",children:u.map((e,s)=>(0,t.jsxs)("div",{className:"flex items-center justify-between p-2 bg-muted rounded border border-border",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[(0,t.jsx)(eu.File,{className:"h-4 w-4 text-muted-foreground flex-shrink-0"}),(0,t.jsx)("span",{className:"text-sm truncate",children:e.name}),(0,t.jsxs)("span",{className:"text-xs text-muted-foreground flex-shrink-0",children:["(",(e.size/1024).toFixed(1)," KB)"]})]}),(0,t.jsx)(r.Button,{variant:"ghost",size:"sm",onClick:()=>{h(e=>e.filter((e,t)=>t!==s))},disabled:k,children:(0,t.jsx)(eh.X,{className:"h-4 w-4"})})]},s))})]}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c.Label,{children:"Folder"}),(0,t.jsxs)(m.Select,{value:f||_,onValueChange:e=>{let t=p.find(t=>t.id===e);t?(v(t.id),N(t.name)):(v(null),N(e))},disabled:k||M,children:[(0,t.jsx)(m.SelectTrigger,{children:(0,t.jsx)(m.SelectValue,{placeholder:M?"Loading folders...":"Select folder"})}),(0,t.jsx)(m.SelectContent,{children:p.length>0?p.map(e=>(0,t.jsx)(m.SelectItem,{value:e.id,children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(A.FolderOpen,{className:"h-3 w-3"}),(0,t.jsx)("span",{children:e.name})]})},e.id)):ep.map(e=>(0,t.jsx)(m.SelectItem,{value:e,children:e},e))})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)(eo.Checkbox,{id:"visible",checked:y,onCheckedChange:e=>w(e),disabled:k}),(0,t.jsx)("label",{htmlFor:"visible",className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:"Visible to investors"})]}),(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)(eo.Checkbox,{id:"featured",checked:C,onCheckedChange:e=>S(e),disabled:k}),(0,t.jsx)("label",{htmlFor:"featured",className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:"Featured document"})]})]})]}),k&&(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,t.jsx)("span",{children:"Uploading..."}),(0,t.jsxs)("span",{children:[F,"%"]})]}),(0,t.jsx)(em.Progress,{value:F})]}),(0,t.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,t.jsx)(r.Button,{variant:"outline",onClick:()=>x(!1),disabled:k,children:"Cancel"}),(0,t.jsxs)(r.Button,{onClick:z,disabled:k||"file"===I&&0===u.length,children:[k&&(0,t.jsx)(j.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),"link"===I?"Add Link":`Upload ${u.length>0?`(${u.length})`:""}`]})]})]})]})})]})}let ej=["Legal","KYC","Reports","Presentations","Financial Models","Misc"];function ef({dealId:e,documentId:a,open:n,onOpenChange:x,onSaved:u,initialData:h}){let[p,g]=(0,s.useState)(h?.file_name||""),[f,b]=(0,s.useState)(h?.folder||"Legal"),[v,_]=(0,s.useState)(h?.visible_to_investors||!1),[N,y]=(0,s.useState)(h?.tags||[]),[w,C]=(0,s.useState)(""),[S,k]=(0,s.useState)(h?.document_notes||""),[T,F]=(0,s.useState)(h?.document_expires_at?new Date(h.document_expires_at).toISOString().slice(0,16):""),[D,I]=(0,s.useState)(!1);(0,s.useEffect)(()=>{h&&(g(h.file_name||""),b(h.folder||"Legal"),_(h.visible_to_investors||!1),y(h.tags||[]),k(h.document_notes||""),F(h.document_expires_at?new Date(h.document_expires_at).toISOString().slice(0,16):""))},[h,n]);let L=()=>{let e=w.trim();e&&!N.includes(e)&&(y([...N,e]),C(""))},A=async()=>{I(!0);try{let t=await fetch(`/api/deals/${e}/documents/${a}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({file_name:p,folder:f,visible_to_investors:v,tags:N,document_notes:S||null,document_expires_at:T?new Date(T).toISOString():null})});if(!t.ok){let e=await t.json();throw Error(e.error||"Failed to update document")}el.toast.success("Document metadata updated successfully"),x(!1),u&&u()}catch(e){console.error("Save error:",e),el.toast.error(e instanceof Error?e.message:"Failed to save changes")}finally{I(!1)}};return(0,t.jsx)(i.Dialog,{open:n,onOpenChange:x,children:(0,t.jsxs)(i.DialogContent,{className:"sm:max-w-2xl max-h-[90vh] overflow-y-auto",children:[(0,t.jsxs)(i.DialogHeader,{children:[(0,t.jsx)(i.DialogTitle,{children:"Edit Document Metadata"}),(0,t.jsx)(i.DialogDescription,{children:"Update document details, visibility, tags, and expiry settings."})]}),(0,t.jsxs)("div",{className:"space-y-4 py-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c.Label,{htmlFor:"fileName",children:"File Name"}),(0,t.jsx)(d.Input,{id:"fileName",value:p,onChange:e=>g(e.target.value),placeholder:"document.pdf"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c.Label,{children:"Folder"}),(0,t.jsxs)(m.Select,{value:f,onValueChange:b,children:[(0,t.jsx)(m.SelectTrigger,{children:(0,t.jsx)(m.SelectValue,{})}),(0,t.jsx)(m.SelectContent,{children:ej.map(e=>(0,t.jsx)(m.SelectItem,{value:e,children:e},e))})]})]}),(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)(eo.Checkbox,{id:"visible",checked:v,onCheckedChange:e=>_(e)}),(0,t.jsx)("label",{htmlFor:"visible",className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:"Visible to investors"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c.Label,{children:"Tags"}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(d.Input,{value:w,onChange:e=>C(e.target.value),onKeyPress:e=>"Enter"===e.key&&(e.preventDefault(),L()),placeholder:"Add tag and press Enter"}),(0,t.jsx)(r.Button,{type:"button",onClick:L,variant:"outline",children:"Add"})]}),N.length>0&&(0,t.jsx)("div",{className:"flex flex-wrap gap-2",children:N.map(e=>(0,t.jsxs)(l.Badge,{variant:"secondary",className:"gap-1",children:[e,(0,t.jsx)(eh.X,{className:"h-3 w-3 cursor-pointer",onClick:()=>{y(N.filter(t=>t!==e))}})]},e))})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c.Label,{htmlFor:"expiresAt",children:"Document Expiry (Optional)"}),(0,t.jsx)(d.Input,{id:"expiresAt",type:"datetime-local",value:T,onChange:e=>F(e.target.value)}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:"Leave blank for no expiry. Expired documents will be hidden from investors."})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c.Label,{htmlFor:"notes",children:"Internal Notes"}),(0,t.jsx)(o.Textarea,{id:"notes",value:S,onChange:e=>k(e.target.value),rows:3,placeholder:"Add internal notes about this document (not visible to investors)"})]})]}),(0,t.jsxs)(i.DialogFooter,{children:[(0,t.jsx)(r.Button,{variant:"outline",onClick:()=>x(!1),disabled:D,children:"Cancel"}),(0,t.jsxs)(r.Button,{onClick:A,disabled:D,children:[D&&(0,t.jsx)(j.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),"Save Changes"]})]})]})})}function eb({dealId:e,documentId:a,open:n,onOpenChange:d}){let[c,o]=(0,s.useState)([]),[m,x]=(0,s.useState)(!1),[h,p]=(0,s.useState)(null),[g,f]=(0,s.useState)(!1),b=(0,s.useRef)(null),v=async t=>{let s=t.target.files?.[0];if(s){f(!0);try{let t=new FormData;t.append("file",s);let r=await fetch(`/api/deals/${e}/documents/${a}/versions`,{method:"POST",body:t});if(!r.ok){let e=await r.json();throw Error(e.error||"Failed to upload new version")}el.toast.success("New version uploaded successfully"),await _()}catch(e){console.error("Error uploading version:",e),el.toast.error(e instanceof Error?e.message:"Failed to upload new version")}finally{f(!1),b.current&&(b.current.value="")}}},_=(0,s.useCallback)(async()=>{x(!0),p(null);try{let t=await fetch(`/api/deals/${e}/documents/${a}/versions`);if(!t.ok)throw Error("Failed to load version history");let s=await t.json();o(s.versions||[])}catch(e){console.error("Error loading versions:",e),p(e instanceof Error?e.message:"Failed to load versions")}finally{x(!1)}},[e,a]);return(0,s.useEffect)(()=>{n&&a&&_()},[n,a,_]),(0,t.jsx)(i.Dialog,{open:n,onOpenChange:d,children:(0,t.jsxs)(i.DialogContent,{className:"sm:max-w-3xl max-h-[80vh] overflow-y-auto",children:[(0,t.jsxs)(i.DialogHeader,{children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)(i.DialogTitle,{className:"flex items-center gap-2",children:[(0,t.jsx)(u.FileText,{className:"h-5 w-5"}),"Document Version History"]}),(0,t.jsxs)("div",{children:[(0,t.jsxs)(r.Button,{size:"sm",onClick:()=>b.current?.click(),disabled:g||m,children:[g?(0,t.jsx)(j.Loader2,{className:"h-4 w-4 mr-2 animate-spin"}):(0,t.jsx)(ex.Upload,{className:"h-4 w-4 mr-2"}),g?"Uploading...":"Upload New Version"]}),(0,t.jsx)("input",{type:"file",ref:b,onChange:v,className:"hidden",accept:".pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx,.txt,.csv"})]})]}),(0,t.jsx)(i.DialogDescription,{children:"View all versions of this document. The latest version is shown to investors."})]}),m&&(0,t.jsx)("div",{className:"flex items-center justify-center py-8",children:(0,t.jsx)(j.Loader2,{className:"h-8 w-8 animate-spin text-muted-foreground"})}),h&&(0,t.jsx)("div",{className:"text-center py-8 text-destructive",children:h}),!m&&!h&&0===c.length&&(0,t.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:"No version history available yet."}),!m&&!h&&c.length>0&&(0,t.jsxs)(F.Table,{children:[(0,t.jsx)(F.TableHeader,{children:(0,t.jsxs)(F.TableRow,{children:[(0,t.jsx)(F.TableHead,{children:"Version"}),(0,t.jsx)(F.TableHead,{children:"File Name"}),(0,t.jsx)(F.TableHead,{children:"Size"}),(0,t.jsx)(F.TableHead,{children:"Uploaded"}),(0,t.jsx)(F.TableHead,{children:"Status"}),(0,t.jsx)(F.TableHead,{className:"text-right",children:"Actions"})]})}),(0,t.jsx)(F.TableBody,{children:c.map(e=>{var s;let a=!e.replaced_by_id;return(0,t.jsxs)(F.TableRow,{children:[(0,t.jsxs)(F.TableCell,{className:"font-medium",children:["v",e.version]}),(0,t.jsx)(F.TableCell,{className:"font-mono text-sm",children:e.file_name}),(0,t.jsx)(F.TableCell,{className:"text-sm text-muted-foreground",children:(s=e.file_size_bytes)?s<1024?`${s} B`:s<1048576?`${(s/1024).toFixed(1)} KB`:`${(s/1048576).toFixed(1)} MB`:"—"}),(0,t.jsx)(F.TableCell,{className:"text-sm",children:(0,T.format)(new Date(e.created_at),"dd MMM yyyy HH:mm")}),(0,t.jsx)(F.TableCell,{children:a?(0,t.jsx)(l.Badge,{className:"bg-emerald-500/20 text-emerald-200",children:"Current"}):(0,t.jsx)(l.Badge,{variant:"outline",className:"text-muted-foreground",children:"Replaced"})}),(0,t.jsx)(F.TableCell,{className:"text-right",children:(0,t.jsxs)(r.Button,{variant:"outline",size:"sm",className:"gap-2",children:[(0,t.jsx)(er.Download,{className:"h-4 w-4"}),"Download"]})})]},e.id)})})]})]})})}function ev({dealId:e,documents:l,onRefresh:n}){let[i,d]=(0,s.useState)(0),[c,o]=(0,s.useState)(null),[m,x]=(0,s.useState)(null),[h,p]=(0,s.useState)(null),[j,f]=(0,s.useState)(null),b=async t=>{f(t);try{let s=await fetch(`/api/deals/${e}/documents/${t}/download`);if(!s.ok)throw Error("Failed to generate download link");let a=await s.json();window.open(a.download_url,"_blank"),el.toast.success("Document download started")}catch(e){console.error("Download error:",e),el.toast.error("Failed to download document")}finally{f(null)}},v=async t=>{if(confirm("Are you sure you want to delete this document? This action cannot be undone.")){p(t);try{if(!(await fetch(`/api/deals/${e}/documents/${t}`,{method:"DELETE"})).ok)throw Error("Failed to delete document");el.toast.success("Document deleted successfully"),n&&n()}catch(e){console.error("Delete error:",e),el.toast.error("Failed to delete document")}finally{p(null)}}};return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)(a.Card,{className:"border-border bg-muted/50",children:[(0,t.jsx)(a.CardHeader,{children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)(a.CardTitle,{className:"text-foreground flex items-center gap-2",children:[(0,t.jsx)(u.FileText,{className:"h-5 w-5"}),"Deal Documents"]}),(0,t.jsx)(a.CardDescription,{children:"Documents scoped to this deal only"})]}),(0,t.jsx)(eg,{dealId:e,onUploadComplete:()=>{d(e=>e+1),n&&n()},trigger:(0,t.jsxs)(r.Button,{className:"gap-2",children:[(0,t.jsx)(C.Plus,{className:"h-4 w-4"}),"Upload Document"]})})]})}),(0,t.jsx)(a.CardContent,{children:0===l.length?(0,t.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:'No documents uploaded yet. Click "Upload Document" to add files.'}):(0,t.jsx)("div",{className:"space-y-2",children:l.map(e=>(0,t.jsxs)("div",{className:"flex items-center justify-between py-3 px-4 rounded-lg border border-border bg-muted/50 hover:bg-muted transition-colors",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3 flex-1",children:[(0,t.jsx)(u.FileText,{className:"h-5 w-5 text-muted-foreground"}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("div",{className:"flex items-center gap-2",children:(0,t.jsx)("span",{className:"font-medium text-foreground",children:e.file_key.split("/").pop()})}),(0,t.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Uploaded ",new Date(e.created_at).toLocaleDateString(),e.created_by_profile&&` by ${e.created_by_profile.display_name}`]})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsxs)(r.Button,{variant:"outline",size:"sm",className:"gap-2",onClick:()=>o(e),children:[(0,t.jsx)(g.Edit,{className:"h-4 w-4"}),"Edit"]}),(0,t.jsxs)(r.Button,{variant:"outline",size:"sm",className:"gap-2",onClick:()=>x(e.id),children:[(0,t.jsx)(ed.History,{className:"h-4 w-4"}),"Versions"]}),(0,t.jsxs)(r.Button,{variant:"outline",size:"sm",className:"gap-2",onClick:()=>b(e.id),disabled:j===e.id,children:[(0,t.jsx)(er.Download,{className:"h-4 w-4"}),j===e.id?"Downloading...":"Download"]}),(0,t.jsx)(r.Button,{variant:"outline",size:"sm",className:"text-red-700 dark:text-red-200",onClick:()=>v(e.id),disabled:h===e.id,children:(0,t.jsx)(M.Trash2,{className:"h-4 w-4"})})]})]},e.id))})})]}),c&&(0,t.jsx)(ef,{dealId:e,documentId:c.id,open:!!c,onOpenChange:e=>!e&&o(null),onSaved:()=>{o(null),n&&n()},initialData:{file_name:c.file_name,folder:c.folder,visible_to_investors:c.visible_to_investors,tags:c.tags,document_notes:c.document_notes,document_expires_at:c.document_expires_at}}),m&&(0,t.jsx)(eb,{dealId:e,documentId:m,open:!!m,onOpenChange:e=>!e&&x(null)})]})}var e_=e.i(56213),eN=e.i(907434),ey=e.i(734213),ew=e.i(509192),eC=e.i(553426),eS=e.i(382021),ek=e.i(262823),eT=e.i(771750);let eF={conversion:ek.RefreshCw,audit:g.Edit,membership:B.Users,interest:ew.Heart,access:eC.Lock,subscription:u.FileText},eD={conversion:"text-purple-500",audit:"text-muted-foreground",membership:"text-blue-500",interest:"text-pink-500",access:"text-orange-500",subscription:"text-green-500"},eI={conversion:"bg-purple-500/10",audit:"bg-muted",membership:"bg-blue-500/10",interest:"bg-pink-500/10",access:"bg-orange-500/10",subscription:"bg-green-500/10"},eL={conversion:"Conversion",audit:"Audit",membership:"Membership",interest:"Interest",access:"Access",subscription:"Subscription"};function eA({dealId:e}){let[n,i]=(0,s.useState)([]),[d,c]=(0,s.useState)(!0),[o,x]=(0,s.useState)(null),[u,h]=(0,s.useState)("all"),[p,g]=(0,s.useState)(!1),[j,f]=(0,s.useState)(0),b=async(t=!1)=>{try{c(!0);let s=t?j:0,a="all"!==u?`&category=${u}`:"",r=await fetch(`/api/deals/${e}/activity?limit=50&offset=${s}${a}`);if(!r.ok)throw Error("Failed to fetch activity timeline");let l=await r.json();t?i(e=>[...e,...l.events||[]]):i(l.events||[]),g(l.hasMore||!1),f(s+(l.events?.length||0)),x(null)}catch(e){console.error("Failed to fetch activities:",e),x("Failed to load activity timeline"),i([])}finally{c(!1)}};return((0,s.useEffect)(()=>{f(0),b(!1)},[e,u]),d&&0===n.length)?(0,t.jsxs)(a.Card,{className:"border-border bg-muted/50",children:[(0,t.jsxs)(a.CardHeader,{children:[(0,t.jsx)(e_.Skeleton,{className:"h-6 w-32"}),(0,t.jsx)(e_.Skeleton,{className:"h-4 w-48"})]}),(0,t.jsx)(a.CardContent,{children:(0,t.jsx)("div",{className:"space-y-4",children:[1,2,3,4,5].map(e=>(0,t.jsxs)("div",{className:"flex gap-4",children:[(0,t.jsx)(e_.Skeleton,{className:"h-10 w-10 rounded-full"}),(0,t.jsxs)("div",{className:"flex-1 space-y-2",children:[(0,t.jsx)(e_.Skeleton,{className:"h-4 w-3/4"}),(0,t.jsx)(e_.Skeleton,{className:"h-3 w-1/2"})]})]},e))})})]}):o?(0,t.jsx)(a.Card,{className:"border-border bg-muted/50",children:(0,t.jsx)(a.CardContent,{className:"pt-6",children:(0,t.jsxs)("div",{className:"flex items-center gap-2 text-destructive",children:[(0,t.jsx)(q.AlertCircle,{className:"h-4 w-4"}),(0,t.jsx)("p",{children:o})]})})}):(0,t.jsxs)(a.Card,{className:"border-border bg-muted/50",children:[(0,t.jsx)(a.CardHeader,{children:(0,t.jsxs)("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)(a.CardTitle,{className:"text-foreground flex items-center gap-2",children:[(0,t.jsx)(ey.Activity,{className:"h-5 w-5"}),"Activity Log"]}),(0,t.jsx)(a.CardDescription,{children:"Complete audit trail of all deal actions"})]}),(0,t.jsxs)(m.Select,{value:u,onValueChange:h,children:[(0,t.jsxs)(m.SelectTrigger,{className:"w-[180px]",children:[(0,t.jsx)(eS.Filter,{className:"h-4 w-4 mr-2"}),(0,t.jsx)(m.SelectValue,{})]}),(0,t.jsxs)(m.SelectContent,{children:[(0,t.jsx)(m.SelectItem,{value:"all",children:"All Activities"}),(0,t.jsx)(m.SelectItem,{value:"conversion",children:"Conversions"}),(0,t.jsx)(m.SelectItem,{value:"audit",children:"Audit Trail"}),(0,t.jsx)(m.SelectItem,{value:"membership",children:"Membership"}),(0,t.jsx)(m.SelectItem,{value:"interest",children:"Interest"}),(0,t.jsx)(m.SelectItem,{value:"access",children:"Access Control"}),(0,t.jsx)(m.SelectItem,{value:"subscription",children:"Subscriptions"})]})]})]})}),(0,t.jsx)(a.CardContent,{children:(0,t.jsx)(eN.ScrollArea,{style:{height:"600px"},className:"pr-4",children:0===n.length?(0,t.jsxs)("div",{className:"text-center py-12",children:[(0,t.jsx)(es.Clock,{className:"h-12 w-12 mx-auto text-muted-foreground mb-4"}),(0,t.jsx)("p",{className:"text-muted-foreground text-lg font-medium",children:"No activities found"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground mt-2",children:"all"===u?"There are no recorded activities for this deal in the last 90 days.":`No ${eL[u]} activities found.`})]}):(0,t.jsxs)("div",{className:"space-y-4",children:[n.map((e,s)=>{let a=eF[e.category],r=eD[e.category],i=eI[e.category],d=s===n.length-1&&!p;return(0,t.jsxs)("div",{className:"relative",children:[!d&&(0,t.jsx)("div",{className:"absolute left-5 top-12 bottom-0 w-px bg-border"}),(0,t.jsxs)("div",{className:"flex gap-4",children:[(0,t.jsx)("div",{className:`flex-shrink-0 w-10 h-10 rounded-full ${i} flex items-center justify-center relative z-10`,children:(0,t.jsx)(a,{className:`h-5 w-5 ${r}`})}),(0,t.jsx)("div",{className:"flex-1 pb-8",children:(0,t.jsxs)("div",{className:"flex items-start justify-between gap-4",children:[(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-1 flex-wrap",children:[(0,t.jsx)("p",{className:"font-semibold text-sm text-foreground",children:e.type}),(0,t.jsx)(l.Badge,{variant:"outline",className:"text-xs",children:eL[e.category]})]}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground mb-2",children:e.description}),e.details&&Object.keys(e.details).length>0&&(0,t.jsx)("div",{className:"flex flex-wrap gap-2 mb-2",children:Object.entries(e.details).filter(([e])=>!["id","userId","dealId"].includes(e)).map(([e,s])=>{let a=String(s);if("boolean"==typeof s)a=s?"Yes":"No";else if(null==s)return null;return(0,t.jsxs)("div",{className:"text-xs bg-muted px-2 py-1 rounded",children:[(0,t.jsxs)("span",{className:"font-medium",children:[e.replace(/_/g," "),":"]})," ",(0,t.jsx)("span",{children:a})]},e)})}),(0,t.jsxs)("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[e.actor&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("span",{children:["by ",e.actor.name,e.actor.role&&` (${e.actor.role})`]}),(0,t.jsx)("span",{children:"•"})]}),(0,t.jsx)("span",{title:(0,T.format)(new Date(e.timestamp),"PPpp"),children:(0,eT.formatDistanceToNow)(new Date(e.timestamp),{addSuffix:!0})})]})]}),e.details?.status==="success"||e.details?.status==="approved"?(0,t.jsx)(et.CheckCircle,{className:"h-4 w-4 text-green-600 flex-shrink-0"}):null,e.details?.status==="error"||e.details?.status==="rejected"?(0,t.jsx)(q.AlertCircle,{className:"h-4 w-4 text-red-600 flex-shrink-0"}):null]})})]})]},e.id)}),p&&(0,t.jsx)("div",{className:"flex justify-center pt-4",children:(0,t.jsx)(r.Button,{variant:"outline",onClick:()=>{b(!0)},disabled:d,children:d?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(ek.RefreshCw,{className:"h-4 w-4 mr-2 animate-spin"}),"Loading..."]}):"Load More"})})]})})})]})}var eP=e.i(661521),eE=e.i(176835),e$=e.i(634847),eB=e.i(429031),eM=e.i(818893),eH=e.i(758768);let eU=(0,e.i(410587).default)("send-horizontal",[["path",{d:"M3.714 3.048a.498.498 0 0 0-.683.627l2.843 7.627a2 2 0 0 1 0 1.396l-2.842 7.627a.498.498 0 0 0 .682.627l18-8.5a.5.5 0 0 0 0-.904z",key:"117uat"}],["path",{d:"M6 12h16",key:"s4cdu5"}]]);var eR=e.i(619962),eO=e.i(550418);let eV={draft:"bg-amber-500/20 text-amber-100",published:"bg-emerald-500/20 text-emerald-100",archived:"bg-muted text-muted-foreground"},eq={draft:"bg-muted text-muted-foreground border-border",sent:"bg-blue-500/20 text-blue-300 border-blue-500/30",pending_signature:"bg-amber-500/20 text-amber-300 border-amber-500/30",accepted:"bg-emerald-500/20 text-emerald-300 border-emerald-500/30",rejected:"bg-red-500/20 text-red-300 border-red-500/30"},ez={draft:"Draft",sent:"Sent",pending_signature:"Pending",accepted:"Accepted",rejected:"Rejected"},eG={term_sheet_date:"",transaction_type:"",opportunity_summary:"",issuer:"",vehicle:"",exclusive_arranger:"",purchaser:"",seller:"",structure:"",allocation_up_to:"",price_per_share_text:"",price_per_share:"",cost_per_share:"",minimum_ticket:"",subscription_fee_percent:"",management_fee_percent:"",management_fee_clause:"",carried_interest_percent:"",performance_fee_clause:"",legal_counsel:"",interest_confirmation_deadline:"",validity_date:"",completion_date:"",completion_date_text:""};function eQ(e){if(!e)return null;let t=Number(e);return Number.isFinite(t)?t:null}function eJ({dealId:e,termSheets:n}){let m,x,u,h,[p,g]=(0,s.useState)(n??[]),[f,b]=(0,s.useState)(!1),[v,_]=(0,s.useState)("create"),[N,w]=(0,s.useState)(null),[S,k]=(0,s.useState)(eG),[F,D]=(0,s.useState)(!1),[L,A]=(0,s.useState)(null),[P,E]=(0,s.useState)(null),[$,M]=(0,s.useState)(null),H=(0,s.useRef)({}),[R,O]=(0,s.useState)([]),[V,q]=(0,s.useState)(!1),[z,G]=(0,s.useState)(!1),[Q,J]=(0,s.useState)(),[K,W]=(0,s.useState)(!1),[X,Y]=(0,s.useState)(!1),[Z,ee]=(0,s.useState)(null),[et,es]=(0,s.useState)(null),[ea,er]=(0,s.useState)(null),[ei,ed]=(0,s.useState)(null),[ec,eo]=(0,s.useState)(null),[em,eu]=(0,s.useState)(null),{isCEO:eh,isStaff:ep}=(0,eO.usePersona)();(0,s.useEffect)(()=>{g(n??[])},[n]);let eg=(0,s.useCallback)(async()=>{q(!0);try{let t=await fetch(`/api/deals/${e}/fee-plans`);if(!t.ok)return void console.error("Failed to fetch fee plans");let s=await t.json();O(s.feePlans||[])}catch(e){console.error("Error fetching fee plans:",e)}finally{q(!1)}},[e]);(0,s.useEffect)(()=>{eg()},[eg]);let ej=(0,s.useMemo)(()=>{let e={};for(let t of R){let s=t.term_sheet_id||"unlinked";e[s]||(e[s]=[]),e[s].push(t)}return e},[R]),ef=e=>e.introducer?{type:"Introducer",name:e.introducer.company_name||e.introducer.name,icon:B.Users}:e.partner?{type:"Partner",name:e.partner.company_name||e.partner.name,icon:y.Building2}:e.commercial_partner?{type:"Commercial Partner",name:e.commercial_partner.company_name||e.commercial_partner.name,icon:U.Briefcase}:null,eb=e=>{J(e),G(!0)},ev=()=>{G(!1),J(void 0)},e_=async t=>{let s=p.find(e=>e.id===t),a=s?.term_sheet_attachment_key?.split("/").pop()||"Term Sheet.pdf";es(t),ed({id:t,file_name:a,name:a,mime_type:"application/pdf",type:"term_sheet"}),W(!0),Y(!0),er(null),ee(null);try{let s=await fetch(`/api/deals/${e}/fee-structures/${t}/attachment`);if(!s.ok){let e=await s.json();throw Error(e.error||"Failed to load document")}let a=await s.json();ee(a.url)}catch(e){er(e instanceof Error?e.message:"Failed to load document")}finally{Y(!1)}},eN=async t=>{eo(t),A(null);try{let s=await fetch(`/api/deals/${e}/fee-structures/${t}/generate`,{method:"POST"}),a=await s.json();if(!s.ok)throw Error(a.error||"Failed to generate term sheet");await eF()}catch(e){A(e instanceof Error?e.message:"Failed to generate term sheet")}finally{eo(null)}},ey=async t=>{eu(t),A(null);try{let s=await fetch(`/api/deals/${e}/fee-structures/${t}/request-close`,{method:"POST"}),a=await s.json();if(!s.ok)throw Error(a.error||"Failed to request close approval");el.toast.success("Close approval created",{description:"The CEO will review this request in the Approvals queue."}),await eF()}catch(t){let e=t instanceof Error?t.message:"Failed to request close approval";A(e),el.toast.error("Request failed",{description:e})}finally{eu(null)}},ew=(0,s.useMemo)(()=>[...p].sort((e,t)=>(t.version??0)-(e.version??0)),[p]),eC=(0,s.useMemo)(()=>ew.filter(e=>"published"===e.status),[ew]);eC[0];let eS=async(t,s)=>{E(null),M(t);try{let a=new FormData;a.append("file",s);let r=await fetch(`/api/deals/${e}/fee-structures/${t}/attachment`,{method:"POST",body:a}),l=await r.json().catch(()=>({}));if(!r.ok)throw Error(l?.error||"Failed to upload attachment");let n=p.map(e=>e.id===t?{...e,term_sheet_attachment_key:l.term_sheet_attachment_key}:e);g(n),N===t&&k(e=>({...e,term_sheet_attachment_key:l.term_sheet_attachment_key??""}))}catch(e){console.error("Term sheet attachment upload failed",e),E(e instanceof Error?e.message:"Failed to upload attachment")}finally{let e=H.current[t];e&&(e.value=""),M(null)}},ek=(e,t)=>{var s;_(e),w("edit"===e?t?.id??null:null),k((s="create"===e?void 0:t)?{term_sheet_date:s.term_sheet_date?s.term_sheet_date.slice(0,10):"",transaction_type:s.transaction_type??"",opportunity_summary:s.opportunity_summary??"",issuer:s.issuer??"",vehicle:s.vehicle??"",exclusive_arranger:s.exclusive_arranger??"",purchaser:s.purchaser??"",seller:s.seller??"",structure:s.structure??"",allocation_up_to:s.allocation_up_to??"",price_per_share_text:s.price_per_share_text??"",price_per_share:null!=s.price_per_share?String(s.price_per_share):"",cost_per_share:null!=s.cost_per_share?String(s.cost_per_share):"",minimum_ticket:s.minimum_ticket??"",subscription_fee_percent:s.subscription_fee_percent??"",management_fee_percent:s.management_fee_percent??"",management_fee_clause:s.management_fee_clause??"",carried_interest_percent:s.carried_interest_percent??"",performance_fee_clause:s.performance_fee_clause??"",legal_counsel:s.legal_counsel??"",interest_confirmation_deadline:s.interest_confirmation_deadline?s.interest_confirmation_deadline.slice(0,16):"",validity_date:s.validity_date?s.validity_date.slice(0,16):"",completion_date:s.completion_date?s.completion_date.slice(0,10):"",completion_date_text:s.completion_date_text??""}:eG),A(null),b(!0)},eT=()=>{b(!1),w(null),k(eG)},eF=async()=>{let t=await fetch(`/api/deals/${e}/fee-structures`);t.ok?g((await t.json()).term_sheets??[]):A("Failed to refresh term sheets. Please reload the page.")},eD=async()=>{D(!0),A(null);try{let t,s={term_sheet_date:S.term_sheet_date||null,transaction_type:S.transaction_type||null,opportunity_summary:S.opportunity_summary||null,issuer:S.issuer||null,vehicle:S.vehicle||null,exclusive_arranger:S.exclusive_arranger||null,purchaser:S.purchaser||null,seller:S.seller||null,structure:S.structure||null,allocation_up_to:eQ(S.allocation_up_to),price_per_share_text:S.price_per_share_text||null,price_per_share:eQ(S.price_per_share),cost_per_share:eQ(S.cost_per_share),minimum_ticket:eQ(S.minimum_ticket),subscription_fee_percent:eQ(S.subscription_fee_percent),management_fee_percent:eQ(S.management_fee_percent),management_fee_clause:S.management_fee_clause||null,carried_interest_percent:eQ(S.carried_interest_percent),performance_fee_clause:S.performance_fee_clause||null,legal_counsel:S.legal_counsel||null,interest_confirmation_deadline:S.interest_confirmation_deadline||null,validity_date:S.validity_date||null,completion_date:S.completion_date||null,completion_date_text:S.completion_date_text||null};if("create"===v||"clone"===v)t=await fetch(`/api/deals/${e}/fee-structures`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});else{if(!N)throw Error("Missing term sheet ID");t=await fetch(`/api/deals/${e}/fee-structures`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({structure_id:N,updates:s})})}if(!t.ok){let e=await t.text();throw Error(e||"Failed to save term sheet")}await eF(),eT()}catch(e){A(e instanceof Error?e.message:"Unexpected error saving term sheet")}finally{D(!1)}},eI=async(t,s)=>{D(!0),A(null);try{let a=await fetch(`/api/deals/${e}/fee-structures`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({structure_id:t.id,updates:{status:s}})});if(!a.ok){let e=await a.text();throw Error(e||"Failed to update status")}await eF()}catch(e){A(e instanceof Error?e.message:"Unexpected error updating status")}finally{D(!1)}};return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"text-lg font-semibold text-foreground",children:"Term Sheet Versions"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Draft, publish, and archive the structured economics that power the investor experience."})]}),(0,t.jsxs)(r.Button,{onClick:()=>ek("create"),disabled:F,className:"gap-2",children:[(0,t.jsx)(C.Plus,{className:"h-4 w-4"}),"New Term Sheet"]})]}),L&&(0,t.jsx)(a.Card,{className:"border border-destructive/30 bg-destructive/10",children:(0,t.jsx)(a.CardContent,{className:"text-sm text-destructive p-3",children:L})}),P&&(0,t.jsx)(a.Card,{className:"border border-amber-400/30 bg-amber-500/10",children:(0,t.jsx)(a.CardContent,{className:"text-sm text-amber-800 p-3",children:P})}),eC.length>0&&(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("h3",{className:"text-sm font-semibold text-emerald-400 uppercase tracking-wide",children:["Published Term Sheets (",eC.length,")"]}),(0,t.jsx)("div",{className:"grid grid-cols-1 xl:grid-cols-2 gap-4",children:eC.map(e=>(0,t.jsxs)(a.Card,{className:"border border-emerald-400/30 bg-emerald-500/10",children:[(0,t.jsxs)(a.CardHeader,{className:"flex flex-row items-start justify-between space-y-0",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)(a.CardTitle,{className:"text-foreground",children:["Version ",e.version]}),(0,t.jsxs)(a.CardDescription,{children:["Published"," ",e.published_at?(0,T.format)(new Date(e.published_at),"dd MMM yyyy"):"—",e.term_sheet_date&&(0,t.jsxs)("span",{className:"ml-2",children:["• Dated: ",(0,T.format)(new Date(e.term_sheet_date),"dd MMM yyyy")]}),e.vehicle&&(0,t.jsxs)("span",{className:"ml-2",children:["• ",e.vehicle]})]})]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsxs)(r.Button,{variant:"outline",size:"sm",className:"gap-2",onClick:()=>ek("edit",e),disabled:F,children:[(0,t.jsx)(eM.Pencil,{className:"h-4 w-4"}),"Edit"]}),(0,t.jsxs)(r.Button,{variant:"outline",size:"sm",className:"gap-2",onClick:()=>ek("clone",e),disabled:F,children:[(0,t.jsx)(eE.Copy,{className:"h-4 w-4"}),"Clone"]}),(0,t.jsx)(r.Button,{variant:"outline",size:"sm",className:"gap-2",onClick:()=>H.current[e.id]?.click(),disabled:$===e.id,children:$===e.id?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(j.Loader2,{className:"h-4 w-4 animate-spin"}),"Uploading..."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(ex.Upload,{className:"h-4 w-4"}),"Upload Attachment"]})}),(0,t.jsx)(r.Button,{variant:"outline",size:"sm",className:"gap-2 border-blue-500/30 hover:bg-blue-500/10",onClick:()=>eN(e.id),disabled:ec===e.id,children:ec===e.id?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(j.Loader2,{className:"h-4 w-4 animate-spin"}),"Generating..."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(eH.FileCheck,{className:"h-4 w-4"}),"Generate PDF"]})}),(0,t.jsx)(r.Button,{variant:"outline",size:"sm",className:"gap-2 border-amber-500/30 hover:bg-amber-500/10",onClick:()=>ey(e.id),disabled:em===e.id||!!e.closed_processed_at,title:e.closed_processed_at?"Already processed":"Request CEO approval to close this termsheet",children:em===e.id?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(j.Loader2,{className:"h-4 w-4 animate-spin"}),"Requesting..."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(eU,{className:"h-4 w-4"}),"Request Close"]})})]})]}),(0,t.jsxs)(a.CardContent,{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("div",{className:"text-xs text-emerald-200",children:e.term_sheet_attachment_key?"Attachment available for investors to download.":"No attachment uploaded yet."}),e.term_sheet_attachment_key&&(0,t.jsxs)(r.Button,{variant:"outline",size:"sm",className:"gap-2 border-emerald-500/30 hover:bg-emerald-500/10",onClick:()=>e_(e.id),children:[(0,t.jsx)(I.Eye,{className:"h-4 w-4"}),"Preview"]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"text-xs font-semibold text-emerald-300 uppercase tracking-wide mb-3",children:"Transaction Details"}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-muted-foreground block text-xs",children:"Transaction Type"}),(0,t.jsx)("span",{className:"text-foreground font-medium",children:e.transaction_type||"—"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-muted-foreground block text-xs",children:"Structure"}),(0,t.jsx)("span",{className:"text-foreground font-medium",children:e.structure||"—"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-muted-foreground block text-xs",children:"Issuer"}),(0,t.jsx)("span",{className:"text-foreground font-medium",children:e.issuer||"—"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-muted-foreground block text-xs",children:"Vehicle"}),(0,t.jsx)("span",{className:"text-foreground font-medium",children:e.vehicle||"—"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-muted-foreground block text-xs",children:"Exclusive Arranger"}),(0,t.jsx)("span",{className:"text-foreground font-medium",children:e.exclusive_arranger||"—"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-muted-foreground block text-xs",children:"Purchaser"}),(0,t.jsx)("span",{className:"text-foreground font-medium",children:e.purchaser||"—"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-muted-foreground block text-xs",children:"Seller"}),(0,t.jsx)("span",{className:"text-foreground font-medium",children:e.seller||"—"})]})]})]}),(0,t.jsx)(eP.Separator,{className:"bg-emerald-400/20"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"text-xs font-semibold text-emerald-300 uppercase tracking-wide mb-3",children:"Investment Terms"}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-muted-foreground block text-xs",children:"Allocation Up To"}),(0,t.jsx)("span",{className:"text-foreground font-medium",children:e.allocation_up_to?e.allocation_up_to.toLocaleString():"—"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-muted-foreground block text-xs",children:"Price Per Share"}),(0,t.jsx)("span",{className:"text-foreground font-medium",children:e.price_per_share_text||"—"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-muted-foreground block text-xs",children:"Minimum Ticket"}),(0,t.jsx)("span",{className:"text-foreground font-medium",children:e.minimum_ticket?e.minimum_ticket.toLocaleString():"—"})]})]})]}),(0,t.jsx)(eP.Separator,{className:"bg-emerald-400/20"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"text-xs font-semibold text-emerald-300 uppercase tracking-wide mb-3",children:"Fee Structure"}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 text-sm",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-muted-foreground block text-xs",children:"Subscription Fee"}),(0,t.jsx)("span",{className:"text-foreground font-medium",children:null!=e.subscription_fee_percent?`${e.subscription_fee_percent}%`:"—"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-muted-foreground block text-xs",children:"Management Fee"}),(0,t.jsx)("span",{className:"text-foreground font-medium",children:null!=e.management_fee_percent?`${e.management_fee_percent}% p.a.`:"—"}),e.management_fee_clause&&(0,t.jsx)("span",{className:"text-muted-foreground block text-xs mt-1 italic",children:e.management_fee_clause})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-muted-foreground block text-xs",children:"Carried Interest"}),(0,t.jsx)("span",{className:"text-foreground font-medium",children:null!=e.carried_interest_percent?`${e.carried_interest_percent}%`:"—"}),e.performance_fee_clause&&(0,t.jsx)("span",{className:"text-muted-foreground block text-xs mt-1 italic",children:e.performance_fee_clause})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-muted-foreground block text-xs",children:"Legal Counsel"}),(0,t.jsx)("span",{className:"text-foreground font-medium",children:e.legal_counsel||"—"})]})]})]}),(0,t.jsx)(eP.Separator,{className:"bg-emerald-400/20"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"text-xs font-semibold text-emerald-300 uppercase tracking-wide mb-3",children:"Timeline & Deadlines"}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-muted-foreground block text-xs",children:"Interest Deadline"}),(0,t.jsx)("span",{className:"text-foreground font-medium",children:e.interest_confirmation_deadline?(0,T.format)(new Date(e.interest_confirmation_deadline),"dd MMM yyyy HH:mm"):"—"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-muted-foreground block text-xs",children:"Completion Date"}),(0,t.jsx)("span",{className:"text-foreground font-medium",children:e.completion_date?(0,T.format)(new Date(e.completion_date),"dd MMM yyyy"):e.completion_date_text||"—"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-muted-foreground block text-xs",children:"Validity Date"}),(0,t.jsx)("span",{className:"text-foreground font-medium",children:e.validity_date?(0,T.format)(new Date(e.validity_date),"dd MMM yyyy HH:mm"):"—"})]})]})]}),e.term_sheet_html&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(eP.Separator,{className:"bg-emerald-400/20"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"text-xs font-semibold text-emerald-300 uppercase tracking-wide mb-3",children:"Opportunity Summary"}),(0,t.jsx)("div",{className:"space-y-2 text-sm text-emerald-50/90 leading-relaxed",dangerouslySetInnerHTML:{__html:e.term_sheet_html}})]})]}),(0,t.jsx)(eP.Separator,{className:"bg-emerald-400/20"}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,t.jsxs)("h4",{className:"text-xs font-semibold text-emerald-300 uppercase tracking-wide flex items-center gap-2",children:[(0,t.jsx)(eH.FileCheck,{className:"h-4 w-4"}),"Linked Fee Plans"]}),(0,t.jsxs)(r.Button,{variant:"outline",size:"sm",className:"gap-1 text-xs h-7 border-emerald-500/30 hover:bg-emerald-500/10",onClick:()=>eb(e.id),children:[(0,t.jsx)(C.Plus,{className:"h-3 w-3"}),"Create Fee Plan"]})]}),V?(0,t.jsxs)("div",{className:"flex items-center gap-2 text-emerald-200/60 text-sm py-2",children:[(0,t.jsx)(j.Loader2,{className:"h-4 w-4 animate-spin"}),"Loading fee plans..."]}):0===(ej[e.id]||[]).length?(0,t.jsx)("div",{className:"text-sm text-emerald-200/60 py-2",children:"No fee plans linked to this term sheet yet. Create one to define commission terms for introducers or partners."}):(0,t.jsx)("div",{className:"space-y-2",children:(ej[e.id]||[]).map(e=>{let s=ef(e);return(0,t.jsxs)("div",{className:"flex items-center justify-between p-2 rounded-md bg-muted/50 border border-emerald-500/10",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[s&&(0,t.jsxs)("div",{className:"flex items-center gap-1 text-xs text-emerald-300/80",children:[(0,t.jsx)(s.icon,{className:"h-3.5 w-3.5"}),(0,t.jsxs)("span",{children:[s.type,":"]}),(0,t.jsx)("span",{className:"font-medium text-emerald-100",children:s.name})]}),(0,t.jsx)("span",{className:"text-sm text-emerald-100 font-medium",children:e.name})]}),(0,t.jsx)(l.Badge,{className:`text-xs ${eq[e.status]||eq.draft}`,children:ez[e.status]||e.status})]},e.id)})})]})]})]},e.id))})]}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("h3",{className:"text-sm font-semibold text-muted-foreground uppercase tracking-wide",children:["Other Versions (",ew.filter(e=>"published"!==e.status).length,")"]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 xl:grid-cols-2 gap-4",children:[ew.filter(e=>"published"!==e.status).map(e=>(0,t.jsxs)(a.Card,{className:"border-border bg-muted/50",children:[(0,t.jsxs)(a.CardHeader,{className:"flex items-start justify-between space-y-0",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)(a.CardTitle,{className:"text-foreground text-lg",children:["Version ",e.version]}),(0,t.jsxs)(a.CardDescription,{children:["Created ",(0,T.format)(new Date(e.created_at),"dd MMM yyyy"),e.term_sheet_date&&` • Term Sheet Date: ${(0,T.format)(new Date(e.term_sheet_date),"dd MMM yyyy")}`]})]}),(0,t.jsx)(l.Badge,{className:eV[e.status]??eV.draft,children:e.status.toUpperCase()})]}),(0,t.jsxs)(a.CardContent,{className:"space-y-4 text-sm",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("div",{className:"text-xs text-muted-foreground",children:e.term_sheet_attachment_key?"Attachment uploaded.":"No attachment uploaded yet."}),e.term_sheet_attachment_key&&(0,t.jsxs)(r.Button,{variant:"ghost",size:"sm",className:"gap-1 h-7 text-xs",onClick:()=>e_(e.id),children:[(0,t.jsx)(I.Eye,{className:"h-3 w-3"}),"Preview"]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("h4",{className:"text-xs font-semibold text-muted-foreground uppercase tracking-wide",children:"Transaction Details"}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-muted-foreground block text-xs",children:"Transaction Type"}),(0,t.jsx)("span",{className:"text-foreground font-medium",children:e.transaction_type||"—"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-muted-foreground block text-xs",children:"Structure"}),(0,t.jsx)("span",{className:"text-foreground font-medium",children:e.structure||"—"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-muted-foreground block text-xs",children:"Issuer"}),(0,t.jsx)("span",{className:"text-foreground font-medium",children:e.issuer||"—"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-muted-foreground block text-xs",children:"Vehicle"}),(0,t.jsx)("span",{className:"text-foreground font-medium",children:e.vehicle||"—"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-muted-foreground block text-xs",children:"Arranger"}),(0,t.jsx)("span",{className:"text-foreground font-medium",children:e.exclusive_arranger||"—"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-muted-foreground block text-xs",children:"Purchaser"}),(0,t.jsx)("span",{className:"text-foreground font-medium",children:e.purchaser||"—"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-muted-foreground block text-xs",children:"Seller"}),(0,t.jsx)("span",{className:"text-foreground font-medium",children:e.seller||"—"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-muted-foreground block text-xs",children:"Legal Counsel"}),(0,t.jsx)("span",{className:"text-foreground font-medium",children:e.legal_counsel||"—"})]})]})]}),(0,t.jsx)(eP.Separator,{}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("h4",{className:"text-xs font-semibold text-muted-foreground uppercase tracking-wide",children:"Investment Terms"}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-muted-foreground block text-xs",children:"Allocation"}),(0,t.jsx)("span",{className:"text-foreground font-medium",children:e.allocation_up_to?e.allocation_up_to.toLocaleString():"—"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-muted-foreground block text-xs",children:"Price Per Share"}),(0,t.jsx)("span",{className:"text-foreground font-medium",children:e.price_per_share_text||"—"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-muted-foreground block text-xs",children:"Min Ticket"}),(0,t.jsx)("span",{className:"text-foreground font-medium",children:e.minimum_ticket?e.minimum_ticket.toLocaleString():"—"})]})]})]}),(0,t.jsx)(eP.Separator,{}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("h4",{className:"text-xs font-semibold text-muted-foreground uppercase tracking-wide",children:"Fee Structure"}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-muted-foreground block text-xs",children:"Subscription Fee"}),(0,t.jsx)("span",{className:"text-foreground font-medium",children:null!=e.subscription_fee_percent?`${e.subscription_fee_percent}%`:"—"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-muted-foreground block text-xs",children:"Management Fee"}),(0,t.jsx)("span",{className:"text-foreground font-medium",children:null!=e.management_fee_percent?`${e.management_fee_percent}% p.a.`:"—"}),e.management_fee_clause&&(0,t.jsx)("span",{className:"text-muted-foreground block text-xs italic mt-1",children:e.management_fee_clause})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-muted-foreground block text-xs",children:"Carried Interest"}),(0,t.jsx)("span",{className:"text-foreground font-medium",children:null!=e.carried_interest_percent?`${e.carried_interest_percent}%`:"—"}),e.performance_fee_clause&&(0,t.jsx)("span",{className:"text-muted-foreground block text-xs italic mt-1",children:e.performance_fee_clause})]})]})]}),(0,t.jsx)(eP.Separator,{}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("h4",{className:"text-xs font-semibold text-muted-foreground uppercase tracking-wide",children:"Timeline"}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-muted-foreground block text-xs",children:"Interest Deadline"}),(0,t.jsx)("span",{className:"text-foreground font-medium",children:e.interest_confirmation_deadline?(0,T.format)(new Date(e.interest_confirmation_deadline),"dd MMM yyyy HH:mm"):"—"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-muted-foreground block text-xs",children:"Validity"}),(0,t.jsx)("span",{className:"text-foreground font-medium",children:e.validity_date?(0,T.format)(new Date(e.validity_date),"dd MMM yyyy HH:mm"):"—"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-muted-foreground block text-xs",children:"Completion Date"}),(0,t.jsx)("span",{className:"text-foreground font-medium",children:e.completion_date?(0,T.format)(new Date(e.completion_date),"dd MMM yyyy"):e.completion_date_text||"—"})]})]})]}),e.term_sheet_html&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,t.jsx)("h4",{className:"text-xs font-semibold text-muted-foreground uppercase tracking-wide",children:"Opportunity Summary"}),(0,t.jsx)("div",{className:"space-y-2 text-sm text-foreground/90 leading-relaxed",dangerouslySetInnerHTML:{__html:e.term_sheet_html}})]}),(0,t.jsx)(eP.Separator,{})]}),(0,t.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,t.jsx)("input",{type:"file",accept:".pdf,.doc,.docx,application/pdf,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document",className:"hidden",ref:t=>{H.current[e.id]=t},onChange:t=>{let s=t.target.files?.[0];s&&eS(e.id,s)}}),(0,t.jsxs)(r.Button,{variant:"outline",size:"sm",className:"gap-2",onClick:()=>ek("clone",e),disabled:F,children:[(0,t.jsx)(eE.Copy,{className:"h-4 w-4"}),"Clone"]}),"draft"===e.status&&(0,t.jsxs)(r.Button,{variant:"outline",size:"sm",className:"gap-2",onClick:()=>ek("edit",e),disabled:F,children:[(0,t.jsx)(eM.Pencil,{className:"h-4 w-4"}),"Edit"]}),"published"!==e.status&&(0,t.jsxs)(r.Button,{size:"sm",className:"gap-2",onClick:()=>eI(e,"published"),disabled:F,children:[(0,t.jsx)(e$.Rocket,{className:"h-4 w-4"}),"Publish"]}),"archived"!==e.status&&(0,t.jsxs)(r.Button,{variant:"outline",size:"sm",className:"gap-2 text-rose-300",onClick:()=>eI(e,"archived"),disabled:F,children:[(0,t.jsx)(eB.Archive,{className:"h-4 w-4"}),"Archive"]}),(0,t.jsx)(r.Button,{variant:"outline",size:"sm",className:"gap-2",onClick:()=>H.current[e.id]?.click(),disabled:$===e.id,children:$===e.id?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(j.Loader2,{className:"h-4 w-4 animate-spin"}),"Uploading..."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(ex.Upload,{className:"h-4 w-4"}),"Upload Attachment"]})}),(0,t.jsx)(r.Button,{variant:"outline",size:"sm",className:"gap-2",onClick:()=>eN(e.id),disabled:ec===e.id,children:ec===e.id?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(j.Loader2,{className:"h-4 w-4 animate-spin"}),"Generating..."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(eH.FileCheck,{className:"h-4 w-4"}),"Generate PDF"]})})]}),"published"===e.status&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(eP.Separator,{}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,t.jsxs)("h4",{className:"text-xs font-semibold text-muted-foreground uppercase tracking-wide flex items-center gap-1.5",children:[(0,t.jsx)(eH.FileCheck,{className:"h-3.5 w-3.5"}),"Linked Fee Plans"]}),(0,t.jsxs)(r.Button,{variant:"ghost",size:"sm",className:"gap-1 text-xs h-6 px-2",onClick:()=>eb(e.id),children:[(0,t.jsx)(C.Plus,{className:"h-3 w-3"}),"Add"]})]}),V?(0,t.jsxs)("div",{className:"flex items-center gap-2 text-muted-foreground text-xs py-1",children:[(0,t.jsx)(j.Loader2,{className:"h-3 w-3 animate-spin"}),"Loading..."]}):0===(ej[e.id]||[]).length?(0,t.jsx)("div",{className:"text-xs text-muted-foreground py-1",children:"No fee plans linked yet."}):(0,t.jsx)("div",{className:"space-y-1.5",children:(ej[e.id]||[]).map(e=>{let s=ef(e);return(0,t.jsxs)("div",{className:"flex items-center justify-between py-1 px-2 rounded bg-muted/50 text-xs",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 min-w-0",children:[s&&(0,t.jsxs)("span",{className:"flex items-center gap-1 text-muted-foreground shrink-0",children:[(0,t.jsx)(s.icon,{className:"h-3 w-3"}),s.name]}),(0,t.jsx)("span",{className:"text-foreground truncate",children:e.name})]}),(0,t.jsx)(l.Badge,{className:`text-[10px] h-5 shrink-0 ${eq[e.status]||eq.draft}`,children:ez[e.status]||e.status})]},e.id)})})]})]})]})]},e.id)),0===ew.length&&(0,t.jsx)(a.Card,{className:"border border-dashed border-border bg-muted/50",children:(0,t.jsxs)(a.CardContent,{className:"py-16 text-center space-y-3",children:[(0,t.jsx)("h4",{className:"text-lg font-semibold text-foreground",children:"No term sheets yet"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Create your first version to begin capturing structured economics and publishing investor-ready content."}),(0,t.jsxs)(r.Button,{variant:"outline",className:"gap-2",onClick:()=>ek("create"),disabled:F,children:[(0,t.jsx)(C.Plus,{className:"h-4 w-4"}),"Create Term Sheet"]})]})})]})]}),(0,t.jsx)(i.Dialog,{open:f,onOpenChange:e=>!e&&eT(),children:(0,t.jsxs)(i.DialogContent,{className:"sm:max-w-3xl max-h-[90vh] overflow-y-auto",children:[(0,t.jsxs)(i.DialogHeader,{children:[(0,t.jsxs)(i.DialogTitle,{children:["create"===v&&"Create Term Sheet","edit"===v&&"Edit Term Sheet","clone"===v&&"Clone Term Sheet"]}),(0,t.jsx)(a.CardDescription,{children:"Populate the structured fields that sync with investor-facing term sheets."})]}),(0,t.jsxs)("div",{className:"space-y-6 py-4",children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c.Label,{htmlFor:"term_sheet_date",children:"Term Sheet Date"}),(0,t.jsx)(d.Input,{id:"term_sheet_date",type:"date",value:S.term_sheet_date,onChange:e=>k(t=>({...t,term_sheet_date:e.target.value}))})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c.Label,{htmlFor:"transaction_type",children:"Transaction Type"}),(0,t.jsx)(d.Input,{id:"transaction_type",value:S.transaction_type,onChange:e=>k(t=>({...t,transaction_type:e.target.value}))})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c.Label,{htmlFor:"structure",children:"Structure"}),(0,t.jsx)(d.Input,{id:"structure",value:S.structure,onChange:e=>k(t=>({...t,structure:e.target.value}))})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c.Label,{htmlFor:"allocation_up_to",children:"Allocation “Up to”"}),(0,t.jsx)(d.Input,{id:"allocation_up_to",type:"number",value:S.allocation_up_to,onChange:e=>k(t=>({...t,allocation_up_to:e.target.value}))})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c.Label,{htmlFor:"opportunity_summary",children:"Opportunity Summary"}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:"Supports basic Markdown for emphasis, lists, and headings. The rendered HTML is stored for the investor view."}),(0,t.jsx)(o.Textarea,{id:"opportunity_summary",rows:3,value:S.opportunity_summary,onChange:e=>k(t=>({...t,opportunity_summary:e.target.value}))})]}),(0,t.jsx)(eP.Separator,{}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c.Label,{htmlFor:"issuer",children:"Issuer"}),(0,t.jsx)(d.Input,{id:"issuer",placeholder:"e.g., VERSO Capital",value:S.issuer,onChange:e=>k(t=>({...t,issuer:e.target.value}))})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c.Label,{htmlFor:"vehicle",children:"Vehicle"}),(0,t.jsx)(d.Input,{id:"vehicle",placeholder:"e.g., VERSO SPV 2025-01",value:S.vehicle,onChange:e=>k(t=>({...t,vehicle:e.target.value}))})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c.Label,{htmlFor:"exclusive_arranger",children:"Exclusive Arranger"}),(0,t.jsx)(d.Input,{id:"exclusive_arranger",placeholder:"e.g., VERSO Management Limited",value:S.exclusive_arranger,onChange:e=>k(t=>({...t,exclusive_arranger:e.target.value}))})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c.Label,{htmlFor:"purchaser",children:"Purchaser"}),(0,t.jsx)(d.Input,{id:"purchaser",placeholder:"e.g., Qualified Limited Partners",value:S.purchaser,onChange:e=>k(t=>({...t,purchaser:e.target.value}))})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c.Label,{htmlFor:"seller",children:"Seller"}),(0,t.jsx)(d.Input,{id:"seller",placeholder:"e.g., GP of Transform Capital",value:S.seller,onChange:e=>k(t=>({...t,seller:e.target.value}))})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c.Label,{htmlFor:"legal_counsel",children:"Legal Counsel"}),(0,t.jsx)(d.Input,{id:"legal_counsel",placeholder:"e.g., Dupont & Partners Law Firm",value:S.legal_counsel,onChange:e=>k(t=>({...t,legal_counsel:e.target.value}))})]})]}),(0,t.jsx)(eP.Separator,{}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c.Label,{htmlFor:"price_per_share_text",children:"Price per Share (Display Text)"}),(0,t.jsx)(d.Input,{id:"price_per_share_text",placeholder:"e.g., £10.00 per share",value:S.price_per_share_text,onChange:e=>k(t=>({...t,price_per_share_text:e.target.value}))}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:'Display text for investors (e.g., "£10.00 per share", "~$15-20")'})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c.Label,{htmlFor:"price_per_share",children:"Price per Share (Numeric)"}),(0,t.jsx)(d.Input,{id:"price_per_share",type:"number",step:"0.01",placeholder:"e.g., 10.00",value:S.price_per_share,onChange:e=>k(t=>({...t,price_per_share:e.target.value}))}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:"Used for subscription calculations"})]})]}),(eh||ep)&&(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 p-4 rounded-lg bg-amber-500/5 border border-amber-500/20",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c.Label,{htmlFor:"cost_per_share",className:"text-amber-200",children:"Cost per Share (Internal)"}),(0,t.jsx)(d.Input,{id:"cost_per_share",type:"number",step:"0.01",placeholder:"e.g., 8.00",value:S.cost_per_share,onChange:e=>k(t=>({...t,cost_per_share:e.target.value})),className:"border-amber-500/30"}),(0,t.jsx)("p",{className:"text-xs text-amber-200/70",children:"VERSO's acquisition cost (not shown to investors)"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c.Label,{className:"text-amber-200",children:"Spread per Share"}),(0,t.jsx)("div",{className:"h-10 px-3 rounded-md bg-background/50 border border-amber-500/30 flex items-center text-sm font-medium",children:(m=parseFloat(S.price_per_share)||0,x=parseFloat(S.cost_per_share)||0,m>0&&x>0?`${(m-x).toFixed(2)}`:"—")}),(0,t.jsx)("p",{className:"text-xs text-amber-200/70",children:"Calculated: price − cost"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c.Label,{className:"text-amber-200",children:"Margin %"}),(0,t.jsx)("div",{className:"h-10 px-3 rounded-md bg-background/50 border border-amber-500/30 flex items-center text-sm font-medium",children:(u=parseFloat(S.price_per_share)||0,h=parseFloat(S.cost_per_share)||0,u>0&&h>0?`${((u-h)/h*100).toFixed(1)}%`:"—")}),(0,t.jsx)("p",{className:"text-xs text-amber-200/70",children:"Margin on cost"})]})]}),(0,t.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c.Label,{htmlFor:"minimum_ticket",children:"Minimum Ticket"}),(0,t.jsx)(d.Input,{id:"minimum_ticket",type:"number",value:S.minimum_ticket,onChange:e=>k(t=>({...t,minimum_ticket:e.target.value}))})]})}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c.Label,{htmlFor:"subscription_fee_percent",children:"Subscription Fee %"}),(0,t.jsx)(d.Input,{id:"subscription_fee_percent",type:"number",step:"0.01",value:S.subscription_fee_percent,onChange:e=>k(t=>({...t,subscription_fee_percent:e.target.value}))})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c.Label,{htmlFor:"management_fee_percent",children:"Management Fee %"}),(0,t.jsx)(d.Input,{id:"management_fee_percent",type:"number",step:"0.01",value:S.management_fee_percent,onChange:e=>k(t=>({...t,management_fee_percent:e.target.value}))})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c.Label,{htmlFor:"carried_interest_percent",children:"Carried Interest %"}),(0,t.jsx)(d.Input,{id:"carried_interest_percent",type:"number",step:"0.01",value:S.carried_interest_percent,onChange:e=>k(t=>({...t,carried_interest_percent:e.target.value}))})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c.Label,{htmlFor:"management_fee_clause",children:"Management Fee Clause"}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:'Optional descriptive text (e.g., "Waived instead of 2.00% per annum")'}),(0,t.jsx)(d.Input,{id:"management_fee_clause",placeholder:"e.g., Waived (instead of 2.00% per annum)",value:S.management_fee_clause,onChange:e=>k(t=>({...t,management_fee_clause:e.target.value}))})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c.Label,{htmlFor:"performance_fee_clause",children:"Performance Fee Clause"}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:'Optional descriptive text (e.g., "Waived instead of 20% no hurdle")'}),(0,t.jsx)(d.Input,{id:"performance_fee_clause",placeholder:"e.g., Waived (instead of 20.00% no hurdle rate)",value:S.performance_fee_clause,onChange:e=>k(t=>({...t,performance_fee_clause:e.target.value}))})]})]}),(0,t.jsx)(eP.Separator,{}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c.Label,{htmlFor:"interest_confirmation_deadline",children:"Interest Confirmation Deadline"}),(0,t.jsx)(d.Input,{id:"interest_confirmation_deadline",type:"datetime-local",value:S.interest_confirmation_deadline,onChange:e=>k(t=>({...t,interest_confirmation_deadline:e.target.value}))})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c.Label,{htmlFor:"validity_date",children:"Validity Date"}),(0,t.jsx)(d.Input,{id:"validity_date",type:"datetime-local",value:S.validity_date,onChange:e=>k(t=>({...t,validity_date:e.target.value}))})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c.Label,{htmlFor:"completion_date",children:"Completion Date"}),(0,t.jsx)(d.Input,{id:"completion_date",type:"date",value:S.completion_date,onChange:e=>k(t=>({...t,completion_date:e.target.value}))}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:"When set, enables automatic CEO approval for deal closing."})]})]})]}),(0,t.jsxs)(i.DialogFooter,{className:"flex items-center justify-between",children:[(0,t.jsx)(r.Button,{type:"button",variant:"ghost",onClick:eT,disabled:F,children:"Cancel"}),(0,t.jsxs)(r.Button,{onClick:eD,disabled:F,children:[F&&(0,t.jsx)(j.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),"Save Term Sheet"]})]})]})}),(0,t.jsx)(en.default,{open:z,onClose:ev,onSuccess:()=>{ev(),eg()},dealId:e,initialTermSheetId:Q}),(0,t.jsx)(eR.DocumentViewerFullscreen,{isOpen:K,document:ei,previewUrl:Z,isLoading:X,error:ea,onClose:()=>{W(!1),ee(null),es(null),er(null),ed(null)},onDownload:()=>{Z&&window.open(Z,"_blank")}})]})}let eK={pending_review:"bg-amber-500/20 text-amber-100",approved:"bg-emerald-500/20 text-emerald-100",rejected:"bg-rose-500/20 text-rose-100",withdrawn:"bg-muted text-muted-foreground",signal:"bg-purple-500/20 text-purple-100"},eW={pending_review:"bg-amber-500/20 text-amber-100",approved:"bg-emerald-500/20 text-emerald-100",rejected:"bg-rose-500/20 text-rose-100",cancelled:"bg-muted text-muted-foreground"};function eX({dealId:e,interests:r,subscriptions:n}){let i=(0,s.useMemo)(()=>{let e=r?.filter(e=>e.is_post_close)??[],t=r?.filter(e=>!e.is_post_close&&"pending_review"===e.status)??[];return{signals:e,pending:t,approved:r?.filter(e=>!e.is_post_close&&"approved"===e.status)??[],other:r?.filter(e=>!e.is_post_close&&!["pending_review","approved"].includes(e.status))??[]}},[r]);return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)(a.Card,{className:"border-border bg-muted/50",children:[(0,t.jsxs)(a.CardHeader,{className:"flex flex-row items-start justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(a.CardTitle,{className:"text-foreground",children:"Interest Pipeline"}),(0,t.jsx)(a.CardDescription,{children:"Track investor signals and align approvals with NDA and data-room workflows."})]}),(0,t.jsx)(f.default,{href:`/versotech_main/approvals?entity=deal_interest&deal=${e}`,className:"text-sm font-medium text-sky-300 hover:text-sky-200",children:"View related approvals ➜"})]}),(0,t.jsxs)(a.CardContent,{className:"space-y-6",children:[i.signals.length>0&&(0,t.jsx)(eY,{title:"Future Interest Signals (Closed Deal)",interests:i.signals,emptyLabel:""}),(0,t.jsx)(eY,{title:"Pending Review",interests:i.pending,emptyLabel:"No pending interests."}),(0,t.jsx)(eY,{title:"Approved",interests:i.approved,emptyLabel:"No approved interests yet."}),i.other.length>0&&(0,t.jsx)(eY,{title:"Completed",interests:i.other,emptyLabel:""})]})]}),(0,t.jsxs)(a.Card,{className:"border-border bg-muted/50",children:[(0,t.jsxs)(a.CardHeader,{className:"flex flex-row items-start justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(a.CardTitle,{className:"text-foreground",children:"Subscription Submissions"}),(0,t.jsx)(a.CardDescription,{children:"Monitor definitive commitments flowing in from the investor data room."})]}),(0,t.jsx)(f.default,{href:`/versotech_main/approvals?entity=deal_subscription&deal=${e}`,className:"text-sm font-medium text-sky-300 hover:text-sky-200",children:"View related approvals ➜"})]}),(0,t.jsx)(a.CardContent,{children:(0,t.jsxs)(F.Table,{className:"min-w-full",children:[(0,t.jsx)(F.TableHeader,{children:(0,t.jsxs)(F.TableRow,{children:[(0,t.jsx)(F.TableHead,{children:"Investor"}),(0,t.jsx)(F.TableHead,{children:"Status"}),(0,t.jsx)(F.TableHead,{children:"Submitted"}),(0,t.jsx)(F.TableHead,{children:"Amount (derived)"})]})}),(0,t.jsx)(F.TableBody,{children:n?.length?n.map(e=>{let s=e.payload_json?.amount??e.payload_json?.subscription_amount??e.payload_json?.commitment_amount,a="number"==typeof s?s:parseFloat(s??""),r=Number.isFinite(a)?a.toLocaleString():void 0;return(0,t.jsxs)(F.TableRow,{children:[(0,t.jsx)(F.TableCell,{children:e.investors?.legal_name||"Unknown investor"}),(0,t.jsx)(F.TableCell,{children:(0,t.jsx)(l.Badge,{className:eW[e.status]??"bg-muted",children:e.status.replace("_"," ").toUpperCase()})}),(0,t.jsx)(F.TableCell,{children:e.submitted_at?(0,T.format)(new Date(e.submitted_at),"dd MMM yyyy HH:mm"):"—"}),(0,t.jsx)(F.TableCell,{children:r??"—"})]},e.id)}):(0,t.jsx)(F.TableRow,{children:(0,t.jsx)(F.TableCell,{colSpan:4,className:"text-center text-muted-foreground py-6",children:"No subscription submissions yet."})})})]})})]})]})}function eY({title:e,interests:s,emptyLabel:a}){return(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("h4",{className:"text-sm font-semibold text-foreground",children:e}),(0,t.jsxs)(F.Table,{className:"min-w-full",children:[(0,t.jsx)(F.TableHeader,{children:(0,t.jsxs)(F.TableRow,{children:[(0,t.jsx)(F.TableHead,{children:"Investor"}),(0,t.jsx)(F.TableHead,{children:"Action"}),(0,t.jsx)(F.TableHead,{children:"Status"}),(0,t.jsx)(F.TableHead,{children:"Indicative Amount"}),(0,t.jsx)(F.TableHead,{children:"Submitted"})]})}),(0,t.jsx)(F.TableBody,{children:s.length?s.map(e=>{let s=e.is_post_close?"signal":e.status,a=e.is_post_close?"SIGNAL":e.status.replace("_"," ").toUpperCase();return(0,t.jsxs)(F.TableRow,{children:[(0,t.jsx)(F.TableCell,{children:e.investors?.legal_name||"Unknown investor"}),(0,t.jsx)(F.TableCell,{children:e.is_post_close?(0,t.jsx)(l.Badge,{className:"bg-purple-500/20 text-purple-100",children:"Notify Me About Similar"}):(0,t.jsx)(l.Badge,{className:"bg-blue-500/20 text-blue-100",children:"I'm Interested"})}),(0,t.jsx)(F.TableCell,{children:(0,t.jsx)(l.Badge,{className:eK[s]??"bg-muted",children:a})}),(0,t.jsx)(F.TableCell,{children:e.indicative_amount?`${e.indicative_currency??""} ${e.indicative_amount.toLocaleString()}`:"—"}),(0,t.jsx)(F.TableCell,{children:e.submitted_at?(0,T.format)(new Date(e.submitted_at),"dd MMM yyyy HH:mm"):"—"})]},e.id)}):(0,t.jsx)(F.TableRow,{children:(0,t.jsx)(F.TableCell,{colSpan:5,className:"text-center text-muted-foreground py-6",children:a})})})]})]})}var eZ=e.i(695817),e0=e.i(398472);let e2={investorId:"",expiresAt:"",autoGranted:!1,notes:""};function e4({dealId:e,dealName:n,memberships:x,accessRecords:h,documents:p}){let f=(0,b.useRouter)(),[v,_]=(0,s.useState)(!1),[N,y]=(0,s.useState)(e2),[w,S]=(0,s.useState)(null),[k,D]=(0,s.useState)(!1),[I,L]=(0,s.useState)(null),[A,P]=(0,s.useState)(h??[]),[E,$]=(0,s.useState)(null),[B,H]=(0,s.useState)({}),[U,R]=(0,s.useState)(!1);(0,s.useEffect)(()=>{P(h??[])},[h]);let O=(0,s.useMemo)(()=>x?.filter(e=>e.investor_id&&e.investors).map(e=>({id:e.investor_id,label:e.investors?.legal_name||"Unnamed investor"}))??[],[x]);(0,s.useMemo)(()=>{let e=new Map;return p?.forEach(t=>{let s=t.folder||"Uncategorised";e.has(s)||e.set(s,[]),e.get(s).push(t)}),Array.from(e.entries())},[p]);let V=()=>{y(e2),S(null),L(null)},q=()=>{_(!1),V()},z=async()=>{let t=await fetch(`/api/deals/${e}/data-room-access`);t.ok?P((await t.json()).access??[]):L("Failed to refresh access records. Please reload the page.")},G=async()=>{if(!N.investorId)return void L("Select an investor before submitting.");D(!0),L(null);try{let t=await fetch(`/api/deals/${e}/data-room-access`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({investor_id:N.investorId,expires_at:N.expiresAt?new Date(N.expiresAt).toISOString():null,auto_granted:N.autoGranted,notes:N.notes||null})});if(!t.ok){let e=await t.text();throw Error(e||"Failed to save access record")}await z(),q()}catch(e){L(e instanceof Error?e.message:"Unexpected error saving access record")}finally{D(!1)}},Q=async t=>{D(!0),L(null);try{let s=await fetch(`/api/deals/${e}/data-room-access`,{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({access_id:t.id,reason:"Revoked via staff portal"})});if(!s.ok){let e=await s.text();throw Error(e||"Failed to revoke access")}await z()}catch(e){L(e instanceof Error?e.message:"Unexpected error revoking access")}finally{D(!1)}},J=async t=>{try{if(t.external_link)window.open(t.external_link,"_blank","noopener,noreferrer"),el.toast.success("Opening document in new tab");else{let s=await fetch(`/api/deals/${e}/documents/${t.id}/download`);if(!s.ok)throw Error("Failed to get download link");let a=await s.json();window.open(a.download_url,"_blank"),el.toast.success("Document download started")}}catch(e){el.toast.error("Failed to open document")}},K=async()=>{if(E){D(!0);try{let t=await fetch(`/api/deals/${e}/documents/${E}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(B)});if(!t.ok){let e=await t.json();throw Error(e.error||"Failed to update document")}el.toast.success("Document updated successfully"),R(!1),$(null),f.refresh()}catch(e){el.toast.error(e instanceof Error?e.message:"Failed to update document")}finally{D(!1)}}},W=async t=>{if(confirm(`Are you sure you want to delete "${t.file_name}"? This action cannot be undone.`)){D(!0);try{if(!(await fetch(`/api/deals/${e}/documents/${t.id}`,{method:"DELETE"})).ok)throw Error("Failed to delete document");el.toast.success("Document deleted successfully"),f.refresh()}catch(e){el.toast.error("Failed to delete document")}finally{D(!1)}}};return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)(a.Card,{className:"border-border bg-muted/50",children:[(0,t.jsxs)(a.CardHeader,{className:"flex flex-row items-start justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(a.CardTitle,{className:"text-foreground",children:"Data Room Access"}),(0,t.jsx)(a.CardDescription,{children:"Manage NDA-cleared investors, extend access windows, and keep visibility in sync with documentation."})]}),(0,t.jsxs)(r.Button,{onClick:()=>{V(),_(!0)},className:"gap-2",disabled:k,children:[(0,t.jsx)(eZ.KeyRound,{className:"h-4 w-4"}),"Grant Access"]})]}),(0,t.jsxs)(a.CardContent,{children:[I&&(0,t.jsx)("div",{className:"mb-4 rounded-md border border-destructive/40 bg-destructive/10 px-4 py-3 text-sm text-destructive",children:I}),(0,t.jsxs)(F.Table,{className:"min-w-full",children:[(0,t.jsx)(F.TableHeader,{children:(0,t.jsxs)(F.TableRow,{children:[(0,t.jsx)(F.TableHead,{children:"Investor"}),(0,t.jsx)(F.TableHead,{children:"Granted"}),(0,t.jsx)(F.TableHead,{children:"Expires"}),(0,t.jsx)(F.TableHead,{children:"Status"}),(0,t.jsx)(F.TableHead,{className:"text-right",children:"Actions"})]})}),(0,t.jsx)(F.TableBody,{children:A?.length?A.map(e=>{let s=!!e.revoked_at,a=!e.revoked_at&&e.expires_at&&new Date(e.expires_at)<new Date(Date.now()+2592e5);return(0,t.jsxs)(F.TableRow,{children:[(0,t.jsx)(F.TableCell,{className:"font-medium",children:e.investors?.legal_name||"Unknown investor"}),(0,t.jsx)(F.TableCell,{children:e.granted_at?(0,T.format)(new Date(e.granted_at),"dd MMM yyyy HH:mm"):"—"}),(0,t.jsx)(F.TableCell,{children:e.expires_at?`${(0,T.format)(new Date(e.expires_at),"dd MMM yyyy HH:mm")} (${(0,eT.formatDistanceToNow)(new Date(e.expires_at),{addSuffix:!0})})`:"No expiry"}),(0,t.jsx)(F.TableCell,{children:(0,t.jsx)(l.Badge,{className:s?"bg-rose-500/20 text-rose-100":a?"bg-amber-500/20 text-amber-100":"bg-emerald-500/20 text-emerald-100",children:s?"REVOKED":a?"EXPIRING":"ACTIVE"})}),(0,t.jsxs)(F.TableCell,{className:"text-right space-x-2",children:[(0,t.jsxs)(r.Button,{variant:"outline",size:"sm",className:"gap-2",onClick:()=>{y({investorId:e.investor_id,expiresAt:e.expires_at?e.expires_at.slice(0,16):"",autoGranted:!!e.auto_granted,notes:e.notes??""}),S(e.id),L(null),_(!0)},disabled:k||s,children:[(0,t.jsx)(es.Clock,{className:"h-4 w-4"}),"Extend"]}),(0,t.jsxs)(r.Button,{variant:"outline",size:"sm",className:"gap-2 text-rose-300",onClick:()=>Q(e),disabled:k||s,children:[(0,t.jsx)(M.Trash2,{className:"h-4 w-4"}),"Revoke"]})]})]},e.id)}):(0,t.jsx)(F.TableRow,{children:(0,t.jsx)(F.TableCell,{colSpan:5,className:"text-center text-muted-foreground py-6",children:"No active access yet. Grant access once the NDA is signed."})})})]})]})]}),(0,t.jsxs)(a.Card,{className:"border-border bg-muted/50",children:[(0,t.jsxs)(a.CardHeader,{className:"flex flex-row items-start justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(a.CardTitle,{className:"text-foreground",children:"Data Room Documents"}),(0,t.jsx)(a.CardDescription,{children:"Upload and manage documents that investors can access in their data room."})]}),(0,t.jsx)(eg,{dealId:e,onUploadComplete:z,trigger:(0,t.jsxs)(r.Button,{className:"gap-2",children:[(0,t.jsx)(C.Plus,{className:"h-4 w-4"}),"Upload Files"]})})]}),(0,t.jsx)(a.CardContent,{children:p?.length?(0,t.jsxs)(F.Table,{children:[(0,t.jsx)(F.TableHeader,{children:(0,t.jsxs)(F.TableRow,{children:[(0,t.jsx)(F.TableHead,{children:"Document"}),(0,t.jsx)(F.TableHead,{children:"Folder"}),(0,t.jsx)(F.TableHead,{children:"Visible to Investors"}),(0,t.jsx)(F.TableHead,{children:"Uploaded"}),(0,t.jsx)(F.TableHead,{className:"text-right",children:"Actions"})]})}),(0,t.jsx)(F.TableBody,{children:p.map(e=>(0,t.jsxs)(F.TableRow,{children:[(0,t.jsx)(F.TableCell,{className:"font-medium",children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[e.external_link?(0,t.jsx)(e0.ExternalLink,{className:"h-4 w-4 text-blue-500"}):(0,t.jsx)(u.FileText,{className:"h-4 w-4 text-muted-foreground"}),e.file_name||e.file_key?.split("/").pop()||"Untitled",e.external_link&&(0,t.jsx)(l.Badge,{variant:"outline",className:"ml-2 text-xs bg-blue-500/10 text-blue-400 border-blue-500/30",children:"Link"})]})}),(0,t.jsx)(F.TableCell,{children:(0,t.jsx)(l.Badge,{variant:"outline",children:e.folder||"Uncategorized"})}),(0,t.jsx)(F.TableCell,{children:(0,t.jsx)(l.Badge,{className:e.visible_to_investors?"bg-emerald-500/20 text-emerald-100":"bg-muted text-muted-foreground",children:e.visible_to_investors?"YES":"NO"})}),(0,t.jsx)(F.TableCell,{className:"text-sm text-muted-foreground",children:e.created_at?(0,T.format)(new Date(e.created_at),"MMM d, yyyy"):"—"}),(0,t.jsxs)(F.TableCell,{className:"text-right space-x-2",children:[(0,t.jsx)(r.Button,{variant:"outline",size:"sm",className:"gap-2",onClick:()=>J(e),disabled:k,children:e.external_link?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(e0.ExternalLink,{className:"h-4 w-4"}),"View"]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(er.Download,{className:"h-4 w-4"}),"Download"]})}),(0,t.jsxs)(r.Button,{variant:"outline",size:"sm",className:"gap-2",onClick:()=>{$(e.id),H({file_name:e.file_name||"",folder:e.folder||"Legal",visible_to_investors:e.visible_to_investors||!1,document_notes:e.document_notes||"",external_link:e.external_link||""}),R(!0)},disabled:k,children:[(0,t.jsx)(g.Edit,{className:"h-4 w-4"}),"Edit"]}),(0,t.jsxs)(r.Button,{variant:"outline",size:"sm",className:"gap-2 text-rose-300",onClick:()=>W(e),disabled:k,children:[(0,t.jsx)(M.Trash2,{className:"h-4 w-4"}),"Delete"]})]})]},e.id))})]}):(0,t.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:"No documents have been published to the data room yet."})})]}),(0,t.jsx)(i.Dialog,{open:v,onOpenChange:e=>!e&&q(),children:(0,t.jsxs)(i.DialogContent,{className:"sm:max-w-lg",children:[(0,t.jsxs)(i.DialogHeader,{children:[(0,t.jsx)(i.DialogTitle,{children:w?"Update Data Room Access":"Grant Data Room Access"}),(0,t.jsxs)(a.CardDescription,{children:["Select an investor and optionally set an expiry to control data room visibility for ",n,"."]})]}),(0,t.jsxs)("div",{className:"space-y-4 py-2",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c.Label,{children:"Investor"}),(0,t.jsxs)(m.Select,{value:N.investorId,onValueChange:e=>y(t=>({...t,investorId:e})),children:[(0,t.jsx)(m.SelectTrigger,{children:(0,t.jsx)(m.SelectValue,{placeholder:"Select investor"})}),(0,t.jsx)(m.SelectContent,{children:O.length?O.map(e=>(0,t.jsx)(m.SelectItem,{value:e.id,children:e.label},e.id)):(0,t.jsx)(m.SelectItem,{value:"",children:"No investors invited yet"})})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c.Label,{htmlFor:"expiresAt",children:"Expiry"}),(0,t.jsx)(d.Input,{id:"expiresAt",type:"datetime-local",value:N.expiresAt,onChange:e=>y(t=>({...t,expiresAt:e.target.value}))}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:"Leave blank for open-ended access."})]}),(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)(eo.Checkbox,{id:"autoGranted",checked:N.autoGranted,onCheckedChange:e=>y(t=>({...t,autoGranted:!!e}))}),(0,t.jsx)(c.Label,{htmlFor:"autoGranted",className:"text-sm font-medium",children:"Mark as auto-granted (automation)"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c.Label,{htmlFor:"notes",children:"Notes"}),(0,t.jsx)(o.Textarea,{id:"notes",rows:3,value:N.notes,onChange:e=>y(t=>({...t,notes:e.target.value}))})]})]}),(0,t.jsxs)(i.DialogFooter,{className:"flex items-center justify-between",children:[(0,t.jsx)(r.Button,{type:"button",variant:"ghost",onClick:q,disabled:k,children:"Cancel"}),(0,t.jsxs)(r.Button,{onClick:G,disabled:k,children:[k&&(0,t.jsx)(j.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),"Save Access"]})]})]})}),(0,t.jsx)(i.Dialog,{open:U,onOpenChange:R,children:(0,t.jsxs)(i.DialogContent,{className:"sm:max-w-lg",children:[(0,t.jsxs)(i.DialogHeader,{children:[(0,t.jsx)(i.DialogTitle,{children:"Edit Document"}),(0,t.jsx)(a.CardDescription,{children:"Update document metadata, folder, and visibility settings."})]}),(0,t.jsxs)("div",{className:"space-y-4 py-2",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c.Label,{htmlFor:"fileName",children:"Document Name"}),(0,t.jsx)(d.Input,{id:"fileName",value:B.file_name||"",onChange:e=>H(t=>({...t,file_name:e.target.value})),placeholder:"Enter document name..."})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c.Label,{htmlFor:"externalLink",children:"External Link (optional)"}),(0,t.jsx)(d.Input,{id:"externalLink",type:"url",value:B.external_link||"",onChange:e=>H(t=>({...t,external_link:e.target.value})),placeholder:"https://drive.google.com/file/d/..."}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:"Leave empty for uploaded files. Add a Google Drive, Dropbox, or other external link to reference documents hosted elsewhere."})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c.Label,{children:"Folder"}),(0,t.jsxs)(m.Select,{value:B.folder,onValueChange:e=>H(t=>({...t,folder:e})),children:[(0,t.jsx)(m.SelectTrigger,{children:(0,t.jsx)(m.SelectValue,{})}),(0,t.jsxs)(m.SelectContent,{children:[(0,t.jsx)(m.SelectItem,{value:"Legal",children:"Legal"}),(0,t.jsx)(m.SelectItem,{value:"KYC",children:"KYC"}),(0,t.jsx)(m.SelectItem,{value:"Reports",children:"Reports"}),(0,t.jsx)(m.SelectItem,{value:"Presentations",children:"Presentations"}),(0,t.jsx)(m.SelectItem,{value:"Financial Models",children:"Financial Models"}),(0,t.jsx)(m.SelectItem,{value:"Misc",children:"Misc"})]})]})]}),(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)(eo.Checkbox,{id:"docVisible",checked:B.visible_to_investors,onCheckedChange:e=>H(t=>({...t,visible_to_investors:!!e}))}),(0,t.jsx)(c.Label,{htmlFor:"docVisible",className:"text-sm font-medium",children:"Visible to investors"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c.Label,{htmlFor:"docNotes",children:"Notes"}),(0,t.jsx)(o.Textarea,{id:"docNotes",rows:3,value:B.document_notes,onChange:e=>H(t=>({...t,document_notes:e.target.value})),placeholder:"Internal notes about this document..."})]})]}),(0,t.jsxs)(i.DialogFooter,{className:"flex items-center justify-between",children:[(0,t.jsx)(r.Button,{type:"button",variant:"ghost",onClick:()=>R(!1),disabled:k,children:"Cancel"}),(0,t.jsxs)(r.Button,{onClick:K,disabled:k,children:[k&&(0,t.jsx)(j.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),"Save Changes"]})]})]})})]})}function e1({dealId:e}){let[n,i]=(0,s.useState)([]),[d,c]=(0,s.useState)(!0),o={pending_review:"bg-yellow-100 dark:bg-yellow-500/20 text-yellow-700 dark:text-yellow-200",approved:"bg-emerald-100 dark:bg-emerald-500/20 text-emerald-700 dark:text-emerald-200",rejected:"bg-red-100 dark:bg-red-500/20 text-red-700 dark:text-red-200",pending_signature:"bg-blue-100 dark:bg-blue-500/20 text-blue-700 dark:text-blue-200",committed:"bg-green-100 dark:bg-green-500/20 text-green-700 dark:text-green-200"},m={no_pack:"bg-muted text-muted-foreground",draft:"bg-purple-100 dark:bg-purple-500/20 text-purple-700 dark:text-purple-200",final:"bg-cyan-100 dark:bg-cyan-500/20 text-cyan-700 dark:text-cyan-200",pending_signature:"bg-amber-100 dark:bg-amber-500/20 text-amber-700 dark:text-amber-200",signed:"bg-emerald-100 dark:bg-emerald-500/20 text-emerald-700 dark:text-emerald-200"},x={no_pack:"No Pack",draft:"Draft Generated",final:"Final Uploaded",pending_signature:"Awaiting Signatures",signed:"Fully Executed"},h=(0,s.useCallback)(async()=>{c(!0);try{let t=await fetch(`/api/deals/${e}/subscriptions`);if(!t.ok)throw Error("Failed to fetch subscriptions");let s=await t.json();i(s.submissions||[])}catch(e){console.error("Error fetching subscriptions:",e),el.toast.error("Failed to load subscriptions")}finally{c(!1)}},[e]);return((0,s.useEffect)(()=>{h()},[e,h]),d)?(0,t.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,t.jsx)(j.Loader2,{className:"h-8 w-8 animate-spin text-muted-foreground"})}):(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)(a.Card,{className:"border border-border bg-muted/50",children:[(0,t.jsx)(a.CardHeader,{children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)(a.CardTitle,{className:"text-foreground flex items-center gap-2",children:[(0,t.jsx)(u.FileText,{className:"h-5 w-5"}),"Subscription Submissions"]}),(0,t.jsx)(a.CardDescription,{children:"Investor subscriptions and pack generation status"})]}),(0,t.jsxs)("div",{className:"text-sm text-muted-foreground",children:[n.length," ",1===n.length?"submission":"submissions"]})]})}),(0,t.jsx)(a.CardContent,{children:0===n.length?(0,t.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:"No subscription submissions yet for this deal."}):(0,t.jsx)("div",{className:"space-y-2",children:n.map(e=>{let s,a;return(0,t.jsxs)("div",{className:"flex items-center justify-between py-4 px-4 rounded-lg border border-border bg-muted/50 hover:bg-muted transition-colors",children:[(0,t.jsxs)("div",{className:"flex items-center gap-4 flex-1",children:[(0,t.jsx)(u.FileText,{className:"h-5 w-5 text-muted-foreground"}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,t.jsx)("span",{className:"font-medium text-foreground",children:e.investors.legal_name}),(0,t.jsx)(l.Badge,{className:o[e.status]||o.pending_review,children:e.status.replace(/_/g," ").toUpperCase()})]}),(0,t.jsxs)("div",{className:"flex items-center gap-4 text-sm text-muted-foreground",children:[(0,t.jsxs)("span",{children:["Amount: ",(s=e.payload_json?.amount||e.payload_json?.subscription_amount,a=e.payload_json?.currency||"USD",s?new Intl.NumberFormat("en-US",{style:"currency",currency:a}).format(s):"Not specified")]}),(0,t.jsx)("span",{children:"•"}),(0,t.jsxs)("span",{children:["Submitted ",new Date(e.submitted_at).toLocaleDateString()]})]})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsxs)("div",{className:"text-right mr-2",children:[(0,t.jsx)("div",{className:"text-xs text-muted-foreground mb-1",children:"Subscription Pack"}),(0,t.jsx)(l.Badge,{className:m[e.pack_status||"no_pack"],children:x[e.pack_status||"no_pack"]})]}),(e.subscription_id||e.pack_document_id)&&(0,t.jsxs)(r.Button,{variant:"outline",size:"sm",className:"gap-2",onClick:()=>{e.subscription_id?window.open(`/versotech_main/subscriptions/${e.subscription_id}`,"_blank"):e.pack_document_id?window.open(`/api/documents/${e.pack_document_id}/download`,"_blank"):el.toast.info("This subscription has not been converted to a formal commitment yet, and no subscription pack has been generated.")},children:[(0,t.jsx)(e0.ExternalLink,{className:"h-4 w-4"}),e.subscription_id?"View Subscription":"View Pack"]})]})]},e.id)})})})]}),(0,t.jsxs)(a.Card,{className:"border border-border bg-muted/50",children:[(0,t.jsx)(a.CardHeader,{children:(0,t.jsx)(a.CardTitle,{className:"text-sm text-foreground",children:"Pack Status Legend"})}),(0,t.jsx)(a.CardContent,{children:(0,t.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-3 text-sm",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(l.Badge,{className:m.no_pack,children:"No Pack"}),(0,t.jsx)("span",{className:"text-muted-foreground",children:"No document generated"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(l.Badge,{className:m.draft,children:"Draft"}),(0,t.jsx)("span",{className:"text-muted-foreground",children:"System generated draft"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(l.Badge,{className:m.final,children:"Final"}),(0,t.jsx)("span",{className:"text-muted-foreground",children:"Staff uploaded final"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(l.Badge,{className:m.pending_signature,children:"Awaiting"}),(0,t.jsx)("span",{className:"text-muted-foreground",children:"Sent for signatures"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(l.Badge,{className:m.signed,children:"Executed"}),(0,t.jsx)("span",{className:"text-muted-foreground",children:"All parties signed"})]})]})})]})]})}var e5=e.i(682950);function e3({open:e,onOpenChange:a,dealId:l,faq:n,onSave:m}){let[x,u]=(0,s.useState)(""),[h,p]=(0,s.useState)(""),[g,f]=(0,s.useState)(!1);(0,s.useEffect)(()=>{n?(u(n.question),p(n.answer)):(u(""),p(""))},[n,e]);let b=async e=>{if(e.preventDefault(),!x.trim()||!h.trim())return void el.toast.error("Question and answer are required");f(!0);try{let e=n?`/api/deals/${l}/faqs/${n.id}`:`/api/deals/${l}/faqs`,t=n?"PATCH":"POST",s=await fetch(e,{method:t,headers:{"Content-Type":"application/json"},body:JSON.stringify({question:x,answer:h})}),r=await s.json();if(!s.ok)throw Error(r.error||"Failed to save FAQ");el.toast.success(n?"FAQ updated successfully":"FAQ created successfully"),m(),a(!1)}catch(e){console.error("Error saving FAQ:",e),el.toast.error(e instanceof Error?e.message:"Failed to save FAQ")}finally{f(!1)}};return(0,t.jsx)(i.Dialog,{open:e,onOpenChange:a,children:(0,t.jsx)(i.DialogContent,{className:"sm:max-w-[600px]",children:(0,t.jsxs)("form",{onSubmit:b,children:[(0,t.jsxs)(i.DialogHeader,{children:[(0,t.jsx)(i.DialogTitle,{children:n?"Edit FAQ":"Add New FAQ"}),(0,t.jsx)(i.DialogDescription,{children:n?"Update the question and answer":"Create a new frequently asked question for this deal"})]}),(0,t.jsxs)("div",{className:"grid gap-4 py-4",children:[(0,t.jsxs)("div",{className:"grid gap-2",children:[(0,t.jsx)(c.Label,{htmlFor:"question",children:"Question"}),(0,t.jsx)(d.Input,{id:"question",value:x,onChange:e=>u(e.target.value),placeholder:"e.g., What is the minimum investment amount?",maxLength:500,required:!0}),(0,t.jsxs)("p",{className:"text-xs text-muted-foreground",children:[x.length,"/500 characters"]})]}),(0,t.jsxs)("div",{className:"grid gap-2",children:[(0,t.jsx)(c.Label,{htmlFor:"answer",children:"Answer"}),(0,t.jsx)(o.Textarea,{id:"answer",value:h,onChange:e=>p(e.target.value),placeholder:"Provide a clear and concise answer...",rows:6,maxLength:5e3,required:!0}),(0,t.jsxs)("p",{className:"text-xs text-muted-foreground",children:[h.length,"/5000 characters"]})]})]}),(0,t.jsxs)(i.DialogFooter,{children:[(0,t.jsx)(r.Button,{type:"button",variant:"outline",onClick:()=>a(!1),disabled:g,children:"Cancel"}),(0,t.jsxs)(r.Button,{type:"submit",disabled:g,children:[g&&(0,t.jsx)(j.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),n?"Update":"Create"," FAQ"]})]})]})})})}var e6=e.i(908925);function e8({faq:e,onEdit:s,onDelete:l}){return(0,t.jsx)(a.Card,{children:(0,t.jsx)(a.CardContent,{className:"pt-6",children:(0,t.jsxs)("div",{className:"flex items-start justify-between gap-4",children:[(0,t.jsxs)("div",{className:"flex-1 space-y-2",children:[(0,t.jsx)("h4",{className:"font-semibold text-sm",children:e.question}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground whitespace-pre-wrap",children:e.answer})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(r.Button,{variant:"ghost",size:"sm",onClick:s,children:(0,t.jsx)(g.Edit,{className:"h-4 w-4"})}),(0,t.jsxs)(e6.AlertDialog,{children:[(0,t.jsx)(e6.AlertDialogTrigger,{asChild:!0,children:(0,t.jsx)(r.Button,{variant:"ghost",size:"sm",children:(0,t.jsx)(M.Trash2,{className:"h-4 w-4 text-destructive"})})}),(0,t.jsxs)(e6.AlertDialogContent,{children:[(0,t.jsxs)(e6.AlertDialogHeader,{children:[(0,t.jsx)(e6.AlertDialogTitle,{children:"Delete FAQ?"}),(0,t.jsx)(e6.AlertDialogDescription,{children:"Are you sure you want to delete this FAQ? This action cannot be undone."})]}),(0,t.jsxs)(e6.AlertDialogFooter,{children:[(0,t.jsx)(e6.AlertDialogCancel,{children:"Cancel"}),(0,t.jsx)(e6.AlertDialogAction,{onClick:l,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Delete"})]})]})]})]})]})})})}function e7({dealId:e}){let[l,n]=(0,s.useState)([]),[i,d]=(0,s.useState)(!0),[c,o]=(0,s.useState)(!1),[m,x]=(0,s.useState)(null),u=(0,s.useCallback)(async()=>{try{let t=await fetch(`/api/deals/${e}/faqs`),s=await t.json();n(s.faqs||[])}catch(e){console.error("Error fetching FAQs:",e),el.toast.error("Failed to load FAQs")}finally{d(!1)}},[e]);(0,s.useEffect)(()=>{u()},[u]);let h=async t=>{try{let s=await fetch(`/api/deals/${e}/faqs/${t}`,{method:"DELETE"});if(!s.ok){let e=await s.json();throw Error(e.error||"Failed to delete")}n(l.filter(e=>e.id!==t)),el.toast.success("FAQ deleted successfully")}catch(e){console.error("Error deleting FAQ:",e),el.toast.error(e instanceof Error?e.message:"Failed to delete FAQ")}},p=()=>{x(null),o(!0)};return i?(0,t.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,t.jsx)(j.Loader2,{className:"h-6 w-6 animate-spin text-muted-foreground"})}):(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)(a.Card,{children:[(0,t.jsx)(a.CardHeader,{children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(e5.HelpCircle,{className:"h-5 w-5 text-primary"}),(0,t.jsx)(a.CardTitle,{children:"Deal FAQs"})]}),(0,t.jsx)(a.CardDescription,{className:"mt-2",children:"Manage frequently asked questions for this deal. Investors with data room access can view these FAQs."})]}),(0,t.jsxs)(r.Button,{onClick:p,children:[(0,t.jsx)(C.Plus,{className:"h-4 w-4 mr-2"}),"Add FAQ"]})]})}),(0,t.jsx)(a.CardContent,{children:0===l.length?(0,t.jsxs)("div",{className:"text-center py-12 border-2 border-dashed rounded-lg",children:[(0,t.jsx)(e5.HelpCircle,{className:"h-12 w-12 mx-auto text-muted-foreground mb-4"}),(0,t.jsx)("p",{className:"text-muted-foreground font-medium mb-2",children:"No FAQs yet"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground mb-4",children:"Add frequently asked questions to help investors understand this deal better."}),(0,t.jsxs)(r.Button,{onClick:p,variant:"outline",children:[(0,t.jsx)(C.Plus,{className:"h-4 w-4 mr-2"}),"Add Your First FAQ"]})]}):(0,t.jsx)("div",{className:"space-y-4",children:l.map(e=>(0,t.jsx)(e8,{faq:e,onEdit:()=>{x(e),o(!0)},onDelete:()=>h(e.id)},e.id))})})]}),(0,t.jsx)(e3,{open:c,onOpenChange:e=>{o(e),e||x(null)},dealId:e,faq:m,onSave:()=>{u(),o(!1),x(null)}})]})}let e9={draft:"bg-muted text-foreground border border-border",open:"bg-emerald-500/20 text-emerald-200 border border-emerald-400/30",allocation_pending:"bg-amber-500/15 text-amber-200 border border-amber-400/30",closed:"bg-blue-500/20 text-blue-200 border border-blue-400/30",cancelled:"bg-red-500/20 text-red-200 border border-red-400/30"},te={equity_secondary:"Secondary",equity_primary:"Primary",credit_trade_finance:"Credit/Trade",other:"Other"};function tt({deal:e,inventorySummary:v,documents:_,termSheets:N,interests:y,dataRoomAccess:C,dataRoomDocuments:S,subscriptions:T,subscriptionsForJourney:F=[],activitySummary:D,userProfile:I,arrangerEntities:L=[]}){let[A,P]=(0,s.useState)("overview"),[E,$]=(0,s.useState)(!1),[B,M]=(0,s.useState)([]),[H,U]=(0,s.useState)(!1),[R,O]=(0,s.useState)({name:e?.name||"",description:e?.description||"",investment_thesis:e?.investment_thesis||"",status:e?.status||"draft",deal_type:e?.deal_type||"equity_secondary",stock_type:e?.stock_type||"common",company_name:e?.company_name||"",company_website:e?.company_website||"",sector:e?.sector||"",stage:e?.stage||"",location:e?.location||"",open_at:e?.open_at?e.open_at.slice(0,16):"",close_at:e?.close_at?e.close_at.slice(0,16):"",target_amount:e?.target_amount||"",currency:e?.currency||"USD",arranger_entity_id:e?.arranger_entity_id||""}),V=(0,b.useRouter)(),q=async()=>{try{let t=await fetch(`/api/deals/${e.id}/inventory`);if(t.ok){let e=await t.json();M(e.inventory||[])}}catch(e){console.error("Failed to fetch share lots:",e)}};(0,s.useEffect)(()=>{e?.id&&q()},[e?.id]),(0,s.useEffect)(()=>{console.log("[DealDetailClient] Component mounted",{dealId:e?.id,dealName:e?.name,dealStatus:e?.status,hasInventory:!!v,termSheetCount:N?.length||0,interestCount:y?.length||0,userRole:I?.role})},[e,v,N,y,I]);let z=async()=>{U(!0);try{if(!(await fetch(`/api/deals/${e.id}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({...R,target_amount:R.target_amount?parseFloat(R.target_amount):null,arranger_entity_id:"none"!==R.arranger_entity_id&&R.arranger_entity_id?R.arranger_entity_id:null})})).ok)throw Error("Failed to update deal");$(!1),V.refresh()}catch(e){console.error("Error updating deal:",e),alert("Failed to update deal. Please try again.")}finally{U(!1)}},G=N?.find(e=>"published"===e.status),Q=y?.filter(e=>"pending_review"===e.status)??[],J=y?.filter(e=>"approved"===e.status)??[],K=C?.filter(e=>!e.revoked_at)??[],W=T?.filter(e=>"pending_review"===e.status)??[],X=D?.nda_completed??0,Y=D?.subscription_completed??0;return e&&e.id?(0,t.jsxs)("div",{className:"p-6 space-y-6",children:[(0,t.jsxs)("div",{className:"flex items-start justify-between",children:[(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsx)("div",{className:"flex items-center gap-3 mb-2",children:(0,t.jsxs)(r.Button,{variant:"ghost",size:"sm",className:"gap-2 text-foreground hover:text-sky-400 hover:bg-muted",onClick:()=>V.push("/versotech_main/deals"),children:[(0,t.jsx)(p.ArrowLeft,{className:"h-4 w-4"}),"Back to Deals"]})}),(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("h1",{className:"text-3xl font-bold text-foreground",children:e.name}),(0,t.jsx)(l.Badge,{className:e9[e.status],children:e.status.replace("_"," ")}),(0,t.jsx)(l.Badge,{variant:"outline",className:"border-border text-foreground",children:te[e.deal_type]})]}),e.company_name&&(0,t.jsxs)("p",{className:"text-muted-foreground text-lg",children:[e.company_name,e.sector&&` • ${e.sector}`,e.location&&` • ${e.location}`]})]}),(0,t.jsx)("div",{className:"flex items-center gap-2",children:(0,t.jsxs)(r.Button,{variant:"outline",className:"gap-2 border-border text-foreground hover:bg-muted",onClick:()=>$(!0),children:[(0,t.jsx)(g.Edit,{className:"h-4 w-4"}),"Edit Deal"]})})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,t.jsxs)(a.Card,{className:"border border-border bg-muted/50",children:[(0,t.jsxs)(a.CardHeader,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,t.jsx)(a.CardTitle,{className:"text-sm font-medium text-muted-foreground",children:"Interest Signals"}),(0,t.jsx)(h.HandCoins,{className:"h-4 w-4 text-muted-foreground"})]}),(0,t.jsxs)(a.CardContent,{children:[(0,t.jsx)("div",{className:"text-2xl font-bold text-foreground",children:y?.length??0}),(0,t.jsxs)("p",{className:"text-xs text-muted-foreground",children:[Q.length," awaiting review"]})]})]}),(0,t.jsxs)(a.Card,{className:"border border-border bg-muted/50",children:[(0,t.jsxs)(a.CardHeader,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,t.jsx)(a.CardTitle,{className:"text-sm font-medium text-muted-foreground",children:"Active NDAs"}),(0,t.jsx)(u.FileText,{className:"h-4 w-4 text-muted-foreground"})]}),(0,t.jsxs)(a.CardContent,{children:[(0,t.jsx)("div",{className:"text-2xl font-bold text-foreground",children:K.length}),(0,t.jsxs)("p",{className:"text-xs text-muted-foreground",children:[J.length," interests approved"]})]})]}),(0,t.jsxs)(a.Card,{className:"border border-border bg-muted/50",children:[(0,t.jsxs)(a.CardHeader,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,t.jsx)(a.CardTitle,{className:"text-sm font-medium text-muted-foreground",children:"Published Term Sheet"}),(0,t.jsx)(x.Package,{className:"h-4 w-4 text-muted-foreground"})]}),(0,t.jsxs)(a.CardContent,{children:[(0,t.jsx)("div",{className:"text-2xl font-bold text-foreground",children:G?`V${G.version}`:"—"}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:G?`Published ${G.published_at?new Date(G.published_at).toLocaleDateString():""}`:"No published version"})]})]}),(0,t.jsxs)(a.Card,{className:"border border-border bg-muted/50",children:[(0,t.jsxs)(a.CardHeader,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,t.jsx)(a.CardTitle,{className:"text-sm font-medium text-muted-foreground",children:"Subscriptions"}),(0,t.jsx)(x.Package,{className:"h-4 w-4 text-muted-foreground"})]}),(0,t.jsxs)(a.CardContent,{children:[(0,t.jsx)("div",{className:"text-2xl font-bold text-foreground",children:T?.length??0}),(0,t.jsxs)("p",{className:"text-xs text-muted-foreground",children:[W.length," awaiting approval"]})]})]}),(0,t.jsxs)(a.Card,{className:"border border-border bg-muted/50",children:[(0,t.jsxs)(a.CardHeader,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,t.jsx)(a.CardTitle,{className:"text-sm font-medium text-muted-foreground",children:"Conversions (90d)"}),(0,t.jsx)(l.Badge,{variant:"outline",children:"Analytics"})]}),(0,t.jsx)(a.CardContent,{children:(0,t.jsxs)("div",{className:"flex flex-col gap-1 text-xs text-muted-foreground",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("span",{children:"NDA completed"}),(0,t.jsx)("span",{className:"font-semibold text-foreground",children:X})]}),(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("span",{children:"Subscriptions funded"}),(0,t.jsx)("span",{className:"font-semibold text-foreground",children:Y})]})]})})]})]}),(0,t.jsxs)(n.Tabs,{defaultValue:"overview",value:A,onValueChange:P,id:`deal-tabs-${e.id}`,children:[(0,t.jsxs)(n.TabsList,{className:"flex flex-wrap gap-2",children:[(0,t.jsx)(n.TabsTrigger,{value:"overview",children:"Overview"}),(0,t.jsx)(n.TabsTrigger,{value:"term-sheet",children:"Term Sheets"}),(0,t.jsx)(n.TabsTrigger,{value:"interests",children:"Interests"}),(0,t.jsx)(n.TabsTrigger,{value:"data-room",children:"Data Room"}),(0,t.jsx)(n.TabsTrigger,{value:"inventory",children:"Inventory"}),(0,t.jsx)(n.TabsTrigger,{value:"members",children:"Members"}),(0,t.jsx)(n.TabsTrigger,{value:"fees",children:"Fee Plans"}),(0,t.jsx)(n.TabsTrigger,{value:"subscriptions",children:"Subscriptions"}),(0,t.jsx)(n.TabsTrigger,{value:"documents",children:"Documents"}),(0,t.jsx)(n.TabsTrigger,{value:"faq",children:"FAQ"}),(0,t.jsx)(n.TabsTrigger,{value:"activity",children:"Activity"})]}),(0,t.jsx)(n.TabsContent,{value:"overview",children:(0,t.jsx)(w,{deal:e,memberships:e.deal_memberships||[],subscriptionsForJourney:F})}),(0,t.jsx)(n.TabsContent,{value:"term-sheet",children:(0,t.jsx)(eJ,{dealId:e.id,termSheets:N})}),(0,t.jsx)(n.TabsContent,{value:"interests",children:(0,t.jsx)(eX,{dealId:e.id,interests:y,subscriptions:T})}),(0,t.jsx)(n.TabsContent,{value:"data-room",children:(0,t.jsx)(e4,{dealId:e.id,dealName:e.name,memberships:e.deal_memberships||[],accessRecords:C,documents:S})}),(0,t.jsx)(n.TabsContent,{value:"inventory",children:(0,t.jsx)(k,{dealId:e.id,shareLots:B,inventorySummary:v,onRefresh:()=>{q()}})}),(0,t.jsx)(n.TabsContent,{value:"members",children:(0,t.jsx)(ee,{dealId:e.id,members:e.deal_memberships||[],subscriptions:F})}),(0,t.jsx)(n.TabsContent,{value:"fees",children:(0,t.jsx)(ei,{dealId:e.id,feePlans:e.fee_plans||[]})}),(0,t.jsx)(n.TabsContent,{value:"subscriptions",children:(0,t.jsx)(e1,{dealId:e.id})}),(0,t.jsx)(n.TabsContent,{value:"documents",children:(0,t.jsx)(ev,{dealId:e.id,documents:_})}),(0,t.jsx)(n.TabsContent,{value:"faq",children:(0,t.jsx)(e7,{dealId:e.id})}),(0,t.jsx)(n.TabsContent,{value:"activity",children:(0,t.jsx)(eA,{dealId:e.id})})]}),(0,t.jsx)(i.Dialog,{open:E,onOpenChange:$,children:(0,t.jsxs)(i.DialogContent,{className:"sm:max-w-3xl max-h-[90vh] overflow-y-auto",children:[(0,t.jsxs)(i.DialogHeader,{children:[(0,t.jsx)(i.DialogTitle,{children:"Edit Deal"}),(0,t.jsx)(i.DialogDescription,{children:"Update deal information. Changes will be reflected immediately."})]}),(0,t.jsxs)("div",{className:"space-y-6 py-4",children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{className:"space-y-2 md:col-span-2",children:[(0,t.jsx)(c.Label,{htmlFor:"edit-name",children:"Deal Name *"}),(0,t.jsx)(d.Input,{id:"edit-name",value:R.name,onChange:e=>O({...R,name:e.target.value}),placeholder:"e.g., Revolut Secondary 2025"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c.Label,{htmlFor:"edit-status",children:"Status"}),(0,t.jsxs)(m.Select,{value:R.status,onValueChange:e=>O({...R,status:e}),children:[(0,t.jsx)(m.SelectTrigger,{id:"edit-status",children:(0,t.jsx)(m.SelectValue,{})}),(0,t.jsxs)(m.SelectContent,{children:[(0,t.jsx)(m.SelectItem,{value:"draft",children:"Draft"}),(0,t.jsx)(m.SelectItem,{value:"open",children:"Open"}),(0,t.jsx)(m.SelectItem,{value:"allocation_pending",children:"Allocation Pending"}),(0,t.jsx)(m.SelectItem,{value:"closed",children:"Closed"}),(0,t.jsx)(m.SelectItem,{value:"cancelled",children:"Cancelled"})]})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c.Label,{htmlFor:"edit-deal-type",children:"Deal Type"}),(0,t.jsxs)(m.Select,{value:R.deal_type,onValueChange:e=>O({...R,deal_type:e}),children:[(0,t.jsx)(m.SelectTrigger,{id:"edit-deal-type",children:(0,t.jsx)(m.SelectValue,{})}),(0,t.jsxs)(m.SelectContent,{children:[(0,t.jsx)(m.SelectItem,{value:"equity_secondary",children:"Secondary"}),(0,t.jsx)(m.SelectItem,{value:"equity_primary",children:"Primary"}),(0,t.jsx)(m.SelectItem,{value:"credit_trade_finance",children:"Credit/Trade Finance"}),(0,t.jsx)(m.SelectItem,{value:"other",children:"Other"})]})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c.Label,{htmlFor:"edit-stock-type",children:"Stock Type"}),(0,t.jsxs)(m.Select,{value:R.stock_type,onValueChange:e=>O({...R,stock_type:e}),children:[(0,t.jsx)(m.SelectTrigger,{id:"edit-stock-type",children:(0,t.jsx)(m.SelectValue,{})}),(0,t.jsxs)(m.SelectContent,{children:[(0,t.jsx)(m.SelectItem,{value:"common",children:"Common/Ordinary Shares"}),(0,t.jsx)(m.SelectItem,{value:"preferred",children:"Preferred Shares"}),(0,t.jsx)(m.SelectItem,{value:"convertible",children:"Convertible Notes"}),(0,t.jsx)(m.SelectItem,{value:"warrant",children:"Warrants"}),(0,t.jsx)(m.SelectItem,{value:"bond",children:"Bonds"}),(0,t.jsx)(m.SelectItem,{value:"note",children:"Notes"}),(0,t.jsx)(m.SelectItem,{value:"other",children:"Other"})]})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c.Label,{htmlFor:"edit-company-name",children:"Company Name"}),(0,t.jsx)(d.Input,{id:"edit-company-name",value:R.company_name,onChange:e=>O({...R,company_name:e.target.value}),placeholder:"e.g., Revolut Ltd"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c.Label,{htmlFor:"edit-company-website",children:"Company Website"}),(0,t.jsx)(d.Input,{id:"edit-company-website",type:"url",value:R.company_website,onChange:e=>O({...R,company_website:e.target.value}),placeholder:"https://..."})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c.Label,{htmlFor:"edit-sector",children:"Sector"}),(0,t.jsx)(d.Input,{id:"edit-sector",value:R.sector,onChange:e=>O({...R,sector:e.target.value}),placeholder:"e.g., Fintech"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c.Label,{htmlFor:"edit-stage",children:"Stage"}),(0,t.jsx)(d.Input,{id:"edit-stage",value:R.stage,onChange:e=>O({...R,stage:e.target.value}),placeholder:"e.g., Series E"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c.Label,{htmlFor:"edit-location",children:"Location"}),(0,t.jsx)(d.Input,{id:"edit-location",value:R.location,onChange:e=>O({...R,location:e.target.value}),placeholder:"e.g., London, UK"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c.Label,{htmlFor:"edit-currency",children:"Currency"}),(0,t.jsxs)(m.Select,{value:R.currency,onValueChange:e=>O({...R,currency:e}),children:[(0,t.jsx)(m.SelectTrigger,{id:"edit-currency",children:(0,t.jsx)(m.SelectValue,{})}),(0,t.jsxs)(m.SelectContent,{children:[(0,t.jsx)(m.SelectItem,{value:"USD",children:"USD"}),(0,t.jsx)(m.SelectItem,{value:"EUR",children:"EUR"}),(0,t.jsx)(m.SelectItem,{value:"GBP",children:"GBP"})]})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c.Label,{htmlFor:"edit-arranger",children:"Arranger (Mandate)"}),(0,t.jsxs)(m.Select,{value:R.arranger_entity_id||"none",onValueChange:e=>O({...R,arranger_entity_id:"none"===e?"":e}),children:[(0,t.jsx)(m.SelectTrigger,{id:"edit-arranger",children:(0,t.jsx)(m.SelectValue,{placeholder:"Select arranger"})}),(0,t.jsxs)(m.SelectContent,{children:[(0,t.jsx)(m.SelectItem,{value:"none",children:"No Arranger"}),L.map(e=>(0,t.jsx)(m.SelectItem,{value:e.id,children:e.company_name||e.legal_name},e.id))]})]}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:"Assign an arranger to manage this deal as their mandate"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c.Label,{htmlFor:"edit-open-at",children:"Open Date"}),(0,t.jsx)(d.Input,{id:"edit-open-at",type:"datetime-local",value:R.open_at,onChange:e=>O({...R,open_at:e.target.value})})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c.Label,{htmlFor:"edit-close-at",children:"Close Date"}),(0,t.jsx)(d.Input,{id:"edit-close-at",type:"datetime-local",value:R.close_at,onChange:e=>O({...R,close_at:e.target.value})})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c.Label,{htmlFor:"edit-target-amount",children:"Target Amount"}),(0,t.jsx)(d.Input,{id:"edit-target-amount",type:"number",step:"1",value:R.target_amount,onChange:e=>O({...R,target_amount:e.target.value}),placeholder:"e.g., 5000000"}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:"Investment terms (price, min/max) are set in the Term Sheet"})]}),(0,t.jsxs)("div",{className:"space-y-2 md:col-span-2",children:[(0,t.jsx)(c.Label,{htmlFor:"edit-description",children:"Description"}),(0,t.jsx)(o.Textarea,{id:"edit-description",rows:3,value:R.description,onChange:e=>O({...R,description:e.target.value}),placeholder:"Brief description of the deal..."})]}),(0,t.jsxs)("div",{className:"space-y-2 md:col-span-2",children:[(0,t.jsx)(c.Label,{htmlFor:"edit-investment-thesis",children:"Investment Thesis"}),(0,t.jsx)(o.Textarea,{id:"edit-investment-thesis",rows:3,value:R.investment_thesis,onChange:e=>O({...R,investment_thesis:e.target.value}),placeholder:"Why this is a good investment opportunity..."})]})]}),(0,t.jsxs)("div",{className:"flex justify-end gap-2 pt-4",children:[(0,t.jsx)(r.Button,{variant:"outline",onClick:()=>$(!1),disabled:H,children:"Cancel"}),(0,t.jsxs)(r.Button,{onClick:z,disabled:H||!R.name,children:[H&&(0,t.jsx)(j.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),"Save Changes"]})]})]})]})})]}):(0,t.jsx)("div",{className:"p-6",children:(0,t.jsx)(a.Card,{className:"border border-destructive/50 bg-destructive/10",children:(0,t.jsxs)(a.CardContent,{className:"p-6 text-center text-foreground",children:[(0,t.jsx)("p",{children:"Unable to load deal details"}),(0,t.jsx)(f.default,{href:"/versotech_main/deals",children:(0,t.jsx)(r.Button,{variant:"outline",className:"mt-4",children:"Back to Deals"})})]})})})}e.s(["DealDetailClient",()=>tt],99874)}]);