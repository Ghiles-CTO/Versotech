(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,496383,e=>{"use strict";let t=(0,e.i(410587).default)("eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);e.s(["Eye",()=>t],496383)},398472,e=>{"use strict";let t=(0,e.i(410587).default)("external-link",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]);e.s(["ExternalLink",()=>t],398472)},262823,e=>{"use strict";let t=(0,e.i(410587).default)("refresh-cw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);e.s(["RefreshCw",()=>t],262823)},501495,e=>{"use strict";e.s(["formatBps",0,e=>null==e?"—":`${e} bps`,"formatCurrency",0,(e,t="USD")=>e?new Intl.NumberFormat("en-US",{style:"currency",currency:t,maximumFractionDigits:0}).format(e):"$0","formatDate",0,e=>{if(!e)return"—";let t="string"==typeof e?new Date(e):e;return Number.isNaN(t?.getTime?.())?"—":t.toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})}])},102728,105938,e=>{"use strict";var t=e.i(295656);function a(e,a,s){let[r,l]=(0,t.normalizeDates)(s?.in,e,a);return 12*(r.getFullYear()-l.getFullYear())+(r.getMonth()-l.getMonth())}e.s(["differenceInCalendarMonths",()=>a],102728);var s=e.i(925362);function r(e,t){let a=(0,s.toDate)(e,t?.in),r=a.getMonth();return a.setFullYear(a.getFullYear(),r+1,0),a.setHours(23,59,59,999),a}e.s(["endOfMonth",()=>r],105938)},396064,e=>{"use strict";let t=(0,e.i(410587).default)("upload",[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]]);e.s(["Upload",()=>t],396064)},80465,e=>{"use strict";let t=(0,e.i(410587).default)("circle-check-big",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);e.s(["CheckCircle",()=>t],80465)},761722,e=>{"use strict";let t=(0,e.i(410587).default)("download",[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]]);e.s(["Download",()=>t],761722)},90613,e=>{"use strict";var t=e.i(722679),a=e.i(282141);function s({className:e,...s}){return(0,t.jsx)("div",{"data-slot":"card",className:(0,a.cn)("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",e),...s})}function r({className:e,...s}){return(0,t.jsx)("div",{"data-slot":"card-header",className:(0,a.cn)("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-1.5 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",e),...s})}function l({className:e,...s}){return(0,t.jsx)("div",{"data-slot":"card-title",className:(0,a.cn)("leading-none font-semibold",e),...s})}function i({className:e,...s}){return(0,t.jsx)("div",{"data-slot":"card-description",className:(0,a.cn)("text-muted-foreground text-sm",e),...s})}function n({className:e,...s}){return(0,t.jsx)("div",{"data-slot":"card-content",className:(0,a.cn)("px-6",e),...s})}function c({className:e,...s}){return(0,t.jsx)("div",{"data-slot":"card-footer",className:(0,a.cn)("flex items-center px-6 [.border-t]:pt-6",e),...s})}e.s(["Card",()=>s,"CardContent",()=>n,"CardDescription",()=>i,"CardFooter",()=>c,"CardHeader",()=>r,"CardTitle",()=>l])},237635,e=>{"use strict";var t=e.i(722679),a=e.i(282141);function s({className:e,...s}){return(0,t.jsx)("div",{"data-slot":"table-container",className:"relative w-full overflow-x-auto",children:(0,t.jsx)("table",{"data-slot":"table",className:(0,a.cn)("w-full caption-bottom text-sm",e),...s})})}function r({className:e,...s}){return(0,t.jsx)("thead",{"data-slot":"table-header",className:(0,a.cn)("[&_tr]:border-b",e),...s})}function l({className:e,...s}){return(0,t.jsx)("tbody",{"data-slot":"table-body",className:(0,a.cn)("[&_tr:last-child]:border-0",e),...s})}function i({className:e,...s}){return(0,t.jsx)("tr",{"data-slot":"table-row",className:(0,a.cn)("hover:bg-muted/50 data-[state=selected]:bg-muted border-b transition-colors",e),...s})}function n({className:e,...s}){return(0,t.jsx)("th",{"data-slot":"table-head",className:(0,a.cn)("text-foreground h-11 md:h-10 px-2 text-left align-middle font-medium text-xs sm:text-sm [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",e),...s})}function c({className:e,...s}){return(0,t.jsx)("td",{"data-slot":"table-cell",className:(0,a.cn)("p-2 align-middle text-xs sm:text-sm [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",e),...s})}e.s(["Table",()=>s,"TableBody",()=>l,"TableCell",()=>c,"TableHead",()=>n,"TableHeader",()=>r,"TableRow",()=>i])},745083,e=>{"use strict";let t=(0,e.i(410587).default)("circle-x",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);e.s(["XCircle",()=>t],745083)},540318,59531,e=>{"use strict";let t=(0,e.i(410587).default)("handshake",[["path",{d:"m11 17 2 2a1 1 0 1 0 3-3",key:"efffak"}],["path",{d:"m14 14 2.5 2.5a1 1 0 1 0 3-3l-3.88-3.88a3 3 0 0 0-4.24 0l-.88.88a1 1 0 1 1-3-3l2.81-2.81a5.79 5.79 0 0 1 7.06-.87l.47.28a2 2 0 0 0 1.42.25L21 4",key:"9pr0kb"}],["path",{d:"m21 3 1 11h-2",key:"1tisrp"}],["path",{d:"M3 3 2 14l6.5 6.5a1 1 0 1 0 3-3",key:"1uvwmv"}],["path",{d:"M3 4h8",key:"1ep09j"}]]);e.s(["default",()=>t],59531),e.s(["Handshake",()=>t],540318)},10994,e=>{"use strict";let t=(0,e.i(410587).default)("wallet",[["path",{d:"M19 7V4a1 1 0 0 0-1-1H5a2 2 0 0 0 0 4h15a1 1 0 0 1 1 1v4h-3a2 2 0 0 0 0 4h3a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1",key:"18etb6"}],["path",{d:"M3 5v14a2 2 0 0 0 2 2h15a1 1 0 0 0 1-1v-4",key:"xoc0q4"}]]);e.s(["Wallet",()=>t],10994)},191026,e=>{"use strict";let t=(0,e.i(410587).default)("message-circle",[["path",{d:"M2.992 16.342a2 2 0 0 1 .094 1.167l-1.065 3.29a1 1 0 0 0 1.236 1.168l3.413-.998a2 2 0 0 1 1.099.092 10 10 0 1 0-4.777-4.719",key:"1sd12s"}]]);e.s(["MessageCircle",()=>t],191026)},531570,e=>{"use strict";var t=e.i(722679),a=e.i(340915),s=e.i(352776),r=e.i(316264),l=e.i(263229),i=e.i(761722),n=e.i(119311),c=e.i(398472),d=e.i(401148),o=e.i(501495);let m={partner:"Partner",introducer:"Introducer","commercial-partner":"Commercial Partner"};function u({open:e,onOpenChange:u,commission:x,commissionType:h}){let[p,j]=(0,a.useState)(!1),[f,g]=(0,a.useState)(null),[b,v]=(0,a.useState)(null),[y,N]=(0,a.useState)(null);(0,a.useEffect)(()=>{(async()=>{if(!e||!x?.invoice_id){v(null),N(null);return}j(!0),g(null);try{let e=`/api/commissions/${h}/${x.id}/invoice`,t=await fetch(e);if(!t.ok){let e=await t.json();throw Error(e.error||"Failed to fetch invoice")}let a=await t.json();v(a.data.url),N(a.data.path)}catch(e){console.error("[ViewInvoiceDialog] Error:",e),g(e instanceof Error?e.message:"Failed to load invoice")}finally{j(!1)}})()},[e,x?.id,x?.invoice_id,h]),(0,a.useEffect)(()=>{e||(v(null),N(null),g(null))},[e]);let w=()=>{b&&window.open(b,"_blank")};if(!x)return null;let C=m[h],_=(0,o.formatCurrency)(x.accrual_amount,x.currency||"USD"),k=y?.toLowerCase().endsWith(".pdf"),T=y?.match(/\.(png|jpg|jpeg)$/i);return(0,t.jsx)(s.Dialog,{open:e,onOpenChange:u,children:(0,t.jsxs)(s.DialogContent,{className:"max-w-4xl max-h-[90vh] flex flex-col",children:[(0,t.jsxs)(s.DialogHeader,{children:[(0,t.jsxs)(s.DialogTitle,{className:"flex items-center gap-2",children:[(0,t.jsx)(n.FileText,{className:"h-5 w-5"}),"Invoice from ",x.entity_name]}),(0,t.jsxs)(s.DialogDescription,{children:[C," commission invoice for ",_,x.deal&&` - ${x.deal.name}`]})]}),(0,t.jsxs)("div",{className:"flex-1 min-h-[400px] relative",children:[p&&(0,t.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-muted/50 rounded-lg",children:(0,t.jsxs)("div",{className:"flex flex-col items-center gap-2",children:[(0,t.jsx)(l.Loader2,{className:"h-8 w-8 animate-spin text-muted-foreground"}),(0,t.jsx)("span",{className:"text-sm text-muted-foreground",children:"Loading invoice..."})]})}),f&&(0,t.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,t.jsxs)("div",{className:"flex flex-col items-center gap-2 text-center p-6",children:[(0,t.jsx)(d.AlertCircle,{className:"h-12 w-12 text-destructive"}),(0,t.jsx)("p",{className:"text-destructive font-medium",children:"Failed to load invoice"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:f})]})}),!p&&!f&&b&&(0,t.jsxs)(t.Fragment,{children:[k&&(0,t.jsx)("iframe",{src:b,className:"w-full h-full min-h-[500px] rounded-lg border",title:"Invoice PDF"}),T&&(0,t.jsx)("div",{className:"w-full h-full min-h-[400px] flex items-center justify-center bg-muted/30 rounded-lg border overflow-auto p-4",children:(0,t.jsx)("img",{src:b,alt:"Invoice",className:"max-w-full max-h-full object-contain"})}),!k&&!T&&(0,t.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,t.jsxs)("div",{className:"text-center p-6",children:[(0,t.jsx)(n.FileText,{className:"h-16 w-16 text-muted-foreground mx-auto mb-4"}),(0,t.jsx)("p",{className:"text-muted-foreground",children:"Preview not available for this file type."}),(0,t.jsxs)(r.Button,{className:"mt-4",onClick:w,children:[(0,t.jsx)(i.Download,{className:"h-4 w-4 mr-2"}),"Download Invoice"]})]})})]}),!p&&!f&&!b&&!x.invoice_id&&(0,t.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,t.jsxs)("div",{className:"flex flex-col items-center gap-2 text-center p-6",children:[(0,t.jsx)(n.FileText,{className:"h-12 w-12 text-muted-foreground"}),(0,t.jsx)("p",{className:"text-muted-foreground",children:"No invoice has been uploaded yet."})]})})]}),(0,t.jsxs)(s.DialogFooter,{className:"flex-shrink-0 gap-2 sm:gap-0",children:[(0,t.jsx)(r.Button,{variant:"outline",onClick:()=>u(!1),children:"Close"}),b&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(r.Button,{variant:"outline",onClick:()=>{b&&window.open(b,"_blank")},children:[(0,t.jsx)(c.ExternalLink,{className:"h-4 w-4 mr-2"}),"Open in New Tab"]}),(0,t.jsxs)(r.Button,{onClick:w,children:[(0,t.jsx)(i.Download,{className:"h-4 w-4 mr-2"}),"Download"]})]})]})]})})}e.s(["ViewInvoiceDialog",()=>u])},176821,e=>{"use strict";var t=e.i(722679),a=e.i(340915),s=e.i(90613),r=e.i(129432),l=e.i(316264),i=e.i(538892),n=e.i(237635),c=e.i(733179),d=e.i(263229),o=e.i(401148),m=e.i(119311),u=e.i(645855),x=e.i(80465),h=e.i(745083),p=e.i(561866),j=e.i(10994),f=e.i(396064),g=e.i(496383),b=e.i(971743),v=e.i(540318),y=e.i(691974),N=e.i(191026),w=e.i(262823),C=e.i(432598),_=e.i(83245),k=e.i(282141),T=e.i(501495),D=e.i(59178),S=e.i(352776);let F={partner:"Partner",introducer:"Introducer","commercial-partner":"Commercial Partner"};function I({open:e,onOpenChange:s,commission:r,commissionType:i,onSuccess:n}){let[c,u]=(0,a.useState)(!1),[h,p]=(0,a.useState)(null),[j,g]=(0,a.useState)(null),b=(0,a.useRef)(null),v=async()=>{if(r&&j){u(!0),p(null);try{let e=`/api/commissions/${i}/${r.id}/invoice`,t=new FormData;t.append("file",j);let a=await fetch(e,{method:"POST",body:t});if(!a.ok){let e=await a.json();throw Error(e.error||"Failed to upload invoice")}n(),s(!1)}catch(e){console.error("[SubmitInvoiceDialog] Error:",e),p(e instanceof Error?e.message:"Failed to submit invoice")}finally{u(!1)}}},y=e=>{!e&&(g(null),p(null),b.current&&(b.current.value="")),s(e)};if(!r)return null;F[i];let N=(0,T.formatCurrency)(r.accrual_amount,r.currency||"USD");return(0,t.jsx)(S.Dialog,{open:e,onOpenChange:y,children:(0,t.jsxs)(S.DialogContent,{className:"max-w-md",children:[(0,t.jsxs)(S.DialogHeader,{children:[(0,t.jsxs)(S.DialogTitle,{className:"flex items-center gap-2",children:[(0,t.jsx)(m.FileText,{className:"h-5 w-5"}),"Submit Invoice"]}),(0,t.jsx)(S.DialogDescription,{children:"Upload your invoice for this commission payment."})]}),(0,t.jsxs)("div",{className:"py-4 space-y-4",children:[h&&(0,t.jsxs)("div",{className:"bg-destructive/10 border border-destructive/30 text-destructive text-sm p-3 rounded flex items-start gap-2",children:[(0,t.jsx)(o.AlertCircle,{className:"h-4 w-4 mt-0.5 flex-shrink-0"}),(0,t.jsx)("span",{children:h})]}),(0,t.jsxs)("div",{className:"bg-muted/50 p-4 rounded-lg space-y-2",children:[r.arranger&&(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{className:"text-muted-foreground",children:"Arranger:"}),(0,t.jsx)("span",{className:"font-medium",children:r.arranger.legal_name})]}),r.deal&&(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{className:"text-muted-foreground",children:"Deal:"}),(0,t.jsx)("span",{className:"font-medium",children:r.deal.name})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{className:"text-muted-foreground",children:"Amount:"}),(0,t.jsx)("span",{className:"font-medium text-primary",children:N})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("label",{className:"text-sm font-medium",children:"Invoice Document *"}),(0,t.jsx)("input",{ref:b,type:"file",accept:".pdf,.jpg,.jpeg,.png",onChange:e=>{let t=e.target.files?.[0];t&&(["application/pdf","image/jpeg","image/png"].includes(t.type)?t.size>0xa00000?p("File size must be less than 10MB"):(g(t),p(null)):p("Please upload a PDF, JPEG, or PNG file"))},className:"hidden"}),j?(0,t.jsxs)("div",{className:"flex items-center gap-2 p-3 border rounded-lg bg-green-50 border-green-200",children:[(0,t.jsx)(x.CheckCircle,{className:"h-5 w-5 text-green-600"}),(0,t.jsx)("span",{className:"text-sm font-medium text-green-800 flex-1 truncate",children:j.name}),(0,t.jsx)(l.Button,{type:"button",variant:"ghost",size:"sm",onClick:()=>{g(null),b.current&&(b.current.value="")},children:"Change"})]}):(0,t.jsxs)(l.Button,{type:"button",variant:"outline",className:"w-full",onClick:()=>b.current?.click(),disabled:c,children:[(0,t.jsx)(f.Upload,{className:"h-4 w-4 mr-2"}),"Select Invoice (PDF, JPEG, PNG)"]}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:"Maximum file size: 10MB"})]}),(0,t.jsx)("div",{className:"bg-blue-50 dark:bg-blue-950/30 border border-blue-200 dark:border-blue-800 p-3 rounded-lg text-sm",children:(0,t.jsx)("p",{className:"text-blue-800 dark:text-blue-200",children:'Once submitted, your invoice will be sent to the arranger and the commission status will be updated to "Invoiced".'})})]}),(0,t.jsxs)(S.DialogFooter,{children:[(0,t.jsx)(l.Button,{variant:"outline",onClick:()=>y(!1),disabled:c,children:"Cancel"}),(0,t.jsx)(l.Button,{onClick:v,disabled:c||!j,children:c?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(d.Loader2,{className:"h-4 w-4 mr-2 animate-spin"}),"Uploading..."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(f.Upload,{className:"h-4 w-4 mr-2"}),"Submit Invoice"]})})]})]})})}var M=e.i(531570);let H={accrued:"bg-blue-100 text-blue-800",invoice_requested:"bg-yellow-100 text-yellow-800",invoice_submitted:"bg-indigo-100 text-indigo-800",invoiced:"bg-orange-100 text-orange-800",paid:"bg-green-100 text-green-800",cancelled:"bg-red-100 text-red-800",rejected:"bg-red-100 text-red-800 border border-red-300"},P={accrued:u.Clock,invoice_requested:m.FileText,invoice_submitted:m.FileText,invoiced:m.FileText,paid:x.CheckCircle,cancelled:h.XCircle,rejected:h.XCircle},B=[{label:"All Status",value:"all"},{label:"Invoice Requested",value:"invoice_requested"},{label:"Invoice Submitted",value:"invoice_submitted"},{label:"Invoiced",value:"invoiced"},{label:"Paid",value:"paid"},{label:"Accrued",value:"accrued"},{label:"Rejected",value:"rejected"},{label:"Cancelled",value:"cancelled"}],q={partner:{table:"partner_commissions",userTable:"partner_users",entityIdField:"partner_id",label:"Partner",icon:y.Briefcase,commissionType:"partner"},introducer:{table:"introducer_commissions",userTable:"introducer_users",entityIdField:"introducer_id",label:"Introducer",icon:v.Handshake,commissionType:"introducer"},commercial_partner:{table:"commercial_partner_commissions",userTable:"commercial_partner_users",entityIdField:"commercial_partner_id",label:"Commercial Partner",icon:b.Building2,commissionType:"commercial-partner"}};function A(){let[e,x]=(0,a.useState)([]),[b,v]=(0,a.useState)({total_owed:0,total_paid:0,pending_invoice:0,invoiced:0,currency:"USD"}),[S,F]=(0,a.useState)(!0),[A,E]=(0,a.useState)(null),[U,R]=(0,a.useState)("all"),[z,L]=(0,a.useState)(void 0),[O,V]=(0,a.useState)(null),[$,Y]=(0,a.useState)(null),[X,G]=(0,a.useState)(!1),[W,J]=(0,a.useState)(!1),[K,Q]=(0,a.useState)(null),Z=async()=>{try{F(!0);let e=(0,D.createClient)(),{data:{user:t}}=await e.auth.getUser();if(!t)return void E("Not authenticated");let[a,s,r]=await Promise.all([e.from("partner_users").select("partner_id").eq("user_id",t.id).maybeSingle(),e.from("introducer_users").select("introducer_id").eq("user_id",t.id).maybeSingle(),e.from("commercial_partner_users").select("commercial_partner_id").eq("user_id",t.id).maybeSingle()]),l=null,i=null;if(a.data?.partner_id?(l="partner",i=a.data.partner_id):s.data?.introducer_id?(l="introducer",i=s.data.introducer_id):r.data?.commercial_partner_id&&(l="commercial_partner",i=r.data.commercial_partner_id),!l||!i)return void E("You are not registered as a partner, introducer, or commercial partner");V(l),Y(i);let n=q[l],{data:c,error:d}=await e.from(n.table).select(`
          id,
          status,
          basis_type,
          rate_bps,
          base_amount,
          accrual_amount,
          currency,
          payment_due_date,
          paid_at,
          notes,
          created_at,
          invoice_id,
          rejection_reason,
          rejected_by,
          rejected_at,
          deal:deals(id, name, company_name),
          arranger:arranger_entities(id, legal_name)
        `).eq(n.entityIdField,i).order("created_at",{ascending:!1});if(d)throw console.error("[MyCommissionsPage] Error:",d),d;let o=(c||[]).map(e=>({...e,deal:Array.isArray(e.deal)?e.deal[0]:e.deal,arranger:Array.isArray(e.arranger)?e.arranger[0]:e.arranger}));x(o);let m={total_owed:0,total_paid:0,pending_invoice:0,invoiced:0,currency:"USD"};o.forEach(e=>{let t=Number(e.accrual_amount)||0;e.currency&&(m.currency=e.currency),"paid"===e.status?m.total_paid+=t:["cancelled","rejected"].includes(e.status)||(m.total_owed+=t),"invoice_requested"===e.status&&(m.pending_invoice+=t),("invoice_submitted"===e.status||"invoiced"===e.status)&&(m.invoiced+=t)}),v(m),E(null)}catch(e){console.error("[MyCommissionsPage] Error:",e),E(e instanceof Error?e.message:"Failed to load commissions")}finally{F(!1)}};(0,a.useEffect)(()=>{Z()},[]);let ee=e=>{Q(e),G(!0)},et=e.filter(e=>{if("all"!==U&&e.status!==U)return!1;if(z?.from||z?.to){let t=new Date(e.created_at);if(z.from&&t<z.from)return!1;if(z.to){let e=new Date(z.to);if(e.setHours(23,59,59,999),t>e)return!1}}return!0});if(S)return(0,t.jsxs)("div",{className:"flex items-center justify-center py-16",children:[(0,t.jsx)(d.Loader2,{className:"h-8 w-8 animate-spin text-muted-foreground"}),(0,t.jsx)("span",{className:"ml-3 text-muted-foreground",children:"Loading commissions..."})]});if(A)return(0,t.jsxs)("div",{className:"text-center py-16",children:[(0,t.jsx)(o.AlertCircle,{className:"h-12 w-12 text-destructive mx-auto mb-4"}),(0,t.jsx)("h3",{className:"text-lg font-medium text-foreground mb-2",children:"Error Loading Commissions"}),(0,t.jsx)("p",{className:"text-muted-foreground",children:A})]});let ea=O?q[O]:null,es=ea?.icon||y.Briefcase;return(0,t.jsxs)("div",{className:"p-6 space-y-6",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-2xl font-bold text-foreground",children:"My Commissions"}),(0,t.jsx)("p",{className:"text-muted-foreground mt-1",children:"View and manage your commission payments"})]}),ea&&(0,t.jsxs)(r.Badge,{variant:"secondary",className:"flex items-center gap-1",children:[(0,t.jsx)(es,{className:"h-3 w-3"}),ea.label]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,t.jsxs)(s.Card,{children:[(0,t.jsx)(s.CardHeader,{className:"pb-2",children:(0,t.jsxs)(s.CardTitle,{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[(0,t.jsx)(j.Wallet,{className:"h-4 w-4"}),"Total Owed"]})}),(0,t.jsxs)(s.CardContent,{children:[(0,t.jsx)("div",{className:"text-2xl font-bold text-orange-600",children:(0,T.formatCurrency)(b.total_owed,b.currency)}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Pending payment"})]})]}),(0,t.jsxs)(s.Card,{children:[(0,t.jsx)(s.CardHeader,{className:"pb-2",children:(0,t.jsxs)(s.CardTitle,{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[(0,t.jsx)(p.CreditCard,{className:"h-4 w-4"}),"Total Paid"]})}),(0,t.jsxs)(s.CardContent,{children:[(0,t.jsx)("div",{className:"text-2xl font-bold text-green-600",children:(0,T.formatCurrency)(b.total_paid,b.currency)}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Completed"})]})]}),(0,t.jsxs)(s.Card,{className:"border-yellow-200 bg-yellow-50/50 dark:bg-yellow-950/20",children:[(0,t.jsx)(s.CardHeader,{className:"pb-2",children:(0,t.jsxs)(s.CardTitle,{className:"text-sm font-medium text-yellow-800 dark:text-yellow-200 flex items-center gap-2",children:[(0,t.jsx)(m.FileText,{className:"h-4 w-4"}),"Invoice Requested"]})}),(0,t.jsxs)(s.CardContent,{children:[(0,t.jsx)("div",{className:"text-2xl font-bold text-yellow-700 dark:text-yellow-300",children:(0,T.formatCurrency)(b.pending_invoice,b.currency)}),(0,t.jsx)("p",{className:"text-xs text-yellow-600 dark:text-yellow-400 mt-1",children:"Submit your invoice"})]})]}),(0,t.jsxs)(s.Card,{children:[(0,t.jsx)(s.CardHeader,{className:"pb-2",children:(0,t.jsxs)(s.CardTitle,{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[(0,t.jsx)(c.TrendingUp,{className:"h-4 w-4"}),"Invoiced"]})}),(0,t.jsxs)(s.CardContent,{children:[(0,t.jsx)("div",{className:"text-2xl font-bold text-blue-600",children:(0,T.formatCurrency)(b.invoiced,b.currency)}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Awaiting payment"})]})]})]}),b.pending_invoice>0&&(0,t.jsx)(s.Card,{className:"border-yellow-400/50 bg-yellow-50 dark:bg-yellow-950/30",children:(0,t.jsx)(s.CardContent,{className:"py-4",children:(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("div",{className:"h-10 w-10 rounded-lg bg-yellow-100 dark:bg-yellow-900 flex items-center justify-center",children:(0,t.jsx)(f.Upload,{className:"h-5 w-5 text-yellow-600 dark:text-yellow-400"})}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("h3",{className:"font-medium text-yellow-800 dark:text-yellow-200",children:"Action Required"}),(0,t.jsxs)("p",{className:"text-sm text-yellow-700 dark:text-yellow-300",children:["You have ",(0,T.formatCurrency)(b.pending_invoice,b.currency)," in commissions awaiting your invoice. Submit your invoices to receive payment."]})]})]})})}),e.some(e=>"rejected"===e.status)&&(0,t.jsx)(s.Card,{className:"border-red-400/50 bg-red-50 dark:bg-red-950/30",children:(0,t.jsx)(s.CardContent,{className:"py-4",children:(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("div",{className:"h-10 w-10 rounded-lg bg-red-100 dark:bg-red-900 flex items-center justify-center",children:(0,t.jsx)(N.MessageCircle,{className:"h-5 w-5 text-red-600 dark:text-red-400"})}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("h3",{className:"font-medium text-red-800 dark:text-red-200",children:"Invoice Rejected - Action Required"}),(0,t.jsx)("p",{className:"text-sm text-red-700 dark:text-red-300",children:"One or more of your invoices has been rejected. Please review the feedback below and resubmit."}),(0,t.jsx)("div",{className:"mt-2 space-y-2",children:e.filter(e=>"rejected"===e.status).map(e=>(0,t.jsxs)("div",{className:"text-sm bg-red-100 dark:bg-red-900/50 p-2 rounded flex items-start gap-2",children:[(0,t.jsx)(h.XCircle,{className:"h-4 w-4 mt-0.5 flex-shrink-0 text-red-600 dark:text-red-400"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"font-medium",children:e.deal?.name||"Commission"}),e.rejection_reason&&(0,t.jsxs)("p",{className:"text-red-600 dark:text-red-400 mt-1",children:["“",e.rejection_reason,"”"]}),e.rejected_at&&(0,t.jsxs)("p",{className:"text-xs text-red-500 dark:text-red-500 mt-1",children:["Rejected on ",(0,T.formatDate)(e.rejected_at)]})]})]},e.id))})]})]})})}),(0,t.jsx)(s.Card,{children:(0,t.jsx)(s.CardContent,{className:"pt-6",children:(0,t.jsxs)("div",{className:"flex flex-wrap gap-4 items-center",children:[(0,t.jsxs)(i.Select,{value:U,onValueChange:R,children:[(0,t.jsx)(i.SelectTrigger,{className:"w-48",children:(0,t.jsx)(i.SelectValue,{placeholder:"Filter by status"})}),(0,t.jsx)(i.SelectContent,{children:B.map(e=>(0,t.jsx)(i.SelectItem,{value:e.value,children:e.label},e.value))})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(_.DateRangePicker,{value:z,onChange:L,className:"w-auto"}),z&&(0,t.jsx)(l.Button,{variant:"ghost",size:"icon",onClick:()=>L(void 0),title:"Clear date filter",children:(0,t.jsx)(C.X,{className:"h-4 w-4"})})]}),("all"!==U||z)&&(0,t.jsx)(l.Button,{variant:"link",size:"sm",onClick:()=>{R("all"),L(void 0)},className:"text-muted-foreground",children:"Clear all filters"})]})})}),(0,t.jsxs)(s.Card,{children:[(0,t.jsxs)(s.CardHeader,{children:[(0,t.jsx)(s.CardTitle,{children:"Commissions"}),(0,t.jsxs)(s.CardDescription,{children:[et.length," commission",1!==et.length?"s":""," found"]})]}),(0,t.jsx)(s.CardContent,{children:0===et.length?(0,t.jsxs)("div",{className:"border border-dashed border-muted rounded-lg py-12 flex flex-col items-center justify-center text-center space-y-2",children:[(0,t.jsx)(c.TrendingUp,{className:"h-10 w-10 text-muted-foreground"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"all"!==U?"No commissions match your filter":"No commissions yet"})]}):(0,t.jsx)("div",{className:"rounded-md border",children:(0,t.jsxs)(n.Table,{children:[(0,t.jsx)(n.TableHeader,{children:(0,t.jsxs)(n.TableRow,{children:[(0,t.jsx)(n.TableHead,{children:"Status"}),(0,t.jsx)(n.TableHead,{children:"Deal"}),(0,t.jsx)(n.TableHead,{children:"Arranger"}),(0,t.jsx)(n.TableHead,{children:"Basis"}),(0,t.jsx)(n.TableHead,{className:"text-right",children:"Amount"}),(0,t.jsx)(n.TableHead,{children:"Due Date"}),(0,t.jsx)(n.TableHead,{children:"Created"}),(0,t.jsx)(n.TableHead,{className:"text-right",children:"Actions"})]})}),(0,t.jsx)(n.TableBody,{children:et.map(e=>{let a=P[e.status]||u.Clock;return(0,t.jsxs)(n.TableRow,{children:[(0,t.jsx)(n.TableCell,{children:(0,t.jsxs)(r.Badge,{variant:"secondary",className:(0,k.cn)("capitalize",H[e.status]),children:[(0,t.jsx)(a,{className:"h-3 w-3 mr-1"}),e.status.replace("_"," ")]})}),(0,t.jsx)(n.TableCell,{children:e.deal?(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"font-medium text-sm",children:e.deal.name}),e.deal.company_name&&(0,t.jsx)("div",{className:"text-xs text-muted-foreground",children:e.deal.company_name})]}):(0,t.jsx)("span",{className:"text-muted-foreground text-sm",children:"—"})}),(0,t.jsx)(n.TableCell,{children:(0,t.jsx)("span",{className:"text-sm",children:e.arranger?.legal_name||"—"})}),(0,t.jsx)(n.TableCell,{className:"capitalize text-sm",children:e.basis_type?e.basis_type.replace("_"," "):"—"}),(0,t.jsxs)(n.TableCell,{className:"text-right",children:[(0,t.jsx)("div",{className:"font-medium",children:(0,T.formatCurrency)(e.accrual_amount,e.currency)}),(0,t.jsx)("div",{className:"text-xs text-muted-foreground",children:null!=e.rate_bps?`${(e.rate_bps/100).toFixed(2)}%`:"—"})]}),(0,t.jsx)(n.TableCell,{className:"text-sm",children:e.payment_due_date?(0,T.formatDate)(e.payment_due_date):"—"}),(0,t.jsx)(n.TableCell,{className:"text-sm text-muted-foreground",children:(0,T.formatDate)(e.created_at)}),(0,t.jsx)(n.TableCell,{className:"text-right",children:(0,t.jsxs)("div",{className:"flex flex-col items-end gap-1",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:["invoice_requested"===e.status&&(0,t.jsxs)(l.Button,{size:"sm",onClick:()=>ee(e),children:[(0,t.jsx)(f.Upload,{className:"h-4 w-4 mr-1"}),"Submit Invoice"]}),"rejected"===e.status&&(0,t.jsxs)(l.Button,{size:"sm",variant:"destructive",onClick:()=>ee(e),children:[(0,t.jsx)(w.RefreshCw,{className:"h-4 w-4 mr-1"}),"Resubmit"]}),("invoice_submitted"===e.status||"invoiced"===e.status||"paid"===e.status)&&e.invoice_id&&(0,t.jsxs)(l.Button,{size:"sm",variant:"ghost",onClick:()=>{Q(e),J(!0)},className:"text-blue-600",children:[(0,t.jsx)(g.Eye,{className:"h-4 w-4 mr-1"}),"View Invoice"]}),"paid"===e.status&&e.paid_at&&(0,t.jsxs)("span",{className:"text-xs text-green-600",children:["Paid ",(0,T.formatDate)(e.paid_at)]})]}),"rejected"===e.status&&e.rejection_reason&&(0,t.jsxs)("div",{className:"text-xs text-red-600 max-w-48 text-right mt-1",title:e.rejection_reason,children:[(0,t.jsx)("span",{className:"font-medium",children:"Reason:"})," ",e.rejection_reason.length>50?`${e.rejection_reason.slice(0,50)}...`:e.rejection_reason]})]})})]},e.id)})})]})})})]}),O&&ea&&(0,t.jsx)(I,{open:X,onOpenChange:G,commission:K,commissionType:ea.commissionType,onSuccess:()=>{Z()}}),O&&ea&&(0,t.jsx)(M.ViewInvoiceDialog,{open:W,onOpenChange:J,commission:K?{id:K.id,accrual_amount:K.accrual_amount,currency:K.currency,entity_name:ea.label,invoice_id:K.invoice_id,deal:K.deal?{name:K.deal.name}:void 0}:null,commissionType:ea.commissionType})]})}e.s(["default",()=>A],176821)}]);