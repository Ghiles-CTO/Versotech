(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,398472,e=>{"use strict";let t=(0,e.i(410587).default)("external-link",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]);e.s(["ExternalLink",()=>t],398472)},501495,e=>{"use strict";e.s(["formatBps",0,e=>null==e?"—":`${e} bps`,"formatCurrency",0,(e,t="USD")=>e?new Intl.NumberFormat("en-US",{style:"currency",currency:t,maximumFractionDigits:0}).format(e):"$0","formatDate",0,e=>{if(!e)return"—";let t="string"==typeof e?new Date(e):e;return Number.isNaN(t?.getTime?.())?"—":t.toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})}])},196767,e=>{"use strict";let t=(0,e.i(410587).default)("dollar-sign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]);e.s(["DollarSign",()=>t],196767)},761722,e=>{"use strict";let t=(0,e.i(410587).default)("download",[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]]);e.s(["Download",()=>t],761722)},90613,e=>{"use strict";var t=e.i(722679),a=e.i(282141);function r({className:e,...r}){return(0,t.jsx)("div",{"data-slot":"card",className:(0,a.cn)("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",e),...r})}function s({className:e,...r}){return(0,t.jsx)("div",{"data-slot":"card-header",className:(0,a.cn)("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-1.5 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",e),...r})}function l({className:e,...r}){return(0,t.jsx)("div",{"data-slot":"card-title",className:(0,a.cn)("leading-none font-semibold",e),...r})}function n({className:e,...r}){return(0,t.jsx)("div",{"data-slot":"card-description",className:(0,a.cn)("text-muted-foreground text-sm",e),...r})}function i({className:e,...r}){return(0,t.jsx)("div",{"data-slot":"card-content",className:(0,a.cn)("px-6",e),...r})}function d({className:e,...r}){return(0,t.jsx)("div",{"data-slot":"card-footer",className:(0,a.cn)("flex items-center px-6 [.border-t]:pt-6",e),...r})}e.s(["Card",()=>r,"CardContent",()=>i,"CardDescription",()=>n,"CardFooter",()=>d,"CardHeader",()=>s,"CardTitle",()=>l])},237635,e=>{"use strict";var t=e.i(722679),a=e.i(282141);function r({className:e,...r}){return(0,t.jsx)("div",{"data-slot":"table-container",className:"relative w-full overflow-x-auto",children:(0,t.jsx)("table",{"data-slot":"table",className:(0,a.cn)("w-full caption-bottom text-sm",e),...r})})}function s({className:e,...r}){return(0,t.jsx)("thead",{"data-slot":"table-header",className:(0,a.cn)("[&_tr]:border-b",e),...r})}function l({className:e,...r}){return(0,t.jsx)("tbody",{"data-slot":"table-body",className:(0,a.cn)("[&_tr:last-child]:border-0",e),...r})}function n({className:e,...r}){return(0,t.jsx)("tr",{"data-slot":"table-row",className:(0,a.cn)("hover:bg-muted/50 data-[state=selected]:bg-muted border-b transition-colors",e),...r})}function i({className:e,...r}){return(0,t.jsx)("th",{"data-slot":"table-head",className:(0,a.cn)("text-foreground h-11 md:h-10 px-2 text-left align-middle font-medium text-xs sm:text-sm [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",e),...r})}function d({className:e,...r}){return(0,t.jsx)("td",{"data-slot":"table-cell",className:(0,a.cn)("p-2 align-middle text-xs sm:text-sm [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",e),...r})}e.s(["Table",()=>r,"TableBody",()=>l,"TableCell",()=>d,"TableHead",()=>i,"TableHeader",()=>s,"TableRow",()=>n])},360209,e=>{"use strict";let t=(0,e.i(410587).default)("percent",[["line",{x1:"19",x2:"5",y1:"5",y2:"19",key:"1x9vlm"}],["circle",{cx:"6.5",cy:"6.5",r:"2.5",key:"4mh3h7"}],["circle",{cx:"17.5",cy:"17.5",r:"2.5",key:"1mdrzq"}]]);e.s(["Percent",()=>t],360209)},871960,e=>{"use strict";var t=e.i(722679),a=e.i(340915),r=e.i(90613),s=e.i(129432),l=e.i(316264),n=e.i(191569),i=e.i(538892),d=e.i(237635),o=e.i(51370),c=e.i(501259),m=e.i(196767),u=e.i(733179),x=e.i(750809),h=e.i(263229),f=e.i(401148),p=e.i(398472),b=e.i(971743),g=e.i(761722),j=e.i(360209),v=e.i(994500),_=e.i(282141),y=e.i(501495),N=e.i(59178),w=e.i(820417);function C(e){return e?Array.isArray(e)?e[0]||null:e:null}function T(e){return e?new Date(e).getTime():0}function S(e){let t=e.filter(e=>e.subscription?.status==="committed"||e.subscription?.status==="active").length,a=e.filter(e=>e.subscription?.status==="pending").length,r=0;for(let t of e)t.subscription&&("committed"===t.subscription.status||"active"===t.subscription.status)&&(r+=t.subscription.commitment);let s=e.find(e=>e.subscription?.currency)?.subscription?.currency||"USD";return{totalReferrals:e.length,convertedCount:t,pendingCount:a,totalCommitmentValue:r,currency:s}}let k={active:"bg-green-100 text-green-800 border-green-200",committed:"bg-blue-100 text-blue-800 border-blue-200",pending:"bg-yellow-100 text-yellow-800 border-yellow-200",cancelled:"bg-gray-100 text-gray-800 border-gray-200"},D=[{label:"All Status",value:"all"},{label:"Active",value:"active"},{label:"Committed",value:"committed"},{label:"Pending",value:"pending"},{label:"Cancelled",value:"cancelled"}],H=[{label:"All Stages",value:"all"},{label:"Dispatched",value:"dispatched"},{label:"Interested",value:"interested"},{label:"Passed",value:"passed"},{label:"Approved (Pack)",value:"approved"},{label:"Signed",value:"signed"},{label:"Funded",value:"funded"}];function M(){let[e,M]=(0,a.useState)(null),[L,U]=(0,a.useState)([]),[R,A]=(0,a.useState)({totalReferrals:0,convertedCount:0,pendingCount:0,totalCommitmentValue:0,currency:"USD"}),[P,q]=(0,a.useState)(!0),[E,$]=(0,a.useState)(null),[B,V]=(0,a.useState)(""),[F,I]=(0,a.useState)("all"),[z,O]=(0,a.useState)("all"),[K,G]=(0,a.useState)(!1),J=async()=>{if(!e)return void v.toast.error("Export is only available for partner users");try{G(!0);let e=await fetch("/api/partners/me/transactions/export");if(429===e.status)return void v.toast.error("Please wait 1 minute between export requests");if(!e.ok){let t=await e.json();throw Error(t.error||"Export failed")}let t=await e.blob(),a=window.URL.createObjectURL(t),r=document.createElement("a");r.href=a,r.download=`partner-transactions-${new Date().toISOString().split("T")[0]}.csv`,document.body.appendChild(r),r.click(),window.URL.revokeObjectURL(a),document.body.removeChild(r),v.toast.success("Transactions exported successfully")}catch(e){console.error("[PartnerTransactionsPage] Export error:",e),v.toast.error(e instanceof Error?e.message:"Failed to export transactions")}finally{G(!1)}};(0,a.useEffect)(()=>{let e=(0,N.createClient)(),t=async t=>{let a=Array.from(new Set(t.map(e=>e.investor_id).filter(e=>!!e))),r=Array.from(new Set(t.map(e=>e.deal_id).filter(e=>!!e))),s=new Map,l=new Map;if(a.length>0&&r.length>0){let{data:t,error:l}=await e.from("subscriptions").select("id, investor_id, deal_id, commitment, currency, status, committed_at, created_at").in("investor_id",a).in("deal_id",r);if(l)throw l;for(let e of t||[]){var n,i;let t=(n=e.investor_id,i=e.deal_id,`${n}:${i}`),a=s.get(t),r=Math.max(T(a?.committed_at),T(a?.created_at)),l=Math.max(T(e.committed_at),T(e.created_at));(!a||l>=r)&&s.set(t,e)}}if(r.length>0){let{data:t}=await e.from("fee_plans").select(`
            deal_id,
            is_default,
            fee_components (
              kind,
              rate_bps,
              flat_amount,
              calc_method
            )
          `).in("deal_id",r).eq("is_active",!0);if(t)for(let e of t){let t=(e.fee_components||[]).find(e=>"referral"===e.kind||"success"===e.kind||"commission"===e.kind);if(t&&e.deal_id){let a=s.get(`${e.deal_id}`)||Array.from(s.values()).find(t=>t.deal_id===e.deal_id);l.set(e.deal_id,{rate_bps:t.rate_bps,flat_amount:t.flat_amount,currency:a?.currency||"USD",kind:t.kind})}}}return t.map(e=>{var t,a;let r=C(e.investor),n=C(e.deal),i=e.investor_id&&e.deal_id&&s.get((t=e.investor_id,a=e.deal_id,`${t}:${a}`))||null,d=`${e.deal_id||"no-deal"}-${e.investor_id||"no-investor"}`,o="dispatched";if(i){let t=i.status||"";"active"===t||"committed"===t?o="funded":"signed"===t?o="signed":"approved"===t?o="approved":"cancelled"===t||"rejected"===t?o="passed":e.interest_confirmed_at&&(o="interested")}else e.interest_confirmed_at&&(o="interested");return{id:d,investor:r?{id:r.id,legal_name:r.legal_name||"Unknown"}:null,deal:n?{id:n.id,name:n.name||"Unknown Deal",company_name:n.company_name??null,status:n.status||"unknown"}:null,subscription:i?{id:i.id,commitment:Number(i.commitment)||0,currency:i.currency||"USD",status:i.status||"pending",committed_at:i.committed_at}:null,referred_at:e.dispatched_at,role:e.role||"investor",investorStage:o,interest_confirmed_at:e.interest_confirmed_at,feeModel:n&&l.get(n.id)||null}})};async function a(){let{data:a,error:r}=await e.from("deal_memberships").select(`
          role,
          dispatched_at,
          interest_confirmed_at,
          deal_id,
          investor_id,
          referred_by_entity_id,
          investor:investor_id (
            id,
            legal_name
          ),
          deal:deal_id (
            id,
            name,
            company_name,
            status
          )
        `).eq("referred_by_entity_type","partner").order("dispatched_at",{ascending:!1}).limit(100);if(r)throw r;let s=await t(a||[]);U(s),A(S(s))}!async function(){try{q(!0);let{data:{user:r}}=await e.auth.getUser();if(!r)return void $("Not authenticated");let{data:s,error:l}=await e.from("partner_users").select("partner_id").eq("user_id",r.id).single();if(l||!s)return void await a();let{data:n,error:i}=await e.from("partners").select("id, name, legal_name, partner_type, status").eq("id",s.partner_id).single();if(i)throw i;M(n);let{data:d,error:o}=await e.from("deal_memberships").select(`
            role,
            dispatched_at,
            interest_confirmed_at,
            deal_id,
            investor_id,
            investor:investor_id (
              id,
              legal_name
            ),
            deal:deal_id (
              id,
              name,
              company_name,
              status
            )
          `).eq("referred_by_entity_id",s.partner_id).eq("referred_by_entity_type","partner").order("dispatched_at",{ascending:!1});if(o)throw o;let c=await t(d||[]);U(c),A(S(c)),$(null)}catch(e){console.error("[PartnerTransactionsPage] Error:",e),$(e instanceof Error?e.message:"Failed to load transactions")}finally{q(!1)}}()},[]);let Q=L.filter(e=>{let t=e.subscription?.status||"no_subscription",a="all"===F||t===F,r="all"===z||e.investorStage===z,s=!B||e.investor?.legal_name?.toLowerCase().includes(B.toLowerCase())||e.deal?.name?.toLowerCase().includes(B.toLowerCase())||e.deal?.company_name?.toLowerCase().includes(B.toLowerCase());return a&&r&&s});return P?(0,t.jsxs)("div",{className:"flex items-center justify-center py-16",children:[(0,t.jsx)(h.Loader2,{className:"h-8 w-8 animate-spin text-muted-foreground"}),(0,t.jsx)("span",{className:"ml-3 text-muted-foreground",children:"Loading transactions..."})]}):E?(0,t.jsxs)("div",{className:"text-center py-16",children:[(0,t.jsx)(f.AlertCircle,{className:"h-12 w-12 text-destructive mx-auto mb-4"}),(0,t.jsx)("h3",{className:"text-lg font-medium text-foreground mb-2",children:"Error Loading Transactions"}),(0,t.jsx)("p",{className:"text-muted-foreground",children:E})]}):(0,t.jsxs)("div",{className:"p-6 space-y-6",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-2xl font-bold text-foreground",children:"Partner Transactions"}),(0,t.jsx)("p",{className:"text-muted-foreground mt-1",children:e?`Track referrals and investments as ${e.name}`:"View all partner-referred transactions across the platform"})]}),(0,t.jsx)("div",{className:"flex items-center gap-2",children:e&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(l.Button,{variant:"outline",onClick:J,disabled:K||0===L.length,children:[K?(0,t.jsx)(h.Loader2,{className:"h-4 w-4 mr-2 animate-spin"}):(0,t.jsx)(g.Download,{className:"h-4 w-4 mr-2"}),"Export CSV"]}),(0,t.jsx)(s.Badge,{variant:"outline",className:"capitalize",children:e.partner_type})]})})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,t.jsxs)(r.Card,{children:[(0,t.jsx)(r.CardHeader,{className:"pb-2",children:(0,t.jsxs)(r.CardTitle,{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[(0,t.jsx)(c.Users,{className:"h-4 w-4"}),"Total Referrals"]})}),(0,t.jsxs)(r.CardContent,{children:[(0,t.jsx)("div",{className:"text-2xl font-bold",children:R.totalReferrals}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Investors referred to deals"})]})]}),(0,t.jsxs)(r.Card,{children:[(0,t.jsx)(r.CardHeader,{className:"pb-2",children:(0,t.jsxs)(r.CardTitle,{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[(0,t.jsx)(u.TrendingUp,{className:"h-4 w-4"}),"Converted"]})}),(0,t.jsxs)(r.CardContent,{children:[(0,t.jsx)("div",{className:"text-2xl font-bold text-green-600",children:R.convertedCount}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Successfully invested"})]})]}),(0,t.jsxs)(r.Card,{children:[(0,t.jsx)(r.CardHeader,{className:"pb-2",children:(0,t.jsxs)(r.CardTitle,{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[(0,t.jsx)(o.ArrowRightLeft,{className:"h-4 w-4"}),"Pending"]})}),(0,t.jsxs)(r.CardContent,{children:[(0,t.jsx)("div",{className:"text-2xl font-bold text-orange-500",children:R.pendingCount}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Awaiting completion"})]})]}),(0,t.jsxs)(r.Card,{children:[(0,t.jsx)(r.CardHeader,{className:"pb-2",children:(0,t.jsxs)(r.CardTitle,{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[(0,t.jsx)(m.DollarSign,{className:"h-4 w-4"}),"Total Value"]})}),(0,t.jsxs)(r.CardContent,{children:[(0,t.jsx)("div",{className:"text-2xl font-bold",children:(0,y.formatCurrency)(R.totalCommitmentValue,R.currency)}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Converted commitments"})]})]})]}),(0,t.jsx)(r.Card,{children:(0,t.jsx)(r.CardContent,{className:"pt-6",children:(0,t.jsxs)("div",{className:"flex flex-col md:flex-row gap-4",children:[(0,t.jsx)("div",{className:"flex-1",children:(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(x.Search,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),(0,t.jsx)(n.Input,{placeholder:"Search by investor, deal, or company...",value:B,onChange:e=>V(e.target.value),className:"pl-10"})]})}),(0,t.jsxs)(i.Select,{value:F,onValueChange:I,children:[(0,t.jsx)(i.SelectTrigger,{className:"w-full md:w-48",children:(0,t.jsx)(i.SelectValue,{placeholder:"Filter by status"})}),(0,t.jsx)(i.SelectContent,{children:D.map(e=>(0,t.jsx)(i.SelectItem,{value:e.value,children:e.label},e.value))})]}),(0,t.jsxs)(i.Select,{value:z,onValueChange:O,children:[(0,t.jsx)(i.SelectTrigger,{className:"w-full md:w-48",children:(0,t.jsx)(i.SelectValue,{placeholder:"Filter by stage"})}),(0,t.jsx)(i.SelectContent,{children:H.map(e=>(0,t.jsx)(i.SelectItem,{value:e.value,children:e.label},e.value))})]})]})})}),(0,t.jsxs)(r.Card,{children:[(0,t.jsxs)(r.CardHeader,{children:[(0,t.jsx)(r.CardTitle,{children:"Transactions"}),(0,t.jsxs)(r.CardDescription,{children:[Q.length," transaction",1!==Q.length?"s":""," found"]})]}),(0,t.jsx)(r.CardContent,{children:0===Q.length?(0,t.jsxs)("div",{className:"border border-dashed border-muted rounded-lg py-12 flex flex-col items-center justify-center text-center space-y-2",children:[(0,t.jsx)(b.Building2,{className:"h-10 w-10 text-muted-foreground"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:B||"all"!==F||"all"!==z?"No transactions match your filters":"No partner transactions yet"}),!e&&0===L.length&&(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:"Partner referrals will appear here when investors are referred via partner relationships"})]}):(0,t.jsx)("div",{className:"rounded-md border",children:(0,t.jsxs)(d.Table,{children:[(0,t.jsx)(d.TableHeader,{children:(0,t.jsxs)(d.TableRow,{children:[(0,t.jsx)(d.TableHead,{children:"Investor"}),(0,t.jsx)(d.TableHead,{children:"Deal"}),(0,t.jsx)(d.TableHead,{children:"Commitment"}),(0,t.jsx)(d.TableHead,{children:"Commission"}),(0,t.jsx)(d.TableHead,{children:"Status"}),(0,t.jsx)(d.TableHead,{children:"Stage"}),(0,t.jsx)(d.TableHead,{children:"Referred"}),(0,t.jsx)(d.TableHead,{className:"text-right",children:"Actions"})]})}),(0,t.jsx)(d.TableBody,{children:Q.map(e=>(0,t.jsxs)(d.TableRow,{children:[(0,t.jsx)(d.TableCell,{children:e.investor?(0,t.jsx)("div",{className:"font-medium",children:e.investor.legal_name}):(0,t.jsx)("span",{className:"text-muted-foreground",children:"—"})}),(0,t.jsx)(d.TableCell,{children:e.deal?(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"font-medium",children:e.deal.name}),e.deal.company_name&&(0,t.jsx)("div",{className:"text-xs text-muted-foreground",children:e.deal.company_name})]}):(0,t.jsx)("span",{className:"text-muted-foreground",children:"—"})}),(0,t.jsx)(d.TableCell,{children:e.subscription?(0,t.jsx)("div",{className:"font-medium",children:(0,y.formatCurrency)(e.subscription.commitment,e.subscription.currency)}):(0,t.jsx)("span",{className:"text-muted-foreground text-sm",children:"Not subscribed"})}),(0,t.jsx)(d.TableCell,{children:e.feeModel?(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsx)(j.Percent,{className:"h-3 w-3 text-emerald-600"}),(0,t.jsx)("span",{className:"text-sm font-medium text-emerald-600",children:e.feeModel.rate_bps?`${(e.feeModel.rate_bps/100).toFixed(2)}%`:e.feeModel.flat_amount?(0,y.formatCurrency)(e.feeModel.flat_amount,e.feeModel.currency):"—"}),e.subscription&&e.feeModel.rate_bps&&(0,t.jsxs)("span",{className:"text-xs text-muted-foreground ml-1",children:["(~",(0,y.formatCurrency)(e.subscription.commitment*e.feeModel.rate_bps/1e4,e.subscription.currency),")"]})]}):(0,t.jsx)("span",{className:"text-muted-foreground text-xs",children:"Not set"})}),(0,t.jsx)(d.TableCell,{children:e.subscription?(0,t.jsx)(s.Badge,{variant:"outline",className:(0,_.cn)("capitalize",k[e.subscription.status]||k.pending),children:e.subscription.status.replace("_"," ")}):(0,t.jsx)(s.Badge,{variant:"outline",className:"text-gray-500",children:"Referred"})}),(0,t.jsx)(d.TableCell,{children:(0,t.jsx)(s.Badge,{variant:"outline",className:(0,_.cn)("capitalize","funded"===e.investorStage&&"bg-green-100 text-green-800 border-green-200","signed"===e.investorStage&&"bg-blue-100 text-blue-800 border-blue-200","approved"===e.investorStage&&"bg-purple-100 text-purple-800 border-purple-200","passed"===e.investorStage&&"bg-red-100 text-red-800 border-red-200","interested"===e.investorStage&&"bg-yellow-100 text-yellow-800 border-yellow-200","dispatched"===e.investorStage&&"bg-gray-100 text-gray-600 border-gray-200"),children:e.investorStage})}),(0,t.jsx)(d.TableCell,{children:e.referred_at?(0,y.formatDate)(e.referred_at):"—"}),(0,t.jsx)(d.TableCell,{className:"text-right",children:(0,t.jsx)("div",{className:"flex items-center justify-end gap-2",children:e.deal&&(0,t.jsx)(l.Button,{variant:"ghost",size:"sm",asChild:!0,children:(0,t.jsx)(w.default,{href:`/versotech_main/opportunities/${e.deal.id}`,children:(0,t.jsx)(p.ExternalLink,{className:"h-4 w-4"})})})})})]},e.id))})]})})})]})]})}e.s(["default",()=>M])}]);