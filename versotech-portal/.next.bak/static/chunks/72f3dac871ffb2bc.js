(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,292959,e=>{"use strict";var s=e.i(722679),t=e.i(340915),a=e.i(603274),r=e.i(337684),n=e.i(90613),i=e.i(316264),l=e.i(129432),d=e.i(56213),c=e.i(429760),o=e.i(352776),m=e.i(674966),u=e.i(191569),x=e.i(514133),h=e.i(282141),p=e.i(310556),g=e.i(410587);let b=(0,g.default)("skip-forward",[["path",{d:"M21 4v16",key:"7j8fe9"}],["path",{d:"M6.029 4.285A2 2 0 0 0 3 6v12a2 2 0 0 0 3.029 1.715l9.997-5.998a2 2 0 0 0 .003-3.432z",key:"zs4d6"}]]);var j=e.i(669019);let f=[{number:1,name:"Received",key:"received",optional:!0},{number:2,name:"Viewed",key:"viewed",optional:!1},{number:3,name:"Interest",key:"interest_confirmed",optional:!0},{number:4,name:"NDA",key:"nda_signed",optional:!0},{number:5,name:"Data Room",key:"data_room_access",optional:!0},{number:6,name:"Pack Gen",key:"pack_generated",optional:!1},{number:7,name:"Pack Sent",key:"pack_sent",optional:!1},{number:8,name:"Signed",key:"signed",optional:!1},{number:9,name:"Funded",key:"funded",optional:!1},{number:10,name:"Active",key:"active",optional:!1}];function N({stages:e,summary:t,currentStage:a=0,className:r,compact:n=!1}){let i=t||(e?{received:e.find(e=>1===e.stage_number)?.completed_at||null,viewed:e.find(e=>2===e.stage_number)?.completed_at||null,interest_confirmed:e.find(e=>3===e.stage_number)?.completed_at||null,nda_signed:e.find(e=>4===e.stage_number)?.completed_at||null,data_room_access:e.find(e=>5===e.stage_number)?.completed_at||null,pack_generated:e.find(e=>6===e.stage_number)?.completed_at||null,pack_sent:e.find(e=>7===e.stage_number)?.completed_at||null,signed:e.find(e=>8===e.stage_number)?.completed_at||null,funded:e.find(e=>9===e.stage_number)?.completed_at||null,active:e.find(e=>10===e.stage_number)?.completed_at||null}:{received:null,viewed:null,interest_confirmed:null,nda_signed:null,data_room_access:null,pack_generated:null,pack_sent:null,signed:null,funded:null,active:null}),l=a||(i.active?10:i.funded?9:i.signed?8:i.pack_sent?7:i.pack_generated?6:i.data_room_access?5:i.nda_signed?4:i.interest_confirmed?3:i.viewed?2:+!!i.received);return(0,s.jsx)(j.TooltipProvider,{children:(0,s.jsxs)("div",{className:(0,h.cn)("w-full",r),children:[(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)("div",{className:"absolute top-4 left-0 right-0 h-0.5 bg-border"}),(0,s.jsx)("div",{className:"absolute top-4 left-0 h-0.5 bg-emerald-500 transition-all duration-500",style:{width:`${100*Math.max(0,(l-1)/9)}%`}}),(0,s.jsx)("div",{className:"relative flex justify-between",children:f.map(e=>{let t=function(e,s,t){return s[e.key]?"completed":e.number===t?"current":null!==s.pack_generated&&null===s.interest_confirmed&&(3===e.number||5===e.number)&&(t>e.number||s.pack_generated)||e.optional&&e.number<t?"skipped":"pending"}(e,i,l),a=i[e.key];return(0,s.jsxs)(j.Tooltip,{children:[(0,s.jsx)(j.TooltipTrigger,{asChild:!0,children:(0,s.jsxs)("div",{className:"flex flex-col items-center",children:[(0,s.jsx)("div",{className:(0,h.cn)("w-8 h-8 rounded-full flex items-center justify-center transition-all","completed"===t&&"bg-emerald-500 text-white","current"===t&&"bg-blue-500 text-white ring-4 ring-blue-200 dark:ring-blue-900","skipped"===t&&"bg-muted text-muted-foreground","pending"===t&&"bg-muted/50 text-muted-foreground"),children:"completed"===t?(0,s.jsx)(p.Check,{className:"w-4 h-4"}):"skipped"===t?(0,s.jsx)(b,{className:"w-3 h-3"}):(0,s.jsx)("span",{className:"text-xs font-medium",children:e.number})}),!n&&(0,s.jsx)("span",{className:(0,h.cn)("mt-2 text-xs font-medium text-center max-w-[60px] leading-tight","completed"===t&&"text-emerald-600 dark:text-emerald-400","current"===t&&"text-blue-600 dark:text-blue-400","skipped"===t&&"text-muted-foreground","pending"===t&&"text-muted-foreground"),children:e.name})]})}),(0,s.jsx)(j.TooltipContent,{side:"bottom",className:"max-w-[200px]",children:(0,s.jsxs)("div",{className:"text-sm",children:[(0,s.jsx)("div",{className:"font-medium",children:e.name}),"completed"===t&&a&&(0,s.jsxs)("div",{className:"text-xs text-muted-foreground mt-1",children:["Completed: ",a?new Date(a).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}):""]}),"current"===t&&(0,s.jsx)("div",{className:"text-xs text-blue-600 mt-1",children:"In Progress"}),"skipped"===t&&(0,s.jsx)("div",{className:"text-xs text-muted-foreground mt-1",children:"Skipped (optional)"}),"pending"===t&&(0,s.jsx)("div",{className:"text-xs text-muted-foreground mt-1",children:"Pending"}),e.optional&&(0,s.jsx)("div",{className:"text-xs text-amber-600 dark:text-amber-400 mt-1",children:"Optional stage"})]})})]},e.number)})})]}),!n&&(0,s.jsx)("div",{className:"mt-4 text-center",children:(0,s.jsxs)("span",{className:"text-sm text-muted-foreground",children:[0===l&&"Not started",1===l&&"Opportunity received",2===l&&"Viewed opportunity",3===l&&"Interest confirmed",4===l&&"NDA signed",5===l&&"Data room access granted",6===l&&"Subscription pack generated",7===l&&"Subscription pack sent for signing",8===l&&"Subscription signed",9===l&&"Investment funded",10===l&&"Investment active"]})})]})})}var v=e.i(799359),y=e.i(994500),_=e.i(230112),w=e.i(197098),k=e.i(761722),C=e.i(398472),S=e.i(557176),D=e.i(119311),T=e.i(595870);let A=(0,g.default)("file-image",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["circle",{cx:"10",cy:"12",r:"2",key:"737tya"}],["path",{d:"m20 17-1.296-1.296a2.41 2.41 0 0 0-3.408 0L9 22",key:"wt3hpn"}]]),F=(0,g.default)("file-play",[["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7z",key:"1mlx9k"}],["path",{d:"M15.033 13.44a.647.647 0 0 1 0 1.12l-4.065 2.352a.645.645 0 0 1-.968-.56v-4.704a.645.645 0 0 1 .967-.56z",key:"1tzo1f"}]]),B=(0,g.default)("presentation",[["path",{d:"M2 3h20",key:"91anmk"}],["path",{d:"M21 3v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V3",key:"2k9sn8"}],["path",{d:"m7 21 5-5 5 5",key:"bip4we"}]]);var O=e.i(959768),I=e.i(49664),P=e.i(358634),R=e.i(553426),q=e.i(496383),$=e.i(263229);function L({document:e,dealId:a,hasAccess:r}){var n,l;let[d,c]=(0,t.useState)(!1),[o,m]=(0,t.useState)(!1),u=(n=e.file_type).includes("pdf")?D.FileText:n.includes("spreadsheet")||n.includes("excel")||n.includes("csv")?T.FileSpreadsheet:n.includes("image")?A:n.includes("video")?F:n.includes("presentation")||n.includes("powerpoint")?B:n.includes("word")||n.includes("document")?D.FileText:S.File,x=!!e.external_link,h=(l=e.file_type).includes("pdf")||l.includes("image")||l.includes("text")||l.includes("video"),p=(0,t.useCallback)(async s=>{if(x&&e.external_link)return void window.open(e.external_link,"_blank","noopener,noreferrer");let t="preview"===s;t?m(!0):c(!0);try{let r=await fetch(`/api/deals/${a}/documents/${e.id}/download?mode=${s}`);if(!r.ok){let e=await r.json().catch(()=>({}));401===r.status?y.toast.error("Please sign in to access documents"):403===r.status?y.toast.error(e.error||"Access denied to this document"):404===r.status?y.toast.error("Document not found"):y.toast.error(e.error||"Failed to access document");return}let n=await r.json(),i=n.download_url||n.url;if(!i)return void y.toast.error("Failed to generate document link");window.open(i,"_blank","noopener,noreferrer"),n.watermark?y.toast.success(t?"Document opened for preview":"Download started",{description:`Link expires in ${Math.floor(n.expires_in_seconds/60)} minutes`,duration:4e3}):y.toast.success(t?"Document opened":"Download started")}catch(e){console.error("Document action error:",e),y.toast.error("Failed to access document. Please try again.")}finally{c(!1),m(!1)}},[a,e.id,e.external_link,x]);return(0,s.jsxs)("div",{className:"flex items-center justify-between py-3 px-4 hover:bg-muted rounded-lg transition-colors group",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3 min-w-0 flex-1",children:[(0,s.jsx)("div",{className:"p-2 rounded-lg bg-muted text-muted-foreground",children:(0,s.jsx)(u,{className:"h-5 w-5"})}),(0,s.jsxs)("div",{className:"min-w-0",children:[(0,s.jsx)("p",{className:"font-medium text-foreground truncate",children:e.file_name}),(0,s.jsxs)("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[(0,s.jsx)("span",{children:function(e){if(0===e)return"—";let s=Math.floor(Math.log(e)/Math.log(1024));return`${(e/Math.pow(1024,s)).toFixed(+(s>0))} ${["B","KB","MB","GB"][s]}`}(e.file_size)}),(0,s.jsx)("span",{children:"•"}),(0,s.jsx)("span",{children:new Date(e.uploaded_at).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}),e.description&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("span",{children:"•"}),(0,s.jsx)("span",{className:"truncate max-w-[200px]",children:e.description})]})]})]})]}),r&&(0,s.jsx)("div",{className:"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:x?(0,s.jsxs)(i.Button,{variant:"ghost",size:"sm",onClick:()=>p("preview"),children:[(0,s.jsx)(C.ExternalLink,{className:"h-4 w-4 mr-1"}),"Open"]}):(0,s.jsxs)(s.Fragment,{children:[h&&(0,s.jsxs)(i.Button,{variant:"ghost",size:"sm",onClick:()=>p("preview"),disabled:o,className:"text-blue-600 hover:text-blue-700 hover:bg-blue-50",children:[o?(0,s.jsx)($.Loader2,{className:"h-4 w-4 mr-1 animate-spin"}):(0,s.jsx)(q.Eye,{className:"h-4 w-4 mr-1"}),"Preview"]}),(0,s.jsxs)(i.Button,{variant:"ghost",size:"sm",onClick:()=>p("download"),disabled:d,children:[d?(0,s.jsx)($.Loader2,{className:"h-4 w-4 mr-1 animate-spin"}):(0,s.jsx)(k.Download,{className:"h-4 w-4 mr-1"}),"Download"]})]})})]})}function M({folderName:e,documents:a,dealId:r,hasAccess:n,defaultOpen:i=!1}){let[d,c]=(0,t.useState)(i);return(0,s.jsxs)(v.Collapsible,{open:d,onOpenChange:c,children:[(0,s.jsx)(v.CollapsibleTrigger,{className:"w-full",children:(0,s.jsxs)("div",{className:"flex items-center justify-between py-3 px-4 hover:bg-muted rounded-lg transition-colors",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("div",{className:"p-2 rounded-lg bg-blue-50 dark:bg-blue-900/30 text-blue-600",children:d?(0,s.jsx)(I.FolderOpen,{className:"h-5 w-5"}):(0,s.jsx)(O.Folder,{className:"h-5 w-5"})}),(0,s.jsx)("span",{className:"font-medium text-foreground",children:e}),(0,s.jsxs)(l.Badge,{variant:"secondary",className:"ml-2",children:[a.length," ",1===a.length?"file":"files"]})]}),d?(0,s.jsx)(_.ChevronDown,{className:"h-5 w-5 text-muted-foreground"}):(0,s.jsx)(w.ChevronRight,{className:"h-5 w-5 text-muted-foreground"})]})}),(0,s.jsx)(v.CollapsibleContent,{children:(0,s.jsx)("div",{className:"ml-6 pl-4 border-l-2 border-border space-y-1",children:a.map(e=>(0,s.jsx)(L,{document:e,dealId:r,hasAccess:n},e.id))})})]})}function E({documents:e,hasAccess:a,requiresNda:r,dealId:l,onRequestAccess:d}){let{featured:c,folders:o}=(0,t.useMemo)(()=>{let s=[],t={};e.forEach(e=>{e.is_featured&&s.push(e);let a=e.category||"General";t[a]||(t[a]=[]),t[a].push(e)});let a={};return Object.keys(t).sort((e,s)=>"General"===e?1:"General"===s?-1:e.localeCompare(s)).forEach(e=>{a[e]=t[e]}),{featured:s,folders:a}},[e]);return a?0===e.length?(0,s.jsx)(n.Card,{children:(0,s.jsxs)(n.CardContent,{className:"py-8 text-center",children:[(0,s.jsx)(O.Folder,{className:"h-12 w-12 mx-auto text-muted-foreground mb-4"}),(0,s.jsx)("h3",{className:"text-lg font-semibold text-foreground mb-2",children:"No Documents Available"}),(0,s.jsx)("p",{className:"text-muted-foreground max-w-md mx-auto",children:"Documents for this deal haven't been uploaded yet. Check back soon."})]})}):(0,s.jsxs)("div",{className:"space-y-6",children:[c.length>0&&(0,s.jsxs)(n.Card,{className:"border-amber-200 bg-amber-50/50 dark:bg-amber-900/10",children:[(0,s.jsxs)(n.CardHeader,{className:"pb-2",children:[(0,s.jsxs)(n.CardTitle,{className:"text-base flex items-center gap-2 text-amber-700 dark:text-amber-300",children:[(0,s.jsx)(P.Star,{className:"h-5 w-5 fill-amber-400 text-amber-400"}),"Featured Documents"]}),(0,s.jsx)(n.CardDescription,{className:"text-amber-600/80 dark:text-amber-400/80",children:"Key documents highlighted by the deal team"})]}),(0,s.jsx)(n.CardContent,{className:"pt-0 space-y-1",children:c.map(e=>(0,s.jsx)(L,{document:e,dealId:l,hasAccess:a},e.id))})]}),(0,s.jsxs)(n.Card,{children:[(0,s.jsxs)(n.CardHeader,{className:"pb-2",children:[(0,s.jsxs)(n.CardTitle,{className:"text-base flex items-center gap-2",children:[(0,s.jsx)(q.Eye,{className:"h-5 w-5 text-blue-500"}),"Data Room"]}),(0,s.jsxs)(n.CardDescription,{children:[e.length," document",1!==e.length?"s":""," across ",Object.keys(o).length," folder",1!==Object.keys(o).length?"s":""]})]}),(0,s.jsx)(n.CardContent,{className:"pt-0 space-y-1",children:Object.entries(o).map(([e,t],r)=>(0,s.jsx)(M,{folderName:e,documents:t,dealId:l,hasAccess:a,defaultOpen:0===r},e))})]})]}):(0,s.jsx)(n.Card,{className:"border-amber-200 bg-amber-50 dark:bg-amber-900/20",children:(0,s.jsxs)(n.CardContent,{className:"py-8 text-center",children:[(0,s.jsx)(R.Lock,{className:"h-12 w-12 mx-auto text-amber-500 mb-4"}),(0,s.jsx)("h3",{className:"text-lg font-semibold text-amber-800 dark:text-amber-200 mb-2",children:"Data Room Access Required"}),(0,s.jsx)("p",{className:"text-amber-700 dark:text-amber-300 mb-4 max-w-md mx-auto",children:r?"Sign the NDA to unlock access to the full data room with deal documents, financials, and more.":"Express interest in this deal to unlock access to the data room."}),d&&(0,s.jsx)(i.Button,{onClick:d,className:"bg-amber-600 hover:bg-amber-700",children:r?"Sign NDA to Unlock":"Request Access"})]})})}var H=e.i(84065),U=e.i(645855),z=e.i(15098),V=e.i(378710),G=e.i(619324);function J(e){return e?new Date(e).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}):"TBD"}function Y(e){if(!e)return"future";let s=new Date(e),t=new Date,a=new Date(t.getFullYear(),t.getMonth(),t.getDate()),r=new Date(s.getFullYear(),s.getMonth(),s.getDate());return r<a?"past":r.getTime()===a.getTime()?"current":"future"}function K({status:e}){return"past"===e?(0,s.jsx)("div",{className:"w-8 h-8 rounded-full bg-emerald-100 dark:bg-emerald-900/30 flex items-center justify-center",children:(0,s.jsx)(z.CheckCircle2,{className:"w-5 h-5 text-emerald-600"})}):"current"===e?(0,s.jsx)("div",{className:"w-8 h-8 rounded-full bg-blue-100 dark:bg-blue-900/30 flex items-center justify-center ring-2 ring-blue-500 ring-offset-2",children:(0,s.jsx)(V.Circle,{className:"w-5 h-5 text-blue-600 fill-blue-600"})}):(0,s.jsx)("div",{className:"w-8 h-8 rounded-full bg-muted flex items-center justify-center",children:(0,s.jsx)(V.Circle,{className:"w-5 h-5 text-muted-foreground"})})}function Q({status:e}){return(0,s.jsx)("div",{className:(0,h.cn)("flex-1 h-1 rounded-full mx-2","past"===e&&"bg-emerald-400","current"===e&&"bg-gradient-to-r from-emerald-400 to-gray-300","future"===e&&"bg-muted")})}function W({openAt:e,closeAt:t,interestDeadline:a,settlementDate:r}){let i=[{label:"Deal Open",date:e,status:Y(e)},...a?[{label:"Interest Deadline",date:a,status:Y(a)}]:[],{label:"Deal Close",date:t,status:Y(t)},...r?[{label:"Settlement",date:r,status:Y(r)}]:[]],d=function(e){if(!e)return null;let s=new Date(e),t=new Date;return Math.ceil((s.getTime()-t.getTime())/864e5)}(t),c=null!==d&&d>0&&d<=7,o=null!==d&&d<=0;return(0,s.jsxs)(n.Card,{children:[(0,s.jsx)(n.CardHeader,{className:"pb-3",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)(n.CardTitle,{className:"text-base flex items-center gap-2",children:[(0,s.jsx)(H.Calendar,{className:"h-5 w-5 text-blue-500"}),"Deal Timeline"]}),null!==d&&!o&&(0,s.jsxs)(l.Badge,{variant:c?"destructive":"secondary",className:"flex items-center gap-1",children:[c&&(0,s.jsx)(G.AlertTriangle,{className:"w-3 h-3"}),(0,s.jsx)(U.Clock,{className:"w-3 h-3"}),d," day",1!==d?"s":""," remaining"]}),o&&(0,s.jsx)(l.Badge,{variant:"secondary",className:"bg-muted",children:"Closed"})]})}),(0,s.jsxs)(n.CardContent,{children:[(0,s.jsx)("div",{className:"hidden sm:block",children:(0,s.jsx)("div",{className:"flex items-center justify-between",children:i.map((e,t)=>(0,s.jsxs)("div",{className:"flex items-center flex-1",children:[(0,s.jsxs)("div",{className:"flex flex-col items-center",children:[(0,s.jsx)(K,{status:e.status}),(0,s.jsxs)("div",{className:"mt-2 text-center",children:[(0,s.jsx)("p",{className:(0,h.cn)("text-xs font-medium","past"===e.status&&"text-emerald-600","current"===e.status&&"text-blue-600","future"===e.status&&"text-muted-foreground"),children:e.label}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground mt-0.5",children:J(e.date)})]})]}),t<i.length-1&&(0,s.jsx)(Q,{status:"past"===e.status&&i[t+1]?.status==="past"?"past":"past"===e.status&&i[t+1]?.status!=="past"?"current":"future"})]},e.label))})}),(0,s.jsx)("div",{className:"sm:hidden space-y-4",children:i.map((e,t)=>(0,s.jsxs)("div",{className:"flex items-start gap-3",children:[(0,s.jsxs)("div",{className:"flex flex-col items-center",children:[(0,s.jsx)(K,{status:e.status}),t<i.length-1&&(0,s.jsx)("div",{className:(0,h.cn)("w-0.5 h-8 mt-2","past"===e.status?"bg-emerald-400":"bg-muted")})]}),(0,s.jsxs)("div",{className:"pt-1",children:[(0,s.jsx)("p",{className:(0,h.cn)("text-sm font-medium","past"===e.status&&"text-emerald-600","current"===e.status&&"text-blue-600","future"===e.status&&"text-muted-foreground"),children:e.label}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground",children:J(e.date)})]})]},e.label))})]})]})}var Z=e.i(691974),X=e.i(196767),ee=e.i(223271),es=e.i(416469),et=e.i(871561),ea=e.i(971743),er=e.i(733179),en=e.i(416200),ei=e.i(275034);function el({item:e}){var t;let a=e.icon,r=(t=e.value)?t.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase()):"-";return(0,s.jsxs)("div",{className:"flex items-center gap-3 p-3 rounded-lg bg-muted/50",children:[(0,s.jsx)("div",{className:"p-2 rounded-md bg-card shadow-sm",children:(0,s.jsx)(a,{className:"w-4 h-4 text-muted-foreground"})}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsx)("p",{className:"text-xs text-muted-foreground",children:e.label}),e.isBadge&&e.value?(0,s.jsx)(l.Badge,{variant:e.badgeVariant||"secondary",className:(0,h.cn)("mt-0.5",e.badgeColor),children:r}):(0,s.jsx)("p",{className:"text-sm font-medium truncate",children:r})]})]})}function ed({dealType:e,currency:t,stockType:a,sector:r,location:i,vehicleName:l,stage:d,round:c}){let o=[{label:"Deal Type",value:e,icon:Z.Briefcase,isBadge:!0,badgeColor:"bg-blue-100 text-blue-700 hover:bg-blue-100"},{label:"Stock Type",value:a,icon:ee.Tag,isBadge:!0,badgeColor:"bg-purple-100 text-purple-700 hover:bg-purple-100"},{label:"Currency",value:t,icon:X.DollarSign},{label:"Sector",value:r,icon:es.Globe},{label:"Location",value:i,icon:et.MapPin},{label:"Vehicle",value:l,icon:ea.Building2},{label:"Stage",value:d,icon:er.TrendingUp},{label:"Round",value:c,icon:en.Target}].filter(e=>e.value||"Deal Type"===e.label||"Currency"===e.label);return(0,s.jsxs)(n.Card,{children:[(0,s.jsx)(n.CardHeader,{className:"pb-3",children:(0,s.jsxs)(n.CardTitle,{className:"text-base flex items-center gap-2",children:[(0,s.jsx)(ei.Info,{className:"h-5 w-5 text-muted-foreground"}),"Key Details"]})}),(0,s.jsx)(n.CardContent,{children:(0,s.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3",children:o.map(e=>(0,s.jsx)(el,{item:e},e.label))})})]})}var ec=e.i(937368),eo=e.i(509192),em=e.i(711819),eu=e.i(932735),ex=e.i(634847),eh=e.i(30100);let ep={0:{label:"New",description:"Choose to request a subscription or explore the data room first",icon:e.i(768385).Sparkles,color:"text-muted-foreground",bgColor:"bg-muted"},1:{label:"Received",description:"Deal dispatched to you",icon:eu.Send,color:"text-blue-600",bgColor:"bg-blue-100 dark:bg-blue-900/30"},2:{label:"Viewed",description:"You have viewed this deal",icon:U.Clock,color:"text-blue-600",bgColor:"bg-blue-100 dark:bg-blue-900/30"},3:{label:"Interest Confirmed",description:"Next: Sign NDA to access documents",icon:eo.Heart,color:"text-pink-600",bgColor:"bg-pink-100 dark:bg-pink-900/30"},4:{label:"NDA Signed",description:"Access data room documents",icon:em.FileSignature,color:"text-indigo-600",bgColor:"bg-indigo-100 dark:bg-indigo-900/30"},5:{label:"Data Room Access",description:"Review documents before subscribing",icon:I.FolderOpen,color:"text-amber-600",bgColor:"bg-amber-100 dark:bg-amber-900/30"},6:{label:"Pack Generated",description:"Subscription documents prepared",icon:z.CheckCircle2,color:"text-cyan-600",bgColor:"bg-cyan-100 dark:bg-cyan-900/30"},7:{label:"Pack Sent",description:"Awaiting your signature",icon:eu.Send,color:"text-violet-600",bgColor:"bg-violet-100 dark:bg-violet-900/30"},8:{label:"Signed",description:"Awaiting funding",icon:em.FileSignature,color:"text-purple-600",bgColor:"bg-purple-100 dark:bg-purple-900/30"},9:{label:"Funded",description:"Awaiting activation",icon:X.DollarSign,color:"text-emerald-600",bgColor:"bg-emerald-100 dark:bg-emerald-900/30"},10:{label:"Active",description:"Investment is active",icon:ex.Rocket,color:"text-green-600",bgColor:"bg-green-100 dark:bg-green-900/30"}};function eg({currentStage:e,membership:t,subscription:a,canExpressInterest:r,canSignNda:d,canSubscribe:c,isTrackingOnly:o,onExpressInterest:m,onSignNda:u,onSubscribe:x}){let p=ep[e]||ep[0],g=p.icon,b=function(e,s){for(let a of[{action:"Investment activated",timestamp:s?.funded_at&&"active"===s.status?s.funded_at:null},{action:"Funded",timestamp:s?.funded_at??null},{action:"Subscription signed",timestamp:s?.signed_at??null},{action:"Pack sent",timestamp:s?.pack_sent_at??null},{action:"Data room access granted",timestamp:e?.data_room_granted_at??null},{action:"NDA signed",timestamp:e?.nda_signed_at??null},{action:"Interest confirmed",timestamp:e?.interest_confirmed_at??null}])if(a.timestamp){var t;return{action:a.action,timestamp:(t=a.timestamp)?new Date(t).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"}):""}}return null}(t,a),j=e/10*100,f=e<=2&&!a,N=c&&!o,v=r&&!o,y=f&&(N||v),_=!o&&d?{label:"Sign NDA",onClick:u,icon:em.FileSignature}:!o&&c?{label:"Subscribe Now",onClick:x,icon:ex.Rocket}:null;return(0,s.jsxs)(n.Card,{className:"border-2 border-dashed border-border bg-gradient-to-br from-background to-muted",children:[(0,s.jsx)(n.CardHeader,{className:"pb-3",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)(n.CardTitle,{className:"text-base flex items-center gap-2",children:[(0,s.jsx)(eo.Heart,{className:"h-5 w-5 text-pink-500"}),"Your Interest Status"]}),(0,s.jsxs)(l.Badge,{className:(0,h.cn)(p.bgColor,p.color,"border-0"),children:["Stage ",e,"/10"]})]})}),(0,s.jsxs)(n.CardContent,{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex items-start gap-4",children:[(0,s.jsx)("div",{className:(0,h.cn)("p-3 rounded-xl",p.bgColor),children:(0,s.jsx)(g,{className:(0,h.cn)("w-6 h-6",p.color)})}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("h3",{className:(0,h.cn)("font-semibold text-lg",p.color),children:p.label}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:p.description})]})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)("div",{className:"flex justify-between text-xs text-muted-foreground",children:[(0,s.jsx)("span",{children:"Journey Progress"}),(0,s.jsxs)("span",{children:[e,"/10 stages"]})]}),(0,s.jsx)(ec.Progress,{value:j,className:"h-2"})]}),o&&(0,s.jsxs)("div",{className:"rounded-lg border border-amber-200 bg-amber-50 p-3 text-amber-900 dark:border-amber-900/40 dark:bg-amber-900/20 dark:text-amber-200",children:[(0,s.jsx)("p",{className:"text-sm font-medium",children:"Tracking Only Access"}),(0,s.jsx)("p",{className:"text-xs text-amber-700 dark:text-amber-300",children:"You can view this deal, but investment actions are disabled. Contact your relationship manager for investor access."})]}),b&&(0,s.jsxs)("div",{className:"p-3 rounded-lg bg-muted text-sm",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 text-muted-foreground",children:[(0,s.jsx)(U.Clock,{className:"w-4 h-4"}),(0,s.jsx)("span",{className:"font-medium",children:b.action})]}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground mt-1 ml-6",children:b.timestamp})]}),y&&(0,s.jsxs)("div",{className:"space-y-4",children:[N&&(0,s.jsx)("button",{onClick:x,className:"w-full p-4 rounded-lg border-2 border-emerald-200 dark:border-emerald-800 bg-emerald-50 dark:bg-emerald-900/20 hover:border-emerald-400 dark:hover:border-emerald-600 transition-colors text-left group",children:(0,s.jsxs)("div",{className:"flex items-start gap-3",children:[(0,s.jsx)("div",{className:"flex h-10 w-10 shrink-0 items-center justify-center rounded-full bg-emerald-600 text-white",children:(0,s.jsx)(ex.Rocket,{className:"w-5 h-5"})}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsxs)("div",{className:"font-semibold text-emerald-700 dark:text-emerald-300 flex items-center gap-2",children:["Subscribe to Investment",(0,s.jsx)(eh.ArrowRight,{className:"w-4 h-4 group-hover:translate-x-1 transition-transform"})]}),(0,s.jsx)("div",{className:"text-sm text-emerald-600 dark:text-emerald-400 mt-0.5",children:"Direct path • NDA + Subscription Pack"})]})]})}),N&&v&&(0,s.jsxs)("div",{className:"relative flex items-center",children:[(0,s.jsx)("div",{className:"flex-1 h-px bg-border"}),(0,s.jsx)("span",{className:"px-3 text-xs text-muted-foreground font-medium bg-background",children:"OR"}),(0,s.jsx)("div",{className:"flex-1 h-px bg-border"})]}),v&&(0,s.jsx)("button",{onClick:m,className:"w-full p-4 rounded-lg border border-dashed border-border hover:border-amber-400 transition-colors text-left group",children:(0,s.jsxs)("div",{className:"flex items-start gap-3",children:[(0,s.jsx)("div",{className:"flex h-10 w-10 shrink-0 items-center justify-center rounded-full bg-amber-100 dark:bg-amber-900/30 text-amber-600",children:(0,s.jsx)(eo.Heart,{className:"w-5 h-5"})}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("div",{className:"font-medium text-foreground flex items-center gap-2",children:"Request Data Room Access"}),(0,s.jsx)("div",{className:"text-sm text-muted-foreground mt-0.5",children:"Review documents before committing"})]})]})})]}),!f&&_&&(0,s.jsxs)(i.Button,{onClick:_.onClick,className:"w-full",size:"lg",children:[(0,s.jsx)(_.icon,{className:"w-4 h-4 mr-2"}),_.label,(0,s.jsx)(eh.ArrowRight,{className:"w-4 h-4 ml-2"})]}),10===e&&(0,s.jsxs)("div",{className:"p-4 rounded-lg bg-emerald-50 dark:bg-emerald-900/20 text-center",children:[(0,s.jsx)(z.CheckCircle2,{className:"w-8 h-8 mx-auto text-emerald-600 mb-2"}),(0,s.jsx)("p",{className:"font-medium text-emerald-700 dark:text-emerald-300",children:"Investment Active"}),(0,s.jsx)("p",{className:"text-sm text-emerald-600 dark:text-emerald-400",children:"View in your Portfolio for NAV tracking"})]})]})]})}var eb=e.i(816654),ej=e.i(376457),ef=e.i(827178),eN=e.i(417439);function ev(e,s="USD"){return e?new Intl.NumberFormat("en-US",{style:"currency",currency:s,minimumFractionDigits:0,maximumFractionDigits:0}).format(e):"-"}function ey({icon:e,iconColor:a,label:r,doc:n}){let[l,d]=(0,t.useState)(!1),c=n.signatories.filter(e=>"signed"===e.status).length,o=n.signatories.length,m="complete"===n.status,u=n.signed_url||n.unsigned_url;return(0,s.jsxs)("div",{children:[(0,s.jsxs)("button",{type:"button",className:(0,h.cn)("w-full flex items-center gap-2.5 py-2 px-2.5 rounded-md text-left transition-colors",o>0&&"hover:bg-muted/50 cursor-pointer",l&&"bg-muted/30"),onClick:()=>o>0&&d(!l),disabled:0===o,children:[(0,s.jsx)(e,{className:(0,h.cn)("w-4 h-4 shrink-0",a)}),(0,s.jsx)("span",{className:"text-sm font-medium flex-1",children:r}),(0,s.jsxs)("div",{className:"flex items-center gap-1.5",children:[o>0&&(0,s.jsxs)("span",{className:(0,h.cn)("text-xs tabular-nums",m?"text-emerald-600":"text-muted-foreground"),children:[c,"/",o]}),m?(0,s.jsx)(z.CheckCircle2,{className:"w-3.5 h-3.5 text-emerald-500"}):(0,s.jsx)(U.Clock,{className:"w-3.5 h-3.5 text-amber-500"}),o>0&&(0,s.jsx)(_.ChevronDown,{className:(0,h.cn)("w-3 h-3 text-muted-foreground transition-transform",l&&"rotate-180")})]})]}),l&&(0,s.jsxs)("div",{className:"ml-6 mr-2 mt-1 mb-1.5 space-y-1",children:[n.signatories.map((e,t)=>{var a;return(0,s.jsxs)("div",{className:"flex items-center justify-between text-xs py-0.5 px-2 rounded bg-muted/40",children:[(0,s.jsx)("span",{className:"text-muted-foreground truncate max-w-[120px]",children:e.name}),"signed"===e.status?(0,s.jsxs)("span",{className:"text-emerald-600 flex items-center gap-1",children:[(0,s.jsx)(z.CheckCircle2,{className:"w-2.5 h-2.5"}),e.signed_at?(a=e.signed_at)?new Date(a).toLocaleDateString("en-US",{month:"short",day:"numeric"}):"":"Done"]}):(0,s.jsx)("span",{className:"text-amber-500 text-[10px]",children:"Pending"})]},t)}),u&&(0,s.jsxs)(i.Button,{size:"sm",variant:"ghost",className:"h-5 text-[10px] px-2 mt-0.5",onClick:e=>{e.stopPropagation(),window.open(n.signed_url||n.unsigned_url,"_blank")},children:[n.signed_url?(0,s.jsx)(k.Download,{className:"w-2.5 h-2.5 mr-1"}):(0,s.jsx)(C.ExternalLink,{className:"w-2.5 h-2.5 mr-1"}),n.signed_url?"Download":"View"]})]})]})}function e_({subscription:e,dealCurrency:a,dealId:r,dealName:d}){let c=function(e){switch(e){case"active":return{label:"Active",color:"text-emerald-600",bg:"bg-emerald-100 dark:bg-emerald-900/30",icon:ex.Rocket};case"committed":return{label:"Committed",color:"text-blue-600",bg:"bg-blue-100 dark:bg-blue-900/30",icon:z.CheckCircle2};case"funded":return{label:"Funded",color:"text-purple-600",bg:"bg-purple-100 dark:bg-purple-900/30",icon:X.DollarSign};default:return{label:"Pending",color:"text-amber-600",bg:"bg-amber-100 dark:bg-amber-900/30",icon:U.Clock}}}(e.status),m=c.icon,x=e.currency||a||"USD",p=e.documents,[g,b]=(0,t.useState)(!1),[j,f]=(0,t.useState)(d?`Subscription pack clarification - ${d}`:"Subscription pack clarification"),[N,v]=(0,t.useState)(""),[_,w]=(0,t.useState)(!1),C=[{key:"generated",done:!!e.pack_generated_at},{key:"sent",done:!!e.pack_sent_at},{key:"signed",done:!!e.signed_at},{key:"funded",done:!!e.funded_at},{key:"active",done:!!e.activated_at}],S=C.filter(e=>e.done).length,T=S/C.length*100;return(0,s.jsxs)(n.Card,{className:"border-2 border-dashed border-gray-200 dark:border-gray-800 bg-gradient-to-br from-white to-gray-50 dark:from-gray-900 dark:to-gray-950",children:[(0,s.jsx)(n.CardHeader,{className:"pb-3",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)(n.CardTitle,{className:"text-base flex items-center gap-2",children:[(0,s.jsx)(ef.Banknote,{className:"h-5 w-5 text-emerald-500"}),"Your Subscription"]}),(0,s.jsxs)(l.Badge,{className:(0,h.cn)(c.bg,c.color,"border-0"),children:[(0,s.jsx)(m,{className:"w-3 h-3 mr-1"}),c.label]})]})}),(0,s.jsxs)(n.CardContent,{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("div",{className:(0,h.cn)("p-2.5 rounded-xl",c.bg),children:(0,s.jsx)(X.DollarSign,{className:(0,h.cn)("w-5 h-5",c.color)})}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsx)("div",{className:"text-xl font-bold tracking-tight",children:ev(e.commitment,x)}),null!==e.funded_amount&&e.funded_amount>0&&(0,s.jsxs)("div",{className:"text-xs text-muted-foreground",children:["Funded: ",ev(e.funded_amount,x)]})]})]}),(0,s.jsxs)("div",{className:"space-y-1.5",children:[(0,s.jsxs)("div",{className:"flex justify-between text-xs text-muted-foreground",children:[(0,s.jsx)("span",{children:"Progress"}),(0,s.jsxs)("span",{children:[S,"/",C.length]})]}),(0,s.jsx)(ec.Progress,{value:T,className:"h-1.5"})]}),p&&(0,s.jsxs)("div",{className:"rounded-lg border divide-y bg-card/50",children:[(0,s.jsx)(ey,{icon:em.FileSignature,iconColor:"text-blue-500",label:"NDA",doc:p.nda}),(0,s.jsx)(ey,{icon:D.FileText,iconColor:"text-purple-500",label:"Subscription Pack",doc:p.subscription_pack}),(p.certificate||e.is_active)&&(0,s.jsxs)("div",{className:"flex items-center gap-2.5 py-2 px-2.5",children:[(0,s.jsx)(ej.Award,{className:(0,h.cn)("w-4 h-4",p.certificate?.status==="available"?"text-amber-500":"text-muted-foreground")}),(0,s.jsx)("span",{className:"text-sm font-medium flex-1",children:"Certificate"}),p.certificate?.status==="available"?(0,s.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,s.jsx)(z.CheckCircle2,{className:"w-3.5 h-3.5 text-emerald-500"}),p.certificate.url&&(0,s.jsx)(i.Button,{size:"sm",variant:"ghost",className:"h-5 px-1.5",onClick:()=>window.open(p.certificate.url,"_blank"),children:(0,s.jsx)(k.Download,{className:"w-3 h-3"})})]}):(0,s.jsx)("span",{className:"text-xs text-muted-foreground",children:"Pending"})]})]}),(0,s.jsx)("div",{className:"pt-1",children:(0,s.jsxs)(i.Button,{variant:"outline",size:"sm",className:"w-full",onClick:()=>b(!0),disabled:!r,children:[(0,s.jsx)(eN.MessageSquare,{className:"w-4 h-4 mr-2"}),"Request Clarification"]})}),e.is_active&&(0,s.jsxs)("div",{className:"flex items-center gap-2.5 p-2.5 rounded-lg bg-emerald-50 dark:bg-emerald-900/20",children:[(0,s.jsx)(ex.Rocket,{className:"w-4 h-4 text-emerald-600"}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("div",{className:"text-sm font-medium text-emerald-700 dark:text-emerald-300",children:"Investment Active"}),(0,s.jsx)("div",{className:"text-xs text-emerald-600 dark:text-emerald-400",children:"Track in Portfolio"})]})]}),!p&&(0,s.jsxs)("div",{className:"flex items-center gap-2.5 p-3 rounded-lg bg-muted/30 text-muted-foreground",children:[(0,s.jsx)(D.FileText,{className:"w-4 h-4"}),(0,s.jsx)("span",{className:"text-sm",children:"Documents being prepared..."})]})]}),(0,s.jsx)(o.Dialog,{open:g,onOpenChange:b,children:(0,s.jsxs)(o.DialogContent,{className:"max-w-lg",children:[(0,s.jsxs)(o.DialogHeader,{children:[(0,s.jsx)(o.DialogTitle,{children:"Request Clarification"}),(0,s.jsx)(o.DialogDescription,{children:"Submit questions or clarification requests about the subscription pack."})]}),(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("label",{className:"text-sm font-medium",children:"Subject"}),(0,s.jsx)(u.Input,{value:j,onChange:e=>f(e.target.value),placeholder:"Subscription pack clarification"})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("label",{className:"text-sm font-medium",children:"Details"}),(0,s.jsx)(eb.Textarea,{value:N,onChange:e=>v(e.target.value),placeholder:"Share the exact sections or questions you need clarified...",rows:5})]})]}),(0,s.jsxs)(o.DialogFooter,{children:[(0,s.jsx)(i.Button,{variant:"outline",onClick:()=>b(!1),disabled:_,children:"Cancel"}),(0,s.jsx)(i.Button,{onClick:async()=>{if(r){if(!j.trim())return void y.toast.error("Please enter a subject for your clarification request.");if(!N.trim())return void y.toast.error("Please include details for your clarification request.");try{w(!0);let e=await fetch("/api/requests",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({category:"communication",subject:j.trim(),details:N.trim(),dealId:r})});if(!e.ok){let s=await e.json();throw Error(s.error||"Failed to submit clarification")}y.toast.success("Clarification request submitted."),v(""),b(!1)}catch(e){console.error("[SubscriptionStatusCard] Clarification error:",e),y.toast.error(e instanceof Error?e.message:"Failed to submit clarification")}finally{w(!1)}}},disabled:_,children:_?"Submitting...":"Submit"})]})]})})]})}var ew=e.i(396132),ek=e.i(401148),eC=e.i(501259),eS=e.i(682950),eD=e.i(619962),eT=e.i(550418),eA=e.i(880494);function eF(e,s="USD"){return e?new Intl.NumberFormat("en-US",{style:"currency",currency:s,minimumFractionDigits:0,maximumFractionDigits:0}).format(e):"-"}function eB(e){return e?new Date(e).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}):"-"}function eO(){let e=(0,a.useParams)(),h=(0,a.useRouter)(),p=(0,a.useSearchParams)(),g=e.id,b=p.get("action"),j=p.get("from"),{hasAnyPersona:f,isLoading:v,activePersona:y,error:_}=(0,eT.usePersona)(),[w,k]=(0,t.useState)(null),[S,D]=(0,t.useState)(!0),[T,A]=(0,t.useState)(null),[F,B]=(0,t.useState)(!1),[O,P]=(0,t.useState)(!1),[$,L]=(0,t.useState)(!1),[M,H]=(0,t.useState)(""),[V,G]=(0,t.useState)(!1),J=y?.persona_type==="partner",[Y,K]=(0,t.useState)(!1),[Q,Z]=(0,t.useState)(!1),[X,en]=(0,t.useState)(null),[ei,el]=(0,t.useState)(null),[ec,eo]=(0,t.useState)(null),{isProxyMode:eu,selectedClient:ex}=(0,eA.useProxyMode)();(0,t.useEffect)(()=>{let e=new AbortController,s=!1;async function t(){try{console.log(`[OpportunityDetail] Starting fetch for dealId: ${g}`),fetch(`/api/investors/me/opportunities/${g}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"view"}),cache:"no-store"}).catch(()=>{});let t=Date.now(),a=eu&&ex?.id?`&client_investor_id=${ex.id}`:"",r=await fetch(`/api/investors/me/opportunities/${g}?_t=${t}${a}`,{cache:"no-store",signal:e.signal,headers:{"Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache"}});if(s)return void console.log(`[OpportunityDetail] Fetch for ${g} was cancelled (user navigated away)`);let n=await r.json();if(!r.ok)throw Error(n.error||`Failed to fetch opportunity (${r.status})`);if(s)return void console.log(`[OpportunityDetail] Ignoring response for ${g} - request was cancelled`);console.log(`[OpportunityDetail] ✅ Setting state for: "${n.opportunity?.name}" (ID: ${n.opportunity?.id})`),n.opportunity?.id!==g&&console.error(`[OpportunityDetail] ⚠️ MISMATCH! URL has ${g} but API returned ${n.opportunity?.id}`),k(n.opportunity);let i=n.opportunity.is_tracking_only||J&&!n.opportunity.membership?.role;"subscribe"===b&&n.opportunity.can_subscribe&&!i&&L(!0)}catch(e){if("AbortError"===e.name)return void console.log(`[OpportunityDetail] Fetch aborted for ${g}`);s||(console.error("Error fetching opportunity:",e),A("Failed to load opportunity details"))}finally{s||D(!1)}}return k(null),A(null),D(!0),f&&g&&t(),()=>{console.log(`[OpportunityDetail] Cleanup: Cancelling fetch for ${g}`),s=!0,e.abort()}},[f,g,b,J,eu,ex?.id]);let eh=async()=>{try{G(!0);let e=await fetch(`/api/deals/${g}/interests`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({})});if(!e.ok){let s=await e.json().catch(()=>({}));throw Error(s.error||"Failed to submit interest")}let s=eu&&ex?.id?`?client_investor_id=${ex.id}`:"",t=await fetch(`/api/investors/me/opportunities/${g}${s}`),a=await t.json();k(a.opportunity),B(!1)}catch(e){console.error("Error expressing interest:",e)}finally{G(!1)}},ep=async()=>{if(M&&w)try{let e;if(G(!0),!(e=eu&&ex?.id?await fetch("/api/commercial-partners/proxy-subscribe",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({deal_id:g,client_investor_id:ex.id,commitment:parseFloat(M),stock_type:w.stock_type||"common",notes:"Submitted in proxy mode by commercial partner"})}):await fetch(`/api/deals/${g}/subscriptions`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({payload:{amount:parseFloat(M),currency:w.currency,bank_confirmation:!1},subscription_type:"personal"})})).ok){let s=await e.json();throw Error(s.error||"Failed to submit subscription")}await e.json();let s=eu&&ex?.id?`?client_investor_id=${ex.id}`:"",t=await fetch(`/api/investors/me/opportunities/${g}${s}`),a=await t.json();k(a.opportunity),L(!1),H(""),alert("Subscription submitted for review. The VERSO team will follow up shortly.")}catch(e){console.error("Error subscribing:",e),alert(e.message||"Failed to submit subscription")}finally{G(!1)}};if(v)return(0,s.jsxs)("div",{className:"p-6 space-y-6",children:[(0,s.jsx)(d.Skeleton,{className:"h-8 w-48"}),(0,s.jsx)(d.Skeleton,{className:"h-24 w-full"}),(0,s.jsx)(d.Skeleton,{className:"h-64 w-full"})]});if(!f)return(0,s.jsx)("div",{className:"p-6",children:(0,s.jsx)(n.Card,{className:"max-w-lg mx-auto",children:(0,s.jsxs)(n.CardHeader,{children:[(0,s.jsx)(n.CardTitle,{children:"Access Required"}),(0,s.jsx)(n.CardDescription,{children:"You need to be associated with an entity to view this opportunity."})]})})});if(S)return(0,s.jsxs)("div",{className:"p-6 space-y-6",children:[(0,s.jsx)(d.Skeleton,{className:"h-8 w-48"}),(0,s.jsx)(d.Skeleton,{className:"h-24 w-full"}),(0,s.jsx)(d.Skeleton,{className:"h-64 w-full"})]});if(T||!w)return(0,s.jsx)("div",{className:"p-6",children:(0,s.jsxs)(n.Card,{className:"max-w-lg mx-auto",children:[(0,s.jsxs)(n.CardHeader,{children:[(0,s.jsx)(n.CardTitle,{children:"Error"}),(0,s.jsx)(n.CardDescription,{children:T||"Opportunity not found"})]}),(0,s.jsx)(n.CardContent,{children:(0,s.jsxs)(i.Button,{onClick:()=>h.push("introductions"===j?"/versotech_main/introductions":"/versotech_main/opportunities"),children:[(0,s.jsx)(ew.ArrowLeft,{className:"w-4 h-4 mr-2"}),"introductions"===j?"Back to Introductions":"Back to Opportunities"]})})]})});let eb=!!w.is_tracking_only||J&&!w.membership?.role,ej=w.can_subscribe&&!eb,ef=w.can_express_interest&&!eb,ev=w.can_sign_nda&&!eb,ey="closed"!==w.status&&!w.subscription&&(ej||ef);return(0,s.jsxs)("div",{className:"p-6 space-y-6",children:[(0,s.jsxs)(i.Button,{variant:"ghost",onClick:()=>{"introductions"===j?h.push("/versotech_main/introductions"):h.back()},children:[(0,s.jsx)(ew.ArrowLeft,{className:"w-4 h-4 mr-2"}),"introductions"===j?"Back to Introductions":"Back"]}),eb?(0,s.jsxs)(n.Card,{children:[(0,s.jsx)(n.CardHeader,{className:"pb-2",children:(0,s.jsx)(n.CardTitle,{className:"text-sm font-medium text-muted-foreground",children:"Tracking Access"})}),(0,s.jsx)(n.CardContent,{children:(0,s.jsxs)("div",{className:"flex items-start gap-3 text-sm text-muted-foreground",children:[(0,s.jsx)(ek.AlertCircle,{className:"h-4 w-4 mt-0.5"}),(0,s.jsx)("span",{children:"This deal is available for tracking only. Contact your relationship manager for investor access."})]})})]}):(0,s.jsxs)(n.Card,{children:[(0,s.jsx)(n.CardHeader,{className:"pb-2",children:(0,s.jsx)(n.CardTitle,{className:"text-sm font-medium text-muted-foreground",children:"Investment Journey"})}),(0,s.jsx)(n.CardContent,{children:(0,s.jsx)(N,{summary:w.journey.summary,currentStage:w.journey.current_stage})})]}),(0,s.jsx)(W,{openAt:w.open_at,closeAt:w.close_at}),(0,s.jsxs)("div",{className:"flex items-start gap-6",children:[w.company_logo_url?(0,s.jsx)(r.default,{src:w.company_logo_url,alt:w.company_name||w.name,width:80,height:80,className:"rounded-xl object-cover"}):(0,s.jsx)("div",{className:"w-20 h-20 rounded-xl bg-gray-100 dark:bg-gray-800 flex items-center justify-center",children:(0,s.jsx)(ea.Building2,{className:"w-10 h-10 text-gray-400"})}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("h1",{className:"text-2xl font-bold",children:w.name}),w.company_name&&(0,s.jsx)("p",{className:"text-muted-foreground",children:w.company_name}),(0,s.jsxs)("div",{className:"flex flex-wrap gap-2 mt-2",children:[w.sector&&(0,s.jsxs)(l.Badge,{variant:"secondary",children:[(0,s.jsx)(er.TrendingUp,{className:"w-3 h-3 mr-1"}),w.sector]}),w.stage&&(0,s.jsx)(l.Badge,{variant:"outline",children:w.stage}),w.location&&(0,s.jsxs)(l.Badge,{variant:"outline",children:[(0,s.jsx)(et.MapPin,{className:"w-3 h-3 mr-1"}),w.location]}),w.stock_type&&(0,s.jsxs)(l.Badge,{variant:"outline",className:"border-purple-300 text-purple-700 dark:text-purple-300",children:[(0,s.jsx)(ee.Tag,{className:"w-3 h-3 mr-1"}),w.stock_type.replace(/_/g," ")]})]})]}),(0,s.jsxs)("div",{className:"flex flex-col gap-3 min-w-[280px]",children:[ey&&(0,s.jsxs)("div",{className:"space-y-3",children:[ej&&(0,s.jsx)("div",{className:"relative",children:(0,s.jsx)(i.Button,{className:"w-full bg-emerald-600 hover:bg-emerald-700 h-auto py-3",onClick:()=>L(!0),children:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(er.TrendingUp,{className:"w-5 h-5"}),(0,s.jsxs)("div",{className:"text-left",children:[(0,s.jsx)("div",{className:"font-semibold",children:"Subscribe to Investment"}),(0,s.jsx)("div",{className:"text-xs opacity-90 font-normal",children:"Submit for review • NDA + Subscription"})]})]})})}),ej&&ef&&(0,s.jsxs)("div",{className:"relative flex items-center gap-3",children:[(0,s.jsx)("div",{className:"flex-1 h-px bg-gray-200 dark:bg-gray-700"}),(0,s.jsx)("span",{className:"text-xs text-muted-foreground font-medium px-2",children:"OR"}),(0,s.jsx)("div",{className:"flex-1 h-px bg-gray-200 dark:bg-gray-700"})]}),ef&&w.access_controls?.can_view_data_room!==!1&&(0,s.jsx)(i.Button,{variant:"outline",className:"w-full h-auto py-3 border-dashed",onClick:()=>B(!0),children:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(I.FolderOpen,{className:"w-5 h-5 text-amber-600"}),(0,s.jsxs)("div",{className:"text-left",children:[(0,s.jsx)("div",{className:"font-medium",children:"Request Data Room Access"}),(0,s.jsx)("div",{className:"text-xs text-muted-foreground font-normal",children:"Review documents first"})]})]})})]}),ev&&(0,s.jsxs)(i.Button,{variant:"outline",onClick:()=>P(!0),children:[(0,s.jsx)(em.FileSignature,{className:"w-4 h-4 mr-2"}),"About NDA Signing"]}),w.subscription&&!w.subscription.is_active&&(0,s.jsxs)(l.Badge,{className:"justify-center py-2",variant:"outline",children:[(0,s.jsx)(U.Clock,{className:"w-4 h-4 mr-2"}),w.subscription.is_funded?"Awaiting Activation":w.subscription.is_signed?"Awaiting Funding":"Awaiting Signature"]}),w.subscription?.is_active&&(0,s.jsxs)(l.Badge,{className:"justify-center py-2 bg-emerald-500 text-white",children:[(0,s.jsx)(z.CheckCircle2,{className:"w-4 h-4 mr-2"}),"Active Investment"]}),(0,s.jsxs)(i.Button,{variant:"ghost",size:"sm",className:"text-muted-foreground hover:text-foreground",onClick:()=>h.push(`/versotech_main/inbox?deal=${w.id}&deal_name=${encodeURIComponent(w.name)}`),children:[(0,s.jsx)(eN.MessageSquare,{className:"w-4 h-4 mr-2"}),"Ask a Question"]})]})]}),(0,s.jsxs)(c.Tabs,{defaultValue:"overview",className:"space-y-4",children:[(0,s.jsxs)(c.TabsList,{children:[(0,s.jsx)(c.TabsTrigger,{value:"overview",children:"Overview"}),w.access_controls?.can_view_data_room!==!1&&(0,s.jsxs)(c.TabsTrigger,{value:"data-room",className:"relative",children:["Data Room",!w.data_room.has_access&&(0,s.jsx)(R.Lock,{className:"w-3 h-3 ml-1"})]}),(0,s.jsx)(c.TabsTrigger,{value:"faqs",children:"FAQs"})]}),(0,s.jsxs)(c.TabsContent,{value:"overview",className:"space-y-6",children:[(0,s.jsxs)("div",{className:"grid gap-6 lg:grid-cols-3",children:[w.subscription?(0,s.jsx)(e_,{subscription:w.subscription,dealCurrency:w.currency,dealId:w.id,dealName:w.name}):w.subscription_submission?(0,s.jsxs)(n.Card,{className:"border-2 border-dashed border-amber-200 bg-amber-50",children:[(0,s.jsx)(n.CardHeader,{className:"pb-3",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)(n.CardTitle,{className:"text-base flex items-center gap-2 text-amber-900",children:[(0,s.jsx)(U.Clock,{className:"h-5 w-5 text-amber-600"}),"Subscription Under Review"]}),(0,s.jsx)(l.Badge,{className:"bg-amber-200 text-amber-900 border-0",children:"Pending Review"})]})}),(0,s.jsx)(n.CardContent,{className:"text-sm text-amber-800",children:w.subscription_submission.submitted_at?`Submitted on ${eB(w.subscription_submission.submitted_at)}.`:"Submitted and awaiting CEO approval."})]}):(0,s.jsx)(eg,{currentStage:w.journey.current_stage,membership:w.membership,subscription:null,canExpressInterest:ef,canSignNda:ev,canSubscribe:ej,isTrackingOnly:eb,onExpressInterest:()=>B(!0),onSignNda:()=>P(!0),onSubscribe:()=>L(!0)}),(0,s.jsx)("div",{className:"lg:col-span-2",children:(0,s.jsx)(ed,{dealType:w.deal_type||"N/A",currency:w.currency,stockType:w.stock_type,sector:w.sector,location:w.location,vehicleName:w.vehicle?.name||null,stage:w.stage,round:w.deal_round})})]}),(0,s.jsxs)("div",{className:"grid gap-6 md:grid-cols-2",children:[(0,s.jsxs)(n.Card,{children:[(0,s.jsx)(n.CardHeader,{children:(0,s.jsx)(n.CardTitle,{children:"Investment Details"})}),(0,s.jsx)(n.CardContent,{children:(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(x.Label,{className:"text-muted-foreground",children:"Target Raise"}),(0,s.jsx)("p",{className:"font-medium",children:eF(w.target_amount,w.currency)})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(x.Label,{className:"text-muted-foreground",children:"Raised"}),(0,s.jsx)("p",{className:"font-medium",children:eF(w.raised_amount,w.currency)})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(x.Label,{className:"text-muted-foreground",children:"Min Investment"}),(0,s.jsx)("p",{className:"font-medium",children:eF(w.minimum_investment,w.currency)})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(x.Label,{className:"text-muted-foreground",children:"Max Investment"}),(0,s.jsx)("p",{className:"font-medium",children:eF(w.maximum_investment,w.currency)})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(x.Label,{className:"text-muted-foreground",children:"Closing Date"}),(0,s.jsx)("p",{className:"font-medium",children:eB(w.close_at)})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(x.Label,{className:"text-muted-foreground",children:"Deal Type"}),(0,s.jsx)("p",{className:"font-medium",children:w.deal_type||"-"})]})]})})]}),(0,s.jsxs)(n.Card,{children:[(0,s.jsx)(n.CardHeader,{children:(0,s.jsx)(n.CardTitle,{children:"Company Information"})}),(0,s.jsxs)(n.CardContent,{className:"space-y-4",children:[w.description&&(0,s.jsxs)("div",{children:[(0,s.jsx)(x.Label,{className:"text-muted-foreground",children:"Description"}),(0,s.jsx)("p",{className:"mt-1",children:w.description})]}),w.investment_thesis&&(0,s.jsxs)("div",{children:[(0,s.jsx)(x.Label,{className:"text-muted-foreground",children:"Investment Thesis"}),(0,s.jsx)("p",{className:"mt-1",children:w.investment_thesis})]}),w.company_website&&(0,s.jsxs)("div",{children:[(0,s.jsx)(x.Label,{className:"text-muted-foreground",children:"Website"}),(0,s.jsxs)("a",{href:w.company_website,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-1 text-blue-600 hover:underline mt-1",children:[(0,s.jsx)(es.Globe,{className:"w-4 h-4"}),w.company_website,(0,s.jsx)(C.ExternalLink,{className:"w-3 h-3"})]})]})]})]})]}),w.access_controls?.can_view_term_sheet!==!1&&w.fee_structures.length>0&&(()=>{let e=w.fee_structures.find(e=>"published"===e.status)||w.fee_structures[0];if(!e)return null;let t=async()=>{if(!e.term_sheet_attachment_key)return;let s=e.term_sheet_attachment_key.split("/").pop()||"Term Sheet.pdf";eo({id:e.id,file_name:s,name:s,mime_type:"application/pdf",type:"term_sheet"}),K(!0),Z(!0),el(null),en(null);try{let s=await fetch(`/api/deals/${w.id}/fee-structures/${e.id}/attachment`),t=await s.json();if(!s.ok)throw Error(t.error||"Failed to load preview");en(t.url)}catch(e){console.error("Error loading term sheet preview:",e),el(e instanceof Error?e.message:"Failed to load preview")}finally{Z(!1)}},a=e.transaction_type||e.structure||e.issuer||e.vehicle||e.exclusive_arranger||e.purchaser||e.seller||e.legal_counsel,r=e.interest_confirmation_deadline||e.validity_date||e.completion_date||e.completion_date_text,l=null!==e.subscription_fee_percent||null!==e.management_fee_percent||null!==e.carried_interest_percent;return(0,s.jsxs)(n.Card,{className:"border-2",children:[(0,s.jsx)(n.CardHeader,{className:"pb-4",children:(0,s.jsxs)("div",{className:"flex items-start justify-between",children:[(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)(n.CardTitle,{className:"text-xl",children:"Term Sheet"}),(e.term_sheet_date||e.version)&&(0,s.jsxs)(n.CardDescription,{className:"text-sm",children:[e.term_sheet_date&&eB(e.term_sheet_date),e.term_sheet_date&&e.version&&" • ",e.version&&`Version ${e.version}`]})]}),e.term_sheet_attachment_key&&(0,s.jsxs)(i.Button,{onClick:t,size:"sm",className:"gap-2",children:[(0,s.jsx)(q.Eye,{className:"w-4 h-4"}),"Preview PDF"]})]})}),(0,s.jsxs)(n.CardContent,{className:"space-y-8",children:[e.price_per_share_text&&(0,s.jsxs)("div",{className:"text-center py-6 px-4 rounded-xl bg-gradient-to-br from-emerald-50 to-teal-50 dark:from-emerald-950/50 dark:to-teal-950/50 border border-emerald-200 dark:border-emerald-800",children:[(0,s.jsx)("div",{className:"text-sm font-medium text-emerald-600 dark:text-emerald-400 mb-1",children:"Price Per Share"}),(0,s.jsx)("div",{className:"text-3xl font-bold text-emerald-700 dark:text-emerald-300",children:e.price_per_share_text})]}),(e.term_sheet_html||e.opportunity_summary)&&(0,s.jsxs)("div",{children:[(0,s.jsx)("h4",{className:"text-sm font-semibold text-muted-foreground mb-3",children:"Opportunity Summary"}),(0,s.jsx)("div",{className:"prose prose-sm dark:prose-invert max-w-none",children:e.term_sheet_html?(0,s.jsx)("div",{dangerouslySetInnerHTML:{__html:e.term_sheet_html}}):(0,s.jsx)("p",{className:"whitespace-pre-wrap text-foreground/80",children:e.opportunity_summary})})]}),(e.allocation_up_to||e.minimum_ticket)&&(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[e.allocation_up_to&&(0,s.jsxs)("div",{className:"text-center p-4 rounded-lg bg-muted/50",children:[(0,s.jsxs)("div",{className:"text-xs text-muted-foreground mb-1",children:["Allocation (",w.currency,")"]}),(0,s.jsx)("div",{className:"text-lg font-semibold",children:eF(e.allocation_up_to,w.currency)})]}),e.minimum_ticket&&(0,s.jsxs)("div",{className:"text-center p-4 rounded-lg bg-muted/50",children:[(0,s.jsx)("div",{className:"text-xs text-muted-foreground mb-1",children:"Min. Ticket"}),(0,s.jsx)("div",{className:"text-lg font-semibold",children:eF(e.minimum_ticket,w.currency)})]})]}),l&&(0,s.jsxs)("div",{children:[(0,s.jsx)("h4",{className:"text-sm font-semibold text-muted-foreground mb-3",children:"Fee Structure"}),(0,s.jsxs)("div",{className:"grid grid-cols-3 gap-4",children:[null!==e.subscription_fee_percent&&(0,s.jsxs)("div",{className:"p-4 rounded-lg border bg-card",children:[(0,s.jsx)("div",{className:"text-xs text-muted-foreground",children:"Subscription Fee"}),(0,s.jsxs)("div",{className:"text-2xl font-bold mt-1",children:[e.subscription_fee_percent,"%"]})]}),null!==e.management_fee_percent&&(0,s.jsxs)("div",{className:"p-4 rounded-lg border bg-card",children:[(0,s.jsx)("div",{className:"text-xs text-muted-foreground",children:"Management Fee"}),(0,s.jsxs)("div",{className:"text-2xl font-bold mt-1",children:[e.management_fee_percent,"%"]}),(0,s.jsx)("div",{className:"text-xs text-muted-foreground",children:"per annum"}),e.management_fee_clause&&(0,s.jsx)("p",{className:"text-xs text-muted-foreground mt-2 border-t pt-2",children:e.management_fee_clause})]}),null!==e.carried_interest_percent&&(0,s.jsxs)("div",{className:"p-4 rounded-lg border bg-card",children:[(0,s.jsx)("div",{className:"text-xs text-muted-foreground",children:"Carried Interest"}),(0,s.jsxs)("div",{className:"text-2xl font-bold mt-1",children:[e.carried_interest_percent,"%"]}),e.performance_fee_clause&&(0,s.jsx)("p",{className:"text-xs text-muted-foreground mt-2 border-t pt-2",children:e.performance_fee_clause})]})]})]}),a&&(0,s.jsxs)("div",{children:[(0,s.jsx)("h4",{className:"text-sm font-semibold text-muted-foreground mb-3",children:"Transaction Details"}),(0,s.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-x-6 gap-y-4",children:[e.transaction_type&&(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-xs text-muted-foreground",children:"Type"}),(0,s.jsx)("div",{className:"font-medium",children:e.transaction_type})]}),e.structure&&(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-xs text-muted-foreground",children:"Structure"}),(0,s.jsx)("div",{className:"font-medium",children:e.structure})]}),e.issuer&&(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-xs text-muted-foreground",children:"Issuer"}),(0,s.jsx)("div",{className:"font-medium",children:e.issuer})]}),e.vehicle&&(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-xs text-muted-foreground",children:"Vehicle"}),(0,s.jsx)("div",{className:"font-medium",children:e.vehicle})]}),e.exclusive_arranger&&(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-xs text-muted-foreground",children:"Arranger"}),(0,s.jsx)("div",{className:"font-medium",children:e.exclusive_arranger})]}),e.purchaser&&(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-xs text-muted-foreground",children:"Purchaser"}),(0,s.jsx)("div",{className:"font-medium",children:e.purchaser})]}),e.seller&&(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-xs text-muted-foreground",children:"Seller"}),(0,s.jsx)("div",{className:"font-medium",children:e.seller})]}),e.legal_counsel&&(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-xs text-muted-foreground",children:"Legal Counsel"}),(0,s.jsx)("div",{className:"font-medium",children:e.legal_counsel})]})]})]}),r&&(0,s.jsxs)("div",{children:[(0,s.jsx)("h4",{className:"text-sm font-semibold text-muted-foreground mb-3",children:"Timeline"}),(0,s.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:[e.interest_confirmation_deadline&&(0,s.jsxs)("div",{className:"p-3 rounded-lg bg-amber-50 dark:bg-amber-950/30 border border-amber-200 dark:border-amber-800",children:[(0,s.jsx)("div",{className:"text-xs font-medium text-amber-600 dark:text-amber-400",children:"Interest Deadline"}),(0,s.jsx)("div",{className:"font-semibold text-amber-700 dark:text-amber-300 mt-1",children:eB(e.interest_confirmation_deadline)})]}),e.validity_date&&(0,s.jsxs)("div",{className:"p-3 rounded-lg bg-muted/50",children:[(0,s.jsx)("div",{className:"text-xs text-muted-foreground",children:"Valid Until"}),(0,s.jsx)("div",{className:"font-medium mt-1",children:eB(e.validity_date)})]}),(e.completion_date||e.completion_date_text)&&(0,s.jsxs)("div",{className:"p-3 rounded-lg bg-muted/50",children:[(0,s.jsx)("div",{className:"text-xs text-muted-foreground",children:"Completion"}),(0,s.jsx)("div",{className:"font-medium mt-1",children:e.completion_date?eB(e.completion_date):e.completion_date_text})]})]})]})]})]})})(),w.signatories.length>0&&(0,s.jsxs)(n.Card,{children:[(0,s.jsxs)(n.CardHeader,{children:[(0,s.jsxs)(n.CardTitle,{className:"flex items-center gap-2",children:[(0,s.jsx)(eC.Users,{className:"w-5 h-5"}),"Authorized Signatories"]}),(0,s.jsx)(n.CardDescription,{children:"These signatories will need to sign the NDA and subscription documents"})]}),(0,s.jsx)(n.CardContent,{children:(0,s.jsx)("div",{className:"space-y-3",children:w.signatories.map(e=>(0,s.jsxs)("div",{className:"flex items-center gap-3 p-3 rounded-lg bg-gray-50 dark:bg-gray-800",children:[(0,s.jsx)("div",{className:"w-10 h-10 rounded-full bg-gray-200 dark:bg-gray-700 flex items-center justify-center",children:(0,s.jsx)(eC.Users,{className:"w-5 h-5 text-gray-500"})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"font-medium",children:e.full_name}),(0,s.jsx)("div",{className:"text-sm text-muted-foreground",children:e.email})]})]},e.id))})})]})]}),w.access_controls?.can_view_data_room!==!1&&(0,s.jsxs)(c.TabsContent,{value:"data-room",className:"space-y-4",children:[w.data_room.has_access&&w.data_room.access_details&&(0,s.jsx)(n.Card,{children:(0,s.jsx)(n.CardContent,{className:"py-4",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[(0,s.jsx)(z.CheckCircle2,{className:"w-4 h-4 text-emerald-500"}),"Access granted: ",eB(w.data_room.access_details.granted_at),w.access_controls?.has_auto_data_room_access&&(0,s.jsx)("span",{className:"ml-2 text-xs bg-emerald-100 text-emerald-700 px-2 py-0.5 rounded-full",children:"Auto-granted (Arranger)"})]}),w.data_room.access_details.expires_at&&(0,s.jsxs)("div",{className:"flex items-center gap-2 text-sm text-amber-600",children:[(0,s.jsx)(U.Clock,{className:"w-4 h-4"}),"Expires: ",eB(w.data_room.access_details.expires_at)]})]})})}),(0,s.jsx)(E,{documents:w.data_room.documents,hasAccess:w.data_room.has_access,requiresNda:w.data_room.requires_nda,dealId:w.id,onRequestAccess:w.can_sign_nda?()=>P(!0):void 0})]}),(0,s.jsx)(c.TabsContent,{value:"faqs",className:"space-y-4",children:0===w.faqs.length?(0,s.jsx)(n.Card,{children:(0,s.jsxs)(n.CardContent,{className:"py-12 text-center",children:[(0,s.jsx)(eS.HelpCircle,{className:"w-12 h-12 mx-auto text-muted-foreground mb-4"}),(0,s.jsx)("h3",{className:"text-lg font-medium mb-2",children:"No FAQs Available"}),(0,s.jsx)("p",{className:"text-muted-foreground",children:"Frequently asked questions will be added by the deal team."})]})}):(0,s.jsxs)(n.Card,{children:[(0,s.jsx)(n.CardHeader,{children:(0,s.jsx)(n.CardTitle,{children:"Frequently Asked Questions"})}),(0,s.jsx)(n.CardContent,{children:(0,s.jsx)(m.Accordion,{type:"single",collapsible:!0,className:"w-full",children:w.faqs.map((e,t)=>(0,s.jsxs)(m.AccordionItem,{value:`faq-${t}`,children:[(0,s.jsx)(m.AccordionTrigger,{children:e.question}),(0,s.jsx)(m.AccordionContent,{children:e.answer})]},e.id))})})]})})]}),(0,s.jsx)(o.Dialog,{open:F,onOpenChange:B,children:(0,s.jsxs)(o.DialogContent,{className:"sm:max-w-md",children:[(0,s.jsxs)(o.DialogHeader,{children:[(0,s.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,s.jsx)("div",{className:"flex h-10 w-10 items-center justify-center rounded-full bg-amber-100 dark:bg-amber-900/30",children:(0,s.jsx)(I.FolderOpen,{className:"h-5 w-5 text-amber-600"})}),(0,s.jsx)(o.DialogTitle,{className:"text-lg",children:"Request Data Room Access"})]}),(0,s.jsxs)(o.DialogDescription,{className:"text-left",children:["Submit your interest to access the data room for ",w.name,"."]})]}),(0,s.jsx)("div",{className:"py-4",children:(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsxs)("div",{className:"flex items-start gap-3 text-sm",children:[(0,s.jsx)("div",{className:"flex h-6 w-6 shrink-0 items-center justify-center rounded-full bg-blue-100 dark:bg-blue-900/30 text-blue-600 text-xs font-medium",children:"1"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"font-medium",children:"Submit Interest"}),(0,s.jsx)("div",{className:"text-muted-foreground",children:"Team reviews your request"})]})]}),(0,s.jsxs)("div",{className:"flex items-start gap-3 text-sm",children:[(0,s.jsx)("div",{className:"flex h-6 w-6 shrink-0 items-center justify-center rounded-full bg-blue-100 dark:bg-blue-900/30 text-blue-600 text-xs font-medium",children:"2"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"font-medium",children:"Sign NDA"}),(0,s.jsx)("div",{className:"text-muted-foreground",children:"All signatories sign the NDA"})]})]}),(0,s.jsxs)("div",{className:"flex items-start gap-3 text-sm",children:[(0,s.jsx)("div",{className:"flex h-6 w-6 shrink-0 items-center justify-center rounded-full bg-emerald-100 dark:bg-emerald-900/30 text-emerald-600 text-xs font-medium",children:"3"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"font-medium",children:"Access Data Room"}),(0,s.jsx)("div",{className:"text-muted-foreground",children:"7-day access to all documents"})]})]})]})}),(0,s.jsxs)(o.DialogFooter,{className:"gap-2 sm:gap-0",children:[(0,s.jsx)(i.Button,{variant:"outline",onClick:()=>B(!1),children:"Cancel"}),(0,s.jsx)(i.Button,{onClick:eh,disabled:V,className:"gap-2",children:V?"Processing...":(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(I.FolderOpen,{className:"w-4 h-4"}),"Submit Interest"]})})]})]})}),(0,s.jsx)(o.Dialog,{open:O,onOpenChange:P,children:(0,s.jsxs)(o.DialogContent,{children:[(0,s.jsxs)(o.DialogHeader,{children:[(0,s.jsx)(o.DialogTitle,{children:"NDA Signing Process"}),(0,s.jsx)(o.DialogDescription,{children:"The NDA will be sent to you automatically once your interest is approved."})]}),(0,s.jsxs)("div",{className:"py-4 space-y-4",children:[(0,s.jsx)("div",{className:"p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:(0,s.jsxs)("div",{className:"flex items-start gap-3",children:[(0,s.jsx)(z.CheckCircle2,{className:"w-5 h-5 text-blue-600 mt-0.5"}),(0,s.jsxs)("div",{className:"text-sm",children:[(0,s.jsx)("p",{className:"font-medium text-blue-800 dark:text-blue-200",children:"Automatic NDA Generation"}),(0,s.jsxs)("p",{className:"text-blue-700 dark:text-blue-300 mt-1",children:["Once your interest is approved by the VERSO team, each authorized signatory (",w.signatories.length,") will receive their own NDA document to sign."]})]})]})}),(0,s.jsx)("div",{className:"p-4 bg-amber-50 dark:bg-amber-900/20 rounded-lg",children:(0,s.jsxs)("div",{className:"flex items-start gap-3",children:[(0,s.jsx)(ek.AlertCircle,{className:"w-5 h-5 text-amber-600 mt-0.5"}),(0,s.jsxs)("div",{className:"text-sm",children:[(0,s.jsx)("p",{className:"font-medium text-amber-800 dark:text-amber-200",children:"Multi-Signatory Required"}),(0,s.jsxs)("p",{className:"text-amber-700 dark:text-amber-300 mt-1",children:["Data room access will be granted only after ",(0,s.jsx)("strong",{children:"all signatories"})," have completed signing their individual NDAs."]})]})]})})]}),(0,s.jsx)(o.DialogFooter,{children:(0,s.jsx)(i.Button,{onClick:()=>P(!1),children:"Got it"})})]})}),(0,s.jsx)(o.Dialog,{open:$,onOpenChange:L,children:(0,s.jsxs)(o.DialogContent,{children:[(0,s.jsxs)(o.DialogHeader,{children:[(0,s.jsx)(o.DialogTitle,{children:"Subscribe to Investment Opportunity"}),(0,s.jsxs)(o.DialogDescription,{children:["Enter your commitment amount to submit a subscription request for ",w.name,". Once reviewed, you'll receive the NDA and subscription documents to sign."]})]}),(0,s.jsxs)("div",{className:"py-4 space-y-4",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)(x.Label,{htmlFor:"amount",children:["Commitment Amount (",w.currency,")"]}),(0,s.jsx)(u.Input,{id:"amount",type:"number",placeholder:`Min: ${eF(w.minimum_investment,w.currency)}`,value:M,onChange:e=>H(e.target.value)}),w.minimum_investment&&w.maximum_investment&&(0,s.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Range: ",eF(w.minimum_investment,w.currency)," - ",eF(w.maximum_investment,w.currency)]})]}),w.signatories.length>0&&(0,s.jsx)("div",{className:"p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:(0,s.jsxs)("div",{className:"flex items-start gap-3",children:[(0,s.jsx)(em.FileSignature,{className:"w-5 h-5 text-blue-600 mt-0.5"}),(0,s.jsxs)("div",{className:"text-sm",children:[(0,s.jsxs)("p",{className:"font-medium text-blue-800 dark:text-blue-200",children:[w.signatories.length," Signatory(ies) Required"]}),(0,s.jsx)("p",{className:"text-blue-700 dark:text-blue-300 mt-1",children:"Both NDA and Subscription Pack will be sent to all authorized signatories."}),(0,s.jsx)("p",{className:"text-amber-600 dark:text-amber-400 mt-2 text-xs",children:"Note: This request does not include data room access."})]})]})})]}),(0,s.jsxs)(o.DialogFooter,{children:[(0,s.jsx)(i.Button,{variant:"outline",onClick:()=>L(!1),children:"Cancel"}),(0,s.jsx)(i.Button,{onClick:ep,disabled:V||!M||null!==w.minimum_investment&&parseFloat(M)<w.minimum_investment,children:V?"Processing...":"Subscribe"})]})]})}),(0,s.jsx)(eD.DocumentViewerFullscreen,{isOpen:Y,document:ec,previewUrl:X,isLoading:Q,error:ei,onClose:()=>{K(!1),en(null),el(null),eo(null)},onDownload:()=>{X&&window.open(X,"_blank")}})]})}e.i(990018),e.s(["default",()=>eO],292959)}]);