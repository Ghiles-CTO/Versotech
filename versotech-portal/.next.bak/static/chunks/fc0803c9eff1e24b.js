(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,196767,e=>{"use strict";let a=(0,e.i(410587).default)("dollar-sign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]);e.s(["DollarSign",()=>a],196767)},816654,e=>{"use strict";var a=e.i(722679),t=e.i(340915),s=e.i(282141);let r=t.forwardRef(({className:e,...t},r)=>(0,a.jsx)("textarea",{className:(0,s.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:border-ring disabled:cursor-not-allowed disabled:opacity-50",e),ref:r,...t}));r.displayName="Textarea",e.s(["Textarea",()=>r])},90613,e=>{"use strict";var a=e.i(722679),t=e.i(282141);function s({className:e,...s}){return(0,a.jsx)("div",{"data-slot":"card",className:(0,t.cn)("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",e),...s})}function r({className:e,...s}){return(0,a.jsx)("div",{"data-slot":"card-header",className:(0,t.cn)("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-1.5 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",e),...s})}function c({className:e,...s}){return(0,a.jsx)("div",{"data-slot":"card-title",className:(0,t.cn)("leading-none font-semibold",e),...s})}function n({className:e,...s}){return(0,a.jsx)("div",{"data-slot":"card-description",className:(0,t.cn)("text-muted-foreground text-sm",e),...s})}function i({className:e,...s}){return(0,a.jsx)("div",{"data-slot":"card-content",className:(0,t.cn)("px-6",e),...s})}function l({className:e,...s}){return(0,a.jsx)("div",{"data-slot":"card-footer",className:(0,t.cn)("flex items-center px-6 [.border-t]:pt-6",e),...s})}e.s(["Card",()=>s,"CardContent",()=>i,"CardDescription",()=>n,"CardFooter",()=>l,"CardHeader",()=>r,"CardTitle",()=>c])},15098,e=>{"use strict";let a=(0,e.i(410587).default)("circle-check",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);e.s(["CheckCircle2",()=>a],15098)},790742,e=>{"use strict";var a=e.i(722679),t=e.i(340915),s=e.i(603274),r=e.i(820417),c=e.i(994500),n=e.i(90613),i=e.i(316264),l=e.i(129432),d=e.i(514133),o=e.i(191569),m=e.i(816654),x=e.i(538892),h=e.i(396132),u=e.i(15098),f=e.i(401148),j=e.i(310556),g=e.i(432598),p=e.i(410587);let b=(0,p.default)("link",[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]]),N=(0,p.default)("unlink",[["path",{d:"m18.84 12.25 1.72-1.71h-.02a5.004 5.004 0 0 0-.12-7.07 5.006 5.006 0 0 0-6.95 0l-1.72 1.71",key:"yqzxt4"}],["path",{d:"m5.17 11.75-1.71 1.71a5.004 5.004 0 0 0 .12 7.07 5.006 5.006 0 0 0 6.95 0l1.71-1.71",key:"4qinb0"}],["line",{x1:"8",x2:"8",y1:"2",y2:"5",key:"1041cp"}],["line",{x1:"2",x2:"5",y1:"8",y2:"8",key:"14m1p5"}],["line",{x1:"16",x2:"16",y1:"19",y2:"22",key:"rzdirn"}],["line",{x1:"19",x2:"22",y1:"16",y2:"16",key:"ox905f"}]]);var v=e.i(704477),y=e.i(196767),C=e.i(84065),w=e.i(119311);let _=e=>{if(null==e)return 0;if("number"==typeof e)return e;let a=parseFloat(e);return Number.isNaN(a)?0:a},k=(e,a="USD")=>new Intl.NumberFormat("en-US",{style:"currency",currency:a,minimumFractionDigits:2,maximumFractionDigits:2}).format(e);function S({transaction:e,openInvoices:p,staffProfile:S}){var T;let M,D,L=(0,s.useRouter)(),[F,A]=(0,t.useState)(!1),[R,U]=(0,t.useState)(""),[B,I]=(0,t.useState)(""),[O,H]=(0,t.useState)(""),z=(0,t.useMemo)(()=>(e.matches||[]).filter(e=>"approved"===e.status),[e]),P=(0,t.useMemo)(()=>e.suggestions||[],[e]),q=(0,t.useMemo)(()=>z.reduce((e,a)=>e+_(a.matched_amount),0),[z]),E=_(e.amount),$=Math.max(E-q,0),J=(0,t.useMemo)(()=>p.find(e=>e.id===R)||null,[p,R]);(0,t.useEffect)(()=>{if(!J)return void I("");let e=Math.min(null!==J.balance_due&&void 0!==J.balance_due?_(J.balance_due):Math.max(_(J.total)-_(J.paid_amount),0),$);I(e>.01?e.toFixed(2):"")},[J,$]);let V=async e=>{A(!0);try{let a=await fetch("/api/staff/reconciliation/match/accept",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({suggested_match_id:e})}),t=await a.json();if(!a.ok)throw Error(t.error||"Failed to accept match");c.toast.success("Match accepted successfully - reloading..."),setTimeout(()=>{window.location.reload()},500)}catch(e){c.toast.error(e.message||"Failed to accept match"),A(!1)}},K=async e=>{A(!0);try{let a=await fetch("/api/staff/reconciliation/match/reject",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({suggested_match_id:e})}),t=await a.json();if(!a.ok)throw Error(t.error||"Failed to reject match");c.toast.success("Suggestion rejected successfully"),window.location.href=window.location.href}catch(e){c.toast.error(e.message||"Failed to reject match"),A(!1)}},X=async()=>{if(!R)return void c.toast.error("Please select an invoice");let a={bank_transaction_id:e.id,invoice_id:R};if(B){let e=parseFloat(B);if(Number.isNaN(e)||e<=0)return void c.toast.error("Enter a valid match amount");a.matched_amount=e}O.trim()&&(a.notes=O.trim()),A(!0);try{let e=await fetch("/api/staff/reconciliation/match/manual",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}),t=await e.json();if(!e.ok)throw Error(t.error||"Failed to create manual match");c.toast.success("Manual match created successfully"),U(""),H(""),L.refresh()}catch(e){c.toast.error(e.message||"Failed to create manual match")}finally{A(!1)}},G=async a=>{if(confirm(a?"Unmatch this invoice from the transaction?":"Unmatch all invoices from this transaction?")){A(!0);try{let t=await fetch("/api/staff/reconciliation/unmatch",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({bank_transaction_id:e.id,match_id:a})}),s=await t.json();if(!t.ok)throw Error(s.error||"Failed to unmatch transaction");c.toast.success(s.message||"Unmatched successfully"),L.refresh()}catch(e){c.toast.error(e.message||"Failed to unmatch transaction")}finally{A(!1)}}};return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsx)(r.default,{href:"/versotech_main/reconciliation",children:(0,a.jsx)(i.Button,{variant:"ghost",size:"icon",children:(0,a.jsx)(h.ArrowLeft,{className:"h-4 w-4"})})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-foreground",children:"Transaction Details"}),(0,a.jsx)("p",{className:"text-muted-foreground mt-1",children:e.bank_reference||e.id})]})]}),(0,a.jsxs)("div",{className:"flex gap-2 items-center",children:[(T=e.status,D=(M={matched:{color:"bg-emerald-900/30 text-emerald-300 border-emerald-700",label:"Matched"},partially_matched:{color:"bg-amber-900/30 text-amber-300 border-amber-700",label:"Partially Matched"},unmatched:{color:"bg-slate-800/50 text-slate-300 border-slate-700",label:"Unmatched"}})[T]||M.unmatched,(0,a.jsxs)(l.Badge,{className:`${D.color} gap-1.5`,children:[(0,a.jsx)(u.CheckCircle2,{className:"h-3 w-3"}),D.label]})),e.match_confidence&&(0,a.jsxs)(l.Badge,{className:e.match_confidence>=80?"bg-emerald-900/30 text-emerald-300 border-emerald-700":e.match_confidence>=60?"bg-amber-900/30 text-amber-300 border-amber-700":"bg-rose-900/30 text-rose-300 border-rose-700",children:[e.match_confidence,"% confidence"]})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,a.jsxs)("div",{className:"lg:col-span-2 space-y-6",children:[(0,a.jsxs)(n.Card,{children:[(0,a.jsx)(n.CardHeader,{children:(0,a.jsxs)(n.CardTitle,{className:"flex items-center gap-2",children:[(0,a.jsx)(y.DollarSign,{className:"h-5 w-5"}),"Transaction Information"]})}),(0,a.jsxs)(n.CardContent,{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(d.Label,{className:"text-muted-foreground text-xs",children:"Amount"}),(0,a.jsx)("div",{className:"text-2xl font-bold text-foreground",children:k(E,e.currency)})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(d.Label,{className:"text-muted-foreground text-xs",children:"Value Date"}),(0,a.jsxs)("div",{className:"text-lg font-medium text-foreground flex items-center gap-2",children:[(0,a.jsx)(C.Calendar,{className:"h-4 w-4"}),new Date(e.value_date).toLocaleDateString()]})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(d.Label,{className:"text-muted-foreground text-xs",children:"Counterparty"}),(0,a.jsxs)("div",{className:"text-lg font-medium text-foreground flex items-center gap-2",children:[(0,a.jsx)(v.User,{className:"h-4 w-4"}),e.counterparty||"—"]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(d.Label,{className:"text-muted-foreground text-xs",children:"Remaining Amount"}),(0,a.jsx)("div",{className:"text-lg font-medium text-amber-200",children:$>.01?k($,e.currency):"Fully allocated"})]})]}),e.memo&&(0,a.jsxs)("div",{children:[(0,a.jsx)(d.Label,{className:"text-muted-foreground text-xs",children:"Memo"}),(0,a.jsxs)("div",{className:"text-sm text-foreground flex items-start gap-2",children:[(0,a.jsx)(w.FileText,{className:"h-4 w-4 mt-0.5"}),e.memo]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(d.Label,{className:"text-muted-foreground text-xs",children:"Account Reference"}),(0,a.jsx)("div",{className:"text-sm font-mono text-foreground",children:e.account_ref||"—"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(d.Label,{className:"text-muted-foreground text-xs",children:"Bank Reference"}),(0,a.jsx)("div",{className:"text-sm font-mono text-foreground",children:e.bank_reference||"—"})]})]})]})]}),(0,a.jsxs)(n.Card,{children:[(0,a.jsxs)(n.CardHeader,{className:"flex flex-row items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)(n.CardTitle,{className:"flex items-center gap-2",children:[(0,a.jsx)(b,{className:"h-5 w-5 text-emerald-300"}),"Approved Matches"]}),(0,a.jsx)(n.CardDescription,{children:z.length>0?`${z.length} invoice${1===z.length?"":"s"} matched`:"No invoices matched yet"})]}),z.length>0&&(0,a.jsxs)(i.Button,{variant:"outline",size:"sm",onClick:()=>G(),disabled:F,children:[(0,a.jsx)(N,{className:"h-4 w-4 mr-2"}),"Unmatch All"]})]}),(0,a.jsxs)(n.CardContent,{className:"space-y-4",children:[0===z.length&&(0,a.jsx)("div",{className:"text-sm text-muted-foreground",children:"No matches yet. Accept a suggestion or create a manual match."}),z.map(t=>{let s=t.invoices,r=s?.currency||e.currency||"USD",c=s?.invoice_number||s?.id?.slice(0,8),l=s?.investor?.legal_name,o=s?.deal?.name;return(0,a.jsxs)(n.Card,{className:"border-emerald-800/40 bg-emerald-950/10",children:[(0,a.jsxs)(n.CardHeader,{className:"flex flex-row items-center justify-between space-y-0",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)(n.CardTitle,{className:"flex items-center gap-2 text-base",children:[(0,a.jsx)(b,{className:"h-4 w-4 text-emerald-300"}),c]}),(0,a.jsxs)(n.CardDescription,{children:[l||"Investor"," ",o?`• ${o}`:""]})]}),(0,a.jsxs)(i.Button,{variant:"ghost",size:"sm",className:"text-rose-300 hover:text-rose-200",onClick:()=>G(t.id),disabled:F,children:[(0,a.jsx)(N,{className:"h-4 w-4 mr-2"}),"Unmatch"]})]}),(0,a.jsxs)(n.CardContent,{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(d.Label,{className:"text-muted-foreground text-xs",children:"Matched Amount"}),(0,a.jsx)("div",{className:"text-sm font-semibold text-foreground",children:k(_(t.matched_amount),r)})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(d.Label,{className:"text-muted-foreground text-xs",children:"Invoice Total"}),(0,a.jsx)("div",{className:"text-sm text-muted-foreground",children:k(_(s?.total),r)})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(d.Label,{className:"text-muted-foreground text-xs",children:"Status"}),(0,a.jsx)("div",{className:"text-xs capitalize text-emerald-200",children:t.match_type.replace("_"," ")})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(d.Label,{className:"text-muted-foreground text-xs",children:"Reason"}),(0,a.jsx)("div",{className:"text-xs text-muted-foreground line-clamp-2",children:t.match_reason||"Manual reconciliation"})]})]})]},t.id)})]})]}),(0,a.jsxs)(n.Card,{children:[(0,a.jsxs)(n.CardHeader,{children:[(0,a.jsxs)(n.CardTitle,{className:"flex items-center gap-2",children:[(0,a.jsx)(f.AlertCircle,{className:"h-5 w-5 text-amber-300"}),"Suggested Matches"]}),(0,a.jsx)(n.CardDescription,{children:P.length>0?"Review and accept high-confidence matches":"No pending suggestions"})]}),(0,a.jsxs)(n.CardContent,{className:"space-y-4",children:[0===P.length&&(0,a.jsx)("div",{className:"text-sm text-muted-foreground",children:"Auto-matching has not produced any suggestions for this transaction."}),P.map(t=>{let s=t.invoices,r=s?.currency||e.currency||"USD",c=s?.invoice_number||s?.id?.slice(0,8),o=s?.investor?.legal_name,m=s?.deal?.name;return(0,a.jsxs)(n.Card,{className:"border-amber-800/40 bg-amber-950/10",children:[(0,a.jsxs)(n.CardHeader,{className:"space-y-1",children:[(0,a.jsxs)(n.CardTitle,{className:"flex items-center justify-between text-base",children:[(0,a.jsxs)("span",{className:"flex items-center gap-2",children:[(0,a.jsx)(b,{className:"h-4 w-4 text-amber-300"}),c]}),null!==t.confidence&&void 0!==t.confidence&&(0,a.jsxs)(l.Badge,{className:t.confidence>=80?"bg-emerald-900/30 text-emerald-300 border-emerald-700":t.confidence>=60?"bg-amber-900/30 text-amber-300 border-amber-700":"bg-rose-900/30 text-rose-300 border-rose-700",children:[t.confidence,"% confidence"]})]}),(0,a.jsxs)(n.CardDescription,{children:[o||"Investor"," ",m?`• ${m}`:""]})]}),(0,a.jsxs)(n.CardContent,{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(d.Label,{className:"text-muted-foreground text-xs",children:"Invoice Total"}),(0,a.jsx)("div",{className:"text-sm font-semibold text-foreground",children:k(_(s?.total),r)})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(d.Label,{className:"text-muted-foreground text-xs",children:"Balance Due"}),(0,a.jsx)("div",{className:"text-sm text-muted-foreground",children:k(s?.balance_due!==void 0&&s?.balance_due!==null?_(s.balance_due):Math.max(_(s?.total)-_(s?.paid_amount),0),r)})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(d.Label,{className:"text-muted-foreground text-xs",children:"Suggested Reason"}),(0,a.jsx)("div",{className:"text-xs text-muted-foreground line-clamp-2",children:t.match_reason})]})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsxs)(i.Button,{size:"sm",onClick:()=>V(t.id),disabled:F,children:[(0,a.jsx)(j.Check,{className:"h-4 w-4 mr-2"})," Accept"]}),(0,a.jsxs)(i.Button,{variant:"outline",size:"sm",onClick:()=>K(t.id),disabled:F,children:[(0,a.jsx)(g.X,{className:"h-4 w-4 mr-2"})," Reject"]})]})]})]},t.id)})]})]})]}),(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)(n.Card,{children:[(0,a.jsxs)(n.CardHeader,{children:[(0,a.jsx)(n.CardTitle,{children:"Manual Match"}),(0,a.jsx)(n.CardDescription,{children:"Link this transaction to an invoice that still has an outstanding balance."})]}),(0,a.jsxs)(n.CardContent,{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(d.Label,{children:"Select Invoice"}),(0,a.jsxs)(x.Select,{value:R,onValueChange:e=>U(e),children:[(0,a.jsx)(x.SelectTrigger,{children:(0,a.jsx)(x.SelectValue,{placeholder:"Choose invoice"})}),(0,a.jsxs)(x.SelectContent,{children:[0===p.length&&(0,a.jsx)(x.SelectItem,{value:"",disabled:!0,children:"No open invoices available"}),p.map(t=>{let s=t.currency||e.currency||"USD",r=null!==t.balance_due&&void 0!==t.balance_due?_(t.balance_due):Math.max(_(t.total)-_(t.paid_amount),0);return(0,a.jsxs)(x.SelectItem,{value:t.id,children:[t.invoice_number||t.id.slice(0,8)," • ",t.investor?.legal_name||"Investor"," • ",k(r,s)," due"]},t.id)})]})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(d.Label,{children:"Match Amount"}),(0,a.jsx)(o.Input,{type:"number",min:"0",step:"0.01",value:B,onChange:e=>I(e.target.value),placeholder:$>0?$.toFixed(2):"0.00"}),(0,a.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Remaining transaction amount: ",k($,e.currency)]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(d.Label,{children:"Notes (optional)"}),(0,a.jsx)(m.Textarea,{value:O,onChange:e=>H(e.target.value),placeholder:"Document any context for this manual match",rows:3})]}),(0,a.jsxs)(i.Button,{onClick:X,disabled:F||!R,className:"w-full",children:[(0,a.jsx)(j.Check,{className:"h-4 w-4 mr-2"})," Create Manual Match"]})]})]}),(0,a.jsxs)(n.Card,{children:[(0,a.jsxs)(n.CardHeader,{children:[(0,a.jsx)(n.CardTitle,{children:"Reconciliation Summary"}),(0,a.jsx)(n.CardDescription,{children:"Overview of this transaction's allocation"})]}),(0,a.jsxs)(n.CardContent,{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:"Total matched"}),(0,a.jsx)("span",{className:"font-medium text-emerald-200",children:k(q,e.currency)})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:"Remaining"}),(0,a.jsx)("span",{className:"font-medium text-amber-200",children:k($,e.currency)})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:"Matches created by"}),(0,a.jsx)("span",{className:"font-medium text-foreground",children:S?.displayName||"Staff"})]})]})]})]})]})]})}e.s(["TransactionDetailClient",()=>S],790742)}]);