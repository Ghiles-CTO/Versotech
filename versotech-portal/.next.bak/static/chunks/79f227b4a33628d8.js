(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,90613,e=>{"use strict";var t=e.i(722679),a=e.i(282141);function r({className:e,...r}){return(0,t.jsx)("div",{"data-slot":"card",className:(0,a.cn)("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",e),...r})}function s({className:e,...r}){return(0,t.jsx)("div",{"data-slot":"card-header",className:(0,a.cn)("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-1.5 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",e),...r})}function l({className:e,...r}){return(0,t.jsx)("div",{"data-slot":"card-title",className:(0,a.cn)("leading-none font-semibold",e),...r})}function d({className:e,...r}){return(0,t.jsx)("div",{"data-slot":"card-description",className:(0,a.cn)("text-muted-foreground text-sm",e),...r})}function n({className:e,...r}){return(0,t.jsx)("div",{"data-slot":"card-content",className:(0,a.cn)("px-6",e),...r})}function i({className:e,...r}){return(0,t.jsx)("div",{"data-slot":"card-footer",className:(0,a.cn)("flex items-center px-6 [.border-t]:pt-6",e),...r})}e.s(["Card",()=>r,"CardContent",()=>n,"CardDescription",()=>d,"CardFooter",()=>i,"CardHeader",()=>s,"CardTitle",()=>l])},237635,e=>{"use strict";var t=e.i(722679),a=e.i(282141);function r({className:e,...r}){return(0,t.jsx)("div",{"data-slot":"table-container",className:"relative w-full overflow-x-auto",children:(0,t.jsx)("table",{"data-slot":"table",className:(0,a.cn)("w-full caption-bottom text-sm",e),...r})})}function s({className:e,...r}){return(0,t.jsx)("thead",{"data-slot":"table-header",className:(0,a.cn)("[&_tr]:border-b",e),...r})}function l({className:e,...r}){return(0,t.jsx)("tbody",{"data-slot":"table-body",className:(0,a.cn)("[&_tr:last-child]:border-0",e),...r})}function d({className:e,...r}){return(0,t.jsx)("tr",{"data-slot":"table-row",className:(0,a.cn)("hover:bg-muted/50 data-[state=selected]:bg-muted border-b transition-colors",e),...r})}function n({className:e,...r}){return(0,t.jsx)("th",{"data-slot":"table-head",className:(0,a.cn)("text-foreground h-11 md:h-10 px-2 text-left align-middle font-medium text-xs sm:text-sm [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",e),...r})}function i({className:e,...r}){return(0,t.jsx)("td",{"data-slot":"table-cell",className:(0,a.cn)("p-2 align-middle text-xs sm:text-sm [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",e),...r})}e.s(["Table",()=>r,"TableBody",()=>l,"TableCell",()=>i,"TableHead",()=>n,"TableHeader",()=>s,"TableRow",()=>d])},501495,e=>{"use strict";e.s(["formatBps",0,e=>null==e?"—":`${e} bps`,"formatCurrency",0,(e,t="USD")=>e?new Intl.NumberFormat("en-US",{style:"currency",currency:t,maximumFractionDigits:0}).format(e):"$0","formatDate",0,e=>{if(!e)return"—";let t="string"==typeof e?new Date(e):e;return Number.isNaN(t?.getTime?.())?"—":t.toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})}])},540318,59531,e=>{"use strict";let t=(0,e.i(410587).default)("handshake",[["path",{d:"m11 17 2 2a1 1 0 1 0 3-3",key:"efffak"}],["path",{d:"m14 14 2.5 2.5a1 1 0 1 0 3-3l-3.88-3.88a3 3 0 0 0-4.24 0l-.88.88a1 1 0 1 1-3-3l2.81-2.81a5.79 5.79 0 0 1 7.06-.87l.47.28a2 2 0 0 0 1.42.25L21 4",key:"9pr0kb"}],["path",{d:"m21 3 1 11h-2",key:"1tisrp"}],["path",{d:"M3 3 2 14l6.5 6.5a1 1 0 1 0 3-3",key:"1uvwmv"}],["path",{d:"M3 4h8",key:"1ep09j"}]]);e.s(["default",()=>t],59531),e.s(["Handshake",()=>t],540318)},300731,e=>{"use strict";var t=e.i(722679),a=e.i(340915),r=e.i(90613),s=e.i(129432),l=e.i(191569),d=e.i(538892),n=e.i(237635),i=e.i(481706),o=e.i(501259),c=e.i(750809),m=e.i(263229),u=e.i(401148),x=e.i(691974),h=e.i(733179),f=e.i(971743),p=e.i(540318),_=e.i(282141),j=e.i(501495),b=e.i(59178);let g={open:"bg-green-100 text-green-800 border-green-200",closed:"bg-blue-100 text-blue-800 border-blue-200",pending:"bg-yellow-100 text-yellow-800 border-yellow-200",cancelled:"bg-red-100 text-red-800 border-red-200"},y=[{label:"All Status",value:"all"},{label:"Open",value:"open"},{label:"Closed",value:"closed"},{label:"Pending",value:"pending"}];function v(){let[e,v]=(0,a.useState)(null),[N,C]=(0,a.useState)([]),[w,T]=(0,a.useState)({totalShared:0,activeDeals:0,totalValue:0,coPartners:0}),[S,H]=(0,a.useState)(!0),[k,A]=(0,a.useState)(null),[D,U]=(0,a.useState)(""),[B,L]=(0,a.useState)("all");(0,a.useEffect)(()=>{async function e(e){let{data:a,error:r}=await e.from("deal_memberships").select(`
          deal_id,
          investor_id,
          dispatched_at,
          referred_by_entity_id,
          referred_by_entity_type,
          investor:investor_id (
            id,
            legal_name
          ),
          deal:deal_id (
            id,
            name,
            status,
            currency,
            target_amount
          )
        `).not("referred_by_entity_id","is",null).order("dispatched_at",{ascending:!1}).limit(50);if(r)throw r;t(a||[],{},{})}function t(e,t,a){let r=e.map(e=>{let r=Array.isArray(e.investor)?e.investor[0]:e.investor,s=Array.isArray(e.deal)?e.deal[0]:e.deal,l=r?.id?t[r.id]:null,d=a[s?.id]||[],n=d.length>0,i=d[0];return{id:`${e.deal_id||"no-deal"}-${e.investor_id||"no-investor"}`,deal_id:s?.id||"",deal_name:s?.name||"Unknown Deal",deal_status:s?.status||"draft",investor_id:r?.id||null,investor_name:r?.legal_name||"Unknown",commitment_amount:l?.commitment||0,currency:s?.currency||"USD",dispatched_at:e.dispatched_at,partner_share:n?50:100,co_referrer_name:n?`Co-referrer (${i.referred_by_entity_type})`:null,co_referrer_type:i?.referred_by_entity_type||null}}),s=r.filter(e=>null!==e.co_referrer_name);C(r);let l=new Set(r.map(e=>e.deal_id)),d=new Set(r.filter(e=>e.co_referrer_name).map(e=>e.co_referrer_name)),n=r.reduce((e,t)=>e+t.commitment_amount,0);T({totalShared:s.length,activeDeals:l.size,totalValue:n,coPartners:d.size})}!async function(){try{H(!0);let a=(0,b.createClient)(),{data:{user:r}}=await a.auth.getUser();if(!r)return void A("Not authenticated");let{data:s,error:l}=await a.from("partner_users").select("partner_id").eq("user_id",r.id).single();if(l||!s)return void await e(a);let{data:d,error:n}=await a.from("partners").select("id, name, legal_name, status, logo_url").eq("id",s.partner_id).single();if(n)throw n;v(d);let{data:i,error:o}=await a.from("deal_memberships").select(`
            deal_id,
            investor_id,
            dispatched_at,
            referred_by_entity_id,
            referred_by_entity_type,
            investor:investor_id (
              id,
              legal_name
            ),
            deal:deal_id (
              id,
              name,
              status,
              currency,
              target_amount
            )
          `).eq("referred_by_entity_id",s.partner_id).eq("referred_by_entity_type","partner").order("dispatched_at",{ascending:!1});if(o)throw o;let c=(i||[]).filter(e=>{let t=Array.isArray(e.investor)?e.investor[0]:e.investor;return t?.id}).map(e=>(Array.isArray(e.investor)?e.investor[0]:e.investor).id),m={};if(c.length>0){let{data:e}=await a.from("subscriptions").select("investor_id, commitment, status").in("investor_id",c);e&&e.forEach(e=>{m[e.investor_id]||(m[e.investor_id]=e)})}let u=[...new Set((i||[]).filter(e=>{let t=Array.isArray(e.deal)?e.deal[0]:e.deal;return t?.id}).map(e=>(Array.isArray(e.deal)?e.deal[0]:e.deal).id))],x={};if(u.length>0){let{data:e}=await a.from("deal_memberships").select("deal_id, referred_by_entity_id, referred_by_entity_type").in("deal_id",u).not("referred_by_entity_id","is",null).neq("referred_by_entity_id",s.partner_id);e&&e.forEach(e=>{x[e.deal_id]||(x[e.deal_id]=[]),x[e.deal_id].push(e)})}t(i||[],m,x),A(null)}catch(e){console.error("[SharedTransactionsPage] Error:",e),A(e instanceof Error?e.message:"Failed to load shared transactions")}finally{H(!1)}}()},[]);let P=N.filter(e=>{let t="all"===B||e.deal_status===B,a=!D||e.deal_name?.toLowerCase().includes(D.toLowerCase())||e.investor_name?.toLowerCase().includes(D.toLowerCase());return t&&a});return S?(0,t.jsxs)("div",{className:"flex items-center justify-center py-16",children:[(0,t.jsx)(m.Loader2,{className:"h-8 w-8 animate-spin text-muted-foreground"}),(0,t.jsx)("span",{className:"ml-3 text-muted-foreground",children:"Loading shared transactions..."})]}):k?(0,t.jsxs)("div",{className:"text-center py-16",children:[(0,t.jsx)(u.AlertCircle,{className:"h-12 w-12 text-destructive mx-auto mb-4"}),(0,t.jsx)("h3",{className:"text-lg font-medium text-foreground mb-2",children:"Error Loading Transactions"}),(0,t.jsx)("p",{className:"text-muted-foreground",children:k})]}):(0,t.jsxs)("div",{className:"p-6 space-y-6",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-2xl font-bold text-foreground",children:"Shared Transactions"}),(0,t.jsx)("p",{className:"text-muted-foreground mt-1",children:e?`View deals shared with other partners as ${e.name}`:"View all transactions with shared referrals"})]}),e&&(0,t.jsx)("div",{className:"flex items-center gap-2",children:e.logo_url?(0,t.jsx)("img",{src:e.logo_url,alt:e.name,className:"h-10 w-10 rounded-lg object-cover"}):(0,t.jsx)("div",{className:"h-10 w-10 rounded-lg bg-muted flex items-center justify-center",children:(0,t.jsx)(f.Building2,{className:"h-5 w-5 text-muted-foreground"})})})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,t.jsxs)(r.Card,{children:[(0,t.jsx)(r.CardHeader,{className:"pb-2",children:(0,t.jsxs)(r.CardTitle,{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[(0,t.jsx)(i.Share2,{className:"h-4 w-4"}),"Shared Referrals"]})}),(0,t.jsxs)(r.CardContent,{children:[(0,t.jsx)("div",{className:"text-2xl font-bold",children:w.totalShared}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"With co-referrers"})]})]}),(0,t.jsxs)(r.Card,{children:[(0,t.jsx)(r.CardHeader,{className:"pb-2",children:(0,t.jsxs)(r.CardTitle,{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[(0,t.jsx)(x.Briefcase,{className:"h-4 w-4"}),"Deals Involved"]})}),(0,t.jsxs)(r.CardContent,{children:[(0,t.jsx)("div",{className:"text-2xl font-bold text-blue-600",children:w.activeDeals}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Unique deals"})]})]}),(0,t.jsxs)(r.Card,{children:[(0,t.jsx)(r.CardHeader,{className:"pb-2",children:(0,t.jsxs)(r.CardTitle,{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[(0,t.jsx)(h.TrendingUp,{className:"h-4 w-4"}),"Total Value"]})}),(0,t.jsxs)(r.CardContent,{children:[(0,t.jsx)("div",{className:"text-2xl font-bold text-emerald-600",children:(0,j.formatCurrency)(w.totalValue,"USD")}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Commitment value"})]})]}),(0,t.jsxs)(r.Card,{children:[(0,t.jsx)(r.CardHeader,{className:"pb-2",children:(0,t.jsxs)(r.CardTitle,{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[(0,t.jsx)(p.Handshake,{className:"h-4 w-4"}),"Co-Partners"]})}),(0,t.jsxs)(r.CardContent,{children:[(0,t.jsx)("div",{className:"text-2xl font-bold text-purple-600",children:w.coPartners}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Partner relationships"})]})]})]}),(0,t.jsx)(r.Card,{children:(0,t.jsx)(r.CardContent,{className:"pt-6",children:(0,t.jsxs)("div",{className:"flex flex-col md:flex-row gap-4",children:[(0,t.jsx)("div",{className:"flex-1",children:(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(c.Search,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),(0,t.jsx)(l.Input,{placeholder:"Search by deal or investor name...",value:D,onChange:e=>U(e.target.value),className:"pl-10"})]})}),(0,t.jsxs)(d.Select,{value:B,onValueChange:L,children:[(0,t.jsx)(d.SelectTrigger,{className:"w-full md:w-48",children:(0,t.jsx)(d.SelectValue,{placeholder:"Filter by status"})}),(0,t.jsx)(d.SelectContent,{children:y.map(e=>(0,t.jsx)(d.SelectItem,{value:e.value,children:e.label},e.value))})]})]})})}),(0,t.jsxs)(r.Card,{children:[(0,t.jsxs)(r.CardHeader,{children:[(0,t.jsx)(r.CardTitle,{children:"Transactions"}),(0,t.jsxs)(r.CardDescription,{children:[P.length," transaction",1!==P.length?"s":""," found"]})]}),(0,t.jsx)(r.CardContent,{children:0===P.length?(0,t.jsxs)("div",{className:"border border-dashed border-muted rounded-lg py-12 flex flex-col items-center justify-center text-center space-y-2",children:[(0,t.jsx)(i.Share2,{className:"h-10 w-10 text-muted-foreground"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:D||"all"!==B?"No transactions match your filters":e?"No shared transactions yet":"No shared transactions found"}),e&&0===N.length&&(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:"Shared transactions appear when you co-refer deals with other partners"})]}):(0,t.jsx)("div",{className:"rounded-md border",children:(0,t.jsxs)(n.Table,{children:[(0,t.jsx)(n.TableHeader,{children:(0,t.jsxs)(n.TableRow,{children:[(0,t.jsx)(n.TableHead,{children:"Deal"}),(0,t.jsx)(n.TableHead,{children:"Investor"}),(0,t.jsx)(n.TableHead,{children:"Your Share"}),(0,t.jsx)(n.TableHead,{children:"Co-Referrer"}),(0,t.jsx)(n.TableHead,{children:"Amount"}),(0,t.jsx)(n.TableHead,{children:"Status"})]})}),(0,t.jsx)(n.TableBody,{children:P.map(e=>(0,t.jsxs)(n.TableRow,{children:[(0,t.jsx)(n.TableCell,{children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(x.Briefcase,{className:"h-4 w-4 text-muted-foreground"}),(0,t.jsx)("span",{className:"font-medium",children:e.deal_name})]})}),(0,t.jsx)(n.TableCell,{children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(o.Users,{className:"h-4 w-4 text-muted-foreground"}),(0,t.jsx)("span",{children:e.investor_name})]})}),(0,t.jsx)(n.TableCell,{children:(0,t.jsxs)(s.Badge,{variant:100===e.partner_share?"default":"secondary",children:[e.partner_share,"%"]})}),(0,t.jsx)(n.TableCell,{children:e.co_referrer_name?(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsx)(p.Handshake,{className:"h-3 w-3 text-muted-foreground"}),(0,t.jsx)("span",{className:"text-sm",children:e.co_referrer_name})]}):(0,t.jsx)("span",{className:"text-muted-foreground text-xs",children:"None"})}),(0,t.jsxs)(n.TableCell,{children:[(0,t.jsx)("div",{className:"font-medium",children:(0,j.formatCurrency)(e.commitment_amount,e.currency)}),(0,t.jsx)("div",{className:"text-xs text-muted-foreground",children:e.dispatched_at?(0,j.formatDate)(e.dispatched_at):"—"})]}),(0,t.jsx)(n.TableCell,{children:(0,t.jsx)(s.Badge,{variant:"outline",className:(0,_.cn)("capitalize",g[e.deal_status]||""),children:e.deal_status})})]},e.id))})]})})})]})]})}e.s(["default",()=>v])}]);