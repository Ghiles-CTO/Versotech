
with vfd as (
  select * from jsonb_to_recordset('[{"row_num":38,"entity_code":"VC106","investor_name":"Anisha Bansal and Rahul KARKUN","investor_type":"individual","currency":"USD","commitment":50000,"funded_amount":0,"shares":2272,"current_position":2272,"notes":null,"price_per_share":22,"cost_per_share":14,"subscription_fee_percent":null,"subscription_fee_amount":null,"performance_fee_tier1_percent":null,"performance_fee_tier1_threshold":null,"performance_fee_tier2_percent":null,"performance_fee_tier2_threshold":null,"spread_per_share":8.5,"spread_fee_amount":19312,"management_fee_percent":null,"bd_fee_percent":null,"bd_fee_amount":null,"finra_fee_shares":null,"finra_fee_amount":null,"discount_rate":null,"interest_rate":null,"valuation_cap":null,"opportunity_name":"VEGINVEST","sourcing_contract_ref":"VEG_VC6_TR4","contract_date":"2021-02-07 00:00:00","extra_cols":["Currency","Funded Amount","Shares","Current Position"]},{"row_num":61,"entity_code":"VC106","investor_name":"Bank SYZ AG","investor_type":"entity","currency":"USD","commitment":3763.2,"funded_amount":3763.2,"shares":160,"current_position":160,"notes":null,"price_per_share":23.52,"cost_per_share":14,"subscription_fee_percent":0,"subscription_fee_amount":0,"performance_fee_tier1_percent":0.1,"performance_fee_tier1_threshold":null,"performance_fee_tier2_percent":null,"performance_fee_tier2_threshold":null,"spread_per_share":9.52,"spread_fee_amount":1523.2,"management_fee_percent":null,"bd_fee_percent":0,"bd_fee_amount":0,"finra_fee_shares":0,"finra_fee_amount":0,"discount_rate":null,"interest_rate":null,"valuation_cap":null,"opportunity_name":"J.MACHOT","sourcing_contract_ref":null,"contract_date":"2021-04-27 00:00:00","extra_cols":["Entity Code","Investor Name","Investor Type","Currency","Commitment","Funded Amount","Shares","Current Position","Notes","Price Per Share","Cost Per Share","Subscription Fee (%)","Subscription Fee Amount","Performance Fee Tier 1 (%)","Performance Fee Tier 1 Threshold","Performance Fee Tier 2 (%)","Performance Fee Tier 2 Threshold","Spread Per Share","Spread Fee Amount","Management Fee (%)","BD Fee (%)","BD Fee Amount","FINRA Fee Shares","FINRA Fee Amount","Discount Rate","Interest Rate","Valuation Cap","Opportunity Name","Contract Date"]},{"row_num":62,"entity_code":"VC106","investor_name":"Bank SYZ AG","investor_type":"entity","currency":"USD","commitment":15052.8,"funded_amount":15052.8,"shares":640,"current_position":640,"notes":null,"price_per_share":23.52,"cost_per_share":13.5,"subscription_fee_percent":0,"subscription_fee_amount":0,"performance_fee_tier1_percent":0.1,"performance_fee_tier1_threshold":null,"performance_fee_tier2_percent":null,"performance_fee_tier2_threshold":null,"spread_per_share":10.02,"spread_fee_amount":6412.8,"management_fee_percent":null,"bd_fee_percent":0,"bd_fee_amount":0,"finra_fee_shares":0,"finra_fee_amount":0,"discount_rate":null,"interest_rate":null,"valuation_cap":null,"opportunity_name":"J.MACHOT","sourcing_contract_ref":null,"contract_date":"2021-04-27 00:00:00","extra_cols":["Entity Code","Investor Name","Investor Type","Currency","Commitment","Funded Amount","Shares","Current Position","Notes","Price Per Share","Cost Per Share","Subscription Fee (%)","Subscription Fee Amount","Performance Fee Tier 1 (%)","Performance Fee Tier 1 Threshold","Performance Fee Tier 2 (%)","Performance Fee Tier 2 Threshold","Spread Per Share","Spread Fee Amount","Management Fee (%)","BD Fee (%)","BD Fee Amount","FINRA Fee Shares","FINRA Fee Amount","Discount Rate","Interest Rate","Valuation Cap","Opportunity Name","Contract Date"]},{"row_num":63,"entity_code":"VC106","investor_name":"Bank SYZ AG","investor_type":"entity","currency":"USD","commitment":36361.92,"funded_amount":36361.92,"shares":1546,"current_position":1546,"notes":null,"price_per_share":23.52,"cost_per_share":16,"subscription_fee_percent":0,"subscription_fee_amount":0,"performance_fee_tier1_percent":0.1,"performance_fee_tier1_threshold":null,"performance_fee_tier2_percent":null,"performance_fee_tier2_threshold":null,"spread_per_share":7.52,"spread_fee_amount":11625.92,"management_fee_percent":null,"bd_fee_percent":0,"bd_fee_amount":0,"finra_fee_shares":0,"finra_fee_amount":0,"discount_rate":null,"interest_rate":null,"valuation_cap":null,"opportunity_name":"JMACHOT","sourcing_contract_ref":"VEG_VC6_TR6","contract_date":"2021-04-27 00:00:00","extra_cols":["Entity Code","Investor Name","Investor Type","Currency","Commitment","Funded Amount","Shares","Current Position","Notes","Price Per Share","Cost Per Share","Subscription Fee (%)","Subscription Fee Amount","Performance Fee Tier 1 (%)","Performance Fee Tier 1 Threshold","Performance Fee Tier 2 (%)","Performance Fee Tier 2 Threshold","Spread Per Share","Spread Fee Amount","Management Fee (%)","BD Fee (%)","BD Fee Amount","FINRA Fee Shares","FINRA Fee Amount","Discount Rate","Interest Rate","Valuation Cap","Opportunity Name","Sourcing Contract Ref","Contract Date"]},{"row_num":64,"entity_code":"VC106","investor_name":"Bank SYZ AG","investor_type":"entity","currency":"USD","commitment":46569.6,"funded_amount":46569.6,"shares":1980,"current_position":1980,"notes":null,"price_per_share":23.52,"cost_per_share":16,"subscription_fee_percent":0,"subscription_fee_amount":0,"performance_fee_tier1_percent":0.1,"performance_fee_tier1_threshold":null,"performance_fee_tier2_percent":null,"performance_fee_tier2_threshold":null,"spread_per_share":7.52,"spread_fee_amount":14889.6,"management_fee_percent":null,"bd_fee_percent":0,"bd_fee_amount":0,"finra_fee_shares":0,"finra_fee_amount":0,"discount_rate":null,"interest_rate":null,"valuation_cap":null,"opportunity_name":"JMACHOT","sourcing_contract_ref":"VEG_VC6_TR5","contract_date":"2021-04-27 00:00:00","extra_cols":["Entity Code","Investor Name","Investor Type","Currency","Commitment","Funded Amount","Shares","Current Position","Notes","Price Per Share","Cost Per Share","Subscription Fee (%)","Subscription Fee Amount","Performance Fee Tier 1 (%)","Performance Fee Tier 1 Threshold","Performance Fee Tier 2 (%)","Performance Fee Tier 2 Threshold","Spread Per Share","Spread Fee Amount","Management Fee (%)","BD Fee (%)","BD Fee Amount","FINRA Fee Shares","FINRA Fee Amount","Discount Rate","Interest Rate","Valuation Cap","Opportunity Name","Sourcing Contract Ref","Contract Date"]},{"row_num":65,"entity_code":"VC106","investor_name":"Bank SYZ AG","investor_type":"entity","currency":"USD","commitment":62892.48,"funded_amount":62892.48,"shares":2674,"current_position":2674,"notes":null,"price_per_share":23.52,"cost_per_share":21,"subscription_fee_percent":0,"subscription_fee_amount":0,"performance_fee_tier1_percent":0.1,"performance_fee_tier1_threshold":null,"performance_fee_tier2_percent":null,"performance_fee_tier2_threshold":null,"spread_per_share":4.02,"spread_fee_amount":10749.48,"management_fee_percent":null,"bd_fee_percent":0,"bd_fee_amount":0,"finra_fee_shares":0,"finra_fee_amount":0,"discount_rate":null,"interest_rate":null,"valuation_cap":null,"opportunity_name":"VEGINVEST","sourcing_contract_ref":"VEG_VC6_TR8","contract_date":"2021-04-27 00:00:00","extra_cols":["Entity Code","Investor Name","Investor Type","Currency","Commitment","Funded Amount","Shares","Current Position","Notes","Price Per Share","Cost Per Share","Subscription Fee (%)","Subscription Fee Amount","Performance Fee Tier 1 (%)","Performance Fee Tier 1 Threshold","Performance Fee Tier 2 (%)","Performance Fee Tier 2 Threshold","Spread Per Share","Spread Fee Amount","Management Fee (%)","BD Fee (%)","BD Fee Amount","FINRA Fee Shares","FINRA Fee Amount","Discount Rate","Interest Rate","Valuation Cap","Opportunity Name","Sourcing Contract Ref","Contract Date"]},{"row_num":66,"entity_code":"VC106","investor_name":"Bank SYZ AG","investor_type":"entity","currency":"USD","commitment":124444.32,"funded_amount":124444.32,"shares":5291,"current_position":5291,"notes":null,"price_per_share":23.52,"cost_per_share":14,"subscription_fee_percent":0,"subscription_fee_amount":0,"performance_fee_tier1_percent":0.1,"performance_fee_tier1_threshold":null,"performance_fee_tier2_percent":null,"performance_fee_tier2_threshold":null,"spread_per_share":9.52,"spread_fee_amount":50370.32,"management_fee_percent":null,"bd_fee_percent":0,"bd_fee_amount":0,"finra_fee_shares":0,"finra_fee_amount":0,"discount_rate":null,"interest_rate":null,"valuation_cap":null,"opportunity_name":"JMACHOT","sourcing_contract_ref":"VEG_VC6_TR4","contract_date":"2021-04-27 00:00:00","extra_cols":["Entity Code","Investor Name","Investor Type","Currency","Commitment","Funded Amount","Shares","Current Position","Notes","Price Per Share","Cost Per Share","Subscription Fee (%)","Subscription Fee Amount","Performance Fee Tier 1 (%)","Performance Fee Tier 1 Threshold","Performance Fee Tier 2 (%)","Performance Fee Tier 2 Threshold","Spread Per Share","Spread Fee Amount","Management Fee (%)","BD Fee (%)","BD Fee Amount","FINRA Fee Shares","FINRA Fee Amount","Discount Rate","Interest Rate","Valuation Cap","Opportunity Name","Sourcing Contract Ref","Contract Date"]},{"row_num":67,"entity_code":"VC106","investor_name":"Bank SYZ AG","investor_type":"entity","currency":"USD","commitment":129407.04,"funded_amount":129407.04,"shares":5502,"current_position":5502,"notes":null,"price_per_share":23.52,"cost_per_share":13.5,"subscription_fee_percent":0,"subscription_fee_amount":0,"performance_fee_tier1_percent":0.1,"performance_fee_tier1_threshold":null,"performance_fee_tier2_percent":null,"performance_fee_tier2_threshold":null,"spread_per_share":10.02,"spread_fee_amount":55130.04,"management_fee_percent":null,"bd_fee_percent":0,"bd_fee_amount":0,"finra_fee_shares":0,"finra_fee_amount":0,"discount_rate":null,"interest_rate":null,"valuation_cap":null,"opportunity_name":"J.MACHOT","sourcing_contract_ref":null,"contract_date":"2021-04-27 00:00:00","extra_cols":["Entity Code","Investor Name","Investor Type","Currency","Commitment","Funded Amount","Shares","Current Position","Notes","Price Per Share","Cost Per Share","Subscription Fee (%)","Subscription Fee Amount","Performance Fee Tier 1 (%)","Performance Fee Tier 1 Threshold","Performance Fee Tier 2 (%)","Performance Fee Tier 2 Threshold","Spread Per Share","Spread Fee Amount","Management Fee (%)","BD Fee (%)","BD Fee Amount","FINRA Fee Shares","FINRA Fee Amount","Discount Rate","Interest Rate","Valuation Cap","Opportunity Name","Contract Date"]},{"row_num":68,"entity_code":"VC106","investor_name":"Bank SYZ AG","investor_type":"entity","currency":"USD","commitment":4661508.64,"funded_amount":4661508.64,"shares":198193,"current_position":198193,"notes":null,"price_per_share":23.52,"cost_per_share":20,"subscription_fee_percent":0,"subscription_fee_amount":0,"performance_fee_tier1_percent":0.1,"performance_fee_tier1_threshold":null,"performance_fee_tier2_percent":null,"performance_fee_tier2_threshold":null,"spread_per_share":3.52,"spread_fee_amount":697639.36,"management_fee_percent":null,"bd_fee_percent":0,"bd_fee_amount":0,"finra_fee_shares":0,"finra_fee_amount":0,"discount_rate":null,"interest_rate":null,"valuation_cap":null,"opportunity_name":"GERSHON","sourcing_contract_ref":null,"contract_date":"2021-04-27 00:00:00","extra_cols":["Entity Code","Investor Name","Investor Type","Currency","Commitment","Funded Amount","Shares","Current Position","Notes","Price Per Share","Cost Per Share","Subscription Fee (%)","Subscription Fee Amount","Performance Fee Tier 1 (%)","Performance Fee Tier 1 Threshold","Performance Fee Tier 2 (%)","Performance Fee Tier 2 Threshold","Spread Per Share","Spread Fee Amount","Management Fee (%)","BD Fee (%)","BD Fee Amount","FINRA Fee Shares","FINRA Fee Amount","Discount Rate","Interest Rate","Valuation Cap","Opportunity Name","Contract Date"]},{"row_num":69,"entity_code":"VC106","investor_name":"Barbara and Heinz WINZ","investor_type":"individual","currency":"USD","commitment":100000,"funded_amount":0,"shares":4440,"current_position":4440,"notes":null,"price_per_share":22.52,"cost_per_share":14,"subscription_fee_percent":0.02,"subscription_fee_amount":2000,"performance_fee_tier1_percent":0.1,"performance_fee_tier1_threshold":null,"performance_fee_tier2_percent":null,"performance_fee_tier2_threshold":null,"spread_per_share":8.52,"spread_fee_amount":37828.8,"management_fee_percent":null,"bd_fee_percent":null,"bd_fee_amount":null,"finra_fee_shares":null,"finra_fee_amount":null,"discount_rate":null,"interest_rate":null,"valuation_cap":null,"opportunity_name":"VEGINVEST","sourcing_contract_ref":"VEG_VC6_TR4","contract_date":"2021-02-05 00:00:00","extra_cols":["Currency","Funded Amount","Shares","Current Position"]},{"row_num":71,"entity_code":"VC106","investor_name":"Beatrice and Marcel KNOPF","investor_type":"individual","currency":"USD","commitment":50000,"funded_amount":0,"shares":2220,"current_position":2220,"notes":null,"price_per_share":22.52,"cost_per_share":14,"subscription_fee_percent":0.02,"subscription_fee_amount":1000,"performance_fee_tier1_percent":0.1,"performance_fee_tier1_threshold":null,"performance_fee_tier2_percent":null,"performance_fee_tier2_threshold":null,"spread_per_share":8.52,"spread_fee_amount":18914.4,"management_fee_percent":null,"bd_fee_percent":null,"bd_fee_amount":null,"finra_fee_shares":null,"finra_fee_amount":null,"discount_rate":null,"interest_rate":null,"valuation_cap":null,"opportunity_name":"VEGINVEST","sourcing_contract_ref":"VEG_VC6_TR4","contract_date":"2021-01-29 00:00:00","extra_cols":["Currency","Funded Amount","Shares","Current Position"]},{"row_num":75,"entity_code":"VC106","investor_name":"Blaine ROLLINS","investor_type":"individual","currency":"USD","commitment":50000,"funded_amount":50000,"shares":2500,"current_position":2500,"notes":null,"price_per_share":20,"cost_per_share":14,"subscription_fee_percent":0,"subscription_fee_amount":0,"performance_fee_tier1_percent":0,"performance_fee_tier1_threshold":null,"performance_fee_tier2_percent":null,"performance_fee_tier2_threshold":null,"spread_per_share":6.5,"spread_fee_amount":16250,"management_fee_percent":null,"bd_fee_percent":0.1,"bd_fee_amount":0.1,"finra_fee_shares":2,"finra_fee_amount":5000,"discount_rate":null,"interest_rate":null,"valuation_cap":null,"opportunity_name":"VEGINVEST","sourcing_contract_ref":"VEG_VC6_TR2","contract_date":"2021-01-28 00:00:00","extra_cols":["Currency","Shares","Current Position","Notes"]},{"row_num":76,"entity_code":"VC106","investor_name":"Blaine ROLLINS","investor_type":"individual","currency":"USD","commitment":150000,"funded_amount":150000,"shares":7500,"current_position":7500,"notes":null,"price_per_share":20,"cost_per_share":13.5,"subscription_fee_percent":0,"subscription_fee_amount":0,"performance_fee_tier1_percent":0,"performance_fee_tier1_threshold":null,"performance_fee_tier2_percent":null,"performance_fee_tier2_threshold":null,"spread_per_share":6.5,"spread_fee_amount":48750,"management_fee_percent":null,"bd_fee_percent":0.1,"bd_fee_amount":0.1,"finra_fee_shares":2,"finra_fee_amount":15000,"discount_rate":null,"interest_rate":null,"valuation_cap":null,"opportunity_name":"VEGINVEST","sourcing_contract_ref":"VEG_VC6_TR1","contract_date":"2020-12-06 00:00:00","extra_cols":["Currency","Shares","Current Position","Notes"]},{"row_num":86,"entity_code":"VC106","investor_name":"Craig BROWN","investor_type":"individual","currency":"USD","commitment":50000,"funded_amount":50000,"shares":2500,"current_position":2500,"notes":null,"price_per_share":20,"cost_per_share":14,"subscription_fee_percent":0,"subscription_fee_amount":0,"performance_fee_tier1_percent":0,"performance_fee_tier1_threshold":null,"performance_fee_tier2_percent":null,"performance_fee_tier2_threshold":null,"spread_per_share":6,"spread_fee_amount":15000,"management_fee_percent":null,"bd_fee_percent":0.1,"bd_fee_amount":0.1,"finra_fee_shares":2,"finra_fee_amount":5000,"discount_rate":null,"interest_rate":null,"valuation_cap":null,"opportunity_name":"VEGINVEST","sourcing_contract_ref":"VEG_VC6_TR4","contract_date":"2021-02-10 00:00:00","extra_cols":["Currency","Shares","Current Position","Notes"]},{"row_num":89,"entity_code":"VC106","investor_name":"Damien Krauser","investor_type":"individual","currency":"USD","commitment":50000,"funded_amount":50000,"shares":2125,"current_position":2125,"notes":null,"price_per_share":23.52,"cost_per_share":21,"subscription_fee_percent":0.02,"subscription_fee_amount":1000,"performance_fee_tier1_percent":0.1,"performance_fee_tier1_threshold":null,"performance_fee_tier2_percent":null,"performance_fee_tier2_threshold":null,"spread_per_share":7.52,"spread_fee_amount":15980,"management_fee_percent":null,"bd_fee_percent":0,"bd_fee_amount":0,"finra_fee_shares":0,"finra_fee_amount":0,"discount_rate":null,"interest_rate":null,"valuation_cap":null,"opportunity_name":"VEGINVEST","sourcing_contract_ref":"VEG_VC6_TR5","contract_date":"2021-04-30 00:00:00","extra_cols":["Currency","Shares","Current Position","Notes"]},{"row_num":90,"entity_code":"VC106","investor_name":"Damien Krauser","investor_type":"individual","currency":"USD","commitment":100000,"funded_amount":100000,"shares":4251,"current_position":4251,"notes":null,"price_per_share":23.52,"cost_per_share":21,"subscription_fee_percent":0.02,"subscription_fee_amount":2000,"performance_fee_tier1_percent":0.1,"performance_fee_tier1_threshold":null,"performance_fee_tier2_percent":null,"performance_fee_tier2_threshold":null,"spread_per_share":4.02,"spread_fee_amount":17089.02,"management_fee_percent":null,"bd_fee_percent":0,"bd_fee_amount":0,"finra_fee_shares":0,"finra_fee_amount":0,"discount_rate":null,"interest_rate":null,"valuation_cap":null,"opportunity_name":"VEGINVEST","sourcing_contract_ref":"VEG_VC6_TR9","contract_date":"2021-04-30 00:00:00","extra_cols":["Currency","Shares","Current Position","Notes"]},{"row_num":105,"entity_code":"VC106","investor_name":"Eric LE SEIGNEUR","investor_type":"individual","currency":"USD","commitment":100000,"funded_amount":100000,"shares":4251,"current_position":4251,"notes":null,"price_per_share":23.52,"cost_per_share":21,"subscription_fee_percent":0.02,"subscription_fee_amount":2000,"performance_fee_tier1_percent":0.2,"performance_fee_tier1_threshold":null,"performance_fee_tier2_percent":null,"performance_fee_tier2_threshold":null,"spread_per_share":4.02,"spread_fee_amount":17089.02,"management_fee_percent":null,"bd_fee_percent":null,"bd_fee_amount":null,"finra_fee_shares":0,"finra_fee_amount":null,"discount_rate":null,"interest_rate":null,"valuation_cap":null,"opportunity_name":"VEGINVEST","sourcing_contract_ref":"VEG_VC6_TR8","contract_date":"2021-04-30 00:00:00","extra_cols":["Currency","Shares","Current Position","Notes"]},{"row_num":106,"entity_code":"VC106","investor_name":"Eric LE SEIGNEUR","investor_type":"individual","currency":"USD","commitment":100000,"funded_amount":0,"shares":4251,"current_position":4251,"notes":null,"price_per_share":23.52,"cost_per_share":21,"subscription_fee_percent":0.02,"subscription_fee_amount":2000,"performance_fee_tier1_percent":0.2,"performance_fee_tier1_threshold":null,"performance_fee_tier2_percent":null,"performance_fee_tier2_threshold":null,"spread_per_share":4.02,"spread_fee_amount":17089.02,"management_fee_percent":null,"bd_fee_percent":null,"bd_fee_amount":null,"finra_fee_shares":null,"finra_fee_amount":null,"discount_rate":null,"interest_rate":null,"valuation_cap":null,"opportunity_name":"VEGINVEST","sourcing_contract_ref":"VEG_VC6_TR9","contract_date":"2021-04-30 00:00:00","extra_cols":["Currency","Funded Amount","Shares","Current Position","Notes"]},{"row_num":120,"entity_code":"VC106","investor_name":"Hedgebay Securities LLC","investor_type":"entity","currency":"USD","commitment":24978.24,"funded_amount":0,"shares":1062,"current_position":1062,"notes":null,"price_per_share":23.52,"cost_per_share":16,"subscription_fee_percent":0,"subscription_fee_amount":0,"performance_fee_tier1_percent":null,"performance_fee_tier1_threshold":null,"performance_fee_tier2_percent":null,"performance_fee_tier2_threshold":null,"spread_per_share":6.81,"spread_fee_amount":7232.22,"management_fee_percent":null,"bd_fee_percent":null,"bd_fee_amount":null,"finra_fee_shares":0.71,"finra_fee_amount":754.02,"discount_rate":null,"interest_rate":null,"valuation_cap":null,"opportunity_name":"VEGINVEST","sourcing_contract_ref":"VEG_VC6_TR5","contract_date":"2021-03-05 00:00:00","extra_cols":["Investor Name","Currency","Funded Amount","Shares","Current Position","Notes"]},{"row_num":121,"entity_code":"VC106","investor_name":"Hedgebay Securities LLC","investor_type":"entity","currency":"USD","commitment":24978.24,"funded_amount":24978.24,"shares":1062,"current_position":1062,"notes":null,"price_per_share":23.52,"cost_per_share":16,"subscription_fee_percent":0,"subscription_fee_amount":0,"performance_fee_tier1_percent":0,"performance_fee_tier1_threshold":null,"performance_fee_tier2_percent":null,"performance_fee_tier2_threshold":null,"spread_per_share":6.81,"spread_fee_amount":7232.22,"management_fee_percent":null,"bd_fee_percent":0,"bd_fee_amount":0,"finra_fee_shares":0.71,"finra_fee_amount":754.02,"discount_rate":null,"interest_rate":null,"valuation_cap":null,"opportunity_name":"VEGINVEST","sourcing_contract_ref":"VEG_VC6_TR5","contract_date":"2021-03-05 00:00:00","extra_cols":["Investor Name","Currency","Shares","Current Position","Notes"]},{"row_num":122,"entity_code":"VC106","investor_name":"Hedgebay Securities LLC","investor_type":"entity","currency":"USD","commitment":24978.24,"funded_amount":0,"shares":1062,"current_position":1062,"notes":null,"price_per_share":23.52,"cost_per_share":16,"subscription_fee_percent":0,"subscription_fee_amount":0,"performance_fee_tier1_percent":null,"performance_fee_tier1_threshold":null,"performance_fee_tier2_percent":null,"performance_fee_tier2_threshold":null,"spread_per_share":6.81,"spread_fee_amount":7232.22,"management_fee_percent":null,"bd_fee_percent":null,"bd_fee_amount":null,"finra_fee_shares":0.71,"finra_fee_amount":754.02,"discount_rate":null,"interest_rate":null,"valuation_cap":null,"opportunity_name":"VEGINVEST","sourcing_contract_ref":"VEG_VC6_TR5","contract_date":"2021-03-09 00:00:00","extra_cols":["Investor Name","Currency","Funded Amount","Shares","Current Position","Notes"]},{"row_num":123,"entity_code":"VC106","investor_name":"Hedgebay Securities LLC","investor_type":"entity","currency":"USD","commitment":100007.04,"funded_amount":100007.04,"shares":4252,"current_position":4252,"notes":null,"price_per_share":23.52,"cost_per_share":16,"subscription_fee_percent":0,"subscription_fee_amount":0,"performance_fee_tier1_percent":0,"performance_fee_tier1_threshold":null,"performance_fee_tier2_percent":null,"performance_fee_tier2_threshold":null,"spread_per_share":6.81,"spread_fee_amount":28956.12,"management_fee_percent":null,"bd_fee_percent":0,"bd_fee_amount":0,"finra_fee_shares":0.71,"finra_fee_amount":3018.92,"discount_rate":null,"interest_rate":null,"valuation_cap":null,"opportunity_name":"VEGINVEST","sourcing_contract_ref":"VEG_VC6_TR5","contract_date":"2021-03-06 00:00:00","extra_cols":["Investor Name","Currency","Shares","Current Position","Notes"]},{"row_num":128,"entity_code":"VC106","investor_name":"INNOSIGHT VENTURES Pte Ltd","investor_type":"entity","currency":"USD","commitment":164640,"funded_amount":164640,"shares":7000,"current_position":7000,"notes":null,"price_per_share":23.52,"cost_per_share":21,"subscription_fee_percent":0,"subscription_fee_amount":0,"performance_fee_tier1_percent":0,"performance_fee_tier1_threshold":null,"performance_fee_tier2_percent":null,"performance_fee_tier2_threshold":null,"spread_per_share":4.02,"spread_fee_amount":28140,"management_fee_percent":null,"bd_fee_percent":0,"bd_fee_amount":0,"finra_fee_shares":0,"finra_fee_amount":0,"discount_rate":null,"interest_rate":null,"valuation_cap":null,"opportunity_name":"VEGINVEST","sourcing_contract_ref":"VEG_VC6_TR8","contract_date":"2021-03-23 00:00:00","extra_cols":["Currency","Shares","Current Position","Notes"]},{"row_num":129,"entity_code":"VC106","investor_name":"INNOSIGHT VENTURES Pte Ltd","investor_type":"entity","currency":"USD","commitment":588000,"funded_amount":588000,"shares":25000,"current_position":25000,"notes":null,"price_per_share":23.52,"cost_per_share":16,"subscription_fee_percent":0,"subscription_fee_amount":0,"performance_fee_tier1_percent":0,"performance_fee_tier1_threshold":null,"performance_fee_tier2_percent":null,"performance_fee_tier2_threshold":null,"spread_per_share":7.52,"spread_fee_amount":188000,"management_fee_percent":null,"bd_fee_percent":0,"bd_fee_amount":0,"finra_fee_shares":0,"finra_fee_amount":0,"discount_rate":null,"interest_rate":null,"valuation_cap":null,"opportunity_name":"VEGINVEST","sourcing_contract_ref":"VEG_VC6_TR5","contract_date":"2021-03-23 00:00:00","extra_cols":["Currency","Shares","Current Position","Notes"]},{"row_num":141,"entity_code":"VC106","investor_name":"Julien MACHOT","investor_type":"individual","currency":"USD","commitment":70902,"funded_amount":70902,"shares":3636,"current_position":3636,"notes":null,"price_per_share":19.5,"cost_per_share":null,"subscription_fee_percent":0,"subscription_fee_amount":0,"performance_fee_tier1_percent":null,"performance_fee_tier1_threshold":null,"performance_fee_tier2_percent":null,"performance_fee_tier2_threshold":null,"spread_per_share":0,"spread_fee_amount":0,"management_fee_percent":null,"bd_fee_percent":null,"bd_fee_amount":null,"finra_fee_shares":null,"finra_fee_amount":null,"discount_rate":null,"interest_rate":null,"valuation_cap":null,"opportunity_name":"VEGINVEST","sourcing_contract_ref":"VEG_VC6_TR8","contract_date":"2022-03-03 00:00:00","extra_cols":["Currency","Shares","Current Position","Notes"]},{"row_num":142,"entity_code":"VC106","investor_name":"Julien MACHOT","investor_type":"individual","currency":"USD","commitment":234607,"funded_amount":234607,"shares":20947,"current_position":20947,"notes":null,"price_per_share":11.2,"cost_per_share":null,"subscription_fee_percent":0,"subscription_fee_amount":0,"performance_fee_tier1_percent":null,"performance_fee_tier1_threshold":null,"performance_fee_tier2_percent":null,"performance_fee_tier2_threshold":null,"spread_per_share":0,"spread_fee_amount":0,"management_fee_percent":null,"bd_fee_percent":null,"bd_fee_amount":null,"finra_fee_shares":null,"finra_fee_amount":null,"discount_rate":null,"interest_rate":null,"valuation_cap":null,"opportunity_name":"VEGINVEST","sourcing_contract_ref":"VEG_VC6_TR12","contract_date":"2021-02-09 00:00:00","extra_cols":["Currency","Shares","Current Position","Notes"]},{"row_num":143,"entity_code":"VC106","investor_name":"Julien MACHOT","investor_type":"individual","currency":"USD","commitment":434863,"funded_amount":434863,"shares":38827,"current_position":38827,"notes":null,"price_per_share":11.2,"cost_per_share":null,"subscription_fee_percent":0,"subscription_fee_amount":0,"performance_fee_tier1_percent":null,"performance_fee_tier1_threshold":null,"performance_fee_tier2_percent":null,"performance_fee_tier2_threshold":null,"spread_per_share":0,"spread_fee_amount":0,"management_fee_percent":null,"bd_fee_percent":null,"bd_fee_amount":null,"finra_fee_shares":null,"finra_fee_amount":null,"discount_rate":null,"interest_rate":null,"valuation_cap":null,"opportunity_name":"VEGINVEST","sourcing_contract_ref":"VEG_VC6_TR12","contract_date":"2021-02-09 00:00:00","extra_cols":["Currency","Shares","Current Position","Notes"]},{"row_num":144,"entity_code":"VC106","investor_name":"Julien MACHOT","investor_type":"individual","currency":"USD","commitment":1360000,"funded_amount":1360000,"shares":68000,"current_position":36742,"notes":null,"price_per_share":20,"cost_per_share":20,"subscription_fee_percent":0,"subscription_fee_amount":0,"performance_fee_tier1_percent":null,"performance_fee_tier1_threshold":null,"performance_fee_tier2_percent":null,"performance_fee_tier2_threshold":null,"spread_per_share":0,"spread_fee_amount":0,"management_fee_percent":null,"bd_fee_percent":null,"bd_fee_amount":null,"finra_fee_shares":null,"finra_fee_amount":null,"discount_rate":null,"interest_rate":null,"valuation_cap":null,"opportunity_name":"CHRIS JONES","sourcing_contract_ref":null,"contract_date":"2021-03-19 00:00:00","extra_cols":["Currency","Shares","Current Position","Notes"]},{"row_num":155,"entity_code":"VC106","investor_name":"Laurence CHANG","investor_type":"individual","currency":"USD","commitment":50000,"funded_amount":50000,"shares":2500,"current_position":2500,"notes":null,"price_per_share":20,"cost_per_share":14,"subscription_fee_percent":0,"subscription_fee_amount":0,"performance_fee_tier1_percent":0,"performance_fee_tier1_threshold":null,"performance_fee_tier2_percent":null,"performance_fee_tier2_threshold":null,"spread_per_share":6.5,"spread_fee_amount":16250,"management_fee_percent":null,"bd_fee_percent":0.1,"bd_fee_amount":0.1,"finra_fee_shares":2,"finra_fee_amount":5000,"discount_rate":null,"interest_rate":null,"valuation_cap":null,"opportunity_name":"VEGINVEST","sourcing_contract_ref":"VEG_VC6_TR2","contract_date":"2021-01-26 00:00:00","extra_cols":["Currency","Shares","Current Position","Notes"]},{"row_num":156,"entity_code":"VC106","investor_name":"Laurence CHANG","investor_type":"individual","currency":"USD","commitment":100000,"funded_amount":100000,"shares":5000,"current_position":5000,"notes":null,"price_per_share":20,"cost_per_share":13.5,"subscription_fee_percent":0,"subscription_fee_amount":0,"performance_fee_tier1_percent":0,"performance_fee_tier1_threshold":null,"performance_fee_tier2_percent":null,"performance_fee_tier2_threshold":null,"spread_per_share":6.5,"spread_fee_amount":32500,"management_fee_percent":null,"bd_fee_percent":0.1,"bd_fee_amount":0.1,"finra_fee_shares":2,"finra_fee_amount":10000,"discount_rate":null,"interest_rate":null,"valuation_cap":null,"opportunity_name":"VEGINVEST","sourcing_contract_ref":"VEG_VC6_TR1","contract_date":"2020-12-22 00:00:00","extra_cols":["Currency","Shares","Current Position","Notes"]},{"row_num":158,"entity_code":"VC106","investor_name":"LEE RAND GROUP","investor_type":"entity","currency":"USD","commitment":24985,"funded_amount":24985,"shares":1315,"current_position":1315,"notes":null,"price_per_share":19,"cost_per_share":14,"subscription_fee_percent":0,"subscription_fee_amount":0,"performance_fee_tier1_percent":0,"performance_fee_tier1_threshold":null,"performance_fee_tier2_percent":null,"performance_fee_tier2_threshold":null,"spread_per_share":5,"spread_fee_amount":6575,"management_fee_percent":null,"bd_fee_percent":0,"bd_fee_amount":0,"finra_fee_shares":0,"finra_fee_amount":0,"discount_rate":null,"interest_rate":null,"valuation_cap":null,"opportunity_name":"VEGINVEST","sourcing_contract_ref":"VEG_VC6_TR4","contract_date":"2021-02-15 00:00:00","extra_cols":["Investor Name","Investor Type","Currency","Shares","Current Position","Notes"]},{"row_num":159,"entity_code":"VC106","investor_name":"LEE RAND GROUP","investor_type":"entity","currency":"USD","commitment":24985,"funded_amount":0,"shares":1315,"current_position":1315,"notes":null,"price_per_share":19,"cost_per_share":14,"subscription_fee_percent":0,"subscription_fee_amount":0,"performance_fee_tier1_percent":null,"performance_fee_tier1_threshold":null,"performance_fee_tier2_percent":null,"performance_fee_tier2_threshold":null,"spread_per_share":5,"spread_fee_amount":6575,"management_fee_percent":null,"bd_fee_percent":null,"bd_fee_amount":null,"finra_fee_shares":null,"finra_fee_amount":null,"discount_rate":null,"interest_rate":null,"valuation_cap":null,"opportunity_name":"VEGINVEST","sourcing_contract_ref":"VEG_VC6_TR4","contract_date":"2021-02-16 00:00:00","extra_cols":["Investor Name","Investor Type","Currency","Funded Amount","Shares","Current Position","Notes"]},{"row_num":160,"entity_code":"VC106","investor_name":"LEE RAND GROUP","investor_type":"entity","currency":"USD","commitment":34998,"funded_amount":34998,"shares":1842,"current_position":1842,"notes":null,"price_per_share":19,"cost_per_share":14,"subscription_fee_percent":0,"subscription_fee_amount":0,"performance_fee_tier1_percent":0,"performance_fee_tier1_threshold":null,"performance_fee_tier2_percent":null,"performance_fee_tier2_threshold":null,"spread_per_share":5,"spread_fee_amount":9210,"management_fee_percent":null,"bd_fee_percent":0,"bd_fee_amount":0,"finra_fee_shares":0,"finra_fee_amount":0,"discount_rate":null,"interest_rate":null,"valuation_cap":null,"opportunity_name":"VEGINVEST","sourcing_contract_ref":"VEG_VC6_TR4","contract_date":"2021-02-16 00:00:00","extra_cols":["Investor Name","Investor Type","Currency","Shares","Current Position","Notes"]},{"row_num":161,"entity_code":"VC106","investor_name":"LEE RAND GROUP","investor_type":"entity","currency":"USD","commitment":49989,"funded_amount":0,"shares":2631,"current_position":2631,"notes":null,"price_per_share":19,"cost_per_share":14,"subscription_fee_percent":0,"subscription_fee_amount":0,"performance_fee_tier1_percent":null,"performance_fee_tier1_threshold":null,"performance_fee_tier2_percent":null,"performance_fee_tier2_threshold":null,"spread_per_share":5,"spread_fee_amount":13155,"management_fee_percent":null,"bd_fee_percent":null,"bd_fee_amount":null,"finra_fee_shares":null,"finra_fee_amount":null,"discount_rate":null,"interest_rate":null,"valuation_cap":null,"opportunity_name":"VEGINVEST","sourcing_contract_ref":"VEG_VC6_TR4","contract_date":"2021-02-15 00:00:00","extra_cols":["Investor Name","Investor Type","Currency","Funded Amount","Shares","Current Position","Notes"]},{"row_num":162,"entity_code":"VC106","investor_name":"LEE RAND GROUP","investor_type":"entity","currency":"USD","commitment":49989,"funded_amount":49989,"shares":2631,"current_position":2631,"notes":null,"price_per_share":19,"cost_per_share":14,"subscription_fee_percent":0,"subscription_fee_amount":0,"performance_fee_tier1_percent":0,"performance_fee_tier1_threshold":null,"performance_fee_tier2_percent":null,"performance_fee_tier2_threshold":null,"spread_per_share":5,"spread_fee_amount":13155,"management_fee_percent":null,"bd_fee_percent":0,"bd_fee_amount":0,"finra_fee_shares":0,"finra_fee_amount":0,"discount_rate":null,"interest_rate":null,"valuation_cap":null,"opportunity_name":"VEGINVEST","sourcing_contract_ref":"VEG_VC6_TR4","contract_date":"2021-02-16 00:00:00","extra_cols":["Investor Name","Investor Type","Currency","Shares","Current Position","Notes"]},{"row_num":163,"entity_code":"VC106","investor_name":"LEE RAND GROUP","investor_type":"entity","currency":"USD","commitment":49989,"funded_amount":0,"shares":2631,"current_position":2631,"notes":null,"price_per_share":19,"cost_per_share":14,"subscription_fee_percent":0,"subscription_fee_amount":0,"performance_fee_tier1_percent":null,"performance_fee_tier1_threshold":null,"performance_fee_tier2_percent":null,"performance_fee_tier2_threshold":null,"spread_per_share":5,"spread_fee_amount":13155,"management_fee_percent":null,"bd_fee_percent":null,"bd_fee_amount":null,"finra_fee_shares":null,"finra_fee_amount":null,"discount_rate":null,"interest_rate":null,"valuation_cap":null,"opportunity_name":"VEGINVEST","sourcing_contract_ref":"VEG_VC6_TR4","contract_date":"2021-02-16 00:00:00","extra_cols":["Investor Name","Investor Type","Currency","Funded Amount","Shares","Current Position","Notes"]},{"row_num":164,"entity_code":"VC106","investor_name":"LEE RAND GROUP","investor_type":"entity","currency":"USD","commitment":199994,"funded_amount":199994,"shares":10526,"current_position":10526,"notes":null,"price_per_share":19,"cost_per_share":14,"subscription_fee_percent":0,"subscription_fee_amount":0,"performance_fee_tier1_percent":0,"performance_fee_tier1_threshold":null,"performance_fee_tier2_percent":null,"performance_fee_tier2_threshold":null,"spread_per_share":5,"spread_fee_amount":52630,"management_fee_percent":null,"bd_fee_percent":0,"bd_fee_amount":0,"finra_fee_shares":0,"finra_fee_amount":0,"discount_rate":null,"interest_rate":null,"valuation_cap":null,"opportunity_name":"VEGINVEST","sourcing_contract_ref":"VEG_VC6_TR4","contract_date":"2021-02-15 00:00:00","extra_cols":["Investor Name","Investor Type","Currency","Shares","Current Position","Notes"]},{"row_num":180,"entity_code":"VC106","investor_name":"Murat Cem and Mehmet Can GOKER","investor_type":"individual","currency":"USD","commitment":350000,"funded_amount":350000,"shares":14880,"current_position":14880,"notes":null,"price_per_share":23.52,"cost_per_share":21,"subscription_fee_percent":0.02,"subscription_fee_amount":7000,"performance_fee_tier1_percent":0,"performance_fee_tier1_threshold":null,"performance_fee_tier2_percent":null,"performance_fee_tier2_threshold":null,"spread_per_share":4.02,"spread_fee_amount":59817.6,"management_fee_percent":null,"bd_fee_percent":0,"bd_fee_amount":0,"finra_fee_shares":0,"finra_fee_amount":0,"discount_rate":null,"interest_rate":null,"valuation_cap":null,"opportunity_name":"VEGINVEST","sourcing_contract_ref":"VEG_VC6_TR8","contract_date":"2021-05-21 00:00:00","extra_cols":["Currency","Shares","Current Position","Notes"]},{"row_num":181,"entity_code":"VC106","investor_name":"Murat Cem and Mehmet Can GOKER","investor_type":"individual","currency":"USD","commitment":650000,"funded_amount":650000,"shares":27636,"current_position":27636,"notes":null,"price_per_share":23.52,"cost_per_share":21,"subscription_fee_percent":0.02,"subscription_fee_amount":13000,"performance_fee_tier1_percent":0,"performance_fee_tier1_threshold":null,"performance_fee_tier2_percent":null,"performance_fee_tier2_threshold":null,"spread_per_share":6.52,"spread_fee_amount":180186.72,"management_fee_percent":null,"bd_fee_percent":0,"bd_fee_amount":0,"finra_fee_shares":0,"finra_fee_amount":0,"discount_rate":null,"interest_rate":null,"valuation_cap":null,"opportunity_name":"VEGINVEST","sourcing_contract_ref":"VEG_VC6_TR9","contract_date":"2021-06-27 00:00:00","extra_cols":["Currency","Shares","Current Position","Notes"]},{"row_num":184,"entity_code":"VC106","investor_name":"Nilakantan MAHESWARI & Subbiah SUBRAMANIAN","investor_type":"individual","currency":"USD","commitment":155000,"funded_amount":0,"shares":6733,"current_position":6733,"notes":null,"price_per_share":23.02,"cost_per_share":14,"subscription_fee_percent":null,"subscription_fee_amount":null,"performance_fee_tier1_percent":0.1,"performance_fee_tier1_threshold":null,"performance_fee_tier2_percent":null,"performance_fee_tier2_threshold":null,"spread_per_share":9.02,"spread_fee_amount":60731.66,"management_fee_percent":null,"bd_fee_percent":null,"bd_fee_amount":null,"finra_fee_shares":null,"finra_fee_amount":null,"discount_rate":null,"interest_rate":null,"valuation_cap":null,"opportunity_name":"VEGINVEST","sourcing_contract_ref":"VEG_VC6_TR4","contract_date":"2021-02-12 00:00:00","extra_cols":["Currency","Funded Amount","Shares","Current Position"]},{"row_num":185,"entity_code":"VC106","investor_name":"OEP Ltd","investor_type":"entity","currency":"USD","commitment":250000,"funded_amount":0,"shares":11905,"current_position":11905,"notes":null,"price_per_share":21,"cost_per_share":13.5,"subscription_fee_percent":0,"subscription_fee_amount":0,"performance_fee_tier1_percent":null,"performance_fee_tier1_threshold":null,"performance_fee_tier2_percent":null,"performance_fee_tier2_threshold":null,"spread_per_share":7.5,"spread_fee_amount":89287.5,"management_fee_percent":null,"bd_fee_percent":null,"bd_fee_amount":null,"finra_fee_shares":null,"finra_fee_amount":null,"discount_rate":null,"interest_rate":null,"valuation_cap":null,"opportunity_name":"VEGINVEST","sourcing_contract_ref":"VEG_VC6_TR2","contract_date":"2022-01-01 00:00:00","extra_cols":["Currency","Funded Amount","Shares","Current Position"]},{"row_num":208,"entity_code":"VC106","investor_name":"Scott FLETCHER","investor_type":"individual","currency":"USD","commitment":500000,"funded_amount":500000,"shares":21258,"current_position":21258,"notes":null,"price_per_share":23.52,"cost_per_share":null,"subscription_fee_percent":0.02,"subscription_fee_amount":10000,"performance_fee_tier1_percent":0,"performance_fee_tier1_threshold":null,"performance_fee_tier2_percent":null,"performance_fee_tier2_threshold":null,"spread_per_share":3.52,"spread_fee_amount":74828.16,"management_fee_percent":null,"bd_fee_percent":0,"bd_fee_amount":0,"finra_fee_shares":0,"finra_fee_amount":0,"discount_rate":null,"interest_rate":null,"valuation_cap":null,"opportunity_name":"J.MACHOT","sourcing_contract_ref":null,"contract_date":"2021-06-28 00:00:00","extra_cols":["Currency","Shares","Current Position","Notes"]},{"row_num":209,"entity_code":"VC106","investor_name":"Scott FLETCHER","investor_type":"individual","currency":"USD","commitment":500000,"funded_amount":0,"shares":21258,"current_position":21258,"notes":null,"price_per_share":23.52,"cost_per_share":21,"subscription_fee_percent":0.02,"subscription_fee_amount":10000,"performance_fee_tier1_percent":0.1,"performance_fee_tier1_threshold":null,"performance_fee_tier2_percent":null,"performance_fee_tier2_threshold":null,"spread_per_share":6.52,"spread_fee_amount":138602.16,"management_fee_percent":null,"bd_fee_percent":null,"bd_fee_amount":null,"finra_fee_shares":null,"finra_fee_amount":null,"discount_rate":null,"interest_rate":null,"valuation_cap":null,"opportunity_name":"VEGINVEST","sourcing_contract_ref":"VEG_VC6_TR9","contract_date":"2021-06-28 00:00:00","extra_cols":["Currency","Funded Amount","Shares","Current Position","Notes"]},{"row_num":228,"entity_code":"VC106","investor_name":"VERSO GROUP","investor_type":"entity","currency":"USD","commitment":0,"funded_amount":0,"shares":0,"current_position":0,"notes":null,"price_per_share":20,"cost_per_share":null,"subscription_fee_percent":0,"subscription_fee_amount":0,"performance_fee_tier1_percent":null,"performance_fee_tier1_threshold":null,"performance_fee_tier2_percent":null,"performance_fee_tier2_threshold":null,"spread_per_share":0,"spread_fee_amount":0,"management_fee_percent":null,"bd_fee_percent":null,"bd_fee_amount":null,"finra_fee_shares":null,"finra_fee_amount":null,"discount_rate":null,"interest_rate":null,"valuation_cap":null,"opportunity_name":"J.MACHOT","sourcing_contract_ref":null,"contract_date":"2021-05-17 00:00:00","extra_cols":["Entity Code","Investor Name","Investor Type","Currency","Commitment","Funded Amount","Shares","Current Position","Notes","Price Per Share","Cost Per Share","Subscription Fee (%)","Subscription Fee Amount","Performance Fee Tier 1 (%)","Performance Fee Tier 1 Threshold","Performance Fee Tier 2 (%)","Performance Fee Tier 2 Threshold","Spread Per Share","Spread Fee Amount","Management Fee (%)","BD Fee (%)","BD Fee Amount","FINRA Fee Shares","FINRA Fee Amount","Discount Rate","Interest Rate","Valuation Cap","Opportunity Name","Sourcing Contract Ref","Contract Date"]}]'::jsonb) as x(
    row_num int,
    entity_code text,
    investor_name text,
    investor_type text,
    currency text,
    commitment numeric,
    funded_amount numeric,
    shares numeric,
    current_position numeric,
    notes text,
    price_per_share numeric,
    cost_per_share numeric,
    subscription_fee_percent numeric,
    subscription_fee_amount numeric,
    performance_fee_tier1_percent numeric,
    performance_fee_tier1_threshold numeric,
    performance_fee_tier2_percent numeric,
    performance_fee_tier2_threshold numeric,
    spread_per_share numeric,
    spread_fee_amount numeric,
    management_fee_percent numeric,
    bd_fee_percent numeric,
    bd_fee_amount numeric,
    finra_fee_shares numeric,
    finra_fee_amount numeric,
    discount_rate numeric,
    interest_rate numeric,
    valuation_cap numeric,
    opportunity_name text,
    sourcing_contract_ref text,
    contract_date date,
    extra_cols text[]
  )
), matched as (
  select vfd.*, v.id as vehicle_id,
         s.id as subscription_id,
         i.id as investor_id,
         coalesce(i.display_name,i.legal_name, trim(coalesce(i.first_name,'')||' '||coalesce(i.last_name,''))) as db_investor,
         i.type as db_investor_type,
         s.currency as db_currency,
         s.commitment as db_commitment,
         s.funded_amount as db_funded_amount,
         s.num_shares as db_shares,
         s.contract_date as db_contract_date,
         s.subscription_fee_amount as db_subscription_fee_amount,
         s.subscription_fee_percent as db_subscription_fee_percent,
         s.spread_fee_amount as db_spread_fee_amount,
         s.spread_per_share as db_spread_per_share,
         s.bd_fee_amount as db_bd_fee_amount,
         s.bd_fee_percent as db_bd_fee_percent,
         s.finra_fee_amount as db_finra_fee_amount,
         s.finra_shares as db_finra_fee_shares,
         s.price_per_share as db_price_per_share,
         s.cost_per_share as db_cost_per_share,
         s.performance_fee_tier1_percent as db_pf1,
         s.performance_fee_tier1_threshold as db_pf1_th,
         s.performance_fee_tier2_percent as db_pf2,
         s.performance_fee_tier2_threshold as db_pf2_th,
         s.management_fee_percent as db_management_fee_percent,
         s.discount_rate as db_discount_rate,
         s.interest_rate as db_interest_rate,
         s.valuation_cap as db_valuation_cap,
         s.opportunity_name as db_opportunity_name,
         s.sourcing_contract_ref as db_sourcing_contract_ref,
         s.acknowledgement_notes as db_notes
  from vfd
  left join vehicles v on v.entity_code = vfd.entity_code
  left join subscriptions s on s.vehicle_id = v.id
     and s.commitment = vfd.commitment
     and ( (s.num_shares is null and vfd.shares is null) or s.num_shares = vfd.shares )
     and ( (s.contract_date is null and vfd.contract_date is null) or s.contract_date = vfd.contract_date )
  left join investors i on i.id = s.investor_id
), with_pos as (
  select m.*, p.units as db_current_position
  from matched m
  left join positions p on p.investor_id=m.investor_id and p.vehicle_id=m.vehicle_id
), with_diffs as (
  select *,
    array_remove(array[CASE WHEN 'Investor Name' = ANY(extra_cols) AND investor_name IS DISTINCT FROM db_investor THEN 'investor_name' END,CASE WHEN 'Investor Type' = ANY(extra_cols) AND investor_type IS DISTINCT FROM db_investor_type THEN 'investor_type' END,CASE WHEN 'Currency' = ANY(extra_cols) AND currency IS DISTINCT FROM db_currency THEN 'currency' END,CASE WHEN 'Commitment' = ANY(extra_cols) AND commitment IS DISTINCT FROM db_commitment THEN 'commitment' END,CASE WHEN 'Funded Amount' = ANY(extra_cols) AND funded_amount IS DISTINCT FROM db_funded_amount THEN 'funded_amount' END,CASE WHEN 'Shares' = ANY(extra_cols) AND shares IS DISTINCT FROM db_shares THEN 'shares' END,CASE WHEN 'Current Position' = ANY(extra_cols) AND current_position IS DISTINCT FROM db_current_position THEN 'current_position' END,CASE WHEN 'Notes' = ANY(extra_cols) AND notes IS DISTINCT FROM db_notes THEN 'notes' END,CASE WHEN 'Price Per Share' = ANY(extra_cols) AND price_per_share IS DISTINCT FROM db_price_per_share THEN 'price_per_share' END,CASE WHEN 'Cost Per Share' = ANY(extra_cols) AND cost_per_share IS DISTINCT FROM db_cost_per_share THEN 'cost_per_share' END,CASE WHEN 'Subscription Fee (%)' = ANY(extra_cols) AND subscription_fee_percent IS DISTINCT FROM db_subscription_fee_percent THEN 'subscription_fee_percent' END,CASE WHEN 'Subscription Fee Amount' = ANY(extra_cols) AND subscription_fee_amount IS DISTINCT FROM db_subscription_fee_amount THEN 'subscription_fee_amount' END,CASE WHEN 'Performance Fee Tier 1 (%)' = ANY(extra_cols) AND performance_fee_tier1_percent IS DISTINCT FROM db_pf1 THEN 'performance_fee_tier1_percent' END,CASE WHEN 'Performance Fee Tier 1 Threshold' = ANY(extra_cols) AND performance_fee_tier1_threshold IS DISTINCT FROM db_pf1_th THEN 'performance_fee_tier1_threshold' END,CASE WHEN 'Performance Fee Tier 2 (%)' = ANY(extra_cols) AND performance_fee_tier2_percent IS DISTINCT FROM db_pf2 THEN 'performance_fee_tier2_percent' END,CASE WHEN 'Performance Fee Tier 2 Threshold' = ANY(extra_cols) AND performance_fee_tier2_threshold IS DISTINCT FROM db_pf2_th THEN 'performance_fee_tier2_threshold' END,CASE WHEN 'Spread Per Share' = ANY(extra_cols) AND spread_per_share IS DISTINCT FROM db_spread_per_share THEN 'spread_per_share' END,CASE WHEN 'Spread Fee Amount' = ANY(extra_cols) AND spread_fee_amount IS DISTINCT FROM db_spread_fee_amount THEN 'spread_fee_amount' END,CASE WHEN 'Management Fee (%)' = ANY(extra_cols) AND management_fee_percent IS DISTINCT FROM db_management_fee_percent THEN 'management_fee_percent' END,CASE WHEN 'BD Fee (%)' = ANY(extra_cols) AND bd_fee_percent IS DISTINCT FROM db_bd_fee_percent THEN 'bd_fee_percent' END,CASE WHEN 'BD Fee Amount' = ANY(extra_cols) AND bd_fee_amount IS DISTINCT FROM db_bd_fee_amount THEN 'bd_fee_amount' END,CASE WHEN 'FINRA Fee Shares' = ANY(extra_cols) AND finra_fee_shares IS DISTINCT FROM db_finra_fee_shares THEN 'finra_fee_shares' END,CASE WHEN 'FINRA Fee Amount' = ANY(extra_cols) AND finra_fee_amount IS DISTINCT FROM db_finra_fee_amount THEN 'finra_fee_amount' END,CASE WHEN 'Discount Rate' = ANY(extra_cols) AND discount_rate IS DISTINCT FROM db_discount_rate THEN 'discount_rate' END,CASE WHEN 'Interest Rate' = ANY(extra_cols) AND interest_rate IS DISTINCT FROM db_interest_rate THEN 'interest_rate' END,CASE WHEN 'Valuation Cap' = ANY(extra_cols) AND valuation_cap IS DISTINCT FROM db_valuation_cap THEN 'valuation_cap' END,CASE WHEN 'Opportunity Name' = ANY(extra_cols) AND opportunity_name IS DISTINCT FROM db_opportunity_name THEN 'opportunity_name' END,CASE WHEN 'Sourcing Contract Ref' = ANY(extra_cols) AND sourcing_contract_ref IS DISTINCT FROM db_sourcing_contract_ref THEN 'sourcing_contract_ref' END,CASE WHEN 'Contract Date' = ANY(extra_cols) AND contract_date IS DISTINCT FROM db_contract_date THEN 'contract_date' END], NULL) as diff_fields,
    jsonb_strip_nulls(jsonb_build_object('investor_name', CASE WHEN 'Investor Name' = ANY(extra_cols) THEN jsonb_build_object('vfd',investor_name,'db',db_investor) END,'investor_type', CASE WHEN 'Investor Type' = ANY(extra_cols) THEN jsonb_build_object('vfd',investor_type,'db',db_investor_type) END,'currency', CASE WHEN 'Currency' = ANY(extra_cols) THEN jsonb_build_object('vfd',currency,'db',db_currency) END,'commitment', CASE WHEN 'Commitment' = ANY(extra_cols) THEN jsonb_build_object('vfd',commitment,'db',db_commitment) END,'funded_amount', CASE WHEN 'Funded Amount' = ANY(extra_cols) THEN jsonb_build_object('vfd',funded_amount,'db',db_funded_amount) END,'shares', CASE WHEN 'Shares' = ANY(extra_cols) THEN jsonb_build_object('vfd',shares,'db',db_shares) END,'current_position', CASE WHEN 'Current Position' = ANY(extra_cols) THEN jsonb_build_object('vfd',current_position,'db',db_current_position) END,'notes', CASE WHEN 'Notes' = ANY(extra_cols) THEN jsonb_build_object('vfd',notes,'db',db_notes) END,'price_per_share', CASE WHEN 'Price Per Share' = ANY(extra_cols) THEN jsonb_build_object('vfd',price_per_share,'db',db_price_per_share) END,'cost_per_share', CASE WHEN 'Cost Per Share' = ANY(extra_cols) THEN jsonb_build_object('vfd',cost_per_share,'db',db_cost_per_share) END,'subscription_fee_percent', CASE WHEN 'Subscription Fee (%)' = ANY(extra_cols) THEN jsonb_build_object('vfd',subscription_fee_percent,'db',db_subscription_fee_percent) END,'subscription_fee_amount', CASE WHEN 'Subscription Fee Amount' = ANY(extra_cols) THEN jsonb_build_object('vfd',subscription_fee_amount,'db',db_subscription_fee_amount) END,'performance_fee_tier1_percent', CASE WHEN 'Performance Fee Tier 1 (%)' = ANY(extra_cols) THEN jsonb_build_object('vfd',performance_fee_tier1_percent,'db',db_pf1) END,'performance_fee_tier1_threshold', CASE WHEN 'Performance Fee Tier 1 Threshold' = ANY(extra_cols) THEN jsonb_build_object('vfd',performance_fee_tier1_threshold,'db',db_pf1_th) END,'performance_fee_tier2_percent', CASE WHEN 'Performance Fee Tier 2 (%)' = ANY(extra_cols) THEN jsonb_build_object('vfd',performance_fee_tier2_percent,'db',db_pf2) END,'performance_fee_tier2_threshold', CASE WHEN 'Performance Fee Tier 2 Threshold' = ANY(extra_cols) THEN jsonb_build_object('vfd',performance_fee_tier2_threshold,'db',db_pf2_th) END,'spread_per_share', CASE WHEN 'Spread Per Share' = ANY(extra_cols) THEN jsonb_build_object('vfd',spread_per_share,'db',db_spread_per_share) END,'spread_fee_amount', CASE WHEN 'Spread Fee Amount' = ANY(extra_cols) THEN jsonb_build_object('vfd',spread_fee_amount,'db',db_spread_fee_amount) END,'management_fee_percent', CASE WHEN 'Management Fee (%)' = ANY(extra_cols) THEN jsonb_build_object('vfd',management_fee_percent,'db',db_management_fee_percent) END,'bd_fee_percent', CASE WHEN 'BD Fee (%)' = ANY(extra_cols) THEN jsonb_build_object('vfd',bd_fee_percent,'db',db_bd_fee_percent) END,'bd_fee_amount', CASE WHEN 'BD Fee Amount' = ANY(extra_cols) THEN jsonb_build_object('vfd',bd_fee_amount,'db',db_bd_fee_amount) END,'finra_fee_shares', CASE WHEN 'FINRA Fee Shares' = ANY(extra_cols) THEN jsonb_build_object('vfd',finra_fee_shares,'db',db_finra_fee_shares) END,'finra_fee_amount', CASE WHEN 'FINRA Fee Amount' = ANY(extra_cols) THEN jsonb_build_object('vfd',finra_fee_amount,'db',db_finra_fee_amount) END,'discount_rate', CASE WHEN 'Discount Rate' = ANY(extra_cols) THEN jsonb_build_object('vfd',discount_rate,'db',db_discount_rate) END,'interest_rate', CASE WHEN 'Interest Rate' = ANY(extra_cols) THEN jsonb_build_object('vfd',interest_rate,'db',db_interest_rate) END,'valuation_cap', CASE WHEN 'Valuation Cap' = ANY(extra_cols) THEN jsonb_build_object('vfd',valuation_cap,'db',db_valuation_cap) END,'opportunity_name', CASE WHEN 'Opportunity Name' = ANY(extra_cols) THEN jsonb_build_object('vfd',opportunity_name,'db',db_opportunity_name) END,'sourcing_contract_ref', CASE WHEN 'Sourcing Contract Ref' = ANY(extra_cols) THEN jsonb_build_object('vfd',sourcing_contract_ref,'db',db_sourcing_contract_ref) END,'contract_date', CASE WHEN 'Contract Date' = ANY(extra_cols) THEN jsonb_build_object('vfd',contract_date,'db',db_contract_date) END)) as change_values
  from with_pos
)
select row_num, entity_code, investor_name, subscription_id, db_investor, diff_fields, change_values
from with_diffs
where subscription_id is null or array_length(diff_fields,1) > 0
order by row_num;
